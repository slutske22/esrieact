"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[99590],{55727:(e,t,s)=>{s.d(t,{c:()=>w});s(39831);var i=s(25423),r=s(99776),o=s(62146),n=s(46729),l=s(6267),a=s(4754),h=(s(75976),s(42482)),c=(s(36791),s(62540),s(73318)),y=s(89423),u=s(41746),d=s(80976);class f{constructor(e,t){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let s=1;const i=new Uint32Array(e);this.layerUIDs=[];const r=i[s++];for(let o=0;o<r;o++)this.layerUIDs[o]=i[s++];this.bufferDataOffset=s,t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){null!=this._data&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}}class _ extends f{constructor(e,t){super(e,t),this.type=n.NP.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const s=new Uint32Array(e);let i=this.bufferDataOffset;this.lineIndexStart=s[i++],this.lineIndexCount=s[i++];const r=s[i++];if(r>0){this.patternMap=new Map;for(let e=0;e<r;e++){const e=s[i++],t=s[i++],r=s[i++];this.patternMap.set(e,[t,r])}}this.bufferDataOffset=i}get usedMemory(){return(this.data?.byteLength??0)+(this.vao?.cachedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=(0,l.WD)(this.vao)}doPrepareForRendering(e,t,s){const i=new Uint32Array(t),r=new Int32Array(i.buffer),o=i[s++],n=y.g.createVertex(e,u._U.STATIC_DRAW,new Int32Array(r.buffer,4*s,o));s+=o;const l=i[s++],a=y.g.createIndex(e,u._U.STATIC_DRAW,new Uint32Array(i.buffer,4*s,l));s+=l;const h=this.layer.lineMaterial;this.vao=new d.Z(e,h.getAttributeLocations(),h.getLayoutInfo(),new Map([["geometry",n]]),a)}}class m extends f{constructor(e,t){super(e,t),this.type=n.NP.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const s=new Uint32Array(e);let i=this.bufferDataOffset;this.fillIndexStart=s[i++],this.fillIndexCount=s[i++],this.outlineIndexStart=s[i++],this.outlineIndexCount=s[i++];const r=s[i++];if(r>0){this.patternMap=new Map;for(let e=0;e<r;e++){const e=s[i++],t=s[i++],r=s[i++];this.patternMap.set(e,[t,r])}}this.bufferDataOffset=i}get usedMemory(){return(this.data?.byteLength??0)+(this.fillVAO?.cachedMemory??0)+(this.outlineVAO?.cachedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=(0,l.WD)(this.fillVAO),this.outlineVAO=(0,l.WD)(this.outlineVAO)}doPrepareForRendering(e,t,s){const i=new Uint32Array(t),r=new Int32Array(i.buffer),o=i[s++],n=y.g.createVertex(e,u._U.STATIC_DRAW,new Int32Array(r.buffer,4*s,o));s+=o;const l=i[s++],a=y.g.createIndex(e,u._U.STATIC_DRAW,new Uint32Array(i.buffer,4*s,l));s+=l;const h=i[s++],c=y.g.createVertex(e,u._U.STATIC_DRAW,new Int32Array(r.buffer,4*s,h));s+=h;const f=i[s++],_=y.g.createIndex(e,u._U.STATIC_DRAW,new Uint32Array(i.buffer,4*s,f));s+=f;const m=this.layer,p=m.fillMaterial,b=m.outlineMaterial;this.fillVAO=new d.Z(e,p.getAttributeLocations(),p.getLayoutInfo(),new Map([["geometry",n]]),a),this.outlineVAO=new d.Z(e,b.getAttributeLocations(),b.getLayoutInfo(),new Map([["geometry",c]]),_)}}class p extends f{constructor(e,t,s){super(e,t),this.type=n.NP.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const i=new Uint32Array(e),r=new Int32Array(e),o=new Float32Array(e);let l=this.bufferDataOffset;this.isIconSDF=!!i[l++];const a=i[l++],y=i[l++],u=i[l++],d=new h.A(a,y,u,0),f=i[l++];for(let n=0;n<f;n++){const e=i[l++],t=i[l++],s=i[l++];this.iconPerPageElementsMap.set(e,[t,s])}const _=i[l++];for(let n=0;n<_;n++){const e=i[l++],t=i[l++],s=i[l++];this.glyphPerPageElementsMap.set(e,[t,s])}const m=i[l++],p=i[l++];this.iconOpacity=new Int32Array(m),this.textOpacity=new Int32Array(p),l=(0,c.X1)(i,r,o,l,this.symbols,s,d),this.bufferDataOffset=l}get usedMemory(){return(this.data?.byteLength??0)+(this.iconVAO?.cachedMemory??0)+(this.textVAO?.cachedMemory??0)+(0,a.Qf)(this.iconOpacity)+(0,a.Qf)(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const t of this.iconPerPageElementsMap.values())e+=t[1];for(const t of this.glyphPerPageElementsMap.values())e+=t[1];return e/3}doDestroy(){this.iconVAO=(0,l.WD)(this.iconVAO),this.textVAO=(0,l.WD)(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,t=this.iconVAO.vertexBuffers.get("opacity");e.length>0&&e.byteLength===t.usedMemory&&t.setSubData(e,0,0,e.length);const s=this.textOpacity,i=this.textVAO.vertexBuffers.get("opacity");s.length>0&&s.byteLength===i.usedMemory&&i.setSubData(s,0,0,s.length)}doPrepareForRendering(e,t,s){const i=new Uint32Array(t),r=new Int32Array(i.buffer),o=i[s++],n=y.g.createVertex(e,u._U.STATIC_DRAW,new Int32Array(r.buffer,4*s,o));s+=o;const l=i[s++],a=y.g.createIndex(e,u._U.STATIC_DRAW,new Uint32Array(i.buffer,4*s,l));s+=l;const h=i[s++],c=y.g.createVertex(e,u._U.STATIC_DRAW,new Int32Array(r.buffer,4*s,h));s+=h;const f=i[s++],_=y.g.createIndex(e,u._U.STATIC_DRAW,new Uint32Array(i.buffer,4*s,f));s+=f;const m=y.g.createVertex(e,u._U.STATIC_DRAW,this.iconOpacity.buffer),p=y.g.createVertex(e,u._U.STATIC_DRAW,this.textOpacity.buffer),b=this.layer,g=b.iconMaterial,S=b.textMaterial;this.iconVAO=new d.Z(e,g.getAttributeLocations(),g.getLayoutInfo(),new Map([["geometry",n],["opacity",m]]),a),this.textVAO=new d.Z(e,S.getAttributeLocations(),S.getLayoutInfo(),new Map([["geometry",c],["opacity",p]]),_)}}class b extends f{constructor(e,t){super(e,t),this.type=n.NP.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const s=new Uint32Array(e);let i=this.bufferDataOffset;this.circleIndexStart=s[i++],this.circleIndexCount=s[i++],this.bufferDataOffset=i}get usedMemory(){return(this.data?.byteLength??0)+(this.vao?.cachedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=(0,l.WD)(this.vao)}doPrepareForRendering(e,t,s){const i=new Uint32Array(t),r=new Int32Array(i.buffer),o=i[s++],n=y.g.createVertex(e,u._U.STATIC_DRAW,new Int32Array(r.buffer,4*s,o));s+=o;const l=i[s++],a=y.g.createIndex(e,u._U.STATIC_DRAW,new Uint32Array(i.buffer,4*s,l));s+=l;const h=this.layer.circleMaterial;this.vao=new d.Z(e,h.getAttributeLocations(),h.getLayoutInfo(),new Map([["geometry",n]]),a)}}var g=s(59992),S=s(61409);class w extends S.Y{constructor(e,t,s,i,r,n,l,a=null){super(e,t,s,i,r,n,o.vA,o.vA),this.styleRepository=l,this._memCache=a,this.type="vector-tile",this._referenced=1,this._hasSymbolBuckets=!1,this._usedMemory=256,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this.id=e.id}get styleLayerUIDs(){return Array.from(this.layerData.keys())}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<g.zk}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<g.zk)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){let t=!1;for(const s of e){const e=this.layerData.get(s);e&&(this._usedMemory-=e.usedMemory,e.type===n.NP.SYMBOL&&this.symbols.delete(s)&&(t=!0),e.destroy(),this.layerData.delete(s))}this._memCache?.updateSize(this.key.id,this),t&&(this.featureIndex?.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}hasFeatures(){const e=this.layerData.values();for(const t of e)if(t.hasData())return!0;return!1}dispose(){"unloaded"!==this.status&&(w._destroyRenderBuckets(this.layerData),this.layerData.clear(),this.featureIndex=null,this._usedMemory=0,this.destroy(),this.status="unloaded")}release(){0==--this._referenced&&(this.dispose(),this.stage=null)}retain(){++this._referenced}get cachedMemory(){return this._usedMemory}get usedMemory(){return this._usedMemory}get usedMemoryPerReference(){return this._usedMemory/(this._referenced||1)}changeDataImpl(e){this.featureIndex?.clear();let t=!1;if(e){const{bucketsWithData:s,emptyBuckets:i}=e,r=this._createRenderBuckets(s);if(i&&i.byteLength>0){const e=new Uint32Array(i);for(const t of e)this._deleteLayerData(t)}for(const[e,o]of r)this._deleteLayerData(e),o.type===n.NP.SYMBOL&&(this.symbols.set(e,o.symbols),t=!0),this._usedMemory+=o.usedMemory,this.layerData.set(e,o);this._memCache?.updateSize(this.key.id,this)}this._hasSymbolBuckets=!1;for(const s of this.layerData.values())s.type===n.NP.SYMBOL&&(this._hasSymbolBuckets=!0);t&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(e){e.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const t=this.resolution/(e.resolution*e.pixelRatio),s=this.width/this.rangeX*t,r=this.height/this.rangeY*t,o=[0,0];e.toScreen(o,[this.x,this.y]);const n=this.transforms.tileUnitsToPixels;(0,i.D_)(n),(0,i.Tl)(n,n,o),(0,i.e$)(n,n,Math.PI*e.rotation/180),(0,i.hs)(n,n,[s,r,1])}_createTransforms(){return{displayViewScreenMat3:(0,r.vt)(),tileMat3:(0,r.vt)(),tileUnitsToPixels:(0,r.vt)()}}static _destroyRenderBuckets(e){if(!e)return;const t=new Set;for(const s of e.values())t.has(s)||(s.destroy(),t.add(s));e.clear()}_createRenderBuckets(e){const t=new Map,s=new Map;for(const i of e){const e=this._deserializeBucket(i,s);for(const s of e.layerUIDs)t.set(s,e)}return t}_deserializeBucket(e,t){let s=t.get(e);if(s)return s;switch(new Uint32Array(e)[0]){case n.NP.FILL:s=new m(e,this.styleRepository);break;case n.NP.LINE:s=new _(e,this.styleRepository);break;case n.NP.SYMBOL:s=new p(e,this.styleRepository,this);break;case n.NP.CIRCLE:s=new b(e,this.styleRepository)}return t.set(e,s),s}_deleteLayerData(e){if(!this.layerData.has(e))return;const t=this.layerData.get(e);this._usedMemory-=t.usedMemory,t.destroy(),this.layerData.delete(e)}}},62146:(e,t,s)=>{s.d(t,{ih:()=>o,kY:()=>i,vA:()=>r});const i=512,r=4096,o=8},99590:(e,t,s)=>{s.d(t,{J:()=>T});var i=s(40315),r=s(99776),o=s(59992),n=s(73318),l=s(31541);class a{constructor(e,t,s,i,l,a){this._symbols=e,this._styleRepository=i,this._zoom=l,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new n.xT(t,s,o.o2),this._si=Math.sin(Math.PI*a/180),this._co=Math.cos(Math.PI*a/180),i.cachedStyles&&(this._styleProps=i.cachedStyles);for(const o of e)for(const e of o.symbols)this._allNeededMatrices.has(e.tile)||this._allNeededMatrices.set(e.tile,(0,r.o8)(e.tile.transforms.tileUnitsToPixels))}work(e){const t=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const s=this._symbols[this._currentLayerCursor],i=this._getProperties(s.styleLayerUID),r=this._styleRepository.layerContexts?.get(s.styleLayerUID);for(;this._currentSymbolCursor<s.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-t>e)return!1;const o=s.symbols[this._currentSymbolCursor];if(!o.uniqueSymbol?.show)continue;const n=this._computeCoordinates(o,i,r),l=o.uniqueSymbol;if(!l.show)continue;const{iconAllowOverlap:a,textAllowOverlap:h}=i;for(const e of n){if(!e.enabled)continue;const t=l.parts[e.partIndex];t.show&&(!(e.partIndex?h:a)&&this._doesCollide(e)&&(e.hard?l.show=!1:t.show=!1))}l.show&&this._insertColliders(l.parts,n,i)}}return!0}_insertColliders(e,t,s){const{iconIgnorePlacement:i,textIgnorePlacement:r}=s;for(const o of t){if(!o.enabled)continue;if(o.partIndex?r:i)continue;if(!e[o.partIndex].show)continue;const t=o.xScreen+o.dxScreen,s=o.yScreen+o.dyScreen,n=t+o.width,l=s+o.height,[a,h,c,y]=this._gridIndex.getCellSpan(t,s,n,l);for(let e=h;e<=y;e++)for(let t=a;t<=c;t++)this._gridIndex.cells[e][t].push(o)}}_computeCoordinates(e,t,s){const{iconRotationAlignment:i,textRotationAlignment:r,iconTranslate:o,iconTranslateAnchor:n,textTranslate:a,textTranslateAnchor:h}=t,c=this._si,y=this._co,u=this._zoom,d=this._allNeededMatrices.get(e.tile),f=e.uniqueSymbol,_=e.colliders(s);let m=0;for(const p of _){const[e,t]=0===p.partIndex?o:a,s=0===p.partIndex?n:h,f=p.minLod<=u&&u<=p.maxLod;m+=f?0:1,p.enabled=f,p.xScreen=p.xTile*d[0]+p.yTile*d[3]+d[6],p.yScreen=p.xTile*d[1]+p.yTile*d[4]+d[7],s===l.Cq.MAP?(p.xScreen+=y*e-c*t,p.yScreen+=c*e+y*t):(p.xScreen+=e,p.yScreen+=t),l.I5.VIEWPORT===(0===p.partIndex?i:r)?(p.dxScreen=p.dxPixels,p.dyScreen=p.dyPixels):(p.dxScreen=y*(p.dxPixels+p.width/2)-c*(p.dyPixels+p.height/2)-p.width/2,p.dyScreen=c*(p.dxPixels+p.width/2)+y*(p.dyPixels+p.height/2)-p.height/2)}return _.length>0&&m===_.length&&f&&(f.show=!1),_}_getProperties(e){const t=this._styleProps.get(e);if(t)return t;const s=this._styleRepository.getLayerStyleProperties?.(e,this._zoom);return this._styleProps.set(e,s),s}_doesCollide(e){const t=e.xScreen+e.dxScreen,s=e.yScreen+e.dyScreen,i=t+e.width,r=s+e.height,[o,n,l,a]=this._gridIndex.getCellSpan(t,s,i,r);for(let h=n;h<=a;h++)for(let e=o;e<=l;e++){const o=this._gridIndex.cells[h][e];for(const e of o){const o=e.xScreen+e.dxScreen,n=e.yScreen+e.dyScreen,l=o+e.width,a=n+e.height;if(!(i<o||t>l||r<n||s>a))return!0}}return!1}}var h=s(55727),c=s(43556);function y(e){return(e.uniqueSymbol?.show&&e.uniqueSymbol?.lastShow)??!1}function u(e,t){if(e.priority-t.priority)return e.priority-t.priority;if(y(e)&&!y(t))return-1;if(y(t)&&!y(e))return 1;const s=e.tile.key,i=t.tile.key;return s.world-i.world?s.world-i.world:s.level-i.level?s.level-i.level:s.row-i.row?s.row-i.row:s.col-i.col?s.col-i.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}class d{get running(){return this._running}constructor(e,t,s,i,r,o,n,l){this.selectionMode=e,this._visibleTiles=t,this._symbolRepository=s,this._styleRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=o,this._symbolLayerSorter=n,this._isLayerVisible=l,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const t=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const t=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}return this._running=!1,!0}_isFeatureFiltered(e,t,s){const i=t.getFilterFlags(e),r=i&c.LY,o=null==s.featureEffect||s.featureEffect.excludedLabelsVisible||i&c.g0;return!(r&&o)}_getFilteredByLayer(){let e;if(this._styleRepository?.layerContexts)for(const t of this._symbolRepository.uniqueSymbols){const s=this._styleRepository.layerContexts?.get(t.styleLayerUID);if(s?.attributeView)for(const i of t.uniqueSymbols){e??=new Map,e.get(t.styleLayerUID)||e.set(t.styleLayerUID,new Set);const r=e.get(t.styleLayerUID),o=s.attributeView,n=s.layerView;this._isFeatureFiltered(i.id,o,n)&&r.add(i.id)}}return e}_resetSelection(){for(let e=0;e<this._symbolRepository.uniqueSymbols.length;e++){const t=this._symbolRepository.uniqueSymbols[e];for(let e=0;e<t.uniqueSymbols.length;e++){const s=t.uniqueSymbols[e];for(const e of s.tileSymbols)e.selectedForRendering=!1}}}_createSelectionJob(){const e="feature-tile"===this.selectionMode?_:m,t=this._symbolRepository.uniqueSymbols;this._resetSelection();const s=[];let i=0,r=0;const o=this._isLayerVisible,n=this._getFilteredByLayer(),l=this._styleRepository?.layerContexts;const a=this._symbolLayerSorter;return{work:function(a){let h;const c=performance.now();for(;r<t.length;r++,i=0){const y=t[r],u=y.styleLayerUID,d=n?.get(u);let f=0;if(l){const e=l.get(u).layerView;f=e.view.allLayerViews.items.indexOf(e)}if(!o(u)){s[r]||(s[r]={styleLayerUID:u,layerOrder:f,symbols:[]});continue}s[r]||={styleLayerUID:u,symbols:[],layerOrder:f};const _=s[r];for(;i<y.uniqueSymbols.length;i++){if(h=y.uniqueSymbols[i],i%100==99&&performance.now()-c>a)return!1;if(h.lastShow=h.show,h.id&&d?.has(h.id)){h.show=!1,h.parts[0].show=!1,h.parts[1].show=!1;continue}const t=e(h);if(t){t.selectedForRendering=!0,_.symbols.push(t),h.show=!0;for(const e of h.parts)e.show=!0}else h.show=!1}}for(const e of s)e.symbols.sort(u);return s.sort(((e,t)=>t.layerOrder-e.layerOrder)),!0},get sortedSymbols(){return s.sort(a)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,t=this._visibleTiles;let s=0;function i(t,s){for(const e of t.symbols.values())f(e,s);e(t,s);for(const e of t.childrenTiles)i(e,s)}return{work(r){const o=performance.now();for(;s<t.length;s++){if(performance.now()-o>r)return!1;const n=t[s];if(null!=n.parentTile)continue;const l=performance.now();n instanceof h.c?i(n,l):e(n,l)}return!0}}}}function f(e,t){for(const s of e){const e=s.uniqueSymbol;for(const s of e.parts){const i=s.targetOpacity>.5?1:-1;s.startOpacity+=i*((t-s.startTime)/o.zk),s.startOpacity=Math.min(Math.max(s.startOpacity,0),1),s.startTime=t,s.targetOpacity=e.show&&s.show?1:0}}}function _(e){let t=null,s=null,i=null;for(const r of e.tileSymbols){const e=r.tile;e.isReady&&e.isCoverage?t=r:e.isReady?s=r:e.rendering&&(i=r)}return t??s??i}function m(e){let t=null,s=!1,i=!1;for(const r of e.tileSymbols)if(!i||!s){const e=r.tile;(!t||e.isCoverage||e.neededForCoverage&&!s)&&(t=r,(e.neededForCoverage||e.isCoverage)&&(i=!0),e.isCoverage&&(s=!0))}return i?t:null}var p=s(9533);class b{static fromSymbols(e,t){let s=e.length;if(s>=g){let i=t;do{i/=2,s/=4}while(s>S&&i>w);const r=new n.xT(t,t,i);for(const t of e)r.getCell(t.xTile,t.yTile).push(t);return new b(t,e,r)}return new b(t,e,null)}constructor(e,t,s){this.tileCoordRange=e,this._symbols=t,this._index=s}addSymbols(e){for(const t of e)this._symbols.push(t);if(this._index)for(const t of e)this._index.getCell(t.xTile,t.yTile).push(t)}removeSymbols(e){const t=new Set(e);if(this._symbols=this._symbols.filter((e=>!t.has(e))),this._index)for(const s of this._index.cells)for(let e=0;e<s.length;e++)s[e]=s[e].filter((e=>!t.has(e)))}getSymbols(){return this._symbols}getCandidate(e,t,s,i){if(!this._index){for(const r of this._symbols)if(s===r.hash&&Math.abs(e-r.xTile)<=i&&Math.abs(t-r.yTile)<=i)return r;return null}const r=this._index.getCellSpan(e-i,t-i,e+i,t+i),[o,n,l,a]=r;for(let h=n;h<=a;h++)for(let r=o;r<=l;r++){const o=this._index.cells[h][r];for(const r of o)if(s===r.hash&&Math.abs(e-r.xTile)<=i&&Math.abs(t-r.yTile)<=i)return r}return null}}const g=32,S=8,w=64;class x{constructor(e,t){this.tileCoordRange=e,this._visibleTiles=t,this._indexMapByTile=new Map,this._uniqueSymbolsByStyleLayerId=new Map}get uniqueSymbols(){return null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}registerVectorTile(e,t){const s=this._ensureIndexMap(e),i=t?.values()??s.keys();for(const r of i){const e=s.get(r);e&&(this._removeSymbols(r,e.getSymbols()),s.delete(r))}this._addSymbols(e.key,s,e.symbols),this._invalidate()}unregisterVectorTile(e){this._removeTile(e),this._invalidate()}registerFeatureTile(e){this._ensureIndexMap(e),this._invalidate()}unregisterFeatureTile(e){this._removeTile(e),this._invalidate()}insertFeatureTileMetrics(e,t){const s=this._indexMapByTile.get(e);if(!s)throw new Error(`tile ${e.id} not registered!`);this._addSymbols(e.key,s,I(t)),this._invalidate()}removeFeatureTileMetrics(e,t){const s=this._indexMapByTile.get(e);if(!s)return;const i=I(t);for(const[r,o]of s.entries()){const e=i.get(r);e&&(o.removeSymbols(e),this._removeSymbols(r,e))}this._invalidate()}deleteStyleLayers(e){for(const t of this._indexMapByTile.values())for(const s of e){const e=t.get(s);e&&(this._removeSymbols(s,e.getSymbols()),t.delete(s))}this._invalidate()}querySymbols(e,t,s,i){const r=[];for(const[o,l]of this._uniqueSymbolsByStyleLayerId.entries())for(const i of l){const l=i.tileSymbols.find((e=>e.selectedForRendering));l&&(0,n.OI)(l,e,t*(window.devicePixelRatio||1),s)&&r.push({vtlSymbol:l,styleLayerUID:o,tileKey:l.tile.key})}return r}_ensureIndexMap(e){let t=this._indexMapByTile.get(e);return t||(t=new Map,this._indexMapByTile.set(e,t)),t}_invalidate(){this._uniqueSymbolLayerArray=null}_addSymbols(e,t,s){for(const[i,r]of s){let e=t.get(i);e?e.addSymbols(r):(e=b.fromSymbols(r,this.tileCoordRange),t.set(i,e))}this._updateUniqueSymbols(e,s)}_removeTile(e){const t=this._indexMapByTile.get(e);if(t){for(const[e,s]of t.entries())this._removeSymbols(e,s.getSymbols());this._indexMapByTile.delete(e),this._invalidate()}}_removeSymbols(e,t){for(const s of t){const t=s.uniqueSymbol;if(t){if(t.tileSymbols=t.tileSymbols.filter((e=>e!==s)),0===t.tileSymbols.length){const s=this._uniqueSymbolsByStyleLayerId.get(e);s.delete(t),0===s.size&&this._uniqueSymbolsByStyleLayerId.delete(e)}s.uniqueSymbol=null}}}_updateUniqueSymbols(e,t){if(0!==t.size){for(const s of this._visibleTiles)s.parentTile||s.key.world!==e.world||s.key.level===e.level&&!s.key.equals(e)||this._matchSymbols(s,e,t);for(const[e,s]of t)for(const t of s)if(!t.uniqueSymbol){t.uniqueSymbol=new p.w(t);let s=this._uniqueSymbolsByStyleLayerId.get(e);s||(s=new Set,this._uniqueSymbolsByStyleLayerId.set(e,s)),s.add(t.uniqueSymbol)}}}_matchSymbols(e,t,s){if(e.key.level>t.level){const s=e.key.level-t.level;if(e.key.row>>s!==t.row||e.key.col>>s!==t.col)return}if(t.level>e.key.level){const s=t.level-e.key.level;if(t.row>>s!==e.key.row||t.col>>s!==e.key.col)return}const i=new Map;for(const[r,o]of s){const s=[],l=20+(e.key.level<t.level?1:1<<e.key.level-t.level),a=this._indexMapByTile.get(e),h=a?.get(r);if(h)for(const i of o){if(i.uniqueSymbol)continue;const r=(0,n.Ag)(this.tileCoordRange,i.xTile,t,e.key),o=(0,n.tE)(this.tileCoordRange,i.yTile,t,e.key),a=-20,c=this.tileCoordRange+20;if(!(r>=a&&r<c&&o>=a&&o<c)){s.push(i);continue}const y=h.getCandidate(r,o,i.hash,l),u=y?.uniqueSymbol;u?(i.uniqueSymbol=u,u.tileSymbols.push(i)):s.push(i)}s.length>0&&i.set(r,s)}for(const r of e.childrenTiles||[])this._matchSymbols(r,t,i)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsByStyleLayerId,t=new Array(e.size);let s,i=0;for(const[r,o]of e){const e=new Array(o.size);s=0;for(const t of o)e[s++]=t;t[i]={styleLayerUID:r,uniqueSymbols:e},i++}return t}}function I(e){const t=new Map;for(const s of e){const e=s.labelClassId;let i=t.get(e);i||(i=[],t.set(e,i)),i.push(s)}return t}const M=1e-6;class T{constructor(e,t,s,r,n,a=o.av){this.styleRepository=t,this._declutterBudget=a,this._tileToHandle=new Map,this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._offsetFromScreenCenter=[0,0],this._completed=!1,this._fading=(0,i.v)(!1);this._symbolRepository=new x(n,r),this._symbolDeclutterer=new d(e,r,this._symbolRepository,this.styleRepository,((e,t,s)=>this._createCollisionJob(e,t,s)),s,((e,t)=>(this.styleRepository.getStyleLayerByUID?.(e.styleLayerUID)?.z??0)-(this.styleRepository.getStyleLayerByUID?.(t.styleLayerUID)?.z??0)),(e=>{const t=this.styleRepository.getStyleLayerByUID?.(e);if(t){if(this._zoom+M<t.minzoom||this._zoom-M>=t.maxzoom)return!1;const e=t.getLayoutProperty?.("visibility");if(e&&e.getValue()===l.bv.NONE)return!1}return!0}))}get symbolRepository(){return this._symbolRepository}_createCollisionJob(e,t,s){return this.updateDecluttererViewState(),new a(e,t,s,this.styleRepository,this._zoom,this._viewState.rotation)}get fading(){return this._fading.value}get decluttererOffset(){return this._offsetFromScreenCenter}registerFeatureTile(e){this.symbolRepository?(this.symbolRepository.registerFeatureTile(e),this.restartDeclutter()):console.error("InternalError: Symbol repository not yet initialized")}unregisterFeatureTile(e){this.symbolRepository?(this._symbolRepository.unregisterFeatureTile(e),this.restartDeclutter()):console.error("InternalError: Symbol repository not yet initialized")}insertFeatureTileMetrics(e,t){this.symbolRepository?(this.symbolRepository.insertFeatureTileMetrics(e,t),this.restartDeclutter()):console.error("InternalError: Symbol repository not yet initialized")}removeFeatureTileMetrics(e,t){this.symbolRepository?(this.symbolRepository.removeFeatureTileMetrics(e,t),this.restartDeclutter()):console.error("InternalError: Symbol repository not yet initialized")}addTile(e){e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",(()=>{this._symbolRepository.registerVectorTile(e),this.restartDeclutter()}))),this._symbolRepository.registerVectorTile(e),this.restartDeclutter()}removeTile(e){const t=this._tileToHandle.get(e);t&&(this._symbolRepository.unregisterVectorTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}update(e,t){this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]};const s=[0,0];t.toScreen(s,t.center);const i=[0,0];return t.toScreen(i,this._declutterViewState.center),this._offsetFromScreenCenter[0]=s[0]-i[0],this._offsetFromScreenCenter[1]=s[1]-i[1],this._continueDeclutter(),this._completed}restartDeclutter(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}clear(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach((e=>e.remove())),this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(e){this._symbolRepository.deleteStyleLayers(e)}_continueDeclutter(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this.updateDecluttererViewState(),this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(this._declutterBudget),this._completed&&this._scheduleNotifyStable())}_scheduleNotifyStable(){null!=this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout((()=>{this._stableNotificationHandle=null,this._fading.value=!1}),1.5*o.zk)}_notifyUnstable(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this._fading.value=!0}updateDecluttererViewState(){this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._offsetFromScreenCenter[0]=0,this._offsetFromScreenCenter[1]=0}}},9533:(e,t,s)=>{s.d(t,{D:()=>i,w:()=>r});class i{constructor(e,t){this.sourceTile=t,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.uniqueSymbol=null,this._colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}colliders(){return this._colliders}}class r{constructor(e){this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1,this.lastShow=!1,this.tileSymbols=[e],this.id=e.id}}},73318:(e,t,s)=>{s.d(t,{Ag:()=>n,OI:()=>d,X1:()=>c,jy:()=>y,tE:()=>l,xT:()=>h});var i=s(46729),r=s(15946),o=s(9533);function n(e,t,s,i){return a(e,t,s.level,s.col,i.key.level,i.key.col)}function l(e,t,s,i){return a(e,t,s.level,s.row,i.level,i.row)}function a(e,t,s,i,r,o){const n=s-r;if(n>=0)return(t>>n)+(i-(o<<n))*(e>>n);const l=-n;return t-(o-(i<<l))*(e>>l)<<l}class h{constructor(e,t,s){this._rows=Math.ceil(t/s),this._columns=Math.ceil(e/s),this._cellSize=s,this.cells=new Array(this._rows);for(let i=0;i<this._rows;i++){this.cells[i]=new Array(this._columns);for(let e=0;e<this._columns;e++)this.cells[i][e]=[]}}getCell(e,t){const s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),i=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[s]&&this.cells[s][i]||null}getCellSpan(e,t,s,i){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function c(e,t,s,i,r,n,l){const a=t[i++];for(let h=0;h<a;h++){const a=new o.D(n,l);a.xTile=t[i++],a.yTile=t[i++],a.hash=t[i++],a.priority=t[i++],a.featureIndex=t[i++];const h=t[i++],c=a.colliders();for(let e=0;e<h;e++){const e=t[i++],r=t[i++],o=t[i++],n=t[i++],l=!!t[i++],a=t[i++],h=s[i++],y=s[i++],u=t[i++],d=t[i++];c.push({xTile:e,yTile:r,dxPixels:o,dyPixels:n,hard:l,partIndex:a,width:u,height:d,minLod:h,maxLod:y})}const y=e[i++];for(let t=0;t<y;t++)a.textVertexRanges.push([e[i++],e[i++]]);const u=e[i++];for(let t=0;t<u;t++)a.iconVertexRanges.push([e[i++],e[i++]]);r.push(a)}return i}function y(e,t,s){for(const[i,r]of e.symbols)u(e,t,s,r,i)}function u(e,t,s,r,o){const n=e.layerData.get(o);if(n.type===i.NP.SYMBOL){for(const t of r){const i=t.uniqueSymbol;let r;if(t.selectedForRendering){const t=i.parts[0],o=t.startOpacity,n=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===n;const l=s?Math.floor(127*o)|n<<7:n?255:0;r=l<<24|l<<16|l<<8|l}else r=0;for(const[e,s]of t.iconVertexRanges)for(let t=e;t<e+s;t+=4)n.iconOpacity[t/4]=r;if(t.selectedForRendering){const t=i.parts[1],o=t.startOpacity,n=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===n;const l=s?Math.floor(127*o)|n<<7:n?255:0;r=l<<24|l<<16|l<<8|l}else r=0;for(const[e,s]of t.textVertexRanges)for(let t=e;t<e+s;t+=4)n.textOpacity[t/4]=r}n.lastOpacityUpdate=t,n.opacityChanged=!0}}function d(e,t,s,i){const o=e.colliders();let n,l,a,h;for(const c of o)if(e.uniqueSymbol?.show&&e.uniqueSymbol.parts[c.partIndex].show&&(n=c.xScreen-i[0]+c.dxScreen,l=c.yScreen-i[1]+c.dyScreen,a=n+c.width,h=l+c.height,(0,r.w4)(s,t.x,t.y,n,l,a,h)))return!0;return!1}},46729:(e,t,s)=>{var i,r,o;s.d(t,{$q:()=>o,NP:()=>i,kh:()=>r}),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(i||(i={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(r||(r={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(o||(o={}))}}]);