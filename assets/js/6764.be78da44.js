"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6764],{46602:(e,t,i)=>{i.d(t,{Mk:()=>m,Zk:()=>h,w6:()=>F});var s=i(66866),r=i(17306),n=i(19251),d=i(40189),o=i(21564),l=(i(39831),i(539),i(63863)),a=i(96023);const c=new r.A.EventEmitter;function h(e,t,i=null,s=!1){const r=(0,d.Tw)();return s=null==t||s,c.emit("apply-edits",{serviceUrl:e,layerId:t,gdbVersion:i,mayReceiveServiceEdits:s,result:r.promise}),r}const u=Symbol();function m(e){return null!=e&&"object"==typeof e&&u in e}function p(e){return null!=e&&"object"==typeof e&&"gdbVersion"in e}function f(e,t,i){const s=new URL(e).host,r=a.Z3.get(s),n=e=>!e||e===r;return n(t)&&n(i)||t===i}const F=e=>{var t;let i=class extends e{static{t=u}constructor(...e){super(...e),this[t]=!0,this._applyEditsHandler=e=>{const{serviceUrl:t,layerId:i,gdbVersion:s,mayReceiveServiceEdits:r,result:d}=e,o=t===this.url,l=null!=i&&null!=this.layerId&&i===this.layerId,a=p(this),c=p(this)&&f(t,s,this.gdbVersion);if(!o||a&&!c||!l&&!r)return;const h=d.then((e=>{if(this.lastEditsEventDate=new Date,l&&(e.addedFeatures.length||e.updatedFeatures.length||e.deletedFeatures.length||e.addedAttachments.length||e.updatedAttachments.length||e.deletedAttachments.length))return this.emit("edits",(0,n.o8)(e)),e;const i=e.editedFeatures?.find((({layerId:e})=>e===this.layerId));if(i){const{adds:t,updates:s,deletes:r}=i.editedFeatures,d={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:t?t.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],deletedFeatures:r?r.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],updatedFeatures:s?s.map((({current:{attributes:e}})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],editedFeatures:(0,n.o8)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,n.o8)(e.historicMoment)};return this.emit("edits",d),d}const r={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,n.o8)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,n.o8)(e.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(t,s,r.historicMoment)&&this.emit("edits",r),r})).then((e=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(t,s,e.historicMoment)&&(this.historicMoment=e.historicMoment),e)));this.emit("apply-edits",{result:h})},this._updateMomentHandler=e=>{const{serviceUrl:t,gdbVersion:i,moment:s}=e,r=t===this.url,n=p(this),d=p(this)&&f(t,i,this.gdbVersion),o=p(this)&&!f(t,this.gdbVersion,null);r&&n&&d&&o&&"historicMoment"in this&&this.historicMoment!==s&&(this.historicMoment=s)},this.when().then((()=>{this.addHandles(function(e){return c.on("apply-edits",new WeakRef(e))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function(e){return c.on("update-moment",new WeakRef(e))}(this._updateMomentHandler))}),(()=>{}))}_shouldUpdateHistoricMoment(e,t,i){return"historicMoment"in this&&this.historicMoment!==i&&(0,a.w5)(e,t)}};return(0,s._)([(0,o.MZ)()],i.prototype,"lastEditsEventDate",void 0),i=(0,s._)([(0,l.$)("esri.layers.mixins.EditBusLayer")],i),i}},8585:(e,t,i)=>{i.d(t,{A:()=>a});var s,r=i(66866),n=i(48982),d=i(21877),o=i(21564),l=(i(39831),i(539),i(9272),i(63863));let a=s=class extends d.A{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new n.A}clone(){return new s({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,r._)([(0,o.MZ)({type:String,json:{write:{isRequired:!0}}})],a.prototype,"floorField",void 0),(0,r._)([(0,o.MZ)({json:{read:!1,write:!1}})],a.prototype,"viewAllMode",void 0),(0,r._)([(0,o.MZ)({json:{read:!1,write:!1}})],a.prototype,"viewAllLevelIds",void 0),a=s=(0,r._)([(0,l.$)("esri.layers.support.LayerFloorInfo")],a)},96023:(e,t,i)=>{i.d(t,{TA:()=>r,We:()=>o,Z3:()=>n,ZJ:()=>l,w5:()=>a});var s=i(86394);const r=(0,i(33880).vD)(),n=new Map,d=new Map;new Map;async function o(e,t,i){if(!e||!i)return!1;if(!t)return!0;const r=new URL(e).host;let d=n.get(r);if(!d){const t=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");d=(await(0,s.A)(t,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return d===t}async function l(e,t,s=!1){if(!e||!t)return!0;const n=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),o=d.get(n)?.entries();if(o)for(const[d,l]of o)if(l.name===t){const e=!l.stack?.hasForwardEdits();if(!e&&s){const[{deleteForwardEdits:e},{default:t}]=await Promise.all([i.e(3093).then(i.bind(i,43093)),i.e(741).then(i.bind(i,80741))]),s=await e(n,d,new t({sessionId:r,moment:l.moment}));return s.success&&l.stack?.clearForwardEdits(),s.success}return e}return!0}function a(e,t){if(!e)return!1;const i=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),s=d.get(i)?.entries();if(s)for(const[r,n]of s)if(n.name===t)return"edit"===n.lockType;return!1}}}]);