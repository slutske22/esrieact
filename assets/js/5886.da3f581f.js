"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5886,7125,9851],{74339:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(72777),s=i(25801);class a{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let r=this._inFlightResourceMap.get(e);return r?r.then((e=>({width:e.width,height:e.height}))):(r=(0,s.M5)(e,t),this._inFlightResourceMap.set(e,r),r.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,r.Al)(e)}}},79851:(e,t,i)=>{i.r(t),i.d(t,{CIMSymbolRasterizer:()=>p});var r=i(1171),s=i(74339),a=i(26502),n=i(48002),o=i(17125),l=i(79126),c=i(50072);const h=96/72;class p{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new s.A}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,s,a,h,p,y,f,u){if(!e)return null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:g}=d;h||(h=(0,c.n5)(g));const v=await o.OverrideHelper.resolveSymbolOverrides(d,t,this._spatialReference,a,h,p,y),w=this._cimResourceManager,M=[];n.wp.fetchResources(v,w,M),n.wp.fetchFonts(v,w,M),M.length>0&&await Promise.all(M);const{width:b,height:C}=i;let x=m(h,b,C,s,u);const I=n.wp.getEnvelope(v,x,w);if(!I)return null;I.x===1/0&&(I.x=b+2),I.y===1/0&&(I.y=-C/2),I.width===-1/0&&(I.width=b),I.height===-1/0&&(I.height=C);let S=1,P=0,O=0;switch(g.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;I.width>b&&(e=b/I.width);let t=1;I.height>C&&(t=C/I.height),"preview"===s&&(I.width<b&&(e=b/I.width),I.height<C&&(t=C/I.height)),S=Math.min(e,t),P=I.x+I.width/2,O=I.y+I.height/2}break;case"CIMLineSymbol":if(u){O=I.y+I.height/2,P=I.x+I.width/2;const e=I.width-b,t=I.height-C;x={paths:(0,l.hs)(x.paths,{xmin:-1*I.width/2+e,xmax:I.width/2-e,ymin:-1*I.height/2+t,ymax:I.height/2-t,width:I.width-2*e,height:I.height-2*t})}}else{(f||I.height>C)&&(S=C/I.height),O=I.y+I.height/2;const e=I.x*S+b/2,t=(I.x+I.width)*S+b/2,i=(0,r.Rg)(x)?x.paths:(0,r.Bi)(x)?x.rings:null;if(null===i)throw new Error("Bad geometry, can't rasterise symbol!");i[0][0][0]-=e/S,i[0][2][0]-=(t-b)/S}break;case"CIMPolygonSymbol":if(u){O=I.y+I.height/2,P=I.x+I.width/2;const e=I.width-b,t=I.height-C;x={paths:(0,l.hs)(x.rings,{xmin:-1*I.width/2+e,xmax:I.width/2-e,ymin:-1*I.height/2+t,ymax:I.height/2-t,width:I.width-2*e,height:I.height-2*t})}}else{P=I.x+I.width/2,O=I.y+I.height/2;const e=I.x*S+b/2,t=(I.x+I.width)*S+b/2,i=I.y*S+C/2,r=(I.y+I.height)*S+C/2,{rings:s}=x;e<0&&(s[0][0][0]-=e,s[0][3][0]-=e,s[0][4][0]-=e),i<0&&(s[0][0][1]+=i,s[0][1][1]+=i,s[0][4][1]+=i),t>b&&(s[0][1][0]-=t-b,s[0][2][0]-=t-b),r>C&&(s[0][2][1]+=r-C,s[0][3][1]+=r-C)}}const k={type:"cim",data:{type:"CIMSymbolReference",symbol:v}};return this.rasterize(k,b,C,P,O,S,h,1,x)}rasterize(e,t,i,r,s,n,o,l=0,p=null,y=window.devicePixelRatio||1){const{data:f}=e;if(!f||"CIMSymbolReference"!==f.type||!f.symbol)return null;const{symbol:u}=f,d=this._canvas,g=y*h;d.width=t*g,d.height=i*g,o||(o=(0,c.n5)(u)),p||(p=m(o,t,i,"legend")),d.width+=2*l,d.height+=2*l;const v=d.getContext("2d",{willReadFrequently:!0}),w=a.IT.createIdentity();return w.translate(-r,-s),w.scale(n*g,-n*g),w.translate(t*g/2+l,i*g/2+l),v.clearRect(0,0,d.width,d.height),new a.Rj(v,this._cimResourceManager,w,!0).drawSymbol(u,p),v.getImageData(0,0,d.width,d.height)}}function m(e,t,i,r,s){const a=-t/2+1,n=t/2-1,o=i/2-1,c=-i/2+1;if(s&&("esriGeometryPolygon"===e||"esriGeometryPolyline"===e)){const r=function(e,t,i,r){return"esriGeometryPolygon"===t?{rings:(0,l.Tl)((0,l.hs)(e.rings,{xmin:0,ymin:0,width:i,height:r}),-1*i/2,-1*r/2)}:"esriGeometryPolyline"===t?{paths:(0,l.Tl)((0,l.hs)(e.paths,{xmin:0,ymin:0,width:i,height:r}),-1*i/2,-1*r/2)}:null}(s,e,t,i);if(r)return r}switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[a,0],[0,0],[n,0]]]};default:return"legend"===r?{rings:[[[a,o],[n,0],[n,c],[a,c],[a,o]]]}:{rings:[[[a,o],[n,o],[n,c],[a,c],[a,o]]]}}}},17125:(e,t,i)=>{i.d(t,{OverrideHelper:()=>p});var r=i(96220),s=i(775),a=i(19251),n=i(79005),o=i(46709),l=i(50072),c=i(29986);const h=e=>{if(!e)return[0,0,0,0];const{r:t,g:i,b:r,a:s}=e;return[t,i,r,255*s]};class p{static findApplicableOverrides(e,t,i){if(e&&t){if(e.primitiveName){let r=!1;for(const t of i)if(t.primitiveName===e.primitiveName){r=!0;break}if(!r)for(const s of t)s.primitiveName===e.primitiveName&&i.push(s)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const r of e.effects)p.findApplicableOverrides(r,t,i);if(e.symbolLayers)for(const r of e.symbolLayers)p.findApplicableOverrides(r,t,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const r of e.effects)p.findApplicableOverrides(r,t,i);if(e.markerPlacement&&p.findApplicableOverrides(e.markerPlacement,t,i),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const r of e.markerGraphics)p.findApplicableOverrides(r,t,i),p.findApplicableOverrides(r.symbol,t,i)}else"CIMCharacterMarker"===e.type?p.findApplicableOverrides(e.symbol,t,i):"CIMHatchFill"===e.type?p.findApplicableOverrides(e.lineSymbol,t,i):"CIMPictureMarker"===e.type&&p.findApplicableOverrides(e.animatedSymbolProperties,t,i)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&(0,l.FH)(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const i=(0,l.rB)(e),r=e.primitiveName,s=[];for(const a of t)a.primitiveName===r&&s.push((0,l.rB)(a));return{type:"cim-effect-param",effect:i,overrides:(0,l.pk)(s)}}static async resolveSymbolOverrides(e,t,i,r,s,o,c){if(!e?.symbol)return null;let{symbol:h,primitiveOverrides:m}=e;const y=!!m;if(!y&&!r)return h;h=(0,a.o8)(h),m=(0,a.o8)(m);let f=!0;if(t||(t={attributes:{}},f=!1),y){if(f||(m=m.filter((e=>!e.valueExpressionInfo?.expression.includes("$feature")))),c||(m=m.filter((e=>!e.valueExpressionInfo?.expression.includes("$view")))),m.length>0){const e=(0,l.O2)(t.attributes),r={spatialReference:i,fields:e,geometryType:s};await p.createRenderExpressions(m,r),p.evaluateOverrides(m,t,s??"esriGeometryPoint",o,c,new n.A(e))}p.applyOverrides(h,m)}return r&&p.applyDictionaryTextOverrides(h,t,r,null),h}static{this._expressionToRenderExpression=new Map}static async createRenderExpressions(e,t){const i=[];for(const r of e){const e=r.valueExpressionInfo;if(!e||p._expressionToRenderExpression.has(e.expression))continue;const s=(0,o.Ad)(e.expression,t.spatialReference);i.push(s),s.then((t=>p._expressionToRenderExpression.set(e.expression,t)))}i.length>0&&await Promise.all(i)}static evaluateOverrides(e,t,i,r,a,n){const o={$view:{scale:a?.scale}};for(const l of e){l.value&&"object"==typeof l.value&&(0,s.IB)(l.value)&&("Color"===l.propertyName||"StrokeColor"===l.propertyName)&&(l.value=h(l.value));const e=l.valueExpressionInfo;if(!e)continue;const a=p._expressionToRenderExpression.get(e.expression);a&&(l.value=(0,c.default)(a,t,o,i,n,r))}}static applyDictionaryTextOverrides(e,t,i,r,s="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const a=e.symbolLayers;if(!a)return;for(const n of a)n&&"CIMVectorMarker"===n.type&&p.applyDictionaryTextOverrides(n,t,i,r,"CIMTextSymbol"===e.type?e.textCase:s)}break;case"CIMVectorMarker":{const s=e.markerGraphics;if(!s)return;for(const e of s)e&&p.applyDictionaryTextOverrides(e,t,i,r)}break;case"CIMMarkerGraphic":{const a=e.textString;if(a&&a.includes("[")){const n=(0,l.gQ)(a,i);e.textString=(0,l.FM)(t,n,r,s)}}}}static applyOverrides(e,t,i,r){if(e.primitiveName)for(const s of t)if(s.primitiveName===e.primitiveName){const t=(0,l.YF)(s.propertyName);if(r&&r.push({cim:e,nocapPropertyName:t,value:e[t]}),i){let t=!1;for(const r of i)r.primitiveName===e.primitiveName&&(t=!0);t||i.push(s)}null!=s.value&&(e[t]=s.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)p.applyOverrides(s,t,i,r);if(e.symbolLayers)for(const s of e.symbolLayers)p.applyOverrides(s,t,i,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const s of e.effects)p.applyOverrides(s,t,i,r);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const s of e.markerGraphics)p.applyOverrides(s,t,i,r),p.applyOverrides(s.symbol,t,i,r)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const i of e)void 0!==i.value&&(t+=`${i.primitiveName}${i.propertyName}${JSON.stringify(i.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new r.A(t).toRgba();return e[3]*=255,e}return t}}},75886:(e,t,i)=>{i.d(t,{D:()=>d,previewCIMSymbol:()=>g});var r=i(89882),s=i(48002),a=i(79851),n=i(17125),o=i(50072),l=i(88148),c=i(73532);const h=new a.CIMSymbolRasterizer(null),p=(0,r.PN)(l.CB.size),m=(0,r.PN)(l.CB.maxSize),y=(0,r.PN)(l.CB.lineWidth),f=1;async function u(e,t,i){const r=t?.size;let s=null!=r&&"object"==typeof r&&"width"in r?r.width:r,a=null!=r&&"object"==typeof r&&"height"in r?r.height:r;if(!s||!a)if("esriGeometryPolygon"===i)s=a=t.maxSize?Math.min(t.maxSize,p):p;else{const r=await d(e,t,i);r&&(s=r.width,a=r.height),"esriGeometryPolyline"===i&&(s=t.maxSize?Math.min(t.maxSize,y):y),s=null!=s&&isFinite(s)?Math.min(s,m):p,a=null!=a&&isFinite(a)?Math.max(Math.min(a,m),f):p}return"legend"===t.style&&"esriGeometryPolyline"===i&&(s=y),{width:s,height:a}}async function d(e,t={},i){const r=t.cimOptions||t;i??=r.geometryType||(0,o.n5)(e?.data?.symbol);const{feature:a,fieldMap:l,viewParams:c}=r,p=await n.OverrideHelper.resolveSymbolOverrides(e.data,a,null,l,i,null,c);if(!p)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:p},e.data.primitiveOverrides=void 0;const m=[];return s.wp.fetchResources(p,h.resourceManager,m),s.wp.fetchFonts(p,h.resourceManager,m),m.length>0&&await Promise.all(m),s.wp.getEnvelope(p,null,h.resourceManager)}async function g(e,t={}){const{node:i,opacity:s,symbolConfig:a}=t,n=null!=a&&"object"==typeof a&&"isSquareFill"in a&&a.isSquareFill,l=t.cimOptions||t,p=l.geometryType||(0,o.n5)(e?.data?.symbol),m=await u(e,t,p),{feature:y,fieldMap:f}=l,d=t?.geometry||n||"esriGeometryPolygon"!==p?"preview":"legend";let g=m;const v=m;if(t?.geometry&&("esriGeometryPolygon"===p||"esriGeometryPolyline"===p)){const e=200;if((0,r.Lz)(m.width)<e||(0,r.Lz)(m.height)<e){const t=m.width>m.height?(0,r.PN)(e)*m.height/m.width:(0,r.PN)(e);g={width:m.width>m.height?(0,r.PN)(e):(0,r.PN)(e)*m.width/m.height,height:t}}}const w=await h.rasterizeCIMSymbolAsync(e,y,g,d,f,p,null,l.viewParams,l.allowScalingUp,t?.geometry?.toJSON());if(!w)return null;const{width:M,height:b}=w,C=document.createElement("canvas");C.width=M,C.height=b,C.getContext("2d").putImageData(w,0,0);const x=(0,r.Lz)(v.width),I=(0,r.Lz)(v.height),S=new Image(x,I);S.src=C.toDataURL(),S.ariaLabel=t.ariaLabel??null,S.alt=t.ariaLabel??"",null!=s&&(S.style.opacity=`${s}`);let P=S;if(null!=t.effectView){const e={shape:{type:"image",x:0,y:0,width:x,height:I,src:S.src},fill:null,stroke:null,offset:[0,0]};P=(0,c.fz)([[e]],[x,I],t)}return i&&P&&i.appendChild(P),P}},29986:(e,t,i)=>{i.d(t,{default:()=>n});var r=i(98849),s=i(539),a=i(20698);function n(e,t,i,r,a,n){if(null==e)return null;const o=e.references("geometry")&&n?l(t,r,n):t,c=e.repurposeFeature(o,a);try{return e.evaluate(c,i)}catch(h){return s.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",h),null}}const o=new Map;function l(e,t,i){const{transform:n,hasZ:l,hasM:c}=i;o.has(t)||o.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,i,r,s)=>(0,a.Tr)(i,t,e,r,s);case"esriGeometryPolygon":return(e,i,r,s)=>(0,a.$X)(i,t,e,r,s);case"esriGeometryPolyline":return(e,i,r,s)=>(0,a.P5)(i,t,e,r,s);case"esriGeometryMultipoint":return(e,i,r,s)=>(0,a.SW)(i,t,e,r,s);default:return s.A.getLogger("esri.views.2d.support.arcadeOnDemand").error(new r.A("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const h=o.get(t)(e.geometry,n,l,c);return{...e,geometry:h}}}}]);