"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[31550],{13504:(e,t,r)=>{r.d(t,{cZ:()=>R,XW:()=>O,fe:()=>F});var n,i=r(86394),o=r(98849),s=r(82256),a=(r(21355),r(88443)),l=r(78983);class p{constructor(){this.version="",this.queryResult=new u}}class u{constructor(){this.featureResult=new c}}class c{constructor(){this.objectIdFieldName="",this.uniqueIdField=new d,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new y,this.geometryType=null,this.spatialReference=new l.A,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new f,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}}class d{constructor(){this.name="",this.isSystemMaintained=!1}}class y{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}}class f{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new h,this.translate=new m}}class h{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}}class m{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}}class g{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}}class b{constructor(){this.attributes=[],this.compressedGeometry=new w,this.centroid=new w,this.aggregateGeometries=[]}}class w{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}}!function(e){e.ELEMENTUID="ELEMENTUID",e.TYPENAME="TYPENAME"}(n||(n={}));const M=[n.ELEMENTUID,n.TYPENAME];var _,T;!function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"}(_||(_={})),function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"}(T||(T={}));var I,v,E,A,S=r(84761),C=r(58435);function k(e){const t=new w;t.geometryType=C.bV[e.geometry_type.value];const r=[],n=[];for(let i=0;i<e.lengths.length;i++)r.push(e.lengths[i]);for(let i=0;i<e.coords.length;i++)n.push(e.coords[i]);return t.lengths=r,t.coords=n,t}function x(e){const t=new g;return t.name=e.name,t.alias=e.alias,t.fieldType=C.r5[e.field_type.value],t.sqlType=E[e.sql_type.value],t.domain=e.domain,t.defaultValue=e.default_value,t}function L(e){const t=x(e);return t.geometryType=C.bV[e.geometry_type.value],t}function N(e){const t=new f;t.quantizeOriginPosition=v[e.quantizeOriginPosition.value];const r=t.scale,n=e.scale;r.xScale=n.xScale,r.yScale=n.yScale,r.mScale=n.mScale,r.zScale=n.zScale;const i=t.translate,o=e.translate;return i.xTranslate=o.xTranslate,i.yTranslate=o.yTranslate,i.mTranslate=o.mTranslate,i.zTranslate=o.zTranslate,t}async function R(e,t){t??=!1;const r={generateAllSublayers:t,namedTypeDefinitions:new Map};return await async function(e){const t=await(0,i.A)(e,{responseType:"array-buffer"}),r=await t.data;return async function(e){const t=new((await(0,S.I)()).MapOfObjectIdentifierSetsDecoder),r=t.decode(new Uint8Array(e)),n=new Map;if(0!==r.error_code)throw new o.A("knowledge-graph:layer-support-utils",r.error_message);const i=t.get_map_of_identifier_sets(),s=i.keys,a=s.size();for(let l=0;l<a;l++){const e=s.get(l),t=i.query_identifier_set(e),r=[];if(t.id_array_type.value===A.GLOBALID_ARRAY){const e=t.get_globalid_array(),n=e.count();for(let t=0;t<n;t++)r.push(e.get_globalid_at(t))}else if(t.id_array_type.value===A.IDENTIFIER_ARRAY){const e=t.get_identifier_array(),n=e.count();for(let t=0;t<n;t++)r.push(e.get_identifier_at(t).toString())}else if(t.id_array_type.value===A.STRING_ARRAY){const e=t.get_string_array(),n=e.count();for(let t=0;t<n;t++)r.push(e.get_string_at(t))}else{if(t.id_array_type.value!==A.OID_ARRAY)throw new o.A("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const e=t.get_oid_array(),n=e.count();for(let t=0;t<n;t++)r.push(e.get_objectid_at(t).toString())}}n.set(e,r)}return t.delete(),n}(new Uint8Array(r))}(e).then((e=>{!function(e,t){for(const[r,n]of e){const e=(0,s.tE)(t.namedTypeDefinitions,r,(()=>({useAllData:!1,members:new Map})));for(const t of n)e.members.has(t)||e.members.set(t,{id:t})}}(e,r)})),r}async function F(e){const t=await(0,S.I)(),r=new t.MapOfObjectIdentifierSets;!function(e,t,r){for(const[n,i]of r.namedTypeDefinitions){if(!i.members||i.useAllData)continue;const r=i.members.keys();let o=!1,s=!0;const a=new t.ObjectIdArray,l=new t.StringArray,p=new t.GlobalIdArray,u=new t.IdentifierArray,c=new t.ObjectIdentifierSet;for(const e of r)s&&(o=!isNaN(Number(e)),s=!1),o?a.add_objectid(Number(e)):(l.add_string(e),p.add_globalid(e)),u.add_identifier(e);c.set_oid_array(a),c.set_string_array(l),c.set_globalid_array(p),c.set_identifier_array(u),a.delete(),l.delete(),p.delete(),u.delete(),e.put_identifier_set(n,c),c.delete()}}(r,t,e);const n=new t.MapOfObjectIdentifierSetsEncoder;try{n.set_map_of_identifier_sets(r),n.encode();const e=n.get_encoding_result();if(0!==e.error.error_code)throw new o.A("knowledge-graph:layer-support-utils",e.error.error_message);const t=structuredClone(e.get_byte_buffer());return n.delete(),t}finally{r.delete()}}async function D(e){const t=await(0,i.A)(e,{responseType:"array-buffer"});return async function(e){const t=new((await(0,S.I)()).FeatureCollectionDecoder),r=t.decode(new Uint8Array(e));if(0!==r.error_code)throw new o.A("knowledge-graph:layer-support-utils",r.error_message);const n=t.get_feature_collection(),i=function(e){const t=new p;t.version=e.version;const r=e.get_query_result();if(0!==r.results_type.value)throw new Error("Got a non-feature collection type");const n=r.get_feature_result(),i=t.queryResult.featureResult;i.objectIdFieldName=n.objectid_field_name,i.exceededTransferLimit=n.exceeded_transfer_limit,i.hasM=n.has_m,i.hasZ=n.has_z,i.geometryType=C.bV[n.geometry_type.value],i.globalIdFieldName=n.globalid_field_name,i.geohashFieldName=n.geohash_field_name;const o=i.uniqueIdField,s=n.unique_id_field;o.name=s.name,o.isSystemMaintained=s.isSystemMaintained;const a=i.geometryProperties,l=n.geometry_properties;a.shapeAreaFieldName=l.shapeAreaFieldName,a.shapeLengthFieldName=l.shapeLengthFieldName,a.units=l.units;const u=i.spatialReference,c=n.spatial_reference;u.wkid=c.wkid,u.latestWkid=c.latestWkid,u.vcsWkid=c.vcsWkid,u.latestVcsWkid=c.latestVcsWkid,u.wkt=c.wkt,i.transform=N(n.transform);const d=i.fields,y=i.fieldNameToAttributeIndexMap,f=n.fields,h=f.size();for(let p=0;p<h;p++){const e=f.get(p),t=x(e);d.push(t),y[t.name]=p,e.delete()}f.delete();const m=i.values,g=n.values_count();for(let p=0;p<g;p++)m.push(n.get_value_at(p));const w=i.features,_=n.features,T=_.size();if(T>0)for(const p of M)if(void 0===y[p])throw new Error(`Feature collection missing required attribute: ${p}`);for(let p=0;p<T;p++){const e=new b,t=_.get(p),r=e.attributes,n=t.attributes_count();for(let l=0;l<n;l++)r.push(t.get_attribute_at(l));const i=t.get_compressed_geometry();i&&(e.compressedGeometry=k(i),e.centroid=k(t.get_centroid()));const o=e.aggregateGeometries,s=t.aggregate_geometries,a=s.size();for(let l=0;l<a;l++){const e=s.get(l),t=k(e);o.push(t),e.delete()}s.delete(),w.push(e),t.delete()}_.delete();const I=i.geometryFields,v=n.geometry_fields,E=v.size();for(let p=0;p<E;p++){const e=v.get(p),t=L(e);I.push(t),e.delete()}return v.delete(),t}(n);return t.delete(),i}(await t.data)}function j(e,t){if(!e?.queryResult?.featureResult)return t;const r=e.queryResult.featureResult.fieldNameToAttributeIndexMap;for(const i of e.queryResult.featureResult.features){const e=i.attributes[r[n.TYPENAME]],o=(0,s.tE)(t.namedTypeDefinitions,e,(()=>({useAllData:!1,members:new Map}))),l=i.attributes[r[n.ELEMENTUID]];if(i.compressedGeometry?.coords?.length>0){let e=i.compressedGeometry.lengths;"esriGeometryPoint"===i.compressedGeometry.geometryType&&(e=[]),o.members.set(l,{id:l,linkChartLocation:new a.A(e,i.compressedGeometry.coords)})}else o.members.set(l,{id:l})}return t}!function(e){e[e.featureResult=0]="featureResult",e[e.countResult=1]="countResult",e[e.idsResult=2]="idsResult"}(I||(I={})),function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"}(v||(v={})),function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"}(E||(E={})),function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(A||(A={}));const O={fetchAndConvertSerializedLinkChart:e=>async function(e){const t=[],r={generateAllSublayers:!1,namedTypeDefinitions:new Map};return e.entitiesUrl&&t.push(D(e.entitiesUrl).then((e=>{j(e,r)}))),e.relationshipsUrl&&t.push(D(e.relationshipsUrl).then((e=>{j(e,r)}))),await Promise.all(t),r}(e)}},31828:(e,t,r)=>{r.d(t,{A:()=>d});var n=r(66866),i=r(21564),o=(r(39831),r(539),r(9272),r(63863)),s=r(8651),a=r(68833),l=r(15305),p=r(25389),u=r(91394),c=r(60973);let d=class extends((0,l.dM)((0,p.j)(a.A))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new u.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,n._)([(0,i.MZ)({type:c.A})],d.prototype,"elevationInfo",void 0),(0,n._)([(0,i.MZ)((0,s.C)(u.Y,"graphics"))],d.prototype,"graphics",void 0),(0,n._)([(0,i.MZ)({type:["show","hide"]})],d.prototype,"listMode",void 0),(0,n._)([(0,i.MZ)()],d.prototype,"screenSizePerspectiveEnabled",void 0),(0,n._)([(0,i.MZ)({readOnly:!0})],d.prototype,"type",void 0),(0,n._)([(0,i.MZ)({constructOnly:!0})],d.prototype,"internal",void 0),d=(0,n._)([(0,o.$)("esri.layers.GraphicsLayer")],d)},20061:(e,t,r)=>{r.d(t,{F0:()=>a,Vx:()=>u,e2:()=>d,f:()=>y});var n=r(39831),i=r(19251),o=r(22567),s=r(23173);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?s.Cb:"esriGeometryPolyline"===e?s.yM:s.WR}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let p=1;function u(e,t){if((0,n.A)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this${c(t)} = null;`;for(const t in e)r+=`this${c(t)} = ${JSON.stringify(e[t])};`;const n=new Function(`\n      return class AttributesClass$${p++} {\n        constructor() {\n          ${r};\n        }\n      }\n    `)();return()=>new n}catch(r){return()=>({[t]:null,...e})}}function c(e){return l.test(e)?`.${e}`:`["${e}"]`}function d(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,i.o8)(e)}}]}function y(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:o.F,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:o.P,editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},75835:(e,t,r)=>{r.d(t,{P:()=>T});var n=r(66866),i=r(52495),o=r(98849),s=r(539),a=r(82256),l=r(40189),p=r(76859),u=r(21564),c=(r(39831),r(9272),r(63863)),d=r(84698),y=r(62802),f=r(68490),h=r(87926),m=r(90670),g=r(35771),b=r(44128),w=r(90563),M=r(82388),_=r(14474);let T=class extends i.A{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach((r=>{r.name&&(t.set(r.name,"entity"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(r.name),r.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(r.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((r=>{r.name&&(t.set(r.name,"relationship"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(r.name),r.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(r.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((r,n)=>{if("entity"===t.get(n))this.entityTypeNames.add(n);else{if("relationship"!==t.get(n))return s.A.getLogger(this).warn(`A named type, ${n}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(n);this.relationshipTypeNames.add(n)}const i=new Map;r.members?.forEach((e=>{(0,a.tE)(this.memberIdTypeLookup,e.id,(()=>new Set)).add(n);const t=this.getById(e.id);t&&i.set(e.id,t)})),this.sublayerCaches.set(n,i)}))}addToLayer(e){e.forEach((({typeName:e,id:t})=>{if(!this.inclusionModeDefinition)throw new o.A("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){const r=this.inclusionModeDefinition.namedTypeDefinitions.get(e);r.members||(r.members=new Map),r.members.set(t,{id:t}),(0,a.tE)(this.memberIdTypeLookup,t,(()=>new Set)).add(e)}}else{const r=new Map;r.set(t,{id:t}),this.inclusionModeDefinition.namedTypeDefinitions.set(e,{useAllData:!1,members:r}),(0,a.tE)(this.memberIdTypeLookup,t,(()=>new Set)).add(e)}}))}getById(e){return g.A.getInstance().readFromStoreById(e)}async getData(e,t,r){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let n;if(n=e||new _.A({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){const e=t.parentCompositeLayer,r=this._processingCacheUpdatesLookup.get(t.objectType.name??""),i=n.outFields;i&&1===i.length&&i[0]===m.dr&&"1=1"===n.where||await Promise.all(r??[]);const o=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],s=[];return o.forEach((r=>{if(this.relationshipTypeNames.has(t.objectType.name)){r.geometry=e.relationshipLinkChartDiagramLookup.get(r.attributes[t.objectIdField]);const n=this.memberIdTypeLookup.get(r.attributes[m.Cz]),i=this.memberIdTypeLookup.get(r.attributes[m.KQ]),o=this._isEndEntitySpatial(n,r,m.Cz),s=this._isEndEntitySpatial(i,r,m.KQ);r.attributes[m.BL]=Number(o&&s)}else{r.geometry=e.entityLinkChartDiagramLookup.get(r.attributes[t.objectIdField]);const n=this.geographicLookup.get(t.objectType.name);n&&r.attributes[n.name]?r.attributes[m.BL]=1:r.attributes[m.BL]=0}r.attributes[m.T1]=r.geometry,s.push(r)})),s}return this.retrieveDataFromService(n,t,r)}async getConnectedRecordIds(e,t,r){const n=[];let i="";const o=this._getNamedTypeIdMapFromNodeIds(e);if(t&&0!==t?.length){for(const e of t)i=i+e+"|";i=i.slice(0,-1)}const s={},a=[];for(const[u,c]of o){const e=`${u}_ids`;s[e]=c,t&&0!==t?.length?a.push(`MATCH (n:${u}) WHERE id(n) IN $${e} WITH n MATCH (n)-[r:${i}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`):a.push(`MATCH (n:${u}) WHERE id(n) IN $${e} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`)}if(!a.length)return n;const l=a.join(" UNION "),p=(await(0,w.executeQueryStreaming)(this.knowledgeGraph,new M.A({openCypherQuery:l,bindParameters:s}),{signal:r?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await p.read();if(e)break;for(let r=0;r<t.length;r++){const e=t[r];n.push({id:e[0],typeName:e[1]}),n.push({id:e[2],typeName:e[3]})}}return n}async getRelationshipsBetweenNodes(e,t,r){const n=this._getNamedTypeIdMapFromNodeIds(e);if(0===n.size)return[];const i={relationshipExclusionIds:t,possibleConnectionEntityIds:e},o=[];for(const[p,u]of n.entries()){const e=`${p}_ids`;i[e]=u,o.push(`MATCH (n:${p}) WHERE id(n) IN $${e} WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const s=o.join(" UNION "),a=[],l=(await(0,w.executeQueryStreaming)(this.knowledgeGraph,new M.A({openCypherQuery:s,bindParameters:i}),{signal:r?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await l.read();if(e)break;for(let r=0;r<t.length;r++){const e=t[r];a.push({id:e[0],typeName:e[1]})}}return a}async getRelationshipsFromNodes(e,t,r,n){const i=this._getNamedTypeIdMapFromNodeIds(e);if(0===i.size||0===t.length)return[];const o={relationshipExclusionIds:r,possibleConnectionEntityIds:t},s=[];for(const[c,d]of i.entries()){const e=`${c}_ids`;o[e]=d,s.push(`MATCH (n:${c}) WHERE id(n) IN $${e} WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const a=s.join(" UNION "),l=new Map,p=(await(0,w.executeQueryStreaming)(this.knowledgeGraph,new M.A({openCypherQuery:a,bindParameters:o}),{signal:n?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await p.read();if(e)break;for(let r=0;r<t.length;r++){const e=t[r];let n=l.get(e[1]);n||(n=new Set,l.set(e[1],n)),n.add(e[0])}}const u=[];for(const[c,d]of l)for(const e of d)u.push({id:e,typeName:c});return u}async refreshCacheContent(e,t,r,n=!0,i){const s=g.A.getInstance(),p=[],u=new Map,c=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&c.set(e.name,e)})),this.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&c.set(e.name,e)})),e||this.inclusionModeDefinition?e?e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const t of this.memberIdTypeLookup.get(e))u.has(t)?u.get(t)?.push(e):u.set(t,[e])})):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{e.useAllData?u.set(t,null):e.members&&e.members.forEach((e=>{u.has(t)&&null!==u.get(t)?u.get(t)?.push(e.id):u.set(t,[e.id])}))})):(this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&u.set(e.name,null)})),this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&u.set(e.name,null)})));for(const[l,d]of u){const e=new Set(d),u=new Promise(((p,u)=>{(async()=>{const p=new Set,u=[];let y,f="",h=!1;if(t||c.get(l)?.properties?.forEach((e=>{e.name&&p.add(e.name)})),r&&this.geographicLookup.has(l)){const e=this.geographicLookup.get(l)?.name;e&&p.add(e)}if(this.entityTypeNames.has(l))f=`MATCH (n:${l}) ${d?"WHERE id(n) IN $ids ":""}return ID(n)`,p.forEach((e=>{f+=`, n.${e}`,u.push(e)}));else{if(!this.relationshipTypeNames.has(l))throw new o.A("knowledge-graph:layer-data-manager",`The graph type of ${l} could not be determined. Was this type set in the KG data model and inclusion definition?`);h=!0,f=`MATCH ()-[n:${l}]->() ${d?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,p.forEach((e=>{f+=`, n.${e}`,u.push(e)}))}y=new M.A(d?{openCypherQuery:f,bindParameters:{ids:d}}:{openCypherQuery:f});const g=(await(0,w.executeQueryStreaming)(this.knowledgeGraph,y,{signal:i?.signal})).resultRowsStream.getReader();for(;;){const{done:t,value:r}=await g.read();if(t)break;const i=[];for(let n=0;n<r.length;n++){const t=r[n];let o=0,s=0;const l={properties:{}};for(l.id=t[o],o++,s++,h&&(l.originId=t[o],o++,s++,l.destinationId=t[o],o++,s++,(0,a.tE)(this.nodeConnectionsLookup,l.originId,(()=>new Set)).add(l.id),(0,a.tE)(this.nodeConnectionsLookup,l.destinationId,(()=>new Set)).add(l.id),(0,a.tE)(this.relationshipConnectionsLookup,l.id,(()=>[l.originId,l.destinationId])));o<t.length;o++)l.properties[u[o-s]]=t[o];e.delete(l.id),i.push(l)}const o=s.writeToStore(i,m.dr,this.geographicLookup.get(l)?.name);this.sublayerCaches.has(l)||this.sublayerCaches.set(l,new Map),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(l)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(l,{useAllData:!1,members:new Map}),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(l).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(l).members=new Map);const p=this.sublayerCaches.get(l);o.forEach((e=>{p?.set(e.attributes[m.dr],e),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(l).members.has(e.attributes[m.dr])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(l).members.set(e.attributes[m.dr],{id:e.attributes[m.dr]}),(0,a.tE)(this.memberIdTypeLookup,e.attributes[m.dr],(()=>new Set)).add(l))}))}const b=this.inclusionModeDefinition?.namedTypeDefinitions.get(l);if(b)for(const t of e)b.members?.delete(t)})().then((()=>{p(null)})).catch((e=>{"AbortError"===e.name?p(null):u(e)}))}));p.push(u),this._processingCacheUpdatesLookup.get(l)?.push(u)}if(await Promise.all(p),i?.signal?.aborted)throw(0,l.NK)()}removeFromLayer(e){const t=new Set,r=new Set(e.map((e=>e.id)));for(const n of e)t.add(n.typeName),1===this.memberIdTypeLookup.get(n.id)?.size?this.memberIdTypeLookup.delete(n.id):this.memberIdTypeLookup.get(n.id)?.delete(n.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{t===n.typeName&&e.members?.has(n.id)&&e.members.delete(n.id)}));t.forEach((e=>{this.sublayerCaches.get(e)?.forEach(((t,n)=>{r.has(n)&&this.sublayerCaches.get(e)?.delete(n)}))}))}async retrieveDataFromService(e,t,r){const n=g.A.getInstance(),i=new Set,s=[];let a,l="",u=[];const c="relationship"===t.graphType,_=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,T=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let I=!_&&T?Array.from(T).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(I=e.objectIds);else if(null!=e.objectIds&&I&&I.length>0){const t=e.objectIds;e.objectIds=I.filter((e=>t.includes(e)))}else if(null!=e.objectIds)I=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=I}if(null!=e.outFields){const r=e.outFields;r.includes("*")?t.fields.forEach((e=>{i.add(e.name)})):r.forEach((e=>{e!==m.dr&&e!==t.geometryFieldName&&i.add(e)}))}if(null!=e.geometry){const r=e.geometry;let n;const u=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,m=u?.spatialReference,g=u?.serviceCapabilities?.geometryCapabilities;let w=g?.geometryMaxBoundingRectangleSizeX,_=g?.geometryMaxBoundingRectangleSizeY;if("point"===r.type){let e=r;e.spatialReference?.isWGS84||(await(0,f.initializeProjection)(e.spatialReference,h.KK),e=(0,f.project)(e,h.KK)),n=new d.A({spatialReference:h.KK,xmin:e.x-1e-4,ymin:e.y-1e-4,xmax:e.x+1e-4,ymax:e.y+1e-4})}else r?.extent?.spatialReference&&!r.spatialReference?.isWGS84?(await(0,f.initializeProjection)(r.extent.spatialReference,h.KK),n=(0,f.project)(r.extent,h.KK)):n=r.extent;if(w&&_&&m){if(4326!==m.wkid){const e=new d.A({spatialReference:m,xmax:w,ymax:_}),t=(0,f.project)(e,h.KK);w=t.xmax,_=t.ymax}if(n.xmax-n.xmin>w)throw new o.A("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${w}\xb0 latitude, limit exceeded`);if(n.ymax-n.ymin>_)throw new o.A("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${_}\xb0 longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){const r=await(0,p.GP)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach((e=>{r.fieldNames.includes(e.name)&&i.add(e.name)}))}l=c?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&i.add(t.geometryFieldName),i.forEach((e=>{l+=`, n.${e}`,s.push(e)})),a=new M.A({openCypherQuery:l,bindParameters:{param_filter_geom:new y.A({rings:(0,b.Wq)(n)})}})}else{let r="";if(null!=e.where&&"1=1"!==e.where){const n=await(0,p.GP)(e.where,t.fieldsIndex);t.fields.forEach((e=>{n.fieldNames.includes(e.name)&&i.add(e.name)}));const o=new Set(["column-reference","string","number","binary-expression"]),s=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let a=!1;const l=e=>{if("column-reference"===e.type)return`n.${e.column}`;if("string"===e.type)return`'${e.value}'`;if("number"===e.type)return`${e.value}`;if("binary-expression"===e.type&&o.has(e.left.type)&&o.has(e.right.type)&&s.has(e.operator))return`${l(e.left)} ${e.operator} ${l(e.right)}`;if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+=`lower(n.${e.left.args.value[0].column})`;else{if("column-reference"!==e.left.type)return a=!0,"";t+=`lower(n.${e.left.column})`}if(t+=" CONTAINS (","string"!==e.right.type)return a=!0,"";{let r=e.right.value;"%"===r.charAt(0)&&(r=r.slice(1)),"%"===r.charAt(r.length-1)&&(r=r.slice(0,-1)),t+=`'${r.toLowerCase()}')`}return t}return a=!0,""};r=l(n.parseTree),a&&(r="")}let n="";n=c?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let o=!1;I&&(o=!0,n+=" WHERE ID(n) IN $ids"),r&&(n+=o?" AND":" WHERE",n+=` ${r}`),n+=" return ID(n)",c&&(n+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&i.add(t.geometryFieldName),i.forEach((e=>{n+=`, n.${e}`,s.push(e)})),a=new M.A(I?{openCypherQuery:n,bindParameters:{ids:I}}:{openCypherQuery:n})}const v=(await(0,w.executeQueryStreaming)(t.parentCompositeLayer.dataManager.knowledgeGraph,a,r)).resultRowsStream.getReader();for(;;){const{done:e,value:r}=await v.read();if(e)break;const i=[];for(let t=0;t<r.length;t++){const e=r[t];let n=0,o=0;const a={properties:{}};for(a.id=e[n],n++,o++,c&&(a.originId=e[n],n++,o++,a.destinationId=e[n],n++,o++);n<e.length;n++)a.properties[s[n-o]]=e[n];i.push(a)}u=u.concat(n.writeToStore(i,m.dr,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return u}_isEndEntitySpatial(e,t,r){for(const n of e??[])if(this.entityTypeNames.has(n)){const e=this.geographicLookup.get(n),i=e&&this.sublayerCaches.get(n)?.get(t.attributes[r]);if(e&&i?.attributes[e.name])return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){const t=new Map;return e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const r of this.memberIdTypeLookup.get(e)){if(!this.entityTypeNames.has(r))return;t.has(r)?t.get(r)?.push(e):t.set(r,[e])}})),t}};(0,n._)([(0,u.MZ)()],T.prototype,"knowledgeGraph",void 0),(0,n._)([(0,u.MZ)()],T.prototype,"inclusionModeDefinition",void 0),(0,n._)([(0,u.MZ)()],T.prototype,"entityTypeNames",void 0),(0,n._)([(0,u.MZ)()],T.prototype,"relationshipTypeNames",void 0),(0,n._)([(0,u.MZ)()],T.prototype,"geographicLookup",void 0),(0,n._)([(0,u.MZ)()],T.prototype,"sublayerCaches",void 0),(0,n._)([(0,u.MZ)()],T.prototype,"nodeConnectionsLookup",void 0),(0,n._)([(0,u.MZ)()],T.prototype,"relationshipConnectionsLookup",void 0),(0,n._)([(0,u.MZ)()],T.prototype,"memberIdTypeLookup",void 0),T=(0,n._)([(0,c.$)("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],T)},54493:(e,t,r)=>{r.d(t,{A:()=>re});var n=r(66866),i=r(56542),o=r(19251),s=r(539),a=r(35775),l=(r(90752),r(21564)),p=(r(39831),r(63863)),u=r(77542),c=r(94255),d=r(84698),y=r(97066),f=r(62802),h=r(42238),m=r(68490),g=r(78983),b=r(87926),w=r(12433),M=r(68833),_=r(88719),T=r(20458),I=r(20061),v=r(90670);r(9272);const E=(0,r(77567).p)(),A=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,n._)([(0,l.MZ)(E.fields)],t.prototype,"fields",void 0),(0,n._)([(0,l.MZ)(E.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,n._)([(0,p.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t),t};var S=r(23257),C=r(15305),k=r(54576),x=r(15053),L=r(94783),N=r(30111),R=r(50508),F=r(25389),D=r(90826),j=r(76592),O=r(92568),P=r(24738),G=r(42453),$=r(61826),Z=r(79682),z=r(83849),q=r(47347),V=r(48887),B=r(53835),U=r(57822),Q=r(14474),H=r(44116),W=r(55056),Y=r(22910);function J(e){if(!e.json)return e;e.json.write=K(e.json.write);const t=e.json.origins;if(!t)return e;let r;for(r in t){const e=t[r];e&&(e.write=K(e.write))}return e}function K(e){return"object"==typeof e&&e?(!1!==e.enabled&&(e.overridePolicy=function(e){const{target:t,writer:r,overridePolicy:n,...i}=e;return function(e,t){const r=ee.call(this,e,t);return r.enabled?{...i,...r}:r}}(e)),e):!0===e?X():e}function X(){return{overridePolicy:ee}}function ee(e,t){const r=!!this.geometryType;let n={enabled:r};return r&&(n={...n,...te.call(this,e,t)}),n}function te(e,t){return{ignoreOrigin:this.originIdOf(t)>c.Gr.DEFAULTS}}let re=class extends(A((0,k.FJ)((0,L.J)((0,x.F)((0,C.dM)((0,N.fY)((0,D.e)((0,F.j)((0,R.J)((0,a.P)(M.A))))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=(0,I.f)(!1,!0),this.charts=null,this.definitionExpression=null,this.displayField="",this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=v.dr,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then((()=>{const e=new MessageChannel;return new Y.A(e.port1,{channel:e,client:{queryFeatures:(e,t={})=>{const r=Q.A.fromJSON(e);return this.queryFeaturesJSON(r,t)}}}),[e.port2]}))},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get userHasUpdateItemPrivileges(){return!!this.parent?.userHasUpdateItemPrivileges}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){const e=[];return this.objectType?.properties?.forEach((t=>{const r="esriFieldTypeOID"===t.fieldType?"esriFieldTypeInteger":t.fieldType;e.push(P.A.fromJSON({name:t.name,type:r,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))})),e.push(P.A.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),P.A.fromJSON({name:v.M1,type:"esriFieldTypeInteger",alias:v.M1,editable:!1}),P.A.fromJSON({name:v.BL,type:"esriFieldTypeInteger",alias:v.BL,editable:!1})),e}get geometryType(){if("link-chart"===this.parentCompositeLayer?.type)return"relationship"===this.graphType?"polyline":"point";const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&"esriGeometryNull"!==t?w.gy.fromJSON(t):null}get geometryFieldName(){if("link-chart"===this.parentCompositeLayer?.type)return v.T1;const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name);return e?.name??null}get graphTypeName(){return this.objectType?.name}get hasM(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,r=t?this.objectType?.properties?.[t]:null;return r?.hasM??!1}get hasZ(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,r=t?this.objectType?.properties?.[t]:null;return r?.hasZ??!1}set labelingInfo(e){this._set("labelingInfo",e)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");if(!this.objectType||!this.parentCompositeLayer||!this.graphTypeName)return null;const e=this.objectType.properties?(0,S.MY)(this.objectType.properties):"ESRI__ID";return"link-chart"===this.parentCompositeLayer.type?(0,S.iW)(this.graphType,this.graphTypeName,e):(0,S.e$)(this.graphTypeName,this.geometryType,e)}set renderer(e){(0,G.yp)(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){if(this._isOverridden("renderer"))return this._get("renderer");const e=this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel,t=[...e?.entityTypes??[],...e?.relationshipTypes??[]].map((e=>e.name)).indexOf(this.graphTypeName),r=(0,S.Td)(t);if("link-chart"===this.parentCompositeLayer?.type){if("relationship"===this.graphType)return new q.A({type:"simple",symbol:(0,S.UT)(r)});const e=(0,V.r)((0,I.F0)(w.gy.toJSON("point")).renderer);return(0,W.dt)(e.symbol,r),e}const n=(0,V.r)((0,I.F0)(w.gy.toJSON(this.geometryType)).renderer);return(0,W.dt)(n.symbol,r),n}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??g.A.WGS84}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return(0,H.tn)(this,e)}createQuery(){return new Q.A({where:"1=1",outFields:["*"]})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return null}async queryFeatures(e,t){await this.load();const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e),i=U.A.fromJSON(await n.executeQuery(r.toJSON(),t?.signal));return i.features.forEach((e=>{e.sourceLayer=this})),i}async queryFeaturesJSON(e,t){await this.load();const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e);return await n.executeQuery(r.toJSON(),t?.signal)}async queryFeatureCount(e,t){await this.load();const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e);return n.executeQueryForCount(r.toJSON(),t?.signal)}async queryExtent(e={},t){await this.load();const r={...e,returnGeometry:!0},{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(r),o=await i.executeQueryForExtent(n.toJSON(),t?.signal);let s;return s=null!=o.extent?.xmin&&null!=o.extent?.xmax&&null!=o.extent?.ymin&&null!=o.extent?.ymax?new d.A(o.extent):new d.A,{count:o.count,extent:s}}async queryObjectIds(e,t){await this.load();const r=Q.A.from(e);let n;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)n=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(r,this,t);n=this.loadQueryEngine(e)}return await n.executeQueryForIds(r.toJSON(),t?.signal)}loadQueryEngine(e){const t=new _.A({geometryType:w.gy.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),r=new T.do({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:w.gy.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,featureIdInfo:{type:"object-id",fieldName:this.objectIdField},spatialReference:this.spatialReference.toJSON(),timeInfo:this.timeInfo?.toJSON(),featureStore:t});return r.featureStore.addMany(e),r}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new Q.A({where:"1=1",outFields:[v.dr]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}load(e){return this.addResolvingPromise(this.parent.load(e).then((()=>(0,G.sv)(this.timeInfo,this.fieldsIndex)))),Promise.resolve(this)}async _setupQueryObjects(e,t){const r=Q.A.from(e),n=r.geometry;if(n&&!n.spatialReference?.isWGS84&&(await(0,m.initializeProjection)(n.spatialReference,b.KK),r.geometry=(0,m.project)(n instanceof f.A||n instanceof h.A||n instanceof y.A?n:n.extent,b.KK)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)return{resolvedQuery:r,queryEngine:this._cachedQueryEngine};const i=await this.parentCompositeLayer.dataManager.getData(r,this,t);return{resolvedQuery:r,queryEngine:this.loadQueryEngine(i)}}};(0,n._)([(0,l.MZ)(J((0,o.o8)(C.sU)))],re.prototype,"blendMode",void 0),(0,n._)([(0,l.MZ)()],re.prototype,"capabilities",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],re.prototype,"userHasUpdateItemPrivileges",null),(0,n._)([(0,l.MZ)({json:{origins:{"web-scene":{write:!1}},write:X()}})],re.prototype,"charts",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],re.prototype,"defaultPopupTemplate",null),(0,n._)([(0,l.MZ)({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],re.prototype,"definitionExpression",void 0),(0,n._)([(0,l.MZ)()],re.prototype,"displayField",void 0),(0,n._)([(0,l.MZ)(J((0,o.o8)(k.Dp)))],re.prototype,"displayFilterEnabled",void 0),(0,n._)([(0,l.MZ)(J((0,o.o8)(k.KV)))],re.prototype,"displayFilterInfo",void 0),(0,n._)([(0,l.MZ)(J((0,o.o8)(C.LF)))],re.prototype,"effect",void 0),(0,n._)([(0,l.MZ)()],re.prototype,"elevationInfo",void 0),(0,n._)([(0,l.MZ)(J((0,o.o8)(x.Y)))],re.prototype,"featureEffect",void 0),(0,n._)([(0,l.MZ)(J((0,o.o8)(O.d)))],re.prototype,"featureReduction",null),(0,n._)([(0,l.MZ)()],re.prototype,"fields",null),(0,n._)([(0,l.MZ)()],re.prototype,"geometryType",null),(0,n._)([(0,l.MZ)()],re.prototype,"geometryFieldName",null),(0,n._)([(0,l.MZ)({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],re.prototype,"graphType",void 0),(0,n._)([(0,l.MZ)({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],re.prototype,"graphTypeName",null),(0,n._)([(0,l.MZ)()],re.prototype,"hasM",null),(0,n._)([(0,l.MZ)()],re.prototype,"hasZ",null),(0,n._)([(0,l.MZ)({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],re.prototype,"id",void 0),(0,n._)([(0,l.MZ)({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],re.prototype,"labelsVisible",void 0),(0,n._)([(0,l.MZ)({type:[$.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:function(e,t,r){const n=[["ESRI__AGGREGATION_COUNT",v.M1],["ESRI__ORIGIN_ID",v.Cz],["ESRI__DESTINATION_ID",v.KQ],["ESRI__LAYOUT_GEOMETRY",v.T1]];try{for(const t of e)for(const[e,r]of n)t.labelExpression=t.labelExpression?.replaceAll(e,r),t.labelExpressionInfo?.expression&&(t.labelExpressionInfo.expression=t.labelExpressionInfo.expression.replaceAll(e,r))}catch(i){s.A.getLogger(this).warn("Error updating labelingInfo",i)}return(0,Z.w)(e,t,r)},write:X()}})],re.prototype,"labelingInfo",null),(0,n._)([(0,l.MZ)({readOnly:!0,json:{read:!1,write:{writer(e,t){switch(this.parentCompositeLayer?.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],re.prototype,"layerType",void 0),(0,n._)([(0,l.MZ)(J((0,o.o8)(j.fV)))],re.prototype,"legendEnabled",void 0),(0,n._)([(0,l.MZ)(J((0,o.o8)(j.hG)))],re.prototype,"maxScale",void 0),(0,n._)([(0,l.MZ)(J((0,o.o8)(j.hn)))],re.prototype,"minScale",void 0),(0,n._)([(0,l.MZ)()],re.prototype,"objectIdField",void 0),(0,n._)([(0,l.MZ)()],re.prototype,"objectType",void 0),(0,n._)([(0,l.MZ)(J((0,o.o8)(j.ke)))],re.prototype,"opacity",void 0),(0,n._)([(0,l.MZ)(J((0,o.o8)(N.ne)))],re.prototype,"orderBy",void 0),(0,n._)([(0,l.MZ)({clonable:!1})],re.prototype,"parent",void 0),(0,n._)([(0,l.MZ)()],re.prototype,"parentCompositeLayer",void 0),(0,n._)([(0,l.MZ)(J((0,o.o8)(j.M6)))],re.prototype,"popupEnabled",void 0),(0,n._)([(0,l.MZ)({type:i.A,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],re.prototype,"popupTemplate",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:{overridePolicy:te}}})],re.prototype,"refreshInterval",void 0),(0,n._)([(0,l.MZ)({types:B.Hg,json:{name:"layerDefinition.drawingInfo.renderer",write:X()}})],re.prototype,"renderer",null),(0,n._)([(0,l.MZ)()],re.prototype,"source",void 0),(0,n._)([(0,l.MZ)()],re.prototype,"spatialReference",null),(0,n._)([(0,l.MZ)({type:z.A,json:{name:"layerDefinition.timeInfo",write:!0,origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:!0},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:!0}}}})],re.prototype,"timeInfo",null),(0,n._)([(0,l.MZ)({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],re.prototype,"title",null),(0,n._)([(0,u.K)("title")],re.prototype,"writeTitle",null),(0,n._)([(0,l.MZ)({json:{read:!1}})],re.prototype,"type",void 0),(0,n._)([(0,l.MZ)(J((0,o.o8)(D.B)))],re.prototype,"useViewTime",void 0),(0,n._)([(0,l.MZ)({type:Boolean,json:{name:"visibility",write:X()}})],re.prototype,"visible",void 0),re=(0,n._)([(0,p.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],re)},35771:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(1171),i=r(21355),o=r(32597),s=r(90670);class a{constructor(){this._featureLookup=new Map}static getInstance(){return a.instance||(a.instance=new a),a.instance}static resetInstance(){a.instance&&(a.instance=null)}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const t=[];return e.forEach((e=>{const r=this.readFromStoreById(e);r&&t.push(r)})),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,t,r){const a=[];return e.forEach((e=>{if(!e?.id)return;e.properties||(e.properties=[]);let l,p=null;if(r&&e.properties[r]&&(p=(0,i.Ux)(e.properties[r])),"originId"in e&&"destinationId"in e&&(e.properties[s.Cz]=e.originId,e.properties[s.KQ]=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const i=this._featureLookup.get(e.id),s=JSON.parse(JSON.stringify(Object.assign(i.attributes,e.properties)));r&&e.properties[r]&&(s[r]=(0,n.rS)(e.properties[r])),l=new o.Om(p?JSON.parse(JSON.stringify(p)):i?.geometry?JSON.parse(JSON.stringify(i.geometry)):null,s,null,e.properties[t])}else l=new o.Om(p?JSON.parse(JSON.stringify(p)):null,e.properties,null,e.properties[t]);this._featureLookup.set(`${e.typeName?`${e.typeName}__${e.id}`:e.id}`,l),a.push(l)})),a}}},90670:(e,t,r)=>{r.d(t,{BL:()=>l,Cz:()=>i,KQ:()=>o,M1:()=>a,T1:()=>s,dr:()=>n});const n="ESRI__ID",i="ESRI__OriginID",o="ESRI__DestID",s="ESRI__LayoutGeometry",a="ESRI__AggregationCount",l="LC.ESRI__IsSpatial"},23257:(e,t,r)=>{r.d(t,{MY:()=>m,Td:()=>f,UT:()=>h,e$:()=>b,iW:()=>g,qN:()=>c});var n=r(96220),i=r(61826),o=r(6402),s=r(90563),a=r(54394),l=r(42602);const p={initializeLayersFromClientData:async(e,t,r)=>{if(t||(t=[...e.layers,...e.tables].map((e=>e.graphTypeName))),0===t?.length)return;const n=new Map;for(const o of t)n.set(o,u(e,o));const i=await(0,s.fetchClientDataAtKeys)(e.dataManager.knowledgeGraph,Array.from(n.values()),{requestOptions:{signal:r?.signal}});for(const o of[...e.layers,...e.tables]){const t=o.objectType.name;if(null==t)continue;const r=i.get(u(e,t));if(r){const e=JSON.parse(r);null===e||"object"!=typeof e||e.hasOwnProperty("showLabels")||(e.showLabels=!1),o.read(e,{origin:"service"})}}}},u=(e,t)=>"knowledge-graph"===e.type?`${t}/Map`:`${t}/LinkChart/LinkChartSubLayer`;async function c(e,t,r){return p.initializeLayersFromClientData(e,t,r)}const d=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"],y="#8f8f82";function f(e){return e<0||e>=d.length?new n.A(y):new n.A(d[e])}function h(e){const t=e.toArray();return new a.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:t},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}]}]}}})}function m(e){let t="ESRI__ID",r=4;for(const n of e)if(n.name){if("name"===n.name.toLowerCase()){t=n.name;break}n.name.toLowerCase().includes("name")?(t=n.name,r=2):"esriFieldTypeString"===n.fieldType&&r>3&&(t=n.name,r=3)}return t}function g(e,t,r){const n={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},s=new i.A({labelExpressionInfo:new o.A({expression:"ESRI__ID"===r?`${t}`:`$feature.${r}`}),labelPlacement:"above-center",symbol:new l.A(n)}),a=new i.A({labelExpressionInfo:new o.A({expression:`'${t}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new l.A({...n,yoffset:"12px"})});return"entity"===e?[s]:[a]}function b(e,t,r){const n={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},s="ESRI__ID"===r?`${e}`:`$feature.${r}`;return"point"===t?[new i.A({labelExpressionInfo:new o.A({expression:s}),labelPlacement:"above-center",symbol:new l.A(n)})]:"polyline"===t?[new i.A({labelExpressionInfo:new o.A({expression:s}),labelPlacement:"center-along",repeatLabel:!0,symbol:new l.A(n)})]:"polygon"===t?[new i.A({labelExpressionInfo:new o.A({expression:s}),labelPlacement:"always-horizontal",symbol:new l.A(n)})]:null}},44128:(e,t,r)=>{r.d(t,{k5:()=>u,aq:()=>p,Wq:()=>c});r(25707);var n=r(98849),i=(r(97066),r(62802),r(42238),r(31828),r(35771),r(33327),r(59851));(0,i.O)()({none:"none",startAndEnd:"start-and-end",startOnly:"start-only"}),(0,i.O)()({absoluteValue:"absolute-value",multiplier:"multiplier"});const o=new Map([["basic-grid","basic-grid"],["geographic-organic-standard","geographic-organic-standard"],["hierarchical-bottom-to-top","hierarchical-bottom-to-top"],["hierarchical-top-to-bottom","hierarchical-bottom-to-top"],["organic-community","organic-community"],["organic-fusiform","organic-standard"],["organic-leaf-circle","organic-standard"],["organic-standard","organic-standard"],["radial-node-centric","radial-root-centric"],["radial-root-centric","radial-root-centric"],["tree-bottom-to-top","tree-left-to-right"],["tree-left-to-right","tree-left-to-right"],["tree-right-to-left","tree-left-to-right"],["tree-top-to-bottom","tree-left-to-right"],["chronological-mono-timeline","chronological-mono-timeline"],["chronological-multi-timeline","chronological-multi-timeline"]]);var s=r(90563),a=r(82388);r(54394),r(68882),r(42602);function l(e,t){const r=new Map;if(t.dataModel?.relationshipTypes)for(const n of t.dataModel.relationshipTypes)n.name&&r.set(n.name,[]);for(const n of e)r.has(n.typeName)&&r.get(n.typeName)?.push(n.id);return r}async function p(e,t,r){const n=[],i=l(e,t),o={},p=[];for(const[s,a]of i){if(a.length<1)continue;const e=`${s}_ids`;o[e]=a,p.push(`MATCH (n)-[r:${s}]->(m) WHERE id(r) in $${e} RETURN id(n), labels(n)[0], id(m), labels(m)[0]`)}if(0===p.length)return[];const u=p.join(" UNION "),c=new a.A({openCypherQuery:u,bindParameters:o}),d=(await(0,s.executeQueryStreaming)(t,c,r?.requestOptions)).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await d.read();if(e)break;for(const r of t)n.push({id:r[0],typeName:r[1]}),n.push({id:r[2],typeName:r[3]})}return n}const u=e=>o.get(e)??"radial-root-centric";function c(e){if(!e.spatialReference.isWGS84)throw new n.A("knowledge-graph:layer-support-utils","The utilsExtentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}},54576:(e,t,r)=>{r.d(t,{FJ:()=>b,Dp:()=>w,KV:()=>M});var n=r(66866),i=r(76724),o=r(21564),s=(r(39831),r(539),r(9272),r(63863)),a=r(73324),l=r(24793),p=r(48982),u=r(21877),c=r(77542),d=r(61781),y=r(33880);const f={write:{overridePolicy:(e,t,r)=>({enabled:!r||"scale"===r.filterMode})}};let h=class extends(l.A.ClonableMixin(u.A)){constructor(e){super(e),this.id=(0,y.lk)(),this.maxScale=0,this.minScale=0,this.title="",this.where=null}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],h.prototype,"id",void 0),(0,n._)([(0,o.MZ)({type:Number,json:f})],h.prototype,"maxScale",void 0),(0,n._)([(0,o.MZ)({type:Number,json:f})],h.prototype,"minScale",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],h.prototype,"title",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],h.prototype,"where",void 0),h=(0,n._)([(0,s.$)("esri.layers.support.DisplayFilter")],h);var m=r(6117);let g=class extends(l.A.ClonableMixin(u.A)){constructor(e){super(e),this.activeFilterId=null,this.filters=new(p.A.ofType(h)),this.mode="manual"}writeFilters(e,t,r,n){const i=e.toArray();"scale"===this.mode&&i.sort(((e,t)=>{const r=(0,d.oW)(t.minScale,e.minScale),n=e.maxScale-t.maxScale;return 0===r?n:r})),t[r]=i.map((e=>e.toJSON(n)))}write(e,t){return super.write(e,(0,m.mW)(this,t))}};(0,n._)([(0,o.MZ)({type:String,json:{write:{overridePolicy:(e,t,r)=>({enabled:"manual"===r.filterMode,isRequired:!0})}}})],g.prototype,"activeFilterId",void 0),(0,n._)([(0,o.MZ)({type:p.A.ofType(h),nonNullable:!0,json:{write:!0}})],g.prototype,"filters",void 0),(0,n._)([(0,c.K)("filters")],g.prototype,"writeFilters",null),(0,n._)([(0,o.MZ)({type:["manual","scale"],nonNullable:!0,json:{name:"filterMode",write:!0}})],g.prototype,"mode",void 0),g=(0,n._)([(0,s.$)("esri.layers.support.DisplayFilterInfo")],g);const b=e=>{let t=class extends e{constructor(){super(...arguments),this.displayFilterEnabled=!0,this.displayFilterInfo=null}};return(0,n._)([(0,o.MZ)(w)],t.prototype,"displayFilterEnabled",void 0),(0,n._)([(0,o.MZ)(M)],t.prototype,"displayFilterInfo",void 0),t=(0,n._)([(0,s.$)("esri.layers.mixins.DisplayFilteredLayer")],t),t},w={type:Boolean,json:{name:"layerDefinition.disableDisplayFilter",read:{reader:e=>!e},write:{layerContainerTypes:a.K,writer(e,t,r){(0,i.sM)(r,!e,t)}},origins:{"web-scene":{write:!1,read:!1}}}},M={type:g,json:{name:"layerDefinition.displayFilterInfo",write:{enabled:!0,allowNull:!0,layerContainerTypes:a.K},origins:{"web-scene":{write:!1,read:!1}}}}},15053:(e,t,r)=>{r.d(t,{F:()=>l,Y:()=>a});var n=r(66866),i=r(21564),o=(r(39831),r(539),r(9272),r(63863));const s={write:{allowNull:!0}},a={type:r(76137).A,json:{origins:{"web-map":s,"portal-item":s}}},l=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return(0,n._)([(0,i.MZ)(a)],t.prototype,"featureEffect",void 0),t=(0,n._)([(0,o.$)("esri.layers.mixins.FeatureEffectLayer")],t),t}},94783:(e,t,r)=>{r.d(t,{J:()=>E});var n=r(66866),i=r(85251),o=r(21564),s=r(39831),a=r(539),l=(r(9272),r(63863)),p=r(94301),u=r(92568),c=r(47347),d=r(63926),y=r(68745),f=r(98849),h=r(69075),m=r(54746),g=r(18443),b=r(23369);s.A.add("esri-cluster-arcade-enabled",!0);const w=(0,s.A)("esri-cluster-arcade-enabled"),M=new Set(["simple-line","simple-fill","picture-fill"]);function _(e,t){let r=t.clone();if(!T(r))return r;if(t.symbols.some((e=>M.has(e.type)))&&(r=new c.A({symbol:new b.A})),r.authoringInfo||(r.authoringInfo=new g.A),r.authoringInfo.isAutoGenerated=!0,"visualVariables"in r){const t=(r.visualVariables||[]).filter((e=>"$view.scale"!==e.valueExpression));t.forEach((t=>{"rotation"===t.type?t.field?t.field=v(e,t.field,"avg_angle","number"):t.valueExpression&&(t.field=I(e,t.valueExpression,"avg_angle","number"),t.valueExpression=null):t.normalizationField?(t.field=v(e,t.field,"avg_norm","number",t.normalizationField),t.normalizationField=null):t.field?t.field=v(e,t.field,"avg","number"):t.valueExpression&&(t.field=I(e,t.valueExpression,"avg","number"),t.valueExpression=null)})),r.visualVariables=t}switch(r.type){case"simple":break;case"pie-chart":for(const t of r.attributes)t.field?t.field=v(e,t.field,"sum","number"):t.valueExpression&&(t.field=I(e,t.valueExpression,"sum","number"),t.valueExpression=null);break;case"unique-value":r.field?r.field=v(e,r.field,"mode","string"):r.valueExpression&&(r.field=I(e,r.valueExpression,"mode","string"),r.valueExpression=null);break;case"class-breaks":r.normalizationField?(r.field=v(e,r.field,"avg_norm","number",r.normalizationField),r.normalizationField=null):r.field?r.field=v(e,r.field,"avg","number"):r.valueExpression&&(r.field=I(e,r.valueExpression,"avg","number"),r.valueExpression=null)}return r}const T=e=>{const t=t=>a.A.getLogger("esri.views.2d.layers.support.clusterUtils").error(new f.A("Unsupported-renderer",t,{renderer:e}));if(!e)return!1;switch(e.type){case"unique-value":if(e.field2||e.field3)return t("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(e.normalizationField){const r=e.normalizationType;if("field"!==r)return t(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return t(`FeatureReductionCluster does not support renderers of type ${e.type}`),!1}if(!w){if("valueExpression"in e&&e.valueExpression)return t("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in e&&e.visualVariables||[]).some((e=>!(!("valueExpression"in e)||!e.valueExpression))))return t("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function I(e,t,r,n){const i=(0,h.d)(t),o="mode"===r?`cluster_type_${i}`:"sum"===r?`cluster_sum_${i}`:`cluster_avg_${i}`;return e.some((e=>e.name===o))||e.push(new p.A({name:o,isAutoGenerated:!0,onStatisticExpression:new m.A({expression:t,returnType:n}),statisticType:r})),o}function v(e,t,r,n,i){if("cluster_count"===t||e.some((e=>e.name===t)))return t;const o=function(e,t,r){switch(e){case"sum":return`cluster_sum_${t}`;case"avg":case"avg_angle":return`cluster_avg_${t}`;case"mode":return`cluster_type_${t}`;case"avg_norm":{const e=r,n="field",i=t.toLowerCase()+",norm:"+n+","+e.toLowerCase();return"cluster_avg_"+(0,h.d)(i)}}}(r,t,i);return e.some((e=>e.name===o))||("avg_norm"===r?e.push(new p.A({name:o,isAutoGenerated:!0,onStatisticExpression:new m.A({expression:`$feature.${t} / $feature.${i}`,returnType:n}),statisticType:"avg"})):e.push(new p.A({name:o,isAutoGenerated:!0,onStatisticField:t,statisticType:r}))),o}const E=e=>{let t=class extends e{constructor(...e){super(...e),this.addHandles((0,i.wB)((()=>this.renderer),(()=>{if(this.featureReduction){const e=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",e)}}),i.OH))}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}set renderer(e){}_withClusterVariable(e,t,r){const n=e.clone();return"visualVariables"in n&&(n.visualVariables||(n.visualVariables=[]),n.visualVariables.some((e=>"size"===e.type))||n.visualVariables.push(new d.A({field:"cluster_count",stops:[new y.A({value:1}),new y.A({useMinValue:!0,size:t}),new y.A({useMaxValue:!0,size:r})]}))),n}_normalizeFeatureReduction(e){if("cluster"!==e?.type)return e;const t=e.clone(),r=[new p.A({name:"cluster_count",alias:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(t.fields??[]).filter((e=>!e.isAutoGenerated)),i=e.renderer&&!e.renderer.authoringInfo?.isAutoGenerated,{clusterMinSize:o,clusterMaxSize:s}=t;if(i){t.fields=[...r,...n];const e=this._withClusterVariable(t.renderer,o,s);return t.effectiveFeatureRenderer=e,t.effectiveClusterRenderer=e,t}if(e.symbol){if(t.fields=[...r,...n],t.renderer=null,!this.renderer)return t.effectiveFeatureRenderer=null,t.effectiveClusterRenderer=null,t;const i=_(r,this.renderer),a=this._withClusterVariable(i,o,s),l="visualVariables"in a&&a.visualVariables?a.visualVariables:[],p=new c.A({symbol:e.symbol,visualVariables:l});return t.fields=[...r,...n],t.effectiveFeatureRenderer=a,t.effectiveClusterRenderer=p,t}if(!this.renderer)return e;const a=_(r,this.renderer);t.fields=[...r,...n],t.renderer=a;const l=this._withClusterVariable(a,o,s);return t.effectiveFeatureRenderer=l,t.effectiveClusterRenderer=l,t}};return(0,n._)([(0,o.MZ)(u.d)],t.prototype,"featureReduction",null),t=(0,n._)([(0,l.$)("esri.layers.mixins.FeatureReductionLayer")],t),t}},30111:(e,t,r)=>{r.d(t,{Rr:()=>l,fY:()=>u,ne:()=>p});var n=r(66866),i=r(76724),o=r(21564),s=(r(39831),r(539),r(9272),r(63863)),a=r(3243);function l(e,t,r){if(!e)return null;const n=e.find((e=>!!e.field));if(!n)return null;const i=new a.A;return i.read(n,r),[i]}const p={type:[a.A],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:l},write:{writer:function(e,t,r,n){const o=e.find((e=>!!e.field));o&&(0,i.sM)(r,[o.toJSON()],t)}}}},u=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return(0,n._)([(0,o.MZ)(p)],t.prototype,"orderBy",void 0),t=(0,n._)([(0,s.$)("esri.layers.mixins.OrderedLayer")],t),t}},94301:(e,t,r)=>{r.d(t,{A:()=>u});var n,i=r(66866),o=r(21877),s=r(19251),a=r(21564),l=(r(39831),r(539),r(63863)),p=r(54746);let u=class extends o.A{static{n=this}constructor(e){super(e),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new n({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:(0,s.o8)(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],u.prototype,"isAutoGenerated",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"name",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"alias",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"onStatisticField",void 0),(0,i._)([(0,a.MZ)({type:p.A,json:{write:!0}})],u.prototype,"onStatisticExpression",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"statisticType",void 0),u=n=(0,i._)([(0,l.$)("esri.layers.support.AggregateField")],u)},54746:(e,t,r)=>{r.d(t,{A:()=>l});var n=r(66866),i=r(24793),o=r(21877),s=r(21564),a=(r(39831),r(539),r(9272),r(63863));let l=class extends(i.A.ClonableMixin(o.A)){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],l.prototype,"expression",void 0),(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],l.prototype,"title",void 0),(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],l.prototype,"returnType",void 0),l=(0,n._)([(0,a.$)("esri.layers.support.ExpressionInfo")],l)},18475:(e,t,r)=>{r.d(t,{c:()=>a});var n=r(66866),i=r(21877),o=r(21564),s=(r(39831),r(539),r(9272),r(63863));let a=class extends i.A{constructor(){super(...arguments),this.type=null}};(0,n._)([(0,o.MZ)({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,n._)([(0,s.$)("esri.layers.support.FeatureReduction")],a)},99989:(e,t,r)=>{r.d(t,{A:()=>l});var n,i=r(66866),o=r(21564),s=(r(39831),r(539),r(9272),r(63863)),a=r(18475);let l=n=class extends a.c{constructor(e){super(e),this.type="selection"}clone(){return new n}};(0,i._)([(0,o.MZ)({type:["selection"]})],l.prototype,"type",void 0),l=n=(0,i._)([(0,s.$)("esri.layers.support.FeatureReductionSelection")],l)},92568:(e,t,r)=>{r.d(t,{d:()=>N});var n,i=r(73324),o=r(18475),s=r(66866),a=r(56542),l=r(19251),p=r(76724),u=r(89882),c=r(21564),d=r(73446),y=r(28902),f=r(75094),h=r(63863),m=r(77542),g=r(94301),b=r(76592),w=r(52506),M=r(61826),_=r(48887),T=r(53835);let I=n=class extends o.c{constructor(e){super(e),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=(0,u.cr)("12px"),this.fields=[],this.renderer=null}writeFields(e,t,r){const n=e.filter((e=>"avg_angle"!==e.statisticType)).map((e=>e.toJSON()));(0,p.sM)(r,n,t)}readRenderer(e,t,r){const n=t.drawingInfo?.renderer;return n?(0,_.L)(n,t,r)??void 0:(0,w.PD)(t,r)}clone(){return new n({fields:(0,l.o8)(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:(0,l.o8)(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:(0,l.o8)(this.popupTemplate),renderer:(0,l.o8)(this.renderer),binType:(0,l.o8)(this.binType),size:this.size})}};(0,s._)([(0,y.e)({binning:"binning"})],I.prototype,"type",void 0),(0,s._)([(0,y.e)({geohash:"geohash",square:"square"}),(0,c.MZ)({type:["geohash","square"]})],I.prototype,"binType",void 0),(0,s._)([(0,c.MZ)({type:Number,json:{write:!0}})],I.prototype,"fixedBinLevel",void 0),(0,s._)([(0,c.MZ)({type:[M.A],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],I.prototype,"labelingInfo",void 0),(0,s._)([(0,c.MZ)(b.kF)],I.prototype,"labelsVisible",void 0),(0,s._)([(0,c.MZ)({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],I.prototype,"maxScale",void 0),(0,s._)([(0,c.MZ)(b.M6)],I.prototype,"popupEnabled",void 0),(0,s._)([(0,c.MZ)({type:a.A,json:{name:"popupInfo",write:!0}})],I.prototype,"popupTemplate",void 0),(0,s._)([(0,c.MZ)({cast:e=>"auto"===e?e:(0,d.GB)((0,u.cr)(e))})],I.prototype,"size",void 0),(0,s._)([(0,c.MZ)({type:[g.A],json:{write:!0}})],I.prototype,"fields",void 0),(0,s._)([(0,m.K)("fields")],I.prototype,"writeFields",null),(0,s._)([(0,c.MZ)({types:T.Hg,json:{write:{target:"drawingInfo.renderer"}}})],I.prototype,"renderer",void 0),(0,s._)([(0,f.w)("renderer",["drawingInfo.renderer"])],I.prototype,"readRenderer",null),I=n=(0,s._)([(0,h.$)("esri.layers.support.FeatureReductionBinning")],I);var v,E=r(21877),A=r(47347),S=r(66961);function C(e){return"simple"===e.type&&!e.visualVariables?.length}let k=v=class extends E.A{constructor(e){super(e),this.type="cluster",this.clusterRadius=(0,u.cr)("80px"),this.clusterMinSize=(0,u.cr)("12px"),this.clusterMaxSize=(0,u.cr)("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(e,t,r){const n=t.drawingInfo?.renderer;return n?.authoringInfo?.isAutoGenerated?null:n?C(n)?null:(0,_.L)(n,t,r)??void 0:(0,w.PD)(t,r)}readSymbol(e,t,r){const n=t.drawingInfo?.renderer;if(n?.authoringInfo?.isAutoGenerated)return null;if(n&&C(n)){const e=(0,_.L)(n,t,r);return e?.symbol}return null}writeSymbol(e,t,r,n){const i=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||i){const r=new A.A({symbol:e});t.drawingInfo={renderer:r.write({},n)}}}writeFields(e,t,r){const n=e.filter((e=>"avg_angle"!==e.statisticType)).map((e=>e.toJSON()));(0,p.sM)(r,n,t)}readFields(e,t,r){return e.filter((e=>!e.isAutoGenerated)).map((e=>g.A.fromJSON(e)))}clone(){return new v({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:(0,l.o8)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:(0,l.o8)(this.fields),maxScale:this.maxScale,renderer:(0,l.o8)(this.renderer),symbol:(0,l.o8)(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:(0,l.o8)(this.popupTemplate)})}};(0,s._)([(0,c.MZ)({type:["cluster"],readOnly:!0,json:{write:!0}})],k.prototype,"type",void 0),(0,s._)([(0,c.MZ)({cast:e=>"auto"===e?e:(0,d.GB)((0,u.cr)(e)),json:{write:!0}})],k.prototype,"clusterRadius",void 0),(0,s._)([(0,c.MZ)({type:Number,cast:u.cr,json:{write:!0}})],k.prototype,"clusterMinSize",void 0),(0,s._)([(0,c.MZ)({type:Number,cast:u.cr,json:{write:!0}})],k.prototype,"clusterMaxSize",void 0),(0,s._)([(0,c.MZ)({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],k.prototype,"maxScale",void 0),(0,s._)([(0,c.MZ)(b.M6)],k.prototype,"popupEnabled",void 0),(0,s._)([(0,c.MZ)({type:a.A,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],k.prototype,"popupTemplate",void 0),(0,s._)([(0,c.MZ)({types:T.Hg,json:{write:{target:"drawingInfo.renderer"}}})],k.prototype,"renderer",void 0),(0,s._)([(0,f.w)("renderer",["drawingInfo.renderer"])],k.prototype,"readRenderer",null),(0,s._)([(0,c.MZ)({types:S.q8})],k.prototype,"symbol",void 0),(0,s._)([(0,f.w)("symbol",["drawingInfo.renderer"])],k.prototype,"readSymbol",null),(0,s._)([(0,m.K)("symbol")],k.prototype,"writeSymbol",null),(0,s._)([(0,c.MZ)({type:[M.A],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],k.prototype,"labelingInfo",void 0),(0,s._)([(0,c.MZ)(b.kF)],k.prototype,"labelsVisible",void 0),(0,s._)([(0,c.MZ)({type:[g.A],json:{write:!0}})],k.prototype,"fields",void 0),(0,s._)([(0,m.K)("fields")],k.prototype,"writeFields",null),(0,s._)([(0,f.w)("fields")],k.prototype,"readFields",null),k=v=(0,s._)([(0,h.$)("esri.layers.support.FeatureReductionCluster")],k);var x=r(99989);const L={key:"type",base:o.c,typeMap:{cluster:k,binning:I}},N={types:{key:"type",base:o.c,typeMap:{selection:x.A,cluster:k,binning:I}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:L},"portal-item":{types:L},"web-scene":{types:{key:"type",base:o.c,typeMap:{selection:x.A}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:i.K}}}}}},77567:(e,t,r)=>{r.d(t,{p:()=>l});var n=r(39831),i=r(539),o=r(24738),s=r(79005),a=r(42453);function l(){return{fields:{type:[o.A],value:null,set:function(e){if(e&&(0,n.A)("big-integer-warning-enabled")){const t=e.filter((e=>"big-integer"===e.type||"oid"===e.type&&(e.length||0)>=8));if(t.length){const e=t.map((e=>`'${e.name}'`)).join(", ");i.A.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${e}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",e)}},fieldsIndex:{readOnly:!0,get(){return s.A.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e?.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e){const r=this.fieldsIndex?.has(t);r||i.A.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e})}return(0,a.DB)(this.fieldsIndex,e)}}}}},33327:(e,t,r)=>{r.d(t,{$C:()=>g,Hh:()=>s,J:()=>p,JT:()=>l,Tu:()=>h,Wg:()=>m,Xq:()=>w,i6:()=>M,pM:()=>f,tx:()=>a,vJ:()=>b});var n=r(99050);let i,o=null;function s(){return i||(i=r.e(49239).then(r.bind(r,49239)).then((e=>e.l)).then((({default:e})=>e({locateFile:e=>(0,n.s)(`esri/libs/linkchartlayout/${e}`)}))).then((e=>{!function(e){o=e}(e)})),i)}var a,l,p,u;!function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot",e[e.IsOld=8]="IsOld"}(a||(a={})),function(e){e[e.Success=0]="Success",e[e.Error=1]="Error",e[e.Canceled=2]="Canceled"}(l||(l={})),function(e){e[e.Regular=0]="Regular",e[e.Curved=1]="Curved",e[e.Recursive=2]="Recursive"}(p||(p={})),function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom"}(u||(u={}));const c={none:0,"start-only":1,"start-and-end":2};function d(e){const t={timeDirection:"right",timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:"start-and-end",showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0,...e?.toJSON()??{},eventsTicksVisualization:e?.eventsTicksVisualization??"start-and-end"};return{...t,timeDirection:{value:u[t.timeDirection]??u.right},eventsTicksVisualization:{value:c[t.eventsTicksVisualization]??c["start-and-end"]}}}function y(e,t,r,n,i,s){const a=r.length,p=i.length,u=Float64Array.BYTES_PER_ELEMENT,c=Uint32Array.BYTES_PER_ELEMENT,d=Uint8Array.BYTES_PER_ELEMENT,y=16+a*(d+2*u)+p*(2*c),f=o._malloc(y);try{const d=f+16-f%16,y=d+a*u,h=y+a*u,m=h+p*c,g=m+p*c,b=()=>[o.HEAPF64.subarray(d>>3,(d>>3)+a),o.HEAPF64.subarray(y>>3,(y>>3)+a),o.HEAPU32.subarray(h>>2,(h>>2)+p),o.HEAPU32.subarray(m>>2,(m>>2)+p),o.HEAPU8.subarray(g,g+a)],[w,M,_,T,I]=b();w.set(r),M.set(n),_.set(i),T.set(s),I.set(t);const v=e(a,g,d,y,p,h,m);let E=null,A=null;if(v.value===l.Success){const e=o.getLayoutLinksTypes(),t=o.getLayoutLinksVerticesEndIndices(),r=o.getLayoutLinksVertices(),n=o.countLayoutLinksVertices();!p||e&&t?n&&!r?v.value=l.Error:(E={types:new Uint8Array(o.HEAPU8.subarray(e,e+p)),vertexEndIndex:new Uint32Array(o.HEAPU32.subarray(t>>2,(t>>2)+p)),vertices:new Float64Array(o.HEAPF64.subarray(r>>3,(r>>3)+2*n))},A=o.getAuxiliaryGraphicElements()):v.value=l.Error}const[S,C,k,x,L]=b();return r.set(S),n.set(C),i.set(k),s.set(x),t.set(L),{status:v.value,links:E,graphics:A}}finally{o._free(f),o.cleanupLayout()}}var f,h,m,g,b,w,M,_,T;!function(e){e.getMinIdealEdgeLength=function(){return o.getMinIdealEdgeLength()},e.apply=function(e,t,r,n,i,s,a=2,l=1,p=-1){return y(((t,r,n,i,s,u,c)=>o.applyForceDirectedLayout(e,t,r,n,i,s,u,c,a,l,p)),t,r,n,i,s)}}(f||(f={})),function(e){e.apply=function(e,t,r,n,i,s,a=2,l=1,p=-1){return y(((t,r,n,i,s,u,c)=>o.applyCommunityLayout(e,t,r,n,i,s,u,c,a,l,p)),t,r,n,i,s)}}(h||(h={})),function(e){e.apply=function(e,t,r,n,i,s){return y(((t,r,n,i,s,a,l)=>o.applySimpleLayout(e,t,r,n,i,s,a,l)),t,r,n,i,s)}}(m||(m={})),function(e){e.apply=function(e,t,r,n,i,s){return y(((t,r,n,i,s,a,l)=>o.applyHierarchicalLayout(e,t,r,n,i,s,a,l)),t,r,n,i,s)}}(g||(g={})),function(e){e.apply=function(e,t,r,n,i,s){return y(((t,r,n,i,s,a,l)=>o.applyRadialTreeLayout(e,t,r,n,i,s,a,l)),t,r,n,i,s)}}(b||(b={})),function(e){e.apply=function(e,t,r,n,i,s){return y(((t,r,n,i,s,a,l)=>o.applySmartTreeLayout(e,t,r,n,i,s,a,l)),t,r,n,i,s)}}(w||(w={})),function(e){e.apply=function(e,t,r,n,i,s,a,p,u,c,f,h){return y(((t,r,n,a,p,y,m)=>{if(i.length!==t)return{value:l.Error};if(s.length!==t)return{value:l.Error};if(u.length!==p)return{value:l.Error};if(c.length!==p)return{value:l.Error};const g=Float64Array.BYTES_PER_ELEMENT,b=16,w=o._malloc(b+t*g),M=o._malloc(b+t*g),_=o._malloc(b+p*g),T=o._malloc(b+p*g),I=w+b-w%b,v=M+b-M%b,E=_+b-_%b,A=T+b-T%b;try{return o.HEAPF64.subarray(I>>3,(I>>3)+t).set(i),o.HEAPF64.subarray(v>>3,(v>>3)+t).set(s),o.HEAPF64.subarray(E>>3,(E>>3)+p).set(u),o.HEAPF64.subarray(A>>3,(A>>3)+p).set(c),o.applyChronologicalLayout(e,t,r,n,a,I,v,p,y,m,E,A,f,d(h))}finally{o._free(w),o._free(M),o._free(_),o._free(T)}}),t,r,n,a,p)}}(M||(M={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(_||(_={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(T||(T={}))},61700:(e,t,r)=>{r.d(t,{A:()=>l});var n=r(66866),i=r(21564),o=(r(39831),r(539),r(9272),r(63863)),s=r(97066),a=r(68989);let l=class extends a.A{constructor(e){super(e),this.layoutGeometry=null}};(0,n._)([(0,i.MZ)({type:s.A,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,n._)([(0,o.$)("esri.rest.knowledgeGraph.Entity")],l)},68989:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(66866),i=r(21564),o=(r(39831),r(539),r(9272),r(63863)),s=r(10444);let a=class extends s.A{constructor(e){super(e),this.typeName=null,this.id=null}};(0,n._)([(0,i.MZ)({type:String,json:{write:!0}})],a.prototype,"typeName",void 0),(0,n._)([(0,i.MZ)({type:String,json:{write:!0}})],a.prototype,"id",void 0),a=(0,n._)([(0,o.$)("esri.rest.knowledgeGraph.GraphNamedObject")],a)},10444:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(66866),i=r(21877),o=r(21564),s=(r(39831),r(539),r(9272),r(63863));let a=class extends i.A{constructor(e){super(e),this.properties=null}};(0,n._)([(0,o.MZ)({json:{write:!0}})],a.prototype,"properties",void 0),a=(0,n._)([(0,s.$)("esri.rest.knowledgeGraph.GraphObject")],a)},82388:(e,t,r)=>{r.d(t,{A:()=>p});var n=r(66866),i=r(21564),o=(r(39831),r(539),r(9272),r(63863)),s=r(78983),a=r(52495);let l=class extends a.A{constructor(e){super(e),this.openCypherQuery=""}};(0,n._)([(0,i.MZ)()],l.prototype,"openCypherQuery",void 0),l=(0,n._)([(0,o.$)("esri.rest.knowledgeGraph.GraphQuery")],l);let p=class extends l{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};(0,n._)([(0,i.MZ)()],p.prototype,"bindParameters",void 0),(0,n._)([(0,i.MZ)()],p.prototype,"bindGeometryQuantizationParameters",void 0),(0,n._)([(0,i.MZ)()],p.prototype,"outputQuantizationParameters",void 0),(0,n._)([(0,i.MZ)({type:s.A})],p.prototype,"outputSpatialReference",void 0),(0,n._)([(0,i.MZ)()],p.prototype,"provenanceBehavior",void 0),p=(0,n._)([(0,o.$)("esri.rest.knowledgeGraph.GraphQueryStreaming")],p)},59351:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(66866),i=(r(539),r(39831),r(9272),r(98849),r(63863)),o=r(10444);let s=class extends o.A{constructor(e){super(e)}};s=(0,n._)([(0,i.$)("esri.rest.knowledgeGraph.ObjectValue")],s)},96408:(e,t,r)=>{r.d(t,{A:()=>l});var n=r(66866),i=r(21877),o=r(21564),s=(r(39831),r(539),r(9272),r(63863)),a=r(10444);let l=class extends i.A{constructor(e){super(e),this.path=[]}};(0,n._)([(0,o.MZ)({type:[a.A],json:{write:!0}})],l.prototype,"path",void 0),l=(0,n._)([(0,s.$)("esri.rest.knowledgeGraph.Path")],l)},53181:(e,t,r)=>{r.d(t,{A:()=>l});var n=r(66866),i=r(21564),o=(r(39831),r(539),r(9272),r(63863)),s=r(42238),a=r(68989);let l=class extends a.A{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,n._)([(0,i.MZ)({type:String,json:{write:!0}})],l.prototype,"originId",void 0),(0,n._)([(0,i.MZ)({type:String,json:{write:!0}})],l.prototype,"destinationId",void 0),(0,n._)([(0,i.MZ)({type:s.A,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,n._)([(0,o.$)("esri.rest.knowledgeGraph.Relationship")],l)},77573:(e,t,r)=>{r.d(t,{Fe:()=>y,KU:()=>g,Km:()=>o,Nk:()=>l});var n=r(96220),i=r(50072);function o(e,t,r,n){if(e)if("CIMTextSymbol"!==e.type){if(r&&e.effects)for(const r of e.effects)a(r,t);if(e.symbolLayers)for(const r of e.symbolLayers){switch(r.type){case"CIMPictureMarker":case"CIMVectorMarker":s(r,t,n);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!n?.preserveOutlineWidth&&r.width&&(r.width*=t);break;case"CIMPictureFill":r.height&&(r.height*=t),r.offsetX&&(r.offsetX*=t),r.offsetY&&(r.offsetY*=t);break;case"CIMHatchFill":o(r.lineSymbol,t,!0,{...n,preserveOutlineWidth:!1}),r.offsetX&&(r.offsetX*=t),r.offsetY&&(r.offsetY*=t),r.separation&&(r.separation*=t)}if(r.effects)for(const e of r.effects)a(e,t)}}else null!=e.height&&(e.height*=t)}function s(e,t,r){if(e&&(e.markerPlacement&&function(e,t){switch((0,i.zr)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map((e=>e*t));e.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map((e=>e*t));e.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const n of e.markerGraphics)e.scaleSymbolsProportionally||o(n.symbol,t,!0,r)}function a(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const r=e.dashTemplate.map((e=>e*t));e.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function l(e){const t=[];return p((0,i.lW)(e),t),t.length?new n.A((0,i.e6)(t[0])):null}function p(e,t){if(!e)return;let r;r="CIMTextSymbol"===e.type?e.symbol:e;const n="CIMPolygonSymbol"===e.type;if(r?.symbolLayers)for(const o of r.symbolLayers)if(!(o.colorLocked||n&&((0,i.mA)(o)||(0,i.MM)(o)&&o.markerPlacement&&(0,i.zr)(o.markerPlacement))))switch(o.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":o.tintColor&&u(t,o.tintColor);break;case"CIMVectorMarker":o.markerGraphics?.forEach((e=>{p(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":u(t,o.color);break;case"CIMGradientFill":c(t,o);break;case"CIMHatchFill":p(o.lineSymbol,t)}}function u(e,t){for(const r of e)if(r.join(".")===t.join("."))return;e.push(t)}function c(e,t){const r=t.colorRamp?.type;switch(r){case"CIMMultipartColorRamp":t.colorRamp.colorRamps?.forEach((t=>{"CIMLinearContinuousColorRamp"===t.type&&d(e,t)}));break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":d(e,t.colorRamp)}}function d(e,t){t&&(t.fromColor&&u(e,t.fromColor),t.toColor&&u(e,t.toColor))}function y(e,t,r){t instanceof n.A||(t=new n.A(t));const o=(0,i.lW)(e);o&&f(o,t,r)}function f(e,t,r){if(!e)return;let n;n="CIMTextSymbol"===e.type?e.symbol:e;const o="CIMPolygonSymbol"===n?.type;if(n?.symbolLayers)for(const s of n.symbolLayers){if(s.colorLocked)continue;if(o)if(r){const{layersToColor:e}=r;if(((0,i.mA)(s)||(0,i.MM)(s)&&s.markerPlacement&&(0,i.zr)(s.markerPlacement))&&"fill"===e||(0,i.jn)(s)&&"outline"===e)continue}else if((0,i.mA)(s)||(0,i.MM)(s)&&s.markerPlacement&&(0,i.zr)(s.markerPlacement))continue;const e=t.toArray();switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor=e;break;case"CIMVectorMarker":s.markerGraphics?.forEach((e=>{f(e.symbol,t,r)}));break;case"CIMSolidStroke":case"CIMSolidFill":s.color=e;break;case"CIMGradientFill":h(s,t);break;case"CIMHatchFill":f(s.lineSymbol,t,r)}}}function h(e,t){const r=e.colorRamp?.type;switch(r){case"CIMMultipartColorRamp":e.colorRamp.colorRamps?.forEach((e=>{"CIMLinearContinuousColorRamp"===e.type&&m(e,t)}));break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":m(e.colorRamp,t)}}function m(e,t){if(e&&(e.fromColor&&(e.fromColor=t.toArray()),e.toColor)){const r=t.clone();r.a=0,e.toColor=r.toArray()}}function g(e,t,r=!1){const n=(0,i.lW)(e);if(r&&(t=360-t),"CIMTextSymbol"!==n?.type){if("CIMPointSymbol"===n?.type&&n.symbolLayers){const e=t-(n.angle||0);for(const t of n.symbolLayers)if((0,i.MM)(t)){let r=t.rotation||0;t.rotateClockwise?r-=e:r+=e,t.rotation=r}n.angle=t}}else n.angle=t}},41977:(e,t,r)=>{r.d(t,{$4:()=>w,O0:()=>M,O1:()=>_,Sw:()=>T,eH:()=>g,rc:()=>b});var n=r(99050),i=r(96220),o=r(86394),s=r(89926),a=r(89882),l=r(77573);const p="picture-fill",u="simple-fill",c="simple-line",d="simple-marker",y="text",f="cim",h=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),m=new s.q(1e3);function g(e){const t=e.style;let r=null;if(e)switch(e.type){case d:"cross"!==t&&"x"!==t&&(r=e.color);break;case u:t&&"solid"!==t?"none"!==t&&(r={type:"pattern",x:0,y:0,src:(0,n.s)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):r=e.color;break;case p:r={type:"pattern",src:e.url,width:(0,a.Lz)(e.width)*e.xscale,height:(0,a.Lz)(e.height)*e.yscale,x:(0,a.Lz)(e.xoffset),y:(0,a.Lz)(e.yoffset)};break;case y:r=e.color;break;case f:r=(0,l.Nk)(e)}return r}function b(e,t){const r=e+"-"+t;return void 0!==m.get(r)?Promise.resolve(m.get(r)):(0,o.A)(e,{responseType:"image"}).then((e=>{const n=e.data,i=n.naturalWidth,o=n.naturalHeight,s=document.createElement("canvas");s.width=i,s.height=o;const a=s.getContext("2d");a.fillStyle=t,a.fillRect(0,0,i,o),a.globalCompositeOperation="destination-in",a.drawImage(n,0,0);const l=s.toDataURL();return m.put(r,l),l}))}function w(e){if(!e)return null;let t=null;switch(e.type){case u:case p:case d:t=w(e.outline);break;case c:{const r=(0,a.Lz)(e.width);null!=e.style&&"none"!==e.style&&0!==r&&(t={color:e.color,style:_(e.style),width:r,cap:e.cap,join:"miter"===e.join?(0,a.Lz)(e.miterLimit):e.join},t.dashArray=M(t).join(",")||"none");break}default:t=null}return t}function M(e){if(!e?.style)return[];const{dashArray:t,style:r,width:n}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map((e=>Number(e)));const i=n??0,o=h.has(r)?h.get(r).map((e=>e*i)):[];if("butt"!==e.cap)for(const[s,a]of o.entries())o[s]=s%2==1?a+i:Math.max(a-i,1);return o}const _=(()=>{const e={};return t=>{if(e[t])return e[t];const r=t.replaceAll("-","");return e[t]=r,r}})(),T=new i.A([128,128,128])},55056:(e,t,r)=>{r.d(t,{$d:()=>f,GG:()=>v,N7:()=>h,Sx:()=>m,UQ:()=>I,di:()=>E,dt:()=>b,f3:()=>A,k_:()=>y});var n=r(96220),i=r(12690),o=(r(39831),r(89882)),s=r(58359),a=r(27664),l=r(77573),p=r(41977),u=r(5159),c=r(66961);const d=new n.A("white");function y(e){if(!e)return 0;if((0,c.wk)(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,o.PN)((0,p.$4)(e)?.width)}function f(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function h(e){return e.resource?.href??""}function m(e,t){if(!e)return null;let r=null;return(0,c.wk)(e)?r=function(e){const t=e.symbolLayers;if(!t)return null;let r=null;return t.forEach((e=>{"object"===e.type&&e.resource?.href||(r="water"===e.type?e.color:e.material?e.material.color:null)})),r?new n.A(r):null}(e):(0,c.$y)(e)&&(r="cim"===e.type?(0,l.Nk)(e):e.color?new n.A(e.color):null),r?g(r,t):null}function g(e,t){if(null==t||null==e)return e;const r=e.toRgba();return r[3]=r[3]*t,new n.A(r)}function b(e,t,r){e&&(t||null!=r)&&(t&&(t=new n.A(t)),(0,c.wk)(e)?function(e,t,r){const n=e.symbolLayers;if(!n)return;const i=e=>g(t??e??(null!=r?d:null),r);n.forEach((e=>{if("object"!==e.type||!e.resource?.href||t)if("water"===e.type)e.color=i(e.color);else{const t=null!=e.material?e.material.color:null,n=i(t);if(null==e.material?e.material=new u.N({color:n}):e.material.color=n,null!=r&&"outline"in e&&null!=e.outline?.color&&(e.outline.color=g(e.outline.color,r)),"marker"in e&&null!=e.marker){const t=i(e.marker.color);e.marker.color=t}}}))}(e,t,r):(0,c.$y)(e)&&function(e,t,r){(t=t??e.color)&&(e.color=g(t,r)),null!=r&&"outline"in e&&e.outline?.color&&(e.outline.color=g(e.outline.color,r))}(e,t,r))}async function w(e,t){const n=e.symbolLayers;n&&await(0,i.jJ)(n,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){const r=t[2];"number"==typeof r&&(e.size=r)}(e,t);break;case"icon":case"line":case"text":!function(e,t){const r=M(t);null!=r&&(e.size=r)}(e,t);break;case"path":!function(e,t){const r=_(t,s.Un,[e.width,void 0,e.height]);null!=r&&(e.width=T(t[0],e.width,1,r),e.height=T(t[2],e.height,1,r))}(e,t);break;case"object":await async function(e,t){const{resourceSize:n,symbolSize:i}=await async function(e){const{computeObjectLayerResourceSize:t}=await r.e(63867).then(r.bind(r,63867)),n=await t(e,10),{width:i,height:o,depth:s}=e,a=[i,s,o];let l=1;for(let r=0;r<3;r++){const e=a[r];if(null!=e){l=e/n[r];break}}for(let r=0;r<3;r++)null==a[r]&&(a[r]=n[r]*l);return{resourceSize:n,symbolSize:a}}(e),o=_(t,n,i);null!=o&&(e.width=T(t[0],i[0],n[0],o),e.depth=T(t[1],i[1],n[1],o),e.height=T(t[2],i[2],n[2],o))}(e,t)}}(e,t)))}function M(e){for(const t of e)if("number"==typeof t)return t;return null}function _(e,t,r){for(let n=0;n<3;n++){const i=e[n];switch(i){case"symbol-value":{const e=r[n];return null!=e?e/t[n]:1}case"proportional":break;default:if(i&&t[n])return i/t[n]}}return null}function T(e,t,r,n){switch(e){case"proportional":return r*n;case"symbol-value":return null!=t?t:r;default:return e}}async function I(e,t){if(e&&t)return(0,c.wk)(e)?w(e,t):void((0,c.$y)(e)&&function(e,t){const r=M(t);if(null!=r)switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=r,e.height=r*t):(e.width=r*t,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}(e,t))}function v(e,t,r){if(e&&null!=t)if((0,c.wk)(e)){const n=e.symbolLayers;n&&n.forEach((e=>{if("object"===e.type)switch(r){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}"icon"===e.type&&(e.angle+=t)}))}else(0,c.$y)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function E(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,a.zu)(t)}function A(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}}}]);