"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[14822],{79207:(t,e,n)=>{function i(t,e,n,i,o){r(t,e,n||0,i||t.length-1,o||s)}function r(t,e,n,i,s){for(;i>n;){if(i-n>600){var a=i-n+1,l=e-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);r(t,e,Math.max(n,Math.floor(e-l*u/a+h)),Math.min(i,Math.floor(e+(a-l)*u/a+h)),s)}var d=t[e],p=n,f=i;for(o(t,n,e),s(t[i],d)>0&&o(t,n,i);p<f;){for(o(t,p,f),p++,f--;s(t[p],d)<0;)p++;for(;s(t[f],d)>0;)f--}0===s(t[n],d)?o(t,n,f):o(t,++f,i),f<=e&&(n=f+1),e<=f&&(i=f-1)}}function o(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function s(t,e){return t<e?-1:t>e?1:0}n.d(e,{q:()=>i})},80347:(t,e,n)=>{n.d(e,{A:()=>f,B:()=>p,C:()=>u,D:()=>h,E:()=>L,F:()=>X,H:()=>q,a:()=>Z,b:()=>_,c:()=>s,d:()=>c,e:()=>P,f:()=>l,g:()=>y,h:()=>A,i:()=>a,j:()=>g,k:()=>M,l:()=>o,m:()=>I,n:()=>w,o:()=>S,q:()=>E,r:()=>b,s:()=>x,t:()=>R,u:()=>v,v:()=>O,w:()=>d,x:()=>Y,y:()=>z,z:()=>m});var i=n(19913),r=n(78115);function o(t){const e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function l(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function c(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function u(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function h(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function d(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function p(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function f(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function m(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function y(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function _(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t}function g(t,e){const n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+i*i+r*r)}function x(t,e){const n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r}function M(t){const e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function v(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function b(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function w(t,e){const n=e[0],i=e[1],r=e[2];let o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function P(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function A(t,e,n){const i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],l=n[2];return t[0]=r*l-o*a,t[1]=o*s-i*l,t[2]=i*a-r*s,t}function I(t,e,n,i){const r=e[0],o=e[1],s=e[2];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t[2]=s+i*(n[2]-s),t}function R(t,e,n){const i=e[0],r=e[1],o=e[2];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12],t[1]=n[1]*i+n[5]*r+n[9]*o+n[13],t[2]=n[2]*i+n[6]*r+n[10]*o+n[14],t}function S(t,e,n){const i=e[0],r=e[1],o=e[2];return t[0]=i*n[0]+r*n[3]+o*n[6],t[1]=i*n[1]+r*n[4]+o*n[7],t[2]=i*n[2]+r*n[5]+o*n[8],t}function O(t,e,n){const i=n[0],r=n[1],o=n[2],s=n[3],a=e[0],l=e[1],c=e[2],u=r*c-o*l,h=o*a-i*c,d=i*l-r*a,p=r*d-o*h,f=o*u-i*d,m=i*h-r*u,y=2*s;return t[0]=a+u*y+2*p,t[1]=l+h*y+2*f,t[2]=c+d*y+2*m,t}const B=(0,i.vt)(),T=(0,i.vt)();function E(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function L(t,e,n){const i=n[0]-e[0],r=n[1]-e[1],o=n[2]-e[2];let s=i*i+r*r+o*o;return s>0?(s=1/Math.sqrt(s),t[0]=i*s,t[1]=r*s,t[2]=o*s,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Z=c,j=u,C=h,X=g,Y=x,q=o,z=M;Object.freeze(Object.defineProperty({__proto__:null,abs:d,add:l,angle:function(t,e){w(B,t),w(T,e);const n=P(B,T);return n>1?0:n<-1?Math.PI:Math.acos(n)},bezier:function(t,e,n,i,r,o){const s=1-o,a=s*s,l=o*o,c=a*s,u=3*o*a,h=3*l*s,d=l*o;return t[0]=e[0]*c+n[0]*u+i[0]*h+r[0]*d,t[1]=e[1]*c+n[1]*u+i[1]*h+r[1]*d,t[2]=e[2]*c+n[2]*u+i[2]*h+r[2]*d,t},ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},clamp:function(t,e=0,n=1){return t[0]=Math.min(Math.max(t[0],e),n),t[1]=Math.min(Math.max(t[1],e),n),t[2]=Math.min(Math.max(t[2],e),n),t},copy:s,cross:A,crossAndNormalize:function(t,e,n){const i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],l=n[2],c=r*l-o*a,u=o*s-i*l,h=i*a-r*s,d=Math.sqrt(c*c+u*u+h*h);return t[0]=c/d,t[1]=u/d,t[2]=h/d,t},direction:L,dist:X,distance:g,div:C,divide:h,dot:P,equals:function(t,e){if(t===e)return!0;const n=t[0],i=t[1],o=t[2],s=e[0],a=e[1],l=e[2],c=(0,r.FD)();return Math.abs(n-s)<=c*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=c*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-l)<=c*Math.max(1,Math.abs(o),Math.abs(l))},exactEquals:E,floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},hermite:function(t,e,n,i,r,o){const s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),u=s*(3-2*o);return t[0]=e[0]*a+n[0]*l+i[0]*c+r[0]*u,t[1]=e[1]*a+n[1]*l+i[1]*c+r[1]*u,t[2]=e[2]*a+n[2]*l+i[2]*c+r[2]*u,t},inverse:b,len:q,length:o,lerp:I,max:m,min:f,mul:j,multiply:u,negate:v,normalize:w,random:function(t,e=1){const n=r.Ov,i=2*n()*Math.PI,o=2*n()-1,s=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(i)*s,t[1]=Math.sin(i)*s,t[2]=o*e,t},rotateX:function(t,e,n,i){const r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},rotateY:function(t,e,n,i){const r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},rotateZ:function(t,e,n,i){const r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:y,scaleAndAdd:_,set:a,sign:p,sqrDist:Y,sqrLen:z,squaredDistance:x,squaredLength:M,str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},sub:Z,subtract:c,transformMat3:S,transformMat4:R,transformQuat:O},Symbol.toStringTag,{value:"Module"}))},73027:(t,e,n)=>{n.d(e,{M5:()=>d,eV:()=>u});var i=n(38116),r=n(62991),o=n(49175),s=n(19759),a=n(98593);let l=null,c=!0;function u(t,e,n,i){if(!e||!n)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(t,e,n)}catch(l){c=!1}const r=h(e,n,i);return r.data.set(t,0),r}function h(t,e,n){return n||(l||(l=document.createElement("canvas"),l.width=1,l.height=1),n=l),n.getContext("2d").createImageData(t,e)}async function d(t,e){const{arrayBuffer:l,mediaType:u}=await async function(t,e){const n=(0,s.r$)(t);if(n?.isBase64)return{arrayBuffer:(0,a.M)(n.data),mediaType:n.mediaType};const r=await(0,i.A)(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:r.getHeader?.("Content-Type")??""}}(t,e),h="image/png"===u;if("image/gif"===u){const{isAnimatedGIF:t,parseGif:i}=await n.e(4989).then(n.bind(n,4989));if(t(l))return i(l,e)}if(h){const{isAnimatedPNG:t,parseApng:i}=await n.e(23034).then(n.bind(n,23034));if(t(l))return i(l,e)}return async function(t,e){const n=window.URL.createObjectURL(t);try{const{data:t}=await(0,i.A)(n,{...e,responseType:"image"});return t}catch(c){if(!(0,o.zf)(c))throw new r.A("invalid-image",`Could not fetch requested image at ${n}`);throw c}finally{window.URL.revokeObjectURL(n)}}(new Blob([l],{type:u}),e)}},79441:(t,e,n)=>{function i(){return[1,0,0,0,1,0,0,0,1]}function r(t,e,n,i,r,o,s,a,l){return[t,e,n,i,r,o,s,a,l]}n.d(e,{fA:()=>r,vt:()=>i,zK:()=>o});const o=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},create:i,fromValues:r},Symbol.toStringTag,{value:"Module"}))},56560:(t,e,n)=>{function i(){return[0,0]}function r(t,e){return[t,e]}function o(){return[0,0]}function s(){return r(1,1)}function a(){return r(1,0)}function l(){return r(0,1)}n.d(e,{Un:()=>u,fA:()=>r,vt:()=>i});const c=[0,0],u=s(),h=a(),d=l();Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:h,UNIT_Y:d,ZEROS:c,clone:function(t){return[t[0],t[1]]},create:i,freeze:function(t,e){return[t,e]},fromArray:function(t,e=[0,0]){const n=Math.min(2,t.length);for(let i=0;i<n;++i)e[i]=t[i];return e},fromValues:r,ones:s,unitX:a,unitY:l,zeros:o},Symbol.toStringTag,{value:"Module"}))},82541:(t,e,n)=>{n.d(e,{B8:()=>a,Ge:()=>d,I0:()=>h,KC:()=>l,hZ:()=>o,hs:()=>u,lw:()=>c,mg:()=>s,z0:()=>r});var i=n(78115);function r(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function o(t,e,n,i,r,o,s,a,l,c){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=c,t}function s(t,e){if(t===e){const n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function a(t,e){const n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*s-a*c,d=-u*o+a*l,p=c*o-s*l;let f=n*h+i*d+r*p;return f?(f=1/f,t[0]=h*f,t[1]=(-u*i+r*c)*f,t[2]=(a*i-r*s)*f,t[3]=d*f,t[4]=(u*n-r*l)*f,t[5]=(-a*n+r*o)*f,t[6]=p*f,t[7]=(-c*n+i*l)*f,t[8]=(s*n-i*o)*f,t):null}function l(t,e){const n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=s*u-a*c,t[1]=r*c-i*u,t[2]=i*a-r*s,t[3]=a*l-o*u,t[4]=n*u-r*l,t[5]=r*o-n*a,t[6]=o*c-s*l,t[7]=i*l-n*c,t[8]=n*s-i*o,t}function c(t,e,n){const i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=n[0],p=n[1],f=n[2],m=n[3],y=n[4],_=n[5],g=n[6],x=n[7],M=n[8];return t[0]=d*i+p*s+f*c,t[1]=d*r+p*a+f*u,t[2]=d*o+p*l+f*h,t[3]=m*i+y*s+_*c,t[4]=m*r+y*a+_*u,t[5]=m*o+y*l+_*h,t[6]=g*i+x*s+M*c,t[7]=g*r+x*a+M*u,t[8]=g*o+x*l+M*h,t}function u(t,e,n){const i=n[0],r=n[1],o=n[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=o*e[6],t[7]=o*e[7],t[8]=o*e[8],t}function h(t,e){const n=e[0],i=e[1],r=e[2],o=e[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,p=r*a,f=r*l,m=o*s,y=o*a,_=o*l;return t[0]=1-h-f,t[3]=u-_,t[6]=d+y,t[1]=u+_,t[4]=1-c-f,t[7]=p-m,t[2]=d-y,t[5]=p+m,t[8]=1-c-h,t}function d(t,e){const n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],y=e[14],_=e[15],g=n*a-i*s,x=n*l-r*s,M=n*c-o*s,v=i*l-r*a,b=i*c-o*a,w=r*c-o*l,P=u*m-h*f,A=u*y-d*f,I=u*_-p*f,R=h*y-d*m,S=h*_-p*m,O=d*_-p*y;let B=g*O-x*S+M*R+v*I-b*A+w*P;return B?(B=1/B,t[0]=(a*O-l*S+c*R)*B,t[1]=(l*I-s*O-c*A)*B,t[2]=(s*S-a*I+c*P)*B,t[3]=(r*S-i*O-o*R)*B,t[4]=(n*O-r*I+o*A)*B,t[5]=(i*I-n*S-o*P)*B,t[6]=(m*w-y*b+_*v)*B,t[7]=(y*M-f*w-_*x)*B,t[8]=(f*b-m*M+_*g)*B,t):null}function p(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}const f=c,m=p;Object.freeze(Object.defineProperty({__proto__:null,add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},adjoint:l,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},determinant:function(t){const e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],s=t[5],a=t[6],l=t[7],c=t[8];return e*(c*o-s*l)+n*(-c*r+s*a)+i*(l*r-o*a)},equals:function(t,e){const n=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=e[0],p=e[1],f=e[2],m=e[3],y=e[4],_=e[5],g=e[6],x=e[7],M=e[8],v=(0,i.FD)();return Math.abs(n-d)<=v*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-p)<=v*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(o-f)<=v*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-m)<=v*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-y)<=v*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(l-_)<=v*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-g)<=v*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(u-x)<=v*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(h-M)<=v*Math.max(1,Math.abs(h),Math.abs(M))},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},frob:function(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)},fromMat2d:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},fromMat4:r,fromQuat:h,fromRotation:function(t,e){const n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},invert:a,isOrthoNormal:function(t){const e=(0,i.FD)(),n=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8];return Math.abs(1-(n*n+s*s+c*c))<=e&&Math.abs(1-(r*r+a*a+u*u))<=e&&Math.abs(1-(o*o+l*l+h*h))<=e},mul:f,multiply:c,multiplyScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},multiplyScalarAndAdd:function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t},normalFromMat4:d,normalFromMat4Legacy:function(t,e){const n=e[0],i=e[1],r=e[2],o=e[4],s=e[5],a=e[6],l=e[8],c=e[9],u=e[10],h=u*s-a*c,d=-u*o+a*l,p=c*o-s*l,f=n*h+i*d+r*p;if(!f)return null;const m=1/f;return t[0]=h*m,t[1]=(-u*i+r*c)*m,t[2]=(a*i-r*s)*m,t[3]=d*m,t[4]=(u*n-r*l)*m,t[5]=(-a*n+r*o)*m,t[6]=p*m,t[7]=(-c*n+i*l)*m,t[8]=(s*n-i*o)*m,t},projection:function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},rotate:function(t,e,n){const i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=Math.sin(n),p=Math.cos(n);return t[0]=p*i+d*s,t[1]=p*r+d*a,t[2]=p*o+d*l,t[3]=p*s-d*i,t[4]=p*a-d*r,t[5]=p*l-d*o,t[6]=c,t[7]=u,t[8]=h,t},scale:u,scaleByVec2:function(t,e,n){const i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t},set:o,str:function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},sub:m,subtract:p,translate:function(t,e,n){const i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=n[0],p=n[1];return t[0]=i,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=d*i+p*s+c,t[7]=d*r+p*a+u,t[8]=d*o+p*l+h,t},transpose:s},Symbol.toStringTag,{value:"Module"}))},53334:(t,e,n)=>{n.d(e,{C:()=>r,Cc:()=>y,Io:()=>h,S8:()=>m,WQ:()=>s,e$:()=>g,hZ:()=>o,hs:()=>u,jb:()=>M,l0:()=>_});var i=n(78115);function r(t,e){return t[0]=e[0],t[1]=e[1],t}function o(t,e,n){return t[0]=e,t[1]=n,t}function s(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function a(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function l(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function c(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function u(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function h(t,e){const n=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(n*n+i*i)}function d(t,e){const n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function p(t){const e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function f(t){const e=t[0],n=t[1];return e*e+n*n}function m(t,e){const n=e[0],i=e[1];let r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t}function y(t,e,n,i){const r=e[0],o=e[1];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t}function _(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5],t}function g(t,e,n,i){const r=e[0]-n[0],o=e[1]-n[1],s=Math.sin(i),a=Math.cos(i);return t[0]=r*a-o*s+n[0],t[1]=r*s+o*a+n[1],t}const x=p,M=a,v=l,b=c,w=h,P=d,A=f;Object.freeze(Object.defineProperty({__proto__:null,add:s,angle:function(t,e){const n=t[0],i=t[1],r=e[0],o=e[1];let s=n*n+i*i;s>0&&(s=1/Math.sqrt(s));let a=r*r+o*o;a>0&&(a=1/Math.sqrt(a));const l=(n*r+i*o)*s*a;return l>1?0:l<-1?Math.PI:Math.acos(l)},ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},copy:r,cross:function(t,e,n){const i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t},dist:w,distance:h,div:b,divide:c,dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},equals:function(t,e){const n=t[0],r=t[1],o=e[0],s=e[1],a=(0,i.FD)();return Math.abs(n-o)<=a*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=a*Math.max(1,Math.abs(r),Math.abs(s))},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},len:x,length:p,lerp:y,max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},mul:v,multiply:l,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t},normalize:m,projectAndScale:function(t,e,n,i,r){let o=e[0]-n[0],s=e[1]-n[1];const a=(i[0]*o+i[1]*s)*(r-1);return o=i[0]*a,s=i[1]*a,t[0]=e[0]+o,t[1]=e[1]+s,t},random:function(t,e=1){const n=2*(0,i.Ov)()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},rotate:g,round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:u,scaleAndAdd:function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t},set:o,sqrDist:P,sqrLen:A,squaredDistance:d,squaredLength:f,str:function(t){return"vec2("+t[0]+", "+t[1]+")"},sub:M,subtract:a,transformMat2:function(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t},transformMat2d:_,transformMat3:function(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t},transformMat4:function(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}},Symbol.toStringTag,{value:"Module"}))},21120:(t,e,n)=>{n.d(e,{E:()=>A,w:()=>a});var i=n(3223),r=n(95039),o=(n(6273),n(11268)),s=n(79207);class a{constructor(t=9,e){this._compareMinX=d,this._compareMinY=p,this._toBBox=t=>t,this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&("function"==typeof e?this._toBBox=e:this._initFormat(e)),this.clear()}destroy(){this.clear(),v.prune(),b.prune(),w.prune(),P.prune()}all(t){l(this._data,t)}search(t,e){let n=this._data;const i=this._toBBox;if(x(t,n))for(v.clear();n;){for(let r=0,o=n.children.length;r<o;r++){const o=n.children[r],s=n.leaf?i(o):o;x(t,s)&&(n.leaf?e(o):g(t,s)?l(o,e):v.push(o))}n=v.pop()}}collides(t){let e=this._data;const n=this._toBBox;if(!x(t,e))return!1;for(v.clear();e;){for(let i=0,r=e.children.length;i<r;i++){const r=e.children[i],o=e.leaf?n(r):r;if(x(t,o)){if(e.leaf||g(t,o))return!0;v.push(r)}}e=v.pop()}return!1}load(t){if(!t.length)return this;if(t.length<this._minEntries){for(let e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this._data.children.length)if(this._data.height===e.height)this._splitRoot(this._data,e);else{if(this._data.height<e.height){const t=this._data;this._data=e,e=t}this._insert(e,this._data.height-e.height-1,!0)}else this._data=e;return this}insert(t){return t&&this._insert(t,this._data.height-1),this}clear(){return this._data=new R([]),this}remove(t){if(!t)return this;let e,n=this._data,o=null,s=0,a=!1;const l=this._toBBox(t);for(w.clear(),P.clear();n||w.length>0;){if(n||(n=w.pop(),o=w.data[w.length-1],s=P.pop()??0,a=!0),n.leaf&&(e=(0,i.qh)(n.children,(0,r.zI)(t),n.children.length,n.indexHint),-1!==e))return n.children.splice(e,1),w.push(n),this._condense(w),this;a||n.leaf||!g(n,l)?o?(s++,n=o.children[s],a=!1):n=null:(w.push(n),P.push(s),s=0,o=n,n=n.children[0])}return this}toJSON(){return this._data}fromJSON(t){return this._data=t,this}_build(t,e,n,i){const r=n-e+1;let o=this._maxEntries;if(r<=o){const i=new R(t.slice(e,n+1));return c(i,this._toBBox),i}i||(i=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/o**(i-1)));const s=new S([]);s.height=i;const a=Math.ceil(r/o),l=a*Math.ceil(Math.sqrt(o));M(t,e,n,l,this._compareMinX);for(let c=e;c<=n;c+=l){const e=Math.min(c+l-1,n);M(t,c,e,a,this._compareMinY);for(let n=c;n<=e;n+=a){const r=Math.min(n+a-1,e);s.children.push(this._build(t,n,r,i-1))}}return c(s,this._toBBox),s}_insert(t,e,n){const i=this._toBBox,r=n?t:i(t);w.clear();const o=function(t,e,n,i){for(;i.push(e),!0!==e.leaf&&i.length-1!==n;){let n,i=1/0,r=1/0;for(let o=0,s=e.children.length;o<s;o++){const s=e.children[o],a=f(s),l=y(t,s)-a;l<r?(r=l,i=a<i?a:i,n=s):l===r&&a<i&&(i=a,n=s)}e=n||e.children[0]}return e}(r,this._data,e,w);for(o.children.push(t),h(o,r);e>=0&&w.data[e].children.length>this._maxEntries;)this._split(w,e),e--;!function(t,e,n){for(let i=n;i>=0;i--)h(e.data[i],t)}(r,w,e)}_split(t,e){const n=t.data[e],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);const o=this._chooseSplitIndex(n,r,i);if(!o)return;const s=n.children.splice(o,n.children.length-o),a=n.leaf?new R(s):new S(s);a.height=n.height,c(n,this._toBBox),c(a,this._toBBox),e?t.data[e-1].children.push(a):this._splitRoot(n,a)}_splitRoot(t,e){this._data=new S([t,e]),this._data.height=t.height+1,c(this._data,this._toBBox)}_chooseSplitIndex(t,e,n){let i,r,o;i=r=1/0;for(let s=e;s<=n-e;s++){const e=u(t,0,s,this._toBBox),a=u(t,s,n,this._toBBox),l=_(e,a),c=f(e)+f(a);l<i?(i=l,o=s,r=c<r?c:r):l===i&&c<r&&(r=c,o=s)}return o}_chooseSplitAxis(t,e,n){const i=t.leaf?this._compareMinX:d,r=t.leaf?this._compareMinY:p;this._allDistMargin(t,e,n,i)<this._allDistMargin(t,e,n,r)&&t.children.sort(i)}_allDistMargin(t,e,n,i){t.children.sort(i);const r=this._toBBox,o=u(t,0,e,r),s=u(t,n-e,n,r);let a=m(o)+m(s);for(let l=e;l<n-e;l++){const e=t.children[l];h(o,t.leaf?r(e):e),a+=m(o)}for(let l=n-e-1;l>=e;l--){const e=t.children[l];h(s,t.leaf?r(e):e),a+=m(s)}return a}_condense(t){for(let e=t.length-1;e>=0;e--){const n=t.data[e];if(0===n.children.length)if(e>0){const r=t.data[e-1],o=r.children;o.splice((0,i.qh)(o,n,o.length,r.indexHint),1)}else this.clear();else c(n,this._toBBox)}}_initFormat(t){const e=["return a"," - b",";"];this._compareMinX=new Function("a","b",e.join(t[0])),this._compareMinY=new Function("a","b",e.join(t[1])),this._toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}function l(t,e){let n=t;for(b.clear();n;){if(!0===n.leaf)for(const t of n.children)e((0,r.zI)(t));else b.pushArray(n.children);n=b.pop()??null}}function c(t,e){u(t,0,t.children.length,e,t)}function u(t,e,n,i,r){r||(r=new R([])),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o,s=e;s<n;s++)o=t.children[s],h(r,t.leaf?i(o):o);return r}function h(t,e){t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY)}function d(t,e){return t.minX-e.minX}function p(t,e){return t.minY-e.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function m(t){return t.maxX-t.minX+(t.maxY-t.minY)}function y(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function _(t,e){const n=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),r=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,r-n)*Math.max(0,o-i)}function g(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function x(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function M(t,e,n,i,r){const o=[e,n];for(;o.length;){const e=o.pop(),n=o.pop();if(e-n<=i)continue;const a=n+Math.ceil((e-n)/i/2)*i;(0,s.q)(t,a,n,e,r),o.push(n,a,a,e)}}const v=new o.A,b=new o.A,w=new o.A,P=new o.A({deallocator:void 0});class A{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class I extends A{constructor(){super(...arguments),this.height=1,this.indexHint=new i.vW}}class R extends I{constructor(t){super(),this.children=t,this.leaf=!0}}class S extends I{constructor(t){super(),this.children=t,this.leaf=!1}}},36176:(t,e,n)=>{n.d(e,{b3:()=>h,jZ:()=>u});var i=n(46030),r=n(2532),o=n(70040),s=n(11021),a=n(56053),l=n(75981),c=n(67488);function u(t){return d(t,!0)}function h(t){return d(t,!1)}function d(t,e){if(null==t)return null;const n=t.spatialReference,r=(0,c.Vp)(n),s=(0,i.W)(t)?t.toJSON():t;if(!r)return s;const u=(0,c.K8)(n)?102100:4326,h=l.j7[u].maxX,d=l.j7[u].minX;if((0,a.fT)(s))return f(s,h,d);if((0,a.U9)(s))return s.points=s.points.map((t=>f(t,h,d))),s;if((0,a.ZC)(s))return p(s,r);if((0,a.Bi)(s)||(0,a.Rg)(s)){const t=(0,o.Rg)(M,s),n={xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3]},i=(0,l.kd)(n.xmin,d)*(2*h),r=0===i?s:(0,l.kS)(s,i);return n.xmin+=i,n.xmax+=i,n.xmax>h?g(r,h,e):n.xmin<d?g(r,d,e):r}return s}function p(t,e){if(!e)return t;const n=function(t,e){const n=[],{ymin:i,ymax:r,xmin:o,xmax:s}=t,a=t.xmax-t.xmin,[l,c]=e.valid,{x:u,frameId:h}=m(t.xmin,e),{x:d,frameId:p}=m(t.xmax,e),f=u===d&&a>0;if(a>2*c){const t={xmin:o<s?u:d,ymin:i,xmax:c,ymax:r},e={xmin:l,ymin:i,xmax:o<s?d:u,ymax:r},a={xmin:0,ymin:i,xmax:c,ymax:r},f={xmin:l,ymin:i,xmax:0,ymax:r},m=[],_=[];y(t,a)&&m.push(h),y(t,f)&&_.push(h),y(e,a)&&m.push(p),y(e,f)&&_.push(p);for(let n=h+1;n<p;n++)m.push(n),_.push(n);n.push(new x(t,[h]),new x(e,[p]),new x(a,m),new x(f,_))}else u>d||f?n.push(new x({xmin:u,ymin:i,xmax:c,ymax:r},[h]),new x({xmin:l,ymin:i,xmax:d,ymax:r},[p])):n.push(new x({xmin:u,ymin:i,xmax:d,ymax:r},[h]));return n}(t,e).map((t=>t.extent));return n.length<2?n[0]||t:n.length>2?(t.xmin=e.valid[0],t.xmax=e.valid[1],t):{rings:n.map((t=>[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]))}}function f(t,e,n){if(Array.isArray(t)){const i=t[0];if(i>e){const n=(0,l.kd)(i,e);t[0]=i+n*(-2*e)}else if(i<n){const e=(0,l.kd)(i,n);t[0]=i+e*(-2*n)}}else{const i=t.x;if(i>e){const n=(0,l.kd)(i,e);t.x+=n*(-2*e)}else if(i<n){const e=(0,l.kd)(i,n);t.x+=e*(-2*n)}}return t}function m(t,e){const[n,i]=e.valid,r=2*i;let o,s=0;return t>i?(o=Math.ceil(Math.abs(t-i)/r),t-=o*r,s=o):t<n&&(o=Math.ceil(Math.abs(t-n)/r),t+=o*r,s=-o),{x:t,frameId:s}}function y(t,e){const{xmin:n,ymin:i,xmax:r,ymax:o}=e;return _(t,n,i)&&_(t,n,o)&&_(t,r,o)&&_(t,r,i)}function _(t,e,n){return e>=t.xmin&&e<=t.xmax&&n>=t.ymin&&n<=t.ymax}function g(t,e,n=!0){const i=!(0,a.Rg)(t);if(i&&(0,s.m3)(t),n)return(new v).cut(t,e);const r=i?t.rings:t.paths,o=i?4:2,l=r.length,c=-2*e;for(let s=0;s<l;s++){const t=r[s];if(t&&t.length>=o){const e=[];for(const n of t)e.push([n[0]+c,n[1]]);r.push(e)}}return i?t.rings=r:t.paths=r,t}class x{constructor(t,e){this.extent=t,this.frameIds=e}}const M=(0,r.vt)();class v{constructor(){this._linesIn=[],this._linesOut=[]}cut(t,e){let n;if(this._xCut=e,t.rings)this._closed=!0,n=t.rings,this._minPts=4;else{if(!t.paths)return null;this._closed=!1,n=t.paths,this._minPts=2}for(const r of n){if(!r||r.length<this._minPts)continue;let t=!0;for(const e of r)t?(this.moveTo(e),t=!1):this.lineTo(e);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),n=[];for(const r of this._linesIn)r&&r.length>=this._minPts&&n.push(r);const i=-2*this._xCut;for(const r of this._linesOut)if(r&&r.length>=this._minPts){for(const t of r)t[0]+=i;n.push(r)}return this._closed?t.rings=n:t.paths=n,t}moveTo(t){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(t[0]),this._moveTo(t[0],t[1],this._prevSide),this._prevPt=t,this._firstPt=t}lineTo(t){const e=this._side(t[0]);if(e*this._prevSide==-1){const n=this._intersect(this._prevPt,t);this._lineTo(this._xCut,n,0),this._prevSide=0,this._lineTo(t[0],t[1],e)}else this._lineTo(t[0],t[1],e);this._prevSide=e,this._prevPt=t}close(){const t=this._firstPt,e=this._prevPt;t[0]===e[0]&&t[1]===e[1]||this.lineTo(t),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(t,e,n){this._closed?(this._lineIn.push([n<=0?t:this._xCut,e]),this._lineOut.push([n>=0?t:this._xCut,e])):(n<=0&&this._lineIn.push([t,e]),n>=0&&this._lineOut.push([t,e]))}_lineTo(t,e,n){this._closed?(b(this._lineIn,n<=0?t:this._xCut,e),b(this._lineOut,n>=0?t:this._xCut,e)):n<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([t,e])):n>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([t,e])):this._prevSide<0?(this._lineIn.push([t,e]),this._lineOut.push([t,e])):this._prevSide>0&&(this._lineOut.push([t,e]),this._lineIn.push([t,e]))}_checkClosingPt(t){const e=t.length;e>3&&t[0][0]===this._xCut&&t[e-2][0]===this._xCut&&t[1][0]===this._xCut&&(t[0][1]=t[e-2][1],t.pop())}_side(t){return t<this._xCut?-1:t>this._xCut?1:0}_intersect(t,e){const n=(this._xCut-t[0])/(e[0]-t[0]);return t[1]+n*(e[1]-t[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function b(t,e,n){const i=t.length;i>1&&t[i-1][0]===e&&t[i-2][0]===e?t[i-1][1]=n:t.push([e,n])}},14822:(t,e,n)=>{n.r(e),n.d(e,{default:()=>ee});var i=n(82392),r=n(54192),o=n(62991),s=n(80861),a=n(33125),l=n(49175),c=n(81482),u=n(77380),h=(n(6273),n(67498),n(25376)),d=n(26325),p=n(48524),f=n(91101),m=n(41247),y=n(20923),_=n(90296),g=n(60368),x=n(22111),M=n(14755),v=n(22395),b=n(82541),w=n(79441),P=n(53334),A=n(80347);const I=(0,n(19913).vt)(),R=(0,w.vt)(),S=(0,w.vt)(),O=(0,w.vt)();function B(t,e,n){return(0,A.i)(I,e[0],e[1],1),(0,A.o)(I,I,(0,b.mg)(R,n)),0===I[2]?(0,P.hZ)(t,I[0],I[1]):(0,P.hZ)(t,I[0]/I[2],I[1]/I[2])}function T(t,e,n){return E(S,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]),E(O,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]),(0,b.lw)(t,(0,b.KC)(S,S),O),0!==t[8]&&(t[0]/=t[8],t[1]/=t[8],t[2]/=t[8],t[3]/=t[8],t[4]/=t[8],t[5]/=t[8],t[6]/=t[8],t[7]/=t[8],t[8]/=t[8]),t}function E(t,e,n,i,r,o,s,a,l){(0,b.hZ)(t,e,i,o,n,r,s,1,1,1),(0,A.i)(I,a,l,1),(0,b.KC)(R,t);const[c,u,h]=(0,A.o)(I,I,(0,b.mg)(R,R));return(0,b.hZ)(R,c,0,0,0,u,0,0,0,h),(0,b.lw)(t,R,t)}var L=n(23572),Z=n(56560),j=n(30214),C=n(65648),X=n(27646),Y=n(44153);let q=class extends M.A{projectOrWarn(t,e){if(null==t)return t;const{geometry:n,pending:i}=(0,X.projectOrLoad)(t,e);return i?null:i||n?n:(s.A.getLogger(this).warn("geometry could not be projected to the spatial reference",{georeference:this,geometry:t,sourceSpatialReference:t.spatialReference,targetSpatialReference:e}),null)}};q=(0,i._)([(0,d.$)("esri.layers.support.GeoreferenceBase")],q);const z=(0,w.vt)(),N=(0,Z.vt)();let V=class extends v.A{};(0,i._)([(0,c.MZ)({type:Number,json:{write:{isRequired:!0}}})],V.prototype,"x",void 0),(0,i._)([(0,c.MZ)({type:Number,json:{write:{isRequired:!0}}})],V.prototype,"y",void 0),V=(0,i._)([(0,d.$)("esri.layers.support.ControlPointsGeoreference.ControlPointJSONType")],V);let H=class extends M.A{constructor(){super(...arguments),this.sourcePoint=null,this.mapPoint=null}};(0,i._)([(0,c.MZ)()],H.prototype,"sourcePoint",void 0),(0,i._)([(0,c.MZ)({type:j.A})],H.prototype,"mapPoint",void 0),H=(0,i._)([(0,d.$)("esri.layers.support.ControlPointsGeoreference.ControlPoint")],H);let $=class extends(v.A.JSONSupportMixin(q)){constructor(t){super(t),this.controlPoints=null,this.height=0,this.type="control-points",this.width=0}readControlPoints(t,e){const n=Y.A.fromJSON(e.spatialReference),i=(0,w.fA)(...e.coefficients,1);return t.map((t=>((0,P.hZ)(N,t.x,t.y),B(N,N,i),{sourcePoint:t,mapPoint:new j.A({x:N[0],y:N[1],spatialReference:n})})))}writeControlPoints(t,e,n,i){if(null!=this.transform)null!=t&&k(t[0])&&(e.controlPoints=t.map((t=>{const e=t.sourcePoint;return{x:e.x,y:e.y}})),e.spatialReference=t[0].mapPoint.spatialReference.toJSON(),e.coefficients=this.transform.slice(0,8));else{const t=new o.A("web-document-write:invalid-georeference","Invalid 'controlPoints', 'width', 'height' configuration. Make sure the parent media element is loaded i.e. the ImageElement or VideoElement set as 'MediaLayer.source'.",{layer:i?.layer,georeference:this});i?.messages?i.messages.push(t):s.A.getLogger(this).error(t.name,t.message)}}get coords(){if(null==this.controlPoints)return null;const t=this._updateTransform(z);if(null==t||!k(this.controlPoints[0]))return null;const e=this.controlPoints[0].mapPoint.spatialReference;return function(t,e,n,i){const r=(0,Z.fA)(0,n),o=(0,Z.fA)(0,0),s=(0,Z.fA)(e,0),a=(0,Z.fA)(e,n);return B(r,r,t),B(o,o,t),B(s,s,t),B(a,a,t),new C.A({rings:[[r,o,s,a,r]],spatialReference:i})}(t,this.width,this.height,e)}set coords(t){if(null==this.controlPoints||!k(this.controlPoints[0]))return;const e=this.controlPoints[0].mapPoint.spatialReference;if(null==(t=this.projectOrWarn(t,e)))return;const{width:n,height:i}=this,{rings:[[r,o,s,a]]}=t,l={sourcePoint:(0,L.tc)(0,i),mapPoint:new j.A({x:r[0],y:r[1],spatialReference:e})},c={sourcePoint:(0,L.tc)(0,0),mapPoint:new j.A({x:o[0],y:o[1],spatialReference:e})},u={sourcePoint:(0,L.tc)(n,0),mapPoint:new j.A({x:s[0],y:s[1],spatialReference:e})},h={sourcePoint:(0,L.tc)(n,i),mapPoint:new j.A({x:a[0],y:a[1],spatialReference:e})};k(l)&&k(c)&&k(u)&&k(h)&&(nt(z,l,c,u,h),this.controlPoints=this.controlPoints.map((({sourcePoint:t})=>((0,P.hZ)(N,t.x,t.y),B(N,N,z),{sourcePoint:t,mapPoint:new j.A({x:N[0],y:N[1],spatialReference:e})}))))}get inverseTransform(){return null==this.transform?null:(0,b.B8)((0,w.vt)(),this.transform)}get transform(){return this._updateTransform()}toMap(t){if(null==t||null==this.transform||null==this.controlPoints||!k(this.controlPoints[0]))return null;(0,P.hZ)(N,t.x,t.y);const e=this.controlPoints[0].mapPoint.spatialReference;return B(N,N,this.transform),new j.A({x:N[0],y:N[1],spatialReference:e})}toSource(t){if(null==t||null==this.inverseTransform||null==this.controlPoints||!k(this.controlPoints[0]))return null;const e=this.controlPoints[0].mapPoint.spatialReference;return t=t.normalize(),null==(t=(0,X.projectOrLoad)(t,e).geometry)?null:((0,P.hZ)(N,t.x,t.y),B(N,N,this.inverseTransform),(0,L.tc)(N[0],N[1]))}toSourceNormalized(t){const e=this.toSource(t);return null!=e&&(e.x/=this.width,e.y/=this.height),e}_updateTransform(t){const{controlPoints:e,width:n,height:i}=this;if(!(null!=e&&n>0&&i>0))return null;const[r,o,s,a]=e;if(!k(r))return null;const l=r.mapPoint.spatialReference,c=this._projectControlPoint(o,l),u=this._projectControlPoint(s,l),h=this._projectControlPoint(a,l);if(!c.valid||!u.valid||!h.valid)return null;if(!k(c.controlPoint))return null;null==t&&(t=(0,w.vt)());let d=null;return d=k(u.controlPoint)&&k(h.controlPoint)?nt(t,r,c.controlPoint,u.controlPoint,h.controlPoint):k(u.controlPoint)?function(t,e,n,i){return et(W,U,e),et(D,K,n),et(F,J,i),(0,P.Cc)(G,W,D,.5),(0,P.e$)(G,F,G,Math.PI),(0,P.Cc)(Q,U,K,.5),(0,P.e$)(Q,J,Q,Math.PI),st(t,W,D,F,G,U,K,J,Q)}(t,r,c.controlPoint,u.controlPoint):function(t,e,n){return et(W,U,e),et(D,K,n),(0,P.e$)(F,D,W,tt),(0,P.e$)(G,W,D,tt),(0,P.e$)(J,K,U,-tt),(0,P.e$)(Q,U,K,-tt),st(t,W,D,F,G,U,K,J,Q)}(t,r,c.controlPoint),d.every((t=>0===t))?null:d}_projectControlPoint(t,e){if(!k(t))return{valid:!0,controlPoint:t};const{sourcePoint:n,mapPoint:i}=t,{geometry:r,pending:o}=(0,X.projectOrLoad)(i,e);return o?{valid:!1,controlPoint:null}:o||r?{valid:!0,controlPoint:{sourcePoint:n,mapPoint:r}}:(s.A.getLogger(this).warn("map point could not be projected to the spatial reference",{georeference:this,controlPoint:t,sourceSpatialReference:i.spatialReference,targetSpatialReference:e}),{valid:!1,controlPoint:null})}};function k(t){return null!=t?.sourcePoint&&null!=t.mapPoint}(0,i._)([(0,c.MZ)({type:[H],json:{write:{allowNull:!1,isRequired:!0,target:{controlPoints:{type:[V],isRequired:!0},coefficients:{type:[Number],isRequired:!0},spatialReference:{type:Y.A,isRequired:!0}}}}})],$.prototype,"controlPoints",void 0),(0,i._)([(0,h.w)("controlPoints")],$.prototype,"readControlPoints",null),(0,i._)([(0,p.K)("controlPoints")],$.prototype,"writeControlPoints",null),(0,i._)([(0,c.MZ)({clonable:!1})],$.prototype,"coords",null),(0,i._)([(0,c.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],$.prototype,"height",void 0),(0,i._)([(0,c.MZ)({readOnly:!0})],$.prototype,"inverseTransform",null),(0,i._)([(0,c.MZ)({readOnly:!0})],$.prototype,"transform",null),(0,i._)([(0,c.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],$.prototype,"width",void 0),$=(0,i._)([(0,d.$)("esri.layers.support.ControlPointsGeoreference")],$);const W=(0,Z.vt)(),D=(0,Z.vt)(),F=(0,Z.vt)(),G=(0,Z.vt)(),U=(0,Z.vt)(),K=(0,Z.vt)(),J=(0,Z.vt)(),Q=(0,Z.vt)(),tt=Math.PI/2;function et(t,e,n){(0,P.hZ)(t,n.sourcePoint.x,n.sourcePoint.y),(0,P.hZ)(e,n.mapPoint.x,n.mapPoint.y)}function nt(t,e,n,i,r){return et(W,U,e),et(D,K,n),et(F,J,i),et(G,Q,r),st(t,W,D,F,G,U,K,J,Q)}const it=new Array(8).fill(0),rt=new Array(8).fill(0);function ot(t,e,n,i,r){return t[0]=e[0],t[1]=e[1],t[2]=n[0],t[3]=n[1],t[4]=i[0],t[5]=i[1],t[6]=r[0],t[7]=r[1],t}function st(t,e,n,i,r,o,s,a,l){return T(t,ot(it,e,n,i,r),ot(rt,o,s,a,l))}var at=n(38116),lt=n(73027),ct=n(19759),ut=n(1874),ht=n(23377),dt=n(11965),pt=n(8e3),ft=n(67488);const mt=(0,Z.vt)();let yt=class extends q{constructor(t){super(t),this.bottomLeft=null,this.bottomRight=null,this.topLeft=null,this.topRight=null,this.type="corners"}get coords(){let{topLeft:t,topRight:e,bottomLeft:n,bottomRight:i}=this;if(null==t||null==e||null==n||null==i)return null;const r=t.spatialReference;return e=this.projectOrWarn(e,r),n=this.projectOrWarn(n,r),i=this.projectOrWarn(i,r),null==e||null==n||null==i?null:new C.A({rings:[[[n.x,n.y],[t.x,t.y],[e.x,e.y],[i.x,i.y],[n.x,n.y]]],spatialReference:r})}set coords(t){const{topLeft:e}=this;if(null==e)return;const n=e.spatialReference;if(null==(t=this.projectOrWarn(t,n)))return;const{rings:[[i,r,o,s]]}=t;this.bottomLeft=new j.A({x:i[0],y:i[1],spatialReference:n}),this.topLeft=new j.A({x:r[0],y:r[1],spatialReference:n}),this.topRight=new j.A({x:o[0],y:o[1],spatialReference:n}),this.bottomRight=new j.A({x:s[0],y:s[1],spatialReference:n})}toSourceNormalized(t){const{topLeft:e,topRight:n,bottomRight:i,bottomLeft:r}=this;if(null==t||null==e||null==n||null==i||null==r)return null;const o=e.spatialReference;t=t.normalize();const s=(0,X.projectOrLoad)(t,o).geometry;if(null==s)return null;(0,P.hZ)(mt,s.x,s.y);const a=T((0,w.vt)(),[e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y],[0,0,0,1,1,0,1,1]);return B(mt,mt,a),(0,L.tc)(mt[0],mt[1])}};(0,i._)([(0,c.MZ)({clonable:!1})],yt.prototype,"coords",null),(0,i._)([(0,c.MZ)({type:j.A})],yt.prototype,"bottomLeft",void 0),(0,i._)([(0,c.MZ)({type:j.A})],yt.prototype,"bottomRight",void 0),(0,i._)([(0,c.MZ)({type:j.A})],yt.prototype,"topLeft",void 0),(0,i._)([(0,c.MZ)({type:j.A})],yt.prototype,"topRight",void 0),yt=(0,i._)([(0,d.$)("esri.layers.support.CornersGeoreference")],yt);const _t=yt;var gt=n(4506),xt=n(78115);let Mt=class extends q{constructor(t){super(t),this.extent=null,this.rotation=0,this.type="extent-and-rotation"}get coords(){if(null==this.extent)return null;const{xmin:t,ymin:e,xmax:n,ymax:i,spatialReference:r}=this.extent;let o;if(this.rotation){const{x:r,y:s}=this.extent.center,a=vt(r,s,this.rotation);o=[a(t,e),a(t,i),a(n,i),a(n,e)],o.push(o[0])}else o=[[t,e],[t,i],[n,i],[n,e],[t,e]];return new C.A({rings:[o],spatialReference:r})}set coords(t){if(null==t||null==this.extent)return;const e=this.extent.spatialReference;if(t=this.projectOrWarn(t,e),null==t?.extent)return;const{rings:[[n,i,r]],extent:{center:{x:o,y:s}}}=t,a=(0,gt.KJ)(Math.PI/2-Math.atan2(i[1]-n[1],i[0]-n[0])),l=vt(o,s,-a),[c,u]=l(n[0],n[1]),[h,d]=l(r[0],r[1]);this.extent=new pt.A({xmin:c,ymin:u,xmax:h,ymax:d,spatialReference:e}),this.rotation=a}toSourceNormalized(t){const{extent:e,rotation:n}=this;if(null==t||null==e)return null;const{xmin:i,ymin:r,xmax:o,ymax:s,center:a,spatialReference:l}=e;t=t.normalize();const c=(0,X.projectOrLoad)(t,l).geometry;if(null==c)return null;let u=c.x,h=c.y;return n&&([u,h]=vt(a.x,a.y,-n)(u,h)),(0,L.tc)((0,gt.hs)(u,i,o,0,1),(0,gt.hs)(h,s,r,0,1))}};function vt(t,e,n){const i=(0,xt.DF)(n),r=Math.cos(i),o=Math.sin(i);return(n,i)=>[r*(n-t)+o*(i-e)+t,r*(i-e)-o*(n-t)+e]}(0,i._)([(0,c.MZ)({clonable:!1})],Mt.prototype,"coords",null),(0,i._)([(0,c.MZ)({type:pt.A})],Mt.prototype,"extent",void 0),(0,i._)([(0,c.MZ)({type:Number})],Mt.prototype,"rotation",void 0),Mt=(0,i._)([(0,d.$)("esri.layers.support.ExtentAndRotationGeoreference")],Mt);function bt(t,e){const n=(0,f.aB)(e);return function(t){return"media"===t?.type}(t)&&!!t.portalItem&&null!=n&&n>f.Gr.PORTAL_ITEM}function wt(t,e,n){return{enabled:!bt(n?.layer,n?.origin),ignoreOrigin:!0}}const Pt={json:{name:"url",type:String,write:{overridePolicy:wt}}},At={readOnly:!0,json:{read:!1,write:{target:"mediaType",overridePolicy:wt}}},It={types:{key:"type",base:q,typeMap:{"control-points":$,corners:_t,"extent-and-rotation":Mt}},json:{types:{key:"type",base:q,typeMap:{"control-points":$}},write:{overridePolicy:()=>({enabled:!0,ignoreOrigin:!0})}}};let Rt=class extends(ht.A.NumericIdentifiableMixin((0,a.P)(dt.A))){constructor(t){super(t),this.georeference=null,this.opacity=1}readGeoreference(t){return $.fromJSON(t)}writeGeoreference(t,e,n,i){const r=i?.resources?.pendingOperations,a=()=>{const r=function(t,e,n){if(!t||"control-points"===t.type)return t;const{coords:i}=t;if(5!==i?.rings[0]?.length)return null;const[r,o,s,a]=i.rings[0],{spatialReference:l}=i;return new $({controlPoints:[{mapPoint:new j.A({x:r[0],y:r[1],spatialReference:l}),sourcePoint:(0,L.tc)(0,n)},{mapPoint:new j.A({x:o[0],y:o[1],spatialReference:l}),sourcePoint:(0,L.tc)(0,0)},{mapPoint:new j.A({x:s[0],y:s[1],spatialReference:l}),sourcePoint:(0,L.tc)(e,0)},{mapPoint:new j.A({x:a[0],y:a[1],spatialReference:l}),sourcePoint:(0,L.tc)(e,n)}],width:e,height:n})}(this.georeference,this.contentWidth,this.contentHeight);if(r){if("control-points"!==t.type&&s.A.getLogger(this).warn(`only georeference of type 'control-points' may be persisted. The georeference of type '${t.type}' has been automatically converted.`),4!==r.controlPoints?.length&&i?.messages)return void i.messages.push(new o.A("property:unsupported","only 'control-points' georeference with 4 control points may be persisted."));e[n]=r.write({},i)}};if("control-points"!==t.type&&!this.loaded&&r)return e[n]={},void r.push(this.load().then(a));a()}get contentWidth(){return 0}get contentHeight(){return 0}toSource(t){const{georeference:e,contentWidth:n,contentHeight:i}=this;if(null==t||null==e||0===n||0===i)return null;const r=e.toSourceNormalized(t);return null==r?null:(r.x*=n,r.y*=i,r)}};(0,i._)([(0,c.MZ)(It)],Rt.prototype,"georeference",void 0),(0,i._)([(0,h.w)("georeference")],Rt.prototype,"readGeoreference",null),(0,i._)([(0,p.K)("georeference")],Rt.prototype,"writeGeoreference",null),(0,i._)([(0,c.MZ)({json:{read:!1,write:!1}})],Rt.prototype,"opacity",void 0),Rt=(0,i._)([(0,d.$)("esri.layers.support.MediaElementBase")],Rt);var St=n(80925);const Ot=Symbol("ImageElementInstance"),Bt=Symbol("VideoElementInstance");function Tt(t){return function(t){return null!=t&&"object"==typeof t&&Ot in t}(t)||function(t){return null!=t&&"object"==typeof t&&Bt in t}(t)}var Et,Lt=n(55714);let Zt=class extends Rt{static{Et=Ot}constructor(t){super(t),this.animationOptions=null,this.content=null,this.image=null,this.type="image",this[Et]=!0,this.image=null}load(){const t=this.image;if("string"==typeof t){const e=(0,lt.M5)(t).then((t=>{this._set("content",t)}));this.addResolvingPromise(e)}else if(t instanceof HTMLImageElement){const e=t.decode().then((()=>{this._set("content",t)}));this.addResolvingPromise(e)}else t?this._set("content",t):this.addResolvingPromise(Promise.reject(new o.A("image-element:invalid-image-type","Invalid image type",{image:t})));return Promise.resolve(this)}get contentWidth(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalWidth:this.content.width}get contentHeight(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalHeight:this.content.height}readImage(t,e,n){return(0,Lt.f)(e.url,n)}writeImage(t,e,n,i){if(null==t)return;const r=i?.portalItem,o=i?.resources;if(!r||!o)return void("string"==typeof t&&(e[n]=(0,Lt.t)(t,i)));const s=function(t){return"string"==typeof t&&!(0,ct.DB)(t)&&!(0,ct.w8)(t)}(t)?t:null;if(s){if(null==(0,Lt.i)(s))return void(e[n]=s);const t=(0,Lt.t)(s,{...i,verifyItemRelativeUrls:i?.verifyItemRelativeUrls?{writtenUrls:i.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},Lt.M.NO);if(r&&t&&!(0,ct.oP)(t))return o.toKeep.push({resource:r.resourceFromPath(t),compress:!1}),void(e[n]=t)}e[n]="<pending>",o.pendingOperations.push(async function(t){if("string"==typeof t)return(0,ct.DB)(t)?(0,ct.N9)(t):(await(0,at.A)(t,{responseType:"blob"})).data;return new Promise((e=>function(t){if(t instanceof HTMLCanvasElement)return t;const e=t instanceof HTMLImageElement?t.naturalWidth:t.width,n=t instanceof HTMLImageElement?t.naturalHeight:t.height,i=document.createElement("canvas"),r=i.getContext("2d");return i.width=e,i.height=n,t instanceof HTMLImageElement?r.drawImage(t,0,0,t.width,t.height):t instanceof ImageData&&r.putImageData(t,0,0),i}(t).toBlob(e)))}(t).then((t=>{const i=function(t,e){const n=(0,ut.lk)(),i=`${(0,ct.fj)("media",n)}.${(0,St.n)({type:"blob",blob:t})}`;return e.resourceFromPath(i)}(t,r);e[n]=i.itemRelativeUrl,o.toAdd.push({resource:i,content:{type:"blob",blob:t},compress:!1,finish:t=>{this.image=t.url}})})))}};(0,i._)([(0,c.MZ)()],Zt.prototype,"animationOptions",void 0),(0,i._)([(0,c.MZ)({readOnly:!0})],Zt.prototype,"content",void 0),(0,i._)([(0,c.MZ)({readOnly:!0})],Zt.prototype,"contentWidth",null),(0,i._)([(0,c.MZ)({readOnly:!0})],Zt.prototype,"contentHeight",null),(0,i._)([(0,c.MZ)(Pt)],Zt.prototype,"image",void 0),(0,i._)([(0,h.w)("image",["url"])],Zt.prototype,"readImage",null),(0,i._)([(0,p.K)("image")],Zt.prototype,"writeImage",null),(0,i._)([(0,c.MZ)(At)],Zt.prototype,"type",void 0),Zt=(0,i._)([(0,d.$)("esri.layers.support.ImageElement")],Zt);var jt=n(48),Ct=n(57888),Xt=n(71004),Yt=n(61985),qt=n(2532),zt=n(19387),Nt=n(64411),Vt=n(93741),Ht=n(36176);let $t=class extends Vt.A{constructor(t){super(t)}get bounds(){const t=this.coords;return null==t?.extent?null:(0,qt.VY)(t.extent)}get coords(){const t=this.element.georeference?.coords;return(0,X.projectOrLoad)(t,this.spatialReference).geometry}get normalizedCoords(){return C.A.fromJSON((0,Ht.jZ)(this.coords))}get normalizedBounds(){const t=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=t?(0,qt.VY)(t):null}};(0,i._)([(0,c.MZ)()],$t.prototype,"spatialReference",void 0),(0,i._)([(0,c.MZ)()],$t.prototype,"element",void 0),(0,i._)([(0,c.MZ)()],$t.prototype,"bounds",null),(0,i._)([(0,c.MZ)()],$t.prototype,"coords",null),(0,i._)([(0,c.MZ)()],$t.prototype,"normalizedCoords",null),(0,i._)([(0,c.MZ)()],$t.prototype,"normalizedBounds",null),$t=(0,i._)([(0,d.$)("esri.layers.support.MediaElementView")],$t);var kt,Wt=n(13190),Dt=n(40102);const Ft=Symbol("canplay");let Gt=class extends Rt{static{kt=Bt}constructor(t){super(t),this.autoplay=!0,this.content=null,this.type="video",this[kt]=!0}load(){const t=this.video;return"string"==typeof t?this.addResolvingPromise(this._preProcessVideoUrl(t).then((async t=>{const e=document.createElement("video");return e.src=Wt.W5.sanitizeUrl((0,ct.s2)(t)),e.crossOrigin="anonymous",e.autoplay=this.autoplay,e.muted=!0,e.loop=!0,e.playsInline=!0,this._loadVideo(e).then((()=>{this._set("content",e)}))}))):t instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(t).then((()=>{this._set("content",t)}))):this.addResolvingPromise(Promise.reject(new o.A("video-element:invalid-video-type","Invalid video type",{video:t}))),Promise.resolve(this)}get contentWidth(){return this.content?.videoWidth??0}get contentHeight(){return this.content?.videoHeight??0}get currentTime(){return this.content?.currentTime}set currentTime(t){if(!this.content)return;const e=(0,gt.qE)(t,0,this.content.duration);"fastSeek"in this.content?this.content.fastSeek(e):this.content.currentTime=e,this.content.play().then((()=>{this.content?.pause()})).catch((()=>{}))}get duration(){return this.content?.duration}set video(t){"not-loaded"===this.loadStatus?this._set("video",t):s.A.getLogger(this).error("#video","video cannot be changed after the element is loaded.")}writeVideo(t,e,n,i){if(!t)return void(i?.messages&&i.messages.push(new o.A("video-element:unsupported-video","video source is missing")));const r=function(t){return"string"==typeof t&&!(0,ct.DB)(t)&&!(0,ct.w8)(t)}(t)?t:null;if(!r)return void(i?.messages&&i.messages.push(new o.A("video-element:unsupported-video","video source must be an absolute url")));!(0,ct.oP)(r)&&i?.blockedRelativeUrls&&i.blockedRelativeUrls.push(r);const s=(0,ct.s2)(r);(0,Lt.i)(s)?i?.messages&&i.messages.push(new o.A("video-element:unsupported-video","video source cannot be an item resource")):e[n]=s}async _preProcessVideoUrl(t){if((0,ct.zs)(t))return(0,ct.yM)(t);try{return await(0,at.A)(t,{method:"head"}),t}catch{try{return(0,ct.yM)(t,!0)}catch{return t}}}async _loadVideo(t){"anonymous"!==t.crossOrigin&&(t.crossOrigin="anonymous",(0,ct.w8)(t.src)||(t.src=t.src));try{await(0,Dt.i)(t,(t=>this.addHandles(t,Ft))),this.autoplay&&await t.play().catch((t=>{throw console.error(t),t}))}finally{this.removeHandles(Ft)}}};(0,i._)([(0,c.MZ)()],Gt.prototype,"autoplay",void 0),(0,i._)([(0,c.MZ)({readOnly:!0})],Gt.prototype,"content",void 0),(0,i._)([(0,c.MZ)({readOnly:!0})],Gt.prototype,"contentWidth",null),(0,i._)([(0,c.MZ)({readOnly:!0})],Gt.prototype,"contentHeight",null),(0,i._)([(0,c.MZ)({type:Number})],Gt.prototype,"currentTime",null),(0,i._)([(0,c.MZ)({type:Number})],Gt.prototype,"duration",null),(0,i._)([(0,c.MZ)(Pt)],Gt.prototype,"video",null),(0,i._)([(0,p.K)("video")],Gt.prototype,"writeVideo",null),(0,i._)([(0,c.MZ)(At)],Gt.prototype,"type",void 0),Gt=(0,i._)([(0,d.$)("esri.layers.support.VideoElement")],Gt);const Ut={key:"type",defaultKeyValue:"image",base:Rt,typeMap:{image:Zt,video:Gt}},Kt=r.A.ofType(Ut);let Jt=class extends(dt.A.LoadableMixin(Xt.A.EsriPromiseMixin(Ct.A.EventedAccessor))){constructor(t){super(t),this._index=new Nt.F,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=t=>{for(const n of t.removed){const t=this._elementViewsMap.get(n);this._elementViewsMap.delete(n),this._index.delete(t),this.removeHandles(t),t.destroy(),this.notifyChange("fullExtent")}const{spatialReference:e}=this;for(const n of t.added){if(this._elementViewsMap.get(n))continue;const t=new $t({spatialReference:e,element:n});this._elementViewsMap.set(n,t);const i=(0,Yt.wB)((()=>t.coords),(()=>this._updateIndexForElement(t,!1)));this._updateIndexForElement(t,!0),this.addHandles(i,t)}this._elementsIndexes.clear(),this.elements.forEach(((t,e)=>this._elementsIndexes.set(t,e))),this.emit("refresh")},this.elements=new Kt}async load(t){if((0,l.Te)(t),!this.spatialReference){const t=this.elements.find((t=>null!=t.georeference?.coords));this._set("spatialReference",t?t.georeference.coords.spatialReference:Y.A.WGS84)}return this._elementsChangedHandler({added:this.elements.items,removed:[]}),this.addHandles(this.elements.on("change",this._elementsChangedHandler)),this}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear()}set elements(t){this._set("elements",(0,jt.V)(t,this._get("elements"),Kt))}get fullExtent(){if("not-loaded"===this.loadStatus)return null;const t=this._index.fullBounds;return null==t?null:new pt.A({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:this.spatialReference})}set spatialReference(t){"not-loaded"===this.loadStatus?this._set("spatialReference",t):s.A.getLogger(this).error("#spatialReference","spatialReference cannot be changed after the source is loaded.")}async queryElements(t,e){await this.load(),await(0,X.initializeProjection)(t.spatialReference,this.spatialReference,null,e);const n=(0,ft.aI)(t.spatialReference,this.spatialReference)?t:(0,X.project)(t,this.spatialReference);if(!n)return[];const i=n.normalize(),r=[];for(const o of i)this._index.forEachInBounds((0,qt.VY)(o),(({normalizedCoords:t,element:e})=>{null!=t&&(0,zt.fA)(o,t)&&r.push(e)}));return r.sort(((t,e)=>this._elementsIndexes.get(t)-this._elementsIndexes.get(e))),r}hasElement(t){return this.elements.includes(t)}_updateIndexForElement(t,e){const n=t.normalizedBounds,i=this._index.has(t),r=null!=n;this._index.delete(t),r&&this._index.set(t,n),this.notifyChange("fullExtent"),e||(i!==r?this.emit("refresh"):this.emit("change",{element:t.element}))}};(0,i._)([(0,c.MZ)()],Jt.prototype,"elements",null),(0,i._)([(0,c.MZ)({readOnly:!0})],Jt.prototype,"fullExtent",null),(0,i._)([(0,c.MZ)()],Jt.prototype,"spatialReference",null),Jt=(0,i._)([(0,d.$)("esri.layers.support.LocalMediaElementSource")],Jt);var Qt=n(29759);let te=class extends((0,y.dM)((0,x.j)((0,_.q)((0,g.A)((0,a.P)(m.A)))))){constructor(t){super(t),this.effectiveSource=null,this.georeference=null,this.copyright=null,this.operationalLayerType="MediaLayer",this.spatialReference=null,this.type="media",this._debouncedSaveOperations=(0,l.sg)((async(t,e,i)=>{const{save:r,saveAs:o}=await n.e(84022).then(n.bind(n,61641));switch(t){case Qt.X.SAVE:return r(this,e);case Qt.X.SAVE_AS:return o(this,i,e)}})),this.source=new Jt}load(t){return this.addResolvingPromise(this._doLoad(t)),Promise.resolve(this)}async _doLoad(t){await this.loadFromPortal({supportedTypes:["Media Layer"]},t);let e=this.source;if(!e)throw new o.A("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer.");const n=this._getSourceOverride(e,this.georeference);n&&(this.setAtOrigin("source",n,"web-map"),this.setAtOrigin("source",n,"web-scene"),e=n);const i=Tt(e)?new Jt({elements:new r.A([e])}):e;this._set("effectiveSource",i),this.spatialReference&&(i.spatialReference=this.spatialReference),await i.load(t),this.spatialReference=i.spatialReference}destroy(){this.effectiveSource?.destroy(),this.effectiveSource!==this.source&&this.source?.destroy()}readGeoreference(t,e){return t&&"itemId"in e&&e.itemId?t:void 0}get fullExtent(){return this.loaded?this.effectiveSource.fullExtent:null}get source(){return this._get("source")}set source(t){"loaded"!==this.loadStatus&&"failed"!==this.loadStatus?this._set("source",t):s.A.getLogger(this).error("#source","source cannot be changed after the layer is loaded.")}castSource(t){return t?Array.isArray(t)?new Jt({elements:new r.A(t)}):t instanceof r.A?new Jt({elements:t}):t:null}readSource(t,e,n){if("itemId"in e&&e.itemId)return;const i=this._createSource(e);return i?.read(e,n),i}writeSource(t,e,n,i){if(t&&t instanceof Jt){const e=t.elements.length;if(1!==e)return void(i?.messages&&i.messages.push(new o.A("media-layer:unsupported-source",`local media element source can only be persisted if it contains exactly one ImageElement, but it has ${e}.`)));t=t.elements.at(0)}Tt(t)?t.write(e,i):i?.messages&&(t?i.messages.push(new o.A("media-layer:unsupported-source","only media elements of type 'ImageElement' or 'VideoElement' can be persisted")):i.messages.push(new o.A("media-layer:unsupported-source","the media layer is missing a source")))}async save(t){return this._debouncedSaveOperations(Qt.X.SAVE,t)}async saveAs(t,e){return this._debouncedSaveOperations(Qt.X.SAVE_AS,e,t)}_createSource(t){if("mediaType"in t)switch(t.mediaType){case"image":return new Zt;case"video":return new Gt}return null}_getSourceOverride(t,e){if(Tt(t)&&this.originIdOf("source")===f.Gr.PORTAL_ITEM&&e&&(this.originIdOf("georeference")===f.Gr.WEB_MAP||this.originIdOf("georeference")===f.Gr.WEB_SCENE)){const n=t.toJSON(),i=this._createSource(n);return i.read({...n},{origin:"portal-item"}),i.read({georeference:e},{origin:"web-map"}),i.read({georeference:e},{origin:"web-scene"}),i}return null}};(0,i._)([(0,c.MZ)({readOnly:!0})],te.prototype,"effectiveSource",void 0),(0,i._)([(0,c.MZ)({readOnly:!0,json:{read:!1,write:!1,origins:{"web-document":{read:!0}}}})],te.prototype,"georeference",void 0),(0,i._)([(0,h.w)("web-document","georeference")],te.prototype,"readGeoreference",null),(0,i._)([(0,c.MZ)({type:String})],te.prototype,"copyright",void 0),(0,i._)([(0,c.MZ)({readOnly:!0})],te.prototype,"fullExtent",null),(0,i._)([(0,c.MZ)({type:["MediaLayer"]})],te.prototype,"operationalLayerType",void 0),(0,i._)([(0,c.MZ)({type:["show","hide"]})],te.prototype,"listMode",void 0),(0,i._)([(0,c.MZ)({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1,target:{url:{type:String},mediaType:{type:["image","video"]},georeference:{type:$}},overridePolicy(t,e,n){return{enabled:!0,allowNull:!1,ignoreOrigin:bt(this,n?.origin)&&Tt(t)&&!!t.georeference&&t.originIdOf("georeference")>f.Gr.PORTAL_ITEM}}}}})],te.prototype,"source",null),(0,i._)([(0,u.w)("source")],te.prototype,"castSource",null),(0,i._)([(0,h.w)("source",["url"])],te.prototype,"readSource",null),(0,i._)([(0,p.K)("source")],te.prototype,"writeSource",null),(0,i._)([(0,c.MZ)()],te.prototype,"spatialReference",void 0),(0,i._)([(0,c.MZ)({readOnly:!0})],te.prototype,"type",void 0),te=(0,i._)([(0,d.$)("esri.layers.MediaLayer")],te);const ee=te},64411:(t,e,n)=>{n.d(e,{F:()=>l});var i=n(6273),r=n(21120),o=n(2532);const s={minX:0,minY:0,maxX:0,maxY:0};function a(t,e,n){(function(t){s.minX=t[0],s.minY=t[1],s.maxX=t[2],s.maxY=t[3]})(e),t.search(s,n)}class l{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new r.w(9,(0,i.A)("esri-csp-restrictions")?t=>({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const t=new Array(this._idByBounds.size);let e=0;this._idByBounds.forEach(((n,i)=>{t[e++]=i})),this._indexInvalid=!1,this._index.clear(),this._index.load(t)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((t=>this._idByBounds.has(t)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const t=(0,o.Ie)();for(const e of this._boundsById.values())e&&(t[0]=Math.min(e[0],t[0]),t[1]=Math.min(e[1],t[1]),t[2]=Math.max(e[2],t[2]),t[3]=Math.max(e[3],t[3]));return t}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(t){const e=this._boundsById.get(t);this._boundsById.delete(t),e&&(this._idByBounds.delete(e),this._indexInvalid||this._index.remove(e))}forEachInBounds(t,e){this._loadIndex(),a(this._index,t,(t=>e(this._idByBounds.get(t))))}get(t){return this._boundsById.get(t)}has(t){return this._boundsById.has(t)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(t,e){if(!this._indexInvalid){const e=this._boundsById.get(t);e&&(this._index.remove(e),this._idByBounds.delete(e))}this._boundsById.set(t,e),e&&(this._idByBounds.set(e,t),this._indexInvalid||(this._boundsToLoad.push(e),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},40102:(t,e,n)=>{n.d(e,{i:()=>r});var i=n(92840);function r(t,e){return new Promise(((n,r)=>{t.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?n():(e((0,i.Oo)(t,"canplay",n)),e((0,i.Oo)(t,"error",r)))}))}},80925:(t,e,n)=>{n.d(e,{n:()=>r});var i=n(19759);function r(t){return o[function(t){return"json"===t.type?"application/json":"blob"===t.type?t.blob.type:function(t){const e=(0,i.Zo)(t);return l[e]||s}(t.url)}(t)]||a}const o={},s="text/plain",a=o[s],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const c in l)o[l[c]]=c},29759:(t,e,n)=>{var i;n.d(e,{X:()=>i}),function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"}(i||(i={}))}}]);