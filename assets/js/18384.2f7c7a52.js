"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[18384,78367,15878],{76027:(e,t,r)=>{r.r(t),r.d(t,{default:()=>xe});var i=r(66866),s=r(24793),n=r(48982),a=r(98849),o=r(6412),l=r(82256),u=r(35775),d=r(40189),p=r(85251),y=r(76859),c=r(20909),h=r(21564),f=(r(39831),r(539)),b=(r(9272),r(75094)),m=r(63863),g=r(68833),w=r(50193),v=r(45681),_=r(15305),F=r(16161),T=r(54576),I=r(46602),M=r(75826),A=r(41506),S=r(34722),Z=r(50508),j=r(25389),O=r(90826),x=r(16123),C=r(76592),E=r(52506),P=r(77567),q=r(42453),k=r(775),L=r(84366),R=r(17671),U=r(76589),$=r(47347),G=r(2692),D=r(77573),V=r(55056);const N={key:"type",base:U.A,errorContext:"renderer",typeMap:{simple:$.A,"unique-value":G.A,"class-breaks":R.A}},Q=(0,L.C)({types:N});const B=["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"];var H=r(56542),J=r(65667),K=r(19251),X=r(45307),W=r(6267),z=r(76724),Y=r(77542),ee=r(73324),te=r(98801),re=r(78983),ie=r(48330),se=r(61826),ne=r(79682),ae=r(15878),oe=r(14474),le=r(44116),ue=r(26207),de=r(56530);const pe=(0,P.p)();let ye=0;function ce(e,t){let r=e.json.write;return"object"!=typeof r&&(r=e.json.write={}),r.ignoreOrigin=!0,t?.spatialOnly&&(r.layerContainerTypes=ee.K),e}function he(e){const t={write:{ignoreOrigin:!0}};return e?.name&&(t.name=e.name),"object"==typeof t.write&&(e?.spatialOnly&&(t.write.layerContainerTypes=ee.K),e?.target&&(t.write.target=e.target)),t}function fe(e){switch(e){case"point":case"multipoint":return ue.UK.clone();case"polyline":return ue.A7.clone();case"polygon":case"multipatch":return ue.Cx.clone();default:return null}}function be(e,t){return null==e?null:t.subtypes?.find((t=>t.code===e))}function me(e,t){let r=null;switch(t.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":r="point";break;case"esriGeometryPolyline":r="line";break;case"esriGeometryPolygon":case"esriGeometryMultiPatch":r="polygon";break;default:t.type,r=null}const i={},s=be(e,t);if(null!=s){const{defaultValues:e}=s;for(const t in e)i[t]=e[t]}return i[t.subtypeField]=e,new ie.A({name:"New Feature",drawingTool:r,prototype:{attributes:i}})}let ge=class extends((0,u.P)(s.A.ClonableMixin(J.A.IdentifiableMixin(X.A)))){constructor(e){super(e),this.attributeTableTemplate=null,this.charts=null,this.editingEnabled=!0,this.fieldOverrides=null,this.fieldsIndex=null,this.formTemplate=null,this.id=`${Date.now().toString(16)}-subtype-sublayer-${ye++}`,this.type="subtype-sublayer",this.labelsVisible=!0,this.labelingInfo=null,this.layerType="ArcGISFeatureLayer",this.legendEnabled=!0,this.listMode="show",this.minScale=0,this.maxScale=0,this.opacity=1,this.parent=null,this.popupEnabled=!0,this.popupTemplate=null,this.subtypeCode=null,this.templates=null,this.title=null,this.visible=!0}load(e){return(0,q.yp)(this.renderer,this.fieldsIndex),Promise.resolve(this)}get _titleCreator(){const e=this._get("_titleCreator");return(0,W.pR)(e),new ae.A({fieldsIndex:this.fieldsIndex,objectIdField:this.objectIdField,displayField:this.parent?.displayField??"",fields:this.fields,effectivePopupTemplate:this.popupTemplate??this.defaultPopupTemplate})}get capabilities(){return this.parent?.capabilities}get effectiveCapabilities(){return this.parent?.effectiveCapabilities}get effectiveEditingEnabled(){const{parent:e}=this;return e?e.effectiveEditingEnabled&&this.editingEnabled:this.editingEnabled}get elevationInfo(){return this.parent?.elevationInfo}get featureTitleFields(){return[...this._titleCreator.requiredFields]}writeFieldOverrides(e,t,r){const{fields:i,parent:s}=this;let n;if(i){n=[];let e=0;i.forEach((({name:t,alias:r,editable:i,visible:a})=>{if(!a)return;const o=s?.fields?.find((e=>e.name===t));if(!o)return;const l={name:t};let u=!1;r!==o.alias&&(l.alias=r,u=!0),i!==o.editable&&(l.editable=i,u=!0),n.push(l),u&&e++})),0===e&&n.length===i.length&&(n=null)}else n=(0,K.o8)(e);n?.length&&(0,z.sM)(r,n,t)}get fields(){const{parent:e,fieldOverrides:t,subtypeCode:r}=this,i=e?.fields;if(!e||!i?.length)return null;const{subtypes:s,subtypeField:n}=e,a=s?.find((e=>e.code===r)),o=a?.defaultValues,l=a?.domains,u=[];for(const d of i){const e=d.clone(),{name:i}=e,s=t?.find((e=>e.name===i));if(e.visible=!t?.length||!!s,s){const{alias:t,editable:r}=s;t&&(e.alias=t),!1===r&&(e.editable=!1)}const a=o?.[i]??null;e.defaultValue=i===n?r:a;const p=l?.[i]??null;e.domain=i===n?null:p?"inherited"===p.type?e.domain:p.clone():null,u.push(e)}return u}get floorInfo(){return this.parent?.floorInfo}get isTable(){return!!this.parent?.isTable}get geometryType(){return this.parent?.geometryType}get globalIdField(){return this.parent?this.parent.globalIdField:(f.A.getLogger(this).error(_e("globalIdField")),null)}get effectiveScaleRange(){const{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}get objectIdField(){return this.parent||f.A.getLogger(this).error(_e("objectIdField")),this.parent?.objectIdField}get defaultPopupTemplate(){return this.createPopupTemplate()}get relationships(){return this.parent?.relationships}set renderer(e){(0,q.yp)(e,this.fieldsIndex),this._override("renderer",e)}get renderer(){if(this._isOverridden("renderer"))return this._get("renderer");const{parent:e}=this;return e&&!e.isTable&&"mesh"!==e.geometryType?function(e){return new $.A({symbol:fe(e)})}(e.geometryType):null}readRendererFromService(e,t,r){if("Table"===t.type)return null;const i=t.drawingInfo?.renderer,s=Q(i,t,r);let n;const{subtypeCode:a}=this;if(null!=a&&function(e,t){return!(!t||"unique-value"!==e?.type||null==e.field||e.field.toLowerCase()!==t.toLowerCase()||e.field2||e.field3||e.valueExpression)}(s,t.subtypeField)){const e=s.uniqueValueInfos?.find((({value:e})=>(e="number"==typeof e?String(e):e)===String(a)));e&&(n=new $.A({symbol:e.symbol}))}else"simple"!==s?.type||s.visualVariables?.length||(n=s);return n}readRenderer(e,t,r){const i=t?.layerDefinition?.drawingInfo?.renderer;if(!i)return;const s=i.visualVariables?.some((e=>"rotationInfo"!==e.type));return s?void 0:Q(i,t,r)||void 0}get spatialReference(){return this.parent?.spatialReference??re.A.WGS84}get subtypeField(){return this.parent?.subtypeField}readTemplatesFromService(e,t){return[me(this.subtypeCode,t)]}readTitleFromService(e,t){const r=be(this.subtypeCode,t);return null!=r?r.name:null}get url(){return this.parent?.url}get userHasUpdateItemPrivileges(){return!!this.parent?.userHasUpdateItemPrivileges}async addAttachment(e,t){const{parent:r}=this;if(!r)throw _e("addAttachment");if(e.getAttribute(r.subtypeField)!==this.subtypeCode)throw new a.A("subtype-sublayer:addAttachment","The feature provided does not belong to this SubtypeSublayer");return r.addAttachment(e,t)}async updateAttachment(e,t,r){const{parent:i}=this;if(!i)throw _e("updateAttachment");if(e.getAttribute(i.subtypeField)!==this.subtypeCode)throw new a.A("subtype-sublayer:updateAttachment","The feature provided does not belong to this SubtypeSublayer");return i.updateAttachment(e,t,r)}async deleteAttachments(e,t){const{parent:r}=this;if(!r)throw _e("deleteAttachments");if(e.getAttribute(r.subtypeField)!==this.subtypeCode)throw new a.A("subtype-sublayer:deleteAttachments","The feature provided does not belong to this SubtypeSublayer");return r.deleteAttachments(e,t)}async applyEdits(e,t){if(!this.parent)throw _e("applyEdits");return this.parent.applyEdits(e,t)}createPopupTemplate(e){let t=this;const{parent:r,fields:i,title:s}=this;if(r){const{displayField:e,editFieldsInfo:n,objectIdField:a}=r;t={displayField:e,editFieldsInfo:n,fields:i,objectIdField:a,title:s}}return(0,le.tn)(t,e)}createQuery(){if(!this.parent)throw _e("createQuery");const e=(0,E.VZ)(this.parent),t=`${this.parent.subtypeField}=${this.subtypeCode}`;return e.where=(0,y.mA)(t,this.parent.definitionExpression),e}getFeatureTitle(e,t){return this._titleCreator.getTitle(this,e,t)}getFeatureTitles(e,t){return this._titleCreator.getTitles(this,e,t)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){if(!t?.excludeImpliedDomains&&this.parent){const t=(0,E.pc)(this.parent,e);if(t)return t}return this._getLayerDomain(e)}async queryAttachments(e,t){const r=await this.load();if(!r.parent)throw _e("queryAttachments");const i=e.clone();return i.where=ve(i.where,r.parent.subtypeField,r.subtypeCode),r.parent.queryAttachments(e,t)}async queryFeatureCount(e,t){const r=await this.load();if(!r.parent)throw _e("queryFeatureCount");return r.parent.queryFeatureCount(we(r.parent,r,e),t)}async queryFeatures(e,t){const r=await this.load();if(!r.parent)throw _e("queryFeatures");return r.parent.queryFeatures(we(r.parent,r,e),t)}async queryObjectIds(e,t){const r=await this.load();if(!r.parent)throw _e("queryObjectIds");return r.parent.queryObjectIds(we(r.parent,r,e),t)}async queryRelatedFeatures(e,t){const r=await this.load();if(!r.parent)throw _e("queryRelatedFeatures");return r.parent.queryRelatedFeatures(e,t)}async queryRelatedFeaturesCount(e,t){const r=await this.load();if(!r.parent)throw _e("queryRelatedFeaturesCount");return r.parent.queryRelatedFeaturesCount(e,t)}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}};(0,i._)([(0,h.MZ)({clonable:!1,readOnly:!0})],ge.prototype,"_titleCreator",null),(0,i._)([(0,h.MZ)({type:de.A,json:he({name:"attributeTableInfo"})})],ge.prototype,"attributeTableTemplate",void 0),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"capabilities",null),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"effectiveCapabilities",null),(0,i._)([(0,h.MZ)({json:he()})],ge.prototype,"charts",void 0),(0,i._)([(0,h.MZ)({type:Boolean,nonNullable:!0,json:he({name:"enableEditing"})})],ge.prototype,"editingEnabled",void 0),(0,i._)([(0,h.MZ)({type:Boolean,readOnly:!0})],ge.prototype,"effectiveEditingEnabled",null),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"elevationInfo",null),(0,i._)([(0,h.MZ)({clonable:!1,readOnly:!0})],ge.prototype,"featureTitleFields",null),(0,i._)([(0,h.MZ)({json:{name:"layerDefinition.fieldOverrides",origins:{service:{read:!1}},write:{ignoreOrigin:!0,allowNull:!0}}})],ge.prototype,"fieldOverrides",void 0),(0,i._)([(0,Y.K)("fieldOverrides")],ge.prototype,"writeFieldOverrides",null),(0,i._)([(0,h.MZ)({...pe.fields,readOnly:!0,json:{read:!1}})],ge.prototype,"fields",null),(0,i._)([(0,h.MZ)(pe.fieldsIndex)],ge.prototype,"fieldsIndex",void 0),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"floorInfo",null),(0,i._)([(0,h.MZ)({type:te.A,json:he({name:"formInfo"})})],ge.prototype,"formTemplate",void 0),(0,i._)([(0,h.MZ)({type:String,clonable:!1,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],ge.prototype,"id",void 0),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"isTable",null),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"geometryType",null),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"globalIdField",null),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"type",void 0),(0,i._)([(0,h.MZ)(ce((0,K.o8)(C.kF)))],ge.prototype,"labelsVisible",void 0),(0,i._)([(0,h.MZ)({type:[se.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",origins:{service:{read:!1}},read:{reader:ne.w},write:{ignoreOrigin:!0,layerContainerTypes:ee.K}}})],ge.prototype,"labelingInfo",void 0),(0,i._)([(0,h.MZ)({type:["ArcGISFeatureLayer"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,layerContainerTypes:ee.K}}})],ge.prototype,"layerType",void 0),(0,i._)([(0,h.MZ)(ce((0,K.o8)(C.fV)))],ge.prototype,"legendEnabled",void 0),(0,i._)([(0,h.MZ)({type:["show","hide"]})],ge.prototype,"listMode",void 0),(0,i._)([(0,h.MZ)((()=>{const e=(0,K.o8)(C.hn);return e.json.origins.service.read=!1,ce(e,{spatialOnly:!0})})())],ge.prototype,"minScale",void 0),(0,i._)([(0,h.MZ)((()=>{const e=(0,K.o8)(C.hG);return e.json.origins.service.read=!1,ce(e,{spatialOnly:!0})})())],ge.prototype,"maxScale",void 0),(0,i._)([(0,h.MZ)({readOnly:!0})],ge.prototype,"effectiveScaleRange",null),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"objectIdField",null),(0,i._)([(0,h.MZ)({type:Number,range:{min:0,max:1},nonNullable:!0,json:he({spatialOnly:!0})})],ge.prototype,"opacity",void 0),(0,i._)([(0,h.MZ)({clonable:!1})],ge.prototype,"parent",void 0),(0,i._)([(0,h.MZ)(ce((0,K.o8)(C.M6)))],ge.prototype,"popupEnabled",void 0),(0,i._)([(0,h.MZ)({type:H.A,json:he({name:"popupInfo"})})],ge.prototype,"popupTemplate",void 0),(0,i._)([(0,h.MZ)({readOnly:!0})],ge.prototype,"defaultPopupTemplate",null),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"relationships",null),(0,i._)([(0,h.MZ)({types:N,json:he({target:"layerDefinition.drawingInfo.renderer",spatialOnly:!0})})],ge.prototype,"renderer",null),(0,i._)([(0,b.w)("service","renderer",["drawingInfo.renderer","subtypeField","type"])],ge.prototype,"readRendererFromService",null),(0,i._)([(0,b.w)("renderer",["layerDefinition.drawingInfo.renderer"])],ge.prototype,"readRenderer",null),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"spatialReference",null),(0,i._)([(0,h.MZ)({type:Number,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],ge.prototype,"subtypeCode",void 0),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"subtypeField",null),(0,i._)([(0,h.MZ)({type:[ie.A],json:he({name:"layerDefinition.templates"})})],ge.prototype,"templates",void 0),(0,i._)([(0,b.w)("service","templates",["geometryType","subtypeField","subtypes","type"])],ge.prototype,"readTemplatesFromService",null),(0,i._)([(0,h.MZ)({type:String,json:he()})],ge.prototype,"title",void 0),(0,i._)([(0,b.w)("service","title",["subtypes"])],ge.prototype,"readTitleFromService",null),(0,i._)([(0,h.MZ)({readOnly:!0,json:{read:!1}})],ge.prototype,"url",null),(0,i._)([(0,h.MZ)({readOnly:!0})],ge.prototype,"userHasUpdateItemPrivileges",null),(0,i._)([(0,h.MZ)({type:Boolean,nonNullable:!0,json:he({name:"visibility",spatialOnly:!0})})],ge.prototype,"visible",void 0),ge=(0,i._)([(0,m.$)("esri.layers.support.SubtypeSublayer")],ge);const we=(e,t,r)=>{if(!r)return t.createQuery();const i=oe.A.from(r);return i.where=ve(i.where,e.subtypeField,t.subtypeCode),i},ve=(e,t,r)=>{const i=new RegExp(`${t}\\s*=\\s*\\d+`),s=`${t}=${r}`,n=e??"";return i.test(n)?n.replace(i,s):(0,y.mA)(s,n)},_e=e=>new a.A("subtype-sublayer:parent-missing",`This sublayer must have a parent SubtypeGroupLayer in order to use ${e}`);var Fe=r(83849),Te=r(93797),Ie=r(8701),Me=r(15954);const Ae="SubtypeGroupLayer";function Se(e,t){return new a.A("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function Ze(e,t){const r=[];for(const i of e){const e=new ge;e.read(i,t),r.push(e)}return r}const je=(0,P.p)();let Oe=class extends((0,M.j)((0,T.FJ)((0,I.w6)((0,_.dM)((0,O.e)((0,j.j)((0,Z.J)((0,v.b)((0,A.q)((0,S.A)((0,u.P)((0,F.d)((0,w.p)(s.A.ClonableMixin(g.A))))))))))))))){constructor(...e){super(...e),this._sublayerLookup=new Map,this.fields=null,this.fieldsIndex=null,this.outFields=null,this.sublayers=new(n.A.ofType(ge)),this.useUniqueColorsForSublayers=!0,this.supportedSourceTypes=new Set(["Feature Layer","Table"]),this.timeInfo=null,this.title="Layer",this.type="subtype-group",this._debouncedSaveOperations=(0,d.sg)((async(e,t,i)=>{const{save:s,saveAs:n}=await r.e(77610).then(r.bind(r,77610));switch(e){case Me.X.SAVE:return s(this,t);case Me.X.SAVE_AS:return n(this,i,t)}})),this.addHandles((0,p.wB)((()=>this.sublayers),((e,t)=>this._handleSublayersChange(e,t)),p.OH))}destroy(){this.source?.destroy()}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=null!=e?e.signal:null,r=this.loadFromPortal({supportedTypes:["Feature Service"]},e).catch(d.QP).then((async()=>{if(!this.url)throw new a.A("subtype-grouplayer:missing-url-or-source","SubtypeGroupLayer must be created with either a url or a portal item");if(null==this.layerId)throw new a.A("subtype-grouplayer:missing-layerid","layerId is required for a SubtypeGroupLayer created with url");return this._initLayerProperties(await this.createGraphicsSource(t))})).then((()=>(0,E.VA)(this,"load",e)));return this.addResolvingPromise(r),Promise.resolve(this)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return this.loaded&&null!=this.capabilities&&this.capabilities.operations.supportsEditing&&this.userHasEditingPrivileges}get effectiveEditingEnabled(){return(0,E.C$)(this)}get operationalLayerType(){return this.isTable?"SubtypeGroupTable":"SubtypeGroupLayer"}get parsedUrl(){const e=(0,c.An)(this.url);return null!=e&&null!=this.layerId&&(e.path=(0,c.fj)(e.path,this.layerId.toString())),e}set source(e){this._get("source")!==e&&this._set("source",e)}readTitleFromService(e,{name:t}){return this.url?(0,x.yG)(this.url,t):t}async addAttachment(e,t){const r=await(0,E.Xl)(this,e,t,Ae);return this.lastEditsEventDate=new Date,r}async updateAttachment(e,t,r){const i=await(0,E.bt)(this,e,t,r,Ae);return this.lastEditsEventDate=new Date,i}async applyEdits(e,t){return(0,E.ct)(this,e,t)}on(e,t){return super.on(e,t)}async createGraphicsSource(e){const{default:t}=await(0,d.qr)(Promise.all([r.e(72076),r.e(47753),r.e(15524)]).then(r.bind(r,15524)),e);return new t({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:e})}createQuery(){const e=(0,E.VZ)(this),t=this.sublayers.map((e=>e.subtypeCode));return e.where=(0,y.mA)(`${this.subtypeField} IN (${t.join(",")})`,this.definitionExpression),e}async deleteAttachments(e,t){const r=await(0,E.mm)(this,e,t,Ae);return this.lastEditsEventDate=new Date,r}async fetchRecomputedExtents(e){return(0,E.WP)(this,e,Ae)}findSublayerForFeature(e){const t=this.fieldsIndex.get(this.subtypeField),r=e.attributes[t.name];return this.findSublayerForSubtypeCode(r)}findSublayerForSubtypeCode(e){return this._sublayerLookup.get(e)}getFieldDomain(e,t){if(!t?.excludeImpliedDomains){const t=(0,E.pc)(this,e);if(t)return t}const r=(0,E.Nv)(this,t?.feature);if(r){const t=r.domains?.[e];return"inherited"===t?.type?this._getLayerDomain(e):t}return this._getLayerDomain(e)}loadAll(){return(0,o.g)(this,(e=>{e(this.sublayers)}))}async queryAttachments(e,t){return(0,E.lV)(this,e,t,Ae)}async queryFeatures(e,t){const r=await this.load(),i=oe.A.from(e)??r.createQuery(),s=i.outFields??[];s.includes(this.subtypeField)||(s.push(this.subtypeField),i.outFields=s);const n=await r.source.queryFeatures(i,t);if(n?.features)for(const a of n.features)a.layer=a.sourceLayer=this.findSublayerForFeature(a);return n}async queryObjectIds(e,t){return(await(0,E.sg)(this,e,t,Ae)).filter(Ie.Et)}async queryFeatureCount(e,t){return(0,E.Ye)(this,e,t,Ae)}async queryExtent(e,t){return(0,E.B5)(this,e,t,Ae)}async queryRelatedFeatures(e,t){return(0,E.hM)(this,e,t,Ae)}async queryRelatedFeaturesCount(e,t){return(0,E.S2)(this,e,t,Ae)}async save(e){return this._debouncedSaveOperations(Me.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(Me.X.SAVE_AS,t,e)}write(e,t){const{origin:r,layerContainerType:i,messages:s}=t;if(this.isTable){if("web-scene"===r||"web-map"===r&&"tables"!==i)return s?.push(Se(this,"using a table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&"web-map"===r&&"tables"===i)return s?.push(Se(this,"using a non-table source cannot be written to tables in web maps")),null;return this.sublayers?.length?super.write(e,t):(s?.push(new a.A("web-document-write:invalid-property",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' has invalid value for 'sublayers' property. 'sublayers' collection should contain at least one sublayer`,{layer:this})),null)}serviceSupportsSpatialReference(e){return!!this.loaded&&(0,Te.D)(this,e)}async getFeatureTitle(e,t){const r=this.findSublayerForFeature(e);return r?await r.getFeatureTitle(e,t):this._getFeatureTitleForUnknownSublayer(e)}async getFeatureTitles(e,t){const r=new Map,i=new Map,s=[i];e.forEach((e=>{const t=this.findSublayerForFeature(e);if(t)(0,l.tE)(r,t,(()=>[])).push(e);else{const t=e.getObjectId()??e.attributes[this.objectIdField];i.set(t,this._getFeatureTitleForUnknownSublayer(e))}}));const n=await Promise.all(Array.from(r).map((([e,r])=>e.getFeatureTitles(r,t))));return n.forEach((e=>s.push(e))),new Map(s.flatMap((e=>[...e])))}get featureTitleFields(){const e=new Set;for(const t of this.sublayers){const r=t.featureTitleFields;for(const t of r)e.add(t)}return[...e]}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}async _initLayerProperties(e){this._set("source",e);const{sourceJSON:t}=e;if(t&&(this.sourceJSON=t,this.read(t,{origin:"service",url:this.parsedUrl})),!this.subtypes?.length)throw new a.A("subtype-grouplayer:missing-subtypes","SubtypeGroupLayer must be created using a layer with subtypes");this._verifyFields(),(0,q.sv)(this.timeInfo,this.fieldsIndex)}async hasDataChanged(){return(0,E.jp)(this)}_verifyFields(){const e=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("SubtypeGroupLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||-1!==e.search(/\/FeatureServer\//i)||this.fields?.some((e=>"geometry"===e.type))||console.log("SubtypeGroupLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_handleSublayersChange(e,t){t&&(t.forEach((e=>{e.parent=null})),this.removeHandles("sublayers-owner"),this._sublayerLookup.clear()),e&&(e.forEach((e=>{e.parent=this,this._sublayerLookup.set(e.subtypeCode,e)})),this.addHandles([e.on("after-add",(({item:e})=>{e.parent=this,this._sublayerLookup.set(e.subtypeCode,e)})),e.on("after-remove",(({item:e})=>{e.parent=null,this._sublayerLookup.delete(e.subtypeCode)}))],"sublayers-owner"))}_getFeatureTitleForUnknownSublayer(e){const{displayField:t,fieldsIndex:r,objectIdField:i}=this;if(t&&r.has(t))return e.attributes[r.get(t).name]??"";const s=e.getObjectId();return null!=s?s.toString():i&&r.has(i)?e.attributes[r.get(i).name]??"":""}};(0,i._)([(0,h.MZ)({readOnly:!0})],Oe.prototype,"createQueryVersion",null),(0,i._)([(0,h.MZ)({readOnly:!0})],Oe.prototype,"editingEnabled",null),(0,i._)([(0,h.MZ)({readOnly:!0})],Oe.prototype,"effectiveEditingEnabled",null),(0,i._)([(0,h.MZ)({...je.fields,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Oe.prototype,"fields",void 0),(0,i._)([(0,h.MZ)(je.fieldsIndex)],Oe.prototype,"fieldsIndex",void 0),(0,i._)([(0,h.MZ)(C.id)],Oe.prototype,"id",void 0),(0,i._)([(0,h.MZ)({type:["show","hide","hide-children"],json:{origins:{"portal-item":{read:!1,write:!1}}}})],Oe.prototype,"listMode",void 0),(0,i._)([(0,h.MZ)({type:["SubtypeGroupLayer","SubtypeGroupTable"],json:{name:"layerType",read:{enabled:!0},write:{enabled:!0,ignoreOrigin:!0,isRequired:!0},origins:{"web-document":{name:"layerType",read:{enabled:!0},write:{enabled:!0,ignoreOrigin:!0,isRequired:!0}},"portal-item":{name:"layerType",read:{enabled:!0},write:{enabled:!0,ignoreOrigin:!0,isRequired:!0}}}}})],Oe.prototype,"operationalLayerType",null),(0,i._)([(0,h.MZ)(je.outFields)],Oe.prototype,"outFields",void 0),(0,i._)([(0,h.MZ)({readOnly:!0})],Oe.prototype,"parsedUrl",null),(0,i._)([(0,h.MZ)({clonable:!1})],Oe.prototype,"source",null),(0,i._)([(0,h.MZ)({type:n.A.ofType(ge),json:{origins:{service:{read:{source:"subtypes",reader(e,t,r){let i=null;if(this.useUniqueColorsForSublayers){const s=function(e,t){const r=e.drawingInfo?.renderer,i=r?Q(r,e,t):null;if("simple"===i?.type)return(0,V.Sx)(i.symbol,null)?i.symbol.clone():null}(t,r);i=s?function(e,t){return(0,k.Iy)(B,e,{offset:!0,shuffle:!0}).reverse().map((e=>{const r=t.clone();return"cim"===r.type?(0,D.Fe)(r,e):(0,V.dt)(r,e),new $.A({symbol:r})}))}(e.length,s):null}const s=e.map((({code:e},s)=>{const n=new ge({subtypeCode:e});n.read(t,r);const a=i?.[s];return a&&n.read({drawingInfo:{renderer:a.toJSON()}},r),n}));return new(n.A.ofType(ge))(s)}}}},read:{source:["layers","tables"],reader(e,t,r){let i;return"SubtypeGroupLayer"===t.layerType&&t.layers?.length?i=Ze(t.layers,r):"SubtypeGroupTable"===t.layerType&&t.tables?.length&&(i=Ze(t.tables,r)),new(n.A.ofType(ge))(i)}},write:{ignoreOrigin:!0,writer(e,t,r,i){const s=[];for(const n of e){const e=n.write({},i);s.push(e)}this.isTable?t.tables=s:t.layers=s}}}})],Oe.prototype,"sublayers",void 0),(0,i._)([(0,h.MZ)()],Oe.prototype,"useUniqueColorsForSublayers",void 0),(0,i._)([(0,h.MZ)({type:Fe.A})],Oe.prototype,"timeInfo",void 0),(0,i._)([(0,h.MZ)({json:{origins:{"portal-item":{write:{enabled:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}}}})],Oe.prototype,"title",void 0),(0,i._)([(0,b.w)("service","title",["name"])],Oe.prototype,"readTitleFromService",null),(0,i._)([(0,h.MZ)({json:{read:!1}})],Oe.prototype,"type",void 0),(0,i._)([(0,h.MZ)({clonable:!1,readOnly:!0})],Oe.prototype,"featureTitleFields",null),Oe=(0,i._)([(0,m.$)("esri.layers.SubtypeGroupLayer")],Oe);const xe=Oe},98350:(e,t,r)=>{r.d(t,{A:()=>p});var i=r(66866),s=r(24793),n=r(59851),a=r(21877),o=r(21564),l=(r(39831),r(539),r(9272),r(63863));const u=new n.J({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),d=new n.J({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let p=class extends(s.A.ClonableMixin(a.A)){constructor(e){super(e),this.cardinality=null,this.catalogId=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};(0,i._)([(0,o.MZ)({json:{read:u.read,write:u.write}})],p.prototype,"cardinality",void 0),(0,i._)([(0,o.MZ)({json:{name:"catalogID"}})],p.prototype,"catalogId",void 0),(0,i._)([(0,o.MZ)({json:{read:!0,write:!0}})],p.prototype,"composite",void 0),(0,i._)([(0,o.MZ)({json:{read:!0,write:!0}})],p.prototype,"id",void 0),(0,i._)([(0,o.MZ)({json:{read:!0,write:!0}})],p.prototype,"keyField",void 0),(0,i._)([(0,o.MZ)({json:{read:!0,write:!0}})],p.prototype,"keyFieldInRelationshipTable",void 0),(0,i._)([(0,o.MZ)({json:{read:!0,write:!0}})],p.prototype,"name",void 0),(0,i._)([(0,o.MZ)({json:{read:!0,write:!0}})],p.prototype,"relatedTableId",void 0),(0,i._)([(0,o.MZ)({json:{read:!0,write:!0}})],p.prototype,"relationshipTableId",void 0),(0,i._)([(0,o.MZ)({json:{read:d.read,write:d.write}})],p.prototype,"role",void 0),p=(0,i._)([(0,l.$)("esri.layers.support.Relationship")],p)},15878:(e,t,r)=>{r.d(t,{A:()=>y});var i=r(66866),s=r(52495),n=r(85569),a=r(12690),o=r(48982),l=r(21564),u=(r(39831),r(539),r(63863)),d=r(42453),p=r(35387);let y=class extends s.A{constructor(e){super(e),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){return this.expressionsUsedInTitle.length>0?this._get("_arcadeTask")||(0,a.UT)((()=>(0,p.l)())):null}get featureUtilsPromise(){return this._get("featureUtilsPromise")??Promise.all([r.e(72076),r.e(3769)]).then(r.bind(r,3769)).then((e=>this._featureUtils=e))}get calculatedExpressions(){const e=new o.A;if(!this.expressionsUsedInTitle.length)return e;if(!this._arcadeTask?.value){for(const t of this.expressionsUsedInTitle??[])e.push({name:t.name,invalid:!0});return e}for(const t of this.expressionsUsedInTitle)try{const r=this._arcadeTask.value.arcade.parseScript(t.expression,["$layer","$map","$datastore"]);if(r.isAsync){e.push({name:t.name,invalid:!0});break}e.push({name:t.name,syntax:r,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(r,{vars:{$feature:"any"}})})}catch{e.push({name:t.name,invalid:!0});break}return e}get expressionsUsedInTitle(){let e=this.effectivePopupTemplate?.title??"";return"string"!=typeof e?[]:(e=e.toLowerCase(),this.effectivePopupTemplate?.expressionInfos?.filter((t=>e.includes(`{expression/${t.name.toLowerCase()}}`)))??[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some((e=>!0===e.invalid))}get requiredFields(){const e=new Set;if(this._arcadeTask?.value&&!this.hasBadExpressions)for(const r of this.calculatedExpressions?.toArray()??[])try{const t=this._arcadeTask.value.arcade.extractFieldLiterals(r.syntax);for(const r of t){const t=r.split("."),i=this.fieldsIndex.get(t.at(-1)??"");i&&e.add(i.name)}}catch{}const t=this._extractFieldNames(this.workingTitle);for(const r of t){const t=this.fieldsIndex.get(r);t&&e.add(t.name)}return null!=this.objectIdField&&e.add(this.objectIdField),e}get titleFromDisplayField(){let e="";return this.displayField&&(e=this.fieldsIndex.get(this.displayField)?.name??""),e||(e=this.fieldsIndex.get(this.objectIdField)?.name??""),e?`{${e}}`:""}get workingTitle(){const e=this.effectivePopupTemplate?this.effectivePopupTemplate.title:"";return""===e||null==e||this.hasBadExpressions||"string"!=typeof e?this.titleFromDisplayField:e}async getTitle(e,t,r){const i=t.getObjectId()??t.attributes[e.objectIdField];return(await this.getTitles(e,[t],r)).get(i)??""}async getTitles(e,t,r){const i=new Map,s=r?.timeZone??"system";try{const[{substituteFieldsInLinksAndAttributes:n}]=await Promise.all([this.featureUtilsPromise,this._arcadeTask?.promise]);r?.fetchMissingFields&&(t=await this._checkAndReQueryGraphics(e,t));const{fieldInfoMap:a,workingTitle:o}=this,l=o&&a;t.forEach((t=>{const r=t.getObjectId()??t.attributes[e.objectIdField],u=l?n({attributes:t.attributes,expressionAttributes:null,fieldInfoMap:a,globalAttributes:this._createFormattedAttributes(e,t,s).global,layer:e,text:o}):"";i.set(r,u)}))}catch{}return i}async _checkAndReQueryGraphics(e,t){const r=t.map((t=>t.getObjectId()??t.attributes[e.objectIdField])).filter(n.Ru);if(r.length!==t.length)return t;if(t.some((e=>!(0,d.Kl)(e,this.requiredFields)))){const i=e.createQuery();i.where="1=1",i.outFields=[...this.requiredFields],i.objectIds=r;const s=await e.queryFeatures(i);if(s?.features.length===t.length)return s.features}return t}_createFieldInfoMap(e){const t=new Map;if(!e)return t;for(const r of e){if(!r.fieldName)continue;const e=this.fieldsIndex.get(r.fieldName),i=e?.name??r.fieldName;r.fieldName=i,t.set(i.toLowerCase(),r)}return t}_createFormattedAttributes(e,t,r="system"){const i=this.effectivePopupTemplate?.fieldInfos??[],s={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&this._arcadeTask?.value){const r=this._arcadeTask.value.Feature.createFromGraphicLikeObject(t.geometry,t.attributes,e,null);for(const e of this.calculatedExpressions)try{s[`expression/${e.name}`]=e.func({vars:{$feature:r}})}catch{}}const n={...t.attributes,...s};return{global:this._featureUtils.formatAttributes({fieldInfos:i,attributes:n,graphic:t,timeZone:r,layer:e,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(e){return(0,d.nw)(e).filter((e=>!(0===e.indexOf("relationships/")||0===e.indexOf("expression/"))))}};(0,i._)([(0,l.MZ)({readOnly:!0})],y.prototype,"_arcadeTask",null),(0,i._)([(0,l.MZ)()],y.prototype,"_featureUtils",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],y.prototype,"featureUtilsPromise",null),(0,i._)([(0,l.MZ)({readOnly:!0})],y.prototype,"calculatedExpressions",null),(0,i._)([(0,l.MZ)()],y.prototype,"displayField",void 0),(0,i._)([(0,l.MZ)()],y.prototype,"effectivePopupTemplate",void 0),(0,i._)([(0,l.MZ)()],y.prototype,"expressionsUsedInTitle",null),(0,i._)([(0,l.MZ)()],y.prototype,"fieldsIndex",void 0),(0,i._)([(0,l.MZ)()],y.prototype,"fieldInfoMap",null),(0,i._)([(0,l.MZ)()],y.prototype,"fields",void 0),(0,i._)([(0,l.MZ)()],y.prototype,"objectIdField",void 0),(0,i._)([(0,l.MZ)()],y.prototype,"requiredFields",null),y=(0,i._)([(0,u.$)("esri.layers.support.TitleCreator")],y)}}]);