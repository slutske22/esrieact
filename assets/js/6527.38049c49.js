"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6527],{44350:(e,t,i)=>{i.d(t,{I:()=>f,b:()=>m});var n=i(55274),a=i(1110),r=i(66012),s=i(80600),o=i(33448),l=i(89002),c=i(63592),h=i(35449),d=i(99152),p=i(4274),u=i(79856),_=i(81868),g=i(50645);function m(e){const t=new p.N5,{vertex:i,fragment:m}=t;return(0,c.NB)(i,e),t.include(r.d,e),t.attributes.add(g.r.POSITION,"vec3"),t.attributes.add(g.r.UV0,"vec2"),e.perspectiveInterpolation&&t.attributes.add(g.r.PERSPECTIVEDIVIDE,"float"),t.varyings.add("vpos","vec3"),e.multipassEnabled&&t.varyings.add("depth","float"),i.code.add(d.H`
    void main(void) {
      vpos = position;
      ${e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0;
      gl_Position = transformPosition(proj, view, vpos);

      ${e.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":""}
    }
  `),t.include(a.HQ,e),t.include(s.Q,e),m.uniforms.add(new u.N("tex",(e=>e.texture)),new h.m("opacity",(e=>e.opacity))),t.varyings.add("vTexCoord","vec2"),e.output===n.V.Alpha?m.code.add(d.H`
    void main() {
      discardBySlice(vpos);
      ${e.multipassEnabled?"terrainDepthTest(depth);":""}

      float alpha = texture(tex, vTexCoord).a * opacity;
      if (alpha  < ${d.H.float(o.H)}) {
        discard;
      }

      fragColor = vec4(alpha);
    }
    `):(m.include(l.a),m.code.add(d.H`
    void main() {
      discardBySlice(vpos);
      ${e.multipassEnabled?"terrainDepthTest(depth);":""}
      fragColor = texture(tex, vTexCoord) * opacity;

      if (fragColor.a < ${d.H.float(o.H)}) {
        discard;
      }

      fragColor = highlightSlice(fragColor, vpos);
      ${e.transparencyPassType===_.y.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    }
    `)),t}const f=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},14628:(e,t,i)=>{i.d(t,{L:()=>f,b:()=>_});var n=i(37046),a=i(56192),r=i(58680),s=i(78286),o=i(35911),l=i(54473),c=i(35449),h=i(99152),d=i(20778),p=i(4274),u=i(50645);function _(e){const t=new p.N5;t.include(o.K,e);const{vertex:i,fragment:a}=t;return i.uniforms.add(new d.X("modelView",((e,t)=>(0,n.w)(m,t.camera.viewMatrix,e.origin))),new d.X("proj",((e,t)=>t.camera.projectionMatrix)),new c.m("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new l.G("pixelToNDC",((e,t)=>(0,r.s)(g,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3])))),t.attributes.add(u.r.START,"vec3"),t.attributes.add(u.r.END,"vec3"),t.attributes.add(u.r.UP,"vec3"),t.attributes.add(u.r.EXTRUDE,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),i.code.add(h.H`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = modelView * vec4(pos, 1);
vec4 projPos = proj * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (modelView * vec4(start, 1)).xyz;
vViewEnd = (modelView * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),a.uniforms.add(new c.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),a.code.add(h.H`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
vec3 dEndStart = vViewEnd - vViewStart;
if (dot(dEndStart, dEndStart) < 1e-5) {
discard;
}
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
fragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),t}const g=(0,s.a)(),m=(0,a.a)(),f=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},250:(e,t,i)=>{i.d(t,{L:()=>I,b:()=>w,d:()=>M});var n=i(92504),a=i(58680),r=i(78286),s=i(21839),o=i(22279),l=i(25102),c=i(52712),h=i(22759),d=i(38774),p=i(96245),u=i(35911),_=i(16961),g=i(54473),m=i(60840),f=i(1411),v=i(35449),y=i(99152),b=i(4274);const M=(0,n.kU)(6);function w(e){const t=new b.N5;t.include(_.c),t.include(u.K,e);const i=t.fragment;if(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)if(i.uniforms.add(new v.m("maxPixelDistance",((t,i)=>e.heightManifoldEnabled?2*i.camera.computeScreenPixelSizeAt(t.heightManifoldTarget):2*i.camera.computeScreenPixelSizeAt(t.lineVerticalPlaneSegment.origin)))),i.code.add(y.H`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.spherical){const e=(e,t,i)=>(0,s.e)(e,t.heightManifoldTarget,i.camera.viewMatrix),t=(e,t)=>(0,s.e)(e,[0,0,0],t.camera.viewMatrix);i.uniforms.add(new f.E("heightManifoldOrigin",((i,n)=>(e(E,i,n),t(R,n),(0,s.f)(R,R,E),(0,s.n)(A,R),A[3]=(0,s.l)(R),A))),new m.t("globalOrigin",((e,i)=>t(E,i))),new v.m("cosSphericalAngleThreshold",((e,t)=>1-Math.max(2,(0,s.o)(t.camera.eye,e.heightManifoldTarget)*t.camera.perRenderPixelRatio)/(0,s.l)(e.heightManifoldTarget)))),i.code.add(y.H`float globeDistancePixels(float posInGlobalOriginLength) {
float dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}
float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
vec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);
float cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);
vec3 posInGlobalOrigin = globalOrigin - pos;
float posInGlobalOriginLength = length(posInGlobalOrigin);
float sphericalDistance = globeDistancePixels(posInGlobalOriginLength);
float planarDistance = planeDistancePixels(heightPlane, pos);
return cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;
}`)}else i.code.add(y.H`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
return planeDistancePixels(heightPlane, pos);
}`);if(e.pointDistanceEnabled&&(i.uniforms.add(new v.m("maxPixelDistance",((e,t)=>2*t.camera.computeScreenPixelSizeAt(e.pointDistanceTarget)))),i.code.add(y.H`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`)),e.intersectsLineEnabled&&(i.uniforms.add(new v.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),i.code.add(y.H`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`)),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&i.code.add(y.H`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),i.code.add(y.H`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),e.heightManifoldEnabled){i.uniforms.add(new g.G("angleCutoff",(e=>S(e))),new f.E("heightPlane",((e,t)=>x(e.heightManifoldTarget,e.renderCoordsHelper.worldUpAtPosition(e.heightManifoldTarget,E),t.camera.viewMatrix))));const t=e.spherical?y.H`normalize(globalOrigin - pos)`:y.H`heightPlane.xyz`;i.code.add(y.H`
    {
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, ${t})));
      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);
    }
    `)}return e.pointDistanceEnabled&&(i.uniforms.add(new g.G("angleCutoff",(e=>S(e))),new f.E("pointDistanceSphere",((e,t)=>function(e,t){return(0,s.e)(C,e.pointDistanceOrigin,t.camera.viewMatrix),C[3]=(0,s.o)(e.pointDistanceOrigin,e.pointDistanceTarget),C}(e,t)))),i.code.add(y.H`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`)),e.lineVerticalPlaneEnabled&&(i.uniforms.add(new g.G("angleCutoff",(e=>S(e))),new f.E("lineVerticalPlane",((e,t)=>function(e,t){const i=(0,h.sd)(e.lineVerticalPlaneSegment,.5,E),n=e.renderCoordsHelper.worldUpAtPosition(i,T),a=(0,s.n)(R,e.lineVerticalPlaneSegment.vector),r=(0,s.b)(A,n,a);return(0,s.n)(r,r),x(e.lineVerticalPlaneSegment.origin,r,t.camera.viewMatrix)}(e,t))),new m.t("lineVerticalStart",((e,t)=>function(e,t){const i=(0,s.c)(E,e.lineVerticalPlaneSegment.origin);return e.renderCoordsHelper.setAltitude(i,0),(0,s.e)(i,i,t.camera.viewMatrix)}(e,t))),new m.t("lineVerticalEnd",((e,t)=>function(e,t){const i=(0,s.g)(E,e.lineVerticalPlaneSegment.origin,e.lineVerticalPlaneSegment.vector);return e.renderCoordsHelper.setAltitude(i,0),(0,s.e)(i,i,t.camera.viewMatrix)}(e,t)))),i.code.add(y.H`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`)),e.intersectsLineEnabled&&(i.uniforms.add(new g.G("angleCutoff",(e=>S(e))),new m.t("intersectsLineStart",((e,t)=>(0,s.e)(E,e.lineStartWorld,t.camera.viewMatrix))),new m.t("intersectsLineEnd",((e,t)=>(0,s.e)(E,e.lineEndWorld,t.camera.viewMatrix))),new m.t("intersectsLineDirection",((e,t)=>((0,s.c)(A,e.intersectsLineSegment.vector),A[3]=0,(0,s.n)(E,(0,l.t)(A,A,t.camera.viewMatrix))))),new v.m("intersectsLineRadius",(e=>e.intersectsLineRadius))),i.code.add(y.H`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`)),i.code.add(y.H`fragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),t}function S(e){return(0,a.s)(O,Math.cos(e.angleCutoff),Math.cos(Math.max(0,e.angleCutoff-(0,n.kU)(2))))}function x(e,t,i){return(0,s.e)(D,e,i),(0,s.c)(A,t),A[3]=0,(0,l.t)(A,A,i),(0,d.O_)(D,A,P)}const O=(0,r.a)(),E=(0,o.c)(),A=(0,c.c)(),T=(0,o.c)(),R=(0,o.c)(),D=(0,o.c)(),P=(0,d.vt)(),C=(0,p.c)(),I=Object.freeze(Object.defineProperty({__proto__:null,build:w,defaultAngleCutoff:M},Symbol.toStringTag,{value:"Module"}))},86451:(e,t,i)=>{i.d(t,{S:()=>M,b:()=>v});var n=i(52712),a=i(80010),r=i(55274),s=i(1110),o=i(66012),l=i(80600),c=i(33448),h=i(89002),d=i(63592),p=i(60840),u=i(1411),_=i(99152),g=i(4274),m=i(81868),f=i(50645);function v(e){const t=new g.N5,i=e.multipassEnabled&&(e.output===r.V.Color||e.output===r.V.Alpha);t.include(o.d,e),t.include(a.L,e),t.include(s.HQ,e);const{vertex:n,fragment:v}=t;return v.include(h.a),(0,d.NB)(n,e),v.uniforms.add(new u.E("uColor",(e=>e.color))),t.attributes.add(f.r.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),i&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(f.r.OFFSET,"vec3"),e.shadingEnabled&&((0,d.S7)(n),t.attributes.add(f.r.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3")),n.code.add(_.H`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&n.code.add(_.H`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),n.code.add(_.H`
    ${i?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),i&&t.include(l.Q,e),v.code.add(_.H`
    void main() {
      discardBySlice(vWorldPosition);
      ${i?"terrainDepthTest(depth);":""}
    `),e.shadingEnabled?(v.uniforms.add(new p.t("shadingDirection",(e=>e.shadingDirection))),v.uniforms.add(new u.E("shadedColor",(e=>y(e.shadingTint,e.color)))),v.code.add(_.H`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`)):v.code.add(_.H`vec4 finalColor = uColor;`),v.code.add(_.H`
      ${e.output===r.V.ObjectAndLayerIdColor?_.H`finalColor.a = 1.0;`:""}
      if (finalColor.a < ${_.H.float(c.y)}) {
        discard;
      }
      ${e.output===r.V.Alpha?_.H`fragColor = vec4(finalColor.a);`:""}

      ${e.output===r.V.Color?_.H`fragColor = highlightSlice(finalColor, vWorldPosition); ${e.transparencyPassType===m.y.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    }
    `),t}function y(e,t){const i=1-e[3],n=e[3]+t[3]*i;return 0===n?(b[3]=n,b):(b[0]=(e[0]*e[3]+t[0]*t[3]*i)/n,b[1]=(e[1]*e[3]+t[1]*t[3]*i)/n,b[2]=(e[2]*e[3]+t[2]*t[3]*i)/n,b[3]=t[3],b)}const b=(0,n.c)(),M=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},78699:(e,t,i)=>{i.d(t,{S:()=>h,b:()=>c});var n=i(63592),a=i(1411),r=i(35449),s=i(99152),o=i(4274),l=i(50645);function c(e){const t=new o.N5,{vertex:i,fragment:c,attributes:h,varyings:d}=t;return(0,n.NB)(i,e),h.add(l.r.POSITION,"vec3"),h.add(l.r.UV0,"vec2"),d.add("vUV","vec2"),i.code.add(s.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),c.uniforms.add(new a.E("backgroundColor",(e=>e.backgroundColor)),new a.E("gridColor",(e=>e.gridColor)),new r.m("gridWidth",(e=>e.gridWidth))),c.code.add(s.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const h=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},16527:(e,t,i)=>{i.r(t),i.d(t,{DrawGraphicTool3D:()=>Xi,ExtentTransformTool:()=>eo,GraphicMoveTool:()=>tr,GraphicReshapeTool:()=>Ar,GraphicTransformTool:()=>Yr});var n=i(66866),a=i(775),r=i(20464),s=i(6267),o=i(85251),l=i(21564),c=i(73446),h=i(85569),d=i(39831),p=i(63863),u=i(21839),_=i(22279),g=i(27451),m=i(60973),f=i(89882),v=(i(539),i(98849),i(96220)),y=i(52495),b=i(12690),M=i(40189),w=i(33604),S=i(58680),x=i(78286),O=i(65319),E=i(15131),A=i(47228);i(59078);let T=e=>({vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}),R=(e,t,i)=>{for(let n=0,a=t.length;n<a;n++){let a=t[n];Array.isArray(a)?R(e,a,i):null!=a&&!1!==a&&("string"==typeof a&&(a=T(a)),i.push(a))}};i(40067);const D={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let P=class extends y.A{get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadowColor(){const{textColor:e,backgroundColor:t}=this,i=t.clone();return i.a*=e.a,i}get _textShadow(){const e=this._textShadowColor.toCss(!0);return`0 0 ${this._textShadowSize}px ${e}`}get _padding(){return.5*this.fontSize}get _borderRadius(){return this._padding}constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new v.A([0,0,0,.6]),this.textColor=new v.A([255,255,255]),this._textShadowSize=1}render(){return function(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let n,a;return i&&1===i.length&&"string"==typeof i[0]?n=i[0]:i&&(a=[],R(e,i,a),0===a.length&&(a=void 0)),{vnodeSelector:e,properties:t,children:a,text:""===n?void 0:n,domNode:null}}("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const i=this._padding,n=this._borderRadius,a=e.measureText(this.text).width,r=this.fontSize,s=C[this.anchor];e.textAlign="center",e.textBaseline="middle";const o=a+2*i,l=r+2*i,c=this.x+s.x*o,h=this.y+s.y*l;this._roundedRect(e,c,h,o,l,n),e.fillStyle=this.backgroundColor.toCss(!0),e.fill();const d=this.x+(s.x+.5)*o,p=this.y+(s.y+.5)*l;this._renderTextShadow(e,this.text,d,p),e.fillStyle=this.textColor.toCss(!0),e.fillText(this.text,d,p)}_renderTextShadow(e,t,i,n){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/I.length})`;const a=this._textShadowSize;for(const[r,s]of I)e.fillText(t,i+a*r,n+a*s)}_roundedRect(e,t,i,n,a,r){e.beginPath(),e.moveTo(t,i+r),e.arcTo(t,i,t+r,i,r),e.lineTo(t+n-r,i),e.arcTo(t+n,i,t+n,i+r,r),e.lineTo(t+n,i+a-r),e.arcTo(t+n,i+a,t+n-r,i+a,r),e.lineTo(t+r,i+a),e.arcTo(t,i+a,t,i+a-r,r),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};let t;for(t in D)e[D[t]]=this.anchor===t;return e}};(0,n._)([(0,l.MZ)()],P.prototype,"x",void 0),(0,n._)([(0,l.MZ)()],P.prototype,"y",void 0),(0,n._)([(0,l.MZ)()],P.prototype,"position",null),(0,n._)([(0,l.MZ)()],P.prototype,"text",void 0),(0,n._)([(0,l.MZ)()],P.prototype,"fontSize",void 0),(0,n._)([(0,l.MZ)()],P.prototype,"anchor",void 0),(0,n._)([(0,l.MZ)()],P.prototype,"visible",void 0),(0,n._)([(0,l.MZ)()],P.prototype,"isDecoration",void 0),(0,n._)([(0,l.MZ)()],P.prototype,"backgroundColor",void 0),(0,n._)([(0,l.MZ)()],P.prototype,"textColor",void 0),(0,n._)([(0,l.MZ)()],P.prototype,"_textShadowSize",void 0),(0,n._)([(0,l.MZ)()],P.prototype,"_textShadowColor",null),(0,n._)([(0,l.MZ)()],P.prototype,"_textShadow",null),(0,n._)([(0,l.MZ)()],P.prototype,"_padding",null),(0,n._)([(0,l.MZ)()],P.prototype,"_borderRadius",null),P=(0,n._)([(0,p.$)("esri.views.overlay.TextOverlayItem")],P);const C={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},I=[];{const e=16;for(let t=0;t<360;t+=360/e)I.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}const L=P;var G=i(36408);const V={default:15,far:25};let z=class extends y.A{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const e=(0,b.UT)((async e=>{const t=await(0,E.ud)("esri/core/t9n/Units");(0,M.Te)(e),this._messagesUnits=t}));this.addHandles([(0,o.wB)((()=>[null!=this.context&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((e=>(0,o.on)((()=>this.context?.editGeometryOperations),e,(()=>this._update())))),(0,r.hA)((()=>e.abort())),(0,o.wB)((()=>this._colors),(e=>this._updateStyle(e)))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return null==this._messagesUnits}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((e=>e.label.text))}}get _edgeDistancePixels(){return V[this.edgeDistance]}get _colors(){const e=this.context?.view.effectiveTheme.textColor??v.A.fromArray([255,255,255]);return{textColor:e,backgroundColor:(0,a._L)((0,a.bJ)(e,a.pW.Low),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;const e=this.context;if(null==e)return void this._destroyUnusedLabels();const{components:t,geometry:i,coordinateHelper:n}=e.editGeometryOperations.data;if(!i)return void this._destroyUnusedLabels();const a=t.length;for(let r=0;r<a;++r){const s=[];if(t[r].iterateVertices((e=>{s.push(n.toXYZ(e.pos))})),0===r&&null!=this.stagedVertex&&s.push(n.toXYZ(this.stagedVertex)),s.length<2)continue;const o=s[0],l=s[s.length-1];"polygon"===i.type&&s.length>2&&!(0,u.G)(o,l)&&s.push(o);const c=1===a&&!(0,O.$3)(s);let h=N,d=F;this.toScreenPointArray(e,o,h);for(let t=1;t<s.length;++t){const i=s[t-1],n=s[t];this.toScreenPointArray(e,n,d),this._addLabel(e,i,h,n,d,c),[h,d]=[d,h]}}this._destroyUnusedLabels()}_updateStyle({textColor:e,backgroundColor:t}){const i=this._nextLabelIndex,n=this._labelInfos;for(let a=0;a<i;++a){const{label:i}=n[a];i.textColor=e,i.backgroundColor=t}}_addLabel(e,t,i,n,a,r){const{label:s}=this._getOrCreateLabel(e);if(!this.visible||(0,S.k)(i,a)<3025)return void(s.visible=!1);const o=null!=e.graphicState?e.graphicState.isDraped?"on-the-ground":"absolute-height":(0,g.w7)(e.editGeometryOperations.data.geometry,e.elevationInfo),{spatialReference:l}=e.editGeometryOperations.data,c=(0,G.Ho)(t,n,l,o),h=this._messagesUnits,d=(0,A.c)(e.view);s.text=null!=h&&null!=c?(0,w.ix)(h,c,d):"",s.visible=!0;const p=a[0]-i[0],u=a[1]-i[1];r?(0,S.s)(Z,-u,p):(0,S.s)(Z,u,-p),(0,S.e)(Z,Z),(0,S.a)(Z,Z,this._edgeDistancePixels),(0,S.l)(H,i,a,.5),(0,S.i)(H,H,Z),s.position=[H[0],H[1]],Math.abs(Z[0])>Math.abs(Z[1])?s.anchor=Z[0]>0?"left":"right":s.anchor=-Z[1]<0?"top":"bottom"}_getOrCreateLabel(e){const t=this._labelInfos.length>this._nextLabelIndex,{textColor:i,backgroundColor:n}=this._colors;if(t){const e=this._labelInfos[this._nextLabelIndex++],{label:t}=e;return t.textColor=i,t.backgroundColor=n,e}const a=new L({anchor:"center",fontSize:10,textColor:i,backgroundColor:n});e.view.overlay?.items.add(a);const r={label:a};return this._labelInfos.push(r),this._nextLabelIndex=this._labelInfos.length,r}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){this.context?.view.overlay?.items.remove(e),e.destroy()}};(0,n._)([(0,l.MZ)()],z.prototype,"context",void 0),(0,n._)([(0,l.MZ)()],z.prototype,"stagedVertex",void 0),(0,n._)([(0,l.MZ)()],z.prototype,"visible",void 0),(0,n._)([(0,l.MZ)()],z.prototype,"edgeDistance",void 0),(0,n._)([(0,l.MZ)()],z.prototype,"updating",null),(0,n._)([(0,l.MZ)()],z.prototype,"_messagesUnits",void 0),(0,n._)([(0,l.MZ)()],z.prototype,"_edgeDistancePixels",null),(0,n._)([(0,l.MZ)()],z.prototype,"_colors",null),z=(0,n._)([(0,p.$)("esri.views.interactive")],z);const Z=(0,x.a)(),H=(0,x.a)(),N=(0,f.gs)(),F=(0,f.gs)();var j=i(38175);let U=class extends z{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:i},n,a=(0,f.gs)()){const{spatialReference:r}=i.data.coordinateHelper;return(0,j.XG)(n,r,t,e,B),e.state.camera.projectToScreen(B,a),a}};U=(0,n._)([(0,p.$)("esri.views.3d.interactive.SegmentLabels3D")],U);const B=(0,_.c)();var k=i(42120),q=i(25102),W=i(20035),X=i(6214),Y=i(94982),$=i(22759),Q=i(32532),J=i(65667),K=i(56867),ee=i(23183),te=i(91080);class ie{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=K.O7.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new ne({view:this._resourceFactory.view,renderGroup:this._renderGroup}),i=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new ne({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,ee.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,ee.q.UPDATE),this._resources.geometriesAdded=!0))}}let ne=class extends((0,J.sA)(y.A)){constructor(e){super(e),this.drapeSourceType=K.Om.Features,this.updatePolicy=te.q.SYNC,this.renderGroup=K.O7.Outline}};(0,n._)([(0,l.MZ)({constructOnly:!0})],ne.prototype,"view",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],ne.prototype,"drapeSourceType",void 0),(0,n._)([(0,l.MZ)()],ne.prototype,"renderGroup",void 0),ne=(0,n._)([(0,p.$)("DrapedVisualElementLayerView")],ne);class ae{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=(0,o.wB)((()=>e.view.ready),(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProperties(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}var re=i(52997),se=i(55103),oe=i(54671);class le{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==re.X.Mesh&&t.type!==re.X.Line&&t.type!==re.X.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==re.X.Mesh&&t.type!==re.X.Line&&t.type!==re.X.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,i=t._stage;if(!i)return;const n=new oe.x(i,{pickable:!1,updatePolicy:te.q.SYNC}),a=new se.B({castShadow:!1}),r=e.createResources(a,n);r.forEach((e=>{i.add(e),e.type===re.X.Texture&&e.load(i.renderView.renderingContext)})),i.add(a),n.add(a);const s=e.cameraChanged,l=s?(0,o.wB)((()=>t.state.camera),(e=>s(e)),o.Vh):null;this._resources={layer:n,object:a,external:r,cameraHandle:l},this._syncVisible()}_destroyResources(){if(null==this._resources)return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((t=>{e.remove(t),t.type===re.X.Texture&&t.unload()}))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class ce extends ae{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new le(this.createObject3DResourceFactory(e.view)),this.drapedResources=new ie(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}var he=i(10714),de=i(90166),pe=i(15788),ue=i(11110),_e=i(11459),ge=i(50645),me=i(47705),fe=i(33444),ve=i(58123),ye=i(14628),be=i(41746),Me=i(2449);class we extends fe.w{initializeProgram(e){return new ve.B(e.rctx,we.shader.get().build(this.configuration),Se)}initializePipeline(){return(0,Me.Ey)({blending:(0,Me.ox)(be.dn.ONE,be.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Me.wE})}}we.shader=new me.$(ye.L,(()=>i.e(1504).then(i.bind(i,41504))));const Se=new Map([[ge.r.START,0],[ge.r.END,1],[ge.r.UP,2],[ge.r.EXTRUDE,3]]);var xe=i(89423);class Oe{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=(0,_.c)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=(0,de.jh)(3*e.length);let i=0;for(const n of e)t[i++]=n[0],t[i++]=n[1],t[i++]=n[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);(0,u.s)(this._origin,e[t],e[t+1],e[t+2])}else(0,u.s)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);null!=t&&(e.bindVAO(t),e.drawArrays(be.WR.TRIANGLES,0,this._count))}dispose(){null!=this._vao&&this._vao.dispose()}_ensureVAO(e){return null==this._buffers?null:(null==this._vao&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const i=this._createDataBuffer(t);return this._dirty=!1,new _e.Z(e,Se,{data:(0,pe.U)(Te)},{data:xe.g.createVertex(e,be._U.STATIC_DRAW,i)})}_ensureVertexData(e,t){if(!this._dirty)return;const i=this._createDataBuffer(t);e.vertexBuffers.data?.setData(i),this._dirty=!1}_numberOfRenderVertices(e){return 2*(e.length/3-1)*3}_createDataBuffer(e){const t=e.reduce(((e,t)=>e+this._numberOfRenderVertices(t)),0);this._count=t;const i=Te.createBuffer(t),n=this._origin;let a=0,r=0;for(const s of e){for(let e=0;e<s.length;e+=3){const t=(0,u.s)(Ae,s[e],s[e+1],s[e+2]);0===e?r=this._renderCoordsHelper.getAltitude(t):this._renderCoordsHelper.setAltitude(t,r);const o=this._renderCoordsHelper.worldUpAtPosition(t,Ee),l=a+2*e,c=(0,u.f)(Ae,t,n);if(e<s.length-3){i.up.setVec(l,o),i.up.setVec(l+3,o),i.up.setVec(l+5,o);for(let e=0;e<6;e++)i.start.setVec(l+e,c);i.extrude.setValues(l,0,-1),i.extrude.setValues(l+1,1,-1),i.extrude.setValues(l+2,1,1),i.extrude.setValues(l+3,0,-1),i.extrude.setValues(l+4,1,1),i.extrude.setValues(l+5,0,1)}if(e>0){i.up.setVec(l-2,o),i.up.setVec(l-4,o),i.up.setVec(l-5,o);for(let e=-6;e<0;e++)i.end.setVec(l+e,c)}}a+=this._numberOfRenderVertices(s)}return i.buffer}}const Ee=(0,_.c)(),Ae=(0,_.c)(),Te=(0,ue.BP)().vec3f(ge.r.START).vec3f(ge.r.END).vec3f(ge.r.UP).vec2f(ge.r.EXTRUDE);var Re=i(38931),De=i(38323),Pe=i(29117),Ce=i(69948);class Ie extends Ce.K{constructor(){super(...arguments),this.contrastControlEnabled=!1}}(0,n._)([(0,Ce.W)()],Ie.prototype,"contrastControlEnabled",void 0);var Le=i(92504),Ge=i(99152),Ve=i(13148),ze=i(250);class Ze extends Ge.Y{constructor(){super(...arguments),this.innerColor=(0,_.f)(1,1,1),this.innerWidth=1,this.glowColor=(0,_.f)(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=(0,Le.kU)(6),this.pointDistanceOrigin=(0,_.c)(),this.pointDistanceTarget=(0,_.c)(),this.lineVerticalPlaneSegment=(0,$.vt)(),this.intersectsLineSegment=(0,$.vt)(),this.intersectsLineRadius=3,this.heightManifoldTarget=(0,_.c)(),this.lineStartWorld=(0,_.c)(),this.lineEndWorld=(0,_.c)()}}class He extends fe.w{initializeProgram(e){return new ve.B(e.rctx,He.shader.get().build(this.configuration),Ve.D)}initializePipeline(){return(0,Me.Ey)({blending:(0,Me.ox)(be.dn.ONE,be.dn.ONE_MINUS_SRC_ALPHA),colorWrite:Me.wE})}}He.shader=new me.$(ze.L,(()=>i.e(8169).then(i.bind(i,90550))));class Ne extends Ie{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}}(0,n._)([(0,Ce.W)()],Ne.prototype,"heightManifoldEnabled",void 0),(0,n._)([(0,Ce.W)()],Ne.prototype,"pointDistanceEnabled",void 0),(0,n._)([(0,Ce.W)()],Ne.prototype,"lineVerticalPlaneEnabled",void 0),(0,n._)([(0,Ce.W)()],Ne.prototype,"intersectsLineEnabled",void 0),(0,n._)([(0,Ce.W)()],Ne.prototype,"spherical",void 0);let Fe=class extends Re.Ot{constructor(e){super(e),this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._viewingMode=he.RT.Local,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this._passParameters=new Ze,this.produces=new Map([[De.N.LASERLINES,()=>!this.contrastControlEnabled],[De.N.LASERLINES_CONTRAST_CONTROL,()=>this.contrastControlEnabled]])}initialize(){this._passParameters.renderCoordsHelper=this.renderCoordsHelper}consumes(){return Re.B7}get isDecoration(){return this._isDecoration}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){(0,u.c)(this._passParameters.heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){(0,u.c)(this._passParameters.pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){(0,u.c)(this._passParameters.pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){(0,$.C)(e,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){(0,$.C)(e,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(e){e!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get viewingMode(){return this._viewingMode}set viewingMode(e){e!==this._viewingMode&&(this._viewingMode=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,null!=this._pathVerticalPlaneData&&this._requestRender())}set pathVerticalPlaneVertices(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new Oe(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new Oe(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(e){(0,Pe.MB)(this._passParameters,e)&&this._requestRender()}initializeRenderContext(e){this._context=e,this._techniqueRepository=e.techniqueRepository,this._techniqueConfig=new Ne;const t=new Ie;t.contrastControlEnabled=this.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(we,t)}uninitializeRenderContext(){this._technique=(0,s.Gz)(this._technique),this._pathVerticalPlaneData=(0,s.WD)(this._pathVerticalPlaneData),this._pathTechnique=(0,s.Gz)(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this.contrastControlEnabled,this._techniqueConfig.spherical=this._viewingMode===he.RT.Global,this._technique=this._techniqueRepository.releaseAndAcquire(He,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}renderNode(e,t){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(e,t),this.pathVerticalPlaneEnabled&&this._renderPath(e)}_renderUnified(e,t){const i=e.rctx;this._updatePassParameters(e),i.bindTechnique(t,this._passParameters,e.bindParameters),i.screen.draw()}_renderPath(e){if(null==this._pathVerticalPlaneData||null==this._pathTechnique)return;const t=e.rctx,i=this._pathTechnique;t.bindTechnique(i,{...this._passParameters,origin:this._pathVerticalPlaneData.origin},e.bindParameters),this._pathVerticalPlaneData.draw(e.rctx)}_updatePassParameters(e){if(!this._intersectsLineEnabled)return;const t=e.bindParameters.camera;if(this._intersectsLineInfinite){if((0,X.$e)((0,Q.LV)(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),je),je.c0=-Number.MAX_VALUE,!(0,Y.ig)(t.frustum,je))return;(0,X.j1)(je,this._passParameters.lineStartWorld),(0,X.mO)(je,this._passParameters.lineEndWorld)}else(0,u.c)(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),(0,u.g)(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}get test(){return{passParameters:this._passParameters}}};(0,n._)([(0,l.MZ)({constructOnly:!0})],Fe.prototype,"contrastControlEnabled",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Fe.prototype,"_isDecoration",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Fe.prototype,"renderCoordsHelper",void 0),Fe=(0,n._)([(0,p.$)("esri.views.3d.support.LaserLineRenderer")],Fe);const je=(0,X.vt)();class Ue extends ae{constructor(e){super(e),this._angleCutoff=ze.d,this._style={},this._heightManifoldTarget=(0,_.c)(),this._heightManifoldEnabled=!1,this._intersectsLine=(0,$.vt)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){return this._renderer}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){null!=e?((0,u.c)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(null==e)return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,Be);this.intersectsLine=(0,$.fA)(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){null!=e?((0,$.C)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=null!=e?(0,$.C)(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=null!=e?{origin:(0,_.g)(e.origin),target:e.target?(0,_.g)(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||null!=this._pointDistanceLine||null!=this._pathVerticalPlaneBuffers)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){null==this._renderer&&(this._renderer=new Fe({renderCoordsHelper:this.view.renderCoordsHelper,contrastControlEnabled:!0,_isDecoration:this.isDecoration}),this._renderer.viewingMode=this.view.state.viewingMode,this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer))}_syncStyle(){null!=this._renderer&&(this._renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){null!=this._renderer&&this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){null!=this._renderer&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){null!=this._renderer&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){null!=this._renderer&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){null!=this._renderer&&(this._renderer.pathVerticalPlaneEnabled=null!=this._pathVerticalPlaneBuffers&&this.visible,null!=this._pathVerticalPlaneBuffers&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){null!=this._renderer&&(this._renderer.lineVerticalPlaneEnabled=null!=this._lineVerticalPlaneSegment&&this.visible,null!=this._lineVerticalPlaneSegment&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(null==this._renderer)return;const e=this._pointDistanceLine,t=null!=e;this._renderer.pointDistanceEnabled=t&&null!=e.target&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,null!=e.target&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){null!=this._renderer&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}}const Be=(0,_.c)();var ke=i(93471),qe=i(94643),We=i(45722),Xe=i(2007),Ye=i(96824);class $e extends ce{constructor(e){super(e),this._ray=(0,Q.vt)(),this._isWorldDown=!1,this._start=(0,_.c)(),this._end=(0,_.f)(1,0,0),this._width=1,this._color=(0,W.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,W.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=tt.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=We.m$.OccludeAndTransparent,this._fadedExtensions=nt,this._laserline=new Ue({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,u.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,u.f)(this._end,e,this._end),(0,Q.Cr)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,u.h)(this._start,e)||((0,u.c)(this._start,e),(0,Q.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,u.h)(this._end,e)||((0,u.c)(this._end,e),(0,Q.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,q.h)(e,this._color)||((0,q.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,q.h)(e,this._innerColor)||((0,q.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,q.h)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,W.c)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===We.m$.OccludeAndTransparentStencil?We.m$.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??nt,this.recreateGeometry()}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new Ye.W(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const n=this._createGeometry(e);i.push(n),t.addGeometry(n),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Ye.W(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new Xe.$(t)}_createGeometry(e){const t=this.extensionType===tt.FADED,i=t?[(0,_.c)(),(0,_.c)(),(0,_.c)(),(0,_.c)()]:[(0,_.c)(),(0,_.c)()];return(0,qe.Z8)(e,i,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===tt.FADED?this._updateLineSegmentFinite(et):this._updateLineSegmentInfinite(this._extensionType,et)}_updateLineSegmentFinite(e){return(0,$.Cr)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,X.$e)(this._ray,Qe),e){case tt.LINE:Qe.c0=-Number.MAX_VALUE;break;case tt.RAY:case tt.GROUND_RAY:{const e=this._ray.origin,t=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,u.E)(Qe.ray.direction,Qe.ray.direction),this._extensionType===tt.GROUND_RAY&&null!=t&&(Qe.c1=Math.abs(i-t));break}}if(!(0,Y.ig)(i.frustum,Qe))return this._updateLineSegmentFinite(t);const n=(0,X.j1)(Qe,Je),a=(0,X.mO)(Qe,Ke);return(0,$.Cr)(n,a,t)}_updateVertexAttributesObject3D(e,t){const i=e.geometries[0].getMutableAttribute(ge.r.POSITION)?.data;if(!i)return;let n=0;for(const a of this._lineVertices(t))i[n++]=a[0],i[n++]=a[1],i[n++]=a[2];e.geometryVertexAttributeUpdated(e.geometries[0],ge.r.POSITION)}_updateVertexAttributesDraped(e,t){const i=e.getMutableAttribute(ge.r.POSITION)?.data;if(!i)return;let n=0;for(const a of this._lineVertices(t))i[n++]=a[0],i[n++]=a[1],i[n++]=ke.bi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===tt.FADED?(yield(0,$.sd)(e,-this.fadedExtensions.start,Je),yield(0,$.sd)(e,0,Je),yield(0,$.sd)(e,1,Je),yield(0,$.sd)(e,1+this.fadedExtensions.end,Je)):(yield(0,$.sd)(e,0,Je),yield(0,$.sd)(e,1,Je))}}const Qe=(0,X.vt)(),Je=(0,_.c)(),Ke=(0,_.c)(),et=(0,$.vt)();var tt;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(tt||(tt={}));const it=1/3,nt={start:it,end:it};var at=i(29394);class rt extends ce{constructor(e){super(e),this._location=(0,_.c)(),this._direction=(0,_.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,W.f)(1,0,1,1),this._renderOccluded=We.m$.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,u.h)(this._location,e)||((0,u.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,u.h)(this._direction,e)||((0,u.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,u.n)(this._direction,(0,u.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,q.h)(e,this._color)||((0,q.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new Ye.W(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const[n,a]=this._createGeometries(e);t.addGeometry(n),t.addGeometry(a),i.push(n),i.push(a),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Ye.W(this.materialParameters),t=(0,o.wB)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new Xe.$(e)))}_createGeometries(e){return[(0,qe.Z8)(e,[(0,_.c)(),(0,_.c)()]),(0,qe.Z8)(e,[(0,_.c)(),(0,_.c)()])]}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,ht),(0,u.g)(st,this.location,this.direction),t.projectToScreen(st,dt),(0,S.e)(dt,(0,S.c)(dt,dt,ht)),this._updateVertexAttributesObject3D(t,e,0,ht,dt,1),this._updateVertexAttributesObject3D(t,e,1,ht,dt,-1)}_updateVertexAttributesObject3D(e,t,i,n,a,r){const s=t.geometries[i],o=s.getMutableAttribute(ge.r.POSITION)?.data;if(!o)return;const{start:l,end:c}=this._computeStartEnd(a,n,r,this.offset,this.width,this.length);e.unprojectFromScreen((0,f.PR)(l),st),o[0]=st[0],o[1]=st[1],o[2]=st[2],e.unprojectFromScreen((0,f.PR)(c),st),o[3]=st[0],o[4]=st[1],o[5]=st[2],t.geometryVertexAttributeUpdated(s,ge.r.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{location:n,width:a,length:r,offset:s}=this,o=pt;o.spatialReference=t.renderer.spatialReference,o.x=n[0],o.y=n[1];const l=this.view.overlayPixelSizeInMapUnits(o)*i,c=a*l,h=r*l,d=s*l;this._updateVertexAttributesDraped(e[0],c,h,d,-1),this._updateVertexAttributesDraped(e[1],c,h,d,1)}_updateVertexAttributesDraped(e,t,i,n,a){const r=e.getMutableAttribute(ge.r.POSITION)?.data;if(!r)return;const{location:s,direction:o}=this,{start:l,end:c}=this._computeStartEnd(o,s,a,n,t,i);r[0]=l[0],r[1]=l[1],r[2]=ke.bi,r[3]=c[0],r[4]=c[1],r[5]=ke.bi,e.invalidateBoundingInfo()}_computeStartEnd(e,t,i,n,a,r){const s=(0,S.a)(ot,(0,S.s)(ot,e[1]*i,e[0]*-i),n+a/2),o=(0,S.i)(lt,(0,S.i)(lt,(0,S.i)(lt,t,(0,S.a)(lt,e,r/2)),s),s);return{start:o,end:(0,S.i)(ct,o,(0,S.a)(ct,e,-r))}}}const st=(0,_.c)(),ot=(0,x.a)(),lt=(0,x.a)(),ct=(0,x.a)(),ht=(0,f.gs)(),dt=(0,f.gs)(),pt=(0,at.T)(0,0,void 0,null);var ut=i(52712),_t=i(4675),gt=i(45573),mt=i(37046),ft=i(56192);class vt extends ae{constructor(e){super(e),this._resources=null,this._transform=(0,ft.a)()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(e){(0,mt.h)(this._transform,e),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new oe.x(e,{pickable:!1,updatePolicy:te.q.SYNC}),i=new se.B({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(i),t.add(i),i.visible=this.visible,this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;null!=this._resources&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial((t=>{e.remove(t)})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){null!=this._resources&&(this._resources.object.visible=e)}}var yt=i(27716),bt=i(58343),Mt=i(97213),wt=i(62331);class St extends vt{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=(0,ut.f)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,ut.f)(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){(0,q.h)(e,this._color)||((0,q.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,q.h)(e,this._outlineColor)||((0,q.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material&&this._material.setParameters(this._materialParameters)}_updateSizeAttribute(){const e=this.object;if(null==e)return;const t=e.geometries[0];if(null==t)return;const i=t.getMutableAttribute(ge.r.SIZE).data,n=this._geometrySize;i[0]=n,i[1]=n,e.geometryVertexAttributeUpdated(e.geometries[0],ge.r.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:(0,Mt.ny)(this._primitive),distanceFieldBoundingBox:Ot,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/xt}createExternalResources(){this._texture=(0,Mt.sZ)(this._primitive,this._preferredTextureSize),this._material=new wt.R(this._materialParameters);const e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){const t=this._createRenderGeometry();null!=t&&e.addGeometry(t)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return(0,Le.qE)(2*this._geometrySize,16,128)}calculateMapBounds(e){const t=this.object?.geometries[0];if(!t)return!1;const i=t.attributes.get(ge.r.POSITION);return(0,k.F)(i.data,this.view.renderCoordsHelper.spatialReference,Et,this.view.spatialReference),(0,_t.Hq)(e,Et),!0}_createRenderGeometry(){const{geometry:e,_material:t}=this;if(null==e||null==t)return null;const{renderCoordsHelper:i,elevationProvider:n}=this.view,a=(0,yt.nG)(e,n,bt.F.fromElevationInfo(this.elevationInfo),i),r=(0,u.s)(gt.rq.get(),e.x,e.y,a),s=gt.rq.get();(0,k.F)(r,e.spatialReference,s,i.spatialReference);const o=this._geometrySize;return(0,qe.DJ)(t,null,s,null,[o,o],[0,0,0,1])}}const xt=Mt.CN,Ot=[xt/2,xt/2,1-xt/2,1-xt/2],Et=(0,_.c)();var At=i(70807),Tt=i(59568),Rt=i(32504);class Dt extends ce{constructor(e){super(e),this._maxSize=0,this._position=(0,_.c)(),this._up=(0,_.c)(),this._right=(0,_.c)(),this._renderOccluded=We.m$.OccludeAndTransparent,this._color=(0,ut.f)(1,0,0,1),this._outlineColor=(0,ut.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=We.m$.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,q.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,q.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,u.o)(t,e),(0,u.o)(t,i))/3,(0,u.n)(this._up,(0,u.f)(this._up,e,t)),(0,u.n)(this._right,(0,u.f)(this._right,i,t)),(0,u.c)(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const t=new Rt.v(this._quadMaterialParameters),i=0===this._outlineSize?void 0:new Ye.W(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,i),{quadMaterial:t,outlineMaterial:i,forEach:e=>{e(t),i&&e(i)}}}_createObject3DGeometries(e,t,i){if((0,u.h)(this._up,_.Z)&&(0,u.h)(this._right,_.Z))return;const n=this._createGeometries(t,i);for(const a of n)e.addGeometry(a);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new Rt.v(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new Ye.W(this._outlineMaterialParameters),i=this._createGeometries(e,t).map((e=>new Xe.$(e)));return this._setTransformDraped(i),{quadMaterial:e,outlineMaterial:t,geometries:i,pixelRatioHandle:(0,o.wB)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_createGeometries(e,t){const{up:i,right:n,corner:a}=this._getVertices(),r=this._quadGeometryData(i,n,a,e);return t?[r,(0,qe.Z8)(t,[i,a,n])]:[r]}_getVertices(){let e=this._up,t=this._right;const i=(0,u.g)(gt.rq.get(),e,t);return this.isDraped&&(e=(0,u.c)(gt.rq.get(),e),t=(0,u.c)(gt.rq.get(),t),e[2]=0,t[2]=0,i[2]=0),{up:e,right:t,corner:i}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,i);(0,mt.d)(Pt,this._position),(0,mt.b)(Pt,Pt,[n,n,n]),e.transformation=Pt}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{_position:n,_size:a}=this,r=(0,u.c)(gt.rq.get(),n);r[2]=ke.bi;const s=Ct;s.spatialReference=t.renderer.spatialReference,s.x=r[0],s.y=r[1];const o=a*(this.view.overlayPixelSizeInMapUnits(s)*i),l=Math.min(this._maxSize,o);(0,mt.d)(Pt,r),(0,mt.b)(Pt,Pt,[l,l,1]);for(const c of e)c.transformation=Pt}_quadGeometryData(e,t,i,n){return new Tt.V(n,[[ge.r.POSITION,new At.n([0,0,0,...t,...e,...i],[0,1,2,1,2,3],3,!0)]])}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}const Pt=(0,ft.a)(),Ct=(0,at.T)(0,0,void 0,null);var It=i(97847),Lt=i(1381),Gt=i(40508),Vt=i(61851),zt=i(86548),Zt=i(4368);class Ht extends zt.b{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof Zt.c?t.length:0)-(e instanceof Zt.c?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:i,view:n}=t,a=Nt(t);return(0,r.DQ)(new St({view:n,primitive:"circle",geometry:(0,It.io)(e.intersectionPoint,i),elevationInfo:e.isDraped?g.Tq:g.qt,size:20,outlineSize:2,color:a.intersectionPointColor,outlineColor:a.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:i,spatialReference:n}=t,a=Nt(t),s=Ft(e.point,e.domain,t);return(0,r.DQ)(new St({view:i,primitive:"circle",geometry:(0,It.io)(s,n),elevationInfo:jt(e,t),size:20,outlineSize:2,color:a.pointColor,outlineColor:a.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:i,spatialReference:n}=t,a=Nt(t),s=Ft(e.lineStart,e.domain,t),o=Ft(e.lineEnd,e.domain,t);return(0,r.DQ)(this._createLineSegmentHint(e.type,s,o,n,jt(e,t),i,a,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,spatialReference:n}=t,a=Nt(t),{isDraped:s}=e,o=jt(e,t),l=Ft(e.lineStart,e.domain,t),c=Ft(e.lineEnd,e.domain,t),h=Bt(l,n,o,i,s),d=Bt(c,n,o,i,s),p=(0,u.p)(d,h,d,.5),_=new rt({view:i,attached:!1,offset:Lt.N.parallelLineHintOffset,length:Lt.N.parallelLineHintLength,width:Lt.N.parallelLineHintWidth,color:a.parallelSignColor,location:p,renderOccluded:s?We.m$.OccludeAndTransparent:We.m$.Opaque,isDraped:s,renderGroup:K.O7.SnappingHint,isDecoration:!0});return _.setDirectionFromPoints(h,p),_.attached=!0,(0,r.DQ)(_)}visualizeRightAngleQuad(e,t){const{view:i,spatialReference:n}=t,a=Nt(t),s=jt(e,t),{isDraped:o}=e,l=Ft(e.previousVertex,e.domain,t),c=Ft(e.centerVertex,e.domain,t),h=Ft(e.nextVertex,e.domain,t),d=Bt(l,n,s,i,o),p=Bt(c,n,s,i,o),u=Bt(h,n,s,i,o);return(0,r.DQ)(new Dt({view:i,attached:!0,color:o?a.rightAngleColorDraped:a.rightAngleColor,renderOccluded:o?We.m$.OccludeAndTransparent:We.m$.Transparent,outlineRenderOccluded:o?We.m$.OccludeAndTransparent:We.m$.Opaque,outlineColor:a.rightAngleOutlineColor,outlineSize:Lt.N.rightAngleHintOutlineSize,size:Lt.N.rightAngleHintSize,isDraped:o,geometry:{previous:d,center:p,next:u},renderGroup:K.O7.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,i,n,a,r,s,o=!1,l=!0,c=!0){const h=Bt(t,n,a,r,o),d=Bt(i,n,a,r,o),p=new $e({view:r,extensionType:tt.FADED,start:h,end:d,isDraped:o,color:s.lineColor,renderOccluded:o?We.m$.OccludeAndTransparent:We.m$.Opaque,renderGroup:K.O7.SnappingHint,isDecoration:!0});switch(e){case Vt.H3.TARGET:p.width=Lt.N.lineHintWidthTarget,p.fadedExtensions={start:0,end:Lt.N.lineHintFadedExtensions};break;case Vt.H3.REFERENCE_EXTENSION:p.width=Lt.N.lineHintWidthReference,p.fadedExtensions={start:0,end:0};break;case Vt.H3.REFERENCE:p.width=Lt.N.lineHintWidthReference,p.fadedExtensions={start:l?Lt.N.lineHintFadedExtensions:0,end:c?Lt.N.lineHintFadedExtensions:0}}return p.attached=!0,p}}function Nt(e){const{effectiveTheme:t}=e.view,i=v.A.toUnitRGBA(t.accentColor),n=[0,0,0,0];return{intersectionPointColor:n,intersectionPointOutlineColor:i,pointColor:n,pointOutlineColor:i,lineColor:i,lineOutlineColor:void 0,parallelSignColor:i,rightAngleColor:i,rightAngleColorDraped:v.A.toUnitRGBA((0,a._L)(t.accentColor,.5)),rightAngleOutlineColor:i}}function Ft(e,t,i){const n=Ut(t,i);return null==n?e:(0,It.vt)(e[0],e[1],n)}function jt(e,t){return null!=Ut(e.domain,t)?t.selfSnappingZ.elevationInfo:e.isDraped?g.Tq:g.qt}function Ut(e,{selfSnappingZ:t}){return e===Gt.n.SELF&&null!=t?t.value:null}function Bt(e,t,i,n,a,r=(0,_.c)()){if(a){const i=n.basemapTerrain.overlayManager.renderer.spatialReference;(0,k.F)(e,t,r,i)}else(0,j.XG)(e,t,i,n,r);return r}var kt=i(12155);function qt(e){const{graphic:t}=e;return[(0,o.wB)((()=>e.displaying),(e=>{e?function(e){const{geometry:t}=e;Xt(t)&&e.notifyMeshTransformChanged({action:kt.$.EnableFastUpdates})}(t):Wt(t)}),{...o.pc}),(0,r.hA)((()=>Wt(t)))]}function Wt(e){const{geometry:t}=e;Xt(t)&&e.notifyMeshTransformChanged({action:kt.$.DisableFastUpdates})}function Xt(e){return"mesh"===e?.type&&!e.vertexSpace.isGeoreferenced}var Yt=i(86868);const $t=.3;function Qt(e,t){t&&Object.assign(e,t)}class Jt{constructor(e){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=We.m$.Opaque,this.color=e.accent}}class Kt{constructor({colors:e,...t}){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=e.accent,this.outlineColor=e.outline,this.renderOccluded=We.m$.Opaque,this.hoverOutlineColor=e.selectedOutline,Qt(this,t)}applyColor(e){this._apply(this.color,e)}applyOutline(e){this._apply(this.outlineColor,e)}applyHoverOutline(e){this._apply(this.hoverOutlineColor,e)}_apply(e,t){t.setParameters({color:(0,a.QP)(e),renderOccluded:this.renderOccluded})}}class ei{constructor({colors:e,...t}){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=We.m$.Transparent,this.minSquaredEdgeLength=900,this.color=(0,a._L)(e.accent,.5),this.hoverColor=e.accent,Qt(this,t)}applyColor(e){this._apply(this.color,e)}applyHover(e){this._apply(this.hoverColor,e)}_apply(e,t){t.setParameters({color:(0,a.QP)(e),renderOccluded:this.renderOccluded})}}class ti{constructor(e){this.vertex=new Kt({colors:e,color:e.accent,outlineColor:e.outline}),this.edge=new Kt({colors:e,color:(0,a.Vl)((0,a._L)(e.accent,2/3),.5),outlineColor:(0,a._L)(e.outline,.5),size:8,collisionPadding:8}),this.selected=new Kt({colors:e,color:e.selected,outlineColor:e.outline}),this.edgeOffset=new ei({colors:e})}}class ii{constructor({colors:e,...t}){this.width=1.5,this.stipplePattern=(0,Yt.wk)(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=We.m$.OccludeAndTransparent,this.color=e.selected,this.stippleOffColor=e.outline,this.innerColor=e.selected,Qt(this,t)}apply(e){e.color=(0,a.QP)(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=(0,a.QP)(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=(0,a.QP)(this.innerColor),e.renderOccluded=this.renderOccluded}}class ni{constructor({colors:e,...t}){this.size=4,this.outlineSize=1,this.shape="square",this.color=e.selected,this.outlineColor=e.outline,Qt(this,t)}apply(e){e.color=(0,a.QP)(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=(0,a.QP)(this.outlineColor),e.primitive=this.shape}}class ai{constructor({colors:e,...t}){this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=$t,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=e.selected,this.glowColor=e.accent,this.heightFillColor=e.accent,Qt(this,t)}apply(e,t=1){const i={glowColor:v.A.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:v.A.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class ri{constructor(e){this.outline=new ii({colors:e,color:e.stippleOff,renderOccluded:We.m$.OccludeAndTransparentStencil,stippleOffColor:e.stippleOn,innerWidth:0}),this.staged=new ii({colors:e,color:e.stippleOn,renderOccluded:We.m$.OccludeAndTransparentStencil,innerColor:e.stagedSolid,stippleOffColor:e.stippleOff}),this.shadowStyle=new ai({colors:e,globalAlpha:$t,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1})}}class si{constructor(e){this.outline=new ni({colors:e,color:e.selected,outlineColor:e.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new ai({colors:e,globalAlpha:$t,glowColor:e.accent,glowFalloff:1.5,glowWidth:6,innerColor:e.selected,innerWidth:1,radius:2})}}class oi extends ii{constructor({colors:e,...t}){super({colors:e}),this.extensionType=tt.GROUND_RAY,Qt(this,t)}}class li{constructor(e){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineGraphics=new ri(e),this.pointGraphics=new si(e),this.heightPlane=new ai({colors:e,globalAlpha:$t,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1}),this.heightBox=new ai({colors:e,globalAlpha:$t,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:0,heightFillColor:e.accent}),this.zVerticalLine=new oi({colors:e,color:(0,a._L)(e.accent,.5),falloff:2,innerColor:(0,a._L)(e.selected,0),renderOccluded:We.m$.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:tt.GROUND_RAY})}}let ci=class extends y.A{constructor(e){super(e)}get colors(){const e=this.getTheme().accentColor,t=e.a;return{accent:e,contrast:(0,a.bJ)(e),selected:v.A.fromArray([255,255,255,t]),selectedOutline:v.A.fromArray([255,255,255,t]),staged:v.A.fromArray([12,207,255,t]),stagedSolid:v.A.fromArray([12,207,255,1]),outline:v.A.fromArray([0,0,0,.5*t]),stippleOn:v.A.fromArray([255,255,255,1]),stippleOff:v.A.fromArray([0,0,0,.5])}}get visualElements(){return new li(this.colors)}get manipulators(){return new ti(this.colors)}get zManipulator(){return new Jt(this.colors)}};(0,n._)([(0,l.MZ)()],ci.prototype,"colors",null),(0,n._)([(0,l.MZ)()],ci.prototype,"visualElements",null),(0,n._)([(0,l.MZ)()],ci.prototype,"manipulators",null),(0,n._)([(0,l.MZ)()],ci.prototype,"zManipulator",null),(0,n._)([(0,l.MZ)()],ci.prototype,"getTheme",void 0),ci=(0,n._)([(0,p.$)("esri.views.3d.interactive.editingTools.settings.Settings")],ci);var hi=i(17306),di=i(84119),pi=i(46684),ui=i(4062);class _i extends ce{constructor(e){super(e),this._attachmentOrigin=(0,at.T)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new hi.A,this._geometry=null,this._width=1,this._color=(0,W.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,W.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=We.m$.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new Ue({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,q.h)(e,this._color)||((0,q.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,q.h)(e,this._innerColor)||((0,q.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,q.h)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,W.c)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=this.object3dResources.resources?.geometries;if(!e||0===e.length)return null;(0,u.s)(mi,0,0,0);let t=0;for(const i of e)i.computeAttachmentOrigin(gi)&&((0,u.g)(mi,mi,gi),t++);return 0===t?null:((0,u.i)(mi,mi,1/t),this.view.renderCoordsHelper.fromRenderCoords(mi,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){null!=this.object3dResources.resources&&this.object3dResources.resources.material.setParameters(this._materialParameters),null!=this.drapedResources.resources&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===We.m$.OccludeAndTransparentStencil?We.m$.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,i){this._createRenderGeometries(t,i);for(const n of i)e.addGeometry(n);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_destroyExternalResources(e){e.geometries=[]}_createObject3DResources(e){const t=new Ye.W(this._materialParameters),i=new Array;return this._recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_createDrapedResources(){const e=new Ye.W(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:i}=this,n=i.basemapTerrain.spatialReference;return null==t||null==n?[]:(0,ui.A)(t,n).lines.map((({position:t})=>{const a={overlayInfo:{spatialReference:n,renderCoordsHelper:i.renderCoordsHelper},attributeData:{position:t},removeDuplicateStartEnd:this._isClosed};return new Xe.$((0,pi.t)(e,a))}))}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const i of this.object3dResources.resources.geometries){const n=i.attributes.get(ge.r.POSITION),a=(0,de.jh)(n.data.length);(0,di.projectBuffer)(n.data,t.spatialReference,0,a,this.view.spatialReference,0,n.data.length/3),(0,_t.Hq)(e,a)}return!0}_createRenderGeometries(e,t){const i=this.geometry;if(null==i)return;const n=(0,ui.C)(i,this.view.elevationProvider,this.view.renderCoordsHelper,bt.F.fromElevationInfo(this.elevationInfo??new m.A({mode:(0,g.w7)(i,null)}))),a=new Array;for(const{position:r,mapPositions:s}of n.lines){const i={mapPositions:s,attributeData:{position:r},removeDuplicateStartEnd:this._isClosed};t.push((0,pi.t)(e,i)),a.push(r)}this._laserline.pathVerticalPlane=a}}const gi=(0,_.c)(),mi=(0,_.c)();var fi=i(91013),vi=i(57813),yi=i(55274),bi=i(67341),Mi=i(58947),wi=i(81500),Si=i(1931),xi=i(81868),Oi=i(9319),Ei=i(86451);class Ai extends fe.w{initializeProgram(e){return new ve.B(e.rctx,Ai.shader.get().build(this.configuration),Ri)}_setPipelineState(e){const t=this.configuration,i=e===xi.y.NONE,n=e===xi.y.FrontFace;return(0,Me.Ey)({blending:t.output!==yi.V.Color&&t.output!==yi.V.Alpha||!t.transparent?null:i?Si.V0:(0,Si.ez)(e),culling:(0,Me.Xt)(t.cullFace),depthTest:{func:n?be.MT.LESS:t.shadingEnabled?be.MT.LEQUAL:be.MT.LESS},depthWrite:i?t.writeDepth?Me.kn:null:(0,Si.XO)(e),colorWrite:Me.wE,polygonOffset:i||n?null:Si.SE})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Ai.shader=new me.$(Ei.S,(()=>i.e(2975).then(i.bind(i,82975))));class Ti extends Oi.E{constructor(){super(...arguments),this.output=yi.V.Color,this.cullFace=fi.s2.None,this.transparencyPassType=xi.y.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.multipassEnabled=!1,this.cullAboveGround=!1}}(0,n._)([(0,Ce.W)({count:yi.V.COUNT})],Ti.prototype,"output",void 0),(0,n._)([(0,Ce.W)({count:fi.s2.COUNT})],Ti.prototype,"cullFace",void 0),(0,n._)([(0,Ce.W)({count:xi.y.COUNT})],Ti.prototype,"transparencyPassType",void 0),(0,n._)([(0,Ce.W)()],Ti.prototype,"hasSlicePlane",void 0),(0,n._)([(0,Ce.W)()],Ti.prototype,"transparent",void 0),(0,n._)([(0,Ce.W)()],Ti.prototype,"writeDepth",void 0),(0,n._)([(0,Ce.W)()],Ti.prototype,"screenSizeEnabled",void 0),(0,n._)([(0,Ce.W)()],Ti.prototype,"shadingEnabled",void 0),(0,n._)([(0,Ce.W)()],Ti.prototype,"multipassEnabled",void 0),(0,n._)([(0,Ce.W)()],Ti.prototype,"cullAboveGround",void 0),(0,n._)([(0,Ce.W)({constValue:!1})],Ti.prototype,"occlusionPass",void 0);const Ri=new Map([[ge.r.POSITION,0],[ge.r.NORMAL,1],[ge.r.OFFSET,2]]);class Di extends We.im{constructor(e){super(e,new Ci),this.supportsEdges=!0,this._configuration=new Ti,this._vertexAttributeLocations=Ri}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,n,a,r){if(this.parameters.screenSizeEnabled){const t=e.attributes.get(ge.r.OFFSET),s={applyToVertex:(e,n,a,r)=>{const s=(0,u.s)(Li,t.data[3*r],t.data[3*r+1],t.data[3*r+2]),o=(0,u.s)(Gi,e,n,a);return(0,u.i)(s,s,this.parameters.screenSizeScale*i.camera.computeScreenPixelSizeAt(s)),(0,u.g)(o,o,s),[o[0],o[1],o[2]]},applyToAabb:e=>{const t=(0,_t.gX)(e,Li);return(0,_t.hs)(e,this.parameters.screenSizeScale*i.camera.computeScreenPixelSizeAt(t))}};(0,Pe.Uy)(e,i,n,a,s,r)}else(0,Pe.Uy)(e,i,n,a,void 0,r)}produces(e,t){if(t===yi.V.Highlight)return e===De.N.OPAQUE_MATERIAL;if(t===yi.V.Color||t===yi.V.Alpha||t===yi.V.ObjectAndLayerIdColor){let t=De.N.OPAQUE_MATERIAL;return this._isTransparent&&(t=this.parameters.writeDepth?De.N.TRANSPARENT_MATERIAL:De.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===t||e===De.N.DRAPED_MATERIAL}return!1}createGLMaterial(e){return new Pi(e)}createBufferWriter(){return new Ii(this.parameters.screenSizeEnabled)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class Pi extends bi.A{beginSlot(e){return this.ensureTechnique(Ai,e)}}class Ci extends We.qA{constructor(){super(...arguments),this.color=(0,ut.f)(1,1,1,1),this.shadingTint=(0,ut.f)(0,0,0,.25),this.shadingDirection=(0,u.n)((0,_.c)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=fi.s2.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class Ii{constructor(e){this.screenSizeEnabled=e;const t=(0,ue.BP)().vec3f(ge.r.POSITION).vec3f(ge.r.NORMAL);this.screenSizeEnabled&&t.vec3f(ge.r.OFFSET),this.vertexBufferLayout=t}elementCount(e){return e.attributes.get(ge.r.POSITION).indices.length}write(e,t,i,n,a){if((0,wi.SA)(i,this.vertexBufferLayout,e,t,n,a),this.screenSizeEnabled){if(!i.attributes.has(ge.r.OFFSET))throw new Error(`${ge.r.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const e=i.attributes.get(ge.r.OFFSET);(0,Mi.vA)(3===e.size);const r=n.getField(ge.r.OFFSET,vi.xs);if(!r)throw new Error("unable to acquire view for "+ge.r.OFFSET);(0,wi.Hk)(e,t,r,a)}}}}const Li=(0,_.c)(),Gi=(0,_.c)();class Vi extends vt{constructor(e){super(e),this.view=null,this._renderOccluded=We.m$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,ut.b)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,ut.b)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,q.h)(e,this._color)||((0,q.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,q.h)(e,this._outlineColor)||((0,q.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const t=function(e,t,i,n,a){const r=(0,de.jh)(3*e.length),s=(0,de.jh)(r.length);e.forEach(((e,t)=>{r[3*t]=e[0],r[3*t+1]=e[1],r[3*t+2]=e.length>2?e[2]:0}));const o=(0,yt.au)(r,t,0,s,0,r,0,r.length/3,i,n,a),l=null!=o;return{numVertices:e.length,position:r,mapPositions:s,projectionSuccess:l,sampledElevation:o}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,bt.F.fromElevationInfo(this.elevationInfo)),i=[],n=t.numVertices,a=t.position;for(let r=0;r<n;++r){const e=(0,u.s)(zi,a[3*r],a[3*r+1],a[3*r+2]),t=Zi(this._vertexMaterial,.5,e),n=Zi(this._vertexOutlineMaterial,.5,e);i.push({vertexGeometry:t,vertexOutlineGeometry:n})}return i}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:n}of t)e.addGeometry(i),e.addGeometry(n)}createExternalResources(){this._vertexMaterial=new Di({...this._vertexMaterialParameters,writeDepth:!0,cullFace:fi.s2.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Di({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:fi.s2.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const zi=(0,_.c)();function Zi(e,t,i){return(0,qe.CM)(e,t,16,16,{offset:i})}let Hi=class extends hi.A.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,n._)([(0,l.MZ)({constructOnly:!0})],Hi.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)()],Hi.prototype,"tracking",void 0),(0,n._)([(0,l.MZ)()],Hi.prototype,"displaying",void 0),(0,n._)([(0,l.MZ)()],Hi.prototype,"isDraped",void 0),Hi=(0,n._)([(0,p.$)("esri.views.3d.layers.graphics.GraphicState")],Hi);var Ni=i(99439),Fi=i(96453),ji=i(12019),Ui=i(92976);const Bi=20,ki=1,qi=.1,Wi=(0,_.c)();let Xi=class extends Ni.Nt{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new ci({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new m.A({mode:e,offset:t})}normalizeCtorArgs(e){if(!e.elevationInfo){const t=e.hasZ??!0;return{...e,elevationInfo:(0,g.bK)(t)}}return e}initializeGraphic(e){const{view:t}=this,i=this._createGraphicState=new Hi({graphic:e});return(0,r.vE)([t.maskOccludee(e),t.trackGraphicState(i),(0,o.wB)((()=>({element:this._outlineVisualElement,isDraped:i.isDraped})),(({element:e,isDraped:t})=>{e&&(e.isDraped=t)}),o.pc),this._setupLoadingIndicator(i),...qt(i)])}updateDrawMeshTooltipInfo(e){const{graphic:t,tooltipOptions:i,view:n}=this;e.tooltipOptions=i,e.viewType=n.type,e.helpMessage=function(e,t){const i=e?.geometry;if(!e||"mesh"!==i?.type||!t)return;const{renderCoordsHelper:n,elevationProvider:a}=t,{camera:r}=t.state,{extent:s}=i,{center:o,spatialReference:l}=s,c=(0,Ui.GA)(l),h=(0,Ui.G9)(l),d=(0,Ui.GA)(n.spatialReference),p=s.width*c,_=s.height*h,m=(s.zmax??0)*h,f=m-(s.zmin??0)*h,v=Math.max(p,_,f)/d,{x:y,y:b}=o,M=o.z??0;(0,u.s)(Wi,y,b,M),n.toRenderCoords(Wi,l,Wi);const w=v/r.computeScreenPixelSizeAt(Wi);if(w>r.width*ki)return"meshTooClose";if(w<Bi)return"meshTooFar";const S=(0,g.bh)(e),{absoluteZ:x}=(0,g.Q5)(y,b,m,l,t,S);return x<(a.getElevation(y,b,M,l,"ground")??0)*h+f*qi?"meshUnderground":"mesh"}(t,this.view),this.updateElevation(e.elevation)}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new Fi.O0({view:this.view,manipulators:this.manipulators,geometryType:(0,Ni.ld)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new ji.IX(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new ji.rT(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Ht,segmentLabels:t?new U:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,g.wF)(this.hasZ,this.elevationInfo),cursor:this.cursor})}onActiveVertexChanged(e){const{view:t}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[e],this._updateVerticalLineVisualElement(e),(0,r.hA)();const i=this._settings,n=i.manipulators.vertex,l=new Vi({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:n.size,outlineSize:n.outlineSize,renderOccluded:n.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=l;const c=i.visualElements.zVerticalLine,h=new $e({view:t,extensionType:c.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:We.m$.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=h;const d=(0,r.vE)([(0,o.wB)((()=>i.visualElements.zVerticalLine),(e=>e.apply(h)),o.Vh),(0,o.wB)((()=>({selectedColor:(0,a.QP)(i.colors.selected),outlineColor:(0,a.QP)(i.manipulators.vertex.outlineColor)})),(({selectedColor:e,outlineColor:t})=>{l.color=e,l.outlineColor=t}),o.Vh),(0,r.hA)((()=>{this._activeVertexVisualElement=(0,s.pR)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,s.pR)(this._verticalLineVisualElement)}))]);return l.attached=!0,d}_updateVerticalLineVisualElement(e){const t=this._verticalLineVisualElement;if(!t)return;const{renderCoordsHelper:i,elevationProvider:n}=this.view;(0,u.s)($i,e[0],e[1],e[2]),Yi.setFromElevationInfo(this.elevationInfo),$i[2]=(0,yt.nG)($i,n,Yi,i),i.toRenderCoords($i,this.view.spatialReference,$i)?(t.setStartEndFromWorldDownAtLocation($i),t.attached=!0):t.attached=!1}onOutlineChanged(e){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=e,(0,r.hA)();const t=this.internalGraphicsLayer.elevationInfo,{view:i}=this,n=this._settings,a=new _i({view:i,geometry:e,elevationInfo:t,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,g.wF)(this.hasZ,t),attached:!1,isDecoration:!0});this._outlineVisualElement=a;const l=(0,r.vE)([(0,o.wB)((()=>n.visualElements.lineGraphics.outline),(e=>e.apply(a)),o.Vh),(0,o.wB)((()=>n.visualElements.lineGraphics.shadowStyle),(e=>e.apply(a)),o.Vh),(0,r.hA)((()=>{this._outlineVisualElement=(0,s.pR)(this._outlineVisualElement)}))]);return a.attached=!0,a.laserlineEnabled=!0,l}onRegularVerticesChanged(e){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=e,(0,r.hA)();const{view:t}=this,i=this._settings,n=i.manipulators.vertex,l=new Vi({view:t,spatialReference:t.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:n.size,outlineSize:n.outlineSize,renderOccluded:n.renderOccluded,attached:!1,isDecoration:!0}),c=(0,r.vE)([(0,o.wB)((()=>({color:(0,a.QP)(i.manipulators.vertex.color),outlineColor:(0,a.QP)(i.manipulators.vertex.outlineColor)})),(({color:e,outlineColor:t})=>{l.color=e,l.outlineColor=t}),o.Vh),(0,r.hA)((()=>{this._verticesVisualElement=(0,s.pR)(this._verticesVisualElement)}))]);return l.attached=!0,this._verticesVisualElement=l,c}updateGraphicGeometry(e,t){if("mesh"===this.geometryType&&"point"===t?.type){const i=this.geometryToPlace;return i&&i.centerAt(t),void(i&&e.geometry===i?i.vertexSpace.isGeoreferenced?e.notifyGeometryChanged():e.notifyMeshTransformChanged():e.geometry=i)}super.updateGraphicGeometry(e,t)}_setupLoadingIndicator(e){const{drawOperation:t}=this;if(!this.geometryToPlace)return t.loading=!1,null;t.loading=!0;const i=(0,r.hA)((()=>{t.loading=!1}));let n;const a=()=>n&&cancelAnimationFrame(n);return(0,r.vE)([(0,o.z7)((()=>e.displaying),(()=>{a(),n=requestAnimationFrame((()=>i.remove()))}),{...o.pc,once:!0}),(0,r.hA)(a),i])}};(0,n._)([(0,l.MZ)({constructOnly:!0})],Xi.prototype,"elevationInfo",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Xi.prototype,"geometryType",void 0),(0,n._)([(0,l.MZ)()],Xi.prototype,"type",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Xi.prototype,"view",void 0),Xi=(0,n._)([(0,p.$)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Xi);const Yi=new bt.F,$i=(0,_.c)();var Qi=i(48982),Ji=i(73569),Ki=i(4238),en=i(85174),tn=(i(17639),i(73345)),nn=i(46615),an=i(76287),rn=i(47936),sn=i(97303),on=i(90328),ln=i(12943),cn=i(80510),hn=i(38774),dn=i(27054);function pn(e,t,i=(0,Q.vt)()){return un(e,(0,f.WA)(t),i),(0,u.n)(i.direction,i.direction),i}function un(e,t,i){return function(e,t,i){const n=(0,f.sc)((0,S.j)(gt.rq.get(),t));if(n[2]=0,!e.unprojectFromRenderScreen(n,i.origin))return null;const a=(0,f.sc)((0,S.j)(gt.rq.get(),t));a[2]=1;const r=e.unprojectFromRenderScreen(a,gt.rq.get());return null==r?null:((0,u.f)(i.direction,r,i.origin),i)}(e,e.screenToRender(t,(0,f.sc)(gt.rq.get())),i)}var _n=i(36549),gn=i(27877),mn=i(78632);class fn{constructor(e){this.metadata=void 0,this._camera=new _n.i,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,ft.a)(),this._worldFrame=null,this._renderLocation=(0,_.c)(),this._renderLocationDirty=!0,this._location=new mn.A({x:0,y:0,z:0}),this._elevationAlignedLocation=new mn.A,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=gn.SJ.None,this._focused=!1,this.events=new hi.A.EventEmitter,this._screenLocation={screenPointArray:(0,f.gs)(),renderScreenPointArray:(0,f.r_)(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);const t=this.view.state?.camera;t&&this._camera.copyFrom(t)}destroy(){this._applyObjectTransform=In,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),(0,r.hA)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){vn(e)&&(this._screenLocationDirty=!0),(0,mt.h)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,ft.a)()),function(e,t,i){switch(e.viewingMode){case"local":return(0,mt.g)(i),!0;case"global":{const n=(0,rn.tO)(e.renderCoordsHelper.spatialReference);(0,ln.n4)(t,0,En,0,n.radius),(0,on.y)((0,Le.kU)(En[0]),(0,Le.kU)(En[1]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){(0,en.EL)(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){(0,en.EL)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=null!=this._elevation.override?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=(0,en.RS)(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,vn(this._modelTransform)){const t=this._calculateModelTransformOffset(Pn);e=(0,u.g)(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;const i=(0,f.WA)(e,yn),n=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,S.k)(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(t,xn),s=n*this.screenLocation.pixelSize,o=un(this._camera,i,Mn);if(null==o)return null;for(const i of e){if(0===i.length)continue;const e=(0,u.e)(En,i[0],r);for(let t=1;t<i.length;t++){const n=(0,u.e)(An,i[t],r),l=(0,$.dz)((0,$.Cr)(e,n,bn),o);if(null!=l&&l<s*s){const t=(0,u.g)(gt.rq.get(),e,n);(0,u.i)(t,t,.5);const i=(0,f.rX)(gt.rq.get());return this._camera.projectToRenderScreen(t,i),i[2]+a}(0,u.c)(e,n)}}break}case"disc":{const e=this.collisionType.direction,t=this.collisionType.offset??_.Z,r=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(r,xn),o=n*this.screenLocation.pixelSize,l=un(this._camera,i,Mn);if(null==l)return null;const c=(0,nn.f)(wn,s),h=(0,u.t)(Rn,e,c),d=(0,u.e)(Dn,t,s);(0,hn.O_)(d,h,On);const p=Tn;if((0,hn.Ui)(On,l,p)&&(0,u.a)(p,d)<o*o)return this.screenLocation.renderScreenPointArray[2]+a;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,r=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(r,xn),o=n*this._camera.computeScreenPixelSizeAt(this.renderLocation),l=un(this._camera,i,Mn);if(null==l)return null;const c=(0,nn.f)(wn,s),h=(0,u.t)(Rn,t,c),d=this._calculateModelTransformPosition(Dn);(0,hn.O_)(d,h,On);const p=Tn;if(!(0,hn.Ui)(On,l,p))break;for(const i of e){if(0===i.length)continue;const e=(0,u.e)(En,i[0],s);for(let t=1;t<i.length;t++){const n=(0,u.e)(An,i[t],s),r=(0,$.kb)((0,$.Cr)(e,n,bn),p);if(null!=r&&r<o*o){const t=(0,u.g)(gt.rq.get(),e,n);(0,u.i)(t,t,.5);const i=(0,f.rX)(gt.rq.get());return this._camera.projectToRenderScreen(t,i),i[2]+a}(0,u.c)(e,n)}}break}default:(0,tn.Xb)(this.collisionType)}return null}attach(e={manipulator3D:{}}){const t=this._stage;if(!t)return;const i=e.manipulator3D;null==i.engineLayerId?(this._engineLayer=new oe.x(t,{pickable:!1,updatePolicy:te.q.SYNC}),i.engineLayerId=this._engineLayer.id):t?.getObject&&(this._engineLayer=t.getObject(i.engineLayerId)),i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,null==this._materialIdReferences&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,sn.canProjectWithoutEngine)(this._location.spatialReference,this.view.spatialReference)||(this.location=new mn.A({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;this._removeResourcesFromStage(),i&&(t.engineLayerId=null,(0,s.pR)(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){(0,sn.projectPoint)(this.location,Cn,e.spatialReference)&&(0,cn.vR)(e.extent,Cn)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(null==this.elevationInfo)return;let e=null,t=0;const i=this.elevationInfo.offset??0;switch(this.elevationInfo.mode){case"on-the-ground":e=(0,dn.R1)(this.view.elevationProvider,this.location,"ground")??0;break;case"relative-to-ground":t=((0,dn.R1)(this.view.elevationProvider,this.location,"ground")??0)+i;break;case"relative-to-scene":t=((0,dn.R1)(this.view.elevationProvider,this.location,"scene")??0)+i;break;case"absolute-height":t=i}return t!==this._elevation.offset||e!==this._elevation.override?(this._elevation.offset=t,void(this._elevation.override=e)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=xn;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),n=(this.focused?gn.p7.Focused:gn.p7.Unfocused)|(this.selected?gn.p7.Selected:gn.p7.Unselected),a=this._noDisplayCount>0;for(const{stateMask:r,objects:s}of i){if(a){for(const e of s)e.visible=!1;continue}const e=(r&gn.p7.All)!==gn.p7.None,i=(r&gn.SJ.All)!==gn.SJ.None,o=!e||(n&r)==(r&gn.p7.All),l=!i||(this.state&r)==(r&gn.SJ.All);if(o&&l)for(const n of s)n.visible=!0,n.transformation=t;else for(const t of s)t.visible=!1}}_ensureEngineResources(){if(null==this._engineResources){const e=this._engineLayer,t=[],i=new Set;this.renderObjects.forEach((({geometry:{material:e}})=>{i.has(e)||(t.push(e),i.add(e))}));const n=new Map;this._renderObjects.forEach((e=>{const t=new se.B({castShadow:!1,geometries:[e.geometry]}),i=n.get(e.stateMask)||[];i.push(t),n.set(e.stateMask,i)}));const a=[];n.forEach(((e,t)=>a.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:a,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i,materials:n}=this._engineResources;n.forEach((t=>{const i=this._materialIdReferences,n=i.get(t.id)||0;0===n&&e.add(t),i.set(t.id,n+1)})),t.forEach((({objects:t})=>{i.addMany(t),e.addMany(t)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){const e=this._stage;if(!this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i,materials:n}=this._engineResources;t.forEach((({objects:t})=>{i.removeMany(t),e.removeMany(t)})),n.forEach((t=>{const i=this._materialIdReferences,n=i.get(t.id);1===n?(e.remove(t),i.delete(t.id)):i.set(t.id,n-1)})),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,Sn);return(0,u.s)(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return(0,u.f)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return(0,mt.s)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,mt.m)(t,t,this._worldFrame),(0,mt.m)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,null!=this._applyObjectTransform&&this._applyObjectTransform(t),t}get test(){let e=!1;if(null!=this._engineResources)for(const t of this._engineResources.objectsByState){for(const i of t.objects)if(i.visible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function vn(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const yn=(0,f.gs)(),bn=(0,$.vt)(),Mn=(0,Q.vt)(),wn=(0,an.a)(),Sn=(0,ft.a)(),xn=(0,ft.a)(),On=(0,hn.vt)(),En=(0,_.c)(),An=(0,_.c)(),Tn=(0,_.c)(),Rn=(0,_.c)(),Dn=(0,_.c)(),Pn=(0,_.c)(),Cn=new mn.A({x:0,y:0,z:0,spatialReference:null}),In=()=>{};class Ln{constructor(e,t=gn.p7.None){this.geometry=e,this.stateMask=t}}var Gn=i(54096);function Vn(e,t=We.m$.OccludeAndTransparent,i=!0){const n=(0,a.pf)(e),r=!(e[3]<1);return i?new Di({color:n,writeDepth:r,cullFace:fi.s2.Back,renderOccluded:t,isDecoration:!0}):new Rt.v({color:n,writeDepth:r,cullFace:fi.s2.Back,renderOccluded:t,isDecoration:!0})}function zn(e,t=We.m$.OccludeAndTransparent){const i=(0,a.pf)(e);return new Rt.v({color:i,writeDepth:!0,cullFace:fi.s2.Front,renderOccluded:t,isDecoration:!0})}const Zn=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1});const Hn=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function Nn(e,t,i,n){const a=(0,u.f)(gt.rq.get(),e,i),r=Fn(a,(0,u.b)(gt.rq.get(),n,a),i,gt.Rc.get());(0,mt.i)(r,r);const s=(0,u.e)(gt.rq.get(),t,r);return Math.atan2(s[1],s[0])}function Fn(e,t,i,n){const a=(0,u.n)(gt.rq.get(),e),r=(0,u.n)(gt.rq.get(),t),s=(0,u.b)(gt.rq.get(),a,r);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=0,n[4]=r[0],n[5]=r[1],n[6]=r[2],n[7]=0,n[8]=s[0],n[9]=s[1],n[10]=s[2],n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n}function jn(e,t){const i=e.getViewForGraphic(t);return null!=i&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function Un(e,t,i){const n=jn(e,i);null==n?function(e,t){if(null==t)return;const i="mesh"===t.type?t.anchor:(0,Gn.W$)(t);null!=i&&(e.location=(0,en.wZ)(i))}(t,i.geometry):t.elevationAlignedLocation=n}var Bn=i(29106);function kn(e){if(null==e||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t="polyline"===e.type?e.paths:e.rings;for(const i of t)for(let e=0;e<i.length-1;e++){const t=i[e],n=i[e+1],a=t[0]-n[0],r=t[1]-n[1];if(a*a+r*r>Bn.Ni)return Math.atan2(n[1]-t[1],n[0]-t[0])}return 0}var qn=i(21292);function Wn(e,t=(0,g.bh)(e)){return"on-the-ground"!==t.mode&&!(null==e.geometry||!e.geometry.hasZ)}var Xn,Yn,$n=i(40315);!function(e){e[e.NONE=0]="NONE",e[e.ANY=1]="ANY",e[e.Z=2]="Z",e[e.XY=4]="XY"}(Xn||(Xn={})),function(e){e[e.TRANSLATE_Z=0]="TRANSLATE_Z",e[e.TRANSLATE_XY=1]="TRANSLATE_XY",e[e.SCALE=2]="SCALE",e[e.ROTATE=3]="ROTATE",e[e.SCALE_ROTATE=4]="SCALE_ROTATE"}(Yn||(Yn={}));class Qn{constructor(){this.grabbingState=Xn.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=Xn.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(t===Yn.TRANSLATE_Z&&(this.zManipulator=e),e instanceof fn&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),null==this.firstGrabbedXY&&e.grabbing&&t===Yn.TRANSLATE_XY&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=Xn.ANY,t){case Yn.TRANSLATE_Z:this.grabbingState|=Xn.Z;break;case Yn.TRANSLATE_XY:this.grabbingState|=Xn.XY}}))}}function Jn(e){const{view:t,graphic:i}=e,n=new Hi({graphic:i}),a=function(e,t){const{view:i,graphic:n}=e,a=new _i({view:i,geometry:ea(n)?n.geometry:null,elevationInfo:(0,g.bh)(n),attached:!1,isDecoration:!0}),s=new ci({getTheme:()=>i.effectiveTheme}),l=()=>{a.attached=t.displaying},c=(0,r.vE)([(0,o.wB)((()=>s.visualElements.lineGraphics.outline),(e=>e.apply(a)),o.Vh),(0,o.wB)((()=>s.visualElements.lineGraphics.shadowStyle),(e=>e.apply(a)),o.Vh),(0,o.wB)((()=>t.displaying),l),(0,o.wB)((()=>t.isDraped),(e=>{a.isDraped=e})),t.on("changed",(()=>a.geometry=ea(n)?n.geometry:null)),(0,r.DQ)(a)]);return l(),{visualElement:a,remove:()=>c.remove()}}(e,n),s=[a,Kn(e,a.visualElement,n),t.maskOccludee(i),t.trackGraphicState(n)];return{visualElement:a.visualElement,remove:()=>(0,r.a0)(s)}}function Kn(e,t,i){const{graphic:n,view:a}=e,s=[],l=(0,g.bh)(n),c="on-the-ground"===l.mode||!l.offset&&"absolute-height"!==l.mode,h=new Qn,d=new ci({getTheme:()=>a.effectiveTheme}),p=d.visualElements,_=new $e({view:a,extensionType:p.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:We.m$.OccludeAndTransparent,isDecoration:!0}),m=(0,Le.kU)(p.heightPlaneAngleCutoff),f=new Ue({view:a,attached:!1,angleCutoff:m,isDecoration:!0}),v=(0,$n.v)(1);s.push((0,o.wB)((()=>({lineShadowStyle:d.visualElements.lineGraphics.shadowStyle,pointShadowStyle:d.visualElements.pointGraphics.shadowStyle,alpha:v.value})),(({lineShadowStyle:e,pointShadowStyle:i,alpha:n})=>{e.apply(t,n),i.apply(_,n)}),o.Vh));const y=(0,$n.v)(1);s.push((0,o.wB)((()=>({heightPlane:d.visualElements.heightPlane,alpha:y.value})),(({heightPlane:e,alpha:t})=>e.apply(f,t)),o.Vh));const b=()=>{if(h.update(e),!i.displaying||c&&(i.isDraped||!ea(n)||!n.geometry.hasZ))return t.laserlineEnabled=!1,_.attached=!1,void(f.attached=!1);t.laserlineEnabled=!0;const a=h.grabbingState&Xn.XY?p.laserlineAlphaMultiplier:1;v.value=a;const r=h.grabbingState&Xn.Z?p.laserlineAlphaMultiplier:1;y.value=r,function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&null!=t.firstGrabbedXY?t.firstGrabbedXY:null;null!=i?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}(_,h),function(e,t,i,n){if(n.numSelected>0){(0,u.s)(ta,0,0,0);let t=0;e.forEachManipulator(((e,i)=>{i===Yn.TRANSLATE_XY&&e.selected&&e instanceof fn&&((0,u.g)(ta,ta,e.renderLocation),t++)})),t>0?(i.heightManifoldTarget=(0,u.i)(ta,ta,1/t),i.attached=!0):i.attached=!1}else{const n=t.attachmentOrigin;null!=n&&e.view.renderCoordsHelper.toRenderCoords(n,ta)?(i.heightManifoldTarget=ta,i.attached=!0):i.attached=!1}}(e,t,f,h)};s.push((0,o.wB)((()=>d.visualElements.zVerticalLine),(e=>e.apply(_)),o.Vh)),s.push(i.on("changed",b),(0,o.wB)((()=>i.displaying),b),t.events.on("attachment-origin-changed",b),(0,r.DQ)(_),(0,r.DQ)(f));const M=[],w=()=>{(0,r.a0)(M),M.length=0,e.forEachManipulator((e=>M.push(e.events.on("grab-changed",b)))),e.forEachManipulator((e=>M.push(e.events.on("select-changed",b)))),b()};return w(),s.push(e.onManipulatorsChanged(w),(0,r.a2)((()=>(0,r.vE)(M)))),(0,r.vE)(s)}function ea(e){return null!=e.geometry&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const ta=(0,_.c)();var ia=i(42609);function na(e){const{view:t,graphic:i}=e,n=new Hi({graphic:i}),a=[],s=function(e,t,i){const{view:n,graphic:a}=e,s=new St({view:n,geometry:aa(a),elevationInfo:(0,g.bh)(a),isDecoration:!0});return function(e,t,i,n){const a=()=>{t.attached=i.displaying},s=new ci({getTheme:()=>e.view.effectiveTheme});(function(e,t,i,n){const{view:a,graphic:s}=e;let o=null;const l=e=>{null!=o&&(o.remove(),o=null),i.isDraped&&null!=e&&(o=function(e,t,i){const n=e.elevationProvider.spatialReference;(0,ia.g)(t,ra,n);const a=ra[0],r=ra[1];return e.elevationProvider.on("elevation-change",(e=>{(0,cn.Rj)(e.extent,a,r)&&i()}))}(a,e,(()=>{t.geometry=e})))},c=()=>{const e=aa(s);l(e),t.geometry=e};n.push(i.on("changed",c),(0,r.a2)((()=>o))),c()})(e,t,i,n),s.visualElements.pointGraphics.outline.apply(t),n.push((0,o.wB)((()=>i.displaying),a,o.Vh))}(e,s,t,i),i.push((0,r.DQ)(s)),s}(e,n,a);return function(e,t,i,n){const{view:a,graphic:s}=e,l=new ci({getTheme:()=>a.effectiveTheme}),c=new $e({view:a,extensionType:l.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:We.m$.OccludeAndTransparent,isDecoration:!0});i.push((0,o.wB)((()=>l.visualElements.zVerticalLine),(e=>e.apply(c)),o.Vh));const h=new Ue({view:a,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),d=(0,Le.kU)(l.visualElements.heightPlaneAngleCutoff),p=new Ue({view:a,attached:!1,angleCutoff:d,isDecoration:!0}),_=(0,g.bh)(e.graphic),m=bt.F.fromElevationInfo(_),f="on-the-ground"===_.mode||!_.offset&&"absolute-height"!==_.mode,v=new Qn,y=(0,$n.v)(1);i.push((0,o.wB)((()=>({heightPlane:l.visualElements.heightPlane,alpha:y.value})),(({heightPlane:e,alpha:t})=>e.apply(p,t)),o.Vh));const b=(0,$n.v)(1);i.push((0,o.wB)((()=>({shadowStyle:l.visualElements.pointGraphics.shadowStyle,alpha:b.value})),(({shadowStyle:e,alpha:t})=>e.apply(h,t)),o.Vh));const M=()=>{v.update(e);const i=aa(s),r=f&&(t.isDraped||null==i||!i.hasZ);let o=!0;if(r||null==i)o=!1;else{const e=(0,yt.nG)(i,a.elevationProvider,m,a.renderCoordsHelper);(0,u.s)(ra,i.x,i.y,e),(0,k.F)(ra,i.spatialReference,ra,a.renderCoordsHelper.spatialReference),c.setStartEndFromWorldDownAtLocation(ra),h.intersectsWorldUpAtLocation=ra}const d=v.grabbingState&Xn.Z?l.visualElements.laserlineAlphaMultiplier:1;y.value=d;const _=(0,_t.Ie)(sa);!r&&t.displaying&&n.calculateMapBounds(_)&&(0,k.F)((0,_t.pg)(_,ra),a.spatialReference,ra,a.renderCoordsHelper.spatialReference)?(p.heightManifoldTarget=ra,p.attached=!0):p.attached=!1;const g=v.grabbingState&Xn.XY?l.visualElements.laserlineAlphaMultiplier:1;b.value=g;const M=o&&t.displaying&&!r;h.attached=M,c.attached=M};i.push((0,o.wB)((()=>[t.displaying,t.isDraped]),M),t.on("changed",M)),e.forEachManipulator((e=>{i.push(e.events.on("grab-changed",M))})),i.push((0,r.DQ)(h)),i.push((0,r.DQ)(c)),i.push((0,r.DQ)(p)),M()}(e,n,a,s),a.push(t.trackGraphicState(n)),{visualElement:s,remove:()=>(0,r.a0)(a)}}function aa(e){const t=e.geometry;return null==t?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}const ra=(0,_.c)(),sa=(0,_t.vt)();function oa(e){switch(e.graphic.geometry.type){case"point":case"mesh":return na(e);case"polygon":case"polyline":return Jn(e);default:return null}}const la=70,ca=Math.ceil(la/3*2),ha=160,da=5*Math.PI/12,pa=1*Math.PI/3;var ua=i(1436);class _a{constructor(){this._available=!0}set location(e){this._forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this._forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this._forEachManipulator3D((t=>t.elevationInfo=e))}get renderLocation(){let e;return this._forEachManipulator3D((t=>{e||(e=t.renderLocation)})),e}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D((t=>t.available=e))}get hovering(){return this.someManipulator((e=>e.hovering))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}_forEachManipulator3D(e){this.forEachManipulator(((t,i)=>{t instanceof fn&&e(t,i)}))}}var ga,ma=i(16597),fa=(i(74515),i(44912),i(689),i(74321));function va(e,t){return ya(e,(()=>t))}function ya(e,t){const i=(0,_.c)(),n=(0,_.c)();let a=!1;return r=>{const s=t(r);if("start"===r.action){const t=(0,f.WA)(r.screenStart,(0,f.PR)(gt.oG.get())),n=un(e.state.camera,t,Ea);null!=n&&(a=(0,hn.Ui)(s,n,i))}if(!a)return null;const o=(0,f.WA)(r.screenEnd,(0,f.PR)(gt.oG.get())),l=un(e.state.camera,o,Ea);return null==l?null:(0,hn.Ui)(s,l,n)?{...r,renderStart:i,renderEnd:n,plane:s,ray:l}:null}}function ba(e,t,i,n=null,a=null){return function(e,t,i=0,n=null,a=null){let r=null;return s=>{if("start"===s.action&&(r=e.sceneIntersectionHelper.intersectElevationFromScreen((0,f.gs)(s.screenStart.x,s.screenStart.y),t,i,a),null!=r&&null!=n&&!(0,sn.projectPoint)(r,r,n)))return null;if(null==r)return null;const o=e.sceneIntersectionHelper.intersectElevationFromScreen((0,f.gs)(s.screenEnd.x,s.screenEnd.y),t,i,a);return null==o||null!=n&&!(0,sn.projectPoint)(o,o,n)?null:{...s,mapStart:r,mapEnd:o}}}(e,i,(0,g.id)(t,e,i),n,a)}function Ma(e,t,i,n=null,a=null){return ba(e,i,(0,g.bh)(t),n,a)}function wa(e,t,i){let n=null;const a=new fa.rh;return a.next(va(e,function(e,t){const i=xa,n=Oa,a=(0,hn.vt)();e.renderCoordsHelper.worldUpAtPosition(t,i);const r=(0,u.b)(a,i,(0,u.f)(n,t,e.state.camera.eye));return(0,u.b)(r,r,i),(0,hn.O_)(t,r,a)}(e,t))).next(function(e,t){const i=(0,_.c)(),n=(0,u.l)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const a=(0,_.c)(),r=(0,_.c)(),s=a=>((0,u.f)(a,a,t),(0,ma._I)(i,a,a),"global"===e.viewingMode&&(0,u.l)(a)*Math.sign((0,u.j)(i,a))<.001-n&&(0,u.f)(a,(0,u.i)(a,i,.001),t),(0,u.g)(a,a,t),a);return e=>(e.renderStart=s((0,u.c)(a,e.renderStart)),e.renderEnd=s((0,u.c)(r,e.renderEnd)),e)}(e,t)).next(Sa(e,i)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,n=e})),e=>(n=null,a.execute(e),n)}function Sa(e,t){const i=e.renderCoordsHelper;return e=>{const n=i.fromRenderCoords(e.renderStart,t),a=i.fromRenderCoords(e.renderEnd,t);return null!=n&&null!=a?{...e,mapStart:n,mapEnd:a}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(ga||(ga={}));const xa=(0,_.c)(),Oa=(0,_.c)(),Ea=(0,Q.vt)();function Aa(e,t,i,n){const a=(i,n)=>t({action:i,graphic:e,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY});return i(((t,i,r)=>(i.next((e=>("start"===e.action&&a("start",e),e))).next((0,fa.n5)(e,n)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&a("update",e);break;case"end":a("end",e)}return e})),{steps:i,cancel:r=r.next((0,fa.Yl)(e)).next((e=>(a("end",{screenDeltaX:0,screenDeltaY:0}),e)))})))}function Ta(e){if(null==e?.axis)return 1;const{mapStart:t,mapEnd:i,axis:n}=e,a=[i.x-t.x,i.y-t.y];return a[0]*n[0]+a[1]*n[1]>0?1:-1}class Ra extends _a{constructor(e){super(),this._handles=new ua.A,this._arrowManipulatorInfos=new Array,this._angle=0,this._scale=1,this._radius=la,this._updateAfterDrag=!1,this.events=new hi.A,this._tool=e.tool,this._view=e.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e)}destroy(){this._handles=(0,s.pR)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,Yn.TRANSLATE_XY)}createGraphicDragPipeline(e,t,i){const n=t.graphic,a=(0,g.bh)(n),r=n.geometry.spatialReference;return Aa(n,i,(t=>this.createDragPipeline(((i,n,a,r,s)=>(({steps:n,cancel:a}=e(i,n,a,r,s)),t(i,n,a))),a,r,n)),this._view.state.viewingMode)}createDragPipeline(e,t,i,n){return(0,r.vE)(this._arrowManipulatorInfos.map((({manipulator:a},r)=>(0,fa.Xt)(a,((a,s,o,l,c)=>{const h=s.next((e=>({...e,manipulatorType:Yn.TRANSLATE_XY}))).next((0,fa.Tp)(this._view,a.elevationAlignedLocation)).next(ba(this._view,a.elevationAlignedLocation,t,i,n)).next((0,fa.an)(a.location,this.angle+(r+1)*Math.PI*.5)).next((0,fa.sO)());e(a,h,o,l,c)})))))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const n=this._radius/la,a=54*n,r=a*Math.sqrt(3)/2,s=(0,qe._B)(this._opaqueMaterial,r,a/2,a/2,.02);(0,qe.xh)(s,(0,mt.d)(gt.Rc.get(),(0,u.s)(gt.rq.get(),0,-r/3,0))),e.renderObjects=[new Ln(s,gn.p7.Focused),new Ln(s.instantiate({material:this._transparentMaterial}),gn.p7.Unfocused)],e.radius=r/3*2*1.2;const o=(0,mt.j)(gt.Rc.get(),i*Math.PI/2),l=(0,mt.d)(gt.Rc.get(),(0,u.s)(gt.rq.get(),0,100*n,0));(0,mt.m)(t,o,l)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=(0,mt.c)(gt.Rc.get(),e,(0,_.f)(0,0,1));if(null==t)return;const i=(0,mt.E)(gt.Rc.get(),(0,u.s)(gt.rq.get(),this.displayScale,this.displayScale,this.displayScale)),n=(0,mt.m)(gt.Rc.get(),i,t);for(const a of this._arrowManipulatorInfos){const e=(0,mt.m)(gt.Rc.get(),n,a.transform);a.manipulator.modelTransform=e}}_createArrowManipulator(e){const t=new fn({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,_.f)(0,0,1)}}),i={manipulator:t,transform:(0,ft.a)()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}_createMaterial(e=1){const t=new Rt.v({cullFace:fi.s2.Back,renderOccluded:We.m$.Transparent,isDecoration:!0});return this._handles.add((0,o.wB)((()=>v.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(i=>{i[3]*=e,t.setParameters({color:i})}),o.Vh)),t}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:e})=>e))}}}class Da{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t=this._lastDragEvent.mapEnd,i=this._snap(this._lastDragEvent.screenEnd);if(null!=i){const n={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(n)}}this._enabled=e}_snap(e){const t=null!=this._view?this._view.toMap(e,{exclude:[]}):null;return null!=t&&null!=this._view&&(t.z=(0,g.id)(t,this._view,this._elevationInfo)),t}createDragEventPipelineStep(e,t){this._view=e,this._elevationInfo=t,this._lastDragEvent=null;const i=new fa.rh;return this._next=i,[e=>{if(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this._snap(e.screenEnd);return null!=t?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}},i]}}class Pa extends _a{constructor(e){super(),this._handles=new ua.A,this._snapToScene=new Da,this._scale=1,this._radius=la,this._view=e.view,this._tool=e.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles=(0,s.pR)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,Yn.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const n=t.graphic,a=(0,g.bh)(n),r=n.geometry.spatialReference;return Aa(n,i,(t=>this.createDragPipeline(((i,n,a,r,s)=>(({steps:n,cancel:a}=e(i,n,a,r,s)),t(i,n,a))),a,r,n)),this._view.state.viewingMode)}createDragPipeline(e,t,i,n){const a=this._view;return(0,fa.Xt)(this._manipulator,((r,s,o,l,c)=>{const h=s.next((0,fa.Tp)(a,r.elevationAlignedLocation)).next(ba(a,r.elevationAlignedLocation,t,i,n)).next(...this._snapToScene.createDragEventPipelineStep(a,t)).next((e=>({...e,manipulatorType:Yn.TRANSLATE_XY}))).next((0,fa.sO)());e(r,h,o,l,c)}))}_updateManipulatorTransform(){const e=(0,mt.E)(gt.Rc.get(),(0,u.s)(gt.rq.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new fn({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,_.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=(0,qe.nW)(this._discMaterial,.02,1,128,(0,_.f)(0,0,1),(0,_.f)(0,0,0));e.transformation=(0,mt.E)((0,ft.a)(),(0,_.f)(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new Ln(e,gn.p7.Focused),new Ln(e.instantiate({material:this._discMaterialTransparent}),gn.p7.Unfocused)],this._manipulator.radius=this._radius/la*80}_createMaterial(e=1){const t=new Rt.v({cullFace:fi.s2.Back,renderOccluded:We.m$.Transparent,isDecoration:!0});return this._handles.add((0,o.wB)((()=>v.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(i=>{i[3]*=e,t.setParameters({color:i})}),o.Vh)),t}get test(){return{discManipulator:this._manipulator}}}class Ca extends _a{constructor(e){super(),this._radius=la,this.events=new hi.A,this._tool=e.tool,this._view=e.view;const t=new ci({getTheme:()=>this._view.effectiveTheme});this._settings=t,null!=e.radius&&(this._radius=e.radius);const i=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:Vn(this._createDarkenedColor(i,1,.25),We.m$.Occlude),materialFocused:Vn(this._createDarkenedColor(i,1,0),We.m$.Occlude),materialOccludedUnfocused:Vn(this._createDarkenedColor(i,.7,0),t.zManipulator.renderOccluded),materialOccludedFocused:Vn(this._createDarkenedColor(i,.85,0),t.zManipulator.renderOccluded)},this._themeHandle=(0,o.wB)((()=>this._view.effectiveTheme.accentColor),(e=>{const t=this._createDarkenedColor(e,1,.25),i=this._createDarkenedColor(e,1,0),n=this._createDarkenedColor(e,.7,0),a=this._createDarkenedColor(e,.85,0),{materialUnfocused:r,materialFocused:s,materialOccludedUnfocused:o,materialOccludedFocused:l}=this._materials;r.setParameters({color:t}),s.setParameters({color:i}),o.setParameters({color:n}),l.setParameters({color:a})})),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._themeHandle=(0,s.xt)(this._themeHandle),this._manipulator.applyObjectTransform=Va,this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,Yn.TRANSLATE_Z)}createGraphicDragPipeline(e,t,i){const n=t.graphic.geometry.spatialReference;return Aa(t.graphic,i,(t=>this.createDragPipeline(((i,n,a,r,s)=>(({steps:n,cancel:a}=e(i,n,a,r,s)),t(i,n,a))),n)),this._view.state.viewingMode)}createDragPipeline(e,t){const i=this._view;return(0,fa.Xt)(this._manipulator,((n,a,r,s,o)=>{const l=a.next((e=>({...e,manipulatorType:Yn.TRANSLATE_Z}))).next(wa(i,n.renderLocation,t)).next((0,fa.sO)());e(n,l,r,s,o)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._settings,t=this._radius/la,i=e.zManipulator.height*t,n=e.zManipulator.coneHeight*t,a=e.zManipulator.coneWidth*t,r=e.zManipulator.width*t,s=[(0,_.f)(0,0,0),(0,_.f)(0,0,i)],o=[(0,_.f)(0,0,0),(0,_.f)(0,0,i+n)],l=(e=>{const t=(0,ft.a)();if((0,mt.w)(t,t,[0,0,i]),(0,mt.r)(t,t,Math.PI/2),e){const i=1+2*e/a;(0,mt.b)(t,t,[i,i,i])}return t})(0),{materialUnfocused:c,materialFocused:h,materialOccludedUnfocused:d,materialOccludedFocused:p}=this._materials,u=(0,qe.Nb)(c,s,r/2,16,!1),g=(0,qe.EE)(c,n,a/2,16,!1);g.transformation=l,this._manipulator.renderObjects=[new Ln(g,gn.p7.Unfocused),new Ln(u,gn.p7.Unfocused),new Ln(g.instantiate({material:h}),gn.p7.Focused),new Ln(u.instantiate({material:h}),gn.p7.Focused),new Ln(g.instantiate({material:d}),gn.p7.Unfocused),new Ln(u.instantiate({material:d}),gn.p7.Unfocused),new Ln(g.instantiate({material:p}),gn.p7.Focused),new Ln(u.instantiate({material:p}),gn.p7.Focused)],this._manipulator.radius=r/2+2,this._manipulator.collisionType={type:"line",paths:[o]}}_createManipulator(){const e=this._view,t=new fn({view:e,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{const i=e.state.camera,n=Ia;e.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,n);const a=(0,u.r)(i.eye,n),r=i.computeRenderPixelSizeAtDist(a),s=(0,u.f)(La,n,i.eye);(0,u.n)(s,s);const o=Ga;e.renderCoordsHelper.worldUpAtPosition(Ia,o);const l=Math.abs((0,u.j)(s,o)),c=(0,u.b)(La,s,o),h=(0,u.b)(La,c,o),d=(0,Le.qE)(l,.01,1),p=1-Math.sqrt(1-d*d)/d/i.fullWidth,_=this._settings,g=this._radius/la,m=_.zManipulator.width*g;(0,u.i)(h,(0,u.n)(h,h),(1/p-1)*a+r*m),t[12]-=La[0],t[13]-=La[1],t[14]-=La[2]},this._manipulator=t,this._updateManipulator()}_createDarkenedColor(e,t,i){const n=(0,a.e$)(e,i);return n.a*=t,v.A.toUnitRGBA(n)}get test(){return{manipulator:this._manipulator}}}const Ia=(0,_.c)(),La=(0,_.c)(),Ga=(0,_.c)(),Va=()=>{};class za extends _a{constructor(e){super(),this._handles=new ua.A,this._interactive=!0;const{tool:t,view:i,snapToScene:n,radius:a}=e;this._view=i,this.xyManipulation=new Pa({tool:t,view:i,snapToScene:n,radius:a}),this.xyAxisManipulation=new Ra({tool:t,view:i,radius:a}),this.zManipulation=new Ca({tool:t,view:i,radius:a}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((e=>this._handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return(0,r.vE)([this.xyManipulation.createGraphicDragPipeline(((t,i,n,a,r)=>e(Ha.XY,t,i,n,a,r)),t,i),this.xyAxisManipulation.createGraphicDragPipeline(((t,i,n,a,r)=>e(Ha.XY_AXIS,t,i,n,a,r)),t,i),this.zManipulation.createGraphicDragPipeline(((t,i,n,a,r)=>e(Ha.Z,t,i,n,a,r)),t,i)])}createDragPipeline(e,t,i,n){return(0,r.vE)([this.xyManipulation.createDragPipeline(((t,i,n,a,r)=>e(Ha.XY,t,i,n,a,r)),t,i,n),this.xyAxisManipulation.createDragPipeline(((t,i,n,a,r)=>e(Ha.XY_AXIS,t,i,n,a,r)),t,i,n),this.zManipulation.createDragPipeline(((t,i,n,a,r)=>e(Ha.Z,t,i,n,a,r)),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,Yn.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((t=>e(t,Yn.TRANSLATE_XY))),this.zManipulation.forEachManipulator((t=>e(t,Yn.TRANSLATE_Z)))}get _xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if((0,d.A)("esri-mobile"))return;const i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));const n=()=>{const t=[];this._xyAxisVisible||e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(Za),this._handles.add(t,Za)};for(const a of i)this._handles.add(a.events.on("focus-changed",n));this._view.inputManager&&this._handles.add((0,o.z7)((()=>this._view.inputManager?.latestPointerType),n)),n()}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){const t=null!=e&&"point-3d"===e.type&&e.symbolLayers;return t&&t.some((e=>"icon"===e.type))?ca:la}}const Za="disable-xy-axis-display";var Ha;!function(e){e[e.XY=0]="XY",e[e.XY_AXIS=1]="XY_AXIS",e[e.Z=2]="Z"}(Ha||(Ha={}));var Na=i(285);class Fa extends _a{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,Yn.TRANSLATE_XY)}createGraphicDragPipeline(e){return Aa(this._graphicState.graphic,e,(e=>this.createDragPipeline(e)),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,n=null!=i.geometry?i.geometry.spatialReference:null;return(0,fa.Xt)(this._manipulator,((a,r,s,o,l)=>{const c=r.next(function(e,t,i,n){const a=t.toMap(e.screenStart,{include:[i]});return null!=a?Ma(t,i,a,n):null}(l,t,i,n)).next((0,fa.EX)()).next((0,fa.sO)());e(a,c,s,o,l)}))}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new Na.l({graphic:t,view:e,selectable:!0,cursor:"move"})}}var ja=i(42497),Ua=i(37413),Ba=i(5470),ka=i(30520),qa=i(53333),Wa=i(89030),Xa=i(38070),Ya=i(18679),$a=i(91199);class Qa{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class Ja{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class Ka{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}const er="manipulators";let tr=class extends(hi.A.EventedMixin(Ua.g)){constructor(e){super(e),this._infos=new Map,this.graphics=new Qi.A,this.enableZ=!0,this.tooltipOptions=new ka.A,this.type="move-3d",this._updatingHandles=new Ki.U,this._moveManipulation=null,this._tooltip=null,this._translateGraphicTooltipInfo=null,this._translateGraphicXYTooltipInfo=null,this._translateGraphicZTooltipInfo=null}initialize(){const{view:e}=this;this.addHandles([this.graphics.on("change",(e=>{e.removed.forEach((e=>this.removeHandles(e))),this._updateGraphicInfos(e),this._setupFastTransformUpdates(e.added),this._refreshManipulators()})),(0,o.wB)((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new Xa.m({view:e}):(0,s.pR)(this._tooltip)}),o.pc)]);const t=this.graphics.toArray();this._updateGraphicInfos({added:t,removed:[]}),this._setupFastTransformUpdates(t),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=(0,s.pR)(this._tooltip),this._moveManipulation=(0,s.pR)(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}get updating(){return this._updatingHandles.updating}reset(){}_updateGraphicInfos({added:e,removed:t}){for(const i of e){if((0,ja.N)(i)!==qn.e.SUPPORTED)continue;const e=new ir(i),t=this.view.trackGraphicState(e.state);this._infos.set(e.graphic,{info:e,handle:t})}for(const i of t)this._infos.get(i)?.handle.remove(),this._infos.delete(i)}_setupFastTransformUpdates(e){for(const t of e){const{info:e}=this._infos.get(t);this.addHandles(qt(e.state),t)}}_refreshManipulators(){if(this.removeHandles(er),this._moveManipulation=(0,s.pR)(this._moveManipulation),this.manipulators.removeAll(),0===this._infos.size)return;const e=Array.from(this._infos.values(),(({info:e})=>e));this._createManipulators(e),this._createVisualElements(e),this._updateMoveManipulation(e)}_createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new Fa({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator((e=>this.addHandles([e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()})),e.events.on("grab-changed",(({action:e})=>{const{tooltipOptions:t,_tooltip:i}=this;null!=i&&("start"===e?(this._translateGraphicTooltipInfo??=new Ya.ar({tooltipOptions:t}),i.info=this._translateGraphicTooltipInfo,i.info.tooltipOptions=t,i.info.distance=Ji.r7):i.clear())}))],er))),this.addHandles(t.manipulationXY.createDragPipeline(((t,i,n,a)=>this._buildDragEventPipeline(e,Ha.XY,t,i,n,a))),er)}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new za({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?za.radiusForSymbol(e[0].graphic.symbol):la});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this.addHandles(e.events.on("immediate-click",(i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.at(0)}),i.stopPropagation()})),er)}));const i=t=>i=>{this.addHandles(i.events.on("focus-changed",(({action:i})=>{const n=this._tooltip;null!=n&&("focus"===i?this._updateMoveTooltip(e,t):n.clear())})),er)};this._moveManipulation.xyManipulation.forEachManipulator(i(Ha.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(Ha.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(Ha.Z));const n=()=>this._updateMoveManipulation(e);for(const r of e)this.addHandles([r.state.on("changed",n),(0,o.wB)((()=>r.state.displaying),n)],er);const a=e[e.length-1];this.addHandles(a.state.on("changed",(()=>this._updateMoveManipulationAngle(a))),er),this.addHandles(t.createDragPipeline(((t,i,n,a,r)=>this._buildDragEventPipeline(e,t,i,n,a,r)),(0,g.bh)(a.graphic),a.graphic.geometry.spatialReference,a.graphic),er),this._updateMoveManipulationAngle(a)}_createVisualElements(e){for(const t of e){const i=t.graphic,n=oa({view:this.view,graphic:i,forEachManipulator:e=>{t.manipulationXY?.forEachManipulator(e),this._moveManipulation?.forEachManipulator(e)},onManipulatorsChanged:()=>(0,r.hA)()});null!=n&&(t.geometryRepresentation=n.visualElement,t.geometryRepresentation instanceof _i&&this.addHandles([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.state.isDraped||this._updateMoveManipulation(e)})),(0,o.wB)((()=>t.state.isDraped),(()=>this._updateMoveManipulation(e)))],er),this.addHandles(n,er))}}_updateMoveManipulationAngle(e){this._moveManipulation&&(this._moveManipulation.angle=kn(e.graphic.geometry))}_updateMoveManipulation(e){const t=(0,at.T)(0,0,0,this.view.spatialReference);let i=0,n=!1;const a=this._moveManipulation;if(a){for(const a of e){if(!a.state.displaying)continue;const e=a.state.graphic;this.enableZ&&Wn(e)&&(n=!0);const r=a.geometryRepresentation instanceof _i&&!a.state.isDraped?a.geometryRepresentation.attachmentOrigin:jn(this.view,e);if(null!=r){const{x:e,y:n,z:a}=r;t.x+=e,t.y+=n,a&&(t.z??=0,t.z+=a),i++}}i>0?(t.x/=i,t.y/=i,t.z??=0,t.z/=i,a.location=t,a.xyManipulation.available=!0,a.xyAxisManipulation.available=!0,a.zManipulation.available=n):a.available=!1}}_buildDragEventPipeline(e,t,i,n,a,r){const s=[],o=[];let l=null,c=null;const h=()=>{for(const e of s)e.dragging=!1;s.length=0,o.length=0,l=null,c=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(1===e.length&&t===Ha.XY){const t=e[0].graphic;({steps:n,cancel:a}=this._buildSnappingPipelineSteps(t,(0,g.bh)(t),n,a,r))}return a=a.next((e=>c?.(e))).next((()=>(this.emit("graphic-move-stop",new Ka(o)),this.destroyed||h(),null))),{steps:n=n.next((t=>{if("start"===t.action){s.length=0,o.length=0;for(const t of e)t.dragging||!t.manipulationXY?.hasManipulator(i)&&t.manipulationXY?.grabbing||(s.push(t),o.push(t.graphic),t.dragging=!0);if(0!==o.length&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),l=(0,fa.qh)(o,this.view.state.viewingMode),c=(0,fa.ns)(o),this.emit("graphic-move-start",new Qa(o)),this.destroyed))return null}return 0!==o.length?t:null})).next((e=>l?.(e))).next((i=>(this._updateMoveTooltip(e,t,i),i))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),n=i.x-t.x,a=i.y-t.y;if(this.emit("graphic-move",new Ja(n,a,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new Ka(o)),this.destroyed)return null;h()}return null})),cancel:a}}_updateMoveTooltip(e,t,i){const{tooltipOptions:n,_tooltip:a}=this;if(null==a)return;a.clear();const r=0===e.length?"absolute-height":e[0].state.isDraped?"on-the-ground":"absolute-height";switch(t){case Ha.XY:a.info=this._translateGraphicTooltipInfo??=new Ya.ar({tooltipOptions:n}),this._updateMoveTooltipDistance(a.info,i,((e,t)=>(0,G.LS)(e,t,r)));break;case Ha.XY_AXIS:a.info=this._translateGraphicXYTooltipInfo??=new Ya.nW({tooltipOptions:n}),this._updateMoveTooltipDistance(a.info,i,((e,t)=>{const n=(0,G.LS)(e,t,r);return(0,Ji.hs)(n,Ta(i))}));break;case Ha.Z:a.info=this._translateGraphicZTooltipInfo??=new Ya.YI({tooltipOptions:n}),this._updateMoveTooltipDistance(a.info,i,$a.e5)}a.info.tooltipOptions=n}_updateMoveTooltipDistance(e,t,i){if(null!=t&&"end"!==t.action){const{mapStart:n,mapEnd:a}=t,r=i(n,a);e.distance=null!=r?r:Ji.r7}else e.distance=Ji.r7}_buildSnappingPipelineSteps(e,t,i,n,a){const r=e.geometry;if(null==r||"point"!==r.type&&"mesh"!==r.type)return{steps:i,cancel:n};const s=("point"===r.type?r:r.anchor).clone(),o=new qa.e({elevationInfo:t,pointer:a,editGeometryOperations:Ba.p.fromGeometry(s,this.view.state.viewingMode),visualizer:new Ht,excludeFeature:e}),l=this.snappingManager,{snappingStep:c,cancelSnapping:h}=(0,Wa.L)({snappingContext:o,snappingManager:l,updatingHandles:this._updatingHandles});return n=n.next(h),{steps:i=i.next((t=>(s.z=(0,g.wS)(this.view,s,(0,g.bh)(e),{mode:"absolute-height",offset:0}),{...t,snapOrigin:o.coordinateHelper.pointToVector(s)}))).next(...c),cancel:n}}get test(){return{tooltip:this._tooltip}}};(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],tr.prototype,"view",void 0),(0,n._)([(0,l.MZ)()],tr.prototype,"graphics",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],tr.prototype,"enableZ",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,type:ka.A})],tr.prototype,"tooltipOptions",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],tr.prototype,"snappingManager",void 0),(0,n._)([(0,l.MZ)()],tr.prototype,"type",void 0),(0,n._)([(0,l.MZ)()],tr.prototype,"updating",null),tr=(0,n._)([(0,p.$)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],tr);class ir{constructor(e){this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Hi({graphic:e})}get graphic(){return this.state.graphic}}var nr=i(49858),ar=i(42238),rr=i(55056),sr=i(12677);function or(e,t,i){const n="on-the-ground"===i.mode?sr.B.XY:sr.B.XYZ;return new sr.L(e,n,t,0)}function lr(e,t,i){const n=(0,_.c)();if(!e.renderCoordsHelper.toRenderCoords(t,n))return null;const a=cr(e,t,(0,hn.qb)(i.plane)),r=cr(e,t,i.edgeDirection);if(null==a||null==r)return null;const s=(0,u.b)((0,_.c)(),a,r);return(0,hn.O_)(n,s,(0,hn.vt)())}function cr(e,t,i){const n=(0,at.T)(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),a=(0,_.c)(),r=(0,_.c)();return e.renderCoordsHelper.toRenderCoords(t,a)&&e.renderCoordsHelper.toRenderCoords(n,r)?(0,u.C)(r,a,r):null}var hr=i(37174),dr=i(35880),pr=i(58486);let ur=class extends pr.w{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=Ji.r7,this.area=null,this.totalLength=null}};(0,n._)([(0,l.MZ)()],ur.prototype,"type",void 0),(0,n._)([(0,l.MZ)()],ur.prototype,"distance",void 0),(0,n._)([(0,l.MZ)()],ur.prototype,"area",void 0),(0,n._)([(0,l.MZ)()],ur.prototype,"totalLength",void 0),ur=(0,n._)([(0,p.$)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],ur);var _r=i(96151),gr=i(27977),mr=i(45951),fr=i(78983);let vr=class extends(hi.A.EventedMixin(y.A)){constructor(e){super(e),this._selectedIndex=0,this._manipulatorHandles=new ua.A,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=xr.NONE,this._updatingHandles=new Ki.U,this._recreatingManipulators=!1,this._settings=new ci({getTheme:()=>this.view.effectiveTheme}),this._translateGraphicTooltipInfo=null,this._translateGraphicXYTooltipInfo=null,this._translateGraphicZTooltipInfo=null,this._translateVertexTooltipInfo=null,this._translateVertexXYTooltipInfo=null,this._translateVertexZTooltipInfo=null,this._edgeOffsetTooltipInfo=null,this.outputGeometry=null,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:e,view:t}=this,i=this._settings.manipulators,n=i.vertex;this._vertexManipulatorMaterial=Vn((0,a.QP)(n.color),n.renderOccluded),this._vertexManipulatorOutlineMaterial=zn((0,a.QP)(n.outlineColor),n.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=zn((0,a.QP)(n.hoverOutlineColor),n.renderOccluded);const r=i.edge;this._edgeManipulatorMaterial=Vn((0,a.QP)(r.color),r.renderOccluded),this._edgeManipulatorOutlineMaterial=zn((0,a.QP)(r.outlineColor),r.renderOccluded);const s=i.edgeOffset;this._edgeOffsetManipulatorMaterial=Vn((0,a.QP)(s.color),s.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=Vn((0,a.QP)(s.hoverColor),s.renderOccluded,!1);const l=i.selected;this._selectedManipulatorMaterial=Vn((0,a.QP)(l.color),l.renderOccluded),this._selectedManipulatorOutlineMaterial=zn((0,a.QP)(l.outlineColor),l.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=zn((0,a.QP)(l.hoverOutlineColor),l.renderOccluded);const c=this._graphicState=new Hi({graphic:e});this._tooltip=new Xa.m({view:t}),this.addHandles([(0,o.wB)((()=>{const e=this._settings.manipulators;return{vertexSettings:e.vertex,edgeSettings:e.edge,edgeOffsetSettings:e.edgeOffset,selectedSettings:e.selected}}),(({vertexSettings:e,edgeSettings:t,edgeOffsetSettings:i,selectedSettings:n})=>{e.applyColor(this._vertexManipulatorMaterial),e.applyOutline(this._vertexManipulatorOutlineMaterial),e.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),t.applyColor(this._edgeManipulatorMaterial),t.applyOutline(this._edgeManipulatorOutlineMaterial),i.applyColor(this._edgeOffsetManipulatorMaterial),i.applyHover(this._edgeOffsetManipulatorHoverMaterial),n.applyColor(this._selectedManipulatorMaterial),n.applyOutline(this._selectedManipulatorOutlineMaterial),n.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)})),(0,o.wB)((()=>c.displaying),(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),(0,o.wB)((()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(({labels:e,enabled:t,edgeOffsetEnabled:i})=>{null!=e&&(e.visible=t,e.edgeDistance=i?"far":"default")}),o.Vh),(0,o.z7)((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),o.Vh),this.view.trackGraphicState(c)])}destroy(){this._segmentLabels=(0,s.pR)(this._segmentLabels),this._tooltip=(0,s.pR)(this._tooltip),this._removeManipulators(),this._updatingHandles.destroy()}get inputGeometry(){return null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.type));this._removeVertices(e)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,s.pR)(this._moveManipulation),this._graphicMoveManipulation=(0,s.pR)(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(e){if(null==this._editGeometryOperations)return;const t=(0,g.bh)(this.graphic);for(const i of this._editGeometryOperations.data.components){const n=e?.byComponentIndex.get(i.index);for(const e of i.vertices){const i=n?.has(e.index);this._createVertexOrEdgeManipulator(e,t,i)}for(const e of i.edges)this._createVertexOrEdgeManipulator(e,t)}this._createGraphicMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return null!=this._editGeometryOperations&&this._editGeometryOperations.canRedo}get canUndo(){return null!=this._editGeometryOperations&&this._editGeometryOperations.canUndo}redo(){if(null==this._editGeometryOperations)return null;const e=this._editGeometryOperations.redo();return null!=e&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if(null==this._editGeometryOperations)return null;this.emit("undo");const e=this._editGeometryOperations.undo();return null!=e&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(e){const t={byComponentIndex:new Map};if(null!=e&&null!=this.inputGeometry&&(0,O.It)(e,this.inputGeometry))for(const n of this._manipulatorInfos)if("vertex"===n.type&&n.manipulator.selected){const{index:e,component:{index:i}}=n.handle,{byComponentIndex:a}=t,r=a.get(i)||new Set;r.add(e),a.set(i,r)}if(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._editGeometryOperations=(0,s.pR)(this._editGeometryOperations),this._segmentLabels=(0,s.pR)(this._segmentLabels),null==e)return void(this._recreatingManipulators=!1);const i="mesh"===e.type?e.anchor:e;this._editGeometryOperations=Ba.p.fromGeometry(i,this.view.state.viewingMode),this._createManipulators(t),this._segmentLabels=new U({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,g.bh)(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}),this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return t;let i=0;const n=[],a=this._manipulatorInfos.some((e=>"vertex"===e.type&&e.manipulator.selected)),r=e===Or.SELECTED_OR_ALL&&a;for(const s of this._manipulatorInfos)"vertex"===s.type&&(s.manipulator.grabbing||r&&!s.manipulator.selected||n.push(s),i++);if(0===n.length)return t;if(this._moveVertices(n,t),n.length===i){if(this._updateEventState(xr.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(xr.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic})}return t}_isMultiVertexSelection(){return this._manipulatorInfos.reduce(((e,t)=>"vertex"===t.type&&t.manipulator.selected?e+1:e),0)>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(xr.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:n}=e;if(!t&&!i&&!n)return;const a=[];for(const r of this._manipulatorInfos)"vertex"===r.type&&(r.manipulator.selected&&!r.manipulator.grabbing||r===e.info)&&a.push(r);this._moveVertices(a,e,dr.B.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case xr.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case xr.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case xr.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case xr.MOVING:switch(this._reshapeEventState){case xr.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case xr.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case xr.RESHAPING:switch(this._reshapeEventState){case xr.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case xr.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulation(){const{tool:e,view:t}=this,i=this._graphicState;if(this._graphicMoveManipulation=new Fa({tool:e,view:t,graphicState:i}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((t,i,n)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=this._editGeometryOperations.createUndoGroup()),t))).next((e=>this._perGraphicManipulatorDragAction(Or.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(Ha.XY,e),e))).next((t=>{"end"===t.action&&(this._tooltip.clear(),e=(0,s.xt)(e))})),n.next((()=>this._onDragCancel(!0,(()=>e=(0,s.xt)(e)))))}))),this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(e,!1))))}else this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})))))}_createMoveManipulation(e){const{graphic:t,tool:i,view:n}=this,a=this._graphicState;this._moveManipulation=new za({tool:i,view:n,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Wn(t),snapToScene:!1,radius:za.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>this.addHandles([e.events.on("immediate-click",(i=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",{...i,graphic:t}),i.stopPropagation()})),this._watchAndUpdateGrabState(e,!1)])));const r=e=>t=>{this.addHandles(t.events.on("focus-changed",(({action:t})=>{"focus"===t&&this._tooltipOptions.enabled?this._updateTranslateTooltip(e):this._tooltip.clear()})))};this._moveManipulation.xyManipulation.forEachManipulator(r(Ha.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(r(Ha.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(r(Ha.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const s=t.geometry.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline(((n,a,r,s,o)=>{const{snappingStep:l,cancelSnapping:c}=(0,Wa.L)({predicate:e=>!!e.info,snappingManager:i.snappingManager,snappingContext:new qa.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:e,pointer:o,excludeFeature:t,visualizer:new Ht}),updatingHandles:this._updatingHandles,useZ:!1});return s=s.next((e=>(this._onDragCancel(),e))).next(c),{steps:r=r.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return e.manipulatorType===Yn.TRANSLATE_XY&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:e})).next((0,fa.pg)(this.view,e,t)).next(...l).next((0,fa.EX)()).next((e=>this._perGraphicManipulatorDragAction(Or.SELECTED_OR_ALL,e))).next((e=>(this._updateTranslateTooltip(n,e),e))),cancel:s}}),e,s,t),(0,o.wB)((()=>a.displaying),(()=>this._updateMoveManipulationPosition()),o.Vh),a.on("changed",(()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()})),(0,o.wB)((()=>a.isDraped),(e=>{this._updateMoveManipulationPosition();const t="align-move-manipulation";e?this.addHandles(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),t):this.removeHandles(t)}),o.Vh)])}_createVisualElements(){const{graphic:e,view:t}=this,i=oa({view:t,graphic:e,forEachManipulator:e=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(e),this._moveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,Yn.TRANSLATE_XY)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});null!=i&&(this._outlineVisualElement=i.visualElement instanceof _i?i.visualElement:null),null!=this._outlineVisualElement&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}))),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e,t=(0,g.bh)(this.graphic)){const i=this._settings.manipulators.edgeOffset,n=i.size/2,a=n+i.collisionPadding,s=n/a,o=s*Math.sqrt(3)/2;null==this._edgeOffsetManipulatorGeometryInside&&(this._edgeOffsetManipulatorGeometryInside=(0,qe._B)(this._edgeOffsetManipulatorMaterial,o,s/2,s/2,i.height,i.offset)),null==this._edgeOffsetManipulatorGeometryOutside&&(this._edgeOffsetManipulatorGeometryOutside=(0,qe._B)(this._edgeOffsetManipulatorMaterial,-o,s/2,s/2,i.height,-i.offset));const l=[new Ln(this._edgeOffsetManipulatorGeometryInside.instantiate(),gn.p7.Unfocused),new Ln(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),gn.p7.Focused),new Ln(this._edgeOffsetManipulatorGeometryOutside.instantiate(),gn.p7.Unfocused),new Ln(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),gn.p7.Focused)],c=new fn({view:this.view,renderObjects:l,elevationInfo:"on-the-ground"!==t.mode||(0,rr.$d)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:a,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionType:{type:"disc",direction:(0,_.f)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),h=new fn({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),d={manipulator:c,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:h,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(d,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(d);const p=[];for(const r of[d.handle.leftVertex,d.handle.rightVertex]){const e=this._getManipulatorInfoFromHandle(r);null!=e&&p.push(e.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(d))))}d.locationUpdateHandle=(0,r.vE)(p),this._manipulatorHandles.add(d.locationUpdateHandle,c),this._manipulatorHandles.add([this._watchAndUpdateGrabState(c,!0),this._watchAndUpdateGrabState(h,!0)],c),this._manipulatorHandles.add((0,fa.Xt)(c,this._createEdgeOffsetPipeline(d,t)),c),this._manipulatorHandles.add((0,fa.Xt)(h,((e,i,n,a)=>{if("touch"===a)this._createEdgeOffsetPipeline(d,t)(e,i,n);else if(this.enableMoveGraphic){const a=this.graphic,r=null!=a.geometry?a.geometry.spatialReference:null;i.next((e=>this._trackNumDragging(e))).next((0,fa.Tp)(this.view,e.elevationAlignedLocation)).next(ba(this.view,e.elevationAlignedLocation,t,r,a)).next((0,fa.sO)()).next((0,fa.EX)()).next((e=>this._perGraphicManipulatorDragAction(Or.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(Ha.XY,e),e))).next((e=>{"end"===e.action&&this._tooltip.clear()})),n.next((()=>this._onDragCancel(!e.metadata.deleting)))}})),c);const u=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()};return this._manipulatorHandles.add([c.events.on("immediate-click",u),h.events.on("immediate-click",u),c.events.on("focus-changed",(({action:e})=>{const{_tooltipOptions:t,_tooltip:i}=this;"focus"===e&&t.enabled?(i.info=this._edgeOffsetTooltipInfo??=new ur({tooltipOptions:t}),i.info.distance=Ji.r7,i.info.tooltipOptions=t,this._updateTooltipAreaOrTotalLength(i.info)):i.clear()}))],c),this._manipulatorInfos.push(d),this.manipulators.add(c),this.manipulators.add(h),this.emit("manipulators-changed"),d}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,n=e.edgeManipulator,a=()=>{e.visibilityHandle=(0,s.xt)(e.visibilityHandle);const a=this._getManipulatorInfoFromHandle(e.handle.leftVertex),o=this._getManipulatorInfoFromHandle(e.handle.rightVertex),l=null!=a&&null!=o&&function(e,t,i){const n=i.projectToRenderScreen(e,(0,f.r_)()),a=i.projectToRenderScreen(t,(0,f.r_)());return null!=n&&null!=a?(0,u.m)((0,u.f)(n,n,a)):0}(a.manipulator.renderLocation,o.manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!n.focused||l)&&(i.grabbable=!l,n.grabbable=!l,e.visibilityHandle=(0,r.vE)([i.disableDisplay(),(0,r.hA)((()=>{i.grabbable=!0,n.grabbable=this.enableMoveGraphic}))]))};this._manipulatorHandles.add([i.events.on("focus-changed",a),n.events.on("focus-changed",a),(0,r.hA)((()=>{(0,s.xt)(e.visibilityHandle),n.metadata.deleting=!0,this.manipulators.remove(n)}))],i),a()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const{coordinateHelper:t}=this._editGeometryOperations.data,i=lr(this.view,e.manipulator.elevationAlignedLocation,or(t,e.handle,e.manipulator.elevationInfo)),n=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==n||null==a)return;const r=n.manipulator.renderLocation,s=a.manipulator.renderLocation,o=null!=i?function(e,t,i){const n=(0,hn.qb)(e),a=(0,u.C)((0,_.c)(),t,i),r=(0,u.b)((0,_.c)(),a,n),s=(0,u.b)((0,_.c)(),a,r);return(0,ft.f)(a[0],a[1],a[2],0,r[0],r[1],r[2],0,s[0],s[1],s[2],0,0,0,0,1)}(i,r,s):ft.I;e.manipulator.modelTransform=o,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=o;const l=(0,u.l)((0,u.f)(Mr,r,s))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,n,a)=>{this._clearSelection();const{step:r,cleanup:s}=this._initializeEdgeOffset(e,t);n.next((e=>this._trackNumDragging(e))).next((0,fa.Tp)(this.view,i.elevationAlignedLocation)).next(r).next(function(e){return ya(e,(e=>e.plane))}(this.view)).next(Sa(this.view,this._editGeometryOperations.data.spatialReference)).next((0,fa.EX)()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next((e=>{"end"===e.action&&s()})),a.next((()=>{i.metadata.deleting||(s(),this._onDragCancel())}))}}_initializeEdgeOffset(e,t){const{view:i}=this,n=this._editGeometryOperations,l=or(n.data.coordinateHelper,e.handle,t),c=n.createUndoGroup(),h=lr(i,e.manipulator.elevationAlignedLocation,l);if(l.requiresSplitEdgeLeft){const t=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);null!=t&&this._splitEdgeManipulator(t,1)}if(l.requiresSplitEdgeRight){const t=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);null!=t&&this._splitEdgeManipulator(t,0)}const d=()=>new ar.A({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:n.data.spatialReference}),p=this._settings,u=new _i({view:i,isDraped:this._graphicState.isDraped,geometry:d(),elevationInfo:e.elevationInfo,width:p.visualElements.lineGraphics.outline.width,attached:!1,isDecoration:!0});let _;const g=()=>{this._cleanEdgeOffsetCollapsedEdges(e),_=(0,s.xt)(_)},m=this.on("undo",g);return _=(0,r.vE)([(0,o.wB)((()=>(0,a.QP)(this._accentColor)),(e=>u.color=e),o.Vh),(0,r.DQ)(u),(0,o.wB)((()=>this._graphicState.isDraped),(e=>u.isDraped=e)),this._graphicState.on("changed",(()=>u.geometry=d())),c,m]),u.attached=!0,{step:e=>null==l||null==h?(g(),null):{...e,operation:l,plane:h},cleanup:g}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||null==t.operation)return t;this._updateEventState(xr.RESHAPING);const{mapDeltaX:i,mapDeltaY:n,mapDeltaZ:a}=t;return(i||n||a)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_applyComputeEdgeOffsetDistanceStep(){return e=>{const{operation:t,mapEnd:i}=e;return null==t||null==i?e:("start"===e.action&&t.selectArrowFromStartPoint(i),{...e,signedDistance:t.signedDistanceToPoint(i)})}}_showEdgeOffsetTooltip(){return e=>{const{mapEnd:t,signedDistance:i,operation:n}=e,{_tooltip:a,_tooltipOptions:r}=this;return r.enabled&&null!=i?(a.info=this._edgeOffsetTooltipInfo??=new ur({tooltipOptions:r}),a.info.tooltipOptions=r,a.info.distance="end"===e.action?Ji.r7:function(e,t,i,n,a){if(e){const e=a.toXYZ(a.pointToVector(i)),r=(0,hn._I)(n,e,gt.rq.get()),s=(0,mr.n3)(r,e,a.spatialReference);if(null!=s)return(0,Ji.d_)(s.value*Math.sign(t),s.unit)}return(0,Ji.d_)(t*(0,Ui.GA)(i.spatialReference),"meters")}(this._graphicState.isDraped,i*n.selectedArrow,t,n.plane,this._editGeometryOperations.data.coordinateHelper),this._updateTooltipAreaOrTotalLength(a.info),e):(a.clear(),e)}}_cleanEdgeOffsetCollapsedEdges(e){const t=e.handle.leftVertex.leftEdge?.leftVertex,i=e.handle.leftVertex,n=e.handle.rightVertex.rightEdge?.rightVertex,a=e.handle.rightVertex,r=this._editGeometryOperations.data.coordinateHelper,s=[];if(t&&r.distance(t.pos,i.pos)<wr){const e=this._getManipulatorInfoFromHandle(i);null!=e&&s.push(e)}if(r.distance(i.pos,a.pos)<wr||n&&r.distance(n.pos,a.pos)<wr){const e=this._getManipulatorInfoFromHandle(a);null!=e&&s.push(e)}s.length&&this._removeVertices(s)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=(0,g.bh)(this.graphic),i=!1){const{view:n}=this,a=this._settings;if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(a.manipulators.vertex);this._vertexManipulatorGeometry=(0,qe.CM)(this._vertexManipulatorMaterial,e,16,16),this._vertexManipulatorOutlineGeometry=(0,qe.CM)(this._vertexManipulatorOutlineMaterial,t,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(a.manipulators.edge);this._edgeManipulatorGeometry=(0,qe.CM)(this._edgeManipulatorMaterial,e,16,16),this._edgeManipulatorOutlineGeometry=(0,qe.CM)(this._edgeManipulatorOutlineMaterial,t,16,16)}const{geometry:o}=this.graphic,l=o?.type,c="point"===l||"mesh"===l?[]:[new Ln(this._vertexManipulatorGeometry.instantiate(),Sr.Vertex|gn.p7.Unselected),new Ln(this._vertexManipulatorOutlineGeometry.instantiate(),Sr.Vertex|gn.p7.Unfocused|gn.p7.Unselected),new Ln(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Sr.Vertex|gn.p7.Focused|gn.p7.Unselected),new Ln(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),gn.p7.Selected),new Ln(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),gn.p7.Selected|gn.p7.Unfocused),new Ln(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),gn.p7.Selected|gn.p7.Focused)];this.enableMidpoints&&c.push(new Ln(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),Sr.Edge|gn.p7.Focused|gn.p7.Unselected),new Ln(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Sr.Edge|gn.p7.Focused|gn.p7.Unselected),new Ln(this._edgeManipulatorGeometry.instantiate(),Sr.Edge|gn.p7.Unfocused|gn.p7.Unselected),new Ln(this._edgeManipulatorOutlineGeometry.instantiate(),Sr.Edge|gn.p7.Unfocused|gn.p7.Unselected));const h=new fn({view:n,renderObjects:c,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),metadata:{deleting:!1}});h.selected=i,this._setTypeSpecificManipulatorSettings(h,e,t);const d="edge"===e.type?{manipulator:h,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:h,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(d),this.manipulators.add(h),this._updateManipulatorPosition(d),"edge"===d.type){const e=[];for(const t of[d.handle.leftVertex,d.handle.rightVertex]){const i=this._getManipulatorInfoFromHandle(t);null!=i&&e.push(i.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(d))))}d.locationUpdateHandle=(0,r.vE)(e),this._manipulatorHandles.add(d.locationUpdateHandle,h)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(h,!0),h);const p=(0,fa.Xt)(h,((e,i,n,a)=>{let r=null;const{snappingStep:o,cancelSnapping:l}=(0,Wa.L)({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new qa.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:t,pointer:a,excludeFeature:this.graphic,visualizer:new Ht}),updatingHandles:this._updatingHandles,useZ:!1});n=n.next((t=>(this._onDragCancel(!e.metadata.deleting,(()=>r=(0,s.xt)(r))),t))).next(l),i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&(r=this._editGeometryOperations.createUndoGroup()),"edge"===d.type){const t=this._splitEdgeManipulator(d);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:d,snapOrigin:d.handle.pos}})).next((0,fa.Tp)(this.view,e.elevationAlignedLocation)).next(Ma(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next((0,fa.pg)(this.view,t,this.graphic)).next(...o).next((0,fa.EX)()).next((t=>{this._perVertexManipulatorDragAction(t),"end"===t.action&&(r=(0,s.xt)(r)),this._updateTranslateVertexTooltip(e,Ha.XY,t)}))}));return this._manipulatorHandles.add([p,h.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,d))),h.events.on("select-changed",(()=>{d.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})),h.events.on("focus-changed",(({action:e})=>{"focus"===e&&"edge"!==d.type?this._updateTranslateVertexTooltip(h,Ha.XY):this._tooltip.clear()}))],h),this.emit("manipulators-changed"),d}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_onDragCancel(e=!0,t){switch(this._numDragging--,e&&(this.undo(),this.outputGeometry=null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null),null!=this.tool.snappingManager&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case xr.NONE:break;case xr.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case xr.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}t&&t(),this.destroyed||this._updateEventState(xr.NONE)}_setTypeSpecificManipulatorSettings(e,t,i){const{graphic:n}=this,a=this._settings;switch(t.type){case"vertex":{e.state=Sr.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2;const{size:t,collisionPadding:r}=a.manipulators.vertex;e.radius=t/2+r,e.elevationInfo=i;const{geometry:s}=n,o=s?.type;e.interactive=null!=o&&"point"!==o&&"mesh"!==o;break}case"edge":{e.state=Sr.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1;const{size:t,collisionPadding:r}=a.manipulators.edge;e.radius=t/2+r,e.elevationInfo="on-the-ground"!==i.mode||(0,rr.$d)(n.symbol)?{mode:"absolute-height",offset:0}:i;break}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>this._onGrabStateChanged(e,t,i.action,i.pointerType)))}_onGrabStateChanged(e,t,i,n="mouse"){if(!this._recreatingManipulators){if("start"===i)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(xr.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==n||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{const{manipulator:t}=e,{geometry:i}=this.graphic,n=i?.type;t.interactive=t.grabbing||!this._numGrabbing&&null!=n&&"point"!==n&&"mesh"!==n,"edgeManipulator"in e&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)})),this._graphicMoveManipulation.forEachManipulator((e=>{e.interactive=e.grabbing||!this._numGrabbing})))}}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){null!=e&&(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),(0,h.Xy)(this._manipulatorInfos,e),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(null==e)return;const t=this._editGeometryOperations;if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,br),e.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),n=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==i||null==n)return;const a=i.manipulator,r=n.manipulator;if(null!=e.manipulator.elevationInfo&&"on-the-ground"===e.manipulator.elevationInfo.mode){const i=a.location,n=r.location,s=.5,o=i.x+s*(n.x-i.x),l=i.y+s*(n.y-i.y),c=i.hasZ&&n.hasZ?0:void 0;e.manipulator.location=(0,at.T)(o,l,c,t.data.spatialReference)}else(0,u.p)(Mr,a.renderLocation,r.renderLocation,.5),e.manipulator.renderLocation=Mr}}_splitEdgeManipulator(e,t=.5){const i=this._editGeometryOperations,n=i.splitEdge(e.handle,t).createdVertex;e.locationUpdateHandle=(0,s.xt)(e.locationUpdateHandle);const a=(0,g.bh)(this.graphic);let r;this.enableEdgeOffset?(this._removeManipulator(e),r=this._createVertexOrEdgeManipulator(n)):(r=e,r.handle=n,r.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,a)),n.leftEdge&&this._createVertexOrEdgeManipulator(n.leftEdge),n.rightEdge&&this._createVertexOrEdgeManipulator(n.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(r),this.enableEdgeOffset||this._updateTranslateVertexTooltip(r.manipulator,Ha.XY),this._updateSelection(e.manipulator);const o=this._updateEventState(xr.RESHAPING),l=i.data.coordinateHelper.vectorToArray(r.handle.pos),c=i.data.components.indexOf(n.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:l,componentIndex:c,vertexIndex:n.index}],added:l}),o&&this._updateEventState(xr.NONE),r}_updateMoveManipulationPosition(){const e=(0,u.s)(Mr,0,0,0);let t=0,i=!1,n=null,a=null;for(const r of this._manipulatorInfos)"vertex"===r.type&&(r.manipulator.selected?(t++,(0,u.g)(e,e,r.manipulator.renderLocation),null==n||r.selectedIndex>n.selectedIndex?(a=n,n=r):(null==a||r.selectedIndex>a.selectedIndex)&&(a=r)):i=!0);if(0===t){const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&Wn(this.graphic),this._moveManipulation.angle=kn(this.graphic.geometry),this._moveManipulation.radius=za.radiusForSymbol(this.graphic.symbol)}else{const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&Wn(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t;let i=0;if(null!=n){const e=n.handle.pos,t=null!=a?a.handle.pos:n.handle.leftEdge&&n.handle.leftEdge.leftVertex?n.handle.leftEdge.leftVertex.pos:null,r=null==a&&n.handle.rightEdge&&n.handle.rightEdge.rightVertex?n.handle.rightEdge.rightVertex.pos:null;t&&r?this._moveManipulation.xyAxisManipulation.available=!1:t?i=yr(t,e):r&&(i=yr(e,r))}this._moveManipulation.angle=i,this._moveManipulation.radius=ca}0!==t&&i?((0,u.i)(e,e,1/t),br.spatialReference=this._editGeometryOperations.data.spatialReference,br.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,br),this._moveManipulation.elevationAlignedLocation=br):null==this._outlineVisualElement||this._graphicState.isDraped||null==this._outlineVisualElement.attachmentOrigin?Un(this.view,this._moveManipulation,this.graphic):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(e){const t=new Array,i=this._editGeometryOperations;for(const n of e)if("vertex"===n.type&&i.canRemoveVertex(n.handle.component)){t.push(n.handle),this._removeManipulator(n),this._removeManipulator(this._getManipulatorInfoFromHandle(n.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(n.handle.rightEdge));const e=i.removeVertices([n.handle]),a=e.removedVertices?.[0].createdEdge;a&&this._createVertexOrEdgeManipulator(a)}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:e.index}}));this.outputGeometry=i.data.geometry;const n=this._updateEventState(xr.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(n&&(this._updateEventState(xr.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t,i=("start"===t.action?dr.B.NEW_STEP:dr.B.ACCUMULATE_STEPS)){const n=this._editGeometryOperations;n.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=n.data.geometry;for(const a of e)this._updateManipulatorPosition(a)}_offsetEdge(e,t){if(null==t.operation||null==t.signedDistance)return;const i=this._editGeometryOperations,n=t.operation.clone();n.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],n),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,e.button===hr.w.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===hr.w.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){const i=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t)}_updateTranslateGraphicTooltip(e,t){const{_tooltipOptions:i,_tooltip:n}=this;if(!i.enabled)return;const a=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case Ha.XY:n.info=this._translateGraphicTooltipInfo??=new Ya.ar({tooltipOptions:i}),this._updateTranslateTooltipDistance(n.info,t,((e,t)=>(0,G.LS)(e,t,a)));break;case Ha.XY_AXIS:n.info=this._translateGraphicXYTooltipInfo??=new Ya.nW({tooltipOptions:i}),this._updateTranslateTooltipDistance(n.info,t,((e,i)=>{const n=(0,G.LS)(e,i,a);return(0,Ji.hs)(n,Ta(t))}));break;case Ha.Z:n.info=this._translateGraphicZTooltipInfo??=new Ya.YI({tooltipOptions:i}),this._updateTranslateTooltipDistance(n.info,t,$a.e5)}n.info.tooltipOptions=i}_updateTranslateVertexTooltip(e,t,i){const{_tooltipOptions:n,_tooltip:a}=this;if(!n.enabled)return;const r=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case Ha.XY:a.info=this._translateVertexTooltipInfo??=new Ya.un({tooltipOptions:n}),this._updateTranslateTooltipDistance(a.info,i,((e,t)=>(0,G.LS)(e,t,r))),this._updateTooltipAreaOrTotalLength(a.info);break;case Ha.XY_AXIS:a.info=this._translateVertexXYTooltipInfo??=new Ya.JH({tooltipOptions:n}),this._updateTranslateTooltipDistance(a.info,i,((e,t)=>{const n=(0,G.LS)(e,t,r);return(0,Ji.hs)(n,Ta(i))})),this._updateTooltipAreaOrTotalLength(a.info);break;case Ha.Z:a.info=this._translateVertexZTooltipInfo??=new Ya.y3({tooltipOptions:n}),this._updateTranslateTooltipDistance(a.info,i,$a.e5)}const s=(0,$a.Re)(e.elevationAlignedLocation);null!=s&&(a.info.elevation=(0,_r.S3)({actual:s})),a.info.tooltipOptions=n}_updateTranslateTooltipDistance(e,t,i){if(null!=t&&"end"!==t.action){const{mapStart:n,mapEnd:a}=t,r=i(n,a);e.distance=null!=r?r:Ji.r7}else e.distance=Ji.r7}_updateTooltipAreaOrTotalLength(e){const{geometry:t}=this.graphic;if(null==t)return e.area=null,void(e.totalLength=null);const i=this._graphicState.isDraped?"on-the-ground":"absolute-height";e.area="polygon"===t.type?(0,gr.Y)(t,i):null,e.totalLength="polyline"===t.type?(0,G.t0)(t,i):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function yr(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}(0,n._)([(0,l.MZ)()],vr.prototype,"_editGeometryOperations",void 0),(0,n._)([(0,l.MZ)()],vr.prototype,"_segmentLabels",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],vr.prototype,"tool",void 0),(0,n._)([(0,l.MZ)()],vr.prototype,"_tooltip",void 0),(0,n._)([(0,l.MZ)()],vr.prototype,"inputGeometry",null),(0,n._)([(0,l.MZ)()],vr.prototype,"outputGeometry",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],vr.prototype,"updating",null),(0,n._)([(0,l.MZ)()],vr.prototype,"manipulators",null),(0,n._)([(0,l.MZ)()],vr.prototype,"view",null),(0,n._)([(0,l.MZ)()],vr.prototype,"graphic",null),(0,n._)([(0,l.MZ)()],vr.prototype,"enableZShape",null),(0,n._)([(0,l.MZ)()],vr.prototype,"enableZVertex",null),(0,n._)([(0,l.MZ)()],vr.prototype,"enableMoveGraphic",null),(0,n._)([(0,l.MZ)()],vr.prototype,"enableMidpoints",null),(0,n._)([(0,l.MZ)()],vr.prototype,"enableEdgeOffset",null),(0,n._)([(0,l.MZ)()],vr.prototype,"_labelOptions",null),(0,n._)([(0,l.MZ)()],vr.prototype,"_tooltipOptions",null),(0,n._)([(0,l.MZ)()],vr.prototype,"_accentColor",null),vr=(0,n._)([(0,p.$)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],vr);const br=(0,at.T)(0,0,void 0,fr.A.WGS84),Mr=(0,_.c)(),wr=1e-6;var Sr,xr,Or;!function(e){e.Vertex=gn.SJ.Custom1,e.Edge=gn.SJ.Custom2}(Sr||(Sr={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(xr||(xr={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Or||(Or={}));var Er=i(86084);let Ar=class extends(hi.A.EventedMixin(Ua.g)){constructor(e){super(e),this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new Er.A,this.tooltipOptions=new ka.A,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new vr({tool:this});this.addHandles([e.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),e.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),e.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),e.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),e.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>e.stopPropagation())),(0,o.wB)((()=>this.graphic),(()=>this._updateGraphic()),o.pc)]),this.finishToolCreation()}destroy(){this._reshapeOperation=(0,s.pR)(this._reshapeOperation)}get updating(){return this._reshapeOperation?.updating??!1}_updateGeometry(){const e=(0,nr.g)(this.graphic);this._reshapeOperation.inputGeometry=null!=e?e.clone():null}_updateGraphic(){if(this.removeHandles("onGraphicGeometryChange"),this._updateGeometry(),(0,nr.N)(this.graphic)!==qn.e.SUPPORTED)return;const e=(0,o.wB)((()=>this.graphic?.geometry),(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),o.OH);this.addHandles(e,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0;const{graphic:t}=this,{geometry:i}=t;"mesh"===i?.type&&"point"===e.type?(t.geometry=i.centerAt(e),t.notifyGeometryChanged()):t.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){const{outputGeometry:e}=this._reshapeOperation;null!=this.graphic&&e&&this._updateGeometryInternally(e.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.undo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){null!=this.snappingManager&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.redo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};(0,n._)([(0,l.MZ)()],Ar.prototype,"_reshapeOperation",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ar.prototype,"view",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Ar.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ar.prototype,"enableZShape",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ar.prototype,"enableZVertex",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ar.prototype,"enableMoveGraphic",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ar.prototype,"enableMidpoints",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ar.prototype,"enableEdgeOffset",void 0),(0,n._)([(0,l.MZ)()],Ar.prototype,"type",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,type:Er.A})],Ar.prototype,"labelOptions",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,type:ka.A})],Ar.prototype,"tooltipOptions",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Ar.prototype,"snappingManager",void 0),(0,n._)([(0,l.MZ)()],Ar.prototype,"updating",null),(0,n._)([(0,l.MZ)()],Ar.prototype,"automaticManipulatorSelection",void 0),Ar=(0,n._)([(0,p.$)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Ar);var Tr=i(17505),Rr=i(61449);let Dr=class extends pr.w{constructor(e){super(e),this.type="transform-rotate",this.rotation=null,this.rotationPrecision=null,this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic"}};(0,n._)([(0,l.MZ)()],Dr.prototype,"type",void 0),(0,n._)([(0,l.MZ)()],Dr.prototype,"rotation",void 0),(0,n._)([(0,l.MZ)()],Dr.prototype,"rotationPrecision",void 0),(0,n._)([(0,l.MZ)()],Dr.prototype,"orientation",void 0),(0,n._)([(0,l.MZ)()],Dr.prototype,"orientationPrecision",void 0),(0,n._)([(0,l.MZ)()],Dr.prototype,"rotationType",void 0),Dr=(0,n._)([(0,p.$)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Dr);let Pr=class extends pr.w{constructor(e){super(e),this.type="transform-scale",this.size=null,this.sizeUnit=null,this.sizePrecision=null}};(0,n._)([(0,l.MZ)()],Pr.prototype,"type",void 0),(0,n._)([(0,l.MZ)()],Pr.prototype,"scale",void 0),(0,n._)([(0,l.MZ)()],Pr.prototype,"size",void 0),(0,n._)([(0,l.MZ)()],Pr.prototype,"sizeUnit",void 0),(0,n._)([(0,l.MZ)()],Pr.prototype,"sizePrecision",void 0),Pr=(0,n._)([(0,p.$)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Pr);let Cr=class extends pr.w{constructor(e){super(e),this.type="transform-absolute",this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic",this.size=null,this.sizePrecision=null,this.sizeUnit=null}};var Ir;(0,n._)([(0,l.MZ)()],Cr.prototype,"type",void 0),(0,n._)([(0,l.MZ)()],Cr.prototype,"orientation",void 0),(0,n._)([(0,l.MZ)()],Cr.prototype,"orientationPrecision",void 0),(0,n._)([(0,l.MZ)()],Cr.prototype,"rotationType",void 0),(0,n._)([(0,l.MZ)()],Cr.prototype,"size",void 0),(0,n._)([(0,l.MZ)()],Cr.prototype,"sizePrecision",void 0),(0,n._)([(0,l.MZ)()],Cr.prototype,"sizeUnit",void 0),Cr=(0,n._)([(0,p.$)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],Cr),function(e){e.ScaleIn=gn.SJ.Custom2,e.ScaleOut=gn.SJ.Custom3,e.RotateLeft=gn.SJ.Custom4,e.RotateRight=gn.SJ.Custom5,e.Unlocked=gn.SJ.Custom7,e.DelayedFocused=gn.SJ.Custom8,e.TouchInput=gn.SJ.Custom12}(Ir||(Ir={}));let Lr=class extends y.A{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}get updating(){return!!this._activeAnimation}constructor(e){super(e),this.mode=null,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this._absoluteTooltipInfo=null,this._scaleTooltipInfo=null,this._rotateTooltipInfo=null,this.events=new hi.A,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>"scale"===this._scaleRotateDragData?.mode?this.adapter.scale:1}initialize(){this._tooltip=new Xa.m({view:this.tool.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([(0,o.z7)((()=>!this.tooltipOptions.enabled),(()=>this._tooltip.clear()),o.Vh),(0,o.wB)((()=>{const{adapter:e}=this,{info:t}=this._tooltip;return t===this._absoluteTooltipInfo&&this.getFocused()?[t,e.size,e.orientationClockwise]:[null]}),(([e])=>{e&&this._updateFocusTooltip()}))])}destroy(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,s.pR)(this._tooltip)}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=(0,Rr.mg)({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=(0,s.pR)(this._activeAnimation)}forEachManipulator(e){e(this._ringManipulator,Yn.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const t=this.tool.graphicState.graphic,i=(0,fa.Xt)(e,((e,i,n)=>{this._scaleRotateDragData=null;const a=this.adapter.startInteraction(),r={mode:"none",origin:(0,_.g)(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=r,this._updateDragState();const s=gt.rq.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,s),i.next(va(this.tool.view,(0,hn.O_)(e.renderLocation,s,(0,hn.vt)()))).next((e=>{const i=(0,hn.qb)(e.plane),n=Nn(e.renderStart,e.renderEnd,r.origin,i),s=Tr.wf.shortestSignedDiff(r.angle,n);r.angleDir=(0,Le.qE)(r.angleDir+s,-.3,.3),r.angle=n;const o=function(e,t){const i=(0,u.f)(gt.rq.get(),t.renderStart,e.origin),n=(0,u.f)(gt.rq.get(),t.renderEnd,e.origin),a=(0,u.l)(i),r=(0,u.l)(n);return 0===a?0:r/a}(r,e),l=o-this.adapter.scale;if(r.scaleDir=(0,Le.qE)(r.scaleDir+l,-.2,.2),this._onScaleChanged(),"none"===r.mode){const i=this.mode||function(e,t,i,n){const{renderStart:a,renderEnd:r}=e,s=Gr(a,n,gt.rq.get()),o=Gr(r,n,gt.rq.get());if((0,u.a)(s,o)<100)return null;const l=(0,u.f)(gt.rq.get(),a,i),c=(0,u.b)(gt.rq.get(),l,(0,hn.qb)(t)),h=a,d=(0,u.g)(gt.rq.get(),h,c),p=Gr(i,n,gt.rq.get()),_=s,g=Gr(d,n,gt.rq.get()),m=(0,u.f)(gt.rq.get(),g,_),f=(0,u.f)(gt.rq.get(),s,p),v=(0,Q.LV)(_,m),y=(0,Q.LV)(p,f);return(0,Q.kb)(v,o)<(0,Q.kb)(y,o)?"rotate":"scale"}(e,e.plane,r.origin,this.tool.view.state.camera);if(null!=i){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}r.mode=i}}switch(r.mode){case"rotate":a.state.angle=r.initialAngle+n;break;case"scale":a.state.scale=o,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case"start":case"update":switch(r.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:(0,Le.KJ)(r.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:o,yScale:o})}break;case"end":switch(r.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:(0,Le.KJ)(r.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:o,yScale:o})}}return"end"===e.action&&(this.startAnimation(zr(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),a.done()),e})).next(this._updateTooltipPipelineStep(r)),n.next((()=>{if(a.cancel(),null!=this._scaleRotateDragData){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(zr(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this.addHandles([i,e.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t,i){let n=0,a=null;const r=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=r,n=0,t()},update:e=>(n+=e,!a?.()||n>=i.delayMs?Vr.STOP:Vr.CONTINUE),destroy:()=>{a&&(e.getFocused=a),t()}}}(this,(()=>this._updateDelayedFocusedState()),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()})),e.events.on("immediate-click",(e=>{e.stopPropagation()})),(0,o.wB)((()=>this.tool.graphicState?.displaying),(e=>this._ringManipulator.available=e),o.Vh)])}_updateTooltipPipelineStep(e){return t=>{const i=this.tooltipOptions;if(!i.enabled)return t;if("end"===t.action)return this._updateFocusTooltip(),t;const n=this._tooltip,a=this.tooltipOptions.visualVariables;switch(e.mode){case"scale":{n.info=this._scaleTooltipInfo??=new Pr({tooltipOptions:i});const{size:e,scale:t}=this.adapter,r=a?.size,s=n.info;s.tooltipOptions=i,s.scale={value:t},s.size=null!=e?(0,Ji.d_)(e,"meters"):void 0,s.sizePrecision=Zr(r?.valueType),s.sizeUnit=r?.unit;break}case"rotate":{n.info=this._rotateTooltipInfo??=new Dr({tooltipOptions:i});const{orientationClockwise:e,relativeAngleClockwise:t}=this.adapter,r=a?.rotation,s=Zr(r?.valueType),o=n.info;o.tooltipOptions=i,o.rotation=null!=t?(0,Ji.Wq)(t,"radians","geographic"):void 0,o.rotationPrecision=s,o.rotationType=r?.rotationType??"geographic",o.orientation=null!=e?(0,Ji.Wq)(e,"radians","geographic"):void 0,o.orientationPrecision=s;break}}return t}}_updateFocusTooltip(){const{tooltipOptions:e,_tooltip:t}=this;if(e.enabled)if(this.getFocused()){const i=e.visualVariables,n=i?.rotation,a=i?.size,r=this.mode,{size:s,orientationClockwise:o}=this.adapter,l=null!=o&&(null==r||"rotate"===r),c=null!=s&&(null==r||"scale"===r);t.info=this._absoluteTooltipInfo??=new Cr({tooltipOptions:e});const h=t.info;h.tooltipOptions=e,h.orientation=l?(0,Ji.Wq)(o,"radians","geographic"):void 0,h.orientationPrecision=Zr(n?.valueType),h.rotationType=n?.rotationType??"geographic",h.size=c?(0,Ji.d_)(s,"meters"):void 0,h.sizeUnit=a?.unit,h.sizePrecision=Zr(a?.valueType)}else t.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(Ir.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(Ir.Unlocked,!(null!=this._scaleRotateDragData&&"none"!==this._scaleRotateDragData?.mode)),null!=this._scaleRotateDragData)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(Ir.ScaleIn|Ir.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Ir.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Ir.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(Ir.RotateLeft|Ir.RotateRight,!1),this._ringManipulator.updateStateEnabled(Ir.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Ir.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Ir.ScaleIn|Ir.ScaleOut|Ir.RotateLeft|Ir.RotateRight,!1)}_updateManipulatorTransform(){const e=(0,mt.c)(gt.Rc.get(),this.adapter.angle,(0,_.f)(0,0,1));if(null==e)return;const t=this.getScale(),i=(0,mt.E)(gt.Rc.get(),(0,u.s)(gt.rq.get(),t,t,t));this._ringManipulator.modelTransform=(0,mt.m)(gt.Rc.get(),i,e)}_createRingManipulator(){const e=(e,t,i)=>{const n=[],a=Math.ceil(128*(t-e)/(2*Math.PI));for(let r=0;r<a+1;r++){const s=e+r*(t-e)/a;n.push((0,_.f)(i*Math.cos(s),i*Math.sin(s),0))}return n},t=t=>e(0,2*Math.PI,t),i=this._createMaterial(1),n=(e,t,n=i)=>(0,qe.Nq)(n,(e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),a=t(ha),r=n(a,24),s={left:new Array,right:new Array},o=[];for(let _=0;_<2;_++){const t=_*Math.PI-Math.PI/4,a=Math.PI/2-da,r=t+a,l=t+Math.PI/2-a,c=e(r,l,190),h=n(c,9);o.push(c),o.push(e(r,l,201)),s.left.push(h),s.right.push(h.instantiate());for(let e=0;e<2;e++){const t=0===e,n=(0,ft.a)();if(t){(0,mt.b)(n,n,[1,-1,1]),(0,mt.k)(n,n,-r,[0,0,1]);const e=Math.round(.2*(c.length-1));n[12]=c[e][0],n[13]=c[e][1],n[14]=c[e][2]}else{(0,mt.k)(n,n,l,[0,0,1]);const e=Math.round(.8*(c.length-1));n[12]=c[e][0],n[13]=c[e][1],n[14]=c[e][2]}const a=(0,qe._B)(i,60,0,23,.5);(0,qe.xh)(a,n),(t?s.left:s.right).push(a)}}const l=[];for(let _=0;_<2;_++){const t=_*Math.PI-Math.PI/4,i=Math.PI/2-pa,a=t+i,r=t+Math.PI/2-i,s=e(a,r,213);l.push(n(s,9))}const c=this._createMaterial(.66),h=this._createMaterial(.5),d=this._createMaterial(.33),p=t(190),u=t(213),m=n(p,9,c),f=n(u,9,d),v=t(130),y=t(107),b=n(v,9,c),M=n(y,9,d);let w=[new Ln(r,Ir.DelayedFocused),new Ln(r.instantiate({material:h}),gn.p7.None)];this.mode&&"scale"!==this.mode||(w=w.concat([...l.map((e=>new Ln(e,Ir.DelayedFocused|Ir.Unlocked))),new Ln(m,Ir.DelayedFocused|Ir.ScaleIn),new Ln(f,Ir.DelayedFocused|Ir.ScaleIn),new Ln(b,Ir.DelayedFocused|Ir.ScaleOut),new Ln(M,Ir.DelayedFocused|Ir.ScaleOut)])),this.mode&&"rotate"!==this.mode||(w=w.concat([...s.right.map((e=>new Ln(e.instantiate(),Ir.DelayedFocused|Ir.Unlocked))),...s.left.map((e=>new Ln(e,Ir.DelayedFocused|Ir.RotateLeft))),...s.right.map((e=>new Ln(e,Ir.DelayedFocused|Ir.RotateRight)))]));const S=[a,...o];return new fn({view:this.tool.view,renderObjects:w,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,g.bh)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:S,direction:(0,_.f)(0,0,1)}})}_createMaterial(e){const t=new Rt.v({cullFace:fi.s2.Back,renderOccluded:We.m$.Transparent,isDecoration:!0});return this.addHandles((0,o.wB)((()=>({color:(0,a.f6)(this.tool.view.effectiveTheme.accentColor,e)})),(e=>t.setParameters(e)),o.Vh)),t}get test(){return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:e=>this._ringIndicatorDelayMs=e,tooltip:this._tooltip}}};function Gr(e,t,i){return t.projectToScreen(e,Hr),(0,u.s)(i,Hr[0],Hr[1],0)}var Vr;function zr(e,t){let i=null,n=1;const a=()=>n;return{start:()=>{n=e.getScale(),i=e.getScale,e.getScale=a,t()},update:e=>(n+=((n+1)/2-n)*Math.min(3*e,1),t(),Math.abs(n-1)<.01?Vr.STOP:Vr.CONTINUE),destroy:()=>{i&&(e.getScale=i),t()}}}function Zr(e){switch(e){case"integer":case"long":return 0;default:return null}}(0,n._)([(0,l.MZ)({constructOnly:!0})],Lr.prototype,"tool",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Lr.prototype,"adapter",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Lr.prototype,"tooltipOptions",void 0),(0,n._)([(0,l.MZ)()],Lr.prototype,"mode",void 0),(0,n._)([(0,l.MZ)()],Lr.prototype,"_activeAnimation",void 0),(0,n._)([(0,l.MZ)()],Lr.prototype,"updating",null),Lr=(0,n._)([(0,p.$)("esri.views.3d.interactive.editingTools.transformGraphic.GraphicScaleRotateTransform")],Lr),function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(Vr||(Vr={}));const Hr=(0,f.gs)();var Nr=i(69175),Fr=i(8695);function jr(e){return null!=e.geometry&&"mesh"===e.geometry.type?function(e){return e.vertexSpace.isRelative?function(e,t,i){let n=t?.clone(),a=(0,_.g)(i.origin),r=null,s=null;return{undo:t=>{r=e.transform?.clone(),s=(0,_.g)(i.origin),e.transform=n,e.vertexSpace.origin=a,t.notifyMeshTransformChanged()},redo:t=>{n=e.transform?.clone(),a=(0,_.g)(i.origin),e.transform=r,e.vertexSpace.origin=s,t.notifyMeshTransformChanged()}}}(e,e.transform,e.vertexSpace):function(e){let t,i=e.vertexAttributes.clonePositional();return{undo:n=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,n.notifyGeometryChanged()},redo:n=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,n.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){let t=e.geometry,i=null;return{undo(e){i=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=i}}}(e)}let Ur=class extends y.A{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([(0,o.z7)((()=>{const e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null}),(({interactionState:e})=>{this._updateMeshRotation(e)}),o.OH),(0,o.z7)((()=>{const e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null}),(({interactionState:e})=>{this._updateMeshSize(e)}),o.OH)])}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){const e=this.geometry.transform;if(null==e)return this._interactionState?.angle??0;const t=(0,Nr.yo)(e.rotation)[2];return Math.abs(t)>.999999?(0,Le.kU)((0,Nr.g7)(e.rotation))*Math.sign(t):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){const e=new Br({angle:this.angle});this._interactionState=e;const t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return jr(this.graphic)}_updateMeshRotation(e){const{angle:t,previousAngle:i}=e;e.previousAngle=t;const{geometry:n}=this,{vertexSpace:a}=n,r=(0,Le.KJ)(t-i);if(a.isGeoreferenced){const e=!a.isRelative&&this.viewingMode===he.RT.Global,t=this.geometry.anchor;this.geometry.rotate(0,0,r,{origin:t,geographic:e}),this.graphic.notifyGeometryChanged()}else{n.transform??=new Fr.A;const{transform:e}=n,t=(0,Nr.AU)(0,0,r,kr);e.rotation=(0,Nr.Zz)(e.rotation,t,e.rotation),this.graphic.notifyMeshTransformChanged()}}_updateMeshSize(e){const{scale:t,previousScale:i}=e;e.previousScale=t;const{geometry:n}=this,{vertexSpace:a}=n,r=t/i;if(a.isGeoreferenced){const e=!a.isRelative&&this.viewingMode===he.RT.Global,t=this.geometry.anchor;this.geometry.scale(r,{origin:t,geographic:e}),this.graphic.notifyGeometryChanged()}else{n.transform??=new Fr.A;const{transform:e}=n;e.scale=(0,u.i)(e.scale,e.scale,r),this.graphic.notifyMeshTransformChanged()}}};(0,n._)([(0,l.MZ)({constructOnly:!0})],Ur.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Ur.prototype,"geometry",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Ur.prototype,"viewingMode",void 0),(0,n._)([(0,l.MZ)()],Ur.prototype,"initialAngle",null),(0,n._)([(0,l.MZ)()],Ur.prototype,"angle",null),(0,n._)([(0,l.MZ)()],Ur.prototype,"angleClockwise",null),(0,n._)([(0,l.MZ)()],Ur.prototype,"relativeAngle",null),(0,n._)([(0,l.MZ)()],Ur.prototype,"relativeAngleClockwise",null),(0,n._)([(0,l.MZ)()],Ur.prototype,"scale",null),(0,n._)([(0,l.MZ)()],Ur.prototype,"_interactionState",void 0),Ur=(0,n._)([(0,p.$)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Ur);let Br=class extends y.A{get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,n._)([(0,l.MZ)()],Br.prototype,"angle",void 0),(0,n._)([(0,l.MZ)()],Br.prototype,"initialAngle",void 0),(0,n._)([(0,l.MZ)()],Br.prototype,"previousAngle",void 0),(0,n._)([(0,l.MZ)()],Br.prototype,"previousScale",void 0),(0,n._)([(0,l.MZ)()],Br.prototype,"scale",void 0),(0,n._)([(0,l.MZ)()],Br.prototype,"state",null),Br=(0,n._)([(0,p.$)("InteractionState")],Br);const kr=(0,Nr.vt)();let qr=class extends y.A{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,o.z7)((()=>null!=this._interactionState?this._interactionState.state:null),(e=>{this._updateSymbol(e)}),o.OH))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?function(e){return-(0,Le.kU)(e)}(this._orientationReferenceSymbolLayer.heading??0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){const e=this._sizeReferenceSymbolLayer;if(null==e)return null;const t=this.findLayerView(),i=this._graphicSymbol;if(null==t||null==i||"point-3d"!==i.type)return null;const n=t.getSymbolLayerSize(i,e);if("size"in n&&null!=n.size)return n.size;const a=this.sizeAxis;return!("width"in n)||null==n.width||null!=a&&"width"!==a&&"all"!==a&&"width-and-depth"!==a?!("depth"in n)||null==e.depth||null!=a&&"depth"!==a&&"all"!==a&&"width-and-depth"!==a?!("height"in n)||null==e.height||null!=a&&"height"!==a&&"all"!==a?null:n.height:n.depth:n.width}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type))}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type&&null!=e.heading))}get _graphicSymbol(){return null!=this.graphic?.symbol&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if(null!=this._interactionState||null==e||null==t)return Wr;const i=e.symbolLayers.map((i=>"object"===i.type?t.getSymbolLayerSize(e,i):null)).toArray(),n=e.clone(),a=this.angle,r=new Xr({originalSymbol:n,angle:a,initialSizes:i});this._interactionState=r;const s=()=>{this._interactionState=null};return{state:r,done:s,cancel:()=>{this._graphicSymbol=n,s()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e},redo:i=>{e=i.symbol,i.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:i,initialSizes:n}){const a=this._graphicSymbol;if(null==a||"point-3d"!==a.type)return;const r=a.clone(),s=-(0,Le.KJ)(t-this.initialAngle);let o=!1;this._forEachObjectSymbolLayerPair(i,r,((t,i,a)=>{const r=(t.heading??0)+s;i.heading!==r&&(i.heading=r,o=!0);const l=n[a];if(null!=l&&"width"in l){l.width=this.sizeFilter(l.width),l.height=this.sizeFilter(l.height),l.depth=this.sizeFilter(l.depth);const t=l.width*e;i.width!==t&&(i.width=t,o=!0);const n=l.depth*e;i.depth!==n&&(i.depth=n,o=!0);const a=l.height*e;i.height!==a&&(i.height=a,o=!0)}})),o&&(this._graphicSymbol=r)}_forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach(((e,n)=>{const a=t.symbolLayers.at(n);"object"===e.type&&"object"===a.type&&i(e,a,n)}))}};(0,n._)([(0,l.MZ)()],qr.prototype,"initialAngle",null),(0,n._)([(0,l.MZ)()],qr.prototype,"angle",null),(0,n._)([(0,l.MZ)()],qr.prototype,"angleClockwise",null),(0,n._)([(0,l.MZ)()],qr.prototype,"orientation",null),(0,n._)([(0,l.MZ)()],qr.prototype,"orientationClockwise",null),(0,n._)([(0,l.MZ)()],qr.prototype,"relativeAngle",null),(0,n._)([(0,l.MZ)()],qr.prototype,"relativeAngleClockwise",null),(0,n._)([(0,l.MZ)()],qr.prototype,"scale",null),(0,n._)([(0,l.MZ)()],qr.prototype,"size",null),(0,n._)([(0,l.MZ)()],qr.prototype,"sizeAxis",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],qr.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)()],qr.prototype,"_interactionState",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],qr.prototype,"findLayerView",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],qr.prototype,"sizeFilter",void 0),(0,n._)([(0,l.MZ)()],qr.prototype,"_sizeReferenceSymbolLayer",null),(0,n._)([(0,l.MZ)()],qr.prototype,"_orientationReferenceSymbolLayer",null),(0,n._)([(0,l.MZ)()],qr.prototype,"_graphicSymbol",null),qr=(0,n._)([(0,p.$)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],qr);const Wr={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Xr=class extends y.A{get state(){const{originalSymbol:e,angle:t,initialAngle:i,scale:n,initialSizes:a}=this;return{originalSymbol:e,angle:t,initialAngle:i,scale:n,initialSizes:a}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}};(0,n._)([(0,l.MZ)()],Xr.prototype,"originalSymbol",void 0),(0,n._)([(0,l.MZ)()],Xr.prototype,"angle",void 0),(0,n._)([(0,l.MZ)()],Xr.prototype,"initialAngle",void 0),(0,n._)([(0,l.MZ)()],Xr.prototype,"initialSizes",void 0),(0,n._)([(0,l.MZ)()],Xr.prototype,"scale",void 0),(0,n._)([(0,l.MZ)()],Xr.prototype,"state",null),Xr=(0,n._)([(0,p.$)("InteractionState")],Xr);let Yr=class extends(hi.A.EventedMixin(Ua.g)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new ka.A,this.type="transform-3d",this._updatingHandles=new Ki.U,this._scaleRotate=null,this._tooltip=null,this._translateGraphicTooltipInfo=null,this._translateGraphicXYTooltipInfo=null,this._translateGraphicZTooltipInfo=null}initialize(){const{graphic:e,view:t}=this;this.graphicState=new Hi({graphic:e}),this.addHandles((0,o.wB)((()=>this.tooltipOptions.enabled),(e=>{this._tooltip=e?new Xa.m({view:t}):(0,s.pR)(this._tooltip)}),o.pc)),this._moveManipulation=new za({tool:this,view:t,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Wn(e),radius:za.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator((t=>this.addHandles(t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:e}),t.stopPropagation()})))));const i=e=>t=>{this.addHandles(t.events.on("focus-changed",(({action:t})=>{const i=this._tooltip;null!=i&&("focus"===t?this._updateMoveTooltip(e):i.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(Ha.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(Ha.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(Ha.Z));const n=(0,g.bh)(e);this._moveManipulation.elevationInfo=n,this.addHandles(qt(this.graphicState));const{geometry:a}=e;if(this._moveManipulation.createGraphicDragPipeline(((i,r,s,o,l)=>{if(null!=a&&i===Ha.XY){const{snappingStep:i,cancelSnapping:r}=(0,Wa.L)({snappingContext:new qa.e({elevationInfo:n,pointer:l,editGeometryOperations:Ba.p.fromGeometry(new mn.A({spatialReference:a.spatialReference}),t.state.viewingMode),visualizer:new Ht,excludeFeature:e}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});o=o.next(r),s=s.next((0,fa.RS)(this.view,n)).next(...i)}return{steps:s=s.next((e=>(this._updateMoveTooltip(i,e),e))),cancel:o}}),this.graphicState,(e=>{const{action:t,graphic:i,dxScreen:n,dyScreen:a}=e,r={graphic:i,dxScreen:n,dyScreen:a};switch(t){case"start":this.emit("graphic-translate-start",r),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",r);break;case"end":this.emit("graphic-translate-stop",r)}})),this._moveManipulation.angle=null!=this._scaleRotate?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles((0,o.wB)((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new Lr({tool:this,mode:e,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.addHandles(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.addHandles([oa({view:this.view,graphic:this.graphic,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,r.hA)()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),(0,o.wB)((()=>t.scale),(()=>this._updateMoveAngle()))].filter(h.Ru)),this.addHandles(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((e=>{e instanceof fn&&this.addHandles(e.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))})),this.finishToolCreation()}destroy(){this._tooltip=(0,s.pR)(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,s.pR)(this._scaleRotate),this._scaleRotateAdapter=(0,s.pR)(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){null!=this._scaleRotate&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return null!=this.graphic.geometry&&"mesh"===this.graphic.geometry.type?new Ur({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new qr({graphic:this.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find((e=>e.layer===this.graphic.layer)),sizeAxis:this.tooltipOptions?.visualVariables?.size?.axis??null})}_forEachManipulator(e){this._moveManipulation?.forEachManipulator(e),this._scaleRotate?.forEachManipulator(e)}_hideManipulatorsForGraphicState(){return(0,o.wB)((()=>this.graphicState.displaying),(e=>{this._forEachManipulator((t=>t.available=e)),this._moveManipulation.zManipulation.available=e&&this.enableZ&&Wn(this.graphic)}))}_createGeometryUndoRecord(){return jr(this.graphic)}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this._updatingHandles.updating||!!this._scaleRotate?.updating}set location(e){this._moveManipulation.location=e,this._scaleRotate&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){this._scaleRotate?.cancelActiveAnimation()}_onScaleChanged(){null!=this._scaleRotate&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){this.view.state.viewingMode===he.RT.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){Un(this.view,this,this.graphic)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(e,t){const{tooltipOptions:i,_tooltip:n}=this;if(null==n)return;n.clear();const a=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case Ha.XY:n.info=this._translateGraphicTooltipInfo??=new Ya.ar({tooltipOptions:i}),this._updateMoveTooltipDistance(n.info,t,((e,t)=>(0,G.LS)(e,t,a)));break;case Ha.XY_AXIS:n.info=this._translateGraphicXYTooltipInfo??=new Ya.nW({tooltipOptions:i}),this._updateMoveTooltipDistance(n.info,t,((e,i)=>{const n=(0,G.LS)(e,i,a);return(0,Ji.hs)(n,Ta(t))}));break;case Ha.Z:n.info=this._translateGraphicZTooltipInfo??=new Ya.YI({tooltipOptions:i}),this._updateMoveTooltipDistance(n.info,t,$a.e5)}n.info.tooltipOptions=i}_updateMoveTooltipDistance(e,t,i){if(null!=t&&"end"!==t.action){const{mapStart:n,mapEnd:a}=t,r=i(n,a);e.distance=null!=r?r:Ji.r7}else e.distance=Ji.r7}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:null!=this._scaleRotate?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:e=>null!=this._scaleRotate?this._scaleRotate.test.setRingIndicatorDelayMs(e):null,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Yr.prototype,"view",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Yr.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Yr.prototype,"enableZ",void 0),(0,n._)([(0,l.MZ)()],Yr.prototype,"enableRotation",void 0),(0,n._)([(0,l.MZ)()],Yr.prototype,"enableScaling",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,type:ka.A})],Yr.prototype,"tooltipOptions",void 0),(0,n._)([(0,l.MZ)()],Yr.prototype,"graphicState",void 0),(0,n._)([(0,l.MZ)({value:!1})],Yr.prototype,"snapToScene",null),(0,n._)([(0,l.MZ)({constructOnly:!0})],Yr.prototype,"snappingManager",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],Yr.prototype,"type",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],Yr.prototype,"updating",null),Yr=(0,n._)([(0,p.$)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Yr);var $r=i(24793),Qr=i(21877),Jr=i(4130),Kr=i(77841);let es=class extends((0,$r.O)(Qr.oY)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,s.CM)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};(0,n._)([(0,l.MZ)({readOnly:!0,json:{read:!1,write:!0}})],es.prototype,"type",void 0),(0,n._)([(0,l.MZ)({type:mn.A}),(0,Kr.P)()],es.prototype,"position",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Kr.P)(),(0,Jr.w)((e=>Tr.ie.normalize((0,c.GB)(e),0,!0)))],es.prototype,"heading",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Kr.P)(),(0,Jr.w)((e=>Tr.ie.normalize((0,c.GB)(e),0,!0)))],es.prototype,"tilt",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0}),(0,Kr.P)()],es.prototype,"width",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0}),(0,Kr.P)()],es.prototype,"height",void 0),es=(0,n._)([(0,p.$)("esri.analysis.SlicePlane")],es);i(58331);var ts=i(28769);(0,ut.f)(0,0,0,.04);(0,d.A)("mac"),Math.cos((0,Le.kU)(45)),Math.cos((0,Le.kU)(5));const is=22.5;(0,ft.a)();var ns=i(25146),as=i(27776),rs=i(52873),ss=i(78699);Ge.Y;class os extends fe.w{initializeProgram(e){return new ve.B(e.rctx,os.shader.get().build(this.configuration),Ve.D)}initializePipeline(){return(0,Me.Ey)({blending:(0,Me.p3)(be.dn.ONE,be.dn.ONE,be.dn.ONE_MINUS_SRC_ALPHA,be.dn.ONE_MINUS_SRC_ALPHA),depthTest:{func:be.MT.LESS},colorWrite:Me.wE})}}os.shader=new me.$(ss.S,(()=>i.e(9799).then(i.bind(i,99799))));rs.W;bi.A;i(86942);i(80715),i(70397),i(55821);var ls;i(84698);function cs(e){const t=(0,u.l)(e.basis1),i=(0,u.l)(e.basis2);return.3*Math.min(t,i)}function hs(e){return cs(e)}function ds(e){return 0!==e.direction[0]&&0!==e.direction[1]}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(ls||(ls={}));const ps=gn.SJ.Custom1;var us,_s;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(us||(us={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(_s||(_s={}));const gs=gn.SJ.Custom2,ms=((0,Q.vt)(),Math.PI/2),fs=gn.SJ.Custom1,vs=gn.SJ.Custom2;var ys,bs=i(76743);!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(ys||(ys={}));class Ms extends fn{constructor(e,t){const i=new Ye.W({width:1,renderOccluded:We.m$.OccludeAndTransparent,isDecoration:!0}),n=new Rt.v({cullFace:fi.s2.Back,renderOccluded:We.m$.Opaque,isDecoration:!0}),r=new Rt.v({cullFace:fi.s2.Back,renderOccluded:We.m$.Opaque,isDecoration:!0}),s=new Rt.v({cullFace:fi.s2.Back,renderOccluded:We.m$.Opaque,isDecoration:!0}),l=new Rt.v({writeDepth:!1,cullFace:fi.s2.Front,renderOccluded:We.m$.Transparent,isDecoration:!0});super({view:e,...ws({offsetMode:t,tubeMaterial:n,tipMaterial:r,capMaterial:s,outlineMaterial:l,calloutMaterial:i})}),this._themeHandle=(0,o.wB)((()=>e.effectiveTheme.accentColor),(e=>{const t=(0,a.bJ)(e),o=v.A.toUnitRGBA(e),c=v.A.toUnitRGBA(t),h=v.A.toUnitRGBA(v.A.blendColors(t,e,.4)),d=v.A.toUnitRGBA(v.A.blendColors(t,e,.14));i.setParameters({color:o}),n.setParameters({color:d}),r.setParameters({color:c}),s.setParameters({color:h}),l.setParameters({color:o})}),o.Vh)}destroy(){this._themeHandle.remove(),super.destroy()}}function ws({offsetMode:e,tubeMaterial:t,tipMaterial:i,capMaterial:n,outlineMaterial:a,calloutMaterial:r}){const s=e===ys.CENTER_ON_CALLOUT?40:0,o=[(0,_.f)(s,0,-24),(0,_.f)(s,0,24)],l=function(e,t){const i=(0,u.f)((0,_.c)(),e[e.length-1],e[e.length-2]);if((0,u.n)(i,i),(0,u.i)(i,i,is),(0,u.g)(i,i,e[e.length-1]),t){const t=(0,u.f)((0,_.c)(),e[0],e[1]);return(0,u.n)(t,t),(0,u.i)(t,t,is),(0,u.g)(t,t,e[0]),[t,...e,i]}return[...e,i]}(o,!0),c=Ss({vertices:o,padding:0,materials:{tube:t,tip:i,cap:n}}),h=Ss({vertices:o,padding:2.25,materials:{tube:a,tip:a,cap:a}}),d=(0,qe.Z8)(r,[[s,0,0],[s-40,0,0]]),p=(0,qe.Z8)(r,[[s,0,0],[s-40,0,0]]);return{renderObjects:[...c.normal.map((e=>new Ln(e,gn.p7.Unfocused|ps))),...h.normal.map((e=>new Ln(e,gn.p7.Unfocused|ps))),new Ln(d,gn.p7.Unfocused|ps|gs),...c.focused.map((e=>new Ln(e,gn.p7.Focused|ps))),...h.focused.map((e=>new Ln(e,gn.p7.Focused|ps))),new Ln(p,gn.p7.Focused|ps|gs)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[l]},collisionPriority:1,radius:11,state:ps}}function Ss({vertices:e,padding:t,materials:i}){const n=n=>{const a=e.slice(0),r=(0,u.f)(gt.rq.get(),a[0],a[1]);(0,u.n)(r,r);const s=(0,u.f)(gt.rq.get(),a[a.length-1],a[a.length-2]);if((0,u.n)(s,s),t>0){const e=(0,u.i)((0,_.c)(),s,-t);a[a.length-1]=(0,u.g)(e,e,a[a.length-1]);const i=(0,u.i)((0,_.c)(),r,-t);a[0]=(0,u.g)(i,i,a[0])}const o=n?1.15:1,l=is*o,c=11*o,h=(0,mt.g)(gt.Rc.get());if(t>0){const e=l/4,i=(0,u.s)(gt.rq.get(),0,e,0),n=1+t/e;(0,mt.w)(h,h,i),(0,mt.b)(h,h,(0,u.s)(gt.rq.get(),n,n,n)),(0,mt.w)(h,h,(0,u.i)(i,i,-1/n))}const d=(0,mt.g)((0,ft.a)()),p=(0,_.f)(0,1,0),g=(0,mt.F)((0,ft.a)(),(0,bs.r)(gt.J8.get(),p,s));g[12]=a[a.length-1][0],g[13]=a[a.length-1][1],g[14]=a[a.length-1][2],(0,mt.m)(g,g,h);const m=i.tube,f=function(e,t,i){const n=[],a=12;for(let r=0;r<a;r++){const t=r/a*2*Math.PI;n.push([Math.cos(t)*e,Math.sin(t)*e])}return(0,qe.Nq)(i,n,t,[],[],!1)}(3*(n?1.15:1)+t,a,m);f.transformation=d;const v=[f],y=i.tip,b=(0,qe.EE)(y,l,c,24,!1,!1,!0);b.transformation=g,v.push(b);const M=i.cap,w=(0,qe.EE)(M,l,c,24,!1,!0,!1);w.transformation=g,v.push(w);const S=(0,mt.F)((0,ft.a)(),(0,bs.r)(gt.J8.get(),p,r));return S[12]=a[0][0],S[13]=a[0][1],S[14]=a[0][2],(0,mt.m)(S,S,h),v.push(b.instantiate({transformation:S})),v.push(w.instantiate({transformation:S})),v};return{normal:n(!1),focused:n(!0)}}var xs=i(3183);class Os{constructor(e,t,i,n){this._tool=e,this._graphicState=t,this._editGeometryOperations=i,this._bounds=n,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;const a=this._tool,r=a.view;this.moveXYGraphicManipulation=new Fa({view:r,tool:a,graphicState:this._graphicState}),a.addHandles(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=new Ms(r,ys.CENTER_ON_CALLOUT),this.moveZManipulator.state|=gs,a.manipulators.add(this.moveZManipulator),a.addHandles([this._createMoveZDragPipeline()]),a.addHandles([a.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null}))])}destroy(){this.moveXYGraphicManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(e){this.moveXYGraphicManipulation.forEachManipulator(e),e(this.moveZManipulator,Yn.TRANSLATE_Z)}updateManipulators(e,t){const i=this.moveZManipulator,n=(0,mt.o)(gt.Rc.get(),e,Math.PI);n[12]=0,n[13]=0,n[14]=0,i.modelTransform=n,i.renderLocation=(0,u.f)(gt.rq.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.moveXYGraphicManipulation.grabbing||this.moveXYGraphicManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){const e=this._tool.tooltipOptions;return this._moveXYTooltipInfo??=new Ya.ar({tooltipOptions:e})}_computeMoveZTooltipInfo(){const e=this._tool,t=e.tooltipOptions,i=this._moveZTooltipInfo??=new Ya.YI({tooltipOptions:t});if(this.moveZManipulator.dragging){const e=this._bounds,t=e.mapBoundsStart.origin,n=e.mapBounds.origin,a=(0,$a.cL)(t,n,this._tool.view.spatialReference);if(null==a)return null;i.distance=a}else i.distance=(0,Ji.d_)(0,e.moveUnit);return i}_updateMoveTooltip(e,t){if(t===Ha.XY||t===Ha.XY_AXIS){const t=(0,G.LS)(e.mapStart,e.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");null!=t&&null!=this._moveXYTooltipInfo&&(this._moveXYTooltipInfo.distance=t)}return e}_createMoveXYGraphicDragPipeline(){return this.moveXYGraphicManipulation.createDragPipeline(((e,t,i)=>this._applyGraphicMoveSteps(t,i,Ha.XY)))}_createMoveZDragPipeline(){const e=this._editGeometryOperations.data.spatialReference;return(0,fa.Xt)(this.moveZManipulator,((t,i,n)=>{const a=(0,_.g)(t.renderLocation),r=i.next(wa(this._tool.view,a,e)).next((0,fa.sO)());this._applyGraphicMoveSteps(r,n,Ha.Z)}))}_applyGraphicMoveSteps(e,t,i){const n=this._tool,a=n.graphic,r=e.next((e=>("start"===e.action&&(n.inputState={type:"move"},this._bounds.backupMapBounds(),n.emit("graphic-translate-start",{graphic:a,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next((0,fa.EX)()).next(this._moveDragUpdateGeometry()).next((e=>{const t={graphic:a,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||(e.mapEnd.z??0)-(e.mapStart.z??0))&&n.emit("graphic-translate",t);break;case"end":n.inputState=null,n.emit("graphic-translate-stop",t)}return e})).next((e=>this._updateMoveTooltip(e,i)));return t.next((()=>{null!=n.inputState&&n.emit("graphic-translate-stop",{graphic:a,dxScreen:0,dyScreen:0}),n.cancel()})),r}_moveDragUpdateGeometry(){const e=this._tool;return t=>{if(null==e.inputState||"move"!==e.inputState.type)return t;const i=[];for(const e of this._editGeometryOperations.data.components)i.push(...e.vertices);const n="start"===t.action?dr.B.NEW_STEP:dr.B.ACCUMULATE_STEPS,a=this._editGeometryOperations.moveVertices(i,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n);return(0,xs.Bb)(a,this._bounds.mapBounds),e.graphic.geometry=this._editGeometryOperations.data.geometry,t}}}const Es="theme-style";function As(e,t){return function(e,t){const i=new Image(t,t);return i.src=e,i}(function(e){const t=(new XMLSerializer).serializeToString(e);return`data:image/svg+xml;base64,${btoa(t)}`}(function(e,{accentColor:t,contrastColor:i}){const n=t.toHex(),a=t.a,r=i.toHex(),s=i.a,o=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem(Es);return o&&(o.innerHTML=`\n      .contrast-fill { fill: ${r}; fill-opacity: ${s}; }\n      .contrast-stroke { stroke: ${r}; stroke-opacity: ${s};  }\n      .accent-fill { fill: ${n}; fill-opacity: ${a}; }\n      .accent-stroke { stroke: ${n}; stroke-opacity:  ${a}; }`),e}(function(e){const t=e.split(",")[1],i=atob(t);return(new DOMParser).parseFromString(i,"image/svg+xml")}(e),t)),t.size)}var Ts=i(28443);var Rs=i(89140),Ds=i(98546),Ps=i(44350);class Cs extends fe.w{initializeProgram(e){return new ve.B(e.rctx,Cs.shader.get().build(this.configuration),Gs)}_setPipelineState(e,t){const i=this.configuration,n=e===xi.y.NONE,a=e===xi.y.FrontFace;return(0,Me.Ey)({blending:i.output!==yi.V.Color&&i.output!==yi.V.Alpha||!i.transparent?null:n?Is:(0,Si.ez)(e),culling:(0,Me.Xt)(i.cullFace),depthTest:{func:(0,Si.K_)(e)},depthWrite:n?i.writeDepth?Me.kn:null:(0,Si.XO)(e),colorWrite:Me.wE,stencilWrite:i.hasOccludees?Ds.v0:null,stencilTest:i.hasOccludees?t?Ds.a9:Ds.qh:null,polygonOffset:n||a?null:(0,Si.aB)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}Cs.shader=new me.$(Ps.I,(()=>i.e(3010).then(i.bind(i,3010))));const Is=(0,Me.ox)(be.dn.ONE,be.dn.ONE_MINUS_SRC_ALPHA);class Ls extends Oi.E{constructor(){super(...arguments),this.output=yi.V.Color,this.cullFace=fi.s2.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=xi.y.NONE,this.multipassEnabled=!1,this.cullAboveGround=!1,this.perspectiveInterpolation=!0}}(0,n._)([(0,Ce.W)({count:yi.V.COUNT})],Ls.prototype,"output",void 0),(0,n._)([(0,Ce.W)({count:fi.s2.COUNT})],Ls.prototype,"cullFace",void 0),(0,n._)([(0,Ce.W)()],Ls.prototype,"hasSlicePlane",void 0),(0,n._)([(0,Ce.W)()],Ls.prototype,"transparent",void 0),(0,n._)([(0,Ce.W)()],Ls.prototype,"enableOffset",void 0),(0,n._)([(0,Ce.W)()],Ls.prototype,"writeDepth",void 0),(0,n._)([(0,Ce.W)()],Ls.prototype,"hasOccludees",void 0),(0,n._)([(0,Ce.W)({count:xi.y.COUNT})],Ls.prototype,"transparencyPassType",void 0),(0,n._)([(0,Ce.W)()],Ls.prototype,"multipassEnabled",void 0),(0,n._)([(0,Ce.W)()],Ls.prototype,"cullAboveGround",void 0),(0,n._)([(0,Ce.W)()],Ls.prototype,"perspectiveInterpolation",void 0),(0,n._)([(0,Ce.W)({constValue:!1})],Ls.prototype,"occlusionPass",void 0);const Gs=new Map([[ge.r.POSITION,0],[ge.r.UV0,2],[ge.r.PERSPECTIVEDIVIDE,3]]);class Vs extends rs.W{constructor(e){super(e,new Hs),this.supportsEdges=!0,this._vertexAttributeLocations=Gs,this._configuration=new Ls}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<Si.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}produces(e,t){return(t===yi.V.Color||t===yi.V.Alpha||t===yi.V.Highlight)&&(e===De.N.DRAPED_MATERIAL||(t===yi.V.Highlight?e===De.N.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?De.N.TRANSPARENT_MATERIAL:De.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:De.N.OPAQUE_MATERIAL)))}createGLMaterial(e){return new zs(e)}createBufferWriter(){const e=as.zK.clone();return this.parameters.perspectiveInterpolation&&e.f32(ge.r.PERSPECTIVEDIVIDE),new Zs(e)}}class zs extends Rs.m{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(Cs,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output!==yi.V.Color&&this._output!==yi.V.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class Zs extends ns.Z{write(e,t,i,n,a){for(const r of this.vertexBufferLayout.fields.keys()){const s=i.attributes.get(r);if(s)if(r===ge.r.PERSPECTIVEDIVIDE){(0,Mi.vA)(1===s.size);const e=n.getField(r,vi.Y$);e&&(0,wi.uO)(s,e,a)}else(0,wi.zC)(r,s,e,t,n,a)}}}class Hs extends We.qA{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=fi.s2.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}}class Ns extends fn{constructor(e,t){const i=new Vs({transparent:!0,writeDepth:!1,renderOccluded:We.m$.Opaque,isDecoration:!0}),n=Zn.calloutWidth,r=new Ye.W({width:n,renderOccluded:We.m$.OccludeAndTransparent,isDecoration:!0});super({view:e,...Fs({imageMaterial:i,calloutMaterial:r})}),this._currentTexture=null,this._themeHandle=(0,o.wB)((()=>e.effectiveTheme.accentColor),(e=>{const n=(0,a._L)(e,.5),s=(0,a.bJ)(e),o=this._currentTexture,l=t(n,s);i.setParameters({textureId:l.texture.id}),r.setParameters({color:v.A.toUnitRGBA(e)}),this._currentTexture=l,o?.release()}),o.Vh)}destroy(){this._themeHandle.remove(),this._currentTexture?.release(),super.destroy()}}function Fs({imageMaterial:e,calloutMaterial:t}){const{focusMultiplier:i,calloutLength:n,discRadius:a}=Zn,r=a*i,s=(e,t)=>{const i=[0,1,2,2,3,0];return new Tt.V(t,[[ge.r.POSITION,new At.n([n-e,-e,0,n+e,-e,0,n+e,e,0,n-e,e,0],i,3,!0)],[ge.r.UV0,new At.n([0,0,1,0,1,1,0,1],i,2,!0)]])},o=(0,qe.Z8)(t,[[0,0,0],[n-a,0,0]]),l=(0,qe.Z8)(t,[[0,0,0],[n-r,0,0]]),c=ps;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[n,0,0]},focusMultiplier:i,radius:a,renderObjects:[new Ln(s(a,e),gn.p7.Unfocused|c),new Ln(o,gn.p7.Unfocused|c),new Ln(s(r,e),gn.p7.Focused|c),new Ln(l,gn.p7.Focused|c)],state:c}}var js=i(63387),Us=i(63937);class Bs{constructor(e,t,i){this._tool=e,this._editGeometryOperations=t,this._bounds=i,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;const n=this._tool,a=n.view,r=!a._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this.rotateManipulator=new Ns(a,((e,t)=>function(e,t){const{accentColor:i,contrastColor:n,preMultiplyAlpha:a}=t;return e.fromData(`heading-rotate:[accent:${i},contrast:${n},size:64]`,(()=>new Ts.g(As("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NnoiIGNsYXNzPSJhY2NlbnQtZmlsbCIvPjxwYXRoIHN0cm9rZS13aWR0aD0iNC45OSIgZD0iTTIwLjA1IDQwLjg2YTE1LjA1IDE1LjA1IDAgMCAwIDE3LjE0LTEuNSAxNS4wNSAxNS4wNSAwIDAgMCA0LjQ3LTE2LjY1IDE1LjA1IDE1LjA1IDAgMCAwLTIyLjcyLTcuMTUgMTUuMDUgMTUuMDUgMCAwIDAtNS41IDcuMTUiIGNsYXNzPSJjb250cmFzdC1zdHJva2UiLz48cGF0aCBkPSJtMTAuOTcgMzUuNTcgNS4zOCAxMi4wNyA3Ljc5LTEzLjQ3LTEzLjE3IDEuNHoiIGNsYXNzPSJjb250cmFzdC1maWxsIi8+PC9zdmc+",{accentColor:i,contrastColor:n,size:64}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:a})))}(a.textures,{accentColor:e,contrastColor:t,preMultiplyAlpha:r}))),n.addHandles([this.rotateManipulator.events.on("grab-changed",(e=>this._onRotateGrab(e))),this._createRotateDragPipeline(this.rotateManipulator)]),n.manipulators.add(this.rotateManipulator),n.addHandles([n.on("graphic-rotate-start",(e=>{this._startAngle=e.angle})),n.on("graphic-rotate",(e=>{this._endAngle=e.angle})),n.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0}))])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(e){e(this.rotateManipulator,Yn.ROTATE)}updateManipulators(e,t){const i=this._bounds.mapBounds.plane[2]<0?Math.PI:0,n=(0,mt.r)(gt.Rc.get(),e,i);n[12]=0,n[13]=0,n[14]=0,this.rotateManipulator.modelTransform=n,this.rotateManipulator.renderLocation=(0,u.g)(gt.rq.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){const e=this._tool.tooltipOptions,t=this._rotateTooltipInfo??=new Us.d({tooltipOptions:e});return t.angle=this._startAngle-this._endAngle,t}_onRotateGrab({action:e,screenPoint:t}){const i=this._tool,n=this._bounds;if("start"!==e||!t)return;const a=function(e,t,i,n){const a=t.worldUpAtPosition(e.origin,gt.rq.get()),r=gt.rq.get();switch(i){case us.HEADING:(0,u.c)(r,a);break;case us.TILT:(0,u.c)(r,e.basis1)}return(0,hn.O_)(e.origin,r,n)}(n.displayBounds,i.view.renderCoordsHelper,us.HEADING,(0,hn.vt)()),r=pn(i.view.state.camera,t);(0,hn.Ui)(a,r,gt.rq.get())&&(n.backupMapBounds(),i.inputState={type:"rotate",rotatePlane:a})}_createRotateDragPipeline(e){const t=this._tool,i=t.graphic;return(0,fa.Xt)(e,((e,n,a)=>{const r=t.inputState;null!=r&&(n.next((e=>("start"===e.action&&t.emit("graphic-rotate-start",{graphic:i,angle:0}),e))).next(va(t.view,r.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(r)).next(this._rotateDragUpdateGeometry()).next((e=>{const n={graphic:i,angle:(0,Le.KJ)(e.rotateAngle)};switch(e.action){case"start":case"update":t.emit("graphic-rotate",n);break;case"end":t.inputState=null,t.emit("graphic-rotate-stop",n)}return e})),a.next((()=>{null!=t.inputState&&t.emit("graphic-rotate-stop",{graphic:i,angle:0}),t.cancel()})))}))}_rotateDragRenderPlaneToRotate(e){return t=>{const i=(0,hn.qb)(e.rotatePlane),n=Nn(t.renderStart,t.renderEnd,this._bounds.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:n}}}_rotateDragUpdateGeometry(){const e=this._tool,t=this._bounds;return i=>{const n=(0,u.c)((0,_.c)(),t.mapBoundsStart.origin),a=[];for(const e of this._editGeometryOperations.data.components)a.push(...e.vertices);const r="start"===i.action?dr.B.NEW_STEP:dr.B.ACCUMULATE_STEPS,s=this._editGeometryOperations.rotateVertices(a,n,i.rotateAngle,r,js.K.REPLACE);return(0,ts.c)(t.mapBoundsStart,t.mapBounds),(0,xs.Bb)(s,t.mapBounds),e.graphic.geometry=this._editGeometryOperations.data.geometry,i}}}class ks extends fn{constructor(e,t){const i=ds(t),n=i?4:1,a=2*n,r={renderOccluded:We.m$.OccludeAndTransparent,isDecoration:!0},s=new Ye.W({...r,width:n}),l=new Ye.W({...r,width:a}),c=new Ye.W({...r,width:1});super({view:e,...Hn,...qs({isCorner:i,unfocusedMaterial:s,focusedMaterial:l,outlineMaterial:c})}),this._themeHandle=(0,o.wB)((()=>e.effectiveTheme.accentColor),(e=>{const t=v.A.toUnitRGBA(e);s.setParameters({color:t}),l.setParameters({color:t}),c.setParameters({color:t})}),o.Vh)}destroy(){this._themeHandle.remove(),super.destroy()}}function qs({isCorner:e,unfocusedMaterial:t,focusedMaterial:i,outlineMaterial:n}){const a=e?[(0,_.f)(1,0,0),(0,_.f)(0,0,0),(0,_.f)(0,1,0)]:[(0,_.f)(1,0,0),(0,_.f)(-1,0,0)];return{renderObjects:[new Ln((0,qe.Z8)(t,a),gn.p7.Unfocused|fs),new Ln((0,qe.Z8)(i,a),gn.p7.Focused|fs),new Ln((0,qe.Z8)(n,a),vs)],collisionType:{type:"line",paths:[a]},radius:e?6:4,state:fs}}class Ws{constructor(e,t,i){this._tool=e,this._onDisplayBoundsChanged=t,this.mapBounds=(0,ts.a)(),this.mapBoundsStart=(0,ts.a)(),this.displayBounds=(0,ts.a)(),this._calculateMapBounds(i)}get displayBoundsMargin(){const{view:e,graphic:t}=this._tool,i=e.pointsOfInterest?.centerOnSurfaceFrequent.location??t.geometry?.extent?.center;return i?Xs*e.pixelSizeAt(i):0}backupMapBounds(){(0,ts.c)(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged()}_calculateMapBounds(e){const{view:t,attachmentOrigin:i}=this._tool,n=e.geometry,a=function(e){const t=kn(e);return(0,x.f)(Math.cos(t),Math.sin(t))}(n);(0,S.a)(a,a,-1);const r=t.spatialReference,s=n.spatialReference,o=i?t.pixelSizeAt(i)*(0,Ui.KX)(r)/(0,Ui.GA)(s):0;(0,xs.G3)(a,e,Ys*o,this.mapBounds)}_calculateDisplayBounds(){const{view:e,attachmentOrigin:t,graphic:i}=this._tool;if(!i.geometry)return;const n=t?.z??(0,yt.nG)(this.mapBounds.origin,e.elevationProvider,bt.F.fromElevationInfo((0,g.bh)(i)),e.renderCoordsHelper),a=(0,ts.c)(this.mapBounds);a.origin[2]=n??0,function(e,t,i,n=0,a){a||(a=(0,ts.a)()),t.toRenderCoords(e.origin,i,a.origin);const r=gt.rq.get();(0,u.g)(r,e.origin,e.basis1),(0,u.g)(r,r,e.basis2),t.toRenderCoords(r,i,r);const s=gt.rq.get();(0,u.g)(s,e.origin,e.basis1),(0,u.f)(s,s,e.basis2),t.toRenderCoords(s,i,s);const o=gt.rq.get();(0,u.f)(o,e.origin,e.basis1),(0,u.f)(o,o,e.basis2),t.toRenderCoords(o,i,o);const l=gt.rq.get();(0,u.f)(l,e.origin,e.basis1),(0,u.g)(l,l,e.basis2),t.toRenderCoords(l,i,l);const c=(0,u.p)(gt.rq.get(),r,s,.5);(0,u.f)(c,c,a.origin);const h=(0,u.p)(gt.rq.get(),o,l,.5);(0,u.f)(h,a.origin,h),(0,u.p)(a.basis1,c,h,.5);const d=(0,u.p)(gt.rq.get(),l,r,.5);(0,u.f)(d,d,a.origin);const p=(0,u.p)(gt.rq.get(),s,o,.5);(0,u.f)(p,a.origin,p),(0,u.p)(a.basis2,d,p,.5);const _=(0,u.b)(gt.rq.get(),a.basis1,a.basis2),g=(0,u.b)(_,_,a.basis1);(0,u.n)(g,g),(0,u.i)(a.basis2,g,(0,u.j)(a.basis2,g)),(0,u.i)(a.basis1,a.basis1,1+n/(0,u.l)(a.basis1)),(0,u.i)(a.basis2,a.basis2,1+n/(0,u.l)(a.basis2)),(0,ts.u)(a)}(a,e.renderCoordsHelper,i.geometry.spatialReference,this.displayBoundsMargin,this.displayBounds)}}const Xs=10,Ys=80;function $s(e,t,i,n){const a=gt.rq.get();(0,u.f)(a,(0,u.f)(a,e.origin,e.basis1),e.basis2);const r=gt.rq.get();(0,u.q)(r,a,e.basis1,2);const s=gt.rq.get();(0,u.q)(s,r,e.basis2,2);const o=gt.rq.get();(0,u.q)(o,a,e.basis2,2),a[2]=r[2]=s[2]=o[2]=t;const l=n?"on-the-ground":"absolute-height",c=(0,Ji.T9)((0,G.wF)(a,r,i,l),(0,G.wF)(o,s,i,l)),h=(0,Ji.T9)((0,G.wF)(r,s,i,l),(0,G.wF)(a,o,i,l));return null==h||null==c?null:[c,h]}class Qs{get zMax(){if(!this._zMaxDirty)return this._zMax;const e=this._editGeometryOperations.data;if(e.geometry.hasZ){const t=e.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;for(const i of e.components)for(const e of i.vertices){const i=t.getZ(e.pos)??0;this._zMax=Math.max(i,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(e,t,i,n,a){this._tool=e,this._graphicState=t,this._editGeometryOperations=i,this._bounds=n,this._preserveAspectRatioStep=a,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._scaleTooltipInfo=null,this._displayBoundsStart=(0,ts.a)(),this._displayBoundsMarginStart=0,this._startScale=(0,x.a)(),this._endScale=(0,x.a)(),this._sizeStart=null,this._zMax=0,this._zMaxDirty=!0;const r=this._tool,s=r.view;this.resizeManipulators=this._resizeHandles.map((e=>{const t=new ks(s,e);return r.addHandles([t.events.on("grab-changed",(e=>this._onResizeGrab(e))),this._createResizeDragPipeline(t,e)]),t})),r.manipulators.addMany(this.resizeManipulators),r.addHandles([r.on("graphic-scale-start",(e=>{(0,S.s)(this._startScale,e.xScale,e.yScale),(0,S.s)(this._endScale,e.xScale,e.yScale)})),r.on("graphic-scale",(e=>{(0,S.s)(this._endScale,e.xScale,e.yScale)})),r.on("graphic-scale-stop",(()=>{(0,S.s)(this._startScale,0,0),(0,S.s)(this._endScale,0,0)})),this._graphicState.on("changed",(()=>{"resize"!==r.inputState?.type&&(this._zMaxDirty=!0)}))])}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){this.resizeManipulators.forEach((t=>e(t,Yn.SCALE)))}updateManipulators(e,t){this.resizeManipulators.forEach(((i,n)=>{!function(e,t,i,n){const a=(0,u.l)(n.basis1),r=(0,u.l)(n.basis2),s=cs(n),o=hs(n),l=(0,u.s)(gt.rq.get(),0,0,0);(0,u.g)(l,(0,u.i)(gt.rq.get(),n.basis1,t.direction[0]),(0,u.i)(gt.rq.get(),n.basis2,t.direction[1])),(0,u.g)(l,n.origin,l);let c=0,h=1;if(ds(t))1===t.direction[0]&&-1===t.direction[1]?c=ms:1===t.direction[0]&&1===t.direction[1]?c=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(c=3*Math.PI/2),h=o;else{const e=0!==t.direction[0]?1:2;c=1===e?ms:0,h=(1===e?r:a)-s}const d=(0,mt.j)(gt.Rc.get(),c);(0,mt.b)(d,d,(0,u.s)(gt.rq.get(),h,h,h)),(0,mt.m)(d,i,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=l}(i,this._resizeHandles[n],e,t)}))}getUpdatedTooltipInfo(){return this.resizeManipulators.some((e=>e.focused))?this._computeScaleTooltipInfo():null}_computeScaleTooltipInfo(){const e=this._tool,t=e.tooltipOptions,i=this._scaleTooltipInfo??=new Us.c({tooltipOptions:t}),n=e.graphic.geometry;if(null==n)return null;const a=$s(this._bounds.mapBounds,this.zMax,n.spatialReference,this._graphicState.isDraped);return null==a?null:(i.xSize=a[0],i.ySize=a[1],null!=this._sizeStart&&this.resizeManipulators.some((e=>e.dragging))?(i.xScale=a[0].value/this._sizeStart[0].value,i.yScale=a[1].value/this._sizeStart[1].value):(i.xScale=1,i.yScale=1),i)}_onResizeGrab({action:e,screenPoint:t}){const i=this._tool,n=this._bounds;if("start"!==e||!t||!i.graphic.geometry)return;const a=pn(i.view.state.camera,t);(0,hn.Ui)(n.displayBounds.plane,a,gt.rq.get())&&(n.backupMapBounds(),(0,ts.c)(n.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=n.displayBoundsMargin,this._sizeStart=$s(n.mapBoundsStart,this.zMax,i.graphic.geometry.spatialReference,this._graphicState.isDraped),i.inputState={type:"resize"})}_createResizeDragPipeline(e,t){const i=this._tool,n=i.graphic;return(0,fa.Xt)(e,((e,a,r)=>{null!=i.inputState&&(a.next((e=>("start"===e.action&&i.emit("graphic-scale-start",{graphic:n,xScale:1,yScale:1}),e))).next(va(i.view,this._displayBoundsStart.plane)).next((e=>({...e,handle:t}))).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._resizeDragUpdateGeometry()).next((e=>{const t={graphic:n,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":i.emit("graphic-scale",t);break;case"end":i.inputState=null,i.emit("graphic-scale-stop",t)}return e})),r.next((()=>{null!=i.inputState&&i.emit("graphic-scale-stop",{graphic:n,xScale:1,yScale:1}),i.cancel()})))}))}_resizeDragRenderPlaneToFactors(){const e=this._bounds;return t=>{const i=this._displayBoundsStart,n=t.handle.direction,a=e.displayBoundsMargin,r=this._displayBoundsMarginStart,s=(0,u.c)(gt.rq.get(),i.origin);(0,u.q)(s,s,i.basis1,-n[0]),(0,u.q)(s,s,i.basis2,-n[1]);const o=(0,u.f)(gt.rq.get(),t.renderEnd,s),l=(0,u.f)(gt.rq.get(),t.renderStart,s),c=ds(t.handle),h=hs(i),d=hs(e.displayBounds)/h,p=(e,t)=>{if(0===e)return 1;let i=(0,u.l)(t),n=.5*e*(0,u.j)(t,o)/i;const s=n<0?-1:1;c&&(n+=(i-.5*e*(0,u.j)(t,l)/i)*s*d);const h=i<1.5*r?1:Js;return i=Math.max(i-r,Js),s>0&&(n-=a),s*Math.max(s*(n/i),h)};return{...t,factor1:p(n[0],i.basis1),factor2:p(n[1],i.basis2)}}}_resizeDragUpdateGeometry(){const e=this._tool,t=this._bounds;return i=>{const n=(0,u.c)((0,_.c)(),t.mapBoundsStart.origin);(0,u.q)(n,n,t.mapBoundsStart.basis1,-i.handle.direction[0]),(0,u.q)(n,n,t.mapBoundsStart.basis2,-i.handle.direction[1]);const a=(0,S.s)((0,x.a)(),t.mapBoundsStart.basis1[0],t.mapBoundsStart.basis1[1]);(0,S.e)(a,a);const r=[];for(const e of this._editGeometryOperations.data.components)r.push(...e.vertices);const s="start"===i.action?dr.B.NEW_STEP:dr.B.ACCUMULATE_STEPS,o=this._editGeometryOperations.scaleVertices(r,n,a,i.factor1,i.factor2,s,js.K.REPLACE);return(0,ts.c)(t.mapBoundsStart,t.mapBounds),(0,xs.Bb)(o,t.mapBounds),e.graphic.geometry=this._editGeometryOperations.data.geometry,i}}}const Js=1e-6;class Ks{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t={...this._lastDragEvent,action:"update"};e&&this._adjustScaleFactors(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;const e=new fa.rh;return this._next=e,[e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e),e]}_adjustScaleFactors(e){const t=ds(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{_adjustScaleFactors:e=>this._adjustScaleFactors(e)}}}let eo=class extends(hi.A.EventedMixin(Ua.g)){constructor(e){super(e),this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.tooltipOptions=new ka.A,this._preserveAspectRatio=new Ks,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type="transform-3d",this._outlineVisualElement=null}initialize(){const{view:e,graphic:t}=this,i=this._graphicState=new Hi({graphic:t}),n=t.geometry,a=this._editGeometryOperations=Ba.p.fromGeometry(n,e.state.viewingMode),s=this._bounds=new Ws(this,(()=>this._updateManipulators()),a.data);this._extentMove=new Os(this,i,a,s),this._extentScale=new Qs(this,i,a,s,(()=>this._preserveAspectRatio.createDragEventPipelineStep())),this._extentRotate=new Bs(this,a,s),this.addHandles([(0,o.wB)((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,Yn.TRANSLATE_Z))),(0,o.wB)((()=>this.enableScaling),(()=>this._extentScale.forEachManipulator((e=>this._updateManipulatorAvailability(e,Yn.SCALE))))),(0,o.wB)((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,Yn.ROTATE)))]),this._updateAllManipulatorAvailability();const l=oa({view:e,graphic:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,r.hA)()});if(null!=l){const{visualElement:e}=l;e instanceof _i&&(this._outlineVisualElement=e,this.addHandles(e.events.on("attachment-origin-changed",(()=>this._bounds.updateDisplayBounds())))),this.addHandles(l)}this.addHandles([i.on("changed",(()=>this._onGeometryChanged())),(0,o.wB)((()=>i.displaying),(()=>this._updateAllManipulatorAvailability())),(0,o.wB)((()=>i.isDraped),(()=>this._graphicDrapedChanged()),o.Vh),(0,o.wB)((()=>e.pointsOfInterest?.centerOnSurfaceFrequent.location),(()=>s.updateDisplayBounds())),e.trackGraphicState(i)]);this._forEachManipulator((e=>{this.addHandles(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this._updateAllManipulatorAvailability()})))}));this._forEachManipulator(((e,i)=>{this.addHandles(e.events.on("immediate-click",(e=>{i===Yn.TRANSLATE_XY&&this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation()})))})),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{view:e}=this,t=this._tooltip=new Xa.m({view:e}),i=()=>{t.info=this._getUpdatedTooltipInfo()};this.addHandles([this.on("graphic-translate-start",i),this.on("graphic-translate",i),this.on("graphic-translate-stop",(()=>{this._tooltip.clear()})),this.on("graphic-rotate-start",i),this.on("graphic-rotate",i),this.on("graphic-rotate-stop",i),this.on("graphic-scale-start",i),this.on("graphic-scale",i),this.on("graphic-scale-stop",i)]),this._forEachManipulator((e=>{this.addHandles([e.events.on("focus-changed",i),e.events.on("grab-changed",i),e.events.on("drag",(e=>{"cancel"===e.action?this._tooltip.clear():i()}))])}))}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(to),this._bounds.updateDisplayBounds(),this._graphicState.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",(e=>{null!=this._attachmentOrigin&&(0,cn.Rj)(e.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()})),to)}_updateManipulators(){if(!this.visible)return;const e=this._bounds.displayBounds,t=function(e,t){return Fn(e.basis1,e.basis2,e.origin,t)}(e,gt.Rc.get());this._extentMove.updateManipulators(t,e),this._extentScale.updateManipulators(t,e),this._extentRotate.updateManipulators(t,e)}_updateAllManipulatorAvailability(){this._forEachManipulator(((e,t)=>this._updateManipulatorAvailability(e,t)))}_updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof fn){const n=this._graphicState.displaying,a=this.enableZ&&Wn(this.graphic);switch(t){case Yn.ROTATE:e.available=n&&this.enableRotation;break;case Yn.SCALE:e.available=n&&(this.enableScaling||this.enableRotation||a),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?fs:vs;break;case Yn.TRANSLATE_Z:e.available=n&&a;break;default:e.available=n}}}_forEachManipulator(e){this._extentMove.forEachManipulator(e),this._extentScale.forEachManipulator(e),this._extentRotate.forEachManipulator(e)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get moveUnit(){return(0,Ui._H)(this.view.spatialReference)??"meters"}get attachmentOrigin(){const e=this.graphic.geometry,t=this._graphicState.isDraped?null:this._outlineVisualElement?.attachmentOrigin;return this._attachmentOrigin=t??jn(this.view,this.graphic)??e?.extent?.center,this._attachmentOrigin}reset(){}cancel(){if(this.canUndo){const e=this._editGeometryOperations.undo();(0,xs.CF)(e,this._bounds.mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry}this.inputState=null}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(null!=this.inputState)this.view.activeTool=null;else if(this.canUndo){const e=this._editGeometryOperations.undo();(0,xs.CF)(e,this._bounds.mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const e=this._editGeometryOperations.redo();(0,xs.Bb)(e,this._bounds.mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry}}get test(){return{moveZManipulator:this._extentMove.moveZManipulator,resizeManipulators:this._extentScale.resizeManipulators,rotateManipulator:this._extentRotate.rotateManipulator,tooltip:this._tooltip}}};(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],eo.prototype,"view",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],eo.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)()],eo.prototype,"enableZ",void 0),(0,n._)([(0,l.MZ)()],eo.prototype,"enableScaling",void 0),(0,n._)([(0,l.MZ)()],eo.prototype,"enableRotation",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,type:ka.A})],eo.prototype,"tooltipOptions",void 0),(0,n._)([(0,l.MZ)()],eo.prototype,"preserveAspectRatio",null),(0,n._)([(0,l.MZ)()],eo.prototype,"moveUnit",null),(0,n._)([(0,l.MZ)()],eo.prototype,"grabbing",void 0),(0,n._)([(0,l.MZ)()],eo.prototype,"inputState",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],eo.prototype,"type",void 0),eo=(0,n._)([(0,p.$)("esri.views.3d.interactive.editingTools.transformGraphic.ExtentTransformTool")],eo);const to="draped-elevation-changes"},35911:(e,t,i)=>{i.d(t,{K:()=>h});var n=i(67726),a=i(1062),r=i(54473),s=i(60840),o=i(35449),l=i(99152),c=i(79856);function h(e,t){const i=e.fragment;i.include(n.D),e.include(a.Ir),i.uniforms.add(new o.m("globalAlpha",(e=>e.globalAlpha)),new s.t("glowColor",(e=>e.glowColor)),new o.m("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new o.m("glowFalloff",(e=>e.glowFalloff)),new s.t("innerColor",(e=>e.innerColor)),new o.m("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio)),new c.N("depthMap",((e,t)=>t.linearDepth?.colorTexture)),new r.G("nearFar",((e,t)=>t.camera.nearFar)),new c.N("frameColor",((e,t)=>t.mainColor))),i.code.add(l.H`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),i.code.add(l.H`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),i.code.add(l.H`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),i.code.add(l.H`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),t.contrastControlEnabled?(i.uniforms.add(new o.m("globalAlphaContrastBoost",(e=>null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1))),i.code.add(l.H`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`)):i.code.add(l.H`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}},80010:(e,t,i)=>{i.d(t,{L:()=>s});var n=i(63592),a=i(35449),r=i(99152);function s(e,t){if(!t.screenSizeEnabled)return;const i=e.vertex;(0,n.yu)(i,t),i.uniforms.add(new a.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio)),new a.m("screenSizeScale",(e=>e.screenSizeScale))),i.code.add(r.H`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}},63937:(e,t,i)=>{i.d(t,{c:()=>c,d:()=>l});var n=i(66866),a=i(73569),r=i(21564),s=i(63863),o=i(58486);let l=class extends o.w{constructor(e){super(e),this.type="extent-rotate",this.angle=0}};(0,n._)([(0,r.MZ)()],l.prototype,"type",void 0),(0,n._)([(0,r.MZ)()],l.prototype,"angle",void 0),l=(0,n._)([(0,s.$)("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],l);let c=class extends o.w{constructor(e){super(e),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=a.r7,this.ySize=a.r7}};(0,n._)([(0,r.MZ)()],c.prototype,"type",void 0),(0,n._)([(0,r.MZ)()],c.prototype,"xScale",void 0),(0,n._)([(0,r.MZ)()],c.prototype,"yScale",void 0),(0,n._)([(0,r.MZ)()],c.prototype,"xSize",void 0),(0,n._)([(0,r.MZ)()],c.prototype,"ySize",void 0),c=(0,n._)([(0,s.$)("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],c)},18679:(e,t,i)=>{i.d(t,{JH:()=>u,YI:()=>c,ar:()=>l,nW:()=>h,un:()=>d,y3:()=>p});var n=i(66866),a=i(73569),r=i(21564),s=i(63863),o=i(58486);let l=class extends o.w{constructor(e){super(e),this.type="translate-graphic",this.distance=a.r7}clear(){this.distance=a.r7}};(0,n._)([(0,r.MZ)()],l.prototype,"type",void 0),(0,n._)([(0,r.MZ)()],l.prototype,"distance",void 0),l=(0,n._)([(0,s.$)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],l);let c=class extends o.w{constructor(e){super(e),this.type="translate-graphic-z",this.distance=a.r7}clear(){this.distance=a.r7}};(0,n._)([(0,r.MZ)()],c.prototype,"type",void 0),(0,n._)([(0,r.MZ)()],c.prototype,"distance",void 0),c=(0,n._)([(0,s.$)("esri.views.interactive.tooltip.TranslateGraphicZTooltipInfo")],c);let h=class extends o.w{constructor(e){super(e),this.type="translate-graphic-xy",this.distance=a.r7}};(0,n._)([(0,r.MZ)()],h.prototype,"type",void 0),(0,n._)([(0,r.MZ)()],h.prototype,"distance",void 0),h=(0,n._)([(0,s.$)("esri.views.interactive.tooltip.TranslateGraphicXYTooltipInfo")],h);let d=class extends o.w{constructor(e){super(e),this.type="translate-vertex",this.distance=a.r7,this.elevation=null,this.area=null,this.totalLength=null}clear(){this.distance=a.r7,this.elevation=null,this.area=null,this.totalLength=null}};(0,n._)([(0,r.MZ)()],d.prototype,"type",void 0),(0,n._)([(0,r.MZ)()],d.prototype,"distance",void 0),(0,n._)([(0,r.MZ)()],d.prototype,"elevation",void 0),(0,n._)([(0,r.MZ)()],d.prototype,"area",void 0),(0,n._)([(0,r.MZ)()],d.prototype,"totalLength",void 0),d=(0,n._)([(0,s.$)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],d);let p=class extends o.w{constructor(e){super(e),this.type="translate-vertex-z",this.distance=a.r7,this.elevation=null}clear(){this.distance=a.r7,this.elevation=null}};(0,n._)([(0,r.MZ)()],p.prototype,"type",void 0),(0,n._)([(0,r.MZ)()],p.prototype,"distance",void 0),(0,n._)([(0,r.MZ)()],p.prototype,"elevation",void 0),p=(0,n._)([(0,s.$)("esri.views.interactive.tooltip.TranslateVertexZTooltipInfo")],p);let u=class extends o.w{constructor(e){super(e),this.type="translate-vertex-xy",this.distance=a.r7,this.elevation=null,this.area=null,this.totalLength=null}clear(){this.distance=a.r7,this.elevation=null,this.area=null,this.totalLength=null}};(0,n._)([(0,r.MZ)()],u.prototype,"type",void 0),(0,n._)([(0,r.MZ)()],u.prototype,"distance",void 0),(0,n._)([(0,r.MZ)()],u.prototype,"elevation",void 0),(0,n._)([(0,r.MZ)()],u.prototype,"area",void 0),(0,n._)([(0,r.MZ)()],u.prototype,"totalLength",void 0),u=(0,n._)([(0,s.$)("esri.views.interactive.tooltip.TranslateVertexXYTooltipInfo")],u)}}]);