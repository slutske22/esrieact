/*! For license information please see common.219ce18d.js.LICENSE.txt */
"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2076],{28453:(t,e,s)=>{s.d(e,{R:()=>o,x:()=>a});var n=s(96540);const i={},r=n.createContext(i);function o(t){const e=n.useContext(r);return n.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function a(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(i):t.components||i:o(t.components),n.createElement(r.Provider,{value:e},t.children)}},98918:(t,e,s)=>{s.d(e,{lY:()=>m,mT:()=>d});var n,i=s(47471),r=s(96274),o=s(90709),a=s(34495);!function(t){t.TimeZoneNotRecognized="TimeZoneNotRecognized"}(n||(n={}));const l={[n.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class h extends Error{constructor(t,e){super((0,r.HC)(l[t],e)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,h)}}function u(t,e,s){return t<e?t-e:t>s?t-s:0}function c(t,e,s){return t<e?e:t>s?s:t}class m{constructor(t){this._date=t,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(t=0,e=1,s=1,n=0,i=0,r=0,o=0,l){if(isNaN(t)||isNaN(e)||isNaN(s)||isNaN(n)||isNaN(i)||isNaN(r)||isNaN(o))return null;const h=a.c9.local(t,e).daysInMonth;let g=a.c9.fromObject({day:c(s,1,h),year:t,month:c(e,1,12),hour:c(n,0,23),minute:c(i,0,59),second:c(r,0,59),millisecond:c(o,0,999)},{zone:d(l)});return g=g.plus({months:u(e,1,12),days:u(s,1,h),hours:u(n,0,23),minutes:u(i,0,59),seconds:u(r,0,59),milliseconds:u(o,0,999)}),new m(g)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(t,e){const s=d(e);return t.isUnknownTimeZone||s===o.GB.instance?m.fromParts(t.year,t.monthJS+1,t.day,t.hour,t.minute,t.second,t.millisecond,s):new m(t._date.setZone(s))}static dateJSToArcadeDate(t){return new m(a.c9.fromJSDate(t,{zone:"system"}))}static dateJSAndZoneToArcadeDate(t,e="system"){const s=d(e);return new m(a.c9.fromJSDate(t,{zone:s}))}static unknownEpochToArcadeDate(t){return new m(a.c9.fromMillis(t,{zone:o.GB.instance}))}static unknownDateJSToArcadeDate(t){return new m(a.c9.fromMillis(t.getTime(),{zone:o.GB.instance}))}static epochToArcadeDate(t,e="system"){const s=d(e);return new m(a.c9.fromMillis(t,{zone:s}))}static dateTimeToArcadeDate(t){return new m(t)}clone(){return new m(this._date)}changeTimeZone(t){const e=d(t);return m.dateTimeToArcadeDate(this._date.setZone(e))}static dateTimeAndZoneToArcadeDate(t,e){const s=d(e);return t.zone===o.GB.instance||s===o.GB.instance?m.fromParts(t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond,s):new m(t.setZone(s))}static nowToArcadeDate(t){const e=d(t);return new m(a.c9.fromJSDate(new Date,{zone:e}))}static nowUTCToArcadeDate(){return new m(a.c9.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===m.systemTimeZoneCanonicalName}equals(t){return this.isSystem&&t.isSystem?this.toNumber()===t.toNumber():this.isUnknownTimeZone===t.isUnknownTimeZone&&this._date.equals(t._date)}get isUnknownTimeZone(){return this._date.zone===o.GB.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let t=this._date.weekday;return t>6&&(t=0),t}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const t=this.zone;return"fixed"===t.type?0===t.fixed?"UTC":t.formatOffset(0,"short"):t.name}stringify(){return JSON.stringify(this.toJSDate())}plus(t){return new m(this._date.plus(t))}diff(t,e){return this._date.diff(t._date,e)[e]}toISODate(){return this._date.toISODate()}toISOString(t){return t?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(t,e){return this._date.toISOTime({suppressMilliseconds:t,includeOffset:e&&!this.isUnknownTimeZone})}toFormat(t,e){return this.isUnknownTimeZone&&(t=t.replaceAll("Z","")),this._date.toFormat(t,e)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new m(this._date.toUTC())}toLocal(){return new m(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(t){if(!t)return null;const e=a.c9.fromISO(t,{setZone:!0});return new m(e)}}function d(t,e=!0){if(t instanceof a.bo)return t;switch((0,i.B)(t)){case"system":return"system";case"utc":return"UTC";case"unknown":return o.GB.instance}if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(t)){const e=a.mQ.parseSpecifier("UTC"+(t.startsWith("+")||t.startsWith("-")?"":"+")+t);if(e)return e}const s=a.oh.create(t);if(!s.isValid){if(e)throw new h(n.TimeZoneNotRecognized);return null}return s}},47471:(t,e,s)=>{s.d(e,{B:()=>i,b:()=>r});var n=s(72234);function i(t){return t.toLowerCase().replaceAll(/[\s-]+/g,"")}class r{constructor(t,e){const s=new Map;for(const n of t){const t=i(n);if(s.has(t))throw new Error(`${n} already added as ${s.get(t)}`);s.set(t,n)}if(null!=e)for(const[n,r]of e){const t=i(n);if(s.has(t))throw new Error(`${n} already associated with ${s.get(t)}`);s.set(t,r)}this._enumMap=s}lookup(t){return this._enumMap.get(i(t))}get(t){const e=this.lookup(t);if(null==e)throw new n.D$(null,n.TX.InvalidParameter,null);return e}}},72234:(t,e,s)=>{s.d(e,{B:()=>d,D$:()=>l,Nh:()=>m,O$:()=>c,TX:()=>n,mT:()=>u,ps:()=>p});var n,i=s(96274);!function(t){t.AsyncNotEnabled="AsyncNotEnabled",t.ModulesNotSupported="ModulesNotSupported",t.CircularModules="CircularModules",t.CannotCompareDateAndTime="CannotCompareDateAndTime",t.NeverReach="NeverReach",t.UnsupportedHashType="UnsupportedHashType",t.InvalidParameter="InvalidParameter",t.FeatureSetDoesNotHaveSubtypes="FeatureSetDoesNotHaveSubtypes",t.UnexpectedToken="UnexpectedToken",t.Unrecognized="Unrecognized",t.UnrecognizedType="UnrecognizedType",t.MaximumCallDepth="MaximumCallDepth",t.BooleanConditionRequired="BooleanConditionRequired",t.TypeNotAllowedInFeature="TypeNotAllowedInFeature",t.KeyMustBeString="KeyMustBeString",t.WrongNumberOfParameters="WrongNumberOfParameters",t.CallNonFunction="CallNonFunction",t.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral",t.NoFunctionInDictionary="NoFunctionInDictionary",t.NoFunctionInArray="NoFunctionInArray",t.AssignModuleFunction="AssignModuleFunction",t.LogicExpressionOrAnd="LogicExpressionOrAnd",t.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean",t.FunctionNotFound="FunctionNotFound",t.InvalidMemberAccessKey="InvalidMemberAccessKey",t.UnsupportedUnaryOperator="UnsupportUnaryOperator",t.InvalidIdentifier="InvalidIdentifier",t.MemberOfNull="MemberOfNull",t.UnsupportedOperator="UnsupportedOperator",t.Cancelled="Cancelled",t.ModuleAccessorMustBeString="ModuleAccessorMustBeString",t.ModuleExportNotFound="ModuleExportNotFound",t.Immutable="Immutable",t.OutOfBounds="OutOfBounds",t.IllegalResult="IllegalResult",t.FieldNotFound="FieldNotFound",t.PortalRequired="PortalRequired",t.LogicError="LogicError",t.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber",t.KeyAccessorMustBeString="KeyAccessorMustBeString",t.WrongSpatialReference="WrongSpatialReference",t.CannotChangeTimeZoneTime="CannotChangeTimeZoneTime",t.CannotChangeTimeZoneDateOnly="CannotChangeTimeZoneDateOnly"}(n||(n={}));const r={[n.TypeNotAllowedInFeature]:"Feature attributes only support dates, numbers, strings, guids.",[n.LogicError]:"Logic error - {reason}",[n.CannotCompareDateAndTime]:"Cannot compare date or dateonly with timeonly types",[n.NeverReach]:"Encountered unreachable logic",[n.AsyncNotEnabled]:"Async Arcade must be enabled for this script",[n.ModuleAccessorMustBeString]:"Module accessor must be a string",[n.ModuleExportNotFound]:"Module has no export with provided identifier",[n.ModulesNotSupported]:"Current profile does not support modules",[n.ArrayAccessorMustBeNumber]:"Array accessor must be a number",[n.FunctionNotFound]:"Function not found",[n.FieldNotFound]:"Key not found - {key}",[n.CircularModules]:"Circular module dependencies are not allowed",[n.Cancelled]:"Execution cancelled",[n.UnsupportedHashType]:"Type not supported in hash function",[n.IllegalResult]:"Value is not a supported return type",[n.PortalRequired]:"Portal is required",[n.InvalidParameter]:"Invalid parameter",[n.WrongNumberOfParameters]:"Call with wrong number of parameters",[n.Unrecognized]:"Unrecognized code structure",[n.UnrecognizedType]:"Unrecognized type",[n.WrongSpatialReference]:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",[n.BooleanConditionRequired]:"Conditions must use booleans",[n.NoFunctionInDictionary]:"Dictionaries cannot contain functions.",[n.NoFunctionInArray]:"Arrays cannot contain functions.",[n.NoFunctionInTemplateLiteral]:"Template Literals do not expect functions by value.",[n.KeyAccessorMustBeString]:"Accessor must be a string",[n.KeyMustBeString]:"Object keys must be a string",[n.Immutable]:"Object is immutable",[n.UnexpectedToken]:"Unexpected token",[n.MemberOfNull]:"Cannot access property of null object",[n.MaximumCallDepth]:"Exceeded maximum function depth",[n.OutOfBounds]:"Out of bounds",[n.InvalidIdentifier]:"Identifier not recognized",[n.CallNonFunction]:"Expression is not a function",[n.InvalidMemberAccessKey]:"Cannot access value using a key of this type",[n.AssignModuleFunction]:"Cannot assign function to module variable",[n.UnsupportedUnaryOperator]:"Unsupported unary operator",[n.UnsupportedOperator]:"Unsupported operator",[n.LogicalExpressionOnlyBoolean]:"Logical expressions must be boolean",[n.LogicExpressionOrAnd]:"Logical expression can only be combined with || or &&",[n.CannotChangeTimeZoneTime]:"Cannot change the timezone of a Time",[n.CannotChangeTimeZoneDateOnly]:"Cannot change the timezone of a DateOnly",[n.FeatureSetDoesNotHaveSubtypes]:"FeatureSet does not have subtypes"};class o extends Error{constructor(...t){super(...t)}}class a extends o{constructor(t,e){super(h(e)+t.message,{cause:t}),this.loc=null,Error.captureStackTrace&&Error.captureStackTrace(this,a),e?.loc&&(this.loc=e.loc)}}class l extends Error{constructor(t,e,s,n){super("Execution error - "+h(s)+(0,i.HC)(r[e],n)),this.loc=null,this.declaredRootClass="esri.arcade.arcadeexecutionerror",Error.captureStackTrace&&Error.captureStackTrace(this,l),s?.loc&&(this.loc=s.loc)}}function h(t){return t&&t.loc?`Line : ${t.loc.start?.line}, ${t.loc.start?.column}: `:""}class u extends Error{constructor(t,e,s,n){super("Compilation error - "+h(s)+(0,i.HC)(r[e],n)),this.loc=null,this.declaredRootClass="esri.arcade.arcadecompilationerror",Error.captureStackTrace&&Error.captureStackTrace(this,u),s?.loc&&(this.loc=s.loc)}}class c extends Error{constructor(){super("Uncompilable code structures"),this.declaredRootClass="esri.arcade.arcadeuncompilableerror",Error.captureStackTrace&&Error.captureStackTrace(this,c)}}function m(t,e,s){return"esri.arcade.arcadeexecutionerror"===s.declaredRootClass||"esri.arcade.arcadecompilationerror"===s.declaredRootClass?null===s.loc&&e?.loc?new a(s,{cause:s}):s:("esri.arcade.featureset.support.featureseterror"===s.declaredRootClass||"esri.arcade.featureset.support.sqlerror"===s.declaredRootClass||s.declaredRootClass,e?.loc?new a(s,{cause:s}):s)}var d;!function(t){t.UnrecognizedUri="UnrecognizedUri",t.UnsupportedUriProtocol="UnsupportedUriProtocol"}(d||(d={}));const g={[d.UnrecognizedUri]:"Unrecognized uri - {uri}",[d.UnsupportedUriProtocol]:"Unrecognized uri protocol"};class p extends Error{constructor(t,e){super((0,i.HC)(g[t],e)),this.declaredRootClass="esri.arcade.arcademoduleerror",Error.captureStackTrace&&Error.captureStackTrace(this,p)}}},47303:(t,e,s)=>{s.d(e,{Fq:()=>o,Yc:()=>i,Yq:()=>r});var n=s(84698);function i(t){if(null==t)return null;switch(t.type){case"polygon":case"multipoint":case"polyline":return t.extent;case"point":return new n.A({xmin:t.x,ymin:t.y,xmax:t.x,ymax:t.y,spatialReference:t.spatialReference});case"extent":return t}return null}function r(t){if(null==t)return null;const e=t.clone();return void 0!==t.cache._geVersion&&(e.cache._geVersion=t.cache._geVersion),e}function o(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}},75992:(t,e,s)=>{s.d(e,{$:()=>St,A:()=>L,B:()=>z,C:()=>Q,D:()=>F,E:()=>kt,F:()=>wt,G:()=>Ct,H:()=>rt,I:()=>nt,J:()=>it,K:()=>T,L:()=>ct,M:()=>vt,N:()=>X,O:()=>c,P:()=>Dt,Q:()=>gt,R:()=>lt,S:()=>O,T:()=>H,U:()=>k,V:()=>d,W:()=>yt,X:()=>pt,Y:()=>at,Z:()=>It,_:()=>bt,a:()=>ut,a0:()=>Et,a1:()=>Pt,a2:()=>$,a3:()=>U,a4:()=>J,a5:()=>At,a6:()=>w,b:()=>ht,c:()=>ot,d:()=>E,e:()=>dt,f:()=>et,g:()=>st,h:()=>_t,i:()=>xt,j:()=>b,k:()=>Rt,l:()=>y,m:()=>x,n:()=>C,o:()=>m,p:()=>p,q:()=>S,r:()=>v,s:()=>ft,t:()=>A,u:()=>M,v:()=>tt,w:()=>P,x:()=>V,y:()=>D,z:()=>N});var n=s(86330),i=s(21566),r=s(62188);const o=[0,0,Number.NaN,0,0,0,0,0,-1,-1,0,0,0,0],a=[2,1,1,1,3,1,2,3,2,4,1,1,2,1],l=[1,1,1,0,2,1,1,1,0,0,0,0,0,1],h=[1,1,1,2,0,0,0,0,2,2,4,2,2,1],u=[4,8,4,8,1],c=25;function m(){return(0,n.d)(c,Number.NaN)}let d=class t{getAttributeCount(){return this.m_attributeCount}getSemantics(t){return this.m_indexToSemantics[t]}getSemanticsBitArray(){return this.m_semanticsBitArray}getAttributeIndex(t){return this.m_semanticsToIndexMap[t]}static getInterpolation(t){return l[t]}static getPersistence(t){return h[t]}static getPersistenceSize(t){return u[t]}static getPersistenceSizeFromSemantics(e){return t.getPersistenceSize(t.getPersistence(e))*t.getComponentCount(e)}static getComponentCount(t){return a[t]}static maxComponentCount(){return 4}static isInteger(t){return 2===t||3===t||4===t}static isIntegerSemantics(e){return t.isInteger(t.getPersistence(e))}static isTexture(t){return 5===t||6===t||7===t}hasAttribute(t){return!!(this.m_semanticsBitArray&1<<t)}hasAttributesFrom(t){return(this.m_semanticsBitArray&t.m_semanticsBitArray)===t.m_semanticsBitArray}hasZ(){return this.hasAttribute(1)}hasM(){return this.hasAttribute(2)}hasID(){return this.hasAttribute(3)}getTotalComponentCount(){return this.m_totalComponentCount}static getDefaultValue(t){return o[t]}static isDefaultValue(t,e){return(0,n.Q)(o[t],e)}equals(t){return this===t}getDefaultPointAttributes(){return this.m_defaultPointAttributes}getPointAttributeOffset(t){return this.m_pointAttributeOffsets[t]}constructor(e){this.m_semanticsBitArray=e,this.m_attributeCount=0,this.m_totalComponentCount=0,this.m_semanticsToIndexMap=new Int32Array(14),this.m_indexToSemantics=new Int32Array(14),this.m_pointAttributeOffsets=new Int32Array(14),this.m_defaultPointAttributes=(0,n.d)(c,Number.NaN),this.m_semanticsToIndexMap.fill(-1),this.m_indexToSemantics.fill(-1);let s=0,i=1,r=14;for(;s<r;s++)e&i&&(this.m_semanticsToIndexMap[s]=this.m_attributeCount,this.m_indexToSemantics[this.m_attributeCount]=s,this.m_attributeCount++,this.m_totalComponentCount+=t.getComponentCount(s)),i<<=1;let o=0;for(s=0,r=this.getAttributeCount();s<r;s++){const e=this.getSemantics(s),n=t.getComponentCount(e),i=t.getDefaultValue(e);this.m_pointAttributeOffsets[s]=o;for(let t=0;t<n;t++)this.m_defaultPointAttributes[o]=i,o++}}};var g=d;function p(){return(0,n.d)(14,0)}class _{static getInstance(){return _.s_thisInstance}constructor(){this.m_map=new Map,this.m_vd2D=new g(1),this.m_map.set(1,this.m_vd2D),this.m_vd3D=new g(3),this.m_map.set(3,this.m_vd2D)}GetVD2D(){return this.m_vd2D}GetVD3D(){return this.m_vd3D}FindOrAdd(t){if(1===t)return this.GetVD2D();if(3===t)return this.GetVD3D();const e=this.m_map.get(t);if(e)return e;const s=new g(t);return this.m_map.set(t,s),s}}function f(t){return _.getInstance().FindOrAdd(t)}function y(t,e){if(!t||!e)return e||t;const s=t.getSemanticsBitArray()|e.getSemanticsBitArray();return(s&t.getSemanticsBitArray())===s?t:(s&e.getSemanticsBitArray())===s?e:f(s)}function x(t,e){const s=t.getSemanticsBitArray()|1<<e;return(s&t.getSemanticsBitArray())===s?t:f(s)}function v(t,e){const s=(t.getSemanticsBitArray()|1<<e)-(1<<e);return s===t.getSemanticsBitArray()?t:f(s)}function b(){return _.getInstance().GetVD2D()}function P(){return _.getInstance().GetVD3D()}function S(t,e,s){if(s.fill(-1),null!==t&&null!==e)for(let n=0,i=t.getAttributeCount();n<i;n++)s[n]=e.getAttributeIndex(t.getSemantics(n))}_.s_thisInstance=new _;class E{static construct(t,e,s){return new E(t,e,s)}constructor(t,e,s){void 0!==t?(this.x=t,this.y=e,this.z=s):this.x=this.y=this.z=Number.NaN}get 0(){return this.x}get 1(){return this.y}get 2(){return this.z}set 0(t){this.x=t}set 1(t){this.y=t}set 2(t){this.z=t}clone(){return new E(this.x,this.y,this.z)}assign(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}setCoords(t,e,s){return this.x=t,this.y=e,this.z=s,this}setCoordsPoint2DZ(t,e){return this.setCoords(t.x,t.y,e)}setCoordsPoint3D(t){this.x=t.x,this.y=t.y,this.z=t.z}setZero(){this.x=0,this.y=0,this.z=0}setNormalized(t){this.assign(t),this.normalizeThis()}normalizeThis(){const t=this.length();return t?(this.x/=t,this.y/=t,this.z/=t):(this.x=1,this.y=0,this.z=0),this}getUnitVector(){const t=new E;return t.setNormalized(this),t}sqrLength(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthXY(){return(0,r.g)(0),0}static sqrDistance(t,e){return(0,n.a)(t.x-e.x)+(0,n.a)(t.y-e.y)+(0,n.a)(t.z-e.z)}static sqrDistanceCoords(t,e,s,i,r,o){return(0,n.a)(t-i)+(0,n.a)(e-r)+(0,n.a)(s-o)}static distance(t,e){return Math.sqrt(E.sqrDistance(t,e))}isEqual(t,e){return void 0===e&&(e=0),Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e&&(0,n.G)(this.z,t.z,e)}static compareByLength(t,e,s,n){return(0,r.g)(0),0}isEqualCoords(t,e,s,n){return(0,r.g)(0),this.x===t&&this.y===e&&this.z===s}isEqualsTols(t,e,s){return(0,r.g)(0),!1}isEqualCoordsTols(t,e,s,n,i){return(0,r.g)(0),!1}static st_isEqual(t,e,s,n){return(0,r.g)(0),!1}equals(t,e){return this.isEqual(t,e)}equalsTols(t,e,s){return(0,r.g)(0),!1}divThis(t){return this.x/=t,this.y/=t,this.z/=t,this}subThis(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}setSub(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}sub(t){return E.construct(this.x-t.x,this.y-t.y,this.z-t.z)}addThis(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add(t){return this.clone().addThis(t)}setAdd(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}mul(t){return E.construct(this.x*t,this.y*t,this.z*t)}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z}crossProductVector(t){const e=this.y*t.z-t.y*this.z,s=t.x*this.z-this.x*t.z,n=this.x*t.y-t.x*this.y;return new E(e,s,n)}setCrossProductVector(t,e){const s=t.y*e.z-e.y*t.z,n=e.x*t.z-t.x*e.z,i=t.x*e.y-e.x*t.y;return this.x=s,this.y=n,this.z=i,this}setScaled(t,e){return this.x=t*e.x,this.y=t*e.y,this.z=t*e.z,this}scaleThis(t){return this.x*=t,this.y*=t,this.z*=t,this}scaleZThis(t){return this.z*=t,this}setNAN(){return(0,r.g)(0),this}isNAN(){return Number.isNaN(this.x)||Number.isNaN(this.y)||Number.isNaN(this.z)}static getNAN(){return E.construct(Number.NaN,Number.NaN,Number.NaN)}isFinite(){return(0,r.g)(0),!1}isZero(){return 0===this.x&&0===this.y&&0===this.z}norm(t){return(0,r.g)(0),0}sqrDistanceFromCenterToSpheroidSurface(t,e){return(0,r.g)(0),0}distanceFromCenterToSpheroidSurface(t,e){return Math.sqrt(this.sqrDistanceFromCenterToSpheroidSurface(t,e))}static getClosestCoordinate(t,e,s,n=!1){return(0,r.g)(0),0}compare(t){return this.y<t.y?-1:this.y>t.y?1:this.x<t.x?-1:this.x>t.x?1:this.z<t.z?-1:this.z>t.z?1:0}compareXYZ(t){return(0,r.g)(0),0}negateThis(){this.x=-this.x,this.y=-this.y,this.z=-this.z}static averageFast(t,e){return(0,r.g)(0),{}}static average(t,e){return(0,r.g)(0),{}}static size(){return E.dimensions}static lerp(t,e,s){const i=new E;return(0,n.x)(t,e,s,i),i}static slerp(t,e,s){return(0,r.g)(0),{}}static compareVectors(t,e){return(0,r.g)(0),0}static selectRightHandedBasisFromNormal(t,e,s){const n=t.getUnitVector(),i=n.createAPerpendicular(),r=new E;r.setCrossProductVector(n,i),r.normalizeThis(),e.setCoordsPoint3D(i),s.setCoordsPoint3D(r)}createAPerpendicular(){const t=[this.crossProductVector(new E(0,0,1)),this.crossProductVector(new E(1,0,0)),this.crossProductVector(new E(0,1,0))],e=[t[0].sqrLength(),t[1].sqrLength(),t[2].sqrLength()],s=t[e.reduce(((t,s,n)=>e[t]>e[n]?t:n),0)];return s.normalizeThis(),s}calculateAngle(t){return(0,r.g)(0),0}static crossDotSign(t,e,s){return(0,r.g)(0),0}static isBisectorRobust(t,e,s){return(0,r.g)(0),0}static compareZOrder(t,e){return(0,r.g)(0),!1}}E.dimensions=3;class C{static constructEmpty(){return new C(Number.NaN,Number.NaN,Number.NaN,Number.NaN,Number.NaN,Number.NaN)}constructor(t,e,s,n,i,r){this.m_EnvelopeType=3,this.xmin=t,this.ymin=e,this.zmin=s,this.xmax=n,this.ymax=i,this.zmax=r,this.normalize()}inflate(t){this.inflateCoords(t,t,t)}inflateCoords(t,e,s){(0,r.g)(0)}getEnvelope2D(){return new i.Envelope2D(this.xmin,this.ymin,this.xmax,this.ymax)}getEnvelopeZs(){return new n.E(this.zmin,this.zmax)}setEmptyZ(){this.zmin=Number.NaN,this.zmax=Number.NaN}normalize(){let t=!1;this.xmin<=this.xmax||(this.xmax=(0,n.c)(this.xmin,this.xmin=this.xmax),t=!0),this.ymin<=this.ymax||(this.ymax=(0,n.c)(this.ymin,this.ymin=this.ymax),t=!0),!t||this.xmin<=this.xmax&&this.ymin<=this.ymax?this.zmin<=this.zmax||(this.zmax=(0,n.c)(this.zmin,this.zmin=this.zmax),this.zmin<=this.zmax||this.setEmptyZ()):this.setEmpty()}isEmpty(){return Number.isNaN(this.xmin)||Number.isNaN(this.ymin)||Number.isNaN(this.xmax)||Number.isNaN(this.ymax)}isEmptyZ(){return Number.isNaN(this.zmin)||Number.isNaN(this.zmax)}setEmpty(){this.xmin=Number.NaN,this.ymin=Number.NaN,this.zmin=Number.NaN,this.xmax=Number.NaN,this.ymax=Number.NaN,this.zmax=Number.NaN}mergeEnv3D(t){t.isEmpty()||(this.mergeCoords(t.xmin,t.ymin,t.zmin),this.mergeCoords(t.xmax,t.ymax,t.zmax))}mergeNe(t){this.mergeNeCoords(t.x,t.y,t.z)}mergeNeCoords(t,e,s){this.xmin>t?this.xmin=t:this.xmax<t&&(this.xmax=t),this.ymin>e?this.ymin=e:this.ymax<e&&(this.ymax=e),this.zmin>s?this.zmin=s:this.zmax<s&&(this.zmax=s)}mergeCoords(t,e,s){this.isEmpty()?(this.xmin=t,this.xmax=t,this.ymin=e,this.ymax=e,this.zmin=s,this.zmax=s):(this.isEmptyZ()&&(this.zmin=s,this.zmax=s),this.mergeNeCoords(t,e,s))}setCoords(t,e,s,n,i,r){this.xmin=t,this.ymin=e,this.zmin=s,this.xmax=n,this.ymax=i,this.zmax=r,this.normalize()}sqrDistanceEnvelope3DAndPoints(t,e,s,n=1){return(0,r.g)(0),0}sqrMaxDistance(t,e=1){return(0,r.g)(0),0}}const w=-559038737;var I=d;function T(t,e,s){switch(t){case 0:return new G(e,s);case 1:return new V(e,s);case 2:return new L(e,s);case 3:throw new Error("64 bit int attribute stream not implemented");case 4:return new k(e,s);default:(0,r.a)("")}}function A(t,e){const s=I.getComponentCount(t);return T(I.getPersistence(t),e*s,I.getDefaultValue(t))}function M(t,e){const s=I.getComponentCount(t);return T(I.getPersistence(t),e*s)}function D(t,e){return new L(t,e)}function N(t,e){return new k(t,e)}function F(t,e){return new V(t,e)}class R{size(){return this.m_size}checkResize(t,e){t>this.m_size&&this.resize(t,e)}resize(t,e){if((t=Math.trunc(t))===this.m_size)return;const s=!!e||Number.isNaN(e);if(t<this.m_a.length)this.m_a.length>R.s_resizeMin&&1.25*t<this.m_a.length&&(this.m_a=this.m_a.slice(0,t)),s&&t>this.m_size&&this.m_a.fill(e,this.m_size,t);else if(t>=this.m_a.length){const n=1.25*t,i=new this.m_a.constructor(n);i.set(this.m_a),this.m_a=i,s&&this.m_a.fill(e,this.m_size,t)}this.m_size=t}resizeRounded(t,e){return this.resize(t,e)}reserve(t){}read(t){return this.m_a[t]}readAsDbl(t){return this.read(t)}write(t,e){this.m_a[t]=e}writeAsDbl(t,e){this.write(t,e)}setRange(t,e,s){(e<0||s<0||s+e>this.size())&&(0,r.a)(),this.m_a.fill(t,e,e+s)}add(t){this.resize(this.m_size+1),this.m_a[this.m_size-1]=t}addArray(t,e){const s=this.m_size;void 0===e?(this.resize(this.m_size+t.length),this.m_a.set(t,s)):(this.resize(this.m_size+e),this.m_a.set(t.slice(0,e),s))}equals(t,e,s,i){return this.getPersistence()===t.getPersistence()&&function(t,e,s,i,r){if(t.getPersistence()!==e.getPersistence())return!1;const o=t.getPersistence()<=1,a=t.size(),l=e.size();if(i>a||i>l)return!1;if(r)if(o){for(let h=s;h<i;h++)if(!(0,n.G)(t.read(h),e.read(h),r))return!1}else for(let n=s;n<i;n++){let s=t.read(n)-e.read(n);if(s<0&&(s=-s),s>r)return!1}else for(let n=s;n<i;n++){const s=t.read(n),i=e.read(n);if(s!==i){if(o&&Number.isNaN(s)&&Number.isNaN(i))continue;return!1}}return!0}(this,t,e,s,i)}insertRange(t,e,s,n){const i=this.m_size;this.checkResize(Math.max(0,n)+s),this.m_a.copyWithin(t+s,t,n>=0?n:i),this.m_a.fill(e,t,t+s)}readRange(t,e){return this.m_a.slice(t,t+e)}insertRangeFromStream(t,e,s,n,i,o,a){(0,r.g)(this.getPersistence()===e.getPersistence());const l=e,h=this.m_size;n&&this.checkResize(Math.max(0,a)+n),this.m_a.copyWithin(t+n,t,a>=0?a:h),this.m_a.set(l.readRange(s,n),t),i||this.reverseRange(t,n,o)}writeRange(t,e,s,n,i,o){(0,r.g)(this.getPersistence()===s.getPersistence());const a=s;if((t<0||e<0||n<0)&&(0,r.a)(),a.size()<n+e&&(0,r.a)(),0===e)return;this.size()<e+t&&this.resize(e+t);const l=a.m_a.subarray(n,n+e);!function(t,e,s,n){if((e<0||s<0)&&(0,r.a)(),0===s)return;if(1===s)return void(t[e]=n[0]);let i=n;s<n.length&&(i=n.subarray(0,s)),t.set(i,e)}(this.m_a,t,e,l)}insertAttributes(t,e,s,n){const i=I.getComponentCount(s);this.m_a.copyWithin(t+i,t,n>=0?n:this.m_size);for(let r=0;r<i;r++)this.m_a[t+r]=e.getAttributeAsDbl(s,r)}insertAttributesFromPoints(t,e,s,i,o){(0,r.g)(I.getPersistence(i)===this.getPersistence());const a=I.getComponentCount(i),l=this.m_size;if(this.checkResize(Math.max(0,o)+a*s),this.m_a.copyWithin(t+a*s,t,o>=0?o:l),0===i){const i=new n.P;for(let n=t,r=0;r<s;r++,n+=2)e[r].queryXY(i),this.m_a[n]=i.x,this.m_a[n+1]=i.y}else if(1===a)for(let n=t,r=0;r<s;r++,n++)this.m_a[n]=e[r].getAttributeAsDbl(i,0);else for(let n=t,r=0;r<s;r++,n+=a)for(let t=0;t<a;t++)this.m_a[n+t]=e[r].getAttributeAsDbl(i,t)}eraseRange(t,e,s){this.m_size<t+e&&(0,r.a)(),this.m_a.copyWithin(t,t+e),this.m_size-=e}reverseRange(t,e,s){if((s<1||e%s!=0)&&(0,r.a)(),this.m_a.subarray(t,t+e).reverse(),s>1)for(let n=t,i=t+e;n<i;n+=s){let t=n,e=n+s-1;for(;t<e;){const s=this.m_a[t];this.m_a[t]=this.m_a[e],this.m_a[e]=s,t++,e--}}}rotate(t,e,s){(e<t||e>s||t>s)&&(0,r.q)("rotate"),e!==t&&e!==s&&(this.reverseRange(t,e-t,1),this.reverseRange(e,s-e,1),this.reverseRange(t,s-t,1))}sort(t,e,s){this.m_a.subarray(t,e).sort(s)}constructor(t){if(t.move)this.m_a=t.move.m_a,this.m_size=t.move.m_size,t.move.m_a=t.move.m_a.slice(0,0),t.move.m_size=0;else if(t.copy)this.m_size=t.copy.m_size,t.maxSize&&(this.m_size=Math.min(t.maxSize,this.m_size)),this.m_a=t.copy.m_a.slice(0,this.m_size);else{const e=Math.max(t.size,R.s_constructMin);this.m_a=new t.ctor(e),(t.defaultValue||Number.isNaN(t.defaultValue))&&this.m_a.fill(t.defaultValue),this.m_size=t.size}}}R.s_constructMin=2,R.s_resizeMin=30;class k extends R{setBits(t,e){this.m_a[t]|=e}clearBits(t,e){this.m_a[t]&=~e}getPersistence(){return 4}clone(){return new k({ctor:Int8Array,copy:this})}restrictedClone(t){return new k({ctor:Int8Array,copy:this,maxSize:t})}constructor(t,e){super("number"==typeof t?{ctor:Int8Array,size:t,defaultValue:e}:t)}}class L extends R{getPersistence(){return 2}clone(){return new L({ctor:Int32Array,copy:this})}restrictedClone(t){return new L({ctor:Int32Array,copy:this,maxSize:t})}write(t,e){(0,r.g)(e<=(0,n.i)()),super.write(t,e)}constructor(t,e){super("number"==typeof t?{ctor:Int32Array,size:t,defaultValue:e}:t)}}class G extends R{getPersistence(){return 0}clone(){return new G({ctor:Float32Array,copy:this})}restrictedClone(t){return new G({ctor:Float32Array,copy:this,maxSize:t})}constructor(t,e){super("number"==typeof t?{ctor:Float32Array,size:t,defaultValue:e}:t)}}class V extends R{getPersistence(){return 1}getArray(){return this.m_a}applyTransformation(t,e,s){(1&e||e+2*s>this.size())&&(0,r.a)();const n=0===e?this.m_a:this.m_a.subarray(e);t.transformInterleavedPoints(n,s,n)}readPoint2D(t){const e=this.m_a[t],s=this.m_a[t+1];return new n.P(e,s)}queryPoint2D(t,e){return e.x=this.m_a[t],e.y=this.m_a[t+1],e}writePoint2D(t,e){this.write(t,e.x),this.write(t+1,e.y)}insert(t,e,s){this.checkResize(s+2),this.m_a.copyWithin(t+2,t,s),this.m_a[t]=e.x,this.m_a[t+1]=e.y}insertRangeFromPoints(t,e,s,n,i,r){const o=this.m_size;if(this.checkResize(Math.max(r,0)+2*n),this.m_a.copyWithin(t+2*n,t,r>=0?r:o),i)for(let a=s,l=t,h=0;h<n;++h,++a){const t=e[a];this.m_a[l++]=t.x,this.m_a[l++]=t.y}else for(let a=s+n-1,l=t,h=0;h<n;++h,--a){const t=e[a];this.m_a[l++]=t.x,this.m_a[l++]=t.y}}queryRange(t,e,s,n,i){if((t<0||e<0)&&(0,r.a)(),!n&&(i<=0||e%i!=0)&&(0,r.a)(),0===e)return;if(1===e)return void(s[0]=this.m_a[t]);const o=this.m_a.subarray(t,t+e);s.set(o)}writeRangeFromArray(t,e,s,n,i){if((t<0||e<0)&&(0,r.a)(),0===e)return;if(1===e)return void(this.m_a[t]=s[0]);let o=s;e<s.length&&(o=s.subarray(0,e)),this.m_a.set(o,t)}clone(){return new V({ctor:Float64Array,copy:this})}restrictedClone(t){return new V({ctor:Float64Array,copy:this,maxSize:t})}constructor(t,e){super("number"==typeof t?{ctor:Float64Array,size:t,defaultValue:e}:t)}}class z{constructor(){this.m_minValue=-1,this.m_maxValue=-1,this.m_dy=Number.NaN,this.m_buckets=new L(0),this.m_bucketedIndices=new L(0)}static sortEx(t,e,s,n,i=32){s-e<=i?n.userSort(e,s,t):(new z).sort(t,e,s,n,i)}sort(t,e,s,n,i=32){if(s-e<=i)return void n.userSort(e,s,t);let r=!0,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let h=e;h<s;h++){const e=n.getValue(t.read(h));e<o&&(o=e),e>a&&(a=e)}if(this.reset(s-e,o,a,s-e)){for(let r=e;r<s;r++){const s=t.read(r),i=n.getValue(s),o=this.getBucket(i);this.m_buckets.write(o,this.m_buckets.read(o)+1),this.m_bucketedIndices.write(r-e,s)}let i=this.m_buckets.read(0);this.m_buckets.write(0,0);for(let t=1,e=this.m_buckets.size();t<e;t++){const e=this.m_buckets.read(t);this.m_buckets.write(t,i),i+=e}for(let r=e;r<s;r++){const s=this.m_bucketedIndices.read(r-e),i=n.getValue(s),o=this.getBucket(i),a=this.m_buckets.read(o);t.write(a+e,s),this.m_buckets.write(o,a+1)}r=!1}if(r)return void n.userSort(e,s,t);let l=0;for(let h=0,u=this.m_buckets.size();h<u;h++){const s=l;l=this.m_buckets.read(h),l>s&&n.userSort(e+s,e+l,t)}this.m_buckets.size()>100&&(this.m_buckets.resize(0),this.m_bucketedIndices.resize(0))}reset(t,e,s,n){if(t<2||s===e)return!1;const i=Math.min(z.c_maxBuckets,t);return this.m_buckets.resize(i),this.m_buckets.setRange(0,0,this.m_buckets.size()),this.m_minValue=e,this.m_maxValue=s,this.m_bucketedIndices.resize(n),this.m_dy=(s-e)/(i-1),!0}getBucket(t){return Math.trunc((t-this.m_minValue)/this.m_dy)}getBucketCount(){return this.m_buckets.size()}}z.c_maxBuckets=65536;class O{capacity(){return this.capacity_}constructor(t){this.m_buffer=new Int32Array(0),this.m_firstFree=-1,this.m_last=0,this.size_=0,this.capacity_=0,this.stride=t}size(){return this.size_}deleteElement(t){t<this.m_last?(this.m_buffer[t*this.stride]=this.m_firstFree,this.m_firstFree=t):this.m_last--,this.size_--}getField(t,e){return this.m_buffer[t*this.stride+e]}setField(t,e,s){this.m_buffer[t*this.stride+e]=s}elementToIndex(t){return t}newElement(){let t=this.m_firstFree;if(-1===t){if(this.m_last===this.capacity_){let t=0!==this.capacity_?Math.trunc(3*(this.capacity_+1)/2):1;if(t>Number.MAX_SAFE_INTEGER&&(t=Number.MAX_SAFE_INTEGER),t===this.capacity_)throw new Error("index out of bounds");this.grow_(t)}t=this.m_last,this.m_last++}else this.m_firstFree=this.m_buffer[t*this.stride];this.size_++;for(let e=t*this.stride;e<t*this.stride+this.stride;e++)this.m_buffer[e]=-1;return t}newElementPset(t){let e=this.m_firstFree;if(-1===e){if(this.m_last===this.capacity_){let t=0!==this.capacity_?Math.trunc(3*(this.capacity_+1)/2):1;if(t>Number.MAX_SAFE_INTEGER&&(t=Number.MAX_SAFE_INTEGER),t===this.capacity_)throw new Error("index out of bounds");this.grow_(t)}e=this.m_last,this.m_last++}else this.m_firstFree=this.m_buffer[e*this.stride];this.size_++;const s=e*this.stride;for(let n=0;n<t.length;n++)this.m_buffer[s+n]=t[n];return e}deleteAll(t){this.m_firstFree=-1,this.m_last=0,this.size_=0,t&&(this.m_buffer=new Int32Array(0),this.capacity_=0)}setCapacity(t){t>this.capacity_&&this.grow_(t)}swap(t,e){const s=t*this.stride,n=e*this.stride;for(let i=0;i<this.stride;i++){const t=this.m_buffer[n+i];this.m_buffer[n+i]=this.m_buffer[s+i],this.m_buffer[s+i]=t}}swapField(t,e,s){const n=this.m_buffer[this.stride*e+s];this.m_buffer[this.stride*e+s]=this.m_buffer[this.stride*t+s],this.m_buffer[this.stride*t+s]=n}static impossibleIndex2(){return-2}static impossibleIndex3(){return-3}static isValidElement(t){return t>=0}grow_(t){null==this.m_buffer&&(this.m_buffer=new Int32Array(0));const e=this.stride*t,s=new Int32Array(e);s.set(this.m_buffer,0),this.m_buffer=s,this.capacity_=t}}class q{constructor(t,e,s){this.m_extent=new i.Envelope2D,this.m_dataExtent=new i.Envelope2D,this.m_childExtents=[new i.Envelope2D,new i.Envelope2D,new i.Envelope2D,new i.Envelope2D],this.m_elementNodes=new O(4),this.m_data=[],this.m_freeData=[],this.m_root=-1,this.m_height=8,void 0===s&&(s=!1),this.m_quadTreeNodes=new O(s?11:10),this.m_bStoreDuplicates=s,this.reset_(t,e)}reset(t,e){this.m_quadTreeNodes.deleteAll(!1),this.m_elementNodes.deleteAll(!1),this.m_data.length=0,this.m_freeData.length=0,this.reset_(t,e)}insert(t,e){if(-1===this.m_root&&this.createRoot_(),this.m_bStoreDuplicates){const s=this.insertDuplicates_(t,e,0,this.m_extent,this.m_root,!1,-1);return-1!==s&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:e}):this.m_dataExtent.mergeEnvelope2D(e)),s}const s=this.insert_(t,e,0,this.m_extent,this.m_root,!1,-1);return-1!==s&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:e}):this.m_dataExtent.mergeEnvelope2D(e)),s}insertEx(t,e,s){if(-1===this.m_root&&this.createRoot_(),this.m_bStoreDuplicates){const s=this.insertDuplicates_(t,e,0,this.m_extent,this.m_root,!1,-1);return-1!==s&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:e}):this.m_dataExtent.mergeEnvelope2D(e)),s}let n;n=-1===s?this.m_root:this.getQuad_(s);const i=this.getHeight(n),r=this.getExtent(n),o=this.insert_(t,e,i,r,n,!1,-1);return-1!==o&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:e}):this.m_dataExtent.mergeEnvelope2D(e)),o}removeElement(t){(0,r.g)(0)}getElement(t){return this.getElementValue_(this.getData_(t))}getElementAtIndex(t){return(0,r.g)(0),0}getElementExtent(t){const e=this.getData_(t);return this.getBoundingBoxValue_(e).clone()}getElementExtentAtIndex(t){return(0,r.g)(0),{}}getDataExtent(){return this.m_dataExtent.clone()}getQuadTreeExtent(){return(0,r.g)(0),{}}getHeight(t){return this.m_quadTreeNodes.getField(t,6)>>q.m_heightBitShift}getMaxHeight(){return this.m_height}getExtent(t){const e=new i.Envelope2D;if(e.setCoords({env2D:this.m_extent}),t===this.m_root)return e;const s=[];let n=t;do{s.push(this.getQuadrant_(n)),n=this.getParent_(n)}while(n!==this.m_root);const r=s.length;for(let i=0;i<r;i++){const t=s.at(-1);s.pop(),0===t?(e.xmin=.5*(e.xmin+e.xmax),e.ymin=.5*(e.ymin+e.ymax)):1===t?(e.xmax=.5*(e.xmin+e.xmax),e.ymin=.5*(e.ymin+e.ymax)):2===t?(e.xmax=.5*(e.xmin+e.xmax),e.ymax=.5*(e.ymin+e.ymax)):(e.xmin=.5*(e.xmin+e.xmax),e.ymax=.5*(e.ymin+e.ymax))}return e}getQuad(t){return this.getQuad_(t)}getElementCount(){return-1===this.m_root?0:this.getSubTreeElementCount_(this.m_root)}getSubTreeElementCount(t){return this.getSubTreeElementCount_(t)}getContainedSubTreeElementCount(t){return this.m_bStoreDuplicates?this.getContainedSubTreeElementCount_(t):this.getSubTreeElementCount_(t)}getIntersectionCount(t,e,s){if(-1===this.m_root)return 0;const r=new i.Envelope2D;r.setCoords({env2D:t}),r.inflateCoords(e,e);const o=[],a=[];o.push(this.m_root),a.push(this.m_extent.clone());const l=(0,n.m)(i.Envelope2D,4);let h=0;for(;o.length>0;){let t=!1;const e=o.at(-1),n=a.at(-1);if(o.pop(),a.pop(),r.containsEnvelope(n)){if(h+=this.getSubTreeElementCount(e),s>0&&h>=s)return s}else if(r.isIntersecting(n)){for(let t=this.getFirstElement_(e);-1!==t;t=this.getNextElement_(t)){const e=this.getData_(t);if(this.getBoundingBoxValue_(e).isIntersecting(r)&&(h++,s>0&&h>=s))return s}t=this.getHeight(e)+1<=this.m_height}if(t){q.setChildExtents_(n,l);for(let t=0;t<4;t++){const s=this.getChild_(e,t);-1!==s&&this.getSubTreeElementCount_(s)>0&&r.isIntersecting(l[t])&&(o.push(s),a.push(l[t].clone()))}}}return h}hasData(t,e){return this.getIntersectionCount(t,e,1)>=1}getIterator(t,e){return new B(this,t,e)}getIteratorForQT(){return new B(this)}getSortedIterator(t,e){return new Y(this.getIterator(t,e))}getSortedIteratorForQT(){return new Y(this.getIteratorForQT())}visitLeavesNearest(t,e,s,n){(0,r.g)(0)}reset_(t,e){(e<0||e>127)&&(0,r.a)("invalid height"),this.m_height=e,this.m_extent.setCoords({env2D:t}),this.m_dataExtent.setEmpty(),this.m_root=-1}insert_(t,e,s,n,r,o,a){if(!n.containsEnvelope(e))return 0===s?-1:this.insert_(t,e,0,this.m_extent,this.m_root,o,a);if(!o)for(let i=r;-1!==i;i=this.getParent_(i))this.setSubTreeElementCount_(i,this.getSubTreeElementCount_(i)+1);const l=new i.Envelope2D;l.setCoords({env2D:n});let h,u=r;for(h=s;h<this.m_height&&this.canPushDown_(u);h++){q.setChildExtents_(l,this.m_childExtents);let t=!1;for(let s=0;s<4;s++)if(this.m_childExtents[s].containsEnvelope(e)){t=!0;let e=this.getChild_(u,s);-1===e&&(e=this.createChild_(u,s)),this.setSubTreeElementCount_(e,this.getSubTreeElementCount_(e)+1),u=e,l.setCoords({env2D:this.m_childExtents[s]});break}if(!t)break}return this.insertAtQuad_(t,e,h,l,u,o,r,a,-1)}insertDuplicates_(t,e,s,r,o,a,l){if(!a){if(!r.containsEnvelope(e))return-1;this.setSubTreeElementCount_(o,this.getSubTreeElementCount_(o)+1),this.setContainedSubTreeElementCount_(o,this.getContainedSubTreeElementCount_(o)+1)}const h=Math.max(e.width(),e.height());let u=-1;const c=[],m=[],d=[];c.push(o),m.push(r.clone()),d.push(s);const g=(0,n.m)(i.Envelope2D,4);for(;c.length>0;){let s=!1;const n=c.at(-1),i=m.at(-1),r=d.at(-1);if(c.pop(),m.pop(),d.pop(),r+1<this.m_height&&this.canPushDown_(n)&&h<=Math.max(i.width(),i.height())/2&&(s=!0),s){q.setChildExtents_(i,g);let t=!1;for(let s=0;s<4;s++)if(t=g[s].containsEnvelope(e),t){let t=this.getChild_(n,s);-1===t&&(t=this.createChild_(n,s)),c.push(t),m.push(g[s].clone()),d.push(r+1),this.setSubTreeElementCount_(t,this.getSubTreeElementCount_(t)+1),this.setContainedSubTreeElementCount_(t,this.getContainedSubTreeElementCount_(t)+1);break}if(!t)for(let s=0;s<4;s++)if(g[s].isIntersecting(e)){let t=this.getChild_(n,s);-1===t&&(t=this.createChild_(n,s)),c.push(t),m.push(g[s].clone()),d.push(r+1),this.setSubTreeElementCount_(t,this.getSubTreeElementCount_(t)+1)}}else u=this.insertAtQuad_(t,e,r,i,n,a,o,l,u),a=!1}return 0}insertAtQuad_(t,e,s,n,i,r,o,a,l){this.getFirstElement_(i);const h=this.getLastElement_(i);let u=-1;if(r){if(i===o)return a;this.disconnectElementHandle_(a),u=a}else-1===l?(u=this.createElement_(),this.setDataValues_(this.getData_(u),t,e)):u=this.createElementFromDuplicate_(l);return this.setQuad_(u,i),-1!==h?(this.setPrevElement_(u,h),this.setNextElement_(h,u)):this.setFirstElement_(i,u),this.setLastElement_(i,u),this.setLocalElementCount_(i,this.getLocalElementCount_(i)+1),this.canFlush_(i)&&this.flush_(s,n,i),u}static setChildExtents_(t,e){const s=.5*(t.xmin+t.xmax),n=.5*(t.ymin+t.ymax);e[0].setCoords({xmin:s,ymin:n,xmax:t.xmax,ymax:t.ymax}),e[1].setCoords({xmin:t.xmin,ymin:n,xmax:s,ymax:t.ymax}),e[2].setCoords({xmin:t.xmin,ymin:t.ymin,xmax:s,ymax:n}),e[3].setCoords({xmin:s,ymin:t.ymin,xmax:t.xmax,ymax:n})}disconnectElementHandle_(t){const e=this.getQuad_(t),s=this.getFirstElement_(e),n=this.getLastElement_(e),i=this.getPrevElement_(t),r=this.getNextElement_(t);s===t?(-1!==r?this.setPrevElement_(r,-1):this.setLastElement_(e,-1),this.setFirstElement_(e,r)):n===t?(this.setNextElement_(i,-1),this.setLastElement_(e,i)):(this.setPrevElement_(r,i),this.setNextElement_(i,r)),this.setPrevElement_(t,-1),this.setNextElement_(t,-1),this.setLocalElementCount_(e,this.getLocalElementCount_(e)-1)}canFlush_(t){return this.getLocalElementCount_(t)===q.m_flushingCount&&!this.hasChildren_(t)}flush_(t,e,s){let n;const r=new i.Envelope2D;let o=this.getFirstElement_(s),a=-1,l=-1;do{l=this.getData_(o),n=this.getElementValue_(l),r.setCoords({env2D:this.getBoundingBoxValue_(l)}),a=this.getNextElement_(o),this.m_bStoreDuplicates?this.insertDuplicates_(n,r,t,e,s,!0,o):this.insert_(n,r,t,e,s,!0,o),o=a}while(-1!==o)}canPushDown_(t){return this.getLocalElementCount_(t)>=q.m_flushingCount||this.hasChildren_(t)}hasChildren_(t){return-1!==this.getChild_(t,0)||-1!==this.getChild_(t,1)||-1!==this.getChild_(t,2)||-1!==this.getChild_(t,3)}createChild_(t,e){const s=this.m_quadTreeNodes.newElement();return this.setChild_(t,e,s),this.setSubTreeElementCount_(s,0),this.setLocalElementCount_(s,0),this.setParent_(s,t),this.setHeightAndQuadrant_(s,this.getHeight_(t)+1,e),this.m_bStoreDuplicates&&this.setContainedSubTreeElementCount_(s,0),s}createRoot_(){this.m_root=this.m_quadTreeNodes.newElement(),this.setSubTreeElementCount_(this.m_root,0),this.setLocalElementCount_(this.m_root,0),this.setHeightAndQuadrant_(this.m_root,0,0),this.m_bStoreDuplicates&&this.setContainedSubTreeElementCount_(this.m_root,0)}createElement_(){const t=this.m_elementNodes.newElement();let e;return this.m_freeData.length>0?(e=this.m_freeData.at(-1),this.m_freeData.pop()):(e=this.m_data.length,this.m_data.length=e+1),this.setData_(t,e),t}createElementFromDuplicate_(t){const e=this.m_elementNodes.newElement(),s=this.getData_(t);return this.setData_(e,s),e}freeElementAndBoxNode_(t){(0,r.g)(0)}getChild_(t,e){return this.m_quadTreeNodes.getField(t,e)}setChild_(t,e,s){this.m_quadTreeNodes.setField(t,e,s)}getFirstElement_(t){return this.m_quadTreeNodes.getField(t,4)}setFirstElement_(t,e){this.m_quadTreeNodes.setField(t,4,e)}getLastElement_(t){return this.m_quadTreeNodes.getField(t,5)}setLastElement_(t,e){this.m_quadTreeNodes.setField(t,5,e)}getQuadrant_(t){return this.m_quadTreeNodes.getField(t,6)&q.m_quadrantMask}getHeight_(t){return this.m_quadTreeNodes.getField(t,6)>>q.m_heightBitShift}setHeightAndQuadrant_(t,e,s){const n=e<<q.m_heightBitShift|s;this.m_quadTreeNodes.setField(t,6,n)}getLocalElementCount_(t){return this.m_quadTreeNodes.getField(t,7)}setLocalElementCount_(t,e){this.m_quadTreeNodes.setField(t,7,e)}getSubTreeElementCount_(t){return this.m_quadTreeNodes.getField(t,8)}setSubTreeElementCount_(t,e){this.m_quadTreeNodes.setField(t,8,e)}getParent_(t){return this.m_quadTreeNodes.getField(t,9)}setParent_(t,e){this.m_quadTreeNodes.setField(t,9,e)}getContainedSubTreeElementCount_(t){return this.m_quadTreeNodes.getField(t,10)}setContainedSubTreeElementCount_(t,e){this.m_quadTreeNodes.setField(t,10,e)}getData_(t){return this.m_elementNodes.getField(t,0)}setData_(t,e){this.m_elementNodes.setField(t,0,e)}getPrevElement_(t){return this.m_elementNodes.getField(t,1)}getNextElement_(t){return this.m_elementNodes.getField(t,2)}setPrevElement_(t,e){this.m_elementNodes.setField(t,1,e)}setNextElement_(t,e){this.m_elementNodes.setField(t,2,e)}getQuad_(t){return this.m_elementNodes.getField(t,3)}setQuad_(t,e){this.m_elementNodes.setField(t,3,e)}getElementValue_(t){return this.m_data[t].element}getBoundingBoxValue_(t){return this.m_data[t].box}setDataValues_(t,e,s){this.m_data[t]=function(t,e){return{element:t,box:e.clone()}}(e,s)}}q.m_quadrantMask=3,q.m_heightBitShift=2,q.m_flushingCount=5;class B{constructor(t,e,s){this.m_bLinear=!1,this.m_queryStart=new n.P,this.m_queryEnd=new n.P,this.m_queryBox=new i.Envelope2D,this.m_tolerance=0,this.m_currentElementHandle=-1,this.m_nextElementHandle=-1,this.m_quadsStack=[],this.m_extentsStack=[],this.m_childExtents=[new i.Envelope2D,new i.Envelope2D,new i.Envelope2D,new i.Envelope2D],this.m_quadTree=t,e&&this.resetIterator(e,s)}resetIterator(t,e){if(void 0===e&&(e=0),t instanceof i.Envelope2D)return this.m_quadsStack.length=0,this.m_extentsStack.length=0,this.m_currentElementHandle=-1,this.m_queryBox.setCoords({env2D:t}),this.m_queryBox.inflateCoords(e,e),this.m_tolerance=Number.NaN,void(-1!==this.m_quadTree.m_root&&this.m_queryBox.isIntersecting(this.m_quadTree.m_extent)?(this.m_quadsStack.push(this.m_quadTree.m_root),this.m_extentsStack.push(this.m_quadTree.m_extent.clone()),this.m_nextElementHandle=this.m_quadTree.getFirstElement_(this.m_quadTree.m_root),this.m_bLinear=!1):this.m_nextElementHandle=-1);if(this.m_quadsStack.length=0,this.m_extentsStack.length=0,this.m_currentElementHandle=-1,t.queryLooseEnvelope(this.m_queryBox),this.m_queryBox.inflateCoords(e,e),-1!==this.m_quadTree.m_root&&this.m_queryBox.isIntersecting(this.m_quadTree.m_extent)){const s=t.getGeometryType();if(this.m_bLinear=s===r.G.enumLine,this.m_bLinear){const s=t;this.m_queryStart.assign(s.getStartXY()),this.m_queryEnd.assign(s.getEndXY()),this.m_tolerance=e}else this.m_tolerance=Number.NaN;this.m_quadsStack.push(this.m_quadTree.m_root),this.m_extentsStack.push(this.m_quadTree.m_extent.clone()),this.m_nextElementHandle=this.m_quadTree.getFirstElement_(this.m_quadTree.m_root)}else this.m_nextElementHandle=-1}next(){if(0===this.m_quadsStack.length)return-1;this.m_currentElementHandle=this.m_nextElementHandle;const t=new n.P,e=new n.P,s=new i.Envelope2D;let r=!1;for(;!r;){for(;-1!==this.m_currentElementHandle;){const n=this.m_quadTree.getData_(this.m_currentElementHandle);if(s.setCoords({env2D:this.m_quadTree.getBoundingBoxValue_(n)}),s.isIntersecting(this.m_queryBox)){if(!this.m_bLinear){r=!0;break}if(t.setCoordsPoint2D(this.m_queryStart),e.setCoordsPoint2D(this.m_queryEnd),s.inflateCoords(this.m_tolerance,this.m_tolerance),s.clipLine(t,e)>0){r=!0;break}}this.m_currentElementHandle=this.m_quadTree.getNextElement_(this.m_currentElementHandle)}if(-1===this.m_currentElementHandle){const s=this.m_quadsStack.at(-1),n=this.m_extentsStack.at(-1);q.setChildExtents_(n,this.m_childExtents),this.m_quadsStack.pop(),this.m_extentsStack.pop();for(let r=0;r<4;r++){const n=this.m_quadTree.getChild_(s,r);if(-1!==n&&this.m_quadTree.getSubTreeElementCount(n)>0&&this.m_childExtents[r].isIntersecting(this.m_queryBox))if(this.m_bLinear){t.setCoordsPoint2D(this.m_queryStart),e.setCoordsPoint2D(this.m_queryEnd);const s=new i.Envelope2D;s.setCoords({env2D:this.m_childExtents[r]}),s.inflateCoords(this.m_tolerance,this.m_tolerance),s.clipLine(t,e)>0&&(this.m_quadsStack.push(n),this.m_extentsStack.push(this.m_childExtents[r].clone()))}else this.m_quadsStack.push(n),this.m_extentsStack.push(this.m_childExtents[r].clone())}if(0===this.m_quadsStack.length)return-1;this.m_currentElementHandle=this.m_quadTree.getFirstElement_(this.m_quadsStack.at(-1))}}return this.m_nextElementHandle=this.m_quadTree.getNextElement_(this.m_currentElementHandle),this.m_currentElementHandle}clone(){return(0,r.g)(0),{}}}class Y{constructor(t){this.m_bucketSort=new z,this.m_sortedHandles=new L(0),this.m_index=-1,this.m_quadTreeIteratorImpl=t}resetIterator(t,e){this.m_quadTreeIteratorImpl.resetIterator(t,e),this.m_sortedHandles.resize(0),this.m_index=-1}next(){if(-1===this.m_index){let t=-1;for(;-1!==(t=this.m_quadTreeIteratorImpl.next());)this.m_sortedHandles.add(t);const e=this,s={userSort(t,s,n){n.sort(t,s,((t,s)=>e.m_quadTreeIteratorImpl.m_quadTree.getElement(t)-e.m_quadTreeIteratorImpl.m_quadTree.getElement(s)))},getValue:t=>e.m_quadTreeIteratorImpl.m_quadTree.getElement(t)};this.m_bucketSort.sort(this.m_sortedHandles,0,this.m_sortedHandles.size(),s)}return this.m_index===this.m_sortedHandles.size()-1?-1:(this.m_index++,this.m_sortedHandles.read(this.m_index))}clone(){return(0,r.g)(0),{}}}class U{constructor(t=!1){this.m_bNotifyOnActions=t}onDelete(t){}onSet(t){}onEndSearch(t){}onAddUniqueElementFailed(t){}onDeleteImpl(t,e){this.m_bNotifyOnActions&&this.onDelete(t.getElement(e))}onSetImpl(t,e){this.m_bNotifyOnActions&&this.onSet(t.getElement(e))}onAddUniqueElementFailedImpl(t){this.m_bNotifyOnActions&&this.onAddUniqueElementFailed(t)}onEndSearchImpl(t){this.m_bNotifyOnActions&&this.onEndSearch(t)}}class H{static st_nullNode(){return-1}constructor(){this.m_defaultTreap=-1,this.m_random=124234251,this.m_comparator=null,this.m_treapData=new O(7),this.m_treapCount=0,this.m_maxDepthEver=0,this.m_bBalancing=!0}setComparator(t){this.m_comparator=t}getComparator(){return this.m_comparator}disableBalancing(){this.m_bBalancing=!1}enableBalancing(){this.m_bBalancing||((0,r.g)(this.m_treapCount<=1),this.rebalance(-1),this.m_bBalancing=!0)}isAutoBalancing(){return this.m_bBalancing}rebalance(t){if(this.m_bBalancing)return;if(-1===t&&(t=this.m_defaultTreap),0===this.size(t))return;const e=[];for(let s=this.getFirst(t);-1!==s;s=this.getNext(s))e.push(s),this.setParent_(s,-1),this.setRight_(s,-1),this.setLeft_(s,-1);this.setRoot_(-1,t),this.setFirst_(-1,t),this.setLast_(-1,t),this.setSize_(0,t),this.m_bBalancing=!0;for(const s of e)this.addBiggestElement_(s,t);this.m_bBalancing=!1}setCapacity(t){this.m_treapData.setCapacity(t)}createTreap(t){const e=this.m_treapData.newElement();return this.setSize_(0,e),this.setTreapData_(t,e),this.m_treapCount++,e}deleteTreap(t){this.m_treapData.deleteElement(t),this.m_treapCount--}addElement(t,e=-1){return-1===e&&(this.m_defaultTreap===H.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),e=this.m_defaultTreap),this.addElement_(t,0,e)}addUniqueElement(t,e=-1){return-1===e&&(this.m_defaultTreap===H.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),e=this.m_defaultTreap),this.addElement_(t,1,e)}addBiggestElement(t,e=-1){-1===e&&(this.m_defaultTreap===H.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),e=this.m_defaultTreap);const s=this.newNode_(t);return this.addBiggestElement_(s,e),s}addElementAtPosition(t,e,s,i,r,o=-1){if(-1===o&&(this.m_defaultTreap===H.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),o=this.m_defaultTreap),this.getRoot_(o)===H.st_nullNode()){const t=this.newNode_(s);return this.setRoot_(t,o),this.addToList_(-1,t,o),t}let a,l,h,u,c;if(r?(a=e!==H.st_nullNode()?this.m_comparator.compare(this,s,e):-1,l=t!==H.st_nullNode()?this.m_comparator.compare(this,s,t):1):(a=-1,l=1),i&&(0===a||0===l)){this.m_comparator.onAddUniqueElementFailedImpl(s);const n=0===a?e:t;return this.setDuplicateElement_(n,o),-1}c=e!==H.st_nullNode()&&t!==H.st_nullNode()?this.m_random>(0,n.B)(this.m_random)>>1:e!==H.st_nullNode(),c?(u=a,h=e):(u=l,h=t);let m=-1,d=-1,g=!0;for(;;){if(u<0){const t=this.getLeft(h);if(t===H.st_nullNode()){d=h,m=this.newNode_(s),this.setLeft_(h,m),this.setParent_(m,h);break}h=t}else{const t=this.getRight(h);if(t===H.st_nullNode()){d=this.getNext(h),m=this.newNode_(s),this.setRight_(h,m),this.setParent_(m,h);break}h=t}g&&(u*=-1,g=!1)}return this.bubbleUp_(m),this.getParent(m)===H.st_nullNode()&&this.setRoot_(m,o),this.addToList_(d,m,o),m}replaceElementAtPosition(t,e,s,n,i=-1){if(n){const n=this.getNext(t);let r=-1;n!==H.st_nullNode()&&(r=this.m_comparator.compare(this,e,n));const o=this.getPrev(t);let a=-1;if(o!==H.st_nullNode()&&(a=this.m_comparator.compare(this,e,o)),s&&(0===r||0===a)){this.m_comparator.onAddUniqueElementFailedImpl(e);const t=0===r?n:o;return i===H.st_nullNode()&&(this.m_defaultTreap===H.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),i=this.m_defaultTreap),this.setDuplicateElement_(t,i),-1}}return this.setElement_(t,e),t}getDuplicateElement(t=-1){return-1===t?this.getDuplicateElement_(this.m_defaultTreap):this.getDuplicateElement_(t)}deleteNode(t,e=-1){this.m_comparator&&this.m_comparator.onDeleteImpl(this,t),-1===e&&(e=this.m_defaultTreap),this.m_bBalancing?this.deleteNode_(t,e):this.unbalancedDelete_(t,e)}search(t,e=-1){let s=this.getRoot(e);for(;s!==H.st_nullNode();){const e=this.m_comparator.compare(this,t,s);if(!e)return s;s=e<0?this.getLeft(s):this.getRight(s)}return this.m_comparator.onEndSearchImpl(t),H.st_nullNode()}searchLowerBound(t,e=-1){let s=this.getRoot(e),n=-1;for(;s!==H.st_nullNode();){const e=t.compare(this,s);if(!e)return s;e<0?s=this.getLeft(s):(n=s,s=this.getRight(s))}return n}searchUpperBound(t,e=-1){let s=this.getRoot(e),n=-1;for(;s!==H.st_nullNode();){const e=t.compare(this,s);if(!e)return s;e<0?(n=s,s=this.getLeft(s)):s=this.getRight(s)}return n}getElement(t){return this.m_treapData.getField(t,3)}getLeft(t){return this.m_treapData.getField(t,0)}getRight(t){return this.m_treapData.getField(t,1)}getParent(t){return this.m_treapData.getField(t,2)}getNext(t){return this.m_treapData.getField(t,6)}getPrev(t){return this.m_treapData.getField(t,5)}getFirst(t=-1){return-1===t?this.getFirst_(this.m_defaultTreap):this.getFirst_(t)}getLast(t=-1){return-1===t?this.getLast_(this.m_defaultTreap):this.getLast_(t)}getTreapData(t=-1){return-1===t?this.getTreapData_(this.m_defaultTreap):this.getTreapData_(t)}setElement(t,e){null!==this.m_comparator&&this.m_comparator.onSetImpl(this,t),this.setElement_(t,e)}getRoot(t=-1){return-1===t?this.getRoot_(this.m_defaultTreap):this.getRoot_(t)}clear(){this.m_treapData.deleteAll(!1),this.m_defaultTreap=H.st_nullNode(),this.m_treapCount=0,this.m_maxDepthEver=0}addToList_(t,e,s){let n;-1!==t?(n=this.getPrev(t),this.setPrev_(t,e)):n=this.getLast_(s),this.setPrev_(e,n),-1!==n&&this.setNext_(n,e),this.setNext_(e,t),t===this.getFirst_(s)&&this.setFirst_(e,s),-1===t&&this.setLast_(e,s),this.setSize_(this.getSize_(s)+1,s)}size(t=-1){return-1===t?this.getSize_(this.m_defaultTreap):this.getSize_(t)}getMaxDepth(t=-1){return this.getMaxDepthHelper_(this.getRoot(t))}getMaxDepthEver(){return this.m_maxDepthEver}static st_isValidNode(t){return O.isValidElement(t)}dbgCheck_(t){}getPriority_(t){return this.m_treapData.getField(t,4)}bubbleDown_(t){let e=this.getLeft(t),s=this.getRight(t);const i=this.getPriority_(t);for(;e!==H.st_nullNode()||s!==H.st_nullNode();){const r=e!==H.st_nullNode()?this.getPriority_(e):(0,n.j)(),o=s!==H.st_nullNode()?this.getPriority_(s):(0,n.j)();if(i<=Math.min(r,o))return;r<=o?this.rotateRight_(e):this.rotateLeft_(t),e=this.getLeft(t),s=this.getRight(t)}}bubbleUp_(t){if(!this.m_bBalancing)return;const e=this.getPriority_(t);let s=this.getParent(t);for(;s!==H.st_nullNode()&&this.getPriority_(s)>e;)this.getLeft(s)===t?this.rotateRight_(t):this.rotateLeft_(s),s=this.getParent(t)}rotateLeft_(t){const e=t,s=this.getRight(t);let n;this.setParent_(s,this.getParent(e)),this.setParent_(e,s),n=this.getLeft(s),this.setRight_(e,n),n!==H.st_nullNode()&&this.setParent_(n,e),this.setLeft_(s,e),n=this.getParent(s),n!==H.st_nullNode()&&(this.getLeft(n)===e?this.setLeft_(n,s):this.setRight_(n,s))}rotateRight_(t){const e=this.getParent(t),s=t;let n;this.setParent_(s,this.getParent(e)),this.setParent_(e,s),n=this.getRight(s),this.setLeft_(e,n),n!==H.st_nullNode()&&this.setParent_(n,e),this.setRight_(s,e),n=this.getParent(s),n!==H.st_nullNode()&&(this.getLeft(n)===e?this.setLeft_(n,s):this.setRight_(n,s))}setParent_(t,e){this.m_treapData.setField(t,2,e)}setLeft_(t,e){this.m_treapData.setField(t,0,e)}setRight_(t,e){this.m_treapData.setField(t,1,e)}setPriority_(t,e){this.m_treapData.setField(t,4,e)}setPrev_(t,e){this.m_treapData.setField(t,5,e)}setNext_(t,e){this.m_treapData.setField(t,6,e)}setRoot_(t,e){this.m_treapData.setField(e,0,t)}setFirst_(t,e){this.m_treapData.setField(e,1,t)}setLast_(t,e){this.m_treapData.setField(e,2,t)}setDuplicateElement_(t,e){this.m_treapData.setField(e,3,t)}setSize_(t,e){this.m_treapData.setField(e,4,t)}setTreapData_(t,e){this.m_treapData.setField(e,5,t)}getRoot_(t){return-1===t?H.st_nullNode():this.m_treapData.getField(t,0)}getFirst_(t){return-1===t?H.st_nullNode():this.m_treapData.getField(t,1)}getLast_(t){return-1===t?H.st_nullNode():this.m_treapData.getField(t,2)}getDuplicateElement_(t){return-1===t?H.st_nullNode():this.m_treapData.getField(t,3)}getSize_(t){return-1===t?0:this.m_treapData.getField(t,4)}getTreapData_(t){return this.m_treapData.getField(t,5)}newNode_(t){const e=this.m_treapData.newElement();return this.setPriority_(e,this.generatePriority_()),this.setElement_(e,t),e}freeNode_(t,e){t!==H.st_nullNode()&&this.m_treapData.deleteElement(t)}generatePriority_(){return this.m_random=(0,n.B)(this.m_random),this.m_random&(0,n.j)()>>1}maxPriority(){return(0,r.g)(0),0}getMaxDepthHelper_(t){return t===H.st_nullNode()?0:1+Math.max(this.getMaxDepthHelper_(this.getLeft(t)),this.getMaxDepthHelper_(this.getRight(t)))}addElement_(t,e,s){if(this.getRoot(s)===H.st_nullNode()){const e=this.newNode_(t);return this.setRoot_(e,s),this.addToList_(-1,e,s),this.m_maxDepthEver=Math.max(this.m_maxDepthEver,1),e}let n=this.getRoot_(s),i=-1,r=-1,o=1;for(;;){const a=-1===e?1:this.m_comparator.compare(this,t,n);if(a<0){const e=this.getLeft(n);if(e===H.st_nullNode()){r=n,i=this.newNode_(t),this.setLeft_(n,i),this.setParent_(i,n);break}n=e}else{if(1===e&&0===a)return this.m_comparator.onAddUniqueElementFailedImpl(t),this.setDuplicateElement_(n,s),-1;const o=this.getRight(n);if(o===H.st_nullNode()){r=this.getNext(n),i=this.newNode_(t),this.setRight_(n,i),this.setParent_(i,n);break}n=o}o++}return this.bubbleUp_(i),this.getParent(i)===H.st_nullNode()&&this.setRoot_(i,s),this.addToList_(r,i,s),this.m_maxDepthEver=Math.max(o,this.m_maxDepthEver),i}removeFromList_(t,e){const s=this.getPrev(t),n=this.getNext(t);-1!==s?this.setNext_(s,n):this.setFirst_(n,e),-1!==n?this.setPrev_(n,s):this.setLast_(s,e),this.setSize_(this.getSize_(e)-1,e)}unbalancedDelete_(t,e){this.removeFromList_(t,e);let s=this.getLeft(t),i=this.getRight(t),r=this.getParent(t),o=t;if(-1!==s&&-1!==i){let a;this.m_random=(0,n.B)(this.m_random),a=this.m_random>(0,n.j)()>>1?this.getNext(t):this.getPrev(t);const l=this.getParent(a)===t;this.m_treapData.swapField(t,a,0),this.m_treapData.swapField(t,a,1),this.m_treapData.swapField(t,a,2),-1!==r?this.getLeft(r)===t?this.setLeft_(r,a):this.setRight_(r,a):this.setRoot_(a,e),l?(s===a?(this.setLeft_(a,t),this.setParent_(i,a)):i===a&&(this.setRight_(a,t),this.setParent_(s,a)),this.setParent_(t,a),r=a):(this.setParent_(s,a),this.setParent_(i,a),r=this.getParent(t),o=a),s=this.getLeft(t),i=this.getRight(t),-1!==s&&this.setParent_(s,t),-1!==i&&this.setParent_(i,t)}const a=-1!==s?s:i;-1===r?this.setRoot_(a,e):this.getLeft(r)===o?this.setLeft_(r,a):this.setRight_(r,a),-1!==a&&this.setParent_(a,r),this.freeNode_(t,e)}deleteNode_(t,e){this.setPriority_(t,(0,n.j)());let s=H.st_nullNode(),i=H.st_nullNode();const r=this.getRoot_(e),o=r===t;if(o&&(s=this.getLeft(r),i=this.getRight(r),s===H.st_nullNode()&&i===H.st_nullNode()))return this.removeFromList_(r,e),this.freeNode_(r,e),void this.setRoot_(H.st_nullNode(),e);this.bubbleDown_(t);const a=this.getParent(t);a!==H.st_nullNode()&&(this.getLeft(a)===t?this.setLeft_(a,H.st_nullNode()):this.setRight_(a,H.st_nullNode())),this.removeFromList_(t,e),this.freeNode_(t,e),o&&this.setRoot_(s===H.st_nullNode()||this.getParent(s)!==H.st_nullNode()?i:s,e)}setElement_(t,e){this.m_treapData.setField(t,3,e)}addBiggestElement_(t,e){if(this.getRoot_(e)===H.st_nullNode())return this.setRoot_(t,e),void this.addToList_(-1,t,e);const s=this.getLast_(e);this.setRight_(s,t),this.setParent_(t,s),this.bubbleUp_(t),this.getParent(t)===H.st_nullNode()&&this.setRoot_(t,e),this.addToList_(-1,t,e)}}class X{constructor(t){this.m_lists=new O(6),this.m_listOfLists=X.st_nullNode(),void 0===t?(this.m_listNodes=new O(3),this.m_bStoreListIndexWithNode=!1):(this.m_listNodes=new O(t?4:3),this.m_bStoreListIndexWithNode=t)}freeNode_(t){this.m_listNodes.deleteElement(t)}newNode_(){return this.m_listNodes.newElement()}freeList_(t){(0,r.g)(0)}newList_(){return this.m_lists.newElement()}setPrev_(t,e){this.m_listNodes.setField(t,1,e)}setNext_(t,e){this.m_listNodes.setField(t,2,e)}setData_(t,e){(0,r.g)(0)}setList_(t,e){return this.m_listNodes.setField(t,3,e)}setListSize_(t,e){this.m_lists.setField(t,4,e)}setNextList_(t,e){(0,r.g)(0)}setPrevList_(t,e){this.m_lists.setField(t,2,e)}createList(t){const e=this.newList_();return this.m_lists.setField(e,3,this.m_listOfLists),this.m_lists.setField(e,4,0),this.m_lists.setField(e,5,t),this.m_listOfLists!==X.st_nullNode()&&this.setPrevList_(this.m_listOfLists,e),this.m_listOfLists=e,e}deleteList(t){this.clear(t);const e=this.m_lists.getField(t,2),s=this.m_lists.getField(t,3);return e!==X.st_nullNode()?this.setNextList_(e,s):this.m_listOfLists=s,s!==X.st_nullNode()&&this.setPrevList_(s,e),this.freeList_(t),s}reserveLists(t){(0,r.g)(0)}getListData(t){return this.m_lists.getField(t,5)}getList(t){return(0,r.g)(0),0}setListData(t,e){this.m_lists.setField(t,5,e)}addElement(t,e){return this.insertElement(t,-1,e)}insertElement(t,e,s){const n=this.newNode_();let i=-1;if(e!==X.st_nullNode()&&(i=this.getPrev(e),this.setPrev_(e,n)),this.setNext_(n,e),i!==X.st_nullNode()&&this.setNext_(i,n),e===this.m_lists.getField(t,0)&&this.m_lists.setField(t,0,n),e===X.st_nullNode()){const e=this.m_lists.getField(t,1);this.setPrev_(n,e),-1!==e&&this.setNext_(e,n),this.m_lists.setField(t,1,n)}return this.setData(n,s),this.setListSize_(t,this.getListSize(t)+1),this.m_bStoreListIndexWithNode&&this.setList_(n,t),n}deleteElement(t,e){const s=this.getPrev(e),n=this.getNext(e);return s!==X.st_nullNode()?this.setNext_(s,n):this.m_lists.setField(t,0,n),n!==X.st_nullNode()?this.setPrev_(n,s):this.m_lists.setField(t,1,s),this.freeNode_(e),this.setListSize_(t,this.getListSize(t)-1),n}reserveNodes(t){this.m_listNodes.setCapacity(t)}getData(t){return this.m_listNodes.getField(t,0)}getElement(t){return this.getData(t)}setData(t,e){this.m_listNodes.setField(t,0,e)}getNext(t){return this.m_listNodes.getField(t,2)}getPrev(t){return this.m_listNodes.getField(t,1)}getFirst(t){return this.m_lists.getField(t,0)}getLast(t){return this.m_lists.getField(t,1)}static st_nullNode(){return-1}clear(t){if(void 0!==t){let e=this.getLast(t);for(;e!==X.st_nullNode();){const t=e;e=this.getPrev(t),this.freeNode_(t)}return this.m_lists.setField(t,0,-1),this.m_lists.setField(t,1,-1),void this.setListSize_(t,0)}for(let e=this.getFirstList();-1!==e;)e=this.deleteList(e)}isEmpty(t){return(0,r.g)(0),!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getListSize(t){return this.m_lists.getField(t,4)}getFirstList(){return this.m_listOfLists}getNextList(t){return this.m_lists.getField(t,3)}}class j extends U{constructor(t){super(),this.m_intervalTree=t}compare(t,e,s){const n=t.getElement(s),i=this.m_intervalTree.getValue_(e),r=this.m_intervalTree.getValue_(n);return i<r?-1:i===r?Z.isLeft_(e)&&Z.isRight_(n)?-1:Z.isLeft_(n)&&Z.isRight_(e)?1:0:1}}class Z{constructor(t){this.m_bEnvelopesRef=!1,this.m_intervals=[],this.m_envelopesRef=null,this.m_intervalNodes=new O(3),this.m_intervalHandles=[],this.m_endIndicesUnique=[],this.m_cCount=-1,this.m_root=-1,this.m_bSortIntervals=!1,this.m_bConstructing=!1,this.m_bConstructionEnded=!1,this.m_bOfflineDynamic=t,this.m_tertiaryNodes=new O(this.m_bOfflineDynamic?5:4),this.m_secondaryTreaps=new H,this.m_secondaryTreaps.setComparator(new j(this)),this.m_secondaryLists=new X}addEnvelopesRef(t){this.reset_(!0,!0),this.m_bEnvelopesRef=!0,this.m_envelopesRef=t,this.m_bConstructing=!1,this.m_bConstructionEnded=!0,this.m_bOfflineDynamic||(this.insertIntervalsStatic_(),this.m_cCount=this.m_envelopesRef.length)}startConstruction(){this.reset_(!0,!1)}addInterval(t){this.m_bConstructing||(0,r.p)(""),this.m_intervals.push(t.clone())}addIntervalCoords(t,e){(0,r.g)(0)}endConstruction(){this.m_bConstructing||(0,r.p)(""),this.m_bConstructing=!1,this.m_bConstructionEnded=!0,this.m_bOfflineDynamic||(this.insertIntervalsStatic_(),this.m_cCount=this.m_intervals.length)}insert(t){if(this.m_bOfflineDynamic&&this.m_bConstructionEnded||(0,r.p)(""),-1===this.m_root){const t=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;if(this.m_bSortIntervals){const e=new L(0);this.querySortedEndPointIndices_(e),this.m_endIndicesUnique.length=0,this.querySortedDuplicatesRemoved_(e),this.m_intervalHandles.length=t,this.m_intervalHandles.fill(-1),this.m_bSortIntervals=!1}else this.m_intervalHandles.fill(-1,0,t);this.m_root=this.createRoot_()}const e=this.insertIntervalEnd_(t<<1,this.m_root),s=this.getSecondaryFromInterval_(e),n=this.m_secondaryTreaps.addElement(1+(t<<1),s);this.setRightEnd_(e,n),this.m_intervalHandles[t]=e,this.m_cCount++}remove(t){this.m_bOfflineDynamic&&this.m_bConstructionEnded||(0,r.p)("");const e=this.m_intervalHandles[t];let s;-1===e&&(0,r.a)("the interval does not exist in the interval tree"),this.m_intervalHandles[t]=-1,this.m_cCount--;let n=this.getSecondaryFromInterval_(e),i=-1;i=this.m_secondaryTreaps.getTreapData(n),this.m_secondaryTreaps.deleteNode(this.getLeftEnd_(e),n),this.m_secondaryTreaps.deleteNode(this.getRightEnd_(e),n),s=this.m_secondaryTreaps.size(n),0===s&&(this.m_secondaryTreaps.deleteTreap(n),this.setSecondaryToTertiary_(i,-1)),this.m_intervalNodes.deleteElement(e);let o=this.getPptr_(i),a=this.getLptr_(i),l=this.getRptr_(i);for(;!(s>0||i===this.m_root||-1!==a&&-1!==l);)i===this.getLptr_(o)?-1!==a?(this.setLptr_(o,a),this.setPptr_(a,o),this.setLptr_(i,-1),this.setPptr_(i,-1)):-1!==l?(this.setLptr_(o,l),this.setPptr_(l,o),this.setRptr_(i,-1),this.setPptr_(i,-1)):(this.setLptr_(o,-1),this.setPptr_(i,-1)):-1!==a?(this.setRptr_(o,a),this.setPptr_(a,o),this.setLptr_(i,-1),this.setPptr_(i,-1)):-1!==l?(this.setRptr_(o,l),this.setPptr_(l,o),this.setRptr_(i,-1),this.setPptr_(i,-1)):(this.setRptr_(o,-1),this.setPptr_(i,-1)),this.m_tertiaryNodes.deleteElement(i),i=o,n=this.getSecondaryFromTertiary_(i),s=-1!==n?this.m_secondaryTreaps.size(n):0,a=this.getLptr_(i),l=this.getRptr_(i),o=this.getPptr_(i)}size(){return this.m_cCount}getIteratorQuery(t,e){return t instanceof n.E?new W(this,t,e):((0,r.g)(0),{})}getIterator(){return new W(this)}querySortedEndPointIndices_(t){const e=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;for(let s=0;s<2*e;s++)t.add(s);this.sortEndIndices_(t,0,2*e)}querySortedDuplicatesRemoved_(t){let e=Number.NaN;for(let s=0;s<t.size();s++){const n=t.read(s),i=this.getValue_(n);i!==e&&(this.m_endIndicesUnique.push(n),e=i)}}insertIntervalsStatic_(){const t=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length,e=new L(0);this.querySortedEndPointIndices_(e),this.m_endIndicesUnique.length=0,this.querySortedDuplicatesRemoved_(e),this.m_intervalNodes.setCapacity(t),this.m_secondaryLists.reserveNodes(2*t);const s=(0,n.d)(t,-1);this.m_root=this.createRoot_();for(let n=0;n<e.size();n++){const t=e.read(n);let i=s[t>>1];if(-1!==i){const e=this.getSecondaryFromInterval_(i);this.setRightEnd_(i,this.m_secondaryLists.addElement(e,t))}else i=this.insertIntervalEnd_(t,this.m_root),s[t>>1]=i}}createRoot_(){const t=this.calculateDiscriminantIndex1_(0,this.m_endIndicesUnique.length-1);return this.createTertiaryNode_(t)}insertIntervalEnd_(t,e){let s=-1,n=e,i=-1,r=-1,o=0,a=this.m_endIndicesUnique.length-1,l=0;const h=t>>1;let u=Number.NaN,c=Number.NaN,m=!0;const d=this.getMin_(h),g=this.getMax_(h);let p=-1;for(;m;){l=o+(a-o>>1),p=this.calculateDiscriminantIndex1_(o,a);const e=this.getDiscriminantFromIndex1_(p);if(g<e){if(-1!==n)if(p===this.getDiscriminantIndex1_(n))s=n,u=e,n=this.getLptr_(n),c=-1!==n?this.getDiscriminant_(n):Number.NaN;else if(c>e){const t=this.createTertiaryNode_(p);e<u?this.setLptr_(s,t):this.setRptr_(s,t),this.setRptr_(t,n),this.m_bOfflineDynamic&&(this.setPptr_(t,s),this.setPptr_(n,t)),s=t,u=e,n=-1,c=Number.NaN}a=l;continue}if(d>e){if(-1!==n)if(p===this.getDiscriminantIndex1_(n))s=n,u=e,n=this.getRptr_(n),c=-1!==n?this.getDiscriminant_(n):Number.NaN;else if(c<e){const t=this.createTertiaryNode_(p);e<u?this.setLptr_(s,t):this.setRptr_(s,t),this.setLptr_(t,n),this.m_bOfflineDynamic&&(this.setPptr_(t,s),this.setPptr_(n,t)),s=t,u=e,n=-1,c=Number.NaN}o=l+1;continue}let h=-1;h=-1===n||p!==this.getDiscriminantIndex1_(n)?this.createTertiaryNode_(p):n,i=this.getSecondaryFromTertiary_(h),-1===i&&(i=this.createSecondary_(h),this.setSecondaryToTertiary_(h,i));const _=this.addEndIndex_(i,t);r=this.createIntervalNode_(),this.setSecondaryToInterval_(r,i),this.setLeftEnd_(r,_),-1!==n&&p===this.getDiscriminantIndex1_(n)||(e<u?this.setLptr_(s,h):this.setRptr_(s,h),this.m_bOfflineDynamic&&this.setPptr_(h,s),-1!==n&&(c<e?this.setLptr_(h,n):this.setRptr_(h,n),this.m_bOfflineDynamic&&this.setPptr_(n,h))),m=!1;break}return r}createTertiaryNode_(t){const e=this.m_tertiaryNodes.newElement();return this.setDiscriminantIndex1_(e,t),e}createSecondary_(t){return this.m_bOfflineDynamic?this.m_secondaryTreaps.createTreap(t):this.m_secondaryLists.createList(t)}createIntervalNode_(){return this.m_intervalNodes.newElement()}reset(){this.m_bOfflineDynamic&&this.m_bConstructionEnded||(0,r.p)(""),this.reset_(!1,this.m_bEnvelopesRef)}reset_(t,e){t?(this.m_bEnvelopesRef=!1,this.m_envelopesRef=null,this.m_bSortIntervals=!0,this.m_bConstructing=!0,this.m_bConstructionEnded=!1,this.m_endIndicesUnique.length=0,e?(this.m_intervals.length=0,this.m_bEnvelopesRef=!0):this.m_intervals.length=0):this.m_bSortIntervals=!1,this.m_bOfflineDynamic?this.m_secondaryTreaps.clear():this.m_secondaryLists.clear(),this.m_intervalNodes.deleteAll(!1),this.m_tertiaryNodes.deleteAll(!1),this.m_root=-1,this.m_cCount=0}getDiscriminant_(t){const e=this.getDiscriminantIndex1_(t);return this.getDiscriminantFromIndex1_(e)}getDiscriminantFromIndex1_(t){if(-1===t)return Number.NaN;if(t>0){const e=t-2,s=this.m_endIndicesUnique[e],n=this.m_endIndicesUnique[e+1];return.5*(this.getValue_(s)+this.getValue_(n))}const e=-t-2,s=this.m_endIndicesUnique[e];return this.getValue_(s)}calculateDiscriminantIndex1_(t,e){let s;return s=t<e?t+(e-t>>1)+2:-(t+2),s}setDiscriminantIndex1_(t,e){this.m_tertiaryNodes.setField(t,0,e)}setSecondaryToTertiary_(t,e){this.m_tertiaryNodes.setField(t,1,e)}setLptr_(t,e){this.m_tertiaryNodes.setField(t,2,e)}setRptr_(t,e){this.m_tertiaryNodes.setField(t,3,e)}setPptr_(t,e){this.m_tertiaryNodes.setField(t,4,e)}setSecondaryToInterval_(t,e){this.m_intervalNodes.setField(t,0,e)}addEndIndex_(t,e){let s=-1;return s=this.m_bOfflineDynamic?this.m_secondaryTreaps.addElement(e,t):this.m_secondaryLists.addElement(t,e),s}setLeftEnd_(t,e){this.m_intervalNodes.setField(t,1,e)}setRightEnd_(t,e){this.m_intervalNodes.setField(t,2,e)}getFirst_(t){return this.m_bOfflineDynamic?this.m_secondaryTreaps.getFirst(t):this.m_secondaryLists.getFirst(t)}getLast_(t){return this.m_bOfflineDynamic?this.m_secondaryTreaps.getLast(t):this.m_secondaryLists.getLast(t)}static isLeft_(t){return!(1&t)}static isRight_(t){return!(1&~t)}getDiscriminantIndex1_(t){return this.m_tertiaryNodes.getField(t,0)}getSecondaryFromTertiary_(t){return this.m_tertiaryNodes.getField(t,1)}getLptr_(t){return this.m_tertiaryNodes.getField(t,2)}getRptr_(t){return this.m_tertiaryNodes.getField(t,3)}getPptr_(t){return this.m_tertiaryNodes.getField(t,4)}getSecondaryFromInterval_(t){return this.m_intervalNodes.getField(t,0)}getLeftEnd_(t){return this.m_intervalNodes.getField(t,1)}getRightEnd_(t){return this.m_intervalNodes.getField(t,2)}getMin_(t){return this.m_bEnvelopesRef?this.m_envelopesRef[t].xmin:this.m_intervals[t].vmin}getMax_(t){return this.m_bEnvelopesRef?this.m_envelopesRef[t].xmax:this.m_intervals[t].vmax}sortEndIndices_(t,e,s){const n=this,i={userSort(t,e,s){n.sortEndIndicesHelper_(s,t,e)},getValue:t=>n.getValue_(t)};(new z).sort(t,e,s,i)}sortEndIndicesHelper_(t,e,s){t.sort(e,s,((t,e)=>{const s=this.getValue_(t),n=this.getValue_(e);return s<n||s===n&&Z.isLeft_(t)&&Z.isRight_(e)?-1:1}))}getValue_(t){if(!this.m_bEnvelopesRef){const e=this.m_intervals[t>>1];return Z.isLeft_(t)?e.vmin:e.vmax}const e=this.m_envelopesRef[t>>1];return Z.isLeft_(t)?e.xmin:e.xmax}}class W{constructor(t,e,s){this.m_query=n.E.constructEmpty(),this.m_tertiaryHandle=-1,this.m_nextTertiaryHandle=-1,this.m_forkedHandle=-1,this.m_currentEndHandle=-1,this.m_nextEndHandle=-1,this.m_tertiaryStack=[],this.m_functionIndex=0,this.m_intervalTree=t,this.m_functionStack=new Array(2),this.m_functionStack[0]=this.nullFunc_,this.m_functionStack[1]=this.nullFunc_,void 0!==e&&this.resetIterator(e,s)}nullFunc_(){return(0,r.d)("should not be called"),!1}resetIterator(t,e){if("number"==typeof t){const s=new n.E;s.setCoords(t,t),this.resetIterator(s,e)}else void 0===e&&(e=0),this.m_query.vmin=t.vmin-e,this.m_query.vmax=t.vmax+e,this.m_tertiaryStack.length=0,this.m_functionIndex=0,this.m_functionStack[0]=this.initialize_}next(){if(this.m_intervalTree.m_bConstructionEnded||(0,r.p)(""),this.m_functionIndex<0)return-1;for(;this.m_fi=this.m_functionStack[this.m_functionIndex],this.m_fi(););return-1!==this.m_currentEndHandle?this.getCurrentEndIndex_()>>1:-1}initialize_(){return this.m_tertiaryHandle=-1,this.m_nextTertiaryHandle=-1,this.m_forkedHandle=-1,this.m_currentEndHandle=-1,this.m_intervalTree.m_tertiaryNodes.size()>0?(this.m_functionStack[0]=this.pIn_,this.m_nextTertiaryHandle=this.m_intervalTree.m_root,!0):(this.m_functionIndex=-1,!1)}pIn_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,-1===this.m_tertiaryHandle)return this.m_functionIndex=-1,this.m_currentEndHandle=-1,!1;const t=this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle);if(this.m_query.vmax<t){const t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==t&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(t),this.m_functionStack[++this.m_functionIndex]=this.left_),!0}if(t<this.m_query.vmin){const t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),-1!==t&&(this.m_nextEndHandle=this.m_intervalTree.getLast_(t),this.m_functionStack[++this.m_functionIndex]=this.right_),!0}this.m_functionStack[this.m_functionIndex]=this.pL_,this.m_forkedHandle=this.m_tertiaryHandle;const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.all_),!0}pL_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,-1===this.m_tertiaryHandle)return this.m_functionStack[this.m_functionIndex]=this.pR_,this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_forkedHandle),!0;if(this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle)<this.m_query.vmin){const t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),-1!==t&&(this.m_nextEndHandle=this.m_intervalTree.getLast_(t),this.m_functionStack[++this.m_functionIndex]=this.right_),!0}const t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==t&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(t),this.m_functionStack[++this.m_functionIndex]=this.all_);const e=this.m_intervalTree.getRptr_(this.m_tertiaryHandle);return-1!==e&&this.m_tertiaryStack.push(e),!0}pR_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,-1===this.m_tertiaryHandle)return this.m_functionStack[this.m_functionIndex]=this.pT_,!0;const t=this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle);if(this.m_query.vmax<t){const t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==t&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(t),this.m_functionStack[++this.m_functionIndex]=this.left_),!0}const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.all_);const s=this.m_intervalTree.getLptr_(this.m_tertiaryHandle);return-1!==s&&this.m_tertiaryStack.push(s),!0}pT_(){if(0===this.m_tertiaryStack.length)return this.m_functionIndex=-1,this.m_currentEndHandle=-1,!1;this.m_tertiaryHandle=this.m_tertiaryStack.at(-1),this.m_tertiaryStack.pop();const t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return-1!==t&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(t),this.m_functionStack[++this.m_functionIndex]=this.all_),-1!==this.m_intervalTree.getLptr_(this.m_tertiaryHandle)&&this.m_tertiaryStack.push(this.m_intervalTree.getLptr_(this.m_tertiaryHandle)),-1!==this.m_intervalTree.getRptr_(this.m_tertiaryHandle)&&this.m_tertiaryStack.push(this.m_intervalTree.getRptr_(this.m_tertiaryHandle)),!0}left_(){return this.m_currentEndHandle=this.m_nextEndHandle,-1!==this.m_currentEndHandle&&Z.isLeft_(this.getCurrentEndIndex_())&&this.m_intervalTree.getValue_(this.getCurrentEndIndex_())<=this.m_query.vmax?(this.m_nextEndHandle=this.getNext_(),!1):(this.m_functionIndex--,!0)}right_(){return this.m_currentEndHandle=this.m_nextEndHandle,-1!==this.m_currentEndHandle&&Z.isRight_(this.getCurrentEndIndex_())&&this.m_intervalTree.getValue_(this.getCurrentEndIndex_())>=this.m_query.vmin?(this.m_nextEndHandle=this.getPrev_(),!1):(this.m_functionIndex--,!0)}all_(){return this.m_currentEndHandle=this.m_nextEndHandle,-1!==this.m_currentEndHandle&&Z.isLeft_(this.getCurrentEndIndex_())?(this.m_nextEndHandle=this.getNext_(),!1):(this.m_functionIndex--,!0)}getNext_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getNext(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getNext(this.m_currentEndHandle)}getPrev_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getPrev(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getPrev(this.m_currentEndHandle)}getCurrentEndIndex_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getElement(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getData(this.m_currentEndHandle)}}class ${constructor(){this.m_tolerance=0,this.m_sweepIndexRed=-1,this.m_sweepIndexBlue=-1,this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_intervalTreeRed=null,this.m_intervalTreeBlue=null,this.m_iteratorRed=null,this.m_iteratorBlue=null,this.m_envelopesRed=[],this.m_envelopesBlue=[],this.m_elementsRed=[],this.m_elementsBlue=[],this.m_sortedEndIndicesRed=new L(0),this.m_sortedEndIndicesBlue=new L(0),this.m_queuedListRed=-1,this.m_queuedListBlue=-1,this.m_queuedEnvelopes=new X,this.m_queuedIndicesRed=[],this.m_queuedIndicesBlue=[],this.m_bAddRed=!1,this.m_bAddBlue=!1,this.m_bAddRedRed=!1,this.m_bDone=!0,this.m_function=this.nullFunc_,this.reset_()}startConstruction(){this.reset_(),this.m_bAddRedRed=!0,this.m_elementsRed.length=0,this.m_envelopesRed.length=0}addEnvelope(t,e){this.m_bAddRedRed||(0,r.p)(""),this.m_elementsRed.push(t),this.m_envelopesRed.push(new i.Envelope2D(e))}endConstruction(){this.m_bAddRedRed||(0,r.p)(""),this.m_bAddRedRed=!1,this.m_envelopesRed.length>0&&(this.m_function=this.initialize_,this.m_bDone=!1)}startRedConstruction(){this.reset_(),this.m_bAddRed=!0,this.m_elementsRed.length=0,this.m_envelopesRed.length=0}addRedEnvelope(t,e){this.m_bAddRed||(0,r.p)(""),this.m_elementsRed.push(t),this.m_envelopesRed.push(e.clone())}endRedConstruction(){this.m_bAddRed||(0,r.p)(""),this.m_bAddRed=!1,this.m_envelopesRed.length>0&&this.m_envelopesBlue.length>0&&(this.m_function===this.nullFunc_||this.m_function===this.initializeBlue_?this.m_function=this.initializeRedBlue_:this.m_function!==this.initializeRedBlue_&&(this.m_function=this.initializeRed_),this.m_bDone=!1)}startBlueConstruction(){this.reset_(),this.m_bAddBlue=!0,this.m_elementsBlue.length=0,this.m_envelopesBlue.length=0}addBlueEnvelope(t,e){this.m_bAddBlue||(0,r.p)(""),this.m_elementsBlue.push(t),this.m_envelopesBlue.push(e.clone())}endBlueConstruction(){this.m_bAddBlue||(0,r.p)(""),this.m_bAddBlue=!1,this.m_envelopesRed.length>0&&this.m_envelopesBlue.length>0&&(this.m_function===this.nullFunc_||this.m_function===this.initializeRed_?this.m_function=this.initializeRedBlue_:this.m_function!==this.initializeRedBlue_&&(this.m_function=this.initializeBlue_),this.m_bDone=!1)}next(){if(this.m_bDone)return!1;for(;this.m_function(););return!this.m_bDone}getHandleA(){return this.m_envelopeHandleA}getHandleB(){return this.m_envelopeHandleB}setTolerance(t){this.m_tolerance=t}getElement(t){return this.m_elementsRed[t]}getRedEnvelope(t){return this.m_envelopesRed[t]}getBlueEnvelope(t){return this.m_envelopesBlue[t]}getRedElement(t){return this.m_elementsRed[t]}getBlueElement(t){return this.m_elementsBlue[t]}isTop_(t){return!(1&~t)}isBottom_(t){return!(1&t)}reset_(){this.m_bAddRed=!1,this.m_bAddBlue=!1,this.m_bAddRedRed=!1,this.m_sweepIndexRed=-1,this.m_sweepIndexBlue=-1,this.m_queuedListRed=-1,this.m_queuedListBlue=-1,this.m_bDone=!0}initialize_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new Z(!0)),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),null===this.m_iteratorRed&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),this.m_sortedEndIndicesRed.resize(0);for(let t=0;t<2*this.m_envelopesRed.length;t++)this.m_sortedEndIndicesRed.add(t);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,2*this.m_envelopesRed.length,!0),this.m_sweepIndexRed=2*this.m_envelopesRed.length,this.m_function=this.sweep_,!0}initializeRed_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new Z(!0)),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),null===this.m_iteratorRed&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),this.m_sortedEndIndicesRed.resize(0);for(let t=0;t<2*this.m_envelopesRed.length;t++)this.m_sortedEndIndicesRed.add(t);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,this.m_sortedEndIndicesRed.size(),!0),this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),-1!==this.m_queuedListRed&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),this.m_function=this.sweepRedBlue_,this.resetBlue_()}initializeBlue_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeBlue||(this.m_intervalTreeBlue=new Z(!0)),this.m_intervalTreeBlue.addEnvelopesRef(this.m_envelopesBlue),null==this.m_iteratorBlue&&(this.m_iteratorBlue=this.m_intervalTreeBlue.getIterator()),this.m_sortedEndIndicesBlue.resize(0);for(let t=0;t<2*this.m_envelopesBlue.length;t++)this.m_sortedEndIndicesBlue.add(t);return this.sortYEndIndices_(this.m_sortedEndIndicesBlue,0,this.m_sortedEndIndicesBlue.size(),!1),this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),-1!==this.m_queuedListBlue&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_function=this.sweepRedBlue_,this.resetRed_()}initializeRedBlue_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new Z(!0)),this.m_intervalTreeBlue||(this.m_intervalTreeBlue=new Z(!0)),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),this.m_intervalTreeBlue.addEnvelopesRef(this.m_envelopesBlue),null===this.m_iteratorRed&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),null===this.m_iteratorBlue&&(this.m_iteratorBlue=this.m_intervalTreeBlue.getIterator()),this.m_sortedEndIndicesRed.resize(0),this.m_sortedEndIndicesBlue.resize(0);for(let t=0;t<2*this.m_envelopesRed.length;t++)this.m_sortedEndIndicesRed.add(t);for(let t=0;t<2*this.m_envelopesBlue.length;t++)this.m_sortedEndIndicesBlue.add(t);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,this.m_sortedEndIndicesRed.size(),!0),this.sortYEndIndices_(this.m_sortedEndIndicesBlue,0,this.m_sortedEndIndicesBlue.size(),!1),this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),-1!==this.m_queuedListRed&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),-1!==this.m_queuedListBlue&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_function=this.sweepRedBlue_,!0}sweep_(){const t=this.m_sortedEndIndicesRed.read(--this.m_sweepIndexRed),e=t>>1;if(this.isBottom_(t))return this.m_intervalTreeRed.remove(e),0!==this.m_sweepIndexRed||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);const s=n.E.construct(this.m_envelopesRed[e].xmin,this.m_envelopesRed[e].xmax);return this.m_iteratorRed.resetIterator(s,this.m_tolerance),this.m_envelopeHandleA=e,this.m_function=this.iterate_,!0}sweepBruteForce_(){return-1==--this.m_sweepIndexRed?(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1):(this.m_envelopeHandleA=this.m_sweepIndexRed,this.m_sweepIndexBlue=this.m_sweepIndexRed,this.m_function=this.iterateBruteForce_,!0)}sweepRedBlueBruteForce_(){return-1==--this.m_sweepIndexRed?(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1):(this.m_envelopeHandleA=this.m_sweepIndexRed,this.m_sweepIndexBlue=this.m_envelopesBlue.length,this.m_function=this.iterateRedBlueBruteForce_,!0)}sweepRedBlue_(){const t=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed-1),e=this.m_sortedEndIndicesBlue.read(this.m_sweepIndexBlue-1),s=this.getAdjustedValue_(t,!0),n=this.getAdjustedValue_(e,!1);return s>n?this.sweepRed_():s<n?this.sweepBlue_():this.isTop_(t)?this.sweepRed_():this.isTop_(e)?this.sweepBlue_():this.sweepRed_()}sweepRed_(){const t=this.m_sortedEndIndicesRed.read(--this.m_sweepIndexRed),e=t>>1;if(this.isBottom_(t))return-1!==this.m_queuedListRed&&-1!==this.m_queuedIndicesRed[e]?(this.m_queuedEnvelopes.deleteElement(this.m_queuedListRed,this.m_queuedIndicesRed[e]),this.m_queuedIndicesRed[e]=-1):this.m_intervalTreeRed.remove(e),0!==this.m_sweepIndexRed||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);if(-1!==this.m_queuedListBlue&&this.m_queuedEnvelopes.getListSize(this.m_queuedListBlue)>0){let t=this.m_queuedEnvelopes.getFirst(this.m_queuedListBlue);for(;-1!==t;){const e=this.m_queuedEnvelopes.getData(t);this.m_intervalTreeBlue.insert(e),this.m_queuedIndicesBlue[e]=-1;const s=this.m_queuedEnvelopes.getNext(t);this.m_queuedEnvelopes.deleteElement(this.m_queuedListBlue,t),t=s}}if(this.m_intervalTreeBlue.size()>0){const t=n.E.construct(this.m_envelopesRed[e].xmin,this.m_envelopesRed[e].xmax);this.m_iteratorBlue.resetIterator(t,this.m_tolerance),this.m_envelopeHandleA=e,this.m_function=this.iterateBlue_}else-1===this.m_queuedListRed&&((0,n.w)(this.m_queuedIndicesRed,this.m_envelopesRed.length,-1),this.m_queuedListRed=this.m_queuedEnvelopes.createList(1)),this.m_queuedIndicesRed[e]=this.m_queuedEnvelopes.addElement(this.m_queuedListRed,e),this.m_function=this.sweepRedBlue_;return!0}sweepBlue_(){const t=this.m_sortedEndIndicesBlue.read(--this.m_sweepIndexBlue),e=t>>1;if(this.isBottom_(t))return-1!==this.m_queuedListBlue&&-1!==this.m_queuedIndicesBlue[e]?(this.m_queuedEnvelopes.deleteElement(this.m_queuedListBlue,this.m_queuedIndicesBlue[e]),this.m_queuedIndicesBlue[e]=-1):this.m_intervalTreeBlue.remove(e),0!==this.m_sweepIndexBlue||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);if(-1!==this.m_queuedListRed&&this.m_queuedEnvelopes.getListSize(this.m_queuedListRed)>0){let t=this.m_queuedEnvelopes.getFirst(this.m_queuedListRed);for(;-1!==t;){const e=this.m_queuedEnvelopes.getData(t);this.m_intervalTreeRed.insert(e),this.m_queuedIndicesRed[e]=-1;const s=this.m_queuedEnvelopes.getNext(t);this.m_queuedEnvelopes.deleteElement(this.m_queuedListRed,t),t=s}}if(this.m_intervalTreeRed.size()>0){const t=n.E.construct(this.m_envelopesBlue[e].xmin,this.m_envelopesBlue[e].xmax);this.m_iteratorRed.resetIterator(t,this.m_tolerance),this.m_envelopeHandleB=e,this.m_function=this.iterateRed_}else-1===this.m_queuedListBlue&&((0,n.w)(this.m_queuedIndicesBlue,this.m_envelopesBlue.length,-1),this.m_queuedListBlue=this.m_queuedEnvelopes.createList(0)),this.m_queuedIndicesBlue[e]=this.m_queuedEnvelopes.addElement(this.m_queuedListBlue,e),this.m_function=this.sweepRedBlue_;return!0}iterate_(){if(this.m_envelopeHandleB=this.m_iteratorRed.next(),-1!==this.m_envelopeHandleB)return!1;const t=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed)>>1;return this.m_intervalTreeRed.insert(t),this.m_function=this.sweep_,!0}iterateRed_(){if(this.m_envelopeHandleA=this.m_iteratorRed.next(),-1!==this.m_envelopeHandleA)return!1;this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1;const t=this.m_sortedEndIndicesBlue.read(this.m_sweepIndexBlue)>>1;return this.m_intervalTreeBlue.insert(t),this.m_function=this.sweepRedBlue_,!0}iterateBlue_(){if(this.m_envelopeHandleB=this.m_iteratorBlue.next(),-1!==this.m_envelopeHandleB)return!1;const t=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed)>>1;return this.m_intervalTreeRed.insert(t),this.m_function=this.sweepRedBlue_,!0}iterateBruteForce_(){if(-1==--this.m_sweepIndexBlue)return this.m_function=this.sweepBruteForce_,!0;const t=this.m_envelopesRed[this.m_sweepIndexRed].clone(),e=this.m_envelopesRed[this.m_sweepIndexBlue];return t.inflateCoords(this.m_tolerance,this.m_tolerance),!t.isIntersecting(e)||(this.m_envelopeHandleB=this.m_sweepIndexBlue,!1)}iterateRedBlueBruteForce_(){if(-1==--this.m_sweepIndexBlue)return this.m_function=this.sweepRedBlueBruteForce_,!0;const t=this.m_envelopesRed[this.m_sweepIndexRed].clone(),e=this.m_envelopesBlue[this.m_sweepIndexBlue];return t.inflateCoords(this.m_tolerance,this.m_tolerance),!t.isIntersecting(e)||(this.m_envelopeHandleB=this.m_sweepIndexBlue,!1)}resetRed_(){return this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),this.m_intervalTreeRed.size()>0&&this.m_intervalTreeRed.reset(),-1!==this.m_queuedListRed&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),this.m_bDone=!1,!0}resetBlue_(){return this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),this.m_intervalTreeBlue.size()>0&&this.m_intervalTreeBlue.reset(),-1!==this.m_queuedListBlue&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_bDone=!1,!0}nullFunc_(){return(0,r.d)("should not be called"),!1}sortYEndIndices_(t,e,s,n){const i=this,r={userSort(t,e,s){i.sortYEndIndicesHelper_(s,t,e,n)},getValue:t=>i.getAdjustedValue_(t,n)};(new z).sort(t,e,s,r)}sortYEndIndicesHelper_(t,e,s,n){t.sort(e,s,((t,e)=>{const s=this.getAdjustedValue_(t,n),i=this.getAdjustedValue_(e,n);return s<i||s===i&&this.isBottom_(t)&&this.isTop_(e)?-1:1}))}getAdjustedValue_(t,e){const s=.5*this.m_tolerance;if(e){const e=this.m_envelopesRed[t>>1];return this.isBottom_(t)?e.ymin-s:e.ymax+s}const n=this.m_envelopesBlue[t>>1];return this.isBottom_(t)?n.ymin-s:n.ymax+s}}var K=d;class Q{constructor(t,e){this.tolerance=void 0!==t?t:Number.NaN,this.resolution=void 0!==e?e:Number.NaN}add(t){return new Q(this.tolerance+t,this.resolution)}scale(t){return new Q(this.tolerance*t,this.resolution*t)}total(){return this.tolerance+this.resolution}}function J(t,e,s,i,r){const o=i*i,a=t.sub(e),l=s.sub(e),h=a.sqrLength(),u=l.sqrLength();if(h<=o||u<=o)return!0;const c=(0,n.a)(a.crossProduct(l));return(c<=o*h||c<=o*u)&&a.dotProduct(l)>=0}function tt(t,e,s){return n=>0===s?(n+t)*e:1*(n-t*e)/e}function et(t,e){const s=new i.Envelope2D;return t.queryLooseEnvelope(s),s.mergeEnvelope2D(e),s}function st(t,e){const s=i.Envelope2D.constructEmpty();t.queryLooseEnvelope(s);const n=i.Envelope2D.constructEmpty();return e.queryLooseEnvelope(n),s.mergeEnvelope2D(n),s}function nt(t,e){return(Number.isFinite(t)||Number.isNaN(t))&&(Number.isFinite(e)||Number.isNaN(e))}function it(t,e){return Number.isFinite(t)&&Number.isFinite(e)}function rt(t,e,s){const n=i.Envelope2D.constructEmpty();return n.setFromPoints(t,e),mt(0,null,n.calculateToleranceFromEnvelope(),s,!1)}function ot(t,e,s){return mt(0,t,e.calculateToleranceFromEnvelope(),s,!1)}function at(t,e,s){return mt(1,t,e.calculateToleranceFromEnvelope(),s,!1)}function lt(t,e,s){return at(t,e.queryInterval(1,0),s)}function ht(t,e,s){const n=i.Envelope2D.constructEmpty();return e.queryEnvelope(n),ot(t,n,s)}function ut(t,e,s=!1){return mt(0,t,e.calculateToleranceFromEnvelope(),s,!0).total()}function ct(t,e,s){const n=i.Envelope2D.constructEmpty();return e.queryEnvelope(n),ut(t,n,s)}function mt(t,e,s,n,i){const r=new Q(0,0);if(null!==e&&(r.tolerance=e.getTolerance(t),(!i||n)&&null!==e)){const s=e.getResolution(t);r.resolution=s,n&&(r.resolution*=2)}return n&&(s*=4,r.tolerance*=1.01,r.resolution*=1.01),r.total()<s?new Q(s,0):r}function dt(t){return Math.sqrt(2)*(2*t.tolerance+t.resolution)}function gt(t){return Math.sqrt(2)*(t.tolerance+t.resolution)}function pt(t){return t>=3}function _t(t,e){return t.getImpl().getIsSimple(e,[0])>=3}function ft(t,e){t.getImpl().setIsSimple(3,e)}function yt(t,e,s,i){if((0,n.a)(e.x-t.x)+(0,n.a)(e.y-t.y)<=s*s){const s=t.z,r=e.z;return(0,n.G)(s,r,i)}return!1}function xt(t){return t>=4}function vt(t,e){return t===r.G.enumPolygon?pt(e):e>=1}function bt(t,e,s){const n=i.Envelope2D.constructEmpty(),r=i.Envelope2D.constructEmpty();t.queryLooseEnvelope(n),e.queryLooseEnvelope(r),n.inflateCoords(s,s),r.inflateCoords(s,s);const o=i.Envelope2D.constructEmpty();o.setCoords({env2D:n}),o.intersect(r);const a=t.querySegmentIterator(),l=e.querySegmentIterator(),h=i.Envelope2D.constructEmpty(),u=i.Envelope2D.constructEmpty(),c=new $;c.setTolerance(s);let m=!1;for(c.startRedConstruction();a.nextPath();)for(;a.hasNextSegment();)a.nextSegment().queryLooseEnvelope(h),h.isIntersecting(o)&&(m=!0,c.addRedEnvelope(a.getStartPointIndex(),h));if(c.endRedConstruction(),!m)return null;let d=!1;for(c.startBlueConstruction();l.nextPath();)for(;l.hasNextSegment();)l.nextSegment().queryLooseEnvelope(u),u.isIntersecting(o)&&(d=!0,c.addBlueEnvelope(l.getStartPointIndex(),u));return c.endBlueConstruction(),d?c:null}function Pt(t,e,s,n,r){t.getGeometryType(),e.getGeometryType();const o=i.Envelope2D.constructEmpty(),a=i.Envelope2D.constructEmpty();t.queryLooseEnvelope(o),e.queryLooseEnvelope(a),o.inflateCoords(s,s),a.inflateCoords(s,s);const l=i.Envelope2D.constructEmpty();l.setCoords({env2D:o}),l.intersect(a);const h=new $;h.setTolerance(s);let u=!1;h.startRedConstruction();for(let i=0,m=t.getPathCount();i<m;i++)t.queryLoosePathEnvelope(i,o),o.isIntersecting(l)&&(u=!0,h.addRedEnvelope(i,o));if(h.endRedConstruction(),!u)return null;let c=!1;h.startBlueConstruction();for(let i=0,m=e.getPathCount();i<m;i++)e.queryLoosePathEnvelope(i,a),a.isIntersecting(l)&&(c=!0,h.addBlueEnvelope(i,a));return h.endBlueConstruction(),c?h:null}function St(t,e,s){const n=i.Envelope2D.constructEmpty(),r=i.Envelope2D.constructEmpty();t.queryLooseEnvelope(n),e.queryEnvelope(r),n.inflateCoords(s,s),r.inflateCoords(s,s);const o=i.Envelope2D.constructEmpty();o.setCoords({env2D:n}),o.intersect(r);const a=t.querySegmentIterator(),l=new $;l.setTolerance(s);let h=!1;for(l.startRedConstruction();a.nextPath();)for(;a.hasNextSegment();)a.nextSegment().queryLooseEnvelope(n),n.isIntersecting(o)&&(h=!0,l.addRedEnvelope(a.getStartPointIndex(),n));if(l.endRedConstruction(),!h)return null;let u=!1;l.startBlueConstruction();for(let c=0,m=e.getPointCount();c<m;c++){const t=e.getXY(c);o.contains(t)&&(u=!0,l.addBlueEnvelope(c,i.Envelope2D.construct(t.x,t.y,t.x,t.y)))}return l.endBlueConstruction(),u?l:null}function Et(t,e,s){const r=i.Envelope2D.constructEmpty(),o=i.Envelope2D.constructEmpty();t.queryEnvelope(r),e.queryEnvelope(o),r.inflateCoords(s,s),o.inflateCoords(s,s);const a=i.Envelope2D.constructEmpty();a.setCoords({env2D:r}),a.intersect(o);const l=new $;l.setTolerance(s);let h=!1;l.startRedConstruction();const u=new n.P;for(let n=0,d=t.getPointCount();n<d;n++)t.queryXY(n,u),a.contains(u)&&(h=!0,l.addRedEnvelope(n,i.Envelope2D.construct(u.x,u.y,u.x,u.y)));if(l.endRedConstruction(),!h)return null;let c=!1;l.startBlueConstruction();const m=new n.P;for(let n=0,d=e.getPointCount();n<d;n++)e.queryXY(n,m),a.contains(m)&&(c=!0,l.addBlueEnvelope(n,i.Envelope2D.construct(m.x,m.y,m.x,m.y)));return l.endBlueConstruction(),c?l:null}function Ct(t){const e=new i.Envelope2D;return t.queryLooseEnvelope(e),e.inflateCoords(1,1),function(t,e){const s=new i.Envelope2D;if(t.queryLooseEnvelope(s),s.isEmpty())return null;t.getGeometryType();const n=new q(s,8);let o=-1;const a=new i.Envelope2D;let l=!1;do{for(let i=0,h=t.getPathCount();i<h;i++)if(t.queryLoosePathEnvelope(i,a),a.isIntersecting(e)){if(o=n.insertEx(i,a,o),-1===o){l&&(0,r.d)("build_quad_tree_for_paths"),s.assign(t.calculateEnvelope2D(!1)),l=!0,n.reset(s,8);break}l=!1}}while(l);return n}(t,e)}function wt(t,e){if(!e){const e=new i.Envelope2D;t.queryLooseEnvelope(e);const s=new q(e,8);let n=-1;const o=new i.Envelope2D,a=t.querySegmentIterator();let l=!1;for(;a.nextPath();)for(;a.hasNextSegment();){const i=a.nextSegment(),h=a.getStartPointIndex();if(i.queryLooseEnvelope(o),n=s.insertEx(h,o,n),-1===n){l&&(0,r.d)(""),e.assign(t.calculateEnvelope2D(!1)),l=!0,s.reset(e,8),a.resetToFirstPath();break}}return s}const s=new i.Envelope2D;t.queryLooseEnvelope(s);const n=new q(s,8);let o=-1;const a=new i.Envelope2D,l=t.querySegmentIterator();let h=!1;for(;l.nextPath();)for(;l.hasNextSegment();){const i=l.nextSegment(),u=l.getStartPointIndex();if(i.queryLooseEnvelope(a),a.isIntersecting(e)&&(o=n.insertEx(u,a,o),-1===o)){h&&(0,r.d)(""),s.assign(t.calculateEnvelope2D(!1)),h=!0,n.reset(s,8),l.resetToFirstPath();break}}return n}function It(t,e){if(e){const s=new q(e,8),o=new n.P,a=new i.Envelope2D;let l=!1;for(let n=0;n<t.getPointCount();n++)o.setCoordsPoint2D(t.getXY(n)),e.contains(o)&&(a.setCoords({pt:o}),-1!==s.insert(n,a)||(l&&(0,r.d)(""),l=!0,s.reset(t.calculateEnvelope2D(),8),n=-1));return s}return(0,r.t)("no-extent version not yet impl"),null}function Tt(t,e,s,n,i){let r=!1;const o=i.vmin,a=i.vmax;for(let l=s;l<e;l+=n){const e=t.read(l);e<o?(r=!0,t.write(l,o)):e>a&&(r=!0,t.write(l,a))}return r}function At(t,e,s,n){if(!t.hasAttribute(s))return!1;const i=t.getGeometryType();if(i===r.G.enumGeometryCollection){const i=t,r=i.getGeometryCount();let o=0;for(let t=0;t<r;++t)o|=At(i.getGeometry(t),e,s,n)?1:0;return!!o}if((0,r.i)(i)){const i=t,o=K.getPersistence(s),a=K.getComponentCount(s),l=i.getPointCount();if(1===o){const t=Tt(i.getAttributeStreamRef(s),l*a,n,a,e);return t&&i.notifyModified(),t}if(2===o){const t=Tt(i.getAttributeStreamRef(s),l*a,n,a,e);return t&&i.notifyModified(),t}(0,r.d)("snap_coordinate not implemented")}if(i===r.G.enumEnvelope){const i=t,r=i.queryInterval(s,n);let o=!1;return r.vmin<e.vmin&&(o=!0,r.vmin=e.vmin),r.vmax>e.vmax&&(o=!0,r.vmax=e.vmax),o&&i.setIntervalEnvelope(s,n,r),o}if(i===r.G.enumPoint){const i=t;let r=i.getAttributeAsDbl(s,n),o=!1;return r<e.vmin&&(o=!0,r=e.vmin),r>e.vmax&&(o=!0,r=e.vmax),o&&i.setAttributeBasic(s,n,r),o}if((0,r.f)(i)){const i=t;let r=i.getStartAttributeAsDbl(s,n),o=!1;return r<e.vmin&&(o=!0,r=e.vmin),r>e.vmax&&(o=!0,r=e.vmax),o&&i.setStartAttribute(s,n,r),r=i.getEndAttributeAsDbl(s,n),r<e.vmin&&(o=!0,r=e.vmin),r>e.vmax&&(o=!0,r=e.vmax),o&&i.setEndAttribute(s,n,r),o}(0,r.d)("snap_coordinate not implemented")}var Mt=d;class Dt{constructor(t){if(this.m_description=null,this.x=Number.NaN,this.y=Number.NaN,this.m_attribs=null,t){if(!t.copy)return t.move?(this.m_description=t.move.m_description,t.move.m_description=null,this.m_attribs=t.move.m_attribs,t.move.m_attribs=null,this.x=t.move.x,void(this.y=t.move.y)):t.vd?(this.m_description=t.vd,void(t.attribBuffer?(this.m_attribs=t.attribBuffer,t.initDefaultValues&&this.setDefaultAttributeValues()):this.ensureAttributes())):t.pt?(this.m_description=b(),void this.setXY(t.pt)):void("x"in t&&("z"in t?(this.m_description=P(),this.ensureAttributes(),this.setXYZ(new E(t.x,t.y,t.z))):(this.m_description=b(),this.setXYCoords(t.x,t.y))));t.copy.copyTo(this)}else this.m_description=b()}assignCopy(t){return this.m_attribs=null,t.copyTo(this),this}assignMove(t){return this.m_attribs=null,t.copyTo(this),t.setEmpty(),this}getXY(){return new n.P(this.x,this.y)}queryXY(t){t.x=this.x,t.y=this.y}setXY(t){this.x=t.x,this.y=t.y}setXYCoords(t,e){this.x=t,this.y=e}getXYZ(){const t=new E;return t.x=this.x,t.y=this.y,t.z=this.getZ(),t}setXYZ(t){this.addAttribute(1),this.x=t.x,this.y=t.y,this.m_attribs[0]=t.z}getX(){return this.x}setX(t){this.x=t}getY(){return this.y}setY(t){this.y=t}getZ(){return this.m_description.hasZ()?this.m_attribs[0]:Mt.getDefaultValue(1)}setZ(t){this.addAttribute(1),this.m_attribs[0]=t}getM(){return this.getAttributeAsDbl(2,0)}setM(t){this.addAttribute(2),this.m_description.hasZ()?this.m_attribs[1]=t:this.m_attribs[0]=t}getID(){return this.getAttributeAsInt(3,0)}setID(t){this.setAttributeBasic(3,0,t)}isEqualXY(t,e){return void 0===e&&(e=0),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e}isEqualXYCoords(t,e,s){return void 0===s&&(s=0),Math.abs(t-this.x)<=s&&Math.abs(e-this.y)<=s}getAttributeAsDbl(t,e){if(0===t){if(0===e)return this.x;if(1===e)return this.y;(0,r.q)("")}const s=Mt.getComponentCount(t);(e<0||e>=s)&&(0,r.q)("");const n=this.m_description.getAttributeIndex(t);return n>=0?this.m_attribs[this.m_description.getPointAttributeOffset(n)-2+e]:Mt.getDefaultValue(t)}getAttributeAsInt(t,e){return Math.trunc(this.getAttributeAsDbl(t,e))}setAttributeBasic(t,e,s){if(0===t)return void(0===e?this.x=s:1===e?this.y=s:(0,r.q)(""));const n=Mt.getComponentCount(t);(e<0||e>=n)&&(0,r.q)("");let i=this.m_description.getAttributeIndex(t);i<0&&(this.addAttribute(t),i=this.m_description.getAttributeIndex(t)),this.m_attribs[this.m_description.getPointAttributeOffset(i)-2+e]=s}copyAttributesFrom(t,e){if(this===t)return;const s=t.getDescription();for(let n=e&&s.hasZ()?2:1,i=s.getAttributeCount();n<i;++n){const e=s.getSemantics(n),i=Mt.getComponentCount(e);for(let s=0;s<i;++s){const n=t.getAttributeAsDbl(e,s);this.setAttributeBasic(e,s,n)}}}getAttributeArray(){return this.m_attribs}getDescription(){return this.m_description}assignVertexDescription(t){this.m_description!==t&&this.assignVertexDescriptionImpl(t)}mergeVertexDescription(t){this.m_description!==t&&(this.m_description.hasAttributesFrom(t)||this.mergeVertexDescriptionImpl(t))}hasAttribute(t){return this.m_description.hasAttribute(t)}addAttribute(t){if(this.m_description.hasAttribute(t))return;const e=x(this.m_description,t);this.assignVertexDescription(e)}dropAttribute(t){if(!this.m_description.hasAttribute(t))return;const e=v(this.m_description,t);this.assignVertexDescription(e)}dropAllAttributes(){const t=b();t!==this.m_description&&this.assignVertexDescription(t)}getGeometryType(){return r.G.enumPoint}getDimension(){return 0}queryEnvelope(t){if(t instanceof kt)return t.setEmpty(),t.assignVertexDescription(this.m_description),void t.merge(this);if(t instanceof C){if(this.isEmpty())return void t.setEmpty();const e=this.getXYZ();return t.xmin=e.x,t.ymin=e.y,t.zmin=e.z,t.xmax=e.x,t.ymax=e.y,void(t.zmax=e.z)}this.isEmpty()?t.setEmpty():(t.xmin=this.x,t.ymin=this.y,t.xmax=this.x,t.ymax=this.y)}queryLooseEnvelope(t){this.queryEnvelope(t)}queryInterval(t,e){const s=new n.E;if(this.isEmpty())return s.setEmpty(),s;const i=this.getAttributeAsDbl(t,e);return s.vmin=i,s.vmax=i,s}applyTransformation(t){if(!this.isEmpty()){if(1===t.m_TransformationType){const e=this.getXY();return t.transformInPlace(e),void this.setXY(e)}(0,r.t)("3d not impl")}}transformAttribute(t,e,s,n,i){if(this.isEmpty())return;this.addAttribute(t);const r=this.getAttributeAsDbl(t,e),o=tt(s,n,i);this.setAttributeBasic(t,e,o(r))}createInstance(){return new Dt({vd:this.m_description})}copyTo(t){if(this===t)return;t.getGeometryType()!==r.G.enumPoint&&(0,r.a)();const e=t;e.x=this.x,e.y=this.y,this.m_attribs?(e.assignVertexDescription(this.m_description),e.m_attribs=this.m_attribs.slice()):(e.releaseAttributes(),e.assignVertexDescription(this.m_description))}isEmpty(){return Number.isNaN(this.x)||Number.isNaN(this.y)}setEmpty(){this.m_description||(this.m_description=b(),this.releaseAttributes()),this.x=Number.NaN,this.y=Number.NaN,this.m_attribs&&(0,n.b)(this.m_attribs,this.m_description.getDefaultPointAttributes(),0,2,this.m_description.getTotalComponentCount()-2)}calculateArea2D(){return 0}calculateLength2D(){return 0}calculateLength3D(t){return 0}equals(t,e){if(t===this)return!0;if(t.getGeometryType()!==r.G.enumPoint)return!1;const s=t;if(this.m_description!==s.m_description)return!1;if(this.isEmpty()!==s.isEmpty())return!1;if(this.isEmpty())return!0;if(void 0===e&&(e=0),Math.abs(this.x-s.x)>e)return!1;if(Math.abs(this.y-s.y)>e)return!1;for(let i=0,r=this.m_description.getTotalComponentCount()-2;i<r;i++)if(!(0,n.G)(this.m_attribs[i],s.m_attribs[i],e))return!1;return!0}getBoundary(){return null}clone(){const t=new Dt({vd:this.m_description});return this.copyTo(t),t}swap(t){if(this===t)return;t.getGeometryType()!==r.G.enumPoint&&(0,r.a)("wrong geometry type");const e=t;e.m_description=(0,n.c)(this.m_description,this.m_description=e.m_description),e.x=(0,n.c)(this.x,this.x=e.x),e.y=(0,n.c)(this.y,this.y=e.y),e.m_attribs=(0,n.c)(this.m_attribs,this.m_attribs=e.m_attribs)}replaceNaNs(t,e){if(this.addAttribute(t),this.isEmpty())return;const s=Mt.getComponentCount(t);for(let n=0;n<s;n++){const s=this.getAttributeAsDbl(t,n);Number.isNaN(s)&&this.setAttributeBasic(t,n,e)}}lerp(t,e,s){if(t.getDescription()!==e.getDescription()&&(0,r.a)("Point.lerp"),this.assignVertexDescription(t.getDescription()),t.isEmpty()||e.isEmpty())return this.setEmpty(),this;this.ensureAttributes();const i=m();t.queryValues(i,i.length);const o=m();e.queryValues(o,o.length);const a=m();let l=i,h=o;const u=a;let c=0;for(let r=0,m=this.m_description.getAttributeCount();r<m;r++){const t=this.m_description.getSemantics(r),e=Mt.getInterpolation(t),i=Mt.getComponentCount(t),o=Mt.getDefaultValue(t);(0,n.A)(e,l,h,u,c,i,s,o),l=l.slice(i),h=h.slice(i),c+=i}return this.setValues(a,c),this}static lerp(t,e,s,n){n.lerp(t,e,s)}setDefaultAttributeValues(){const t=this.m_description.getTotalComponentCount()-2;t>0&&(this.m_attribs?(0,n.b)(this.m_attribs,this.m_description.getDefaultPointAttributes(),0,2,t):this.m_attribs=this.m_description.getDefaultPointAttributes().slice(2))}static sqrDistance2D(t,e){return n.P.sqrDistanceCoords(t.x,t.y,e.x,e.y)}getImpl(){return this}mergeVertexDescriptionImpl(t){const e=y(this.getDescription(),t);this.assignVertexDescription(e)}releaseAttributes(){this.m_attribs=null}assignVertexDescriptionImpl(t){this.m_description||(this.m_description=b());const e=p();S(t,this.m_description,e);let s=null;t.getTotalComponentCount()-2>0&&(s=t.getDefaultPointAttributes().slice(2));for(let n=1,i=t.getAttributeCount();n<i;n++){const i=e[n];if(-1!==i){const e=this.m_description.getPointAttributeOffset(i)-2,r=t.getPointAttributeOffset(n)-2,o=Mt.getComponentCount(t.getSemantics(n));for(let t=0;t<o;t++)s[r+t]=this.m_attribs[e+t]}}this.m_attribs=s,this.m_description=t}ensureAttributes(){this.m_description.getTotalComponentCount()-2>0&&null===this.m_attribs&&(this.m_attribs=this.m_description.getDefaultPointAttributes().slice(2))}queryValues(t,e){const s=this.m_description.getTotalComponentCount();(0,r.g)(s<=e),t[0]=this.x,t[1]=this.y,(0,n.b)(t,this.m_attribs,2,0,s-2)}copyCommonAttributesTo(t){t.x=this.x,t.y=this.y;const e=t.getDescription();if(e===this.m_description)this.m_attribs&&(0,n.b)(t.m_attribs,this.m_attribs,0,0,this.m_description.getTotalComponentCount()-2);else{let s=0;for(let n=1,i=e.getAttributeCount();n<i;n++){const i=e.getSemantics(n);let r=Mt.getComponentCount(i);if(this.m_description.hasAttribute(i)){let e=this.m_description.getPointAttributeOffset(this.m_description.getAttributeIndex(i))-2;for(;0!==r;)t.m_attribs[s++]=this.m_attribs[e++],r--}else{const e=Mt.getDefaultValue(i);for(;0!==r;)t.m_attribs[s++]=e,r--}}}}setValues(t,e){const s=this.m_description.getTotalComponentCount();(0,r.g)(s<=e),this.x=t[0],this.y=t[1],(0,n.b)(this.m_attribs,t,0,2,s-2)}dbgDefaultAttribs(){}}Dt.type=r.G.enumPoint;var Nt=d;function Ft(t,e){return e*(t.getTotalComponentCount()-2)}class Rt{constructor(t){if(this.m_attributes=null,t)if(void 0!==t.xmin)this.m_envelope2D=new i.Envelope2D(t.xmin,t.ymin,t.xmax,t.ymax);else if(void 0!==t.env2D)this.m_envelope2D=new i.Envelope2D(t.env2D);else if(t.move)this.m_envelope2D=new i.Envelope2D(t.move.m_envelope2D),this.m_attributes=t.move.m_attributes,t.move.m_attributes=null;else{if(!t.moveEnv)throw new Error("unrecognized EnvelopeData constructor options");{const e=t.moveEnv.accessEnvelopeData();this.m_envelope2D=new i.Envelope2D(e.m_envelope2D),this.m_attributes=e.m_attributes,e.m_attributes=null}}else this.m_envelope2D=i.Envelope2D.constructEmpty()}ensureAttributes(t){const e=t.getTotalComponentCount()-2;!this.m_attributes&&e&&(this.m_attributes=(0,n.d)(2*e,Number.NaN),this.m_attributes.fill(Number.NaN))}copyTo(t,e){const s=e,o=t.getTotalComponentCount()-2;if(s.m_description!==t&&(s.releaseAttributes_(),s.m_description=t,o&&(s.m_data.m_attributes=(0,n.d)(2*o,Number.NaN))),o){(0,r.g)(this.m_attributes&&s.m_data.m_attributes);const t=2*o;(0,n.b)(s.m_data.m_attributes,this.m_attributes,0,0,t)}s.m_data.m_envelope2D=new i.Envelope2D(this.m_envelope2D)}copyToIfNotNull(t,e){e.m_envelope2D=new i.Envelope2D(this.m_envelope2D),e.releaseAttributes(),t.getTotalComponentCount()-2&&this.m_attributes&&(e.m_attributes=this.m_attributes.slice())}releaseAttributes(){this.m_attributes=null}isEmpty(){return this.m_envelope2D.isEmpty()}transformAttribute(t,e,s,n,i){(0,r.g)(0)}queryInterval(t,e,s,n){if(this.isEmpty())return void n.setEmpty();if(0===e)return void(0===s?this.m_envelope2D.queryIntervalX(n):1===s?this.m_envelope2D.queryIntervalY(n):(0,r.q)(""));const i=Nt.getComponentCount(e);(s<0||s>=i)&&(0,r.q)("");const o=t.getAttributeIndex(e);if(o>=0)return n.vmin=this.m_attributes[Ft(t,0)+t.getPointAttributeOffset(o)-2+s],void(n.vmax=this.m_attributes[Ft(t,1)+t.getPointAttributeOffset(o)-2+s]);{const t=Nt.getDefaultValue(e);return void n.setCoords(t,t)}}queryEnvelope3D(t,e){const s=new n.E;this.queryInterval(t,1,0,s),e.setCoords(this.m_envelope2D.xmin,this.m_envelope2D.ymin,s.vmin,this.m_envelope2D.xmax,this.m_envelope2D.ymax,s.vmax)}setEmpty(t){this.m_envelope2D.setEmpty();const e=t.getTotalComponentCount()-2;e&&(this.m_attributes?this.dbgAssertSize(e):this.m_attributes=(0,n.d)(2*e,Number.NaN),this.m_attributes.fill(Number.NaN))}dbgAssertSize(t){}}let kt=class t{constructor(t){if(this.m_EnvelopeType=4,this.m_description=b(),void 0===t)this.m_data=new Rt;else if(void 0!==t.vd)this.m_description=t.vd,this.m_data=new Rt,this.ensureAttributes_();else if(t?.env2D)this.m_data=new Rt({env2D:t.env2D});else if(void 0!==t.xmin)this.m_data=new Rt({xmin:t.xmin,ymin:t.ymin,xmax:t.xmax,ymax:t.ymax});else if(t.copy)this.m_data=new Rt,t.copy.copyTo(this);else if(t.move)this.m_description=t.move.m_description,t.move.m_description=null,this.m_data=new Rt({move:t.move.m_data});else{if(!t.centerPoint)throw new Error("unrecognized Envelope constructor options");this.m_description=t.centerPoint.getDescription(),this.m_data=new Rt,this.ensureAttributes_(),this.setFromPoint(t.centerPoint,t.width,t.height)}}accessEnvelopeData(){return this.m_description=null,this.m_data}assignMove(t){return this===t||(this.m_description=t.m_description,t.m_description=null,this.m_data=new Rt({move:t.m_data})),this}assignCopy(t){return this===t||t.copyTo(this),this}transformAttribute(t,e,s,n,i){(0,r.g)(0)}setAttributeBasic(t,e,s){if(this.addAttribute(t),this.m_data.isEmpty())return;const n=this.queryInterval(t,e);n.vmin=s,n.vmax=s,this.setIntervalEnvelope(t,e,n)}mergeVertexDescriptionImpl(t){const e=y(this.getDescription(),t);this.assignVertexDescription(e)}asEnvelope2D(){return new i.Envelope2D(this.m_data.m_envelope2D)}assignVertexDescription(t){this.m_description!==t&&this.assignVertexDescriptionImpl(t)}getGeometryType(){return r.G.enumEnvelope}getDimension(){return 2}getXMin(){return this.m_data.m_envelope2D.xmin}getYMin(){return this.m_data.m_envelope2D.ymin}getXMax(){return this.m_data.m_envelope2D.xmax}getYMax(){return this.m_data.m_envelope2D.ymax}width(){return this.m_data.isEmpty()?Number.NaN:this.m_data.m_envelope2D.width()}height(){return this.m_data.isEmpty()?Number.NaN:this.m_data.m_envelope2D.height()}getCenterXY(){return this.m_data.isEmpty()?new n.P:this.m_data.m_envelope2D.getCenter()}getCenter(t){if(t.assignVertexDescription(this.m_description),this.m_data.isEmpty())return void t.setEmpty();const e=this.m_description.getAttributeCount();for(let s=1;s<e;s++){const e=this.m_description.getSemantics(s),n=Nt.getComponentCount(e);for(let s=0;s<n;s++){const n=.5*(this.getAttributeAsDblImpl(0,e,s)+this.getAttributeAsDblImpl(1,e,s));t.setAttributeBasic(e,s,n)}}t.setXY(this.m_data.m_envelope2D.getCenter())}setCoords(t,e,s,n){this.m_data.m_envelope2D.setCoords({xmin:t,ymin:e,xmax:s,ymax:n})}setEnvelope(t){if(t instanceof i.Envelope2D)this.m_data.m_envelope2D=new i.Envelope2D(t),this.m_data.m_envelope2D.normalize();else{this.addAttribute(1),this.m_data.m_envelope2D=t.getEnvelope2D(),this.m_data.m_envelope2D.normalize();const e=n.E.constructEmpty();e.setCoords(t.zmin,t.zmax),this.setInterval(1,0,e.vmin,e.vmax)}}merge(e){if(e instanceof i.Envelope2D)return e.isValid()||(0,r.a)(""),void this.m_data.m_envelope2D.mergeEnvelope2D(e);if(e instanceof t){if(e.m_data.isEmpty())return;const t=e.getDescription();this.mergeVertexDescription(t),this.m_data.m_envelope2D.mergeEnvelope2D(e.m_data.m_envelope2D);for(let s=1,n=t.getAttributeCount();s<n;s++){const n=t.getSemantics(s),i=Nt.getComponentCount(n);for(let t=0;t<i;t++){const s=e.queryInterval(n,t),i=this.queryInterval(n,t);i.merge(s),this.setIntervalEnvelope(n,t,i)}}}else if(e instanceof Dt){const t=e;if(t.isEmpty())return;const s=t.getDescription();if(this.mergeVertexDescription(s),this.m_data.isEmpty())return void this.setFromPoint(t);this.m_data.m_envelope2D.merge(t.getXY());for(let e=1,n=s.getAttributeCount();e<n;e++){const n=s.getSemantics(e),i=Nt.getComponentCount(n);for(let e=0;e<i;e++){const s=t.getAttributeAsDbl(n,e),i=this.queryInterval(n,e);i.mergeCoordinate(s),this.setIntervalEnvelope(n,e,i)}}}else(0,r.t)("unrecognized type for envelope.merge")}intersect(t){if(!this.m_data.m_envelope2D.intersect(t.m_data.m_envelope2D))return this.setEmpty(),!1;const e=t.getDescription();this.mergeVertexDescription(e);for(let s=1,n=this.m_description.getAttributeCount();s<n;s++){const e=this.m_description.getSemantics(s),n=Nt.getComponentCount(e);for(let s=0;s<n;s++){const n=t.queryInterval(e,s),i=this.queryInterval(e,s);i.intersect(n),this.setIntervalEnvelope(e,s,i)}}return!0}intersectCommonAttributes(t){if(!this.m_data.m_envelope2D.intersect(t.m_data.m_envelope2D))return this.setEmpty(),!1;const e=t.getDescription();for(let s=1,n=this.m_description.getAttributeCount();s<n;s++){const n=this.m_description.getSemantics(s);if(!e.hasAttribute(n))continue;const i=Nt.getComponentCount(n);for(let e=0;e<i;e++){const s=t.queryInterval(n,e),i=this.queryInterval(n,e);i.intersect(s),this.setIntervalEnvelope(n,e,i)}}return!0}move(t,e){this.m_data.m_envelope2D.move(t,e)}centerAt(t,e){this.m_data.m_envelope2D.centerAtCoords(t,e)}centerAtPoint(t){this.m_data.m_envelope2D.centerAt(t)}reaspect(t,e){this.m_data.m_envelope2D.reaspect(t,e)}inflateCoords(t,e){this.m_data.m_envelope2D.inflateCoords(t,e)}containsCoords(t,e){return this.m_data.m_envelope2D.containsCoords(t,e)}contains(t){return this.m_data.m_envelope2D.contains(t)}containsPoint(t){return!t.isEmpty()&&this.m_data.m_envelope2D.contains(t.getXY())}containsEnvelope(t){return this.m_data.m_envelope2D.containsEnvelope(t.m_data.m_envelope2D)}setIntervalEnvelope(t,e,s){if(this.addAttribute(t),this.m_data.isEmpty())return;const i=new n.E(s);if(i.normalize(),0===t){if(i.isEmpty())return void this.setEmpty();0===e?(this.m_data.m_envelope2D.xmin=i.vmin,this.m_data.m_envelope2D.xmax=i.vmax):1===e?(this.m_data.m_envelope2D.ymin=i.vmin,this.m_data.m_envelope2D.ymax=i.vmax):(0,r.q)("")}else this.setAttributeAsDblImpl(0,t,e,i.vmin),this.setAttributeAsDblImpl(1,t,e,i.vmax)}setInterval(t,e,s,i){this.setIntervalEnvelope(t,e,new n.E(s,i))}queryInterval(t,e){const s=new n.E;return this.m_data.queryInterval(this.m_description,t,e,s),s}queryEnvelope(t){2!==t.m_EnvelopeType?3!==t.m_EnvelopeType?4!==t.m_EnvelopeType?(0,r.t)("unrecognized type for queryEnveloper"):this.copyTo(t):this.m_data.queryEnvelope3D(this.m_description,t):t.setCoords({env2D:this.m_data.m_envelope2D})}applyTransformation(t){1!==t.m_TransformationType?(0,r.g)(0):t.transformEnvInPlace(this.m_data.m_envelope2D)}createInstance(){return new t({vd:this.m_description})}copyTo(t){t!==this&&this.m_data.copyTo(this.m_description,t)}isEmpty(){return this.m_data.isEmpty()}setEmpty(){this.m_description||(this.m_description=b()),this.m_data.setEmpty(this.m_description)}calculateArea2D(){return this.m_data.m_envelope2D.getArea()}calculateLength2D(){return this.m_data.m_envelope2D.getLength()}calculateLength3D(t){return(0,r.g)(0),0}equals(t,e){if(t===this)return!0;const s=t;if(this.m_description!==s.m_description)return!1;if(this.m_data.isEmpty()!==s.m_data.isEmpty())return!1;if(this.m_data.isEmpty())return!0;if(void 0===e&&(e=0),Math.abs(this.m_data.m_envelope2D.xmin-s.m_data.m_envelope2D.xmin)>e)return!1;if(Math.abs(this.m_data.m_envelope2D.ymin-s.m_data.m_envelope2D.ymin)>e)return!1;if(Math.abs(this.m_data.m_envelope2D.xmax-s.m_data.m_envelope2D.xmax)>e)return!1;if(Math.abs(this.m_data.m_envelope2D.ymax-s.m_data.m_envelope2D.ymax)>e)return!1;for(let i=0,r=2*(this.m_description.getTotalComponentCount()-2);i<r;i++)if(!(0,n.G)(this.m_data.m_attributes[i],s.m_data.m_attributes[i],e))return!1;return!0}getBoundary(){return(0,r.t)("getBoundary not available in this context. Use the boundary operator with an envelope parameter"),null}clone(){return new t({copy:this})}swap(t){if(this===t)return;t.getGeometryType()!==r.G.enumEnvelope&&(0,r.a)("wrong geometry type");const e=t;e.m_description=(0,n.c)(this.m_description,this.m_description=e.m_description),e.m_data.m_envelope2D=(0,n.c)(this.m_data.m_envelope2D,this.m_data.m_envelope2D=e.m_data.m_envelope2D),e.m_data.m_attributes=(0,n.c)(this.m_data.m_attributes,this.m_data.m_attributes=e.m_data.m_attributes)}queryCoordinates(t){this.m_data.isEmpty()&&(0,r.a)(""),this.m_data.m_envelope2D.queryCorners(t)}queryCornerByVal(t,e){(t<0||t>3)&&(0,r.q)(""),e.assignVertexDescription(this.m_description);const s=this.getDescription().getAttributeCount();for(let n=1;n<s;n++){const s=this.m_description.getSemantics(n),i=Nt.getComponentCount(s);for(let n=0;n<i;n++)e.setAttributeBasic(s,n,this.getAttributeAsDblImpl(t%2,s,n))}e.setXY(this.m_data.m_envelope2D.queryCorner(t))}queryCorner(t,e){e.assign(this.m_data.m_envelope2D.queryCorner(t))}getDescription(){return this.m_description}mergeVertexDescription(t){this.m_description!==t&&(this.m_description&&this.m_description.hasAttributesFrom(t)||this.mergeVertexDescriptionImpl(t))}hasAttribute(t){return this.m_description.hasAttribute(t)}addAttribute(t){if(this.m_description.hasAttribute(t))return;const e=x(this.m_description,t);this.assignVertexDescription(e)}dropAttribute(t){if(!this.m_description.hasAttribute(t))return;const e=v(this.m_description,t);this.assignVertexDescription(e)}dropAllAttributes(){const t=b();t!==this.m_description&&this.assignVertexDescription(t)}queryLooseEnvelope(t){this.queryEnvelope(t)}replaceNaNs(t,e){if(this.addAttribute(t),this.m_data.isEmpty())return;const s=Nt.getComponentCount(t);for(let n=0;n<s;n++){const s=this.queryInterval(t,n);s.isEmpty()&&(s.vmin=e,s.vmax=e,this.setIntervalEnvelope(t,n,s))}}getImpl(){return this}setFromPoint(t,e,s){this.m_data.m_envelope2D.setCoords({center:t.getXY(),width:e??0,height:s??0});const n=t.getDescription();for(let i=1,r=n.getAttributeCount();i<r;i++){const e=n.getSemantics(i),s=Nt.getComponentCount(e);for(let n=0;n<s;n++){const s=t.getAttributeAsDbl(e,n);this.setInterval(e,n,s,s)}}}assignVertexDescriptionImpl(t){const e=p();S(t,this.m_description,e);let s=null;const i=t.getTotalComponentCount()-2,r=this.m_description?this.m_description.getTotalComponentCount()-2:0;i>0&&(s=(0,n.d)(2*i,Number.NaN));for(let o=1;o<t.getAttributeCount();o++){const a=e[o];if(-1!==a){const e=t.getPointAttributeOffset(o)-2,l=Nt.getComponentCount(t.getSemantics(o)),h=this.m_description.getPointAttributeOffset(a)-2;(0,n.b)(s,this.m_data.m_attributes,e,h,l),(0,n.b)(s,this.m_data.m_attributes,i+e,r+h,l)}}this.releaseAttributes_(),this.m_data.m_attributes=s,this.m_description=t}getAttributeAsDblImpl(t,e,s){if(this.m_data.isEmpty()&&(0,r.u)(""),0===e)return t?s?this.m_data.m_envelope2D.ymax:this.m_data.m_envelope2D.xmax:s?this.m_data.m_envelope2D.ymin:this.m_data.m_envelope2D.xmin;s>=Nt.getComponentCount(e)&&(0,r.q)("");const n=this.m_description.getAttributeIndex(e);return n>=0?this.m_data.m_attributes[Ft(this.m_description,t)+this.m_description.getPointAttributeOffset(n)-2+s]:d.getDefaultValue(e)}setAttributeAsDblImpl(t,e,s,n){0===e&&(t?1===s?this.m_data.m_envelope2D.ymax=n:0===s?this.m_data.m_envelope2D.xmax=n:(0,r.q)(""):1===s?this.m_data.m_envelope2D.ymin=n:0===s?this.m_data.m_envelope2D.xmin=n:(0,r.q)(""));const i=Nt.getComponentCount(e);(s<0||s>=i)&&(0,r.q)(""),this.addAttribute(e);const o=this.m_description.getAttributeIndex(e);this.m_data.m_attributes[Ft(this.m_description,t)+this.m_description.getPointAttributeOffset(o)-2+s]=n}releaseAttributes_(){this.m_data.releaseAttributes()}ensureAttributes_(){this.m_data.ensureAttributes(this.m_description)}};kt.type=r.G.enumEnvelope;Object.freeze(Object.defineProperty({__proto__:null,Envelope:kt,EnvelopeData:Rt},Symbol.toStringTag,{value:"Module"}))},21566:(t,e,s)=>{s.r(e),s.d(e,{Envelope2D:()=>r});var n=s(62188),i=s(86330);class r{static construct(t,e,s,n){return new r(t,e,s,n)}constructor(t,e,s,n){this.m_EnvelopeType=2,void 0===t?(this.xmin=Number.NaN,this.ymin=Number.NaN,this.xmax=Number.NaN,this.ymax=Number.NaN):"number"==typeof t?(this.xmin=t,this.ymin=e,this.xmax=s,this.ymax=n):(this.xmin=t.xmin,this.ymin=t.ymin,this.xmax=t.xmax,this.ymax=t.ymax),this.normalize()}static constructEmpty(){return new r(Number.NaN,Number.NaN,Number.NaN,Number.NaN)}clone(){return new r(this)}assign(t){return this.xmin=t.xmin,this.xmax=t.xmax,this.ymin=t.ymin,this.ymax=t.ymax,this}width(){return this.xmax-this.xmin}height(){return this.ymax-this.ymin}maxDimension(){return Math.max(this.width(),this.height())}minDimension(){return Math.min(this.width(),this.height())}sqrDiagonal(){const t=this.width(),e=this.height();return t*t+e*e}diagonal(){return Math.sqrt(this.sqrDiagonal())}getCenterX(){return.5*(this.xmin+this.xmax)}getCenterY(){return.5*(this.ymin+this.ymax)}getCenter(){return i.P.construct(this.getCenterX(),this.getCenterY())}queryCenter(t){t.x=.5*(this.xmin+this.xmax),t.y=.5*(this.ymin+this.ymax)}setEmpty(){this.xmin=Number.NaN,this.ymin=Number.NaN,this.xmax=Number.NaN,this.ymax=Number.NaN}setInfinite(){this.xmin=Number.NEGATIVE_INFINITY,this.xmax=Number.POSITIVE_INFINITY,this.ymin=Number.NEGATIVE_INFINITY,this.ymax=Number.POSITIVE_INFINITY}isDegenerate(t){return!this.isEmpty()&&(this.width()<=t||this.height()<=t)}isZero(){return!(this.isEmpty()||this.width()&&this.height())}isEmpty(){return Number.isNaN(this.xmin)||Number.isNaN(this.ymin)||Number.isNaN(this.xmax)||Number.isNaN(this.ymax)}mergeNeCoords(t,e){this.xmin>t?this.xmin=t:this.xmax<t&&(this.xmax=t),this.ymin>e?this.ymin=e:this.ymax<e&&(this.ymax=e)}mergeNe(t){this.mergeNeCoords(t.x,t.y)}mergeCoords(t,e){this.isEmpty()?(this.xmin=t,this.ymin=e,this.xmax=t,this.ymax=e):(this.xmin>t?this.xmin=t:this.xmax<t&&(this.xmax=t),this.ymin>e?this.ymin=e:this.ymax<e&&(this.ymax=e))}merge(t){this.mergeCoords(t.x,t.y)}mergeEnvelope2D(t){t.isEmpty()||(this.mergeCoords(t.xmin,t.ymin),this.mergeNeCoords(t.xmax,t.ymax))}mergePoints(t,e){for(let s=0;s<e;){if(!this.isEmpty()){for(let n=s;n<e;n++)this.mergeNe(t[n]);break}this.setCoords(t[s]),s++}}mergePointsInterleaved(t,e,s){for(let n=2*e,i=n+2*s;n<i;n+=2)this.mergeCoords(t.read(n),t.read(n+1))}inflateCoords(t,e){this.isEmpty()||(this.xmin-=t,this.xmax+=t,this.ymin-=e,this.ymax+=e,(this.xmin>this.xmax||this.ymin>this.ymax)&&this.setEmpty())}getInflatedCoords(t,e){const s=this.clone();return s.inflateCoords(t,e),s}inflate(t){this.inflateCoords(t,t)}getInflated(t){const e=this.clone();return e.inflateCoords(t,t),e}zoom(t,e){this.isEmpty()||this.setCoords({center:this.getCenter(),width:t*this.width(),height:e*this.height()})}scale(t){t<0&&this.setEmpty(),this.xmin*=t,this.xmax*=t,this.ymin*=t,this.ymax*=t}equals(t,e){return!(!this.isEmpty()||!t.isEmpty())||(e?Math.abs(this.xmin-t.xmin)<=e&&Math.abs(this.ymin-t.ymin)<=e&&Math.abs(this.xmax-t.xmax)<=e&&Math.abs(this.ymax-t.ymax)<=e:this.xmin===t.xmin&&this.ymin===t.ymin&&this.xmax===t.xmax&&this.ymax===t.ymax)}setCoords(t){void 0!==t.xmin?(this.xmin=t.xmin,this.xmax=t.xmax,this.ymin=t.ymin,this.ymax=t.ymax):void 0!==t.x?(this.xmin=t.x,this.xmax=t.x,this.ymin=t.y,this.ymax=t.y):void 0!==t.pt1?(this.xmin=t.pt1.x,this.ymin=t.pt1.y,this.xmax=t.pt2.x,this.ymax=t.pt2.y,this.normalize()):void 0!==t.env2D?(this.xmin=t.env2D.xmin,this.xmax=t.env2D.xmax,this.ymin=t.env2D.ymin,this.ymax=t.env2D.ymax,this.normalize()):void 0!==t.pt?(this.xmin=t.pt.x,this.xmax=t.pt.x,this.ymin=t.pt.y,this.ymax=t.pt.y):void 0!==t.center?(this.xmin=t.center.x-.5*t.width,this.xmax=this.xmin+t.width,this.ymin=t.center.y-.5*t.height,this.ymax=this.ymin+t.height,this.normalize()):(0,n.t)("unrecognized input type for setCoords"),this.normalize()}queryIntervalX(t){this.isEmpty()?t.setEmpty():t.setCoords(this.xmin,this.xmax)}queryIntervalY(t){this.isEmpty()?t.setEmpty():t.setCoords(this.ymin,this.ymax)}setFromPoints(t,e){if(0===e)return void this.setEmpty();if(Array.isArray(t)){const s=t;this.setCoords(s[0]);for(let t=1;t<e;){if(!this.isEmpty()){for(let n=t;n<e;n++)this.mergeNe(s[n]);return}this.setCoords(s[t]),t++}return}const s=t;this.setCoords({x:s[0],y:s[1]});for(let n=1,i=2*e;n<i;n+=2){if(!this.isEmpty()){for(let t=n,i=2*e;t<i;t+=2)this.mergeNeCoords(s[t],s[t+1]);return}this.setCoords({x:s[n],y:s[n+1]}),n+=2}}normalize(){let t=!1;this.xmin<=this.xmax||([this.xmin,this.xmax]=[this.xmax,this.xmin],t=!0),this.ymin<=this.ymax||([this.ymin,this.ymax]=[this.ymax,this.ymin],t=!0),!t||this.xmin<=this.xmax&&this.ymin<=this.ymax||this.setEmpty()}isValid(){return this.isEmpty()||this.xmin<=this.xmax&&this.ymin<=this.ymax}getLowerLeft(){return new i.P(this.xmin,this.ymin)}getLowerRight(){return new i.P(this.xmax,this.ymin)}getUpperLeft(){return new i.P(this.xmin,this.ymax)}getUpperRight(){return new i.P(this.xmax,this.ymax)}move(t,e){this.isEmpty()||(this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e)}centerAtCoords(t,e){this.move(t-this.getCenterX(),e-this.getCenterY())}centerAt(t){this.centerAtCoords(t.x,t.y)}containsCoords(t,e){return t>=this.xmin&&t<=this.xmax&&e>=this.ymin&&e<=this.ymax}contains(t){return this.containsCoords(t.x,t.y)}containsEnvelope(t){return t.xmin>=this.xmin&&t.xmax<=this.xmax&&t.ymin>=this.ymin&&t.ymax<=this.ymax}containsExclusiveCoords(t,e){return t>this.xmin&&t<this.xmax&&e>this.ymin&&e<this.ymax}containsExclusive(t){return this.containsExclusiveCoords(t.x,t.y)}containsExclusiveEnvelope(t){return t.xmin>this.xmin&&t.xmax<this.xmax&&t.ymin>this.ymin&&t.ymax<this.ymax}isIntersecting(t){return(this.xmin<=t.xmin?this.xmax>=t.xmin:t.xmax>=this.xmin)&&(this.ymin<=t.ymin?this.ymax>=t.ymin:t.ymax>=this.ymin)}isIntersectingNe(t){return(this.xmin<=t.xmin?this.xmax>=t.xmin:t.xmax>=this.xmin)&&(this.ymin<=t.ymin?this.ymax>=t.ymin:t.ymax>=this.ymin)}intersect(t){if(this.isEmpty())return!1;if(t.isEmpty())return this.setEmpty(),!1;t.xmin>this.xmin&&(this.xmin=t.xmin),t.xmax<this.xmax&&(this.xmax=t.xmax),t.ymin>this.ymin&&(this.ymin=t.ymin),t.ymax<this.ymax&&(this.ymax=t.ymax);const e=this.xmin<=this.xmax&&this.ymin<=this.ymax;return e||this.setEmpty(),e}queryCorner(t){switch(3&t){case 0:return new i.P(this.xmin,this.ymin);case 1:return new i.P(this.xmin,this.ymax);case 2:return new i.P(this.xmax,this.ymax);default:return new i.P(this.xmax,this.ymin)}}queryCorners(t){t[0].setCoords(this.xmin,this.ymin),t[1].setCoords(this.xmin,this.ymax),t[2].setCoords(this.xmax,this.ymax),t[3].setCoords(this.xmax,this.ymin)}queryCornersReversed(t){t[0].setCoords(this.xmin,this.ymin),t[1].setCoords(this.xmax,this.ymin),t[2].setCoords(this.xmax,this.ymax),t[3].setCoords(this.xmin,this.ymax)}reaspect(t,e){if(this.isEmpty())return;const s=t/e,n=.5*this.width(),i=.5*this.height()*s;if(n<=i){const t=this.getCenterX();this.xmin=t-i,this.xmax=t+i}else{const t=n/s,e=this.getCenterY();this.ymin=e-t,this.ymax=e+t}this.normalize()}getArea(){return this.isEmpty()?0:this.width()*this.height()}getLength(){return this.isEmpty()?0:2*(this.width()+this.height())}clipCode(t){return(t.x<this.xmin?1:0)|(t.x>this.xmax?1:0)<<1|(t.y<this.ymin?1:0)<<2|(t.y>this.ymax?1:0)<<3}clipLine(t,e){let s=this.clipCode(t),n=this.clipCode(e);if(s&n)return 0;if(!(s|n))return 4;const i=(s?1:0)|(n?2:0);do{const i=e.x-t.x,o=e.y-t.y;if(Math.abs(i)>Math.abs(o)?s&r.XMASK?(s&r.XLESSXMIN?(t.y+=o*(this.xmin-t.x)/i,t.x=this.xmin):(t.y+=o*(this.xmax-t.x)/i,t.x=this.xmax),s=this.clipCode(t)):n&r.XMASK?(n&r.XLESSXMIN?(e.y+=o*(this.xmin-e.x)/i,e.x=this.xmin):(e.y+=o*(this.xmax-e.x)/i,e.x=this.xmax),n=this.clipCode(e)):s?(s&r.YLESSYMIN?(t.x+=i*(this.ymin-t.y)/o,t.y=this.ymin):(t.x+=i*(this.ymax-t.y)/o,t.y=this.ymax),s=this.clipCode(t)):(n&r.YLESSYMIN?(e.x+=i*(this.ymin-e.y)/o,e.y=this.ymin):(e.x+=i*(this.ymax-e.y)/o,e.y=this.ymax),n=this.clipCode(e)):s&r.YMASK?(s&r.YLESSYMIN?(t.x+=i*(this.ymin-t.y)/o,t.y=this.ymin):(t.x+=i*(this.ymax-t.y)/o,t.y=this.ymax),s=this.clipCode(t)):n&r.YMASK?(n&r.YLESSYMIN?(e.x+=i*(this.ymin-e.y)/o,e.y=this.ymin):(e.x+=i*(this.ymax-e.y)/o,e.y=this.ymax),n=this.clipCode(e)):s?(s&r.XLESSXMIN?(t.y+=o*(this.xmin-t.x)/i,t.x=this.xmin):(t.y+=o*(this.xmax-t.x)/i,t.x=this.xmax),s=this.clipCode(t)):(n&r.XLESSXMIN?(e.y+=o*(this.xmin-e.x)/i,e.x=this.xmin):(e.y+=o*(this.xmax-e.x)/i,e.x=this.xmax),n=this.clipCode(e)),s&n)return 0}while(s|n);return i}distanceFromEnvelope(t){return Math.sqrt(this.sqrDistanceEnvelope(t,null,null))}distance(t){return Math.sqrt(this.sqrDistance(t))}sqrDistanceEnvelope(t,e,s){if(!e&&!s){if(this.isEmpty()||t.isEmpty())return Number.NaN;let e,s=0,n=0;return e=this.xmin-t.xmax,e>s&&(s=e),e=this.ymin-t.ymax,e>n&&(n=e),e=t.xmin-this.xmax,e>s&&(s=e),e=t.ymin-this.ymax,e>n&&(n=e),s*s+n*n}if(this.isEmpty()||t.isEmpty())return e&&e.setNAN(),s&&s.setNAN(),Number.NaN;let n,i=0,r=0;const o=Math.max(this.xmin,t.xmin),a=Math.max(this.ymin,t.ymin);return e&&e.setCoords(o,a),s&&s.setCoords(o,a),n=this.xmin-t.xmax,n>i&&(i=n,e&&(e.x=this.xmin),s&&(s.x=t.xmax)),n=this.ymin-t.ymax,n>r&&(r=n,e&&(e.y=this.ymin),s&&(s.y=t.ymax)),n=t.xmin-this.xmax,n>i&&(i=n,e&&(e.x=this.xmax),s&&(s.x=t.xmin)),n=t.ymin-this.ymax,n>r&&(r=n,e&&(e.y=this.ymax),s&&(s.y=t.ymin)),i*i+r*r}sqrDistance(t,e){if(void 0===e){if(this.isEmpty()||t.isNAN())return Number.NaN;let e,s=0,n=0;return e=this.xmin-t.x,e>s&&(s=e),e=this.ymin-t.y,e>n&&(n=e),e=t.x-this.xmax,e>s&&(s=e),e=t.y-this.ymax,e>n&&(n=e),s*s+n*n}if(this.isEmpty()||t.isNAN())return e.setNAN(),Number.NaN;e.assign(t);let s,n=0,i=0;return s=this.xmin-t.x,s>n&&(n=s,e.x=this.xmin),s=this.ymin-t.y,s>i&&(i=s,e.y=this.ymin),s=t.x-this.xmax,s>n&&(n=s,e.x=this.xmax),s=t.y-this.ymax,s>i&&(i=s,e.y=this.ymax),n*n+i*i}sqrMaxMinDistanceEnvelope(t){if(this.isEmpty()||t.isEmpty())return Number.NaN;let e=Number.MAX_VALUE;{const s=i.P.sqrDistanceCoords(this.xmin,this.ymin,t.xmax,t.ymin),n=i.P.sqrDistanceCoords(this.xmin,this.ymin,t.xmax,t.ymax),r=i.P.sqrDistanceCoords(this.xmin,this.ymax,t.xmax,t.ymin),o=i.P.sqrDistanceCoords(this.xmin,this.ymax,t.xmax,t.ymax),a=Math.max(s,n),l=Math.max(r,o),h=Math.max(a,l);e=Math.min(h,e)}{const s=i.P.sqrDistanceCoords(this.xmin,this.ymin,t.xmin,t.ymax),n=i.P.sqrDistanceCoords(this.xmin,this.ymin,t.xmax,t.ymax),r=i.P.sqrDistanceCoords(this.xmax,this.ymin,t.xmin,t.ymax),o=i.P.sqrDistanceCoords(this.xmax,this.ymin,t.xmax,t.ymax),a=Math.max(s,n),l=Math.max(r,o),h=Math.max(a,l);e=Math.min(h,e)}{const s=i.P.sqrDistanceCoords(this.xmax,this.ymin,t.xmin,t.ymin),n=i.P.sqrDistanceCoords(this.xmax,this.ymin,t.xmin,t.ymax),r=i.P.sqrDistanceCoords(this.xmax,this.ymax,t.xmin,t.ymin),o=i.P.sqrDistanceCoords(this.xmax,this.ymax,t.xmin,t.ymax),a=Math.max(s,n),l=Math.max(r,o),h=Math.max(a,l);e=Math.min(h,e)}{const s=i.P.sqrDistanceCoords(this.xmin,this.ymax,t.xmin,t.ymin),n=i.P.sqrDistanceCoords(this.xmin,this.ymax,t.xmax,t.ymin),r=i.P.sqrDistanceCoords(this.xmax,this.ymax,t.xmin,t.ymin),o=i.P.sqrDistanceCoords(this.xmax,this.ymax,t.xmax,t.ymin),a=Math.max(s,n),l=Math.max(r,o),h=Math.max(a,l);e=Math.min(h,e)}return e}sqrMaxDistanceEnvelope(t){if(this.isEmpty()||t.isEmpty())return Number.NaN;let e=0;const s=(0,i.m)(i.P,4);this.queryCorners(s);const n=(0,i.m)(i.P,4);t.queryCorners(n);for(let r=0;r<4;r++)for(let t=0;t<4;t++){const o=i.P.sqrDistance(s[r],n[t]);o>e&&(e=o)}return e}sqrMaxMinDistance(t){const e=i.P.sqrDistance(t,this.getLowerLeft()),s=i.P.sqrDistance(t,this.getUpperLeft()),n=i.P.sqrDistance(t,this.getLowerRight()),r=i.P.sqrDistance(t,this.getUpperRight());let o,a=Math.max(e,s);return o=Math.max(e,n),a>o&&(a=o),o=Math.max(s,r),a>o&&(a=o),o=Math.max(n,r),a>o&&(a=o),a}sqrMinDistance(t){return this.contains(t)?0:this.sqrDistance(t)}sqrMaxDistance(t){let e=i.P.sqrDistance(t,this.getLowerLeft());return e=Math.max(i.P.sqrDistance(t,this.getUpperLeft()),e),e=Math.max(i.P.sqrDistance(t,this.getUpperRight()),e),e=Math.max(i.P.sqrDistance(t,this.getLowerRight()),e),e}snapToBoundary(t){if(t.isNAN())return!1;if(this.isEmpty())return t.setNAN(),!0;let e=!0;if(t.x<this.xmin?t.x=this.xmin:t.x>this.xmax?t.x=this.xmax:e=!1,t.y<this.ymin?t.y=this.ymin:t.y>this.ymax?t.y=this.ymax:e=!1,e)return!0;if(t.x===this.xmin||t.x===this.xmax||t.y===this.ymin||t.y===this.ymax)return!1;const s=this.xmax-t.x,n=t.x-this.xmin,i=this.ymax-t.y,r=t.y-this.ymin;return Math.max(s,n)>Math.max(i,r)?t.y=r<i?this.ymin:this.ymax:t.x=n<s?this.xmin:this.xmax,!0}snapClip(t){const e=(0,i.s)(t.x,this.xmin,this.xmax),s=(0,i.s)(t.y,this.ymin,this.ymax);return i.P.construct(e,s)}boundaryDistance(t){if(this.isEmpty()||t.isNAN())return Number.NaN;if(t.x===this.xmin)return t.y-this.ymin;const e=this.ymax-this.ymin,s=this.xmax-this.xmin;if(t.y===this.ymax)return e+t.x-this.xmin;if(t.x===this.xmax)return e+s+this.ymax-t.y;if(t.y===this.ymin)return 2*e+s+this.xmax-t.x;const n=new i.P;return n.setCoordsPoint2D(t),this.snapToBoundary(n),this.boundaryDistance(n)}envelopeSide(t){if(this.isEmpty())return-1;let e=this.boundaryDistance(t);const s=this.ymax-this.ymin,n=this.xmax-this.xmin;return e<s?0:(e-=s)<n?1:e-n<s?2:3}querySide(t,e){switch(t){case 0:e.constructFromCoords(this.xmin,this.ymin,this.xmin,this.ymax);break;case 1:e.constructFromCoords(this.xmin,this.ymax,this.xmax,this.ymax);break;case 2:e.constructFromCoords(this.xmax,this.ymax,this.xmax,this.ymin);break;case 3:e.constructFromCoords(this.xmax,this.ymin,this.xmin,this.ymin);break;default:(0,n.a)("query_side")}return e}isPointOnBoundary(t,e){return Math.abs(t.x-this.xmin)<=e||Math.abs(t.x-this.xmax)<=e||Math.abs(t.y-this.ymin)<=e||Math.abs(t.y-this.ymax)<=e}calculateToleranceFromEnvelope(){return this.isEmpty()?(0,i.g)():(Math.abs(this.xmin)+Math.abs(this.xmax)+Math.abs(this.ymin)+Math.abs(this.ymax)+1)*(0,i.g)()}toString(){return`[${this.xmin}, ${this.ymin}, ${this.xmax}, ${this.ymax}]`}}r.XLESSXMIN=1,r.YLESSYMIN=4,r.XMASK=3,r.YMASK=12},62188:(t,e,s)=>{function n(t,e){try{if(!t)throw new Error(e)}catch(i){throw i}}s.d(e,{A:()=>w,B:()=>L,C:()=>V,D:()=>z,G:()=>u,a:()=>E,b:()=>C,c:()=>k,d:()=>D,e:()=>d,f:()=>_,g:()=>n,h:()=>y,i:()=>f,j:()=>x,k:()=>p,l:()=>g,m:()=>b,n:()=>S,o:()=>R,p:()=>I,q:()=>M,r:()=>P,s:()=>N,t:()=>A,u:()=>T,v:()=>v,w:()=>F,x:()=>O,y:()=>G,z:()=>m});class i extends Error{constructor(t,e){super(e),this.m_AdditionalMessage=e,this.m_ErrorType=t,this.name="GeometryError"}what(){return function(t){switch(t){case 1:return"Unknown error";case 2:return"Corrupted geometry";case 3:return"Empty geometry";case 4:return"Math singularity";case 5:return"Buffer is too small";case 6:return"Invalid shape type";case 7:return"Projection out of supported range";case 8:return"Non simple geometry";case 9:return"Cannot calculate geodesic";case 10:return"Notation conversion";case 11:return"Missing grid file";case 12:return"Invalid call";case 13:return"Internal error";case 14:return"Not implemented";case 15:return"IO error";case 16:return"Invalid 3D";case 17:return"An ambiguous geography edge with antipodal points";case 18:return"Geocentric coordinates require ellipsoidal height";case 19:return"Geography cannot be projected into a gnomonic plane or a result of an operation cannot fit into a gnomonic plane";case 20:return"Geometry is too large to be exported in to a given format";case 22:return"Operation is canceled by the user";case 21:return"The operation, such as projection or geodetic computation, cannot be performed without pe-wasm loaded";default:return"unknown error"}}(this.m_ErrorType)}additionalMessage(){return this.m_AdditionalMessage?this.m_AdditionalMessage:""}code(){return this.m_ErrorType}}class r extends i{constructor(t){super(2,t),this.name="CorruptedGeometryError"}}class o extends i{constructor(t){super(3,t),this.name="EmptyGeometryError"}}class a extends i{constructor(t){super(4,t),this.name="MathSingularityError"}}class l extends i{constructor(t){super(21,t),this.name="ProjectionEngineNotLoadedError"}}class h extends i{constructor(t){super(8,t),this.name="NonSimpleGeometryError"}}var u;!function(t){t[t.enumUnknown=0]="enumUnknown",t[t.enumPoint=513]="enumPoint",t[t.enumLine=5122]="enumLine",t[t.enumBezier=5123]="enumBezier",t[t.enumEllipticArc=5124]="enumEllipticArc",t[t.enumEnvelope=3077]="enumEnvelope",t[t.enumMultiPoint=8710]="enumMultiPoint",t[t.enumPolyline=25607]="enumPolyline",t[t.enumPolygon=27656]="enumPolygon",t[t.enumMultipatch=40969]="enumMultipatch",t[t.enumGeometryCollection=3594]="enumGeometryCollection",t[t.enumRationalBezier2=5134]="enumRationalBezier2",t[t.enumBezier2=5135]="enumBezier2",t[t.enumRationalBezier23d=5392]="enumRationalBezier23d",t[t.enumGreatArc3d=5393]="enumGreatArc3d"}(u||(u={}));const c=[0,0,1,1,1,2,0,1,2,3,-1,-1,-1,-1,1,1];function m(t){return c[15&t]}function d(t){return!!(512&t)}function g(t){return!!(1024&t)}function p(t){return!!(2048&t)}function _(t){return!!(4096&t)}function f(t){return!!(8192&t)}function y(t){return!!(16384&t)}function x(t){return!!(32768&t)}function v(t){const e=t.getGeometryType();return f(e)?t.getPointCount():t.isEmpty()?0:e===u.enumEnvelope?4:e===u.enumPoint?1:_(e)?2:void D("missing type")}function b(t){const e=t.getGeometryType();if(y(e))return t.hasNonLinearSegments();if(e===u.enumGeometryCollection){const e=t;for(let t=0,s=e.getGeometryCount();t<s;t++)if(b(e.getGeometry(t)))return!0;return!1}return!!_(e)&&e!==u.enumLine}function P(t){throw new l(t)}function S(t){throw new r(t)}function E(t){throw new Error(t)}function C(t){throw new a(t)}function w(){E("Geometry type is not supported for 3D operations.")}function I(t){throw new i(12,t)}function T(t){throw new o(t)}function A(t){throw new i(14,t)}function M(t){throw new Error(t)}function D(t){throw new i(13,t)}function N(t){throw new Error(t)}function F(t){throw new h(t)}function R(t){t&&b(t)&&A("Operation does not support curves.")}function k(t){t&&x(t.getGeometryType())&&A("Unsupported geometry type.")}function L(t){t===u.enumGeometryCollection&&E("Geometry_collection instances are not supported in this operation")}function G(t){L(t.getGeometryType())}function V(t){E(`bad wkid: ${t}`)}function z(t){let e="bad wkt: ";e+=t,e+="...",E(e)}function O(t,e){t||E(e)}},74642:(t,e,s)=>{s.d(e,{$:()=>it,A:()=>fr,B:()=>hr,C:()=>ys,D:()=>Oi,E:()=>ms,F:()=>Xi,H:()=>yt,I:()=>gt,J:()=>pt,K:()=>It,L:()=>Br,M:()=>p,N:()=>Vi,O:()=>zi,P:()=>Ct,Q:()=>Nr,R:()=>I,S:()=>Yr,T:()=>Wt,U:()=>yi,V:()=>br,W:()=>X,X:()=>us,Y:()=>Fr,Z:()=>Lr,_:()=>q,a:()=>os,a0:()=>v,a1:()=>Rr,a2:()=>kr,a3:()=>zr,a4:()=>P,a5:()=>Qi,a6:()=>cs,a7:()=>Ni,a8:()=>u,a9:()=>Ai,b:()=>Ti,c:()=>Tt,d:()=>Gi,e:()=>_s,f:()=>ds,g:()=>W,i:()=>ps,l:()=>Ri,n:()=>ls,s:()=>c,x:()=>ye,y:()=>In,z:()=>_r});var n=s(62188),i=s(75992),r=s(86330),o=s(21566),a=s(33147),l=s(50256);class h{constructor(){this.posStream=null,this.streams=null}get(t){return t>0?this.streams[t-1]:this.posStream}set(t,e){t>0?this.streams[t-1]=e:this.posStream=e}destroyAndSetSize(t){if(this.streams=null,t>1){this.streams=new Array(t-1);for(let e=0;e<t-1;++e)this.streams[e]=null}this.posStream=null}swap(t){[this.streams,t.streams]=[t.streams,this.streams],[this.posStream,t.posStream]=[t.posStream,this.posStream]}empty(){return null===this.posStream&&null===this.streams}}function u(t,e,s){if(t)for(let n=e.length-1;n>=0;--n)s(e[n]);else e.forEach(s)}function c(t,e){let s=(0,r.B)(t);const n=e.length/(0,r.i)();for(let i=0;i<e.length;++i){const t=Math.trunc(s*n);s=(0,r.B)(s);const i=Math.trunc(s*n),o=e[t];e[t]=e[i],e[i]=o}}var m=i.V;const d="can not assign an empty point to a vertex";class g{constructor(t){if(this.m_accelerators=null,void 0!==t&&t.move)this.m_description=t.move.m_description,t.move.m_description=(0,i.j)(),this.m_vertexAttributes=t.move.m_vertexAttributes,t.move.m_vertexAttributes=new h,this.m_envelopeData=t.move.m_envelopeData,t.move.m_envelopeData=new i.k,this.m_pointCount=t.move.m_pointCount,this.m_reservedPointCount=t.move.m_reservedPointCount,this.m_flags=t.move.m_flags,this.m_bFillRule=t.move.m_bFillRule,this.m_bPathStarted=t.move.m_bPathStarted,this.m_bPolygon=t.move.m_bPolygon,this.m_simpleTolerance=t.move.m_simpleTolerance;else{const e=void 0!==t&&t.vd?t.vd:(0,i.j)();this.m_description=e,this.m_vertexAttributes=new h,this.m_envelopeData=new i.k,this.m_pointCount=0,this.m_reservedPointCount=-1,this.m_flags=4063,this.m_bFillRule=this.m_bPathStarted=this.m_bPolygon=!1,this.m_simpleTolerance=0,void 0!==t&&t.copy&&t.copy.copyTo(this)}}equalsBase(t,e){if(!(0,n.i)(t.getGeometryType()))return!1;const s=t;if(this===s)return!0;if(!this.m_description.equals(s.getDescription()))return!1;if(this.isEmptyImpl()!==s.isEmptyImpl())return!1;if(this.isEmptyImpl())return!0;const i=this.getPointCount();if(i!==s.getPointCount())return!1;for(let n=0;n<this.m_description.getAttributeCount();n++){const t=this.m_description.getSemantics(n),r=this.getAttributeStreamRef(t),o=s.getAttributeStreamRef(t),a=m.getComponentCount(t);if(!r.equals(o,0,i*a,e))return!1}if(e){if(!this.equalsImplTol(t,e))return!1}else if(!this.equalsImpl(t))return!1;return!0}transformAttribute(t,e,s,r,o){if(this.addAttribute(t),!this.isEmpty()&&(0!==s||1!==r)){if(0===t){const t=new a.T;return 0===o?0===e?(t.setShiftCoords(s,0),t.scale(r,1)):1===e?(t.setShiftCoords(0,s),t.scale(1,r)):(0,n.a)(""):0===e?(t.setScaleCoords(1/r,1),t.shiftCoords(-s,0)):1===e?(t.setScaleCoords(1,1/r),t.shiftCoords(0,-s)):(0,n.a)(""),void this.applyTransformation(t)}(function(t,e,s,i,r){(e<0||s<0||i<1||e+i*(s-1)+1>t.size())&&(0,n.a)("Index out of bound");for(let n=e,o=e+i*(s-1)+1;n<o;n+=i)t.writeAsDbl(n,r(t.readAsDbl(n)))})(this.getAttributeStreamRef(t),e,this.getPointCount(),m.getComponentCount(t),(0,i.v)(s,r,o)),this.notifyModified()}}getDescription(){return this.m_description}assignVertexDescription(t){this.m_description!==t&&this.assignVertexDescriptionImpl(t)}mergeVertexDescriptionImpl(t){const e=this.getDescription(),s=(0,i.l)(e,t);this.assignVertexDescription(s)}mergeVertexDescription(t){this.m_description!==t&&(this.m_description.hasAttributesFrom(t)||this.mergeVertexDescriptionImpl(t))}hasAttribute(t){return this.m_description.hasAttribute(t)}addAttribute(t){if(this.m_description.hasAttribute(t))return;const e=(0,i.m)(this.m_description,t);this.assignVertexDescription(e)}dropAttribute(t){if(!this.m_description.hasAttribute(t))return;const e=(0,i.r)(this.m_description,t);this.assignVertexDescription(e)}dropAllAttributes(){const t=(0,i.j)();t!==this.m_description&&this.assignVertexDescription(t)}getAttributeStreamRef(t){this.throwIfEmpty(),this.m_description.hasAttribute(t)||(0,n.a)("AttributeStream : Geometry does not have the attribute");const e=this.m_description.getAttributeIndex(t);return this.m_vertexAttributes.get(e)}setAttributeStreamRef(t,e){e||(0,n.a)("stream"),e&&m.getPersistence(t)!==e.getPersistence()&&(0,n.a)(""),this.addAttribute(t);const s=this.m_description.getAttributeIndex(t);this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),this.m_vertexAttributes.set(s,e),this.notifyModifiedFlags(2001)}notifyModifiedFlags(t){65535===t&&(this.m_reservedPointCount=-1,this.notifyModifiedAllImpl()),this.setDirtyFlagProtected(t,!0),this.clearAccelerators(),32&t&&this.verifyAllStreamsAfterSizeChange()}notifyModified(){this.notifyModifiedFlags(2001)}getPointCount(){return this.m_pointCount}getPointByVal(t,e){const s=e;s.assignVertexDescription(this.m_description);for(let n=0;n<this.m_description.getAttributeCount();n++){const e=this.m_description.getSemantics(n);for(let i=0,r=m.getComponentCount(e);i<r;i++){const o=this.m_vertexAttributes.get(n).readAsDbl(r*t+i);s.setAttributeBasic(e,i,o)}}}setPointByValNoCurves(t,e){const s=e;s.isEmpty()&&(0,n.a)(d);const i=s.getDescription();i!==this.m_description&&this.mergeVertexDescription(i);const r=this.m_vertexAttributes.get(0);r.write(2*t,s.getX()),r.write(2*t+1,s.getY());for(let n=1,o=this.m_description.getAttributeCount();n<o;n++){const e=this.m_description.getSemantics(n),i=m.getComponentCount(e);for(let r=0;r<i;r++){const o=s.getAttributeAsDbl(e,r);this.m_vertexAttributes.get(n).writeAsDbl(t*i+r,o)}}this.notifyModifiedFlags(2001)}setPointByValFromArrayNoCurves(t,e,s,i){(0,n.g)(0)}getPointByValAsArray(t,e,s,i){(0,n.g)(0)}isEmpty(){return this.isEmptyImpl()}isEmptyImpl(){return 0===this.m_pointCount}getAttributeAsDbl(t,e,s){const i=m.getComponentCount(t);s>=i&&(0,n.q)("");const r=this.m_description.getAttributeIndex(t);return r>=0?this.m_vertexAttributes.get(r).readAsDbl(e*i+s):m.getDefaultValue(t)}queryAttributeAsDbl(t,e,s,i){const r=m.getComponentCount(t);i<r&&(0,n.q)("");const o=this.m_description.getAttributeIndex(t);if(o>=0){const t=e*r,n=this.m_vertexAttributes.get(o);for(let e=0;e<r;e++)s[e]=n.readAsDbl(t+e)}else{const e=m.getDefaultValue(t);for(let t=0;t<r;t++)s[t]=e}}getAttributeAsInt(t,e,s){return Math.trunc(this.getAttributeAsDbl(t,e,s))}queryAttributeAsInt(t,e,s,i){(0,n.g)(0)}setAttributeNoCurves(t,e,s,i){const r=m.getComponentCount(t);s>=r&&(0,n.q)(""),this.addAttribute(t);const o=this.m_description.getAttributeIndex(t);this.notifyModifiedFlags(2001),this.m_vertexAttributes.get(o).writeAsDbl(e*r+s,i)}setAttributeFromArrayNoCurves(t,e,s,i){(e<0||e>=this.m_pointCount)&&(0,n.q)("");const r=m.getComponentCount(t);i<r&&(0,n.q)(""),this.addAttribute(t);const o=this.m_description.getAttributeIndex(t);this.notifyModifiedFlags(2001);const a=this.m_vertexAttributes.get(o);for(let n=0;n<r;++n)a.writeAsDbl(e*r+n,s[n])}getXY(t){return this.m_vertexAttributes.get(0).readPoint2D(2*t)}queryXY(t,e){return this.m_vertexAttributes.get(0).queryPoint2D(2*t,e)}setXYNoCurves(t,e){this.m_vertexAttributes.get(0).writePoint2D(2*t,e),this.notifyModifiedFlags(2001)}setXYCoordsNoCurves(t,e,s){const n=this.m_vertexAttributes.get(0);n.write(2*t,e),n.write(2*t+1,s),this.notifyModifiedFlags(2001)}getXYZ(t){const e=this.m_vertexAttributes.get(0),s=i.d.getNAN();return s.x=e.read(2*t),s.y=e.read(2*t+1),this.m_description.hasAttribute(1)?s.z=this.m_vertexAttributes.get(1).read(t):s.z=m.getDefaultValue(1),s}setXYZNoCurves(t,e){this.addAttribute(1),this.notifyModifiedFlags(2001);const s=this.m_vertexAttributes.get(0);s.write(2*t,e.x),s.write(2*t+1,e.y),this.m_vertexAttributes.get(1).write(t,e.z)}queryEnvelope(t){t instanceof o.Envelope2D||t instanceof i.n?this.updateEnvelope(t):(this.updateAllDirtyIntervals(!0),this.m_envelopeData.copyTo(this.m_description,t))}queryLooseEnvelope(t){this.updateLooseEnvelope(t)}queryInterval(t,e){const s=r.E.constructEmpty();return this.isEmptyImpl()||(this.updateAllDirtyIntervals(!0),this.m_envelopeData.queryInterval(this.m_description,t,e,s)),s}setAttributeBasic(t,e,s){this.setAttributeImpl(t,e,s)}setAttributeImpl(t,e,s){if(this.addAttribute(t),this.isEmpty())return;let n=!1;const i=m.getComponentCount(t),r=this.getAttributeStreamRef(t),o=Number.isNaN(s);if(1===r.getPersistence()){const t=r;for(let r=e,a=this.m_pointCount*i;r<a;r+=i){const e=t.read(r);(o||e===s)&&Number.isNaN(e)||(t.write(r,s),n=!0)}}else for(let a=e,l=this.m_pointCount*i;a<l;a+=i)r.readAsDbl(a)!==s&&(r.writeAsDbl(a,s),n=!0);n&&this.notifyModifiedFlags(2001)}replaceNaNs(t,e){if(this.addAttribute(t),this.isEmpty())return;let s=!1;const n=m.getComponentCount(t),i=this.getAttributeStreamRef(t);for(let r=0;r<n;r++)if(1===i.getPersistence()){const t=i;for(let i=0,r=this.m_pointCount*n;i<r;i++){const n=t.read(i);Number.isNaN(n)&&(t.write(i,e),s=!0)}}else for(let t=0,o=this.m_pointCount*n;t<o;t++){const n=i.readAsDbl(t);Number.isNaN(n)&&(i.writeAsDbl(t,e),s=!0)}s&&this.notifyModifiedFlags(2001)}calculateLength3D(t){return(0,n.g)(0),0}setEnvelopeForImport(t){this.m_description.equals(t.getDescription())||(0,n.a)(""),this.m_envelopeData=new i.k({moveEnv:t}),this.setDirtyFlagProtected(192,!1)}copyTo(t){t.getGeometryType()!==this.getGeometryType()&&(0,n.a)(""),this!==t&&this.copyToUnchecked(t,!1)}queryCoordinates(t,e,s,i){let r=i<0?this.m_pointCount:i;if(r=Math.min(r,s+e),(s<0||r<s||this.m_pointCount>0&&s>=this.m_pointCount)&&(0,n.a)(""),0===this.m_pointCount)return r;const o=this.getAttributeStreamRef(0);for(let n=2*s,a=2*r,l=0;n<a;n+=2,l++)o.queryPoint2D(n,t[l]);return r}queryCoordinates3D(t,e,s,i){let r=i<0?this.m_pointCount:i;if(r=Math.min(r,s+e),(s<0||r<s||this.m_pointCount>0&&s>=this.m_pointCount)&&(0,n.a)(""),0===this.m_pointCount)return r;const o=this.getAttributeStreamRef(0);let a=null;const l=m.getDefaultValue(1),h=this.m_description.hasAttribute(1);h&&(a=this.getAttributeStreamRef(1));let u=0;for(let n=s;n<r;n++,u++)t[u].x=o.read(2*n),t[u].y=o.read(2*n+1),t[u].z=h?a.read(n):l;return r}clearAndSetDirtyFlagProtected(t,e){let s=0;const n=t&~e,i=e|n;s=this.m_flags,(s&i)!==e&&(this.m_flags=s&~n|e)}getIsSimple(t,e){e[0]=0;let s=-1;const n=this.m_flags,i=this.m_simpleTolerance;return 1&n||(s=(14&n)>>1,e[0]=i,i<t&&(s=-1)),s}setIsSimple(t,e,s=!1){if(2===t?(0,n.g)(this.getGeometryType()===n.G.enumPolyline):1===t?(0,n.g)(this.getGeometryType()===n.G.enumMultiPoint||this.getGeometryType()===n.G.enumPolyline):3===t&&(0,n.g)(this.getGeometryType()===n.G.enumPolygon),-1===t)this.setDirtyFlagProtected(17,!0);else{let n=t<<1;s||(n|=16);const i=31;this.clearAndSetDirtyFlagProtected(i,n),this.m_simpleTolerance!==e&&(this.m_simpleTolerance=e)}}attributeStreamIsAllocated(t){this.throwIfEmpty();const e=this.m_description.getAttributeIndex(t);return e>=0&&null!==this.m_vertexAttributes.get(e)}capacity(){return-1===this.m_reservedPointCount&&0===this.m_pointCount?0:this.m_reservedPointCount}getDescriptionImpl(){return this.m_description}copyToUnchecked(t,e=!1){e&&this.hasDirtyFlag(32)&&(0,n.s)("Cannot do shallow clone on unprepared geometry");const s=t,i=this.getGeometryType(),r=s.getGeometryType();(0,n.g)(i===r||i===n.G.enumPolygon&&r===n.G.enumPolyline,"failure in copyToUnchcked"),s.clearAccelerators(),s.m_description=this.m_description,s.m_vertexAttributes.destroyAndSetSize(0),s.m_envelopeData.releaseAttributes();const o=this.m_description.getAttributeCount(),a=new h;if(!this.m_vertexAttributes.empty()){a.destroyAndSetSize(o);for(let t=0;t<o;t++)if(this.m_vertexAttributes.get(t))if(e)a.set(t,this.m_vertexAttributes.get(t));else{const e=m.getComponentCount(this.m_description.getSemantics(t));a.set(t,this.m_vertexAttributes.get(t).restrictedClone(this.getPointCount()*e))}}if(this.m_envelopeData.copyToIfNotNull(this.m_description,s.m_envelopeData),s.m_flags=this.m_flags,s.m_simpleTolerance=this.m_simpleTolerance,i!==r){const t=[Number.NaN];s.getIsSimple(0,t)>=3?s.setIsSimple(1,t[0]):s.setIsSimple(-1,0)}s.m_vertexAttributes.swap(a),a.destroyAndSetSize(0),s.m_pointCount=this.m_pointCount,s.hasDirtyFlag(32)||s.m_vertexAttributes.empty()?((0,n.g)(!e||0===s.m_pointCount),s.m_reservedPointCount=-1):s.m_reservedPointCount=s.m_pointCount;try{this.copyToImpl(s,e)}catch(l){throw s.setEmpty(),l}s.verifyAllStreamsAfterSizeChange()}buildRasterizedGeometryAccelerator(t,e){return!1}getAccelerators(){return this.m_accelerators}clearAccelerators(){this.m_accelerators&&this.m_accelerators.release(),this.m_accelerators=null}ensureUniqueAccelerators(){if(this.m_accelerators&&!this.m_accelerators.uniqueUse()){const t=this.m_accelerators.clone();this.m_accelerators.release(),this.m_accelerators=t}}interpolateTwoVertices(t,e,s,o){(t<0||t>=this.m_pointCount)&&(0,n.q)(""),(e<0||e>=this.m_pointCount)&&(0,n.q)(""),o.assignVertexDescription(this.m_description);const a=(0,r.d)(m.maxComponentCount(),Number.NaN),l=(0,r.d)(m.maxComponentCount(),Number.NaN),h=(0,i.o)();let u=0;for(let c=0;c<this.m_description.getAttributeCount();c++){const o=this.m_description.getSemantics(c),d=m.getInterpolation(o),g=m.getComponentCount(o),p=m.getDefaultValue(o);this.queryAttributeAsDbl(o,t,a,g),this.queryAttributeAsDbl(o,e,l,g),(0,n.g)(u+g<=i.O),(0,r.A)(d,a,l,h,u,g,s,p),u+=g}!function(t,e){const s=t.getDescription().getTotalComponentCount();t.setX(e[0]),t.setY(e[1]),(0,r.b)(t.getAttributeArray(),e,0,2,s-2)}(o,h)}getShortestDistance(t,e){return r.P.distance(this.getXY(t),this.getXY(e))}getShortestSqrDistance(t,e){return r.P.sqrDistance(this.getXY(t),this.getXY(e))}resizeImpl(t){if(t<0&&(0,n.a)(),(t=Math.ceil(t))===this.m_pointCount)return;this.m_pointCount=t;const e=this.m_pointCount<=this.m_reservedPointCount?2001:4095;this.notifyModifiedFlags(e)}assignVertexDescriptionImpl(t){if(!this.m_vertexAttributes.empty()){const e=(0,i.p)();(0,i.q)(t,this.m_description,e);const s=new h;s.destroyAndSetSize(t.getAttributeCount());for(let n=0;n<t.getAttributeCount();n++){const t=e[n];-1!==t?s.set(n,this.m_vertexAttributes.get(t)):this.m_reservedPointCount=-1}s.swap(this.m_vertexAttributes)}this.m_description=t,this.m_envelopeData.releaseAttributes(),this.notifyModifiedFlags(4095)}hasDirtyFlag(t){return!!(this.m_flags&t)}setDirtyFlagProtected(t,e){e?this.m_flags|=t:this.m_flags&=~t}notifyModifiedAllImpl(){}verifyAllStreamsAfterSizeChange(){this.hasDirtyFlag(32)&&this.verifyAllStreamsAfterSizeChangeImpl()}verifyAllStreamsAfterSizeChangeImpl(){if(this.hasDirtyFlag(32)){if(this.m_reservedPointCount<this.m_pointCount){this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),this.m_reservedPointCount=-1;let t=Number.MAX_SAFE_INTEGER,e=0;e=this.m_pointCount<4?3:this.m_pointCount<=128?2*this.m_pointCount:Math.trunc((4*this.m_pointCount+2)/3);for(let s=0;s<this.m_description.getAttributeCount();s++){const n=this.m_description.getSemantics(s);let r=0;if(null!==this.m_vertexAttributes.get(s)){const t=m.getComponentCount(n);r=this.m_vertexAttributes.get(s).size()/t,r<this.m_pointCount&&(this.m_vertexAttributes.get(s).resize(e*t,m.getDefaultValue(n)),r=e)}else this.m_vertexAttributes.set(s,(0,i.t)(n,e)),r=e;r<t&&(t=r)}this.m_reservedPointCount=t}this.verifyStreamsAfterSizeChangeExtraImpl(),this.setDirtyFlagProtected(32,!1)}}verifyStreamsAfterSizeChangeExtraImpl(){}updateAllDirtyIntervals(t){if(t?this.hasDirtyFlag(192):this.hasDirtyFlag(128)){if(this.isEmpty())return this.hasDirtyFlag(192)&&this.m_envelopeData.setEmpty(this.m_description),void this.setDirtyFlagProtected(192,!1);const e=this.updateXYImpl(t),s=new i.E({vd:this.m_description});s.setEnvelope(e);for(let t=1;t<this.m_description.getAttributeCount();t++){const e=this.m_description.getSemantics(t),n=m.getComponentCount(e),i=this.m_vertexAttributes.get(t);for(let t=0;t<n;t++){const o=new r.E;o.setEmpty();for(let e=0;e<this.m_pointCount;e++){const s=i.readAsDbl(e*n+t);o.mergeCoordinate(s)}s.setIntervalEnvelope(e,t,o)}}(t?this.hasDirtyFlag(192):this.hasDirtyFlag(128))&&(this.m_envelopeData=new i.k({moveEnv:s}),this.clearDirtyIntervalsFlag(t))}}updateXYImpl(t){const e=o.Envelope2D.constructEmpty(),s=this.m_vertexAttributes.get(0);return e.mergePointsInterleaved(s,0,this.m_pointCount),e}updateEnvelope3D(t){(0,n.g)(0)}updateLooseEnvelope(t){this.updateAllDirtyIntervals(!1),t instanceof o.Envelope2D?t.assign(this.m_envelopeData.m_envelope2D):this.m_envelopeData.queryEnvelope3D(this.m_description,t)}updateEnvelope(t){this.updateAllDirtyIntervals(!0),t.assign(this.m_envelopeData.m_envelope2D)}setEmptyImpl(){this.m_pointCount=0,this.m_reservedPointCount=-1,this.m_vertexAttributes.destroyAndSetSize(0),this.notifyModifiedFlags(4095)}clearDirtyIntervalsFlag(t){this.setDirtyFlagProtected(192,!1)}reserveImpl(t,e){if(t<0&&(0,n.a)(""),0===t)return;let s=t=Math.ceil(t);if(this.m_reservedPointCount<s){this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),e?(null===this.m_vertexAttributes.get(0)&&this.m_vertexAttributes.set(0,(0,i.u)(0,0)),this.m_vertexAttributes.get(0).resizeRounded(2*s),s=this.m_vertexAttributes.get(0).size()>>1):null===this.m_vertexAttributes.get(0)?this.m_vertexAttributes.set(0,(0,i.u)(0,s)):this.m_vertexAttributes.get(0).resize(2*s);for(let t=1;t<this.m_description.getAttributeCount();t++){const e=this.m_description.getSemantics(t),n=m.getComponentCount(e);null!==this.m_vertexAttributes.get(t)?this.m_vertexAttributes.get(t).resize(s*n):this.m_vertexAttributes.set(t,(0,i.u)(e,s))}this.reserveImplImpl(s,e),this.m_reservedPointCount=s}}reserveRounded(t){t<0&&(0,n.a)(),t=Math.ceil(t),this.reserveImpl(t,!0)}reserveImplImpl(t,e){}throwIfEmpty(){this.isEmptyImpl()&&(0,n.u)("")}}class p extends g{constructor(t){super(t),t&&(t.points?this.addPoints2D(t.points,t.pointsSize,0,-1):t.point&&this.add(t.point))}assignCopy(t){return t.copyTo(this),this}assignMove(t){return t.copyTo(this),t.setEmpty(),this}insertPoint2D(t,e){t>this.getPointCount()&&(0,n.a)("invalid point index"),t<0&&(t=this.getPointCount());const s=this.m_pointCount;this.resizeNoInit(this.m_pointCount+1);for(let n=0,r=this.m_description.getAttributeCount();n<r;n++){const r=this.m_description.getSemantics(n),o=i.V.getComponentCount(r);if(0===r)this.m_vertexAttributes.get(n).insert(o*t,e,o*s);else{const e=i.V.getDefaultValue(r);this.m_vertexAttributes.get(n).insertRange(o*t,e,o,o*s)}}this.notifyModifiedFlags(2001)}insertPoint(t,e){e.isEmpty()&&(0,n.a)(d),t<0&&(t=this.getPointCount()),this.mergeVertexDescription(e.getDescription());const s=this.m_pointCount;this.resizeNoInit(this.m_pointCount+1);for(let n=0,r=this.m_description.getAttributeCount();n<r;n++){const r=this.m_description.getSemantics(n),o=i.V.getComponentCount(r);if(e.hasAttribute(r))this.m_vertexAttributes.get(n).insertAttributes(o*t,e,r,o*s);else{const e=i.V.getDefaultValue(r);this.m_vertexAttributes.get(n).insertRange(o*t,e,o,o*s)}}this.notifyModifiedFlags(2001)}insertPoints(t,e,s){if((t>this.getPointCount()||s<0)&&(0,n.q)(""),t<0&&(t=this.getPointCount()),0===s)return;const r=e[0].getDescription();this.mergeVertexDescription(r);const o=this.m_pointCount;this.resizeNoInit(this.m_pointCount+s);for(let n=0,a=this.m_description.getAttributeCount();n<a;n++){const a=this.m_description.getSemantics(n),l=i.V.getComponentCount(a);if(this.m_vertexAttributes.get(n))if(r.hasAttribute(a))this.m_vertexAttributes.get(n).insertAttributesFromPoints(t*l,e,s,a,o*l);else{const e=i.V.getDefaultValue(a);this.m_vertexAttributes.get(n).insertRange(l*t,e,l*s,l*o)}}this.notifyModifiedFlags(2001)}insertPoints2D(t,e,s){if((t>this.getPointCount()||s<0)&&(0,n.a)("invalid point index"),t<0&&(t=this.getPointCount()),0===s)return;const r=this.m_pointCount;this.resizeNoInit(this.m_pointCount+s);for(let n=0,o=this.m_description.getAttributeCount();n<o;n++){const o=this.m_description.getSemantics(n),a=i.V.getComponentCount(o);if(this.m_vertexAttributes.get(n))if(0===o)this.m_vertexAttributes.get(n).insertRangeFromPoints(a*t,e,0,s,!0,a*r);else{const e=i.V.getDefaultValue(o);this.m_vertexAttributes.get(n).insertRange(a*t,e,a,a*r)}}this.notifyModifiedFlags(2001)}removePoints(t,e){if((t<0||e<0||t+e>this.getPointCount())&&(0,n.q)("remove_points"),0!==e){for(let s=0,n=this.m_description.getAttributeCount();s<n;s++)if(this.m_vertexAttributes.get(s)){const n=this.m_description.getSemantics(s),r=i.V.getComponentCount(n);this.m_vertexAttributes.get(s).eraseRange(r*t,r*e,r*this.m_pointCount)}this.m_pointCount-=e,this.m_reservedPointCount>0&&(this.m_reservedPointCount-=e),this.notifyModifiedFlags(2001)}}removePoint(t){for(let e=0,s=this.m_description.getAttributeCount();e<s;e++)if(this.m_vertexAttributes.get(e)){const s=this.m_description.getSemantics(e),n=i.V.getComponentCount(s);this.m_vertexAttributes.get(e).eraseRange(n*t,n,n*this.m_pointCount)}this.m_pointCount--,this.m_reservedPointCount>0&&this.m_reservedPointCount--,this.notifyModifiedFlags(2001)}calculateEnvelope2D(){return this.updateXYImpl(!0)}resizeNoInit(t){this.resizeImpl(t)}resizeAndInitNonPositionAttributes(t){const e=this.m_pointCount;if(this.resizeImpl(t),this.m_pointCount>e)for(let s=1,n=this.m_description.getAttributeCount();s<n;s++){const t=this.m_description.getSemantics(s),n=i.V.getDefaultValue(t),r=i.V.getComponentCount(t);this.m_vertexAttributes.get(s).insertRange(r*e,n,r*(this.m_pointCount-e),r*e)}}queryCoordinates3D(t,e,s,r){let o=r<0?this.m_pointCount:r;if(o=Math.min(o,s+e),(s<0||o<s||this.m_pointCount>0&&s>=this.m_pointCount)&&(0,n.a)(""),0===this.m_pointCount)return o;const a=this.getAttributeStreamRef(0);let l=null;const h=i.V.getDefaultValue(1),u=this.m_description.hasAttribute(1);u&&(l=this.getAttributeStreamRef(1));let c=0;for(let n=s;n<o;n++,c++)t[c].x=a.read(2*n),t[c].y=a.read(2*n+1),t[c].z=u?l.read(n):h;return o}queryAttributeAsInt(t,e,s,i){(0,n.g)(0)}add(t){t.isEmpty()&&(0,n.a)(d),this.resizeAndInitNonPositionAttributes(this.m_pointCount+1),this.setPointByValNoCurves(this.m_pointCount-1,t)}addXY(t,e){this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);const s=new r.P(t,e);this.setXYNoCurves(this.m_pointCount-1,s)}addXYZ(t,e,s){this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);const n=new i.d;n.setCoords(t,e,s),this.setXYZNoCurves(this.m_pointCount-1,n)}addPoint2D(t){this.addXY(t.x,t.y)}addPoint3D(t){this.addXYZ(t.x,t.y,t.z)}addPoints(t,e,s){this===t&&(0,n.a)("Multi_point_impl.add");const r=s<0?t.getPointCount():s;if((e<0||e>t.getPointCount()||r<e)&&(0,n.a)(""),e===r)return;const o=t.getDescription();this.mergeVertexDescription(o);const a=r-e,l=this.m_pointCount;this.resizeNoInit(this.m_pointCount+a);for(let n=0,h=this.m_description.getAttributeCount();n<h;n++){const s=this.m_description.getSemantics(n),r=i.V.getComponentCount(s),h=this.getAttributeStreamRef(s);if(o.hasAttribute(s)){const n=t.getAttributeStreamRef(s);h.insertRangeFromStream(l*r,n,e*r,a*r,!0,1,l*r)}else{const t=i.V.getDefaultValue(s);h.insertRange(l*r,t,a*r,l*r)}}}addPoints2D(t,e,s,i){let r=e;const o=i<0?r:i;if((r<0||s<0||s>r||o<s)&&(0,n.a)(""),s===o)return;r=o-s;const a=this.m_pointCount;this.resizeAndInitNonPositionAttributes(this.m_pointCount+r);const l=this.getAttributeStreamRef(0);for(let n=0;n<r;++n)l.writePoint2D(2*(a+n),t[s+n]);this.notifyModifiedFlags(2001)}addPoints3D(t,e,s,i){let o=e;const a=i<0?o:i;if((o<0||s<0||s>o||a<s)&&(0,n.a)(""),this.addAttribute(1),s===a)return;o=a-s;const l=this.m_pointCount;this.resizeAndInitNonPositionAttributes(this.m_pointCount+o);const h=this.getAttributeStreamRef(0),u=new r.P;for(let n=0;n<o;n++)u.x=t[s+n].x,u.y=t[s+n].y,h.writePoint2D(2*(l+n),u);const c=this.getAttributeStreamRef(1);for(let n=0;n<o;n++)c.write(l+n,t[s+n].z);this.notifyModifiedFlags(2001)}setPointByVal(t,e){this.setPointByValNoCurves(t,e)}setXY(t,e){this.setXYNoCurves(t,e)}setXYCoords(t,e,s){this.setXYCoordsNoCurves(t,e,s)}setXYZ(t,e){this.setXYZNoCurves(t,e)}setAttribute(t,e,s,n){this.setAttributeNoCurves(t,e,s,n)}getGeometryType(){return n.G.enumMultiPoint}getDimension(){return 0}createInstance(){return new p({vd:this.getDescription()})}setEmpty(){this.setEmptyImpl()}applyTransformation(t){if(this.isEmpty())return;if(t.isIdentity())return;const e=this.m_vertexAttributes.get(0);1===t.m_TransformationType?e.applyTransformation(t,0,this.m_pointCount):(0,n.t)("3d xform not impl"),this.notifyModifiedFlags(2001)}calculateArea2D(){return 0}calculateLength2D(){return 0}calculateLength3D(t){return 0}equals(t,e){return t.getGeometryType()===n.G.enumMultiPoint&&this.equalsBase(t,e)}queryEnvelope(t){4===t.m_EnvelopeType?(this.updateAllDirtyIntervals(!0),this.m_envelopeData.copyTo(this.m_description,t)):2===t.m_EnvelopeType?this.updateEnvelope(t):(0,n.t)("")}getImpl(){return this}getBoundary(){return null}reserve(t){this.reserveImpl(t)}clone(){const t=this.createInstance();return this.copyTo(t),t}swap(t){(0,n.g)(0)}buildQuadTreeAccelerator(t){return!1}getHashCodeImpl(){return(0,n.g)(0),0}equalsImpl(t){return!0}equalsImplTol(t,e){return!0}copyToImpl(t,e){}}p.type=n.G.enumMultiPoint;class _{constructor(){this.m_EnvelopeType=5,this.envAabb=o.Envelope2D.constructEmpty(),this.envRot=o.Envelope2D.constructEmpty()}static constructEmpty(){return new _}width(){return this.envAabb.width()}height(){return this.envAabb.height()}maxDim(){return Math.max(this.width(),this.height())}setEmpty(){this.envAabb.setEmpty(),this.envRot.setEmpty()}setCoords(t){this.envAabb.setCoords(t),this.envRot.setCoords({x:f(t),y:y(t)})}setFromPoints(t,e){this.setEmpty(),this.mergePoints(t,e)}mergeNe(t){this.envAabb.mergeNe(t),this.envRot.mergeNeCoords(f(t),y(t))}mergePoints(t,e){this.envAabb.mergePoints(t,e);for(let s=0;s<e;){if(!this.envRot.isEmpty()){for(let n=s;n<e;n++){const e=f(t[n]),s=y(t[n]);this.envRot.mergeNeCoords(e,s)}break}{const e=f(t[s]),n=y(t[s]);this.envRot.setCoords({x:e,y:n}),s++}}}isIntersectingPoint2D(t){return!(!this.envAabb.contains(t)||!this.envRot.containsCoords(f(t),y(t)))}isIntersectingW(t){return this.envAabb.isIntersecting(t.envAabb)&&this.envRot.isIntersecting(t.envRot)}containsW(t){return!(!this.envAabb.containsEnvelope(t.envAabb)||!this.envRot.containsEnvelope(t.envRot))}containsPoint2D(t){return this.isIntersectingPoint2D(t)}intersectW(t){const e=this.envAabb.intersect(t.envAabb),s=this.envRot.intersect(t.envRot);return e&&!s&&this.envAabb.setEmpty(),s&&!e&&this.envRot.setEmpty(),e&&s}inflate(t){this.envAabb.inflateCoords(t,t);const e=t*(0,r.D)();this.envRot.inflateCoords(e,e),e<0&&_.st_reduceEmpty(this)}static st_reduceEmpty(t){const e=t.envAabb.isEmpty(),s=t.envRot.isEmpty();e&&!s?t.envRot.setEmpty():s&&!e&&t.envAabb.setEmpty()}sqrMaxMinDistance(t){const e=this.envAabb.sqrMaxMinDistance(t),s=this.envRot.sqrMaxMinDistance(x(t))/2;return Math.max(e,s)}sqrMinDistance(t){const e=this.envAabb.sqrMinDistance(t),s=this.envRot.sqrMinDistance(x(t))/2;return Math.max(e,s)}sqrMaxDistance(t){const e=this.envAabb.sqrMaxDistance(t),s=this.envRot.sqrMaxDistance(x(t))/2;return Math.max(e,s)}getEnvelope2D(){return this.envAabb}getRotatedEnvelope2D(){return this.envRot}xyRot(t,e){const s=function(t,e){return t-e}(t.x,t.y),n=function(t,e){return t+e}(t.x,t.y);e.setCoords(s,n)}}function f(t){return t.x-t.y}function y(t){return t.x+t.y}function x(t){return new r.P(f(t),y(t))}class v{constructor(){this.x=r.H.getNAN(),this.y=r.H.getNAN()}static getNAN(){return new v}static constructPoint2D(t){const e=new v;return e.x.set(t.x),e.y.set(t.y),e}static constructCoords(t,e){const s=new v;return s.x.set(t),s.y.set(e),s}static constructCoordsE(t,e){const s=new v;return s.setCoordsE(t,e),s}get 0(){return this.x.clone()}set 0(t){this.x.setE(t)}get 1(){return this.y.clone()}set 1(t){this.y.setE(t)}clone(){return(new v).setE(this)}scaleThis(t){return this.x.mulThisE(t),this.y.mulThisE(t),this}setCoords(t,e){return this.x.set(t),this.y.set(e),this}setCoordsE(t,e){return this.x.setE(t),this.y.setE(e),this}set(t){return this.x.set(t.x),this.y.set(t.y),this}setE(t){return this.x.setE(t.x),this.y.setE(t.y),this}setWithEps(t,e){return this.x.setWithEps(t.x,e),this.y.setWithEps(t.y,e),this}getUnitVector(){const t=this.clone();return t.normalize(),t}sqrLength(){return this.x.sqr().addE(this.y.sqr())}length(){return this.sqrLength().sqrt()}mulE(t){const e=new v;return e.setCoordsE(this.x.mulE(t),this.y.mulE(t)),e}mul(t){const e=new v;return e.setCoordsE(this.x.mul(t),this.y.mul(t)),e}mulThis(t){return this.x.mulThis(t),this.y.mulThis(t),this}mulThisE(t){return this.x.mulThisE(t),this.y.mulThisE(t),this}divE(t){return this.clone().divThisE(t)}divThisE(t){return this.x.divThisE(t),this.y.divThisE(t),this}normalize(){const t=this.length();0===t.value()?(this.x=r.I.clone(),this.y=r.J.clone()):(this.x.divThisE(t),this.y.divThisE(t))}addE(t){return this.clone().addThisE(t)}addThisE(t){return this.x.addThisE(t.x),this.y.addThisE(t.y),this}subE(t){return this.clone().subThisE(t)}subThisE(t){return this.x.subThisE(t.x),this.y.subThisE(t.y),this}static distance(t,e){return t.subE(e).length()}negateThis(){return this.x.negateThis(),this.y.negateThis(),this}eq(t){return this.x.eq(t.x)&&this.y.eq(t.y)}isZero(){return this.x.isZero()&&this.y.isZero()}isTrueZero(){return!this.x.value()&&!this.y.value()}rotateDirect(t,e){const s=this.x.mulE(t).subThisE(this.y.mulE(e)),n=this.x.mulE(e).addThisE(this.y.mulE(t));return this.x.setE(s),this.y.setE(n),this}rotateReverse(t,e){const s=this.x.mulE(t).addThisE(this.y.mulE(e)),n=this.x.negate().mulThisE(e).addThisE(this.y.mulE(t));return this.x.setE(s),this.y.setE(n),this}dotProduct(t){return this.x.mulE(t.x).addE(this.y.mulE(t.y))}crossProduct(t){return this.x.mulE(t.y).subE(this.y.mulE(t.x))}value(){return r.P.construct(this.x.value(),this.y.value())}}class b{constructor(){this.a11=new r.H(1),this.a12=new r.H(0),this.a21=new r.H(0),this.a22=new r.H(1)}clone(){const t=new b;return t.a11.setE(this.a11),t.a12.setE(this.a12),t.a21.setE(this.a21),t.a22.setE(this.a22),t}assign(t){return this.a11.setE(t.a11),this.a12.setE(t.a12),this.a21.setE(t.a21),this.a22.setE(t.a22),this}mulThis(t){const e=this.a11.mulE(t.a11).addThisE(this.a12.mulE(t.a21)),s=this.a11.mulE(t.a12).addThisE(this.a12.mulE(t.a22)),n=this.a21.mulE(t.a11).addThisE(this.a22.mulE(t.a21)),i=this.a21.mulE(t.a12).addThisE(this.a22.mulE(t.a22));return this.a11=e,this.a12=s,this.a21=n,this.a22=i,this}mulLeftThis(t){const e=t.clone();return this.assign(e.mulThis(this)),this}det(){return this.a11.mulE(this.a22).subThisE(this.a12.mulE(this.a21))}invertThis(){const t=this.det();if(0!==t.value()){const e=this.a22.divE(t),s=this.a12.negate().divThisE(t),n=this.a21.negate().divThisE(t),i=this.a11.divE(t);this.a11=e,this.a12=s,this.a21=n,this.a22=i}else this.setZero();return!t.isZero()}transposeThis(){return this.a21=(0,r.c)(this.a12,this.a12=this.a21),this}eigenSymmetric(t,e){const s=this.a12.clone();s.addThisE(this.a21),s.mulThisByPower2(.5);let n=new r.H(1),i=new r.H(0);if(s.isZero())t[0].setE(this.a11),t[1].setE(this.a22);else{const e=new r.H(1);if(this.a11.ne(this.a22)){const o=this.a11.subE(this.a22).divE(s);o.mulThisByPower2(.5);const a=o.sqr();e.setE(o),e.absThis(),e.subThisE(a.add(1).sqrtThis()),o.gt(r.J)&&e.negateThis();const l=e.sqr().addThis(1).sqrtThis().invThis();i=e.mulE(l),n.setE(l);const h=e.mulE(s);t[0]=this.a11.addE(h),t[1]=this.a22.subE(h)}else n=new r.H(1/Math.sqrt(2)),i=n.clone(),t[0]=this.a11.addE(s),t[1]=this.a22.subE(s)}e[0].x=n.toDouble(),e[0].y=i.toDouble(),e[1].x=i.negate().toDouble(),e[1].y=n.toDouble(),Math.abs(t[0].toDouble())>Math.abs(t[1].toDouble())&&(t[1]=(0,r.c)(t[0],t[0]=t[1]),e[1]=(0,r.c)(e[0],e[0]=e[1]))}setZero(){this.a11.set(0),this.a21.set(0),this.a12.set(0),this.a22.set(0)}}class P{static constructPoint2D(t){return new P(r.M.constructDouble(t.x),r.M.constructDouble(t.y))}constructor(t,e){if(void 0===t)return this.x=(new r.M).setNAN(),void(this.y=(new r.M).setNAN());this.x=t.clone(),this.y=e.clone()}assignPoint2D(t){return this.x.setDouble(t.x),this.y.setDouble(t.y),this}setCoords(t,e){return this.x.setThis(t),this.y.setThis(e),this}asPoint2D(){return new r.P(this.x.value(),this.y.value())}crossProduct(t){return this.x.mul(t.y).sub(this.y.mul(t.x))}leftPerpendicularThis(){const t=this.x.clone();this.x=this.y.clone().negate(),this.y=t}clone(){return new P(this.x,this.y)}dotProduct(t){return this.x.mul(t.x).add(this.y.mul(t.y))}add(t){return new P(this.x.add(t.x),this.y.add(t.y))}sub(t){return new P(this.x.sub(t.x),this.y.sub(t.y))}sqrLength(){return this.x.sqr().addThis(this.y.sqr())}mulThis(t){return this.x.mulThis(t),this.y.mulThis(t),this}mul(t){return this.clone().mulThis(t)}subThis(t){return this.x.subThis(t.x),this.y.subThis(t.y),this}addThis(t){return this.x.addThis(t.x),this.y.addThis(t.y),this}}var S=i.V;function E(t){let e=!1;for(let s=0;s<2;s++){const n=(0,r.F)(t[0][s],t[3][s]);n>0?((0,r.F)(t[0][s],t[1][s])<0&&(t[1][s]=t[0][s],e=!0),(0,r.F)(t[1][s],t[3][s])<0&&(t[1][s]=t[3][s],e=!0),(0,r.F)(t[0][s],t[2][s])<0&&(t[2][s]=t[0][s],e=!0),(0,r.F)(t[2][s],t[3][s])<0&&(t[2][s]=t[3][s],e=!0),(0,r.F)(t[1][s],t[2][s])<0&&(t[2][s]=t[1][s],e=!0)):n<0?((0,r.F)(t[0][s],t[1][s])>0&&(t[1][s]=t[0][s],e=!0),(0,r.F)(t[1][s],t[3][s])>0&&(t[1][s]=t[3][s],e=!0),(0,r.F)(t[0][s],t[2][s])>0&&(t[2][s]=t[0][s],e=!0),(0,r.F)(t[2][s],t[3][s])>0&&(t[2][s]=t[3][s],e=!0),(0,r.F)(t[1][s],t[2][s])>0&&(t[2][s]=t[1][s],e=!0)):t[1][s]===t[0][s]&&t[2][s]===t[0][s]||(t[1][s]=t[0][s],t[2][s]=t[0][s],e=!0)}return e}function C(t,e){const s=t.getStartXY();if(s.equals(e.getStartXY()))return!0;if(s.equals(e.getEndXY()))return!0;const n=t.getEndXY();return!!n.equals(e.getStartXY())||!!n.equals(e.getEndXY())}function w(t,e){let s=t.calculateLowerLength2D();return!(s>e)&&(!!t.isLine()||(s=t.calculateUpperLength2D(),s<=e||0!==e&&t.calculateLength2D()<=e))}function I(t,e,s){const i=(0,r.m)(r.P,4);let o=t.queryControlPointsHelper(i);const a=(0,r.m)(r.P,4);let l=e.queryControlPointsHelper(a);i[0].equals(a[0])||(0,n.w)("");const h=t.getGeometryType();if(h===e.getGeometryType()&&i.map(((t,e)=>a[e].equals(t))).reduce(((t,e)=>t&&e))){if(h!==n.G.enumRationalBezier2)return 0;{const s=e,n=[0,0,0],i=[0,0,0];if(t.queryWeights(n),s.queryWeights(i),n.map(((t,e)=>i[e]===t)).reduce(((t,e)=>t&&e)))return 0}}for(;o>2&&i[1].equals(i[0]);)i.splice(1,1),o--;for(;l>2&&a[1].equals(a[0]);)a.splice(1,1),l--;(i[1].equals(i[0])||a[1].equals(i[0]))&&(0,n.w)("");const u=r.P.compareVectorsOrigin(i[0],i[1],a[1]);if(0===u){const s=P.constructPoint2D(i[0]),n=new P;t.queryCoord2DMP(1e-16,n),n.sub(s);const r=new P;return e.queryCoord2DMP(1e-16,r),r.sub(s),r.crossProduct(n).sign()}return u}function T(t,e,s,i,o,a,l,h){let u=t.calculateUpperLength2D(),c=e.calculateUpperLength2D(),m=t,d=e,g=!1;u>c&&(d=(0,r.c)(m,m=d),i=(0,r.c)(s,s=i),c=(0,r.c)(u,u=c),g=!0);const p=0===s;{l[0]=p?1:0;const t=m.getCoord2D(l[0]);h[0]=d.getClosestCoordinate(t,!1);const e=d.getCoord2D(h[0]);if(r.P.distance(t,e)<=o){const e=[.5,.75,.25,.1,.9];let s=!0;for(let n=0;n<e.length;n++)if(t.assign(m.getCoord2D(e[n])),!d.isCloserThanDistance(t,new r.E(0,1),o)){s=!1;break}if(s)return g&&(h[0]=(0,r.c)(l[0],l[0]=h[0])),1}}if(u<=3*o)return 0;let _=(0,r.s)(Math.max(o/u,.1),0,.5),f=.01*o,y=0,x=0,v=_,b=-1,P=0,S=1/32;for(let E=0;;E++){(0,n.g)(E<4095);const t=p?_:1-_,e=m.getCoord2D(t),s=d.getClosestCoordinate(e,!1);if(s===i)return P;const u=d.getCoord2D(s),c=r.P.distance(e,u);if(0===E&&(b=c),c<=f?(S=.5,x=c,y=_):(v=_,b=c),Math.abs(x-b)>.1*f&&v-y>1e-16)_=(0,r.q)(y,v,S);else{if(l[P]=t,h[P]=s,g&&(h[P]=(0,r.c)(l[P],l[P]=h[P])),1===a||1===P)return 1===P&&l[0]>l[1]&&(l[1]=(0,r.c)(l[0],l[0]=l[1]),h[1]=(0,r.c)(h[0],h[0]=h[1])),P+1;P++,y=v,x=b,v=.8,b=-1,_=.8,S=1/32,f=10*o,E=0}}}function A(t,e,s,n,i,o,a,l,h){if((0,r.N)(s,0,1)&&(0,r.N)(n,0,1)&&0===r.P.distance(t.getCoord2D(s),e.getCoord2D(n))){const h=1e-12,u=new v,c=(0,r.O)();if(t.queryDerivative(new r.H(s,c),u),u.isTrueZero()){const e=1===s?-1e-12:h;t.queryDerivative(new r.H(s,c).add(e),u)}1===s&&u.negateThis();const m=new v;if(e.queryDerivative(new r.H(n,c),m),m.isTrueZero()){const t=1===s?-1e-12:h;e.queryDerivative(new r.H(n,c).add(t),m)}1===n&&m.negateThis(),u.isZero()||u.normalize(),m.isZero()||m.normalize();const d=u.dotProduct(m),g=u.crossProduct(m);g.scaleError(3);const p=()=>{{const s=t.calculateUpperLength2D(),n=e.calculateUpperLength2D();return Math.min(.01*i/Math.min(s,n),1e-10)}};if(d.ge(r.J)&&(g.isZero()||Math.abs(g.value())<p()))return T(t,e,s,n,i,o,a,l)}return 0}function M(t,e){t.m_XStart=e.x,t.m_YStart=e.y}function D(t,e,s){t.m_XStart=e,t.m_YStart=s}function N(t,e){t.m_XEnd=e.x,t.m_YEnd=e.y}function F(t,e,s){t.m_XEnd=e,t.m_YEnd=s}function R(t,e){const s=new i.d;return e?(s.x=t.m_XEnd,s.y=t.m_YEnd):(s.x=t.m_XStart,s.y=t.m_YStart),s.z=function(t,e){return t.m_description.hasZ()?t.m_attributes[e*(t.m_description.getTotalComponentCount()-2)]:S.getDefaultValue(1)}(t,e),s}function k(t,e,s){t.m_description.hasZ()||t.addAttribute(1),e?t.m_XEnd===s.x&&t.m_YEnd===s.y||(t.m_XEnd=s.x,t.m_YEnd=s.y,t.endPointModified()):t.m_XStart===s.x&&t.m_YStart===s.y||(t.m_XStart=s.x,t.m_YStart=s.y,t.endPointModified()),t.m_attributes[(t.m_description.getTotalComponentCount()-2)*e]=s.z}function L(t,e,s){s.assignVertexDescription(t.m_description);const n=0===e?t.m_XStart:t.m_XEnd,i=0===e?t.m_YStart:t.m_YEnd;s.setXYCoords(n,i);for(let r=1;r<t.m_description.getAttributeCount();r++){const n=t.m_description.getSemantics(r);for(let i=0,r=S.getComponentCount(n);i<r;i++){const r=V(t,e,n,i);s.setAttributeBasic(n,i,r)}}}function G(t,e,s){s.isEmpty()&&(0,n.u)(""),function(t,e,s){e?t.m_XEnd===s.x&&t.m_YEnd===s.y||(t.m_XEnd=s.x,t.m_YEnd=s.y,t.endPointModified()):t.m_XStart===s.x&&t.m_YStart===s.y||(t.m_XStart=s.x,t.m_YStart=s.y,t.endPointModified())}(t,e,s.getXY());const i=s.getDescription();i!==t.m_description&&t.mergeVertexDescription(i);for(let n=1,r=i.getAttributeCount();n<r;n++){const r=i.getSemantics(n),o=S.getComponentCount(r);for(let n=0;n<o;n++)z(t,e,r,n,s.getAttributeAsDbl(r,n))}}function V(t,e,s,i){if((e<0||e>1)&&(0,n.q)(""),0===s)return(i<0||i>=2)&&(0,n.q)(""),0===e?0===i?t.m_XStart:t.m_YStart:0===i?t.m_XEnd:t.m_YEnd;const r=S.getComponentCount(s);(i<0||i>=r)&&(0,n.q)("");const o=t.m_description.getAttributeIndex(s);return o>=0?t.m_attributes[e*(t.m_description.getTotalComponentCount()-2)+t.m_description.getPointAttributeOffset(o)-2+i]:S.getDefaultValue(s)}function z(t,e,s,i,r){if((e<0||e>1)&&(0,n.q)(""),0===s)return 0===e?0===i?t.m_XStart=r:1===i?t.m_YStart=r:(0,n.q)(""):1===e?0===i?t.m_XEnd=r:1===i?t.m_YEnd=r:(0,n.q)(""):(0,n.q)(""),void t.endPointModified();const o=S.getComponentCount(s);(i<0||i>=o)&&(0,n.q)("");let a=t.m_description.getAttributeIndex(s);a<0&&(t.addAttribute(s),a=t.m_description.getAttributeIndex(s)),t.m_attributes[e*(t.m_description.getTotalComponentCount()-2)+t.m_description.getPointAttributeOffset(a)-2+i]=r}function O(t,e){if(t===e)return;e.isEmpty()&&(0,n.u)("");const s=e.getDescription();s!==t.m_description&&t.mergeVertexDescription(s);for(let n=1,i=s.getAttributeCount();n<i;n++){const i=s.getSemantics(n),r=S.getComponentCount(i);for(let s=0;s<r;s++){let n=V(e,0,i,s);z(t,0,i,s,n),n=V(e,1,i,s),z(t,1,i,s,n)}}}function q(t){return t.absNorm()*(0,r.g)()}function B(t,e){return Math.max(t.absNorm(),e.absNorm())*(0,r.g)()}function Y(t,e,s){const n=new _;t.queryEnvelopeW(r.E.unit(),n);const i=new _;return e.queryEnvelopeW(r.E.unit(),i),i.inflate(s),!n.isIntersectingW(i)}function U(t,e,s){const n=(0,r.L)(t,s),i=(0,r.L)(e,s);n.sort(((t,e)=>t.compare(e))),i.sort(((t,e)=>t.compare(e)));for(let r=0;r<3;r++){if(n[r].compare(i[r])<0)return-1;if(0!==n[r].compare(i[r]))return 1}return 0}var H=i.V;class X{constructor(t){if(t.copy)this.m_XStart=t.copy.m_XStart,this.m_YStart=t.copy.m_YStart,this.m_XEnd=t.copy.m_XEnd,this.m_YEnd=t.copy.m_YEnd,this.m_description=t.copy.m_description,this.m_attributes=null,this.m_description&&this.m_description.getTotalComponentCount()-2&&(this.m_attributes=t.copy.m_attributes.slice());else{if(t.move)return this.m_description=t.move.m_description,t.move.m_description=null,this.m_attributes=t.move.m_attributes,t.move.m_attributes=null,this.m_XStart=t.move.m_XStart,this.m_YStart=t.move.m_YStart,this.m_XEnd=t.move.m_XEnd,void(this.m_YEnd=t.move.m_YEnd);if(void 0!==t.XStart)return this.m_XStart=t.XStart,this.m_YStart=t.YStart,this.m_XEnd=t.XEnd,this.m_YEnd=t.YEnd,this.m_attributes=null,this.m_description=t.vd?t.vd:(0,i.j)(),void(t.vd&&this.setDefaultAttributeValues());if(void 0!==t.ZStart)return this.m_XStart=t.XStart,this.m_YStart=t.YStart,this.m_XEnd=t.XEnd,this.m_YEnd=t.YEnd,this.m_description=t.vd?t.vd:(0,i.w)(),void(t.vd?(this.setDefaultAttributeValues(),this.addAttribute(1),this.m_attributes[0]=t.ZStart,this.m_attributes[this.m_description.getTotalComponentCount()-2]=t.ZEnd):this.m_attributes=[t.ZStart,t.ZEnd]);if(t.start)return this.m_XStart=t.start.x,this.m_YStart=t.start.y,this.m_XEnd=t.end.x,this.m_YEnd=t.end.y,this.m_attributes=null,void(this.m_description=(0,i.j)());if(t.start3D)return this.m_XStart=t.start3D.x,this.m_YStart=t.start3D.y,this.m_XEnd=t.end3D.x,this.m_YEnd=t.end3D.y,this.m_description=t.vd?t.vd:(0,i.w)(),void(t.vd?(this.setDefaultAttributeValues(),this.addAttribute(1),this.m_attributes[0]=t.start3D.z,this.m_attributes[this.m_description.getTotalComponentCount()-2]=t.end3D.z):this.m_attributes=[t.start3D.z,t.end3D.z]);(0,n.d)("bad constructor params"),this.m_XStart=this.m_YStart=this.m_XEnd=this.m_YEnd=Number.NaN}}setDefaultAttributeValues(){const t=this.m_description.getTotalComponentCount()-2;t>0&&(null===this.m_attributes&&(this.m_attributes=(0,r.d)(2*t,Number.NaN)),(0,r.b)(this.m_attributes,this.m_description.getDefaultPointAttributes(),0,2,t),(0,r.b)(this.m_attributes,this.m_description.getDefaultPointAttributes(),t,2,t))}absNormXYZ(t){return(0,n.t)("not implemented"),0}queryWeights(t){}snapControlPoints3D(){return(0,n.t)("not implemented"),!1}setCoordsForIntersector3D(t,e,s){(0,n.t)("not implemented")}transformAttribute(t,e,s,i,r){(0,n.t)("")}mergeVertexDescriptionImpl(t){const e=this.getDescription(),s=(0,i.l)(e,t);this.assignVertexDescription(s)}changeEndPoints(t,e){const s=t.getXY(),n=e.getXY();this.changeEndPoints2D(s,n);let i=t.getDescription();i!==this.getDescription()&&this.mergeVertexDescription(i),i=e.getDescription(),i!==this.getDescription()&&this.mergeVertexDescription(i);for(let r=1,o=i.getAttributeCount();r<o;r++){const s=i.getSemantics(r),n=H.getComponentCount(s);for(let i=0;i<n;i++)z(this,0,s,i,t.getAttributeAsDbl(s,i)),z(this,1,s,i,e.getAttributeAsDbl(s,i))}}getStartXY(){return new r.P(this.m_XStart,this.m_YStart)}setStartXY(t){this.m_XStart=t.x,this.m_YStart=t.y,this.endPointModified()}setStartXYCoords(t,e){this.m_XStart=t,this.m_YStart=e,this.endPointModified()}getStartXYZ(){return R(this,0)}setStartXYZ(t){k(this,0,t)}setStartXYZCoords(t,e,s){k(this,0,i.d.construct(t,e,s))}queryStart(t){L(this,0,t)}setStart(t){G(this,0,t)}setStart2D(t){this.setStartXY(t)}getStartAttributeAsDbl(t,e){return V(this,0,t,e)}getStartAttributeAsInt(t,e){return(0,n.g)(0),0}setStartAttribute(t,e,s){z(this,0,t,e,s)}setStartAttributesFromPoint(t,e){const s=t.getDescription();for(let n=e&&s.hasZ()?2:1,i=s.getAttributeCount();n<i;++n){const e=s.getSemantics(n),i=H.getComponentCount(e);for(let s=0;s<i;++s){const n=t.getAttributeAsDbl(e,s);this.setStartAttribute(e,s,n)}}}setEndAttributesFromPoint(t,e){const s=t.getDescription();for(let n=e&&s.hasZ()?2:1,i=s.getAttributeCount();n<i;++n){const e=s.getSemantics(n),i=H.getComponentCount(e);for(let s=0;s<i;++s){const n=t.getAttributeAsDbl(e,s);this.setEndAttribute(e,s,n)}}}getStartX(){return this.m_XStart}getStartY(){return this.m_YStart}getStartZ(){return(0,n.g)(0),0}getEndX(){return this.m_XEnd}getEndY(){return this.m_YEnd}getEndZ(){return(0,n.g)(0),0}getEndXY(){return new r.P(this.m_XEnd,this.m_YEnd)}setEndXY(t){this.m_XEnd=t.x,this.m_YEnd=t.y,this.endPointModified()}setEndXYCoords(t,e){this.m_XEnd=t,this.m_YEnd=e,this.endPointModified()}getEndXYZ(){return R(this,1)}setEndXYZ(t){k(this,1,t)}setEndXYZCoords(t,e,s){k(this,1,i.d.construct(t,e,s))}queryEnd(t){L(this,1,t)}setEnd(t){G(this,1,t)}setEnd2D(t){this.setEndXY(t)}getEndAttributeAsDbl(t,e){return V(this,1,t,e)}getEndAttributeAsInt(t,e){return(0,n.g)(0),Math.trunc(0)}setEndAttribute(t,e,s){z(this,1,t,e,s)}getDimension(){return 1}copyTo(t){if(this===t)return;t.getGeometryType()!==this.getGeometryType()&&(0,n.a)("");const e=t;e.assignVertexDescription(this.m_description),e.m_attributes&&(0,r.b)(e.m_attributes,this.m_attributes,0,0,2*(this.m_description.getTotalComponentCount()-2)),e.m_XStart=this.m_XStart,e.m_YStart=this.m_YStart,e.m_XEnd=this.m_XEnd,e.m_YEnd=this.m_YEnd,this.copyToImpl(e)}isEmpty(){return this.isEmptyImpl()}isClosed(){return this.m_XStart===this.m_XEnd&&this.m_YStart===this.m_YEnd}setEmpty(){}calculateArea2D(){return 0}queryInterval(t,e){const s=r.E.constructEmpty();return s.vmin=V(this,0,t,e),s.vmax=s.vmin,s.mergeNeCoordinate(V(this,1,t,e)),s}calculateLength3D(t){return(0,n.g)(0),0}getCoord3D(t){return(0,n.g)(0),{}}getCoord2D(t){const e=r.P.getNAN();return this.queryCoord2D(t,e),e}queryCoord3D(t,e){(0,n.g)(0)}getCoordZ(t){return(0,n.g)(0),0}queryCoord(t,e){e.assignVertexDescription(this.m_description),e.setXY(this.getCoord2D(t));for(let s=1,n=this.m_description.getAttributeCount();s<n;s++){const n=this.m_description.getSemantics(s),i=H.getComponentCount(n);for(let s=0;s<i;s++){const i=this.getAttributeAsDbl(t,n,s);e.setAttributeBasic(n,s,i)}}}isCloserThanDistance(t,e,s){const n=o.Envelope2D.constructEmpty();if(this.queryLooseEnvelopeOnInterval(e,n),n.distance(t)>s)return!1;const i=this.getClosestCoordinateOnInterval(t,e,s);return!Number.isNaN(i)&&r.P.distance(t,this.getCoord2D(i))<=s}isMonotoneQuickAndDirty(){return!1}isTrue3D(){return!1}getReversed(){const t=this.clone();return t.reverse(),t}reverse(){this.m_XEnd=(0,r.c)(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=(0,r.c)(this.m_YStart,this.m_YStart=this.m_YEnd),this.reverseImpl();for(let t=1,e=this.m_description.getAttributeCount();t<e;t++){const e=this.m_description.getSemantics(t);for(let t=0,s=H.getComponentCount(e);t<s;t++){const s=V(this,0,e,t);z(this,0,e,t,V(this,1,e,t)),z(this,1,e,t,s)}}return this.afterCompletedModification(),this}isEmptyImpl(){return!1}isCircular(){return!1}distance(t,e,s,i){if(!e&&this.isIntersecting(t,0,!1)){if(null!==s||null!==i){const e=(0,r.d)(9,Number.NaN),o=(0,r.d)(9,Number.NaN),a=this.intersect(t,null,e,o,0);(0,n.g)(a<=9),0===a&&(0,n.d)(""),null!==s&&(s[0]=e[0]),null!==i&&(i[0]=o[0])}return 0}let o,a=Number.MAX_VALUE,l=-1,h=a;return o=this.getStartXY(),l=t.getClosestCoordinate(o,!1),o.subThis(t.getCoord2D(l)),h=o.length(),h<a&&(a=h,null!==i&&(i[0]=l),null!==s&&(s[0]=0)),o=this.getEndXY(),l=t.getClosestCoordinate(o,!1),o.subThis(t.getCoord2D(l)),h=o.length(),h<a&&(a=h,null!==i&&(i[0]=l),null!==s&&(s[0]=1)),o=t.getStartXY(),l=this.getClosestCoordinate(o,!1),o.subThis(this.getCoord2D(l)),h=o.length(),h<a&&(a=h,null!==s&&(s[0]=l),null!==i&&(i[0]=0)),o=t.getEndXY(),l=this.getClosestCoordinate(o,!1),o.subThis(this.getCoord2D(l)),h=o.length(),h<a&&(a=h,null!==s&&(s[0]=l),null!==i&&(i[0]=1)),a}calculateSubLengthFromStart(t){return this.tToLength(t)}calculateSubLength(t,e){return e===t?0:this.tToLength(e)-this.tToLength(t)}static recalculateParentT(t,e,s){return(0,r.q)(t,e,s)}moveTo(t){const e=this.isClosed(),s=new a.T;s.setShift(t.sub(this.getStartXY())),this.applyTransformation(s),e?this.changeEndPoints2D(t,t):this.changeEndPoints2D(t,this.getEndXY())}moveTo3D(t){(0,n.g)(0)}getDescription(){return this.m_description}assignVertexDescription(t){!function(t,e){const s=(0,i.p)();(0,i.q)(e,t.m_description,s);let n=null;const o=e.getTotalComponentCount()-2,a=t.m_description?t.m_description.getTotalComponentCount()-2:0;if(o>0&&(n=(0,r.d)(2*o,Number.NaN),(0,r.b)(n,e.getDefaultPointAttributes(),0,2,o),(0,r.b)(n,e.getDefaultPointAttributes(),o,2,o),null!==t.m_description))for(let i=1;i<e.getAttributeCount();i++){const r=s[i];if(-1!==r){const s=t.m_description.getPointAttributeOffset(r)-2,l=e.getPointAttributeOffset(i)-2,h=S.getComponentCount(e.getSemantics(i));for(let e=0;e<h;++e)n[l]=t.m_attributes[s],n[o+l]=t.m_attributes[a+s]}}t.m_attributes=n,t.m_description=e}(this,t)}mergeVertexDescription(t){this.m_description!==t&&(this.m_description.hasAttributesFrom(t)||this.mergeVertexDescriptionImpl(t))}hasAttribute(t){return this.m_description.hasAttribute(t)}addAttribute(t){if(this.m_description.hasAttribute(t))return;const e=(0,i.m)(this.m_description,t);this.assignVertexDescription(e)}dropAttribute(t){if(!this.m_description.hasAttribute(t))return;const e=(0,i.r)(this.m_description,t);this.assignVertexDescription(e)}dropAllAttributes(){const t=(0,i.j)();t!==this.m_description&&this.assignVertexDescription(t)}swap(t){if(this===t)return;t.getGeometryType()!==this.getGeometryType()&&(0,n.a)("wrong geometry type");const e=t;e.m_description=(0,r.c)(this.m_description,this.m_description=e.m_description),e.m_XStart=(0,r.c)(this.m_XStart,this.m_XStart=e.m_XStart),e.m_YStart=(0,r.c)(this.m_YStart,this.m_YStart=e.m_YStart),e.m_XEnd=(0,r.c)(this.m_XEnd,this.m_XEnd=e.m_XEnd),e.m_YEnd=(0,r.c)(this.m_YEnd,this.m_YEnd=e.m_YEnd),e.m_attributes=(0,r.c)(this.m_attributes,this.m_attributes=e.m_attributes),this.swapImpl(e)}equals(t,e){if(this.getGeometryType()!==t.getGeometryType())return!1;const s=void 0===e;s&&(e=0);const n=t;if(this===n)return!0;if(this.m_description!==n.m_description)return!1;if(Math.abs(this.m_XStart-n.m_XStart)>e||Math.abs(this.m_XEnd-n.m_XEnd)>e||Math.abs(this.m_YStart-n.m_YStart)>e||Math.abs(this.m_YEnd-n.m_YEnd)>e)return!1;for(let i=0,o=2*(this.m_description.getTotalComponentCount()-2);i<o;i++)if(!(0,r.G)(this.m_attributes[i],n.m_attributes[i],e))return!1;return s?this.equalsImpl(n):this.equalsImplTol(n,e)}getImpl(){return this}setAttributeBasic(t,e,s){if(this.addAttribute(t),0===t&&this.isCurve()){(e<0||e>1)&&(0,n.a)("");const t=new a.T,i=0===e?s:0,r=1===e?s:0;t.setShiftCoords(i,r),0===e?t.xx=0:t.yy=0,this.applyTransformation(t)}else this.setStartAttribute(t,e,s),this.setEndAttribute(t,e,s)}replaceNaNs(t,e){if(this.addAttribute(t),this.isEmpty())return;const s=H.getComponentCount(t);for(let n=0;n<s;n++){const s=this.getStartAttributeAsDbl(t,n);Number.isNaN(s)&&this.setStartAttribute(t,n,e);const i=this.getEndAttributeAsDbl(t,n);Number.isNaN(i)&&this.setEndAttribute(t,n,e)}}}X.s_maxMonotonicPartParams=8;class j extends l.G{constructor(t,e){super(),this.m_index=-1,this.gc=t,this.dim=e}next(){for(;;){if(this.m_index>=this.gc.getGeometryCount())return null;if(this.m_index++,this.m_index===this.gc.getGeometryCount())return null;const t=this.gc.getGeometry(this.m_index);if(-1===this.dim||1<<t.getDimension()&this.dim)return t}return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}class Z{constructor(t){this.m_geoms=[],this.m_description=(0,i.j)(),t&&(t.vd?this.m_description=t.vd:t.copy?t.copy.copyTo(this):(0,n.a)("constructor argument not recognized"))}getGeometryCount(){return this.m_geoms.length}reserve(t){}addGeometry(t){if(t.getGeometryType()===n.G.enumGeometryCollection){const e=t;for(let t=0,s=e.getGeometryCount();t<s;t++)this.addGeometry(e.getGeometry(t))}else this.m_geoms.push(t.clone()),this.mergeVertexDescription(t.getDescription())}addCursor(t){for(let e=t.next();null!==e;e=t.next())this.addGeometry(e)}getGeometry(t){return(t<0||t>=this.m_geoms.length)&&(0,n.a)("Geometry_collection.get_geometry"),this.m_geoms[t]}modifiedElementIndex(t){this.mergeVertexDescription(this.getGeometry(t).getDescription())}modifiedElement(t){this.mergeVertexDescription(t.getDescription())}getGeometryType(){return n.G.enumGeometryCollection}getDimension(){let t=0;for(const e of this.m_geoms)t=Math.max(t,e.getDimension());return t}getDescription(){return this.m_description}assignVertexDescription(t){this.m_description!==t&&this.assignVertexDescriptionImpl(t)}assignVertexDescriptionImpl(t){for(const e of this.m_geoms)e.assignVertexDescription(t);this.m_description=t}mergeVertexDescription(t){this.m_description!==t&&(this.m_description.hasAttributesFrom(t)||this.mergeVertexDescriptionImpl(t))}hasAttribute(t){return this.m_description.hasAttribute(t)}addAttribute(t){if(this.m_description.hasAttribute(t))return;const e=(0,i.m)(this.m_description,t);this.assignVertexDescription(e)}dropAttribute(t){if(!this.m_description.hasAttribute(t))return;const e=(0,i.r)(this.m_description,t);this.assignVertexDescription(e)}dropAllAttributes(){const t=(0,i.j)();t!==this.m_description&&this.assignVertexDescription(t)}queryInterval(t,e){let s=new r.E;const n=new r.E;n.setEmpty();for(const i of this.m_geoms)s=i.queryInterval(t,e),n.merge(s);return n}queryEnvelope(t){if(4===t.m_EnvelopeType){const e=new i.E;t.setEmpty(),t.assignVertexDescription(this.m_description);for(const s of this.m_geoms)s.queryEnvelope(e),t.merge(e)}else if(2===t.m_EnvelopeType){const e=new o.Envelope2D;t.setEmpty();for(const s of this.m_geoms)s.queryEnvelope(e),t.mergeEnvelope2D(e)}(0,n.t)("3d envelope case not implemented")}queryLooseEnvelope(t){if(2===t.m_EnvelopeType){const e=new o.Envelope2D;t.setEmpty();for(const s of this.m_geoms)s.queryLooseEnvelope(e),t.mergeEnvelope2D(e)}(0,n.t)("3d not impl")}isEmpty(){return 0===this.m_geoms.length}setEmpty(){this.m_geoms.length=0}applyTransformation(t){if(1===t.m_TransformationType)for(const e of this.m_geoms)e.applyTransformation(t);(0,n.t)("3d xform not impl")}transformAttribute(t,e,s,n,i){for(const r of this.m_geoms)r.transformAttribute(t,e,s,n,i)}createInstance(){return new Z({vd:this.getDescription()})}copyTo(t){t.getGeometryType()!==n.G.enumGeometryCollection&&(0,n.a)("");const e=t;if(e!==this){e.m_geoms.length=0,e.assignVertexDescription(this.m_description);for(const t of this.m_geoms)e.m_geoms.push(t.clone())}}calculateArea2D(){const t=new r.K(0);for(const e of this.m_geoms)t.pe(e.calculateArea2D());return t.getResult()}calculateLength2D(){const t=new r.K(0);for(const e of this.m_geoms)t.pe(e.calculateLength2D());return t.getResult()}calculateLength3D(t){return(0,n.g)(0),0}getBoundary(){const t=this.createInstance(),e=t;for(const s of this.m_geoms){const t=s.getBoundary();t&&e.m_geoms.push(t)}return t}clone(){return new Z({copy:this})}equals(t,e){if(t===this)return!0;if(t.getGeometryType()!==n.G.enumGeometryCollection)return!1;const s=t;if(this.m_description!==s.m_description)return!1;if(this.m_geoms.length!==s.m_geoms.length)return!1;for(let n=0;n<this.m_geoms.length;++n)if(!this.m_geoms[n].equals(s.m_geoms[n],e))return!1;return!0}swap(t){t.getGeometryType()!==n.G.enumGeometryCollection&&(0,n.a)("");const e=t;e!==this&&(this.m_geoms=(0,r.c)(e.m_geoms,e.m_geoms=this.m_geoms))}setAttributeBasic(t,e,s){for(const n of this.m_geoms)n.setAttributeBasic(t,e,s)}replaceNaNs(t,e){for(const s of this.m_geoms)s.replaceNaNs(t,e)}getImpl(){return this}mergeVertexDescriptionImpl(t){const e=this.getDescription(),s=(0,i.l)(e,t);this.assignVertexDescription(s)}}function W(t,e=-1){return new j(t,e)}Z.type=n.G.enumGeometryCollection;class $ extends X{constructor(t){super(t)}}class K extends ${isTrue3D(){return!0}constructor(t){super(t)}}function Q(t,e,s){J(e,t.getStartXY(),t.getEndXY(),s)}function J(t,e,s,n){(0,r.U)(e,s,t,n)}function tt(t,e){return(0,r.q)(t.m_XStart,t.m_XEnd,e)}function et(t,e){return(0,r.q)(t.m_YStart,t.m_YEnd,e)}function st(t,e,s){e.value()<=.5?(0,r.a4)(2,v.constructPoint2D(t.getStartXY()),v.constructPoint2D(t.getEndXY()),e,s):(0,r.a5)(2,v.constructPoint2D(t.getStartXY()),v.constructPoint2D(t.getEndXY()),e,s)}function nt(t,e,s){t.m_XStart=e.x,t.m_YStart=e.y,t.m_XEnd=s.x,t.m_YEnd=s.y,t.afterCompletedModification()}function it(t){if(t.m_YEnd<t.m_YStart||t.m_YEnd===t.m_YStart&&t.m_XEnd<t.m_XStart){t.m_XEnd=(0,r.c)(t.m_XStart,t.m_XStart=t.m_XEnd),t.m_YEnd=(0,r.c)(t.m_YStart,t.m_YStart=t.m_YEnd);for(let e=0,s=t.m_description.getTotalComponentCount()-2;e<s;e++)t.m_attributes[e+s]=(0,r.c)(t.m_attributes[e],t.m_attributes[e]=t.m_attributes[e+s])}}function rt(t,e,s,n){let i=0;if((t.m_XStart===e.m_XStart&&t.m_YStart===e.m_YStart||t.m_XStart===e.m_XEnd&&t.m_YStart===e.m_YEnd)&&(i++,!n))return 1;if(t.m_XEnd===e.m_XStart&&t.m_YEnd===e.m_YStart||t.m_XEnd===e.m_XEnd&&t.m_YEnd===e.m_YEnd){if(i++,2===i)return 2;if(!n)return 1}return e.isIntersectingPoint(t.getStartXY(),s,!0)||e.isIntersectingPoint(t.getEndXY(),s,!0)||t.isIntersectingPoint(e.getStartXY(),s,!0)||t.isIntersectingPoint(e.getEndXY(),s,!0)?4:n&&i?0:function(t,e){const s=lt(t,e.m_XStart,e.m_YStart),n=lt(t,e.m_XEnd,e.m_YEnd);if(s<0&&n<0||s>0&&n>0)return!1;const i=lt(e,t.m_XStart,t.m_YStart),r=lt(e,t.m_XEnd,t.m_YEnd);return!(i<0&&r<0||i>0&&r>0)&&(ct(t)>ct(e)?ut(t,e):ut(e,t))}(t,e)?4:0}function ot(t,e,s,n,i,o,a,l){null!==n&&(0,r.w)(n,2,Number.NaN),null!==i&&(0,r.w)(i,2,Number.NaN),null!==s&&(0,r.ac)(s,r.P,2);const h=function(t,e,s,n,i,o,a,l,h){const u=at(t,e.getStartXY(),a,!1),c=at(t,e.getEndXY(),a,!1),m=at(e,t.getStartXY(),a,!1),d=at(e,t.getEndXY(),a,!1);let g=0,p=0;if(!Number.isNaN(u)){let s=!1;l&&(0,r.N)(u,0,1)&&t.getCoord2D(u).isEqualPoint2D(e.getStartXY())&&(g++,s=!0),s||(i&&(i[p]=u),o&&(o[p]=0),n&&n[p].setCoords(e.m_XStart,e.m_YStart),p++)}if(!Number.isNaN(c)){let a=!1;l&&(0,r.N)(c,0,1)&&t.getCoord2D(c).isEqualPoint2D(e.getEndXY())&&(g++,a=!0),a||(s>p&&(i&&(i[p]=c),o&&(o[p]=1),n&&n[p].setCoords(e.m_XEnd,e.m_YEnd)),p++)}if(2!==p&&!Number.isNaN(m)&&!(0===u&&0===m||0===c&&1===m)){let a=!1;l&&(0,r.N)(m,0,1)&&e.getCoord2D(m).isEqualPoint2D(t.getStartXY())&&(g++,a=!0),a||(s>p&&(i&&(i[p]=0),o&&(o[p]=m),n&&n[p].setCoords(t.m_XStart,t.m_YStart)),p++)}if(2!==p&&!Number.isNaN(d)&&!(1===u&&0===d||1===c&&1===d)){let a=!1;l&&(0,r.N)(d,0,1)&&e.getCoord2D(d).isEqualPoint2D(t.getEndXY())&&(g++,a=!0),a||(s>p&&(i&&(i[p]=1),o&&(o[p]=d),n&&n[p].setCoords(e.m_XEnd,e.m_YEnd)),p++)}if(p>0)return h&&(o=(0,r.c)(i,i=o)),2===p&&s>=2&&i&&i[0]>i[1]&&(i[1]=(0,r.c)(i[0],i[0]=i[1]),o&&(o[1]=(0,r.c)(o[0],o[0]=o[1])),n&&(n[1]=(0,r.c)(n[0],n[0]=n[1]))),p;if(g>0)return 0;const _=function(t,e,s){const n=t.m_XEnd-t.m_XStart,i=t.m_YEnd-t.m_YStart,o=e.m_XEnd-e.m_XStart,a=e.m_YEnd-e.m_YStart,l=o*i-n*a;if(0===l)return r.P.getNAN();const h=4*(0,r.O)()*(Math.abs(o*i)+Math.abs(n*a)),u=e.m_XStart-t.m_XStart,c=e.m_YStart-t.m_YStart,m=o*c-u*a,d=4*(0,r.O)()*(Math.abs(o*c)+Math.abs(u*a)),g=m/l,p=Math.abs(l),_=(d*p+h*Math.abs(m))/(l*l)+(0,r.O)()*Math.abs(g);if(g<-_||g>1+_)return r.P.getNAN();const f=n*c-u*i,y=f/l,x=(4*(0,r.O)()*(Math.abs(n*c)+Math.abs(u*i))*p+h*Math.abs(f))/(l*l)+(0,r.O)()*Math.abs(y);if(y<-x||y>1+x)return r.P.getNAN();let v=(0,r.s)(g,0,1),b=(0,r.s)(y,0,1);const P=r.P.getNAN();Q(t,v,P);const S=r.P.getNAN();if(Q(e,b,S),!s||r.P.distance(P,S)>s){const n=r.P.getNAN();(0,r.U)(P,S,.5,n),v=t.getClosestCoordinate(n,!1),b=e.getClosestCoordinate(n,!1);const i=r.P.getNAN();Q(t,v,i);const o=r.P.getNAN();Q(e,b,o),i.subThis(o);const a=i.length(),l=(t.absNorm()+e.absNorm())*(0,r.g)();if(a>Math.max(s,l))return r.P.getNAN()}return new r.P(v,b)}(t,e,a);return Number.isNaN(_.x)?0:(n&&(n[0]=t.getCoord2D(_.x)),i&&(i[0]=_.x),o&&(o[0]=_.y),1)}(t,e,2,s,n,i,o,a,l);return n&&(n.length=h),i&&(i.length=h),s&&(s.length=h),h}function at(t,e,s,n){const i=r.P.getNAN(),o=r.P.getNAN();let a=!1;t.m_YEnd<t.m_YStart||t.m_YEnd===t.m_YStart&&t.m_XEnd<t.m_XStart?(i.setCoords(t.m_XEnd,t.m_YEnd),o.setCoords(t.m_XStart,t.m_YStart),a=!0):(i.setCoords(t.m_XStart,t.m_YStart),o.setCoords(t.m_XEnd,t.m_YEnd));const l=a?1:0,h=a?0:1,u=r.P.getNAN();u.setSub(e,i);let c=u.length(),m=3*c*(0,r.O)();if(c<=Math.max(s,m))return n&&0===c?Number.NaN:l;if(u.setSub(e,o),c=u.length(),m=3*c*(0,r.O)(),c<=Math.max(s,m))return n&&0===c?Number.NaN:h;u.setCoords(o.x-i.x,o.y-i.y);const d=u.length();if(d>0){const t=1/d;u.scale(t);const n=r.P.getNAN();n.setSub(e,i);const c=n.dotProduct(u),m=8*n.dotProductAbs(u)*(0,r.O)();u.leftPerpendicularThis();const g=n.dotProduct(u),p=8*n.dotProductAbs(u)*(0,r.O)(),_=Math.max(s,m);if(c<-_||c>d+_)return Number.NaN;const f=Math.max(s,p);if(Math.abs(g)<=f){let n=c*t;n=(0,r.s)(n,0,1);const u=r.P.getNAN();if(J(n,i,o,u),r.P.distance(u,e)<=s){if(n<.5){if(r.P.distance(u,i)<=s&&r.P.distance(e,i)<=s)return l}else if(r.P.distance(u,o)<=s&&r.P.distance(e,o)<=s)return h;return a?1-n:n}}}return Number.NaN}function lt(t,e,s){const n=r.P.getNAN();n.setCoords(e,s),n.subThis(t.getStartXY());const i=r.P.getNAN();i.setSub(t.getEndXY(),t.getStartXY());const o=i.crossProduct(n),a=4*(0,r.O)()*(Math.abs(i.x*n.y)+Math.abs(i.y*n.x));return o>a?-1:o<-a?1:0}function ht(t,e,s,n){const i=n?t.m_XStart:t.m_XEnd,o=n?t.m_YStart:t.m_YEnd,a=r.P.getNAN();return a.x=e.getEndX()-i,a.y=e.getEndY()-o,!(s.dotProduct(a)>3*(0,r.O)()*s.dotProductAbs(a))||(a.x=e.getStartX()-i,a.y=e.getStartY()-o,s.dotProduct(a)<=3*(0,r.O)()*s.dotProductAbs(a))}function ut(t,e){const s=r.P.getNAN();return s.x=t.m_XEnd-t.m_XStart,s.y=t.m_YEnd-t.m_YStart,!!ht(t,e,s,!1)&&(s.negateThis(),!!ht(t,e,s,!0))}function ct(t){const e=t.m_XStart-t.m_XEnd,s=t.m_YStart-t.m_YEnd;return e*e+s*s}class mt{constructor(t){if(this.m_segFlagStream=null,this.m_xyStream=null,this.m_bCirculator=!1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_nextPathIndex=0,this.m_currentPathIndex=-1,this.m_parent=t.parent,this.m_buffer=new this.m_parent.m_segmentBufferCTor,this.m_description=t.parent.getDescription(),this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex),void 0!==t.pointIndex){(t.pointIndex<0||t.pointIndex>=t.parent.getPointCount())&&(0,n.q)("");const e=t.parent.getPathIndexFromPointIndex(t.pointIndex);this.m_currentPathIndex=e,this.m_nextPathIndex=e+1,this.m_nextSegmentIndex=t.pointIndex-t.parent.getPathStart(e),this.m_segmentCount=this.getSegmentCount(this.m_currentPathIndex)}else if(void 0!==t.pathIndex){(t.pathIndex<0||t.pathIndex>=t.parent.getPathCount()||t.segmentIndex<0)&&(0,n.q)("");const e=t.parent.isClosedPath(t.pathIndex)?0:1;t.segmentIndex>=t.parent.getPathSize(t.pathIndex)-e&&(0,n.q)(""),this.m_nextSegmentIndex=t.segmentIndex,this.m_currentPathIndex=t.pathIndex,this.m_nextPathIndex=this.m_nextSegmentIndex+1,this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex)}this.prepare(),this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1,this.m_bStripAttributes=!1,this.m_prevPathIndex=-1,this.m_prevSegmentIndex=-1,this.m_bNeedsUpdate=!1,this.m_currentPathIndex>-1&&(this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex))}stripAttributes(){this.m_bStripAttributes=!0}prepare(){this.m_bCirculator=!1,this.m_parent.isEmptyImpl()?(this.m_segFlagStream=null,this.m_xyStream=null):(this.m_segFlagStream=this.m_parent.getSegmentFlagsStreamRef(),this.m_xyStream=this.m_parent.getAttributeStreamRef(0))}nextPath(){return this.m_currentPathIndex=this.m_nextPathIndex,!(this.m_currentPathIndex>=this.m_parent.getPathCount()||(this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_segmentCount=this.getSegmentCount(this.m_currentPathIndex),this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex),this.m_nextPathIndex++,0))}previousPath(){return 0!==this.m_nextPathIndex&&(this.m_nextPathIndex--,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex),this.m_currentPathIndex=this.m_nextPathIndex,this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex),this.resetToLastSegment(),!0)}getSegmentCount(t){return this.m_parent.isEmptyImpl()?0:this.m_parent.getSegmentCountPath(t)}resetToFirstPath(){this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_nextPathIndex=0,this.m_currentPathIndex=-1,this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1}resetToLastPath(){this.m_nextPathIndex=this.m_parent.getPathCount(),this.m_currentPathIndex=-1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_pathBegin=-1}resetToPath(t){(t<0||t>this.m_parent.getPathCount())&&(0,n.q)(""),this.m_nextPathIndex=t,this.m_currentPathIndex=-1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1}isLastPath(){return this.m_currentPathIndex===this.m_parent.getPathCount()-1}isFirstSegmentInPath(){return 0===this.m_currentSegmentIndex}isLastSegmentInPath(){return this.m_currentSegmentIndex===this.m_segmentCount-1}resetToFirstSegment(){this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0}resetToLastSegment(){this.m_nextSegmentIndex=this.m_segmentCount,this.m_currentSegmentIndex=-1}resetTo(t){this.m_parent!==t.m_parent&&(0,n.p)(""),this.m_currentSegmentIndex=t.m_currentSegmentIndex,this.m_nextSegmentIndex=t.m_nextSegmentIndex,this.m_currentPathIndex=t.m_currentPathIndex,this.m_nextPathIndex=t.m_nextPathIndex,this.m_segmentCount=t.m_segmentCount,this.m_bCirculator=t.m_bCirculator,this.m_pathBegin=t.m_pathBegin,this.m_bCurrentPathClosed=t.m_bCurrentPathClosed,this.m_bStripAttributes=t.m_bStripAttributes,this.m_description=t.m_description}resetToVertex(t,e){if(this.m_currentPathIndex>=0&&this.m_currentPathIndex<this.m_parent.getPathCount()){const e=this.getPathBegin();if(t>=e&&t<this.m_parent.getPathEnd(this.m_currentPathIndex))return this.m_currentSegmentIndex=-1,void(this.m_nextSegmentIndex=t-e)}let s;s=e>=0&&e<this.m_parent.getPathCount()&&t>=this.m_parent.getPathStart(e)&&t<this.m_parent.getPathEnd(e)?e:this.m_parent.getPathIndexFromPointIndex(t),this.m_nextPathIndex=s+1,this.m_currentPathIndex=s,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=t-this.m_parent.getPathStart(s),this.m_segmentCount=this.getSegmentCount(s),this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex)}hasNextSegment(){return this.m_nextSegmentIndex<this.m_segmentCount}hasPreviousSegment(){return this.m_nextSegmentIndex>0}nextSegment(){return this.m_currentSegmentIndex!==this.m_nextSegmentIndex&&this.updateSegment(),this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:(this.m_nextSegmentIndex===this.m_segmentCount&&(0,n.q)("Segment_iterator_impl::next_segment"),this.m_nextSegmentIndex++),this.m_buffer.get()}previousSegment(){return this.m_bCirculator?this.m_nextSegmentIndex=(this.m_segmentCount+this.m_nextSegmentIndex-1)%this.m_segmentCount:(0===this.m_nextSegmentIndex&&(0,n.q)(""),this.m_nextSegmentIndex--),this.m_nextSegmentIndex!==this.m_currentSegmentIndex&&this.updateSegment(),this.m_buffer.get()}nextCurve(){if(!this.m_parent.hasNonLinearSegments())return this.resetToLastSegment(),null;let t=0;for(;;){if(this.m_nextSegmentIndex===this.m_segmentCount||t===this.m_segmentCount)return null;const e=this.getPathBegin()+this.m_nextSegmentIndex;if(1!=(31&this.m_segFlagStream.read(e))){this.updateSegment();break}this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:this.m_nextSegmentIndex++,t++}return this.m_currentSegmentIndex!==this.m_nextSegmentIndex&&this.updateSegment(),this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:(this.m_nextSegmentIndex===this.m_segmentCount&&(0,n.q)(""),this.m_nextSegmentIndex++),this.m_buffer.get()}getPathBegin(){return this.m_pathBegin}getPathIndex(){return this.m_currentPathIndex}getStartPointIndex(){return this.getPathBegin()+this.m_currentSegmentIndex}getEndPointIndex(){return this.isClosingSegment()?this.getPathBegin():this.getStartPointIndex()+1}updateSegment(){(this.m_nextSegmentIndex<0||this.m_nextSegmentIndex>=this.m_segmentCount||this.m_currentPathIndex<0)&&(0,n.q)(""),this.m_currentSegmentIndex=this.m_nextSegmentIndex,this.m_parent.getSegmentFromPath(this.m_currentPathIndex,this.m_currentSegmentIndex,this.m_buffer,this.m_bStripAttributes)}isClosingSegment(){return this.m_bCurrentPathClosed&&this.m_currentSegmentIndex===this.m_segmentCount-1}isCurve(){return null!==this.m_segFlagStream&&1!=(31&this.m_segFlagStream.read(this.m_currentSegmentIndex))}isPathClosed(){return this.m_bCurrentPathClosed}setCirculator(t){this.m_bCirculator=t}getImpl(){return this}}class dt{constructor(t){this.m_rasterizedGeometry=null,this.m_quadTree=null,this.m_quadTreeForPaths=null,this.m_refCount=1,t&&t.copyTo(this)}getRasterizedGeometry(){return this.m_rasterizedGeometry}copyTo(t){t!==this&&((0,n.g)(t.uniqueUse()),t.m_quadTree=this.m_quadTree,t.m_quadTreeForPaths=this.m_quadTreeForPaths,t.m_rasterizedGeometry=this.m_rasterizedGeometry)}clone(){const t=new dt;return this.copyTo(t),t}uniqueUse(){return 1===this.m_refCount}addRef(){++this.m_refCount}release(){0==--this.m_refCount&&(this.m_rasterizedGeometry=null,this.m_quadTree=null,this.m_quadTreeForPaths=null)}setRasterizedGeometry(t){(0,n.g)(this.uniqueUse())}setQuadTree(t){(0,n.g)(this.uniqueUse()),this.m_quadTree=t}setQuadTreeForPaths(t){(0,n.g)(this.uniqueUse()),this.m_quadTreeForPaths=t}getQuadTree(){return this.m_quadTree}getQuadTreeForPaths(){return this.m_quadTreeForPaths}}function gt(t){return!(t.isEmpty()||t.getGeometryType()!==n.G.enumPolyline&&t.getGeometryType()!==n.G.enumPolygon||t.getPointCount()<20)}function pt(t){return!(t.isEmpty()||t.getGeometryType()!==n.G.enumPolyline&&t.getGeometryType()!==n.G.enumPolygon||t.getPointCount()<20)}function _t(t,e){return t.readPoint2D(e+4)}function ft(t){const e=t.getGeometryType();return e===n.G.enumEllipticArc?10:e===n.G.enumBezier?4:e===n.G.enumRationalBezier2?5:e===n.G.enumBezier2?2:void(0,n.d)("")}function yt(t){const e=31&t;return 4===e?10:2===e?4:8===e?5:16===e?2:0}function xt(t,e,s,n){const i=t.getPathStart(e),o=t.getPathEnd(e);if(o-i<3)return;const a=2*i,l=r.P.getNAN();s.queryPoint2D(a,l);const h=l.x,u=l.y,c=r.P.getNAN();s.queryPoint2D(a+2,c);const m=r.P.getNAN();for(let r=a+4,d=2*o;r<d;r+=2)s.queryPoint2D(r,m),n.pe((m.x-l.x)*(c.y-u)),l.setCoordsPoint2D(c),c.setCoordsPoint2D(m);n.pe((h-l.x)*(c.y-u))}function vt(t,e,s){for(;e.hasNextSegment();){const t=e.nextCurve();if(null===t)break;s.pe(2*t.calculateArea2DHelper())}}var bt=i.V;class Pt{static toSegType(t){let e=0;switch(t){case n.G.enumLine:e=1;break;case n.G.enumBezier:e=2;break;case n.G.enumEllipticArc:e=4;break;case n.G.enumRationalBezier2:e=8;break;case n.G.enumBezier2:e=16;break;default:(0,n.d)("")}return e}constructor(){this.m_segmentFlags=null,this.m_segmentParamIndex=null,this.m_segmentParams=null,this.m_curveCount=0,this.m_bezierCount=0,this.m_arcCount=0,this.m_rbezier2Count=0,this.m_bezier2Count=0,this.m_curveParamWritePoint=0}assignCopy(t){return this.m_segmentFlags=t.m_segmentFlags,this.m_segmentParamIndex=t.m_segmentParamIndex,this.m_segmentParams=t.m_segmentParams,this.m_curveCount=t.m_curveCount,this.m_bezierCount=t.m_bezierCount,this.m_arcCount=t.m_arcCount,this.m_rbezier2Count=t.m_rbezier2Count,this.m_bezier2Count=t.m_bezier2Count,this.m_curveParamWritePoint=t.m_curveParamWritePoint,this}}class St extends g{constructor(t){super(t),this.m_cachedRingAreas2D=null,this.m_paths=null,this.m_pathFlags=null,this.m_curveData=null,t.move?(this.m_bPolygon=t.move.m_bPolygon,this.m_cachedLength2D=t.move.m_cachedLength2D,this.m_cachedArea2D=t.move.m_cachedArea2D,this.m_currentPathIndex=t.move.m_currentPathIndex,this.m_cachedRingAreas2D=t.move.m_cachedRingAreas2D,this.m_paths=t.move.m_paths,this.m_pathFlags=t.move.m_pathFlags,this.m_curveData=t.move.m_curveData,t.move.m_curveData=null,t.move.setEmpty()):(this.m_bPolygon=t.bPolygon,this.m_cachedLength2D=0,this.m_cachedArea2D=0,this.m_currentPathIndex=0)}getGeometryType(){return this.m_bPolygon?n.G.enumPolygon:n.G.enumPolyline}getDimension(){return this.m_bPolygon?2:1}changeRingStartPoint(t){(0,n.g)(this.m_bPolygon);const e=this.getPathIndexFromPointIndex(t),s=this.getPathStart(e);if(s===t)return;const i=this.getPathEnd(e);(t>=i||t<s)&&(0,n.a)("change_ring_start_point");for(let n=0,r=this.m_description.getAttributeCount();n<r;n++){const e=this.m_description.getSemantics(n),r=bt.getComponentCount(e);this.m_vertexAttributes.get(n).rotate(s*r,t*r,i*r)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.rotate(s,t,i),this.m_curveData.m_segmentParamIndex.rotate(s,t,i))}setFillRule(t){this.m_bFillRule=1===t}getFillRule(){return this.m_bFillRule?1:0}isExteriorRingOGC(t){return!!this.m_bPolygon&&(this.updateOGCFlagsProtected(),!!(8&this.m_pathFlags.read(t)))}isExteriorRing(t){return this.calculateRingArea2D(t)>0}calculateRingArea2D(t){return this.m_bPolygon?(this.updateRingAreas2DProtected(),this.m_cachedRingAreas2D.read(t)):0}updateRingAreas2DProtected(){if(!this.hasDirtyFlag(1024))return;const t=this.getPathCount();if(0===t)return this.hasDirtyFlag(1024)&&(this.m_cachedArea2D=0),void this.setDirtyFlagProtected(1024,!1);const e=new i.x(t),s=new r.K(0),n=new r.K(0);if(0!==this.m_pointCount){const i=this.getAttributeStreamRef(0);if(this.hasNonLinearSegments()){const t=new mt({parent:this});for(t.stripAttributes();t.nextPath();){n.reset();const r=t.getPathIndex();xt(this,r,i,n),vt(0,t,n);const o=.5*n.getResult();s.add(o),e.write(r,o)}}else for(let r=0;r<t;r++){n.reset(),xt(this,r,i,n);const t=.5*n.getResult();s.add(t),e.write(r,t)}}this.hasDirtyFlag(1024)&&(this.m_cachedArea2D=s.getResult(),this.m_cachedRingAreas2D=e,this.setDirtyFlagProtected(1024,!1))}getOGCPolygonCount(){if(!this.m_bPolygon)return 0;this.updateOGCFlagsProtected();let t=0;const e=this.getPathCount();for(let s=0;s<e;s++)8&this.m_pathFlags.read(s)&&t++;return t}getHashCodeImpl(){return(0,n.g)(0),0}equalsImpl(t){const e=t,s=this.getPathCount();if(s!==e.getPathCount())return!1;const n=this.hasNonLinearSegments();if(n!==e.hasNonLinearSegments())return!1;if(n){if(this.m_curveData.m_curveCount!==e.m_curveData.m_curveCount)return!1;if(this.m_curveData.m_bezierCount!==e.m_curveData.m_bezierCount)return!1}if(this.m_paths&&!this.m_paths.equals(e.m_paths,0,s+1))return!1;if(this.m_bFillRule!==e.m_bFillRule)return!1;if(!this.m_bPolygon&&this.m_pathFlags&&!this.m_pathFlags.equals(e.m_pathFlags,0,s))return!1;if(this.hasNonLinearSegments()){if(!this.m_curveData.m_segmentFlags.equals(e.m_curveData.m_segmentFlags,0,this.getPointCount()))return!1;for(let t=0,s=this.getPointCount();t<s;t++){const s=this.m_curveData.m_segmentFlags.read(t);if(!St.isNonLinearSegmentFlag(s))continue;const n=this.m_curveData.m_segmentParamIndex.read(t),i=e.m_curveData.m_segmentParamIndex.read(t),o=yt(s);for(let t=0;t<o;t++){const s=this.m_curveData.m_segmentParams.read(n+t),o=e.m_curveData.m_segmentParams.read(i+t);if(!(0,r.Q)(s,o))return!1}}}return!0}equalsImplTol(t,e){const s=t,n=this.getPathCount();if(n!==s.getPathCount())return!1;const i=this.hasNonLinearSegments();if(i!==s.hasNonLinearSegments())return!1;if(i){if(this.m_curveData.m_curveCount!==s.m_curveData.m_curveCount)return!1;if(this.m_curveData.m_bezierCount!==s.m_curveData.m_bezierCount)return!1}if(this.m_paths&&!this.m_paths.equals(s.m_paths,0,n+1))return!1;if(this.m_bFillRule!==s.m_bFillRule)return!1;if(!this.m_bPolygon&&this.m_pathFlags&&!this.m_pathFlags.equals(s.m_pathFlags,0,n))return!1;if(!i)return!0;if(!this.m_curveData.m_segmentFlags.equals(s.m_curveData.m_segmentFlags,0,this.getPointCount()))return!1;const r=this.querySegmentIterator(),o=s.querySegmentIterator();for(;r.nextPath();){if(!o.nextPath())return!1;for(;r.hasNextSegment();){const t=r.nextCurve(),s=o.nextCurve();if(!(t&&s&&t.equals(s,e))){if(!t&&!s)break;return!1}}}return!0}reserveImplImpl(t,e){this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.resize(t,1),this.m_curveData.m_segmentParamIndex.resize(t,-1),this.checkCompactSegmentParams())}verifyStreamsAfterSizeChangeExtraImpl(){this.m_paths||(this.m_paths=(0,i.y)(1,0),this.m_pathFlags=(0,i.z)(1,0)),this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.resize(this.m_reservedPointCount,1),this.m_curveData.m_segmentParamIndex.resize(this.m_reservedPointCount,-1),this.checkCompactSegmentParams())}copyToImpl(t,e){const s=t;s.m_bPathStarted=!1,s.m_bFillRule=this.m_bFillRule,this.m_paths?s.m_paths=e?this.m_paths:this.m_paths.clone():s.m_paths=null,this.m_pathFlags?s.m_pathFlags=e?this.m_pathFlags:this.m_pathFlags.clone():s.m_pathFlags=null,this.m_curveData&&(s.m_curveData||(s.m_curveData=new Pt),s.m_curveData.assignCopy(this.m_curveData),s.m_curveData.m_curveCount=0,s.updateCurveCounter(this.m_curveData.m_curveCount),e||(this.m_curveData.m_segmentParamIndex?s.m_curveData.m_segmentParamIndex=this.m_curveData.m_segmentParamIndex.clone():s.m_curveData.m_segmentParamIndex=null,this.m_curveData.m_segmentFlags?s.m_curveData.m_segmentFlags=this.m_curveData.m_segmentFlags.clone():s.m_curveData.m_segmentFlags=null,this.m_curveData.m_segmentParams?s.m_curveData.m_segmentParams=this.m_curveData.m_segmentParams.clone():s.m_curveData.m_segmentParams=null)),s.hasDirtyFlag(512)||(s.m_cachedLength2D=this.m_cachedLength2D),s.m_cachedRingAreas2D=null,s.hasDirtyFlag(1024)||(s.m_cachedArea2D=this.m_cachedArea2D,null!==this.m_cachedRingAreas2D&&(s.m_cachedRingAreas2D=e?this.m_cachedRingAreas2D:this.m_cachedRingAreas2D.clone()))}calculateArea2D(){return this.m_bPolygon?(this.updateRingAreas2DProtected(),this.m_cachedArea2D):0}calculateLength2D(){if(!this.hasDirtyFlag(512))return this.m_cachedLength2D;const t=this.querySegmentIterator(),e=new r.K(0);for(;t.nextPath();)for(;t.hasNextSegment();)e.add(t.nextSegment().calculateLength2D());return this.hasDirtyFlag(512)&&(this.m_cachedLength2D=e.getResult()),this.setDirtyFlagProtected(512,!1),e.getResult()}calculatePathLength2D(t){const e=this.querySegmentIteratorAtVertex(this.getPathStart(t)),s=new r.K(0);for(;e.hasNextSegment();)s.add(e.nextSegment().calculateLength2D());return s.getResult()}calculateLength3D(t){return(0,n.g)(0),0}calculatePathLength3D(t,e){return(0,n.g)(0),0}copyTo(t){(0,n.h)(t.getGeometryType())||(0,n.a)(""),this!==t&&super.copyTo(t)}swap(t){(0,n.g)(0)}setPointByVal(t,e){this.setPointByValWithCurves(t,e)}setPointByValWithCurves(t,e){if(this.hasNonLinearSegments()){const s=e.getXY();if(this.setXYCoordsWithCurves(t,s.x,s.y),1===this.m_description.getAttributeCount())return}this.setPointByValNoCurves(t,e)}setXYCoordsWithCurves(t,e,s){if(this.hasNonLinearSegments()){const n=St.getPathIndexFromPointIndexImpl(this.m_paths,this.getPathCount(),t,this.m_currentPathIndex);this.m_currentPathIndex=n;const i=this.getPrevSegmentTypeFromPath(n,t),o=this.getNextSegmentType(t);if(1!==i||1!==o){let a=t-1;const l=new Yr;1!==i&&(this.isClosedPath(n)&&t===this.getPathStart(n)&&(a=this.getPathEnd(n)-1),this.getSegmentBuffer(a,l,!0));const h=new Yr;1!==o&&this.getSegmentBuffer(t,h,!0);const u=t+1;this.setXYCoordsNoCurves(t,e,s);const c=new r.P(e,s);return 1!==i&&(l.get().changeEndPoints2D(l.get().getStartXY(),c),this.replaceSegmentImpl(a,t,l.get(),!0)),void(1!==o&&(h.get().changeEndPoints2D(c,h.get().getEndXY()),this.replaceSegmentImpl(t,u,h.get(),!0)))}}this.setXYCoordsNoCurves(t,e,s)}setXYZWithCurves(t,e){this.hasNonLinearSegments()?(this.setXYCoordsWithCurves(t,e.x,e.y),this.setAttributeNoCurves(1,t,0,e.z)):this.setXYZNoCurves(t,e)}setAttributeWithCurves(t,e,s,n){if(0===t&&this.hasNonLinearSegments()){const t=this.getXY(e);0===s?t.x=n:t.y=n,this.setXYCoordsWithCurves(e,t.x,t.y)}else this.setAttributeNoCurves(t,e,s,n)}setXY(t,e){this.setXYCoordsWithCurves(t,e.x,e.y)}setXYCoords(t,e,s){this.setXYCoordsWithCurves(t,e,s)}setXYZ(t,e){this.setXYZWithCurves(t,e)}setAttribute(t,e,s,n){this.setAttributeWithCurves(t,e,s,n)}setAttributeWithCurvesFromArray(t,e,s,i){if(0===t&&this.hasNonLinearSegments()){i<2&&(0,n.q)("");const t=this.getXY(e);t.x=s[0],t.y=s[1],this.setXYCoordsWithCurves(e,t.x,t.y)}else this.setAttributeFromArrayNoCurves(t,e,s,i)}setAttributeFromArray(t,e,s,n){this.setAttributeWithCurvesFromArray(t,e,s,n)}hasNonLinearSegments(){return 0!==this.getCurveCount()}getSegmentCount(){let t=this.getPointCount();if(!this.m_bPolygon){t-=this.getPathCount();for(let e=0,s=this.getPathCount();e<s;e++)this.isClosedPath(e)&&t++}return t}getSegmentCountPath(t){let e=this.getPathSize(t);return!this.isClosedPath(t)&&e>0&&e--,e}add(t,e){this===t&&(0,n.a)("Multi_path_impl::add");for(let s=0,n=t.getPathCount();s<n;s++)this.addPath(t,s,!e)}addPath(t,e,s){this.insertPath(-1,t,e,s)}addPathPoint2D(t,e,s){this.insertPath2D(-1,t,0,e,s)}addPathMultiPoint(t,e,s,n){s<0&&(s=t.getPointCount()-e),this.insertPointsFromMultipoint(-1,0,t,e,s,n)}addSegmentsFromPath(t,e,s,i,r){if(this===t&&(0,n.a)("Multi_path_impl.add_segments_from_path"),r||0!==this.getPathCount()||(r=!0),e<0&&(e=t.getPathCount()-1),(e>=t.getPathCount()||s<0||i<0||s+i>t.getSegmentCountPath(e))&&(0,n.q)("add_segments_from_path"),0===i)return;const o=t.getPathStart(e),a=t.isClosedPath(e)&&s+i===t.getSegmentCountPath(e);this.m_bPathStarted=!1,this.mergeVertexDescription(t.getDescription());let l=i;const h=o+s;let u=h+1;r&&(l++,u--),!r&&t.hasNonLinearSegments()&&1!==t.m_curveData.m_segmentFlags.read(h)&&(t.getXY(h).equals(this.getXY(this.m_pointCount-1))||(0,n.a)("add_segments_from_path: start point mismatch"));const c=this.m_pointCount;if(this.resizeImpl(this.m_pointCount+l),this.verifyAllStreamsAfterSizeChange(),r){if(0===l)return;this.m_paths.add(this.m_pointCount);let s=t.m_pathFlags.read(e);this.m_bPolygon&&(s|=1),this.m_pathFlags.write(this.m_pathFlags.size()-1,s),this.m_pathFlags.add(0)}else this.m_paths.write(this.m_pathFlags.size()-1,this.m_pointCount);const m=a?l-1:l;for(let n=0,d=this.m_description.getAttributeCount();n<d;n++){const e=this.m_description.getSemantics(n),s=bt.getComponentCount(e),i=t.m_description.getAttributeIndex(e);if(m>0){if(i<0||!t.m_vertexAttributes.get(i)){const t=bt.getDefaultValue(e);this.m_vertexAttributes.get(n).insertRange(s*c,t,m*s,s*c),a&&this.m_vertexAttributes.get(n).insertRange(s*c+m*s,t,s,s*c);continue}this.m_vertexAttributes.get(n).insertRangeFromStream(s*c,t.m_vertexAttributes.get(i),s*u,m*s,!0,s,s*c)}a&&this.m_vertexAttributes.get(n).insertRangeFromStream(s*(c+m),t.m_vertexAttributes.get(i),s*o,s,!0,s,s*(c+m))}if(this.hasNonLinearSegments()&&this.initSegmentData(0),t.hasNonLinearSegments()){let e=0;for(let s=0,n=h;s<i;s++)e+=yt(t.m_curveData.m_segmentFlags.read(n)),n++;if(e>0){this.initSegmentData(e);let s=h,n=c-(r?0:1),o=0;for(let e=0;e<i;e++){const e=t.m_curveData.m_segmentFlags.read(s);if(this.m_curveData.m_segmentFlags.write(n,e),St.isNonLinearSegmentFlag(e)){o++;let i=t.m_curveData.m_segmentParamIndex.read(s);const r=yt(e);this.m_curveData.m_segmentParamIndex.write(n,this.m_curveData.m_curveParamWritePoint);for(let e=0;e<r;e++){const e=t.m_curveData.m_segmentParams.read(i);this.m_curveData.m_segmentParams.write(this.m_curveData.m_curveParamWritePoint,e),this.m_curveData.m_curveParamWritePoint++,i++}this.incCurveType(e,1)}else this.m_curveData.m_segmentParamIndex.write(n,-1);n++,s++}this.modifyCurveCounter(o)}}if(a){const t=this.getPathCount()-1,e=this.getPathStart(t),s=this.getPathEnd(t)-1,n=this.getXY(e),i=this.getXY(s);n.isEqualPoint2D(i)&&(--this.m_pointCount,this.m_paths.write(t+1,this.m_pointCount))}this.notifyModifiedFlags(2001)}reverseAllPaths(){for(let t=0,e=this.getPathCount();t<e;t++)this.reversePath(t)}reversePath(t){t>=this.getPathCount()&&(0,n.a)("");const e=this.getPathSize(t);if(0===e)return;const s=this.getPathStart(t),i=this.isClosedPath(t);if(this.hasNonLinearSegments()){let t=s;const n=new this.m_segmentBufferCTor;let r=!1;for(let s=0;s<e;s++,t++){const e=this.m_curveData.m_segmentFlags.read(t);if(!St.isNonLinearSegmentFlag(e))continue;r=!0,this.querySegment(t,n,!0),n.get().reverse();const s=this.m_curveData.m_segmentParamIndex.read(t);n.get().writeInBufferStream(this.m_curveData.m_segmentParams,s)}if(r){const t=i?0:1;this.m_curveData.m_segmentFlags.reverseRange(s,e-t,1),this.m_curveData.m_segmentParamIndex.reverseRange(s,e-t,1)}}const r=i?1:0;for(let n=0,a=this.m_description.getAttributeCount();n<a;n++)if(this.m_vertexAttributes.get(n)){const t=this.m_description.getSemantics(n),i=bt.getComponentCount(t);this.m_vertexAttributes.get(n).reverseRange(i*(s+r),i*(e-r),i)}const o=6&this.m_pathFlags.read(t);if(o){let e=0;4&o&&(e|=2),2&o&&(e|=4),this.m_pathFlags.clearBits(t,6),this.m_pathFlags.setBits(t,e)}this.notifyModifiedFlags(1233)}removePath(t){const e=this.getPathCount();t<0&&(t=e-1),t>=e&&(0,n.a)("");const s=this.getPathStart(t),i=this.getPathSize(t);for(let n=0,r=this.m_description.getAttributeCount();n<r;n++)if(this.m_vertexAttributes.get(n)){const t=this.m_description.getSemantics(n),e=bt.getComponentCount(t);this.m_vertexAttributes.get(n).eraseRange(e*s,e*i,e*this.m_pointCount)}if(this.hasNonLinearSegments()){let t=0;for(let e=s,n=s+i;e<n;e++){const s=this.m_curveData.m_segmentFlags.read(e);St.isNonLinearSegmentFlag(s)&&(this.incCurveType(s,-1),t++)}this.modifyCurveCounter(-t),this.m_curveData.m_segmentFlags.eraseRange(s,i,this.m_pointCount),this.m_curveData.m_segmentParamIndex.eraseRange(s,i,this.m_pointCount)}for(let n=t+1;n<=e;n++){const t=this.m_paths.read(n);this.m_paths.write(n-1,t-i)}if(this.m_pathFlags)for(let n=t+1;n<=e;n++){const t=this.m_pathFlags.read(n);this.m_pathFlags.write(n-1,t)}this.m_paths.resize(e),this.m_pathFlags.resize(e),this.m_pointCount-=i,this.m_reservedPointCount-=i,t===e-1&&(this.m_bPathStarted=!1),this.notifyModifiedFlags(2001),this.checkCompactSegmentParams(),this.dbgVerifyCurves()}dbgVerifyCurves(){}insertPath(t,e,s,r){this===e&&(0,n.a)("Multi_path_impl::insert_path");const o=this.getPathCount();if(!r&&e.hasNonLinearSegmentsPath(s))return t=this.insertPath(t,e,s,!0),this.reversePath(t),t;s>=e.getPathCount()&&(0,n.a)(""),t>o&&(0,n.a)(""),t<0&&(t=o),s<0&&(s=e.getPathCount()-1),this.m_bPathStarted=!1,this.mergeVertexDescription(e.getDescription());const a=e.getPathStart(s),l=e.getPathSize(s);if(0===l)return this.insertPath2D(t,null,0,0,!0);const h=this.m_pointCount,u=e.isClosedPath(s)&&!r?1:0;this.resizeImpl(this.m_pointCount+l),this.verifyAllStreamsAfterSizeChange();const c=t<o?this.getPathStart(t):h;for(let n=0,i=this.m_description.getAttributeCount();n<i;n++){const t=this.m_description.getSemantics(n),s=e.getDescription().getAttributeIndex(t),i=bt.getComponentCount(t);if(s>=0&&e.m_vertexAttributes.get(s))0!==u&&this.m_vertexAttributes.get(n).insertRangeFromStream(c*i,e.m_vertexAttributes.get(s),i*a,i,!0,i,i*h),this.m_vertexAttributes.get(n).insertRangeFromStream((c+u)*i,e.m_vertexAttributes.get(s),i*(a+u),i*(l-u),r,i,i*(h+u));else{const e=bt.getDefaultValue(t);this.m_vertexAttributes.get(n).insertRange(c*i,e,i*l,i*h)}}const m=h+l;this.m_paths.add(m);for(let n=o;n>=t+1;n--){const t=this.m_paths.read(n-1);this.m_paths.write(n,t+l)}this.m_pathFlags.add(0);for(let n=o-1;n>=t+1;n--){let t=this.m_pathFlags.read(n);t&=-9,this.m_pathFlags.write(n+1,t)}let d=e.getPathFlagsStreamRef().read(s);if(d&=-9,this.m_bPolygon&&(d|=1),this.m_pathFlags.write(t,d),e.hasNonLinearSegments()){this.initSegmentData(0);let t=a,s=0;for(let n=0;n<l;n++)s+=yt(e.m_curveData.m_segmentFlags.read(t)),t++;if(s>0){null===this.m_curveData.m_segmentFlags?(this.m_curveData.m_segmentFlags=(0,i.z)(this.m_pointCount,1),this.m_curveData.m_segmentParamIndex=(0,i.y)(this.m_pointCount,-1)):(this.m_curveData.m_segmentFlags.insertRange(c,1,l,h),this.m_curveData.m_segmentParamIndex.insertRange(c,-1,l,h)),this.m_curveData.m_segmentParams?this.m_curveData.m_segmentParams.resize(this.m_curveData.m_curveParamWritePoint+s):this.m_curveData.m_segmentParams=(0,i.D)(s),t=a;let n=c,r=0;for(let s=0;s<l;s++){const s=e.m_curveData.m_segmentFlags.read(t);if(St.isNonLinearSegmentFlag(s)){this.m_curveData.m_segmentFlags.write(n,s),this.m_curveData.m_segmentParamIndex.write(n,this.m_curveData.m_curveParamWritePoint);const i=yt(s);let o=e.m_curveData.m_segmentParamIndex.read(t);for(let t=0;t<i;t++){const t=e.m_curveData.m_segmentParams.read(o);this.m_curveData.m_segmentParams.write(this.m_curveData.m_curveParamWritePoint,t),this.m_curveData.m_curveParamWritePoint++,o++}r++,this.incCurveType(s,1)}t++,n++}this.modifyCurveCounter(r)}}return this.notifyModifiedFlags(2001),t}insertPath2D(t,e,s,i,r){const o=this.getPathCount();(t>o||s<0)&&(0,n.a)(""),t<0&&(t=o),this.m_bPathStarted=!1;const a=this.m_pointCount;this.resizeImpl(this.m_pointCount+i),0===i&&this.notifyModifiedFlags(32),this.verifyAllStreamsAfterSizeChange();const l=t<o?this.getPathStart(t):a;if(e)this.m_vertexAttributes.get(0).insertRangeFromPoints(2*l,e,s,i,r,2*a);else{const t=bt.getDefaultValue(0);this.m_vertexAttributes.get(0).insertRange(2*l,t,2*i,2*a)}for(let n=1,h=this.m_description.getAttributeCount();n<h;n++){const t=this.m_description.getSemantics(n),e=bt.getComponentCount(t),s=bt.getDefaultValue(t);this.m_vertexAttributes.get(n).insertRange(l*e,s,e*i,e*a)}this.m_paths.add(this.m_pointCount);for(let n=o;n>=t+1;n--){const t=this.m_paths.read(n-1);this.m_paths.write(n,t+i)}this.m_pathFlags.add(0);for(let n=o-1;n>=t+1;n--){let t=this.m_pathFlags.read(n);t&=-9,this.m_pathFlags.write(n+1,t)}return this.m_bPolygon&&this.m_pathFlags.write(t,1),this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(l,1,i,a),this.m_curveData.m_segmentParamIndex.insertRange(l,-1,i,a)),this.notifyModifiedFlags(2001),t}insertPathFromMultipoint(t,e,s,i,r){const o=e.getImpl(),a=this.getPathCount();(t>a||s<0)&&(0,n.a)("");const l=i<0?o.getPointCount()-s:i;if(l>o.getPointCount()&&(0,n.a)(""),s>=o.getPointCount()&&(0,n.a)("pointsOffset"),t<0&&(t=a),this.m_bPathStarted=!1,this.mergeVertexDescription(o.getDescription()),0===l)return void this.insertPath2D(t,null,0,0,!0);const h=this.m_pointCount,u=s;this.resizeImpl(this.m_pointCount+l),this.verifyAllStreamsAfterSizeChange();const c=t<a?this.getPathStart(t):h;for(let n=0,g=this.m_description.getAttributeCount();n<g;n++){const t=this.m_description.getSemantics(n),e=o.getDescription().getAttributeIndex(t),s=bt.getComponentCount(t);if(e>=0){const e=o.getAttributeStreamRef(t);this.m_vertexAttributes.get(n).insertRangeFromStream(c*s,e,s*u,s*l,r,s,s*h)}else{const e=bt.getDefaultValue(t);this.m_vertexAttributes.get(n).insertRange(c*s,e,s*l,s*h)}}const m=h+l;this.m_paths.add(m);for(let n=a;n>=t+1;n--){const t=this.m_paths.read(n-1);this.m_paths.write(n,t+l)}this.m_pathFlags.add(0);for(let n=a-1;n>=t+1;n--){let t=this.m_pathFlags.read(n);t&=-9,this.m_pathFlags.write(n+1,t)}let d=0;this.m_bPolygon&&(d|=1),this.m_pathFlags.write(t,d),this.notifyModifiedFlags(2001)}insertPoints(t,e,s,i,r,o,a){if(this===s&&(0,n.a)("Multi_path_impl.insert_points"),t<0&&(t=this.getPathCount()),i<0&&(i=s.getPathCount()-1),(t>this.getPathCount()||e>=0&&e>this.getPathSize(t)||i>=s.getPathCount()||o>s.getPathSize(i))&&(0,n.q)(""),!o)return;if(this.mergeVertexDescription(s.m_description),t===this.getPathCount()){this.m_paths.add(this.m_pointCount);let t=s.m_pathFlags.read(i);t&=-9,this.m_bPolygon?this.m_pathFlags.add(1|t):this.m_pathFlags.add(t)}e<0&&(e=this.getPathSize(t));const l=this.m_pointCount;this.resizeImpl(this.m_pointCount+o),this.verifyAllStreamsAfterSizeChange();const h=this.getPathStart(t),u=h+e;o<0&&(o=s.getPathSize(i));const c=s.getPathStart(i),m=c+o;for(let n=0,d=this.m_description.getAttributeCount();n<d;n++){const t=this.m_description.getSemantics(n),i=bt.getComponentCount(t),d=s.m_description.getAttributeIndex(t);if(d<0||!s.m_vertexAttributes.get(d)){const e=bt.getDefaultValue(t);this.m_vertexAttributes.get(n).insertRange(i*u,e,m*i,i*l)}else this.m_vertexAttributes.get(n)?.insertRangeFromStream(i*(h+e),s.m_vertexAttributes.get(d),i*(c+r),o*i,a,i,i*l)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(h+e,1,o,l),this.m_curveData.m_segmentParamIndex.insertRange(h+e,-1,o,l),e>0&&this.isNonLinearSegment(h+e-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(h+e-1),-1),this.m_curveData.m_segmentFlags.write(h+e-1,1),this.m_curveData.m_segmentParamIndex.write(h+e-1,-1),this.modifyCurveCounter(-1)));for(let n=t+1,d=this.getPathCount();n<=d;n++){const t=this.m_paths.read(n);this.m_paths.write(n,t+o)}this.notifyModifiedFlags(2001)}insertPointsFromPoints(t,e,s,i,r,o){if(t<0&&(t=this.getPathCount()),(t>this.getPathCount()||e>this.getPathSize(t)||i<0)&&(0,n.q)(""),!r)return;t===this.getPathCount()&&(this.m_paths.add(this.m_pointCount),this.m_bPolygon?this.m_pathFlags.add(1):this.m_pathFlags.add(0)),e<0&&(e=this.getPathSize(t));const a=this.m_pointCount;this.resizeImpl(this.m_pointCount+r),this.verifyAllStreamsAfterSizeChange();const l=this.getPathStart(t);this.m_vertexAttributes.get(0).insertRangeFromPoints(2*(l+e),s,i,r,o,2*a);for(let n=1,h=this.m_description.getAttributeCount();n<h;n++){const t=this.m_description.getSemantics(n),s=bt.getComponentCount(t),i=bt.getDefaultValue(t);this.m_vertexAttributes.get(n).insertRange((l+e)*s,i,s*r,s*a)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(l+e,1,r,a),this.m_curveData.m_segmentParamIndex.insertRange(l+e,-1,r,a),e>0&&this.isNonLinearSegment(l+e-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(l+e-1),-1),this.m_curveData.m_segmentFlags.write(l+e-1,1),this.m_curveData.m_segmentParamIndex.write(l+e-1,-1),this.modifyCurveCounter(-1)));for(let n=t+1,h=this.getPathCount();n<=h;n++)this.m_paths.write(n,this.m_paths.read(n)+r);this.notifyModifiedFlags(2001)}insertPointsFromMultipoint(t,e,s,i,r,o){const a=s.getImpl(),l=this.getPathCount();t<0&&(t=this.getPathCount());const h=a.getPointCount();if((i<0||i>h)&&(0,n.q)(""),(r<0||i+r>h)&&(r=h-i),e<0&&(e=t<l?this.getPathSize(t):0),(t>l||t<l&&e>this.getPathSize(t)||t===l&&e>0||r<0)&&(0,n.q)(""),!r)return;if(this.mergeVertexDescription(a.getDescription()),t===l){this.m_paths.add(this.m_pointCount);const t=0;this.m_bPolygon?this.m_pathFlags.add(1|t):this.m_pathFlags.add(t)}e<0&&(e=this.getPathSize(t));const u=this.m_pointCount;this.resizeImpl(this.m_pointCount+r),this.verifyAllStreamsAfterSizeChange();const c=this.getPathStart(t),m=c+e,d=0+r;for(let n=0,g=this.m_description.getAttributeCount();n<g;n++){const t=this.m_description.getSemantics(n),s=bt.getComponentCount(t);if(a.getDescription().getAttributeIndex(t)<0){const e=bt.getDefaultValue(t);this.m_vertexAttributes.get(n).insertRange(s*m,e,d*s,s*u);continue}const l=a.getAttributeStreamRef(t);this.m_vertexAttributes.get(n).insertRangeFromStream(s*(c+e),l,s*(0+i),r*s,o,s,s*u)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(c+e,1,r,u),this.m_curveData.m_segmentParamIndex.insertRange(c+e,-1,r,u),e>0&&this.isNonLinearSegment(c+e-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(c+e-1),-1),this.m_curveData.m_segmentFlags.write(c+e-1,1),this.m_curveData.m_segmentParamIndex.write(c+e-1,-1),this.modifyCurveCounter(-1)));for(let n=t+1,g=this.getPathCount();n<=g;n++){const t=this.m_paths.read(n);this.m_paths.write(n,t+r)}this.notifyModifiedFlags(2001)}insertPoint2D(t,e,s){const i=this.getPathCount();t<0&&(t=i),(t>i||t<i&&e>this.getPathSize(t))&&(0,n.q)(""),t===i&&this.addPathPoint2D(null,0,!0);const r=this.m_pointCount;this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();const o=this.getPathStart(t),a=e<0?this.getPathSize(t)+o:e+o,l=this.m_vertexAttributes.get(0);if(a===r)this.m_paths.write(t+1,r+1),l.writePoint2D(2*a,s);else{l.insert(2*a,s,2*r);for(let t=1,e=this.m_description.getAttributeCount();t<e;t++){const e=this.m_description.getSemantics(t),s=bt.getComponentCount(e),n=bt.getDefaultValue(e);this.m_vertexAttributes.get(t).insertRange(s*a,n,s,s*r)}this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.insertRange(a,1,1,r),this.m_curveData.m_segmentParamIndex.insertRange(a,-1,1,r));for(let e=t+1,s=i;e<=s;e++)this.m_paths.write(e,this.m_paths.read(e)+1)}this.m_curveData&&this.m_curveData.m_segmentFlags&&a>o&&this.isNonLinearSegment(a-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(a-1),-1),this.modifyCurveCounter(-1),this.m_curveData.m_segmentFlags.write(a-1,1),this.m_curveData.m_segmentParamIndex.write(a-1,-1)),this.notifyModifiedFlags(2001)}insertPoint(t,e,s){const i=this.getPathCount();t<0&&(t=i),(t>i||t<i&&e>this.getPathSize(t))&&(0,n.q)(""),t===i&&this.addPathPoint2D(null,0,!0);const r=this.m_pointCount;this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();const o=this.getPathStart(t),a=e<0?this.getPathSize(t)+o:e+o;if(a===r)this.m_paths.write(t+1,r+1),this.setPointByValNoCurves(a,s);else{const e=s.getDescription();this.m_description!==e&&this.mergeVertexDescription(e);for(let t=0,n=this.m_description.getAttributeCount();t<n;t++){const n=this.m_description.getSemantics(t),i=bt.getComponentCount(n);if(e.hasAttribute(n))this.m_vertexAttributes.get(t).insertAttributes(i*a,s,n,i*r);else{const e=bt.getDefaultValue(n);this.m_vertexAttributes.get(t).insertRange(i*a,e,i,i*r)}}this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.insertRange(a,1,1,r),this.m_curveData.m_segmentParamIndex.insertRange(a,-1,1,r));for(let s=t+1,n=i;s<=n;s++)this.m_paths.write(s,this.m_paths.read(s)+1)}this.m_curveData&&this.m_curveData.m_segmentFlags&&a>o&&this.isNonLinearSegment(a-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(a-1),-1),this.modifyCurveCounter(-1),this.m_curveData.m_segmentFlags.write(a-1,1),this.m_curveData.m_segmentParamIndex.write(a-1,-1)),this.notifyModifiedFlags(2001)}removePointFromPath(t,e){const s=this.getPathCount();t<0&&(t=s-1),(t>=s||e>=this.getPathSize(t))&&(0,n.q)("Multi_path.remove_point");const i=this.getPathStart(t),r=this.isClosedPath(t);e<0&&(e=this.getPathSize(t)-1),e<0&&(0,n.q)("Multi_path.remove_point");const o=i+e;for(let n=0,a=this.m_description.getAttributeCount();n<a;n++)if(this.m_vertexAttributes.get(n)){const t=this.m_description.getSemantics(n),e=bt.getComponentCount(t);this.m_vertexAttributes.get(n).eraseRange(e*o,e,e*this.m_pointCount)}if(this.m_curveData&&this.m_curveData.m_segmentFlags){this.checkCompactSegmentParams();let e=0;if(o>i&&this.isNonLinearSegment(o-1))e+=1,this.incCurveType(this.m_curveData.m_segmentFlags.read(o-1),-1),this.m_curveData.m_segmentFlags.write(o-1,1),this.m_curveData.m_segmentParamIndex.write(o-1,-1);else{const s=this.getPathEnd(t);r&&i+1<s&&this.isNonLinearSegment(s-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(s-1),-1),this.m_curveData.m_segmentFlags.write(s-1,1),this.m_curveData.m_segmentParamIndex.write(s-1,-1),e+=1)}this.isNonLinearSegment(o)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(o),-1),e+=1),e>0&&this.modifyCurveCounter(-e),this.m_curveData.m_segmentFlags.eraseRange(o,1,this.m_pointCount),this.m_curveData.m_segmentParamIndex.eraseRange(o,1,this.m_pointCount)}for(let n=s;n>=t+1;n--){const t=this.m_paths.read(n);this.m_paths.write(n,t-1)}this.m_pointCount--,this.m_reservedPointCount--,this.notifyModifiedFlags(2001)}removePoint(t){let e;e=t<0?this.getPathCount()-1:this.getPathIndexFromPointIndex(t),this.removePointFromPath(e,t-this.getPathStart(e))}getNextSegmentType(t){return this.hasNonLinearSegments()?this.m_curveData.m_segmentFlags.read(t):1}getPrevSegmentTypeFromPath(t,e){if(!this.hasNonLinearSegments())return 1;const s=this.getPathStart(t);if(e>s)return this.m_curveData.m_segmentFlags.read(e-1);if(e===s){if(this.isClosedPath(t)){const e=this.getPathEnd(t);return this.m_curveData.m_segmentFlags.read(e-1)}return 1}(0,n.d)("")}getNumberOfCurves(t){if(!this.hasNonLinearSegments())return 0;let e=0;for(let s=this.getPathStart(t),n=this.getPathEnd(t);s<n;s++)St.isNonLinearSegmentFlag(this.m_curveData.m_segmentFlags.read(s))&&++e;return e}getPathCount(){return this.m_paths?this.m_paths.size()-1:0}getPathSize(t){return this.m_paths.read(t+1)-this.m_paths.read(t)}getPathStart(t){return this.m_paths.read(t)}getPathEnd(t){return this.m_paths.read(t+1)}getPathIndexFromPointIndex(t,e=-1){-1===e&&(e=this.m_currentPathIndex);const s=this.getPathCount(),n=St.getPathIndexFromPointIndexImpl(this.m_paths,s,t,e);return this.m_currentPathIndex=n,n}startPathCoords(t,e){this.startPathPoint(new i.P({x:t,y:e}))}startPath(t){this.startPathPoint(new i.P({pt:t}))}startPath3D(t){this.startPathPoint(new i.P({x:t.x,y:t.y,z:t.z}))}startPath3DCoords(t,e,s){this.startPathPoint(new i.P({x:t,y:e,z:s}))}startPathPoint(t){t.isEmpty()&&(0,n.a)("");const e=t.getDescription();let s;if(this.m_description!==e){this.mergeVertexDescription(e);const n=new i.P({vd:this.m_description});t.copyCommonAttributesTo(n),s=n}else s=t;this.m_bPathStarted?this.setPointByValNoCurves(this.m_pointCount-1,s):(this.insertPoint(-1,-1,s),this.m_bPathStarted=!0)}beforeNewSegmentHelper2(){this.m_paths=(0,i.y)(2),this.m_paths.write(0,0),this.m_pathFlags=(0,i.z)(2,0),this.m_bPolygon&&this.m_pathFlags.write(0,1)}beforeNewSegmentHelper1(){null!==this.m_paths?(this.m_paths.add(0),this.m_pathFlags.add(0),this.m_bPolygon&&this.m_pathFlags.write(this.m_pathFlags.size()-2,1)):this.beforeNewSegmentHelper2()}beforeNewSegment(t){0!==this.m_pointCount||this.m_bPathStarted||this.startPathCoords(0,0);const e=this.m_pointCount,s=this.m_paths.size()-1,n=e+t;this.m_paths.write(s,n),this.resizeImpl(n),this.m_bPathStarted&&(this.m_bPathStarted=!1)}finishLineTo(){if(this.hasNonLinearSegments()){const t=this.m_curveData.m_segmentFlags.read(this.m_pointCount-1);1!==t&&(this.m_curveData.m_segmentFlags.write(this.m_pointCount-1,1),this.m_curveData.m_segmentParamIndex.write(this.m_pointCount-1,-1),this.modifyCurveCounter(-1),this.incCurveType(t,-1))}}lineToCoords(t,e){if(this.beforeNewSegment(1),1===this.m_description.getAttributeCount())this.setXYCoordsNoCurves(this.m_pointCount-1,t,e);else{const s=(0,i.o)(),n=new i.P({vd:this.m_description,attribBuffer:s,initDefaultValues:!0});n.setXYCoords(t,e),this.setPointByValNoCurves(this.m_pointCount-1,n)}this.finishLineTo()}lineTo(t){this.lineToCoords(t.x,t.y)}lineTo3D(t){this.beforeNewSegment(1);const e=(0,i.l)(this.m_description,(0,i.w)()),s=(0,i.o)(),n=new i.P({vd:e,attribBuffer:s,initDefaultValues:!0});n.setXYZ(t),this.setPointByValNoCurves(this.m_pointCount-1,n),this.finishLineTo()}lineTo3DCoords(t,e,s){this.lineTo3D(new i.d(t,e,s))}lineToPoint(t){if(this.beforeNewSegment(1),this.m_description===t.getDescription())this.setPointByValNoCurves(this.m_pointCount-1,t);else{this.mergeVertexDescription(t.getDescription());const e=(0,i.o)(),s=new i.P({vd:this.m_description,attribBuffer:e,initDefaultValues:!1});t.copyCommonAttributesTo(s),this.setPointByValNoCurves(this.m_pointCount-1,s)}this.finishLineTo()}openPathAndDuplicateStartVertex(t){this.m_bPolygon&&(0,n.d)("");const e=this.getPathCount();if(t>e&&(0,n.a)(""),!this.isClosedPath(t))return;this.m_pathFlags||(0,n.d)("");const s=this.m_pointCount,i=this.getPathStart(t),r=this.getPathEnd(t);if(r-i!=0){this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();for(let t=0,e=this.m_description.getAttributeCount();t<e;t++)if(this.m_vertexAttributes.get(t)){const e=this.m_description.getSemantics(t),n=bt.getComponentCount(e);this.m_vertexAttributes.get(t).insertRangeFromStream(n*r,this.m_vertexAttributes.get(t),n*i,n,!0,1,n*s)}for(let s=e;s>t;s--){const t=this.m_paths.read(s);this.m_paths.write(s,t+1)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(r,1,1,s),this.m_curveData.m_segmentParamIndex.insertRange(r,-1,1,s)),this.m_pathFlags.clearBits(t,1)}}openPath(t){this.m_bPolygon&&(0,n.d)(""),t>this.getPathCount()&&(0,n.a)(""),this.m_pathFlags||(0,n.d)(""),this.m_pathFlags.clearBits(t,1)}isStrongPathStart(t){return!!(2&this.m_pathFlags.read(t))}setStrongPathStart(t,e){e?this.m_pathFlags.setBits(t,2):this.m_pathFlags.clearBits(t,2)}isStrongPathEnd(t){return!!(4&this.m_pathFlags.read(t))}setStrongPathEnd(t,e){e?this.m_pathFlags.setBits(t,4):this.m_pathFlags.clearBits(t,4)}clearStrongPathEnds(){for(let t=0,e=this.getPathCount();t<e;++t)this.m_pathFlags.clearBits(t,6)}openAllPathsAndDuplicateStartVertex(){if(this.m_bPolygon&&(0,n.d)(""),this.isEmpty())return;this.m_pathFlags||(0,n.d)("");let t=0;const e=this.getPathCount();for(let n=0;n<e;n++)this.isClosedPath(n)&&(this.getPathSize(n)>0?t++:this.m_pathFlags.clearBits(n,1));if(0===t)return;const s=this.hasNonLinearSegments();let r=0;const o=this.getPathCount(),a=this.m_description.getAttributeCount(),l=new Array(a);let h=null,u=null;for(let n=0;n<o;++n){const e=this.getPathStart(n),o=this.getPathSize(n),c=this.isClosedPath(n);if(o>0){const n=e+r;for(let s=0;s<a;s++)if(this.m_vertexAttributes.get(s)){const r=this.m_description.getSemantics(s),a=bt.getComponentCount(r);if(!l[s]){const e=a*(this.m_pointCount+t),n=(0,i.u)(r,e);l[s]=n}l[s].writeRange(n*a,o*a,this.m_vertexAttributes.get(s),e*a,!0,1),c&&l[s].writeRange((n+o)*a,a,this.m_vertexAttributes.get(s),e*a,!0,1)}if(s){if(null===h){const e=this.m_pointCount+t;h=(0,i.z)(e),u=(0,i.y)(e)}h.writeRange(n,o,this.m_curveData.m_segmentFlags,e,!0,1),u.writeRange(n,o,this.m_curveData.m_segmentParamIndex,e,!0,1),c&&(h.write(n+o,1),u.write(n+o,-1))}}this.m_paths.write(n,e+r),c&&(this.m_pathFlags.clearBits(n,1),++r)}this.m_paths.write(o,this.m_pointCount+t),this.m_pathFlags.clearBits(o,1);for(let n=0;n<a;n++)this.m_vertexAttributes.get(n)&&this.m_vertexAttributes.set(n,l[n]);s&&(this.m_curveData.m_segmentFlags=h,this.m_curveData.m_segmentParamIndex=u),this.m_pointCount+=t,this.m_reservedPointCount>0&&(this.m_reservedPointCount=this.m_pointCount)}closePathWithLine(t){void 0===t&&(t=this.getPathCount()-1),this.throwIfEmpty(),(t<0||t>=this.getPathCount())&&(0,n.a)("close_path_with_line"),t===this.getPathCount()-1&&(this.m_bPathStarted=!1);const e=this.m_pathFlags.read(t);if(1&e||this.m_pathFlags.write(t,1|e),this.m_curveData&&this.m_curveData.m_segmentFlags){const e=this.getPathEnd(t)-1,s=this.m_curveData.m_segmentFlags.read(e);1!==s&&(this.m_curveData.m_segmentFlags.write(e,1),this.m_curveData.m_segmentParamIndex.write(e,-1),this.incCurveType(s,-1),this.modifyCurveCounter(-1))}this.notifyModifiedFlags(2001)}closeLastPathWithSegment(t){this.closePathWithSegment(this.getPathCount()-1,t)}closePathWithSegment(t,e){if(this.throwIfEmpty(),(t<0||t>=this.getPathCount())&&(0,n.a)("close_path_with_line"),e.getEndXY().equals(this.getXY(this.getPathStart(t)))||(0,n.a)("close_path_with_segment: end point mismatch"),t===this.getPathCount()-1)this.m_bPathStarted=!1,this.addSegment(e,!1),--this.m_pointCount,this.m_paths.write(t+1,this.m_pointCount);else{this.mergeVertexDescription(e.getDescription());const s=e.getStartXY(),i=this.getPathEnd(t)-1;s.equals(this.getXY(i))||(0,n.a)("close_path_with_segment: start point mismatch");const r=e.getGeometryType();if(r===n.G.enumLine)return void this.closePathWithLine(t);{const t=ft(e);this.initSegmentData(t);const s=Pt.toSegType(r),n=this.m_curveData.m_segmentFlags.read(i);if(n!==s)this.m_curveData.m_segmentParamIndex.write(i,this.m_curveData.m_curveParamWritePoint),e.writeInBufferStream(this.m_curveData.m_segmentParams,this.m_curveData.m_curveParamWritePoint),this.m_curveData.m_curveParamWritePoint+=t,this.incCurveType(s,1),1!==n?this.incCurveType(n,-1):this.modifyCurveCounter(1);else{const t=this.m_curveData.m_segmentParamIndex.read(i);e.writeInBufferStream(this.m_curveData.m_segmentParams,t)}this.m_curveData.m_segmentFlags.write(i,s)}}const s=this.m_pathFlags.read(t);1&s||this.m_pathFlags.write(t,1|s),this.notifyModifiedFlags(2001)}closeAllPaths(){if(this.m_bPolygon||this.isEmptyImpl())return;this.m_bPathStarted=!1;let t=!1;for(let e=0,s=this.m_paths.size()-1;e<s;e++){if(this.isClosedPath(e))continue;const s=this.m_pathFlags.read(e);this.m_pathFlags.write(e,1|s),t=!0}t&&this.notifyModifiedFlags(512)}isClosedPath(t){return!!(1&this.m_pathFlags.read(t))}isClosedPathInXYPlane(t){if(this.isClosedPath(t))return!0;const e=this.getPathStart(t),s=this.getPathEnd(t)-1;if(e>s)return!1;const n=this.getXY(e),i=this.getXY(s);return n.isEqualPoint2D(i)}isClosedPathIn3D(t){return(0,n.g)(0),!1}hasNonLinearSegmentsPath(t){if(!this.hasNonLinearSegments())return!1;for(let e=this.getPathStart(t),s=this.getPathEnd(t);e<s;e++)if(St.isNonLinearSegmentFlag(this.m_curveData.m_segmentFlags.read(e)))return!0;return!1}isNonLinearSegment(t){return!(1&this.getSegmentFlags(t))}addEnvelope(t,e){if(t.isEmpty())return;const s=0===this.m_pointCount;if(t instanceof o.Envelope2D)this.startPathCoords(t.xmin,t.ymin),e?(this.lineToCoords(t.xmax,t.ymin),this.lineToCoords(t.xmax,t.ymax),this.lineToCoords(t.xmin,t.ymax)):(this.lineToCoords(t.xmin,t.ymax),this.lineToCoords(t.xmax,t.ymax),this.lineToCoords(t.xmax,t.ymin));else{const s=t.getDescription(),n=(0,i.o)(),r=new i.P({vd:s,attribBuffer:n,initDefaultValues:!1});for(let i=0,o=4;i<o;i++){const s=e?o-i-1:i;t.queryCornerByVal(s,r),0===i?this.startPathPoint(r):this.lineToPoint(r)}}this.closePathWithLine(),this.m_bPathStarted=!1,s&&!e&&(this.setDirtyFlagProtected(256,!1),this.m_bPolygon&&Math.min(t.width(),t.height())>0&&this.setIsSimple(3,0))}addPathFromClosedSegment(t,e){if(t.isClosed()||(0,n.a)("add_path_from_closedSegment: segment must be closed"),e){const e=t.getReversed(),s=new i.P;e.queryStart(s),this.startPathPoint(s),this.closeLastPathWithSegment(e)}else{const e=new i.P;t.queryStart(e),this.startPathPoint(e),this.closeLastPathWithSegment(t)}}addSegment_(t,e){const s=t.getDescription();this.mergeVertexDescription(s);const r=(0,i.o)(),o=new i.P({vd:s,attribBuffer:r,initDefaultValues:!1}),a=t.getGeometryType();if(a===n.G.enumLine)(e||this.isEmptyImpl())&&(t.queryStart(o),this.startPathPoint(o)),t.queryEnd(o),this.lineToPoint(o);else{let s=!1;if((e||this.isEmptyImpl())&&(s=!0),s||t.getStartXY().equals(this.getXY(this.m_pointCount-1))||(0,n.a)("add_segment: start point mismatch"),s&&(t.queryStart(o),this.startPathPoint(o)),this.beforeNewSegment(1),t.queryEnd(o),o.getDescription()===this.m_description)this.setPointByVal(this.m_pointCount-1,o);else{const t=(0,i.o)(),e=new i.P({vd:this.m_description,attribBuffer:t,initDefaultValues:!1});o.copyCommonAttributesTo(e),this.setPointByVal(this.m_pointCount-1,e)}const r=ft(t);this.initSegmentData(r),this.m_curveData.m_segmentParamIndex.write(this.m_pointCount-2,this.m_curveData.m_curveParamWritePoint),t.writeInBufferStream(this.m_curveData.m_segmentParams,this.m_curveData.m_curveParamWritePoint),this.m_curveData.m_curveParamWritePoint+=r;const l=Pt.toSegType(a);this.incCurveType(l,1),this.modifyCurveCounter(1),this.m_curveData.m_segmentFlags.write(this.m_pointCount-2,l)}}addSegment(t,e,s){s?e?this.addPathFromClosedSegment(t,!1):this.closeLastPathWithSegment(t):this.addSegment_(t,e)}interpolateAttributesRange(t,e,s,i){for(let a=t;a<s-1;a++)this.isClosedPath(a)&&(0,n.a)("cannot interpolate across closed paths");const r=this.m_description.getAttributeCount();if(1===r)return;const o=this.calculateSubLength2D(t,e,s,i);if(0!==o)for(let n=1;n<r;n++){const r=this.m_description.getSemantics(n);this.interpolateAttributesSemanticsImpl(r,t,e,s,i,o)}}interpolateAttributesSemantics(t,e,s,i,r){if(0===t)return;this.hasAttribute(t)||(0,n.a)("does not have the given attribute"),2===bt.getInterpolation(t)&&(0,n.a)("angular interpolation");for(let a=e;a<i-1;a++)this.isClosedPath(a)&&(0,n.a)("cannot interpolate across closed paths");const o=this.calculateSubLength2D(e,s,i,r);0!==o&&this.interpolateAttributesSemanticsImpl(t,e,s,i,r,o)}interpolateAttributesPath(t,e,s){const n=this.m_description.getAttributeCount();if(1===n)return;if(e===s)return;const i=this.calculatePathSubLength2D(t,e,s);for(let r=1;r<n;r++){const n=this.m_description.getSemantics(r);this.interpolateAttributesSemanticsPathImpl(n,t,e,s,i)}}interpolateAttributesSemanticsPath(t,e,s,i){if(0===t)return;this.hasAttribute(t)||(0,n.a)("does not have the given attribute"),2===bt.getInterpolation(t)&&(0,n.a)("angular interpolation");const r=this.calculatePathSubLength2D(e,s,i);0!==r&&this.interpolateAttributesSemanticsPathImpl(t,e,s,i,r)}interpolateAttributesSemanticsImpl(t,e,s,n,i,o){const a=this.querySegmentIterator(),l=this.getPathStart(e)+s,h=this.getPathStart(n)+i,u=bt.getComponentCount(t),c=(0,r.d)(bt.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(t,l,c,u);const m=(0,r.d)(bt.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(t,h,m,u);const d=(0,r.d)(bt.maxComponentCount(),Number.NaN);(0,r.b)(d,c,0,0,u);let g=0;const p=bt.getDefaultValue(t),_=bt.getInterpolation(t);a.resetToVertex(l,e);do{if(a.hasNextSegment()){if(a.nextSegment(),a.getStartPointIndex()===h)return;this.setAttributeFromArray(t,a.getStartPointIndex(),d,u),a.previousSegment();do{const e=a.nextSegment();if(a.getEndPointIndex()===h)return;g+=e.calculateLength2D(),(0,r.A)(_,c,m,d,0,u,g/o,p),a.isClosingSegment()||this.setAttributeFromArray(t,a.getEndPointIndex(),d,u)}while(a.hasNextSegment())}}while(a.nextPath())}interpolateAttributesSemanticsPathImpl(t,e,s,i,o){(0,n.g)(0!==t);const a=this.querySegmentIterator(),l=bt.getInterpolation(t),h=this.getPathStart(e)+s,u=this.getPathStart(e)+i;if(u===h)return;const c=bt.getComponentCount(t),m=(0,r.d)(bt.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(t,h,m,c);const d=(0,r.d)(bt.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(t,u,d,c);const g=new r.K(0);a.resetToVertex(h,e),a.setCirculator(this.isClosedPath(e));const p=bt.getDefaultValue(t),_=(0,r.d)(bt.maxComponentCount(),Number.NaN);(0,r.b)(_,m,0,0,c);const f=0===o;let y=.5;do{const e=a.nextSegment();if(this.setAttributeFromArrayNoCurves(t,a.getStartPointIndex(),_,c),!f){const t=e.calculateLength2D();g.pe(t),y=g.getResult()/o}(0,r.A)(l,m,d,_,0,c,y,p)}while(a.getEndPointIndex()!==u)}querySegment(t,e,s){const i=this.getPathIndexFromPointIndex(t),r=t-this.getPathStart(i);r>=this.getSegmentCountPath(i)&&(0,n.a)("get_segment"),this.getSegmentFromPath(i,r,e,s)}getSegment(t,e){const s=new this.m_segmentBufferCTor;return this.getSegmentBuffer(t,s,e),s.releaseSegment()}getSegmentType(t){const e=this.getPathIndexFromPointIndex(t),s=t-this.getPathStart(e);return s>=this.getSegmentCountPath(e)&&(0,n.a)("get_segment"),this.getSegmentTypeFromPath(e,s)}getSegmentFromPath(t,e,s,r){const o=this.getPathStart(t)+e,a=this.getSegmentFlagsStreamRef();let l=1;switch(a&&(l=31&a.read(o)),l){case 1:s.createLine();break;case 2:s.createCubicBezier();break;case 4:s.createEllipticArc();break;case 8:s.createQuadraticRationalBezier();break;case 16:s.createQuadraticBezier();break;default:(0,n.d)("")}const h=s.get();let u,c=null;if(r?(c=(0,i.j)(),h.assignVertexDescription(c)):h.assignVertexDescription(this.m_description),u=o===this.getPathEnd(t)-1&&this.isClosedPath(t)?this.getPathStart(t):o+1,M(h,this.getXY(o)),N(h,this.getXY(u)),!r)for(let n=1,i=this.m_description.getAttributeCount();n<i;n++){const t=this.m_description.getSemantics(n),e=bt.getComponentCount(t);for(let s=0;s<e;s++){const e=this.getAttributeAsDbl(t,o,s);h.setStartAttribute(t,s,e);const n=this.getAttributeAsDbl(t,u,s);h.setEndAttribute(t,s,n)}}if(St.isNonLinearSegmentFlag(l)){const t=this.m_curveData.m_segmentParamIndex.read(o);h.readFromBufferStream(this.m_curveData.m_segmentParams,t)}}replaceLinearEllipticalArcsWithTrueLines(){if(!this.hasNonLinearSegments())return!1;if(0===this.m_curveData.m_arcCount)return!1;let t=!1;for(let e=0,s=this.getPointCount();e<s;e++)if(4===this.m_curveData.m_segmentFlags.read(e)){const s=this.m_curveData.m_segmentParamIndex.read(e);_t(this.m_curveData.m_segmentParams,s).isNAN()&&(this.m_curveData.m_segmentFlags.write(e,1),this.m_curveData.m_segmentParamIndex.write(e,-1),this.incCurveType(4,-1),this.modifyCurveCounter(-1),t=!0)}return t&&this.checkCompactSegmentParams(),t}queryPointAlongPath(t,e,s,i=!1){const o={iSegment:-1},a=i?o:{tSegment:0};if(s.setEmpty(),this.isEmpty())return o;if((t<0||t>=this.getPathCount())&&(0,n.a)("query_point_along_path"),e<0)return o;const l=this.getPathSize(t);if(0===l)return o;if(1===l)return this.getPointByVal(this.getPathStart(t),s),a.tSegment=0,o.iSegment=this.getPathStart(t),o;const h=this.querySegmentIteratorAtVertex(this.getPathStart(t)),u=new r.K(0);for(;h.hasNextSegment();){const t=h.nextSegment(),n=t.calculateLength2D(),i=u.getResult();if(u.add(n),u.getResult()>=e){let r=e-i;r>n&&(r=n);const l=t.lengthToT(r);return t.queryCoord(l,s),a.tSegment=l,o.iSegment=h.getStartPointIndex(),o}}if(this.isClosedPath(t)){const e=this.getPathStart(t);return this.getPointByVal(e,s),a.tSegment=1,o.iSegment=this.getPathEnd(t)-1,o}{const e=this.getPathEnd(t)-1;return this.getPointByVal(e,s),this.getPathSize(t)>1?(a.tSegment=1,o.iSegment=this.getPathEnd(t)-2,o):(a.tSegment=0,o.iSegment=this.getPathStart(t),o)}}queryPointsAlongPath(t,e,s,i,o,a){{let t=0;for(let r=0;r<e;++r)i&&i[r].setEmpty(),o&&(o[r]=-1),a&&(a[r]=0),t>s[r]&&(0,n.a)("query_points_along"),t=s[r]}const l=this.getPathSize(t);if(0===e||0===l)return 0;if(1===l){const e=this.getPathStart(t);return i&&this.getPointByVal(e,i[0]),a&&(a[0]=0),o&&(o[0]=e),1}const h=this.getPathStart(t),u=new r.K(0),c=this.querySegmentIteratorAtVertex(h);let m=0,d=0,g=s[m];for(;c.hasNextSegment();){const t=c.nextSegment(),n=t.calculateLength2D(),r=u.getResult();for(u.add(n);u.getResult()>=g;){let l=g-r;l>n&&(l=n);const h=t.lengthToT(l);if(i&&t.queryCoord(h,i[d]),a&&(a[d]=h),o&&(o[d]=c.getStartPointIndex()),d++,m++,g=s[m],m===e)return d}}if(this.isClosedPath(t)){const e=this.getPathStart(t),s=0;i&&this.getPointByVal(e,i[d]),a&&(a[d]=s),o&&(o[d]=e),d++}else if(this.getPathSize(t)>1){const e=this.getPathEnd(t)-2,s=1;i&&this.getPointByVal(e+1,i[d]),a&&(a[d]=s),o&&(o[d]=e),d++}return d}queryPointsAlong(t,e,s,i,o){{let r=0;for(let a=0;a<t;++a)s&&s[a].setEmpty(),i&&(i[a]=-1),o&&(o[a]=0),r>e[a]&&(0,n.a)("query_points_along"),r=e[a]}if(0===t)return 0;const a=new r.K(0),l=this.querySegmentIterator();let h=-1,u=0,c=0,m=e[u];for(;l.nextPath();)for(;l.hasNextSegment();){h=l.getPathIndex();const n=l.nextSegment(),r=n.calculateLength2D(),d=a.getResult();for(a.add(r);a.getResult()>=m;){let a=m-d;a>r&&(a=r);const h=n.lengthToT(a);if(s&&n.queryCoord(h,s[c]),o&&(o[c]=h),i&&(i[c]=l.getStartPointIndex()),c++,u++,m=e[u],u===t)return c}}if(h<0)return 0;if(this.isClosedPath(h)){const t=this.getPathStart(h),e=0;s&&this.getPointByVal(t,s[c]),o&&(o[c]=e),i&&(i[c]=t),c++}else if(this.getPathSize(h)>1){const t=this.getPathEnd(h)-2,e=1;s&&this.getPointByVal(t+1,s[c]),o&&(o[c]=e),i&&(i[c]=t),c++}return c}querySegmentIterator(){return new mt({parent:this})}querySegmentIteratorAtVertex(t){return new mt({parent:this,pointIndex:t})}queryPathEnvelope(t,e){this.queryPathEnvelopeImpl(t,e,!0)}queryLoosePathEnvelope(t,e){this.queryPathEnvelopeImpl(t,e,!1)}queryPathEnvelopeImpl(t,e,s){if(e instanceof i.E&&(0,n.g)(0,"not implemented for Envelope"),e instanceof i.n&&(0,n.g)(0,"not implemented for Envelope3D"),(t>=this.getPathCount()||t<0)&&(0,n.a)(""),this.isEmpty())return void e.setEmpty();const r=this.getAttributeStreamRef(0),a=o.Envelope2D.constructEmpty();a.setEmpty();for(let i=2*this.getPathStart(t),o=2*this.getPathEnd(t);i<o;){const t=o-i;(0,n.g)(!(1&t)),a.mergePointsInterleaved(r,i/2,t/2),i+=t}if(e.setCoords({env2D:a}),this.hasNonLinearSegmentsPath(t)){const i=this.querySegmentIterator();if(i.resetToPath(t),i.nextPath())for(;i.hasNextSegment();){const t=i.nextCurve();if(!t)break;{const n=o.Envelope2D.constructEmpty();s?t.queryEnvelope(n):t.queryLooseEnvelope(n),e.mergeEnvelope2D(n)}}else(0,n.g)(0)}}checkCompactSegmentParams(){if(!this.m_curveData||null===this.m_curveData.m_segmentParams)return!1;if(this.m_curveData.m_segmentParams.size()<=this.m_vertexAttributes.get(0).size())return!1;const t=yt(4)*this.m_curveData.m_arcCount+yt(2)*this.m_curveData.m_bezierCount+yt(8)*this.m_curveData.m_rbezier2Count+yt(16)*this.m_curveData.m_bezier2Count;return this.m_curveData.m_segmentParams.size()>Math.max(3*t>>1,10)?(this.forceCompactSegmentParams(),!0):(0===this.m_pointCount&&(this.m_curveData.m_curveParamWritePoint=0),!1)}forceCompactSegmentParams(){let t=0;for(let n=0,i=this.getPointCount();n<i;n++){const e=this.m_curveData.m_segmentFlags.read(n);St.isNonLinearSegmentFlag(e)&&(t+=yt(e))}const e=(0,i.D)(t);let s=0;for(let n=0,i=this.getPointCount();n<i;n++){const t=this.m_curveData.m_segmentFlags.read(n);if(St.isNonLinearSegmentFlag(t)){let i=this.m_curveData.m_segmentParamIndex.read(n);this.m_curveData.m_segmentParamIndex.write(n,s);const r=yt(t);for(let t=0;t<r;t++)e.write(s,this.m_curveData.m_segmentParams.read(i)),s++,i++}}this.m_curveData.m_segmentParams=e,this.m_curveData.m_curveParamWritePoint=s}setEmpty(){this.m_curveData&&(this.removeAllCurvesFromGlobalCounter(),this.m_curveData=null),this.m_bPathStarted=!1,this.m_paths=null,this.m_pathFlags=null,this.setEmptyImpl()}applyTransformation(t){this.applyTransformationToPath(t,-1)}applyTransformation3D(t){(0,n.g)(0)}getImpl(){return this}reserve(t){this.reserveImpl(t),t>0&&!this.m_paths&&(this.m_paths=(0,i.y)(0),this.m_pathFlags=(0,i.z)(0),this.m_paths.reserve(2),this.m_pathFlags.reserve(2),this.m_paths.resize(1,0),this.m_pathFlags.resize(1,this.m_bPolygon?1:0))}reserveParts(t,e){this.reserveImpl(t),e>0&&(this.m_paths?(this.m_paths.reserve(e+1),this.m_pathFlags.reserve(e+1)):(this.m_paths=(0,i.y)(0),this.m_pathFlags=(0,i.z)(0),this.m_paths.reserve(e+1),this.m_pathFlags.reserve(e+1),this.m_paths.resize(1,0),this.m_pathFlags.resize(1,this.m_bPolygon?1:0)))}clone(){const t=this.createInstance();return this.copyTo(t),t}queryLimitedSegmentIterator(t){return new Et(this,t)}getPathStreamRef(){return this.throwIfEmpty(),this.m_paths}setPathStreamRef(t){this.m_paths=t}getSegmentFlagsStreamRef(){return this.throwIfEmpty(),null!=this.m_curveData?this.m_curveData.m_segmentFlags:null}getPathFlagsStreamRef(){return this.throwIfEmpty(),this.m_pathFlags}setPathFlagsStreamRef(t){this.m_pathFlags=t}getSegmentIndexStreamRef(){return this.throwIfEmpty(),null!==this.m_curveData?this.m_curveData.m_segmentParamIndex:null}getSegmentDataStreamRef(){return this.throwIfEmpty(),null!==this.m_curveData?this.m_curveData.m_segmentParams:null}setSegmentData(t,e,s,n){this.m_curveData||(this.m_curveData=new Pt),this.m_curveData.m_segmentFlags=s,this.m_curveData.m_segmentParams=e,this.m_curveData.m_segmentParamIndex=t,this.m_curveData.m_curveParamWritePoint=n}static getPathIndexFromPointIndexImpl(t,e,s,i){if(i>=0&&i<e){if(s>=t.read(i)){if(s<t.read(i+1))return i;i++}else i--;if(i>=0&&i<e&&s>=t.read(i)&&s<t.read(i+1))return i}if(e<5){for(let n=0;n<e;n++)if(s<t.read(n+1))return n;(0,n.n)("")}let r=0,o=e-1;for(;o>r;){const e=r+(o-r>>1);if(s<t.read(e))o=e-1;else{if(!(s>=t.read(e+1)))return e;r=e+1}}return r}getHighestPointIndex(t){(0,n.g)(t>=0&&t<this.getPathCount());const e=this.getAttributeStreamRef(0),s=this.getPathEnd(t),i=this.getPathStart(t);let o=-1;const a=new r.P;a.y=Number.NEGATIVE_INFINITY,a.x=Number.NEGATIVE_INFINITY;for(let n=i+0;n<s;n++){const t=e.readPoint2D(2*n);-1===a.compare(t)&&(o=n,a.setCoordsPoint2D(t))}return o}applyTransformationToPath(t,e){if(e>=this.getPathCount()&&(0,n.a)("apply_transformation"),this.isEmpty())return;if(t.isIdentity())return;const s=this.m_vertexAttributes.get(0);if(!(e<0?this.hasNonLinearSegments():this.hasNonLinearSegmentsPath(e))){let n,i;return e<0?(n=0,i=this.m_pointCount):(n=this.getPathStart(e),i=this.getPathEnd(e)),s.applyTransformation(t,2*n,i-n),void this.notifyModifiedFlags(2001)}const i=new this.m_segmentBufferCTor,o=this.getPathCount();let a=e<0?0:e;do{const n=this.getPathStart(a),o=this.getPathEnd(a),l=this.isClosedPath(a),h=s.readPoint2D(2*n);if(!this.hasNonLinearSegmentsPath(a)){s.applyTransformation(t,2*n,o-n);continue}const u=r.P.getNAN();for(let e=n;e<o;++e){if(1!=(31&this.m_curveData.m_segmentFlags.read(e))){const r=l&&e+1===o;r&&s.writePoint2D(2*n,h),this.getSegmentBuffer(e,i,!0),i.get().applyTransformation(t);const a=this.m_curveData.m_segmentParamIndex.read(e);i.get().writeInBufferStream(this.m_curveData.m_segmentParams,a),s.writePoint2D(2*e,i.get().getStartXY()),r&&s.writePoint2D(2*n,i.get().getEndXY());continue}const r=2*e;s.queryPoint2D(r,u),t.transformInPlace(u),s.writePoint2D(r,u)}if(a===e)break}while(++a<o);this.notifyModifiedFlags(2001)}calculateSubLength2D(t,e,s,i){const r=this.getPathStart(t)+e,o=this.getPathStart(s)+i;(o<r||r<0||o>this.getPointCount()-1)&&(0,n.p)("");const a=this.querySegmentIterator();let l=0;a.resetToVertex(r,t);do{for(;a.hasNextSegment();){const t=a.nextSegment();if(a.getStartPointIndex()===o)break;l+=t.calculateLength2D()}if(a.getStartPointIndex()===o)break}while(a.nextPath());return l}calculatePathSubLength2D(t,e,s){const i=this.getPathStart(t)+e,r=this.getPathStart(t)+s;(i<0||r>this.getPointCount()-1)&&(0,n.p)("");const o=this.querySegmentIterator();if(i>r&&(this.isClosedPath(t)||(0,n.a)("cannot iterate across an open path"),o.setCirculator(!0)),i===r)return 0;let a=0,l=0;o.resetToVertex(i,t);do{l+=a,a=o.nextSegment().calculateLength2D()}while(o.getStartPointIndex()!==r);return l}calculateEnvelope2D(t){return this.updateXYImpl(t)}updateXYImpl(t){const e=super.updateXYImpl(t);if(this.hasNonLinearSegments()){const s=o.Envelope2D.constructEmpty(),n=this.querySegmentIterator();for(;n.nextPath();)for(;n.hasNextSegment();){const i=n.nextCurve();if(!i)break;t?i.queryEnvelope(s):i.queryLooseEnvelope(s),e.mergeEnvelope2D(s)}}return e}notifyModifiedAllImpl(){null!==this.m_paths&&this.m_paths.size()?this.m_pointCount=this.m_paths.read(this.m_paths.size()-1):this.m_pointCount=0}setDirtyOGCFlags(t){this.setDirtyFlagProtected(16,t)}hasDirtyOGCStartFlags(){return this.hasDirtyFlag(16)}setDirtyRingAreas2D(t){this.setDirtyFlagProtected(1024,t)}hasDirtyRingAreas2D(){return this.hasDirtyFlag(1024)}static isNonLinearSegmentFlag(t){return!(1&t)}addAndExplicitlyOpenAllPaths(t,e){this===t&&(0,n.a)("Multi_path_impl::add");let s=this.getPathCount();for(let n=0,i=t.getPathCount();n<i;n++)this.addPath(t,n,!e),this.openPathAndDuplicateStartVertex(s),s++}getSegmentFlags(t){return null!==this.m_curveData&&null!==this.m_curveData.m_segmentFlags?this.m_curveData.m_segmentFlags.read(t):1}getSegmentBuffer(t,e,s){const i=this.getPathIndexFromPointIndex(t),r=t-this.getPathStart(i);r>=this.getSegmentCountPath(i)&&(0,n.a)("getSegmentBuffer"),this.getSegmentFromPath(i,r,e,s)}getSegmentTypeFromPath(t,e){const s=this.getPathStart(t)+e,i=this.getSegmentFlagsStreamRef();let r=1;switch(i&&(r=31&i.read(s)),r){case 1:return n.G.enumLine;case 2:return n.G.enumBezier;case 4:return n.G.enumEllipticArc;case 8:return n.G.enumRationalBezier2;case 16:return n.G.enumBezier2;default:(0,n.d)("")}}ensureXYMonotoneSegments(){if(!this.m_curveData)return!1;let t=!1;for(let e=0,s=this.getPathCount();e<s;e++){const s=this.getPathStart(e),i=this.getPathEnd(e),o=i-s;for(let e=s;e<i;e++){const i=31&this.m_curveData.m_segmentFlags.read(e);if(1===i)continue;2!==i&&(0,n.t)("ensure_xy_monotone_segments");const a=(e-s+1)%o+s,l=this.m_curveData.m_segmentParamIndex.read(e),h=(0,r.m)(r.P,4);h[0]=this.getXY(e),h[3]=this.getXY(a),h[1].x=this.m_curveData.m_segmentParams.read(l),h[1].y=this.m_curveData.m_segmentParams.read(l+1),h[2].x=this.m_curveData.m_segmentParams.read(l+2),h[2].y=this.m_curveData.m_segmentParams.read(l+3),E(h)&&(t=!0,this.m_curveData.m_segmentParams.write(l,h[1].x),this.m_curveData.m_segmentParams.write(l+1,h[1].y),this.m_curveData.m_segmentParams.write(l+2,h[2].x),this.m_curveData.m_segmentParams.write(l+3,h[2].y))}}return t&&this.notifyModifiedFlags(2001),t}buildRasterizedGeometryAccelerator(t,e){return!1}buildQuadTreeAccelerator(t){if(this.m_accelerators||(this.m_accelerators=new dt),null!==this.m_accelerators.getQuadTree())return!0;this.ensureUniqueAccelerators(),this.m_accelerators.setQuadTree(null);const e=(0,i.F)(this);return this.m_accelerators.setQuadTree(e),!0}buildQuadTreeForPathsAccelerator(t){if(this.m_accelerators||(this.m_accelerators=new dt),null!==this.m_accelerators.getQuadTreeForPaths())return!0;this.ensureUniqueAccelerators(),this.m_accelerators.setQuadTreeForPaths(null);const e=(0,i.G)(this);return this.m_accelerators.setQuadTreeForPaths(e),!0}updateCurveCounter(t){this.modifyCurveCounter(t-this.getCurveCount())}removeAllCurvesFromGlobalCounter(){this.m_curveData&&(St.st_totalCurveCount-=this.m_curveData.m_curveCount,this.m_curveData.m_curveCount=0,this.m_curveData.m_bezierCount=0,this.m_curveData.m_arcCount=0,this.m_curveData.m_bezier2Count=0,this.m_curveData.m_rbezier2Count=0,this.m_curveData.m_curveParamWritePoint=0)}modifyCurveCounter(t){t&&(this.m_curveData||(this.m_curveData=new Pt),St.st_totalCurveCount+=t,this.m_curveData.m_curveCount+=t)}getCurveCount(){return this.m_curveData?this.m_curveData.m_curveCount:0}incCurveType(t,e){this.m_curveData||(this.m_curveData=new Pt),2&t?this.m_curveData.m_bezierCount+=e:4&t?this.m_curveData.m_arcCount+=e:8&t?this.m_curveData.m_rbezier2Count+=e:16&t&&(this.m_curveData.m_bezier2Count+=e)}getCurveWritePoint(){return null!==this.m_curveData?this.m_curveData.m_curveParamWritePoint:0}initSegmentData(t){null===this.m_curveData&&(this.m_curveData=new Pt);const e=this.m_reservedPointCount>0?this.m_reservedPointCount:this.m_pointCount;null===this.m_curveData.m_segmentParamIndex&&(this.m_curveData.m_segmentFlags=(0,i.z)(e,1),this.m_curveData.m_segmentParamIndex=(0,i.y)(e,-1));const s=this.m_curveData.m_curveParamWritePoint+t;null===this.m_curveData.m_segmentParams?this.m_curveData.m_segmentParams=(0,i.D)(s):s!==this.m_curveData.m_segmentParams.size()&&this.m_curveData.m_segmentParams.resize(s,0),this.m_curveData.m_segmentFlags.size()<e&&(this.m_curveData.m_segmentFlags.resize(e,1),this.m_curveData.m_segmentParamIndex.resize(e,-1))}updateCurveWritePoint(t){null===this.m_curveData&&(this.m_curveData=new Pt),this.m_curveData.m_curveParamWritePoint=t}updateOGCFlagsHelper(){const t=this.getPathCount();if(0===t)return;const e=this.m_pathFlags;let s=0;for(let n=0;n<t;n++){const t=this.m_cachedRingAreas2D.read(n);0===s&&(s=(0,r.e)(t)),t*s>0||0===s?e.setBits(n,8):e.clearBits(n,8)}}updateOGCFlagsProtected(){this.hasDirtyFlag(16)&&(this.updateRingAreas2DProtected(),this.updateOGCFlagsHelper(),this.setDirtyFlagProtected(16,!1))}replaceSegment(t,e,s){(t<0||t>=this.getPointCount())&&(0,n.a)("Multi_path_impl.replace_segment"),(0,n.g)(e.isCurve());const i=this.getPathIndexFromPointIndex(t),r=this.getPathStart(i),o=(t-r+1)%this.getPathSize(i)+r;{const s=this.getXY(t),i=this.getXY(o),r=!s.isEqualPoint2D(e.getStartXY())||!i.isEqualPoint2D(e.getEndXY());(0,n.g)(!r)}this.replaceSegmentImpl(t,o,e,s)}replaceSegmentImpl(t,e,s,o){const a=s.getDescription();this.mergeVertexDescription(a);const l=(0,r.d)(32,Number.NaN),h=new i.P({vd:a,attribBuffer:l,initDefaultValues:!1}),u=null===this.m_curveData?1:31&this.m_curveData.m_segmentFlags.read(t),c=yt(u),m=ft(s);let d,g=!1;c>=m?((0,n.g)(null!==this.m_curveData),g=!0,d=this.m_curveData.m_segmentParamIndex.read(t)):(this.initSegmentData(m),g=!1,d=this.m_curveData.m_curveParamWritePoint);const p=s.getGeometryType(),_=Pt.toSegType(p);o||(s.queryStart(h),this.setPointByValNoCurves(t,h),s.queryEnd(h),this.setPointByValNoCurves(e,h)),this.m_curveData.m_segmentParamIndex.write(t,1!==_?d:-1),this.m_curveData.m_segmentFlags.write(t,_),1!==_&&s.writeInBufferStream(this.m_curveData.m_segmentParams,d),g||(this.m_curveData.m_curveParamWritePoint+=m),u!==_&&(this.incCurveType(u,-1),this.incCurveType(_,1),this.modifyCurveCounter(1===u?1:-1))}setAttributeImpl(t,e,s){if(this.addAttribute(t),!this.isEmpty())if(this.hasNonLinearSegments()&&0===t){(e<0||e>1)&&(0,n.a)("");const t=new a.T,i=0===e?s:0,r=0===e?0:1;t.setShiftCoords(i,r),0===e?t.xx=0:t.yy=0,this.applyTransformation(t)}else super.setAttributeImpl(t,e,s)}}St.st_totalCurveCount=0;class Et{constructor(t,e){this.m_segIter=null,this.m_quadTree=null,this.m_qtIter=null,this.m_extentOfInterest=new o.Envelope2D(e),this.m_bfirst=!0,this.m_prevIndex=-100,this.m_parent=t}nextSegment(){return this.m_bfirst&&this.prepare_(),this.m_quadTree?this.nextSegmentQt():this.nextSegmentNoQt()}getPathIndex(){return this.m_segIter.getPathIndex()}getStartPointIndex(){return this.m_segIter.getStartPointIndex()}getEndPointIndex(){return this.m_segIter.getEndPointIndex()}isClosingSegment(){return this.m_segIter.isClosingSegment()}isPathClosed(){return this.m_segIter.isPathClosed()}prepare_(){const t=this.m_parent.getAccelerators();t&&(this.m_quadTree=t.getQuadTree(),this.m_quadTree&&(this.m_qtIter=this.m_quadTree.getSortedIterator(this.m_extentOfInterest,0))),this.m_segIter=this.m_parent.querySegmentIterator()}nextSegmentQt(){this.m_bfirst=!1;const t=this.m_qtIter.next();if(-1===t)return null;const e=this.m_quadTree.getElement(t);return(e!==this.m_prevIndex+1||this.m_segIter.isLastSegmentInPath())&&(this.m_segIter.resetToVertex(e,this.m_segIter.getPathIndex()),this.m_prevIndex=e),this.m_segIter.nextSegment()}nextSegmentNoQt(){for(;;){if(!this.m_bfirst&&this.m_segIter.hasNextSegment()){const t=this.m_segIter.nextSegment(),e=o.Envelope2D.constructEmpty();if(t.queryLooseEnvelope(e),!e.isIntersecting(this.m_extentOfInterest))continue;return t}if(this.m_bfirst=!1,!this.m_segIter.nextPath())return null}}}class Ct extends St{constructor(t){t?t.vd?(super({vd:t.vd,bPolygon:!1}),this.m_segmentBufferCTor=Yr):t.copy?(super({vd:t.copy.getDescription(),bPolygon:!1}),this.m_segmentBufferCTor=Yr,t.copy.copyTo(this)):t.move?(super({move:t.move}),this.m_segmentBufferCTor=Yr):t.start?(super({vd:t.start.getDescription(),bPolygon:!1}),this.m_segmentBufferCTor=Yr,this.startPathPoint(t.start),this.lineToPoint(t.end)):t.path?(super({bPolygon:!1}),this.m_segmentBufferCTor=Yr,this.addPathPoint2D(t.path,t.pointCount,t.bForward)):(0,n.d)("bad constructor arg"):(super({bPolygon:!1}),this.m_segmentBufferCTor=Yr)}getBoundary(){return Tt(this)}assignCopy(t){return this!==t&&t.copyTo(this),this}assignMove(t){return t.copyTo(this),this}getGeometryType(){return Ct.type}getDimension(){return 1}createInstance(){return new Ct({vd:this.getDescription()})}equals(t,e){return this.equalsBase(t,e)}}Ct.type=n.G.enumPolyline;var wt=n.G;function It(t,e){if(t.isEmpty())return!1;const s=t.getGeometryType();if(s===wt.enumPolygon)return 0!==t.calculateArea2D();if(s===wt.enumPolyline)return At(t.getImpl(),e,!0).bNotEmpty;if(s===wt.enumEnvelope)return!0;if((0,n.f)(s))return!!t.isClosed();if((0,n.e)(s))return!1;if(s===wt.enumGeometryCollection){const s=t;for(let t=0,n=s.getGeometryCount();t<n;t++)if(It(s.getGeometry(t),e))return!0;return!1}(0,n.t)("")}function Tt(t,e){const s=t.getGeometryType();if(s===wt.enumPolygon){const e=new Ct({vd:t.getDescription()});return t.isEmpty()||t.copyToUnchecked(e),e}if(s===wt.enumPolyline)return At(t.getImpl(),e,!1).boundary;if(s===wt.enumEnvelope){const e=new Ct({vd:t.getDescription()});return t.isEmpty()||e.addEnvelope(t,!1),e}if((0,n.f)(s)){const e=new p({vd:t.getDescription()});if(!t.isEmpty()&&!t.isClosed()){const s=new i.P;e.reserve(2),t.queryStart(s),e.add(s),t.queryEnd(s),e.add(s)}return e}if(s===wt.enumGeometryCollection){const s=t;let n=null;for(let i=0,r=s.getGeometryCount();i<r;i++){const r=Tt(s.getGeometry(i),e);if(null!==r){null===n&&(n=t.createInstance());const e=r;n.addGeometry(e)}}return n}if((0,n.e)(s))return new i.P({vd:t.getDescription()});(0,n.t)("")}function At(t,e,s){const n=!1,o=t;let a=null;if(s||(a=new p({vd:o.getDescription()})),!o.isEmpty()){const t=new i.A(0);for(let e=0,s=o.getPathCount();e<s;e++)if(o.getPathSize(e)>0&&!o.isClosedPathInXYPlane(e)){const s=o.getPathStart(e);t.add(s);const n=o.getPathEnd(e)-1;t.add(n)}if(t.size()>0){const e=new i.B,n=o.getAttributeStreamRef(0),l={userSort(t,e,s){const i=r.P.getNAN(),o=r.P.getNAN();s.sort(t,e,((t,e)=>(n.queryPoint2D(2*t,i),n.queryPoint2D(2*e,o),i.compare(o))))},getValue:t=>n.read(2*t+1)};e.sort(t,0,t.size(),l);let h=n.readPoint2D(2*t.read(0)),u=0,c=1;const m=new i.P;for(let i=1,o=t.size();i<o;i++){const e=n.readPoint2D(2*t.read(i));if(e.isEqualPoint2D(h))t.read(u)>t.read(i)?(t.write(u,(0,r.j)()),u=i):t.write(i,(0,r.j)()),c++;else{if(1&c){if(s)return{bNotEmpty:!0,boundary:new p({})}}else t.write(u,(0,r.j)());h=e,u=i,c=1}}if(1&c){if(s)return{bNotEmpty:!0,boundary:new p({})}}else t.write(u,(0,r.j)());if(!s){t.sort(0,t.size());for(let e=0,s=t.size();e<s&&t.read(e)!==(0,r.j)();e++)o.getPointByVal(t.read(e),m),a.add(m)}}}return s?{bNotEmpty:n,boundary:new p({})}:{bNotEmpty:n,boundary:a}}function Mt(t,e,s,i){const o=4*(0,r.O)()*(Math.abs(e.vmin)+Math.abs(e.vmax)),a=(0,r.O)();if(1===t.getMaxDerivative()){(0,n.g)(s>0);const a=kt(t,0,e,(0,r.O)(),o);return i[0]=a.root,a.cRoots}let l,h=[];const u=new r.E(e.vmin-o,e.vmax+o);h.push(new r.P(u.vmin,u.vmax));let c=0;for(let n=t.getMaxDerivative()-1;n>=0;n--){l=h,h=[];for(let u=0,m=l.length;u<m;u++){if(l[u][0]<l[u][1]){let m,d,g;if(n===t.getMaxDerivative()-1?({root:m,funcAtRoot:d,cRoots:g}=kt(t,n,r.E.construct(l[u][0],l[u][1]),a,.5*o)):({root:m,funcAtRoot:d,cRoots:g}=Lt(t,n,r.E.construct(l[u][0],l[u][1]),a,.5*o)),1===g){if(0===n)c<s&&(l[u][0]<=e.vmin&&l[u][1]>=e.vmin&&m!==e.vmin&&0===t.getValue(0,e.vmin)&&(m=e.vmin),l[u][0]<=e.vmax&&l[u][1]>=e.vmax&&m!==e.vmax&&0===t.getValue(0,e.vmax)&&(m=e.vmax),i[c]=e.snapClip(m),c>0?i[c]-i[c-1]>o&&c++:c++);else{const t=r.P.getNAN();t[0]=l[u][0],t[1]=m,h.push(t);const e=r.P.getNAN();e[0]=m,e[1]=l[u][1],h.push(e)}continue}}h.push(l[u])}}return c}function Dt(t,e,s,n,i,o){const a=(0,r.m)(r.H,2),l=zt(new r.H(t),new r.H(e),new r.H(s),n,i,a);return o[0]=a[0].value(),o[1]=a[1].value(),l}function Nt(t,e,s,n,i,o,a){const l=(0,r.m)(r.H,3),h=Ot(new r.H(t),new r.H(e),new r.H(s),new r.H(n),i,o,l);return a[0]=l[0].value(),a[1]=l[1].value(),a[2]=l[2].value(),h}function Ft(t,e,s,n,i,o,a,l){return function(t,e,s,n,i,o,a,l){const h=(0,r.d)(s*s,Number.NaN);h.fill(0),(0,r.b)(l,n,0,0,s);const u=(0,r.d)(s,Number.NaN),c=(0,r.d)(s,Number.NaN),m=(0,r.d)(s,Number.NaN);let d=t(l,s,e);const g=100;let p=0;for(p=0;p<g;p++){const n=d;for(let t=0;t<s;++t)c[t]=l[t];if(p%s==0){h.fill(0);for(let t=0;t<s;t++)h[t*s+t]=1}let a=0,g=0;for(let r=0;r<s;++r){for(let t=0;t<s;++t)u[t]=h[r*s+t];const n=d;d=Gt(t,e,l,u,i,o,s);const c=n-d;c>a&&(g=r,a=c)}for(let t=0;t<s;t++)u[t]=l[t]-c[t],m[t]=l[t]+(l[t]-c[t]);const _=t(m,s,e);if(_<n&&2*(n-2*d+_)*(0,r.a)(n-d-a)<(0,r.a)(n-_)*a){d=Gt(t,e,l,u,i,o,s);for(let t=0;t<s;++t)h[g*s+t]=h[(s-1)*s+t],h[(s-1)*s+t]=u[t]}if(n<=d)return t(l,s,e)}return d}(t,e,s,n,i,o,0,l)}function Rt(t,e,s,n,i,o){return function(t,e,s,n,i,o){const a=(0,r.aq)();let l=n,h=t(l,e),u=s,c=i,m=t(u,e),d=t(c,e);h>m&&(h=m,l=u),h>d&&(h=d,l=c);let g=u,p=c,_=m,f=d;_>f&&(_=(0,r.c)(f,f=_),p=(0,r.c)(g,g=p));let y=l-g,x=g-p;const v=.5*Math.min(o,c-u),b=2*v,P=100;let S,E=0;for(S=0;S<P&&!(c-u<=b);++S){const s=u+.5*(c-u);let n=E>0;if(!n&&Math.abs(x)<=v&&(n=!0,E=3),!n){const t=l-g,e=l-p,s=t*(h-f);let i=e*(h-_),r=e*i-t*s;i=2*(i-s),i>0&&(r=-r),i=Math.abs(i),0===i||Math.abs(r)>=Math.abs(i*x/2)||r<=i*(u-l)||r>=i*(c-l)?(n=!0,E=3):(x=y,y=r/i)}n&&(x=l>=s?u-l:c-l,y=a*x,E--);let i=l+y;i<u+v?i=u+v:i>c-v&&(i=c-v);const r=t(i,e);r<h?(i>=l?(u=l,m=h):(c=l,d=h),p=g,g=l,l=i,f=_,_=h,h=r):(i<l?(u=i,m=r):(c=i,d=r),r<=_||g===l?(p=g,g=i,f=_,_=r):(r<=f||p===l||p===g)&&(p=i,f=r))}return l}(t,e,s,n,i,o)}function kt(t,e,s,i,o){const a={root:0,funcAtRoot:0,cRoots:0};let l=s.vmin,h=s.vmax,u=0,c=Number.MAX_VALUE,m=t.getValue(e,l),d=t.getValue(e,h),g=0,p=0,_=0;if(m>=0&&d>=0||m<=0&&d<=0)return Math.abs(m)<Math.abs(d)?(a.funcAtRoot=m,a.root=l,a.cRoots=0===m?1:0,a):(a.funcAtRoot=d,a.root=h,a.cRoots=0===d?1:0,a);Math.abs(m)<Math.abs(d)&&(h=(0,r.c)(l,l=h),d=(0,r.c)(m,m=d)),u=l,g=m;let f=!0,y=0;for(;0!==d&&Math.abs(l-h)>i*Math.abs(h)+o;y++){let s=y>64;if(!s){p=m!==g&&d!==g?l*d*g/((m-d)*(m-g))+h*m*g/((d-m)*(d-g))+u*m*d/((g-m)*(g-d)):h-d*(h-l)/(d-m);const t=(3*l+h)/4;if(s=!(p>t&&p<h||p>h&&p<t),!s){const t=i*Math.abs(h)+o;if(f){const e=Math.abs(h-u);s=Math.abs(p-h)>=.5*e||e<t}else{const e=Math.abs(u-c);s=Math.abs(p-h)>=.5*e||e<t}}}if(s?(p=(l+h)/2,f=!0):f=!1,_=t.getValue(e,p),0===_)return a.root=p,a.funcAtRoot=_,a.cRoots=1,a;if(!s){const s=l-p,n=p-h;if(Math.abs(s)>10*Math.abs(n)){let s=h+3*n;for(let n=0;n<2;n++){const n=t.getValue(e,s);(0,r.e)(m)*(0,r.e)(n)>0?(l=s,m=n):s=(0,r.q)(l,h,.75)}}else if(Math.abs(n)>10*Math.abs(s)){let n=l-3*s;for(let s=0;s<2;++s){const s=t.getValue(e,n);(0,r.e)(d)*(0,r.e)(s)>0?(h=n,d=s):n=(0,r.q)(l,h,.25)}}}c=u,u=h,g=d,(0,r.e)(m)*(0,r.e)(_)<0?(h=p,d=_):(l=p,m=_),Math.abs(m)<Math.abs(d)&&(h=(0,r.c)(l,l=h),d=(0,r.c)(m,m=d)),128===y&&(0,n.d)("Root_finder iterations exceeded")}return a.root=h,a.funcAtRoot=d,a.cRoots=1,a}function Lt(t,e,s,i,o){const a={root:0,funcAtRoot:0,cRoots:0};let l=s.vmin,h=t.getValue(e,l),u=s.vmax,c=t.getValue(e,u);if(h>=0&&c>=0||h<=0&&c<=0)return Math.abs(h)<Math.abs(c)?(a.funcAtRoot=h,a.root=l,a.cRoots=0===h?1:0,a):(a.funcAtRoot=c,a.root=u,a.cRoots=0===c?1:0,a);c<0&&(c=(0,r.c)(h,h=c),u=(0,r.c)(l,l=u));let m=.5*(l+u),d=Math.abs(u-l),g=d,p=t.getValue(e,m),_=t.getValue(e+1,m);let f=4;let y=1,x=0,v=0,b=1;let P=0;for(;++P<100;){let s;P>32||0===_||2===b&&x>1||1===b&&f<4?(b=1,y>1&&y--):(b=2,v>1&&Math.abs(2*p)>Math.abs(d*_)&&y++),d=g;let n=!1;if(1===b)do{if(v>2){const t=16*Math.abs(d);if(.5*Math.abs(l-u)>t){const e=Math.min(l,u),n=Math.max(l,u);if(m===e){s=m,m=e+t,g=m-s;break}if(m===n){s=m,m=n-t,g=m-s;break}}}g=.5*(u-l),s=m,m=l+g,n=l===m||u===m}while(0);else for(;;){g=y*p/_,s=m,m-=g,n=m===s;const t=Math.min(l,u),e=Math.max(l,u);if(m<t){if(y>1){m=s,y--;continue}g=s-t,m=t}else if(m>e){if(y>1){m=s,y--;continue}g=s-e,m=e}break}if(n||Math.abs(g)<o){s!==m&&(p=t.getValue(e,m));break}p=t.getValue(e,m),_=t.getValue(e+1,m);const i=l,r=u;p<0?(h=p,l=m):(c=p,u=m),2===b&&(l===i&&u===r||v>1&&Math.abs(g)>=.5001*Math.abs(d))?x++:x=0,1===b?(f++,v=0):(f=0,v++)}return 100===P&&(0,n.d)("Root_finder iterations exceeded"),a.root=m,a.funcAtRoot=p,a.cRoots=1,a}function Gt(t,e,s,n,i,o,a){const l=n.slice(0,a);let h=0;for(let r=0;r<a;r++)h+=n[r]*n[r];if(h=Math.sqrt(h),h>0)for(let r=0;r<a;r++)l[r]/=h;let u=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY;{const t=(0,r.d)(a,0);for(let e=0;e<a;e++)t[e]=e;t.sort(((t,e)=>{const s=Math.abs(l[t]),n=Math.abs(l[e]);return s<n?-1:s>n?1:0}));for(let e=0;e<a;e++){const n=t[e];if(0===l[n])continue;let a=(i[n]-s[n])/l[n],h=(o[n]-s[n])/l[n];h<a&&(h=(0,r.c)(a,a=h)),a>u&&(u=a),h<c&&(c=h)}}let m=0;const d=(Math.abs(u)+Math.abs(c))*(0,r.O)()*100,g=(0,r.d)(a,Number.NaN),p=l.slice();function _(n,i){for(let t=0,e=a;t<e;t++)g[t]=s[t]+n*p[t];return t(g,a,e)}d>0&&(m=Rt(_,null,u,0,c,d));const f=_(m);for(let y=0,x=a;y<x;y++)s[y]=(0,r.s)(g[y],i[y],o[y]);return f}function Vt(t,e,s,n){return t.isZero()?e.isZero()?-1:0:(n.setE(e.clone().negateThis().divThisE(t)),s.containsCoordinate(n.value())?1:0)}function zt(t,e,s,n,i,o){if(0===t.value())return i?(o[0].set(1),n.containsCoordinate(o[0].value())?1:0):Vt(e,s,n,o[0]);if(i){let e=2;return o[0].set(1),o[1].setE(s).divThisE(t),o[1].eq(o[0])&&(o[1].set(1),e=1),n.containsCoordinate(o[1].value())||(e=1),n.containsCoordinate(o[0].value())||(e--,o[0].setE(o[1])),2===e&&o[0].value()>o[1].value()&&(o[1]=(0,r.c)(o[0],o[0]=o[1])),e}const a=e.clone().sqrThis().subThisE(t.clone().mulThisE(s).mulThisE(r.a6));if(a.lt(r.J))return 0;const l=new r.H(e.value()>=0?1:-1),h=a.clone().sqrtThis(),u=new r.H(-.5).mulThisE(e.clone().addThisE(l.clone().mulThisE(h)));let c=0;o[0].setE(u.divE(t));const m=new r.H(o[0].value()),d=new r.H(t.value()).mulE(m).addE(new r.H(e.value()).mulE(m).addE(new r.H(s.value())));return d.isZero()||jt(o[0],t,e,s,o[0]),n.containsCoordinate(o[0].value())&&c++,0!==h.value()&&0!==u.value()?(o[c].assign(s.divE(u)),m.set(o[c].value()),d.assign(new r.H(t.value()).mulE(m).addE(new r.H(e.value()).mulE(m).addE(new r.H(s.value())))),d.isZero()||jt(o[c],t,e,s,o[c]),n.containsCoordinate(o[c].value())&&c++,2===c&&o[0].value()>o[1].value()&&(o[1]=(0,r.c)(o[0],o[0]=o[1])),c):c}function Ot(t,e,s,i,o,a,l){if(0===t.value())return zt(e,s,i,o,a,l);if(a){let s=1;l[0].set(1);const n=l.slice(s),a=zt(t,e.addE(t),i.negate(),o,!1,n);if(a>0){s+=a;for(let t=1;t<s;t++)l[t].eq(r.I)&&(l[s-1]=(0,r.c)(l[t],l[t]=l[s-1]),s--)}const h=l.slice(0,s);h.sort(((t,e)=>t.value()<e.value()?-1:t.value()>e.value()?1:0));for(let t=0;t<s;++t)l[t]=h[t];return s}return function(t,e,s,i,o,a){const l=(0,r.m)(r.H,3);let h=0;const u=e.negate().divThisE(t.clone().mulThis(3));o.containsCoordinate(u.value())&&(l[0].setE(u),h=1);const c=(0,r.m)(r.H,2),m=zt(t.mul(3),e.mul(2),s,o,!1,c);if(m<0)return i.isZero()?-1:0;for(let n=0;n<m;n++)o.containsCoordinate(c[n].value())&&l[h++].setE(c[n]);(0,r.C)(l,0,h,((t,e)=>t.value()<e.value()?-1:t.value()>e.value()?1:0));const d=(0,r.m)(r.H,5);d[0].set(o.vmin);for(let n=0;n<h;n++)d[1+n].setE(l[n]);d[1+h].set(o.vmax);const g=h+2;let p=1,_=0;{const n=d[0].clone();if(t.clone().mulThisE(n).addThisE(e).mulThisE(n).addThisE(s).mulThisE(n).addThisE(i).isZero()){const r=Bt(t,e,s,i);n.setError(r.estimateError(n.value())),a[_]=n,_++,p++}}for(let r=p;r<g;r++){const l=d[r].clone(),h=t.clone().mulThisE(l).addThisE(e).mulThisE(l).addThisE(s).mulThisE(l).addThisE(i).isZero();if(h||!d[r].eq(d[r-1])){if(h||Ht(d[r-1].value(),d[r].value(),d[r-1].clone().addThisE(d[r]).divThisByPower2(2),t,e,s,i,l)){if(_>0&&l.eq(a[_-1]))continue;if(_>=3&&(0,n.d)("cubic_polynomial_solver_too_many_roots"),h){const n=Bt(t,e,s,i);l.setError(n.estimateError(l.value()))}a[_]=l,_++}if(d[r].value()===o.vmax)break;h&&r++}}return _}(t,e,s,i,o,l)}function qt(t,e,s,i,o,a){return(a<e||e<0)&&(0,n.a)("nth_degree_real_roots"),function(t,e,s,n,i){const o=new Yt(t,e,s,(0,r.O)());let a=0;if(2===o.truePower)a=zt(t[2],t[1],t[0],s,n,i);else if(1===o.truePower)a=Vt(t[1],t[0],s,i[0]);else{if(0===o.truePower)return t[0].value()?0:-1;{const t=[];t.length=e,a=Mt(o,s,e,t);for(let e=0;e<a;e++)i[e].set(t[e])}}for(let r=0;r<a;r++)i[r].setError(o.getError(i[r].value()));return a}(t,e,s,i,o)}function Bt(t,e,s,n){return{coef0:t.clone(),coef1:e.clone(),coef2:s.clone(),coef3:n.clone(),calcF(t){return this.coef0.clone().mulThis(t).addThisE(this.coef1).mulThis(t).addThisE(this.coef2).mulThis(t).addThisE(this.coef3)},calcDF(t){return this.coef0.clone().mulThis(3).mulThis(t).addThisE(this.coef1.clone().mulThisByPower2(2)).mulThis(t).addThisE(this.coef2)},estimateError(t){const e=Math.abs(t),s=((this.coef0.eps()*e+this.coef1.eps())*e+this.coef2.eps())*e+this.coef3.eps()+this.calcF(t).eps(),n=this.coef0.clone().mulThis(t).mulThis(3).addThisE(this.coef1.clone().mulThis(2)).mulThis(t).addThisE(this.coef2);if(n.isZero()){const e=this.coef0.clone().mulThis(t).mulThis(6).addThisE(this.coef1.clone().mulThis(2));if(e.isZero()){const t=this.coef0.clone().mulThis(6);return Math.pow(6*s/Math.abs(t.value()),1/3)}return Math.sqrt(2*s/Math.abs(e.value()))}return s/Math.abs(n.value())}}}class Yt{updateCoefs(t){if(this.lastDeriv1===t)return this.curCoefs=this.derivCoefs1,void(this.lastUsed=1);if(this.lastDeriv2===t)return this.curCoefs=this.derivCoefs2,void(this.lastUsed=2);let e;1===this.lastUsed?(e=this.derivCoefs2,this.lastDeriv2=t,this.lastUsed=2):(e=this.derivCoefs1,this.lastDeriv1=t,this.lastUsed=1),e.length=0;for(let s=0,n=this.truePower-t;s<=n;++s){e.push(this.coefs[s+t].clone());let n=s+t,i=n--;for(let e=1;e<t;e++)i*=n--;e[s].mulThis(i)}this.curCoefs=e}constructor(t,e,s,n){this.derivCoefs1=[],this.derivCoefs2=[],this.lastDeriv1=-1,this.lastDeriv2=-1,this.lastUsed=-1,this.curCoefs=null,this.coefs=t,this.power=e,this.truePower=0;for(let i=e;i>=1;i--)if(0!==this.coefs[i].value()){this.truePower=i;break}}getMaxDerivative(){return this.truePower+1}getValue(t,e){let s=this.coefs;0===t?s=this.coefs:(this.updateCoefs(t),s=this.curCoefs);const n=new r.K(0);let i=1;for(let r=0,o=this.truePower-t;r<=o;++r)n.pe(i*s[r].value()),i*=e;return n.getResult()}getError(t){const e=Math.abs(t),s=new r.K(0),n=new r.H(1),i=new r.H(0);for(let r=0,a=this.power;r<=a;++r)i.addThisE(this.coefs[r].mulE(n)),s.pe(n.value()*this.coefs[r].eps()),n.mulThis(e);s.pe(i.eps());let o=1;for(let a=1;a<=this.truePower;++a){o*=a,this.updateCoefs(a);const e=new r.H(1),n=new r.H(0);for(let s=0,i=this.truePower-a;s<=i;++s)n.addThisE(this.curCoefs[s].mulE(e)),e.mulThis(t);if(!n.isZero())return Math.pow(o*s.getResult()/Math.abs(n.value()),1/a)}return 0}}function Ut(t,e,s,n,i,o){let a=t,l=e,h=l-a;if(!o){let s=n.calcF(t).value(),i=n.calcF(e).value();if((s>0||s>i)&&(l=(0,r.c)(a,a=l),i=(0,r.c)(s,s=i)),s>=0||i<=0)return!1}let u,c=!1,m=s,d=0;for(;d<100;d++){const t=n.calcF(m);if(u=n.calcDF(m),u.isZero())return!1;if(!t.value()||d>3&&t.isZero()){c=!0;break}o||(t.value()<0?a=m:l=m);const e=t.value()/u.value(),s=m-e;o||(s>=a&&s<=l||s>=l&&s<=a)&&Math.abs(e)<=.5*h?(m=s,h=Math.abs(e)):(h=Math.abs(.5*(l-a)),m=.5*(a+l))}return!!c&&(i.set(m,n.estimateError(m)),!0)}function Ht(t,e,s,n,i,r,o,a){return Ut(t,e,s.value(),Bt(n,i,r,o),a,!1)}class Xt{constructor(t,e,s){this.coefs=(0,r.m)(r.H,3),this.coefs[0].setE(t),this.coefs[1].setE(e),this.coefs[2].setE(s)}calcF(t){const e=new r.H(t);return this.coefs[0].mulE(e).addE(this.coefs[1]).mulE(e).addE(this.coefs[2])}calcDF(t){const e=new r.H(t);return r.H.st_mulByPower2(this.coefs[0],2).mulE(e).addE(this.coefs[1])}estimateError(t){const e=Math.abs(t),s=(this.coefs[0].eps()*e+this.coefs[1].eps())*e+this.coefs[2].eps()+this.calcF(t).eps(),n=new r.H(2).mulE(this.coefs[0]).mul(t).addE(this.coefs[1]);if(n.isZero()){const t=this.coefs[0].value();return Math.sqrt(s/Math.abs(t))}return s/Math.abs(n.value())}}function jt(t,e,s,n,i){return Ut(0,0,t.value(),new Xt(e,s,n),i,!0)}var Zt=i.V;class Wt extends ${constructor(t){return void 0===t||(0,r.W)(t,"vd")?(super({vd:t?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=new r.P(0,0),void(this.m_weights=[1,0,1])):(t.fromPoint&&t.weight?t={fromPoint:t.fromPoint,controlPoint1:t.controlPoint1,toPoint:t.toPoint,weight0:1,weight1:t.weight,weight2:1}:t.points&&t.weight?t={fromPoint:t.points[0],controlPoint1:t.points[1],toPoint:t.points[2],weight0:1,weight1:t.weight,weight2:1}:t.points&&t.weights&&(t={fromPoint:t.points[0],controlPoint1:t.points[1],toPoint:t.points[2],weight0:t.weights[0],weight1:t.weights[1],weight2:t.weights[2]}),t.fromPoint&&t.weight0?(super({start:t.fromPoint,end:t.toPoint}),(t.weight0<=0||t.weight1<0||t.weight2<=0)&&(0,n.a)("weights"),this.m_cp=t.controlPoint1.clone(),void(this.m_weights=[t.weight0,t.weight1,t.weight2])):t.copy?(super(t),this.m_cp=t.copy.m_cp.clone(),void(this.m_weights=t.copy.m_weights.slice())):t.move?(super(t),this.m_cp=t.move.m_cp.clone(),void(this.m_weights=t.move.m_weights.slice())):void(0,n.t)("unexpected constructor param"))}getBoundary(){return Tt(this)}assignMove(t){return this}assignCopy(t){return t.copyTo(this),this}construct(t,e,s,n){this.dropAllAttributes(),this.setCpsAndWeights(t,e,s,1,n,1),Rn(this)}constructWeights(t,e,s,n,i,r){this.dropAllAttributes(),this.setCpsAndWeights(t,e,s,n,i,r),Rn(this)}constructArray(t,e){this.construct(t[0],t[1],t[2],e)}constructArrayWeights(t,e){this.dropAllAttributes(),this.setCpsAndWeightsArray(t,e),Rn(this)}convertToStandardForm(){}getStandardFormWeight(){return this.m_weights[1]/Math.sqrt(this.m_weights[0]*this.m_weights[2])}getGeometryType(){return n.G.enumRationalBezier2}queryEnvelope(t){if(t instanceof o.Envelope2D){if(t.setCoords(this.getStartXY()),t.mergeNe(this.getEndXY()),t.contains(this.m_cp))return;const e=jn(this);if(null!==e){const s=new r.P;for(const n of e.specialPoints)this.queryCoord2D(n,s),t.mergeNe(s)}else{const e=[],s=(0,r.m)(r.P,3);this.queryControlPoints(s),Ln(s,this.m_weights,e);const n=new r.P;for(const i of e)this.queryCoord2D(i,n),t.mergeNe(n)}}}applyTransformation(t){if(t instanceof a.T){const e=(0,r.m)(r.P,3);return this.queryControlPoints(e),t.transformPoints2D(e,3,e),this.setStartXY(e[0]),this.m_cp.assign(e[1]),this.setEndXY(e[2]),void this.afterCompletedModification()}}createInstance(){return new Wt({vd:this.m_description})}calculateLength2D(){return Gn(this,1,!1)}calculateLowerLength2D(){return r.P.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return this.calculateUpperLength2D_()}calculateUpperLength2D_(){return this.m_weights[1]>0?r.P.distance(this.getStartXY(),this.m_cp)+r.P.distance(this.getEndXY(),this.m_cp):r.P.distance(this.getStartXY(),this.getEndXY())}queryCoord2D(t,e){return this.queryCoord2DExtension(t,e,!0)}queryCoord2DE(t,e){!function(t,e,s){const n=(0,r.m)(r.P,3);t.queryControlPoints(n);const i=[0,0,0];t.queryWeights(i),function(t,e,s,n){if(0===s.value())return void n.setE(t[0]);if(1===s.value())return void n.setE(t[2]);const i=[t[0].x.mulE(e[0]),t[1].x.mulE(e[1]),t[2].x.mulE(e[2])],o=[t[0].y.mulE(e[0]),t[1].y.mulE(e[1]),t[2].y.mulE(e[2])],a=[e[0].clone(),e[1].clone(),e[2].clone()],l=new r.H,h=new r.H,u=new r.H;if(s.value()<=.5){const t=(0,r.ad)(i[0],i[1],s),e=(0,r.ad)(i[1],i[2],s);l.setE((0,r.ad)(t,e,s));const n=(0,r.ad)(o[0],o[1],s),c=(0,r.ad)(o[1],o[2],s);h.setE((0,r.ad)(n,c,s));const m=(0,r.ad)(a[0],a[1],s),d=(0,r.ad)(a[1],a[2],s);u.setE((0,r.ad)(m,d,s))}else{const t=(0,r.ae)(i[0],i[1],s),e=(0,r.ae)(i[1],i[2],s);l.setE((0,r.ae)(t,e,s));const n=(0,r.ae)(o[0],o[1],s),c=(0,r.ae)(o[1],o[2],s);h.setE((0,r.ae)(n,c,s));const m=(0,r.ae)(a[0],a[1],s),d=(0,r.ae)(a[1],a[2],s);u.setE((0,r.ae)(m,d,s))}l.divThisE(u),h.divThisE(u);const c=new r.P(l.value(),h.value());Si([t[0].value(),t[1].value(),t[2].value()],c),n.x.set(c.x,l.eps()),n.y.set(c.y,h.eps())}([v.constructPoint2D(n[0]),v.constructPoint2D(n[1]),v.constructPoint2D(n[2])],[new r.H(i[0]),new r.H(i[1]),new r.H(i[2])],e,s)}(this,t,e)}queryCoord2DExtension(t,e,s){if(s){if(t<0)return void Q(new Br({start:this.getStartXY(),end:this.getStartXY().add(this.getTangent(0).getUnitVector())}),t,e);if(t>1)return void Q(new Br({start:this.getEndXY(),end:this.getEndXY().add(this.getTangent(1).getUnitVector())}),t-1,e)}const n=(0,r.m)(r.P,3);this.queryControlPoints(n),_i(n,this.m_weights,t,e)}getCoordX(t){const e=new r.P;return this.queryCoord2DExtension(t,e,!0),e.x}getCoordY(t){const e=new r.P;return this.queryCoord2DExtension(t,e,!0),e.y}cut(t,e,s){const n=new Yr;return this.queryCut(t,e,n,s),n.releaseSegment()}queryCut(t,e,s,n){const i=s.createQuadraticRationalBezier();if(this.cutBezierIgnoreAttributes(t,e,i),n)return;i.assignVertexDescription(this.m_description);const r=this.m_description.getAttributeCount();if(r>1){for(let e=1;e<r;e++){const s=this.m_description.getSemantics(e),n=Zt.getComponentCount(s);for(let e=0;e<n;e++){const n=this.getAttributeAsDbl(t,s,e);i.setStartAttribute(s,e,n)}}for(let t=1;t<r;t++){const s=this.m_description.getSemantics(t),n=Zt.getComponentCount(s);for(let t=0;t<n;t++){const n=this.getAttributeAsDbl(e,s,t);i.setEndAttribute(s,t,n)}}}}queryDerivative(t,e){!function(t,e,s){const i=(0,r.m)(r.P,3);t.queryControlPoints(i);const o=(0,r.d)(3,Number.NaN);t.queryWeights(o),function(t,e,s,i){s.value()<0&&s.set(0,s.eps()),s.value()>1&&s.set(1,s.eps());const o=(0,r.m)(v,4);(function(t,e,s,i,o){const a=[v.constructPoint2D(t[0]),v.constructPoint2D(t[1]),v.constructPoint2D(t[2])];a[2].subThisE(a[0]),a[1].subThisE(a[0]),a[0].setCoords(0,0),function(t,e,s,i,o){(0,n.g)(s>0);const a=[t[0].clone(),t[1].clone(),t[2].clone()];if(!a[0].isZero()){for(let t=1;t<3;++t)a[t].subThisE(a[0]);a[0]=v.constructCoords(0,0)}const l=qn(a,e,0,i),h=function(t,e,s){if(s.toDouble()<=.5){const e=(0,r.ad)(t[0],t[1],s),n=(0,r.ad)(t[1],t[2],s);return(0,r.ad)(e,n,s)}{const e=(0,r.ae)(t[0],t[1],s),n=(0,r.ae)(t[1],t[2],s);return(0,r.ae)(e,n,s)}}(e,0,i),u=l.divE(h);o[0].setE(u);const c=[e[1].mulE(e[0]),e[2].mulE(e[0]).mul(.5),e[1].mulE(e[2])],m=qn([t[1].subE(t[0]),t[2].subE(t[0]),t[2].subE(t[1])],c,0,i).mul(2),d=h.sqr(),g=m.divE(d);o[1].setE(g)}(a,[new r.H(e[0]),new r.H(e[1]),new r.H(e[2])],s,i,o)})(t,e,1,s,o),i.setE(o[1])}(i,o,e,s)}(this,t,e)}cutBezierIgnoreAttributes(t,e,s){(t<0||e>1||t>e)&&(0,n.a)("Quadratic_rational_bezier.cut_bezier_ignore_attributes");const i=(0,r.m)(r.P,3);this.queryControlPoints(i);const o=[0,0,0];ni(i,this.m_weights,t,e,i,o),s.setControlPointsAndWeights(i,o)}splitBezierIgnoreAttributes(t,e,s){}getAttributeAsDbl(t,e,s){if(0===e)return 0===s?this.getCoordX(t):this.getCoordY(t);const n=this.calculateLength2D(),i=n>0?this.tToLength(t)/n:0,o=Zt.getInterpolation(e),a=this.getStartAttributeAsDbl(e,s),l=this.getEndAttributeAsDbl(e,s);return(0,r.V)(o,a,l,i,Zt.getDefaultValue(e))}getClosestCoordinate(t,e){return Wn(this,t,r.E.unit(),e,-1)}getClosestCoordinateOnInterval(t,e,s=-1){return Wn(this,t,e,!1,s)}getYMonotonicParts(t,e){return this.getMonotonicParts(t,e)}getMonotonicParts(t,e){t.length<2&&(0,n.a)("");const s=kn(this);let i=0;if(2===s.specialPointsCount())return 0;(0,n.g)(t.length>=s.specialPointsCount()-1);for(let n=1,r=s.specialPointsCount();n<r;++n)this.queryCut(s.specialPoints[n-1],s.specialPoints[n],t[i],e),i++;for(let n=0;n<i;++n)ti(t[n].get());return i}intersectionWithAxis2D(t,e,s,n){s&&(s.length=9),n&&(n.length=9);const i=new Array(3),o=(0,r.m)(r.H,2),a=new r.E(0,1);let l=0;const h=(0,r.m)(r.P,3);if(this.queryControlPoints(h),t){if(i[0]=new r.H(h[0].y).sub(e).mul(this.m_weights[0]),i[1]=new r.H(h[1].y).sub(e).mul(this.m_weights[1]),i[2]=i[0].subE(i[1].mul(2)).addE(new r.H(h[2].y).sub(e).mul(this.m_weights[2])),i[1]=i[1].subE(i[0]).mulThisByPower2(2),l=zt(i[2],i[1],i[0],a,!1,o),s)for(let r=0;r<l;r++)s[r]=this.getCoordX(o[r].value())}else if(i[0]=new r.H(h[0].x).sub(e).mul(this.m_weights[0]),i[1]=new r.H(h[1].x).sub(e).mul(this.m_weights[1]),i[2]=i[0].subE(i[1].mul(2)).addE(new r.H(h[2].x).sub(e).mul(this.m_weights[2])),i[1]=i[1].subE(i[0]).mulThisByPower2(2),l=zt(i[2],i[1],i[0],a,!1,o),s)for(let r=0;r<l;r++)s[r]=this.getCoordY(o[r].value());if(n)for(let r=0;r<l;r++)n[r]=o[r].value();else s&&(0,r.C)(s,0,l,r.a8);return l}intersectionOfYMonotonicWithAxisX(t,e){if(this.m_YStart===this.m_YEnd)return t===this.m_YStart?e:Number.NaN;if(t===this.m_YStart)return this.m_XStart;if(t===this.m_YEnd)return this.m_XEnd;const s=[Number.NaN,Number.NaN],i=this.intersectionWithAxis2D(!0,t,s,null);return(0,n.g)(2!==i),-1===i?e:s[0]}isCurve(){return!0}isDegenerate(t){return w(this,t)}isDegenerate3D(t,e){return!1}queryLooseEnvelope(t){if(t instanceof o.Envelope2D)return t.setCoords({pt:this.getStartXY()}),t.mergeNe(this.m_cp),void t.mergeNe(this.getEndXY())}clone(t){const e=this.createInstance();return this.copyTo(e),e}queryInterval(t,e){if(0===t){const t=o.Envelope2D.constructEmpty();this.queryEnvelope(t);const s=r.E.constructEmpty();return 0===e?t.queryIntervalX(s):t.queryIntervalY(s),s}return super.queryInterval(t,e)}queryLooseEnvelopeOnInterval(t,e){const s=(0,r.m)(r.P,3);this.queryControlPoints(s);ni(s,this.m_weights,t.vmin,t.vmax,s,[0,0,0]),e.setFromPoints(s,3)}changeEndPoints2D(t,e){if(t.isEqual(this.m_XStart,this.m_YStart)&&e.isEqual(this.m_XEnd,this.m_YEnd))return;const s=this.m_cp.isEqual(this.m_XStart,this.m_YStart),n=this.m_cp.isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(t),this.setEndXY(e),s?this.m_cp.setCoordsPoint2D(t):n&&this.m_cp.setCoordsPoint2D(e),this.normalizeAfterEndpointChange()}tToLength(t){return Gn(this,t,!0)}lengthToT(t){return function(t,e){const s=Gn(t,1,!1);if(e<=0)return e;if(e>=s)return e-s+1;const i=[0];return 1!==Mt(new Un(t,e),r.E.unit(),1,i)&&(0,n.d)(""),i[0]}(this,t)}calculateWeightedAreaCentroid2D(t){const e=function(t){const e=(0,r.m)(r.P,3),s=[0,0,0];return t.queryControlPoints(e),t.queryWeights(s),function(t,e){const s=yi(e);if(1===s){const e=(0,r.m)(r.P,3);$e(t,e);const s=e[2].clone(),n=e[1].clone(),i=new r.P,o=s.y*n.x-s.x*n.y;return i.x=-(4*s.x+5*n.x)*o/60,i.y=-(4*s.y+5*n.y)*o/60,i}if(0===s)return new r.P(0,0);(0,n.g)(s>0);const i=t[1].sub(t[0]),o=t[2].sub(t[0]);if(s<1){const t=Math.sqrt(1-s),e=Math.sqrt(1+s),n=(i.y*o.x-i.x*o.y)*s/Math.pow(t*e,5)/12,r=Math.atan2(t,e),a=s*t*e,l=s*s,h=i.mul(2*(2+l)),u=o.mul(2*l-5),c=h.add(u).mul(a),m=o.sub(i.mul(2*l)).mul(6*r);return c.add(m).mul(n)}{const t=Math.sqrt(s-1),e=Math.sqrt(s+1),n=(i.y*o.x-i.x*o.y)*s/Math.pow(t*e,5)/12,r=Math.atanh(t/e),a=s*t*e,l=s*s,h=i.mul(4).sub(o.mul(5)),u=i.add(o).mul(2*l),c=h.add(u).mul(a),m=o.sub(i.mul(2*l)).mul(6*r);return c.add(m).mul(n)}}(e,s)}(this),s=Hn(this);return e.x+=(this.getStartX()-t.x)*s,e.y+=(this.getStartY()-t.y)*s,e}calculateWeightedCentroid2D(){const t=new r.P;return this.isDegenerate(0)?(t.setCoords(0,0),t):function(t){if(0===t.m_weights[1])return!0;const e=r.P.distance(t.getStartXY(),t.getEndXY()),s=t.calculateUpperLength2D();return s-e<=8*Number.EPSILON*s}(this)?(t.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),t):(t.assign(function(t,e,s){void 0===s&&(s=e,e=0);const i=new r.P;if(e<0||s>1)return i.setNAN(),i;if(e>s&&(0,n.a)("calculate_sub_weighted_centroid"),e===s||t.isDegenerate(0))return i.setCoords(0,0),i;const o=kn(t),a=Xn(t),l=a/t.calculateUpperLength2D();let h=e,u=0;for(let n=1,r=o.specialPointsCount();n<r;n++)if(e<o.specialPoints[n]){u=n-1;break}i.setCoords(0,0);for(let n=u+1,r=o.specialPointsCount();n<r;n++){const e=Math.min(o.specialPoints[n],s),r=Fn(t,h,e,l,a);if(i.addThis(r),h=e,s<=o.specialPoints[n])break}return i.add(t.getStartXY().mul(t.calculateLength2D()))}(this,1)),t)}getControlPoint1(){return this.m_cp.clone()}setControlPoint1(t){this.m_cp.setCoordsPoint2D(t),this.afterCompletedModification()}queryWeights(t){for(let e=0;e<3;++e)t[e]=this.m_weights[e]}queryCoord2DMP(t,e){const s=(0,r.m)(r.P,3);return this.queryControlPoints(s),function(t,e,s,n){const i=s.lte(r.a7)?r.M.lerpLo:r.M.lerpHi,[o,a,l]=[e.map(((e,s)=>t[s].x.mul(e))),e.map(((e,s)=>t[s].y.mul(e))),e].map((([t,e,n])=>i(i(t,e,s),i(e,n,s),s))),h=new r.P(o.divThis(l).value(),a.divThis(l).value());Si(t.map((t=>t.asPoint2D())),h),n.x=r.M.constructDouble(h.x),n.y=r.M.constructDouble(h.y)}(s.map((t=>P.constructPoint2D(t))),this.m_weights.map((t=>r.M.constructDouble(t))),r.M.constructDouble(t),e)}setWeights(t){}queryControlPoints(t){t[0].assign(this.getStartXY()),t[1].assign(this.m_cp),t[2].assign(this.getEndXY())}queryControlPointsHelper(t){return this.queryControlPoints(t),3}setControlPointsAndWeights(t,e){this.setCpsAndWeightsArray(t,e),this.afterCompletedModification()}getTangent(t){const e=(0,r.m)(r.P,3);return this.queryControlPoints(e),Yn(e,this.m_weights,t)}getDerivative(t){const e=(0,r.s)(t,0,1),s=(0,r.m)(r.P,4);return Vn(this,1,e,s),s[1]}getCurvature(t){const e=(0,r.m)(r.P,4);Vn(this,2,t,e);const s=e[1].sqrLength();return 0===s?Number.NaN:(e[1].divThis(Math.sqrt(s)),e[1].crossProduct(e[2])/s)}isIntersecting(t,e,s){return!1}isIntersectingPoint(t,e,s){return!1}isIntersectingPoint3D(t,e,s,n,i=1){return!1}isMonotoneQuickAndDirty(){const t=(0,r.m)(r.P,3);return this.queryControlPoints(t),Jn(t)}getMonotonicPartParams(t,e){const s=kn(this),i=s.specialPointsCount();if(!e)return s.specialPointsCount();t<i&&(0,n.a)("");for(let n=0;n<i;n++)e[n]=s.specialPoints[n];return i}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=(0,r.c)(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=(0,r.c)(this.m_YStart,this.m_YStart=this.m_YEnd),this.m_weights[2]=(0,r.c)(this.m_weights[0],this.m_weights[0]=this.m_weights[2]);for(let t=0,e=this.m_description.getTotalComponentCount()-2;t<e;t++)this.m_attributes[t+e]=(0,r.c)(this.m_attributes[t],this.m_attributes[t]=this.m_attributes[t+e]);this.m_cachedValues=null}}isLine(){return!1}isDegenerateToLineHelper(t){const e=(0,r.m)(r.P,3);this.queryControlPoints(e);const s=e[2].sub(e[0]),n=s.length();if(r.P.distance(e[0],e[1])+r.P.distance(e[2],e[1])-n>t)return!1;const i=t,o=e[1].clone();return o.subThis(e[0]),!(Math.abs(o.crossProduct(s))/n>i)}copyIgnoreAttributes(t){const e=(0,r.m)(r.P,3);this.queryControlPoints(e);const s=[0,0,0];this.queryWeights(s),t.setControlPointsAndWeights(e,s)}calculateArea2DHelper(){return Hn(this)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)+this.m_cp.norm(1)}absNormXYZ(t){return(0,n.g)(0),0}queryEnvelopeW(t,e){Kn(this,t,e)}setSegmentFromCoordsForStitcher(t,e){const s=[0,0,0];this.queryWeights(s),this.constructWeights(t[0],this.getControlPoint1(),t[e-1],s[0],s[1],s[2])}writeInBufferStream(t,e){const s=new Float64Array(5);return s[0]=this.m_cp.x,s[1]=this.m_cp.y,s[2]=this.m_weights[0],s[3]=this.m_weights[1],s[4]=this.m_weights[2],t.writeRangeFromArray(e,s.length,s,!0,1),e+s.length}readFromBufferStream(t,e){const s=new Float64Array(5);t.queryRange(e,s.length,s,!0,1),this.m_cp.x=s[0],this.m_cp.y=s[1],this.m_weights[0]=s[2],this.m_weights[1]=s[3],this.m_weights[2]=s[4],this.m_cachedValues=null}snapControlPoints(t){const e=(0,r.m)(r.P,3);this.queryControlPoints(e);const s=r.P.sqrDistance(e[1],e[0]),n=r.P.sqrDistance(e[1],e[2]);let i=e[0].clone(),o=s;s>n&&(i=e[2].clone(),o=n);let a=!1;return o<=t&&0!==o&&(a=!0,this.setControlPoint1(i)),a}needsSnapControlPoints(t){if(!t)return!1;const e=(0,r.m)(r.P,3);this.queryControlPoints(e);const s=r.P.sqrDistance(e[1],e[0]),n=r.P.sqrDistance(e[1],e[2]);e[0].clone();let i=s;return s>n&&(e[2].clone(),i=n),i<=t&&0!==i}calculateSpecialPointsForCracking(t,e){return 0}ensureXYMonotone(){return ti(this)}setCoordsForIntersector(t,e,s){!function(t,e,s,n){if(e.isEqual(t.m_XStart,t.m_YStart)&&s.isEqual(t.m_XEnd,t.m_YEnd))return;const i=!!n&&t.isMonotoneQuickAndDirty(),o=new a.T,l=(0,r.m)(r.P,3);l[0].setCoords(t.m_XStart,t.m_YStart),l[2].setCoords(t.m_XEnd,t.m_YEnd);const h=new r.P;h.setSub(l[2],l[0]),h.leftPerpendicularThis(),l[1].setAdd(l[0],h);const u=(0,r.m)(r.P,3);u[0].setCoordsPoint2D(e),u[2].setCoordsPoint2D(s),h.setSub(u[2],u[0]),h.leftPerpendicularThis(),u[1].setAdd(u[0],h),o.setFromTwoTriangles(l,u)?o.transformInPlace(t.m_cp):(0,r.U)(e,s,.5,t.m_cp),t.changeEndPoints2D(e,s),i&&ti(t)}(this,t,e,s)}copyToImpl(t){const e=t;e.m_cp.setCoordsPoint2D(this.m_cp),e.m_weights[0]=this.m_weights[0],e.m_weights[1]=this.m_weights[1],e.m_weights[2]=this.m_weights[2],Zn(e,jn(this))}reverseImpl(){this.m_weights[2]=(0,r.c)(this.m_weights[0],this.m_weights[0]=this.m_weights[2])}equalsImpl(t){const e=t;if(!this.m_cp.equals(e.m_cp))return!1;for(let s=0;s<3;s++)if(this.m_weights[s]!==e.m_weights[s])return!1;return!0}equalsImplTol(t,e){const s=t;if(!this.m_cp.isEqualPoint2D(s.m_cp,e))return!1;const n=(0,r.m)(r.P,3);this.queryControlPoints(n);const o=(0,r.m)(r.P,3);s.queryControlPoints(o);const a=[s.m_weights[0],s.m_weights[1],s.m_weights[2]];for(let r=0;r<3;r++){const t=new i.d;t.setCoordsPoint2DZ(n[r].mul(this.m_weights[r]),this.m_weights[r]);const s=new i.d;if(s.setCoordsPoint2DZ(o[r].mul(a[r]),a[r]),!t.isEqual(s,e))return!1}return!0}swapImpl(t){const e=t;e.m_cp=(0,r.c)(this.m_cp,this.m_cp=e.m_cp),e.m_weights=(0,r.c)(this.m_weights,this.m_weights=e.m_weights),function(t,e){e.m_cachedValues=(0,r.c)(t.m_cachedValues,t.m_cachedValues=e.m_cachedValues)}(this,e)}afterCompletedModification(){Rn(this)}intersect(t,e,s,n,i){return Lr(!1,this,t,e,s,n,i)}intersectPoint(t,e,s){return function(t,e,s,i){const o=new _;if(Kn(t,r.E.unit(),o),o.inflate(i),!o.isIntersectingPoint2D(e))return 0;const a=kn(t);let l=0;const h=[];let u=a.specialPoints[0];for(let r=1,c=a.specialPoints.length;r<c;++r){const s=a.specialPoints[r],i=Nn(t,e,u,s);if(0===h.length)h.push(i);else if(i.t===i.tmin)(0,n.g)(h.at(-1).d<=i.d),h.at(-1).tmax=i.tmax;else if(h.at(-1).t===h.at(-1).tmax){(0,n.g)(h.at(-1).d>=i.d);const t=h.at(-1).tmin;h[h.length-1]=i,h.at(-1).tmin=t}else h.push(i);u=s}for(const n of h)if(n.d<=i){const t=n.t;s?(s[l]=t,l++):l++}return l}(this,t,e,s)}endPointModified(){Rn(this)}clearEndPointModified(){}setCpsAndWeights(t,e,s,i,r,o){(i<=0||o<=0||r<0)&&(0,n.a)("weights"),(t.isNAN()||e.isNAN()||s.isNAN())&&(0,n.a)("NAN control points in bezier are not supported"),this.setStartXY(t),this.m_cp.assign(e),this.m_weights[0]=i,this.m_weights[1]=r,this.m_weights[2]=o,this.setEndXY(s)}setCpsAndWeightsArray(t,e){this.setCpsAndWeights(t[0],t[1],t[2],e[0],e[1],e[2])}}Wt.type=n.G.enumRationalBezier2;var $t=i.V;class Kt extends ${constructor(t){void 0===t||(0,r.W)(t,"vd")?(super({vd:t?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=new r.P(0,0)):t.from?(super({XStart:t.from.x,YStart:t.from.y,XEnd:t.to.x,YEnd:t.to.y,...t.vd}),this.m_cp=t.cp.clone()):t.points?(super({XStart:t.points[0].x,YStart:t.points[0].y,XEnd:t.points[2].x,YEnd:t.points[2].y,...t.vd}),this.m_cp=t.points[1].clone()):t.copy?(super(t),this.m_cp=t.copy.m_cp.clone()):(0,n.d)("unexpected constructor args")}getBoundary(){return Tt(this)}assignCopy(t){return this!==t&&t.copyTo(this),this}construct(t,e,s){this.setStartXY(t),this.m_cp.assign(e),this.setEndXY(s),Ee(this)}constructPoints(t){this.setStartXY(t[0]),this.m_cp.assign(t[1]),this.setEndXY(t[2]),Ee(this)}getGeometryType(){return n.G.enumBezier2}queryEnvelope(t){if(2!==t.m_EnvelopeType)(0,n.t)("env type not impl");else{if(t.setCoords(this.getStartXY()),t.mergeNe(this.getEndXY()),t.contains(this.m_cp))return;const e=ke(this);if(null!==e){const s=new r.P;for(const n of e.specialPoints)this.queryCoord2D(n,s),t.mergeNe(s)}else{const e=[];we(this,e);const s=new r.P;for(const n of e)this.queryCoord2D(n,s),t.mergeNe(s)}}}applyTransformation(t){if(1===t.m_TransformationType){const e=(0,r.m)(r.P,3);return this.queryControlPoints(e),t.transformPoints2D(e,3,e),this.setStartXY(e[0]),this.m_cp.assign(e[1]),this.setEndXY(e[2]),void this.afterCompletedModification()}(0,n.g)(0)}createInstance(){return new Kt({vd:this.m_description})}calculateLength2D(){return Ie(this,1,!1)}calculateLowerLength2D(){return r.P.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return this.calculateUpperLength2D_()}calculateUpperLength2D_(){return r.P.distance(this.getStartXY(),this.m_cp)+r.P.distance(this.getEndXY(),this.m_cp)}queryCoord2D(t,e){this.queryCoord2DExtended(t,e,!1)}queryCoord2DExtended(t,e,s){const n=(0,r.m)(r.P,3);this.queryControlPoints(n),Qe(n,t,e,s)}queryCoord2DE(t,e){!function(t,e,s){const n=(0,r.m)(r.P,3);t.queryControlPoints(n),function(t,e,s){if(e.value()<=.5){const n=v.constructPoint2D(t[1]),i=new v;(0,r.a4)(2,v.constructPoint2D(t[0]),n,e,i);const o=new v;(0,r.a4)(2,n,v.constructPoint2D(t[2]),e,o);const a=new v;(0,r.a4)(2,i,o,e,a),s.setE(a)}else{const n=v.constructPoint2D(t[1]),i=new v;(0,r.a5)(2,v.constructPoint2D(t[0]),n,e,i);const o=new v;(0,r.a5)(2,n,v.constructPoint2D(t[2]),e,o);const a=new v;(0,r.a5)(2,i,o,e,a),s.setE(a)}}(n,e,s)}(this,t,e)}queryCoord2DMP(t,e){(0,n.g)(!1,"bernstein polynomials not ported")}getCoordX(t){if(t<0||t>1){const e=new r.P;return this.queryCoord2DExtended(t,e,!0),e.x}if(t<=.5){const e=(0,r.X)(this.getStartX(),this.m_cp.x,t),s=(0,r.X)(this.m_cp.x,this.getEndX(),t);return(0,r.X)(e,s,t)}{const e=(0,r.Y)(this.getStartX(),this.m_cp.x,t),s=(0,r.Y)(this.m_cp.x,this.getEndX(),t);return(0,r.Y)(e,s,t)}}getCoordY(t){if(t<0||t>1){const e=new r.P;return this.queryCoord2DExtended(t,e,!0),e.y}if(t<=.5){const e=(0,r.X)(this.getStartX(),this.m_cp.x,t),s=(0,r.X)(this.m_cp.x,this.getEndX(),t);return(0,r.X)(e,s,t)}{const e=(0,r.Y)(this.getStartY(),this.m_cp.y,t),s=(0,r.Y)(this.m_cp.y,this.getEndY(),t);return(0,r.Y)(e,s,t)}}cut(t,e,s){const n=new Yr;return this.queryCut(t,e,n,s),n.releaseSegment()}queryCut(t,e,s,n){const i=s.createQuadraticBezier();if(this.cutBezierIgnoreAttributes(t,e,i),n)return;i.assignVertexDescription(this.m_description);const r=this.m_description.getAttributeCount();if(r>1){for(let e=1;e<r;e++){const s=this.m_description.getSemantics(e),n=$t.getComponentCount(s);for(let e=0;e<n;e++){const n=this.getAttributeAsDbl(t,s,e);i.setStartAttribute(s,e,n)}}for(let t=1;t<r;t++){const s=this.m_description.getSemantics(t),n=$t.getComponentCount(s);for(let t=0;t<n;t++){const n=this.getAttributeAsDbl(e,s,t);i.setEndAttribute(s,t,n)}}}}queryDerivative(t,e){!function(t,e,s){const n=(0,r.m)(r.P,4);t.queryControlPoints(n),function(t,e,s){e.value()<0&&e.set(0,e.eps()),e.value()>1&&e.set(1,e.eps()),s.setE(function(t,e,s){{const e=v.constructPoint2D(t[1]).subE(v.constructPoint2D(t[0])),n=new r.H(1).subE(s),i=v.constructPoint2D(t[2]).subE(v.constructPoint2D(t[1])),o=e.mulE(n).addE(i.mulE(s));return o.mulThisE(new r.H(2)),o}}(t,0,e))}(n,e,s)}(this,t,e)}cutBezierIgnoreAttributes(t,e,s){if((t<0||e>1||t>e)&&(0,n.a)("Quadratic_bezier.cut_bezier_ignore_attributes"),0===t&&1===e)return s.setStartXY(this.getStartXY()),s.m_cp.assign(this.m_cp),void s.setEndXY(this.getEndXY());const i=(0,r.m)(r.P,3);this.queryControlPoints(i),Ue(i,t,e,i),s.constructPoints(i)}splitBezierIgnoreAttributes(t,e,s){(0,n.g)(0)}getAttributeAsDbl(t,e,s){if(0===e)return 0===s?this.getCoordX(t):this.getCoordY(t);const n=this.calculateLength2D(),i=n>0?this.tToLength(t)/n:0,o=$t.getInterpolation(e),a=this.getStartAttributeAsDbl(e,s),l=this.getEndAttributeAsDbl(e,s);return(0,r.V)(o,a,l,i,$t.getDefaultValue(e))}getClosestCoordinate(t,e){return Ge(this,t,r.E.unit(),e)}getClosestCoordinateOnInterval(t,e,s=-1){return Ge(this,t,e,!1)}getYMonotonicParts(t,e){return this.getMonotonicParts(t,e)}getMonotonicParts(t,e){t.length<2&&(0,n.a)("");const s=Ce(this);let i=0;if(2===s.specialPointsCount())return 0;(0,n.g)(t.length>=s.specialPointsCount()-1);for(let n=1,r=s.specialPointsCount();n<r;++n)this.queryCut(s.specialPoints[n-1],s.specialPoints[n],t[i],e),i++;for(let n=0;n<i;++n)qe(t[n].get());return i}intersectionWithAxis2D(t,e,s,n){const i=(0,r.m)(r.H,3),o=(0,r.m)(r.H,2),a=new r.E(0,1);let l=0;if(t){if(i[0]=new r.H(this.getStartY()).sub(e),i[1]=new r.H(this.m_cp.y).subE(new r.H(this.getStartY())).mulThisByPower2(2),i[2]=new r.H(this.getStartY()).add(this.getEndY()).subE(new r.H(this.m_cp.y).mulThisByPower2(2)),l=zt(i[2],i[1],i[0],a,!1,o),s)for(let r=0;r<l;r++)s[r]=this.getCoordX(o[r].value())}else if(i[0]=new r.H(this.getStartX()).sub(e),i[1]=new r.H(this.m_cp.x).subE(new r.H(this.getStartX())).mulThisByPower2(2),i[2]=new r.H(this.getStartX()).add(this.getEndX()).subE(new r.H(this.m_cp.x).mulThisByPower2(2)),l=zt(i[2],i[1],i[0],a,!1,o),s)for(let r=0;r<l;r++)s[r]=this.getCoordY(o[r].value());if(n)for(let r=0;r<l;r++)n[r]=o[r].value();else s&&(0,r.Z)(s,l);return l}intersectionOfYMonotonicWithAxisX(t,e){if(this.m_YStart===this.m_YEnd)return t===this.m_YStart?e:Number.NaN;if(t===this.m_YStart)return this.m_XStart;if(t===this.m_YEnd)return this.m_XEnd;const s=[0,0],i=this.intersectionWithAxis2D(!0,t,s,null);return(0,n.g)(2!==i),-1===i?e:s[0]}isCurve(){return!0}isLine(){return!1}isDegenerate(t){return w(this,t)}isDegenerate3D(t,e){return(0,n.g)(0),!1}queryLooseEnvelope(t){if(2===t.m_EnvelopeType)return t.setCoords(this.getStartXY()),t.mergeNe(this.m_cp),void t.mergeNe(this.getEndXY());(0,n.g)(0)}clone(t){const e=this.createInstance();return this.copyTo(e),e}queryInterval(t,e){if(0===t){const t=new o.Envelope2D;this.queryEnvelope(t);const s=new r.E;return 0===e?t.queryIntervalX(s):t.queryIntervalY(s),s}return super.queryInterval(t,e)}queryLooseEnvelopeOnInterval(t,e){const s=(0,r.m)(r.P,4);this.queryControlPoints(s),Ue(s,t.vmin,t.vmax,s),e.setFromPoints(s,4)}changeEndPoints2D(t,e){if(t.isEqual(this.m_XStart,this.m_YStart)&&e.isEqual(this.m_XEnd,this.m_YEnd))return;const s=this.m_cp.isEqual(this.m_XStart,this.m_YStart),n=this.m_cp.isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(t),this.setEndXY(e),s?this.m_cp.setCoordsPoint2D(t):n&&this.m_cp.setCoordsPoint2D(e),this.normalizeAfterEndpointChange()}tToLength(t){return Ie(this,t,!0)}lengthToT(t){return function(t,e){const s=Ie(t,1,!1);if(e<=0)return e;if(e>=s)return e-s+1;const i=[0];return 1!==Mt(new Pe(t,e),r.E.unit(),1,i)&&(0,n.d)(""),i[0]}(this,t)}calculateWeightedAreaCentroid2D(t){const e=(0,r.m)(r.P,3);!function(t,e,s=!1){const n=(0,r.m)(r.P,3);t.queryControlPoints(n),$e(n,e,s)}(this,e);const s=e[2],n=e[1],i=new r.P,o=s.y*n.x-s.x*n.y;i.x=-(4*s.x+5*n.x)*o/60,i.y=-(4*s.y+5*n.y)*o/60;const a=Fe(this);return i.x+=(e[0].x-t.x)*a,i.y+=(e[0].y-t.y)*a,i}calculateWeightedCentroid2D(){const t=new r.P;return this.isDegenerate(0)?(t.setCoords(0,0),t):function(t){const e=r.P.distance(t.getStartXY(),t.getEndXY()),s=t.calculateUpperLength2D();return s-e<=8*Number.EPSILON*s}(this)?(t.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),t):(t.assign(function(t,e,s){void 0===s&&(s=e,e=0);const i=new r.P;if(e<0||s>1)return i.setNAN(),i;if(e>s&&(0,n.a)("calculate_sub_weighted_centroid"),e===s||t.isDegenerate(0))return i.setCoords(0,0),i;const o=Ce(t),a=q(t),l=Math.min(a/t.calculateUpperLength2D(),1e-7);let h=e,u=0;for(let n=1,r=o.specialPointsCount();n<r;n++)if(e<o.specialPoints[n]){u=n-1;break}i.setCoords(0,0);for(let n=u+1,r=o.specialPointsCount();n<r;n++){const e=Math.min(o.specialPoints[n],s),r=Se(t,h,e,l,a);if(i.addThis(r),h=e,s<=o.specialPoints[n])break}return i.add(t.getStartXY().mul(t.calculateLength2D()))}(this,1)),t)}getControlPoint1(){return this.m_cp.clone()}setControlPoint1(t){this.m_cp.setCoordsPoint2D(t),this.afterCompletedModification()}queryControlPoints(t){t[0].assign(this.getStartXY()),t[1].assign(this.m_cp),t[2].assign(this.getEndXY())}queryControlPointsHelper(t){return this.queryControlPoints(t),3}setControlPoints(t){for(let e=0;e<3;e++)t[e].isNAN()&&(0,n.a)("NaN control points in bezier are not supported");this.m_XStart=t[0].x,this.m_YStart=t[0].y,this.m_cp.setCoordsPoint2D(t[1]),this.m_XEnd=t[2].x,this.m_YEnd=t[2].y,this.afterCompletedModification()}getTangent(t){const e=(0,r.s)(t,0,1);let s=De(this,1,e);return s.isZero()&&(s=De(this,2,e),1===e&&s.negateThis()),s}getDerivative(t){return De(this,1,(0,r.s)(t,0,1))}getCurvature(t){const e=De(this,1,t),s=De(this,2,t),n=e.sqrLength();return 0===n?Number.NaN:(e.divThis(Math.sqrt(n)),e.crossProduct(s)/n)}isIntersecting(t,e,s){return 0!==Nr(!1,this,t,e,s)}isIntersectingPoint(t,e,s){if(s&&(t.isEqualPoint2D(this.getStartXY())||t.isEqualPoint2D(this.getEndXY())))return!1;const n=new o.Envelope2D;if(this.queryLooseEnvelope(n),n.inflateCoords(e,e),!n.contains(t))return!1;const i=this.getClosestCoordinate(t,!1),a=new r.P;return this.queryCoord2D(i,a),r.P.distance(a,t)<=e}isIntersectingPoint3D(t,e,s,i,r=1){return(0,n.g)(0),!1}isMonotoneQuickAndDirty(){return!1}getMonotonicPartParams(t,e){const s=Ce(this),i=s.specialPointsCount();if(!e)return s.specialPointsCount();t<i&&(0,n.a)("");for(let n=0;n<i;n++)e[n]=s.specialPoints[n];return i}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){(0,r.c)(this.m_XStart,this.m_XStart=this.m_XEnd),(0,r.c)(this.m_YStart,this.m_YStart=this.m_YEnd);for(let t=0,e=this.m_description.getTotalComponentCount()-2;t<e;t++)this.m_attributes[t+e]=(0,r.c)(this.m_attributes[t],this.m_attributes[t]=this.m_attributes[t+e]);this.m_cachedValues=null}}isDegenerateToLineHelper(t){const e=(0,r.m)(r.P,3);this.queryControlPoints(e);const s=e[2].sub(e[0]),n=s.length();if(r.P.distance(e[0],e[1])+r.P.distance(e[2],e[1])-n>t)return!1;const i=t,o=e[1].clone();return o.subThis(e[0]),!(Math.abs(o.crossProduct(s))/n>i)}copyIgnoreAttributes(t){const e=(0,r.m)(r.P,3);this.queryControlPoints(e),t.setControlPoints(e)}calculateArea2DHelper(){return Fe(this)}absNorm(){return function(t){return t.getStartXY().norm(1)+t.getEndXY().norm(1)+t.m_cp.norm(1)}(this)}queryEnvelopeW(t,e){const s=(0,r.m)(r.P,3);this.queryControlPoints(s),ze(s,t,e)}setSegmentFromCoordsForStitcher(t,e){this.construct(t[0],this.getControlPoint1(),t[e-1])}snapControlPoints(t){return function(t,e){const s=(0,r.m)(r.P,3);t.queryControlPoints(s);const n=r.P.sqrDistance(s[1],s[0]),i=r.P.sqrDistance(s[1],s[2]);let o=s[0].clone(),a=n;n>i&&(o=s[2].clone(),a=i);let l=!1;return a<=e&&0!==a&&(l=!0,t.setControlPoint1(o)),l}(this,t)}writeInBufferStream(t,e){const s=new Float64Array(2);return s[0]=this.m_cp.x,s[1]=this.m_cp.y,t.writeRangeFromArray(e,s.length,s,!0,1),e+s.length}readFromBufferStream(t,e){const s=new Float64Array(2);t.queryRange(e,s.length,s,!0,1),this.m_cp.x=s[0],this.m_cp.y=s[1],this.m_cachedValues=null}needsSnapControlPoints(t){return function(t,e){if(!e)return!1;const s=(0,r.m)(r.P,3);t.queryControlPoints(s);const n=r.P.sqrDistance(s[1],s[0]),i=r.P.sqrDistance(s[1],s[2]);s[0].clone();let o=n;return n>i&&(s[2].clone(),o=i),o<=e&&0!==o}(this,t)}calculateSpecialPointsForCracking(t,e){return 0}ensureXYMonotone(){return qe(this)}setCoordsForIntersector(t,e,s){!function(t,e,s,n){if(e.isEqual(t.m_XStart,t.m_YStart)&&s.isEqual(t.m_XEnd,t.m_YEnd))return;const i=!!n&&t.isMonotoneQuickAndDirty(),o=new a.T,l=(0,r.m)(r.P,3);l[0].setCoords(t.m_XStart,t.m_YStart),l[2].setCoords(t.m_XEnd,t.m_YEnd);const h=new r.P;h.setSub(l[2],l[0]),h.leftPerpendicularThis(),l[1].setAdd(l[0],h);const u=(0,r.m)(r.P,3);u[0].setCoordsPoint2D(e),u[2].setCoordsPoint2D(s),h.setSub(u[2],u[0]),h.leftPerpendicularThis(),u[1].setAdd(u[0],h),o.setFromTwoTriangles(l,u)?o.transformInPlace(t.m_cp):(0,r.U)(e,s,.5,t.m_cp),t.changeEndPoints2D(e,s),i&&qe(t)}(this,t,e,s)}copyToImpl(t){const e=t;e.m_cp.setCoordsPoint2D(this.m_cp),Le(e,ke(this))}reverseImpl(){}equalsImplTol(t,e){const s=t;return!!this.m_cp.isEqualPoint2D(s.m_cp,e)}equalsImpl(t){const e=t;return!!this.m_cp.equals(e.m_cp)}swapImpl(t){const e=t;e.m_cp=(0,r.c)(this.m_cp,this.m_cp=e.m_cp),function(t,e){e.m_cachedValues=(0,r.c)(t.m_cachedValues,t.m_cachedValues=e.m_cachedValues)}(this,e)}afterCompletedModification(){Ee(this)}intersect(t,e,s,n,i){return Lr(!1,this,t,e,s,n,i)}intersectPoint(t,e,s){return function(t,e,s,n,i){const o=new _;if(function(t,e,s){const n=(0,r.m)(r.P,3);t.queryControlPoints(n),ze(n,e,s)}(t,r.E.unit(),o),o.inflate(i),!o.isIntersectingPoint2D(e))return 0;const a=new r.P,l=Ge(t,e,r.E.unit(),!1);return t.queryCoord2D(l,a),r.P.distance(a,e)<=i?(n&&(n[0]=l),1):0}(this,t,e.length,e,s)}endPointModified(){Ee(this)}clearEndPointModified(){}}Kt.type=n.G.enumBezier2;class Qt{constructor(t){return t.coefsT?(this.m_zeroCtor=t.zeroCtor,this.m_elements=t.coefsT.map((t=>t.clone())),(0,n.g)(this.m_elements.length===t.power+1),void this.updatePower()):t.coef0?(this.m_zeroCtor=t.zeroCtor,void(this.m_elements=[t.coef0.clone()])):t.copy?(this.m_zeroCtor=t.copy.m_zeroCtor,void(this.m_elements=t.copy.m_elements.map((t=>t.clone())))):(this.m_zeroCtor=t.zeroCtor,void(this.m_elements=[new this.m_zeroCtor]))}construct(t,e){return this.m_elements=t.map((t=>t.clone())),this.updatePower(),this}construct0(t){return this.m_elements.length=0,this.m_elements.push(t.clone()),this.updatePower(),this}assignCopy(t){return this.m_elements=t.m_elements.map((t=>t.clone())),this.updatePower(),this}assignMove(t){return this.m_elements=t.m_elements,t.m_elements=[],this.updatePower(),this}power(){return this.m_elements.length-1}addElement(t){this.m_elements.push(t.clone())}scaleRangeToUnitInterval(t,e){const s=e;s.subThis(t);const n=this.power();for(let i=0;i<=n;i++){const e=new this.m_zeroCtor;for(let s=i;s<=n;s++){const n=this.m_elements[s];n.mulDoubleThis((0,r.ao)(s,i));const o=t.pow(s-i);n.mulThis(o),e.addThis(n)}const o=s.pow(i);e.mulThis(o),this.m_elements[i]=e}}fmSubThis(t,e){return(0,n.g)(0),this}addThis(t){const e=Math.min(this.power(),t.power());for(let n=0;n<=e;++n)this.m_elements[n].addThis(t.m_elements[n]);const s=t.power();this.m_elements.length=Math.max(this.power(),t.power())+1;for(let n=e+1;n<=s;++n)this.m_elements[n]=t.m_elements[n];return this.updatePower(),this}add0(t){return this.m_elements[0].addThis(t),this.updatePower(),this}addNumber0(t){return(0,n.g)(0),this}sub(t){const e=Math.min(this.power(),t.power());for(let n=0;n<=e;++n)this.m_elements[n].subThis(t.m_elements[n]);const s=t.power();this.m_elements.length=Math.max(this.power(),t.power())+1;for(let n=e+1;n<=s;++n)this.m_elements[n]=t.m_elements[n].clone(),this.m_elements[n].negateThis();return this.updatePower(),this}sub0(t){return(0,n.g)(0),this}subNumber0(t){return(0,n.g)(0),this}subShifted(t,e){const s=this.power(),n=t.power()+e,i=Math.min(this.power(),n);let r=0;for(let o=e;o<=i;++o)this.m_elements[o].subThis(t.m_elements[r]),r++;if(n<=s)return this.updatePower(),this;this.m_elements.length=n+1;for(let o=s+1;o<this.m_elements.length;++o)this.m_elements[o]=new this.m_zeroCtor;for(let o=i+1;o<=n;++o)this.m_elements[o].subThis(t.m_elements[r++]);return this.updatePower(),this}subShiftedWithCoef(t,e,s){const n=this.power(),i=t.power()+s,r=Math.min(this.power(),i);let o=0;for(let a=s;a<=r;++a)this.m_elements[a].fmSubThis(t.m_elements[o],e),o++;if(i<=n)return this.updatePower(),this;this.m_elements.length=i+1;for(let a=n+1;a<this.m_elements.length;++a)this.m_elements[a]=new this.m_zeroCtor;for(let a=r+1;a<=i;++a)this.m_elements[a].fmSubThis(t.m_elements[o++],e);return this.updatePower(),this}mulThis(t){if(this.constructor===t.constructor){const e=t,s=[];for(let t=0,n=this.power();t<=n;t++)for(let i=0,r=e.power();i<=r;i++){const n=this.m_elements[t].clone();n.mulThis(e.m_elements[i]),t+i<s.length?s[t+i].addThis(n):s.push(n)}this.m_elements=s}else for(let e=0,s=this.power();e<=s;e++)this.m_elements[e].mulThis(t);return this.updatePower(),this}mulElementThis(t){for(let e=0,s=this.power();e<=s;e++)this.m_elements[e].mulThis(t);return this.updatePower(),this}mulDoubleThis(t){for(let e=0,s=this.power();e<=s;e++)this.m_elements[e].mulDoubleThis(t);return this.updatePower(),this}mulNumber0(t){return(0,n.g)(0),this}mulBigint0(t){return(0,n.g)(0),this}mulBigIntThis(t){return(0,n.g)(0),this}mulInt320(t){return(0,n.g)(0),this}div0(t){return(0,n.g)(0),this}absThis(){return(0,n.g)(0),this}div(t,e,s){if(this.power()<t.power())return s.assignCopy(this),void e.setZero();s.setZero(),e.setZero();const n=t.getElement(t.power()),i=this.clone();let o=i.power();const a=i.power()-t.power();let l=a;for(e.m_elements=(0,r.m)(e.m_zeroCtor,a+1);;){if(o<t.power()){s.assignMove(i);break}if(o===i.power()){const s=i.getElement(i.power());s.divThis(n),i.subShiftedWithCoef(t,s,i.power()-t.power()),e.m_elements[l]=s.clone()}l--,o--}s.updatePower(),e.updatePower()}divThis(t){return(0,n.g)(0),this}subThis(t){const e=Math.min(this.power(),t.power());for(let n=0;n<=e;++n)this.m_elements[n].subThis(t.m_elements[n]);const s=t.power();this.m_elements.length=Math.max(this.power(),t.power())+1;for(let n=e+1;n<=s;++n)this.m_elements[n]=t.m_elements[n].clone(),this.m_elements[n].negateThis();return this.updatePower(),this}sub0This(t){return this.m_elements[0].subThis(t),this.updatePower(),this}subFrom(t,e){(0,n.g)(0)}isZero(){return 0===this.power()&&this.m_elements[0].isZero()}negateThis(){for(let t=this.m_elements.length-1;t>=0;t--)this.m_elements[t].negateThis();return this}getElement(t){return this.m_elements[t].clone()}setElement(t,e){return this.m_elements[t]=e.clone(),this}evaluate(t){const e=this.power(),s=this.m_elements[e].clone();for(let n=e-1;n>=0;--n)s.mulThis(t),s.addThis(this.m_elements[n]);return s}equals(t){if(this===t)return!0;if(this.power()!==t.power())return!1;for(let e=this.m_elements.length-1;e>=0;e--)if(!this.m_elements[e].equals(t.m_elements[e]))return!1;return!0}updatePower(){for(let t=this.m_elements.length-1;t>0&&this.m_elements[t].isZero();t--)this.m_elements.pop();return this}setZero(){return this.m_elements.length=1,this.m_elements[0]=new this.m_zeroCtor,this.updatePower(),this}derivative(t){if(this.power()<t)return this.clone().setZero();if(0===t)return this.clone();const e=new this.constructor({coefsT:this.m_elements.slice(t),power:this.power()-t});for(let s=t,n=this.power();s<=n;s++){let n=BigInt(s);for(let e=s-1,i=s-t;e>i;--e)n*=BigInt(e);e.m_elements[s-t].mulBigIntThis(n)}return e.updatePower(),e}derivative1This(){if(this.m_elements.length>1){this.m_elements=this.m_elements.slice(1);for(let t=1,e=this.power();t<=e;t++)this.m_elements[t].mulThis(r.M.constructInt32(t+1))}else this.m_elements.length=0,this.m_elements.push(new this.m_zeroCtor);return this}limitPrecisionThis(t){for(let e=this.power();e>=0;--e)this.m_elements[e].limitPrecisionThis(t);return this.updatePower(),this}hiBitIndex(){return this.m_elements.reduce(((t,e)=>{const s=e.hiBitIndex();return t<s?s:t}),0)}shiftRight(t){return this.m_elements.splice(0,t),this.updatePower(),this}evaluateDerivative(t){const e=this.power(),s=this.m_elements[e];s.mulDoubleThis(e);for(let n=e-1;n>=1;--n){s.mulThis(t);const e=this.m_elements[n];e.mulDoubleThis(n),s.addThis(e)}return s}static evaluateCoefs(t,e,s){const n=t.power();s.construct0(t.getElement(0).evaluate(e));for(let i=1;i<=n;++i)s.addElement(t.getElement(i).evaluate(e));s.updatePower()}}class Jt extends Qt{constructor(t){super(void 0===t?{zeroCtor:r.M}:{...t,zeroCtor:r.M})}clone(){return new Jt({copy:this})}absEvaluate(t){const e=this.power(),s=this.m_elements[e].clone();s.absThis();const n=t.clone();n.absThis();for(let i=e-1;i>=0;--i)s.mulThis(n),s.addThis(this.m_elements[i].abs());return s}}class te extends Qt{constructor(t){super(void 0===t?{zeroCtor:Jt}:{...t,zeroCtor:Jt})}clone(){return new te({copy:this})}constructFromMPValues(t,e){this.m_elements.length=0;for(let s=0;s<=e;++s)this.m_elements.push(new Jt({coef0:t[s]}));return this.updatePower(),this}}function ee(t,e,s,i,o,a,l,h,u,c,m,d,g,p,_,f,y,x,v,b=!1){const P={polypoly1:new te,polypoly2:new te,polyX2:new Jt,polyY2:new Jt,polyX2Deriv:new Jt,polyY2Deriv:new Jt,polypolyX1:new te,polypolyY1:new te,polypolyX1Deriv:new te,polypolyY1Deriv:new te,lazyPolypolyD1:new te,lazyPolypolyD1Deriv:new te,lazyPolyD2:new Jt,lazyPolyD2Deriv:null,polypoly11:new te,polypoly12:new te,tempPp:new te,tempPp1:new te,tempPp2:new te,tempP:new Jt,tempP1:new Jt,tempP2:new Jt};P.polyX2.construct(l,h),P.polyY2.construct(u,c),P.polypolyX1.constructFromMPValues(t,e),P.polypolyY1.constructFromMPValues(s,i),P.polypoly11.assignCopy(P.polypolyX1),P.polypoly12.assignCopy(P.polypolyY1),m&&(P.lazyPolyD2.construct(m,d),P.polypoly11.mulElementThis(P.lazyPolyD2),P.polypoly12.mulElementThis(P.lazyPolyD2)),o?(P.lazyPolypolyD1.constructFromMPValues(o,a),P.lazyPolypolyD1Deriv=new te({copy:P.lazyPolypolyD1}),P.lazyPolypolyD1Deriv.derivative1This(),P.tempPp.assignCopy(P.lazyPolypolyD1),P.tempPp.mulElementThis(P.polyX2),P.polypoly11.subThis(P.tempPp),P.tempPp.assignCopy(P.lazyPolypolyD1),P.tempPp.mulElementThis(P.polyY2),P.polypoly12.subThis(P.tempPp)):(P.polypoly11.sub0This(P.polyX2),P.polypoly12.sub0This(P.polyY2)),P.polypolyX1Deriv.assignCopy(P.polypolyX1),P.polypolyX1Deriv.derivative1This(),P.polypolyY1Deriv.assignCopy(P.polypolyY1),P.polypolyY1Deriv.derivative1This(),o&&(P.polypolyX1Deriv.mulThis(P.lazyPolypolyD1),P.tempPp2.assignCopy(P.lazyPolypolyD1Deriv),P.tempPp2.mulThis(P.polypolyX1),P.polypolyX1Deriv.subThis(P.tempPp2),P.polypolyY1Deriv.mulThis(P.lazyPolypolyD1),P.tempPp2.assignCopy(P.lazyPolypolyD1Deriv),P.tempPp2.mulThis(P.polypolyY1),P.polypolyY1Deriv.subThis(P.tempPp2)),P.polyX2Deriv.assignCopy(P.polyX2),P.polyX2Deriv.derivative1This(),P.polyY2Deriv.assignCopy(P.polyY2),P.polyY2Deriv.derivative1This(),m&&((0,n.g)(null===P.lazyPolyD2Deriv),P.lazyPolyD2Deriv=new Jt({copy:P.lazyPolyD2}),P.lazyPolyD2Deriv.derivative1This(),P.polyX2Deriv.mulThis(P.lazyPolyD2),P.tempP1.assignCopy(P.lazyPolyD2Deriv),P.tempP1.mulThis(P.polyX2),P.polyX2Deriv.subThis(P.tempP1),P.polyY2Deriv.mulThis(P.lazyPolyD2),P.tempP1.assignCopy(P.lazyPolyD2Deriv),P.tempP1.mulThis(P.polyY2),P.polyY2Deriv.subThis(P.tempP1)),P.polypoly1.assignCopy(P.polypoly11),P.polypoly1.mulElementThis(P.polyX2Deriv),P.tempPp.assignCopy(P.polypoly12),P.tempPp.mulElementThis(P.polyY2Deriv),P.polypoly1.addThis(P.tempPp),P.polypoly2.assignCopy(P.polypolyX1Deriv),P.polypoly2.mulElementThis(P.polyY2Deriv),P.tempPp.assignCopy(P.polypolyY1Deriv),P.tempPp.mulElementThis(P.polyX2Deriv),P.polypoly2.subThis(P.tempPp);let S=[];const E=[];y||(y=[]),f||(f=[]),he(P.polypoly11,P.polypoly12,P.tempP);const C=r.ai.ldexp(-59).toDouble(),w=[];let I=ue(P.tempP,g,_,C,64,w,x,x);if(I<0)return-1;for(let D=0;D<I;D++){const t=P.tempP1,e=P.tempP2;Jt.evaluateCoefs(P.polypoly11,w[D],t);const s=(0,r.aj)(t.m_elements,t.power()+1);s.sort(((t,e)=>t.compare(e))),Jt.evaluateCoefs(P.polypoly12,w[D],e);const i=(0,r.aj)(e.m_elements,e.power()+1);i.sort(((t,e)=>t.compare(e)));const o=s[0],a=s.at(-1),l=i[0],h=i.at(-1);a.subThis(o),h.subThis(l);const u=a.subThis(h).GEZ(),c=58,m=[];let d;if(d=ue(u?t:e,g,p,r.ai.ldexp(-59).toDouble(),c,m,x,x),d<0&&(0,n.d)("mp_curve_proximity"),d>0){const s=u?e:t;for(let t=0;t<d;t++){let e;if(u){const s=P.tempP;Jt.evaluateCoefs(P.polypoly12,w[D].addDouble(Number.EPSILON),s),e=s.evaluate(m[t])}else{const s=P.tempP;Jt.evaluateCoefs(P.polypoly11,w[D].addDouble(Number.EPSILON),s),e=s.evaluate(m[t])}const i=s.evaluateDerivative(m[t]).abs().mulDoubleThis(Number.EPSILON),o=s.evaluate(m[t]);i.addThis(e.sub(o).absThis()),i.ldexpThis(3),o.absThis(),o.lt(i)?E.push((0,r.k)(m[t].toDouble(),w[D].toDouble())):(0,n.g)(o.gte(i))}}}I=E.length,he(P.polypoly1,P.polypoly2,P.tempP);const T=[];let A=ue(P.tempP,g,_,C,64,T);A<0&&(A=0);for(let n=0;n<A;n++){Jt.evaluateCoefs(P.polypoly1,T[n],P.tempP1);const t=[];let e=ue(P.tempP1,g,p,C,64,t);if(0!==e)if(Jt.evaluateCoefs(P.polypoly2,T[n],P.tempP2),e<0){if(e=ue(P.tempP2,g,p,C,64,t),e<0)continue;for(let s=0;s<e;s++)S.push((0,r.k)(t[s].toDouble(),T[n].toDouble()))}else{const s=P.tempP2.absEvaluate(r.ai);s.mulThis(r.M.constructDouble(1e-12));for(let i=0;i<e;i++){const e=P.tempP2.evaluate(t[i]);e.absThis(),e.lt(s)&&S.push((0,r.k)(t[i].toDouble(),T[n].toDouble()))}}}if(A=S.length,0===I&&0===A)return 0;S=S.concat(E),S.sort(((t,e)=>b?(0,r.a8)(t.second,e.second):(0,r.a8)(t.first,e.first)));const M=(0,r.u)(S,((t,e)=>t.first===e.first&&t.second===e.second));S=S.slice(0,M),f.length=0,y.length=0;for(const n of S)f.push(n.first),y.push(n.second);return(0,n.g)(f.length===y.length),y.length}function se(t,e,s,n,i,o,a,l,h,u,c,m,d){const g={polyIntersect:new Jt,polyX1:new Jt,polyY1:new Jt,polyX1Deriv:new Jt,polyY1Deriv:new Jt,lazyPolyD1:new Jt,lazyPolyD1Deriv:new Jt,tempP:new Jt,tempP1:new Jt,tempP2:new Jt,polypoly1Proximity:new te,polypoly2Proximity:new te};g.polyX1.construct(t,e),g.polyY1.construct(s,n),g.polyX1Deriv.assignCopy(g.polyX1),g.polyX1Deriv.derivative1This(),g.polyY1Deriv.assignCopy(g.polyY1),g.polyY1Deriv.derivative1This(),g.polyIntersect.assignCopy(g.polyX1),g.polyIntersect.mulThis(g.polyX1),g.polyIntersect.mulElementThis(a[0]),g.tempP.assignCopy(g.polyY1),g.tempP.mulThis(g.polyY1),g.tempP.mulElementThis(a[1]),g.polyIntersect.addThis(g.tempP),i?(g.lazyPolyD1.construct(i,o),g.tempP.assignCopy(g.lazyPolyD1),g.tempP.mulThis(g.lazyPolyD1),g.tempP.mulElementThis(a[2]),g.polyIntersect.addThis(g.tempP)):g.polyIntersect.add0(a[2]);{const i=a[0].clone(),o=i.clone();o.sqrThis();const l=a[1].clone(),h=l.clone();h.sqrThis();const u=a[2].clone(),c=i.clone();c.subThis(l),g.polyX1.construct(t,e),g.polyX1Deriv.assignCopy(g.polyX1),g.polyX1Deriv.derivative1This(),g.polyY1.construct(s,n),g.polyY1Deriv.assignCopy(g.polyY1),g.polyY1Deriv.derivative1This(),g.tempP.assignCopy(g.polyX1),g.tempP.mulThis(g.polyX1),g.tempP.mulElementThis(h),g.tempP.mulElementThis(u),g.polypoly1Proximity.construct0(g.tempP),g.tempP.assignCopy(g.polyX1),g.tempP.mulThis(l.mul(c).mul(u).ldexpThis(1)),g.polypoly1Proximity.addElement(g.tempP),g.tempP.assignCopy(g.polyX1),g.tempP.mulThis(g.polyX1),g.tempP.mulElementThis(i.mul(h)),g.tempP1.assignCopy(g.polyY1),g.tempP1.mulThis(g.polyY1),g.tempP1.mulElementThis(o.mul(l)),g.tempP.addThis(g.tempP1),g.tempP.add0(c.mul(c).mul(u)),g.polypoly1Proximity.addElement(g.tempP),g.tempP.assignCopy(g.polyX1),g.tempP.mulElementThis(c.mul(i).mul(l).ldexpThis(1)),g.polypoly1Proximity.addElement(g.tempP),g.tempP.construct0(i.mul(c).mul(c)),g.polypoly1Proximity.addElement(g.tempP),g.polypoly1Proximity.updatePower(),g.tempP.construct0(r.ah),g.polypoly2Proximity.construct0(g.tempP),g.tempP.assignCopy(g.polyX1),g.tempP.mulThis(g.polyX1Deriv),g.tempP1.assignCopy(g.polyY1),g.tempP1.mulThis(g.polyY1Deriv),g.tempP.addThis(g.tempP1),g.tempP.mulElementThis(i.mul(l)),g.polypoly2Proximity.addElement(g.tempP),g.tempP.assignCopy(g.polyX1Deriv),g.tempP.mulElementThis(c.mul(i)),g.polypoly2Proximity.addElement(g.tempP),g.polypoly2Proximity.updatePower()}const p=[],_=[];null===c&&(c=[]);let f=2*g.polyIntersect.power()+58;const y=.5*Number.EPSILON,x=[],v=ue(g.polyIntersect,l,h,y,f,x,m,m);if(v<0)return-1;for(const r of x)_.push(r.toDouble());he(g.polypoly1Proximity,g.polypoly2Proximity,g.tempP),f=2*g.tempP.power()+58,x.length=0;let b=ue(g.tempP,l,h,y,f,x);if(b<0&&(b=0),0===v&&0===b)return 0;for(const r of x)p.push(r.toDouble());const P=p.concat(_);c.length=P.length,(0,r.b)(c,P,0,0,P.length),(0,r.v)(c);const S=(0,r.u)(c,((t,e)=>0===(0,r.a8)(t,e)));return c.length=S,c.length}function ne(t,e,s,n){return t.isZero()?e.isZero()?-1:0:(n.setThis(e),n.negateThis(),n.divThis(t),s.isEmpty()||s.containsCoordinate(n.value())?1:0)}function ie(t,e,s,n,i,o,a){if(t.isZero())return o?(a[0].setInt32(1),i.containsCoordinate(1)?1:0):ne(e,s,i,a[0]);if(o){let e=2;return a[0].setInt32(1),s.equals(t)?(a[1].setInt32(1),e=1):a[1].setThis(s.div(t)),i.containsCoordinate(a[1].value())||(e=1),i.containsCoordinate(a[0].value())||(e--,a[0].setThis(a[1])),2===e&&a[0].value()>a[1].value()&&(a[1]=(0,r.c)(a[0],a[0]=a[1])),e}const l=e.clone();l.sqrThis();const h=t.clone();if(h.mulThis(s).ldexpThis(2).negateThis().addThis(l),h.LZ())return 0;const u=n+2,c=r.M.sqrt(h,u),m=c.clone();e.LZ()&&m.negateThis(),m.addThis(e).limitPrecisionThis(u).ldexpThis(-1).negateThis();let d=0;return a[0].setThis(m).divThis(r.M.constructAssign(t,u)).limitPrecisionThis(n),(i.isEmpty()||i.containsCoordinate(a[0].value()))&&d++,c.isZero()||m.isZero()||(a[d].setThis(s).divThis(m).limitPrecisionThis(n),(i.isEmpty()||i.containsCoordinate(a[d].value()))&&d++,2===d&&a[0].gt(a[1])&&(a[1]=(0,r.c)(a[0],a[0]=a[1]))),d}function re(t,e,s,i,o,a,l,h){if(t.isZero())return ie(e,s,i,o,a,l,h);const u=(t,e)=>{if(t>0){let s=e+t;for(let t=1;t<s;t++)h[t].equals(h[0])&&(h[s-1]=(0,r.c)(h[t],h[t]=h[s-1]),s--);e=s}return(0,r.C)(h,0,e,((t,e)=>t.compare(e))),e};if(i.isZero()){let n=0;return a.containsCoordinate(0)&&(h[0].setInt32(0),n=1),u(ie(t,e,s,o,a,l,h.slice(1)),n)}if(l){let s=0;a.containsCoordinate(1)&&(h[0].setInt32(1),s=1);const n=e.add(t),r=i.negate(),l=t.add(n).add(r).isZero();return u(ie(t,n,r,o,a,l,h.slice(s)),s)}const c=new r.M,m=new r.M,d=new r.M,g=e.clone();if(g.isZero())m.setThis(s),m.divThis(t),d.setThis(i),d.divThis(t);else{g.divThis(t).divDoubleThis(3).negateThis();const n=e.clone();n.sqrThis();const r=t.clone();r.sqrThis(),m.setThis(t),m.mulThis(s).mulDoubleThis(3).subThis(n).divThis(r).divDoubleThis(3),d.setThis(n),d.mulThis(e),d.ldexpThis(1),c.setThis(t),c.mulThis(e).mulThis(s).mulDoubleThis(9),d.subThis(c),c.setThis(r),c.mulThis(i).mulDoubleThis(27),d.addThis(c),d.divThis(r).divThis(t).divDoubleThis(27)}if(m.isZero()){const t=d.clone();return t.negateThis(),t.isZero()?(h[0].setThis(g),fe(a,o,h,1)):(h[0].setThis(r.M.cubicRoot(t,o).add(g)),fe(a,o,h,1))}const p=d.clone();if(p.sqrThis().ldexpThis(-2),c.setThis(m.clone()),c.sqrThis().mulThis(m).divDoubleThis(27),p.addThis(c),p.isZero())return h[0].setThis(d),h[0].mulDoubleThis(3).divThis(m),h[1].setThis(h[0]),h[1].negateThis(),h[1].ldexpThis(-1),h[0].addThis(g),h[1].addThis(g),fe(a,o,h,2);if(p.GZ())return p.setThis(r.M.sqrt(p,o+8)),c.setThis(d),c.ldexpThis(-1).negateThis(),c.addThis(p),h[0].setThis(r.M.cubicRoot(c,o+8)),c.setThis(d),c.ldexpThis(-1).negateThis(),c.subThis(p),h[0].addThis(r.M.cubicRoot(c,o+8)),h[0].addThis(g),fe(a,o,h,1);c.setThis(m),c.divDoubleThis(3).negateThis(),(0,n.g)(c.GEZ());const _=r.M.sqrt(c,o+8),f=_.clone();f.negateThis(),f.addThis(g),_.addThis(g);const y=r.M.constructDouble(a.isEmpty()?-Number.MAX_VALUE:a.vmin),x=r.M.constructDouble(a.isEmpty()?Number.MAX_VALUE:a.vmax),v=new Jt({zeroCtor:r.M});v.construct0(i),v.addElement(s),v.addElement(e),v.addElement(t);const b=new Jt({copy:v});b.derivative1This();let P=0;const S=(0,r.m)(r.M,4);S[P++].setThis(y),f.gt(y)&&f.lt(x)&&S[P++].setThis(f),_.gt(y)&&_.lt(x)&&S[P++].setThis(_),S[P++].setThis(x);const E=3*o;let C=52,w=Number.EPSILON;for(;C<E;)2*C<=E?(w*=w,C*=2):(w*=Number.EPSILON,C+=52);C+=2;let I=0,T=!1;for(let n=1;n<P;n++)if(de(v,b,S[n-1],S[n],w,C,h[0])){I=1,T=n+1<P;break}if(!I)return 0;if(T){const t=new Jt({zeroCtor:r.M,coef0:h[0]});t.negateThis(),t.addElement(r.ai);const e=new Jt({zeroCtor:r.M}),s=new Jt({zeroCtor:r.M});v.div(t,e,s),(0,n.g)(2===e.power()),(0,n.g)(0===s.power());const i=ie(e.getElement(2),e.getElement(1),e.getElement(0),o,a,!1,h.slice(1));(0,n.g)(i>=0&&i<=2),I+=i}return fe(a,o,h,I)}function oe(t,e,s,n,i,o,a,l,h){if(t.isZero())return re(e,s,n,i,o,a,l,h);const u=(t,e)=>{if(t>0){let s=e+t;for(let t=1;t<s;t++)h[t].equals(h[0])&&(h[s-1]=(0,r.c)(h[t],h[t]=h[s-1]),s--);e=s}return(0,r.C)(h,0,e,((t,e)=>t.compare(e))),e};if(i.isZero()){let i=0;return a.containsCoordinate(0)&&(h[0].setInt32(0),i=1),u(re(t,e,s,n,o,a,l,h.slice(i)),i)}const c=new Jt({zeroCtor:r.M,coef0:i});if(c.addElement(n),c.addElement(s),c.addElement(e),c.addElement(t),l){let t=0;a.containsCoordinate(1)&&(h[0].setInt32(1),t=1);const e=new Jt({zeroCtor:r.M,coef0:r.M.constructInt32(-1)});e.addElement(r.M.constructInt32(1));const s=new Jt({zeroCtor:r.M}),n=new Jt({zeroCtor:r.M});return c.div(e,s,n),u(re(3===s.power()?s.getElement(3):r.ah.clone(),s.power()>=2?s.getElement(2):r.ah.clone(),s.power()>=1?s.getElement(1):r.ah.clone(),s.getElement(0),o,a,s.evaluate(r.ai).isZero(),h.slice(t)),t)}if(c.getElement(0).isZero()){let t=0;for(a.containsCoordinate(0)&&(t=1,h[0].setDouble(0));c.getElement(0).isZero()&&c.power()>0;)c.shiftRight(1);const e=re(3===c.power()?c.getElement(3):r.ah.clone(),c.power()>=2?c.getElement(2):r.ah.clone(),c.power()>=1?c.getElement(1):r.ah.clone(),c.getElement(0),o,a,!1,h.slice(t));return e>0&&(t+=e),(0,r.C)(h,0,t,((t,e)=>t.compare(e))),t}let m=52,d=Number.EPSILON;for(;m<o;)2*m<=o?(d*=d,m*=2):(d*=Number.EPSILON,m+=52);m+=2;const g=_e(c),p=r.M.constructDouble(Math.max(Math.abs(a.vmax),Math.abs(a.vmin)));return d=(g.lt(p)?g:p).mul(r.M.constructDouble(d)).toDouble(),pe(c,a,d,m,l,!1,h,4)}function ae(t,e){let s=t,n=e;n.power()>s.power()&&(n=(0,r.c)(s,s=n));const i=s.power()-n.power(),o=new Jt({copy:s.getElement(s.power())});s.mulThis(n.getElement(n.power()));for(let r=0,a=s.power();r<a;r++)if(r>=i){const t=new Jt({copy:n.getElement(r-i)});t.mulThis(o);const e=s.getElement(r).sub(t);s.setElement(r,e)}s.setElement(s.power(),s.getElement(s.power()).setZero()),s.updatePower(),le(s)}function le(t){let e=0;for(;e<t.power()&&t.getElement(e).isZero();)e++;return e>0&&(t.shiftRight(e),!0)}function he(t,e,s){const n=t.clone(),i=e.clone();for(le(n),le(i);0!==n.power()||0!==i.power();)ae(n,i);s.assignMove(n.getElement(0))}function ue(t,e,s,n,i,o,a=!1,l=!1){o.length=0;const h=t.power(),u=(0,r.m)(r.M,2*h+4),c=function(t,e,s,n,i,o,a){if(0===t.power())return t.isZero()?-1:0;const l=t.evaluate(r.M.constructInt32(1)).isZero();if(1===t.power()){const s=ne(t.getElement(1),t.getElement(0),e,o.at(0));return o[0].limitPrecisionThis(n),1!==s?0:(o[0].limitPrecisionThis(n),1)}return 2===t.power()?ie(t.getElement(2),t.getElement(1),t.getElement(0),n,e,l,o):3===t.power()?re(t.getElement(3),t.getElement(2),t.getElement(1),t.getElement(0),n,e,l,o):4===t.power()?oe(t.getElement(4),t.getElement(3),t.getElement(2),t.getElement(1),t.getElement(0),n,e,l,o):pe(t,e,s,n,l,i,o,a)}(t,s||r.E.unit(),n,i,!1,u,u.length);if(c>0){o.length=0;for(let t=0;t<c;t++){const e=u[t];t>0&&e.lte(o.at(-1))||o.push(e.clone())}return o.length}return c}function ce(t,e,s){if((0,n.g)(s>=1),0===t.power())return t.isZero()?-1:0;const i=t.getElement(0);return i.negateThis(),i.divThis(t.getElement(1)),e[0].setThis(i),1}function me(t,e,s,i){if(t.power()<2)return ce(t,s,i);(0,n.g)(i>=1);let o=t.getElement(1);o.mulThis(t.getElement(1));const a=t.getElement(0);if(a.mulThis(t.getElement(2)),a.ldexpThis(2),o.subThis(a),o.LZ())return 0;if(o.isZero()){const n=t.getElement(1);return n.negateThis(),n.divThis(t.getElement(2)),n.ldexpThis(-1),n.limitPrecisionThis(e),s[0].setThis(n),1}(0,n.g)(i>=2),o=r.M.sqrt(o,e+8);const l=t.getElement(1);l.negateThis();const h=l.clone();h.subThis(o),h.divThis(t.getElement(2)),h.ldexpThis(-1),h.limitPrecisionThis(e);const u=l.clone();return u.addThis(o),u.divThis(t.getElement(2)),u.ldexpThis(-1),u.limitPrecisionThis(e),h.lt(u)?(s[0].setThis(h),s[1].setThis(u)):(s[1].setThis(h),s[0].setThis(u)),2}function de(t,e,s,i,o,a,l){let h=s.clone(),u=i.clone();h.limitPrecisionThis(a),u.limitPrecisionThis(a);let c=t.evaluate(h);c.limitPrecisionThis(a+2);let m=t.evaluate(u);if(m.limitPrecisionThis(a+2),c.GEZ()&&m.GEZ()||c.LEZ()&&m.LEZ())return c.absLessAbs(m)?(l=h,c.isZero()):(l=u,m.isZero());const d=m.LZ();d&&(m=(0,r.c)(c,c=m),u=(0,r.c)(h,h=u));const g=d?u:h,p=d?h:u,_=h.add(u).ldexpThis(-1);_.limitPrecisionThis(a);const f=u.sub(h);f.limitPrecisionThis(a),f.absThis();const y=f.clone();let x=t.evaluate(_),v=e.evaluate(_);const b=new Jt({copy:t}),P=new Jt({copy:e});{const s=Math.max(t.hiBitIndex(),e.hiBitIndex()),n=r.ai.clone();n.ldexpThis(-(a+2));for(let i=64;i<s;){b.limitPrecisionThis(i),P.limitPrecisionThis(i);const r=b.evaluate(_),o=P.evaluate(_),a=r.sub(x),l=o.sub(v);if(a.divThis(x).absThis().lt(n)&&(v.isZero()||l.divThis(v).absThis().lt(n)))break;b.assignCopy(t),P.assignCopy(e),i=Math.min(i+64,s)}x.limitPrecisionThis(a+2),v.limitPrecisionThis(a+2)}let S=4;let E=1,C=0,w=0,I=1;const T=r.M.constructDouble(.25*o),A=r.M.constructDouble(.5001);let M=0;for(;++M<300;){if(M>32&&C>0||v.isZero()||2===I&&C>1||1===I&&S<4)I=1,E>1&&E--;else if(I=2,w>1){const t=f.mul(v);t.absThis(),t.ldexpThis(-3),t.absLessAbs(x)&&E++}f.setThis(y);const t=new r.M;let e=!1;if(1===I)do{if(w>2){const e=f.clone();if(e.absThis(),e.ldexpThis(4),p.sub(g).ldexpThis(-1).gt(e)){if(_.equals(g)){t.setThis(_),_.setThis(g.add(e)),_.limitPrecisionThis(a),y.setThis(_.sub(t));break}if(_.equals(p)){t.setThis(_),_.setThis(p.sub(e)),_.limitPrecisionThis(a),y.setThis(_.sub(t));break}}}y.setThis(u.sub(h)),y.ldexpThis(-1),y.limitPrecisionThis(a),t.setThis(_),_.setThis(h.add(y)),_.limitPrecisionThis(a),_.lt(g)?_.setThis(g):_.gt(p)&&_.setThis(p),e=h.equals(_)||u.equals(_)}while(0);else for(;;){if(y.setThis(x.div(v)),y.limitPrecisionThis(a),1!==E&&y.mulDoubleThis(E),t.setThis(_),_.subThis(y),_.limitPrecisionThis(a),e=_.equals(t),_.lt(g)){if(E>1){_.setThis(t),E--;continue}y.setThis(t.sub(g)),_.setThis(g)}else if(_.gt(p)){if(E>1){_.setThis(t),E--;continue}y.setThis(t.sub(p)),_.setThis(p)}break}if(e||y.absLessAbs(T)){t.equals(_)||(x=b.evaluate(_),x.limitPrecisionThis(a+2));break}x=b.evaluate(_),x.limitPrecisionThis(a+2),v=P.evaluate(_),v.limitPrecisionThis(a+2);const s=h.clone(),n=u.clone();x.LZ()?(c.setThis(x),h.setThis(_)):(m.setThis(x),u.setThis(_)),2===I&&(h.equals(s)&&u.equals(n)||w>1&&!y.absLessAbs(A.mul(f)))?C++:C=0,1===I?(S++,w=0):(S=0,w++)}return M>=300&&(0,n.d)("Root_finder iterations exceeded"),l.setThis(_),!0}function ge(t,e,s,n,i){const o=t.evaluate(s);if(o.isZero())return!0;const a=r.M.constructDouble(.5*n),l=s.clone();l.subThis(a);const h=t.evaluate(l),u=s.clone();u.addThis(a);const c=t.evaluate(u);if(h.LZ()&&c.GZ()||h.GZ()&&c.LZ())return!0;if(o.GZ()?h.LEZ()||c.LEZ():h.GEZ()||c.GEZ())return!0;const m=h.LEZ()&&c.LEZ(),d=h.GEZ()&&c.GEZ();let g=!1;return m?o.gt(h)&&o.gt(c)&&(g=!0):d&&o.lt(h)&&o.lt(c)&&(g=!0),!!g&&o.absThis().lt(r.M.constructDouble(1e-17))}function pe(t,e,s,i,o,a,l,h){(0,n.g)(s>0),(0,n.g)(h>=t.power());const u=l,c=[];let m=[];const d=new Jt({zeroCtor:t.m_zeroCtor}),g=new Jt({zeroCtor:t.m_zeroCtor}),p=new Jt({zeroCtor:t.m_zeroCtor}),_=r.M.constructDouble(s),f=r.M.constructDouble(e.vmin),y=r.M.constructDouble(e.vmax),x=f.sub(_),v=y.add(_),b=_e(t),P=b.clone();if(P.negateThis(),x.lt(P))x.setThis(P.sub(_));else if(x.gt(b))return 0;if(v.gt(b))v.setThis(b.add(_));else if(v.lt(P))return 0;let S=t,E=null;if(o){const e=new Jt({coef0:r.M.constructInt32(-1)});e.addElement(r.ai),E=new Jt,S=E;const s=new Jt,n=new Jt;for(t.div(e,s,n),E.assignCopy(s);S.evaluate(r.ai).isZero();)S.div(e,s,n),E.assignCopy(s)}let C=!1;if(S.power()>0&&S.getElement(0).isZero())for(C=!0,E||(E=new Jt({copy:S}),S=E);S.getElement(0).isZero();)E.shiftRight(1);let w=i+2*S.power()+2,I=s/Math.pow(2,S.power()+2),T=w;if(r.ah.gt(x)&&r.ah.lt(v))for(let n=0,F=S.power();n<F;n++)if(S.getElement(n).isZero()){c.push(r.ah.clone());break}for(let F=S.power()-1;F>0;F--)if(I*=2,w-=2,T-=2,S.power()-F!=1)if(S.power()-F!=2){g.assignMove(p),p.assignMove(S.derivative(F-1));let t=[];for(let e=0,s=m.length;e<s;++e)if(m[e].first.lte(m[e].second)){const s=new r.M;if(de(g,d,m[e].first,m[e].second,I,w,s)){c.push(s);let n=s.sub(_);n.limitPrecisionThis(T),t.push((0,r.k)(m[e].first,n)),n=s.add(_),n.limitPrecisionThis(T),t.push((0,r.k)(n,m[e].second))}else t.push(m[e])}m=t,t=[],d.assignMove(g)}else{g.assignMove(S.derivative(F));const t=me(g,w,u,h);(0,n.g)(t>=0&&t<=2);for(let e=0;e<t;e++)u[e].gt(x)&&u[e].lt(v)&&!u[e].isZero()&&c.push(u[e].clone());if(c.length>1&&c.sort(((t,e)=>t.compare(e))),c.length>0){let t=c[0].sub(_);t.limitPrecisionThis(T),m.push((0,r.k)(x.clone(),t));let e=1===c.length?v.clone():c[1].sub(_);t=c[0].add(_),t.limitPrecisionThis(T),e.limitPrecisionThis(T),m.push((0,r.k)(t,e)),c.length>1&&(e=2===c.length?v.clone():c[2].sub(_),e.limitPrecisionThis(T),t=c[1].add(_),t.limitPrecisionThis(T),m.push((0,r.k)(t,e)),c.length>2&&(t=c[2].add(_),t.limitPrecisionThis(T),m.push((0,r.k)(t,v.clone()))))}else m.push((0,r.k)(x.clone(),v.clone()));d.assignCopy(g),p.assignMove(S.derivative(F-1))}else g.assignMove(S.derivative(F)),1===ce(g,u,h)&&(u[0].gt(x)&&u[0].lt(v)&&!u[0].isZero()&&c.push(u[0].clone()),d.assignMove(g),p.assignMove(S.derivative(F-1)));c.sort(((t,e)=>t.compare(e))),0===m.length&&(d.assignMove(S.derivative(S.power())),d.isZero()||m.push((0,r.k)(x.clone(),v.clone())));let A=0,M=0,D=0;const N=new r.M;for(;;){if(M<m.length){if(m[M].first.gt(m[M].second)){M++;continue}let t=!1;if(D<c.length&&c[D].lt(m[M].first)&&(t=!0),!t){de(S,d,m[M].first,m[M].second,s,i,N)&&(N.lt(f)?u[A++].setThis(f):N.gt(y)?u[A++].setThis(y):u[A++].setThis(N)),M++;continue}}if(!(D<c.length))break;0!==D&&c[D-1].equals(c[D])||ge(S,0,c[D],s)&&(N.setThis(c[D]),N.lt(f)?N.setThis(f):N.gt(y)&&N.setThis(y),0!==A&&u[A].equals(N)||u[A++].setThis(N)),D++}return C&&r.ah.gt(x)&&r.ah.lt(v)&&(u[A++].setThis(r.ah),(0,r.C)(u,0,A,((t,e)=>t.compare(e)))),o&&r.ai.gt(x)&&r.ai.lt(v)&&(u[A++].setThis(r.ai),(0,r.C)(u,0,A,((t,e)=>t.compare(e)))),A}function _e(t){const e=t.getElement(t.power());e.limitPrecisionThis(53),e.absThis();const s=r.ah.clone();for(let n=0,i=t.power();n<i;n++){const e=t.getElement(n);e.limitPrecisionThis(53),e.gt(s)&&s.setThis(e)}return s.divThis(e),s.addThis(r.ai),s.mulThis(r.M.constructDouble(1+100*Number.EPSILON)),s}function fe(t,e,s,n){let i=n;if(!t.isEmpty()){i=0;for(let e=0;e<n;++e)t.containsCoordinate(s[e].value())&&(i!==e&&s[i].setThis(s[e]),i++)}i>1&&(s[0].gt(s[1])&&(s[1]=(0,r.c)(s[0],s[0]=s[1])),i>2&&(s[0].gt(s[2])&&(s[2]=(0,r.c)(s[0],s[0]=s[2])),s[1].gt(s[2])&&(s[2]=(0,r.c)(s[1],s[1]=s[2]))));for(let r=0;r<i;++r)s[r].limitPrecisionThis(e);return i}function ye(t,e,s,i,o,a){return function(t,e,s,i,o,a){if(s<e&&(0,n.a)("xTo < xFrom"),s===e)return 0;const l=[0];let h=Number.MAX_VALUE;const u=[Number.MAX_VALUE];let c=0;const m=32,d=(0,r.d)(m+1,Number.NaN),g=(0,r.d)(m+1,Number.NaN),p=[0];d[0]=1;let _=0,f=0;for(let r=0;r<m;r++){if(c=xe(e,s,i,0===r,c,p),g[r]=c,r+1>=t){ve(r+1-t,t,d,g,0,l,u)||(0,n.d)("polynomial_interpolation");const e=o*Math.abs(l[0])+a,s=Math.abs(h-l[0]);if(s<=e&&Math.abs(u[0])<=e){if(_++,_>1&&(s<=.1*f||0===f||_>2))return l[0]}else _=0;f=s,h=l[0]}g[r+1]=g[r],d[r+1]=.25*d[r]}return l[0]}(t,e,s,a,i,o)}function xe(t,e,s,n,i,o){let a=i;if(n)return o[0]=1,a=.5*(e-t)*(s(t)+s(e)),a;const l=o[0],h=(e-t)/l,u=t,c=new r.K(0);for(let r=1;r<=o[0];++r){const t=(r-.5)*h;c.add(s(u+t))}return a=.5*(a+(e-t)*c.getResult()/l),o[0]*=2,a}function ve(t,e,s,n,i,o,a){let l=0,h=Math.abs(i-s[t]);const u=(0,r.d)(e,Number.NaN),c=(0,r.d)(e,Number.NaN);for(let r=0;r<e;++r){const e=Math.abs(i-s[t+r]);e<h&&(l=r,h=e),u[r]=n[t+r],c[r]=n[t+r]}let m=0,d=0,g=0;o[0]=n[t+l],l--;for(let r=1;r<e;r++){for(let n=0;n<e-r;n++){if(d=s[t+n]-i,g=s[t+n+r]-i,m=d-g,0===m)return!1;const e=(u[n+1]-c[n])/m;u[n]=d*e,c[n]=g*e}if(2*(l+1)<e-r){const t=l+1;a[0]=u[t]}else{const t=l;a[0]=c[t],l--}o[0]+=a[0]}return!0}class be{constructor(){this.area=Number.NaN,this.centroid_x=Number.NaN,this.centroid_y=0,this.specialPoints=[],this.specialPointsLength=[]}specialPointsCount(){return this.specialPoints.length}}let Pe=class{constructor(t,e){this.b=t,this.len=e}getMaxDerivative(){return 1}getValue(t,e){return 0===t?this.len-Ie(this.b,e,!1):0}getError(t){return(0,n.g)(0),0}};function Se(t,e,s,n,i){let o=!0;const a=(0,r.m)(r.P,3);t.queryControlPoints(a);let l=o?0:1,h=a[1][l]-a[0][l],u=a[2][l]-a[0][l];const c=ye(5,e,s,n,i,(t=>{let e;if(t<=.5){const s=(0,r.X)(0,h,t),n=(0,r.X)(h,u,t);e=(0,r.X)(s,n,t)}else{const s=(0,r.Y)(0,h,t),n=(0,r.Y)(h,u,t);e=(0,r.Y)(s,n,t)}return e*Ne(a,1,t).length()}));o=!1,l=o?0:1,h=a[1][l]-a[0][l],u=a[2][l]-a[0][l];const m=ye(5,e,s,n,i,(t=>{let e;if(t<=.5){const s=(0,r.X)(0,h,t),n=(0,r.X)(h,u,t);e=(0,r.X)(s,n,t)}else{const s=(0,r.Y)(0,h,t),n=(0,r.Y)(h,u,t);e=(0,r.Y)(s,n,t)}return e*Ne(a,1,t).length()}));return new r.P(c,m)}function Ee(t){t.m_cachedValues=null}function Ce(t){if(t.m_cachedValues)return t.m_cachedValues;const e=new be;return we(t,e.specialPoints),Le(t,e),e}function we(t,e){const s=(0,r.m)(r.P,3);t.queryControlPoints(s);const n=(0,r.m)(r.H,8);n[0].set(0);let i=1;{const t=(0,r.m)(r.H,3);!function(t,e,s=!1){const n=0,i=new r.H(t[1][n]).subE(new r.H(t[0][n]));e[1]=i.mul(2),e[2]=new r.H(t[2][n]).subE(new r.H(t[1][n])).subE(i),s?e[0].set(0):e[0].set(t[0][n])}(s,t,!1);const e=(0,r.m)(r.H,2),o=new r.E(0,1);let a=Vt(t[2].mul(2),t[1],o,e[0]);a<0&&(a=0);for(let s=0;s<a;s++)(0,r.N)(e[s].value(),0,1)||(n[i]=e[s],i++)}{const t=(0,r.m)(r.H,3);!function(t,e,s=!1){const n=1,i=new r.H(t[1][n]).subE(new r.H(t[0][n]));e[1]=i.mul(2),e[2]=new r.H(t[2][n]).subE(new r.H(t[1][n])).subE(i),s?e[0].set(0):e[0].set(t[0][n])}(s,t,!1);const e=(0,r.m)(r.H,2),o=new r.E(0,1);let a=Vt(t[2].mul(2),t[1],o,e[0]);a<0&&(a=0);for(let s=0;s<a;s++)(0,r.N)(e[s].value(),0,1)||(n[i]=e[s],i++)}if(n[i].set(1),i++,i>2){(0,r.C)(n,0,i,((t,e)=>t.value()-e.value()));let t=0,e=n[0].value(),s=1;for(let r=1;r<i;r++)n[r].eq(n[r-1])?(e+=n[r].value(),s++):(s>1&&(e/=s,n[t].set(e)),t++,n[t]=n[r],e=n[r].value(),s=1);t++,i=t}n[0].set(0),n[i-1].set(1),e.length=i;for(let r=0;r<i;r++)e[r]=n[r].value()}function Ie(t,e,s){const n=(0,r.m)(r.P,3);return t.queryControlPoints(n),Te(n,e,s)}function Te(t,e,s){if(s){if(e<0)return e;if(e>1)return e-1+Te(t,1,!1)}if(1===e)return Ae(t);const n=(0,r.m)(r.P,3);return Ye(t,e,n,null),Ae(n)}function Ae(t){if(t[0].equals(t[1]))return r.P.distance(t[2],t[0]);if(t[1].equals(t[2]))return r.P.distance(t[0],t[2]);const e=r.P.distance(t[0],t[1])+r.P.distance(t[2],t[1]),s=r.P.distance(t[0],t[2]);if(e-s<=e*Number.EPSILON)return s;const n=(0,r.m)(r.P,3);$e(t,n,!0);const i=4*((0,r.a)(n[2].x)+(0,r.a)(n[2].y)),o=2*(n[2].x*n[1].x+n[2].y*n[1].y),a=(0,r.a)(n[1].x)+(0,r.a)(n[1].y);if(1e-14*(Math.abs(o)+Math.abs(a))>=Math.abs(i))return 1e-14*Math.abs(a)>=Math.abs(o)?1*Math.sqrt(a):2/(3*o)*(Math.pow(1*o+a,1.5)-Math.pow(a,1.5));const l=o/i,h=a/i,u=h-l*l,c=1+l;if(0===u)return l>=0&&c>=0||l<=0&&c<=0?Math.abs(.5*Math.sqrt(i)*(c*c-l*l)):.5*Math.sqrt(i)*(c*c+l*l);const m=Math.sqrt(u+c*c),d=Math.sqrt(h);return.5*Math.sqrt(i)*(c*m-l*d+u*Math.log(Math.abs((c+m)/(l+d))))}function Me(t,e){const s=(0,r.s)(e,0,1);let n=Ne(t,1,s);return n.isZero()&&(n=Ne(t,2,s)),n}function De(t,e,s){const n=(0,r.m)(r.P,3);return t.queryControlPoints(n),Ne(n,e,s)}function Ne(t,e,s){if(1===e){const e=t[1].sub(t[0]).mul(1-s).add(t[2].sub(t[1]).mul(s));return e.mulThis(2),e}return 2===e?t[2].sub(t[1]).sub(t[1].sub(t[0]).mul(2)):r.P.construct(0,0)}function Fe(t){const e=(0,r.m)(r.P,3);return t.queryControlPoints(e),Re(e)}function Re(t){return-t[1].sub(t[0]).crossProduct(t[2].sub(t[0]))/3}function ke(t){return t.m_cachedValues}function Le(t,e){t.m_cachedValues=e}function Ge(t,e,s,i,o){(0,n.x)(r.E.unit().contains(s),"QuadraticBezierHelper::getClosestCoordinateSegment");const a=(0,r.m)(r.P,3);t.queryControlPoints(a);let l=Number.MAX_VALUE;const h=[0],u=Ve(a,e,h);if(s.containsCoordinate(h[0]))l=r.P.distance(e,u);else{h[0]=s.vmin,Qe(a,h[0],u),l=r.P.distance(u,e);const t=new r.P;Qe(a,s.vmax,t);const n=r.P.distance(t,e);l>n&&(u.setCoordsPoint2D(t),h[0]=s.vmax,l=n)}if(!i)return h[0];if(s.vmin<=0){const n=new r.P;t.queryCoord2DExtended(-1,n,!0);const i=new r.P;t.queryCoord2D(s.vmin,i);const o=new Br({start:n,end:i}),a=o.getClosestCoordinate(e,!0);if(a<1){const t=o.getCoord2D(a),s=r.P.distance(t,e);s<l&&(l=s,h[0]=a-1,u.assign(t))}}if(s.vmin>=1){const n=new r.P;t.queryCoord2DExtended(2,n,!0);const i=new r.P;t.queryCoord2D(s.vmax,i);const o=new Br({start:i,end:n}),a=o.getClosestCoordinate(e,!0);if(a>0){const t=o.getCoord2D(a),s=r.P.distance(t,e);s<l&&(l=s,h[0]=1+a,u.assign(t))}}return h[0]}function Ve(t,e,s){const n=t[2].sub(t[1]).sub(t[1].sub(t[0])),i=t[1].sub(t[0]),o=t[0].sub(e),a=o.dotProduct(i),l=o.dotProduct(n)+2*i.dotProduct(i),h=3*i.dotProduct(n),u=n.dotProduct(n),c=(0,r.d)(3,Number.NaN),m=Nt(u,h,l,a,r.E.unit(),!1,c),d=t[0].clone();let g=0,p=r.P.sqrDistance(t[0],e),_=r.P.sqrDistance(t[2],e);_<p&&(g=1,d.assign(t[2]),p=_);for(let f=0;f<m;f++){const s=new r.P;Qe(t,c[f],s),_=r.P.sqrDistance(s,e),_<p&&(p=_,d.assign(s),g=c[f])}return s&&(s[0]=g),d}function ze(t,e,s){if(e.equalsRange(0,1))return void s.setFromPoints(t,3);const n=(0,r.m)(r.P,3);Ue(t,e.vmin,e.vmax,n),s.setFromPoints(n,3)}function Oe(t,e,s){s.setEmpty();const n=[];n.push(new r.E(0,1));const i=.5*Math.max(e.width(),e.height());for(;n.length;){const o=n.at(-1);n.pop();const a=new _;if(ze(t,o,a),a.isIntersectingW(e)){const t=Math.max(a.width(),a.height());if(e.containsW(a)||t<=i||o.width()<1e-12)s.merge(o);else{const t=o.getCenter();n.push(r.E.construct(o.vmin,t)),n.push(r.E.construct(t,o.vmax))}}}}function qe(t){const e=(0,r.m)(r.P,3);t.queryControlPoints(e);const s=Be(e);return s&&(t.m_cp.setCoordsPoint2D(e[1]),t.afterCompletedModification()),s}function Be(t){let e=!1;for(let s=0;s<2;s++){const n=(0,r.F)(t[0][s],t[2][s]);n>0?((0,r.F)(t[0][s],t[1][s])<0&&(t[1][s]=t[0][s],e=!0),(0,r.F)(t[1][s],t[2][s])<0&&(t[1][s]=t[2][s],e=!0)):n<0?((0,r.F)(t[0][s],t[1][s])>0&&(t[1][s]=t[0][s],e=!0),(0,r.F)(t[1][s],t[2][s])>0&&(t[1][s]=t[2][s],e=!0)):t[1][s]!==t[0][s]&&(t[1][s]=t[0][s],e=!0)}return e}function Ye(t,e,s,n){(new r.P).setCoordsPoint2D(t[0]),(new r.P).setCoordsPoint2D(t[1]),(new r.P).setCoordsPoint2D(t[2]);const i=new r.P,o=new r.P,a=new r.P;if((0,r.U)(t[0],t[1],e,i),(0,r.U)(t[1],t[2],e,o),(0,r.U)(i,o,e,a),s&&(s[0].assign(t[0]),s[1].assign(i),s[2].assign(a)),n){const e=t[2];n[0].assign(a),n[1].assign(o),n[2].assign(e)}}function Ue(t,e,s,n){if(e===s){const s=new r.P;return Qe(t,e,s),n[0]=s,n[1]=s,void(n[2]=s)}const i=(0,r.m)(r.P,3);Ye(t,s,i,null),Ye(i,e/s,null,i),Qe(t,e,i[0]),Qe(t,s,i[2]),n[0].setCoordsPoint2D(i[0]),n[1].setCoordsPoint2D(i[1]),n[2].setCoordsPoint2D(i[2])}function He(t,e,s,n,i){if(i){if(0!==Rr(e,s))return t?4:2}else if(C(e,s))return 1;return 0!==je(t,e,s,null,null,null,n,i??!1,!0,!1)?4:0}function Xe(t,e,s,n,i){if(i){if(0!==Rr(e,s))return t?4:2}else if(C(e,s))return 1;return 0!==Ze(t,e,s,null,null,null,n,i??!1,!0,!1)?4:0}function je(t,e,s,i,o,a,l,h,u,c){if(null!=o&&(o.length=0),null!==a&&(a.length=0),null!==i&&(i.length=0),s.isDegenerate(0)){const t=[0,0],n=e.intersectPoint(s.getStartXY(),t,l);if(n>0){if(null!==o)for(let e=0;e<n;e++)o.push(t[e]);if(null!==a)for(let t=0;t<n;t++)a.push(0);if(null!==i)for(let s=0;s<n;s++){const n=new r.P;e.queryCoord2D(t[s],n),i.push(n)}}return n}const m=B(e,s);if(l=Math.max(l,m),e.isDegenerateToLineHelper(m)){const t=new Br({start:e.getStartXY(),end:e.getEndXY()}),n=ot(t,s,i,o,a,l,h,c);if(o)for(let s=0;s<n;++s){const n=t.getCoord2D(o[s]);o[s]=e.getClosestCoordinate(n,!1)}return n}if(Y(e,s,l))return 0;const d=P.constructPoint2D(s.getStartXY()),g=P.constructPoint2D(s.getEndXY()).sub(d),p=g.clone();p.leftPerpendicularThis();const _=P.constructPoint2D(e.m_cp).sub(P.constructPoint2D(e.getStartXY())),f=P.constructPoint2D(e.getEndXY()).sub(P.constructPoint2D(e.m_cp));let y=_.dotProduct(p).toDouble(),x=f.sub(_).dotProduct(p).toDouble();const v=(0,r.d)(12,Number.NaN),b=(0,r.d)(12,Number.NaN);let S=function(t,e,s,n){const i=new r.H,o=Vt(new r.H(t),new r.H(e),s,i);return n[0]=i.value(),o}(x,y,r.E.unit(),v);S<0&&(v[0]=0,v[1]=1,S=2);let E,C=0;for(let n=0,P=C;n<S;++n){const t=e.getCoord2D(v[n+P]);b[C]=s.getClosestCoordinate(t,!1),r.P.distance(t,s.getCoord2D(b[C]))<=l&&(v[C]=v[n+P],C++)}const w=(0,r.m)(r.P,3);e.queryControlPoints(w);{const t=(0,r.m)(P,3);if(Ke(w,t,!1),t[0]=t[0].sub(d),g.x.abs().gte(g.y.abs())){const e=g.y.div(g.x);x=t[2].y.sub(t[2].x.mul(e)).toDouble(),y=t[1].y.sub(t[1].x.mul(e)).toDouble(),E=t[0].y.sub(t[0].x.mul(e)).toDouble()}else{const e=g.x.div(g.y);x=t[2].x.sub(t[2].y.mul(e)).toDouble(),y=t[1].x.sub(t[1].y.mul(e)).toDouble(),E=t[0].x.sub(t[0].y.mul(e)).toDouble()}}const I=e.getEndXY().equals(s.getStartXY())||e.getEndXY().equals(s.getEndXY()),T=[0,0];S=Dt(x,y,E,r.E.unit(),I,T);for(let n=0,P=C;n<S;++n){v[n+P]=T[n];const t=e.getCoord2D(v[n+P]);b[C]=s.getClosestCoordinate(t,!1),r.P.distance(t,s.getCoord2D(b[C]))<=l&&(v[C]=v[n+P],C++)}(0,n.g)(C<v.length+4),S=e.intersectPoint(s.getStartXY(),T,l);for(let n=0;n<S;n++)v[C]=T[n],b[C++]=0;S=e.intersectPoint(s.getEndXY(),T,l);for(let n=0;n<S;n++)v[C]=T[n],b[C++]=1;S=s.intersectPoint(e.getStartXY(),T,l);for(let n=0;n<S;n++)b[C]=T[n],v[C++]=0;S=s.intersectPoint(e.getEndXY(),T,l);for(let n=0;n<S;n++)b[C]=T[n],v[C++]=0;return 0===C?0:Vr(t,e,s,v,b,C,i,o,a,l,h,u,c)}function Ze(t,e,s,n,i,o,l,h,u,c){if(rr(s))return je(t,e,new Br({start:s.getStartXY(),end:s.getEndXY()}),n,i,o,l,h,u,c);const m=B(e,s);if(Y(e,s,l=Math.max(l,m)))return 0;const d=[],g=[],p=(0,r.m)(r.P,3);{e.queryControlPoints(p);const t=(0,r.m)(r.P,3),n=new a.T;s.canonicToWorldTransformation(n);const i=new a.T;i.setInvert(n),i.transformPoints2D(p,3,t);const o=(0,r.m)(P,3);Ke(t,o);const u=[o[0].x,o[1].x,o[2].x],c=[o[0].y,o[1].y,o[2].y],m=(0,r.m)(r.M,3);m[0].setDouble(s.getSemiMinorAxis()),m[0].sqrThis(),m[1].setDouble(s.getSemiMajorAxis()),m[1].sqrThis(),m[2]=m[0],m[2].mul(m[1]),m[2].negate();const _=se(u,2,c,2,null,0,m,!0,r.E.unit(),r.E.unit(),d,h);if(_>0){let t=0;for(let n=0;n<_;n++){const i=new r.P;e.queryCoord2D(d[n],i);const o=s.getClosestCoordinate(i,!1),a=new r.P;s.queryCoord2D(o,a),r.P.distance(i,a)<=l&&(d[t]=d[n],g.push(o),t++)}d.length=t}}const _=[0,1];for(let a=0;a<2;a++){const t=0===a?s.getStartXY():s.getEndXY(),e=[0];Ve(p,t,e);const n=new r.P;Qe(p,e[0],n),r.P.distance(t,n)<=l&&(d.push(e[0]),g.push(_[a]))}for(let a=0;a<2;a++){const t=[0,2];{const e=s.getClosestCoordinate(p[t[a]],!1),n=new r.P;s.queryCoord2D(e,n),r.P.distance(p[t[a]],n)<=l&&(d.push(_[a]),g.push(e))}}return Vr(t,e,s,d,g,d.length,n,i,o,l,h,u,c)}function We(t,e,s,n,i,o,a,l,h,u){const c=(0,r.m)(r.P,3);e.queryControlPoints(c);const m=(0,r.m)(r.P,3);if(s.queryControlPoints(m),U(c,m,3)<0)return We(t,s,e,n,o,i,a,l,h,!u);const d=B(e,s);if(Y(e,s,a=Math.max(a,d)))return 0;if(function(t,e,s,n,i,o,a,l,h){const u=(0,r.m)(r.P,3);t.queryControlPoints(u);const c=(0,r.m)(r.P,3);if(e.queryControlPoints(c),u[0].equals(c[0])){if(u[1].equals(c[1])&&u[2].equals(c[2]))return s&&(s.length=0,s.push(u[0]),s.push(u[2])),n&&(n.length=0,n.push(0),n.push(1)),i&&(i.length=0,i.push(0),i.push(1)),!0;if(!u[0].equals(c[2]))return!1}return!!(u[0].equals(c[2])&&u[1].equals(c[1])&&u[2].equals(c[0]))&&(n&&(n.length=0,n.push(0),n.push(1),h&&(n[1]=(0,r.c)(n[0],n[0]=n[1]))),i&&(i.length=0,i.push(1),i.push(0),h&&(i[1]=(0,r.c)(i[0],i[0]=i[1]))),s&&(s.length=0,s.push(u[0]),s.push(u[2]),h&&(s[1]=(0,r.c)(s[0],s[0]=s[1]))),!0)}(e,s,n,i,o,0,0,0,u))return 2;const g=new r.E(0,1),p=new r.E(0,1);{const t=new _;ze(c,r.E.unit(),t);const e=new _;ze(m,r.E.unit(),e);const s=Math.max(t.maxDim(),e.maxDim());if(t.inflate(3*a),e.inflate(3*a),!t.intersectW(e))return 0;if(t.maxDim()<.1*s){if(Oe(c,t,g),Oe(m,t,p),g.isEmpty()||p.isEmpty())return 0;Ue(c,g.vmin,g.vmax,c),Ue(m,p.vmin,p.vmax,m)}}const f=Or(c,2,m,2,a);if(0===f)return 0;const y=[],x=[];if(-1===f){const t=(0,r.m)(P,3);Ke(c,t);const e=[t[0].x,t[1].x,t[2].x],s=[t[0].y,t[1].y,t[2].y],n=(0,r.m)(P,3);Ke(m,n);const i=ee(e,2,s,2,null,0,[n[0].x,n[1].x,n[2].x],2,[n[0].y,n[1].y,n[2].y],2,null,0,!0,r.E.unit(),r.E.unit(),y,x,u,0,u);if(i>0){let t=0;for(let e=0;e<i;e++){const s=new r.P,n=new r.P;Qe(m,x[e],n),Qe(c,y[e],s),r.P.distance(s,n)<=a&&(y[t]=y[e],x[t]=x[e],t++)}y.length=t,x.length=t}}for(let _=0;_<2;_++){const t=0===_?c:m,e=0===_?m:c;for(let s=0;s<2;s++){const n=0===s?0:2,i=[0];Ve(e,t[n],i);const o=new r.P;Qe(e,i[0],o),r.P.distance(t[n],o)<=a&&(0===_?(y.push(0===n?0:1),x.push(i[0])):(x.push(0===n?0:1),y.push(i[0])))}}if(0===y.length)return 0;if(!g.equalsRange(0,1))for(let r=0;r<y.length;++r)y[r]=Kt.recalculateParentT(g.vmin,g.vmax,y[r]);if(!p.equalsRange(0,1))for(let r=0;r<x.length;++r)x[r]=Kt.recalculateParentT(p.vmin,p.vmax,x[r]);return Vr(t,e,s,y,x,y.length,n,i,o,a,l,h,u)}function $e(t,e,s=!1){const n=t[1].sub(t[0]);e[1].assign(n.mul(2)),e[2].assign(t[2].sub(t[1]).sub(n)),s?e[0].setCoords(0,0):e[0].assign(t[0])}function Ke(t,e,s=!1){const n=P.constructPoint2D(t[1]),i=n.sub(P.constructPoint2D(t[0]));e[1]=i.mul(r.M.constructInt32(2)),e[2]=P.constructPoint2D(t[2]).sub(n).sub(i),e[0]=s?new P(r.ah,r.ah):P.constructPoint2D(t[0])}function Qe(t,e,s,n){if(n){if(e<0)return void Q(new Br({start:t[0],end:t[0].add(Me(t,0).getUnitVector())}),e,s);if(e>1)return void Q(new Br({start:t[2],end:t[2].add(Me(t,1).getUnitVector())}),e-1,s)}if(e<=.5){const n=t[1].clone(),i=new r.P;(0,r.a2)(2,t[0],n,e,i);const o=new r.P;(0,r.a2)(2,n,t[2],e,o);const a=new r.P;(0,r.a2)(2,i,o,e,a),s.assign(a)}else{const n=t[1].clone(),i=new r.P;(0,r.a3)(2,t[0],n,e,i);const o=new r.P;(0,r.a3)(2,n,t[2],e,o);const a=new r.P;(0,r.a3)(2,i,o,e,a),s.assign(a)}}const Je=[[.33998104358485626,.6521451548625461],[.8611363115940526,.34785484513745385]],ts=[[.1834346424956498,.362683783378362],[.525532409916329,.31370664587788727],[.7966664774136267,.22238103445337448],[.9602898564975363,.10122853629037626]],es=[[.09501250983763744,.1894506104550685],[.2816035507792589,.18260341504492358],[.45801677765722737,.16915651939500254],[.6178762444026438,.14959598881657674],[.755404408355003,.12462897125553388],[.8656312023878318,.09515851168249279],[.9445750230732326,.062253523938647894],[.9894009349916499,.027152459411754096]],ss=[[.04830766568773832,.0965400885147278],[.1444719615827965,.09563872007927486],[.23928736225213706,.09384439908080457],[.33186860228212767,.09117387869576389],[.42135127613063533,.08765209300440381],[.5068999089322294,.08331192422694675],[.5877157572407623,.07819389578707031],[.6630442669302152,.0723457941088485],[.7321821187402897,.06582222277636185],[.7944837959679424,.058684093478535544],[.84936761373257,.050998059262376175],[.8963211557660521,.04283589802222668],[.9349060759377397,.03427386291302143],[.9647622555875064,.02539206530926206],[.9856115115452684,.01627439473090567],[.9972638618494816,.007018610009470096]],ns=[[.024350292663424433,.048690957009139724],[.07299312178779904,.04857546744150343],[.12146281929612056,.048344762234802954],[.16964442042399283,.04799938859645831],[.21742364374000708,.04754016571483031],[.2646871622087674,.04696818281621002],[.31132287199021097,.046284796581314416],[.3572201583376681,.04549162792741814],[.4022701579639916,.044590558163756566],[.4463660172534641,.04358372452932345],[.48940314570705296,.04247351512365359],[.5312794640198946,.04126256324262353],[.571895646202634,.03995374113272034],[.6111553551723933,.038550153178615626],[.6489654712546573,.03705512854024005],[.6852363130542333,.035472213256882386],[.7198818501716109,.033805161837141606],[.7528199072605319,.03205792835485155],[.7839723589433414,.030234657072402478],[.8132653151227975,.028339672614259483],[.8406292962525803,.02637746971505466],[.8659993981540928,.024352702568710874],[.8893154459951141,.022270173808383253],[.9105221370785028,.02013482315353021],[.9295691721319396,.017951715775697343],[.9464113748584028,.015726030476024718],[.9610087996520538,.013463047896718643],[.973326827789911,.011168139460131128],[.983336253884626,.008846759826363947],[.9910133714767443,.006504457968978363],[.9963401167719553,.004147033260562468],[.9993050417357722,.001783280721696433]],is=[[.012223698960615764,.024446180196262518],[.03666379096873349,.024431569097850044],[.06108196960413957,.02440235563384958],[.08546364050451549,.024358557264690626],[.10979423112764375,.024300200167971867],[.13405919946118777,.02422731922281525],[.15824404271422493,.024139957989019287],[.18233430598533718,.024038168681024052],[.2063155909020792,.023922012136703457],[.23017356422666,.023791557781003402],[.2538939664226943,.023646883584447616],[.2774626201779044,.02348807601653591],[.3008654388776772,.02331522999406276],[.32408843502441337,.023128448824387027],[.3471177285976355,.022927844143686846],[.369939555349859,.02271353585023646],[.39254027503326744,.022485652032744968],[.414906379552275,.022244328893799764],[.43702450103710416,.02198971066846049],[.4588814198335522,.021721949538052076],[.48046407240417205,.02144120553920846],[.5017595591361445,.02114764646822135],[.5227551520511755,.02084144778075115],[.5434383024128103,.02052279248696007],[.5637966482266181,.020191871042130043],[.5838180216287631,.01984888123283086],[.6034904561585486,.019494028058706602],[.6228021939105849,.019127523609950944],[.6417416925623075,.01874958694054471],[.660297632272646,.01836044393733134],[.6784589224477192,.017960327185008687],[.6962147083695144,.017549475827117706],[.7135543776835874,.01712813542311138],[.7304675667419088,.016696557801589205],[.746944166797062,.016255000909785187],[.7629743300440948,.015803728659399347],[.7785484755064119,.015343010768865144],[.7936572947621933,.014873122602147314],[.8082917575079137,.014394345004166847],[.8224431169556439,.013906964132951985],[.8361029150609068,.013411271288616333],[.8492629875779689,.012907562739267348],[.8619154689395485,.012396139543950923],[.8740527969580318,.01187730737274028],[.8856677173453972,.011351376324080417],[.8967532880491582,.010818660739503076],[.9073028834017568,.010279479015832158],[.9173101980809605,.009734153415006806],[.9267692508789478,.009183009871660874],[.9356743882779164,.00862637779861675],[.9440202878302202,.008064589890486059],[.9518019613412644,.0074979819256347285],[.9590147578536999,.006926892566898814],[.9656543664319652,.006351663161707189],[.9717168187471366,.005772637542865698],[.9771984914639074,.00519016183267633],[.9820961084357185,.004604584256702955],[.9864067427245862,.004016254983738642],[.9901278184917344,.0034255260409102157],[.9932571129002129,.0028327514714579912],[.9957927585349812,.0022382884309626186],[.997733248625514,.0016425030186690294],[.9990774599773758,.0010458126793403489],[.9998248879471319,.00044938096029209035]];function rs(t,e,s,n){const i=.5*(n-s),o=s+i,a=new r.K(0);for(let l=0,h=Math.trunc(t/2);l<h;++l){let s,n;switch(t){case 4:s=Je[l][0],n=Je[l][1];break;case 8:s=ts[l][0],n=ts[l][1];break;case 16:s=es[l][0],n=es[l][1];break;case 32:s=ss[l][0],n=ss[l][1];break;case 64:s=ns[l][0],n=ns[l][1];break;case 128:s=is[l][0],n=is[l][1];break;default:throw new Error("Quadrature_integral: invalid n")}const h=(0,r.am)(-.5,s,o),u=(0,r.am)(i,s,o);a.pe(e(h)*n),a.pe(e(u)*n)}return a.getResult()*i}class os extends St{constructor(t){t?t.vd?(super({vd:t.vd,bPolygon:!0}),this.m_segmentBufferCTor=Yr):t.copy?(super({vd:t.copy.getDescription(),bPolygon:!0}),this.m_segmentBufferCTor=Yr,t.copy.copyTo(this)):t.move?(super({move:t.move}),this.m_segmentBufferCTor=Yr):t.envelope?(0,n.t)("envelope constructor not impl"):(0,n.d)("bad arg to polygon constructor"):(super({bPolygon:!0}),this.m_segmentBufferCTor=Yr)}assignMove(t){return t.copyTo(this),this}assignCopy(t){return t.copyTo(this),this}getBoundary(){return Tt(this)}getExteriorRingCount(){return this.getOGCPolygonCount()}getGeometryType(){return os.type}getDimension(){return 2}createInstance(){return new os({vd:this.getDescription()})}equals(t,e){return this.equalsBase(t,e)}}os.type=n.G.enumPolygon;var as=i.V;const ls=-1;class hs{constructor(t){this.m_shape=t}userSort(t,e,s){this.m_shape.sortVerticesSimpleByYHelper(s,t,e)}getValue(t){return this.m_shape.getY(t)}}class us{constructor(t){!function(t){return void 0!==t.parent}(t)?(this.m_parent=t.copy.m_parent,this.m_geometry=t.copy.m_geometry,this.m_path=t.copy.m_path,this.m_vertex=t.copy.m_vertex,this.m_index=t.copy.m_index,this.m_bSkipMultiPoints=t.copy.m_bSkipMultiPoints,this.m_firstVertex=t.copy.m_firstVertex,this.m_bFirst=!0,this.m_selection=t.copy.m_selection,this.m_bOneGeom=t.copy.m_bOneGeom):(this.m_parent=t.parent,this.m_geometry=t.geometry,this.m_path=t.path,this.m_vertex=t.vertex,this.m_firstVertex=t.firstVertex,this.m_index=t.selection?0:t.index,this.m_bSkipMultiPoints=t.bSkipMultiPoints,this.m_selection=t.selection,this.m_bOneGeom=t.bOneGeom,this.m_bFirst=!0)}moveToNextHelper(){for(this.m_path=this.m_parent.getNextPath(this.m_path),this.m_index=0;this.m_geometry!==ls;){for(;this.m_path!==ls;this.m_path=this.m_parent.getNextPath(this.m_path))if(this.m_vertex=this.m_parent.getFirstVertex(this.m_path),this.m_firstVertex=this.m_vertex,this.m_vertex!==ls)return this.m_vertex;if(this.m_bOneGeom)return ls;if(this.m_geometry=this.m_parent.getNextGeometry(this.m_geometry),this.m_geometry===ls)break;this.m_bSkipMultiPoints&&!(0,n.h)(this.m_parent.getGeometryType(this.m_geometry))||(this.m_path=this.m_parent.getFirstPath(this.m_geometry))}return ls}nextSelection(){for(;this.m_index<this.m_parent.m_selectedVertices.length;){const t=this.m_parent.m_selectedVertices[this.m_index++];if(t!==ls&&(this.m_path=this.m_parent.getPathFromVertex(t),!this.m_bOneGeom||this.m_geometry===this.m_parent.getGeometryFromPath(this.m_path)))return this.m_geometry=this.m_parent.getGeometryFromPath(this.m_path),t}return ls}next(){return this.m_selection?this.nextSelection():this.m_bFirst?(this.m_bFirst=!1,this.m_vertex):this.m_vertex!==ls?(this.m_vertex=this.m_parent.getNextVertex(this.m_vertex),this.m_index++,this.m_vertex!==ls&&this.m_vertex!==this.m_firstVertex?this.m_vertex:this.moveToNextHelper()):ls}currentGeometry(){return this.m_geometry}currentPath(){return this.m_path}static create_(t,e,s,n,i,r,o,a,l){return new us({parent:t,geometry:e,path:s,vertex:n,firstVertex:i,index:r,bSkipMultiPoints:o,selection:a,bOneGeom:l})}}class cs{constructor(t){this.parentage=t}equals(t){return this.parentage===t.parentage}}class ms{setPrevPath(t,e){this.m_pathIndexList.setField(t,1,e)}setNextPath(t,e){this.m_pathIndexList.setField(t,2,e)}setPathFlags(t,e){this.m_pathIndexList.setField(t,6,e)}getPathFlags(t){return this.m_pathIndexList.getField(t,6)}setPathGeometry(t,e){this.m_pathIndexList.setField(t,7,e)}getPathIndex(t){return this.m_pathIndexList.getField(t,0)}setNextGeometry(t,e){this.m_geometryIndexList.setField(t,1,e)}setPrevGeometry(t,e){this.m_geometryIndexList.setField(t,0,e)}getGeometryIndex(t){return this.m_geometryIndexList.getField(t,7)}setFirstPath(t,e){this.m_geometryIndexList.setField(t,3,e)}setLastPath(t,e){this.m_geometryIndexList.setField(t,4,e)}newGeometry(t){const e=this.m_geometryIndexList.newElement();return this.m_geometryIndexList.setField(e,2,t),this.m_geometryIndexList.setField(e,5,0),this.m_geometryIndexList.setField(e,6,0),this.m_geometryIndexList.setField(e,7,this.m_geometryIndexList.elementToIndex(e)),e}freeGeometry(t){this.m_geometryIndexList.deleteElement(t)}newPath(t){const e=this.m_pathIndexList.newElement(),s=this.m_pathIndexList.elementToIndex(e);if(this.m_pathIndexList.setField(e,0,s),this.m_pathIndexList.setField(e,3,0),this.m_pathIndexList.setField(e,6,0),this.setPathGeometry(e,t),s>=this.m_pathAreas.length){const t=Math.trunc(s<16?16:3*s/2);this.m_pathAreas.length=t,this.m_pathLengths.length=t}return this.m_pathAreas[s]=0,this.m_pathLengths[s]=0,this.m_pathCount++,e}freePath(t){this.m_pathIndexList.deleteElement(t),this.m_pathCount--}newVertex(t){const e=this.m_vertexIndexList.newElement(),s=t>=0?t:this.m_vertexIndexList.elementToIndex(e);if(this.m_vertexIndexList.setField(e,0,s),t<0){if(s>=this.m_vertices.getPointCount()){const t=Math.trunc(s<16?16:3*s/2);this.m_vertices.reserveRounded(t),this.m_vertices.resizeNoInit(t),null!==this.m_segments&&(this.m_segments.length=t),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0)}this.m_segments&&(this.m_segments[s]=null)}return this.m_pointCount++,e}freeVertex(t){this.unselect(t);const e=this.getVertexIndex(t);this.m_vertexIndexList.deleteElement(t),this.m_pointCount--;for(let s=0,n=this.m_indices.length;s<n;s++){if(s===this.m_selectionIndex)continue;const t=this.m_indices[s];null!==t&&t.size()>e&&t.write(e,-1)}this.m_weights&&this.m_weights.size()>e&&this.m_weights.write(e,1),this.m_ranks&&this.m_ranks.size()>e&&this.m_ranks.write(e,1),this.m_segmentWeights&&this.m_segmentWeights.size()>e&&this.m_segmentWeights.write(e,1),this.m_segmentRanks&&this.m_segmentRanks.size()>e&&this.m_segmentRanks.write(e,1),this.m_segments&&this.setSegmentToIndex(e,null)}insertVertex_(t,e,s,n){this.m_hasForceSetEnvelope=0;const i=e!==ls?this.getPrevVertex(e):this.getLastVertex(t),r=i!==ls?this.getNextVertex(i):ls,o=this.newVertex(null===s?this.m_pointCount:-1),a=this.getVertexIndex(o);null!==s&&this.m_vertices.setPointByValNoCurves(a,s),this.setPathToVertex(o,t),this.setNextVertex(o,r),this.setPrevVertex(o,i),r!==ls&&this.setPrevVertex(r,o),i!==ls&&this.setNextVertex(i,o);const l=this.isClosedPath(t),h=this.getFirstVertex(t);e===ls&&this.setLastVertex(t,o),e===h&&(l&&n&&h!==ls||this.setFirstVertex(t,o)),l&&r===ls&&(this.setNextVertex(o,o),this.setPrevVertex(o,o)),this.setPathSize(t,this.getPathSize(t)+1);const u=this.getGeometryFromPath(t);return this.setGeometryVertexCount(u,this.getPointCount(u)+1),o}getHelperPoint(){return this.m_helperPoint||(this.m_helperPoint=new i.P({vd:this.m_vertices.getDescription()}),this.m_helperPoint.setXYCoords(0,0)),this.m_helperPoint}addMultiPoint(t,e){const s=this.createGeometry(t.getGeometryType(),t.getDescription());return this.appendMultiPoint(s,t,e),s}addPoint_(t,e){const s=this.createGeometry(n.G.enumMultiPoint,t.getDescription());return this.appendPoint(s,t,e),s}appendMultiPath_(t,e){if(e.isEmpty())return;const s=e.getImpl();this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+s.getPointCount()),this.m_verticesMp.addPoints(e,0,s.getPointCount()),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);const n=null!==this.m_segments||null!==s.getSegmentFlagsStreamRef();this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+s.getPointCount()),this.m_pathIndexList.setCapacity(this.m_pathIndexList.size()+s.getPathCount());for(let i=0,r=s.getPathCount();i<r;i++){if(0===s.getPathSize(i))continue;const e=this.insertPath(t,ls);this.setClosedPath(e,s.isClosedPath(i));for(let t=s.getPathStart(i),r=s.getPathEnd(i);t<r;t++){const i=this.insertVertex_(e,ls,null,!1);if(n){const e=this.getVertexIndex(i);if(1&s.getSegmentFlags(t))this.setSegmentToIndex(e,null);else{const n=new Yr;s.querySegment(t,n,!0),this.setSegmentToIndex(e,n.releaseSegment())}}}s.isStrongPathStart(i)&&this.setStrongPathStart(e,!0),s.isStrongPathEnd(i)&&this.setStrongPathEnd(e,!0)}}addMultiPath(t,e){const s=this.createGeometry(t.getGeometryType(),t.getDescription());return t.getGeometryType()===n.G.enumPolygon&&this.setFillRule(s,t.getFillRule()),this.appendMultiPath(s,t,e),s}appendMultiPathPolyline(t,e,s){const n=e.getImpl(),i=null!==this.m_segments||null!==n.getSegmentFlagsStreamRef(),r=new o.Envelope2D;e.queryEnvelope(r);{const r=s.clone();let o=n.getPointCount();const a=n.getAccelerators();if(a&&a.getQuadTree()&&(o=a.getQuadTree().getIntersectionCount(r,0,n.getPointCount()+1)),o<e.getPointCount()){if(0===o)return;const s=n.queryLimitedSegmentIterator(r);let a=-1,l=-100,h=-1,u=0,c=-1,m=ls,d=!1,g=s.nextSegment();if(null!==g)for(;;g=s.nextSegment()){let r=null===g;const o=null!==g?s.getPathIndex():a,p=null!==g?s.getStartPointIndex():l;if(r||(a===o&&l+1===p?u++:r=!0),r){if(-1!==c){let t=-1,s=-1;if(u===h){this.setClosedPath(m,d);const i=n.getPathEnd(a);this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+i-c),this.m_verticesMp.addPoints(e,c,i),s=n.getPathSize(a),t=i-1}else if(!d||l+1<n.getPathEnd(a))this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+l+2-c),this.m_verticesMp.addPoints(e,c,l+2),s=l-c+2,t=l;else{this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+l+2-c),this.m_verticesMp?.addPoints(e,c,l+1),t=l,s=l-c+1;const i=n.getPathStart(a);this.m_verticesMp.addPoints(e,i,i+1),s+=1}this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);for(let e=0,r=c;e<s;e++,r++){const e=this.insertVertex_(m,ls,null,!1);if(i){const s=this.getVertexIndex(e);if(1&n.getSegmentFlags(r)||r>t)this.setSegmentToIndex(s,null);else{const t=new Yr;n.getSegmentBuffer(r,t,!0),this.setSegmentToIndex(s,t.releaseSegment())}}}}if(null===g)break;u=1,c=p,a!==o?(m=this.insertPath(t,ls),this.setClosedPath(m,!1),h=n.getSegmentCountPath(o),d=n.isClosedPath(o),a=o):m=this.insertPath(t,ls)}l=p}return}}this.appendMultiPath_(t,e)}appendMultiPathPolygon(t,e,s){const i=e.getImpl(),a=null!==this.m_segments||null!==i.getSegmentFlagsStreamRef(),l=o.Envelope2D.constructEmpty();e.queryEnvelope(l),(0,n.g)(s.isIntersecting(l)&&!s.containsEnvelope(l));let h=o.Envelope2D.construct(Number.NEGATIVE_INFINITY,s.ymin,Number.POSITIVE_INFINITY,s.ymax),u=o.Envelope2D.construct(s.xmin,Number.NEGATIVE_INFINITY,s.xmax,Number.POSITIVE_INFINITY);const c=i.getAccelerators();if(c&&c.getQuadTree()){const t=c.getQuadTree(),e=t.getIntersectionCount(h,0,0);e>t.getIntersectionCount(u,0,e+1)&&(u=(0,r.c)(h,h=u))}else h.height()>u.width()&&(u=(0,r.c)(h,h=u));const m=[],d=i.queryLimitedSegmentIterator(h);let g=-1,p=-100,_=-1,f=0,y=-1,x=-1,v=ls,b=!0,P=d.nextSegment();if(null!==P)for(;;P=d.nextSegment()){let s=null===P;const l=null!==P?d.getPathIndex():g,h=null!==P?d.getStartPointIndex():p;if(s||(l===g?p+1===h?f++:s=!0:(s=g>=0,g<0&&(g=l,_=i.getSegmentCountPath(g),y=h,v=ls,f=1))),s){if(0!==m.length||_!==f){0!==m.length&&m[0].first===y||(this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.addPoints(e,y,y+1),-1===x&&(x=y),v===ls&&(v=this.insertPath(t,ls),this.setClosedPath(v,!0)),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.insertVertex_(v,ls,null,!1));for(const{first:s,second:r}of m){-1===x&&(x=s);let o=-1,l=-1;const h=s+r-1;if(r===_){const t=h+1;l=t-s,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+l),this.m_verticesMp.addPoints(e,s,t),o=h,(0,n.g)(1===m.length)}else if(h+1<i.getPathEnd(g)){const t=h+2;l=t-s,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+l),this.m_verticesMp.addPoints(e,s,t),o=h}else{const t=i.getPathStart(g),n=t!==x?1:0,r=h+1;l=r-s+n,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+(r-s)+n),this.m_verticesMp.addPoints(e,s,r),o=h,n>0&&this.m_verticesMp?.addPoints(e,t,t+1)}this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),v===ls&&(v=this.insertPath(t,ls),this.setClosedPath(v,!0));for(let t=0,e=s;t<l;t++,e++){const t=this.insertVertex_(v,ls,null,!1);if(a){const s=this.getVertexIndex(t);if(1&i.getSegmentFlags(e)||e>o)this.setSegmentToIndex(s,null);else{const t=new Yr;i.getSegmentBuffer(e,t,!0),this.setSegmentToIndex(s,t.releaseSegment())}}}}if(0===m.length||m.at(-1).first+m.at(-1).second!==y+f){let t=y+f;t===e.getPathEnd(g)&&(t=e.getPathStart(g)),x!==t&&(this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.addPoints(e,t,t+1),this.insertVertex_(v,ls,null,!1))}}m.length=0,b=!0,l!==g&&(g=l,_=i.getSegmentCountPath(g),v=ls,x=-1),y=h,f=1}if(!P)break;{const t=o.Envelope2D.constructEmpty();P.queryLooseEnvelope(t),u.isIntersecting(t)?(b?m.push((0,r.k)(h,1)):m.at(-1).second++,b=!1):b=!0}p=h}}appendMultiPath(t,e,s){if(void 0===s)return void this.appendMultiPath_(t,e);if(e.isEmpty())return;const i=e.getGeometryType()===n.G.enumPolygon,r=o.Envelope2D.constructEmpty();e.queryEnvelope(r),s.isIntersecting(r)&&(!s.containsEnvelope(r)&&e.getPointCount()>10?i?this.appendMultiPathPolygon(t,e,s):this.appendMultiPathPolyline(t,e,s):this.appendMultiPath_(t,e))}appendPoint(t,e,s){if(e.isEmpty())return;if(void 0!==s&&!s.contains(e.getXY()))return;this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.add(e),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+1);const n=this.insertPath(t,ls);this.insertVertex_(n,ls,null,!1)}appendMultiPoint_(t,e){this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+e.getPointCount()),this.m_verticesMp.addPoints(e,0,e.getPointCount()),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+e.getPointCount());const s=this.insertPath(t,ls);for(let n=0,i=e.getPointCount();n<i;n++)this.insertVertex_(s,ls,null,!1)}appendMultiPoint(t,e,s){if(void 0===s)return void this.appendMultiPoint_(t,e);const n=e.getAttributeStreamRef(0);let i=0;for(let h=0,u=e.getPointCount();h<u;h++){const t=n.readPoint2D(2*h);s.contains(t)&&i++}this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+i);let r=-1,o=-1,a=0;for(let h=0,u=e.getPointCount();h<u;h++){const t=n.readPoint2D(2*h);s.contains(t)?(-1===r&&(r=h,o=h),o++):r>=0&&(this.m_verticesMp.addPoints(e,r,o-r),r=-1,a++)}if(r>0&&(this.m_verticesMp.addPoints(e,r,o-r),a++),!a)return;this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+i);const l=this.insertPath(t,ls);for(let h=0,u=e.getPointCount();h<u;h++){const t=n.readPoint2D(2*h);s.contains(t)&&this.insertVertex_(l,ls,null,!1)}}splitSegmentForward(t,e,s,i,r){const o=this.getNextVertex(t);o===ls&&(0,n.a)("Edit_shape.split_segment_forward_");const a=this.getHelperPoint(),l=this.getPathFromVertex(t);let h=t;const u=this.hasSegmentParentage();for(let c=0,m=e.getResultSegmentCount(s);c<m;c++){const t=this.getVertexIndex(h),i=this.getNextVertex(h),d=e.getResultSegment(s,c);let g=null;if(d.getGeometryType()!==n.G.enumLine&&(g=d.clone(),g.dropAllAttributes()),0===c&&(d.queryStart(a),this.setSegmentToIndex(t,null),this.setPointEx(h,a,e.getResultSegmentStartPointRank(s,c),e.getResultSegmentStartPointWeight(s,c),r)),this.setSegmentRank(h,e.getResultSegmentInteriorRank(s,c)),this.setSegmentWeight(h,e.getResultSegmentInteriorWeight(s,c)),u){const t=e.getResultSegmentSegmentParentage(s,c),n=e.getResultSegmentStartPointIsBreak(s,c);this.setSegmentParentageAndBreak(h,t,n)}if(d.queryEnd(a),c<m-1){this.setSegmentToIndex(t,g);const n=this.insertVertex(l,i,a);this.setWeight(n,e.getResultSegmentEndPointWeight(s,c)),this.setRank(n,e.getResultSegmentEndPointRank(s,c)),this.select(n),h=n}else{this.setPointEx(o,a,e.getResultSegmentEndPointRank(s,c),e.getResultSegmentEndPointWeight(s,c),r);const n=e.getResultSegmentEndPointIsBreak(s,c);this.setSegmentParentageBreakVertex(o,n),this.setSegmentToIndex(t,g)}}}splitSegmentBackward(t,e,s,i,r){const o=this.getNextVertex(t);o===ls&&(0,n.a)("Edit_shape.split_segment_backward_");const a=this.getHelperPoint(),l=this.getPathFromVertex(t);let h=t;const u=this.hasSegmentParentage();for(let c=0,m=e.getResultSegmentCount(s);c<m;c++){const t=m-c-1,i=this.getVertexIndex(h),d=this.getNextVertex(h),g=e.getResultSegment(s,t);let p=null;if(g.getGeometryType()!==n.G.enumLine&&(p=g.clone(),p.reverse(),p.dropAllAttributes()),0===c&&(g.queryEnd(a),this.setSegmentToIndex(i,null),this.setPointEx(h,a,e.getResultSegmentEndPointRank(s,t),e.getResultSegmentEndPointWeight(s,t),r),this.setSegmentParentageAndBreak(h,e.getResultSegmentSegmentParentage(s,t),e.getResultSegmentEndPointIsBreak(s,t))),g.getGeometryType()===n.G.enumLine?this.setSegmentToIndex(i,null):this.setSegmentToIndex(i,p),this.setSegmentRank(h,e.getResultSegmentInteriorRank(s,t)),this.setSegmentWeight(h,e.getResultSegmentInteriorWeight(s,t)),g.queryStart(a),c<m-1){const n=this.insertVertex(l,d,a);this.setWeight(n,e.getResultSegmentStartPointWeight(s,t)),this.setRank(n,e.getResultSegmentStartPointRank(s,t)),this.select(n),h=n,u&&this.setSegmentParentageAndBreak(n,e.getResultSegmentSegmentParentage(s,t),e.getResultSegmentEndPointIsBreak(s,t))}else this.setPointEx(o,a,e.getResultSegmentStartPointRank(s,t),e.getResultSegmentStartPointWeight(s,t),r)}}selected_(t){return this.getUserIndex(t,this.m_selectionIndex)>=0}allocateIndex(t=!0){if(this.m_deletedIndices.length){const e=this.m_deletedIndices.pop();return t&&e.setRange(-1,0,e.size()),e}return t?(0,i.y)(0,-1):(0,i.y)(0)}recycleUserIndex(t){this.m_deletedIndices.push(t)}allocatePathIndex(){if(this.m_deletedPathIndices.length){const t=this.m_deletedPathIndices.at(-1);return this.m_deletedPathIndices.pop(),t}return(0,i.y)(0)}recyclePathUserIndex(t){this.m_deletedPathIndices.push(t)}peelALoop_(t,e,s){const n=this.getNextVertex(t),i=this.getNextVertex(e),o=this.getVertexIndex(t),a=this.getVertexIndex(e);if(this.setNextVertex(t,i),this.setPrevVertex(i,t),this.setNextVertex(e,n),this.setPrevVertex(n,e),this.m_segments){const t=this.getSegmentFromIndex(o),e=this.getSegmentFromIndex(a);this.setSegmentToIndex(a,null),this.setSegmentToIndex(o,e),this.setSegmentToIndex(a,t)}if(this.hasSegmentParentage()){let s=this.getSegmentParentage(e),n=this.getSegmentParentage(t);-1===s&&-1===n||(n=(0,r.c)(s,s=n),this.setSegmentParentageAndBreak(t,n),this.setSegmentParentageAndBreak(e,s))}if(s){const e=this.getPathFromVertex(t),s=this.getGeometryFromPath(e),r=[!1],o=this.insertClosedPath(s,ls,n,this.getFirstVertex(e),r);r[0]&&this.setFirstVertex(e,i);let a=this.getPathSize(e);return a-=this.getPathSize(o),this.setPathSize(e,a),o}return ls}sortVerticesSimpleByYHelper(t,e,s){t.sort(e,s,((t,e)=>{let s=this.compareVerticesSimpleY(t,e);if(0===s){const n=this.getPathInternalIndexFromVertex(t),i=this.getPathInternalIndexFromVertex(e);s=n<i?-1:n>i?1:0}return s}))}sortVerticesSimpleByYHelper3D(t,e,s){(0,n.g)(0)}constructor(){this.m_verticesMp=null,this.m_vertices=null,this.m_xyStream=null,this.m_vertexDescription=null,this.m_segments=null,this.m_weights=null,this.m_ranks=null,this.m_segmentWeights=null,this.m_segmentRanks=null,this.m_indices=[],this.m_deletedIndices=[],this.m_pathAreas=[],this.m_pathLengths=[],this.m_pathindices=[],this.m_deletedPathIndices=[],this.m_geometryIndices=[],this.m_selectedVertices=[],this.m_helperPoint=null,this.m_forceSetEnvelope=i.n.constructEmpty(),this.m_hasForceSetEnvelope=0,this.m_workPoint2D=r.P.getNAN(),this.m_workPoint2_2D=r.P.getNAN(),this.m_curveStitcher=null,this.m_pathCount=0,this.m_pointCount=0,this.m_firstGeometry=ls,this.m_lastGeometry=ls,this.m_vertexIndexList=new i.S(5),this.m_pathIndexList=new i.S(8),this.m_geometryIndexList=new i.S(8),this.m_bHasAttributes=!1,this.m_selectedCount=0,this.m_selectionIndex=-1,this.m_selection=!1,this.m_bucketSort=new i.B,this.m_segmentParentageIndex=-1}getTotalPointCount(){return this.m_pointCount}getEnvelope2D(t){if(0!==this.m_hasForceSetEnvelope)return new o.Envelope2D(this.m_forceSetEnvelope.xmin,this.m_forceSetEnvelope.ymin,this.m_forceSetEnvelope.xmax,this.m_forceSetEnvelope.ymax);const e=this.hasCurves(),s=o.Envelope2D.constructEmpty(),n=this.queryVertexIterator();let i=!0;for(let r=n.next();r!==ls;r=n.next()){if(i?s.merge(this.getXY(r)):s.mergeNe(this.getXY(r)),e){const t=this.getSegment(r);if(null!==t){const e=o.Envelope2D.constructEmpty();t.queryLooseEnvelope(e),s.mergeEnvelope2D(e)}}i=!1}return s}getEnvelope3D(t){return(0,n.g)(0),i.n.constructEmpty()}forceSetEnvelope2D(t){this.m_hasForceSetEnvelope=1,this.m_forceSetEnvelope.setCoords(t.xmin,t.ymin,0,t.xmax,t.ymax,0)}forceSetEnvelope3D(t){(0,n.g)(0)}forgetForceSetEnvelope(){this.m_hasForceSetEnvelope=0}getGeometryCount(){return this.m_geometryIndexList.size()}addGeometry(t,e){const s=t.getGeometryType();if((0,n.h)(s))return this.addMultiPath(t,e);if(s===n.G.enumMultiPoint)return this.addMultiPoint(t,e);if(s===n.G.enumPoint)return this.addPoint_(t,e);if(s===n.G.enumEnvelope){const s=new os;return s.addEnvelope(t,!1),this.addMultiPath(s,e)}(0,n.a)("")}appendGeometry(t,e){this.mergeVertexDescription(e.getDescription());const s=e.getGeometryType();(0,n.h)(s)?this.appendMultiPath(t,e):s!==n.G.enumMultiPoint?(0,n.a)(""):this.appendMultiPoint(t,e)}assignRankToGeometryVertices(t,e){e<1&&(e=1);const s=this.queryVertexIterator();for(let n=s.next();n!==ls;n=s.next())this.setRank(n,e),this.setSegmentRank(n,e)}collapseAllGeometriesToFirst(){this.collapseGeometriesToFirst(n.G.enumUnknown)}collapseGeometriesToFirst(t){this.dbgVerifyVertexCounts();let e=ls,s=-1,i=-1;for(let r=this.getFirstGeometry();r!==ls;)if(t!==n.G.enumUnknown&&this.getGeometryType(r)!==t)r=this.getNextGeometry(r);else{if(e===ls){e=r,s=this.getPathCount(e),i=this.getPointCount(e),r=this.getNextGeometry(r);continue}for(let s=this.getFirstPath(r);s!==ls;s=this.getNextPath(s))this.setPathGeometry(s,e);s+=this.getPathCount(r),i+=this.getPointCount(r);const t=this.getLastPath(e),n=this.getFirstPath(r);t!==ls?this.setNextPath(t,n):this.setFirstPath(e,n),n!==ls&&(this.setPrevPath(n,t),this.setLastPath(e,this.getLastPath(r))),this.setFirstPath(r,ls),this.setLastPath(r,ls);const o=r;r=this.getNextGeometry(r),this.setGeometryVertexCount(o,0),this.removeGeometry(o)}return e!==ls&&(this.setGeometryVertexCount(e,i),this.setGeometryPathCount(e,s),this.dbgVerifyVertexCounts()),e}setFillRule(t,e){let s=this.m_geometryIndexList.getField(t,2);s&=-134217729,s|=1===e?134217728:0,this.m_geometryIndexList.setField(t,2,s)}getFillRule(t){return 134217728&this.m_geometryIndexList.getField(t,2)?1:0}setGeometryModified(t,e){let s=this.m_geometryIndexList.getField(t,2);!!(67108864&s)!==e&&(s&=-67108865,s|=e?67108864:0,this.m_geometryIndexList.setField(t,2,s))}getGeometryModified(t){return!!(67108864&this.m_geometryIndexList.getField(t,2))}setGeometryModifiedWithVertex(t,e){const s=this.getPathFromVertex(t),n=this.getGeometryFromPath(s);this.setGeometryModified(n,e)}getGeometryModifiedWithVertex(t){const e=this.getPathFromVertex(t),s=this.getGeometryFromPath(e);return this.getGeometryModified(s)}swapGeometry(t,e){const s=this.getFirstPath(t),n=this.getFirstPath(e),i=this.getLastPath(t),r=this.getLastPath(e);for(let m=this.getFirstPath(t);m!==ls;m=this.getNextPath(m))this.setPathGeometry(m,e);for(let m=this.getFirstPath(e);m!==ls;m=this.getNextPath(m))this.setPathGeometry(m,t);this.setFirstPath(t,n),this.setFirstPath(e,s),this.setLastPath(t,r),this.setLastPath(e,i);const o=this.getPointCount(t),a=this.getPathCount(t),l=this.getPointCount(e),h=this.getPathCount(e);this.setGeometryVertexCount(t,l),this.setGeometryVertexCount(e,o),this.setGeometryPathCount(t,h),this.setGeometryPathCount(e,a);const u=this.m_geometryIndexList.getField(t,2),c=this.m_geometryIndexList.getField(e,2);this.m_geometryIndexList.setField(t,2,c),this.m_geometryIndexList.setField(e,2,u)}addPathFromMultiPath(t,e,s){const i=this.createGeometry(s?n.G.enumPolygon:n.G.enumPolyline,t.getDescription()),r=t.getImpl();if(t.getPathSize(e)<2)return i;this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+t.getPathSize(e)),this.m_verticesMp.addPoints(t,t.getPathStart(e),r.getPathEnd(e)),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);const o=this.insertPath(i,ls);this.setClosedPath(o,r.isClosedPath(e)||s);const a=null!==this.m_segments||null!==r.getSegmentFlagsStreamRef();for(let n=r.getPathStart(e),l=r.getPathEnd(e);n<l;n++){const t=this.insertVertex_(o,ls,null,!1);if(a){const e=this.getVertexIndex(t);if(1&r.getSegmentFlags(n))this.setSegmentToIndex(e,null);else{const t=new Yr;r.querySegment(n,t,!0),this.setSegmentToIndex(e,t.releaseSegment())}}}return r.isStrongPathStart(e)&&this.setStrongPathStart(o,!0),r.isStrongPathEnd(e)&&this.setStrongPathEnd(o,!0),i}getGeometry(t){const e=this.getGeometryType(t),s=function(t,e){let s,r=e,o=null;switch(r||(o=(0,n.j)(t)?(0,i.w)():(0,i.j)(),r=o),t){case n.G.enumPoint:s=new i.P({vd:r});break;case n.G.enumLine:s=new Br({vd:r});break;case n.G.enumBezier:s=new In({vd:r});break;case n.G.enumEllipticArc:s=new Ri({vd:r});break;case n.G.enumRationalBezier2:s=new Wt({vd:r});break;case n.G.enumBezier2:s=new Kt({vd:r});break;case n.G.enumEnvelope:s=new i.E({vd:r});break;case n.G.enumMultiPoint:s=new p({vd:r});break;case n.G.enumPolyline:s=new Ct({vd:r});break;case n.G.enumPolygon:s=new os({vd:r});break;case n.G.enumMultipatch:(0,n.t)("multipatch not impl");break;case n.G.enumGeometryCollection:s=new Z({vd:r});break;default:(0,n.a)("Geometry.create")}return s}(e,this.m_verticesMp.getDescription()),r=this.getPointCount(t);if(0===r)return s;if((0,n.h)(e)){const e=s.getImpl(),n=this.getPathCount(t),o=(0,i.y)(n+1),a=(0,i.z)(n+1,0),l=s.getDescription(),h=this.hasCurves();for(let s=0,u=l.getAttributeCount();s<u;s++){const h=l.getSemantics(s),u=as.getComponentCount(h),c=(0,i.t)(h,r),m=this.m_vertices.getAttributeStreamRef(h);let d=0,g=0,p=0;for(let e=this.getFirstPath(t);e!==ls;e=this.getNextPath(e)){let t=0;this.isClosedPath(e)&&(t|=1),this.isExterior(e)&&(t|=8),this.isStrongPathStart(e)&&(t|=2),this.isStrongPathEnd(e)&&(t|=4),t&&a.setBits(g,t);const s=this.getPathSize(e);if(o.write(g++,p),p+=s,0===h){const t=m,s=c;let n;for(let i=this.getFirstVertex(e);d<p;i=this.getNextVertex(i),d++){const e=this.getVertexIndex(i);n=t.readPoint2D(2*e),s.writePoint2D(2*d,n)}}else for(let n=this.getFirstVertex(e);d<p;n=this.getNextVertex(n),d++){const t=this.getVertexIndex(n);for(let e=0;e<u;e++){const s=m.readAsDbl(t*u+e);c.writeAsDbl(d*u+e,s)}}}e.setAttributeStreamRef(h,c),o.write(n,r)}if(e.setPathFlagsStreamRef(a),e.setPathStreamRef(o),e.notifyModifiedFlags(65535),h){let s=0,n=0;for(let i=this.getFirstPath(t);i!==ls;i=this.getNextPath(i)){s+=this.getPathSize(i);for(let t=this.getFirstVertex(i);n<s;t=this.getNextVertex(t)){const s=this.getSegment(t);null!==s&&s.isCurve()&&e.replaceSegment(n,s,!0),n++}}}}else if(e===n.G.enumMultiPoint){const e=s.getImpl(),n=s.getDescription();e.reserve(r),e.resizeNoInit(r);for(let s=0,i=n.getAttributeCount();s<i;s++){const i=n.getSemantics(s),r=as.getComponentCount(i),o=e.getAttributeStreamRef(i),a=this.m_vertices.getAttributeStreamRef(i);let l=0;const h=this.getFirstPath(t),u=this.getPathSize(h);for(let t=this.getFirstVertex(h);l<u;t=this.getNextVertex(t),l++){const e=this.getVertexIndex(t);for(let t=0;t<r;t++){const s=a.readAsDbl(e*r+t);o.writeAsDbl(l*r+t,s)}}e.setAttributeStreamRef(i,o)}e.notifyModifiedFlags(65535)}else(0,n.d)("getGeometry");return s}queryPointGeometryOnly(t,e){this.getGeometryType(t)!==n.G.enumMultiPoint&&(0,n.a)("get_point_geometry_only");const s=this.getPointCount(t);if(s>1&&(0,n.a)("get_point_geometry_only"),0===s)return e.assignVertexDescription(this.m_vertexDescription),void e.setEmpty();const i=this.getFirstPath(t),r=this.getFirstVertex(i);this.queryPoint(r,e)}removeGeometry(t){for(let n=this.getFirstPath(t);n!==ls;n=this.removePath(n));const e=this.getPrevGeometry(t),s=this.getNextGeometry(t);return e!==ls?this.setNextGeometry(e,s):this.m_firstGeometry=s,s!==ls?this.setPrevGeometry(s,e):this.m_lastGeometry=e,this.freeGeometry(t),s}createGeometry(t,e){void 0===e&&(e=(0,i.j)());const s=this.newGeometry(t);return this.m_vertices||(this.m_verticesMp=new p({vd:e}),this.m_vertices=this.m_verticesMp.getImpl()),this.mergeVertexDescription(e),this.m_firstGeometry===ls?(this.m_firstGeometry=s,this.m_lastGeometry=s):(this.setPrevGeometry(s,this.m_lastGeometry),this.setNextGeometry(this.m_lastGeometry,s),this.m_lastGeometry=s),s}getFirstGeometry(){return this.m_firstGeometry}getLastGeometry(){return this.m_lastGeometry}getNextGeometry(t){return this.m_geometryIndexList.getField(t,1)}getPrevGeometry(t){return this.m_geometryIndexList.getField(t,0)}getGeometryType(t){return 16777215&this.m_geometryIndexList.getField(t,2)}setGeometryUserIndex(t,e,s){const n=this.m_geometryIndices[e],i=this.getGeometryIndex(t);i>=n.size()&&n.resize(Math.max(1.25*i,16),-1),n.write(i,s)}getGeometryUserIndex(t,e){const s=this.getGeometryIndex(t),n=this.m_geometryIndices[e];return s<n.size()?n.read(s):-1}createGeometryUserIndex(){for(let e=0;e<this.m_geometryIndices.length;e++)if(null===this.m_geometryIndices[e])return this.m_geometryIndices[e]=(0,i.y)(0),e;this.m_geometryIndices.push((0,i.y)(0));const t=this.m_geometryIndices.length-1;return(0,n.g)(t>=0&&t<=Number.MAX_SAFE_INTEGER),t}removeGeometryUserIndex(t){for(this.m_geometryIndices[t]=null;this.m_geometryIndices.length>0&&null===this.m_geometryIndices.at(-1);)this.m_geometryIndices.pop()}getFirstPath(t){return this.m_geometryIndexList.getField(t,3)}getLastPath(t){return this.m_geometryIndexList.getField(t,4)}hasPointFeatures(){for(let t=this.getFirstGeometry();t!==ls;t=this.getNextGeometry(t))if(!(0,n.h)(this.getGeometryType(t)))return!0;return!1}getPointCount(t){return this.m_geometryIndexList.getField(t,5)}getPathCount(t){return this.m_geometryIndexList.getField(t,6)}filterClosePoints(t,e,s,i,o){const a=t*t;let l=0;const h=this.hasCurves(),u=this.hasSegmentParentage(),c=!0;for(let m=o===ls?this.getFirstGeometry():o;m!==ls;m=o===ls?this.getNextGeometry(m):ls){const t=this.getGeometryType(m);if(!(0,n.h)(t))continue;if(s&&t!==n.G.enumPolygon)continue;const o=this.getGeometryType(m)===n.G.enumPolygon;let d=this.getGeometryModified(m);for(let s=this.getFirstPath(m);s!==ls;){let t=0;for(let e=this.getFirstVertex(s);t<Math.trunc(this.getPathSize(s)/2);){const o=this.getNextVertex(e);if(o===ls)break;const g=this.getXY(e),p=this.getXY(o);let _=r.P.sqrDistance(g,p),f=!0;do{if(_<=a){if(h){const t=this.getSegment(e);if(null!==t){const e=t.calculateLength2D();if(_=e*e,_>a)break}}if(0===_?0===l&&(l=-1):l=1,o!==this.getLastVertex(s)){const t=u&&(this.getSegmentParentageBreakVertex(e)||this.getSegmentParentageBreakVertex(o));if(this.transferAllDataToTheVertex(o,e,c),this.removeVertex(o,!1),i&&!d&&(this.setGeometryModified(m,!0),d=!0),u&&e!==o){this.setSegmentParentageBreakVertex(e,t);const s=this.getNextVertex(e);(0,n.g)(s!==ls),this.isDiscontinuousSegmentParentage(s)&&this.setSegmentParentageBreakVertex(s,!0)}}f=!1}}while(0);f&&(e=this.getNextVertex(e)),t++}let g=this.getFirstVertex(s);for(let e=this.isClosedPath(s)?g:this.getLastVertex(s);this.getPathSize(s)>0;){const t=this.getPrevVertex(e);if(t===ls)break;{const o=this.getXY(t),p=this.getXY(e);let _=r.P.sqrDistance(o,p),f=!0;do{if(_<=a){if(h){const e=this.getSegment(t);if(null!==e){const t=e.calculateLength2D();if(_=t*t,_>a)break}}if(0===_?0===l&&(l=-1):l=1,u){(0,n.g)(this.m_segmentParentageIndex>=0);const s=this.getUserIndex(e,this.m_segmentParentageIndex);this.transferAllDataToTheVertex(t,e,c),this.setUserIndex(e,this.m_segmentParentageIndex,s)}else this.transferAllDataToTheVertex(t,e,c);const r=u&&(this.getSegmentParentageBreakVertex(e)||this.getSegmentParentageBreakVertex(t));this.removeVertex(t,!0),i&&!d&&(this.setGeometryModified(m,!0),d=!0),u&&t!==e&&(r||this.isDiscontinuousSegmentParentage(e))&&this.setSegmentParentageBreakVertex(e,!0),g===t&&(g=this.getFirstVertex(s)),f=!1}}while(0);if(f&&(e=this.getPrevVertex(e),e===g))break}}const p=this.getPathSize(s);let _=e&&p<(o?3:2);_&&o&&2===p&&h&&(_=!this.pathHasCurves(s)),_?(s=this.removePath(s),0===l&&(l=-1),i&&!d&&(this.setGeometryModified(m,!0),d=!0)):s=this.getNextPath(s)}}return l}filterClosePoints3D(t,e,s,i,r,o){return(0,n.g)(0),0}hasDegenerateSegments(t){for(let e=this.getFirstGeometry();e!==ls;e=this.getNextGeometry(e))if((0,n.h)(this.getGeometryType(e)))for(let s=this.getFirstPath(e);s!==ls;){const e=this.getPathSize(s);if(0===e)return!0;let n=this.getFirstVertex(s);for(let s=0;s<e;s++){const e=this.getNextVertex(n);if(e===ls)break;const s=this.getVertexIndex(n),i=this.getSegmentFromIndex(s);let r=0;if(null!==i){if(r=i.calculateLowerLength2D(),r<=t){if(r=i.calculateUpperLength2D(),r<=t)return!0;if(r=i.calculateLength2D(),r<=t)return!0}}else{const n=this.getVertexIndex(e);if(r=this.m_vertices.getShortestDistance(s,n),r<=t)return!0}n=e}s=this.getNextPath(s)}return!1}hasDegenerateSegments3D(t,e){return(0,n.g)(0),!1}transferAllDataToTheVertex(t,e,s=!1){const n=this.getVertexIndex(t),i=this.getVertexIndex(e);if(s){let t=1,e=1;if(this.m_ranks&&(t=this.getRankWithIndex(n),e=this.getRankWithIndex(i)),t>e&&this.setRankWithIndex(i,t),t>=e&&this.m_weights){const s=this.getWeightWithIndex(n),r=this.getWeightWithIndex(i);(t>e||s>r)&&this.setWeightWithIndex(i,s)}}else{if(this.m_weights){const t=this.getWeightWithIndex(n);this.setWeightWithIndex(i,t)}if(this.m_ranks){const t=this.getRankWithIndex(n);this.setRankWithIndex(i,t)}}if(this.m_segmentWeights){const t=this.getSegmentWeightWithIndex(n);this.setSegmentWeightWithIndex(i,t)}if(this.m_segmentRanks){const t=this.getSegmentRankWithIndex(n);this.setSegmentRankWithIndex(i,t)}for(let o=0,a=this.m_indices.length;o<a;o++)if(o!==this.m_selectionIndex&&null!==this.m_indices[o]){const s=this.getUserIndex(t,o);this.setUserIndex(e,o,s)}const r=this.selected(t);r!==this.selected(e)&&(r?this.select(e):this.unselect(e))}splitSegmentAxisAware(t,e,s,i,r){let o=0;const a=this.getNextVertex(t);a===ls&&(0,n.a)("");const l=this.getVertexIndex(t),h=this.getVertexIndex(a),u=this.getSegmentFromIndex(l);let c=this.m_vertices.getShortestDistance(l,h);const m=this.getPathFromVertex(t),d=this.m_bHasAttributes;d&&u&&(c=u.calculateLength2D());const g=this.getSegmentParentage(t),p=this.getHelperPoint();if(u){let t=0,n=0,r=ls;for(let _=0;_<s;_++){const s=e[_];if(t<s&&s<1){const e=u.cut(t,s);if(null!==i&&(_>0&&e.setStartXY(i[_-1]),e.setEndXY(i[_]),e.normalizeAfterEndpointChange(),n=_),d){const t=c>0?u.calculateSubLengthFromStart(s)/c:0;this.m_vertices.interpolateTwoVertices(l,h,t,p)}p.setXY(e.getEndXY()),r=this.insertVertex(m,a,p),o++;const f=this.getPrevVertex(r),y=this.getVertexIndex(f);this.setSegmentToIndex(y,e),-1!==g&&this.setSegmentParentageAndBreak(r,g,!1),t=s}}if(r!==ls){const e=u.cut(t,1);null!==i&&(e.setStartXY(i[n]),e.normalizeAfterEndpointChange());const s=this.getVertexIndex(r);this.setSegmentToIndex(s,e)}}else{let t=0;for(let n=0;n<s;n++){const s=e[n];if(t<s&&s<1){this.m_vertices.interpolateTwoVertices(l,h,s,p);const t=this.insertVertex(m,a,p);o++,-1!==g&&this.setSegmentParentageAndBreak(t,g,!1)}t=s}}return o}splitSegment(t,e,s,n=null){return this.splitSegmentAxisAware(t,e,s,n,-1)}snapControlPoints(t,e,s){this.getNextVertex(t)===ls&&(0,n.a)("");let i=t,r=!1;for(let n=0;n<e;++n){const t=this.getVertexIndex(i),e=this.getSegmentFromIndex(t);if(e){const t=e.snapControlPoints(s);r||=t}i=this.getNextVertex(i)}return r}snapControlPointsOnSelection(t){if(!this.hasCurves())return!1;let e=0;const s=this.queryVertexIteratorOnSelection();for(let n=s.next();n!==ls;n=s.next()){const s=this.getVertexIndex(n),i=this.getSegmentFromIndex(s);i&&(e|=i.snapControlPoints(t)?1:0)}return 0!==e}calculateSubLength2D(t,e,s){return(0,n.g)(0),0}setPoint(t,e,s){if(this.setPointOnly(t,e),null!==this.m_segments){const n=this.getVertexIndex(t),i=this.getSegmentFromIndex(n);null!==i&&(i.setStartXY(e.getXY()),i.normalizeAfterEndpointChange(),s&&i.ensureXYMonotone());const r=this.getPrevVertex(t);if(r!==ls){const t=this.getVertexIndex(r),n=this.getSegmentFromIndex(t);null!==n&&(n.setEndXY(e.getXY()),n.normalizeAfterEndpointChange(),s&&n.ensureXYMonotone())}}}setPointEx(t,e,s,n,i){this.setPoint(t,e,i);const r=this.getVertexIndex(t);this.setWeightWithIndex(r,n),this.setRankWithIndex(r,s)}setPointOnly(t,e){const s=this.getVertexIndex(t);this.m_vertices.setPointByValNoCurves(s,e)}setPointOnlyEx(t,e,s,i){(0,n.g)(0)}queryPoint(t,e){const s=this.getVertexIndex(t);this.m_vertices.getPointByVal(s,e)}setXY(t,e){this.setXYCoords(t,e.x,e.y)}setXYCoords(t,e,s){const n=this.getVertexIndex(t);if(this.m_vertices?.setXYCoordsNoCurves(n,e,s),null!==this.m_segments){const i=this.getSegmentFromIndex(n);null!==i&&(i.setStartXYCoords(e,s),i.normalizeAfterEndpointChange());const r=this.getPrevVertex(t);if(r!==ls){const t=this.getVertexIndex(r),n=this.getSegmentFromIndex(t);null!=n&&(n.setEndXYCoords(e,s),n.normalizeAfterEndpointChange())}}}setXYMonotonic(t,e,s){const n=this.getVertexIndex(t);if(this.m_vertices.setXYCoordsNoCurves(n,e,s),null!==this.m_segments){const i=this.getSegmentFromIndex(n);if(null!==i){const t=i.getEndXY();i.setCoordsForIntersector(new r.P(e,s),t,!1),i.ensureXYMonotone()}const o=this.getPrevVertex(t);if(o!==ls){const t=this.getVertexIndex(o),n=this.getSegmentFromIndex(t);if(null!==n){const t=n.getStartXY();n.setCoordsForIntersector(t,new r.P(e,s),!1),n.ensureXYMonotone()}}}}setXYMonotonicPoint2D(t,e){this.setXYMonotonic(t,e.x,e.y)}queryXY(t,e){const s=this.getVertexIndex(t);return this.m_vertices.queryXY(s,e)}getXY(t){const e=this.getVertexIndex(t);return this.m_vertices.getXY(e)}getXYWithIndex(t){return this.m_xyStream.readPoint2D(2*t)}static setSegDefault(t,e,s){(0,n.g)(0)}setXYZ(t,e,s){(0,n.g)(0)}setXYZCoords(t,e,s,i){(0,n.g)(0)}queryXYZ(t,e){(0,n.g)(0)}getXYZ(t){return(0,n.g)(0),i.d.getNAN()}getXYZWithIndex(t){return(0,n.g)(0),i.d.getNAN()}mergeVertexDescription(t){this.m_verticesMp.mergeVertexDescription(t),this.m_vertexDescription=this.m_verticesMp.getDescription(),this.m_bHasAttributes=this.m_vertexDescription.getAttributeCount()>1}addAttribute(t){(0,n.g)(0)}getAttributeAsDbl(t,e,s){return this.m_vertices.getAttributeAsDbl(t,this.getVertexIndex(e),s)}queryAttributeAsDbl(t,e,s,i){(0,n.g)(0)}setAttribute(t,e,s,i){(0,n.g)(0)}setAttributeInt(t,e,s,i){(0,n.g)(0)}getVertexDescription(){return this.m_vertexDescription}getMinPathVertexY(t){return(0,n.g)(0),0}getVertexIndex(t){return this.m_vertexIndexList.getField(t,0)}getY(t){const e=this.getVertexIndex(t);return this.m_vertices.queryXY(e,this.m_workPoint2D),this.m_workPoint2D.y}getX(t){return this.getXY(t).x}isEqualXY(t,e){return this.queryXY(t,this.m_workPoint2D),this.queryXY(e,this.m_workPoint2_2D),this.m_workPoint2D.isEqualPoint2D(this.m_workPoint2_2D)}isEqualXYPoint2D(t,e){return this.queryXY(t,this.m_workPoint2D),this.m_workPoint2D.isEqualPoint2D(e)}isEqualXYZPoint3D(t,e){return(0,n.g)(0),!1}setWeight(t,e){e<1&&(e=1);const s=1===e;if(null==this.m_weights){if(s)return;this.m_weights=(0,i.D)(this.m_vertices.getPointCount(),1)}const n=this.getVertexIndex(t);if(n>=this.m_weights.size()){if(s)return;this.m_weights.resize(n+1,1)}this.m_weights.write(n,e)}setWeightWithIndex(t,e){e<1&&(e=1);const s=1===e;if(null===this.m_weights){if(s)return;this.m_weights=(0,i.D)(this.m_vertices.getPointCount(),1)}if(t>=this.m_weights.size()){if(s)return;this.m_weights.resize(t+1,1)}this.m_weights.write(t,e)}getWeight(t){if(null===this.m_weights)return 1;const e=this.getVertexIndex(t);return e>=this.m_weights.size()?1:this.m_weights.read(e)}getWeightWithIndex(t){return null===this.m_weights||t>=this.m_weights.size()?1:this.m_weights.read(t)}getRank(t){if(null===this.m_ranks)return 1;const e=this.getVertexIndex(t);return e>=this.m_ranks.size()?1:this.m_ranks.read(e)}getRankWithIndex(t){return null===this.m_ranks||t>=this.m_ranks.size()?1:this.m_ranks.read(t)}setRank(t,e){e<1&&(e=1);const s=1===e;if(null===this.m_ranks){if(s)return;this.m_ranks=(0,i.y)(this.m_vertices.getPointCount(),1)}const n=this.getVertexIndex(t);if(n>=this.m_ranks.size()){if(s)return;this.m_ranks.resize(n+1,1)}this.m_ranks.write(n,e)}setRankWithIndex(t,e){e<1&&(e=1);const s=1===e;if(null===this.m_ranks){if(s)return;this.m_ranks=(0,i.y)(this.m_vertices.getPointCount(),1)}if(t>=this.m_ranks.size()){if(s)return;this.m_ranks.resize(t+1,1)}this.m_ranks.write(t,e)}setSegmentWeight(t,e){e<1&&(e=1);const s=1===e;if(null===this.m_segmentWeights){if(s)return;this.m_segmentWeights=(0,i.D)(this.m_vertices.getPointCount(),1)}const n=this.getVertexIndex(t);if(n>=this.m_segmentWeights.size()){if(s)return;this.m_segmentWeights.resize(n+1,1)}this.m_segmentWeights.write(n,e)}setSegmentWeightWithIndex(t,e){e<1&&(e=1);const s=1===e;if(null==this.m_segmentWeights){if(s)return;this.m_segmentWeights=(0,i.D)(this.m_vertices.getPointCount(),1)}if(t>=this.m_segmentWeights.size()){if(s)return;this.m_segmentWeights.resize(t+1,1)}this.m_segmentWeights.write(t,e)}getSegmentWeight(t){if(null===this.m_segmentWeights)return 1;const e=this.getVertexIndex(t);return e>=this.m_segmentWeights.size()?1:this.m_segmentWeights.read(e)}getSegmentWeightWithIndex(t){return null==this.m_segmentWeights||t>=this.m_segmentWeights.size()?1:this.m_segmentWeights.read(t)}getSegmentRank(t){if(null===this.m_segmentRanks)return ms.st_defaultRank;const e=this.getVertexIndex(t);return e>=this.m_segmentRanks.size()?ms.st_defaultRank:this.m_segmentRanks.read(e)}getSegmentRankWithIndex(t){return null===this.m_segmentRanks||t>=this.m_segmentRanks.size()?1:this.m_segmentRanks.read(t)}setSegmentRank(t,e){e<1&&(e=1);const s=1===e;if(null===this.m_segmentRanks){if(s)return;this.m_segmentRanks=(0,i.y)(this.m_vertices.getPointCount(),1)}const n=this.getVertexIndex(t);if(n>=this.m_segmentRanks.size()){if(s)return;this.m_segmentRanks.resize(n+1,1)}this.m_segmentRanks.write(n,e)}setSegmentRankWithIndex(t,e){e<1&&(e=1);const s=1===e;if(null===this.m_segmentRanks){if(s)return;this.m_segmentRanks=(0,i.y)(this.m_vertices.getPointCount(),1)}if(t>=this.m_segmentRanks.size()){if(s)return;this.m_segmentRanks.resize(t+1,1)}this.m_segmentRanks.write(t,e)}removeWeights(){this.m_weights=null,this.m_segmentWeights=null}removeRanks(){this.m_ranks=null,this.m_segmentRanks=null}setUserIndex(t,e,s){const n=this.m_indices[e],i=this.getVertexIndex(t);if(n.size()<=i){if(-1===s)return;n.resize(this.m_vertices.getPointCount(),-1)}n.write(i,s)}getUserIndex(t,e){const s=this.getVertexIndex(t),n=this.m_indices[e];return s<n.size()?n.read(s):-1}addToUserIndex(t,e,s){const n=this.m_indices[e],i=this.getVertexIndex(t);n.size()<=i&&n.resize(this.m_vertices.getPointCount(),-1);const r=n.read(i);n.write(i,r+s)}createUserIndex(){for(let e=0;e<this.m_indices.length;e++)if(null===this.m_indices[e])return this.m_indices[e]=this.allocateIndex(),e;this.m_indices.push(this.allocateIndex());const t=this.m_indices.length-1;return(0,n.g)(t>=0&&t<=(0,r.i)()),t}createUserIndexUninitialized(){for(let e=0;e<this.m_indices.length;e++)if(null===this.m_indices[e])return this.m_indices[e]=this.allocateIndex(!1),e;this.m_indices.push(this.allocateIndex(!1));const t=this.m_indices.length-1;return(0,n.g)(t>=0&&t<=Number.MAX_SAFE_INTEGER),t}fillUserIndexForGeometry(t,e,s){const n=this.m_indices[e],i=n.size();for(let r=this.getFirstPath(t);r!==ls;r=this.getNextPath(r)){let t=this.getFirstVertex(r);for(let e=0,o=this.getPathSize(r);e<o;e++,t=this.getNextVertex(t)){const e=this.getVertexIndex(t);e<i&&n.write(e,s)}}}fillUserIndexForSelection(t,e){(0,n.g)(0)}removeUserIndex(t){for(this.recycleUserIndex(this.m_indices[t]),this.m_indices[t]=null;this.m_indices.length>0&&null===this.m_indices[this.m_indices.length-1];)this.m_indices.pop()}replaceCurveWithLine(t){if(null!==this.m_segments){const e=this.getVertexIndex(t);this.setSegmentToIndex(e,null)}}queryLineConnector(t,e,s=!1){const n=this.getNextVertex(t);if(n===ls)return!1;if(!this.m_bHasAttributes||s){const s=this.getXY(t);e.setStartXY(s);const i=this.getXY(n);e.setEndXY(i)}else{const s=new i.P({vd:this.getVertexDescription()});this.queryPoint(t,s),e.setStart(s),this.queryPoint(n,s),e.setEnd(s)}return!0}queryLineConnector3D(t,e,s=!1){return(0,n.g)(0),!1}hasCurves(){return null!==this.m_segments}geometryHasCurves(t){return(0,n.g)(0),!1}pathHasCurves(t){if(!this.hasCurves())return!1;const e=this.getFirstVertex(t);if(e===ls)return!1;const s=this.getPathSize(t);let i=e;for(let r=0;r<s;r++,i=this.getNextVertex(i)){const t=this.getSegment(i);if(null!==t&&t.getGeometryType()!==n.G.enumLine)return!0}return!1}insertPath(t,e){let s=ls;e!==ls?(t!==this.getGeometryFromPath(e)&&(0,n.a)(""),s=this.getPrevPath(e)):s=this.getLastPath(t);const i=this.newPath(t);return e!==ls&&this.setPrevPath(e,i),this.setNextPath(i,e),this.setPrevPath(i,s),s!==ls?this.setNextPath(s,i):this.setFirstPath(t,i),e===ls&&this.setLastPath(t,i),this.setGeometryPathCount(t,this.getPathCount(t)+1),i}removePath(t){const e=this.getPrevPath(t),s=this.getNextPath(t),n=this.getGeometryFromPath(t);return e!==ls?this.setNextPath(e,s):this.setFirstPath(n,s),s!==ls?this.setPrevPath(s,e):this.setLastPath(n,e),this.clearPath(t),this.setGeometryPathCount(n,this.getPathCount(n)-1),this.freePath(t),s}clearPath(t){const e=this.getFirstVertex(t);if(e!==ls){let s=e;for(let e=0,i=this.getPathSize(t);e<i;e++){const t=s;s=this.getNextVertex(s),this.freeVertex(t)}const n=this.getGeometryFromPath(t);this.setGeometryVertexCount(n,this.getPointCount(n)-this.getPathSize(t))}this.setPathSize(t,0)}getNextPath(t){return this.m_pathIndexList.getField(t,2)}getPrevPath(t){return this.m_pathIndexList.getField(t,1)}getPathSize(t){return this.m_pathIndexList.getField(t,3)}isClosedPath(t){return!!(1&this.getPathFlags(t))}setClosedPath(t,e){if(this.isClosedPath(t)===e)return;if(this.getPathSize(t)>0){const s=this.getFirstVertex(t),n=this.getLastVertex(t);if(e){this.setNextVertex(n,s),this.setPrevVertex(s,n);const t=this.getVertexIndex(n);this.setSegmentToIndex(t,null)}else{this.setNextVertex(n,ls),this.setPrevVertex(s,ls);const t=this.getVertexIndex(n);this.setSegmentToIndex(t,null)}}const s=(1|this.getPathFlags(t))-1;this.setPathFlags(t,s|(e?1:0))}closeAllPaths(t){(0,n.g)(0)}isStrongPathStart(t){return!!(8&this.getPathFlags(t))}isStrongPathEnd(t){return!!(16&this.getPathFlags(t))}setStrongPathStart(t,e){const s=(8|this.getPathFlags(t))-8;this.setPathFlags(t,s|(e?8:0))}setStrongPathEnd(t,e){const s=(16|this.getPathFlags(t))-16;this.setPathFlags(t,s|(e?16:0))}getGeometryFromPath(t){return this.m_pathIndexList.getField(t,7)}isExterior(t){return!!(2&this.getPathFlags(t))}setExterior(t,e){const s=(2|this.getPathFlags(t))-2;this.setPathFlags(t,s|(e?2:0))}getRingArea(t){if(this.isRingAreaValid(t))return this.m_pathAreas[this.getPathIndex(t)];const e=this.getFirstVertex(t);if(e===ls)return 0;const s=this.getXY(e),i=new r.K(0),o=this.getPathSize(t);if(o>2){const t=s.clone(),n=t.x,a=t.y;let l=this.getNextVertex(e);const h=this.getXY(l);l=this.getNextVertex(l);const u=r.P.getNAN();for(let e=2;e<o;e++,l=this.getNextVertex(l))this.queryXY(l,u),i.pe((u.x-t.x)*(h.y-a)),t.setCoordsPoint2D(h),h.setCoordsPoint2D(u);i.pe((n-t.x)*(h.y-a))}if(this.hasCurves()){let t=e;for(let e=0;e<o;e++,t=this.getNextVertex(t)){const e=this.getSegment(t);if(null===e||e.getGeometryType()===n.G.enumLine)continue;const s=2*e.calculateArea2DHelper();i.pe(s)}}this.setRingAreaValid(t,!0);const a=.5*i.getResult();return this.m_pathAreas[this.getPathIndex(t)]=a,a}getPathIndexInternal(t){return this.getPathIndex(t)}getPathInternalIndexFromVertex(t){return this.getPathIndex(this.getPathFromVertex(t))}setPathUserIndex(t,e,s){const n=this.m_pathindices[e],i=this.getPathIndex(t);n.size()<this.m_pathAreas.length&&n.resize(this.m_pathAreas.length,-1),n.write(i,s)}getPathUserIndex(t,e){const s=this.getPathIndex(t),n=this.m_pathindices[e];return s<n.size()?n.read(s):-1}createPathUserIndex(){for(let e=0;e<this.m_pathindices.length;e++)if(null===this.m_pathindices[e])return this.m_pathindices[e]=this.allocatePathIndex(),e;this.m_pathindices.push(this.allocatePathIndex());const t=this.m_pathindices.length-1;return(0,n.g)(t>=0&&t<=Number.MAX_SAFE_INTEGER),t}fillPathUserIndexForGeometry(t,e,s){const n=this.m_pathindices[e],i=n.size();for(let r=this.getFirstPath(t);r!==ls;r=this.getNextPath(r)){const t=this.getPathIndex(r);t<i&&n.write(t,s)}}removePathUserIndex(t){for(this.recyclePathUserIndex(this.m_pathindices[t]),this.m_pathindices[t]=null;this.m_pathindices.length>0&&null===this.m_pathindices.at(-1);)this.m_pathindices.pop()}movePath(t,e,s){if(s===ls&&(0,n.a)(""),e===s)return;const i=this.getNextPath(s);let r=this.getPrevPath(s);const o=this.getGeometryFromPath(s);r===ls?this.setFirstPath(o,i):this.setNextPath(r,i),i===ls?this.setLastPath(o,r):this.setPrevPath(i,r),this.setGeometryVertexCount(o,this.getPointCount(o)-this.getPathSize(s)),this.setGeometryPathCount(o,this.getPathCount(o)-1),r=e===ls?this.getLastPath(t):this.getPrevPath(e),this.setPrevPath(s,r),this.setNextPath(s,e),e===ls?this.setLastPath(t,s):this.setPrevPath(e,s),r===ls?this.setFirstPath(t,s):this.setNextPath(r,s),this.setGeometryVertexCount(t,this.getPointCount(t)+this.getPathSize(s)),this.setGeometryPathCount(t,this.getPathCount(t)+1),this.setPathGeometry(s,t)}addVertex(t,e){return this.m_vertices.getPointByVal(this.getVertexIndex(e),this.getHelperPoint()),this.insertVertex_(t,ls,this.getHelperPoint(),!1)}insertVertex(t,e,s){return this.insertVertex_(t,e,s,!0)}removeVertex(t,e){const s=this.getPathFromVertex(t),n=this.getPrevVertex(t),i=this.getNextVertex(t);n!==ls&&this.setNextVertex(n,i);const r=this.getPathSize(s);if(t===this.getFirstVertex(s)&&this.setFirstVertex(s,r>1?i:ls),i!==ls&&this.setPrevVertex(i,n),t===this.getLastVertex(s)&&this.setLastVertex(s,r>1?n:ls),this.hasCurves()&&n!==ls&&i!==ls){const s=this.getVertexIndex(t),r=this.getVertexIndex(n),o=this.getVertexIndex(i);if(e){const t=this.getSegmentFromIndex(r);if(null!==t){const e=this.m_vertices.getXY(o);t.setEndXY(e),t.normalizeAfterEndpointChange()}this.setSegmentToIndex(s,null)}else{const t=this.getSegmentFromIndex(s);if(this.setSegmentToIndex(s,null),null!==t){const e=this.m_vertices.getXY(r);t.setStartXY(e),t.normalizeAfterEndpointChange()}this.setSegmentToIndex(r,t)}}this.setPathSize(s,r-1);const o=this.getGeometryFromPath(s);return this.setGeometryVertexCount(o,this.getPointCount(o)-1),this.freeVertex(t),i}removeVertices(t,e){(0,n.g)(t!==e);const s=this.getPathFromVertex(t),i=this.getPrevVertex(t),r=this.getPrevVertex(e);i!==ls&&this.setNextVertex(i,e);let o=this.getPathSize(s);const a=this.getVertexIndex(t);this.setSegmentToIndex(a,null),this.setPrevVertex(e,i),this.setPrevVertex(t,ls),this.setNextVertex(r,ls);let l=0,h=t;const u=this.getFirstVertex(s);let c=!1;for(;;){const t=this.getNextVertex(h);if(c||=u===h,this.freeVertex(h),l++,h===r)break;h=t}o-=l,c&&this.setFirstVertex(s,o>0?e:ls),this.setPathSize(s,o);const m=this.getGeometryFromPath(s);this.setGeometryVertexCount(m,this.getPointCount(m)-l)}getFirstVertex(t){return this.m_pathIndexList.getField(t,4)}getLastVertex(t){return this.m_pathIndexList.getField(t,5)}getNextVertex(t){return this.m_vertexIndexList.getField(t,2)}getPrevVertex(t){return this.m_vertexIndexList.getField(t,1)}getNextVertexEx(t,e){return e>0?this.m_vertexIndexList.getField(t,2):this.m_vertexIndexList.getField(t,1)}getPrevVertexEx(t,e){return e>0?this.m_vertexIndexList.getField(t,1):this.m_vertexIndexList.getField(t,2)}getPathFromVertex(t){return this.m_vertexIndexList.getField(t,3)}addPoint(t,e){return this.insertVertex_(t,ls,e,!1)}getGeometryFromVertex(t){return this.getGeometryFromPath(this.getPathFromVertex(t))}replaceNaNs(t,e){this.m_vertexDescription.hasAttribute(t)||(0,n.d)(""),this.m_vertices.replaceNaNs(t,e)}removeNaNVertices(){for(let t=this.getFirstGeometry();t!==ls;t=this.getNextGeometry(t))for(let e=this.getFirstPath(t);e!==ls;e=this.getNextPath(e)){let t=this.getFirstVertex(e);for(let s=0,n=this.getPathSize(e);s<n;s++)t=this.getXY(t).isFinite()?this.getNextVertex(t):this.removeVertex(t,!0)}}queryVertexIterator(t=ls){return this.queryVertexIteratorEx(!1,t)}queryVertexIteratorEx(t,e=ls){let s=ls,i=ls,r=ls,o=ls,a=0,l=!1;for(s=e!==ls?e:this.getFirstGeometry();s!==ls;s=this.getNextGeometry(s))if(!t||(0,n.h)(this.getGeometryType(s))){for(i=this.getFirstPath(s);i!==ls;i=this.getNextPath(i))if(r=this.getFirstVertex(i),o=r,a=0,r!==ls){l=!0;break}if(l||e!==ls)break}return l||(s=ls),us.create_(this,s,i,r,o,a,t,!1,e!==ls)}queryVertexIteratorOnSelection(t=ls){return this.m_selection?us.create_(this,t,ls,ls,ls,-1,!1,!0,t!==ls):this.queryVertexIteratorEx(!1,t)}hasSelection(){return this.m_selection}createEmptySelection(){(0,n.g)(0)}removeSelection(){this.m_selection&&(this.m_selectedVertices.length=0,this.removeUserIndex(this.m_selectionIndex),this.m_selectionIndex=-1,this.m_selection=!1,this.m_selectedCount=0)}select(t){return!!this.selected(t)||(this.setUserIndex(t,this.m_selectionIndex,this.m_selectedVertices.length),this.m_selectedVertices.push(t),this.m_selectedCount++,!1)}unselect(t){if(!this.m_selection)return;const e=this.getUserIndex(t,this.m_selectionIndex);e>=0&&(this.m_selectedVertices[e]=ls,this.setUserIndex(t,this.m_selectionIndex,-1),this.m_selectedCount--)}selected(t){return!this.m_selection||this.selected_(t)}getSelectedCount(){return this.m_selection?this.m_selectedCount:this.getTotalPointCount()}createSelectionForCrackingAndClustering(t,e){return(0,n.g)(0),!1}peelALoop(t,e){this.peelALoop_(t,e,!1)}peelALoopIntoAPath(t,e){return this.peelALoop_(t,e,!0)}applyTransformation(t){if(this.m_verticesMp.applyTransformation(t),null!==this.m_segments)for(let e=0,s=this.m_segments.length;e<s;e++)this.m_segments[e]&&this.m_segments[e].applyTransformation(t)}setGeometryType(t,e){this.m_geometryIndexList.setField(t,2,e)}splitSegmentWithIntersector(t,e,s,n,i){n?this.splitSegmentForward(t,e,s,!0,i):this.splitSegmentBackward(t,e,s,!0,i)}setPrevVertex(t,e){this.m_vertexIndexList.setField(t,1,e)}setNextVertex(t,e){this.m_vertexIndexList.setField(t,2,e)}setPathToVertex(t,e){this.m_vertexIndexList.setField(t,3,e)}setPathSize(t,e){this.m_pathIndexList.setField(t,3,e)}setFirstVertex(t,e){this.m_pathIndexList.setField(t,4,e)}setLastVertex(t,e){this.m_pathIndexList.setField(t,5,e)}getSegment(t){if(null!=this.m_segments){const e=this.getVertexIndex(t);return this.getSegmentFromIndex(e)}return null}isCurve(t){if(null===this.m_segments)return!1;const e=this.getVertexIndex(t);return this.m_segments.length>e&&null!==this.m_segments[e]}querySegment(t,e,s=!0,n=!1){const i=this.getNextVertex(t);if(i===ls)return!1;const r=this.getSegment(t);if(!r)return!s&&(this.queryLineConnector(t,e.createLine(),n),!0);if(e.copyFrom(r,!0),n)return!0;if(this.m_vertexDescription.getAttributeCount()>1){const s=this.getHelperPoint();this.queryPoint(t,s),e.get().setStart(s),this.queryPoint(i,s),e.get().setEnd(s)}return!0}getSegmentFromIndex(t){return(null!==this.m_segments&&this.m_segments.length>t?this.m_segments[t]:null)||null}getAndClearSegmentFromIndex(t){return(null!==this.m_segments&&this.m_segments.length>t?this.m_segments[t]:null)||null}setSegmentToIndex(t,e){if(this.m_hasForceSetEnvelope=0,null===this.m_segments){if(!e)return;this.m_segments=[],this.m_segments.length=this.m_vertices.getPointCount()}t>=this.m_segments.length&&(this.m_segments.length=t+1),this.m_segments[t]=e}setGeometryPathCount(t,e){this.m_geometryIndexList.setField(t,6,e)}setGeometryVertexCount(t,e){this.m_geometryIndexList.setField(t,5,e)}ringParentageCheckInternal(t,e){return(0,n.g)(0),!1}reverseRingInternal(t){const e=this.hasCurves(),s=this.hasSegmentParentage();let n=null,i=-1,r=t;if(e){const t=this.getVertexIndex(r);n=this.getAndClearSegmentFromIndex(t)}s&&(i=this.getSegmentParentage(r));do{const t=this.getPrevVertex(r),o=this.getNextVertex(r);if(this.setNextVertex(r,t),this.setPrevVertex(r,o),e){const t=this.getVertexIndex(o),e=this.getSegmentFromIndex(t);n&&n.reverse(),this.setSegmentToIndex(t,n),n=e}if(s){const t=this.getSegmentParentage(o);this.setSegmentParentagePreserveBreak(o,i),i=t}r=o}while(r!==t);this.dbgVerifyIntegrity(t)}setTotalPointCount(t){this.m_pointCount=t}removePathOnly(t){const e=this.getPrevPath(t),s=this.getNextPath(t),n=this.getGeometryFromPath(t);e!==ls?this.setNextPath(e,s):this.setFirstPath(n,s),s!==ls?this.setPrevPath(s,e):this.setLastPath(n,e),this.setFirstVertex(t,ls),this.setLastVertex(t,ls),this.freePath(t)}insertClosedPath(t,e,s,n,i){const r=this.insertPath(t,ls);let o=0,a=s;for(i[0]=!1;;){a===n&&(i[0]=!0),this.setPathToVertex(a,r),o++;const t=this.getNextVertex(a);if(t===s)break;a=t}return this.setClosedPath(r,!0),this.setPathSize(r,o),i[0]&&(s=n),this.setFirstVertex(r,s),this.setLastVertex(r,this.getPrevVertex(s)),this.setRingAreaValid(r,!1),r}findVertex2D(t,e){return(0,n.g)(0),0}findVertex3D(t,e,s){return(0,n.g)(0),0}dbgVerifyMonotone(){}dbgCheckSelection(){}dbgVerifySegment(t){}dbgVerifyIntegrity(t,e=!0){}dbgVerifyVertexCounts(){}dbgVerifyCurves(){}dbgDumpGeometry(t,e){}getNextNthVertex(t,e){if(0===e)return t;let s=t;for(let n=0;n<e;++n)if(s=e>0?this.getNextVertex(s):this.getPrevVertex(s),s===ls)return ls;return s}removeVertexInternal(t,e){const s=this.getPrevVertex(t),n=this.getNextVertex(t);if(s!==ls&&this.setNextVertex(s,n),n!==ls&&this.setPrevVertex(n,s),this.hasCurves()&&s!==ls&&n!==ls){const i=this.getVertexIndex(t),r=this.getVertexIndex(s),o=this.getVertexIndex(n);if(e){const t=this.getSegmentFromIndex(r);if(null!==t){const e=this.m_vertices.getXY(o);t.setEndXY(e),t.normalizeAfterEndpointChange()}this.setSegmentToIndex(i,null)}else{const t=this.getSegmentFromIndex(i);if(this.setSegmentToIndex(i,null),null!==t){const e=this.m_vertices.getXY(r);t.setStartXY(e),t.normalizeAfterEndpointChange()}this.setSegmentToIndex(r,t)}}return this.freeVertex(t),n}isRingAreaValid(t){return!!(4&this.getPathFlags(t))}setRingAreaValid(t,e){const s=(4|this.getPathFlags(t))-4;this.setPathFlags(t,s|(e?4:0))}compareVerticesSimpleY(t,e){return this.queryXY(t,this.m_workPoint2D),this.queryXY(e,this.m_workPoint2_2D),this.m_workPoint2D.compare(this.m_workPoint2_2D)}compareVerticesSimpleY3D(t,e){return this.getXYZ(t).compare(this.getXYZ(e))}compareVerticesSimpleX(t,e){return this.getXY(t).compareX(this.getXY(e))}sortVerticesSimpleByYHeapMerge(t,e){(0,n.g)(0)}sortVerticesSimpleByY(t,e,s){this.m_bucketSort.sort(t,e,s,new hs(this))}sortVerticesSimpleByX(t,e,s){(0,n.g)(0)}sortVerticesSimpleByY3D(t,e,s){(0,n.g)(0)}snapVertexForPoleClipping(t,e){const s=this.getPrevVertex(t);s!==ls&&this.replaceCurveWithLine(s),this.getNextVertex(t)!==ls&&this.replaceCurveWithLine(t);const n=new r.P;this.queryXY(t,n),n.y=e,this.setXY(t,n)}setSegmentParentageAndBreak(t,e,s=!0){if(-1===this.m_segmentParentageIndex){if(-1===e)return;this.m_segmentParentageIndex=this.createUserIndex()}e>=0&&((0,n.g)(e<=(0,r.j)()>>1),e<<=1,e|=s?1:0),this.setUserIndex(t,this.m_segmentParentageIndex,e)}setSegmentParentagePreserveBreak(t,e){if((0,n.g)(e>=-1),-1===this.m_segmentParentageIndex){if(-1===e)return;this.m_segmentParentageIndex=this.createUserIndex()}e>=0&&((0,n.g)(e<=(0,r.j)()>>1),e<<=1,e|=this.getSegmentParentageBreakVertex(t)?1:0),this.setUserIndex(t,this.m_segmentParentageIndex,e)}getSegmentParentage(t){if(-1===this.m_segmentParentageIndex)return-1;const e=this.getUserIndex(t,this.m_segmentParentageIndex);return e<0?e:e>>1}getOriginalSegmentInfo(t){if(-1!==this.m_segmentParentageIndex){const e=this.getSegmentParentage(t);return new cs(e)}return new cs(-1)}setSegmentParentageBreakVertex(t,e){if(-1===this.m_segmentParentageIndex)return;let s=this.getUserIndex(t,this.m_segmentParentageIndex);s<0||!!(1&s)!==e&&(e?s|=1:s&=(0,r.j)()>>1<<1,this.setUserIndex(t,this.m_segmentParentageIndex,s))}getSegmentParentageBreakVertex(t){if(-1===this.m_segmentParentageIndex)return!0;const e=this.getUserIndex(t,this.m_segmentParentageIndex);return e<0||!!(1&e)}isDiscontinuousSegmentParentage(t){const e=this.getPrevVertex(t);return e!==ls&&this.getSegmentParentage(e)!==this.getSegmentParentage(t)}setCurveStitcherPointer(t){this.m_curveStitcher=t}hasSegmentParentage(){return-1!==this.m_segmentParentageIndex}deleteSegmentParentage(){-1!==this.m_segmentParentageIndex&&(this.removeUserIndex(this.m_segmentParentageIndex),this.m_segmentParentageIndex=-1),this.m_curveStitcher=null}clearSegments(){this.m_segments=null}}function ds(t){if(t.isEmpty())return new os({vd:t.getDescription()});if((0,n.h)(t.getGeometryType())&&t.hasNonLinearSegments())return function(t){(0,n.g)(t.hasNonLinearSegments()&&!t.isEmpty());const e=new ys;return e.addGeometry(t),e.getBoundingGeometry()}(t);const e=t.getImpl(),s=e.getPointCount();if(s<=2){if(1===s||e.getXY(0).equals(e.getXY(1))){const t=new i.P({vd:e.getDescription()});return e.getPointByVal(0,t),t}{const t=new i.P,s=new Ct({vd:e.getDescription()});return e.getPointByVal(0,t),s.startPathPoint(t),e.getPointByVal(1,t),s.lineToPoint(t),s}}const o=e.getAttributeStreamRef(0),a=new ys({stream:o,n:s});let l=1;const h=o.readPoint2D(0),u=new r.P;for(;l<s&&o.queryPoint2D(l<<1,u).equals(h);)l++;if(a.m_treeHull.addElement(0),l<s){a.m_treeHull.addBiggestElement(l);const t=new r.P;for(let s=l+1;s<e.getPointCount();s++){o.queryPoint2D(s<<1,t);const e=a.treeHull(t);-1!==e&&a.m_treeHull.setElement(e,s)}}const c=e.getDescription(),m=c.getAttributeCount()>1,d=a.m_treeHull.size();let g=null;if(d>=2){g=d>=3?new os({vd:c}):new Ct({vd:c});const t=g.getImpl();t.reserve(a.m_treeHull.size()),t.addPathPoint2D(null,0,!0);const s=new r.P;for(let n=a.m_treeHull.getFirst();-1!==n;n=a.m_treeHull.getNext(n))if(m){const s=new i.P;e.getPointByVal(a.m_treeHull.getElement(n),s),t.insertPoint(0,-1,s)}else o.queryPoint2D(a.m_treeHull.getElement(n)<<1,s),t.insertPoint2D(0,-1,s)}else if(m){const t=new i.P({vd:c});e.getPointByVal(a.m_treeHull.getElement(a.m_treeHull.getFirst()),t),g=t}else{const t=o.readPoint2D(a.m_treeHull.getElement(a.m_treeHull.getFirst())<<1);g=new i.P(t)}return g}function gs(t,e,s,n=!1){if(e<=262144)return function(t,e,s,n){const r=new i.A(0);for(let i=0;i<e;i++)r.add(i);const o={userSort(e,s,n){n.sort(e,s,((e,s)=>t[e].compareX(t[s])))},getValue:e=>t[e].x};n||i.B.sortEx(r,0,e,o);let a=0;t:for(let i=0;i<e;++i){const e=r.read(i);for(;a>=2;){const n=s[a-2],o=s[a-1];if(t[o].equals(t[e])){r.write(i,-1);continue t}if(!(xs(t[n],t[o],t[e])>=0)){o===r.read(i-1)&&r.write(i-1,-1);break}a--}s[a++]=e,2===a&&t[e].equals(t[s[0]])&&(r.write(1,-1),a--)}const l=a+1;t:for(let i=e-2;i>=0;--i){const e=r.read(i);if(!(e<0)){for(;a>=l;){const n=s[a-2],i=s[a-1];if(t[i].equals(t[e]))continue t;if(!(vs(t[n],t[i],t[e])>=0))break;a--}if(0!==i){const n=s[a-1];s[a++]=e,t[e].equals(t[n])&&a--}}}return a>1&&t[s[0]].equals(t[s[a-1]])&&a--,a}(t,e,s,n);const r=new ys({points:t,n:e});let o=1;const a=t[0];for(;o<e&&t[o].equals(a);)o++;if(r.m_treeHull.addElement(0),o<e){r.m_treeHull.addBiggestElement(o);for(let s=o+1;s<e;s++){const e=t[s],n=r.treeHull(e);-1!==n&&r.m_treeHull.setElement(n,s)}}let l=0;for(let i=r.m_treeHull.getFirst();-1!==i;i=r.m_treeHull.getNext(i))s[l++]=r.m_treeHull.getElement(i);return l}function ps(t,e,s){if((e<0||e>=t.getPathCount())&&(0,n.a)("path index"),t.hasNonLinearSegmentsPath(e))return!1;const i=t.getImpl(),o=i.getPathStart(e),a=i.getPathEnd(e),l=!i.isClosedPath(e)&&i.isClosedPathInXYPlane(e),h=i.getAttributeStreamRef(0),u=2*o;let c=2*a;if(l&&(c-=2),c-u<6)return!0;const m=h.readPoint2D(u),d=h.readPoint2D(u+2),g=h.readPoint2D(u+4);if(!bs(r.P.orientationRobust(d,g,m)))return!1;const p=d.clone(),_=new r.P;for(let n=u+6;n<c;n+=2){if(_.assign(d),d.assign(g),h.queryPoint2D(n,g),!bs(r.P.orientationRobust(d,g,m)))return!1;if(!bs(r.P.orientationRobust(p,g,m)))return!1;if(!bs(r.P.orientationRobust(d,g,_)))return!1}return!0}function _s(t,e,s,i,o){if(function(t,e,s){t.setNAN(),e.setCoords(1,0),s.setCoords(0,0)}(s,i,o),t.isEmpty())return;if(t.getGeometryType()===n.G.enumPoint)return void s.assign(t.getXY());const a=t,l=a.getPointCount();0!==l&&(1!==l?function(t,e,s,n,i,o){if(2===e){const e=t.getXY(0),s=t.getXY(1);n.assign(e.add(s).mul(.5));const r=s.sub(e);i=Es(r),o.setCoords(.5*r.length(),0)}else{let a=Number.MAX_VALUE;const l=[0,1,0,0],h=new r.R(4,2);for(h.set(0,0,0),h.set(0,1,1),h.set(1,0,1),h.set(1,1,2);l[0]<e;++l[0],Cs(h,0,e)){l[1]===l[0]&&(++l[1],Cs(h,1,e));for(let s=1;;++s){for(;;){const n=ws(t.getXY(h.get(0,0)),t.getXY(h.get(0,1)),t.getXY(h.get(s,0)),t.getXY(h.get(s,1)),2^s);if(n>0)break;if(++l[s],Cs(h,s,e),0===n)break}if(3===s)break;l[s+1]<l[s]&&(l[s+1]=l[s],h.set(s+1,0,h.get(s,0)),h.set(s+1,1,h.get(s,1)))}const u=t.getXY(h.get(0,0)).add(t.getXY(h.get(2,0))).mul(.5),c=Es(t.getXY(h.get(0,1)).sub(t.getXY(h.get(0,0)))),m=new r.P;let d,g;if(m.x=Math.max(0,c.dotProduct(t.getXY(h.get(1,0)).sub(t.getXY(h.get(3,0))))),m.y=Math.max(0,c.crossProduct(t.getXY(h.get(0,0)).sub(t.getXY(h.get(2,0))))),s?(d=m.x*m.y,g=d<a):(d=m.y,g=d<a),g){a=d;const e=t.getXY(h.get(1,0)),s=t.getXY(h.get(3,0)),r=e.add(s).mul(.5).sub(u);n.assign(u.add(c.mul(c.dotProduct(r)))),i.assign(c),o.assign(m)}}o.mulThis(.5),o.x<o.y&&(o.y=(0,r.c)(o.x,o.x=o.y),i.leftPerpendicularThis())}i.y<0?i.negateThis():0===i.y&&(i.x=1)}(a,l,e,s,i,o):s.assign(a.getXY(0)))}ms.st_defaultRank=1;class fs{constructor(t){this.m_handleP=-1,this.m_handleQ=-1,this.m_currentSupport=-1,this.m_area=0,this.m_bDone=!0,(0,n.g)(0),this.m_convexHull=t,this.m_function=this.done_}next(){return(0,n.g)(0),!1}get_vertex_handle_p(){return(0,n.g)(0),0}get_vertex_handle_q(){return(0,n.g)(0),0}get_current_support(){return(0,n.g)(0),0}getNext(t){return(0,n.g)(0),0}getPrev(t){return(0,n.g)(0),0}intialize_(){return(0,n.g)(0),!1}increment_(){return(0,n.g)(0),!1}increment_q_(){return(0,n.g)(0),!1}increment_p_(){return(0,n.g)(0),!1}parallel_edge_with_q_support_(){return(0,n.g)(0),!1}parallel_edge_with_p_support_(){return(0,n.g)(0),!1}done_(){return(0,n.g)(0),!1}}class ys{nullGetXY(t){return(0,n.d)("m_getXY is null"),{}}nullDeleteNode(t){(0,n.d)("m_deleteNode is null")}constructor(t){return this.m_treeHull=new i.T,this.m_shape=null,this.m_stream=null,this.m_points=null,this.m_geometryHandle=-1,this.m_pathHandle=-1,this.m_getXY=this.nullGetXY,this.m_deleteNode=this.nullDeleteNode,t?t.stream?(this.m_treeHull.setCapacity(Math.min(20,t.n)),this.m_stream=t.stream,this.m_getXY=this.getXYStream,this.m_deleteNode=this.deleteNodeStream,this.m_points=null,this.m_geometryHandle=ls,void(this.m_pathHandle=ls)):t.points?(this.m_treeHull.setCapacity(Math.min(20,t.n)),this.m_points=t.points,this.m_getXY=this.getXYPoints,this.m_deleteNode=this.deleteNodePoints,this.m_stream=null,this.m_geometryHandle=ls,void(this.m_pathHandle=ls)):void(0,n.p)("unrecognized constructor parameter"):(this.m_treeHull.setCapacity(20),this.m_shape=new ms,this.m_geometryHandle=this.m_shape.createGeometry(n.G.enumMultiPoint),this.m_pathHandle=this.m_shape.insertPath(this.m_geometryHandle,ls),this.m_getXY=this.getXYShape,this.m_deleteNode=this.deleteNodeShape,this.m_stream=null,void(this.m_points=null))}getXYShape(t){return this.m_shape.getXY(t)}getXYStream(t){return this.m_stream.readPoint2D(t<<1)}getXYPoints(t){return(0,n.g)(0),new r.P}deleteNodeShape(t){const e=this.m_treeHull.getElement(t);this.m_treeHull.deleteNode(t),this.m_shape.removeVertex(e,!1)}deleteNodeStream(t){this.m_treeHull.deleteNode(t)}deleteNodePoints(t){(0,n.g)(0)}addGeometry(t){if(t.isEmpty())return;const e=t.getGeometryType();if(e===n.G.enumGeometryCollection){const e=t;for(let t=0,s=e.getGeometryCount();t<s;t++)this.addGeometry(e.getGeometry(t))}else(0,n.i)(e)?this.addMultiVertexGeometry(t):(0,n.f)(e)?this.addSegment(t,!1):e===n.G.enumEnvelope?this.addEnvelope(t):e===n.G.enumPoint?this.addPoint(t):(0,n.a)("Convex_hull: geometry not supported")}getBoundingGeometry(){const t=new i.P,e=this.m_treeHull.getFirst(),s=new os({vd:this.m_shape.getVertexDescription()});if(0===this.m_treeHull.size())return s;s.reserve(this.m_treeHull.size()),this.m_shape.queryPoint(this.m_treeHull.getElement(e),t),s.startPathPoint(t);for(let n=this.m_treeHull.getNext(e);-1!==n;n=this.m_treeHull.getNext(n))this.m_shape.queryPoint(this.m_treeHull.getElement(n),t),s.lineToPoint(t);return s}getAntipodalPairsIterator(){return(0,n.g)(0),new fs(this)}getXY(t){return(0,n.g)(0),new r.P}getXYWithIndex(t){return(0,n.g)(0),new r.P}getFirst(){return(0,n.g)(0),0}getLast(){return(0,n.g)(0),0}getNext(t){return(0,n.g)(0),0}getPrev(t){return(0,n.g)(0),0}getVertexIndex(t){return(0,n.g)(0),0}getPointCount(){return(0,n.g)(0),0}addMultiVertexGeometry(t){const e=new i.P,s=t.getImpl(),o=new r.P;for(let n=0;n<t.getPointCount();n++){s.queryXY(n,o);const i=this.addPoint2D(o);if(-1!==i){t.getPointByVal(n,e);const s=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(i,s)}}if((0,n.h)(t.getGeometryType())){const e=t;if(e.hasNonLinearSegments()){const t=e.querySegmentIterator();for(;t.nextPath();)for(;t.hasNextSegment();){const e=t.nextCurve();null!==e&&this.addSegment(e,!0)}}}}addEnvelope(t){const e=new i.P;for(let s=0;s<4;s++){const n=new r.P;t.queryCorner(s,n);const i=this.addPoint2D(n);if(-1!==i){t.queryCornerByVal(s,e);const n=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(i,n)}}}static querySegmentControlPoints(t,e,s){const o=t.getGeometryType();if((0,n.g)(o!==n.G.enumLine),o===n.G.enumEllipticArc){const s=t,n=60*Math.PI/180,o=Math.abs(s.getSweepAngle());if(o>n){const t=Math.min(6,Math.ceil(o/n)),a=1/t,l=new Yr;s.queryStart(e[0]);let h=1;for(let n=0;n<t;n++){s.queryCut(n*a,(n+1)*a,l);const o=(0,r.m)(r.P,3);xr(l.get(),o);const u=r.P.calculateLength(o,3),c=r.P.calculateLength(o,2),m=u>0?c/u:.5;n<t-1?l.get().queryEnd(e[h+1]):s.queryEnd(e[h+1]),i.P.lerp(e[h-1],e[h+1],m,e[h]),e[h].setXY(o[1]),h+=2}return h}{const s=(0,r.m)(r.P,3);xr(t,s);const n=r.P.calculateLength(s,3);t.queryStart(e[0]),t.queryEnd(e[2]);const o=r.P.calculateLength(s,2),a=n>0?o/n:.5;return i.P.lerp(e[0],e[2],a,e[1]),e[1].setXY(s[1]),3}}if(o===n.G.enumBezier){const s=t,n=(0,r.m)(r.P,4);s.queryControlPoints(n);const o=r.P.calculateLength(n,4),a=r.P.calculateLength(n,2),l=r.P.calculateLength(n,3);t.queryStart(e[0]),t.queryEnd(e[3]);const h=o>0?a/o:.5;i.P.lerp(e[0],e[3],h,e[1]),e[1].setXY(n[1]);const u=o>0?l/o:.5;return i.P.lerp(e[0],e[3],u,e[2]),e[2].setXY(n[2]),4}if(o===n.G.enumBezier2){const s=t,n=(0,r.m)(r.P,3);s.queryControlPoints(n);const o=r.P.calculateLength(n,3);t.queryStart(e[0]),t.queryEnd(e[2]);const a=r.P.calculateLength(n,2),l=o>0?a/o:.5;return i.P.lerp(e[0],e[2],l,e[1]),e[1].setXY(n[1]),3}if(o===n.G.enumRationalBezier2){const s=t,n=(0,r.m)(r.P,3);s.queryControlPoints(n);const o=r.P.calculateLength(n,3);t.queryStart(e[0]),t.queryEnd(e[2]);const a=r.P.calculateLength(n,2),l=o>0?a/o:.5;return i.P.lerp(e[0],e[2],l,e[1]),e[1].setXY(n[1]),3}(0,n.a)("Convex_hull: segment type not supported")}addSegment(t,e){if(!e){const e=new i.P,s=t.getStartXY(),n=this.addPoint2D(s);if(-1!==n){t.queryStart(e);const s=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(n,s)}const r=t.getEndXY(),o=this.addPoint2D(r);if(-1!==o){t.queryEnd(e);const s=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(o,s)}}if(t.isCurve()){const e=(0,r.m)(i.P,13);for(let s=1,n=ys.querySegmentControlPoints(t,e,e.length)-1;s<n;++s){const t=e[s].getXY(),n=this.addPoint2D(t);if(-1!==n){const t=this.m_shape.addPoint(this.m_pathHandle,e[s]);this.m_treeHull.setElement(n,t)}}}}addPoint(t){const e=t.getXY(),s=this.addPoint2D(e);if(-1!==s){const e=this.m_shape.addPoint(this.m_pathHandle,t);this.m_treeHull.setElement(s,e)}}addPoint2D(t){let e=-1;if(0===this.m_treeHull.size())return e=this.m_treeHull.addElement(-4),e;if(1===this.m_treeHull.size()){const s=this.m_treeHull.getElement(this.m_treeHull.getFirst()),n=this.m_shape.getXY(s);return t.equals(n)||(e=this.m_treeHull.addBiggestElement(-5)),e}return e=this.treeHull(t),e}treeHull(t){let e=-1;do{const s=this.m_treeHull.getFirst(),n=this.m_treeHull.getLast(),i=this.m_treeHull.getElement(s),o=this.m_treeHull.getElement(n),a=this.m_getXY(i),l=this.m_getXY(o),h=r.P.orientationRobust(l,t,a);if(bs(h)){e=this.m_treeHull.addBiggestElement(-1);const i=this.treeHullWalkBackward(t,n,s);i!==s&&this.treeHullWalkForward(t,s,this.m_treeHull.getPrev(i));break}if(Ps(h)){let i=this.m_treeHull.getRoot(),o=this.m_treeHull.getFirst(),l=this.m_treeHull.getLast(),h=-1,u=-1,c=-1;for(;o!==this.m_treeHull.getPrev(l);){u=this.m_treeHull.getElement(i);const e=this.m_getXY(u);Ps(r.P.orientationRobust(e,t,a))?(l=i,i=this.m_treeHull.getLeft(i)):(o=i,i=this.m_treeHull.getRight(i))}i=l,h=o,u=this.m_treeHull.getElement(i),c=this.m_treeHull.getElement(h);const m=this.m_getXY(u),d=this.m_getXY(c);if(h!==s&&!bs(r.P.orientationRobust(d,t,m)))break;e=this.m_treeHull.addElementAtPosition(h,i,-2,!0,!1),this.treeHullWalkForward(t,i,n),this.treeHullWalkBackward(t,h,s);break}{const i=Ss(t,l,a);if(-1===i){const i=this.m_treeHull.getPrev(n);this.m_treeHull.deleteNode(n),e=this.m_treeHull.addBiggestElement(-3),this.treeHullWalkBackward(t,i,s)}else if(1===i){const i=this.m_treeHull.getNext(s);this.m_treeHull.deleteNode(s),e=this.m_treeHull.addElementAtPosition(-1,i,-3,!0,!1),this.treeHullWalkForward(t,i,n)}break}}while(0);return e}treeHullWalkForward(t,e,s){if(e===s)return s;let n=e,i=this.m_treeHull.getElement(n),o=this.m_treeHull.getNext(n);const a=this.m_getXY(i);for(;n!==s&&this.m_treeHull.size()>2;){const e=this.m_treeHull.getElement(o),s=this.m_getXY(e);if(bs(r.P.orientationRobust(s,t,a)))break;const l=n;n=o,i=e,a.assign(s),o=this.m_treeHull.getNext(n),this.m_deleteNode(l)}return n}treeHullWalkBackward(t,e,s){if(e===s)return s;let n=e,i=this.m_treeHull.getElement(n),o=this.m_treeHull.getPrev(n);const a=this.m_getXY(i);for(;n!==s&&this.m_treeHull.size()>2;){const e=this.m_treeHull.getElement(o),s=this.m_getXY(e);if(bs(r.P.orientationRobust(a,t,s)))break;const l=n;n=o,i=e,a.assign(s),o=this.m_treeHull.getPrev(n),this.m_deleteNode(l)}return n}}function xs(t,e,s){const n=e.sub(t),i=s.sub(e);if(0===n.x)return i.x>0?-1:0;if(0===n.y)return i.y>0?1:i.y<0?-1:0;const o=n.crossProduct(i),a=4*Number.EPSILON*(Math.abs(i.x*n.y)+Math.abs(i.y*n.x));return o>a?1:o<-a?-1:r.P.orientationRobust(t,e,s)}function vs(t,e,s){const n=e.sub(t),i=s.sub(e);if(0===n.x)return i.x<0?-1:0;if(0===n.y)return i.y>0?-1:i.y<0?1:0;const o=n.crossProduct(i),a=4*Number.EPSILON*(Math.abs(i.x*n.y)+Math.abs(i.y*n.x));return o>a?1:o<-a?-1:r.P.orientationRobust(t,e,s)}function bs(t){return t<0}function Ps(t){return t>0}function Ss(t,e,s){let n=-1;n=e.y===s.y?0:e.x===s.x?1:Math.abs(e.x-s.x)>=Math.abs(e.y-s.y)?0:1;let i=-1;return i=e[n]<s[n]?t[n]<e[n]?-1:s[n]<t[n]?1:0:e[n]<t[n]?-1:t[n]<s[n]?1:0,i}function Es(t){return(t=t.clone()).divThis(Math.max(Math.abs(t.x),Math.abs(t.y))),t.normalize(),t}function Cs(t,e,s){t.inc(e,0)===s&&t.set(e,0,0),t.inc(e,1)===s&&t.set(e,1,0)}function ws(t,e,s,i,o){switch(o){case 0:break;case 1:e.rightPerpendicularThis(),t.rightPerpendicularThis();break;case 2:e.negateThis(),t.negateThis();break;case 3:e.leftPerpendicularThis(),t.leftPerpendicularThis();break;default:(0,n.a)("")}return r.P.orientationRobustEx(t,e,s,i)}class Is{constructor(){this.length=Number.NaN,this.specialPoints=[]}specialPointsCount(){return this.specialPoints.length}}function Ts(t){return function(t){return 256*(0,r.O)()*t}(t.calculateUpperLength2D())}function As(t,e,s=!1){e[1].setCoords(t.m_cp[0].x-t.getStartX(),t.m_cp[0].y-t.getStartY()),e[1].mulThis(3),e[2].setCoords(t.m_cp[1].x-t.m_cp[0].x,t.m_cp[1].y-t.m_cp[0].y),e[2].mulThis(3),e[3]=t.getEndXY().sub(t.getStartXY()),e[3].subThis(e[2]),e[2].subThis(e[1]),s?e[0].setCoords(0,0):e[0]=t.getStartXY()}function Ms(t,e,s){const n=(0,r.m)(r.P,4);t.queryControlPoints(n),Ns(n,e,s)}function Ds(t,e,s){const n=(0,r.m)(r.P,4);t.queryControlPoints(n),Fs(n,e,s)}function Ns(t,e,s){let n=t[1].x;n-=t[0].x,n*=3;let i=t[2].x;i-=t[1].x,i*=3;let r=t[3].x;r-=t[0].x,r-=i,i-=n,e[3].setWithEps(r),e[2].setWithEps(i),e[1].setWithEps(n),s?e[0].set(0):e[0].set(t[0].x)}function Fs(t,e,s){let n=t[1].y;n-=t[0].y,n*=3;let i=t[2].y;i-=t[1].y,i*=3;let r=t[3].y;r-=t[0].y,r-=i,i-=n,e[3].setWithEps(r),e[2].setWithEps(i),e[1].setWithEps(n),s?e[0].set(0):e[0].set(t[0].y)}function Rs(t,e,s=!1){const n=(0,r.m)(P,4);n[0].assignPoint2D(t[0]),n[1].assignPoint2D(t[1]),n[2].assignPoint2D(t[2]),n[3].assignPoint2D(t[3]),e[1].setCoords(n[1].x.sub(n[0].x),n[1].y.sub(n[0].y)),e[1].mulThis(r.M.constructInt32(3)),e[2].setCoords(n[2].x.sub(n[1].x),n[2].y.sub(n[1].y)),e[2].mulThis(r.M.constructInt32(3)),e[3]=n[3].sub(n[0]),e[3]=e[3].sub(e[2]),e[2]=e[2].sub(e[1]),s?e[0].setCoords(r.ah,r.ah):e[0]=n[0].clone()}function ks(t,e,s){if(s){if(e<0)return e;if(e>1)return e-1+ks(t,1,!1)}if(t.isDegenerate(0))return 0;const n=1===e,i=Ls(t);if(n&&!Number.isNaN(i.length)&&!Number.isNaN(i.length))return i.length;const r=Ts(t),o=r/t.calculateUpperLength2D();let a=0,l=0;for(let h=1,u=i.specialPointsCount();h<u;h++){const s=i.specialPoints[h];if(a+=Sn(t,l,Math.min(e,s),o,r),e<=s)break;l=s}return n&&(i.length=a),a}function Ls(t){if(t.m_cachedValues)return t.m_cachedValues;const e=new Is,s=(0,r.m)(r.H,8),n=(0,r.m)(r.P,4);t.queryControlPoints(n);const i=yn(n,s);e.specialPoints=[];for(let r=0;r<i;r++)e.specialPoints.push(s[r].value());return Vs(t,e),e}function Gs(t){let e=null;return e=t.m_cachedValues,e}function Vs(t,e){t.m_cachedValues=e}function zs(t){t.m_cachedValues=null}function Os(t,e,s,n){const i=(0,r.m)(r.P,4);t.queryControlPoints(i);const o=(0,r.d)(18,NaN),a=Mt(new gn(i,e,NaN),r.E.construct(s,n),18,o),l=new r.P;t.queryCoord2D(s,l);let h=s,u=r.P.distance(l,e);const c=new r.P;t.queryCoord2D(n,c);const m=r.P.distance(c,e);m<u&&(u=m,h=n,l.assign(c));for(let d=0;d<a;d++){t.queryCoord2D(o[d],c);const s=r.P.distance(c,e);s<u&&(u=s,h=o[d],l.assign(c))}return function(t,e,s,n,i){return{tmin:t,tmax:e,t:s,d:n,pt:i.clone()}}(s,n,h,u,l)}function qs(t,e){const s=(0,r.m)(r.H,4);Ms(t,s,!0);const i=(0,r.m)(r.H,4);Ds(t,i,!0);const o=s[3].clone(),a=s[2].clone(),l=s[1].clone(),h=i[3].clone(),u=i[2].clone(),c=i[1].clone(),m=a.mulE(l).addE(u.mulE(c)).mul(4),d=a.mulE(a).mul(8).addE(o.mulE(l).mul(12)).addE(u.mulE(u).mul(8).addE(h.mulE(c).mul(12))),g=o.mulE(a).addE(h.mulE(u)).mul(36),p=o.mulE(o).addE(h.mulE(h)).mul(36),_=(0,r.m)(r.H,3),f=Ot(p,g,d,m,new r.E(0,1),!1,_);if((0,n.g)(f<=3),f>0){const s=Us(t,1,0).sqrLength(),n=Us(t,1,1).sqrLength();let i=s;e.set(0),i<n&&(i=n,e.set(1));for(let r=0;r<f;r++){const s=Us(t,1,_[r].value()).sqrLength();s<i&&(i=s,e=_[r])}}}function Bs(t,e,s){const n=new r.P;return function(t,e,s,n){if(1===e){const e=1-s,i=e*e,r=s*s,o=t[1].sub(t[0]),a=t[2].sub(t[1]),l=t[3].sub(t[2]),h=o.mul(i).add(a.mul(2*e*s)).add(l.mul(r));n.assign(h.mul(3))}else if(2===e){const e=1-s,i=t[2].sub(t[1]).sub(t[1].sub(t[0])),r=t[3].sub(t[2]).sub(t[2].sub(t[1])),o=i.mul(e).add(r.mul(s));n.assign(o.mul(6))}else if(3===e){const e=t[2].sub(t[1]),s=t[3].sub(e.mul(3)).sub(t[0]);n.assign(s.mul(6))}else n.setCoords(0,0)}(t,e,s,n),n}function Ys(t,e,s){const n=[v.constructPoint2D(t[0]),v.constructPoint2D(t[1]),v.constructPoint2D(t[2]),v.constructPoint2D(t[3])],i=new v;return function(t,e,s,n){{const e=r.I.subE(s),i=e.sqr(),o=s.sqr(),a=t[1].subE(t[0]).mulE(i).addE(t[2].subE(t[1]).mulE(new r.H(2).mulE(e).mulE(s))).addE(t[3].subE(t[2]).mulE(o));n.setE(a.mulE(new r.H(3)))}}(n,0,s,i),i}function Us(t,e,s){const n=(0,r.m)(r.P,4);return t.queryControlPoints(n),Bs(n,e,s)}function Hs(t){const e=t.m_cp[0].sub(t.getStartXY()),s=t.m_cp[1].sub(t.m_cp[0]),n=t.getEndXY().sub(t.getStartXY());return e.mulThis(3),s.mulThis(3),n.subThis(s),s.subThis(e),(3*n.x*(2*s.y+5*e.y)-3*n.y*(2*s.x+5*e.x)+10*(s.x*e.y-s.y*e.x))/60}function Xs(t){const e=(0,r.m)(r.P,4);t.queryControlPoints(e);const s=js(e);return s&&(t.m_cp[0].setCoordsPoint2D(e[1]),t.m_cp[1].setCoordsPoint2D(e[2]),t.afterCompletedModification()),s}function js(t){return E(t)}function Zs(t){return function(t){const e=(0,r.F)(t[0].y,t[1].y),s=(0,r.F)(t[1].y,t[2].y),n=(0,r.F)(t[2].y,t[3].y);if(e>=0&&s>=0&&n>=0||e<=0&&s<=0&&n<=0){const e=(0,r.F)(t[0].x,t[1].x),s=(0,r.F)(t[1].x,t[2].x),n=(0,r.F)(t[2].x,t[3].x);if(e>=0&&s>=0&&n>=0||e<=0&&s<=0&&n<=0)return!0}return!1}(t)}function Ws(t,e,s){const n=new r.P,i=new r.P,o=new r.P,a=new r.P,l=new r.P;e<=.5?((0,r.a2)(2,t[0],t[1],e,n),(0,r.a2)(2,t[1],t[2],e,i),(0,r.a2)(2,t[2],t[3],e,o),(0,r.a2)(2,n,i,e,a),(0,r.a2)(2,i,o,e,l),(0,r.a2)(2,a,l,e,s)):((0,r.a3)(2,t[0],t[1],e,n),(0,r.a3)(2,t[1],t[2],e,i),(0,r.a3)(2,t[2],t[3],e,o),(0,r.a3)(2,n,i,e,a),(0,r.a3)(2,i,o,e,l),(0,r.a3)(2,a,l,e,s))}function $s(t,e,s,i){(0,n.g)(e>=0&&e<=1);const o=new r.P,a=new r.P,l=new r.P,h=new r.P,u=new r.P,c=new r.P;e<=.5?((0,r.a2)(2,t[0],t[1],e,o),(0,r.a2)(2,t[1],t[2],e,a),(0,r.a2)(2,t[2],t[3],e,l),(0,r.a2)(2,o,a,e,h),(0,r.a2)(2,a,l,e,u),(0,r.a2)(2,h,u,e,c)):((0,r.a3)(2,t[0],t[1],e,o),(0,r.a3)(2,t[1],t[2],e,a),(0,r.a3)(2,t[2],t[3],e,l),(0,r.a3)(2,o,a,e,h),(0,r.a3)(2,a,l,e,u),(0,r.a3)(2,h,u,e,c));const m=t[3].clone();s&&(s[0].assign(t[0]),s[1].assign(o),s[2].assign(h),s[3].assign(c)),i&&(i[0].assign(c),i[1].assign(u),i[2].assign(l),i[3].assign(m))}function Ks(t,e,s,i){if((0,n.g)(e>=0&&s<=1&&e<=s),e===s){const s=new r.P;return Qs(t,e,s),i[0].assign(s),i[1].assign(s),i[2].assign(s),void i[3].assign(s)}if(0===e&&1===s){for(let e=0;e<4;++e)i[e].assign(t[e]);return}const o=(0,r.m)(r.P,4);$s(t,s,o,null),$s(o,s>0?e/s:0,null,o),Qs(t,e,o[0]),Qs(t,s,o[3]),i[0].setCoordsPoint2D(o[0]),i[1].setCoordsPoint2D(o[1]),i[2].setCoordsPoint2D(o[2]),i[3].setCoordsPoint2D(o[3])}function Qs(t,e,s,n){if(n){if(e<0)return void Q(new Br({start:t[0],end:t[0].add(tn(t,0).getUnitVector())}),e,s);if(e>1)return void Q(new Br({start:t[3],end:t[3].add(tn(t,1).getUnitVector())}),e-1,s)}if(e<=.5){const n=new r.P;(0,r.a2)(2,t[0],t[1],e,n);const i=new r.P;(0,r.a2)(2,t[1],t[2],e,i);const o=new r.P;(0,r.a2)(2,t[2],t[3],e,o);const a=new r.P;(0,r.a2)(2,n,i,e,a);const l=new r.P;(0,r.a2)(2,i,o,e,l),(0,r.a2)(2,a,l,e,s)}else{const n=new r.P;(0,r.a3)(2,t[0],t[1],e,n);const i=new r.P;(0,r.a3)(2,t[1],t[2],e,i);const o=new r.P;(0,r.a3)(2,t[2],t[3],e,o);const a=new r.P;(0,r.a3)(2,n,i,e,a);const l=new r.P;(0,r.a3)(2,i,o,e,l),(0,r.a3)(2,a,l,e,s)}}function Js(t,e,s){const n=(0,r.m)(r.P,4);t.queryControlPoints(n),function(t,e,s){if(e.value()<=.5){const n=new v;(0,r.a4)(2,v.constructPoint2D(t[0]),v.constructPoint2D(t[1]),e,n);const i=new v;(0,r.a4)(2,v.constructPoint2D(t[1]),v.constructPoint2D(t[2]),e,i);const o=new v;(0,r.a4)(2,v.constructPoint2D(t[2]),v.constructPoint2D(t[3]),e,o);const a=new v;(0,r.a4)(2,n,i,e,a);const l=new v;(0,r.a4)(2,i,o,e,l),(0,r.a4)(2,a,l,e,s)}else{const n=new v;(0,r.a5)(2,v.constructPoint2D(t[0]),v.constructPoint2D(t[1]),e,n);const i=new v;(0,r.a5)(2,v.constructPoint2D(t[1]),v.constructPoint2D(t[2]),e,i);const o=new v;(0,r.a5)(2,v.constructPoint2D(t[2]),v.constructPoint2D(t[3]),e,o);const a=new v;(0,r.a5)(2,n,i,e,a);const l=new v;(0,r.a5)(2,i,o,e,l),(0,r.a5)(2,a,l,e,s)}}(n,e,s)}function tn(t,e){const s=(0,r.s)(e,0,1);let n=Bs(t,1,s);return n.isZero()&&(n=Bs(t,2,s),n.isZero()?n=Bs(t,3,s):1===s&&n.negateThis()),n}function en(t,e,s){const n=(0,r.m)(r.P,4);t.queryControlPoints(n),function(t,e,s){e.value()<0&&e.set(0,e.eps()),e.value()>1&&e.set(1,e.eps()),s.setE(Ys(t,0,e))}(n,e,s)}function sn(t,e,s,n,i){if(i){if(0!==Rr(e,s))return t?4:2}else if(C(e,s))return 1;return 0!==an(t,e,s,null,null,null,n,void 0!==i&&i,!0,!1)?4:0}function nn(t,e,s,n,i){if(i){if(0!==Rr(e,s))return t?4:2}else if(C(e,s))return 1;return 0!==ln(t,e,s,null,null,null,n,void 0!==i&&i,!0,!1)?4:0}function rn(t,e,s,n,i){if(i){if(0!==Rr(e,s))return t?4:2}else if(C(e,s))return 1;return 0!==un(t,e,s,null,null,null,n,void 0!==i&&i,!0,!1)?4:0}function on(t,e,s,n,i){if(i){if(0!==Rr(e,s))return t?4:2}else if(C(e,s))return 1;return 0!==cn(t,e,s,null,null,null,n,i??!1,!0,!1)?4:0}function an(t,e,s,n,i,o,a,l,h,u){if(null!==i&&(i.length=0),null!=o&&(o.length=0),null!==n&&(n.length=0),s.isDegenerate(0)){const t=[0,0,0],l=e.intersectPoint(s.getStartXY(),t,a);if(l>0){if(null!==i)for(let e=0;e<l;e++)i.push(t[e]);if(null!==o)for(let t=0;t<l;t++)o.push(0);if(null!=n)for(let s=0;s<l;s++){const i=new r.P;e.queryCoord2D(t[s],i),n.push(i)}}return l}const c=B(e,s);if(Y(e,s,a=Math.max(a,c)))return 0;const m=(0,r.m)(r.P,4);As(e,m);const d=s.getEndXY();d.subThis(s.getStartXY());const g=d.clone();g.leftPerpendicularThis();let p=3*m[3].dotProduct(g),_=2*m[2].dotProduct(g),f=m[1].dotProduct(g);const y=(0,r.d)(15,Number.NaN),x=(0,r.d)(15,Number.NaN);let v=Dt(p,_,f,r.E.unit(),!1,y);v<0&&(y[0]=0,y[1]=1,v=2);let b,P=0;for(let C=0,w=P;C<v;++C){const t=e.getCoord2D(y[C+w]);x[P]=s.getClosestCoordinate(t,!1),r.P.distance(t,s.getCoord2D(x[P]))<=a&&(y[P]=y[C+w],P++)}if(m[0].subThis(s.getStartXY()),Math.abs(d.x)>=Math.abs(d.y)){const t=d.y/d.x;p=m[3].y-m[3].x*t,_=m[2].y-m[2].x*t,f=m[1].y-m[1].x*t,b=m[0].y-m[0].x*t}else{const t=d.x/d.y;p=m[3].x-m[3].y*t,_=m[2].x-m[2].y*t,f=m[1].x-m[1].y*t,b=m[0].x-m[0].y*t}const S=e.getEndXY().equals(s.getStartXY())||e.getEndXY().equals(s.getEndXY()),E=[0,0,0];v=Nt(p,_,f,b,r.E.unit(),S,E);for(let C=0,w=P;C<v;++C){y[C+w]=E[C];const t=e.getCoord2D(y[C+w]);x[P]=s.getClosestCoordinate(t,!1),r.P.distance(t,s.getCoord2D(x[P]))<=a&&(y[P]=y[C+w],P++)}v=e.intersectPoint(s.getStartXY(),E,a);for(let r=0;r<v;r++)y[P]=E[r],x[P++]=0;v=e.intersectPoint(s.getEndXY(),E,a);for(let r=0;r<v;r++)y[P]=E[r],x[P++]=1;return 0!==s.intersectPoint(e.getStartXY(),E,a)&&(x[P]=E[0],y[P++]=0),0!==s.intersectPoint(e.getEndXY(),E,a)&&(x[P]=E[0],y[P++]=1),0===P?0:Vr(t,e,s,y,x,P,n,i,o,a,l,h,u)}function ln(t,e,s,n,i,o,l,h,u,c){if(rr(s))return an(t,e,new Br({start:s.getStartXY(),end:s.getEndXY()}),n,i,o,l,h,u,c);const m=B(e,s);if(Y(e,s,l=Math.max(l,m)))return 0;const d=[],g=[],p=[],_=(0,r.m)(r.P,4);{e.queryControlPoints(_);const t=(0,r.m)(r.P,4),n=new a.T;s.canonicToWorldTransformation(n);const i=new a.T;i.setInvert(n),i.transformPoints2D(_,4,t);const o=(0,r.m)(P,4);Rs(t,o);const u=[o[0].x,o[1].x,o[2].x,o[3].x],c=[o[0].y,o[1].y,o[2].y,o[3].y],m=(0,r.m)(r.M,3);m[0].setDouble(s.getSemiMinorAxis()),m[0].sqrThis(),m[1].setDouble(s.getSemiMajorAxis()),m[1].sqrThis(),m[2].setThis(m[0]),m[2].mulThis(m[1]),m[2].negateThis();const f=se(u,3,c,3,null,0,m,!0,r.E.unit(),r.E.unit(),g,h);if(f>0){let t=0;for(let n=0;n<f;n++){const i=new r.P;e.queryCoord2D(g[n],i);const o=s.getClosestCoordinate(i,!1),a=new r.P;s.queryCoord2D(o,a),r.P.distance(i,a)<=l&&(d.push(i.clone()),g[t]=g[n],p.push(o),t++)}g.length=t,d.length=t}}const f=[0,1];for(let a=0;a<2;a++){const t=0===a?s.getStartXY():s.getEndXY(),e=[0];pn(_,t,r.E.unit(),!1,-1,1,e);const n=new r.P;Qs(_,e[0],n),r.P.distance(t,n)<=l&&(g.push(e[0]),p.push(f[a]),d.push(n.clone()))}for(let a=0;a<2;a++){const t=[0,3];{const e=s.getClosestCoordinate(_[t[a]],!1),n=new r.P;s.queryCoord2D(e,n),r.P.distance(_[t[a]],n)<=l&&(g.push(f[a]),p.push(e),d.push(n.clone()))}}return Vr(t,e,s,g,p,g.length,n,i,o,l,h,u,c)}function hn(t,e,s,i,o,a,l,h,u,c){const m=(0,r.m)(r.P,4);e.queryControlPoints(m);const d=(0,r.m)(r.P,4);if(s.queryControlPoints(d),U(m,d,4)<0)return hn(t,s,e,i,a,o,l,h,u,!c);const g=B(e,s);if(Y(e,s,l=Math.max(l,g)))return 0;if(function(t,e,s,n,i,o,a,l,h){const u=(0,r.m)(r.P,4);t.queryControlPoints(u);const c=(0,r.m)(r.P,4);if(e.queryControlPoints(c),u[0].equals(c[0])){if(u[1].equals(c[1])&&u[2].equals(c[2])&&u[3].equals(c[3]))return s&&(s.length=0,s.push(u[0]),s.push(u[3])),n&&(n.length=0,n.push(0),n.push(1)),i&&(i.length=0,i.push(0),i.push(1)),!0;if(!u[0].equals(c[3]))return!1}return!!(u[0].equals(c[3])&&u[1].equals(c[2])&&u[2].equals(c[1])&&u[3].equals(c[0]))&&(n&&(n.length=0,n.push(0),n.push(1),h&&(n[1]=(0,r.c)(n[0],n[0]=n[1]))),i&&(i.length=0,i.push(1),i.push(0),h&&(i[1]=(0,r.c)(i[0],i[0]=i[1]))),s&&(s.length=0,s.push(u[0]),s.push(u[3]),h&&(s[1]=(0,r.c)(s[0],s[0]=s[1]))),!0)}(e,s,i,o,a,0,0,0,c))return 2;const p=new r.E(0,1),f=new r.E(0,1);{const t=new _;dn(m,new r.E(0,1),t);const e=new _;dn(d,new r.E(0,1),e);const s=Math.max(t.maxDim(),e.maxDim());if(t.inflate(3*l),e.inflate(3*l),!t.intersectW(e))return 0;if(t.maxDim()<.1*s){if(vn(m,t,p),p.isEmpty())return 0;if(vn(d,t,f),f.isEmpty())return 0;Ks(m,p.vmin,p.vmax,m),Ks(d,f.vmin,f.vmax,d)}}const y=Or(m,3,d,3,l);if(0===y)return 0;const x=[],v=[],b=[];let S=!1;if(-1===y){const t=(0,r.m)(P,4);Rs(m,t);const e=[t[0].x,t[1].x,t[2].x,t[3].x],s=[t[0].y,t[1].y,t[2].y,t[3].y],n=(0,r.m)(P,4);Rs(d,n);const i=[],o=[],a=ee(e,3,s,3,null,0,[n[0].x,n[1].x,n[2].x,n[3].x],3,[n[0].y,n[1].y,n[2].y,n[3].y],3,null,0,!0,r.E.unit(),r.E.unit(),i,o,u);if(a>0)for(let h=0;h<a;h++){const t=new r.P;Qs(d,o[h],t);const e=new r.P;Qs(m,i[h],e),r.P.distance(e,t)<=l&&(x.push(e.clone()),b.push(o[h]),v.push(i[h]))}else-1===a&&(S=!0)}for(let n=0;n<2;n++){const t=0===n?m:d,e=0===n?d:m;for(let s=0;s<2;s++){const i=0===s?0:3,o=[0];pn(e,t[i],r.E.unit(),!1,-1,1,o);const a=new r.P;Qs(e,o[0],a),r.P.distance(t[i],a)<=l&&(0===n?(v.push(0===i?0:1),b.push(o[0])):(b.push(0===i?0:1),v.push(o[0])),x.push(a.clone()))}}if(0===v.length&&S){const t=e.calculateUpperLength2D()>s.calculateUpperLength2D();{const i=[0,0];if(2===fn(t?e:s,i,!0)&&((0,n.g)(r.E.unit().containsCoordinate(i[0])),!r.E.unit().containsCoordinate(i[1]))){const e=new r.P;Qs(t?m:d,i[0],e);const s=[0,0];1===pn(t?d:m,e,r.E.unit(),!1,-1,2,s)&&(x.push(e.clone()),v.push(t?i[0]:s[0]),b.push(t?s[0]:i[0]))}}}if(0===v.length)return 0;if(!p.equalsRange(0,1))for(let n=0;n<v.length;++n)v[n]=In.recalculateParentT(p.vmin,p.vmax,v[n]);if(!f.equalsRange(0,1))for(let n=0;n<b.length;++n)b[n]=In.recalculateParentT(f.vmin,f.vmax,b[n]);return Vr(t,e,s,v,b,v.length,i,o,a,l,h,u,c)}function un(t,e,s,i,o,a,l,h,u,c){const m=B(e,s);if(s.isDegenerateToLineHelper(m)){const n=new Br({start:s.getStartXY(),end:s.getEndXY()}),r=an(t,e,n,i,o,a,l,h,u,c);if(a)for(let t=0;t<r;++t){const e=n.getCoord2D(a[t]);a[t]=s.getClosestCoordinate(e,!1)}return r}if(Y(e,s,l=Math.max(l,m)))return 0;const d=(0,r.m)(r.P,4);e.queryControlPoints(d);const g=(0,r.m)(r.P,3);s.queryControlPoints(g);const p=new r.E(0,1),f=new r.E(0,1),y=[0,0,0];s.queryWeights(y);const x=[1,yi(y),1];{const t=new _;dn(d,new r.E(0,1),t);const e=new _;Qn(g,x,new r.E(0,1),e);const s=Math.max(t.maxDim(),e.maxDim());if(t.inflate(3*l),e.inflate(3*l),!t.intersectW(e))return 0;if(t.maxDim()<.1*s){if(vn(d,t,p),p.isEmpty())return 0;if(fi(g,x,t,f),f.isEmpty())return 0;Ks(d,p.vmin,p.vmax,d),ni(g,x,f.vmin,f.vmax,g,x)}}const v=Or(d,3,g,2,l);if(0===v)return 0;const b=[],S=[],E=[];if(-1===v){const t=(0,r.m)(P,4);Rs(d,t);const e=[t[0].x,t[1].x,t[2].x,t[3].x],s=[t[0].y,t[1].y,t[2].y,t[3].y],n=(0,r.m)(r.M,3),i=(0,r.m)(r.M,3),o=(0,r.m)(r.M,3);mi(g,x,n,i,o);const a=[],h=[],c=ee(n,2,i,2,o,2,e,3,s,3,null,0,!0,r.E.unit(),r.E.unit(),h,a,u);if(c>0)for(let u=0;u<c;u++){const t=new r.P;Qs(d,a[u],t);const e=new r.P;_i(g,x,h[u],e),r.P.distance(t,e)<=l&&(b.push(t.clone()),S.push(a[u]),E.push(h[u]))}}for(let _=0;_<2;_++){let t,e;0===_?(t=d,e=g):(e=d,t=g);for(let s=0;s<2;s++){const i=0===s?0:t.length-1,o=[0],a=new r.P;if(0===_){const s=$n(e,x,t[i],r.E.unit(),!1,-1,1,o);(0,n.g)(1===s),_i(e,x,o[0],a)}else{const s=pn(e,t[i],r.E.unit(),!1,-1,1,o);(0,n.g)(1===s),Qs(e,o[0],a)}r.P.distance(t[i],a)<=l&&(0===_?(S.push(0===i?0:1),E.push(o[0])):(E.push(0===i?0:1),S.push(o[0])),b.push(a.clone()))}}if(0===S.length)return 0;if(!p.equalsRange(0,1))for(let n=0;n<S.length;++n)S[n]=In.recalculateParentT(p.vmin,p.vmax,S[n]);if(!f.equalsRange(0,1))for(let n=0;n<E.length;++n)E[n]=Wt.recalculateParentT(f.vmin,f.vmax,E[n]);for(let n=0;n<E.length;++n)E[n]=xi(y,E[n]);return Vr(t,e,s,S,E,S.length,i,o,a,l,h,u,c)}function cn(t,e,s,i,o,a,l,h,u,c){const m=B(e,s);if(Y(e,s,l=Math.max(l,m)))return 0;const d=(0,r.m)(r.P,4);e.queryControlPoints(d);const g=(0,r.m)(r.P,3);s.queryControlPoints(g);const p=Or(d,3,g,2,l);if(0===p)return 0;const _=[],f=[],y=[];if(-1===p){const t=(0,r.m)(P,4);Rs(d,t);const n=[t[0].x,t[1].x,t[2].x,t[3].x],i=[t[0].y,t[1].y,t[2].y,t[3].y],o=(0,r.m)(P,3);Ke(g,o);const a=ee([o[0].x,o[1].x,o[2].x],2,[o[0].y,o[1].y,o[2].y],2,null,0,n,3,i,3,null,0,!0,r.E.unit(),r.E.unit(),y,f,h);if(a>0){let t=0;for(let n=0;n<a;n++){const i=new r.P;e.queryCoord2D(f[n],i);const o=new r.P;s.queryCoord2D(y[n],o),r.P.distance(i,o)<=l&&(_.push(i.clone()),f[t]=f[n],y[t]=y[n],t++)}f.length=t,_.length=t}}for(let x=0;x<2;x++){let t,e;0===x?(t=d,e=g):(e=d,t=g);for(let s=0;s<2;s++){const i=0===s?0:t.length-1,o=[0],a=new r.P;if(0===x)Ve(e,t[i],o),Qe(e,o[0],a);else{const s=pn(e,t[i],r.E.unit(),!1,-1,1,o);(0,n.g)(1===s),Qs(e,o[0],a)}r.P.distance(t[i],a)<=l&&(0===x?(f.push(0===i?0:1),y.push(o[0])):(y.push(0===i?0:1),f.push(o[0])),_.push(a.clone()))}}return Vr(t,e,s,f,y,f.length,i,o,a,l,h,u,c)}function mn(t,e,s){const n=(0,r.m)(r.P,4);t.queryControlPoints(n),dn(n,e,s)}function dn(t,e,s){if(e.equalsRange(0,1))return void s.setFromPoints(t,4);const n=(0,r.m)(r.P,4);Ks(t,e.vmin,e.vmax,n),s.setFromPoints(n,4)}let gn=class{constructor(t,e,s){this.dbgCounter=0,this.controlPoints=t,this.point=e.clone(),this.maxDistance=s}getMaxDerivative(){return 6}getValue(t,e){switch(t){case 0:{const t=new r.P;Qs(this.controlPoints,e,t);const s=Bs(this.controlPoints,1,e);return 2*t.sub(this.point).dotProduct(s)}case 1:{const t=new r.P;Qs(this.controlPoints,e,t);const s=Bs(this.controlPoints,1,e),n=Bs(this.controlPoints,2,e);return 2*(t.sub(this.point).dotProduct(n)+s.dotProduct(s))}case 2:{const t=new r.P;Qs(this.controlPoints,e,t);const s=Bs(this.controlPoints,1,e),n=Bs(this.controlPoints,2,e),i=Bs(this.controlPoints,3,e);return 2*(t.sub(this.point).dotProduct(i)+3*s.dotProduct(n))}case 3:{const t=Bs(this.controlPoints,1,e),s=Bs(this.controlPoints,2,e),n=Bs(this.controlPoints,3,e);return 2*(4*t.dotProduct(n)+3*s.sqrLength())}case 4:{const t=Bs(this.controlPoints,2,e),s=Bs(this.controlPoints,3,e);return 10*t.dotProduct(s)*2}case 5:{const t=Bs(this.controlPoints,3,e);return 10*t.dotProduct(t)*2}default:return 0}}getError(t){return 0}isInterestingInterval(t,e){if(t>=0&&e<=1){const s=(0,r.m)(r.P,4);Ks(this.controlPoints,t,e,s);const n=new _;if(n.setFromPoints(s,4),Math.sqrt(n.sqrMinDistance(this.point))>this.maxDistance)return!1}return!0}};function pn(t,e,s,o,a,l,h){(0,n.x)(r.E.unit().contains(s)&&l>0,"getClosestCoordinate"),(a<0||Number.isNaN(a))&&(a=Number.MAX_VALUE);const u=[],c=new r.P;Qs(t,s.vmin,c);let m=r.P.distance(c,e);if(m<=a&&u.push(new r.P(s.vmin,m)),s.vmin!==s.vmax&&(Qs(t,s.vmax,c),m=r.P.distance(c,e),m<=a&&u.push(new r.P(s.vmax,m))),s.width()>0){const n=(0,r.d)(18,Number.NaN),i=Mt(new gn(t,e,a),s,18,n);for(let s=0;s<i;s++)Qs(t,n[s],c),m=r.P.distance(c,e),m>a||u.push(new r.P(n[s],m))}if(o){(0,n.g)(s.equals(r.E.unit()));{Qs(t,-1,c,!0);const s=new r.P;Qs(t,0,s);const n=new Br({start:c,end:s}),i=n.getClosestCoordinate(e,!0);i<1&&(c.assign(n.getCoord2D(i)),m=r.P.distance(c,e),m<=a&&u.push(new r.P(i-1,m)))}{Qs(t,2,c,!0);const n=new r.P;Qs(t,s.vmax,n);const i=new Br({start:n,end:c}),o=i.getClosestCoordinate(e,!0);o>0&&(c.assign(i.getCoord2D(o)),m=r.P.distance(c,e),m<=a&&u.push(new r.P(1+o,m)))}}if(!u.length)return 0;u.sort(((t,e)=>t.compare(e)));let d=0;const g=u[0].x;if(h[d++]=g,d<l){const e=(0,i.H)(t,4,!1).total(),s=u[0].y;for(let t=1,n=u.length;t<n;t++)if(u[t].y>s+e){u.length=t;break}u.sort(((t,e)=>(0,r.a8)(t.x,e.x))),d=0,h[d++]=u[0].x;for(let t=1,n=u.length;t<n;t++)u[t].x!==h[d-1]&&d<l&&(h[d++]=u[t].x)}return d}function _n(t,e,s,n,i,o,a){const l=(0,r.m)(r.P,4);return t.queryControlPoints(l),pn(l,e,s,n,i,o,a)}function fn(t,e,s=!1){const n=(0,r.m)(r.P,4);t.queryControlPoints(n);const i=(0,r.m)(P,4);let o,a,l;Rs(n,i,!0);const h=i[3].x.isZero(),u=i[3].y.isZero();if(h||u)if(h&&!u){if(i[2].x.isZero())return 0;o=i[1].x.div(i[2].x).negate(),a=i[2].y.div(i[3].y),l=i[1].y.div(i[3].y)}else{if(h||!u)return 0;if(i[2].y.isZero())return 0;o=i[1].y.div(i[2].y).negate(),a=i[2].x.div(i[3].x),l=i[1].x.div(i[3].x)}else{i[2].x.divThis(i[3].x),i[1].x.divThis(i[3].x),i[2].y.divThis(i[3].y),i[1].y.divThis(i[3].y);const t=i[2].x.sub(i[2].y);if(t.isZero())return 0;o=i[1].x.sub(i[1].y).div(t).negate(),a=i[2].x.clone(),l=i[1].x.clone()}if(!s&&o.abs().value()>2)return 0;const c=[0,0],m=t.getStartXY().equals(t.getEndXY()),d=Dt(1,-o.toDouble(),o.add(a).mul(o).add(l).toDouble(),r.E.unit(),m,c);if(0===d)return 0;if(c[0]>=0&&c[0]<=1){const t=o.toDouble()-c[0];if(s||t>=0&&t<=1)return e[0]=c[0],e[1]=t,e[0]>e[1]&&(e[1]=(0,r.c)(e[0],e[0]=e[1])),2}if(2===d&&c[1]>=0&&c[1]<=1){const t=o.toDouble()-c[1];if(s||t>=0&&t<=1)return e[0]=c[1],e[1]=t,e[0]>e[1]&&(e[1]=(0,r.c)(e[0],e[0]=e[1])),2}return 0}function yn(t,e){e[0].set(0);let s=1;const i=(0,r.m)(r.H,4);Ns(t,i,!0);const o=(0,r.m)(r.H,4);Fs(t,o,!0);{const t=i[3].mul(3),n=i[2].mul(2),o=i[1].clone(),a=(0,r.m)(r.H,2);let l=zt(t,n,o,new r.E(0,1),!1,a);l<0&&(l=0);for(let i=0;i<l;i++)(0,r.N)(a[i].value(),0,1)||(e[s]=a[i],s++)}{const t=o[3].mul(3),n=o[2].mul(2),i=o[1].clone(),a=(0,r.m)(r.H,2);let l=zt(t,n,i,new r.E(0,1),!1,a);l<0&&(l=0);for(let o=0;o<l;o++)(0,r.N)(a[o].value(),0,1)||(e[s]=a[o],s++)}if(s+=function(t,e,s){const n=t[1].mulE(e[2]).subThisE(t[2].mulE(e[1])),i=t[1].mulE(e[3]).subThisE(t[3].mulE(e[1])).mulThis(3),o=t[2].mulE(e[3]).subThisE(t[3].mulE(e[2])).mulThis(3),a=(0,r.m)(r.H,2);let l=zt(o,i,n,new r.E(0,1),!1,a);l<0&&(l=0);let h=0;for(let u=0;u<l;u++)(0,r.N)(a[u].value(),0,1)||(s[h].setE(a[u]),h++);return h}(i,o,e.slice(s)),e[s].set(1),s++,s>2){(0,r.C)(e,0,s,((t,e)=>{const s=t.value(),n=e.value();return s<n?-1:s>n?1:0}));let n=0;const i=e[0].clone();let o=0;const a=function(t){return t[0].norm(1)+t[1].norm(1)+t[2].norm(1)+t[3].norm(1)}(t)*(0,r.O)(),l=new r.P;Ws(t,e[0].value(),l);for(let h=1;h<s;h++){const s=new r.P;if(Ws(t,e[h].value(),s),e[h].eq(i)||s.isEqualPoint2D(l,a)){if(0!==n){if(0===e[h].eps())i.setE(e[h]),o=0;else if(0!==o){const t=(0,r.a)(1/e[h].eps()),s=1/o,n=t+s;i.set((e[h].value()*t+i.value()*s)/n),o=1/n,i.setError(Math.sqrt(o))}e[n].setE(i),Ws(t,i.value(),l)}}else n++,e[n].setE(e[h]),i.setE(e[h]),Ws(t,i.value(),l),o=(0,r.a)(e[h].eps())}n++,s=n}return 1===s&&(s=2,e[1].set(1)),(0,n.g)(0===e[0].value()),(0,n.g)(1===e[s-1].value()),s}function xn(t,e,s,n){const i=(0,r.m)(r.P,s);for(let l=0;l<s;++l)i[l]=new r.P(l/(s-1),0);const o=(t,e,s,n)=>{const i=new r.H(e.x).subE(new r.H(t.x)).divE(new r.H(e.y).subE(new r.H(t.y))).mulE(new r.H(s).subE(new r.H(t.y))).addE(new r.H(t.x));if(i.eps()>.1){const n=(e.x-t.x)/(e.y-t.y)*(s-t.y)+t.x;i.set(n,(0,r.O)())}if(i.lt(new r.H(0))||i.gt(new r.H(1)))return!1;let o=i.value()-i.eps();o=(0,r.s)(o,0,1);let a=i.value()+i.eps();return a=(0,r.s)(a,0,1),n.mergeCoordinate(o),n.mergeCoordinate(a),!0},a=[];{const e=(t,e)=>{a.length=s;const n=gs(i,s,a,!0),l=new r.E;l.setEmpty();const h=s=>s.y<t?-1:s.y>e?1:0;let u=i[a[0]],c=h(u);0===c&&l.mergeCoordinate(u.x);for(let s=1;s<=n;++s){const r=i[a[s%n]],m=h(r);0===m&&l.mergeCoordinate(r.x);let d=0;m!==c&&(d=m*c==0?1===m||1===c?2:1:3,1&d&&o(u,r,t,l),2&d&&o(u,r,e,l)),u=r,c=m}return l};for(let n=0;n<s;++n)i[n].y=t[n].x;const l=e(n.xmin,n.xmax);if(l.isEmpty())return new r.E(l);for(let n=0;n<s;++n)i[n].y=t[n].y;const h=e(n.ymin,n.ymax);return l.intersect(new r.E(h)),new r.E(l)}}function vn(t,e,s){s.setEmpty(),s.merge(function(t,e,s,n){const i=xn(t,0,s,n.getEnvelope2D());if(i.isEmpty())return new r.E(i);const o=(0,r.m)(r.P,s);for(let r=0;r<s;++r)n.xyRot(t[r],o[r]);const a=xn(o,0,s,n.getRotatedEnvelope2D());return i.intersect(new r.E(a)),new r.E(i)}(t,0,4,e))}class bn{constructor(t,e){this.b=t,this.len=e}getMaxDerivative(){return 1}getValue(t,e){return 0===t?this.len-ks(this.b,e,!1):0}getError(t){return 0}}function Pn(t,e,s,i,o,a,l){for(;;){const h=r.P.distance(e[0],e[3]),u=r.P.distance(e[0],e[1])+r.P.distance(e[1],e[2])+r.P.distance(e[2],e[3]);if(u-h<=i+s*u)return t+(0,r.q)(h,u,.5);const c=t=>Bs(e,1,t).length();{(0,n.g)(l<12);let h=c(0),m=c(1);o[0]+=2,h>m&&(m=(0,r.c)(h,h=m),e[3]=(0,r.c)(e[0],e[0]=e[3]),e[2]=(0,r.c)(e[1],e[1]=e[2]));let d=h/(h+m),g=1,p=u;for(;d<1/32&&p>=32*(i+s*p);){g/=4;const t=c(g);o[0]++,d=h/(t+h);const s=new r.P;if(Qs(e,.5*g,s),p=r.P.distance(s,e[0]),p<=i){const t=new r.P;Qs(e,g,t),p+=r.P.distance(t,s)}}if(1!==g){const n=(0,r.m)(r.P,4);$s(e,g,e,n),t=Pn(t,n,s,i,o,0,l+1),a++,l++;continue}}const m=8;o[0]+=m;const d=rs(m,c,0,1),g=16;o[0]+=g;const p=rs(g,c,0,1);let _=Math.abs(d-p)>i+s*u;if(!_)return t+p;if(a<3){const n=(0,r.m)(r.P,4);$s(e,.5,e,n),t=Pn(t,n,s,i,o,a+1,l+1),a++,l++;continue}const f=32;o[0]+=f;const y=rs(f,c,0,1);if(_=Math.abs(p-y)>i+s*u,!_)return t+y;const x=64;o[0]+=x;const v=rs(x,c,0,1);if(_=Math.abs(y-v)>i+s*u,!_)return t+v;const b=128;o[0]+=b;const P=rs(b,c,0,1);return _=Math.abs(v-P)>i+s*u,t+P}}function Sn(t,e,s,n,i){if(s===e)return 0;const o=(0,r.m)(r.P,4);t.queryControlPoints(o);const a=(0,r.m)(r.P,4);return Ks(o,e,s,a),Pn(0,a,n,i,[0],0,0)}function En(t,e,s,n,i){let o=!0;const a=ye(5,e,s,n,i,(e=>{const s=Us(t,1,e);return(o?t.getCoordX(e)-t.getStartX():t.getCoordY(e)-t.getStartY())*s.length()}));o=!1;const l=ye(5,e,s,n,i,(e=>{const s=Us(t,1,e);return(o?t.getCoordX(e)-t.getStartX():t.getCoordY(e)-t.getStartY())*s.length()}));return new r.P(a,l)}function Cn(t,e,s,i,o,a,l,h,u,c,m,d){(0,n.g)(c+2===d);let g=0,p=0,_=0,f=0,y=0,x=0,v=0;const b=(t,e)=>{const n=1-e,l=s.mul((0,r.an)(n)),h=i.mul(3*e*n*n),u=o.mul(3*e*e*n),c=a.mul((0,r.an)(e));return l.add(h).add(u).add(c).sub(m[t]).sqrLength()};for(let n=1,S=d-1;n<S;n++){let e=u[n-1];if(t){n>2?(e=(0,r.s)(2*u[n-2]-u[n-3],0,1),u[n-1]=e):2===n&&(e=(0,r.s)(2*u[n-2],0,1),u[n-1]=e);const t=(t,e,n)=>{let l=-1;for(let h=0;!(Math.abs(e-l)<1e-12)&&10!==h;h++){const h=e*e,u=1-e,c=u*u,d=c*u,g=s.x-2*i.x+o.x,p=s.x-3*i.x+3*o.x-a.x,_=s.y-2*i.y+o.y,f=s.y-3*i.y+3*o.y-a.y,y=s.x-i.x-2*g*e+p*h,x=-m[t].x+s.x*d+e*(3*i.x*c+e*(3*o.x*u+a.x*e)),v=s.y-i.y-2*_*e+f*h,b=-m[t].y+s.y*d+e*(3*i.y*c+e*(3*o.y*u+a.y*e)),P=-6*(y*x+v*b),S=6*(3*(0,r.a)(y)-(-2*g+2*p*e)*x)+6*(3*(0,r.a)(v)-(-2*_+2*f*e)*b);if(l=e,0===S)break;e=(0,r.s)(e-P/S,n,1)}return l};{const e=b(n,u[n-1]);let s=t(n,u[n-1],0),i=b(n,s);if(1.01*e<i){const e=n>1?u[n-2]:0,r=t(n,.3*(u[n-1]-e)+e,0),o=b(n,r);o<i&&(i=o,s=r)}e>i&&(u[n-1]=s)}}const l=u[n-1],h=l*l,c=h*l,d=1-l,P=d*d,S=P*d;g+=3*h*P*P,p+=3*c*S,_+=3*h*h*P;const E=-(S*s.x+c*a.x-m[n].x);f+=E*l*P,y+=E*h*d;const C=-(S*s.y+c*a.y-m[n].y);x+=C*l*P,v+=C*h*d}if(e){const t=g*_-p*p;Math.abs(t)>=1e-12*(Math.abs(g*_)+Math.abs(p*p))+1e-10?(l||(i.x=(f*_-y*p)/t,i.y=(x*_-v*p)/t),h||(o.x=(g*y-p*f)/t,o.y=(g*v-p*x)/t)):((0,r.U)(s,a,.3,i),(0,r.U)(s,a,.6,o))}let P=0;for(let n=1,r=d-1;n<r;n++)P+=b(n,u[n-1]);return P}var wn=i.V;class In extends ${constructor(t){t&&t.cp?(super({start:t.cp[0],end:t.cp[3],vd:t.vd}),this.m_cp=(0,r.m)(r.P,2),this.m_cp[0].assign(t.cp[1]),this.m_cp[1].assign(t.cp[2])):void 0===t||(0,r.W)(t,"vd")?(super({vd:t?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=(0,r.m)(r.P,2),this.m_cp[0].setCoords(0,0),this.m_cp[1].setCoords(0,0)):t.from?(super({start:t.from,end:t.to,vd:t.vd}),this.m_cp=(0,r.m)(r.P,2),this.m_cp[0].assign(t.cp1),this.m_cp[1].assign(t.cp2)):(super({XStart:0,YStart:0,XEnd:0,YEnd:0,vd:t.vd}),(0,n.d)("unrecognized constructor params"),this.m_cp=(0,r.m)(r.P,2),this.m_cp[0].setCoords(0,0),this.m_cp[1].setCoords(0,0)),this.m_cachedValues=0}getBoundary(){return Tt(this)}construct(t,e,s,n){this.m_XStart=t.x,this.m_YStart=t.y,this.m_XEnd=n.x,this.m_YEnd=n.y,this.m_cp[0].assign(e),this.m_cp[1].assign(s),this.afterCompletedModification()}constructPoints(t){this.m_XStart=t[0].x,this.m_YStart=t[0].y,this.m_XEnd=t[3].x,this.m_YEnd=t[3].y,this.m_cp[0].assign(t[1]),this.m_cp[1].assign(t[2]),this.afterCompletedModification()}constructFromQuadratic(t){const e=(0,r.m)(r.P,4);(function(t,e){e[0].assign(t[0]),e[3].assign(t[2]),(0,r.U)(t[0],t[1],2/3,e[1]),(0,r.U)(t[1],t[2],1/3,e[2])})(t,e),this.constructPoints(e)}constructFromQuadraticSegment(t){this.dropAllAttributes(),this.assignVertexDescription(t.getDescription()),this.m_XStart=t.getStartX(),this.m_YStart=t.getStartY(),this.m_XEnd=t.getEndX(),this.m_YEnd=t.getEndY(),(0,r._)(2,t.getStartXY(),t.getControlPoint1(),2/3,this.m_cp[0]),(0,r._)(2,t.getControlPoint1(),t.getEndXY(),1/3,this.m_cp[1]),this.afterCompletedModification(),O(this,t)}getGeometryType(){return n.G.enumBezier}queryEnvelope(t){if(2!==t.m_EnvelopeType)return void(0,n.g)(0);if(t.setCoords(this.getStartXY()),t.mergeNe(this.getEndXY()),t.contains(this.m_cp[0])&&t.contains(this.m_cp[1]))return;const e=Gs(this);if(null!==e){const s=new r.P;for(const n of e.specialPoints)this.queryCoord2D(n,s),t.mergeNe(s);return}const s=(0,r.m)(r.H,8),i=(0,r.m)(r.P,4);this.queryControlPoints(i);const o=yn(i,s),a=new r.P;for(let n=1;n<o-1;n++)this.queryCoord2D(s[n].value(),a),t.mergeNe(a)}applyTransformation(t){if(1===t.m_TransformationType){const e=(0,r.m)(r.P,4);return this.queryControlPoints(e),t.transformPoints2D(e,4,e),this.setStartXY(e[0]),this.m_cp[0].assign(e[1]),this.m_cp[1].assign(e[2]),this.setEndXY(e[3]),void zs(this)}(0,n.g)(0)}createInstance(){return new In({vd:this.m_description})}calculateLength2D(){return ks(this,1,!1)}calculateLowerLength2D(){return r.P.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return r.P.distance(this.getStartXY(),this.m_cp[0])+r.P.distance(this.m_cp[0],this.m_cp[1])+r.P.distance(this.getEndXY(),this.m_cp[1])}queryCoord2D(t,e){return this.queryCoord2DExtends(t,e,!0)}queryCoord2DMP(t,e){(0,n.g)(0)}queryCoord2DExtends(t,e,s){const n=(0,r.m)(r.P,4);this.queryControlPoints(n),Qs(n,t,e,s)}queryCoord2DE(t,e){Js(this,t,e)}getCoordX(t){if(t<0||t>1){const e=new r.P;return this.queryCoord2DExtends(t,e,!0),e.x}const e=(0,r.q)(this.getStartX(),this.m_cp[0].x,t),s=(0,r.q)(this.m_cp[0].x,this.m_cp[1].x,t),n=(0,r.q)(this.m_cp[1].x,this.getEndX(),t),i=(0,r.q)(e,s,t),o=(0,r.q)(s,n,t);return(0,r.q)(i,o,t)}getCoordY(t){if(t<0||t>1){const e=new r.P;return this.queryCoord2DExtends(t,e,!0),e.y}const e=(0,r.q)(this.getStartY(),this.m_cp[0].y,t),s=(0,r.q)(this.m_cp[0].y,this.m_cp[1].y,t),n=(0,r.q)(this.m_cp[1].y,this.getEndY(),t),i=(0,r.q)(e,s,t),o=(0,r.q)(s,n,t);return(0,r.q)(i,o,t)}cut(t,e,s){const n=new Yr;return this.queryCut(t,e,n,s),n.releaseSegment()}queryCut(t,e,s,n){const i=s.createCubicBezier();if(this.cutBezierIgnoreAttributes(t,e,i),n)return;i.assignVertexDescription(this.m_description);const r=this.m_description.getAttributeCount();if(r>1){for(let e=1;e<r;e++){const s=this.m_description.getSemantics(e),n=wn.getComponentCount(s);for(let e=0;e<n;e++){const n=this.getAttributeAsDbl(t,s,e);i.setStartAttribute(s,e,n)}}for(let t=1;t<r;t++){const s=this.m_description.getSemantics(t),n=wn.getComponentCount(s);for(let t=0;t<n;t++){const n=this.getAttributeAsDbl(e,s,t);i.setEndAttribute(s,t,n)}}}}queryDerivative(t,e){en(this,t,e)}cutBezierIgnoreAttributes(t,e,s){(t<0||e>1||t>e)&&(0,n.a)("Cubic_bezier.cut_bezier_ignore_attributes");const i=(0,r.m)(r.P,4);this.queryControlPoints(i);const o=(0,r.m)(r.P,4);Ks(i,t,e,o),s.setControlPoints(o)}splitBezierIgnoreAttributes(t,e,s){this===e&&this===s&&(0,n.a)("Cubic_bezier.split_bezier_ignore_attributes");const i=(0,r.m)(r.P,4);this.queryControlPoints(i);const o=(0,r.m)(r.P,4),a=(0,r.m)(r.P,4);$s(i,t,o,a),e&&e.setControlPoints(o),s&&s.setControlPoints(a)}getAttributeAsDbl(t,e,s){if(0===e)return 0===s?this.getCoordX(t):this.getCoordY(t);if(0===t)return this.getStartAttributeAsDbl(e,s);if(1===t)return this.getEndAttributeAsDbl(e,s);const n=this.getStartAttributeAsDbl(e,s),i=this.getEndAttributeAsDbl(e,s),o=this.calculateLength2D(),a=o>0?this.tToLength(t)/o:0,l=wn.getInterpolation(e);return(0,r.V)(l,n,i,a,wn.getDefaultValue(e))}getClosestCoordinate(t,e){const s=[Number.NaN];return _n(this,t,r.E.unit(),e,-1,1,s),s[0]}getClosestCoordinateOnInterval(t,e,s=-1){const n=[Number.NaN];return 0===_n(this,t,e,!1,s,1,n)?Number.NaN:n[0]}getYMonotonicParts(t,e=!1){return this.getMonotonicParts(t,e)}getMonotonicParts(t,e){t.length<2&&(0,n.a)("");const s=Ls(this);if(2===s.specialPointsCount()&&this.isMonotoneQuickAndDirty())return 0;let i=0;(0,n.g)(t.length>=s.specialPointsCount()-1);for(let n=1,r=s.specialPointsCount();n<r;++n)this.queryCut(s.specialPoints[n-1],s.specialPoints[n],t[i],e),i++;for(let n=0;n<i;++n)Xs(t[n].get());return i}intersectionWithAxis2D(t,e,s,n){const i=(0,r.m)(r.P,4);return this.queryControlPoints(i),function(t,e,s,n,i){const o=(0,r.m)(r.H,4),a=(0,r.m)(r.H,3),l=new r.E(0,1);let h=0;if(e){if(Fs(t,o,!1),h=Ot(o[3],o[2],o[1],o[0].sub(s),l,!1,a),n)for(let u=0;u<h;u++){const e=new r.P;Qs(t,a[u].value(),e),n[u]=e.x}}else if(Ns(t,o,!1),h=Ot(o[3],o[2],o[1],o[0].sub(s),l,!1,a),n)for(let u=0;u<h;u++){const e=new r.P;Qs(t,a[u].value(),e),n[u]=e.y}if(i)for(let r=0;r<h;r++)i[r]=a[r].value();else n&&(0,r.C)(n,0,h,r.a8);return h}(i,t,e,s,n)}intersectionOfYMonotonicWithAxisX(t,e){if(this.m_YStart===this.m_YEnd)return t===this.m_YStart?e:Number.NaN;if(t===this.m_YStart)return this.m_XStart;if(t===this.m_YEnd)return this.m_XEnd;const s=[0,0],i=this.intersectionWithAxis2D(!0,t,s,null);return(0,n.g)(2!==i),-1===i?e:s[0]}isCurve(){return!0}isDegenerate(t){return w(this,t)}isDegenerate3D(t,e){return(0,n.g)(0),!1}queryLooseEnvelope(t){if(2===t.m_EnvelopeType)return t.setCoords({pt:this.getStartXY()}),t.mergeNe(this.m_cp[0]),t.mergeNe(this.m_cp[1]),void t.mergeNe(this.getEndXY());(0,n.g)(0)}clone(t){const e=this.createInstance();return this.copyTo(e),e}queryInterval(t,e){if(0===t){const t=o.Envelope2D.constructEmpty();this.queryEnvelope(t);const s=r.E.constructEmpty();return 0===e?t.queryIntervalX(s):t.queryIntervalY(s),s}return super.queryInterval(t,e)}queryLooseEnvelopeOnInterval(t,e){const s=(0,r.m)(r.P,4);this.queryControlPoints(s),Ks(s,t.vmin,t.vmax,s),e.setFromPoints(s,4)}changeEndPoints2D(t,e){if(t.isEqual(this.m_XStart,this.m_YStart)&&e.isEqual(this.m_XEnd,this.m_YEnd))return;const s=this.m_cp[0].isEqual(this.m_XStart,this.m_YStart),n=this.m_cp[0].isEqual(this.m_XEnd,this.m_YEnd),i=this.m_cp[1].isEqual(this.m_XStart,this.m_YStart),r=this.m_cp[1].isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(t),this.setEndXY(e),s?this.m_cp[0].setCoordsPoint2D(t):n&&this.m_cp[0].setCoordsPoint2D(e),r?this.m_cp[1].setCoordsPoint2D(e):i&&this.m_cp[1].setCoordsPoint2D(t),this.normalizeAfterEndpointChange()}tToLength(t){return ks(this,t,!0)}lengthToT(t){return function(t,e){const s=ks(t,1,!1);if(e<=0)return e;if(e>=s)return e-s+1;const i=[0];return 1!==Mt(new bn(t,e),r.E.unit(),1,i)&&(0,n.d)(""),i[0]}(this,t)}calculateWeightedAreaCentroid2D(t){const e=(0,r.m)(r.P,4);As(this,e);const s=e[3],n=e[2],i=e[1],o=new r.P;o.x=(5*s.x*s.x*(7*n.y+16*i.y)+s.x*(-35*s.y*n.x+40*n.x*n.y-80*s.y*i.x+140*n.x*i.y+112*i.x*i.y)-2*(s.y*(20*n.x*n.x+70*n.x*i.x+56*i.x*i.x)-7*(4*n.x+5*i.x)*(-n.y*i.x+n.x*i.y)))/840,o.y=(-5*s.y*s.y*(7*n.x+16*i.x)+s.y*(5*s.x*(7*n.y+16*i.y)-4*(10*n.x*n.y+35*n.y*i.x+28*i.x*i.y))+2*(-7*(4*n.y+5*i.y)*(n.y*i.x-n.x*i.y)+s.x*(20*n.y*n.y+70*n.y*i.y+56*i.y*i.y)))/840;const a=Hs(this);return o.x+=(e[0].x-t.x)*a,o.y+=(e[0].y-t.y)*a,o}calculateWeightedCentroid2D(){const t=new r.P;return this.isDegenerate(0)?(t.setCoords(0,0),t):function(t){const e=r.P.distance(t.getStartXY(),t.getEndXY()),s=t.calculateUpperLength2D();return s-e<=8*Number.EPSILON*s}(this)?(t.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),t):(t.assign(function(t,e,s){void 0===s&&(s=e,e=0);const i=new r.P;if(e<0||s>1)return i.setNAN(),i;if(e>s&&(0,n.a)("calculate_sub_weightedCentroid"),e===s||t.isDegenerate(0))return i.setCoords(0,0),i;const o=Ls(t),a=Ts(t),l=a/t.calculateUpperLength2D();let h=e,u=0;for(let n=1,r=o.specialPointsCount();n<r;n++)if(e<o.specialPoints[n]){u=n-1;break}i.setCoords(0,0);for(let n=u+1,r=o.specialPointsCount();n<r;n++){const e=Math.min(o.specialPoints[n],s),r=En(t,h,e,l,a);if(i.addThis(r),h=e,s<=o.specialPoints[n])break}return i.add(t.getStartXY().mul(t.calculateLength2D()))}(this,1)),t)}getControlPoint1(){return this.m_cp[0].clone()}setControlPoint1(t){this.m_cp[0].setCoordsPoint2D(t),this.afterCompletedModification()}getControlPoint2(){return this.m_cp[1].clone()}setControlPoint2(t){this.m_cp[1].setCoordsPoint2D(t),this.afterCompletedModification()}queryControlPoints(t){t[0].assign(this.getStartXY()),t[1].assign(this.m_cp[0]),t[2].assign(this.m_cp[1]),t[3].assign(this.getEndXY())}queryControlPointsHelper(t){return this.queryControlPoints(t),4}setControlPoints(t){for(let e=0;e<4;e++)t[e].isNAN()&&(0,n.a)("NAN control points in bezier are not supported");this.m_XStart=t[0].x,this.m_YStart=t[0].y,this.m_cp[0].setCoordsPoint2D(t[1]),this.m_cp[1].setCoordsPoint2D(t[2]),this.m_XEnd=t[3].x,this.m_YEnd=t[3].y,this.afterCompletedModification()}getTangent(t){const e=(0,r.m)(r.P,4);return this.queryControlPoints(e),tn(e,t)}getDerivative(t){const e=(0,r.m)(r.P,4);return this.queryControlPoints(e),Bs(e,1,t)}getCurvature(t){const e=Us(this,1,t),s=Us(this,2,t),n=e.sqrLength();return 0===n?Number.NaN:(e.divThis(Math.sqrt(n)),e.crossProduct(s)/n)}isIntersectingPoint(t,e,s){if(s&&(t.equals(this.getStartXY())||t.equals(this.getEndXY())))return!1;const n=new o.Envelope2D;if(this.queryLooseEnvelope(n),n.inflateCoords(e,e),!n.contains(t))return!1;const i=this.getClosestCoordinate(t,!1),a=new r.P;return this.queryCoord2D(i,a),r.P.distance(a,t)<=e}isIntersectingPoint3D(t,e,s,i,r=1){return(0,n.g)(0),!1}isMonotoneQuickAndDirty(){const t=(0,r.m)(r.P,4);return this.queryControlPoints(t),Zs(t)}getMonotonicPartParams(t,e){const s=Ls(this),i=s.specialPointsCount();if((0,n.g)(X.s_maxMonotonicPartParams>=i),!e)return s.specialPointsCount();t<i&&(0,n.a)("");for(let n=0;n<i;n++)e[n]=s.specialPoints[n];return i}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=(0,r.c)(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=(0,r.c)(this.m_YStart,this.m_YStart=this.m_YEnd);for(let t=0,e=this.m_description.getTotalComponentCount()-2;t<e;t++)this.m_attributes[t+e]=(0,r.c)(this.m_attributes[t],this.m_attributes[t]=this.m_attributes[t+e]);this.m_cp[1]=(0,r.c)(this.m_cp[0],this.m_cp[0]=this.m_cp[1]),this.m_cachedValues=null}}findMinDeriv(){const t=new r.H;return qs(this,t),t.value()}isLine(){return!1}isDegenerateToLineHelper(t){const e=(0,r.m)(r.P,4);this.queryControlPoints(e);const s=e[3].sub(e[0]),n=s.length();if(r.P.distance(e[0],e[1])+r.P.distance(e[2],e[1])+r.P.distance(e[2],e[3])-n>t)return!1;const i=t;let o=e[1].clone();o.subThis(e[0]);let a=Math.abs(o.crossProduct(s))/n;return!(a>i||(o=e[2].clone(),o.subThis(e[1]),a=Math.abs(o.crossProduct(s))/n,a>i))}copyIgnoreAttributes(t){const e=(0,r.m)(r.P,4);this.queryControlPoints(e),t.setControlPoints(e)}calculateArea2DHelper(){return Hs(this)}absNorm(){return function(t){return t.getStartXY().norm(1)+t.getEndXY().norm(1)+t.m_cp[0].norm(1)+t.m_cp[1].norm(1)}(this)}queryEnvelopeW(t,e){mn(this,t,e)}setSegmentFromCoordsForStitcher(t,e){!function(t,e,s){if((0,n.g)(s>=2),2===s){const n=new r.P;(0,r.U)(e[0],e[s-1],1/3,n);const i=new r.P;return(0,r.U)(e[0],e[s-1],2/3,i),void t.construct(e[0],n,i,e[s-1])}const i=e[0],o=e[s-1],a=[0,0],l=_n(t,i,r.E.unit(),!1,Number.NaN,2,a),h=[0,0],u=_n(t,o,r.E.unit(),!1,Number.NaN,2,h),c=[];for(let n=0;n<l;n++)for(let l=0;l<u;l++){const u=a[n],m=h[l],d=u>m,g=(n,a)=>{const l=(0,r.d)(s-2,Number.NaN),h=()=>{let t=0;for(let n=1,i=s-1;n<i;n++){t+=r.P.distance(e[n-1],e[n]);const s=t;l[n-1]=s}t+=r.P.distance(e[s-2],e[s-1]),d&&l.reverse();for(let e=1,n=s-1;e<n;e++)l[e-1]/=t,d&&(l[e-1]=1-l[e-1])};let c=!1,g=!1;{const e=new Yr;d?(t.queryCut(m,u,e,!0),n.assign(e.get().getControlPoint2()),a.assign(e.get().getControlPoint1())):(t.queryCut(u,m,e,!0),n.assign(e.get().getControlPoint1()),a.assign(e.get().getControlPoint2())),i.equals(n)&&(c=!0),o.equals(a)&&(g=!0)}h();let p=Number.MAX_VALUE;const _=n.clone(),f=a.clone();for(let t=0;t<5;t++)p=Cn(!0,!1,i,_,f,o,c,g,l,s-2,e,s);for(let t=0;t<30;t++){const t=_.clone();f.clone();const n=Cn(!0,!0,i,_,f,o,c,g,l,s-2,e,s);if(p<=n&&t.equals(_)&&t.equals(f))break;p=n}h();let y=!1,x=Number.MAX_VALUE;const v=n.clone(),b=a.clone();for(let t=0;t<30;t++){const t=v.clone();b.clone();const n=Cn(y,!0,i,v,b,o,c,g,l,s-2,e,s);if(x<=n&&t.equals(v)&&t.equals(b))break;y=!0,x=n}return x<p?(n.assign(v),a.assign(b)):(n.assign(_),a.assign(f),x=p),x},p=new r.P,_=new r.P,f=[g(p,_),r.P.distance(i,p)+r.P.distance(p,_)+r.P.distance(_,o),p.x,p.y,_.x,_.y];c.splice(c.length,0,...f)}let m=c[0],d=c[1],g=0;for(let n=6;n<c.length;n+=6)c[n]<m&&(m=c[n],d=c[n+1],g=n);let p=g;for(let n=0;n<c.length;n+=6)n!==g&&c[n+1]<d&&Math.abs(m-c[n])<10*m&&(d=c[n+1],p=n);t.construct(i,new r.P(c[p+2],c[p+3]),new r.P(c[p+4],c[p+5]),o)}(this,t,e)}writeInBufferStream(t,e){const s=new Float64Array(4);return this.writeInBuffer_(s),t.writeRangeFromArray(e,s.length,s,!0,1),e+s.length}writeInBuffer_(t){return t[0]=this.m_cp[0].x,t[1]=this.m_cp[0].y,t[2]=this.m_cp[1].x,t[3]=this.m_cp[1].y,4}readFromBufferStream(t,e){const s=new Float64Array(4);t.queryRange(e,s.length,s,!0,1),this.readFromBuffer_(s)}readFromBuffer_(t){this.m_cp=(0,r.m)(r.P,2),this.m_cp[0].x=t[0],this.m_cp[0].y=t[1],this.m_cp[1].x=t[2],this.m_cp[1].y=t[3],this.m_cachedValues=null}snapControlPoints(t){const e=(0,r.m)(r.P,4);this.queryControlPoints(e);const s=(e,s,n)=>{let i=!1;return r.P.sqrDistance(e,n)<=t&&(i=!e.equals(n),e.setCoordsPoint2D(n),r.P.sqrDistance(s,n)<=t&&(i||=!s.equals(n),s.setCoordsPoint2D(n))),i},n=s(e[1],e[2],e[0]),i=s(e[2],e[1],e[3]);return(n||i)&&this.setControlPoints(e),n||i}needsSnapControlPoints(t){if(!t)return!1;const e=(0,r.m)(r.P,4);this.queryControlPoints(e);const s=(e,s,n)=>{let i=!1;return r.P.sqrDistance(e,n)<=t&&(i=!e.equals(n),e.setCoordsPoint2D(n),r.P.sqrDistance(s,n)<=t&&(i||=!s.equals(n),s.setCoordsPoint2D(n))),i},n=s(e[1],e[2],e[0]),i=s(e[2],e[1],e[3]);return n||i}calculateSpecialPointsForCracking(t,e){return function(t,e,s){s.length=0;{const e=new r.H;qs(t,e);const n=new v;if(en(t,e,n),n.isZero())return e.isZero()||e.eq(new r.H(1))?0:(s.push(e.value()),1)}const n=(0,r.m)(r.H,4);Ms(t,n,!0);const i=(0,r.m)(r.H,4);Ds(t,i,!0);const o=(0,r.m)(r.H,6),a=n[3].negate().mulE(i[1]).addE(n[2].mulE(i[2]).mul(2)).addE(n[1].mulE(i[3])),l=n[3].negate().mulE(i[1]).subE(n[2].mulE(i[2]).mul(2)).addE(n[1].mulE(i[3])),h=n[2].mulE(n[2]).subE(i[2].mulE(i[2]));o[0]=i[1].mulE(i[1]).mulE(a).addE(n[1].mulE(n[1]).mulE(l)).addE(n[1].mulE(i[1]).mulE(h).mul(2)).mul(6),o[1]=n[2].mulE(i[1]).subE(n[1].mulE(i[2])).mulE(n[2].mulE(n[2]).addE(n[1].mulE(n[3]).mul(2)).addE(i[2].mulE(i[2])).addE(i[1].mulE(i[3]).mul(2))).mul(24);const u=n[1].mulE(i[2]).mulE(i[2]).mulE(i[3]),c=n[2].mulE(n[2]).mulE(n[3]).mulE(i[1]).subE(u).mul(156),m=n[3].mulE(i[1]).subE(n[1].mulE(i[3])),d=n[3].mulE(i[1]).subE(n[1].mulE(i[3])),g=n[1].mulE(n[3]).mulE(d).addE(i[1].mulE(i[3]).mulE(m)).mul(72),p=i[1].mulE(i[3]).subE(n[1].mulE(n[3])),_=n[2].mulE(i[2]).mulE(p).mul(120),f=n[1].mulE(n[2]).mulE(n[2]).mulE(i[3]),y=n[3].mulE(i[1]).mulE(i[2]).mulE(i[2]).subE(f).mul(36);o[2]=c.addE(g).addE(_).addE(y);const x=n[2].mulE(n[3]).mulE(n[3]).mulE(i[1]).subE(n[1].mulE(i[2]).mulE(i[3]).mulE(i[3])).mul(360),b=n[2].mulE(i[2]).mulE(n[2].mulE(n[3]).subE(i[2].mulE(i[3]))).addE(n[3].mulE(i[2]).mulE(i[2]).mulE(i[2])).subE(n[2].mulE(n[2]).mulE(n[2]).mulE(i[3])).mul(24),P=n[2].mulE(i[1]).mulE(i[3]).mulE(i[3]).subE(n[1].mulE(n[3]).mulE(n[3]).mulE(i[2])).mul(72),S=n[3].mulE(i[3]).mulE(i[1].mulE(i[2]).subE(n[1].mulE(n[2]))).mul(288);o[3]=x.addE(b).addE(P).addE(S),o[4]=i[3].mulE(i[3]).addE(n[3].mulE(n[3])).mulE(n[3].mulE(i[1]).subE(n[1].mulE(i[3]))).mul(270).addE(n[3].mulE(i[2]).subE(n[2].mulE(i[3]))).mulE(n[2].mulE(n[3]).addE(i[2].mulE(i[3]))).mul(180),o[5]=n[3].mulE(i[2]).subE(n[2].mulE(i[3])).mulE(n[3].mulE(n[3]).addE(i[3].mulE(i[3]))).mul(216);const E=(0,r.m)(r.H,5),C=qt(o,5,new r.E(0,1),!1,E,5);if(C>0){let n=Math.abs(t.getCurvature(0)),i=0;const o=Math.abs(t.getCurvature(1));(o>n||!Number.isFinite(o))&&(i=1);for(let e=0;e<C;e++){const s=Math.abs(t.getCurvature(E[e].value()));t.getCoord2D(E[e].value()),(s>n||!Number.isFinite(s))&&(n=s,i=E[e].value())}if((!Number.isFinite(n)||1/n<e)&&!(0,r.N)(i,0,1)){const e=t.getCoord2D(i);if(!e.equals(t.getStartXY())&&!e.equals(t.getEndXY()))return s.push(i),1}}if(!t.isClosed()){const e=[0,0],n=fn(t,e,!1);for(let t=0;t<n;t++)e[t]>0&&e[t]<1&&s.push(e[t]);return s.length}return 0}(this,t,e)}ensureXYMonotone(){return Xs(this)}setCoordsForIntersector(t,e,s){!function(t,e,s,n){if(e.isEqual(t.m_XStart,t.m_YStart)&&s.isEqual(t.m_XEnd,t.m_YEnd))return;const i=!!n&&t.isMonotoneQuickAndDirty(),o=new a.T,l=(0,r.m)(r.P,3);l[0].setCoords(t.m_XStart,t.m_YStart),l[2].setCoords(t.m_XEnd,t.m_YEnd);const h=new r.P;h.setSub(l[2],l[0]),h.leftPerpendicularThis(),l[1].setAdd(l[0],h);const u=(0,r.m)(r.P,3);u[0].setCoordsPoint2D(e),u[2].setCoordsPoint2D(s),h.setSub(u[2],u[0]),h.leftPerpendicularThis(),u[1].setAdd(u[0],h),o.setFromTwoTriangles(l,u)?o.transformPoints2D(t.m_cp,2,t.m_cp):((0,r.U)(e,s,1/3,t.m_cp[0]),(0,r.U)(e,s,2/3,t.m_cp[1])),t.changeEndPoints2D(e,s),i&&Xs(t)}(this,t,e,s)}copyToImpl(t){const e=t;e.m_cp[0].assign(this.m_cp[0]),e.m_cp[1].assign(this.m_cp[1]),Vs(e,Gs(this))}reverseImpl(){this.m_cp[1]=(0,r.c)(this.m_cp[0],this.m_cp[0]=this.m_cp[1])}equalsImpl(t){const e=t;return!!this.m_cp[0].equals(e.m_cp[0])&&!!this.m_cp[1].equals(e.m_cp[1])}equalsImplTol(t,e){const s=t;return!!this.m_cp[0].isEqualPoint2D(s.m_cp[0],e)&&!!this.m_cp[1].isEqualPoint2D(s.m_cp[1],e)}swapImpl(t){const e=t;e.m_cp[0]=(0,r.c)(this.m_cp[0],this.m_cp[0]=e.m_cp[0]),e.m_cp[1]=(0,r.c)(this.m_cp[1],this.m_cp[1]=e.m_cp[1]),function(t,e){e.m_cachedValues=(0,r.c)(t.m_cachedValues,t.m_cachedValues=e.m_cachedValues)}(this,e)}afterCompletedModification(){zs(this)}isIntersecting(t,e,s){return 0!==Nr(!1,this,t,e,s)}intersect(t,e,s,n,i){return Lr(!1,this,t,e,s,n,i)}intersectPoint(t,e,s){return function(t,e,s,i){const o=new _;if(mn(t,r.E.unit(),o),o.inflate(i),!o.isIntersectingPoint2D(e))return 0;const a=Ls(t);let l=0,h=a.specialPoints[0];const u=[];for(let r=1,c=a.specialPoints.length;r<c;++r){const s=a.specialPoints[r],i=Os(t,e,h,s);if(0===u.length)u.push(i);else if(i.t===i.tmin)(0,n.g)(u.at(-1).d<=i.d),u.at(-1).tmax=i.tmax;else if(u.at(-1).t===u.at(-1).tmax){(0,n.g)(u.at(-1).d>=i.d);const t=u.at(-1).tmin;u[u.length-1]=i,u.at(-1).tmin=t}else u.push(i);h=s}for(const r of u)if(r.d<=i){const t=r.t;s?(l>=s.length&&(0,n.q)(""),s[l]=t,l++):l++}return l}(this,t,e,s)}endPointModified(){zs(this)}clearEndPointModified(){}}In.type=n.G.enumBezier;class Tn{constructor(){this.length=Number.NaN,this.area=Number.NaN,this.centroidX=Number.NaN,this.centroidY=0,this.specialPoints=[],this.specialPointsLength=[]}specialPointsCount(){return this.specialPoints.length}}function An(t,e,s,i,o,a,l,h){for(;;){const u=r.P.distance(e[0],e[2]),c=r.P.distance(e[0],e[1])+r.P.distance(e[1],e[2]);if(c-u<=o+i*c)return t+(0,r.q)(u,c,.5);const m=(0,r.m)(r.P,4),d=t=>(zn(e,s,1,t,m),m[1].length());if(0===l&&h<8){(0,n.g)(h<8);let u=d(0),m=d(1);a[0]+=2,u>m&&(m=(0,r.c)(u,u=m),e[2]=(0,r.c)(e[0],e[0]=e[2]),s[2]=(0,r.c)(s[0],s[0]=s[2]));let g=u/(u+m),p=1,_=c;for(;g<1/32&&_>=o+i*_;){p/=4;const t=d(p);a[0]++,g=u/(t+u);const n=new r.P;if(_i(e,s,.5*p,n),_=r.P.distance(n,e[0]),_<=o){const t=new r.P;_i(e,s,p,t),_+=r.P.distance(t,n)}}if(1!==p){const n=(0,r.m)(r.P,3),u=[0,0,0];si(e,s,p,e,s,n,u),t=An(t,n,u,i,o,a,0,h+1),l++,h++;continue}}let g=!1;const p=8;a[0]+=p;const _=rs(p,d,0,1),f=16;a[0]+=f;const y=rs(f,d,0,1);if(g=Math.abs(_-y)>o+i*c,!g)return t+y;if(l<8&&h<9){const n=(0,r.m)(r.P,3),u=[0,0,0];si(e,s,.5,e,s,n,u),t=An(t,n,u,i,o,a,l+1,h+1),l++,h++;continue}const x=32;a[0]+=x;const v=rs(x,d,0,1);if(g=Math.abs(y-v)>o+i*c,!g)return t+v;const b=64;a[0]+=b;const P=rs(b,d,0,1);if(g=Math.abs(v-P)>o+i*c,!g)return t+P;const S=128;a[0]+=S;const E=rs(S,d,0,1);return g=Math.abs(P-E)>o+i*c,t+E}}function Mn(t,e,s,n,i){if(s===e)return 0;const o=(0,r.m)(r.P,3),a=[0,0,0];t.queryControlPoints(o),t.queryWeights(a);const l=[0,0,0],h=(0,r.m)(r.P,3);return ni(o,a,e,s,h,l),An(0,h,l,n,i,[0],0,0)}class Dn{constructor(t,e,s){this.controlPoints=(0,r.L)(t,3),this.weights=[0,0,0],(0,r.b)(this.weights,e,0,0,3),this.point=s.clone()}getMaxDerivative(){return 3}getValue(t,e){if(0===t){const t=new r.P;_i(this.controlPoints,this.weights,e,t);const s=(0,r.m)(r.P,4);return zn(this.controlPoints,this.weights,1,e,s),2*t.sub(this.point).dotProduct(s[1])}if(1===t){const t=new r.P;_i(this.controlPoints,this.weights,e,t);const s=(0,r.m)(r.P,4);return zn(this.controlPoints,this.weights,2,e,s),2*(t.sub(this.point).dotProduct(s[2])+s[1].dotProduct(s[1]))}if(2===t){const t=new r.P;_i(this.controlPoints,this.weights,e,t);const s=(0,r.m)(r.P,4);return zn(this.controlPoints,this.weights,3,e,s),2*(t.sub(this.point).dotProduct(s[3])+3*s[1].dotProduct(s[2]))}return 0}getError(t){return(0,n.g)(0),0}}function Nn(t,e,s,n){const i=function(t,e,s,n,i){return{tmin:t,tmax:e,t:s,d:n,pt:i.clone()}}(0,0,0,0,r.P.getNAN()),o=(0,r.d)(18,Number.NaN),a=(0,r.m)(r.P,3);t.queryControlPoints(a),a[2].subThis(e),a[1].subThis(e),a[0].subThis(e);const l=[0,0,0];t.queryWeights(l);const h=[1,yi(l),1],u=vi(l,s),c=vi(l,n),m=Mt(new Dn(a,h,new r.P(0,0)),r.E.construct(u,c),18,o);_i(a,h,u,i.pt),i.t=u,i.d=r.P.distance(i.pt,new r.P(0,0));const d=new r.P;_i(a,h,c,d);const g=r.P.distance(d,new r.P(0,0));g<i.d&&(i.d=g,i.t=c,i.pt.assign(d));for(let p=0;p<m;p++){_i(a,h,o[p],d);const t=r.P.distance(d,new r.P(0,0));t<i.d&&(i.d=t,i.t=xi(l,o[p]),i.pt.assign(d))}return i}function Fn(t,e,s,n,i){let o=!0;const a=(0,r.m)(r.P,4),l=ye(5,e,s,n,i,(e=>(Vn(t,1,e,a),(o?t.getCoordX(e)-t.getStartX():t.getCoordY(e)-t.getStartY())*a[1].length())));o=!1;const h=ye(5,e,s,n,i,(e=>(Vn(t,1,e,a),(o?t.getCoordX(e)-t.getStartX():t.getCoordY(e)-t.getStartY())*a[1].length())));return new r.P(l,h)}function Rn(t){t.m_cachedValues=null}function kn(t){if(t.m_cachedValues)return t.m_cachedValues;const e=new Tn,s=(0,r.m)(r.P,3);t.queryControlPoints(s);const n=[0,0,0];return t.queryWeights(n),Ln(s,n,e.specialPoints),Zn(t,e),e}function Ln(t,e,s){if(0===e[1])return s.length=0,s.push(0),void s.push(1);const n=(0,r.m)(r.H,8);n[0].set(0);let i=1;{const s=new r.H(t[1].x).subThis(t[0].x).mulThis(e[1]).mulThis(e[0]),o=new r.H(t[2].x).subThis(t[0].x).mulThis(e[2]).mulThis(e[0]),a=s.subE(o).addThisE(new r.H(t[2].x).subThis(t[1].x).mulThis(e[2]).mulThis(e[1]));o.subThisE(s.mul(2));const l=(0,r.m)(r.H,2);let h=zt(a,o,s,new r.E(0,1),!1,l);h<0&&(h=0);for(let t=0;t<h;t++)(0,r.N)(l[t].value(),0,1)||(n[i]=l[t],i++)}{const s=new r.H(t[1].y).subThis(t[0].y).mulThis(e[1]).mulThis(e[0]),o=new r.H(t[2].y).subThis(t[0].y).mulThis(e[2]).mulThis(e[0]),a=s.subE(o).addThisE(new r.H(t[2].y).subThis(t[1].y).mulThis(e[2]).mulThis(e[1]));o.subThisE(s.mul(2));const l=(0,r.m)(r.H,2);let h=zt(a,o,s,new r.E(0,1),!1,l);h<0&&(h=0);for(let t=0;t<h;t++)(0,r.N)(l[t].value(),0,1)||(n[i]=l[t],i++)}if(n[i].set(1),i++,i>2){(0,r.C)(n,0,i,((t,e)=>(0,r.a8)(t.value(),e.value())));let t=0,e=n[0].value(),s=1;for(let r=1;r<i;r++)n[r].eq(n[r-1])?(e+=n[r].value(),s++):(s>1&&(e/=s,n[t].set(e)),t++,n[t]=n[r],e=n[r].value(),s=1);t++,i=t}n[0].set(0),n[i-1].set(1),s.length=i;for(let r=0;r<i;r++)s[r]=n[r].value()}function Gn(t,e,s){if(s){if(e<0)return e;if(e>1)return e-1+Gn(t,1,!1)}if(t.isDegenerate(0))return 0;const n=1===e,i=kn(t);if(n&&!Number.isNaN(i.length))return i.length;const r=Xn(t),o=r/t.calculateUpperLength2D();let a=0,l=0;for(let h=1,u=i.specialPointsCount();h<u;h++){const s=i.specialPoints[h];if(a+=Mn(t,l,Math.min(e,s),o,r),e<=s)break;l=s}return n&&(i.length=a),a}function Vn(t,e,s,n){const i=(0,r.m)(r.P,3);t.queryControlPoints(i);const o=[0,0,0];t.queryWeights(o),zn(i,o,e,s,n)}function zn(t,e,s,i,o){const a=[t[0],t[1],t[2]],l=[e[0],e[1],e[2]],h=(0,r.m)(r.P,4);!function(t,e,s,i,r){(0,n.g)(s>0);const o=[t[0].clone(),t[1].clone(),t[2].clone()];if(!o[0].isZero()){for(let t=1;t<3;++t)o[t].subThis(o[0]);o[0].setCoords(0,0)}const a=On(o,e,0,i),l=Bn(e,0,i),h=a.divide(l);if(r[0].assign(h),0===s)return;const u=[e[1]*e[0],e[2]*e[0]*.5,e[1]*e[2]],c=[t[1].sub(t[0]),t[2].sub(t[0]),t[2].sub(t[1])],m=l*l,d=On(c,u,0,i).mul(2).divide(m);if(r[1].assign(d),1===s)return;const g=Bn(e,1,i),p=2*l*g,_=On(c,u,1,i).mul(2).sub(d.mul(p)).divide(m);if(r[2].assign(_),2===s)return;const f=On(c,u,2,i).mul(2),y=2*(g*g+l*Bn(e,2,i)),x=f.sub(_.mul(p).mul(2)).sub(d.mul(y)).divide(m);r[3].assign(x),3!==s&&(0,n.d)("")}(a,l,s,i,h);for(let n=0;n<=s;n++)o[n].setCoords(h[n].x,h[n].y)}function On(t,e,s,i){if(0===s){if(i<=.5){const s=new r.P;(0,r.a2)(2,t[0].mul(e[0]),t[1].mul(e[1]),i,s);const n=new r.P;(0,r.a2)(2,t[1].mul(e[1]),t[2].mul(e[2]),i,n);const o=new r.P;return(0,r.a2)(2,s,n,i,o),o}{const s=new r.P;(0,r.a3)(2,t[0].mul(e[0]),t[1].mul(e[1]),i,s);const n=new r.P;(0,r.a3)(2,t[1].mul(e[1]),t[2].mul(e[2]),i,n);const o=new r.P;return(0,r.a3)(2,s,n,i,o),o}}if(1===s){const s=t[1].mul(e[1]),n=s.sub(t[0].mul(e[0])).mul(1-i).add(t[2].mul(e[2]).sub(s).mul(i));return n.mulThis(2),n}if(2===s){const s=t[1].mul(e[1]),n=t[2].mul(e[2]).sub(s).sub(s.sub(t[0].mul(e[0])));return n.mulThis(2),n}(0,n.d)("")}function qn(t,e,s,n){if(n.toDouble()<=.5){const s=new v;(0,r.a4)(2,t[0].mulE(e[0]),t[1].mulE(e[1]),n,s);const i=new v;(0,r.a4)(2,t[1].mulE(e[1]),t[2].mulE(e[2]),n,i);const o=new v;return(0,r.a4)(2,s,i,n,o),o}{const s=new v;(0,r.a5)(2,t[0].mulE(e[0]),t[1].mulE(e[1]),n,s);const i=new v;(0,r.a5)(2,t[1].mulE(e[1]),t[2].mulE(e[2]),n,i);const o=new v;return(0,r.a5)(2,s,i,n,o),o}}function Bn(t,e,s){if(0===e){const e=(0,r.q)(t[0],t[1],s),n=(0,r.q)(t[1],t[2],s);return(0,r.q)(e,n,s)}return 1===e?2*((1-s)*(t[1]-t[0])+(t[2]-t[1])*s):2===e?2*(t[2]-t[1]-(t[1]-t[0])):void(0,n.d)("")}function Yn(t,e,s){const n=(0,r.s)(s,0,1),i=(0,r.m)(r.P,4);if(zn(t,e,3,n,i),i[1].isZero()){if(i[2].isZero())return i[3];{const t=i[2].clone();return 1===n&&t.negateThis(),t}}return i[1]}class Un{constructor(t,e){this.len=0,this.b=t,this.len=e}getMaxDerivative(){return 1}getValue(t,e){return 0===t?this.len-Gn(this.b,e,!1):0}getError(t){return(0,n.g)(0),0}}function Hn(t){const e=(0,r.m)(r.P,3),s=[0,0,0];return t.queryControlPoints(e),t.queryWeights(s),function(t,e){const s=yi(e);if(1===s)return Re(t);if(0===s)return 0;const i=[new r.P(0,0),t[1].sub(t[0]),t[2].sub(t[0])],o=i[1].crossProduct(i[2]);if(s<1){(0,n.g)(s>0);const t=1-s;let e;if(t<.01)e=-1/3+t*(2/15+t*(3/35+t*(16/315+t*(20/693+t*(16/1001+t*(56/6435))))));else{const n=t*(1+s),i=Math.atan2(Math.sqrt(t),Math.sqrt(1+s));e=s*(.5*s-(0,r.ap)(n)*i)/n}return o*e}{const t=(s-1)*(s+1);return.25*s/Math.pow(t,1.5)*(-2*s*Math.sqrt(t)*o-4*i[1].y*i[2].x*Math.atanh(Math.sqrt((s-1)/(s+1)))-i[1].x*i[2].y*Math.log(2*s*(s-Math.sqrt(t))-1))}}(e,s)}function Xn(t){return function(t){return 256*(0,r.O)()*t}(t.calculateUpperLength2D())}function jn(t){return t.m_cachedValues}function Zn(t,e){t.m_cachedValues=e}function Wn(t,e,s,n,i){const o=(0,r.m)(r.P,3);t.queryControlPoints(o);const a=[0,0,0];t.queryWeights(a);const l=[0];return 1===$n(o,a,e,r.E.unit(),n,i,1,l)?l[0]:Number.NaN}function $n(t,e,s,o,a,l,h,u){(0,n.x)(r.E.unit().contains(o)&&h>0,""),(l<0||Number.isNaN(l))&&(l=Number.MAX_VALUE);const c=new Array(3);for(let n=0;n<3;++n)c[n]=t[n].sub(s);const m=yi(e),d=P.constructPoint2D(c[0]),g=P.constructPoint2D(c[1]),p=P.constructPoint2D(c[2]),_=r.M.constructDouble(m),f=_.clone();f.ldexpThis(1);const y=d.dotProduct(g.sub(d)).mul(_),x=_.mul(_.addDouble(2)),v=p.sub(g.mul(x.ldexp(1))),b=g.sqrLength().mul(_.mul(_).ldexp(1)).add(d.sqrLength().mul(_.ldexp(2).subDouble(1))).add(d.dotProduct(v)),S=p.sub(g.mul(f)).add(d.mul(f.subDouble(1))),E=g.mul(_).sub(d).dotProduct(S).mulDouble(3),C=g.dotProduct(p).mul(_.subDouble(3).mul(_)).ldexp(1),w=g.sqrLength().mul(_.mul(_).ldexp(2)),I=d.sqrLength().mul(_.ldexp(2).subDouble(3)),T=d.dotProduct(p.sub(g.mul(_.mulDouble(3).subDouble(1)).mul(_))).ldexp(1),A=p.sqrLength().addThis(C).addThis(w).addThis(I).addThis(T),M=d.add(p).sub(g.mul(f)),D=_.subDouble(1),N=p.sub(d).dotProduct(M).mul(D),F=new r.P(0,0),R=[];let k=new r.P;_i(c,e,o.vmin,k);let L=r.P.distance(k,F);if(L<=l&&R.push(new r.P(o.vmin,L)),o.vmin!==o.vmax&&(_i(c,e,o.vmax,k),L=r.P.distance(k,F),L<=l&&R.push(new r.P(o.vmax,L))),o.width()>0){const t=c[2].isZero(),s=(0,r.m)(r.M,4),n=oe(N,A,E,b,y,58,o,t,s);for(let i=0;i<n;i++){if(!o.containsExclusiveCoordinate(s[i].toDouble()))continue;let t=s[i].toDouble();t=xi(e,t);const n=new r.P;_i(c,e,t,n),L=r.P.distance(n,F),L<=l&&R.push(new r.P(t,L))}}if(a){(0,n.g)(o.equals(r.E.unit()));{_i(c,e,-1,k,!0);const t=new r.P;_i(c,e,0,t);const s=new Br({start:k,end:t}),n=s.getClosestCoordinate(F,!0);n<1&&(k=s.getCoord2D(n),L=r.P.distance(k,F),L<=l&&R.push(new r.P(n-1,L)))}{_i(c,e,2,k,!0);const t=new r.P;_i(c,e,o.vmax,t);const s=new Br({start:t,end:k}),n=s.getClosestCoordinate(F,!0);n>0&&(k=s.getCoord2D(n),L=r.P.distance(k,F),L<=l&&R.push(new r.P(1+n,L)))}}if(!R.length)return 0;R.sort(((t,e)=>t.compare(e)));let G=0;const V=R[0].x;if(u[G++]=V,G<h){const t=(0,i.H)(c,4,!1).total(),e=R[0].y;for(let s=1,n=R.length;s<n;s++)if(R[s].y>e+t){R.length=s;break}R.sort(((t,e)=>(0,r.a8)(t.x,e.x))),G=0,u[G++]=R[0].x;for(let s=1,n=R.length;s<n;s++)R[s].x!==u[G-1]&&G<h&&(u[G++]=R[s].x)}return G}function Kn(t,e,s){const n=(0,r.m)(r.P,3);t.queryControlPoints(n);const i=[0,0,0];t.queryWeights(i),Qn(n,i,e,s)}function Qn(t,e,s,n){if(s.equalsRange(0,1))return void n.setFromPoints(t,3);const i=(0,r.m)(r.P,3);ni(t,e,s.vmin,s.vmax,i,[0,0,0]),n.setFromPoints(i,3)}function Jn(t){const e=(0,r.F)(t[0].y,t[1].y),s=(0,r.F)(t[1].y,t[2].y);if(e>=0&&s>=0||e<=0&&s<=0){const e=(0,r.F)(t[0].x,t[1].x),s=(0,r.F)(t[1].x,t[2].x);if(e>=0&&s>=0||e<=0&&s<=0)return!0}return!1}function ti(t){const e=(0,r.m)(r.P,3);t.queryControlPoints(e);const s=ei(e);return s&&(t.m_cp.setCoordsPoint2D(e[1]),t.afterCompletedModification()),s}function ei(t){let e=!1;for(let s=0;s<2;s++){const n=(0,r.F)(t[0][s],t[2][s]);n>0?((0,r.F)(t[0][s],t[1][s])<0&&(t[1][s]=t[0][s],e=!0),(0,r.F)(t[1][s],t[2][s])<0&&(t[1][s]=t[2][s],e=!0)):n<0?((0,r.F)(t[0][s],t[1][s])>0&&(t[1][s]=t[0][s],e=!0),(0,r.F)(t[1][s],t[2][s])>0&&(t[1][s]=t[2][s],e=!0)):t[1][s]!==t[0][s]&&(t[1][s]=t[0][s],e=!0)}return e}function si(t,e,s,o,a,l,h){(0,n.g)(s>=0&&s<=1&&o!==l&&a!==h),(0,n.g)(e[0]>0&&e[2]>0&&e[1]>=0);const u=[1,yi(e),1],c=vi(e,s),m=(0,r.L)(t,3),d=(0,r.m)(i.d,3);di(m,u,d);const g=(0,r.m)(i.d,3),p=(0,r.m)(i.d,3);bi(d,c,o?g:null,l?p:null),Pi(e,s,a,h);const _=Jn(m);if(o){for(let t=0;t<3;++t)pi(g[t],o[t]);Ei(m,o),_&&ei(o)}if(l){for(let t=0;t<3;++t)pi(p[t],l[t]);Ei(m,l),_&&ei(l)}}function ni(t,e,s,o,a,l){if((0,n.g)(s>=0&&o<=1&&s<=o),s===o){const n=new r.P,i=gi(t,e,s,n);return Si(t,n),a[0].assign(n),a[1].assign(n),a[2].assign(n),l[0]=i,l[1]=i,void(l[2]=i)}if(0===s&&1===o)return a[0].assign(t[0]),a[1].assign(t[1]),a[2].assign(t[2]),l[0]=e[0],l[1]=e[1],void(l[2]=e[2]);const h=(0,r.m)(i.d,3);{const n=[1,yi(e),1],i=vi(e,s),r=vi(e,o);di(t,n,h),bi(h,r,h,null),bi(h,i>=r?1:i/r,null,h)}const u=[0,0,0];Pi(e,o,u,null),Pi(u,s/o,null,u);const c=Jn(t),m=(0,r.m)(r.P,3);pi(h[1],m[1]),_i(t,e,s,m[0]),_i(t,e,o,m[2]),Ei(t,m);for(let n=0;n<3;++n)a[n].assign(m[n]),l[n]=u[n];c&&ei(a)}function ii(t,e,s){const n=yi(e),i=[1,n,1],o=4*n/(3*(1+n));s[0].assign(t[0]),s[3].assign(t[2]),(0,r.U)(t[0],t[1],o,s[1]),(0,r.U)(t[2],t[1],o,s[2]),new In({cp:s}),new Wt({points:t,weight:n});let a=0,l=.1,h=0;for(let u=0;u<9;u++,l+=.1){const e=new r.P;_i(t,i,l,e);const n=new r.P;Qs(s,l,n);const o=r.P.sqrDistance(e,n);o>a&&(a=o,h=l)}{const e=new r.P;_i(t,i,h,e);const n=[0];pn(s,e,r.E.unit(),!1,-1,1,n);const o=new r.P;return Qs(s,n[0],o),a=r.P.sqrDistance(e,o),Math.sqrt(a)}}function ri(t,e,s,n,i){if(i){if(0!==Rr(e,s))return t?4:2}else if(C(e,s))return 1;return 0!==li(t,e,s,null,null,null,n,void 0!==i&&i,!0,!1)?4:0}function oi(t,e,s,n,i){if(i){if(0!==Rr(e,s))return t?4:2}else if(C(e,s))return 1;return 0!==hi(t,e,s,null,null,null,n,i??!1,!0,!1)?4:0}function ai(t,e,s,n,i){if(i){if(0!==Rr(e,s))return t?4:2}else if(C(e,s))return 1;return 0!==ci(t,e,s,null,null,null,n,i??!1,!0,!1)?4:0}function li(t,e,s,i,o,a,l,h,u,c){if(null!==o&&(o.length=0),null!==a&&(a.length=0),null!==i&&(i.length=0),s.isDegenerate(0)){const t=[0,0],n=e.intersectPoint(s.getStartXY(),t,l);if(n>0){if(null!==o)for(let e=0;e<n;e++)o.push(t[e]);if(null!=a)for(let t=0;t<n;t++)a.push(0);if(null!=i)for(let s=0;s<n;s++){const n=new r.P;e.queryCoord2D(t[s],n),i.push(n)}}return n}const m=B(e,s);if(l=Math.max(l,m),e.isDegenerateToLineHelper(m)){const t=new Br({start:e.getStartXY(),end:e.getEndXY()}),n=ot(t,s,i,o,a,l,h,c);if(o)for(let s=0;s<n;++s){const n=t.getCoord2D(o[s]);o[s]=e.getClosestCoordinate(n,!1)}return n}if(Y(e,s,l))return 0;const d=(0,r.m)(r.P,3);e.queryControlPoints(d);const g=[0,0,0];e.queryWeights(g);const p=[1,yi(g),1],_=s.getEndXY().sub(s.getStartXY()),f=_.clone();f.leftPerpendicularThis();const y=d[0].clone(),x=d[1].clone(),v=d[2].clone(),b=x.sub(y),P=v.sub(y),S=v.sub(x),E=p[0],C=p[1],w=p[2],I=E*C,T=E*w,A=C*w,M=b.dotProduct(f)*I,D=P.dotProduct(f)*T;let N=M,F=D-2*M,R=S.dotProduct(f)*A+D-D;const k=(0,r.d)(13,Number.NaN),L=(0,r.d)(13,Number.NaN);let G=Dt(R,F,N,r.E.unit(),!1,k);G<0&&(k[0]=0,k[1]=1,G=2);let V=0;for(let n=0,B=V;n<G;++n){const t=new r.P;_i(d,p,k[n+B],t),L[V]=s.getClosestCoordinate(t,!1),r.P.distance(t,s.getCoord2D(L[V]))<=l&&(k[V]=k[n+B],V++)}const z=(0,r.m)(r.P,3),O=(0,r.m)(r.P,3);if(e.queryControlPoints(O),O[0].subThis(s.getStartXY()),O[1].subThis(s.getStartXY()),O[2].subThis(s.getStartXY()),function(t,e,s,n=!1){const i=(0,r.m)(r.P,3);n?(i[0].setCoordsPoint2D(t[0]),i[1].setCoordsPoint2D(t[1]),i[1].subThis(i[0]),i[2].setCoordsPoint2D(t[2]),i[2].subThis(i[0]),i[0].setCoords(0,0)):(i[0].setCoordsPoint2D(t[0]),i[1].setCoordsPoint2D(t[1]),i[2].setCoordsPoint2D(t[2])),i[0].mulThis(e[0]),i[1].mulThis(e[1]),i[2].mulThis(e[2]),s[1].setCoords(i[1].x-i[0].x,i[1].y-i[0].y),s[2].setCoordsPoint2D(i[2].sub(i[1])),s[2].subThis(s[1]),s[1].x*=2,s[1].y*=2,s[0].setCoordsPoint2D(i[0])}(O,p,z,!1),Math.abs(_.x)>=Math.abs(_.y)){const t=_.y/_.x;R=z[2].y-z[2].x*t,F=z[1].y-z[1].x*t,N=z[0].y-z[0].x*t}else{const t=_.x/_.y;R=z[2].x-z[2].y*t,F=z[1].x-z[1].y*t,N=z[0].x-z[0].y*t}const q=e.getEndXY().equals(s.getStartXY())||e.getEndXY().equals(s.getEndXY()),U=[0,0];G=Dt(R,F,N,r.E.unit(),q,U);for(let n=0,B=V;n<G;++n){k[n+B]=U[n];const t=new r.P;_i(d,p,k[n+B],t),L[V]=s.getClosestCoordinate(t,!1),r.P.distance(t,s.getCoord2D(L[V]))<=l&&(k[V]=k[n+B],V++)}(0,n.g)(V<k.length+4);for(let n=0;n<V;n++)k[n]=xi(g,k[n]);G=e.intersectPoint(s.getStartXY(),U,l);for(let n=0;n<G;n++)k[V]=U[n],L[V++]=0;G=e.intersectPoint(s.getEndXY(),U,l);for(let n=0;n<G;n++)k[V]=U[n],L[V++]=1;G=s.intersectPoint(e.getStartXY(),U,l);for(let n=0;n<G;n++)L[V]=U[n],k[V++]=0;G=s.intersectPoint(e.getEndXY(),U,l);for(let n=0;n<G;n++)L[V]=U[n],k[V++]=1;return 0===V?0:Vr(t,e,s,k,L,V,i,o,a,l,h,u,c)}function hi(t,e,s,n,i,o,l,h,u,c){if(rr(s))return li(t,e,new Br({start:s.getStartXY(),end:s.getEndXY()}),n,i,o,l,h,u,c);const m=B(e,s);if(Y(e,s,l=Math.max(l,m)))return 0;const d=[],g=[],p=(0,r.m)(r.P,4);{e.queryControlPoints(p);const t=(0,r.m)(r.P,4),n=new a.T;s.canonicToWorldTransformation(n);const i=new a.T;i.setInvert(n),i.transformPoints2D(p,4,t);const o=(0,r.m)(r.M,3),u=(0,r.m)(r.M,3),c=(0,r.m)(r.M,3),m=[0,0,0];e.queryWeights(m),mi(t,m,o,u,c);const _=(0,r.m)(r.M,3);_[0].setDouble(s.getSemiMinorAxis()),_[0].sqrThis(),_[1].setDouble(s.getSemiMajorAxis()),_[1].sqrThis(),_[2].setThis(_[0]),_[2].mulThis(_[1]),_[2].negateThis();const f=se(o,2,u,2,c,2,_,!0,r.E.unit(),r.E.unit(),d,h);if(f>0){let t=0;for(let n=0;n<f;n++){const i=new r.P;e.queryCoord2D(d[n],i);const o=s.getClosestCoordinate(i,!1),a=new r.P;s.queryCoord2D(o,a),r.P.distance(i,a)<=l&&(d[t]=d[n],g.push(o),t++)}d.length=t}}const _=[0,1];for(let a=0;a<2;a++){const t=0===a?s.getStartXY():s.getEndXY(),n=Wn(e,t,r.E.unit(),!1,-1),i=new r.P;e.queryCoord2D(n,i),r.P.distance(t,i)<=l&&(d.push(n),g.push(_[a]))}for(let a=0;a<2;a++){const t=[0,3];{const e=s.getClosestCoordinate(p[t[a]],!1),n=new r.P;s.queryCoord2D(e,n),r.P.distance(p[t[a]],n)<=l&&(d.push(_[a]),g.push(e))}}return Vr(t,e,s,d,g,d.length,n,i,o,l,h,u,c)}function ui(t,e,s,i,o,a,l,h,u,c){const m=(0,r.m)(r.P,3);e.queryControlPoints(m);const d=(0,r.m)(r.P,3);if(s.queryControlPoints(d),U(m,d,3)<0)return ui(t,s,e,i,a,o,l,h,u,!c);const g=B(e,s);if(e.isDegenerateToLineHelper(g)){const n=new Br({start:e.getStartXY(),end:e.getEndXY()}),r=li(t,s,n,i,a,o,l,h,u,!c);if(o)for(let t=0;t<r;++t){const s=n.getCoord2D(o[t]);o[t]=e.getClosestCoordinate(s,!1)}return r}if(s.isDegenerateToLineHelper(g)){const n=new Br({start:s.getStartXY(),end:s.getEndXY()}),r=li(t,e,n,i,o,a,l,h,u,c);if(a)for(let t=0;t<r;++t){const e=n.getCoord2D(a[t]);a[t]=s.getClosestCoordinate(e,!1)}return r}if(Y(e,s,l=Math.max(l,g)))return 0;const p=(0,r.d)(3,Number.NaN);e.queryWeights(p);const f=(0,r.d)(3,Number.NaN);s.queryWeights(f);const y=[1,yi(p),1],x=[1,yi(f),1],v=new r.E(0,1),b=new r.E(0,1);{const t=_.constructEmpty();Qn(m,y,new r.E(0,1),t);const e=_.constructEmpty();Qn(d,x,new r.E(0,1),e);const s=Math.max(t.maxDim(),e.maxDim());if(t.inflate(3*l),e.inflate(3*l),!t.intersectW(e))return 0;if(t.maxDim()<.1*s){if(fi(m,y,t,v),fi(d,x,t,b),v.isEmpty()||b.isEmpty())return 0;ni(m,y,v.vmin,v.vmax,m,y),ni(d,x,b.vmin,b.vmax,d,x)}}const P=Or(m,2,d,2,l);if(0===P)return 0;const S=[],E=[];if(-1===P){const t=(0,r.m)(r.M,3),e=(0,r.m)(r.M,3),s=(0,r.m)(r.M,3);mi(m,y,t,e,s);const n=(0,r.m)(r.M,3),i=(0,r.m)(r.M,3),o=(0,r.m)(r.M,3);mi(d,x,n,i,o);const a=[],u=[],g=ee(t,2,e,2,s,2,n,2,i,2,o,2,!0,r.E.unit(),r.E.unit(),a,u,h,0,c);if(g>0)for(let h=0;h<g;h++){const t=new r.P;_i(d,x,u[h],t);const e=new r.P;_i(m,y,a[h],e),r.P.distance(e,t)<=l&&(S.push(a[h]),E.push(u[h]))}}for(let _=0;_<2;_++){let t,e,s;0===_?(t=m,e=d,s=x):(t=d,e=m,s=y);for(let i=0;i<2;i++){const o=0===i?0:t.length-1,a=new r.P,h=[0],u=$n(e,s,t[o],r.E.unit(),!1,-1,1,h);(0,n.g)(1===u),_i(e,s,h[0],a),r.P.distance(t[o],a)<=l&&(0===_?(S.push(0===o?0:1),E.push(h[0])):(E.push(0===o?0:1),S.push(h[0])))}}if(0===S.length)return 0;if(!v.equalsRange(0,1))for(let n=0;n<S.length;++n)S[n]=Wt.recalculateParentT(v.vmin,v.vmax,S[n]);if(!b.equalsRange(0,1))for(let n=0;n<E.length;++n)E[n]=Wt.recalculateParentT(b.vmin,b.vmax,E[n]);for(let n=0;n<S.length;++n)S[n]=xi(p,S[n]);for(let n=0;n<E.length;++n)E[n]=xi(f,E[n]);return Vr(t,e,s,S,E,S.length,i,o,a,l,h,u,c)}function ci(t,e,s,n,i,o,a,l,h,u){if(e.isLine())return je(t,s,new Br({start:e.getStartXY(),end:e.getEndXY()}),n,o,i,a,l,h,!u);if(s.isLine())return li(t,e,new Br({start:s.getStartXY(),end:s.getEndXY()}),n,i,o,a,l,h,u);const c=B(e,s);if(Y(e,s,a=Math.max(a,c)))return 0;const m=(0,r.m)(r.P,3);e.queryControlPoints(m);const d=(0,r.m)(r.P,3);s.queryControlPoints(d);const g=Or(m,2,d,2,a);if(0===g)return 0;const p=[],_=[];if(-1===g){const t=(0,r.m)(r.M,3),n=(0,r.m)(r.M,3),i=(0,r.m)(r.M,3),o=[0,0,0];e.queryWeights(o),mi(m,o,t,n,i);const h=(0,r.m)(P,3);Ke(d,h);const c=ee(t,2,n,2,i,2,[h[0].x,h[1].x,h[2].x],2,[h[0].y,h[1].y,h[2].y],2,null,0,!0,r.E.unit(),r.E.unit(),p,_,l,0,u);if(c>0){let t=0;for(let n=0;n<c;n++){const i=new r.P;s.queryCoord2D(_[n],i);const o=new r.P;e.queryCoord2D(p[n],o),r.P.distance(o,i)<=a&&(p[t]=p[n],_[t]=_[n],t++)}p.length=t,_.length=t}}for(let f=0;f<2;f++){let t;t=0===f?m:d;for(let n=0;n<2;n++){const i=0===n?0:t.length-1;let o;const l=new r.P;0===f?(o=Ge(s,t[i],r.E.unit(),!1),s.queryCoord2D(o,l)):(o=Wn(e,t[i],r.E.unit(),!1,-1),e.queryCoord2D(o,l)),r.P.distance(t[i],l)<=a&&(0===f?(p.push(0===i?0:1),_.push(o)):(_.push(0===i?0:1),p.push(o)))}}return Vr(t,e,s,p,_,p.length,n,i,o,a,l,h,u)}function mi(t,e,s,n,i){const o=r.M.constructDouble(e[0]),a=r.M.constructDouble(e[1]),l=r.M.constructDouble(e[2]);s[0].setDouble(t[0].x),s[0].mulThis(o),s[1].setDouble(t[1].x),s[1].mulThis(a),s[2].setDouble(t[2].x),s[2].mulThis(l),s[2].subThis(s[1]),s[1].subThis(s[0]),s[2].subThis(s[1]),s[1].ldexpThis(1),n[0].setDouble(t[0].y),n[0].mulThis(o),n[1].setDouble(t[1].y),n[1].mulThis(a),n[2].setDouble(t[2].y),n[2].mulThis(l),n[2].subThis(n[1]),n[1].subThis(n[0]),n[2].subThis(n[1]),n[1].ldexpThis(1),i[0].setDouble(e[0]),i[1].setDouble(e[1]),i[2].setThis(i[1]),i[2].ldexpThis(1),i[2].negateThis(),i[2].addThis(i[0]),i[2].addDoubleThis(e[2]),i[1].subThis(i[0]),i[1].ldexpThis(1)}function di(t,e,s){for(let n=0;n<3;++n)s[n].setCoordsPoint2DZ(t[n].mul(e[n]),e[n])}function gi(t,e,s,n){if(0===s)return n.assign(t[0]),e[0];if(1===s)return n.assign(t[2]),e[2];const i=[t[0].x*e[0],t[1].x*e[1],t[2].x*e[2]],o=[t[0].y*e[0],t[1].y*e[1],t[2].y*e[2]],a=[e[0],e[1],e[2]],l=s;let h,u,c;if(s<=.5){const t=(0,r.X)(i[0],i[1],l),e=(0,r.X)(i[1],i[2],l);h=(0,r.q)(t,e,l);const s=(0,r.X)(o[0],o[1],l),n=(0,r.X)(o[1],o[2],l);u=(0,r.q)(s,n,l);const m=(0,r.X)(a[0],a[1],l),d=(0,r.X)(a[1],a[2],l);c=(0,r.X)(m,d,l)}else{const t=(0,r.Y)(i[0],i[1],l),e=(0,r.Y)(i[1],i[2],l);h=(0,r.Y)(t,e,l);const s=(0,r.Y)(o[0],o[1],l),n=(0,r.Y)(o[1],o[2],l);u=(0,r.Y)(s,n,l);const m=(0,r.Y)(a[0],a[1],l),d=(0,r.Y)(a[1],a[2],l);c=(0,r.Y)(m,d,l)}return h/=c,u/=c,n.setCoords(h,u),Si(t,n),c}function pi(t,e){return e.setCoords(t.x/t.z,t.y/t.z),t.z}function _i(t,e,s,n,i){if(i){if(s<0)return void Q(new Br({start:t[0],end:t[0].add(Yn(t,e,0).getUnitVector())}),s,n);if(s>1)return void Q(new Br({start:t[2],end:t[2].add(Yn(t,e,1).getUnitVector())}),s-1,n)}gi(t,e,s,n)}function fi(t,e,s,n){n.setEmpty();const i=[];i.push(new r.E(0,1));const o=.5*Math.max(s.width(),s.height());for(;i.length;){const a=i.at(-1);i.pop();const l=new _;if(Qn(t,e,a,l),l.isIntersectingW(s)){const t=Math.max(l.width(),l.height());if(s.containsW(l)||t<=o||a.width()<1e-12)n.merge(a);else{const t=a.getCenter();i.push(r.E.construct(a.vmin,t)),i.push(r.E.construct(t,a.vmax))}}}}function yi(t){return t[1]/Math.sqrt(t[0]*t[2])}function xi(t,e){const s=Math.sqrt(t[2]/t[0]);return e/(0,r.q)(s,1,e)}function vi(t,e){const s=Math.sqrt(t[0]/t[2]);return e/(0,r.q)(s,1,e)}function bi(t,e,s,o){(0,n.g)(e>=0&&e<=1),(new i.d).setCoordsPoint3D(t[0]),(new i.d).setCoordsPoint3D(t[1]),(new i.d).setCoordsPoint3D(t[2]);const a=new i.d,l=new i.d,h=new i.d;(0,r._)(3,t[0],t[1],e,a),(0,r._)(3,t[1],t[2],e,l),(0,r._)(3,a,l,e,h);const u=t[2].clone();s&&(s[0].assign(t[0]),s[1].assign(a),s[2].assign(h)),o&&(o[0].assign(h),o[1].assign(l),o[2].assign(u))}function Pi(t,e,s,i){const o=[t[0],t[1],t[2]];(0,n.g)(e>=0&&e<=1&&s!==i);const a=(0,r.q)(o[0],o[1],e),l=(0,r.q)(o[1],o[2],e),h=(0,r.q)(a,l,e);s&&(s[0]=o[0],s[1]=a,s[2]=h),i&&(i[0]=h,i[1]=l,i[2]=o[2])}function Si(t,e){const s=r.E.constructEmpty();s.vmin=s.vmax=t[0].x,s.mergeNeCoordinate(t[1].x),s.mergeNeCoordinate(t[2].x),e.x=(0,r.s)(e.x,s.vmin,s.vmax),s.vmin=s.vmax=t[0].y,s.mergeNeCoordinate(t[1].y),s.mergeNeCoordinate(t[2].y),e.y=(0,r.s)(e.y,s.vmin,s.vmax)}function Ei(t,e){const s=new r.E;s.vmin=s.vmax=t[0].x,s.mergeNeCoordinate(t[1].x),s.mergeNeCoordinate(t[2].x),e[0].x=(0,r.s)(e[0].x,s.vmin,s.vmax),e[1].x=(0,r.s)(e[1].x,s.vmin,s.vmax),e[2].x=(0,r.s)(e[2].x,s.vmin,s.vmax),s.vmin=s.vmax=t[0].y,s.mergeNeCoordinate(t[1].y),s.mergeNeCoordinate(t[2].y),e[0].y=(0,r.s)(e[0].y,s.vmin,s.vmax),e[1].y=(0,r.s)(e[1].y,s.vmin,s.vmax),e[2].y=(0,r.s)(e[2].y,s.vmin,s.vmax)}const Ci=r.ag/180,wi=180/r.ag;function Ii(t){let e=t;return e=function(t){let e=t;return e>=-360&&e<720?(e<0?e+=360:e>=360&&(e-=360),e):(e=(0,r.l)(e,360),e<0&&(e+=360),e)}(e),e>180&&(e-=360),e}function Ti(t){return t*Ci}function Ai(t){return t*wi}function Mi(t){const e=(0,r.a9)();let s=t;return s>=-e&&s<2*e?(s<0&&(s+=e),s>=e&&(s-=e),s):(s=(0,r.l)(s,e),s<0&&(s+=e),s)}function Di(t){const e=(0,r.$)();let s=t;return s>-e&&s<=e||(s=Mi(s),s>e&&(s-=(0,r.a9)())),s}function Ni(t,e){return Ii(e-t)}var Fi=i.V;class Ri extends ${constructor(t){if(void 0===t||(0,r.W)(t,"vd"))return super({vd:t?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_semiMajorAxis=0,this.m_minorMajorRatio=1,this.m_rotation=0,this.m_cosr=1,this.m_sinr=0,this.m_center=new r.P(0,0),this.m_sweepAngle=0,this.m_startAngle=0,this.m_interior=new r.P(0,0),void(this.m_bits=0);if(t.copy)return super(t),void(this!==t.copy&&(this.m_center=new r.P(0,0),this.m_interior=new r.P(0,0),t.copy.copyToImpl(this)));if(t.move)super(t),this.m_semiMajorAxis=t.move.m_semiMajorAxis,this.m_minorMajorRatio=t.move.m_minorMajorRatio,this.m_rotation=t.move.m_rotation,this.m_cosr=t.move.m_cosr,this.m_sinr=t.move.m_sinr,this.m_center=t.move.m_center.clone(),this.m_sweepAngle=t.move.m_sweepAngle,this.m_startAngle=t.move.m_startAngle,this.m_interior=t.move.m_interior.clone(),this.m_bits=t.move.m_bits,this.m_cachedValues=t.move.m_cachedValues,t.move.m_cachedValues=null;else{if(t.fromPoint)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_center=new r.P(0,0),this.m_interior=new r.P(0,0),void this.constructCircularArcThreePoint(t.fromPoint,t.toPoint,t.interiorPoint);if(t.center)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_center=new r.P(0,0),this.m_interior=new r.P(0,0),void this.constructCircleRadius(t.radius,t.center,t.bIsCounterClockwise);if(t.semiMajorAxis)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),void this.constructEllipticArcEndPoints(t.fromPoint,t.toPoint,t.semiMajorAxis,t.minorMajorRatio,t.axisXRotationRad,t.bBigArc,t.bIsCounterClockwise)}}getBoundary(){return Tt(this)}assignCopy(t){return this!==t&&t.copyTo(this),this}constructCircleRadius(t,e,s=!1){return this.constructEllipse(t,1,e,0,s),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructCircleCenterAndPoint(t,e,s=!1){const n=r.P.distance(t,e);return this.constructEllipticArcEndPointsCenter(e,e,n,1,0,!0,s,t),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructTwoPointCircle(t,e,s=!1){const n=r.P.lerp(t,e,.5);return this.constructCircleCenterAndPoint(n,t,s),this}constructLineEllipticArc(t,e){return ir(this,t,e,1),this}constructLineCircularArc(t,e){return ir(this,t,e,0),this}constructEllipse(t,e,s,n,i=!1){this.m_semiMajorAxis=Math.abs(t),this.m_minorMajorRatio=Math.abs(e),this.m_minorMajorRatio>1&&(this.m_semiMajorAxis*=this.m_minorMajorRatio,this.m_minorMajorRatio=1/this.m_minorMajorRatio);const o=new r.P(0,this.m_minorMajorRatio*this.m_semiMajorAxis),a=Math.cos(n),l=Math.sin(n);return o.rotateDirect(a,l),o.addThis(s),this.constructEllipticArcEndPointsCenter(o,o,this.m_semiMajorAxis,this.m_minorMajorRatio,n,!0,i,s),this}inflate(t){if(this.isDegenerateToLine())return;let e=this.getSemiMinorAxis()+t;if(e=e<=0?0:(this.getSemiMajorAxis()+t)/this.getSemiMajorAxis(),this.isCircular()){const t=new a.T;t.setShiftCoords(-this.m_center.x,-this.m_center.y),t.scale(e,e),t.shiftCoords(this.m_center.x,this.m_center.y),this.applyTransformation(t)}else{const t=new a.T;this.canonicToWorldTransformation(t);const s=t.clone();s.invertPreciseThis(),s.scale(e,e),s.multiply(t),this.applyTransformation(s)}}constructEnclosingCircle(t,e,s=!1){return function(t,e,s,i){0===s&&(0,n.a)("construct_enclosing_circle");const o=[0,0,0],a=function(t,e,s){const n=[];return ki(e,n),Li(t,n,e,s)}(e,s,o);if(1===a)t.constructCircleRadius(0,e[o[0]],i);else if(2===a){const s=r.P.lerp(e[o[0]],e[o[1]],.5),n=r.P.distance(e[o[0]],s),a=r.P.distance(e[o[1]],s);t.constructCircleRadius(Math.max(n,a),s,i)}else if(3===a){const s=r.P.calculateCircleCenterFromThreePoints(e[o[0]],e[o[1]],e[o[2]]),n=r.P.distance(e[o[0]],s),a=r.P.distance(e[o[1]],s),l=r.P.distance(e[o[2]],s);t.constructCircleRadius(Math.max(n,a,l),s,i)}else(0,n.d)("unexpected")}(this,t,e,s),this}constructThreePointCircle(t,e,s,n=!1){if(t.equals(e)||e.equals(s)||t.equals(s)){const i=t.clone(),r=e.clone(),o=s.clone();return i.equals(r)&&r.assign(o),this.constructTwoPointCircle(i,r,n)}{const i=r.P.calculateCircleCenterFromThreePoints(t,e,s);if(!i.isFinite()||!Number.isFinite(r.P.distance(t,i))){const n=r.P.distance(t,e),i=r.P.distance(t,s);this.constructLineCircularArc(t,n>=i?e:s)}return this.constructCircleCenterAndPoint(i,t,n)}}constructCircularArcThreePoint(t,e,s){const n=new r.H(t.x),i=new r.H(e.x),o=new r.H(s.x),a=new r.H(t.y),l=new r.H(e.y),h=new r.H(s.y),u=new r.H(.5),c=i.subE(n),m=l.subE(a),d=o.subE(n),g=h.subE(a),p=c.mulE(g).subThisE(m.mulE(d));if(p.scaleError(10),p.isZero()){if(!c.isZero()||!m.isZero())return ir(this,t,e,0),this;{const n=t.clone().addThis(e).mulThis(.5).addThis(s).mulThis(.5),i=s.sub(n).length();this.constructEllipticArcEndPointsCenter(t,e,i,1,0,!0,!1,n),this.m_interior.assign(s)}return this.setProjectionBehavior(0),this}const _=c.sqr().addThisE(m.sqr()).mulThisE(u),f=d.sqr().addThisE(g.sqr()).mulThisE(u),y=_.mulE(g).subThisE(f.mulE(m)),x=c.mulE(f).subThisE(d.mulE(_));y.divThisE(p),x.divThisE(p);const v=y.sqr().addThisE(x.sqr());v.sqrtThis();const b=y.addE(n),P=x.addE(a);let S=t.x-b.value(),E=t.y-P.value();const C=Math.atan2(E,S);S=e.x-b.value(),E=e.y-P.value();const w=Math.atan2(E,S);S=s.x-b.value(),E=s.y-P.value();const I=Math.atan2(E,S);let T=I-2*(0,r.$)();for(;T<C;)T+=2*(0,r.$)();let A=w-2*(0,r.$)();for(;A<T;)A+=2*(0,r.$)();let M=I+2*(0,r.$)();for(;M>C;)M-=2*(0,r.$)();let D,N=w+2*(0,r.$)();for(;N>M;)N-=2*(0,r.$)();D=A-C<C-N?A-C:N-C;const F=new r.P(b.value(),P.value());return this.constructEllipticArcEndPointsCenter(t,e,v.value(),1,0,Math.abs(D)>(0,r.$)(),D>0,F),this.m_interior.assign(s),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructCircularArc(t,e,s,n){return this.constructEllipticArcGeneral(t,1,e,s,n,0),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructEllipticArcEndPoints(t,e,s,n,i,r,o){return nr(this,t,e,s,n,i,r,o)}constructEllipticArcEndPointsCenter(t,e,s,n,i,r,o,a){return nr(this,t,e,s,n,i,r,o,a)}constructEllipticArcGeneral(t,e,s,n,i,o){this.m_semiMajorAxis=Math.abs(t),this.m_minorMajorRatio=Math.abs(e),this.m_minorMajorRatio>1&&(this.m_semiMajorAxis*=this.m_minorMajorRatio,this.m_minorMajorRatio=1/this.m_minorMajorRatio);const a=Di(o),l=Math.cos(a),h=Math.sin(a),u=new r.P(this.m_semiMajorAxis,this.m_minorMajorRatio*this.m_semiMajorAxis),c=r.P.getNAN(),m=Di(n);c.x=u.x*Math.cos(m),c.y=u.y*Math.sin(m),c.rotateDirect(l,h),c.addThis(s);const d=(0,r.a0)(i,(0,r.a9)());let g=d;Math.abs(g)===(0,r.a9)()&&(g=0);const p=r.P.getNAN();return p.x=u.x*Math.cos(m+g),p.y=u.y*Math.sin(m+g),p.rotateDirect(l,h),p.addThis(s),this.constructEllipticArcEndPointsCenter(c,p,this.m_semiMajorAxis,this.m_minorMajorRatio,a,Math.abs(d)>(0,r.$)(),d>0,s)}constructEllipticArcAsNURB(t,e,s,i){return(i>=1||i<0)&&(0,n.a)("construct_elliptic_arc_as_NURB: weight"),e.isFinite()||(0,n.a)("construct_elliptic_arc_as_NURB: control_point"),vr([t,e,s],i*i,null,!1,this),this}constructCanonic(t){return this.assignCopy(t),t.isDegenerateToLine()||t.m_center.isEqual(0,0)&&0===this.m_rotation||(this.m_XStart=t.getSemiMajorAxis()*Math.cos(t.m_startAngle),this.m_YStart=t.getSemiMinorAxis()*Math.sin(t.m_startAngle),this.m_XEnd=t.getSemiMajorAxis()*Math.cos(t.getEndAngle()),this.m_YEnd=t.getSemiMinorAxis()*Math.sin(t.getEndAngle()),this.m_center.setCoords(0,0),this.m_rotation=0,this.m_cosr=1,this.m_sinr=0,Er(this),this.afterCompletedModification(),t!==this&&O(this,t)),this}isCircular(){return 1===this.m_minorMajorRatio&&0===this.m_rotation&&!this.isDegenerateToLine()}isDegenerateToLineHelper(t){if(this.isLine())return!0;if(this.isMajor())return!1;const e=this.getEndXY().sub(this.getStartXY()).length();return!(this.calculateLength2D()-e>t)}isDegenerateToLine(){return rr(this)}getCenter(){return this.m_center.clone()}setCenter(t){if(!this.m_center.isNAN()){const e=t.sub(this.m_center);this.m_XStart+=e.x,this.m_YStart+=e.y,this.m_XEnd+=e.x,this.m_YEnd+=e.y,this.m_interior.addThis(e),this.m_center.assign(t),this.endPointModified(),this.normalizeAfterEndpointChange()}}getAxisXRotation(){return this.m_rotation}getSemiAxes(){return r.P.construct(this.m_semiMajorAxis,this.m_semiMajorAxis*this.m_minorMajorRatio)}getSemiMajorAxis(){return this.m_semiMajorAxis}getSemiMinorAxis(){return this.m_semiMajorAxis*this.m_minorMajorRatio}getMinorMajorRatio(){return this.m_minorMajorRatio}isClockwise(){return!dr(this)}isMajor(){return pr(this)}getSweepAngle(){return this.m_sweepAngle}getStartAngle(){return this.m_startAngle}getEndAngle(){return this.m_startAngle+this.m_sweepAngle}getGeometryType(){return n.G.enumEllipticArc}queryEnvelope(t){if(4===t.m_EnvelopeType){t.setEmpty(),t.assignVertexDescription(this.m_description);const e=o.Envelope2D.constructEmpty();this.queryEnvelope(e),t.setEnvelope(e);for(let s=1,n=this.m_description.getAttributeCount();s<n;s++){const e=this.m_description.getSemantics(s);for(let n=0,i=Fi.getComponentCount(e);s<i;s++){const s=this.queryInterval(e,n);t.setIntervalEnvelope(e,n,s)}}}else 2===t.m_EnvelopeType?Tr(this,r.E.unit(),t):(0,n.t)("3d not impl")}applyTransformation(t){lr(this,t,!1,null,null)}createInstance(){return new Ri}calculateLength2D(){return function(t,e,s){if(rr(t))return(s-e)*r.P.distance(t.getStartXY(),t.getEndXY());if(1===t.m_minorMajorRatio)return Math.abs(t.getSweepAngle()*(e-s))*t.m_semiMajorAxis;const n=or(t,e);return or(t,s)-n}(this,0,1)}queryControlPointsHelper(t){(0,n.d)("")}queryCoord2D(t,e){if(rr(this))J(t,this.getStartXY(),this.getEndXY(),e);else if(0===t)e.assign(r.P.construct(this.m_XStart,this.m_YStart));else if(1===t)e.assign(r.P.construct(this.m_XEnd,this.m_YEnd));else{const s=Qi(this,t),n=new r.P(this.m_semiMajorAxis*Math.cos(s),this.getSemiMinorAxis()*Math.sin(s));n.rotateDirect(this.m_cosr,this.m_sinr),n.addThis(this.m_center),e.assign(n)}}queryCoord2DE(t,e){!function(t,e,s){if(rr(t))st(new Br({start:t.getStartXY(),end:t.getEndXY()}),e,s);else if(0===e.value())s.set(t.getStartXY());else if(1===e.value())s.set(t.getEndXY());else{const n=new r.H;Ji(t,e,n);const i=new r.H,o=new r.H;r.H.st_cosAndSin(n,i,o);const a=v.constructCoordsE(new r.H(t.m_semiMajorAxis).mulThisE(i),new r.H(t.m_semiMajorAxis).mulThis(t.m_minorMajorRatio).mulThisE(o)),l=new r.H(t.m_rotation);r.H.st_cosAndSin(l,i,o),a.rotateDirect(i,o),a.addThisE(v.constructPoint2D(t.m_center)),s.setE(a)}}(this,t,e)}queryCoord2DMP(t,e){(0,n.t)("")}getCoordX(t){const e=new r.P;return this.queryCoord2D(t,e),e.x}getCoordY(t){const e=new r.P;return this.queryCoord2D(t,e),e.y}cut(t,e,s){const n=new Yr;return this.queryCut(t,e,n,s),n.releaseSegment()}queryCut(t,e,s,n){const i=s.createEllipticArc();n&&i.dropAllAttributes();let o=0===t&&1===e;if(o&&!n)return void this.copyTo(i);const a=r.P.getNAN();this.queryCoord2D(t,a);const l=r.P.getNAN();if(this.queryCoord2D(e,l),!o)if(a.equals(l))e-t>.5&&this.isMajor()&&this.isClosed()?(o=!0,t=0,e=1):1===e?t=e:e=t;else if(t>0&&a.isEqual(this.m_XStart,this.m_YStart)&&(t=0),e<1&&l.isEqual(this.m_XEnd,this.m_YEnd)&&(e=1),o=0===t&&1===e,o&&!n)return void this.copyTo(i);if(i.m_center.assign(this.m_center),i.m_semiMajorAxis=this.m_semiMajorAxis,i.m_minorMajorRatio=this.m_minorMajorRatio,i.m_interior.assign(this.m_interior),i.m_rotation=this.m_rotation,i.m_cosr=this.m_cosr,i.m_sinr=this.m_sinr,i.m_sweepAngle=this.m_sweepAngle,i.m_startAngle=this.m_startAngle,i.m_bits=this.m_bits,D(i,a.x,a.y),F(i,l.x,l.y),o)return void ur(i,tr(this));i.m_startAngle=Qi(this,t),i.m_sweepAngle=Qi(this,e)-i.m_startAngle,i.m_startAngle=ji(i.m_startAngle),gr(i,Math.abs(i.m_sweepAngle)>(0,r.$)()),n&&i.assignVertexDescription(this.m_description),Er(i),$i(i);const h=this.m_description.getAttributeCount();if(h>1&&!n){for(let e=1;e<h;e++){const s=this.m_description.getSemantics(e),n=Fi.getComponentCount(s);for(let e=0;e<n;e++){const n=this.getAttributeAsDbl(t,s,e);i.setStartAttribute(s,e,n)}}for(let t=1;t<h;t++){const s=this.m_description.getSemantics(t),n=Fi.getComponentCount(s);for(let t=0;t<n;t++){const n=this.getAttributeAsDbl(e,s,t);i.setEndAttribute(s,t,n)}}}i.afterCompletedModification()}queryDerivative(t,e){!function(t,e,s){if(rr(t))s.setE(v.constructPoint2D(t.getEndXY()).subE(v.constructPoint2D(t.getStartXY())));else{const n=new r.H;Ji(t,e,n);const i=new v;if(i.setCoordsE(new r.H(t.m_semiMajorAxis).negate().mulE((new r.H).setSin(n)),new r.H(t.getSemiMinorAxis()).mulE((new r.H).setCos(n))),t.m_rotation){const e=new r.H(t.m_rotation);i.rotateDirect((new r.H).setCos(e),(new r.H).setSin(e))}i.scaleThis(new r.H(t.getSweepAngle())),s.setE(i)}}(this,t,e)}cutArcIgnoreAttributes(t,e,s){let n=0===t&&1===e;const i=new r.P;this.queryCoord2D(t,i);const o=new r.P;this.queryCoord2D(e,o),n||(i.equals(o)?e-t>.5&&this.isMajor()&&this.isClosed()?(n=!0,t=0,e=1):1===e?t=e:e=t:(t>0&&i.isEqual(this.m_XStart,this.m_YStart)&&(t=0),e<1&&o.isEqual(this.m_XEnd,this.m_YEnd)&&(e=1),n=0===t&&1===e)),s.m_center.assign(this.m_center),s.m_semiMajorAxis=this.m_semiMajorAxis,s.m_minorMajorRatio=this.m_minorMajorRatio,s.m_interior.assign(this.m_interior),s.m_rotation=this.m_rotation,s.m_cosr=this.m_cosr,s.m_sinr=this.m_sinr,s.m_sweepAngle=this.m_sweepAngle,s.m_startAngle=this.m_startAngle,s.m_bits=this.m_bits,D(s,i.x,i.y),F(s,o.x,o.y),n?ur(s,tr(this)):(s.m_startAngle=Qi(this,t),s.m_sweepAngle=Qi(this,e)-s.m_startAngle,s.m_startAngle=ji(s.m_startAngle),gr(s,Math.abs(s.m_sweepAngle)>Math.PI),Er(s),s.afterCompletedModification())}changeEndPoints2D(t,e){sr(this,t,e,!1)}getAttributeAsDbl(t,e,s){if(0===e)return 0===s?this.getCoordX(t):this.getCoordY(t);if(0===t)return this.getStartAttributeAsDbl(e,s);if(1===t)return this.getEndAttributeAsDbl(e,s);const n=this.calculateLength2D(),i=n>0?this.tToLength(t)/n:0,o=Fi.getInterpolation(e),a=this.getStartAttributeAsDbl(e,s),l=this.getEndAttributeAsDbl(e,s);return(0,r.V)(o,a,l,i,Fi.getDefaultValue(e))}getClosestCoordinate(t,e){return Ar(this,t,r.E.unit(),e)}getClosestCoordinateOnInterval(t,e,s=-1){return Ar(this,t,e,!1)}getYMonotonicParts(t,e=!1){t.length<2&&(0,n.a)("");const s=this.getSemiAxes(),i=Math.atan2(s.y*this.m_cosr,s.x*this.m_sinr),o=i+(0,r.$)(),a=(0,r.d)(3,Number.NaN);let l=0;if(a[0]=Ki(this,i),a[0]>0&&a[0]<1&&l++,a[1]=Ki(this,o),a[1]>0&&a[1]<1&&(a[l]=a[1],l++),0===l)return 0;a[l]=1,l++,(0,n.g)(t.length>=l);let h=0;for(let n=0;n<l;n++){const s=a[n];this.queryCut(h,s,t[n],e),h=s}return l}getMonotonicParts(t,e){if(t.length<4&&(0,n.a)(""),this.isDegenerateToLine())return t[0].createEllipticArc().assignCopy(this),e&&t[0].get().dropAllAttributes(),1;const s=this.getSemiAxes(),i=(0,r.d)(4,Number.NaN);i[0]=Math.atan2(s.y*this.m_cosr,s.x*this.m_sinr),i[1]=i[0]+(0,r.$)(),i[2]=Math.atan2(-s.y*this.m_sinr,s.x*this.m_cosr),i[3]=i[2]+(0,r.$)();const o=(0,r.d)(5,Number.NaN);let a=0;for(let n=0;n<4;n++)o[a]=Ki(this,i[n]),o[a]>0&&o[a]<1&&a++;if(0===a)return 0;(0,r.Z)(o,a),o[a-1]<1&&(o[a]=1,a++),(0,n.g)(t.length>=a);let l=0;for(let n=0;n<a;n++){const s=o[n];this.queryCut(l,s,t[n],e),l=s}return a}intersectionWithAxis2D(t,e,s,n){if(rr(this))return new Br({start:this.getStartXY(),end:this.getEndXY()}).intersectionWithAxis2D(t,e,s,n);let i,o;const a=new r.H(e),l=this.getSemiAxes();if(t){if(e>this.m_center.y+l.x||e<this.m_center.y-l.x)return 0;i=new r.H(l.x).mulThis(this.m_sinr),o=new r.H(l.y).mulThis(this.m_cosr),a.subThis(this.m_center.y)}else{if(e>this.m_center.x+l.x||e<this.m_center.x-l.x)return 0;i=new r.H(l.x).mulThis(this.m_cosr),o=new r.H(l.y).mulThis(-this.m_sinr),a.subThis(this.m_center.x)}const h=i.sqr(),u=o.sqr(),c=h.addE(u),m=o.mulE(a).mulThis(-2),d=a.sqr().subThisE(h),g=m.sqr().subThisE(c.mulE(d).mulThis(4)),p=i.mulE(a).mulThis(-2),_=a.sqr().subThisE(u),f=p.sqr().subThisE(c.mulE(_).mulThis(4));let y=g.eps()*Math.abs(f.value())<=f.eps()*Math.abs(g.value());y?i.isZero()&&(y=!1):o.isZero()&&(y=!0),y||(m.setE(p),d.setE(_));const x=(0,r.m)(r.H,2);let v=zt(c,m,d,r.E.construct(-1,1),!1,x);if(0===v)return 0;const b=[0,0];let P=0;for(let S=0;S<v;S++){const t=new r.H,e=new r.H;y?(t.setE(x[S]),e.setE(a.subE(o.mulE(x[S])).divThisE(i))):(e.setE(x[S]),t.setE(a.subE(i.mulE(x[S])).divThisE(o)));const s=Ki(this,Math.atan2(t.value(),e.value()));s>=0&&s<=1&&(b[P]=s,P++)}return v=P,0===v?0:(2===v&&b[0]>b[1]&&(b[1]=(0,r.c)(b[0],b[0]=b[1])),n&&(0,r.b)(n,b,0,0,v),s&&(s[0]=t?this.getCoordX(b[0]):this.getCoordY(b[0]),v>1&&(s[1]=t?this.getCoordX(b[1]):this.getCoordY(b[1]),!n&&s[0]>s[1]&&(s[1]=(0,r.c)(s[0],s[0]=s[1])))),v)}intersectionOfYMonotonicWithAxisX(t,e){if(this.m_YStart===this.m_YEnd)return t===this.m_YStart?e:Number.NaN;if(t===this.m_YStart)return this.m_XStart;if(t===this.m_YEnd)return this.m_XEnd;const s=[0,0];return-1===this.intersectionWithAxis2D(!0,t,s,null)?e:s[0]}isCurve(){return!0}isDegenerate(t){return w(this,t)}isDegenerate3D(t,e){return(0,n.g)(0),!1}queryLooseEnvelope(t){3!==t.m_EnvelopeType?this.queryLooseEnvelopeOnInterval(new r.E(0,1),t):(0,n.t)("3d not impl")}clone(t){const e=new Ri;return this.copyTo(e),e}queryInterval(t,e){if(0===t){if(rr(this))return 0===e?r.E.construct(this.getStartX(),this.getEndX()):r.E.construct(this.getStartY(),this.getEndY());let t;const s=this.getSemiAxes();t=0===e?Math.atan2(-s.y*this.m_sinr,s.x*this.m_cosr):Math.atan2(s.y*this.m_cosr,s.x*this.m_sinr);const n=t+Math.PI,i=[0,0];i[0]=Ki(this,t),i[1]=Ki(this,n);const o=0===e?r.E.construct(this.getStartX(),this.getEndX()):r.E.construct(this.getStartY(),this.getEndY()),a=new r.P;for(let r=0;r<2;r++){const t=i[r];t>0&&t<1&&(this.queryCoord2D(t,a),o.mergeNeCoordinate(0===e?a.x:a.y))}return o}return super.queryInterval(t,e)}queryLooseEnvelopeOnInterval(t,e){const s=new r.E(0,1);if(s.intersect(t),s.isEmpty())return void e.setEmpty();if(rr(this))return e.setCoords(this.getCoord2D(s.vmin)),void e.mergeNe(this.getCoord2D(s.vmax));const n=this.getCoord2D(s.vmin),i=this.getCoord2D(s.vmax);if(1===this.m_minorMajorRatio&&Math.abs(this.m_sweepAngle)*s.width()<=r.o){let t=r.P.lerp(n,i,.5);const s=t.sub(this.m_center);return s.normalize(),t=t.add(s.mul(.5*r.P.distance(n,i))),e.setCoords(n),e.mergeNe(i),void e.mergeNe(t)}Tr(this,s,e)}tToLength(t){return rr(this)?t*r.P.distance(this.getStartXY(),this.getEndXY()):1===this.m_minorMajorRatio?Math.abs(this.getSweepAngle()*t)*this.m_semiMajorAxis:or(this,t)}parametricAngleToT(t){return Ki(this,t)}tToParametricAngle(t){return Qi(this,t)}lengthToT(t){if(rr(this)){const e=r.P.distance(this.getStartXY(),this.getEndXY());return 0===e?0:t/e}if(1===this.m_minorMajorRatio){const e=Math.abs(this.getSweepAngle())*this.m_semiMajorAxis;return 0===e?0:t/e}return function(t,e){if(rr(t)){const s=r.P.distance(t.getStartXY(),t.getEndXY());return 0===s?0:e/s}if(1===t.m_minorMajorRatio){const s=Math.abs(t.getSweepAngle()*t.m_semiMajorAxis);return 0===s?0:e/s}if(0===e)return 0;const s=t.getSweepAngle();if(0===s)return.5;const n=er(t),i=(0,r.T)(),o=ar(t);s<0&&(e=-e);const a=e/t.m_semiMajorAxis+o;let l=(0,r.ab)(a,n.e2,n.completeE);return l-=i,l-=t.getStartAngle(),l/s}(this,t)}calculateWeightedAreaCentroid2D(t){if(rr(this)){const t=new r.P;return t.setCoords(0,0),t}const e=Sr(this),s=this.getStartXY().sub(this.m_center),n=this.getEndXY().sub(this.m_center),i=this.m_semiMajorAxis,o=this.getSemiMinorAxis(),a=this.m_startAngle+this.m_sweepAngle,l=new r.P;l.x=i*o*(i*this.m_cosr*(-Math.sin(a)+Math.sin(this.m_startAngle))+o*(-Math.cos(a)+Math.cos(this.m_startAngle))*this.m_sinr)/3,l.y=i*o*(o*(Math.cos(a)-Math.cos(this.m_startAngle))*this.m_cosr+i*(-Math.sin(a)+Math.sin(this.m_startAngle))*this.m_sinr)/3;const h=n.add(s).mul(n.crossProduct(s)/6);return l.x-=h.x,l.y-=h.y,l.add(this.m_center.sub(t).mul(e))}calculateWeightedCentroid2D(){const t=new r.P;if(this.isDegenerate(0))return t.setCoords(0,0),t;if(rr(this))return t.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),t;let e=this.m_startAngle,s=this.m_startAngle+this.m_sweepAngle;if(s<e){const t=e;e=s,s=t}const n=Math.sin(e),i=Math.sin(s),o=Math.cos(e),a=Math.cos(s);if(1===this.m_minorMajorRatio){const e=this.getSemiMajorAxis(),s=e*e,r=s*(i-n),l=s*(o-a);t.setCoords(r,l)}else{const e=this.getSemiMajorAxis(),s=this.getSemiMinorAxis(),r=e*e,l=s*s,h=e*s,u=r-l,c=u/l,m=u/r,d=Math.sqrt(c),g=Math.sqrt(m),p=.5*h*(Math.asinh(d*i)/d+i*Math.sqrt(1+c*i*i))-.5*h*(Math.asinh(d*n)/d+n*Math.sqrt(1+c*n*n)),_=-.5*h*(Math.asin(g*a)/g+a*Math.sqrt(1-m*a*a))- -.5*h*(Math.asin(g*o)/g+o*Math.sqrt(1-m*o*o));t.setCoords(p,_)}return t.rotateDirect(this.m_cosr,this.m_sinr),t.assign(t.add(this.m_center.mul(this.calculateLength2D()))),t}isIntersectingPoint(t,e,s){if(s&&(t.isEqualPoint2D(this.getStartXY())||t.isEqualPoint2D(this.getEndXY())))return!1;if(!rr(this)){const s=r.P.distance(t,this.m_center),n=this.getSemiAxes();if(s<n.x-e||s>n.y+e)return!1}const n=this.getClosestCoordinate(t,!1),i=new r.P;return this.queryCoord2D(n,i),r.P.distance(i,t)<=e}isIntersectingPoint3D(t,e,s,i,r=1){return(0,n.g)(0),!1}getTangent(t){if(rr(this))return this.getEndXY().sub(this.getStartXY());{const e=Qi(this,t),s=new r.P;return s.setCoords(-this.m_semiMajorAxis*Math.sin(e),this.getSemiMinorAxis()*Math.cos(e)),this.m_rotation&&s.rotateDirect(this.m_cosr,this.m_sinr),s.scale(this.getSweepAngle()),s}}getDerivative(t){if(rr(this))return this.getEndXY().sub(this.getStartXY());{const e=Qi(this,t),s=new r.P;return s.setCoords(-this.m_semiMajorAxis*Math.sin(e),this.getSemiMinorAxis()*Math.cos(e)),this.m_rotation&&s.rotateDirect(this.m_cosr,this.m_sinr),s.scale(this.getSweepAngle()),s}}normalizeAfterEndpointChange(){return!!_r(this)&&(rr(this)?(fr(this),!1):yr(this,!1))}projectionBehavior(){return(4&this.m_bits)>>2}setProjectionBehavior(t){this.m_bits=-5&this.m_bits|t<<2}convertToCanonic(t){const e=new r.P(t.x,t.y);return e.subThis(this.m_center),e.rotateReverse(this.m_cosr,this.m_sinr),e}convertFromCanonic(t){const e=new r.P(t.x,t.y);return e.rotateDirect(this.m_cosr,this.m_sinr),e.addThis(this.m_center),e}canonicToWorldTransformation(t){t.setRotate(this.m_cosr,this.m_sinr),t.shiftCoords(this.m_center.x,this.m_center.y)}getCurvature(t){const e=Qi(this,t),s=new r.P,n=this.getSemiMinorAxis();s.setCoords(-this.m_semiMajorAxis*Math.sin(e),n*Math.cos(e));const i=new r.P;i.setCoords(-this.m_semiMajorAxis*Math.cos(e),-n*Math.sin(e)),this.m_rotation&&(s.rotateDirect(this.m_cosr,this.m_sinr),i.rotateDirect(this.m_cosr,this.m_sinr));const o=s.sqrLength();if(0===o)return Number.NaN;const a=Math.sqrt(o);return s.divThis(a),s.crossProduct(i)/o}getMonotonicPartParams(t,e){const s=(0,r.d)(6,Number.NaN);s[0]=0;let i=1;if(this.isDegenerateToLine())s[1]=1,i=2;else{const t=this.getSemiAxes(),e=(0,r.d)(4,Number.NaN);this.m_rotation?(e[0]=Math.atan2(t.y*this.m_cosr,t.x*this.m_sinr),e[1]=e[0]+Math.PI,e[2]=Math.atan2(-t.y*this.m_sinr,t.x*this.m_cosr),e[3]=e[2]+Math.PI):(e[0]=0,e[1]=Math.PI,e[2]=.5*Math.PI,e[3]=(0,r.a1)());for(let n=0;n<4;n++){const t=Ki(this,e[n]);t>0&&t<1&&(s[i]=t,i++)}i>2&&(0,r.Z)(s,i),s[i]=1,i++}if(e){t<i&&(0,n.a)("");for(let t=0;t<i;t++)e[t]=s[t]}return i}calculateLowerLength2D(){const t=r.P.distance(this.getStartXY(),this.getEndXY());if(this.isDegenerateToLine())return t;const e=Math.abs(this.m_sweepAngle)*this.getSemiMinorAxis();return Math.max(e,t)}calculateUpperLength2D(){const t=r.P.distance(this.getStartXY(),this.getEndXY());if(this.isDegenerateToLine())return t;const e=Math.abs(this.m_sweepAngle)*this.getSemiMajorAxis();return Math.max(e,t)}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=(0,r.c)(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=(0,r.c)(this.m_YStart,this.m_YStart=this.m_YEnd);for(let t=0,e=this.m_description.getTotalComponentCount()-2;t<e;t++)this.m_attributes[t+e]=(0,r.c)(this.m_attributes[t],this.m_attributes[t]=this.m_attributes[t+e]);this.m_startAngle=this.m_startAngle+this.m_sweepAngle,this.m_sweepAngle=-this.m_sweepAngle}}isLine(){return rr(this)}copyIgnoreAttributes(t){t.m_XStart=this.m_XStart,t.m_YStart=this.m_YStart,t.m_XEnd=this.m_XEnd,t.m_YEnd=this.m_YEnd,t.m_center.assign(this.m_center),t.m_semiMajorAxis=this.m_semiMajorAxis,t.m_minorMajorRatio=this.m_minorMajorRatio,t.m_interior.assign(this.m_interior),t.m_rotation=this.m_rotation,t.m_cosr=this.m_cosr,t.m_sinr=this.m_sinr,t.m_sweepAngle=this.m_sweepAngle,t.m_startAngle=this.m_startAngle,t.m_bits=this.m_bits,cr(t)}calculateArea2DHelper(){return Sr(this)}absNorm(){let t=this.getStartXY().norm(1)+this.getEndXY().norm(1);return this.isDegenerateToLine()||(t+=this.m_center.norm(1),t+=this.m_semiMajorAxis),t}queryEnvelopeW(t,e){if(e.setCoords(this.getCoord2D(t.vmin)),e.mergeNe(this.getCoord2D(t.vmax)),rr(this))return;const s=this.getSemiAxes(),n=(0,r.d)(8,Number.NaN);{const t=Math.atan2(-s.y*this.m_sinr,s.x*this.m_cosr),e=t+Math.PI,i=Math.atan2(s.y*this.m_cosr,s.x*this.m_sinr),r=i+Math.PI;n[0]=Ki(this,t),n[1]=Ki(this,e),n[2]=Ki(this,i),n[3]=Ki(this,r)}{const t=this.m_cosr+this.m_sinr,e=this.m_cosr-this.m_sinr,i=Math.atan2(-s.y*t,s.x*e),r=i+Math.PI,o=Math.atan2(s.y*e,s.x*t),a=o+Math.PI;n[4]=Ki(this,i),n[5]=Ki(this,r),n[6]=Ki(this,o),n[7]=Ki(this,a)}const i=r.P.getNAN();for(let r=0;r<8;r++){const s=n[r];t.containsExclusiveCoordinate(s)&&(this.queryCoord2D(s,i),e.mergeNe(i))}}setSegmentFromCoordsForStitcher(t,e){!function(t,e,s){const n=0===t.projectionBehavior();if(s<=2)return void ir(t,e[0],e[s-1],n?0:1);if(n){t.constructCircularArcThreePoint(e[0],e[s-1],e[Math.trunc(s/2)]);const n=new r.P;return t.queryCoord2D(.5,n),void t.m_interior.setCoordsPoint2D(n)}const i=t.getSemiMajorAxis(),o=t.getMinorMajorRatio(),a=t.getAxisXRotation(),l=t.getCenter(),h=new Array(4);h[0]=t.isMajor(),h[1]=!h[0],h[2]=h[0],h[3]=!h[0];const u=new Array(4);u[0]=t.isClockwise(),u[1]=u[0],u[2]=!u[0],u[3]=!u[0];const c=Math.trunc(s<5?1:(s+4)/5),m=(0,r.m)(Ri,4),d=(0,r.d)(4,Number.NaN);let g=0;for(let p=0;p<4;p++){m[p].constructEllipticArcEndPointsCenter(e[0],e[s-1],i,o,a,h[p],u[p],l),d[p]=0;let t=0;for(let n=c;n<s-1;n+=c){const s=m[p].getClosestCoordinate(e[n],!1);d[p]+=r.P.sqrDistance(m[p].getCoord2D(s),e[n]),t++}d[p]/=t,d[p]<d[g]&&(g=p)}t.assignCopy(m[g])}(this,t,e)}writeInBufferStream(t,e){const s=new Float64Array(10);return s[0]=this.m_bits,s[1]=this.m_semiMajorAxis,s[2]=this.m_minorMajorRatio,s[3]=this.m_rotation,s[4]=this.m_center.x,s[5]=this.m_center.y,s[6]=this.m_sweepAngle,s[7]=this.m_startAngle,s[8]=this.m_interior.x,s[9]=this.m_interior.y,t.writeRangeFromArray(e,s.length,s,!0,1),e+s.length}readFromBufferStream(t,e){const s=new Float64Array(10);t.queryRange(e,s.length,s,!0,1),this.m_bits=s[0],this.m_semiMajorAxis=s[1],this.m_minorMajorRatio=s[2],this.m_rotation=s[3],this.m_center.x=s[4],this.m_center.y=s[5],this.m_sweepAngle=s[6],this.m_startAngle=s[7],this.m_interior.x=s[8],this.m_interior.y=s[9],this.m_cosr=Math.cos(this.m_rotation),this.m_sinr=Math.sin(this.m_rotation),this.m_cachedValues=null}snapControlPoints(t){return!1}needsSnapControlPoints(t){return!1}calculateSpecialPointsForCracking(t,e){return(0,n.d)("should not1; be called"),0}ensureXYMonotone(){if(rr(this))return!1;if(this.getStartXY().equals(this.getEndXY()))return ir(this,this.getStartXY(),this.getEndXY(),this.projectionBehavior()),!0;const t=(0,r.m)(r.P,3);let e=xr(this,t);if(ei(t)){let s=!1;if(0===this.projectionBehavior()){const n=new o.Envelope2D;n.setCoords({pt:t[0]}),n.mergeNe(t[2]);const i=new r.P;i.setSub(t[2],t[0]),i.leftPerpendicularThis(),i.normalize(),i.scale(r.P.distance(t[2],t[0]));const a=r.P.lerp(t[2],t[0],.5),l=a.sub(i),h=a.add(i);n.clipLine(l,h);const u=r.P.getClosestCoordinate(l,h,t[1],!1);t[1]=r.P.lerp(l,h,u);const c=t[2].sub(t[1]),m=t[0].sub(t[1]),d=c.crossProduct(m),g=c.dotProduct(m);e=(0,r.T)()-Math.abs(.5*Math.atan2(d,g)),s=!0}return vr(t,e*e,null,s,this),!0}return!1}setCoordsForIntersector(t,e,s){sr(this,t,e,s)}getInteriorPoint(){return this.m_interior.clone()}copyToImpl(t){const e=t;e.m_center.assign(this.m_center),e.m_semiMajorAxis=this.m_semiMajorAxis,e.m_minorMajorRatio=this.m_minorMajorRatio,e.m_interior.assign(this.m_interior),e.m_rotation=this.m_rotation,e.m_cosr=this.m_cosr,e.m_sinr=this.m_sinr,e.m_sweepAngle=this.m_sweepAngle,e.m_startAngle=this.m_startAngle,e.m_bits=this.m_bits,ur(e,tr(this))}reverseImpl(){mr(this,!dr(this)),$i(this),(0!==this.projectionBehavior()||this.getStartXY().equals(this.getEndXY()))&&Er(this)}equalsImpl(t){const e=t;if(this.m_bits!==e.m_bits)return!1;if(this.m_semiMajorAxis!==e.m_semiMajorAxis)return!1;if(this.m_minorMajorRatio!==e.m_minorMajorRatio)return!1;if(!(this.m_center.isEqualPoint2D(e.m_center)||this.m_center.isNAN()&&e.m_center.isNAN()))return!1;if(this.m_rotation!==e.m_rotation)return!1;if(!this.m_interior.equals(e.m_interior))return!1;const s=e.m_sweepAngle;if(this.m_sweepAngle!==s)return!1;const n=e.m_startAngle;return this.m_startAngle===n}equalsImplTol(t,e){const s=t;if(this.m_bits!==s.m_bits)return!1;if(this.m_center.isNAN()&&s.m_center.isNAN())return!0;if(this.m_center.isNAN()!==s.m_center.isNAN())return!1;if(!this.getSemiAxes().isEqualPoint2D(s.getSemiAxes(),e))return!1;if(!this.m_center.isEqualPoint2D(s.m_center,e))return!1;const n=Math.abs(Ti(Ii(Ai(this.m_rotation-s.m_rotation)))),i=Math.abs((0,r.$)()-n),o=Math.min(n,i);if(this.m_semiMajorAxis*Math.abs(o)>e)return!1;const a=this.getCoord2D(.5),l=s.getCoord2D(.5);return!!a.isEqualPoint2D(l,e)}swapImpl(t){const e=t;this.m_center=(0,r.c)(e.m_center,e.m_center=this.m_center),this.m_semiMajorAxis=(0,r.c)(e.m_semiMajorAxis,e.m_semiMajorAxis=this.m_semiMajorAxis),this.m_minorMajorRatio=(0,r.c)(e.m_minorMajorRatio,e.m_minorMajorRatio=this.m_minorMajorRatio),this.m_interior=(0,r.c)(e.m_interior,e.m_interior=this.m_interior),this.m_rotation=(0,r.c)(e.m_rotation,e.m_rotation=this.m_rotation),this.m_cosr=(0,r.c)(e.m_cosr,e.m_cosr=this.m_cosr),this.m_sinr=(0,r.c)(e.m_sinr,e.m_sinr=this.m_sinr),this.m_sweepAngle=(0,r.c)(e.m_sweepAngle,e.m_sweepAngle=this.m_sweepAngle),this.m_startAngle=(0,r.c)(e.m_startAngle,e.m_startAngle=this.m_startAngle),this.m_bits=(0,r.c)(e.m_bits,e.m_bits=this.m_bits),function(t,e){e.m_cachedValues=(0,r.c)(t.m_cachedValues,t.m_cachedValues=e.m_cachedValues)}(this,e)}afterCompletedModification(){fr(this),cr(this)}intersect(t,e,s,n,i){return Lr(!1,this,t,e,s,n,i)}intersectPoint(t,e,s){if(e.length<2&&(0,n.q)(""),rr(this))return new Br({start:this.getStartXY(),end:this.getEndXY()}).intersectPoint(t,e,s);{const e=r.P.distance(t,this.m_center);if(e>this.m_semiMajorAxis+s||e<this.getSemiMinorAxis()-s)return 0}const i=this.getClosestCoordinate(t,!1),o=r.P.getNAN();return this.queryCoord2D(i,o),r.P.distance(o,t)<=s?(0,r.N)(i,0,1)&&(this.queryCoord2D(0===i?1:0,o),r.P.distance(o,t)<=s)?(e&&(e[0]=0,e[1]=1),2):(e&&(e[0]=i),1):0}isIntersecting(t,e,s){return 0!==Nr(!1,this,t,e,s)}endPointModified(){this.m_bits|=8,cr(this)}clearEndPointModified(){fr(this)}}function ki(t,e){e.length=t;for(let s=0;s<e.length;++s)e[s]=s;t>3&&c(t,e)}function Li(t,e,s,n,i){let o=0;const a=[0,0,0];let l=0;let h=0;for(let u=0;u<3;++u){let i=!1;for(;h<s;){const s=t.at(e[h]);let c=1;if(3===o?c=r.P.inCircleRobust(t.at(n[0]),t.at(n[1]),t.at(n[2]),s):2===o?c=r.P.inCircleRobust3Point(t.at(n[0]),t.at(n[1]),s):1===o&&s.equals(t.at(n[0]))&&(c=0),c<=0){if(c<0&&u+1<3){e[l]=(0,r.c)(e[h],e[h]=e[l]);for(let t=0;t<o;t++)if(n[t]===e[h]){a[t]=h;break}l++}h++;continue}i=!0;let m=0;for(let t=0;t<o;t++)a[t]>h&&(n[m]=n[t],a[m]=a[t],m++);o=m,n[o]=e[h],a[o]=h,o++,o<3?h=l:(1===r.P.orientationRobust(t.at(n[0]),t.at(n[1]),t.at(n[2]))&&(n[2]=(0,r.c)(n[0],n[0]=n[2]),a[2]=(0,r.c)(a[0],a[0]=a[2])),h++)}if(!i)break;if(u+1<3){l=0;let s=!1;for(let t=0;t<o;t++)for(let e=t+1;e<o;e++)a[t]>a[e]&&(a[e]=(0,r.c)(a[t],a[t]=a[e]),n[e]=(0,r.c)(n[t],n[t]=n[e]),s=!0);for(let t=0;t<o;t++)e[a[t]]=(0,r.c)(e[t],e[t]=e[a[t]]),a[t]=t;s&&3===o&&1===r.P.orientationRobust(t.at(n[0]),t.at(n[1]),t.at(n[2]))&&(n[2]=(0,r.c)(n[0],n[0]=n[2]),a[2]=(0,r.c)(a[0],a[0]=a[2]))}h=o}return o}function Gi(t,e,s,n,i,o){return new Oi(0,0,0,null,!1,(0,r.i)()).densifyEx(t,e,s,n,!1,o)}function Vi(t,e,s,i,o,a,l,h){a&&(a.length=0),l&&(l.length=0);const u=t.getGeometryType();if(u===n.G.enumLine)return a&&(a.push(t.getStartXY()),a.push(r.P.getNAN()),a.push(r.P.getNAN()),a.push(t.getEndXY())),l&&(l.push(0),l.push(1)),1;if(u===n.G.enumBezier){if(!i)return a&&(a.push(t.getStartXY()),a.push(t.getControlPoint1()),a.push(t.getControlPoint2()),a.push(t.getEndXY())),l&&(l.push(0),l.push(1)),1;const e=(0,r.d)(9,Number.NaN);let n=t.getMonotonicPartParams(e.length,e);if(e.length=n,n=qi(t,s,e),2===n&&o&&(e[1]=.5,e.push(1),n=3),l&&l.splice(0,0,...e.slice(0,n)),a){const s=new Yr;for(let i=1;i<n;i++){const n=e[i-1],r=e[i];t.queryCut(n,r,s,!0);const o=s.get();Xs(o),1===i&&a.push(o.getStartXY()),a.push(o.getControlPoint1()),a.push(o.getControlPoint2()),a.push(o.getEndXY())}}return n-1}if(u===n.G.enumEllipticArc){const h=t;if(h.isDegenerateToLine()||h.isDegenerate(0))return a&&(a.push(t.getStartXY()),a.push(r.P.getNAN()),a.push(r.P.getNAN()),a.push(t.getEndXY())),l&&(l.push(0),l.push(1)),1;if(i&&(o||!h.isMonotoneQuickAndDirty())){const u=(0,r.d)(6,Number.NaN);let c=h.getMonotonicPartParams(u.length,u);u.length=c,c=qi(t,s,u),2===c&&o&&(u[1]=.5,u.push(1),c=3);let m=0;if(c>2){const t=new Yr,r=l||[];let o=0;for(let d=1;d<c;d++){const g=u[o],p=u[d];if(h.queryCut(g,p,t,!0),t.get().isDegenerate(0))continue;const _=r.length,f=Bi(1===d,t.get(),e,s,i,a,l);(0,n.g)(f>0),m+=f;const y=d===c-1,x=u[o],v=t.get().getSweepAngle()/h.getSweepAngle();for(let t=_,e=r.length;t<e;t++)if(r[t]=!y||t+1<e?x+r[t]*v:1,a){const e=3*t,s=h.getCoord2D(r[t]);a[e].setCoordsPoint2D(s),e>0&&js(a.slice(e-3))}o=d}return m}}return Bi(!0,h,e,s,i,a,l)}if(u===n.G.enumRationalBezier2){const n=t;if(i&&(o||!n.isMonotoneQuickAndDirty())){const i=(0,r.d)(6,Number.NaN);let h=n.getMonotonicPartParams(i.length,i);i.length=h,h=qi(t,s,i),2===h&&o&&(i[1]=.5,i.push(1),h=3);let u=0;if(h>2){const t=new Yr,r=l||[];for(let o=1;o<h;o++){const c=i[o-1],m=i[o];n.queryCut(c,m,t,!0);const d=r.length;u+=Yi(1===o,t.get(),e,s,!1,a,l);const g=o===h-1,p=i[o-1];for(let t=d,e=r.length;t<e;t++)if(r[t]=!g||t+1<e?p+r[t]:1,a){const e=3*t,s=n.getCoord2D(r[t]);a[e].setCoordsPoint2D(s),e>0&&Be(a.slice(e-3))}}return u}}return Yi(!0,n,e,s,i,a,l)}if(u===n.G.enumBezier2){const n=t,h=(0,r.m)(r.P,3);n.queryControlPoints(h);const u=new In;u.constructFromQuadratic(h);const c=Vi(u,e,s,i,o,a,l);if(null!=a&&null!=l){const t=3;for(let e=1,s=0;e<c;++e,s+=t){const o=new r.P;n.queryCoord2D(l[e],o);const h=a[s+t];!o.equals(h)&&(a[s+t].setCoordsPoint2D(o),i)&&js(a.slice(s,s+4))}}return c}(0,n.t)("")}function zi(t,e,s,i,o,a,l,h,u){const c=t.getGeometryType();if(a&&(a.length=0,l.length=0),h&&(h.length=0),c===n.G.enumEllipticArc){const e=t;if(e.isDegenerateToLine()||e.isDegenerate(0))return a&&(a.push(t.getStartXY()),a.push(r.P.getNAN()),a.push(t.getEndXY()),l.push(Number.NaN),l.push(Number.NaN),l.push(Number.NaN)),h&&(h.push(0),h.push(1)),1}const m=(0,r.d)(9,Number.NaN);let d;if(o)d=t.getMonotonicPartParams(m.length,m),m.length=d,d=qi(t,s,m);else{if(d=2,m[0]=0,m[1]=1,c===Ri.type){const e=t.getSweepAngle();if(e>.9*Math.PI){const t=2*Math.PI/3;Math.min(3,Math.trunc(e/t+.5))>2?(m[0]=0,m[1]=1/3,m[2]=2/3,m[3]=1,d=4):(m[0]=0,m[1]=.5,m[2]=1,d=3)}}else(0,n.g)(c===Wt.type);m.length=d}if(2===d&&i&&(m[1]=.5,m.push(1),d=3),a){const e=new Yr;let s=1;for(;s<d;){const i=m[s-1],h=m[s];t.queryCut(i,h,e,!0);const u=(0,r.m)(r.P,3),g=[1,1,1];if(c===n.G.enumEllipticArc){const t=e.get();if(Math.abs(t.getSweepAngle())>.9*Math.PI){const t=(h-i)/3;m.splice(s,0,i+t),m.splice(s+1,0,i+2*t),d+=2;continue}g[1]=xr(t,u)}else{const t=e.get();t.queryControlPoints(u),t.queryWeights(g)}o&&ei(u),1===s&&(a.push(u[0].clone()),l.push(g[0])),a.push(u[1].clone()),a.push(u[2].clone()),l.push(g[1]),l.push(g[2]),s++}}return h&&(h.length=d,(0,r.b)(h,m,0,0,d)),d-1}Ri.type=n.G.enumEllipticArc;class Oi{static constructDefault(t){return new Oi(0,0,0,t,!1,(0,r.i)())}constructor(t,e,s,o,a,l){this.m_segmentBuffer=null,this.m_dummyPoint=new i.P,this.m_progressCounter=0,this.m_progressTracker=o,this.m_bSetDensifyFlag=a,this.m_maxLength=t,this.m_maxDeviation=e,this.m_maxAngle=s>(0,r.T)()?(0,r.T)():s,this.m_cosMaxAngle=Math.cos(this.m_maxAngle),this.m_bOnlyCurveDensify=this.m_maxAngle>0||this.m_maxDeviation>0,this.m_maxSegmentsPerCurve=l,(0,n.x)(this.m_maxSegmentsPerCurve>0,"this.m_maxSegmentsPerCurve > 0"),this.m_minStep=1/this.m_maxSegmentsPerCurve}densify(t){return this.densifyGeom(t)}densifySegment(t,e){this.densifySegmentEx(t,null,!0,!1,e)}densifyEx(t,e,s,i,o,a){return this.m_maxLength=e,this.m_maxDeviation=s,this.m_maxAngle=i>(0,r.T)()?(0,r.T)():i,this.m_cosMaxAngle=Math.cos(this.m_maxAngle),this.m_bOnlyCurveDensify=this.m_maxAngle>0||this.m_maxDeviation>0,this.m_bSetDensifyFlag=o,this.m_maxSegmentsPerCurve=a,(0,n.x)(this.m_maxSegmentsPerCurve>0,"this.m_maxSegmentsPerCurve > 0"),this.m_minStep=1/this.m_maxSegmentsPerCurve,this.densifyGeom(t)}densifyGeom(t){if(t.isEmpty()||t.getDimension()<1)return t;const e=t.getGeometryType();return(0,n.j)(e)?t:(0,n.h)(e)?this.densifyMultiPath(t):(0,n.f)(e)?this.densifySegmentImpl(t):e===n.G.enumEnvelope?this.densifyEnvelope(t):void(0,n.d)("")}densifySegmentEx(t,e,s,i,r){const o=t.getGeometryType();if(!(this.m_maxLength>0||this.m_bOnlyCurveDensify&&o!==n.G.enumLine)&&(!i||s))return void(e?o===n.G.enumLine?e.addSegment(t,s):(s&&(t.queryStart(this.m_dummyPoint),e.startPathPoint(this.m_dummyPoint)),t.queryEnd(this.m_dummyPoint),e.lineToPoint(this.m_dummyPoint)):(s&&r.push(0),r.push(1)));if(o===n.G.enumBezier)return void this.densifyCubicBezier(t,e,s,i,r);if(o===n.G.enumRationalBezier2)return void this.densifyRationalBezier2(t,e,s,i,r);if(o===n.G.enumBezier2)return void this.densifyBezier2(t,e,s,i,r);if(o===n.G.enumEllipticArc&&!t.isLine()&&t.getMinorMajorRatio()<.25)return void this.densifyEllipticArc(t,e,s,i,r);let a=1;this.m_maxLength>0&&(a=this.calculateLengthSubdivisionStep(t,this.m_maxLength)),this.m_maxDeviation>0&&(a=Math.min(a,this.calculateDeviationSubdivisionStep(t,this.m_maxDeviation))),this.m_maxAngle>0&&(a=Math.min(a,this.calculateAngularSubdivisionStep(t,this.m_maxAngle))),this.densifySegmentByLength(t,a,e,s,i,r)}densifyMultiPath(t){if(!t.hasNonLinearSegments()){if(1===t.getDescription().getAttributeCount())return this.densifyMultiPathLinear(t);if(!(this.m_maxLength>0))return t}const e=t.createInstance();e.getGeometryType()===n.G.enumPolygon&&e.setFillRule(t.getFillRule()),e.reserve(t.getPointCount());const s=t.getImpl().querySegmentIterator();for(;s.nextPath();){let t=!0;for(;s.hasNextSegment();){const n=s.nextSegment(),i=s.isClosingSegment();this.densifySegmentEx(n,e,t,i,null),i&&e.closePathWithLine(),t=!1}}return e}densifySegmentImpl(t){const e=new Ct({vd:t.getDescription()});return this.densifySegmentEx(t,e,!0,!1,[0]),e}densifyEnvelope(t){const e=new os({vd:t.getDescription()});e.addEnvelope(t,!1);const s=o.Envelope2D.constructEmpty();t.queryEnvelope(s);const n=s.width(),i=s.height();return!(this.m_maxLength>0)||n<=this.m_maxLength&&i<=this.m_maxLength?e:this.densifyMultiPath(e)}densifyMultiPathLinear(t){if(!(this.m_maxLength>0))return t;const e=t.createInstance();e.getGeometryType()===n.G.enumPolygon&&e.setFillRule(t.getFillRule()),e.reserve(t.getPointCount());const s=e.getImpl(),i=t.getImpl(),o=i.getAttributeStreamRef(0),a=new Br;for(let n=0,l=i.getPathCount();n<l;n++){const t=i.isClosedPath(n);if(0===i.getPathSize(n))continue;const l=i.getPathStart(n),h=o.readPoint2D(2*l),u=h.clone();s.startPath(h);for(let c=l+1,m=i.getPathEnd(n);c<m;c++){const t=o.readPoint2D(2*c),n=r.P.distance(u,t);if(n>this.m_maxLength){let e=Math.ceil(n/this.m_maxLength);e>(0,r.i)()&&(e=(0,r.i)());const i=1/e;let o,l,h;u.compare(t)<0?(a.setStartXY(u),a.setEndXY(t),o=0,l=1):(a.setStartXY(t),a.setEndXY(u),o=e-2,l=-1);for(let t=0,n=e-1;t<n;t++,o+=l){this.progress_(),h=i*(o+1);const t=new r.P;a.queryCoord2D(h,t),s.lineTo(t),this.m_bSetDensifyFlag&&s.setAttributeNoCurves(10,s.getPointCount()-1,0,1)}}else this.progress_();e.lineTo(t),u.assign(t)}if(t){const t=r.P.distance(u,h);if(t>this.m_maxLength){const e=h;let n=Math.ceil(t/this.m_maxLength);n>(0,r.i)()&&(n=(0,r.i)());const i=1/n;let o,l;u.compare(e)<0?(a.setStartXY(u),a.setEndXY(e),o=0,l=1):(a.setStartXY(e),a.setEndXY(u),o=n-2,l=-1);const c=new r.P(0,0);let m;for(let t=0,r=n-1;t<r;t++,o+=l)this.progress_(),m=i*(o+1),a.queryCoord2D(m,c),s.lineTo(c),this.m_bSetDensifyFlag&&s.setAttributeNoCurves(10,s.getPointCount()-1,0,1)}s.closePathWithLine()}}return e}densifySegmentByLength(t,e,s,i,o,a){(0,n.g)(t.getGeometryType()!==n.G.enumBezier);let l=t.getStartXY().compare(t.getEndXY());0===l&&e<1&&(t.getGeometryType()===n.G.enumEllipticArc?l=t.getSweepAngle()<0?1:-1:(0,n.t)("densify segment by length"));let h=0;if(i&&(s?(t.queryStart(this.m_dummyPoint),s.startPathPoint(this.m_dummyPoint)):a.push(0),++h),e*this.m_maxSegmentsPerCurve<1&&(e=1/this.m_maxSegmentsPerCurve),e<1){this.m_segmentBuffer||(this.m_segmentBuffer=new Yr);let n=Math.ceil(1/e);n>(0,r.i)()&&(n=(0,r.i)()),e=1/n,this.m_segmentBuffer.create(t.getGeometryType());let i,o,u,c=t;l<0?(i=0,o=1):(t.copyTo(this.m_segmentBuffer.get()),this.m_segmentBuffer.get().reverse(),i=n-2,o=-1,c=this.m_segmentBuffer.get());const m=n-1;for(let t=0;t<m;t++,i+=o)u=e*(i+1),s?(c.queryCoord(u,this.m_dummyPoint),s.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==u&&0!==u&&s.setAttribute(10,s.getPointCount()-1,0,1)):a.push(l>0?1-u:u),this.progress_();u=1,h+=m}(!o||o&&i&&h<2)&&(s?(t.queryEnd(this.m_dummyPoint),s.lineToPoint(this.m_dummyPoint)):a.push(1))}densifyCubicBezier(t,e,s,n,i){const o=new In;let a=t;const l=t.calculateUpperLength2D();let h=t.getStartXY().compare(t.getEndXY());if(0===h&&l>0){const e=(0,r.m)(r.P,4);t.queryControlPoints(e),h=e[1].compare(e[2]),0===h&&(h=e[1].compare(e[0]))}h>0&&(t.copyTo(o),o.reverse(),a=o);let u=0;s&&(e?(t.queryStart(this.m_dummyPoint),e.startPathPoint(this.m_dummyPoint)):i.push(0),++u);const c=[],m=[],d=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve));let g=!0,p=0;if(h>0)for(c.push([a.getStartXY(),a.getControlPoint1(),a.getControlPoint2(),a.getEndXY(),new r.P(0,1)]),m.push(0);c.length;){this.progress_();const t=c.at(-1),o=m.at(-1),l=t[4].x,h=t[4].y;if(o<d&&this.bezierNeedsSplit(t)){g&&(p=a.findMinDeriv(),g=!1);let e=.5*(l+h);Math.abs(p-e)<.4*(h-l)&&(e=p);const s=(e-l)/(h-l),n=t[0].mul(1-s).add(t[1].mul(s)),i=t[1].mul(1-s).add(t[2].mul(s)),u=t[2].mul(1-s).add(t[3].mul(s)),d=n.mul(1-s).add(i.mul(s)),_=i.mul(1-s).add(u.mul(s)),f=d.mul(1-s).add(_.mul(s)),y=t[3];t[1]=n,t[2]=d,t[3]=f,t[4].setCoords(l,e);const x=[f,_,u,y,new r.P(e,h)];c.push(x),m[m.length-1]=o+1,m.push(o+1)}else c.pop(),m.pop(),(c.length>0||!n||n&&s&&u<2)&&(e?(a.queryCoord(l,this.m_dummyPoint),e.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==l&&0!==l&&e.setAttribute(10,e.getPointCount()-1,0,1)):i.push(1-l),++u)}else for(c.push([a.getStartXY(),a.getControlPoint1(),a.getControlPoint2(),a.getEndXY(),new r.P(0,1)]),m.push(0);c.length;){this.progress_();const t=c.at(-1),o=m.at(-1),l=t[4].x,h=t[4].y;if(o<d&&this.bezierNeedsSplit(t)){g&&(p=a.findMinDeriv(),g=!1);let e=.5*(l+h);Math.abs(p-e)<.4*(h-l)&&(e=p);const s=(e-l)/(h-l),n=t[0].mul(1-s).add(t[1].mul(s)),i=t[1].mul(1-s).add(t[2].mul(s)),u=t[2].mul(1-s).add(t[3].mul(s)),d=n.mul(1-s).add(i.mul(s)),_=i.mul(1-s).add(u.mul(s)),f=d.mul(1-s).add(_.mul(s)),y=t[0];t[0]=f,t[1]=_,t[2]=u,t[4].setCoords(e,h);const x=[y,n,d,f,new r.P(l,e)];c.push(x),m[m.length-1]=o+1,m.push(o+1)}else c.pop(),m.pop(),(c.length>0||!n||n&&s&&u<2)&&(e?(a.queryCoord(h,this.m_dummyPoint),e.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==h&&0!==h&&e.setAttribute(10,e.getPointCount()-1,0,1)):i.push(h),++u)}}densifyRationalBezier2(t,e,s,n,i){const o=new Wt;let a=t;const l=t.calculateUpperLength2D();let h=t.getStartXY().compare(t.getEndXY());0===h&&l>0&&(h=0),h>0&&(t.copyTo(o),o.reverse(),a=o);let u=0;s&&(e?(t.queryStart(this.m_dummyPoint),e.startPathPoint(this.m_dummyPoint)):i.push(0),++u);const c=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve)),m=new Wt,d=[],g=[];for(d.push(new r.E(0,1)),g.push(0);d.length;){this.progress_();const t=d.at(-1).clone(),o=g.at(-1);if(o<c&&this.rationalBezier2NeedsSplit(a,m,t.vmin,t.vmax)){const e=t.getCenter();h>0?(d.at(-1).vmax=e,d.push(new r.E(e,t.vmax))):(d.at(-1).vmin=e,d.push(new r.E(t.vmin,e))),g[g.length-1]=o+1,g.push(o+1)}else if(d.pop(),g.pop(),d.length>0||!n||n&&s&&u<2){const s=h>0?t.vmin:t.vmax;e?(a.queryCoord(s,this.m_dummyPoint),e.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==s&&0!==s&&e.setAttribute(10,e.getPointCount()-1,0,1)):i.push(h>0?1-s:s),++u}}}densifyBezier2(t,e,s,n,i){const o=new Kt;let a=t;const l=t.calculateUpperLength2D();let h=t.getStartXY().compare(t.getEndXY());0===h&&l>0&&(h=0),h>0&&(t.copyTo(o),o.reverse(),a=o);let u=0;s&&(e?(t.queryStart(this.m_dummyPoint),e.startPathPoint(this.m_dummyPoint)):i.push(0),++u);const c=Math.ceil(Math.log2(this.m_maxSegmentsPerCurve)),m=new Kt,d=[],g=[];for(d.push(new r.E(0,1)),g.push(0);d.length;){this.progress_();const t=d.at(-1).clone(),o=g.at(-1);if(o<c&&this.bezier2NeedsSplit(a,m,t.vmin,t.vmax)){const e=t.getCenter();h>0?(d.at(-1).vmax=e,d.push(new r.E(e,t.vmax))):(d.at(-1).vmin=e,d.push(new r.E(t.vmin,e))),g[g.length-1]=o+1,g.push(o+1)}else if(d.pop(),g.pop(),d.length>0||!n||n&&s&&u<2){const s=h>0?t.vmin:t.vmax;e?(a.queryCoord(s,this.m_dummyPoint),e.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==s&&0!==s&&e.setAttribute(10,e.getPointCount()-1,0,1)):i.push(h>0?1-s:s),++u}}}densifyEllipticArc(t,e,s,n,i){const o=new Ri;let a=t;const l=t.calculateUpperLength2D();let h=t.getStartXY().compare(t.getEndXY());0===h&&l>0&&(h=t.isClockwise()?0:1),h>0&&(t.copyTo(o),o.reverse(),a=o);let u=0;s&&(e?(t.queryStart(this.m_dummyPoint),e.startPathPoint(this.m_dummyPoint)):i.push(0),++u);const c=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve)),m=new Ri,d=[],g=[];for(d.push(new r.E(0,1)),g.push(0);d.length;){this.progress_();const t=d.at(-1).clone(),o=g.at(-1);if(o<c&&this.ellipticArcNeedsSplit(a,m,t.vmin,t.vmax)){const e=t.getCenter();h>0?(d.at(-1).vmax=e,d.push(new r.E(e,t.vmax))):(d.at(-1).vmin=e,d.push(new r.E(t.vmin,e))),g[g.length-1]=o+1,g.push(o+1)}else if(d.pop(),g.pop(),d.length>0||!n||n&&s&&u<2){const s=h>0?t.vmin:t.vmax;e?(a.queryCoord(s,this.m_dummyPoint),e.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==s&&0!==s&&e.setAttribute(10,e.getPointCount()-1,0,1)):i.push(h>0?1-s:s),++u}}}calculateLengthSubdivisionStep(t,e){const s=t.calculateUpperLength2D();if(!t.isCurve())return s?e/s:1;if(t.getGeometryType()===n.G.enumEllipticArc){const n=t;if(n.isCircular()||n.isDegenerate(0)||n.isDegenerateToLine()){let t=e/s;return t<this.m_minStep&&(t=this.m_minStep),t}return e/s*n.getSemiAxes().y/n.getSemiAxes().x}t.getGeometryType()===n.G.enumBezier&&(0,n.t)(""),(0,n.t)("")}calculateDeviationSubdivisionStep(t,e){if(!t.isCurve())return 1;if(t.getGeometryType()===n.G.enumEllipticArc){const s=t;if(s.isDegenerate(0)||s.isDegenerateToLine())return 1;{const n=s.getSemiMajorAxis(),i=1-e/n;let r=Math.PI/2;if(i>0){const t=4*Math.sqrt(e/n*.5);r=Math.min(Math.PI/2,Math.abs(t))}r=Math.max(r,2*Math.PI/this.m_maxSegmentsPerCurve);const o=r*n;return this.calculateLengthSubdivisionStep(t,o)}}(0,n.t)("")}calculateAngularSubdivisionStep(t,e){if(!t.isCurve())return 1;if(t.getGeometryType()===n.G.enumEllipticArc){const s=t;return s.isDegenerate(0)||s.isDegenerateToLine()?1:this.calculateLengthSubdivisionStep(t,e*s.getSemiMinorAxis())}(0,n.t)("")}rationalBezier2NeedsSplit(t,e,s,n){t.cutBezierIgnoreAttributes(s,n,e);let i=!1;if(this.m_maxLength>0&&e.calculateUpperLength2D()>this.m_maxLength)return i=!0,!0;const o=(0,r.m)(r.P,3);e.queryControlPoints(o);const a=[0,0,0];return e.queryWeights(a),!i&&this.m_maxDeviation>0&&(i=!Oi.checkRationalBezier2MaxDeviation(o,a,this.m_maxDeviation)),!i&&this.m_maxAngle>0&&(i=!Oi.checkRationalBezier2MaxAngle(o,a,this.m_cosMaxAngle)),i}bezier2NeedsSplit(t,e,s,n){t.cutBezierIgnoreAttributes(s,n,e);let i=!1;if(this.m_maxLength>0&&e.calculateUpperLength2D()>this.m_maxLength)return i=!0,!0;const o=(0,r.m)(r.P,3);return e.queryControlPoints(o),!i&&this.m_maxDeviation>0&&(i=!Oi.checkBezier2MaxDeviation(o,this.m_maxDeviation)),!i&&this.m_maxAngle>0&&(i=!Oi.checkBezier2MaxAngle(o,this.m_cosMaxAngle)),i}ellipticArcNeedsSplit(t,e,s,n){t.cutArcIgnoreAttributes(s,n,e);let i=!1;return this.m_maxLength>0&&e.calculateUpperLength2D()>this.m_maxLength?(i=!0,!0):(!i&&this.m_maxDeviation>0&&(i=!Oi.checkEllipticArcMaxDeviation(e,this.m_maxDeviation)),!i&&this.m_maxAngle>0&&(i=!Oi.checkEllipticArcMaxAngle(e,this.m_cosMaxAngle)),i)}bezierNeedsSplit(t){let e=!1;return this.m_maxLength>0&&r.P.distance(t[0],t[1])+r.P.distance(t[1],t[2])+r.P.distance(t[2],t[3])>this.m_maxLength?(e=!0,!0):(!e&&this.m_maxDeviation>0&&(e=!Oi.checkBezierMaxDeviation(t,this.m_maxDeviation)),!e&&this.m_maxAngle>0&&(e=!Oi.checkBezierMaxAngle(t,this.m_cosMaxAngle)),e)}progress_(){}static checkBezierMaxDeviation(t,e){const s=t[3].sub(t[0]);if(s.sqrLength()>0){const n=s.clone();n.leftPerpendicularThis(),n.normalize();const i=n.dotProduct(t[0].sub(t[1])),o=n.dotProduct(t[0].sub(t[2]));if(Math.max(Math.abs(i),Math.abs(o))<=e){const e=new r.P;Qs(t,.5,e,!1);const n=e.sub(t[0]).dotProduct(s);return n>=0&&n<=s.sqrLength()}return!1}return Math.max(t[0].sub(t[1]).sqrLength(),t[0].sub(t[2]).sqrLength())<=e*e}static checkBezierMaxAngle(t,e){if(t[0].equals(t[3]))return!(!t[0].equals(t[1])||!t[1].equals(t[2]));const s=t[3].sub(t[0]);s.normalize();{const n=t[1].sub(t[0]),i=n.dotProduct(s);if(i<0)return!1;if(n.length()*e>i)return!1}{const n=t[2].sub(t[0]),i=n.dotProduct(s);if(i<0)return!1;if(n.length()*e>i)return!1}{const n=t[2].sub(t[1]),i=n.dotProduct(s);if(i<0)return!1;if(n.length()*e>i)return!1}return!0}static checkRationalBezier2MaxDeviation(t,e,s){if(0===e[1])return!1;const n=t[2].sub(t[0]);if(n.sqrLength()>0){const e=n.clone();e.leftPerpendicularThis(),e.normalize();const i=e.dotProduct(t[0].sub(t[1]));if(Math.abs(i)<=s){const e=t[1].sub(t[0]).dotProduct(n);return e>=0&&e<=n.sqrLength()}return!1}return t[0].sub(t[1]).sqrLength()<=s*s}static checkRationalBezier2MaxAngle(t,e,s){if(0===e[1])return!1;if(t[0].equals(t[2]))return!!t[0].equals(t[1]);const n=t[2].sub(t[0]);n.normalize();{const e=t[1].sub(t[0]),i=e.dotProduct(n);if(i<0)return!1;if(e.length()*s>i)return!1}return!0}static checkBezier2MaxDeviation(t,e){const s=t[2].sub(t[0]);if(s.sqrLength()>0){const n=s.clone();n.leftPerpendicularThis(),n.normalize();const i=n.dotProduct(t[0].sub(t[1]));if(Math.abs(i)<=e){const e=t[1].sub(t[0]).dotProduct(s);return e>=0&&e<=s.sqrLength()}return!1}return t[0].sub(t[1]).sqrLength()<=e*e}static checkBezier2MaxAngle(t,e){if(t[0].equals(t[2]))return!!t[0].equals(t[1]);const s=t[2].sub(t[0]);s.normalize();{const n=t[1].sub(t[0]),i=n.dotProduct(s);if(i<0)return!1;if(n.length()*e>i)return!1}return!0}static checkEllipticArcMaxDeviation(t,e){if(Math.abs(t.getSweepAngle())<Math.PI){const s=t.getEndXY().sub(t.getStartXY()),i=[0,0];if(1===function(t,e,s){(0,n.g)(!rr(t));const i=new a.T;i.setRotateAngle(-t.getAxisXRotation());const o=new r.P;i.queryTransform(e,o);const l=Math.atan2(-o.x*t.getMinorMajorRatio(),o.y),h=l+(0,r.$)();let u=Ki(t,l),c=Ki(t,h);c<u&&(c=(0,r.c)(u,u=c));let m=0;return u>=0&&u<=1&&(s[m++]=u),c>=0&&c<=1&&(s[m++]=c),m}(t,s,i)){const s=t.getCoord2D(i[0]),n=r.P.getClosestCoordinate(t.getStartXY(),t.getEndXY(),s),o=new r.P;return(0,r.U)(t.getStartXY(),t.getEndXY(),n,o),r.P.distance(s,o)<=e}}const s=t.getCoord2D(.5),i=new r.P;return(0,r.U)(t.getEndXY(),t.getStartXY(),.5,i),r.P.distance(s,i)<=e}static checkEllipticArcMaxAngle(t,e){const s=t.getTangent(0),n=t.getTangent(1),i=s.dotProduct(n);return!(i<0||s.length()*n.length()*e>i)}static checkTypeForReplace(t,e){return t.getGeometryType()===e&&(e!==n.G.enumEllipticArc||t.isCircular())}}function qi(t,e,s){const n=s.length;if(e<=0||n<=2)return n;let i=0;const o=(0,r.d)(n-1,Number.NaN);for(let r=1,a=n;r<a;r++){const e=t.tToLength(s[r]);o[r-1]=e-i,i=e}for(;o.length>1;){const t=o.findIndex((t=>t<=2*e));if(-1===t)break;let n=t+1,i=t+1;if(t>0){const e=t-1;(i===o.length||o[e]>o[i])&&(i=e,n--)}o[i]+=o[t],o.splice(t,1),s.splice(n,1)}return s.length}function Bi(t,e,s,n,i,l,h,u){const c=e.clone();c.dropAllAttributes();const m=(t,e,s,n)=>(e&&(t&&e.push(n.getStartXY()),e.push(r.P.getNAN()),e.push(r.P.getNAN()),e.push(n.getEndXY())),s&&(t&&s.push(0),s.push(1)),1);if(c.isDegenerateToLine()||c.isDegenerate(0))return m(t,l,h,e);const d=c.getStartXY(),g=c.getEndXY(),p=c.getSemiAxes(),_=new a.T;if(c.isCircular())_.setIdentity();else{const t=c.getAxisXRotation();_.setScaleCoords(1,c.getMinorMajorRatio()),_.rotateAngle(t)}const f=c.getCenter();_.shift(f);const y=_.clone();y.invertThis(),c.applyTransformation(y);const x=c.getSweepAngle();if(0===x)return m(t,l,h,e);const v=o.Envelope2D.constructEmpty();v.setCoords({center:f,width:2*p.x,height:2*p.x});const b=.05*v.calculateToleranceFromEnvelope(),P=Math.max(s/p.x,b/p.x);let S=4*Math.pow(P/.0741,1/6);S=Math.min(S,Math.PI/2);const E=Mi(c.getStartAngle());let C=x>0?Math.floor(E/S):Math.ceil(E/S);C*=S;const w=x>0?S:-S;C+w===E&&(C+=w);let I=4/3*Math.tan(Math.abs(S)/4);x>0&&(I=-I),h&&t&&h.push(0);const T=S/Math.abs(x);let A=(C-E)/x;const M=d.clone(),D=new r.P;c.queryCoord2D(0,D);const N=D.clone(),F=1-.01*T;let R=0,k=0;for(;A<1;){let s;if(A+=T,k>0&&A<F)s=I;else{A>=F&&(A=1);const t=(A-k)*x;s=4/3*Math.tan(Math.abs(t)/4),x>0&&(s=-s)}c.queryCoord2D(A,D);const o=new r.P;_.queryTransform(D,o);const a=e.getClosestCoordinate(o,!1);if(e.queryCoord2D(a,o),1!==A&&(r.P.distance(M,o)<=2*n||r.P.distance(o,g)<=2*n))continue;M.setCoordsPoint2D(o);const u=(0,r.m)(r.P,4);u[0].assign(N),u[3].assign(D),u[1].rightPerpendicularOther(N),u[1].scaleAddThis(s,N),u[2].leftPerpendicularOther(D),u[2].scaleAddThis(s,D),_.transformPoints2D(u,3,u),u[3].assign(o),0===k&&u[0].setCoordsPoint2D(d),1===A&&u[3].setCoordsPoint2D(g),i&&js(u);let m=!0;for(let t=1;t<4;t++)if(!u[t].isEqualPoint2D(u[0])){m=!1;break}m||(h&&h.push(a),l&&(0===k&&t&&l.push(u[0].clone()),l.push(u[1].clone()),l.push(u[2].clone()),l.push(u[3].clone())),R++),k=A,N.setCoordsPoint2D(D)}return R}function Yi(t,e,s,n,i,a,l,h){e.clone().dropAllAttributes();const u=new o.Envelope2D;e.queryLooseEnvelope(u);const c=.05*u.calculateToleranceFromEnvelope(),m=Math.max(s,c);l&&t&&l.push(0);let d=0;const g=(0,r.m)(r.P,3);e.queryControlPoints(g);const p=[0,0,0];e.queryWeights(p);const _=[],f=(0,r.d)(9,Number.NaN);let y=0;i?(y=e.getMonotonicPartParams(f.length,f),f.length=y,y=qi(e,n,f)):(f.length=2,y=2,f[0]=0,f[1]=1);let x=0,v=t;for(let o=1;o<y;o++){const t=f[o];for(_.length=0,_.push(t),_.push(x);_.length>1;){const t=_.at(-1);_.pop();const e=_.at(-1),s=(0,r.m)(r.P,3),n=[0,0,0];ni(g,p,t,e,s,n);const i=(0,r.m)(r.P,4),o=ii(s,n,i),h=16,u=_.length>h;m>=o||u?(l.push(e),a&&(v&&(a.push(i[0]),v=!1),a.push(i[1]),a.push(i[2]),a.push(i[3])),d++):(_.push(.5*(t+e)),_.push(t))}x=t}return d}class Ui{constructor(t,e){this.m_arc=t,this.m_sqrChordLength=e}getMaxDerivative(){return 1}getValue(t,e){return 0===t?r.P.sqrDistance(this.m_arc.getCoord2D(e),this.m_arc.getCoord2D(1-e))-this.m_sqrChordLength:0}getError(t){return 0}}function Hi(t,e){return t.convertToCanonic(e)}function Xi(t,e,s,n){let i=t.m_startAngle,o=t.m_sweepAngle;const a=1e-12;for(;i>(0,r.$)();)i-=2*(0,r.$)();for(;i<=-(0,r.$)();)i+=2*(0,r.$)();if(!Number.isNaN(e)){for(;e>(0,r.$)();)e-=2*(0,r.$)();for(;e<=-(0,r.$)();)e+=2*(0,r.$)();!s&&e>i&&(e-=2*(0,r.$)()),s&&e<i&&(e+=2*(0,r.$)()),o=e-i,Math.abs(o)<a&&!n&&(o=s?2*(0,r.$)():-2*(0,r.$)()),Math.abs(o)>2*(0,r.$)()-a&&n&&(o=0)}Math.abs(o)>2*(0,r.$)()-a&&(o=o>=0?2*(0,r.$)():-2*(0,r.$)(),t.setEndXY(t.getStartXY())),Math.abs(o)<a&&(o=0,t.setEndXY(t.getStartXY())),n=Math.abs(o)<=(0,r.$)(),o&&(s=o>0),t.m_startAngle=ji(i),t.m_sweepAngle=o,gr(t,!n),mr(t,s)}function ji(t){let e=t,s=!1;return e<=-(0,r.$)()?(e+=(0,r.a9)(),s=!0):e>(0,r.$)()&&(e-=(0,r.a9)(),s=!0),e<=-(0,r.$)()?(e=(0,r.l)(e,(0,r.a9)()),e<=-(0,r.$)()&&(e+=(0,r.a9)()),s=!0):e>(0,r.$)()&&(e=(0,r.l)(e,(0,r.a9)()),e>(0,r.$)()&&(e-=(0,r.a9)()),s=!0),s&&(e>(0,r.$)()||e<=-(0,r.$)())&&(e=(0,r.$)()),e}function Zi(t,e,s){const n=s,i=n.getSemiAxes();let o=new r.P(i.x*Math.cos(t[0]),i.y*Math.sin(t[0]));return o=n.convertFromCanonic(o),r.P.sqrDistance(o,n.getStartXY())}function Wi(t,e,s){const n=s,i=n.getSemiAxes(),o=t[0]+n.getStartAngle();let a=new r.P(i.x*Math.cos(o),i.y*Math.sin(o));return a=n.convertFromCanonic(a),r.P.sqrDistance(a,n.getEndXY())}function $i(t){if(t.m_center.isNAN())return t.m_startAngle=0,void(t.m_sweepAngle=0);const e=t.getStartXY(),s=t.getEndXY(),n=e.equals(s),i=pr(t),o=dr(t),a=t.projectionBehavior();if(n){const s=t.convertToCanonic(e),n=new r.P(t.m_semiMajorAxis,t.m_semiMajorAxis*t.m_minorMajorRatio);s.x/=n.x,s.y/=n.y,t.m_startAngle=ji(Math.atan2(s.y,s.x)),t.m_sweepAngle=i?o?(0,r.a9)():-(0,r.a9)():0}else{const n=t.convertToCanonic(e),l=new r.P(t.m_semiMajorAxis,t.m_semiMajorAxis*t.m_minorMajorRatio);n.x/=l.x,n.y/=l.y;const h=t.convertToCanonic(s);h.x/=l.x,h.y/=l.y,t.m_startAngle=Math.atan2(n.y,n.x),t.m_sweepAngle=r.P.calculateAngle(n,h),o?t.m_sweepAngle<0&&(t.m_sweepAngle+=(0,r.a9)()):t.m_sweepAngle>0&&(t.m_sweepAngle-=(0,r.a9)()),t.m_startAngle=ji(t.m_startAngle);let u=Zi([t.m_startAngle],0,t);if(u=Math.sqrt(u),u>.25*q(t)){const e=t.m_startAngle-1e-4,s=t.m_startAngle+1e-4,n=[0];Ft(Zi,t,1,[t.m_startAngle],[e],[s],0,n),t.m_startAngle=ji(n[0])}if(u=Wi([t.m_sweepAngle],0,t),u=Math.sqrt(u),u>.25*q(t)){const e=t.m_sweepAngle-1e-4,s=t.m_sweepAngle+1e-4,n=[0];Ft(Wi,t,1,[t.m_sweepAngle],[e],[s],0,n),t.m_sweepAngle=n[0]}const c=Math.abs(t.m_sweepAngle)>(0,r.$)();if(gr(t,c),i!==c&&!i&&Math.abs(t.m_sweepAngle)>1.5*(0,r.$)())return void ir(t,e,s,a);if(0===t.m_sweepAngle||o!==t.m_sweepAngle>0)return void ir(t,e,s,a)}}function Ki(t,e){return(function(t,e){const s=new r.E(t.getStartAngle(),t.getEndAngle());s.normalize();const n=(0,r.a9)(),i=(0,r.l)(e,n);if(i<s.vmin){let t=i+n;for(;t<s.vmin;)t+=n;return s.containsCoordinate(t)?t:s.vmin-i<t-s.vmax?i:t}if(i>s.vmax){let t=i-n;for(;t>s.vmax;)t-=n;return s.containsCoordinate(t)||s.vmin-t<i-s.vmax?t:i}return i}(t,e)-t.getStartAngle())/t.getSweepAngle()}function Qi(t,e){return t.m_startAngle+e*t.m_sweepAngle}function Ji(t,e,s){s.assign(new r.H(t.m_startAngle).addE(e.mulE(new r.H(t.m_sweepAngle))))}function tr(t){return t.m_cachedValues}function er(t){if(t.m_cachedValues)return t.m_cachedValues;const e={e2:0,completeE:0};return e.e2=function(t){return 1-(0,r.a)(t.m_minorMajorRatio)}(t),e.completeE=(0,r.af)(e.e2),t.m_cachedValues=e,e}function sr(t,e,s,n){if(!e.isEqual(t.m_XStart,t.m_YStart)||!s.isEqual(t.m_XEnd,t.m_YEnd)){if(rr(t))return t.m_XStart=e.x,t.m_YStart=e.y,t.m_XEnd=s.x,t.m_YEnd=s.y,Er(t),void t.afterCompletedModification();if(n&&Math.abs(t.getSweepAngle())<=1.01*(0,r.T)()){const n=(0,r.m)(r.P,3),i=xr(t,n);if(Jn(n)){if(n[0].assign(e),n[2].assign(s),ei(n),0===t.projectionBehavior()){let e=0,s=2;r.P.sqrDistance(n[1],n[0])<r.P.sqrDistance(n[1],n[2])&&(s=(0,r.c)(e,e=s));const i=n[s].sub(n[e]),o=i.length();i.divThis(o);const a=n[1].sub(n[e]),l=a.length(),h=a.dotProduct(i)/l,u=a.crossProduct(i)/l,c=new r.P;(0,r.U)(n[e],n[s],.5,c);const m=.5*o/u*(0,r.s)(1-h,0,1),d=n[1].side(n[e],n[s]),g=i.clone();d?g.leftPerpendicularThis():g.rightPerpendicularThis();const p=c.sub(g.mul(m));t.constructCircularArcThreePoint(n[0],n[2],p)}else vr(n,i*i,null,!1,t);return}}0===t.projectionBehavior()?function(t,e,s){const n=t.getStartXY(),i=t.getEndXY(),o=n.equals(i),l=e.equals(s);if(!o&&!l){const o=new a.T;o.setShiftCoords(-t.m_XStart,-t.m_YStart);const l=r.P.distance(e,s),h=r.P.distance(n,i),u=l/h;o.scale(u,u);const c=i.sub(n);c.divThis(h);const m=s.sub(e);m.divThis(l);const d=c.crossProduct(m),g=m.dotProduct(c);return o.rotate(g,d),o.shiftCoords(e.x,e.y),void lr(t,o,!0,e,s)}const h=new r.P;if(t.queryCoord2D(.5,h),l){if(o){const i=t.m_center.add(e.sub(n));t.constructEllipticArcEndPointsCenter(e,s,t.getSemiMajorAxis(),1,0,!0,!t.isClockwise(),i),t.setProjectionBehavior(0)}else if(t.isMajor()){const n=h.sub(e).getUnitVector().mul(2*t.getSemiMajorAxis()).add(e);t.constructCircularArcThreePoint(e,s,n)}else t.constructCircularArcThreePoint(e,s,e);return}const u=e.add(s).mul(.5),c=s.sub(e);c.rightPerpendicularThis();const m=u.add(c),d=r.P.getClosestCoordinate(u,m,t.getCenter(),!0),g=new r.P;(0,r.U)(u,m,d,g);const p=r.P.distance(e,g);t.constructEllipticArcEndPointsCenter(e,s,p,1,0,!0,!t.isClockwise(),g),t.setProjectionBehavior(0)}(t,e,s):Dr(t,e,s)}}function nr(t,e,s,n,i,r,o,a,l){return t.m_bits=0,t.m_rotation=r,M(t,e),N(t,s),t.m_cosr=Math.cos(r),t.m_sinr=Math.sin(r),gr(t,o),mr(t,a),void 0!==l?t.m_center.assign(l):t.m_center.setNAN(),t.setProjectionBehavior(1),t.m_semiMajorAxis=n,t.m_minorMajorRatio=i,yr(t,void 0===l)}function ir(t,e,s,n){t.m_bits=0,t.m_rotation=0,M(t,e),N(t,s),t.m_interior.assign(e.add(s).mul(.5)),t.m_startAngle=0,t.m_sweepAngle=0,t.m_cosr=1,t.m_sinr=0,gr(t,!1),mr(t,!1),t.m_center.setNAN(),t.m_semiMajorAxis=1,t.m_minorMajorRatio=0,t.setProjectionBehavior(n),t.afterCompletedModification()}function rr(t){return t.m_center.isNAN()}function or(t,e){if(0===e)return 0;const s=er(t),n=Qi(t,e),i=(0,r.T)(),o=ar(t),a=(0,r.aa)(n+i,s.e2,s.completeE),l=t.m_semiMajorAxis*(a-o);return Math.abs(l)}function ar(t){const e=er(t);return(0,r.aa)(t.getStartAngle()+(0,r.T)(),e.e2,e.completeE)}function lr(t,e,s,i,o){if(2===e.m_TransformationType)return void(0,n.g)(0);if((0,n.g)(!_r(t)),e.isIdentity()&&(!i||i.equals(t.getStartXY())&&o.equals(t.getEndXY())))return;cr(t);let a=r.P.getNAN(),l=r.P.getNAN();if(null===i?(a.x=t.m_XStart,a.y=t.m_YStart,e.transformInPlace(a),l.x=t.m_XEnd,l.y=t.m_YEnd,e.transformInPlace(l)):(a=i,l=o),rr(t))return t.m_XStart=a.x,t.m_YStart=a.y,t.m_XEnd=l.x,void(t.m_YEnd=l.y);const h=t.m_center.clone();if(e.transformInPlace(h),s||e.isUniformNoRotation()){let s=dr(t);if(e.isReflective()&&(s=!s),0===t.projectionBehavior()){if(!a.equals(l)){const s=t.m_interior.clone();return e.transformInPlace(s),void t.constructCircularArcThreePoint(a,l,s)}return void hr(t,a,l,h,s,!1)}const n=new r.P(t.m_cosr,t.m_sinr);e.transformWithoutTranslateInPlace(n);const i=Math.atan2(n.y,n.x),o=t.getSemiAxes();e.transformWithoutTranslateInPlace(o);const u=t.m_center.clone();return e.transformInPlace(u),void t.constructEllipticArcEndPointsCenter(a,l,o.x,o.y/o.x,i,t.isMajor(),s,u)}{{const s=new Array(4);!function(t,e){const s=new r.H(t.m_cosr).sqrThis(),n=new r.H(t.m_sinr).sqrThis(),i=new r.H(t.m_minorMajorRatio),o=new r.H(1/t.m_minorMajorRatio),a=i.mulE(s).addThisE(o.mulE(n)),l=i.subE(o).mulThis(2*t.m_cosr*t.m_sinr),h=i.mulE(n).addThisE(o.mulE(s));e[0]=a,e[1]=l,e[2]=h,e[3]=new r.H(-t.m_semiMajorAxis).mulThis(t.m_semiMajorAxis).mulThis(t.m_minorMajorRatio)}(t,s);const n=new b;if(n.a11.setE(s[0]),n.a12.setE(s[1]),n.a12.mulThisByPower2(.5),n.a21.setE(n.a12),n.a22.setE(s[2]),!n.det().isZero()){const i=new b;if(i.a11.set(e.xx),i.a12.set(e.xy),i.a21.set(e.yx),i.a22.set(e.yy),i.invertThis()){const o=i.clone();o.transposeThis();const u=n.clone();if(u.mulThis(i),u.mulLeftThis(o),!u.det().isZero()){const n=(0,r.m)(r.H,4);n[0].setE(u.a11),n[1].setE(u.a12),n[1].mulThisByPower2(2),n[2].setE(u.a22),n[3].setE(s[3]);const i=r.P.getNAN(),o=function(t,e){const s=new b;s.a11.setE(t[0]),s.a12=r.H.st_mulByPower2(t[1],.5),s.a21.setE(s.a12),s.a22.setE(t[2]);const n=[r.P.getNAN(),r.P.getNAN()],i=[new r.H,new r.H];s.eigenSymmetric(i,n);const o=t[3].clone();return o.negateThis(),o.invThis(),i[0].mulThisE(o),i[1].mulThisE(o),i[0].sqrtThis().invThis(),i[1].sqrtThis().invThis(),e.x=i[0].toDouble(),e.y=i[1].toDouble(),Math.atan2(n[0].y,n[0].x)}(n,i);let c=dr(t);return e.isReflective()&&(c=!c),void t.constructEllipticArcEndPointsCenter(a,l,i.x,i.y/i.x,o,t.isMajor(),c,h)}}}}const s=[r.P.getNAN(),r.P.getNAN(),r.P.getNAN()];s[0].setCoords(t.getSemiMajorAxis(),0),s[0].rotateDirect(t.m_cosr,t.m_sinr),s[1].setCoords(t.getSemiMajorAxis(),t.getSemiMinorAxis()),s[1].rotateDirect(t.m_cosr,t.m_sinr),s[2].setCoords(0,t.getSemiMinorAxis()),s[2].rotateDirect(t.m_cosr,t.m_sinr);let n=t.isClockwise();n&&(s[2]=(0,r.c)(s[0],s[0]=s[2]));const i=.5;e.transformWithoutTranslateArray(s,3,s),e.isReflective()&&(n=!n);const o=new r.P(0,0),u=t.createInstance();vr(s,i,o,!1,u),t.constructEllipticArcEndPointsCenter(a,l,u.getSemiMajorAxis(),u.getMinorMajorRatio(),u.getAxisXRotation(),t.isMajor(),!n,h)}}function hr(t,e,s,n,i,r){const o=.5*(n.sub(e).length()+n.sub(s).length());t.m_center.assign(n),t.m_startAngle=Math.atan2(e.y-t.m_center.y,e.x-t.m_center.x),Xi(t,Math.atan2(s.y-t.m_center.y,s.x-t.m_center.x),i,r);const a=t.constructEllipticArcEndPointsCenter(e,s,o,1,0,Math.abs(t.m_sweepAngle)>Math.PI,t.m_sweepAngle>0,n);return t.setProjectionBehavior(0),a}function ur(t,e){t.m_cachedValues=e}function cr(t){t.m_cachedValues=null}function mr(t,e){const s=e?1:0;t.m_bits=-2&t.m_bits|s}function dr(t){return!!(1&t.m_bits)}function gr(t,e){const s=e?1:0;t.m_bits=-3&t.m_bits|s<<1}function pr(t){return!!(2&t.m_bits)}function _r(t){return!!(8&t.m_bits)}function fr(t){t.m_bits&=-9}function yr(t,e){fr(t);const s=t.getStartXY(),i=t.getEndXY();let o=!1;const a=pr(t),l=dr(t),h=t.projectionBehavior(),u=s.equals(i);let c=0===t.m_minorMajorRatio||0===t.m_semiMajorAxis;if(Number.isNaN(t.m_minorMajorRatio)&&(0===t.m_semiMajorAxis?t.m_minorMajorRatio=1:(0,n.n)("NAN minor major ratio and non-zero major axis")),c||=e?u:t.m_center.isNAN(),c)return ir(t,s,i,h),!0;t.m_semiMajorAxis=Math.abs(t.m_semiMajorAxis),t.m_minorMajorRatio=Math.abs(t.m_minorMajorRatio),t.m_minorMajorRatio>1&&(t.m_semiMajorAxis*=t.m_minorMajorRatio,t.m_minorMajorRatio=1/t.m_minorMajorRatio);const m=new r.P(t.m_semiMajorAxis,t.m_semiMajorAxis*t.m_minorMajorRatio);if((0,n.g)(m.y>0&&m.x>=m.y),u){const e=t.convertToCanonic(s);(0,n.g)(!m.isZero()),e.x/=m.x,e.y/=m.y;const i=Math.sqrt((0,r.a)(e.x)+(0,r.a)(e.y));if(o=1!==i,t.m_semiMajorAxis*=i,m.mulThis(i),t.m_startAngle=ji(Math.atan2(e.y,e.x)),!a)return t.m_interior.assign(s),t.m_sweepAngle=0,t.afterCompletedModification(),o;t.m_sweepAngle=l?(0,r.a9)():-(0,r.a9)()}else{let e=t.m_center.isNAN()||function(t){if(t.m_center.isNAN())return!1;const e=new v;e.setWithEps(t.getStartXY(),8),e.subThisE((new v).setWithEps(t.m_center,8));const s=new r.H;s.setWithEps(t.m_rotation,8);const n=new r.H,i=new r.H;r.H.st_cosAndSin(s,n,i),e.rotateReverse(n,i);const o=new v;o.setWithEps(t.getEndXY()),o.subThisE(v.constructPoint2D(t.m_center)),o.rotateReverse(n,i);const a=new r.H;a.setWithEps(t.m_semiMajorAxis,8);const l=a.clone(),h=new r.H;h.setWithEps(t.m_minorMajorRatio),l.mulThisE(h),e.x.divThisE(a),e.y.divThisE(l),o.x.divThisE(a),o.y.divThisE(l);const u=e.x.sqr().addThisE(e.y.sqr()).subThisE(r.I),c=o.x.sqr().addThisE(o.y.sqr()).subThisE(r.I);return!u.isZero()||!c.isZero()}(t);if(!e){const n=t.convertToCanonic(s);n.x/=m.x,n.y/=m.y;const o=new r.P(1,0);t.m_startAngle=r.P.calculateAngle(o,n);const a=t.convertToCanonic(i);a.x/=m.x,a.y/=m.y,t.m_sweepAngle=r.P.calculateAngle(n,a),e=!Pr(t)}if(e){o=!0;const e=s.sub(i).mulThis(.5);e.rotateReverse(t.m_cosr,t.m_sinr);let n=(0,r.a)(e.x/m.x)+(0,r.a)(e.y/m.y);n>1&&(n=Math.sqrt(n),t.m_semiMajorAxis*=n,m.mulThis(n));const h=new r.P(0,0);{const t=m.x*m.x,s=m.y*m.y,n=t*e.y*e.y+s*e.x*e.x,i=t*s-n;if(i>0){const t=Math.sqrt(i/n);h.setCoords(m.x*e.y/m.y,-m.y*e.x/m.x),h.mulThis(t),a===l&&h.negateThis()}}{const e=new r.P(h.x,h.y);e.rotateDirect(t.m_cosr,t.m_sinr),e.addThis(s.add(i).mulThis(.5)),t.m_center.assign(e)}}if($i(t),!Pr(t))return ir(t,s,i,h),!0}return Er(t),t.afterCompletedModification(),o}function xr(t,e){(0,n.g)(Math.abs(t.getSweepAngle())<15*Math.PI/16);const s=t.getSemiMajorAxis(),i=t.getSemiMinorAxis();let o;if(0===s)return e[0].setCoordsPoint2D(t.getStartXY()),e[1].setCoordsPoint2D(t.getStartXY()),e[2].setCoordsPoint2D(t.getStartXY()),o=1,o;if(0===i)return e[0].setCoordsPoint2D(t.getStartXY()),e[2].setCoordsPoint2D(t.getEndXY()),e[1]=r.P.lerp(e[0],e[2],.5),o=1,o;const a=t.getSweepAngle(),l=t.getStartAngle(),h=l+a,u=new r.P(-s*Math.sin(l),i*Math.cos(l)),c=new r.P(-s*Math.sin(h),i*Math.cos(h));u.normalize(),c.normalize(),u.rotateDirect(t.m_cosr,t.m_sinr),c.rotateDirect(t.m_cosr,t.m_sinr),e[0].setCoordsPoint2D(t.getStartXY()),e[2].setCoordsPoint2D(t.getEndXY()),e[1].setSub(e[2],e[0]);const m=u.crossProduct(c);return e[1].assign(u.mul(e[1].crossProduct(c)/m)),e[1].addThis(e[0]),o=Math.cos(.5*a),o}function vr(t,e,s,i,o){if(i){const s=.5,n=Math.sqrt(e),i=(0,r.a)(1-s)+2*n*s*(1-s)+(0,r.a)(s),a=t[0].mul((0,r.a)(1-s)).add(t[1].mul(2*n*s*(1-s))).add(t[2].mul((0,r.a)(s))).divThis(i);return o.constructCircularArcThreePoint(t[0],t[2],a),!0}const a=t[0].sub(t[1]),l=t[2].sub(t[1]),h=a.crossProduct(l),u=a.dotProduct(l),c=e;(0,n.g)(c<=1),(0,n.g)(c>0);const m=.5/(1-c),d=a.sqrLength(),g=u,p=l.sqrLength(),_=(0,r.a)(h),f=a.sub(l).sqrLength();if(0===_)return ir(o,t[0],t[2],1),!1;if(u<=-Math.sqrt(d)*Math.sqrt(p))return ir(o,t[0],t[2],1),!1;const y=[0,0],x=new r.E;x.setInfinite();const v=Dt(2*_,-(f/c+4*g),2*(1-c)/c,x,!1,y);if(0===v)return ir(o,t[0],t[2],1),!1;1===v&&(y[1]=y[0]);const b=Math.sqrt(m/y[0]),P=Math.sqrt(m/y[1]),S=.5/c;let E=S-p*y[0],C=S-d*y[0];Math.abs(E)>Math.abs(C)?C=g*y[0]-S+1:E=g*y[0]-S+1;const w=a.mul(E).add(l.mul(C)),I=w.norm(1)<1e-15*b?0:Math.atan2(w.y,w.x)+Math.PI,T=a.add(l),A=s?s.clone():t[1].add(T.mul(m)),M=t[0].sub(A),D=t[2].sub(A),N=M.crossProduct(D)<0;return new Ri,o.constructEllipticArcEndPointsCenter(t[0],t[2],b,P/b,I,!1,!N,A)}function br(t,e,s,n,i){return vr(t,e,s,n,i)}function Pr(t){const e=q(t);let s=!1;{const n=new r.P(t.m_semiMajorAxis*Math.cos(t.m_startAngle),t.getSemiMinorAxis()*Math.sin(t.m_startAngle));n.rotateDirect(t.m_cosr,t.m_sinr),n.addThis(t.m_center),s=r.P.distance(t.getStartXY(),n)>e}let n=!1;if(!s){const s=new r.P(t.m_semiMajorAxis*Math.cos(t.m_startAngle+t.m_sweepAngle),t.getSemiMinorAxis()*Math.sin(t.m_startAngle+t.m_sweepAngle));s.rotateDirect(t.m_cosr,t.m_sinr),s.addThis(t.m_center),n=r.P.distance(t.getEndXY(),s)>e}return!s&&!n}function Sr(t){if(rr(t))return 0;if(t.isDegenerate(0))return 0;const e=t.m_semiMajorAxis,s=t.getSemiMinorAxis(),n=e*e+s*s,i=t.getStartAngle(),r=t.getEndAngle(),o=t.m_center.y-t.m_YStart,a=t.m_cosr,l=t.m_sinr;let h=1,u=0;t.m_rotation&&(h=(a-l)*(a+l),u=2*a*l);const c=((-.5*(r-i)+.25*h*(2*Math.cos(r+i)*Math.sin(r-i)))*s+-2*Math.sin(.5*(r+i))*Math.sin(.5*(r-i))*a*o)*e/n;let m=0;return t.m_rotation&&(m=-2*Math.sin(r+i)*Math.sin(r-i)*.125*u-s*o/n*(2*Math.cos(.5*(r+i))*Math.sin(.5*(r-i)))*l),n*(c+m)+-.5*(t.m_XEnd-t.m_XStart)*(t.m_YEnd-t.m_YStart)}function Er(t){t.queryCoord2D(.5,t.m_interior)}function Cr(t,e,s,n,i){if(i){if(0!==Rr(e,s))return 2}else if(C(e,s))return 1;return 0!==wr(t,e,s,null,null,null,n,void 0!==i&&i,!0,!1)?4:0}function wr(t,e,s,i,o,a,l,h,u,c){if(rr(e))return ot(new Br({start:e.getStartXY(),end:e.getEndXY()}),s,i,o,a,l,h,c);null!==o&&(o.length=0),null!==a&&(a.length=0),null!==i&&(i.length=0);const m=B(e,s);if(Y(e,s,l=Math.max(m,l)))return 0;const d=s.getStartXY();d.subThis(e.m_center);const g=s.getEndXY();g.subThis(e.m_center),d.rotateReverse(e.m_cosr,e.m_sinr),g.rotateReverse(e.m_cosr,e.m_sinr);const p=g.clone();p.subThis(d);const _=e.m_semiMajorAxis,f=1/_,y=e.getSemiMinorAxis(),x=1/y,v=p.clone();v.leftPerpendicularThis();const b=Math.atan2(y*v.y,_*v.x),P=(0,r.d)(16,Number.NaN),S=(0,r.d)(16,Number.NaN);let E=0;const C=[b,b+Math.PI];for(let n=0;n<2;++n){const t=Ki(e,C[n]);if(t>=0&&t<=1){P[E]=t;const n=e.getCoord2D(P[E]);S[E]=s.getClosestCoordinate(n,!1),r.P.distance(n,s.getCoord2D(S[E]))<=l&&E++}}const w=d.x*f,I=d.y*x,T=p.x*f,A=p.y*x;let M=Dt(T*T+A*A,2*(w*T+I*A),w*w+I*I-1,r.E.unit(),!1,S);(0,n.g)(M>=0);for(let n=0;n<M;n++){const t=p.mul(S[n]).add(d);t.x*=f,t.y*=x;const i=Ki(e,Math.atan2(t.y,t.x));if(i>=0&&i<=1){P[E]=i;const t=e.getCoord2D(i);S[E]=s.getClosestCoordinate(t,!1),r.P.distance(t,s.getCoord2D(S[E]))<=l&&E++}}(0,n.g)(E<P.length+4);const D=(0,r.d)(16,Number.NaN);M=e.intersectPoint(s.getStartXY(),D,l);for(let n=0;n<M;n++,E++)P[E]=D[n],S[E]=0;M=e.intersectPoint(s.getEndXY(),D,l);for(let n=0;n<M;n++,E++)P[E]=D[n],S[E]=1;M=s.intersectPoint(e.getStartXY(),D,l);for(let n=0;n<M;n++,E++)P[E]=0,S[E]=D[n];M=s.intersectPoint(e.getEndXY(),D,l);for(let n=0;n<M;n++,E++)P[E]=1,S[E]=D[n];return 0===E?0:Vr(t,e,s,P,S,E,i,o,a,l,h,u,c)}function Ir(t,e,s,i,o,a,l,h,u,c){if(rr(e)){const n=new Br({start:e.getStartXY(),end:e.getEndXY()});return wr(t,s,n,i,a,o,l,h,u,!0)}if(rr(s)){const n=new Br({start:s.getStartXY(),end:s.getEndXY()});return wr(t,e,n,i,o,a,l,h,u,c)}const m=B(e,s);l=Math.max(l,m);let d=!1;{const t=e.getSemiAxes(),i=e.getCenter(),c=s.getSemiAxes(),m=s.getCenter(),g=r.P.distance(m,i),p=t.x+c.x;if(g>p+l)return 0;if(t.y>c.x){if(g+c.x+l<t.y)return 0}else if(c.y>t.x&&g+t.x+l<c.y)return 0;if(u&&!h){const i=1===e.m_minorMajorRatio&&e.isClosed()&&e.isMajor(),r=1===s.m_minorMajorRatio&&s.isClosed()&&s.isMajor();if(i&&r&&(d=!0,g<=p)&&Math.max(t.x,c.x)<=Math.min(t.x,c.x)+g)return(0,n.g)(!o&&!a),1}}if(!d&&Y(e,s,l))return 0;const g=[],p=[],_=!1,f=!1,y=zi(e,0,0,_,f,g,p,null),x=[],v=[],b=zi(s,0,0,_,f,x,v,null);if(1===y&&1===b){const t=new Wt({points:g,weights:p}),n=new Wt({points:x,weights:v}),m=[],d=[],_=ui(!1,t,n,i,null===o?null:m,null===a?null:d,l,h,u,c);if(_>0&&null!==o||null!==a){o&&(o.length=0),a&&(a.length=0);for(let i=0;i<_;++i){if(o)if((0,r.N)(m[i],0,1))o.push(m[i]);else{const s=t.tToLength(m[i]),n=e.lengthToT(s);o.push(n)}if(a)if((0,r.N)(d[i],0,1))a.push(d[i]);else{const t=n.tToLength(d[i]),e=s.lengthToT(t);a.push(e)}}}return _}let P=[];const S=[];let E=0;const C=u&&!h;for(let n=0;n<y;n++){const t=new Wt({points:g.slice(2*n,2*n+3),weights:p.slice(2*n,2*n+3)});let i=0;for(let o=0;o<b;o++){S.length<=o&&S.push(new Wt({points:x.slice(2*o,2*o+3),weights:v.slice(2*o,2*o+3)}));const a=[],h=[],u=C?null:a,c=C?null:h,m=ui(!1,t,S[o],null,u,c,l,!1,C,!1);if(m>0&&C)return 1;for(let l=0;l<m;++l){if(0===a[l]&&0===n)a[l]=0;else if(1===a[l]&&n===y-1)a[l]=1;else{const s=t.tToLength(a[l])+E,n=e.lengthToT(s);a[l]=n}if(0===h[l]&&0===o)h[l]=0;else if(1===h[l]&&o===b-1)h[l]=1;else{const t=S[o].tToLength(h[l])+i,e=s.lengthToT(t);h[l]=e}P.push((0,r.k)(a[l],h[l]))}i+=S[o].calculateLength2D()}E+=t.calculateLength2D()}if(0===P.length)return 0;if(h&&(P=P.filter((t=>!(0,r.N)(t.first,0,1)||!(0,r.N)(t.second,0,1)||!e.getCoord2D(t.first).equals(s.getCoord2D(t.second))))),u)return P.length;const w=[],I=[];for(const n of P)w.push(n.first),I.push(n.second);return Vr(t,e,s,w,I,w.length,i,o,a,l,h,u,c)}function Tr(t,e,s){if(s.setCoords(t.getCoord2D(e.vmin)),s.mergeNe(t.getCoord2D(e.vmax)),rr(t))return;const n=t.getSemiAxes(),i=[0,0,0,0];{const e=Math.atan2(-n.y*t.m_sinr,n.x*t.m_cosr),s=e+Math.PI,r=Math.atan2(n.y*t.m_cosr,n.x*t.m_sinr),o=r+Math.PI;i[0]=Ki(t,e),i[1]=Ki(t,s),i[2]=Ki(t,r),i[3]=Ki(t,o)}const o=new r.P;for(let r=0;r<4;r++){const n=i[r];e.containsExclusiveCoordinate(n)&&(t.queryCoord2D(n,o),s.mergeNe(o))}}function Ar(t,e,s,i,o){if(0===t.m_semiMajorAxis)return s.vmin;let a=r.P.getNAN();t.queryCoord2D(s.vmin,a);let l=r.P.getNAN();if(t.queryCoord2D(s.vmax,l),rr(t))return new Br({start:a,end:l}).getClosestCoordinate(e,i);const h=Hi(t,e);if(a=Hi(t,a),l=Hi(t,l),1===t.m_minorMajorRatio){if(h.isEqual(0,0))return s.vmin;const e=Ki(t,Math.atan2(h.y,h.x));return i||s.containsCoordinate(e)?e:r.P.distance(h,a)<=r.P.distance(h,l)?s.vmin:s.vmax}const u=t.getSemiMajorAxis(),c=t.getSemiMinorAxis(),m=(u-c)*(u+c),d=(0,r.a)(m),g=h.x,p=h.y,_=(0,r.a)(c*p),f=c*m*p*2,y=[new r.H(_),new r.H(f),new r.H(d-(0,r.a)(u*g)-_),new r.H(-f),new r.H(-d)],x=(0,r.m)(r.H,4),v=qt(y,4,new r.E(-1,1),!1,x,4);let b=s.vmin,P=r.P.sqrDistance(h,a);{const t=r.P.sqrDistance(h,l);t<P&&(b=s.vmax,P=t)}(0,n.g)(!i);let S=(0,r.d)(8,Number.NaN);for(let n=0;n<v;++n){const e=x[n].value(),s=Math.sqrt(1-e*e),i=Math.atan2(e,s),r=Math.atan2(e,-s);S[2*n]=Ki(t,i),S[2*n+1]=Ki(t,r)}S=S.slice(0,2*v),(0,r.v)(S);for(let n=0,E=2*v;n<E;++n)if(S[n]>s.vmin&&S[n]<s.vmax){const s=r.P.sqrDistance(e,t.getCoord2D(S[n]));P>s&&(P=s,b=S[n])}return b}function Mr(t,e,s){return t.m_semiMajorAxis===e.m_semiMajorAxis&&t.isMajor()!==e.isMajor()&&!!t.m_center.equals(e.m_center)&&t.m_sinr===e.m_sinr&&t.m_cosr===e.m_cosr&&t.m_minorMajorRatio===e.m_minorMajorRatio&&(s?t.isClockwise()!==e.isClockwise():t.isClockwise()===e.isClockwise())}function Dr(t,e,s,i){const o=t.getStartXY(),l=t.getEndXY(),h=o.equals(l),u=e.equals(s);if(!h&&!u){const n=new a.T;return n.initializeFromTwoPoints(o,l,e,s),lr(t,n,!0,e,s),t.endPointModified(),void t.normalizeAfterEndpointChange()}if(!t.isMajor())return void ir(t,e,s,1);if(h&&u){const n=t.m_center.add(e.sub(o));return void t.constructEllipticArcEndPointsCenter(e,s,t.getSemiMajorAxis(),t.getMinorMajorRatio(),t.getAxisXRotation(),!0,!t.isClockwise(),n)}if(!h){const n=.5*((0,r.a9)()-Math.abs(t.getSweepAngle())),i=(t.getSweepAngle()+n*(0,r.e)(t.getSweepAngle()))/t.getSweepAngle(),o=new r.P;t.queryCoord2D(i,o),t.constructEllipticArcEndPointsCenter(o,o,t.getSemiMajorAxis(),t.getMinorMajorRatio(),t.getAxisXRotation(),!0,!t.isClockwise(),t.getCenter());const a=t.getCenter().add(e.sub(o));return void t.constructEllipticArcEndPointsCenter(e,s,t.getSemiMajorAxis(),t.getMinorMajorRatio(),t.getAxisXRotation(),!0,!t.isClockwise(),a)}const c=r.P.sqrDistance(e,s);let m=.25,d=.75;if(c<r.P.sqrDistance(t.getCoord2D(.25),t.getCoord2D(.75))){const e=[0],s=Mt(new Ui(t,c),r.E.construct(0,.25),1,e);s>0&&((0,n.g)(1===s),m=e[0],d=1-e[0])}const g=t.getCoord2D(m),p=t.getCoord2D(d);(0,n.g)(!g.equals(p)),t.constructEllipticArcEndPointsCenter(g,p,t.getSemiMajorAxis(),t.getMinorMajorRatio(),t.getAxisXRotation(),!0,!t.isClockwise(),t.m_center),Dr(t,e,s)}function Nr(t,e,s,n,i){return Fr(t,!1,e,s,n,i)}function Fr(t,e,s,i,r,o){const a=s.getGeometryType(),l=i.getGeometryType(),h=Math.max(r,B(s,i));if(a===n.G.enumLine&&l===n.G.enumLine)return rt(s,i,h,o);let u=s,c=i,m=s.getStartXY(),d=s.getEndXY();if(m.compare(d)>0&&(u=s.clone().reverse()),m=i.getStartXY(),d=i.getEndXY(),m.compare(d)>0&&(c=i.clone().reverse()),e){if(s.equals(i))return 2;if(function(t,e,s){return(0,n.g)(t.isCurve()||e.isCurve()),!!(t.getStartXY().equals(e.getStartXY())&&A(t,e,0,0,s,2,[0,0],[0,0])||t.getEndXY().equals(e.getEndXY())&&A(t,e,1,1,s,2,[0,0],[0,0])||t.getStartXY().equals(e.getEndXY())&&A(t,e,0,1,s,2,[0,0],[0,0])||t.getEndXY().equals(e.getStartXY())&&A(t,e,1,0,s,2,[0,0],[0,0]))}(s,i,h))return 4}switch(a){case n.G.enumLine:switch(l){case n.G.enumEllipticArc:return Cr(t,c,u,h,o);case n.G.enumBezier:return sn(t,c,u,h,o);case n.G.enumRationalBezier2:return ri(t,c,u,h,o);case n.G.enumBezier2:return He(t,c,u,h,o);default:(0,n.d)("")}break;case n.G.enumEllipticArc:switch(l){case n.G.enumLine:return Cr(t,u,c,h,o);case n.G.enumEllipticArc:return function(t,e,s,n,i){if(i){if(0!==Rr(e,s))return 2}else if(C(e,s))return 1;return 0!==Ir(t,e,s,null,null,null,n,void 0!==i&&i,!0,!1)?4:0}(t,u,c,h,o);case n.G.enumBezier:return nn(t,c,u,h,o);case n.G.enumRationalBezier2:return oi(t,c,u,h,o);case n.G.enumBezier2:return Xe(t,c,u,h,o);default:(0,n.d)("")}break;case n.G.enumBezier:switch(l){case n.G.enumLine:return sn(t,u,c,h,o);case n.G.enumEllipticArc:return nn(t,u,c,h,o);case n.G.enumBezier:return function(t,e,s,n,i){if(i){if(0!==Rr(e,s))return 2}else if(C(e,s))return 1;return 0!==hn(t,e,s,null,null,null,n,void 0!==i&&i,!0,!1)?4:0}(t,u,c,h,o);case n.G.enumRationalBezier2:return rn(t,u,c,h,o);case n.G.enumBezier2:return on(t,u,c,h,o);default:(0,n.d)("")}break;case n.G.enumRationalBezier2:switch(l){case n.G.enumLine:return ri(t,u,c,h,o);case n.G.enumEllipticArc:return oi(t,u,c,h,o);case n.G.enumBezier:return rn(t,c,u,h,o);case n.G.enumRationalBezier2:return function(t,e,s,n,i){if(i){const n=Rr(e,s);if(0!==n){if(t){if(1===n){if(e.m_weights[0]===s.m_weights[0]&&e.m_weights[1]===s.m_weights[1]&&e.m_weights[2]===s.m_weights[2])return 2}else if(e.m_weights[0]===s.m_weights[2]&&e.m_weights[1]===s.m_weights[1]&&e.m_weights[2]===s.m_weights[0])return 2;return 4}return 2}}else if(C(e,s))return 1;return 0!==ui(t,e,s,null,null,null,n,void 0!==i&&i,!0,!1)?4:0}(t,u,c,h,o);case n.G.enumBezier2:return ai(t,u,c,h,o);default:(0,n.d)("")}break;case n.G.enumBezier2:switch(l){case n.G.enumLine:return He(t,u,c,h,o);case n.G.enumEllipticArc:return Xe(t,u,c,h,o);case n.G.enumBezier:return on(t,c,u,h,o);case n.G.enumRationalBezier2:return ai(t,c,u,h,o);case n.G.enumBezier2:return function(t,e,s,n,i){if(i){if(0!==Rr(e,s))return 2}else if(C(e,s))return 1;return 0!==We(t,e,s,null,null,null,n,i??!1,!0,!1)?4:0}(t,u,c,h,o);default:(0,n.d)("")}break;default:(0,n.d)("")}}function Rr(t,e,s=!0){if(!s&&!kr(t,e))return 0;const i=t.isLine()&&e.isLine();if(t.getStartXY().equals(e.getStartXY())&&t.getEndXY().equals(e.getEndXY())){const s=1;if(i)return s;const r=t.getGeometryType();if(r!==e.getGeometryType())return 0;if(r===n.G.enumBezier){const n=t,i=e;return n.getControlPoint1().equals(i.getControlPoint1())&&n.getControlPoint2().equals(i.getControlPoint2())?s:0}if(r===n.G.enumEllipticArc)return Mr(t,e,!1)?s:0;if(r===n.G.enumRationalBezier2){const n=t,i=e;if(n.getControlPoint1().equals(i.getControlPoint1())&&n.getStandardFormWeight()===i.getStandardFormWeight())return s}else if(r===n.G.enumBezier2){const n=e;if(t.getControlPoint1().equals(n.getControlPoint1()))return s}return 0}if(t.getStartXY().equals(e.getEndXY())&&t.getEndXY().equals(e.getStartXY())){const s=-1;if(i)return s;const r=t.getGeometryType();if(r!==e.getGeometryType())return 0;if(r===n.G.enumBezier){const n=t,i=e;return n.getControlPoint1().equals(i.getControlPoint2())&&n.getControlPoint2().equals(i.getControlPoint1())?s:0}if(r===n.G.enumEllipticArc)return Mr(t,e,!0)?s:-1;if(r===n.G.enumRationalBezier2){const n=t,i=e;if(n.getControlPoint1().equals(i.getControlPoint1())&&n.getStandardFormWeight()===i.getStandardFormWeight())return s}else if(r===n.G.enumBezier2){const n=e;if(t.getControlPoint1().equals(n.getControlPoint1()))return s}return 0}return 0}function kr(t,e){const s=t.getGeometryType();return s===e.getGeometryType()&&(s!==n.G.enumEllipticArc||t.projectionBehavior()===e.projectionBehavior())}function Lr(t,e,s,i,r,o,a){!r&&o&&(0,n.a)("");const l=e.getGeometryType(),h=s.getGeometryType(),u=Math.max(a,B(e,s));if(i&&(i.length=0),r&&(r.length=0),o&&(o.length=0),l===n.G.enumLine&&h===n.G.enumLine)return ot(e,s,i,r,o,u,!1,!1);let c=e,m=s,d=e.getStartXY(),g=e.getEndXY(),p=!1,_=!1;d.compare(g)>0&&(c=e.clone(!0).reverse(),p=!0),d=s.getStartXY(),g=s.getEndXY(),d.compare(g)>0&&(m=s.clone(!0).reverse(),_=!0);let f=0;switch(l){case n.G.enumLine:switch(h){case n.G.enumEllipticArc:f=wr(t,m,c,i,o,r,u,!1,!1,!0);break;case n.G.enumBezier:f=an(t,m,c,i,o,r,u,!1,!1,!0);break;case n.G.enumRationalBezier2:f=li(t,m,c,i,o,r,u,!1,!1,!0);break;case n.G.enumBezier2:f=je(t,m,c,i,o,r,u,!1,!1,!0);break;default:(0,n.d)("")}break;case n.G.enumEllipticArc:switch(h){case n.G.enumLine:f=wr(t,c,m,i,r,o,u,!1,!1,!1);break;case n.G.enumEllipticArc:f=Ir(t,c,m,i,r,o,u,!1,!1,!1);break;case n.G.enumBezier:f=ln(t,m,c,i,o,r,u,!1,!1,!0);break;case n.G.enumRationalBezier2:f=hi(t,m,c,i,o,r,u,!1,!1,!0);break;case n.G.enumBezier2:f=Ze(t,m,c,i,o,r,u,!1,!1,!0);break;default:(0,n.d)("")}break;case n.G.enumRationalBezier2:switch(h){case n.G.enumLine:f=li(t,c,m,i,r,o,u,!1,!1,!1);break;case n.G.enumEllipticArc:f=hi(t,c,m,i,r,o,u,!1,!1,!1);break;case n.G.enumBezier:f=un(t,m,c,i,o,r,u,!1,!1,!0);break;case n.G.enumRationalBezier2:f=ui(t,c,m,i,r,o,u,!1,!1,!1);break;case n.G.enumBezier2:f=ci(t,c,m,i,r,o,u,!1,!1,!1);break;default:(0,n.d)("")}break;case n.G.enumBezier2:switch(h){case n.G.enumLine:f=je(t,c,m,i,r,o,u,!1,!1,!1);break;case n.G.enumEllipticArc:f=Ze(t,c,m,i,r,o,u,!1,!1,!1);break;case n.G.enumBezier:f=cn(t,m,c,i,o,r,u,!1,!1,!0);break;case n.G.enumRationalBezier2:f=ci(t,m,c,i,o,r,u,!1,!1,!0);break;case n.G.enumBezier2:f=We(t,c,m,i,r,o,u,!1,!1,!1);break;default:(0,n.d)("")}break;case n.G.enumBezier:switch(h){case n.G.enumLine:f=an(t,c,m,i,r,o,u,!1,!1,!1);break;case n.G.enumEllipticArc:f=ln(t,c,m,i,r,o,u,!1,!1,!1);break;case n.G.enumBezier:f=hn(t,c,m,i,r,o,u,!1,!1,!1);break;case n.G.enumRationalBezier2:f=un(t,c,m,i,r,o,u,!1,!1,!1);break;case n.G.enumBezier2:f=cn(t,c,m,i,r,o,u,!1,!1,!1);break;default:(0,n.d)("")}break;default:(0,n.d)("")}if(p){if(r){for(let t=0;t<f;t++)r[t]=1-r[t];r.reverse()}i&&i.reverse(),o&&o.reverse()}if(_&&o)for(let n=0;n<f;n++)o[n]=1-o[n];return f}function Gr(t,e,s){return e===s?0:(e>s&&(s=(0,r.c)(e,e=s)),t.cut(e,s,!0).calculateUpperLength2D())}function Vr(t,e,s,n,i,o,a,l,h,u,c,m,d){if(!o)return 0;const g=(t,e)=>{for(let s=0;s<o;++s){let n=e[s];if((0,r.N)(n,0,1)){n=(0,r.ak)(n);continue}const i=t.getCoord2D(n);n<.5?i.equals(t.getStartXY())&&Gr(t,0,n)<=q(t)&&(e[s]=0):i.equals(t.getEndXY())&&Gr(t,n,1)<=q(t)&&(e[s]=1)}};g(e,n),g(s,i),function(t,e,s,n,i){const o=[],a=[],l=[];for(let u=0,c=i;u<c;u++)o.push(t.calculateSubLengthFromStart(s[u])),a.push(e.calculateSubLengthFromStart(n[u])),(0,r.N)(s[u],0,1)&&(0,r.N)(n[u],0,1)&&t.getCoord2D(s[u]).equals(e.getCoord2D(n[u]))&&l.push(u);if(0===l.length||l.length===i)return;l.sort(((t,e)=>s[t]<s[e]?-1:s[t]>s[e]?1:n[t]<n[e]?-1:n[t]>n[e]?1:0));let h=-1;for(const u of l){if(h>=0&&s[u]===s[h]&&s[u]===s[h]){h=u;continue}h=u;const l=[];l.length=i;for(let t=0;t<l.length;++t)l[t]=t;l.sort(((t,e)=>{const s=o[u],n=a[u],i=o[t]-s,r=a[t]-n,l=i*i+r*r,h=o[e]-s,c=a[e]-n,m=h*h+c*c;return l<m?-1:l>m?1:0}));for(let o=0;o<i;o++){const i=l[o];if(i===u||s[i]===s[u]&&n[i]===n[u]||(0,r.N)(s[i],0,1)&&(0,r.N)(n[i],0,1))continue;const a=(s,n,i,o)=>{const a=new v,l=new r.H;l.setWithEps(1);const h=new r.H;h.set(n,l.eps()),t.queryCoord2DE(h,a);const u=new v;t.queryCoord2DE(new r.H(s),u);let c=!1;return a.eq(u)&&(h.set(o,l.eps()),e.queryCoord2DE(h,a),e.queryCoord2DE(new r.H(i),u),c=a.eq(u)),!c},h=r.P.getNAN();t.queryCoord2D(s[i],h);const c=r.P.getNAN();if(e.queryCoord2D(n[i],c),0===r.P.distance(h,c)&&a(s[u],s[i],n[u],n[i]))break;const m=new r.E(n[i],n[u]);m.normalizeNoNAN();const d=new r.E(s[i],s[u]);d.normalizeNoNAN();let g=-1,p=Number.POSITIVE_INFINITY,_=Number.POSITIVE_INFINITY,f=s[i];h.assign(t.getCoord2D(f));for(let o=0;o<5;o++){const o=e.getClosestCoordinateOnInterval(h,m,-1);c.assign(e.getCoord2D(o));const l=r.P.distance(h,c);if(f=t.getClosestCoordinateOnInterval(c,d,-1),f===s[u]&&o===n[u]){g=1;break}h.assign(t.getCoord2D(f));const y=r.P.distance(c,h);if(!(y<_&&l<p)){g=0;break}if(0===y&&0===l){a(s[u],s[i],n[u],n[i])?(s[i]=f,n[i]=o,g=0):g=1;break}_=y,p=l}if(-1===g&&(g=(0,r.N)(s[i],0,1)||(0,r.N)(n[i],0,1)?0:1),1!==g)break;s[i]=s[u],n[i]=n[u]}}}(e,s,n,i,o);const p=[];for(let r=0,y=o;r<y;r++)p.push(r);const _=(t,e)=>d?(0,r.al)(i[t],n[t],i[e],n[e]):(0,r.al)(n[t],i[t],n[e],i[e]);if(p.length>1){p.sort(_);const t=Math.max(q(e),q(s));let o=0;for(let a=1,l=p.length;a<l;a++){const l=n[p[o]],h=n[p[a]],u=i[p[o]],c=i[p[a]];if(l!==h||u!==c)if(!(Gr(e,l,h)<=t&&Gr(s,u,c)<=t)||(0,r.N)(l,0,1)&&(0,r.N)(u,0,1)||(0,r.N)(h,0,1)&&(0,r.N)(c,0,1))o++,p[o]=p[a];else{const t=r.P.distance(e.getCoord2D(l),s.getCoord2D(u)),n=r.P.distance(e.getCoord2D(h),s.getCoord2D(c));if(t<=n)continue;if(n<t){p[o]=p[a];continue}}}if(p.length=o+1,1===p.length&&0!==p[0]&&(n[0]=n[p[0]],i[0]=i[p[0]],p[0]=0),p.length>2){const t=r.E.constructEmpty(),o=r.E.constructEmpty();t.setCoords(n[p[0]],n[p.at(-1)]),o.setCoords(i[p[0]],i[p.at(-1)]);let a=!0;for(let e=1,s=p.length-1;e<s;e++)if(!t.containsCoordinate(n[p[e]])||!o.containsCoordinate(i[p[e]])){a=!1;break}if(a){const n=[.5,.2,.7,.1,.3,.4,.6,.8,.9];for(let i=0;i<n.length;i++){let l=(0,r.q)(t.vmin,t.vmax,n[i]);const h=e.getCoord2D(l);if(!s.isCloserThanDistance(h,o,u)){a=!1;break}l=(0,r.q)(o.vmin,o.vmax,n[i]);const c=s.getCoord2D(l);if(!e.isCloserThanDistance(c,t,u)){a=!1;break}}}a&&(p[1]=p.at(-1),p.length=2)}}if(1===p.length&&t){const t=0,r=0;A(e,s,n[0],i[0],u,1,[t],[r])&&(p.push(1),n[1]=t,i[1]=r,p.sort(_))}if(c&&1===p.length){let t=!0;for(let o=0,a=p.length;o<a;o++)if(!(0,r.N)(n[p[o]],0,1)||!(0,r.N)(i[p[o]],0,1)||0!==r.P.distance(e.getCoord2D(n[p[o]]),s.getCoord2D(i[p[o]]))){t=!1;break}if(t)return 0}let f=0;for(let y=0,x=p.length;y<x;y++){if(l&&l.push(n[p[y]]),h&&h.push(i[p[y]]),a){const t=r.P.getNAN();e.queryCoord2D(n[p[y]],t),a.push(t)}f++}return f}function zr(t,e,s,n,i,o,a,l,h){if((0,r.N)(s,0,1)&&(0,r.N)(n,0,1)&&0===r.P.distance(t.getCoord2D(s),e.getCoord2D(n))){const u=1e-12,c=new v,m=Number.EPSILON;if(t.queryDerivative(new r.H(s,m),c),c.isTrueZero()){const e=1===s?-1e-12:u;t.queryDerivative(new r.H(s,m).add(e),c)}1===s&&c.negateThis();const d=new v;if(e.queryDerivative(new r.H(n,m),d),d.isTrueZero()){const t=1===s?-1e-12:u;e.queryDerivative(new r.H(n,m).add(t),d)}1===n&&d.negateThis(),c.isZero()||c.normalize(),d.isZero()||d.normalize();const g=c.dotProduct(d),p=c.crossProduct(d);p.scaleError(3);const _=()=>{if(h)return.001;{const s=t.calculateUpperLength2D(),n=e.calculateUpperLength2D();return Math.min(.01*i/Math.min(s,n),1e-10)}};if(g.ge(r.J)&&(p.isZero()||Math.abs(p.value())<_()))return T(t,e,s,n,i,o,a,l)}return 0}function Or(t,e,s,i,o){let a=-1,l=-1,h=-1,u=-1;{const n=[0,e],r=[e,0],o=[0,i],c=[i,0];for(let e=0;e<2&&-1===a;++e)for(let i=0;i<2;++i)if(t[n[e]].equals(s[o[i]])){a=n[e],l=r[e],h=o[i],u=c[i];break}}if(-1===a){const n=new _;n.setFromPoints(t,e+1);const r=new _;return r.setFromPoints(s,i+1),r.inflate(o),n.isIntersectingW(r)?-1:0}{const c=(0,r.d)(e+1,Number.NaN),m=gs(t,e+1,c);(0,n.g)(m>1);let d=0,g=0;for(let t=0;t<m;++t)a===c[t]&&(g=t,d++),l===c[t]&&d++;if(2!==d)return-1;const p=(0,r.d)(i+1,Number.NaN),_=gs(s,i+1,p);(0,n.g)(_>1),d=0;let f=0;for(let t=0;t<_;++t)h===p[t]&&(f=t,d++),u===p[t]&&d++;if(2!==d)return-1;const y=t[c[(g+m-1)%m]],x=t[c[(g+1)%m]],v=s[p[(f+_-1)%_]],b=s[p[(f+1)%_]],P=t[a],S=[y,x,v,b],E=[0,1,2,3];E.sort(((t,e)=>r.P.compareVectorsOrigin(P,S[t],S[e])));let C=E[0];for(let t=1;t<4;t++){if(E[t]!==(C+1)%4)return-1;C=E[t]}{const t=y.sub(P),e=b.sub(P),s=e.dotProduct(t);if(s>0){const n=e.crossProduct(t),i=Math.abs(Math.atan2(n,s)),r=i*t.length(),a=i*e.length();if(r<=o||a<=o)return-1}}{const t=x.sub(P),e=v.sub(P),s=e.dotProduct(t);if(s>0){const n=e.crossProduct(t),i=Math.abs(Math.atan2(n,s)),r=i*t.length(),a=i*e.length();if(r<=o||a<=o)return-1}}return 1}}var qr=i.V;class Br extends K{constructor(t){super(t||{XStart:0,YStart:0,XEnd:0,YEnd:0})}assignMove(t){return this!==t&&(this.m_description=t.m_description,t.m_description=null,this.m_attributes=t.m_attributes,t.m_attributes=null,this.m_XStart=t.m_XStart,t.m_XStart=Number.NaN,this.m_YStart=t.m_YStart,this.m_XEnd=t.m_XEnd,t.m_XEnd=Number.NaN,this.m_YEnd=t.m_YEnd),this}assignCopy(t){return this!==t&&t.copyTo(this),this}calculateLowerLength3D(){return(0,n.g)(0),0}calculateUpperLength3D(){return(0,n.g)(0),0}changeEndPoints3D(t,e){(0,n.g)(0)}getClosestCoordinate3D(t,e,s){return(0,n.g)(0),0}getBoundary(){return Tt(this)}getAttributeAsDbl(t,e,s){if(0===e)return 0===s?tt(this,t):et(this,t);const n=qr.getInterpolation(e),i=this.getStartAttributeAsDbl(e,s),o=this.getEndAttributeAsDbl(e,s);return(0,r.V)(n,i,o,t,qr.getDefaultValue(e))}constructFromCoords(t,e,s,n){this.dropAllAttributes(),this.setStartXYCoords(t,e),this.setEndXYCoords(s,n)}construct(t,e){this.dropAllAttributes(),this.setStartXY(t),this.setEndXY(e)}construct3D(t,e){(0,n.g)(0)}constructPoint(t,e){this.assignVertexDescription(t.getDescription()),this.mergeVertexDescription(e.getDescription()),this.setStart(t),this.setEnd(e)}getGeometryType(){return Br.type}queryEnvelope(t){if(4===t.m_EnvelopeType){t.setEmpty(),t.assignVertexDescription(this.m_description);const e=o.Envelope2D.constructEmpty();this.queryEnvelope(e),t.setEnvelope(e);for(let s=1,n=this.m_description.getAttributeCount();s<n;s++){const e=this.m_description.getSemantics(s);for(let n=0,i=qr.getComponentCount(e);s<i;s++){const s=this.queryInterval(e,n);t.setIntervalEnvelope(e,n,s)}}}else 2===t.m_EnvelopeType?t.setCoords({xmin:this.m_XStart,ymin:this.m_YStart,xmax:this.m_XEnd,ymax:this.m_YEnd}):3===t.m_EnvelopeType?(t.setEmpty(),t.mergeCoords(this.m_XStart,this.m_YStart,V(this,0,1,0)),t.mergeCoords(this.m_XEnd,this.m_YEnd,V(this,1,1,0))):(0,n.t)("env type not impl")}applyTransformation(t){(0,n.g)(t instanceof a.T);const e=new r.P;e.x=this.m_XStart,e.y=this.m_YStart,t.transformInPlace(e),this.m_XStart=e.x,this.m_YStart=e.y,e.x=this.m_XEnd,e.y=this.m_YEnd,t.transformInPlace(e),this.m_XEnd=e.x,this.m_YEnd=e.y}createInstance(){return new Br({vd:this.m_description})}calculateLength2D(){return Math.sqrt(ct(this))}calculateLength3D(t){return(0,n.g)(0),0}changeEndPoints2D(t,e){this.setStartXY(t),this.setEndXY(e),this.normalizeAfterEndpointChange()}queryControlPointsHelper(t){return(0,n.g)(t.length>=2),t[0]=this.getStartXY(),t[1]=this.getEndXY(),2}queryCoord2D(t,e){return Q(this,t,e)}queryCoord3D(t,e){(0,n.g)(0)}getCoordZ(t){return function(t,e){const s=t.getStartZ(),n=t.getEndZ();return(0,r.q)(s,n,e)}(this,t)}queryCoord2DE(t,e){st(this,t,e)}queryCoord2DMP(t,e){e.assignPoint2D(this.getStartXY());const s=P.constructPoint2D(this.getEndXY());s.subThis(e),s.mulThis(r.M.constructDouble(t)),e.addThis(s)}getCoordX(t){return tt(this,t)}getCoordY(t){return et(this,t)}cut(t,e,s){const n=new Yr;return this.queryCut(t,e,n,s),n.releaseSegment()}queryCut(t,e,s,n){const i=s.createLine();n&&i.assignVertexDescription(this.m_description);const o=r.P.getNAN();if(Q(this,t,o),i.setStartXYCoords(o.x,o.y),Q(this,e,o),i.setEndXYCoords(o.x,o.y),!n)for(let r=1,a=this.m_description.getAttributeCount();r<a;r++){const s=this.m_description.getSemantics(r),n=qr.getComponentCount(s);for(let r=0;r<n;r++){const n=this.getAttributeAsDbl(t,s,r);i.setStartAttribute(s,r,n);const o=this.getAttributeAsDbl(e,s,r);i.setEndAttribute(s,r,o)}}}queryDerivative(t,e){!function(t,e,s){const n=v.constructPoint2D(t.getStartXY()),i=v.constructPoint2D(t.getEndXY());s.setCoordsE(i.x.subE(n.x),i.y.subE(n.y))}(this,0,e)}getClosestCoordinate(t,e){return r.P.getClosestCoordinate(this.getStartXY(),this.getEndXY(),t,e)}getClosestCoordinateOnInterval(t,e,s=-1){const n=new r.P;this.queryCoord2D(e.vmin,n);const i=new r.P;this.queryCoord2D(e.vmax,i);const o=r.P.getClosestCoordinate(n,i,t,!1);return X.recalculateParentT(e.vmin,e.vmax,o)}intersectionOfYMonotonicWithAxisX(t,e){const s=this.m_YEnd-this.m_YStart;if(!s)return t===this.m_YEnd?e:Number.NaN;const n=(t-this.m_YStart)/s;let i=tt(this,n);return 1===n&&(i=this.m_XEnd),i}isCurve(){return!1}isMonotoneQuickAndDirty(){return!0}isDegenerate(t){const e=this.m_XStart-this.m_XEnd,s=this.m_YStart-this.m_YEnd;return Math.sqrt(e*e+s*s)<=t}isDegenerate3D(t,e){return(0,n.g)(0),!1}queryLooseEnvelope(t){this.queryEnvelope(t)}clone(t){const e=new Br;return this.copyTo(e),e}tToLength(t){return t*this.calculateLength2D()}lengthToT(t){const e=this.calculateLength2D();return 0!==e?t/e:0}calculateWeightedAreaCentroid2D(t){const e=new r.P;return e.setCoords(0,0),e}calculateWeightedCentroid2D(){return this.getCoord2D(.5).mul(this.calculateLength2D())}getTangent(t){const e=r.P.getNAN();return e.setSub(this.getEndXY(),this.getStartXY()),e}getDerivative(t){const e=new r.P;return e.setSub(this.getEndXY(),this.getStartXY()),e}getCurvature(t){return 0}isIntersectingPoint(t,e,s){return at(this,t,e,s)>=0}isIntersectingPoint3D(t,e,s,i,r=1){return(0,n.g)(0),!1}getYMonotonicParts(t,e){return 0}getMonotonicParts(t,e){return 0}getMonotonicPartParams(t,e){return e&&(t<2&&(0,n.a)(""),e[0]=0,e[1]=1),2}intersectionWithAxis2D(t,e,s,n){if(t){const t=this.m_YEnd-this.m_YStart;if(!t)return e===this.m_YEnd?-1:0;const i=(e-this.m_YStart)/t;return i<0||i>1?0:(s&&(s[0]=tt(this,i)),n&&(n[0]=i),1)}{const t=this.m_XEnd-this.m_XStart;if(!t)return e===this.m_XEnd?-1:0;const i=(e-this.m_XStart)/t;return i<0||i>1?0:(s&&(s[0]=et(this,i)),n&&(n[0]=i),1)}}calculateUpperLength2D(){return this.calculateLength2D()}calculateLowerLength2D(){return this.calculateLength2D()}normalizeAfterEndpointChange(){return!1}queryLooseEnvelopeOnInterval(t,e){if(2===e.m_EnvelopeType){let s=(0,r.s)(t.vmin,0,1);const n=new r.P;return this.queryCoord2D(s,n),e.setCoords({pt:n}),s=(0,r.s)(t.vmax,0,1),this.queryCoord2D(s,n),void e.mergeNe(n)}(0,n.t)("3d dst not impl")}orientBottomUp(){it(this)}isLine(){return!0}isDegenerateToLineHelper(t){return!0}copyIgnoreAttributes(t){t.setStartXY(this.getStartXY()),t.setEndXY(this.getEndXY()),t.normalizeAfterEndpointChange()}calculateArea2DHelper(){return 0}absNormXYZ(t){return function(t,e){const s=t.getStartXYZ();s.z*=e;const n=t.getEndXYZ();return n.z*=e,s.norm(1)+n.norm(1)}(this,t)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)}queryEnvelopeW(t,e){e.setCoords(this.getCoord2D(t.vmin)),e.mergeNe(this.getCoord2D(t.vmax))}setSegmentFromCoordsForStitcher(t,e){nt(this,t[0],t[e-1])}writeInBufferStream(t,e){return(0,n.g)(0),0}readFromBufferStream(t,e){(0,n.g)(0)}snapControlPoints(t){return!1}needsSnapControlPoints(t){return!1}calculateSpecialPointsForCracking(t,e){return 0}ensureXYMonotone(){return!1}setCoordsForIntersector(t,e,s){nt(this,t,e)}static isIntersectingLineLine(t,e,s,n){return rt(t,e,s,n)}static isIntersectingLineLine_(t,e,s,n){return rt(t,e,s,n)}copyToImpl(t){}reverseImpl(){}equalsImpl(t){return!0}equalsImplTol(t,e){return!0}swapImpl(t){}afterCompletedModification(){}endPointModified(){}clearEndPointModified(){}intersect(t,e,s,n,i){return Lr(!1,this,t,e,s,n,i)}intersectPoint(t,e,s){e.length<1&&(0,n.q)("");const i=at(this,t,s,!1);return i>=0?(e&&(e[0]=i),1):0}isIntersecting(t,e,s){return 0!==Nr(!1,this,t,e,s)}}Br.type=n.G.enumLine;class Yr{constructor(t){this.m_seg=null,this.m_curves=null,this.m_lineBuffer=new Br,this.m_mask=0,this.m_active=0,void 0!==t&&(t.copy?t.copy.copyTo(this,!1):t.move?this.assignMove(t.move):t.segment?this.copyFrom(t.segment,!!t.bIgnoreAttributes):(0,n.d)("bad constructor params"))}assignCopy(t){return t instanceof Yr?this!==t&&t.copyTo(this,!1):this.copyFrom(t,!1),this}assignMove(t){if(t instanceof Yr){if(this===t)return this;this.reset(),1&t.m_mask&&(this.m_lineBuffer=t.m_lineBuffer,t.m_lineBuffer=null,this.m_mask=1),this.m_curves=t.m_curves,this.m_mask=t.m_mask,this.m_active=t.m_active,t.reset(),this.m_seg=this.activeSegment(),t.m_seg=null}else{if(this.m_seg===t)return this;this.create(t.getGeometryType()),this.m_seg.swap(t)}return this}activeSegment(){switch(this.m_active){case 0:return null;case 1:return this.line();case 2:return this.arc();case 4:return this.bezier3();case 8:return this.bezier2();case 16:return this.rbezier2();default:(0,n.d)("")}}get(){return this.m_seg}reset(){1&this.m_mask&&(this.m_lineBuffer=null),this.m_mask>1&&(this.m_curves=null),this.m_mask=0,this.m_active=0}empty(){return null===this.m_seg}copyTo(t,e){this!==t&&(this.empty()?t.m_seg=null:t.copyFrom(this.m_seg,e))}copyToWithZ(t,e){(0,n.g)(0)}createImpl(t){switch(t){case n.G.enumLine:1&this.m_mask||(this.m_lineBuffer=new Br,this.m_mask|=1,this.m_active=1);break;case n.G.enumEllipticArc:2&this.m_mask||(this.m_curves=new Ri,this.m_mask=1&this.m_mask|2,this.m_active=2);break;case n.G.enumBezier:4&this.m_mask||(this.m_curves=new In,this.m_mask=1&this.m_mask|4,this.m_active=4);break;case n.G.enumBezier2:8&this.m_mask||(this.m_curves=new Kt,this.m_mask=1&this.m_mask|8,this.m_active=8);break;case n.G.enumRationalBezier2:16&this.m_mask||(this.m_curves=new Wt,this.m_mask=1&this.m_mask|16,this.m_active=16);break;default:(0,n.a)("")}}create(t){t===n.G.enumLine?this.createLine():t===n.G.enumEllipticArc?this.createEllipticArc():t===n.G.enumBezier?this.createCubicBezier():t===n.G.enumRationalBezier2?this.createQuadraticRationalBezier():t===n.G.enumBezier2?this.createQuadraticBezier():(0,n.a)("Segment_buffer.create")}copyFrom(t,e){this.m_seg!==t&&(this.create(t.getGeometryType()),e?t.copyIgnoreAttributes(this.m_seg):t.copyTo(this.m_seg))}copyFromWithZ(t,e){(0,n.g)(0)}line(){return this.m_lineBuffer}arc(){return this.m_curves}bezier3(){return this.m_curves}bezier2(){return this.m_curves}rbezier2(){return this.m_curves}createLine(){return this.createImpl(n.G.enumLine),this.m_seg=this.line(),this.line()}createEllipticArc(){return this.createImpl(n.G.enumEllipticArc),this.m_seg=this.arc(),this.arc()}createCubicBezier(){return this.createImpl(n.G.enumBezier),this.m_seg=this.bezier3(),this.bezier3()}createQuadraticRationalBezier(){return this.createImpl(n.G.enumRationalBezier2),this.m_seg=this.rbezier2(),this.rbezier2()}createQuadraticBezier(){return this.createImpl(n.G.enumBezier2),this.m_seg=this.bezier2(),this.bezier2()}releaseSegment(){if(this.m_seg=null,0===this.m_active&&(0,n.d)("releaseSegment"),1&this.m_active){const t=this.line();return this.m_mask-=1,this.m_active=0,this.m_lineBuffer=null,t}let t;return 2&this.m_active?t=this.arc():4&this.m_active?t=this.bezier3():8&this.m_active?t=this.bezier2():16&this.m_active?t=this.rbezier2():(0,n.d)("releaseSegment"),this.m_mask-=this.m_active,this.m_active=0,this.m_curves=null,t}equals(t){return t instanceof Yr?this===t||(this.empty()?t.empty():!t.empty()&&this.get().equals(t.get())):((0,n.t)("seg comparison not yet impl"),!1)}}},80690:(t,e,s)=>{s.d(e,{O:()=>d,a:()=>c,c:()=>h});var n=s(50256),i=s(62188),r=s(75992),o=s(21566),a=s(74642),l=s(86330);function h(t,e,s,n,i){return u(t,e,null,s,n,i)}function u(t,e,s,n,a,l){const u=t.getGeometryType();if(u===i.G.enumPoint){const s=t.getXY();return e.contains(s)?t:t.createInstance()}if(u===i.G.enumEnvelope){const s=o.Envelope2D.constructEmpty();if(t.queryEnvelope(s),s.intersect(e)){const e=t.clone();return e.setEnvelope(s),e}return t.createInstance()}if(t.isEmpty())return t;if(e.isEmpty())return t.createInstance();const c=e.clone();{const e=new o.Envelope2D;if(t.queryLooseEnvelope(e),c.containsEnvelope(e))return t;if(!c.isIntersecting(e))return t.createInstance();0===a&&(e.intersect(c),e.inflate(Math.max(.1*e.maxDimension(),1)),e.intersect(c),c.assign(e))}let d=n;if((null!==s||Number.isNaN(d))&&(d=(0,r.c)(s,c,!1).total()),u===i.G.enumGeometryCollection){const e=t,s=t.createInstance();for(let t=0,n=e.getGeometryCount();t<n;t++){const n=e.getGeometry(t);if(n.isEmpty())continue;const i=h(n,c,d,a,l);i.isEmpty()||(i===n?s.addGeometry(i.clone()):s.addGeometry(i))}return s}(0,i.i)(u)||(0,i.a)("Clip: geometry not supported");const g=t.getImpl().getAccelerators();if(null!==g){const t=g.getRasterizedGeometry();(0,i.g)(null===t)}switch(u){case i.G.enumMultiPoint:{const e=t;let s;const n=e.getPointCount(),r=e.getImpl().getAttributeStreamRef(0);let o=0;for(let t=0;t<n;t++){const n=r.readPoint2D(2*t);c.contains(n)||(0===o&&(s=e.createInstance()),o<t&&s.addPoints(e,o,t),o=t+1)}return o>0&&s.addPoints(e,o,n),0===o?e:((0,i.g)(null!==s),s)}case i.G.enumPolygon:case i.G.enumPolyline:return function(t,e,s,n,i){return new m(e,i).clipMultiPath2(t,s,n)}(t,c,d,a,l);default:(0,i.d)("")}}function c(t,e,s,n,i,r){const a=new m(e,r),l=new o.Envelope2D;return t.queryLooseEnvelope(l),e.containsEnvelope(l)?t:e.isIntersecting(l)?a.clipPolesOut(t,i):t.createInstance()}class m{constructor(t,e){this.m_shape=new a.E,this.m_geometry=a.n,this.m_verticesOnExtentIndex=-1,this.m_verticesOnExtent=[],this.m_progressCounter=0,this.m_extent=new o.Envelope2D(t),this.m_progressTracker=e}progress_(){}clipMultiPath2(t,e,s){return t.getGeometryType()===i.G.enumPolygon?this.clipPolygonOrProjectedPolyline2(t,s):this.clipPolyline(t,e)}clipPolygonOrProjectedPolyline2(t,e){const s=t.getGeometryType()===i.G.enumPolyline;if(0===this.m_extent.width()||0===this.m_extent.height())return t.createInstance();const n=o.Envelope2D.constructEmpty();t.queryLooseEnvelope(n),this.m_geometry=s?this.m_shape.addGeometry(t):this.m_shape.addGeometry(t,this.m_extent);const r=o.Envelope2D.constructEmpty(),h=o.Envelope2D.constructEmpty(),u=new l.P,c=new l.P,d=(0,l.d)(9,Number.NaN),g=(0,l.d)(9,Number.NaN),p=(0,l.m)(l.P,9);let _=null;const f=new a.L,y=[];let x=!1;for(let o=0;!x&&o<4;o++){let t=!1;const e=!!(1&o);let l=0;switch(o){case 0:l=this.m_extent.xmin,t=n.xmin<=l&&n.xmax>=l;break;case 1:l=this.m_extent.ymin,t=n.ymin<=l&&n.ymax>=l;break;case 2:l=this.m_extent.xmax,t=n.xmin<=l&&n.xmax>=l;break;case 3:l=this.m_extent.ymax,t=n.ymin<=l&&n.ymax>=l}if(t){x=!0;for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==a.n;){let n=!0,v=-1,b=-1;const P=this.m_shape.getFirstVertex(t);let S=P;do{this.progress_(),_=this.m_shape.getSegment(S);let t=_;if(null===t){const e=this.m_shape.getNextVertex(S);if(e===a.n){(0,i.g)(s),0===v&&y.push(S);break}this.m_shape.queryXY(S,u),f.setStartXY(u),this.m_shape.queryXY(e,c),f.setEndXY(c),t=f}t.queryLooseEnvelope(r);let P=m.checkSegmentIntersection(r,o,l);t.isCurve()&&0===P&&t.isCurve()&&(f.setStartXY(t.getStartXY()),f.setEndXY(t.getEndXY()),this.m_shape.replaceCurveWithLine(S),t=f,f.queryEnvelope(r),P=m.checkSegmentIntersection(r,o,l));let E=0,C=a.n;if(-1===P){const s=t.intersectionWithAxis2D(e,l,d,g);if(s>0){let n=null;if(t.isCurve()){n=p,(0,i.g)(s<=9);for(let t=0;t<s;t++)e?p[t].setCoords(d[t],l):p[t].setCoords(l,d[t]);E=this.m_shape.splitSegmentAxisAware(S,g,s,n,e?1:0)}else E=this.m_shape.splitSegmentAxisAware(S,g,s,null,-1)}else E=0;E+=1;let r=S,a=this.m_shape.getNextVertex(r);t=null;for(let t=0;t<E;t++){this.m_shape.queryXY(r,u),this.m_shape.queryXY(a,c),_=this.m_shape.getSegment(r);let t=_;null===t&&(f.setStartXY(u),f.setEndXY(c),t=f),t.queryEnvelope(h);let s=m.checkSegmentIntersection(h,o,l);t.isCurve()&&0===s&&(this.m_shape.replaceCurveWithLine(r),f.setStartXY(u),f.setEndXY(c),t=f,t.queryEnvelope(h),s=m.checkSegmentIntersection(h,o,l)),-1===s&&(e?Math.abs(u.y-l)<Math.abs(c.y-l)?(u.y=l,this.m_shape.setXY(r,u)):(c.y=l,this.m_shape.setXY(a,c)):Math.abs(u.x-l)<Math.abs(c.x-l)?(u.x=l,this.m_shape.setXY(r,u)):(c.x=l,this.m_shape.setXY(a,c)),_=this.m_shape.getSegment(r),t=_,null===t&&(f.setStartXY(u),f.setEndXY(c),t=f),t.queryEnvelope(h),s=m.checkSegmentIntersection(h,o,l),-1===s&&(s=m.checkSegmentIntersectionLoose(h,o,l)));const i=v;v=s,-1===b&&(b=v),0===i&&1===v||1===i&&0===v||0===i&&0===v&&y.push(r),1===v&&(x=!1,n=!1),r=a,C=r,a=this.m_shape.getNextVertex(a)}}if(0===E){const t=v;v=P,-1===b&&(b=v),0===t&&v>=1||t>=1&&0===v||0===t&&0===v&&y.push(S),1===v&&(x=!1,n=!1),C=this.m_shape.getNextVertex(S)}if(S=C,y.length>=256){for(let t=1,e=y.length-1;t<e;t++){const e=y[t];s?this.m_shape.snapVertexForPoleClipping(e,l):this.m_shape.removeVertex(e,!1)}y[1]=y.at(-1),y.length=2}}while(S!==P);if(!n){0!==b||!s&&0!==v&&2!==v||y.push(P);for(let t=0,e=y.length;t<e;t++){const e=y[t];s?this.m_shape.snapVertexForPoleClipping(e,l):this.m_shape.removeVertex(e,!1)}}y.length=0,t=n||0===this.m_shape.getPathSize(t)?this.m_shape.removePath(t):this.m_shape.getNextPath(t)}}}if(x)return t.createInstance();_=null,s?this.removeSpikesAlongPoles():this.resolveBoundaryOverlaps(),e>0&&this.densifyAlongClipExtent(e);const v=this.m_shape.getGeometry(this.m_geometry);return v.getGeometryType()===i.G.enumPolygon&&v.setFillRule(t.getFillRule()),v}clipPolyline(t,e){const s=o.Envelope2D.constructEmpty(),n=o.Envelope2D.constructEmpty(),i=(0,l.d)(9,Number.NaN),r=(0,l.d)(9,Number.NaN),h=new a.S;let u=t;const c=o.Envelope2D.constructEmpty();t.queryLooseEnvelope(c);for(let o=0;o<4;o++){let e=!1;const a=!!(1&o);let d=0;switch(o){case 0:d=this.m_extent.xmin,e=c.xmin<=d&&c.xmax>=d;break;case 1:d=this.m_extent.ymin,e=c.ymin<=d&&c.ymax>=d;break;case 2:d=this.m_extent.xmax,e=c.xmin<=d&&c.xmax>=d;break;case 3:d=this.m_extent.ymax,e=c.ymin<=d&&c.ymax>=d}if(!e)continue;const g=u;u=t.createInstance();const p=g.getImpl().querySegmentIterator();p.resetToFirstPath();const _=new l.P,f=new l.P;for(;p.nextPath();){let t=-1,e=!0;for(;p.hasNextSegment();){this.progress_();const l=p.nextSegment(),c=l.isDegenerate(0);l.queryLooseEnvelope(s);const g=m.checkSegmentIntersection(s,o,d);if(-1===g){const s=l.intersectionWithAxis2D(a,d,i,r);let g=0;_.assign(l.getStartXY());for(let p=0;p<=s;p++){const y=p<s?r[p]:1;if(g===y)continue;l.queryCut(g,y,h,!1);const x=h.get();let v=!1;if(x.getStartXY().equals(_)||(x.setStartXY(_),v=!0),p<s&&(a?(f.x=i[p],f.y=d):(f.x=d,f.y=i[p]),x.getEndXY().equals(f)||(x.setEndXY(f),v=!0)),v&&x.normalizeAfterEndpointChange(),!c&&x.isDegenerate(0))continue;x.queryEnvelope(n);let b=m.checkSegmentIntersection(n,o,d);if(-1===b){const t=x.getStartXY(),e=x.getEndXY();v=!1,a?Math.abs(t.y-d)<Math.abs(e.y-d)?(t.y=d,x.setStartXY(t),t.equals(x.getStartXY())||(x.setStartXY(t),v=!0)):(e.y=d,e.equals(x.getEndXY())||(x.setEndXY(e),v=!0)):Math.abs(t.x-d)<Math.abs(e.x-d)?(t.x=d,t.equals(x.getStartXY())||(x.setStartXY(t),v=!0)):(e.x=d,e.equals(x.getEndXY())||(x.setEndXY(e),v=!0)),v&&x.normalizeAfterEndpointChange(),x.queryEnvelope(n),b=m.checkSegmentIntersection(n,o,d),-1===b&&(b=m.checkSegmentIntersectionLoose(n,o,d))}_.assign(x.getEndXY()),g=y,t=b,t>=1?(u.addSegment(x,e),e=!1):e=!0}}else t=g,t>=1?(u.addSegment(l,e),e=!1):e=!0}}}return u}static checkSegmentIntersection(t,e,s){switch(e){case 0:return t.xmin<s&&t.xmax<=s?0:t.xmin>=s?t.xmax===s?2:1:-1;case 1:return t.ymin<s&&t.ymax<=s?0:t.ymin>=s?t.ymax===s?2:1:-1;case 2:return t.xmin>=s&&t.xmax>s?0:t.xmax<=s?t.xmin===s?2:1:-1;case 3:return t.ymin>=s&&t.ymax>s?0:t.ymax<=s?t.ymin===s?2:1:-1}return(0,i.d)(""),0}static checkSegmentIntersectionLoose(t,e,s){switch(e){case 0:{const e=Math.abs(t.xmin-s),n=Math.abs(t.xmax-s);return t.xmin<s?e>n?0:1:((0,i.d)(""),1)}case 1:{const e=Math.abs(t.ymin-s),n=Math.abs(t.ymax-s);return t.ymin<s?e>n?0:1:((0,i.d)(""),1)}case 2:{const e=Math.abs(t.xmin-s),n=Math.abs(t.xmax-s);return t.xmax>s?e<n?0:1:((0,i.d)(""),1)}case 3:{const e=Math.abs(t.ymin-s),n=Math.abs(t.ymax-s);return t.ymax>s?e<n?0:1:((0,i.d)(""),1)}}return(0,i.d)(""),0}resolveBoundaryOverlaps(){this.m_verticesOnExtentIndex=-1,this.splitSegments(!1,this.m_extent.xmin),this.splitSegments(!1,this.m_extent.xmax),this.splitSegments(!0,this.m_extent.ymin),this.splitSegments(!0,this.m_extent.ymax),this.m_verticesOnExtent.length=0,this.m_verticesOnExtentIndex=this.m_shape.createUserIndex();const t=new l.P;for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==a.n;e=this.m_shape.getNextPath(e)){let s=this.m_shape.getFirstVertex(e);for(let n=0,i=this.m_shape.getPathSize(e);n<i;n++,s=this.m_shape.getNextVertex(s))this.progress_(),this.m_shape.queryXY(s,t),this.m_extent.xmin!==t.x&&this.m_extent.xmax!==t.x&&this.m_extent.ymin!==t.y&&this.m_extent.ymax!==t.y||(this.m_shape.setUserIndex(s,this.m_verticesOnExtentIndex,this.m_verticesOnExtent.length),this.m_verticesOnExtent.push(s))}this.dbgCheckPathFirst(),this.resolveOverlaps(!1,this.m_extent.xmin),this.dbgCheckPathFirst(),this.resolveOverlaps(!1,this.m_extent.xmax),this.dbgCheckPathFirst(),this.resolveOverlaps(!0,this.m_extent.ymin),this.dbgCheckPathFirst(),this.resolveOverlaps(!0,this.m_extent.ymax),this.fixPaths()}densifyAlongClipExtent(t){const e=new l.P(0,0),s=new l.P(0,0),n=(0,l.d)(2048,Number.NaN);for(let r=this.m_shape.getFirstPath(this.m_geometry);r!==a.n;r=this.m_shape.getNextPath(r)){const o=this.m_shape.getFirstVertex(r);let a=o;do{const r=this.m_shape.getNextVertex(a);this.m_shape.queryXY(a,e);let o=-1;if(e.x===this.m_extent.xmin?(this.m_shape.queryXY(r,s),s.x===this.m_extent.xmin&&(o=1)):e.x===this.m_extent.xmax&&(this.m_shape.queryXY(r,s),s.x===this.m_extent.xmax&&(o=1)),e.y===this.m_extent.ymin?(this.m_shape.queryXY(r,s),s.y===this.m_extent.ymin&&(o=0)):e.y===this.m_extent.ymax&&(this.m_shape.queryXY(r,s),s.y===this.m_extent.ymax&&(o=0)),-1===o){a=r;continue}if(this.isCurve(a)){a=r;continue}const h=e.clone(),u=new l.P(0,0);if(o){const n=e.y-this.m_extent.ymin;u.y=(0,l.e)(s.y-e.y),h.y=t*(0,l.f)(Math.floor(Math.abs(n)/t),n)+this.m_extent.ymin,u.y<0&&(h.y+=t)}else{const n=e.x-this.m_extent.xmin;u.x=(0,l.e)(s.x-e.x),h.x=t*(0,l.f)(Math.floor(Math.abs(n)/t),n)+this.m_extent.xmin,u.x<0&&(h.x+=t)}const c=o?s.y-e.y:s.x-e.x,m=Math.abs(c);if(m/t>65536&&(0,i.d)(""),m>0){const s=Math.trunc(m/t)+2;n.length<s&&(n.length=s);let r=0;for(let a=0;;a++){const s=h.add(u.mul(a*t)),l=(o?s.y-e.y:s.x-e.x)/c;if(l>=1)break;l<=0||((0,i.g)(r<=n.length),n[r]=l,r++)}0!==r&&this.m_shape.splitSegment(a,n,r)}a=r}while(a!==o)}}splitSegments(t,e){let s=-1;const n=new l.P,i=[];for(let l=this.m_shape.getFirstPath(this.m_geometry);l!==a.n;l=this.m_shape.getNextPath(l)){let r=this.m_shape.getFirstVertex(l),o=a.n;for(let a=0,h=this.m_shape.getPathSize(l);a<h;a++,r=o)if(this.progress_(),o=this.m_shape.getNextVertex(r),this.m_shape.queryXY(r,n),(t?n.y===e:n.x===e)&&(this.m_shape.queryXY(o,n),t?n.y===e:n.x===e)){if(this.isCurve(r))continue;-1===s&&(s=this.m_shape.createUserIndex()),1!==this.m_shape.getUserIndex(r,s)&&(i.push(r),this.m_shape.setUserIndex(r,s,1)),1!==this.m_shape.getUserIndex(o,s)&&(i.push(o),this.m_shape.setUserIndex(o,s,1))}}if(-1!==s&&this.m_shape.removeUserIndex(s),i.length<3)return;i.sort(((t,e)=>this.compareVertices(t,e)));const r=new l.P,o=new l.P,h=new l.P;o.setNAN();let u=-1,c=[],m=[];const d=this.m_shape.createUserIndex(),g=this.m_shape.createUserIndex();for(let a=0,p=i.length;a<p;a++){const s=i[a];if(this.m_shape.queryXY(s,n),!n.isEqualPoint2D(o)){if(-1===u){u=a,o.setCoordsPoint2D(n);continue}for(let n=u;n<a;n++){const s=i[n],a=this.m_shape.getNextVertex(s),l=this.m_shape.getPrevVertex(s);let h=!1;this.m_shape.queryXY(a,r),o.compare(r)<0&&(t?r.y===e:r.x===e)&&(this.isCurve(s)||(c.push(s),h=!0,this.m_shape.setUserIndex(s,g,1))),this.m_shape.queryXY(l,r),o.compare(r)<0&&(t?r.y===e:r.x===e)&&(this.isCurve(l)||(h||c.push(s),this.m_shape.setUserIndex(s,d,1)))}for(let t=0,e=c.length;t<e;t++){const e=c[t],s=this.m_shape.getUserIndex(e,d),i=this.m_shape.getUserIndex(e,g);if(1===s){const t=this.m_shape.getPrevVertex(e);this.m_shape.queryXY(t,h);let s=0;if(!h.isEqualPoint2D(n)){const i=l.P.distance(o,h);s=l.P.distance(h,n)/i,0===s?s=Number.EPSILON:1===s&&(s=1-Number.EPSILON),this.m_shape.splitSegment(t,[s],1);const r=this.m_shape.getPrevVertex(e);this.m_shape.setXY(r,n),m.push(r),this.m_shape.setUserIndex(r,d,1),this.m_shape.setUserIndex(r,g,-1)}}if(1===i){const t=this.m_shape.getNextVertex(e);this.m_shape.queryXY(t,h);let s=0;if(!h.isEqualPoint2D(n)){const t=l.P.distance(o,h);s=l.P.distance(o,n)/t,0===s?s=Number.EPSILON:1===s&&(s=1-Number.EPSILON),this.m_shape.splitSegment(e,[s],1);const i=this.m_shape.getNextVertex(e);this.m_shape.setXY(i,n),m.push(i),this.m_shape.setUserIndex(i,d,-1),this.m_shape.setUserIndex(i,g,1)}}}const s=c;c=m,m=s,m.length=0,u=a,o.setCoordsPoint2D(n)}}this.m_shape.removeUserIndex(d),this.m_shape.removeUserIndex(g)}resolveOverlaps(t,e){const s=new l.P,n=[];let r=-1;for(let i=0,l=this.m_verticesOnExtent.length;i<l;i++){this.progress_();const o=this.m_verticesOnExtent[i];if(o===a.n)continue;const l=this.m_shape.getNextVertex(o);if(this.m_shape.queryXY(o,s),(t?s.y===e:s.x===e)&&(this.m_shape.queryXY(l,s),t?s.y===e:s.x===e)){if(this.isCurve(o))continue;-1===r&&(r=this.m_shape.createUserIndex()),-2!==this.m_shape.getUserIndex(o,r)&&(n.push(o),this.m_shape.setUserIndex(o,r,-2)),-2!==this.m_shape.getUserIndex(l,r)&&(n.push(l),this.m_shape.setUserIndex(l,r,-2))}}if(0===n.length)return void(-1!==r&&this.m_shape.removeUserIndex(r));(0,i.g)(-1!==r),n.sort(((t,e)=>this.compareVertices(t,e)));for(let i=0,a=n.length;i<a;i++){const t=n[i];this.m_shape.setUserIndex(t,r,i)}const o=new l.P,h=new l.P;h.setNAN();let u=-1;for(let i=0,l=n.length;i<l;i++){this.progress_();const l=n[i];if(l!==a.n&&(this.m_shape.queryXY(l,s),!s.isEqualPoint2D(h))){if(-1!==u)for(;;){let s=!1;const l=i;for(let c=u;c<l;c++){const l=n[c];if(l===a.n)continue;let u=a.n;const m=this.m_shape.getNextVertex(l);this.m_shape.queryXY(m,o),h.compare(o)<0&&(t?o.y===e:o.x===e)&&(this.isCurve(l)||(u=m));let d=a.n;const g=this.m_shape.getPrevVertex(l);if(this.m_shape.queryXY(g,o),h.compare(o)<0&&(t?o.y===e:o.x===e)&&(this.isCurve(g)||(d=g)),u===a.n||d===a.n){if(u!==a.n||d!==a.n){for(let m=c+1;m<i;m++){const i=n[m];if(i===a.n)continue;const c=this.m_shape.getNextVertex(i);let g=a.n;this.m_shape.queryXY(c,o),h.compare(o)<0&&(t?o.y===e:o.x===e)&&(this.isCurve(i)||(g=c));const p=this.m_shape.getPrevVertex(i);let _=a.n;if(this.m_shape.queryXY(p,o),h.compare(o)<0&&(t?o.y===e:o.x===e)&&(this.isCurve(p)||(_=p)),g!==a.n&&_!==a.n){this.beforeRemoveVertex(i,n,r),this.m_shape.removeVertex(i,!1),this.beforeRemoveVertex(g,n,r),this.m_shape.removeVertex(g,!1),s=!0;break}if(u!==a.n&&_!==a.n){this.removeOverlap(n,l,u,i,_,r),s=!0;break}if(d!==a.n&&g!==a.n){this.removeOverlap(n,i,g,l,d,r),s=!0;break}}if(s)break}}else this.beforeRemoveVertex(l,n,r),this.m_shape.removeVertex(l,!1),this.beforeRemoveVertex(u,n,r),this.m_shape.removeVertex(u,!1),s=!0}if(!s)break}u=i,h.setCoordsPoint2D(s)}}this.m_shape.removeUserIndex(r)}beforeRemoveVertex(t,e,s){let n=this.m_shape.getUserIndex(t,s);(0,i.g)(n>=0),e[n]=a.n,n=this.m_shape.getUserIndex(t,this.m_verticesOnExtentIndex),(0,i.g)(n>=0),this.m_verticesOnExtent[n]=a.n;const r=this.m_shape.getPathFromVertex(t);r!==a.n&&this.m_shape.getFirstVertex(r)===t&&(this.m_shape.setFirstVertex(r,a.n),this.m_shape.setLastVertex(r,a.n))}removeOverlap(t,e,s,n,i,r){this.m_shape.setNextVertex(e,n),this.m_shape.setPrevVertex(n,e),this.m_shape.setPrevVertex(s,i),this.m_shape.setNextVertex(i,s),this.beforeRemoveVertex(n,t,r),this.m_shape.removeVertexInternal(n,!1),this.beforeRemoveVertex(i,t,r),this.m_shape.removeVertexInternal(i,!0)}removeSpikesAlongPoles(){this.removeSpikesOnPole(this.m_extent.ymin),this.removeSpikesOnPole(this.m_extent.ymax)}removeSpikesOnPole(t){for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==a.n;e=this.m_shape.getNextPath(e)){const s=this.m_shape.getPathSize(e);if(s<3)continue;let n=this.m_shape.getFirstVertex(e);const i=new l.P;this.m_shape.queryXY(n,i);let r=i.y===t&&!this.isCurve(n);n=this.m_shape.getNextVertex(n);const o=new l.P;this.m_shape.queryXY(n,o);let a=o.y===t&&!this.isCurve(n);n=this.m_shape.getNextVertex(n);const h=new l.P;for(let e=0,l=s-2;e<l;e++,n=this.m_shape.getNextVertex(n)){this.progress_(),this.m_shape.queryXY(n,h);const e=h.y===t;a&&r&&e&&(o.x-i.x)*(h.x-o.x)<=0?(this.m_shape.removeVertex(this.m_shape.getPrevVertex(n),!1),o.setCoordsPoint2D(h),a=e&&!this.isCurve(n)):(i.setCoordsPoint2D(o),r=a,o.setCoordsPoint2D(h),a=e&&!this.isCurve(n))}}}fixPaths(){for(let i=0,r=this.m_verticesOnExtent.length;i<r;i++){const t=this.m_verticesOnExtent[i];t!==a.n&&this.m_shape.setPathToVertex(t,a.n)}const t=this.m_shape.hasCurves();let e=0,s=0;for(let i=this.m_shape.getFirstPath(this.m_geometry);i!==a.n;){const t=this.m_shape.getFirstVertex(i);if(t===a.n||i!==this.m_shape.getPathFromVertex(t)){const t=i;i=this.m_shape.getNextPath(i),this.m_shape.setFirstVertex(t,a.n),this.m_shape.removePathOnly(t);continue}let n=t,r=0;do{this.m_shape.setPathToVertex(n,i),r++,n=this.m_shape.getNextVertex(n)}while(n!==t);this.m_shape.setRingAreaValid(i,!1),this.m_shape.setLastVertex(i,this.m_shape.getPrevVertex(t)),this.m_shape.setPathSize(i,r),s+=r,e++,i=this.m_shape.getNextPath(i)}for(let r=0,o=this.m_verticesOnExtent.length;r<o;r++){let n=this.m_verticesOnExtent[r];if(n===a.n)continue;let o=this.m_shape.getPathFromVertex(n);if(o!==a.n)continue;o=this.m_shape.insertPath(this.m_geometry,a.n);let l=!1,h=0;const u=n;do{this.m_shape.setPathToVertex(n,o),h++,t&&h<=2&&(l||=this.isCurve(n)),n=this.m_shape.getNextVertex(n)}while(n!==u);if(l?0===h:h<=2){let t=this.m_shape.getUserIndex(u,this.m_verticesOnExtentIndex);(0,i.g)(t>=0),this.m_verticesOnExtent[t]=a.n;const e=this.m_shape.removeVertex(u,!1);2===h&&(t=this.m_shape.getUserIndex(e,this.m_verticesOnExtentIndex),t>=0&&(this.m_verticesOnExtent[t]=a.n),this.m_shape.removeVertex(e,!1));const s=o;o=this.m_shape.getNextPath(o),this.m_shape.setFirstVertex(s,a.n),this.m_shape.removePathOnly(s)}else this.m_shape.setClosedPath(o,!0),this.m_shape.setPathSize(o,h),this.m_shape.setFirstVertex(o,u),this.m_shape.setLastVertex(o,this.m_shape.getPrevVertex(u)),this.m_shape.setRingAreaValid(o,!1),s+=h,e++}this.m_shape.setGeometryPathCount(this.m_geometry,e),this.m_shape.setGeometryVertexCount(this.m_geometry,s);let n=0;for(let i=this.m_shape.getFirstGeometry();i!==a.n;i=this.m_shape.getNextGeometry(i))n+=this.m_shape.getPointCount(i);this.m_shape.setTotalPointCount(n)}dbgCheckPathFirst(){}isCurve(t){return null!==this.m_shape.getSegment(t)}compareVertices(t,e){const s=new l.P;this.m_shape.queryXY(t,s);const n=new l.P;return this.m_shape.queryXY(e,n),s.compare(n)}clipPolesOut(t,e){return this.clipPolygonOrProjectedPolyline2(t,e)}}class d{getOperatorType(){return 10004}supportsCurves(){return!0}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s,n){return new g(t,e,s,n)}execute(t,e,s,n){return function(t,e,s,n){return u(t,e,s,Number.NaN,0,n)}(t,e,s,n)}}class g extends n.G{constructor(t,e,s,n){super(),this.m_progressTracker=n,this.m_index=-1,t||(0,i.a)(""),this.m_envelope=e,this.m_inputGeometryCursor=t,this.m_spatialRefImpl=s,this.m_tolerance=(0,r.c)(s,e,!1).total()}next(){let t;return(t=this.m_inputGeometryCursor.next())?((0,i.c)(t),this.m_index=this.m_inputGeometryCursor.getGeometryID(),h(t,this.m_envelope,this.m_tolerance,0,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}},77536:(t,e,s)=>{s.d(e,{NonSimpleResult:()=>n});class n{assign(t){this.m_reason=t.m_reason,this.m_vertexIndex1=t.m_vertexIndex1,this.m_vertexIndex2=t.m_vertexIndex2}constructor(t,e,s){void 0!==t?(this.m_reason=t,this.m_vertexIndex1=e,this.m_vertexIndex2=s):(this.m_reason=0,this.m_vertexIndex1=-1,this.m_vertexIndex2=-2)}clear(){this.m_reason=0,this.m_vertexIndex1=-1,this.m_vertexIndex2=-1}}},1804:(t,e,s)=>{s.d(e,{O:()=>l});var n=s(50256),i=s(62188),r=s(74642),o=r.D;class a extends n.G{constructor(t,e,s,n,i,r){super(),this.m_densificator=new o(e,s,n,r,!1,i),this.m_index=-1,this.m_inputGeoms=t}tock(){return!0}getRank(){return 1}next(){let t=null;for(;t=this.m_inputGeoms.next();)return(0,i.c)(t),this.m_index=this.m_inputGeoms.getGeometryID(),this.densify(t);return null}getGeometryID(){return this.m_index}densify(t){return this.m_densificator.densify(t)}}class l{getOperatorType(){return 10202}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}supportsCurves(){return!0}executeMany(t,e,s,n,i,r=12e3){return new a(t,e,s,n,r,i)}execute(t,e,s,n,i,o=12e3){return(0,r.d)(t,e,s,n,i,o)}}},86330:(t,e,s)=>{s.d(e,{$:()=>Ae,A:()=>gt,B:()=>ye,C:()=>vt,D:()=>Se,E:()=>u,F:()=>Qt,G:()=>Kt,H:()=>m,I:()=>x,J:()=>y,K:()=>i,L:()=>Mt,M:()=>Le,N:()=>Ce,O:()=>Ee,P:()=>Ue,Q:()=>$t,R:()=>Ot,S:()=>kt,T:()=>De,U:()=>G,V:()=>dt,W:()=>Rt,X:()=>k,Y:()=>L,Z:()=>xt,_:()=>D,a:()=>z,a0:()=>Te,a1:()=>Fe,a2:()=>A,a3:()=>M,a4:()=>N,a5:()=>F,a6:()=>v,a7:()=>ze,a8:()=>bt,a9:()=>Me,aA:()=>Et,aB:()=>me,aC:()=>ee,aD:()=>Ie,aE:()=>w,aF:()=>ge,aG:()=>Be,aH:()=>qe,aI:()=>fe,aJ:()=>Ht,aK:()=>de,aa:()=>it,ab:()=>rt,ac:()=>It,ad:()=>b,ae:()=>P,af:()=>nt,ag:()=>Gt,ah:()=>Ve,ai:()=>Ge,aj:()=>mt,ak:()=>Re,al:()=>Pt,am:()=>X,an:()=>O,ao:()=>ut,ap:()=>q,aq:()=>Pe,ar:()=>ne,as:()=>_t,at:()=>ce,au:()=>pe,av:()=>Dt,aw:()=>At,ax:()=>T,ay:()=>ue,az:()=>Ye,b:()=>pt,c:()=>ft,d:()=>Ft,e:()=>B,f:()=>I,g:()=>be,h:()=>Ct,i:()=>se,j:()=>te,k:()=>Lt,l:()=>st,m:()=>Tt,n:()=>Nt,o:()=>zt,p:()=>Vt,q:()=>R,r:()=>Jt,s:()=>we,t:()=>Y,u:()=>St,v:()=>yt,w:()=>wt,x:()=>V,y:()=>S,z:()=>C});var n=s(62188);class i{constructor(t){this.sum=t,this.compensation=0}assign(t){return this.compensation=t.compensation,this.sum=t.sum,this}reset(){this.sum=this.compensation=0}resetToStart(t){this.sum=t,this.compensation=0}normalize(){const t=[Number.NaN];this.sum=et(this.sum,this.compensation,t),this.compensation=t[0]}add(t){const e=this.sum+t;let s;if(Math.abs(this.sum)>=Math.abs(t)){const n=this.sum-e+t;s=this.compensation+n}else{const n=t-e+this.sum;s=this.compensation+n}this.sum=e,this.compensation=s}sub(t){this.add(-t)}addProduct(t,e){const s=[0],n=K(t,e,s);this.add(n),this.add(s[0])}mul(t){const e=new i(0);e.addProduct(this.sum,t),e.addProduct(this.compensation,t),this.assign(e)}getResult(){return this.sum+this.compensation}pe(t){return this.add(t),this}me(t){return this.add(-t),this}}const r=[5,1,2,1,3,1,2,1,4,1,2,1,3,1,2,1],o=[-1,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3];function a(t){let e=0;return 65535n&t||(e+=16,t>>=16n),255n&t||(e+=8,t>>=8n),15n&t||(e+=4,t>>=4n),e+r[Number(BigInt.asUintN(4,t))]}function l(t){let e=0;return 4294967295n&t||(e=32,t>>=32n),e+a(BigInt.asUintN(32,t))}function h(t){let e=0;return 0xffffffff00000000n&t&&(e=32,t>>=32n),e+function(t){let e=0;return 4294901760n&t&&(e+=16,t>>=16n),65280n&t&&(e+=8,t>>=8n),240n&t&&(e+=4,t>>=4n),e+o[Number(BigInt.asUintN(4,t))]+1}(t)}class u{constructor(t,e){if(this.m_EnvelopeType=1,void 0!==t){if(t instanceof u)return this.vmin=t.vmin,void(this.vmax=t.vmax);this.vmin=t,this.vmax=e,this.normalize()}else this.setEmpty()}static construct(t,e){return new u(t,e)}static constructEmpty(){return new u}setCoords(t,e){this.vmin=t,this.vmax=e,this.normalize()}setCoordsFromEnvelope(t){this.vmin=t.vmin,this.vmax=t.vmax}setEmpty(){this.vmin=Number.NaN,this.vmax=Number.NaN}getCenter(){return.5*(this.vmin+this.vmax)}equalsRange(t,e){return $t(this.vmin,t)&&$t(this.vmax,e)}equals(t,e){return!(!this.isEmpty()||!t.isEmpty())||(void 0!==e?Math.abs(this.vmin-t.vmin)<=e&&Math.abs(this.vmax-t.vmax)<=e:this.vmin===t.vmin&&this.vmax===t.vmax)}width(){return this.vmax-this.vmin}isEmpty(){return Number.isNaN(this.vmin)||Number.isNaN(this.vmax)}isZero(){return this.vmin===this.vmax}setInfinite(){this.vmin=Number.NEGATIVE_INFINITY,this.vmax=Number.POSITIVE_INFINITY}move(t){this.isEmpty()||(this.vmin+=t,this.vmax+=t)}contains(t){return t.vmin>=this.vmin&&t.vmax<=this.vmax}containsCoordinate(t){return t>=this.vmin&&t<=this.vmax}containsRightExclusive(t){return t>=this.vmin&&t<this.vmax}containsExclusiveCoordinate(t){return t>this.vmin&&t<this.vmax}containsExclusive(t){return t.vmin>this.vmin&&t.vmax<this.vmax}isIntersecting(t){return this.vmin<=t.vmin?this.vmax>=t.vmin:t.vmax>=this.vmin}mergeCoordinate(t){if(this.isEmpty())return this.vmin=t,void(this.vmax=t);this.mergeNeCoordinate(t)}merge(t){if(t.isEmpty())return;const e=t.vmin,s=t.vmax;this.mergeCoordinate(e),this.mergeCoordinate(s)}mergeNe(t){const e=t.vmin,s=t.vmax;this.mergeNeCoordinate(e),this.mergeNeCoordinate(s)}mergeNeCoordinate(t){t<this.vmin?this.vmin=t:t>this.vmax&&(this.vmax=t)}intersect(t){this.isEmpty()||t.isEmpty()?this.setEmpty():(this.vmin<t.vmin&&(this.vmin=t.vmin),this.vmax>t.vmax&&(this.vmax=t.vmax),this.vmin>this.vmax&&this.setEmpty())}inflate(t){this.isEmpty()||(this.vmin-=t,this.vmax+=t,this.vmax<this.vmin&&this.setEmpty())}normalize(){this.vmin<=this.vmax||(this.vmin>this.vmax?this.vmax=ft(this.vmin,this.vmin=this.vmax):this.setEmpty())}isValid(){return this.isEmpty()||this.vmin<=this.vmax}snapClip(t){return we(t,this.vmin,this.vmax)}calculateToleranceFromEnvelope(){return this.isEmpty()?be():(Math.abs(this.vmin)+Math.abs(this.vmax)+1)*be()}static unit(){return c}normalizeNoNAN(){this.vmin>this.vmax&&(this.vmax=ft(this.vmin,this.vmin=this.vmax))}setCoordsNoNAN(t,e){this.vmin=t,this.vmax=e,this.normalizeNoNAN()}clone(){return new u(this.vmin,this.vmax)}}const c=new u(0,1);class m{static getNAN(){return new m(Number.NaN)}constructor(t,e){this.m_value=t??0,this.m_eps=e??0}[Symbol.toPrimitive](t){return this}clone(){return new m(this.m_value,this.m_eps)}assign(t){return this.m_value=t.m_value,this.m_eps=t.m_eps,this}scaleError(t){this.m_eps*=t}setError(t){this.m_eps=t}set(t,e){return this.m_value=t,this.m_eps=e??0,this}setWithEps(t,e){return void 0===e&&(e=1),this.m_value=t,this.m_eps=m.ulp(t)*e,this}setE(t){return this.m_value=t.m_value,this.m_eps=t.m_eps,this}precise(){return new m(this.m_value)}value(){return this.m_value}toDouble(){return this.m_value}eps(){return this.m_eps}resetError(){return this.m_eps=0,this}absThis(){return this.m_value=Math.abs(this.m_value),this}add(t){return this.clone().addThis(t)}addE(t){return this.clone().addThisE(t)}addThisE(t){const e=this.m_value+t.m_value,s=this.m_eps+t.m_eps+m.ulp(e);return this.m_value=e,this.m_eps=s,this}addThis(t){const e=this.m_value+t,s=this.m_eps+m.ulp(e);return this.m_value=e,this.m_eps=s,this}subE(t){return this.clone().subThisE(t)}sub(t){return this.clone().subThis(t)}subThisE(t){const e=this.m_value-t.m_value,s=this.m_eps+t.m_eps+m.ulp(e);return this.m_value=e,this.m_eps=s,this}subThis(t){const e=this.m_value-t,s=this.m_eps+m.ulp(e);return this.m_value=e,this.m_eps=s,this}setAddE(t,e){return this.m_value=t.m_value+e.m_value,this.m_eps=t.m_eps+e.m_eps+m.ulp(this.m_value),this}setAdd(t,e){return this.m_value=t+e,this.m_eps=m.ulp(this.m_value),this}setAddEN(t,e){return this.m_value=t.m_value+e,this.m_eps=t.m_eps+m.ulp(this.m_value),this}setAddNE(t,e){return this.m_value=t+e.m_value,this.m_eps=e.m_eps+m.ulp(this.m_value),this}setSubE(t,e){return this.m_value=t.m_value-e.m_value,this.m_eps=t.m_eps+e.m_eps+m.ulp(this.m_value),this}setSub(t,e){return this.m_value=t-e,this.m_eps=m.ulp(this.m_value),this}setSubEN(t,e){return this.m_value=t.m_value-e,this.m_eps=t.m_eps+m.ulp(this.m_value),this}setSubNE(t,e){return this.m_value=t-e.m_value,this.m_eps=e.m_eps+m.ulp(this.m_value),this}mulThisE(t){const e=this.m_value*t.m_value;return this.m_eps=this.m_eps*Math.abs(t.m_value)+t.m_eps*Math.abs(this.m_value)+this.m_eps*t.m_eps+m.ulp(e),this.m_value=e,this}mulThis(t){const e=this.m_value*t;return this.m_eps=this.m_eps*Math.abs(t)+m.ulp(e),this.m_value=e,this}mul(t){return this.clone().mulThis(t)}mulE(t){return this.clone().mulThisE(t)}setMulE(t,e){const s=t.m_value*e.m_value;return this.m_eps=t.m_eps*Math.abs(e.m_value)+e.m_eps*Math.abs(t.m_value)+t.m_eps*e.m_eps+m.ulp(s),this.m_value=s,this}setMul(t,e){return this.m_value=t*e,this.m_eps=m.ulp(this.m_value),this}setMulEN(t,e){return this.setE(t),this.mulThis(e)}setMulNE(t,e){return this.setE(e),this.mulThis(t)}mulThisByPower2(t){return this.m_value*=t,this.m_eps*=Math.abs(t),this}static st_mulByPower2(t,e){return new m(t.m_value,t.m_eps).mulThisByPower2(e)}divE(t){return this.clone().divThisE(t)}divThisE(t){const e=Math.abs(t.m_value),s=this.m_value/t.m_value;let n=(this.m_eps+Math.abs(s)*t.m_eps)/e;if(t.m_eps>.01*e){const s=t.m_eps/e;n*=1+(1+s)*s}return this.m_value=s,this.m_eps=n+m.ulp(s),this}divThis(t){const e=Math.abs(t);return this.m_value/=t,this.m_eps=this.m_eps/e+m.ulp(this.m_value),this}setDivE(t,e){return this.setE(t),this.divThisE(e)}setDiv(t,e){return this.m_value=t/e,this.m_eps=m.ulp(this.m_value),this}setDivEN(t,e){return this.setE(t),this.divThis(e)}setDivNE(t,e){return this.set(t),this.divThisE(e)}divThisByPower2(t){return this.m_value/=t,this.m_eps/=Math.abs(t),this}invThis(){return this.setE(x.clone().divThisE(this)),this}sqrt(){return this.clone().sqrtThis()}sqrtThis(){let t,e;return this.m_value>=0?(t=Math.sqrt(this.m_value),e=this.m_value>10*this.m_eps?.5*this.m_eps/t:this.m_value>this.m_eps?t-Math.sqrt(this.m_value-this.m_eps):Math.max(t,Math.sqrt(this.m_value+this.m_eps)-t),e+=m.ulp(t)):this.m_value<-this.m_eps?(t=Number.NaN,e=Number.NaN):(t=0,e=Math.sqrt(this.m_eps)),this.m_value=t,this.m_eps=e,this}sqr(){return this.clone().sqrThis()}sqrThis(){const t=this.m_value*this.m_value;return this.m_eps=2*this.m_eps*Math.abs(this.m_value)+this.m_eps*this.m_eps+m.ulp(t),this.m_value=t,this}setSin(t){const e=Math.sin(t.m_value),s=Math.cos(t.m_value);this.m_value=e;const n=Math.abs(e),i=Math.abs(t.value());return this.m_eps=(Math.abs(s)+.5*n*t.m_eps)*t.m_eps+m.ulp(n+i),this}static ulp(t){let e=Xt(t);const s=((0x7ff0000000000000n&e)>>52n)-1075n;return s>-1023n?(e=s+0x3ffn<<52n,function(t){return Yt[0]=t,Bt[0]}(e)):0===t?0:Number.MIN_VALUE}setCos(t){const e=Math.sin(t.m_value),s=Math.cos(t.m_value);this.m_value=s;const n=Math.abs(s),i=Math.abs(t.value());return this.m_eps=(Math.abs(e)+.5*n*t.m_eps)*t.m_eps+m.ulp(n+i),this}static st_cosAndSin(t,e,s){const n=Math.sin(t.m_value),i=Math.cos(t.m_value);s.m_value=n,e.m_value=i;const r=Math.abs(n),o=Math.abs(i),a=Math.abs(t.value());s.m_eps=(Math.abs(i)+.5*r*t.m_eps)*t.m_eps+m.ulp(r+a),e.m_eps=(Math.abs(n)+.5*o*t.m_eps)*t.m_eps+m.ulp(o+a)}negate(){return this.clone().negateThis()}negateThis(){return this.m_value=-this.m_value,this}setAbs(){return this.m_value=Math.abs(this.m_value),this}isInInterval(t){return u.construct(this.m_value-this.m_eps,this.m_value+this.m_eps).isIntersecting(t)}eq(t){return Math.abs(this.m_value-t.m_value)<=this.m_eps+t.m_eps}ne(t){return!this.eq(t)}gt(t){return this.m_value-t.m_value>this.m_eps+t.m_eps}lt(t){return t.m_value-this.m_value>this.m_eps+t.m_eps}ge(t){return!this.lt(t)}le(t){return!this.gt(t)}tolEQ(t,e){return Math.abs(this.m_value-t.m_value)<=e||this.eq(t)}tolNE(t,e){return!this.tolEQ(t,e)}tolGT(t,e){return this.m_value-t.m_value>e&&this.gt(t)}tolLT(t,e){return t.m_value-this.m_value>e&&this.lt(t)}tolGE(t,e){return!this.tolLT(t,e)}tolLE(t,e){return!this.tolGT(t,e)}isZero(){return Math.abs(this.m_value)<=this.m_eps}isFuzzyZero(){return this.isZero()&&0!==this.m_eps}tolIsZero(t){return Math.abs(this.m_value)<=Math.max(this.m_eps,t)}setPi(){this.setE(f)}setEuler(){this.set(2.718281828459045,_())}static size(){return 1}}function d(t,e){const s=jt(t),n=jt(e),i=53-l(s),r=53-l(n);return(i>=0?i:0)+(r>=0?r:0)<=52}function g(t,e){const s=t+e;return s-t===e&&s-e===t}function p(t,e){const s=t-e;return t-s===e&&e+s===t}function _(){return Ee()}m.dimensions=1;const f=new m(Math.PI,.5*_()),y=new m(0,0),x=new m(1,0),v=new m(4,0);function b(t,e,s){return t.addE(e.subE(t).mulE(s))}function P(t,e,s){return e.subE(e.subE(t).mulE(x.subE(s)))}function S(t){let e;if(0===t)e=1;else if(Math.abs(t)>.01)e=function(t){return Math.atanh(t)}(t)/t;else{let s;const n=-36.841361487904734;e=0;const i=t*t;for(let t=2*Math.trunc(n/Math.log(i)+2.5)-1;t>1;t-=2)s=1/t,e=(e+s)*i;e+=1}return e}function E(t){const e=Math.PI*Math.PI/6;let s;if(1===t)s=e;else if(t>1)s=e;else if(0===t)s=t;else if(t<0){const e=1+(t=Math.abs(t)),n=Math.log(e);s=n*n/-2-E(t/e)}else if(t>.5){const n=1-t,i=Math.log(t)*Math.log(n);s=e-E(n)-i}else{s=0;const e=1+Math.trunc(-16*Math.log(10)/Math.log(t)+1.5);let n=e;for(let i=e;i>0;i--,n-=1)s*=t,s+=1/(n*n);s*=t}return s}function C(t,e){const s=e*t;if(Math.abs(e)<.1){let e=0;for(let t=60;t>=1;t--)e*=s,e+=1/t/t;return e*=t,e}return E(s)/e}function w(t,e){return t<e?Lt(t,e):Lt(e,t)}function I(t,e){const s=Math.abs(t);return e>=0?s:-s}function T(t){return Math.round(t)}function A(t,e,s,n,i){i[0]=e[0]+(s[0]-e[0])*n,i[1]=e[1]+(s[1]-e[1])*n,3===t&&(i[2]=e[2]+(s[2]-e[2])*n)}function M(t,e,s,n,i){i[0]=s[0]-(s[0]-e[0])*(1-n),i[1]=s[1]-(s[1]-e[1])*(1-n),3===t&&(i[2]=s[2]-(s[2]-e[2])*(1-n))}function D(t,e,s,n,i){n<=.5?A(t,e,s,n,i):M(t,e,s,n,i)}function N(t,e,s,n,i){i[0]=e[0].addE(s[0].subE(e[0]).mulE(n)),i[1]=e[1].addE(s[1].subE(e[1]).mulE(n))}function F(t,e,s,n,i){i[0]=s[0].subE(s[0].subE(e[0]).mulE(x.subE(n))),i[1]=s[1].subE(s[1].subE(e[1]).mulE(x.subE(n)))}function R(t,e,s){let n;return n=s<=.5?t+(e-t)*s:e-(e-t)*(1-s),n}function k(t,e,s){return t+(e-t)*s}function L(t,e,s){return e-(e-t)*(1-s)}function G(t,e,s,n){s<=.5?(n.x=t.x+(e.x-t.x)*s,n.y=t.y+(e.y-t.y)*s):(n.x=e.x-(e.x-t.x)*(1-s),n.y=e.y-(e.y-t.y)*(1-s))}function V(t,e,s,n){s<=.5?(n.x=t.x+(e.x-t.x)*s,n.y=t.y+(e.y-t.y)*s,n.z=t.z+(e.z-t.z)*s):(n.x=e.x-(e.x-t.x)*(1-s),n.y=e.y-(e.y-t.y)*(1-s),n.z=e.z-(e.z-t.z)*(1-s))}function z(t){return t*t}function O(t){return t*t*t}function q(t){return 1/Math.sqrt(t)}function B(t){return t<0?-1:t>0?1:0}function Y(t,e,s,n){const i=[0],r=[0],o=[0];return et(K(t,s,i),K(e,n,r),o)+(i[0]+r[0]+o[0])}const U=[0],H=[0];function X(t,e,s){return function(t,e,s,n){const i=et(t,e,J),r=et(i,s,tt);return et(r,J[0]+tt[0],n)}(K(t,e,U),s,U[0],H)}const j=[0],Z=[0],W=[0],$=[0];function K(t,e,s){const n=t*e;return Q(t,j,Z),Q(e,W,$),s[0]=Z[0]*$[0]-(n-j[0]*W[0]-Z[0]*W[0]-j[0]*$[0]),n}function Q(t,e,s){const n=134217729*t;e[0]=n-(n-t),s[0]=t-e[0]}const J=[0],tt=[0];function et(t,e,s){const n=t+e;return Math.abs(t)>Math.abs(e)?s[0]=t-n+e:s[0]=e-n+t,n}function st(t,e){return t%e}function nt(t){const e=1-t;if(0===e)return 1;let s;if(e<=.01){const t=e,n=Math.log(t);s=1+t*(.4431471805599453-.25*n+t*(.05680519270997949-.09375*n+t*(.02183137044373718-.05859375*n+t*(.011544521417308362-.042724609375*n+t*(.00714200031339596-.0336456298828125*n+t*(.004854743337164948-.027757644653320312*n+t*(.003514687963781376-.023627042770385742*n)))))))}else{if(t<.016){const e=t,s=.25,n=.046875,i=.01953125,r=.01068115234375,o=.0067291259765625,a=.004626274108886719,l=.0033752918243408203,h=.0025710230693221092;return De()*(1-e*(s+e*(n+e*(i+e*(r+e*(o+e*(a+e*(l+e*h))))))))}s=ot(0,e,1)-t*at(0,e,1)/3}return we(s,1,De())}function it(t,e,s=Number.NaN){if((0,n.g)(e>=0&&e<=1),0===e)return t;let i=1,r=t;if(r<0&&(r=-r,i=-1),1===e){const t=Math.round(r/Ae()),e=r-t*Ae();return i*(2*t+Math.sin(e))}const o=De(),a=Math.floor(r/o);1&a?r=(a+1)*o-r:r-=a*o;const l=Math.sin(r),h=Number.isNaN(s)?nt(e):s;let u;if(1===l)u=h+Math.sqrt(1-e)*(r-o);else{const t=r*r;if(.01424*Math.pow(t,4)<=2*Ee())u=r*(1+t*e*(-1/6+t*((4-3*e)/120-(16+(45*e-60)*e)/5040*t)));else if(e<=.01){const t=Math.sin(2*r),s=Math.sin(4*r),n=Math.sin(6*r),i=Math.sin(8*r),o=Math.sin(10*r);u=r+e*((2*-r+t)/8+e*((-3*r+2*t-.25*s)/64+e*((-20*r+15*t-3*s+n/3)/1024+e*(5*(-140*r+112*t-28*s+16/3*n-.5*i)/65536+7*e*((-63*r+52.5*t-15*s+3.75*n-.625*i+.05*o)/65536+e*(-693*r+594*t-185.625*s+1.375*n-12.375*i+1.8*o-.125*Math.sin(12*r))/1048576)))))}else{const t=l*l,s=Math.cos(r),n=s*s,i=lt(l,s,e);u=l*(ot(n,i,1)-e*t*at(n,i,1)/3)}}return 1&a?u=h*(a+1)-u:u+=h*a,i*u}function rt(t,e,s=Number.NaN){if(0===t)return 0;let n=1,i=t;t<0&&(i=-i,n=-1);const r=Number.isNaN(s)?nt(e):s,o=Math.floor(i/r);1&o?i=(o+1)*r-i:i-=o*r;let a=i<=0?0:i>=r?De():function(t,e,s){if(0===e)return t;if(1===e)return Math.asin(t);let n=0,i=!0;if(t<.2){const s=t*t,r=t*(1+s*e*(1/6+s*((13*e-4)/120+(16-284*e+493*e*e)/5040*s))),o=Math.abs(e*(4944*e-64-31224*e*e+37369*e*e*e)/362880*Math.pow(t,9));if(o<Math.abs(r)*Ee())return r;n=r,i=o>.1*r}if(i){const i=1-e,r=1-t/s,o=Math.sqrt(r*r+i*i),a=Math.atan2(i,t+Ee());n=De()+Math.sqrt(o)*(a-De())}let r=0;for(let o=0;o<7;o++){r=it(n,e,s);const i=lt(Math.sin(n),Math.cos(n),e);if(n-=(r-t)/Math.sqrt(i),o>0&&Math.abs(r-t)<=4*Ee()*t)break}return n}(i,e,r);return 1&o?a=De()*(o+1)-a:a+=De()*o,n*a}function ot(t,e,s){(0,n.g)((0!==t?1:0)+(0!==e?1:0)+1>1);let i=t,r=e,o=s;for(;;){const t=Math.sqrt(i*r)+Math.sqrt(r*o)+Math.sqrt(o*i);i=.25*(i+t),r=.25*(r+t),o=.25*(o+t);const e=(i+r+o)/3,s=(e-i)/e,n=(e-r)/e,a=(e-o)/e;if(Math.abs(s)<=.0024&&Math.abs(n)<=.0024&&Math.abs(a)<=.0024){const t=s*n-a*a,i=s*n*a;return(1+(1/24*t-.1-3/44*i-5*t*t/208+t*i/16)*t+(1/14+3*i/104)*i)/Math.sqrt(e)}}}function at(t,e,s){(0,n.g)(0!==t||0!==e);let r=t,o=e,a=s;const l=new i(0);let h=1;for(;;){const t=.2*(r+o+3*a),e=(t-r)/t,s=(t-o)/t,n=(t-a)/t;if(Math.abs(e)<=.0015&&Math.abs(s)<=.0015&&Math.abs(n)<=.0015){const i=e*s,r=n*n,o=i-r,a=i-6*r,u=a+o+o,c=3/26,m=a*(9/22*.25*a-.21428571428571427-1.5*c*n*u),d=n*(1/6*u+n*(-.4090909090909091*o+n*c*i));return 3*l.getResult()+h*(1+m+d)/(t*Math.sqrt(t))}const i=Math.sqrt(r),u=Math.sqrt(o),c=Math.sqrt(a),m=i*(u+c)+u*c;l.add(h/(c*(a+m))),h*=.25,r=.25*(r+m),o=.25*(o+m),a=.25*(a+m)}}function lt(t,e,s){return t<.999?1-s*z(t):1-s+s*z(e)}const ht=new class{constructor(t){for(this.values=[[1]];this.values.length<t+1;){const t=this.values.at(-1),e=Ft(t.length+1,1);for(let s=1;s<t.length;++s)e[s]=t[s-1]+t[s];this.values.push(e)}}get(t,e){return this.values[t][e]}}(32);function ut(t,e){if(t<ht.values.length)return ht.get(t,e);const s=Math.exp(((0,n.g)(0),0));return s+.01>2147483647&&(0,n.q)("The result value of n choose k is out of range"),s+.01}function ct(t,e){if(t.isZero())return t.clone();const s=t.clone().divThis(t);if(e<0)return s.divThis(ct(t,-e));for(t=t.clone(),e=Math.trunc(e);1&e&&s.mulThis(t),e>>=1;)t.mulThis(t);return s}function mt(t,e){if(0===e)return[];const s=t[0].clone().mulDoubleThis(0),n=[];n.length=e;const i=e-1;for(let r=0;r<=i;++r){n[r]=s.clone();for(let e=0;e<=r;++e)n[r].addThis(t[e].clone().mulDoubleThis(ut(r,e)/ut(i,e)))}return n}function dt(t,e,s,i,r){return 0===t?0===i?e:1===i?s:r:1===t?0===i?e:1===i?s:R(e,s,i):(2===t&&(0,n.t)("angular interpolation"),void(0,n.t)(""))}function gt(t,e,s,i,r,o,a,l){if(0===t)for(let n=0;n<o;++n)i[n+r]=0===a?e[n]:1===a?s[n]:l;else if(1===t)if(0===a)pt(i,e,r,0,o);else if(1===a)pt(i,s,r,0,o);else for(let n=0;n<o;++n)i[n+r]=R(e[n],s[n],a);else if(2===t)if(0===a)pt(i,e,r,0,o);else if(1===a)pt(i,s,r,0,o);else{let t=0;for(let n=0,l=r;n<o;++n,++l)i[l]=R(e[n],s[n],a),t+=i[l]*i[l];if(t>0){t=Math.sqrt(t);for(let e=r;e<r+o;++e)i[e]/=t}else{for(let t=r;t<r+o;++t)i[t]=0;i[r]=1}}else(0,n.t)("")}function pt(t,e,s,n,i){if(0===i)return;let r=0,o=s,a=n;for(;r++<i;)t[o++]=e[a++]}function _t(t,e,s){let n=0;for(let i=0;!n&&i<s;++i)n=t[i]-e[i];return n}function ft(t,e){return t}function yt(t){t.sort(((t,e)=>t<e?-1:t>e?1:0))}function xt(t,e){const s=t.slice(0,e);yt(s),pt(t,s,0,0,e)}function vt(t,e,s,n){const i=t.slice(e,e+s);i.sort(n),pt(t,i,e,0,s)}function bt(t,e){return t<e?-1:t>e?1:0}function Pt(t,e,s,n){return t<s?-1:t>s?1:e<n?-1:e>n?1:0}function St(t,e){if(t.length<2)return t.length;let s=0;for(let n=1;n<t.length;++n)e(t[n],t[s])||(s++,t[n]=ft(t[s],t[s]=t[n]));return 1+s}function Et(t,e){t[e]=t.at(-1),t.pop()}function Ct(t,e=!1){return{[Symbol.dispose](){this.bForget||t()},bForget:e}}function wt(t,e,s){t.length=e,t.fill(s)}function It(t,e,s){t.length=s;for(let n=0;n<s;++n)t[n]=new e}function Tt(t,e){const s=new Array(e);for(let n=0;n<e;++n)s[n]=new t;return s}function At(t,e,s){for(let n=0;n<s;++n)t[n].assign(e[n]);return s}function Mt(t,e){const s=t.slice(0,e);for(let n=0;n<e;++n)s[n]=s[n].clone();return s}function Dt(t){return Array.from({length:t},(()=>null))}function Nt(t,e){return Array.from({length:e},(()=>t()))}function Ft(t,e){const s=new Array(t);return s.fill(e),s}function Rt(t,e){return e in t&&1===Object.getOwnPropertyNames(t).length}class kt{constructor(...t){this.m_elts=t}get length(){return this.m_elts.length}at(t){return this.m_elts[t]}[Symbol.dispose](){for(const t of this.m_elts)t[Symbol.dispose]()}}function Lt(t,e){return{first:t,second:e}}const Gt=Math.PI,Vt=2*Math.PI,zt=.5*Math.PI;class Ot{constructor(t,e){this.m_cr=t,this.m_cc=e,this.m_v=Ft(t*e,0)}get(t,e){return this.m_v[t*this.m_cc+e]}set(t,e,s){this.m_v[t*this.m_cc+e]=s}inc(t,e){return++this.m_v[t*this.m_cc+e]}}const qt=new ArrayBuffer(8),Bt=new Float64Array(qt),Yt=new BigUint64Array(qt),Ut=0x0fffffffffffffn;function Ht(){return Number.EPSILON*ve}function Xt(t){return Bt[0]=t,Yt[0]}function jt(t){return Xt(t)&Ut}function Zt(t){return Number((9218868437227405312n&Xt(t))>>52n)}function Wt(t){if(0n===t)return-1n;if(1n===t||-1n===t)return 0n;t<0n&&(t=-t);let e=0n,s=512n,n=1n<<e+s;for(;t>=n;)e+=s,s<<=1n,n<<=s;let i=e;s>>=1n;let r=i+s;for(;s>0n;)t<1n<<r||(i=r),s>>=1n,r=i+s;return i}function $t(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Kt(t,e,s){return t===e||Math.abs(t-e)<=s||Number.isNaN(t)&&Number.isNaN(e)}function Qt(t,e){return t<e?-1:t>e?1:0}function Jt(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;{const s=Number.isNaN(t),n=Number.isNaN(e);return s<n?-1:s>n?1:0}}function te(){return 2147483647}function ee(){return 32767}function se(){return 2147483647}function ne(){return-2147483648}const ie=2147483647,re=BigInt(ie),oe=2166136261,ae=16777619;const le=14695981039346656037n,he=1099511628211n;function ue(t){let e=oe;for(let s=0,n=t.length;s<n;++s)e=(e^t.charCodeAt(s))*ae;return e&ie}function ce(t,e){return e+2654435769+(t<<6)+(t>>2)&ie}function me(t,e){return ce(t,_e(e))}function de(t){return ce(3735928559,t)}function ge(t,e){return ce(t,de(e))}function pe(t){return function(t){let e=oe,s=t;return e=(e^255&s)*ae,s>>=8,e=(e^255&s)*ae,s>>=8,e=(e^255&s)*ae,s>>=8,e=(e^255&s)*ae,e&ie}(t)}function _e(t){return Number(function(t){let e=le,s=t;return e=(e^0xffn&s)*he,s>>=8n,e=(e^0xffn&s)*he,s>>=8n,e=(e^0xffn&s)*he,s>>=8n,e=(e^0xffn&s)*he,s>>=8n,e=(e^0xffn&s)*he,s>>=8n,e=(e^0xffn&s)*he,s>>=8n,e=(e^0xffn&s)*he,e&re}(t))}function fe(t){return _e(Xt(function(t){return Re(t)}(t)))}function ye(t){return function(t){return 1103515245*t+12345&2147483647}(t)}const xe=100,ve=100;function be(){return Number.EPSILON*xe}function Pe(){return.38196601125010515}function Se(){return 1.4142135623730951}function Ee(){return Number.EPSILON}function Ce(t,e,s){return t===e||t===s}function we(t,e,s){return t>=e?t<=s?t:s:e}function Ie(t,e,s){const n=t[0];if(n>=e){if(n<=s)return!1;t[0]=s}else t[0]=e;return!0}function Te(t,e){return t>=e?e:t<-e?-e:t}function Ae(){return Gt}function Me(){return Vt}function De(){return zt}const Ne=3*De();function Fe(){return Ne}function Re(t){return t+0}function ke(t){return{v:t}}class Le{constructor(){this.m_rn=ke(0n),this.m_rd=ke(1n),this.m_bNaN=!1,this.m_bNormalized=!1,this.m_power=0,this.m_sign=0}static constructAssign(t,e){const s=t.clone();return void 0!==e&&s.limitPrecisionThis(e),s}static constructDouble(t){return(new Le).setDouble(t)}static constructInt64(t){return(new Le).setInt64(t)}static constructRational(t,e){return(new Le).setRational(t,e)}static constructInt32(t){return this.constructInt64(BigInt(Math.trunc(t)))}[Symbol.toPrimitive](t){return this}compare(t){return this.lt(t)?-1:this.gt(t)?1:0}assignCopy(t){return this.setThis(t)}abs(){return this.clone().absThis()}absThis(){return this.isNAN()||(this.m_sign*=this.m_sign),this}clone(){return(new Le).setThis(this)}setThis(t){return this.m_bNaN=t.m_bNaN,this.m_bNormalized=t.m_bNormalized,this.m_rn.v=t.m_rn.v,this.m_rd.v=t.m_rd.v,this.m_power=t.m_power,this.m_sign=t.m_sign,this}setZero(){return this.m_rn.v=0n,this.m_rd.v=1n,this.m_bNaN=!1,this.m_power=0,this.m_bNormalized=!0,this.m_sign=0,this}setDouble(t){if(this.setZero(),0===t)return this;if(Number.isInteger(t)&&Math.abs(t)<2147483647)return this.setInt32(t);const e=Xt(t),s=(e&Le.s_em)>>52n,i=!!(e&Le.s_sm),r=e&Le.s_fm;if(s===Le.s_emax)return r?(this.m_rn.v=this.m_rd.v=0n,this.m_bNaN=!0,this):(this.m_rn.v=i?-1n:1n,this.m_rd.v=0n,this);0n===s&&(0,n.t)("denormalized numbers not yet implemented");const o=s-1023n,a=o>=0n?o:0n,l=o<0n?-o:0n;return this.m_rn.v=(1n<<52n|r)<<a,this.m_rd.v=1n<<52n+l,this.m_sign=i?-1:1,this.m_bNormalized=!1,this.normalizeThis()}setInt64(t){return 0n===t?this.setZero():(this.m_bNaN=!1,this.m_sign=t>0n?1:-1,this.m_rn.v=t>0n?t:-t,this.m_rd.v=1n,this.m_power=0,this.m_bNormalized=!1,this.normalizeThis())}setRational(t,e){return 0n===t?0n===e?this.setNAN():this.setZero():0n===e?t>0n?this.setPositiveInf():this.setNegativeInf():(this.m_sign=(t>0n?1:-1)*(e>0n?1:-1),this.m_rn.v=t>0n?t:-t,this.m_rd.v=e>0n?e:-e,this.m_power=0,this.m_bNormalized=!1,this.normalizeThis())}setInt32(t){return this.setInt64(BigInt(Math.trunc(t)))}getDouble(){return this.convertToDouble()}toDouble(){return this.convertToDouble()}value(){return this.convertToDouble()}isNAN(){return this.m_bNaN}isPositiveInf(){return!this.isNAN()&&0n===this.m_rd.v&&1===this.m_sign}isNegativeInf(){return!this.isNAN()&&0n===this.m_rd.v&&-1===this.m_sign}isFinite(){return!this.isNAN()&&0n!==this.m_rd.v}setNAN(){return this.m_bNaN=!0,this.m_rn.v=0n,this.m_rd.v=0n,this.m_power=0,this.m_bNormalized=!0,this}setPositiveInf(){return this.m_rn.v=1n,this.m_rd.v=0n,this.m_bNaN=!1,this.m_bNormalized=!0,this.m_sign=1,this.m_power=0,this}setNegativeInf(){return this.m_rn.v=1n,this.m_rd.v=0n,this.m_bNaN=!1,this.m_bNormalized=!0,this.m_sign=-1,this.m_power=0,this}subThis(t){if(t.isNAN()&&this.setNAN(),this.isPositiveInf()&&t.isPositiveInf())this.setNAN();else{if(this.isPositiveInf()&&t.isNegativeInf())return this.setPositiveInf(),this;if(this.isNegativeInf()&&t.isNegativeInf())this.setNAN();else if(this.isNegativeInf()&&t.isPositiveInf())return this.setNegativeInf(),this}return this.isNAN()?this:this.opPlusMinus(t,!1)}thisSubAbs(t){return(0,n.g)(0),this}mulThis(t){return t.isNAN()&&this.setNAN(),this.isNAN()?this:(this.m_sign*=t.m_sign,0===this.m_sign?this.setZero():(this.m_rn.v*=t.m_rn.v,this.m_rd.v*=t.m_rd.v,this.m_power+=t.m_power,this.m_bNormalized=!1,this.normalizeThis(),this))}mulDoubleThis(t){return this.mulThis(Le.constructDouble(t))}thisMulInt64(t){return(0,n.g)(0),this}thisMulInt32(t){return(0,n.g)(0),this}divThis(t){return this.mulThis(t.clone().invertThis())}divDoubleThis(t){return this.divThis(Le.constructDouble(t))}addDoubleThis(t){return this.addThis(Le.constructDouble(t))}subDoubleThis(t){return this.subThis(Le.constructDouble(t))}mul(t){return this.clone().mulThis(t)}mulBigIntThis(t){return this.mulThis(Le.constructInt64(t))}mulDouble(t){return this.clone().mulThis(Le.constructDouble(t))}div(t){return this.clone().divThis(t)}divDouble(t){return this.clone().divDoubleThis(t)}add(t){return this.clone().addThis(t)}fmSubThis(t,e){return this.subThis(t.clone().mulThis(e))}fmAddThis(t,e){return this.addThis(t.clone().mulThis(e))}addThis(t){if(t.isNAN()&&this.setNAN(),this.isPositiveInf()&&t.isPositiveInf())return this.setPositiveInf(),this;if(this.isPositiveInf()&&t.isNegativeInf())this.setNAN();else{if(this.isNegativeInf()&&t.isNegativeInf())return this.setNegativeInf(),this;this.isNegativeInf()&&t.isPositiveInf()&&this.setNAN()}return this.isNAN()?this:this.opPlusMinus(t,!0)}addDouble(t){return this.clone().addThis(Le.constructDouble(t))}sub(t){return this.clone().subThis(t)}subDouble(t){return this.clone().subThis(Le.constructDouble(t))}isZero(){return 0===this.m_sign}equals(t){return this.clone().subThis(t).isZero()}lt(t){return!this.isNAN()&&!t.isNAN()&&!(this.isPositiveInf()&&t.isPositiveInf()||this.isNegativeInf()&&t.isNegativeInf())&&!this.isPositiveInf()&&(!!t.isPositiveInf()||this.clone().sub(t).LZ())}absLessAbs(t){return this.abs().lt(t.abs())}gt(t){return this.clone().sub(t).GZ()}lte(t){return this.sub(t).LEZ()}gte(t){return this.sub(t).GEZ()}normalizeThis(){if(this.m_bNormalized)return this;if(0n===this.m_rn.v)return this.setZero();let t=0,e=0xffffffffn;for(;0n===(this.m_rn.v&e)&&e<=this.m_rn.v;)e<<=32n,t+=32;e&=this.m_rn.v,e>>=BigInt(t),t+=a(BigInt.asUintN(32,e))-1;let s=0;for(e=0xffffffffn;0n===(this.m_rd.v&e)&&e<=this.m_rd.v;)e<<=32n,s+=32;return e&=this.m_rd.v,e>>=BigInt(s),s+=a(BigInt.asUintN(32,e))-1,this.m_rn.v>>=BigInt(t),this.m_rd.v>>=BigInt(s),this.m_power+=t-s,this.m_rn.v>1n&&this.m_rd.v>1n&&(this.m_rn.v%this.m_rd.v===0n?(this.m_rn.v/=this.m_rd.v,this.m_rd.v=1n):this.m_rd.v%this.m_rn.v===0n&&(this.m_rd.v/=this.m_rn.v,this.m_rn.v=1n)),this.m_bNormalized=!0,this}negateThis(){return this.isNAN()||(this.m_sign*=-1),this}negate(){return this.clone().negateThis()}invertThis(){return this.isNAN()?this:this.isPositiveInf()||this.isNegativeInf()?(this.setZero(),this):0n===this.m_rn.v?(this.setPositiveInf(),this):(this.m_rd=ft(this.m_rn,this.m_rn=this.m_rd),this.m_power=-this.m_power,this)}limitPrecisionThis(t){if(0===t)return this;if(this.isZero())return this.setZero();if(!this.isFinite())return this;this.normalizeThis();let e=Number(Wt(this.m_rn.v));if(e>t){const s=e-t;this.m_rn.v>>=BigInt(e-t),this.m_power+=s}if(e=Number(Wt(this.m_rd.v)),e>t){const s=e-t;this.m_rd.v>>=BigInt(e-t),this.m_power-=s}return this}hiBitIndex(){return Math.max(Number(Wt(this.m_rn.v)),Number(Wt(this.m_rd.v)))}ldexp(t){return this.clone().ldexpThis(t)}ldexpThis(t){return t&&(this.m_bNormalized=!1,this.m_power+=t,this.normalizeThis()),this}static lerp(t,e,s){return Le.lerpLo(e,e,s)}static lerpLo(t,e,s){return e.sub(t).mulThis(s).addThis(t)}static lerpHi(t,e,s){return e.sub(t).mulThis(Ge.sub(s)).addThis(t)}LZ(){return!this.isNAN()&&-1===this.m_sign}GZ(){return!this.isNAN()&&1===this.m_sign}LEZ(){return!this.isNAN()&&this.m_sign<=0}GEZ(){return!this.isNAN()&&this.m_sign>=0}toString(){return this.toDouble().toString()}sqr(){return this.clone().sqrThis()}sqrThis(){return this.mulThis(this.clone())}static sqrt(t,e){if(t.m_sign<0n&&(0,n.q)("MP_value: sqrt(-1)"),t.isZero())return t.clone();let s=52,i=2220446049250313e-31;for(;s<e;)2*s<=e?(i*=i,s*=2):(i*=2220446049250313e-31,s+=52);s+=52;const r=Wt(t.m_rn.v),o=Wt(t.m_rd.v);let a,l=t.m_power+Number(r-o);const h=new Le;Math.abs(l)>200?(1&Math.abs(l)&&(l+=1),a=Le.constructAssign(t,53).ldexpThis(-l).value(),h.setThis(t).ldexpThis(-l),(0,n.g)(Number.isFinite(a))):(h.setThis(t),a=h.value(),(0,n.g)(Number.isFinite(a)),l=0),a=Math.sqrt(a);const u=Le.constructDouble(a),c=Le.constructDouble(i);c.mulThis(u).ldexpThis(1);const m=i*a*2,d=u.clone(),g=new Le;let p;for(let n=0;n<10;++n){d.mulThis(u),g.setThis(h).subThis(d).absThis();let t=g.value();if(p=1,t<.9)for(;t>m;)t*=t,++p;else p=4;if(g.lte(c))break;for(let e=0;e<p;e++)d.setThis(u).divThis(h).invertThis().addThis(u).ldexpThis(-1).limitPrecisionThis(s),u.setThis(d)}return u.ldexpThis(l/2)}static cubicRoot(t,e){if(t.isZero())return t.clone();let s=52,n=2220446049250313e-31;for(;s<e;)2*s<=e?(n*=n,s*=2):(n*=2220446049250313e-31,s+=52);s+=52;const i=Math.pow(Math.abs(t.value()),1/3),r=Le.constructDouble(i),o=r.clone();o.sqrThis().mulDoubleThis(3).mulDoubleThis(n),o.limitPrecisionThis(32),t.LZ()&&r.negateThis();for(let a=0;a<10;++a){const e=r.clone();e.sqrThis().mulThis(r);const n=e.clone();if(n.subThis(t),n.absThis().limitPrecisionThis(32),n.lte(o))break;n.setThis(t),n.ldexpThis(1),n.addThis(e);const i=e.clone();i.ldexpThis(1),i.addThis(t),n.divThis(i),r.mulThis(n),r.limitPrecisionThis(s)}return r}isInTheRangeOfDouble(){return(0,n.g)(0),!1}sign(){return this.m_sign}cosAndSin(t,e){(0,n.g)(0)}pow(t){return ct(this,t)}static nan(){return(0,n.g)(0),new Le}convertToDouble(){if(this.m_bNaN)return Number.NaN;if(this.isZero())return 0;if(0n===this.m_rd.v)return 1===this.m_sign?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;const t=-1===this.m_sign,e=this.m_rn.v<<(this.m_power>=0?BigInt(this.m_power):0n);let s=this.m_rd.v<<(this.m_power<0?BigInt(-this.m_power):0n);const n=e/s;let i=Number(n);if(BigInt(i)!==n)return t?-i:i;let r=e-n*s;if(r){let t=Wt(s)-1023n;t>0n&&(s>>=t,r<<=52n,r>>=t);let e=Number(r);Number.isFinite(e)||(r>>=52n,e=Number(r),t=0n),t>0n&&(e/=Math.pow(2,52)),i+=e/Number(s)}return t?-i:i}signVal(){return 1===this.m_sign?1n:-1===this.m_sign?-1n:0n}opPlusMinus(t,e){const s=Math.min(this.m_power,t.m_power);let n,i;this.m_power>s?(n=BigInt(this.m_power-s),i=0n):(n=0n,i=BigInt(t.m_power-s));const r=this.signVal()*this.m_rn.v*t.m_rd.v<<n,o=t.signVal()*t.m_rn.v*this.m_rd.v<<i;return this.m_rn.v=e?r+o:r-o,this.m_rd.v*=t.m_rd.v,this.m_power=s,this.m_sign=1,this.m_rn.v<0n&&(this.m_sign=-1,this.m_rn.v=-this.m_rn.v),this.m_bNormalized=!1,this.normalizeThis(),this}}Le.s_sm=0x8000000000000000n,Le.s_em=0x7ff0000000000000n,Le.s_fm=0x000fffffffffffffn,Le.s_emax=0x7ffn;const Ge=Le.constructInt32(1),Ve=Le.constructInt32(0),ze=Le.constructDouble(.5);function Oe(t,e){let s=Zt(t);const n=Zt(e);return s===n?(s-=53-function(t,e){return h(t^e)}(jt(t),jt(e)),s):s>n?s:n}function qe(t,e){for(let s=0,n=0,i=t.length;s<i;s+=2,n++)e[n].x=t[s],e[n].y=t[s+1]}function Be(t){const e=new Float64Array(2*t.length);for(let s=0,n=t.length;s<n;++s){const n=s<<1;e[n]=t[s].x,e[n+1]=t[s].y}return e}function Ye(t){const e=Tt(Ue,t.length);for(let s=0,n=t.length;s<n;++s)e[s].setCoords(t[s][0],t[s][1]);return e}class Ue{static construct(t,e){return new Ue(t,e)}constructor(t,e){void 0!==t?(this.x=t,this.y=e):this.x=this.y=Number.NaN}clone(){return new Ue(this.x,this.y)}assign(t){this.setCoordsPoint2D(t)}setCoords(t,e){return this.x=t,this.y=e,this}setCoordsPoint2D(t){this.x=t.x,this.y=t.y}isEqualPoint2D(t,e){return void 0!==e?Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e:this.x===t.x&&this.y===t.y}isEqual(t,e,s){return void 0!==s?Math.abs(this.x-t)<=s&&Math.abs(this.y-e)<=s:this.x===t&&this.y===e}equalsPoint2D(t,e){return this.isEqualPoint2D(t,e)}setSub(t,e){this.x=t.x-e.x,this.y=t.y-e.y}addThis(t){return this.x+=t.x,this.y+=t.y,this}setAdd(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}absoluteOther(t){}absolute(){return(0,n.g)(0),this}setNegate(){this.x=-this.x,this.y=-this.y}setNegateOther(t){this.x=-t.x,this.y=-t.y}interpolateThis(t,e){}interpolate(t,e,s){(0,n.g)(0)}scaleAddThis(t,e){this.x=this.x*t+e.x,this.y=this.y*t+e.y}setScaleAdd(t,e,s){this.x=e.x*t+s.x,this.y=e.y*t+s.y}scaleOther(t,e){(0,n.g)(0)}scale(t){this.x*=t,this.y*=t}compare(t){return this.y<t.y?-1:this.y>t.y?1:this.x<t.x?-1:this.x>t.x?1:0}compareX(t){return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0}normalizeOther(t){(0,n.g)(0)}normalize(){const t=this.length();return t?(this.x/=t,this.y/=t):(this.x=1,this.y=0),this}getUnitVector(){return this.clone().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}sqrLength(){return this.x*this.x+this.y*this.y}static averageFast(t,e){return(0,n.g)(0),{}}static average(t,e){const s=new Ue;if(0===e)return s.setNAN(),s;if(1===e)return s.assign(t[0]),s;const n=new i(t[0].x),r=new i(t[0].y);for(let i=1;i<e;i++)n.add(t[i].x),r.add(t[i].y),255&i||(n.normalize(),r.normalize());return s.x=n.getResult()/e,s.y=r.getResult()/e,s}static calculateLength(t,e){const s=new i(0);for(let n=1;n<e;n++)s.add(Ue.distance(t[n],t[n-1]));return s.getResult()}offset(t,e){const s=Ue.distance(t,e),n=Ue.construct(this.x,this.y);if(0===s)return Ue.distance(n,t);const i=e.clone();return i.subThis(t),n.subThis(t),n.crossProduct(i)/s}side(t,e){return t.equals(e)?this.equals(t)?0:1:Ue.orientationRobust(e,t,this)}static sqrDistance(t,e){const s=t.x-e.x,n=t.y-e.y;return s*s+n*n}static sqrDistanceCoords(t,e,s,n){const i=s-t,r=n-e;return i*i+r*r}static distance(t,e){return Math.sqrt(Ue.sqrDistance(t,e))}dotProduct(t){return this.x*t.x+this.y*t.y}dotProductAbs(t){return Math.abs(this.x*t.x)+Math.abs(this.y*t.y)}crossProduct(t){return this.x*t.y-this.y*t.x}crossProductAbs(t){return(0,n.g)(0),0}rotateDirect(t,e){const s=this.x*t-this.y*e,n=this.x*e+this.y*t;this.x=s,this.y=n}rotateReverse(t,e){const s=this.x*t+this.y*e,n=-this.x*e+this.y*t;this.x=s,this.y=n}leftPerpendicularThis(){const t=this.x;this.x=-this.y,this.y=t}leftPerpendicularOther(t){const e=t.x;this.x=-t.y,this.y=e}rightPerpendicularThis(){const t=this.x;this.x=this.y,this.y=-t}rightPerpendicularOther(t){const e=t.x;this.x=t.y,this.y=-e}equals(t){return this.x===t.x&&this.y===t.y}notequals(t){return this.x!==t.x||this.y!==t.y}not(){return!this.x&&!this.y}gt(t){return this.y>t.y||this.y===t.y&&this.x>t.x}gte(t){return!this.lt(t)}lt(t){return this.y<t.y||this.y===t.y&&this.x<t.x}lte(t){return!this.gt(t)}subThis(t){return this.x-=t.x,this.y-=t.y,this}divThis(t){return this.x/=t,this.y/=t,this}add(t){return new Ue(this.x+t.x,this.y+t.y)}sub(t){return new Ue(this.x-t.x,this.y-t.y)}negateThis(){return this.x=-this.x,this.y=-this.y,this}negate(){return new Ue(-this.x,-this.y)}mul(t){return new Ue(this.x*t,this.y*t)}mulThis(t){return this.x*=t,this.y*=t,this}divide(t){return new Ue(this.x/t,this.y/t)}setNAN(){this.x=this.y=Number.NaN}isNAN(){return Number.isNaN(this.x)||Number.isNaN(this.y)}static getNAN(){return new Ue(Number.NaN,Number.NaN)}isFinite(){return Number.isFinite(this.x)&&Number.isFinite(this.y)}isZero(){return 0===this.x&&0===this.y}norm(t){switch(t){case 0:{const t=Math.abs(this.x),e=Math.abs(this.y),s=t-e;return s>=0?t:s<=0?e:Number.NaN}case 1:return Math.abs(this.x)+Math.abs(this.y);case 2:return Math.sqrt(this.x*this.x+this.y*this.y);default:(0,n.a)("norm")}}getQuarter(){return Ue.getQuarterCoords(this.x,this.y)}static getQuarterCoords(t,e){return t>0?e>=0?1:4:e>0?2:0===t?4:3}static compareVectors(t,e){const s=t.getQuarter(),n=e.getQuarter();return n===s?Ue.orientationRobustImpl(Ue.construct(0,0),e,t,!0):s<n?-1:1}static compareVectorsOrigin(t,e,s){const n=e.sub(t),i=s.sub(t),r=n.getQuarter(),o=i.getQuarter();return o===r?Ue.orientationRobustImpl(t,s,e,!0):r<o?-1:1}static orientationRobust(t,e,s){return Ue.orientationRobustImpl(t,e,s,!1)}static orientationRobustEx(t,e,s,n){if(t.equals(e)||s.equals(n))return 0;const i=e.x-t.x,r=e.y-t.y,o=n.x-s.x,a=n.y-s.y;{const t=Ue.getQuarterCoords(i,r)-1,e=Ue.getQuarterCoords(o,a)-1,s=Ue.d[t][e];if(0!==s)return s}const l=i*a,h=r*o,u=4*Ee()*(Math.abs(l)+Math.abs(h)),c=l-h;return Math.abs(c)>=u?c<0?-1:c>0?1:0:Ue.orientationRobustExMp(t,e,s,n)}static orientationRobustExMp(t,e,s,n){const i=Le.constructDouble(e.x),r=Le.constructDouble(n.x);i.subThis(Le.constructDouble(t.x)),r.subThis(Le.constructDouble(s.x));const o=Le.constructDouble(e.y),a=Le.constructDouble(n.y);return o.subThis(Le.constructDouble(t.y)),a.subThis(Le.constructDouble(s.y)),i.mulThis(a),o.mulThis(r),i.subThis(o),i.LZ()?-1:i.GZ()?1:0}static orientationNonRobust(t,e,s){const n=e.sub(t).crossProduct(s.sub(t));return n<0?-1:n>0?1:0}static orientationRobustImpl(t,e,s,n){if(e.isEqualPoint2D(t)||s.isEqualPoint2D(t)||e.isEqualPoint2D(s))return 0;const i=e.x-t.x,r=e.y-t.y,o=s.x-t.x,a=s.y-t.y;if(!n){const t=Ue.getQuarterCoords(i,r)-1,e=Ue.getQuarterCoords(o,a)-1,s=Ue.d[t][e];if(0!==s)return s}const l=(Math.abs(i)+Math.abs(r)+Math.abs(o)+Math.abs(a))*(Math.abs(e.x)+Math.abs(e.y)+Math.abs(s.x)+Math.abs(s.y))*8*_(),h=i*a-r*o;if(Math.abs(h)>l)return h<0?-1:1;if(p(e.x,t.x)&&p(s.y,t.y)&&p(e.y,t.y)&&p(s.x,t.x)&&d(i,a)&&d(r,o)){const t=i*a,e=r*o;if(p(t,e)){const s=t-e;return s<0?-1:s>0?1:0}}return Ue.orientationRobustMp(t,e,s)}static orientationRobustMp(t,e,s){const n=Le.constructDouble(e.x),i=Le.constructDouble(s.x);{const e=Le.constructDouble(t.x);n.subThis(e),i.subThis(e)}const r=Le.constructDouble(s.y),o=Le.constructDouble(e.y);{const e=Le.constructDouble(t.y);r.subThis(e),o.subThis(e)}return n.mulThis(r),o.mulThis(i),n.subThis(o),n.LZ()?-1:n.GZ()?1:0}static inCircleRobust(t,e,s,n){const i=new m,r=new m;i.set(t.x),i.subThis(n.x),r.set(t.y),r.subThis(n.y);const o=new m,a=new m;o.set(e.x),o.subThis(n.x),a.set(e.y),a.subThis(n.y);const l=new m,h=new m;l.set(s.x),l.subThis(n.x),h.set(s.y),h.subThis(n.y);const u=i.mulE(a).subE(r.mulE(o)),c=o.mulE(h).subE(a.mulE(l)),d=i.mulE(h).subE(r.mulE(l)),g=i.mulE(i).addE(r.mulE(r)),p=o.mulE(o).addE(a.mulE(a)),_=l.mulE(l).addE(h.mulE(h)),f=g.mulE(c).subE(p.mulE(d)).addE(_.mulE(u));if(!f.isFuzzyZero()){const t=f.value();return t<0?-1:t>0?1:0}return Ue.inCircleRobustMp(t,e,s,n)}static inCircleRobustMp(t,e,s,n){do{if(!p(t.x,n.x)||!p(t.y,n.y))break;if(!p(e.x,n.x)||!p(e.y,n.y))break;if(!p(s.x,n.x)||!p(s.y,n.y))break;const i=t.x-n.x,r=t.y-n.y,o=e.x-n.x,a=e.y-n.y,l=s.x-n.x,h=s.y-n.y;if(!d(i,a)||!d(r,o))break;if(!d(o,h)||!d(a,l))break;if(!d(i,h)||!d(r,l))break;if(!d(i,i)||!d(r,r))break;if(!d(o,o)||!d(a,a))break;if(!d(l,l)||!d(h,h))break;const u=i*a,c=r*o,m=o*h,_=a*l,f=i*h,y=r*l,x=i*i,v=r*r,b=o*o,P=a*a,S=l*l,E=h*h;if(!p(u,c))break;if(!p(m,_))break;if(!p(f,y))break;if(!g(x,v))break;if(!g(b,P))break;if(!g(S,E))break;const C=u-c,w=m-_,I=f-y,T=x+v,A=b+P,M=S+E;if(!d(T,w))break;if(!d(A,I))break;if(!d(M,C))break;const D=T*w,N=A*I,F=M*C;if(!p(D,N))break;const R=D-N;if(!g(R,F))break;const k=R+F;return k<0?-1:k>0?1:0}while(0);const i=Le.constructDouble(n.x),r=Le.constructDouble(n.y),o=Le.constructDouble(t.x),a=Le.constructDouble(t.y);o.subThis(i),a.subThis(r);const l=Le.constructDouble(e.x),h=Le.constructDouble(e.y);l.subThis(i),h.subThis(r);const u=Le.constructDouble(s.x),c=Le.constructDouble(s.y);u.subThis(i),c.subThis(r);const m=o.mul(h).sub(a.mul(l)),_=l.mul(c).sub(h.mul(u)),f=o.mul(c).sub(a.mul(u)),y=o.mul(o).add(a.mul(a)),x=l.mul(l).add(h.mul(h)),v=u.mul(u).add(c.mul(c)),b=y.mul(_).sub(x.mul(f)).add(v.mul(m));return b.LZ()?-1:b.GZ()?1:0}static inCircleRobustMp3Point(t,e,s){const n=Le.constructDouble(t.x),i=Le.constructDouble(t.y),r=Le.constructDouble(e.x),o=Le.constructDouble(e.y),a=Le.constructDouble(s.x),l=Le.constructDouble(s.y),h=a.mul(a).add(l.mul(l)).sub(a.mul(n).add(l.mul(i)).add(a.mul(r)).add(l.mul(o))).add(n.mul(r).add(i.mul(o)));return h.LZ()?-1:h.GZ()?1:0}static inCircleRobust3Point(t,e,s){const n=new m(t.x),i=new m(t.y),r=new m(e.x),o=new m(e.y),a=new m(s.x),l=new m(s.y),h=a.mulE(a).addE(l.mulE(l)).subE(a.mulE(n).addE(l.mulE(i)).addE(a.mulE(r)).addE(l.mulE(o))).addE(n.mulE(r).addE(i.mulE(o)));if(!h.isFuzzyZero()){const t=h.value();return t<0?-1:t>0?1:0}return Ue.inCircleRobustMp3Point(t,e,s)}static calculateCircleCenterFromThreePoints(t,e,s){if(t.equals(s)||t.equals(e)||s.equals(e))return Ue.getNAN();const n=function(t,e,s){const n=new m(e.x);n.subThis(t.x);const i=new m(e.y);i.subThis(t.y);const r=new m(s.x);r.subThis(t.x);const o=new m(s.y);o.subThis(t.y);const a=n.clone();a.mulThisE(o);let l=i.clone();if(l.mulThisE(r),a.subThisE(l),0===a.value())return Ue.getNAN();a.mulThis(2);const h=n.clone();h.mulThisE(n);const u=i.clone();u.mulThisE(i);const c=h.clone();c.addThisE(u);const d=r.clone();d.mulThisE(r);const g=o.clone();g.mulThisE(o);const p=d.clone();p.addThisE(g);const _=i.clone();_.mulThisE(p),l=o.clone(),l.mulThisE(c),_.subThisE(l),_.divThisE(a);const f=n.clone();f.mulThisE(p),l=r.clone(),l.mulThisE(c),f.subThisE(l),f.divThisE(a);const y=Ue.construct(t.x-_.value(),t.y+f.value()),x=t.sub(y).length(),v=e.sub(y).length(),b=s.sub(y).length(),P=1e-15*(x+Math.abs(t.x)+Math.abs(e.x)+Math.abs(s.x)+Math.abs(t.y)+Math.abs(e.y)+Math.abs(s.y));return Math.abs(x-v)<=P&&Math.abs(x-b)<=P&&_.eps()<P&&f.eps()<P?y:Ue.getNAN()}(t,e,s);return n.isNAN()?function(t,e,s){const n=Le.constructDouble(e.x);n.subDoubleThis(t.x);const i=Le.constructDouble(e.y);i.subDoubleThis(t.y);const r=Le.constructDouble(s.x);r.subDoubleThis(t.x);const o=Le.constructDouble(s.y);o.subDoubleThis(t.y);const a=n.clone();a.mulThis(o);let l=i.clone();if(l.mulThis(r),a.subThis(l),a.isZero())return Ue.getNAN();a.mulDoubleThis(2);const h=n.clone();h.mulThis(n);const u=i.clone();u.mulThis(i);const c=h.clone();c.addThis(u);const m=r.clone();m.mulThis(r);const d=o.clone();d.mulThis(o);const g=m.clone();g.addThis(d);const p=i.clone();p.mulThis(g),l=o.clone(),l.mulThis(c),p.subThis(l),p.divThis(a);const _=n.clone();return _.mulThis(g),l=r.clone(),l.mulThis(c),_.subThis(l),_.divThis(a),Ue.construct(t.x-p.value(),t.y+_.value())}(t,e,s):n}static calculateAngle(t,e){return Math.atan2(t.crossProduct(e),t.dotProduct(e))}static isBisectorRobust(t,e,s){return(0,n.g)(0),!1}static size(){return 2}get 0(){return this.x}get 1(){return this.y}set 0(t){this.x=t}set 1(t){this.y=t}static compareZorder(t,e){const s=Ue.c_compare_zorder_xx[t.x<0?1:0]|Ue.c_compare_zorder_yy[t.y<0?1:0],n=Ue.c_compare_zorder_xx[e.x<0?1:0]|Ue.c_compare_zorder_yy[e.y<0?1:0];if(s===n){let s=0,n=0;for(let i=0;i<2;++i){const r=Oe(t[i],e[i]);r>s&&(s=r,n=i)}return t[n]<e[n]}return s<n}static lerp(t,e,s){const n=new Ue;return G(t,e,s,n),n}static getClosestCoordinate(t,e,s,n=!1){const i=Ue.getNAN();i.setSub(e,t);const r=i.sqrLength();if(0===r)return.5;if(e.isEqualPoint2D(s))return 1;const o=Ue.getNAN();o.setSub(s,t);let a=o.dotProduct(i)/r;return n||(a<0?a=0:a>1&&(a=1)),a}static intersectLinesAtOnePoint(t,e,s,n){if(t.equals(e)||s.equals(n))return Ue.getNAN();const i=e.x-t.x,r=s.x-n.x,o=e.y-t.y,a=s.y-n.y,l=i*a-r*o;if(!l)return Ue.getNAN();const h=l;if(0===h)return Ue.getNAN();let u=(s.x-t.x)*a-(s.y-t.y)*r;u/=h;const c=new Ue;return G(t,e,u,c),c.isFinite()?c:Ue.getNAN()}toString(){return`[${this.x},${this.y}]`}}Ue.dimensions=2,Ue.d=[[0,1,0,-1],[-1,0,1,0],[0,-1,0,1],[1,0,-1,0]],Ue.c_compare_zorder_xx=[2,0],Ue.c_compare_zorder_yy=[1,0]},57592:(t,e,s)=>{s.r(e),s.d(e,{$:()=>In,A:()=>Sn,B:()=>Pr,C:()=>xs,D:()=>ji,E:()=>S,F:()=>Hi,G:()=>qi,H:()=>zi,I:()=>os,J:()=>Xo,K:()=>Oo,L:()=>Cn,M:()=>Ri,N:()=>Wi,O:()=>un,P:()=>Go,Q:()=>wn,R:()=>ho,S:()=>y,T:()=>Ys,U:()=>yr,V:()=>$n,W:()=>Vi,X:()=>Lo,Y:()=>Wn,Z:()=>An,_:()=>Mn,a:()=>ro,a0:()=>Tn,a1:()=>Kn,a2:()=>O,a3:()=>N,a4:()=>R,a5:()=>_n,a6:()=>z,a7:()=>D,a8:()=>Zi,a9:()=>zo,aA:()=>go,aB:()=>mo,aC:()=>ri,aD:()=>Eo,aE:()=>ao,aF:()=>g,aG:()=>aa,aH:()=>la,aI:()=>ha,aJ:()=>ua,aK:()=>ca,aa:()=>Ir,ab:()=>Cr,ac:()=>Sr,ad:()=>Ci,ae:()=>cr,af:()=>qt,ag:()=>Bt,ah:()=>pi,ai:()=>_i,aj:()=>ds,ak:()=>Vs,al:()=>Rs,am:()=>eo,an:()=>zt,ao:()=>uo,ap:()=>Ss,aq:()=>bs,ar:()=>ys,as:()=>Zs,at:()=>tt,au:()=>et,av:()=>B,aw:()=>yo,ax:()=>Vo,ay:()=>Xi,az:()=>G,b:()=>fi,c:()=>io,d:()=>Ei,e:()=>gi,f:()=>xi,g:()=>gn,h:()=>rs,i:()=>to,j:()=>bi,k:()=>Ws,l:()=>fs,m:()=>_s,n:()=>ms,o:()=>Fs,p:()=>Ls,q:()=>gs,r:()=>ie,s:()=>Qs,t:()=>Rt,u:()=>ls,v:()=>Jr,w:()=>C,x:()=>nr,y:()=>T,z:()=>Ho});var n=s(21566),i=s(62188),r=s(74642),o=s(75992),a=s(86330),l=s(66866),h=s(33147),u=s(80690),c=s(1804),m=s(50256),d=s(77536);class g{constructor(t){if(this.m_geom=this.m_sr=null,t){if(t.move)return this.m_geom=t.move.m_geom,t.move.m_geom=null,this.m_sr=t.move.m_sr,void(t.move.m_sr=null);if(t.copy)return this.m_geom=t.copy.m_geom?t.copy.m_geom.clone():null,void(this.m_sr=t.copy.m_sr);t.geom&&(this.m_geom=t.geom),t.sr&&(this.m_sr=t.sr)}}getGeometry(){return this.m_geom}getSpatialReference(){return this.m_sr}setGeometry(t){this.m_geom=t}setSpatialReference(t){this.m_sr=t}equals(t,e){const s=t;return!(!this.m_sr&&s.m_sr||this.m_sr&&!s.m_sr||!this.m_geom&&s.m_geom||this.m_geom&&!s.m_geom||this.m_sr&&s.m_sr&&!this.m_sr.equals(s.m_sr)||this.m_geom&&s.m_geom&&!this.m_geom.equals(s.m_geom,e))}clone(){let t=null;return this.m_geom&&(t=this.m_geom.clone()),new g({geom:t,sr:this.m_sr})}hasGeom(){return!!this.m_geom}}class p{constructor(t){this.m_factor=1,this.m_wkid=0,this.m_peUnit=null,t&&(this.m_peUnit=t,this.m_factor=t.getUnitFactor(),this.m_wkid=t.getCode(),this.m_wkid<0&&(this.m_wkid=0))}getName(){return this.m_peUnit?this.m_peUnit.getName():""}getID(){return this.m_wkid}getConversionFactor(t){return this.getUnitType()!==t.getUnitType()&&(0,i.a)("unit type mismatch"),this.getUnitToBaseFactor()/t.getUnitToBaseFactor()}getUnitToBaseFactor(){return this.m_factor}getHashCode(){return(0,a.at)((0,a.au)(this.getUnitType()),(0,a.au)(this.getUnitToBaseFactor()))}equals(t){return!!t&&this.getUnitType()===t.getUnitType()&&this.getUnitToBaseFactor()===t.getUnitToBaseFactor()&&this.getID()===t.getID()&&this.getName()===t.getName()}static isValidWkid(t){return!1}}const _={330:104878,500:104879,1300:104899,1450:104986,2230:104988,3800:104978,5e3:104919,6200:104906,8200:104909,9500:104927,9600:104977,1e4:[104911,104936],11e3:104941,11080:104872,11100:104907,12e3:104920,12400:104995,13e3:104948,14e3:[104923,104989],15e3:[104913,104954],15100:104976,16e3:[104926,104931],18e3:[104922,104982],21e3:104947,21500:104877,27e3:[104950,104957],29e3:104964,3e4:104921,31e3:104949,33e3:104946,4e4:[104914,104967],40600:104897,41900:104937,42e3:104951,43100:104993,49300:104924,50100:104939,54e3:104955,58200:104981,59500:104930,74e3:104961,77e3:104956,79e3:104962,83500:104910,85e3:104917,88800:104934,89200:104985,96e3:104997,104e3:104963,106500:104898,11e4:104938,133e3:104932,135e3:104983,17e4:104965,198200:104987,198630:104935,208e3:104966,235800:104952,249400:104929,252100:104980,255e3:104973,47e4:104972,529800:104942,531e3:104996,56e4:104928,561400:104979,578900:104945,584700:104959,593e3:104970,606e3:104999,718e3:104933,745700:104984,761400:104953,763500:104994,764e3:104940,788900:104958,1188300:104998,1195e3:104969,1352600:104968,1560800:104874,1562090:104915,1737400:104903,1821460:104918,1821490:104876,2409300:104912,2410300:104873,2439400:104974,2439700:104900,2575e3:104943,2631200:104875,2632345:104916,3393400:104904,3396190:[104905,104971],6051e3:104901,6051800:104902,637e4:104128,6370997:[4052,37008],6371e3:4035,6371007:4047,6371228:[4053,10346],6376045:[8042,8043],6376523:[4027,4901,4902],6376896:37007,6378135:[4122,4322,4324,4720,4985,4987],6378136:[4740,4923,7678,7680,9474,9475,104017,104018],6378137:[3823,3824,3888,3889,4017,4019,4023,4031,4040,4046,4055,4074,4075,4080,4081,4121,4126,4130,4133,4140,4141,4148,4151,4152,4163,4166,4167,4170,4171,4172,4173,4176,4180,4189,4190,4258,4269,4283,4318,4319,4326,4463,4466,4469,4470,4480,4482,4483,4490,4557,4558,4612,4617,4619,4624,4627,4659,4661,4667,4669,4670,4674,4686,4687,4693,4694,4702,4737,4742,4747,4749,4750,4755,4756,4757,4758,4759,4761,4762,4763,4764,4765,4883,4885,4887,4889,4893,4895,4898,4907,4909,4921,4925,4927,4929,4931,4933,4935,4937,4939,4941,4943,4945,4947,4949,4951,4953,4955,4957,4959,4961,4963,4965,4967,4971,4975,4977,4979,4981,4983,4989,4997,4999,5012,5013,5245,5246,5251,5252,5263,5264,5323,5324,5340,5342,5353,5354,5359,5360,5364,5365,5370,5371,5372,5373,5380,5381,5392,5393,5488,5489,5545,5546,5592,5593,5885,5886,6134,6135,6310,6311,6318,6319,6321,6322,6324,6325,6364,6365,6667,6668,6705,6706,6782,6783,6980,6982,6983,6987,6989,6990,7034,7035,7036,7037,7038,7039,7040,7041,7042,7072,7073,7084,7085,7086,7087,7133,7135,7136,7138,7139,7372,7373,7657,7659,7661,7663,7665,7685,7686,7797,7798,7816,7843,7844,7880,7881,7885,7886,7900,7901,7902,7903,7904,7905,7906,7907,7908,7909,7910,7911,7912,7915,7917,7919,7921,7923,7925,7927,7929,7931,8085,8086,8231,8232,8235,8237,8239,8240,8244,8246,8248,8249,8251,8252,8254,8255,8399,8403,8426,8427,8449,8542,8544,8545,8684,8685,8698,8699,8817,8818,8860,8888,8899,8900,8901,8902,8906,8907,8916,8918,8920,8922,8924,8926,8928,8930,8932,8934,8936,8938,8940,8942,8944,8946,8948,8949,8972,8973,8974,8975,8976,8977,8978,8979,8980,8981,8982,8983,8984,8985,8986,8987,8988,8989,8990,8991,8992,8993,8994,8995,8996,8997,8998,8999,9e3,9002,9003,9005,9006,9008,9009,9011,9012,9013,9014,9016,9017,9018,9019,9053,9054,9055,9056,9057,9059,9060,9061,9062,9063,9064,9065,9066,9067,9068,9069,9071,9072,9074,9075,9139,9140,9147,9148,9152,9153,9183,9184,9293,9294,9299,9308,9309,9332,9333,9364,9372,9379,9380,9384,9453,9469,9470,9546,9547,9695,9696,9701,9702,9739,9754,9755,9758,9763,9776,9777,9778,9779,9781,9782,9783,9784,9866,9871,9939,9964,9969,9974,9989,9990,10175,10177,10178,10185,10191,10196,10204,10209,10214,10219,10224,10229,10237,10272,10277,10283,10284,10298,10299,10300,10304,10305,10307,10309,10310,10311,10312,10327,10328,10413,10414,10468,10474,10475,10570,10571,10605,10606,10623,10628,10638,10639,10670,10671,10672,10673,10689,10690,10724,10725,10738,10739,10761,10762,10780,10781,10784,10785,10799,10800,20033,20040,20041,20045,20046,104009,104010,104011,104012,104013,104014,104015,104016,104019,104020,104021,104022,104024,104027,104028,104050,104100,104107,104108,104110,104111,104114,104115,104116,104117,104118,104119,104120,104121,104122,104123,104124,104129,104133,104134,104137,104141,104142,104143,104144,104145,104179,104180,104181,104182,104183,104184,104185,104186,104199,104223,104257,104258,104259,104260,104286,104287,104602,104613,104644,104645,104646,104647,104653,104804,104896,104991],6378140:4610,6378145:[4025,4276,4760,4891,37001],6378150:37003,6378155:[37004,37207],6378160:[3821,4003,4021,4036,4202,4203,4237,4238,4291,4618,4708,5527,37231,104023,104136],6378166:37002,6378200:[4020,4229,4286,4303,4706],6378245:[4024,4147,4164,4178,4179,4191,4200,4205,4214,4284,4317,4555,4676,4677,4678,4991,4993,5560,5561,37257,104135],6378270:[4732,37005,37229],6378273:[4054,10345],6378300:[4029,4168,4174],6378388:[4022,4123,4153,4154,4158,4159,4160,4161,4165,4181,4182,4183,4184,4185,4192,4194,4195,4196,4199,4204,4207,4208,4215,4218,4221,4224,4225,4230,4231,4233,4235,4236,4247,4248,4249,4254,4255,4259,4264,4265,4271,4272,4274,4285,4287,4288,4292,4297,4309,4311,4313,4316,4472,4475,4611,4614,4615,4616,4621,4622,4623,4625,4626,4628,4629,4630,4631,4632,4633,4636,4637,4639,4641,4642,4643,4644,4645,4646,4658,4660,4662,4663,4664,4665,4668,4672,4673,4684,4688,4689,4690,4691,4692,4698,4704,4705,4707,4709,4710,4711,4712,4714,4715,4716,4718,4719,4721,4722,4724,4725,4727,4728,4729,4730,4733,4734,4735,4739,4741,4753,4754,4802,4803,4806,4809,4810,4823,4824,4900,5524,6883,8428,8430,8431,9248,9251,9253,9403,9893,10158,10249,10252,10635,10636,10735,10736,10758,37201,37204,37205,37212,37213,37214,37215,37216,37217,37218,37219,37221,37222,37224,37226,37227,37230,37232,37233,37234,37235,37237,37238,37241,37242,37245,37246,37247,37249,37250,37251,37253,37259,104104,104106,104125,104126,104127,104130,104138,104248],6378523:104786,24764e3:104960,25559e3:104944,60268e3:104925,71492e3:104908,6957e5:104975,6377397.155:[3819,3906,4004,4120,4124,4125,4149,4150,4156,4162,4211,4219,4257,4262,4280,4289,4294,4295,4301,4306,4308,4312,4314,4613,4666,4745,4746,4801,4804,4805,4808,4813,4814,4815,4818,4820,4904,5132,5228,5229,5681,5830,8351,9267,10268,37255,104101,104102,104105,104131,104648,104696,104697,104990,104992],6377563.396:[4001,4188,4277,4278,4279],6377340.189:[4002,4299,4300],6377492.018:[4005,4273,4817],6377483.865280418:[4006,4293],6378293.645208759:[4007,4157,4302,4738,5464],6378206.4:[4008,4127,4128,4129,4135,4136,4137,4138,4139,4169,4216,4242,4253,4267,4608,4609,4638,4675,4683,4695,4717,4723,4726,4995,5451,5467,37220,37239,37243,37252,37260,104e3,104109,104112,104113,104132],6378450.047:[4009,4268],6378300.789:[4010,4281],6378249.2:[4011,4014,4155,4193,4206,4213,4223,4226,4227,4228,4252,4261,4266,4275,4282,4296,4304,4310,4315,4671,4807,4811,4816,4821,37223,37225,104139,104140,104261,104304],6378249.145:[4012,4013,4132,4134,4142,4143,4175,4197,4198,4201,4209,4210,4212,4220,4222,4232,4234,4246,4250,4251,4256,4260,4263,4270,4305,4307,4600,4601,4602,4603,4604,4605,4606,4607,4620,4679,4680,4696,4697,4699,4700,4701,4703,4713,4731,4736,4743,4744,4812,4819,6881,6882,6892,6894,8694,37206,37208,37211,37228,37240,37254,104025,104026,104103,104305],6377276.345:[4015,4131,4144,4239,4240,4244,4682,5233,6207,37202,104256,104664,104693],6377298.556:[4016,4298],6377304.063:[4018,4245],6378298.3:[4028,4903],6378136.2:4032,6378136.3:4033,6378249.144808011:[4034,4241],20922931.8:[4042,4243],6377301.243:[4044,4145,37203],6377299.151:[4045,4146],6377019.27:[4657,10256,10260,10265],6378306.3696:[4748,4752],6377295.664:[4751,37006],6378136.5:[7682,7683],6371008.7714:104047,6378418.941:[104700,104726,104760],6378586.581:[104701,104743],6378505.809:104702,6378544.823:104703,6378490.569:104704,6378470.757:[104705,104776],6378403.701:[104706,104750],6378434.181:[104707,104724,104739,104764],6378454.907:104708,6378400.653:104709,6378567.378:104710,6378546.957:[104711,104717,104780],6378476.853:[104712,104736],6378411.321:[104713,104728],6378647.541:[104714,104715],6378514.953:[104716,104782],6378421.989:[104718,104770],6378481.425:[104719,104753,104774,104781],6378518.001:[104720,104725],6378521.049:[104721,104723,104731,104745,104748],6378464.661:104722,6378436.619:104727,6378574.389:[104729,104730],6378472.281:[104732,104756],6378498.189:[104733,104746],6378449.421:[104734,104766],6378525.621:[104735,104754],6378466.185:104737,6378496.665:104738,6378643.579:104740,6378559.758:104741,6378414.369:[104742,104763,104772],6378441.801:104744,6378502.761:[104747,104759,104773,104775],6378617.061:104749,6378624.681:[104751,104765],6378468.623:104752,6378445.763:[104755,104758,104761],6378670.401:104757,6378438.753:104762,6378543.909:104767,6378605.783:104768,6378540.861:104769,6378443.325:[104771,104784],6378548.481:104777,6378463.746:104778,6378426.561:104779,6378453.688:104783,6378530.193:104785,6378376.271:[104800,104828],6378471.92:104801,6378472.931:104802,6378411.351:104803,6378380.991:104805,6378414.96:104806,6378345.09:[104807,104819,104844,104870],6378412.542:104808,6378470.401:104809,6378376.331:104810,6378379.031:104811,6378407.621:104812,6378376.811:[104813,104827],6378313.92:104814,6378414.93:104815,6378413.021:104816,6378380.381:104817,6378530.851:104818,6378591.521:104820,6378378.881:104821,6378408.481:[104822,104832],6378375.601:[104823,104838],6378408.041:104824,6378655.071:104825,6378409.151:104826,6378315.7:[104829,104840,104845,104851],6378285.86:[104830,104835,104859],6378379.301:104831,6378560.121:104833,6378531.821:104834,6378500.6:104836,6378376.041:104837,6378406.601:104839,6378438.991:104841,6378345.42:104842,6378593.86:104843,6378381.271:[104846,104847],6378413.671:104848,6378344.377:104849,6378563.891:104850,6378408.091:104852,6378377.671:104853,6378472.751:104854,6378412.511:104855,6378407.281:104856,6378534.451:104857,6378406.051:104858,6378532.921:104860,6378380.091:104861,6378408.941:104862,6378624.171:104863,6378377.411:104864,6378474.591:104865,6378407.141:104866,6378376.871:104867,6378375.251:104868,6378405.971:104869,6378437.651:104871};class f extends p{constructor(t){if("number"==typeof t)return super(),this.m_factor=t,void(this.m_wkid=0);super(t)}getUnitType(){return 1}convertFromRadians(t){return t/this.getUnitToBaseFactor()}convertToRadians(t){return t*this.getUnitToBaseFactor()}}function y(t){return new Hr}function x(t){const e=Zo(null);return t.getType()===zo.PE_TYPE_PROJCS||t.getType()===zo.PE_TYPE_GEOGCS?e.reset(t.getUnit()):(0,i.a)("PE_coord_sys"),e.get()||(0,i.d)("cannot create units from coord sys"),function(t){return t.getType()===zo.PE_TYPE_LINUNIT?new Hr(t):t.getType()===zo.PE_TYPE_ANGUNIT?new f(t):void(0,i.a)("peUnit")}(e.get())}class v{constructor(t,e,s){void 0===t?(this.x=new a.H,this.y=new a.H,this.z=new a.H):t instanceof o.d?(this.x=new a.H(t.x),this.y=new a.H(t.y),this.z=new a.H(t.z)):t instanceof a.H?(this.x=t.clone(),this.y=e.clone(),this.z=s.clone()):(0,i.a)("EPoint3D constructor")}dotProduct(t){return this.x.mulE(t.x).addE(this.y.mulE(t.y)).addE(this.z.mulE(t.z))}crossProduct(t){return new v(this.y.mulE(t.z).subE(this.z.mulE(t.y)),this.z.mulE(t.x).subE(this.x.mulE(t.z)),this.x.mulE(t.y).subE(this.y.mulE(t.x)))}crossProductVector(t){const e=this.y.mulE(t.z).subE(t.y.mulE(this.z)),s=t.x.mulE(this.z).subE(this.x.mulE(t.z)),n=this.x.mulE(t.y).subE(t.x.mulE(this.y));return new v(e,s,n)}sqrLength(){return this.x.mulE(this.x).addE(this.y.mulE(this.y)).addE(this.z.mulE(this.z))}length(){return this.sqrLength().sqrt()}static distance(t,e){return t.sub(e).length()}negate(){return new v(this.x.negate(),this.y.negate(),this.z.negate())}add(t){return new v(this.x.addE(t.x),this.y.addE(t.y),this.z.addE(t.z))}sub(t){return new v(this.x.subE(t.x),this.y.subE(t.y),this.z.subE(t.z))}subThis(t){return this.x.subThisE(t.x),this.y.subThisE(t.y),this.z.subThisE(t.z),this}addThis(t){return this.x.addThisE(t.x),this.y.addThisE(t.y),this.z.addThisE(t.z),this}mul(t){return new v(this.x.mulE(t),this.y.mulE(t),this.z.mulE(t))}div(t){return new v(this.x.divE(t),this.y.divE(t),this.z.divE(t))}eq(t){return this.x.eq(t.x)&&this.y.eq(t.y)&&this.z.eq(t.z)}isZero(){return this.x.isZero()&&this.y.isZero()&&this.z.isZero()}value(){return o.d.construct(this.x.value(),this.y.value(),this.z.value())}}class b{constructor(t){if(this.m_origin=new o.d,this.m_normal=new o.d,this.m_axisX=new o.d,this.m_axisY=new o.d,!t)return this.m_origin=new o.d,this.m_normal=new o.d(0,0,1),this.m_axisX=new o.d(1,0,0),void(this.m_axisY=new o.d(0,1,0));t.pt0&&t.pt1&&t.pt2?this.setFromPoints(t.pt0,t.pt1,t.pt2):(0,i.g)(0,`unimplemented constructor options ${JSON.stringify(t)}`)}assign(t){return(0,i.g)(0),this}set(t,e,s,n){(0,i.g)(0)}setFromPoints(t,e,s){let n=e.sub(t);const i=s.sub(t);this.m_normal=n.crossProductVector(i);let r=!0;if(this.m_normal.isZero()){if(r=!1,n.isZero()&&(n=i),n.isZero()){const e=0,s=1;return this.m_normal.setCoords(e,e,s),this.m_axisX.setCoords(s,e,e),this.m_axisY.setCoords(e,s,e),this.m_origin=t,!1}this.m_axisX=n.getUnitVector(),this.m_normal=this.m_axisX.createAPerpendicular()}else this.m_normal.normalizeThis(),this.m_axisX=n.getUnitVector();return this.m_axisY=this.m_normal.crossProductVector(this.m_axisX),this.m_origin=t,r}getCoord(t,e){return(0,i.g)(0),{}}getCoord2D(t){return(0,i.g)(0),{}}getCoordX(t,e){return(0,i.g)(0),0}getCoordY(t,e){return(0,i.g)(0),0}getCoordZ(t,e){return(0,i.g)(0),0}setPreferredAxisX(t){(0,i.g)(0)}getOrigin(){return(0,i.g)(0),{}}getNormal(){return(0,i.g)(0),{}}getAxisX(){return this.m_axisX.clone()}getAxisY(){return this.m_axisY.clone()}setAxisX(t,e=!1){(0,i.g)(0)}setAxisY(t,e=!1){(0,i.g)(0)}recalculateAxisY(){(0,i.g)(0)}setOrigin(t){(0,i.g)(0)}setNormal(t,e){(0,i.g)(0)}intersect(t,e){return(0,i.g)(0),!1}intersectLine(t){return(0,i.g)(0),0}intersectLineEx(t,e){return(0,i.g)(0),0}closestCoordinate(t){const e=t.sub(this.m_origin),s=new a.P;return s.x=e.dotProduct(this.m_axisX),s.y=e.dotProduct(this.m_axisY),s}projectVector(t){return(0,i.g)(0),{}}signedDistance(t){return(0,i.g)(0),0}distance(t){return(0,i.g)(0),0}}function P(t,e){return!1}function S(t,e,s,n,r=100,o=P){let l,h,u,c,m,d,g,p,_;(0,i.g)(n>0);let f,y,x,v=0,b=0;const S=(0,a.aq)();e>s&&(s=(0,a.c)(e,e=s));const E=t(e),C=t(s);E<C?(l=h=u=e,c=m=d=E):(l=h=u=s,c=m=d=C);let w=0;for(;w<r&&(x=.5*(s-e),_=e+x,f=n*(Math.abs(l)+.25),y=2*f,!(o(l,c)||Math.abs(l-_)<=y-x));++w){if(Math.abs(b)>f){const t=(l-h)*(c-d);let n=(l-u)*(c-m),i=(l-u)*n-(l-h)*t;n=2*(n-t),n>0&&(i=-i),n=Math.abs(n);const r=b;b=v,Math.abs(i)>=Math.abs(n*r*.5)||i<=n*(e-l)||i>=n*(s-l)?(b=l>=_?e-l:s-l,v=(0,a.aq)()*b):(v=i/n,p=l+v,(p-e<y||s-p<y)&&(v=_-l<0?-Math.abs(f):Math.abs(f)))}else b=l>=_?e-l:s-l,v=b*S;p=l+v,g=t(p),g<c?(p>=l?e=l:s=l,u=h,h=l,l=p,d=m,m=c,c=g):(p<l?e=p:s=p,g<=m||h===l?(u=h,h=p,d=m,m=g):(g<=d||u===l||u===h)&&(u=p,d=g))}return(0,a.k)(l,c)}function E(t,e,s){return t>s?t-=Math.ceil((t-s)/a.p)*a.p:t<e&&(t+=Math.ceil((e-t)/a.p)*a.p),t}function C(t,e,s){return function(t,e,s,n){const i=s.x,r=s.y;return w(t,e,Math.cos(i),Math.sin(i),Math.cos(r),Math.sin(r),n)}(t,e,s,0)}function w(t,e,s,n,i,r,a){const l=t/Math.sqrt(1-e*r*r),h=l+a,u=h*i*s,c=h*i*n,m=(l*(1-e)+a)*r;return o.d.construct(u,c,m)}function I(t,e,s){const n=new a.H,i=new a.H,r=new a.H,o=new a.H;n.setCos(s.x),i.setSin(s.x),r.setCos(s.y),o.setSin(s.y);const l=o.negate().mulE(o.mul(e)).add(1).sqrt(),h=new a.H(t).divE(l),u=h.mulE(r).mulE(n),c=h.mulE(r).mulE(i),m=h.mul(1-e).mulE(o);return new v(u,c,m)}function T(t,e,s){const n=s.x,i=s.y,r=s.z,o=Math.atan2(i,n),l=Math.sqrt(n*n+i*i),h=Math.atan2(r,(1-e)*l);return a.P.construct(o,h)}function A(t,e,s){const n=1-e,i=t/Math.sqrt((0,a.a)(s.x)+(0,a.a)(s.y)+(0,a.a)(s.z)/n);return s.mul(i)}function M(t,e,s,n,i){const r=C(t,e,s),a=C(t,e,n);return T(0,e,o.d.lerp(r,a,i))}function D(t,e,s){const n=new o.d;return n.setCrossProductVector(e,s),Math.abs(Math.atan2(n.length(),e.dotProduct(s)))*t}function N(t,e,s,n,i){const r=s.getUnitVector(),a=n.getUnitVector(),l=e.getUnitVector(),h=new o.d;if(h.setCrossProductVector(r,a),!h.isZero()){h.normalizeThis();const e=l.sub(h.mul(h.dotProduct(l)));if(!e.isZero()){e.normalizeThis();const s=r.add(a).mul(.5);if(s.dotProduct(e)>s.dotProduct(r)){const s=Math.abs(h.dotProduct(l)),n=Math.asin(s);return i.assign(e.getUnitVector().mul(t)),n*t}}}const u=D(1,r,l),c=D(1,a,l);return u<=c?(i.assign(s),u*t):(i.assign(n),c*t)}function F(t,e,s,n,r){switch((0,i.g)(s.isFinite()&&n.isFinite()),r){case 0:return function(t,e,s,n){const i={stack:[],error:void 0,hasError:!1};try{const r=(0,l.b)(i,new Go,!1);return Ho.geodeticDistance(t,e,s.x,s.y,n.x,n.y,r,null,null,zo.PE_LINETYPE_GEODESIC),r.val}catch(r){i.error=r,i.hasError=!0}finally{(0,l.c)(i)}}(t,e,s,n);case 1:return function(t,e,s){const n={stack:[],error:void 0,hasError:!1};try{const i=(0,l.b)(n,new Go,!1);return Ho.greatEllipticDistance(t,e,s.x,s.y,s.x,s.y,i,null,null),i.val}catch(i){n.error=i,n.hasError=!0}finally{(0,l.c)(n)}}(t,e,s);case 2:case 3:{const i=C(t,e,s),r=C(t,e,n);return o.d.distance(i,r)}default:(0,i.t)("")}}function R(t,e,s,n,i,r=0,l){if(2===r||3===r)return function(t,e,s,n,i,r=!1,l){const h=A(t,e,s);if(r){const r=new b({pt0:new o.d(0,0,0),pt1:n,pt2:i}),u=r.closestCoordinate(s),c=r.closestCoordinate(n),m=r.closestCoordinate(i),d=a.P.getClosestCoordinate(c,m,u),g=A(t,e,o.d.lerp(n,i,d)),p=o.d.distance(g,h);return l&&l.assign(g),(0,a.k)(d,p)}const u=s=>{const r=A(t,e,o.d.lerp(n,i,s));return o.d.distance(r,h)},c=o.d.distance(n,i);if(c>0){const s=q(t,c),{first:r,second:h}=S(u,0,1,s);return l&&l.assign(A(t,e,o.d.lerp(n,i,r))),(0,a.k)(r,h)}{const t=o.d.distance(s,n);return l&&l.assign(s),(0,a.k)(.5,t)}}(t,e,s,n,i,3===r,l);const h=T(0,e,s),u=s=>{const a=T(0,e,o.d.lerp(n,i,s));return F(t,e,h,a,r)},c=o.d.distance(n,i);if(c>0){const s=q(t,c),{first:r,second:h}=S(u,0,1,s);return l&&l.assign(A(t,e,o.d.lerp(n,i,r))),(0,a.k)(r,h)}{const t=u(0);return l&&l.assign(n),(0,a.k)(.5,t)}}function k(t,e,s,n,i,o){if(o[0]=Number.NaN,o[1]=Number.NaN,Math.abs(s.x-n.x)>Math.PI)return 0;if(Math.abs(s.y)>a.o||Math.abs(n.y)>a.o)return 0;if((Math.abs(s.y)===a.o||Math.abs(n.y)===a.o)&&s.x!==n.x)return 0;if(Math.abs(i)>=a.o)return 0;if(s.y>0&&n.y>0&&s.y>i&&n.y>i||s.y<0&&n.y<0&&s.y<i&&n.y<i)return 0;const l=r.a0.constructPoint2D(s),h=r.a0.constructPoint2D(n),u=I(1,e,l),c=I(1,e,h),m=u.crossProductVector(c);if(m.z.isZero())return a.E.construct(s.y,n.y).containsCoordinate(i)?(o[0]=s.x,1):0;const d=m.x.divE(m.z.negate()),g=m.y.divE(m.z.negate()),p=d.mulE(d).addE(g.mulE(g)).sqrt();if(p.isZero()||d.isZero()&&g.isZero())return 0===i?(o[0]=s.x,o[1]=n.x,2):0;const _=(1-e)*Math.tan(i)/p.value();if(Math.abs(_)>1)return 0;const f=Math.acos(_),y=Math.atan2(g.value(),d.value()),x=y-f;let v=y+f;const b=Math.min(s.x,n.x),P=Math.max(s.x,n.x);E(x,b,P),0!==i?E(v,b,P):v=x;let S=0;return b<=x&&x<=P&&(o[S]=x,S++),v!==x&&b<=v&&v<=P&&(o[S]=v,S++),S}function L(t,e){e[0]>.5*Math.PI?(t[0]+=Math.PI,e[0]=Math.PI-e[0]):e[0]<.5*-Math.PI&&(t[0]-=Math.PI,e[0]=-Math.PI-e[0]),(0,i.g)(e[0]>=.5*-Math.PI&&e[0]<=.5*Math.PI)}function G(t,e,s,n,i){n=(0,a.s)(n,-a.o,a.o),i=(0,a.s)(i,-a.o,a.o);const r=a.o-.03;let o;return o=n>r&&i>r||n<-r&&i<-r?function(t,e,s){let n=1;if(e<0&&(n=-1,e=-e,s=-s),0!==t){const i=t*t,r=i*t,o=[1,(1+11*t)/12,(1+118*t+241*i)/360,(1+1089*t+10419*i+8651*r)/20160,(1+9836*t+318246*i+1027436*r+r*t*458881)/1814400],l=e=>{let s=0;const n=(0,a.a)(e)/(t-1);for(let t=o.length-1;t>=0;--t)s=o[t]+s*n;return s*=-(0,a.a)(e/(1-t)),s},h=l(a.o-e);return(l(a.o-s)-h)*n}{const t=a.o-e,i=a.o-s,r=-4*(0,a.a)(Math.sin(t/2));return(-4*(0,a.a)(Math.sin(i/2))-r)*n}}(t,n,i):V(t,i)-V(t,n),.5*(s-e)*o*function(t){return 1-t}(t)}function V(t,e){if(0===e)return 0;const s=Math.sin(e);let n=s,i=s;if(0!==t){n/=1-t*s*s;const e=Math.sqrt(t);i=s*(0,a.y)(e*s)}return n+i}function z(t,e){return t/Math.sqrt(1-e)}function O(t,e){return(1-e)*t}function q(t,e){if(0!==e){const s=t*(0,a.aJ)()/e;return Math.min(s,1e-10)}return 0}class B{constructor(t){this.m_currentShift=63n,this.m_currentElt=0n,this.m_iCurrentElt=-1,this.m_parent=t,this.m_aiSetElts=t.m_bits.flatMap(((t,e)=>e))}next(){if(this.m_currentShift++,64n===this.m_currentShift){if(this.m_iCurrentElt++,this.m_iCurrentElt===this.m_aiSetElts.length)return B.npos();this.m_currentShift=0n,this.m_currentElt=this.m_parent.m_bits[this.m_aiSetElts[this.m_iCurrentElt]]}for(;this.m_currentShift<63n&&!(this.m_currentElt&1n<<this.m_currentShift);)this.m_currentShift++;return this.m_currentElt&1n<<this.m_currentShift?64*this.m_aiSetElts[this.m_iCurrentElt]+Number(this.m_currentShift):this.next()}static npos(){return Number.MAX_SAFE_INTEGER}}function Y(t){return 1n<<(0x3fn&BigInt(t))}function U(t){return t>>6}class H{constructor(t){this.m_bits=[],void 0!==t&&t.copy&&(this.m_bits=t.copy.m_bits.slice())}assignMove(){return this}assignCopy(){return this}hasBit(t){const e=Y(t),s=U(t);return void 0!==this.m_bits[s]&&!!(this.m_bits[s]&e)}setBit(t){const e=Y(t),s=U(t);void 0===this.m_bits[s]&&(this.m_bits[s]=0n),this.m_bits[s]|=e}clearBit(t){}flipBit(t){const e=Y(t),s=U(t);return void 0===this.m_bits[s]&&(this.m_bits[s]=0n),this.m_bits[s]^=e,0n!==(this.m_bits[s]&e)}clear(){this.m_bits.length=0}isZero(){let t=0;return this.m_bits.forEach((e=>{t|=e?2:1})),!(2&t)}equals(t){if(this===t)return!0;if(this.m_bits.length!==t.m_bits.length)return!1;let e=0;return this.m_bits.forEach(((s,n)=>{e|=s===t.m_bits[n]?2:1})),!(1&e||(t.m_bits.forEach(((t,s)=>{e|=t===this.m_bits[s]?2:1})),1&e))}notEquals(t){return!this.equals(t)}assignOr(t){return t.m_bits.forEach(((t,e)=>{void 0===this.m_bits[e]?this.m_bits[e]=t:this.m_bits[e]|=t})),this}assignSubtract(t){return t.m_bits.forEach(((t,e)=>{void 0!==this.m_bits[e]&&(this.m_bits[e]&=~t)})),this}assignAnd(t){return t.m_bits.forEach(((t,e)=>{void 0!==this.m_bits[e]&&(this.m_bits[e]&=t)})),this}assignXor(t){return t.m_bits.forEach(((t,e)=>{void 0===this.m_bits[e]?this.m_bits[e]=t:this.m_bits[e]^=t})),this}getHashCode(){return this.m_bits.reduce(((t,e)=>(0,a.aB)(t,e)),(0,a.au)(0))}getUnorderedBitIterator(){return new B(this)}}class X{constructor(t,e){this.m_map=new Map,this.m_hf=t,this.m_ef=e}add(t){const e=this.m_hf(t);if(!this.m_map.has(e))return this.m_map.set(e,t),this;const s=this.m_map.get(e);return s instanceof Array?s.find((e=>this.m_ef(e,t)))||s.push(t):this.m_ef(s,t)||this.m_map.set(e,[s,t]),this}clear(){this.m_map.clear()}delete(t){return!1}has(t){const e=this.m_hf(t);if(!this.m_map.has(e))return!1;const s=this.m_map.get(e);return s instanceof Array?void 0!==s.find((e=>this.m_ef(e,t))):this.m_ef(s,t)}get(t){const e=this.m_hf(t),s=this.m_map.get(e);if(void 0!==s)return s instanceof Array?s.find((e=>this.m_ef(e,t))):s}get size(){let t=0;for(const e of this.m_map.values())t+=e instanceof Array?e.length:1;return t}forEach(t,e){}[Symbol.iterator](){return(new Set)[Symbol.iterator]()}entries(){return(new Set).entries()}keys(){return(new Set).keys()}values(){return(new Set).values()}get[Symbol.toStringTag](){return"ValueSet"}}class j extends o.a3{constructor(t){super(),this.m_bufferLeft=new r.S,this.m_bufferRight=new r.S,this.m_intervalLeft=a.E.constructEmpty(),this.m_intervalRight=a.E.constructEmpty(),this.m_yScanline=Number.NaN,this.m_helper=t}compare(t,e,s){const n=e,i=t.getElement(s);this.m_helper.querySegmentXY(n,this.m_bufferLeft),this.m_helper.querySegmentXY(i,this.m_bufferRight);const r=this.m_bufferLeft.get(),o=this.m_bufferRight.get();if(this.m_intervalLeft.setCoords(r.getStartX(),r.getEndX()),this.m_intervalRight.setCoords(o.getStartX(),o.getEndX()),this.m_intervalLeft.vmax<this.m_intervalRight.vmin)return-1;if(this.m_intervalLeft.vmin>this.m_intervalRight.vmax)return 1;const a=r.getStartY()===r.getEndY(),l=o.getStartY()===o.getEndY();if(a||l){if(a&&l)return 0;if(r.getStartY()===o.getStartY()&&r.getStartX()===o.getStartX())return a?1:-1;if(r.getEndY()===o.getEndY()&&r.getEndX()===o.getEndX())return a?-1:1}let h=r.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalLeft.vmin),u=o.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalRight.vmin);if(h===u){const t=r.getEndY(),e=o.getEndY(),s=Math.min(t,e);let n=.5*(s+this.m_yScanline);n===this.m_yScanline&&(n=s),h=r.intersectionOfYMonotonicWithAxisX(n,this.m_intervalLeft.vmin),u=o.intersectionOfYMonotonicWithAxisX(n,this.m_intervalRight.vmin)}return h<u?-1:h>u?1:0}setY(t){this.m_yScanline=t}}class Z{constructor(t){this.m_segmentBuffer=new r.S,this.m_point=a.P.getNAN(),this.m_parent=t}setPointXY(t){this.m_point.assign(t)}compare(t,e){const s=t.getElement(e);this.m_parent.querySegmentXY(s,this.m_segmentBuffer);const n=this.m_segmentBuffer.get(),i=new a.E;if(i.setCoords(n.getStartX(),n.getEndX()),this.m_point.x<i.vmin)return-1;if(this.m_point.x>i.vmax)return 1;const r=n.intersectionOfYMonotonicWithAxisX(this.m_point.y,this.m_point.x);return this.m_point.x<r?-1:this.m_point.x>r?1:0}}var W,$;function K(t,e){return{parentage:t,rank:e}}function Q(t,e){const s=t.length;if(s!==e.length)return!1;const n=t[0].parentage;if(n!==e[0].parentage)return!1;if(-1===n)return!0;for(let i=1;i<s;++i)if(t[i].parentage!==e[i].parentage)return!1;return!0}function J(t,e,s){s.length=0;let n=!1;{let i=t.getHalfEdgeVertexIterator(e);for(;i!==r.n;){const e=t.getVertexFromVertexIterator(i),r=t.getShape().getSegmentRank(e),o=t.getShape().getSegmentParentage(e);n||=o>=0,s.push(K(o,r)),i=t.incrementVertexIterator(i)}}{let i=t.getHalfEdgeVertexIterator(t.getHalfEdgeTwin(e));for(;i!==r.n;){const e=t.getVertexFromVertexIterator(i),r=t.getShape().getSegmentRank(e),o=t.getShape().getSegmentParentage(e);n||=o>=0,s.push(K(o,r)),i=t.incrementVertexIterator(i)}}n&&s.sort(((t,e)=>t.rank>e.rank?-1:t.rank<e.rank?1:t.parentage<e.parentage?-1:t.parentage>e.parentage?1:0)),-1===s[0].parentage&&(s.length=1)}!function(t){t[t.enumInputModeBuildGraph=0]="enumInputModeBuildGraph",t[t.enumInputModeSimplifyAlternate=1]="enumInputModeSimplifyAlternate",t[t.enumInputModeSimplifyWinding=2]="enumInputModeSimplifyWinding"}(W||(W={})),function(t){t[t.enumSegmentParentageBreakNode=1]="enumSegmentParentageBreakNode",t[t.enumPathBreakNode=2]="enumPathBreakNode"}($||($={}));class tt{constructor(){this.m_shape=null,this.m_clusterData=new o.S(8),this.m_clusterVertices=new o.S(2),this.m_firstCluster=r.n,this.m_lastCluster=r.n,this.m_halfEdgeData=new o.S(8),this.m_chainData=new o.S(8),this.m_chainAreas=null,this.m_chainPerimeters=null,this.m_universeChain=-1,this.m_simplifiedGeometry=-1,this.m_edgeIndices=[],this.m_clusterIndices=[],this.m_chainIndices=[],this.m_bBuildGeometryParentageSets=!1,this.m_chainBitSetIndex=-1,this.m_edgeBitSetIndex=-1,this.m_edgeBitSetIndexLeft=-1,this.m_emptyBitSet=null,this.m_geometryMapID=null,this.m_uniqueBitSets=null,this.m_chainBitSets=[],this.m_edgeBitSets=[],this.m_checkDirtyPlanesweepTolerance=Number.NaN,this.m_geometryIDIndex=-1,this.m_clusterIndex=-1,this.m_halfEdgeIndex=-1,this.m_tmpHalfEdgeParentageIndex=-1,this.m_tmpHalfEdgeParentageIndexLeft=-1,this.m_tmpHalfEdgeWindingNumberIndex=-1,this.m_tmpHalfEdgeOddEvenNumberIndex=-1,this.m_segmentParentageIndex=-1,this.m_segmentIndexHe=-1,this.m_clusterBreakNodeIndex=-1,this.m_universeGeomID=-1,this.m_pointCount=0,this.m_progressCounter=0,this.m_bBuildChains=!0,this.m_bDirtyCheckFailed=!1}setCheckDirtyPlanesweepTolerance(t){this.m_checkDirtyPlanesweepTolerance=t}dirtyCheckFailed(){return this.m_bDirtyCheckFailed}getShape(){return this.m_shape}setEditShape(t,e,s=!0,n=!1){n?this.setEditShapeImpl3D_(t,W.enumInputModeBuildGraph,null,e,!1):this.setEditShapeImpl_(t,W.enumInputModeBuildGraph,null,e,s)}setAndSimplifyEditShapeAlternate(t,e,s=null,n=!1){const r=[];r.push(e),this.m_simplifiedGeometry=e,n?this.setEditShapeImpl3D_(t,W.enumInputModeSimplifyAlternate,r,s,!1):this.setEditShapeImpl_(t,W.enumInputModeSimplifyAlternate,r,s,t.getGeometryType(e)===i.G.enumPolygon)}setAndSimplifyEditShapeWinding(t,e,s=null){const n=[];n.push(e),this.m_simplifiedGeometry=e,this.setEditShapeImpl_(t,W.enumInputModeSimplifyWinding,n,s,!0)}removeShape(){null!==this.m_shape&&(-1!==this.m_geometryIDIndex&&(this.m_shape.removeGeometryUserIndex(this.m_geometryIDIndex),this.m_geometryIDIndex=-1),-1!==this.m_clusterIndex&&(this.m_shape.removeUserIndex(this.m_clusterIndex),this.m_clusterIndex=-1),-1!==this.m_halfEdgeIndex&&(this.m_shape.removeUserIndex(this.m_halfEdgeIndex),this.m_halfEdgeIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),-1!==this.m_tmpHalfEdgeWindingNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1),-1!==this.m_tmpHalfEdgeOddEvenNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1),-1!==this.m_segmentParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_segmentParentageIndex),this.m_segmentParentageIndex=-1),-1!==this.m_segmentIndexHe&&(this.deleteUserIndexForHalfEdges(this.m_segmentIndexHe),this.m_segmentIndexHe=-1),-1!==this.m_clusterBreakNodeIndex&&(this.deleteUserIndexForClusters(this.m_clusterBreakNodeIndex),this.m_clusterBreakNodeIndex=-1),this.deleteEdgeBitSets_(),this.deleteChainBitSets_(),this.m_emptyBitSet=null,this.m_geometryMapID=null,this.m_shape=null,this.m_clusterData.deleteAll(!0),this.m_clusterVertices.deleteAll(!0),this.m_firstCluster=r.n,this.m_lastCluster=r.n,this.m_halfEdgeData.deleteAll(!0),this.m_edgeIndices.length=0,this.m_clusterIndices.length=0,this.m_chainIndices.length=0,this.m_chainData.deleteAll(!0),this.m_universeChain=r.n,this.m_chainAreas=null)}getClusterHalfEdge(t){return this.m_clusterData.getField(t,2)}queryXY(t,e){const s=this.getClusterVertexIndex_(t);e.assign(this.m_shape.getXYWithIndex(s))}queryXYZ(t,e){(0,i.g)(0)}getClusterParentage(t){return this.m_clusterData.getField(t,1)}getFirstCluster(){return this.m_firstCluster}getPrevCluster(t){return this.m_clusterData.getField(t,3)}getNextCluster(t){return this.m_clusterData.getField(t,4)}getClusterChain(t){return this.m_clusterData.getField(t,6)}getClusterVertexIterator(t){return this.m_clusterData.getField(t,7)}incrementVertexIterator(t){return this.m_clusterVertices.getField(t,1)}getVertexFromVertexIterator(t){return this.m_clusterVertices.getField(t,0)}getClusterUserIndex(t,e){const s=this.getClusterIndex_(t),n=this.m_clusterIndices[e];return n.size()<=s?-1:n.read(s)}setClusterUserIndex(t,e,s){const n=this.getClusterIndex_(t),i=this.m_clusterIndices[e];i.size()<=n&&i.resize(this.m_clusterData.size(),-1),i.write(n,s)}hasClusterUserIndexFlags(t,e,s){if(-1===e)return!1;const n=this.getClusterUserIndex(t,e);return-1!==n&&!!(s&n)}setClusterUserIndexFlags(t,e,s){const n=this.getClusterIndex_(t),i=this.m_clusterIndices[e];i.size()<=n&&i.resize(this.m_clusterData.size(),-1);let r=i.read(n);-1===r&&(r=0),i.write(n,s|r)}clearClusterUserIndexFlags(t,e,s){const n=this.getClusterIndex_(t),i=this.m_clusterIndices[e];i.size()<=n&&i.resize(this.m_clusterData.size(),-1);let r=i.read(n);-1===r&&(r=0),i.write(n,~s&r)}createUserIndexForClusters(t=-1){const e=new o.A(this.m_clusterData.capacity(),t);for(let s=0,n=this.m_clusterIndices.length;s<n;s++)if(null===this.m_clusterIndices[s])return this.m_clusterIndices[s]=e,s;return this.m_clusterIndices.push(e),this.m_clusterIndices.length-1}deleteUserIndexForClusters(t){this.m_clusterIndices[t]=null}getHalfEdgeOrigin(t){return this.m_halfEdgeData.getField(t,1)}getHalfEdgeTo(t){return this.getHalfEdgeOrigin(this.getHalfEdgeTwin(t))}getHalfEdgeTwin(t){return this.m_halfEdgeData.getField(t,4)}getHalfEdgePrev(t){return this.m_halfEdgeData.getField(t,5)}getHalfEdgeNext(t){return this.m_halfEdgeData.getField(t,6)}getHalfEdgeChain(t){return this.m_halfEdgeData.getField(t,2)}getHalfEdgeFaceParentage(t){return this.getChainParentage(this.getHalfEdgeChain(t))}getHalfEdgeVertexIterator(t){return this.m_halfEdgeData.getField(t,7)}getHalfEdgeFromXY(t,e){this.queryXY(this.getHalfEdgeOrigin(t),e)}getHalfEdgeToXY(t,e){this.queryXY(this.getHalfEdgeTo(t),e)}isHalfEdgeCurve(t){return-1!==this.m_segmentIndexHe&&-1!==this.getHalfEdgeUserIndex(t,this.m_segmentIndexHe)}getHalfEdgeFromXYZ(t,e){(0,i.g)(0)}getHalfEdgeToXYZ(t,e){(0,i.g)(0)}getHalfEdgeParentage(t){return this.m_halfEdgeData.getField(t,3)&tt.c_EdgeParentageMask}getHalfEdgeUserIndex(t,e){const s=this.getHalfEdgeIndex_(t),n=this.m_edgeIndices[e];return n.size()<=s?-1:n.read(s)}setHalfEdgeUserIndex(t,e,s){const n=this.getHalfEdgeIndex_(t),i=this.m_edgeIndices[e];i.size()<=n&&i.resize(this.m_halfEdgeData.size(),-1),i.write(n,s)}createUserIndexForHalfEdges(t){void 0===t&&(t=-1);const e=new o.A(this.m_halfEdgeData.capacity(),t);for(let n=0,i=this.m_edgeIndices.length;n<i;n++)if(null===this.m_edgeIndices[n])return this.m_edgeIndices[n]=e,n;this.m_edgeIndices.push(e);const s=this.m_edgeIndices.length-1;return(0,i.g)(s>=0&&s<=Number.MAX_SAFE_INTEGER),s}deleteUserIndexForHalfEdges(t){this.m_edgeIndices[t]=null}deleteEdgesBreakFaces_(t){for(let e=0,s=t.length;e<s;e++){const s=t[e],n=this.getHalfEdgeChain(s),i=this.getHalfEdgeTwin(s),o=this.getHalfEdgeChain(i);this.setChainHalfEdge_(n,r.n),this.setChainHalfEdge_(o,r.n),this.updateVertexToHalfEdgeConnection_(s,!0),this.deleteEdgeImpl_(s)}}doesHalfEdgeBelongToAPolygonInterior(t,e){return(0,i.g)(0),!1}doesHalfEdgeBelongToAPolygonExterior(t,e){return(0,i.g)(0),!1}doesHalfEdgeBelongToAPolygonBoundary(t,e){return(0,i.g)(0),!1}doesHalfEdgeBelongToAPolylineInterior(t,e){return(0,i.g)(0),!1}doesHalfEdgeBelongToAPolylineExterior(t,e){return(0,i.g)(0),!1}doesClusterBelongToAPolygonInterior(t,e){return(0,i.g)(0),!1}doesClusterBelongToAPolygonExterior(t,e){return(0,i.g)(0),!1}doesClusterBelongToAPolygonBoundary(t,e){return(0,i.g)(0),!1}getFirstChain(){return this.m_universeChain}getChainHalfEdge(t){return this.m_chainData.getField(t,1)}getChainParentage(t){return this.m_chainData.getField(t,2)}getChainParent(t){return this.m_chainData.getField(t,3)}getChainFirstIsland(t){return this.m_chainData.getField(t,4)}getChainNextInParent(t){return this.m_chainData.getField(t,5)}getChainNext(t){return this.m_chainData.getField(t,7)}getChainArea(t){const e=this.getChainIndex_(t);let s=this.m_chainAreas.read(e);return Number.isNaN(s)&&(this.updateChainAreaAndPerimeter_(t),s=this.m_chainAreas.read(e)),s}getChainPerimeter(t){return(0,i.g)(0),0}getChainUserIndex(t,e){const s=this.getChainIndex_(t),n=this.m_chainIndices[e];return n.size()<=s?-1:n.read(s)}setChainUserIndex(t,e,s){const n=this.getChainIndex_(t),i=this.m_chainIndices[e];i.size()<=n&&i.resize(this.m_chainData.size(),-1),i.write(n,s)}createUserIndexForChains(){const t=new o.A(this.m_chainData.capacity(),-1);for(let e=0,s=this.m_chainIndices.length;e<s;e++)if(null===this.m_chainIndices[e])return this.m_chainIndices[e]=t,e;return this.m_chainIndices.push(t),this.m_chainIndices.length-1}deleteUserIndexForChains(t){this.m_chainIndices[t]=null}extractPolygonFromChainAndIslands(t,e,s,n){const o=e===r.n?t.createGeometry(i.G.enumPolygon):e,a=new r.S;this.extractPolygonPathFromChain_(t,o,s,n,a);for(let i=this.getChainFirstIsland(s);i!==r.n;i=this.getChainNextInParent(i))this.extractPolygonPathFromChain_(t,o,i,n,a);return o}getGeometryID(t){const e=this.m_shape.getGeometryUserIndex(t,this.m_geometryIDIndex);return(0,i.g)(e>=0),1<<Math.min(e,31)}getClusterFromVertex(t){return this.m_shape.getUserIndex(t,this.m_clusterIndex)}getHalfEdgeFromVertex(t){return this.m_shape.getUserIndex(t,this.m_halfEdgeIndex)}buildGeometryParentageSets(){this.m_bBuildGeometryParentageSets=!0}getChainBitSet(t){if((0,i.g)(this.m_bBuildGeometryParentageSets),-1===this.m_chainBitSetIndex)return this.getEmptySet();const e=this.getChainUserIndex(t,this.m_chainBitSetIndex);(0,i.g)(e>=0);let s=this.m_chainBitSets.at(e);return s||(s=this.getEmptySet()),s}getChainBoundaryBitSet(t){(0,i.g)(this.m_bBuildGeometryParentageSets);const e=new H,s=t=>{const s=this.getChainHalfEdge(t);let n=s;do{const t=this.getEdgeBitSet_(n);null!==t&&e.assignOr(t);const s=this.getEdgeBitSet_(this.getHalfEdgeTwin(n));null!==s&&e.assignOr(s),n=this.getHalfEdgeNext(n)}while(n!==s)};s(t);for(let n=this.getChainFirstIsland(t);n!==r.n;n=this.getChainNextInParent(n))s(t);return e}getChainPolygons(t){return(0,i.g)(0),[]}getGeometriesFromBits(t){if(!this.m_bBuildGeometryParentageSets||null===t)return[];if(null===this.m_geometryMapID){this.m_geometryMapID=new Map;for(let t=this.m_shape.getFirstGeometry();t!==r.n;t=this.m_shape.getNextGeometry(t))this.m_geometryMapID.set(this.m_shape.getGeometryUserIndex(t,this.m_geometryIDIndex),t)}const e=[],s=t.getUnorderedBitIterator();for(let n=s.next();n!==B.npos();n=s.next())(0,i.g)(this.m_geometryMapID.has(n)),e.push(this.m_geometryMapID.get(n));return e}getVertexDominant(t,e){if(e===r.n)return t;const s=this.getClusterFromVertex(t);return this.getVertexDominantFromCluster(s,e)}getVertexDominantFromCluster(t,e){if(e!==r.n){let s=r.n;for(let n=this.getClusterVertexIterator(t);n!==r.n;n=this.incrementVertexIterator(n)){const t=this.getVertexFromVertexIterator(n);s===r.n&&(s=t);const i=this.m_shape.getPathFromVertex(t);if(this.m_shape.getGeometryFromPath(i)===e){s=t;break}}return s}{const e=this.getClusterVertexIterator(t);return e!==r.n?this.getVertexFromVertexIterator(e):r.n}}isBreakNode(t){return this.hasClusterUserIndexFlags(t,this.m_clusterBreakNodeIndex,$.enumSegmentParentageBreakNode)}setBreakNode(t,e){(0,i.g)(-1!==this.m_clusterBreakNodeIndex),e?this.setClusterUserIndexFlags(t,this.m_clusterBreakNodeIndex,$.enumSegmentParentageBreakNode):this.clearClusterUserIndexFlags(t,this.m_clusterBreakNodeIndex,$.enumSegmentParentageBreakNode)}isStrongPathNode(t){return this.hasClusterUserIndexFlags(t,this.m_clusterBreakNodeIndex,$.enumPathBreakNode)}setStrongPathNode(t,e){if(-1===this.m_clusterBreakNodeIndex){if(!e)return;this.m_clusterBreakNodeIndex=this.createUserIndexForClusters()}e?this.setClusterUserIndexFlags(t,this.m_clusterBreakNodeIndex,$.enumPathBreakNode):this.clearClusterUserIndexFlags(t,this.m_clusterBreakNodeIndex,$.enumPathBreakNode)}getSegmentParentage(t){if(-1===this.m_segmentParentageIndex)return-1;const e=this.getHalfEdgeUserIndex(t,this.m_segmentParentageIndex);return e>=0?e:-1}isCrossroadAhead(t){const e=this.getHalfEdgeNext(t);if(this.isStrongPathNode(this.getHalfEdgeOrigin(e)))return!0;const s=this.getHalfEdgeTwin(e),n=this.getHalfEdgeNext(s);return t!==this.getHalfEdgeTwin(n)}isCrossroadBehind(t){return(0,i.g)(0),!1}getHalfEdgeConnector(t,e){const s=this.getClusterHalfEdge(t);if(s===r.n)return r.n;let n=s,i=r.n,o=r.n;do{if(this.getHalfEdgeTo(n)===e)return n;if(i===r.n){if(i=this.getClusterHalfEdge(e),i===r.n)return r.n;o=i}if(this.getHalfEdgeTo(o)===t)return n=this.getHalfEdgeTwin(o),n;n=this.getHalfEdgeNext(this.getHalfEdgeTwin(n)),o=this.getHalfEdgeNext(this.getHalfEdgeTwin(o))}while(n!==s&&o!==i);return r.n}querySegmentXY(t,e){if(-1!==this.m_segmentIndexHe){let s=this.getHalfEdgeUserIndex(t,this.m_segmentIndexHe);if(-1!==s){if(-2!==s){const t=this.m_shape.getSegmentFromIndex(s);e.copyFrom(t,!0)}else{s=this.getHalfEdgeUserIndex(this.getHalfEdgeTwin(t),this.m_segmentIndexHe);const n=this.m_shape.getSegmentFromIndex(s);e.copyFrom(n,!0),e.get().reverse()}return}}e.createLine();const s=e.get(),n=a.P.getNAN();this.getHalfEdgeFromXY(t,n),s.setStartXY(n),this.getHalfEdgeToXY(t,n),s.setEndXY(n)}isCurveEdge(t){return-1!==this.m_segmentIndexHe&&-1!==this.getHalfEdgeUserIndex(t,this.m_segmentIndexHe)}compareEdgeAnglesCurveHelper_(t,e,s){const n=new r.S,o=new r.S;this.querySegmentXY(t,n),this.querySegmentXY(e,o);const l=n.get(),h=o.get();if(l.equals(h))return 0;const u=new a.P;this.getHalfEdgeFromXY(t,u);const c=new a.P;this.getHalfEdgeToXY(t,c);const m=new a.P;return this.getHalfEdgeToXY(e,m),(0,i.g)(!c.isEqualPoint2D(m)),(0,r.R)(l,h)}compareEdgeAnglesHelper_(t,e,s){if(t===e)return 0;if(this.isHalfEdgeCurve(t)||this.isHalfEdgeCurve(e))return this.compareEdgeAnglesCurveHelper_(t,e,s);const n=a.P.getNAN();this.getHalfEdgeToXY(t,n);const i=a.P.getNAN();if(this.getHalfEdgeToXY(e,i),n.isEqualPoint2D(i))return 0;const r=a.P.getNAN();this.getHalfEdgeFromXY(t,r);const o=a.P.getNAN();o.setSub(n,r);const l=a.P.getNAN();return l.setSub(i,r),!s||l.y>=0&&o.y>0?a.P.compareVectors(o,l):0}compareEdgeAngles_(t,e){return this.compareEdgeAnglesHelper_(t,e,!1)}compareEdgeAnglesForPair_(t,e){return this.compareEdgeAnglesHelper_(t,e,!0)}compareEdgeAngles3D_(t,e){return(0,i.g)(0),0}compareEdgeAnglesForPair3D_(t,e){return(0,i.g)(0),0}dbgDumpChains_(){}dbgDumpChainToPolygon_(t,e){}deleteEdgeInternal_(t){const e=this.getHalfEdgeChain(t),s=this.getHalfEdgeTwin(t),n=this.getHalfEdgeChain(s);(0,i.g)(n===e),(0,i.g)(t===this.getHalfEdgeNext(s)||s===this.getHalfEdgeNext(t));let o=this.getHalfEdgeNext(t);o===s&&(o=this.getHalfEdgeNext(o),o===t&&(o=r.n));const a=this.getChainIndex_(e),l=this.m_chainAreas.read(a);Number.isNaN(l)||(this.setChainArea_(e,Number.NaN),this.setChainPerimeter_(e,Number.NaN));const h=this.getChainHalfEdge(e);h!==t&&h!==s||this.setChainHalfEdge_(e,o),this.updateVertexToHalfEdgeConnection_(t,!0),this.deleteEdgeImpl_(t)}getFirstUnvisitedHalfEdgeOnCluster_(t,e,s){let n=e!==r.n?e:this.getClusterHalfEdge(t);if(n===r.n)return r.n;const i=n;for(;;){if(1!==this.getHalfEdgeUserIndex(n,s))return n;const t=this.getHalfEdgeNext(this.getHalfEdgeTwin(n));if(t===i)return r.n;n=t}}removeSpikes_(){let t=!1;const e=this.createUserIndexForHalfEdges();for(let s=this.getFirstCluster();s!==r.n;s=this.getNextCluster(s)){let n=r.n;for(;;){let i=this.getFirstUnvisitedHalfEdgeOnCluster_(s,n,e);if(i===r.n)break;n=this.getHalfEdgeNext(this.getHalfEdgeTwin(i));let o=i;for(;;){const s=this.getHalfEdgeNext(o),a=this.getHalfEdgePrev(o),l=this.getHalfEdgeTwin(o);if(a===l){if(this.deleteEdgeInternal_(o),t=!0,n!==o&&n!==l||(n=r.n),o===i||a===i){if(i=s,o===i||a===i)break;o=s;continue}}else this.setHalfEdgeUserIndex(o,e,1);if(o=s,o===i)break}}}return this.deleteUserIndexForHalfEdges(e),t}progress_(t,e=!1){}newCluster_(){const t=this.m_clusterData.newElement();return this.m_clusterData.setField(t,1,0),t}newHalfEdgePair_(){const t=this.m_halfEdgeData.newElement();this.m_halfEdgeData.setField(t,2,0),this.m_halfEdgeData.setField(t,3,0);const e=this.m_halfEdgeData.newElement();return this.m_halfEdgeData.setField(e,2,0),this.m_halfEdgeData.setField(e,3,0),this.setHalfEdgeTwin_(t,e),this.setHalfEdgeTwin_(e,t),t}newChain_(){const t=this.m_chainData.newElement();return this.m_chainData.setField(t,2,0),t}deleteChain_(t){return(0,i.g)(0),0}getClusterIndex_(t){return this.m_clusterData.elementToIndex(t)}setClusterVertexIterator_(t,e){this.m_clusterData.setField(t,7,e)}setClusterHalfEdge_(t,e){this.m_clusterData.setField(t,2,e)}setClusterParentage_(t,e){this.m_clusterData.setField(t,1,e)}setPrevCluster_(t,e){this.m_clusterData.setField(t,3,e)}setNextCluster_(t,e){this.m_clusterData.setField(t,4,e)}setClusterVertexIndex_(t,e){this.m_clusterData.setField(t,5,e)}getClusterVertexIndex_(t){return this.m_clusterData.getField(t,5)}setClusterChain_(t,e){this.m_clusterData.setField(t,6,e)}addClusterToExteriorChain_(t,e){this.setClusterChain_(e,t)}getHalfEdgeIndex_(t){return this.m_halfEdgeData.elementToIndex(t)}setHalfEdgeOrigin_(t,e){this.m_halfEdgeData.setField(t,1,e)}setHalfEdgeTwin_(t,e){this.m_halfEdgeData.setField(t,4,e)}setHalfEdgePrev_(t,e){this.m_halfEdgeData.setField(t,5,e)}setHalfEdgeNext_(t,e){this.m_halfEdgeData.setField(t,6,e)}setHalfEdgeChain_(t,e){this.m_halfEdgeData.setField(t,2,e)}setHalfEdgeParentage_(t,e){this.m_halfEdgeData.setField(t,3,e)}getHalfEdgeParentageMask_(t){return this.m_halfEdgeData.getField(t,3)}setHalfEdgeVertexIterator_(t,e){this.m_halfEdgeData.setField(t,7,e)}updateVertexToHalfEdgeConnectionHelper_(t,e){const s=e?r.n:t;for(let n=this.getHalfEdgeVertexIterator(t);n!==r.n;n=this.incrementVertexIterator(n)){const t=this.getVertexFromVertexIterator(n);this.m_shape.setUserIndex(t,this.m_halfEdgeIndex,s)}}updateVertexToHalfEdgeConnection_(t,e){t!==r.n&&(this.updateVertexToHalfEdgeConnectionHelper_(t,e),this.updateVertexToHalfEdgeConnectionHelper_(this.getHalfEdgeTwin(t),e))}getChainIndex_(t){return this.m_chainData.elementToIndex(t)}setChainHalfEdge_(t,e){this.m_chainData.setField(t,1,e)}setChainParentage_(t,e){this.m_chainData.setField(t,2,e)}setChainParent_(t,e){this.m_chainData.setField(t,3,e);const s=this.getChainFirstIsland(e);this.setChainNextInParent_(t,s),this.setChainFirstIsland_(e,t)}setChainFirstIsland_(t,e){this.m_chainData.setField(t,4,e)}setChainNextInParent_(t,e){this.m_chainData.setField(t,5,e)}setChainPrev_(t,e){this.m_chainData.setField(t,6,e)}setChainNext_(t,e){this.m_chainData.setField(t,7,e)}setChainArea_(t,e){const s=this.getChainIndex_(t);this.m_chainAreas.write(s,e)}setChainPerimeter_(t,e){const s=this.getChainIndex_(t);this.m_chainPerimeters.write(s,e)}updateChainAreaAndPerimeter_(t){const e=this.m_shape.hasCurves(),s=new a.K(0),n=new a.K(0),i=this.getChainHalfEdge(t),o=a.P.getNAN(),l=a.P.getNAN(),h=a.P.getNAN();this.getHalfEdgeFromXY(i,o),l.setCoordsPoint2D(o);let u=i;do{this.getHalfEdgeToXY(u,h),e&&this.isCurveEdge(u)||n.pe(a.P.distance(l,h)),this.getHalfEdgeChain(this.getHalfEdgeTwin(u))!==t&&s.pe((h.x-o.x-(l.x-o.x))*(h.y-o.y+(l.y-o.y))*.5),l.setCoordsPoint2D(h),u=this.getHalfEdgeNext(u)}while(u!==i);if(e){const e=new r.S;u=i;do{this.getHalfEdgeToXY(u,h);const i=this.isCurveEdge(u);if(i&&(this.querySegmentXY(u,e),n.pe(e.get().calculateLength2D())),this.getHalfEdgeChain(this.getHalfEdgeTwin(u))!==t&&i){const t=e.get().calculateArea2DHelper();s.pe(t)}u=this.getHalfEdgeNext(u)}while(u!==i)}const c=this.getChainIndex_(t);this.m_chainAreas.write(c,s.getResult()),this.m_chainPerimeters.write(c,n.getResult())}getChainTopmostEdge_(t){return(0,i.g)(0),0}planeSweepParentage_(t,e){const s=new j(this),n=new o.T;n.setCapacity(Math.trunc(this.m_pointCount/2)),n.setComparator(s);const i=[],l=this.createUserIndexForHalfEdges();let h=null;const u=a.P.getNAN();for(let a=this.getFirstCluster();a!==r.n;a=this.getNextCluster(a)){this.progress_(e);const c=this.getClusterHalfEdge(a);if(c!==r.n){if(i.length=0,!this.tryOptimizedInsertion_(n,l,i,a,c)){this.queryXY(a,u),s.setY(u.y);let t=c;do{const e=this.getHalfEdgeUserIndex(t,l);-1!==e&&(n.deleteNode(e),this.setHalfEdgeUserIndex(t,l,o.S.impossibleIndex2())),t=this.getHalfEdgeNext(this.getHalfEdgeTwin(t))}while(c!==t);t=c;do{if(-1===this.getHalfEdgeUserIndex(t,l)){const e=n.addElement(t);i.push(e)}t=this.getHalfEdgeNext(this.getHalfEdgeTwin(t))}while(c!==t)}for(let e=i.length-1;e>=0;e--){const s=i[e],r=n.getElement(s),o=this.getHalfEdgeTwin(r);this.setHalfEdgeUserIndex(o,l,s),this.planeSweepParentagePropagateParentage_(n,s,t)}}else if(this.getClusterChain(a)===r.n){null===h&&(h=new Z(this)),this.queryXY(a,u),h.setPointXY(u);const t=n.searchLowerBound(h);let e=this.m_universeChain;if(-1!==t){let s=n.getElement(t);this.getHalfEdgeChain(s)===this.getHalfEdgeChain(this.getHalfEdgeTwin(s))&&(s=this.getLeftSkipPolylines_(n,t)),s!==r.n&&(e=this.getHalfEdgeChain(s))}this.addClusterToExteriorChain_(e,a)}}this.deleteUserIndexForHalfEdges(l)}planeSweepParentagePropagateParentage_(t,e,s){const n=t.getElement(e),o=this.getHalfEdgeChain(n);if(this.getChainParent(o)!==r.n)return;const a=this.getLeftSkipPolylines_(t,e),l=this.getHalfEdgeTwin(n),h=this.getHalfEdgeChain(l);let u=this.getChainParent(o),c=this.getChainParent(h);if(a===r.n)u===r.n&&(h===o?(this.setChainParent_(h,this.m_universeChain),c=this.m_universeChain,u=c):(c===r.n&&(this.setChainParent_(h,this.m_universeChain),c=this.m_universeChain),this.setChainParent_(o,h),u=h));else{const t=this.getHalfEdgeChain(a);if(c===r.n){if(this.getChainArea(t)<=0){const e=this.getChainParent(t);this.setChainParent_(h,e),c=e}else this.setChainParent_(h,t),c=t;h===o&&(u=c)}}u===r.n&&(this.trySetChainParentFromTwin_(o,h),u=this.getChainParent(o)),(0,i.g)(u!==r.n),s===W.enumInputModeBuildGraph?this.propagateParentageBuildGraph_(t,e,n,a):s===W.enumInputModeSimplifyWinding?this.propagateParentageWinding_(t,e,n,a,l,o,h):s===W.enumInputModeSimplifyAlternate&&this.propagateParentageAlternate_(t,e,n,a,l,o,h)}propagateParentageBuildGraph_(t,e,s,n){let i,o=e;n===r.n?(o=t.getNext(o),i=this.getHalfEdgeChain(s)):i=this.getHalfEdgeChain(n);let a=null,l=this.getChainParentage(i);for(this.m_bBuildGeometryParentageSets&&(a=this.getChainBitSet(i));-1!==o;o=t.getNext(o)){const e=t.getElement(o),s=this.getHalfEdgeTwin(e);i=this.getHalfEdgeChain(e);const n=this.getHalfEdgeChain(s);if(this.m_bBuildGeometryParentageSets){let t=this.getChainBitSet(n);t=new H({copy:t}),t.assignOr(a),this.setChainBitSet_(n,t);let s=this.getChainBitSet(i);const r=this.getLeftEdgeBitSet_(e),o=new H({copy:a});if(o.assignSubtract(r),o.isZero())break;s=new H({copy:s}),s.assignOr(o),this.setChainBitSet_(i,s),a=s}const r=this.getChainParentage(n),h=r|l;h!==r&&this.setChainParentage_(n,h);let u=this.getChainParentage(i);const c=l&~this.getHalfEdgeUserIndex(e,this.m_tmpHalfEdgeParentageIndexLeft);if(c&&(u|=c,this.setChainParentage_(i,u)),0===c)break;l=u}}propagateParentageWinding_(t,e,s,n,o,a,l){if(a===l)return;let h=this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeWindingNumberIndex);h+=this.getHalfEdgeUserIndex(o,this.m_tmpHalfEdgeWindingNumberIndex);let u=0;const c=[],m=[];m.push(0);for(let d=t.getFirst();d!==e;d=t.getNext(d)){const e=t.getElement(d),s=this.getHalfEdgeTwin(e),n=this.getHalfEdgeChain(e),o=this.getHalfEdgeChain(s);if(n!==o){let t=this.getHalfEdgeUserIndex(e,this.m_tmpHalfEdgeWindingNumberIndex);t+=this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeWindingNumberIndex),u+=t;let a=!1;0!==c.length&&c.at(-1)===o&&(m.pop(),c.pop(),a=!0),(0,i.g)(this.getChainParent(o)!==r.n),a&&this.getChainParent(o)===n||(m.push(u),c.push(n))}}if(u+=h,0!==c.length&&c.at(-1)===l&&(m.pop(),c.pop()),0!==u){if(0===m.at(-1)){const t=this.m_simplifiedGeometry,e=this.getGeometryID(t);this.setChainParentage_(a,e)}}else if(0!==m.at(-1)){const t=this.m_simplifiedGeometry,e=this.getGeometryID(t);this.setChainParentage_(a,e)}}propagateParentageAlternate_(t,e,s,n,i,o,a){const l=this.m_simplifiedGeometry,h=this.getGeometryID(l);if(n===r.n)this.setChainParentage_(a,this.m_universeGeomID),1&this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(o,h):this.setChainParentage_(o,this.m_universeGeomID);else{const t=this.getChainParentage(a);if(0===t){const t=this.getHalfEdgeChain(n),e=this.getChainParentage(t);this.setChainParentage_(a,e),1&this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(o,e===h?this.m_universeGeomID:h):this.setChainParentage_(o,e)}else 1&this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(o,t===h?this.m_universeGeomID:h):this.setChainParentage_(o,t)}}tryOptimizedInsertion_(t,e,s,n,i){let a=i,l=-1,h=r.n,u=0;do{if(2===u)return!1;const t=this.getHalfEdgeUserIndex(a,e);if(-1!==t){if(-1!==l)return!1;l=t}else{if(h!==r.n)return!1;h=a}u++,a=this.getHalfEdgeNext(this.getHalfEdgeTwin(a))}while(i!==a);return h!==r.n&&-1!==l&&(this.setHalfEdgeUserIndex(t.getElement(l),e,o.S.impossibleIndex2()),t.setElement(l,h),s.push(l),!0)}trySetChainParentFromTwin_(t,e){const s=this.getChainArea(t);if(0===s)return!1;const n=this.getChainArea(e);if(s>0&&n<0||s<0&&n>0)return this.setChainParent_(t,e),!0;{const s=this.getChainParent(e);if(s!==r.n)return this.setChainParent_(t,s),!0}return!1}createHalfEdges_(t,e){this.m_halfEdgeIndex=this.m_shape.createUserIndex();for(let s=0,n=e.size();s<n;s++){const n=e.read(s),o=this.m_shape.getUserIndex(n,this.m_clusterIndex),a=this.m_shape.getPathFromVertex(n),l=this.m_shape.getGeometryFromPath(a),h=this.m_shape.getGeometryType(l);if((0,i.h)(h)){const e=this.m_shape.getNextVertex(n);if(e===r.n)continue;const s=this.m_shape.getUserIndex(e,this.m_clusterIndex);if(o===s)continue;const a=this.newHalfEdgePair_(),u=this.getHalfEdgeTwin(a),c=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(c,0,n),this.m_clusterVertices.setField(c,1,-1),this.setHalfEdgeVertexIterator_(a,c),this.m_shape.setUserIndex(n,this.m_halfEdgeIndex,a),this.setHalfEdgeOrigin_(a,o);const m=this.getClusterHalfEdge(o);if(m===r.n)this.setClusterHalfEdge_(o,a),this.setHalfEdgePrev_(a,u),this.setHalfEdgeNext_(u,a);else{const t=this.getHalfEdgePrev(m);this.setHalfEdgePrev_(m,u),this.setHalfEdgeNext_(u,m),this.setHalfEdgeNext_(t,a),this.setHalfEdgePrev_(a,t)}this.setHalfEdgeOrigin_(u,s);const d=this.getClusterHalfEdge(s);if(d===r.n)this.setClusterHalfEdge_(s,u),this.setHalfEdgeNext_(a,u),this.setHalfEdgePrev_(u,a);else{const t=this.getHalfEdgePrev(d);this.setHalfEdgePrev_(d,a),this.setHalfEdgeNext_(a,d),this.setHalfEdgeNext_(t,u),this.setHalfEdgePrev_(u,t)}const g=this.getGeometryID(l);if(t===W.enumInputModeBuildGraph){const t=h===i.G.enumPolygon?g:0;if(this.setHalfEdgeUserIndex(u,this.m_tmpHalfEdgeParentageIndex,0),this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeParentageIndex,t),this.setHalfEdgeUserIndex(u,this.m_tmpHalfEdgeParentageIndexLeft,t),this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeParentageIndexLeft,0),this.m_bBuildGeometryParentageSets){const t=new H,e=this.m_shape.getGeometryUserIndex(l,this.m_geometryIDIndex);t.setBit(e),this.setEdgeBitSet_(a,t),this.setEdgeBitSet_(u,null),this.setLeftEdgeBitSet_(u,t),this.setLeftEdgeBitSet_(a,null)}}else if(t===W.enumInputModeSimplifyWinding){const t=this.m_shape.getXY(n),s=this.m_shape.getXY(e);let i=0,r=0;t.compare(s)<0?i=1:r=-1,this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeWindingNumberIndex,i),this.setHalfEdgeUserIndex(u,this.m_tmpHalfEdgeWindingNumberIndex,r)}else t===W.enumInputModeSimplifyAlternate&&(this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeOddEvenNumberIndex,1),this.setHalfEdgeUserIndex(u,this.m_tmpHalfEdgeOddEvenNumberIndex,1));const p=h===i.G.enumPolygon?tt.c_EdgeBitMask:0;this.setHalfEdgeParentage_(a,g|p),this.setHalfEdgeParentage_(u,g|p)}}if(this.m_shape.hasCurves()){this.m_segmentIndexHe=this.createUserIndexForHalfEdges();for(let t=0,s=e.size();t<s;t++){const s=e.read(t);if(this.m_shape.getSegment(s)){const t=this.m_shape.getUserIndex(s,this.m_halfEdgeIndex);t!==r.n&&(this.setHalfEdgeUserIndex(t,this.m_segmentIndexHe,this.m_shape.getVertexIndex(s)),this.setHalfEdgeUserIndex(this.getHalfEdgeTwin(t),this.m_segmentIndexHe,-2))}}}}mergeVertexListsOfEdges_(t,e){{const s=this.getHalfEdgeVertexIterator(e);if(s!==r.n){const n=this.getHalfEdgeVertexIterator(t);this.m_clusterVertices.setField(s,1,n),this.setHalfEdgeVertexIterator_(t,s),this.setHalfEdgeVertexIterator_(e,r.n)}}const s=this.getHalfEdgeTwin(t),n=this.getHalfEdgeTwin(e);{const t=this.getHalfEdgeVertexIterator(n);if(t!==r.n){const e=this.getHalfEdgeVertexIterator(s);this.m_clusterVertices.setField(t,1,e),this.setHalfEdgeVertexIterator_(s,t),this.setHalfEdgeVertexIterator_(n,r.n)}}if(-1!==this.m_segmentIndexHe){let i=this.getHalfEdgeUserIndex(t,this.m_segmentIndexHe);if(-1!==i){if(-2===i){const s=this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe);this.setHalfEdgeUserIndex(t,this.m_segmentIndexHe,s)}if(i=this.getHalfEdgeUserIndex(s,this.m_segmentIndexHe),-2===i){const t=this.getHalfEdgeUserIndex(n,this.m_segmentIndexHe);this.setHalfEdgeUserIndex(s,this.m_segmentIndexHe,t)}}}}sortHalfEdgesByAngle_(t){const e=[];for(let s=this.getFirstCluster();s!==r.n;s=this.getNextCluster(s)){e.length=0;const n=this.getClusterHalfEdge(s);if(n!==r.n){let i=n;do{e.push(i),i=this.getHalfEdgeNext(this.getHalfEdgeTwin(i))}while(i!==n);if(e.length>1){let i=!0;e.length>2?(e.sort(((t,e)=>this.compareEdgeAngles_(t,e))),e.push(e[0])):this.compareEdgeAnglesForPair_(e[0],e[1])>0?e[1]=(0,a.c)(e[0],e[0]=e[1]):i=!1;let o=e[0],l=o,h=this.getHalfEdgeTo(l),u=this.getHalfEdgeTwin(l),c=r.n;for(let s=1,n=e.length;s<n;s++){const n=e[s],i=this.getHalfEdgeTwin(n),a=this.getHalfEdgeOrigin(i);if(a!==h||n===l)this.updateVertexToHalfEdgeConnection_(c,!1),c=r.n,l=n,h=a,u=i;else{if(t===W.enumInputModeBuildGraph){const t=this.getHalfEdgeParentageMask_(l)|this.getHalfEdgeParentageMask_(n);if(this.setHalfEdgeParentage_(l,t),this.setHalfEdgeParentage_(u,t),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(n,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(u,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(u,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(n,this.m_tmpHalfEdgeParentageIndexLeft)),this.setHalfEdgeUserIndex(u,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(u,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeParentageIndexLeft)),this.m_bBuildGeometryParentageSets){let t,e,s;t=this.getEdgeBitSet_(l),e=this.getEdgeBitSet_(n),s=new H({copy:t}),s.assignOr(e),this.setEdgeBitSet_(l,s),t=this.getEdgeBitSet_(u),e=this.getEdgeBitSet_(i),s=new H({copy:t}),s.assignOr(e),this.setEdgeBitSet_(u,s),t=this.getLeftEdgeBitSet_(l),e=this.getLeftEdgeBitSet_(n),s=new H({copy:t}),s.assignOr(e),this.setLeftEdgeBitSet_(l,s),t=this.getLeftEdgeBitSet_(u),e=this.getLeftEdgeBitSet_(i),s=new H({copy:t}),s.assignOr(e),this.setLeftEdgeBitSet_(u,s)}}else if(-1!==this.m_tmpHalfEdgeWindingNumberIndex){const t=this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(n,this.m_tmpHalfEdgeWindingNumberIndex),e=this.getHalfEdgeUserIndex(u,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeWindingNumberIndex);this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeWindingNumberIndex,t),this.setHalfEdgeUserIndex(u,this.m_tmpHalfEdgeWindingNumberIndex,e)}else if(-1!==this.m_tmpHalfEdgeOddEvenNumberIndex){const t=this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(n,this.m_tmpHalfEdgeOddEvenNumberIndex),e=this.getHalfEdgeUserIndex(u,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeOddEvenNumberIndex);this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeOddEvenNumberIndex,t),this.setHalfEdgeUserIndex(u,this.m_tmpHalfEdgeOddEvenNumberIndex,e)}this.mergeVertexListsOfEdges_(l,n),this.deleteEdgeImpl_(n),c=l,e[s]=r.n,n===o&&(e[0]=r.n,o=r.n)}}if(this.updateVertexToHalfEdgeConnection_(c,!1),c=r.n,!i){o=r.n;for(let t=0,s=e.length;t<s;t++){const s=e[t];if(s!==r.n){o=s;break}}n!==o&&this.setClusterHalfEdge_(s,o);continue}o=r.n;for(let t=0,s=e.length;t<s;t++){const s=e[t];if(s===r.n)continue;if(o===r.n){o=s,l=o,h=this.getHalfEdgeTo(l),u=this.getHalfEdgeTwin(l);continue}if(s===l)continue;const n=this.getHalfEdgeTwin(s),i=this.getHalfEdgeOrigin(n);this.setHalfEdgeNext_(u,s),this.setHalfEdgePrev_(s,u),l=s,h=i,u=n}this.setClusterHalfEdge_(s,o)}}}}sortHalfEdgesByAngle3D_(t){(0,i.g)(0)}buildChains_(t){this.m_universeChain=this.newChain_(),this.setChainHalfEdge_(this.m_universeChain,r.n);let e=this.m_universeChain;const s=this.createUserIndexForHalfEdges();for(let n=this.getFirstCluster();n!==r.n;n=this.getNextCluster(n)){const t=this.getClusterHalfEdge(n);if(t!==r.n){let n=t;do{if(1!==this.getHalfEdgeUserIndex(n,s)){const t=this.newChain_();this.setChainHalfEdge_(t,n),this.setChainPrev_(t,e),this.setChainNext_(e,t);let i=null;this.m_bBuildGeometryParentageSets&&(i=new H),e=t;let r=0,o=n;do{-1!==this.m_tmpHalfEdgeParentageIndex&&(r|=this.getHalfEdgeUserIndex(o,this.m_tmpHalfEdgeParentageIndex)),this.m_bBuildGeometryParentageSets&&i.assignOr(this.getEdgeBitSet_(o)),this.setHalfEdgeChain_(o,t),this.setHalfEdgeUserIndex(o,s,1),o=this.getHalfEdgeNext(o)}while(o!==n);this.m_bBuildGeometryParentageSets&&this.setChainBitSet_(t,i),this.setChainParentage_(t,r)}n=this.getHalfEdgeNext(this.getHalfEdgeTwin(n))}while(n!==t)}}this.m_chainAreas=new o.x(this.m_chainData.size(),Number.NaN),this.m_chainPerimeters=new o.x(this.m_chainData.size(),Number.NaN),this.setChainArea_(this.m_universeChain,Number.POSITIVE_INFINITY),this.setChainPerimeter_(this.m_universeChain,Number.POSITIVE_INFINITY),this.deleteUserIndexForHalfEdges(s)}simplify_(t){(0,i.g)(0)}simplifyAlternate_(){(0,i.g)(0)}simplifyWinding_(){(0,i.g)(0)}setEditShapeImpl_(t,e,s,n,l){this.removeShape(),this.m_bBuildChains=l,this.m_shape=t,this.m_geometryIDIndex=this.m_shape.createGeometryUserIndex();let h=this.m_shape.getTotalPointCount();if(s){h=0;for(let t=0,e=s.length;t<e;t++)h+=this.m_shape.getPointCount(s[t])}const u=new o.A(0);let c=0,m=0;{let t=null!=s?s[0]:this.m_shape.getFirstGeometry(),e=1;for(;t!==r.n;){this.m_shape.setGeometryUserIndex(t,this.m_geometryIDIndex,m++);for(let e=this.m_shape.getFirstPath(t);e!==r.n;e=this.m_shape.getNextPath(e)){let t=this.m_shape.getFirstVertex(e);for(let s=0,n=this.m_shape.getPathSize(e);s<n;s++)u.add(t),t=this.m_shape.getNextVertex(t)}(0,i.e)(this.m_shape.getGeometryType(t))||(c+=this.m_shape.getPathCount(t)),null!=s?(t=e<s.length?s[e]:r.n,e++):t=this.m_shape.getNextGeometry(t)}}this.m_universeGeomID=1<<Math.min(m,31),this.m_pointCount=u.size(),this.m_shape.sortVerticesSimpleByY(u,0,this.m_pointCount),this.m_clusterVertices.setCapacity(this.m_pointCount),this.progress_(n,!0),this.m_clusterData.setCapacity(this.m_pointCount+10),this.m_halfEdgeData.setCapacity(2*this.m_pointCount+32),this.m_chainData.setCapacity(Math.max(32,c)),this.m_clusterIndex=this.m_shape.createUserIndex();const d=a.P.getNAN();let g=0;const p=a.P.getNAN();for(let i=0;i<=this.m_pointCount;i++){if(i<this.m_pointCount){const t=u.read(i);this.m_shape.queryXY(t,p)}else p.setNAN();if(!d.isEqualPoint2D(p)){if(g<i){const t=this.newCluster_();let e=r.n,s=-1;for(let n=g;n<i;n++){s=u.read(n),this.m_shape.setUserIndex(s,this.m_clusterIndex,t);const i=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(i,0,s),this.m_clusterVertices.setField(i,1,e),e=i;const r=this.m_shape.getPathFromVertex(s),o=this.m_shape.getGeometryFromPath(r),a=this.getGeometryID(o);this.setClusterParentage_(t,this.getClusterParentage(t)|a)}this.setClusterVertexIterator_(t,e),this.setClusterVertexIndex_(t,this.m_shape.getVertexIndex(s)),this.m_lastCluster!==r.n&&this.setNextCluster_(this.m_lastCluster,t),this.setPrevCluster_(t,this.m_lastCluster),this.m_lastCluster=t,this.m_firstCluster===r.n&&(this.m_firstCluster=t)}g=i,d.setCoordsPoint2D(p)}}if(this.m_shape.hasSegmentParentage()){-1===this.m_clusterBreakNodeIndex&&(this.m_clusterBreakNodeIndex=this.createUserIndexForClusters());for(let t=0;t<this.m_pointCount;t++){const e=u.read(t);if(this.m_shape.getSegmentParentageBreakVertex(e)){const t=this.getClusterFromVertex(e);this.setBreakNode(t,!0)}}}this.progress_(n,!0);{let t=null!=s?s[0]:this.m_shape.getFirstGeometry(),e=1;for(;t!==r.n;){for(let e=this.m_shape.getFirstPath(t);e!==r.n;e=this.m_shape.getNextPath(e)){if(this.m_shape.isStrongPathStart(e)){const t=this.m_shape.getFirstVertex(e),s=this.getClusterFromVertex(t);this.setStrongPathNode(s,!0)}if(this.m_shape.isStrongPathEnd(e)){const t=this.m_shape.isClosedPath(e)?this.m_shape.getFirstVertex(e):this.m_shape.getLastVertex(e),s=this.getClusterFromVertex(t);this.setStrongPathNode(s,!0)}}null!=s?(t=e<s.length?s[e]:r.n,e++):t=this.m_shape.getNextGeometry(t)}}if(e===W.enumInputModeBuildGraph&&(this.m_tmpHalfEdgeParentageIndex=this.createUserIndexForHalfEdges(),this.m_tmpHalfEdgeParentageIndexLeft=this.createUserIndexForHalfEdges()),e===W.enumInputModeSimplifyWinding&&(this.m_tmpHalfEdgeWindingNumberIndex=this.createUserIndexForHalfEdges()),e===W.enumInputModeSimplifyAlternate&&(this.m_tmpHalfEdgeOddEvenNumberIndex=this.createUserIndexForHalfEdges()),this.createHalfEdges_(e,u),this.dbgNavigate_(),this.sortHalfEdgesByAngle_(e),!Number.isNaN(this.m_checkDirtyPlanesweepTolerance)&&!this.checkStructureAfterDirtySweep_())return this.m_bDirtyCheckFailed=!0,void this.cleanSetEditShapeImpl_();this.buildChains_(e),-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),this.m_bBuildChains&&this.planeSweepParentage_(e,n),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),this.dbgChkChainParents_(),this.dbgDumpChains_(),this.mergeSegmentParentage_(),this.dbgNavigate_(),this.dbgDumpChains_(),this.cleanSetEditShapeImpl_()}setEditShapeImpl3D_(t,e,s,n,r){(0,i.g)(0)}cleanSetEditShapeImpl_(){-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),-1!==this.m_tmpHalfEdgeWindingNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1),-1!==this.m_tmpHalfEdgeOddEvenNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1)}cleanSetEditShapeImpl3D_(){(0,i.g)(0)}dbgNavigate_(){}dbgChkChainParents_(){}deleteEdgeImpl_(t){const e=this.getHalfEdgeNext(t),s=this.getHalfEdgePrev(t),n=this.getHalfEdgeTwin(t),i=this.getHalfEdgeNext(n),o=this.getHalfEdgePrev(n);e!==n&&(this.setHalfEdgeNext_(o,e),this.setHalfEdgePrev_(e,o)),s!==n&&(this.setHalfEdgeNext_(s,i),this.setHalfEdgePrev_(i,s));const a=this.getHalfEdgeOrigin(t);this.getClusterHalfEdge(a)===t&&(i!==t?this.setClusterHalfEdge_(a,i):this.setClusterHalfEdge_(a,r.n));const l=this.getHalfEdgeOrigin(n);this.getClusterHalfEdge(l)===n&&(e!==n?this.setClusterHalfEdge_(l,e):this.setClusterHalfEdge_(l,r.n)),this.m_halfEdgeData.deleteElement(t),this.m_halfEdgeData.deleteElement(n)}getLeftSkipPolylines_(t,e){let s=e;for(;;){if(s=t.getPrev(s),-1===s)return r.n;{const e=t.getElement(s);if(this.getHalfEdgeChain(e)!==this.getHalfEdgeChain(this.getHalfEdgeTwin(e)))return e}}}checkStructureAfterDirtySweep_(){const t=(0,a.a)(this.m_checkDirtyPlanesweepTolerance),e=new a.P,s=new a.P,n=new a.P,i=new a.P,o=new a.P;for(let a=this.getFirstCluster();a!==r.n;a=this.getNextCluster(a)){const l=this.getClusterHalfEdge(a);if(l!==r.n){let r=l;this.getHalfEdgeFromXY(r,e),this.getHalfEdgeToXY(r,s),n.setSub(s,e);let a=n.sqrLength();do{const l=r;if(r=this.getHalfEdgeNext(this.getHalfEdgeTwin(r)),r!==l){this.getHalfEdgeToXY(r,i),o.setSub(i,e);const l=o.sqrLength(),h=o.crossProduct(n),u=h*h/(l*a);if(Math.min(l,a)*u<=t&&o.dotProduct(n)>=0)return!1;n.assign(o),a=l,s.assign(i)}}while(r!==l)}}return!0}extractPolygonPathFromChain_(t,e,s,n,i){const a=this.m_shape.hasSegmentParentage(),l=this.getChainHalfEdge(s);let h=l,u=r.n;const c=new o.P;do{const o=this.getHalfEdgeTwin(h);if(this.getHalfEdgeChain(o)!==s){let s=r.n;const o=this.getHalfEdgeOrigin(h);if(n===r.n){const t=this.getClusterVertexIterator(o);s=this.getVertexFromVertexIterator(t)}else for(let t=this.getClusterVertexIterator(o);t!==r.n;t=this.incrementVertexIterator(t)){const e=this.getVertexFromVertexIterator(t);s===r.n&&(s=e);const i=this.m_shape.getPathFromVertex(e);if(this.m_shape.getGeometryFromPath(i)===n){s=e;break}}let l;if(u===r.n&&(u=t.insertPath(e,r.n),t.setClosedPath(u,!0)),this.m_shape===t?l=t.addVertex(u,s):(this.m_shape.queryPoint(s,c),l=t.addPoint(u,c)),this.isHalfEdgeCurve(h)&&(this.querySegmentXY(h,i),t.setSegmentToIndex(t.getVertexIndex(l),i.get().clone())),a){const e=this.getSegmentParentage(h);t.setSegmentParentageAndBreak(l,e,this.isBreakNode(o))}}h=this.getHalfEdgeNext(h)}while(h!==l)}mergeSegmentParentage_(){if(!this.m_shape.hasSegmentParentage())return;(0,i.g)(-1!==this.m_clusterBreakNodeIndex),(0,i.g)(-1===this.m_segmentParentageIndex);for(let n=this.getFirstCluster();n!==r.n;n=this.getNextCluster(n)){let t=0;const e=this.getClusterHalfEdge(n);if(e!==r.n){let s=e;do{t++,s=this.getHalfEdgeNext(this.getHalfEdgeTwin(s))}while(s!==e&&t<3)}2!==t&&this.setBreakNode(n,!0)}let t=[],e=[];this.m_segmentParentageIndex=this.createUserIndexForHalfEdges();const s=this.createUserIndexForHalfEdges();for(let n=this.getFirstCluster();n!==r.n;n=this.getNextCluster(n)){const i=this.getClusterHalfEdge(n);if(i!==r.n){let n=!1,r=i;do{let i=r;for(;-1===this.getHalfEdgeUserIndex(i,s);){const r=this.getHalfEdgeNext(i),o=this.getHalfEdgeTwin(i);J(this,i,e);const l=e.at(-1).parentage;if(!n){const e=this.getHalfEdgeOrigin(i);if(!this.isBreakNode(e)){const e=this.getHalfEdgePrev(i);i!==e&&(J(this,e,t),n=!0)}}if(n&&!Q(e,t)){const t=this.getHalfEdgeOrigin(i);this.setBreakNode(t,!0)}t=(0,a.c)(e,e=t),n=!0;const h=this.getHalfEdgeOrigin(r);this.isBreakNode(h)&&(n=!1),this.setHalfEdgeUserIndex(i,this.m_segmentParentageIndex,l),this.setHalfEdgeUserIndex(o,this.m_segmentParentageIndex,l),this.setHalfEdgeUserIndex(i,s,1),this.setHalfEdgeUserIndex(o,s,1),i=r}r=this.getHalfEdgeNext(this.getHalfEdgeTwin(r))}while(r!==i)}}this.deleteUserIndexForHalfEdges(s)}registerNewBitSet(t){return null===this.m_uniqueBitSets&&(this.m_uniqueBitSets=new X((t=>t.getHashCode()),((t,e)=>t.equals(e))),this.m_uniqueBitSets.add(this.getEmptySet())),null===t?this.getEmptySet():this.m_uniqueBitSets.has(t)?this.m_uniqueBitSets.get(t):(this.m_uniqueBitSets.add(t),t)}getLeftEdgeBitSet_(t){const e=this.getHalfEdgeUserIndex(t,this.m_edgeBitSetIndexLeft);return(0,i.g)(e>=0),(0,i.g)(this.m_edgeBitSets.at(e)),this.m_edgeBitSets.at(e)}getEdgeBitSet_(t){const e=this.getHalfEdgeUserIndex(t,this.m_edgeBitSetIndex);return(0,i.g)(e>=0),this.m_edgeBitSets.at(e)}setEdgeBitSet_(t,e){(0,i.g)(this.m_bBuildGeometryParentageSets),e=this.registerNewBitSet(e),-1===this.m_edgeBitSetIndex&&(this.m_edgeBitSetIndex=this.createUserIndexForHalfEdges());const s=this.getHalfEdgeUserIndex(t,this.m_edgeBitSetIndex);-1!==s?this.m_edgeBitSets[s]=e:(this.setHalfEdgeUserIndex(t,this.m_edgeBitSetIndex,this.m_edgeBitSets.length),this.m_edgeBitSets.push(e))}setLeftEdgeBitSet_(t,e){(0,i.g)(this.m_bBuildGeometryParentageSets),e=this.registerNewBitSet(e),-1===this.m_edgeBitSetIndexLeft&&(this.m_edgeBitSetIndexLeft=this.createUserIndexForHalfEdges());const s=this.getHalfEdgeUserIndex(t,this.m_edgeBitSetIndexLeft);-1!==s?this.m_edgeBitSets[s]=e:(this.setHalfEdgeUserIndex(t,this.m_edgeBitSetIndexLeft,this.m_edgeBitSets.length),this.m_edgeBitSets.push(e))}setChainBitSet_(t,e){(0,i.g)(this.m_bBuildGeometryParentageSets),e=this.registerNewBitSet(e),-1===this.m_chainBitSetIndex&&(this.m_chainBitSetIndex=this.createUserIndexForChains());const s=this.getChainUserIndex(t,this.m_chainBitSetIndex);-1!==s?this.m_chainBitSets[s]=e:(this.setChainUserIndex(t,this.m_chainBitSetIndex,this.m_chainBitSets.length),this.m_chainBitSets.push(e))}getEmptySet(){return this.m_emptyBitSet||(this.m_emptyBitSet=new H),this.m_emptyBitSet}deleteEdgeBitSets_(){-1!==this.m_edgeBitSetIndex&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndex),this.m_edgeBitSetIndex=-1),-1!==this.m_edgeBitSetIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndexLeft),this.m_edgeBitSetIndexLeft=-1),this.m_edgeBitSets.length=0,this.m_uniqueBitSets=null}deleteChainBitSets_(){-1!==this.m_chainBitSetIndex&&(this.deleteUserIndexForChains(this.m_chainBitSetIndex),this.m_chainBitSetIndex=-1,this.m_chainBitSets.length=0)}dbgPrintEdge_(t){}dbgVerifyEdgeSegment(t){}}tt.c_EdgeParentageMask=~(1<<31),tt.c_EdgeBitMask=1<<31;class et{freeNode_(t){this.m_listNodes.deleteElement(t)}newNode_(){return this.m_listNodes.newElement()}freeList_(t){this.m_lists.deleteElement(t)}newList_(){return this.m_lists.newElement()}Init_(t){(0,i.g)(0)}constructor(t){this.m_listNodes=new o.S(2),this.m_listOfLists=et.st_nullNode(),this.m_bAllowNavigationBetweenLists=!0,void 0===t&&(t=!0),this.m_bAllowNavigationBetweenLists=t,this.m_lists=new o.S(this.m_bAllowNavigationBetweenLists?4:2)}createList(){const t=this.newList_();return this.m_bAllowNavigationBetweenLists&&(this.m_lists.setField(t,3,this.m_listOfLists),this.m_listOfLists!==et.st_nullNode()&&this.m_lists.setField(this.m_listOfLists,2,t),this.m_listOfLists=t),t}deleteList(t){let e=this.getFirst(t);for(;e!==et.st_nullNode();){const t=e;e=this.getNext(e),this.freeNode_(t)}if(this.m_bAllowNavigationBetweenLists){const e=this.m_lists.getField(t,2),s=this.m_lists.getField(t,3);e!==et.st_nullNode()?this.m_lists.setField(e,3,s):this.m_listOfLists=s,s!==et.st_nullNode()&&this.m_lists.setField(s,2,e)}this.freeList_(t)}reserveLists(t){this.m_lists.setCapacity(t)}addElement(t,e){this.m_lists.getField(t,0);const s=this.m_lists.getField(t,1),n=this.newNode_();return s!==et.st_nullNode()?(this.m_listNodes.setField(s,1,n),this.m_lists.setField(t,1,n)):(this.m_lists.setField(t,0,n),this.m_lists.setField(t,1,n)),this.m_listNodes.setField(n,0,e),n}reserveNodes(t){this.m_listNodes.setCapacity(t)}deleteElementDirect(t,e,s){e!==et.st_nullNode()?(this.m_listNodes.setField(e,1,this.m_listNodes.getField(s,1)),this.m_lists.getField(t,1)===s&&this.m_lists.setField(t,1,e)):(this.m_lists.setField(t,0,this.m_listNodes.getField(s,1)),this.m_lists.getField(t,1)===s&&this.m_lists.setField(t,1,et.st_nullNode())),this.freeNode_(s)}deleteElementSearch(t,e){let s=-1,n=this.getFirst(t);for(;n!==e;)s=n,n=this.getNext(n);this.deleteElementDirect(t,s,e)}concatenateLists(t,e){const s=this.m_lists.getField(t,1),n=this.m_lists.getField(e,0);if(n!==et.st_nullNode()&&(s!==et.st_nullNode()?(this.m_listNodes.setField(s,1,n),this.m_lists.setField(t,1,this.m_lists.getField(e,1))):(this.m_lists.setField(t,0,n),this.m_lists.setField(t,1,this.m_lists.getField(e,1)))),this.m_bAllowNavigationBetweenLists){const t=this.m_lists.getField(e,2),s=this.m_lists.getField(e,3);t!==et.st_nullNode()?this.m_lists.setField(t,3,s):this.m_listOfLists=s,s!==et.st_nullNode()&&this.m_lists.setField(s,2,t)}return this.freeList_(e),t}getElement(t){return this.m_listNodes.getField(t,0)}getData(t){return this.getElement(t)}setElement(t,e){(0,i.g)(0)}getNext(t){return this.m_listNodes.getField(t,1)}getFirst(t){return this.m_lists.getField(t,0)}getFirstElement(t){const e=this.getFirst(t);return this.getElement(e)}static st_nullNode(){return-1}clear(){this.m_listNodes.deleteAll(!0),this.m_lists.deleteAll(!0),this.m_listOfLists=et.st_nullNode()}isEmpty(t){return(0,i.g)(0),!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getFirstList(){return this.m_listOfLists}getNextList(t){return this.m_lists.getField(t,3)}}function st(t=-1){return{m_value:t,m_line:new r.L,m_segment:null,m_segmentInfo:new r.a6(-1),m_env:new a.E(0,0),m_dxdy:55555555,m_bHorizontal:!1,m_bCurve:!1}}class nt extends o.a3{constructor(t,e,s){super(!0),this.m_bIntersectionDetected=!1,this.m_nonSimpleResult=new d.NonSimpleResult,this.m_tempSimpleEdge1=st(),this.m_tempSimpleEdge2=st(),this.m_prev1=r.n,this.m_prev2=r.n,this.m_vertex1=r.n,this.m_vertex2=r.n,this.m_currentNode=-1,this.m_prevX1=Number.NaN,this.m_prevX2=Number.NaN,this.m_prevY=Number.NaN,this.m_prevX=0,this.m_sweepY=Number.NaN,this.m_sweepX=0,this.m_ptSweep=new a.P,this.m_simpleEdgesCache=[],this.m_simpleEdgesRecycle=[],this.m_cOutstandingConstructedEdges=0,this.m_shape=t,this.m_bShapeHasSegments=this.m_shape.hasCurves(),this.m_tolerance=e,this.m_tolerance10=10*e,this.m_bIsSimple=s;const n=Math.trunc(Math.min(3*t.getTotalPointCount()/2,67)),i=Math.min(7,n);this.m_simpleEdgesCache.length=i}tryGetCachedEdge_(t){const e=this.m_simpleEdgesCache[(t&(0,a.j)())%this.m_simpleEdgesCache.length];return e&&e.m_value===t?e:null}tryDeleteCachedEdge_(t){const e=(t&(0,a.j)())%this.m_simpleEdgesCache.length,s=this.m_simpleEdgesCache[e];s&&s.m_value===t&&(this.m_simpleEdgesRecycle.push(s),this.m_simpleEdgesCache[e]=null)}tryCreateCachedEdge_(t){const e=(t&(0,a.j)())%this.m_simpleEdgesCache.length;let s=this.m_simpleEdgesCache[e];return s?null:(0===this.m_simpleEdgesRecycle.length?(s=st(),this.m_cOutstandingConstructedEdges++):s=this.m_simpleEdgesRecycle.pop(),s.m_value=t,this.m_simpleEdgesCache[e]=s,s)}initSimpleEdge_(t,e){this.m_bShapeHasSegments&&this.initSimpleEdgeHelper_(t,e)||t.m_bCurve||(this.m_shape.queryLineConnector(e,t.m_line,!0),t.m_segment=t.m_line,t.m_env.setCoordsNoNAN(t.m_line.getStartX(),t.m_line.getEndX()),t.m_env.vmax+=this.m_tolerance,t.m_line.orientBottomUp(),t.m_bHorizontal=t.m_line.getEndY()===t.m_line.getStartY(),t.m_bHorizontal||(t.m_dxdy=(t.m_line.getEndX()-t.m_line.getStartX())/(t.m_line.getEndY()-t.m_line.getStartY())))}initSimpleEdgeHelper_(t,e){if(t.m_segment=this.m_shape.getSegment(e),t.m_segmentInfo=this.m_shape.getOriginalSegmentInfo(e),t.m_bCurve=null!==t.m_segment,t.m_bCurve){const e=t.m_segment.clone();return e.orientBottomUp(),t.m_segment=e,t.m_env=t.m_segment.queryInterval(0,0),t.m_env.vmax+=this.m_tolerance,!0}return!1}compareTwoSegments_(t,e){const s=t.getStartXY(),n=t.getEndXY(),i=e.getStartXY(),r=e.getEndXY();if(this.m_ptSweep.setCoords(this.m_sweepX,this.m_sweepY),s.isEqualPoint2D(i)&&this.m_sweepY===s.y){this.m_ptSweep.assign(n.compare(r)<0?n:r);const s=t.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),i=e.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x);if(Math.abs(s-i)>this.m_tolerance)return s<i?-1:1}const o=s.compare(i)<0?i:s,l=n.compare(r)<0?n:r;let h=0,u=0;for(let c=1;c<5;c++){(0,a.U)(o,l,c/5,this.m_ptSweep);const s=t.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),n=e.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),i=Math.abs(s-n);i>h&&(h=i,u=s<n?-1:1)}return 0===u?this.errorCracking():u}compareNonHorizontal_(t,e){if(t.m_line.getStartY()===e.m_line.getStartY()&&t.m_line.getStartX()===e.m_line.getStartX())return t.m_line.getEndY()===e.m_line.getEndY()&&t.m_line.getEndX()===e.m_line.getEndX()?this.m_bIsSimple?this.errorCoincident():0:this.compareNonHorizontalUpperEnd_(t,e);if(t.m_line.getEndY()===e.m_line.getEndY()&&t.m_line.getEndX()===e.m_line.getEndX())return this.compareNonHorizontalLowerEnd_(t,e);const s=this.compareNonHorizontalLowerEnd_(t,e),n=this.compareNonHorizontalUpperEnd_(t,e);return s<0&&n<0?-1:s>0&&n>0?1:this.errorCracking()}compareHorizontal1Case1_(t,e){if(t.getEndX()>e.getEndX()){if(e.getEndX()>e.getStartX()&&e.getEndY()-e.getStartY()<2*this.m_tolerance&&t.isIntersectingPoint(e.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((e.getEndY()-e.getStartY())/(e.getEndX()-e.getStartX())*(t.getEndX()-t.getStartX())<this.m_tolerance10&&e.isIntersectingPoint(t.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return 1}compareHorizontal1Case2_(t,e){if(t.getStartX()<e.getStartX()){if(e.getEndX()>e.getStartX()&&e.getEndY()-e.getStartY()<2*this.m_tolerance&&t.isIntersectingPoint(e.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((e.getEndY()-e.getStartY())/(e.getEndX()-e.getStartX())*(t.getStartX()-t.getEndX())<this.m_tolerance10&&e.isIntersectingPoint(t.getStartXY(),this.m_tolerance,!0))return this.errorCracking();return-1}compareHorizontal1Case3_(t,e){const s=a.P.getNAN();s.setSub(e.getEndXY(),e.getStartXY()),s.rightPerpendicularThis(),s.normalize();const n=a.P.getNAN();n.setSub(t.getStartXY(),e.getStartXY());const i=a.P.getNAN();i.setSub(t.getEndXY(),e.getStartXY());const r=n.dotProduct(s),o=i.dotProduct(s),l=Math.abs(r),h=Math.abs(o);if(l<h){if(l<this.m_tolerance10&&e.isIntersectingPoint(t.getStartXY(),this.m_tolerance,!0))return this.errorCracking()}else if(h<this.m_tolerance10&&e.isIntersectingPoint(t.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return r<0&&o<0?-1:r>0&&o>0?1:this.errorCracking()}compareHorizontal1_(t,e){return t.getStartY()===e.getStartY()&&t.getStartX()===e.getStartX()?this.compareHorizontal1Case1_(t,e):t.getEndY()===e.getEndY()&&t.getEndX()===e.getEndX()?this.compareHorizontal1Case2_(t,e):this.compareHorizontal1Case3_(t,e)}compareHorizontal2_(t,e){return t.getEndY()===e.getEndY()&&t.getEndX()===e.getEndX()&&t.getStartY()===e.getStartY()&&t.getStartX()===e.getStartX()?this.m_bIsSimple?this.errorCoincident():0:this.errorCracking()}compareNonHorizontalLowerEnd_(t,e){let s=1;if(t.m_line.getStartY()<e.m_line.getStartY()){s=-1;const n=t;t=e,e=n}const n=t.m_line,i=e.m_line,r=n.getStartX()-i.getStartX(),o=e.m_dxdy*(n.getStartY()-i.getStartY()),a=this.m_tolerance10;return r<o-a?-s:r>o+a?s:i.isIntersectingPoint(n.getStartXY(),this.m_tolerance,!0)?this.errorCracking():r<o?-s:s}compareNonHorizontalUpperEnd_(t,e){let s=1;if(e.m_line.getEndY()<t.m_line.getEndY()){s=-1;const n=t;t=e,e=n}const n=t.m_line,i=e.m_line,r=n.getEndX()-i.getStartX(),o=e.m_dxdy*(n.getEndY()-i.getStartY()),a=this.m_tolerance10;return r<o-a?-s:r>o+a?s:i.isIntersectingPoint(n.getEndXY(),this.m_tolerance,!0)?this.errorCracking():r<o?-s:s}errorCoincident(){this.m_bIntersectionDetected=!0;return this.m_nonSimpleResult=new d.NonSimpleResult(7,this.m_vertex1,this.m_vertex2),-1}errorCracking(){if(this.m_bIntersectionDetected=!0,this.m_bIsSimple){const t=6;this.m_nonSimpleResult=new d.NonSimpleResult(t,this.m_vertex1,this.m_vertex2)}else this.m_prev1=r.n,this.m_prev2=r.n,this.m_vertex1=r.n,this.m_vertex2=r.n;return-1}compareSegments_(t,e,s,n){if(s.m_env.vmax<n.m_env.vmin)return-1;if(n.m_env.vmax<s.m_env.vmin)return 1;if(!s.m_bCurve&&!n.m_bCurve){let t=s.m_bHorizontal?1:0;return t|=n.m_bHorizontal?2:0,0===t?this.compareNonHorizontal_(s,n):1===t?this.compareHorizontal1_(s.m_line,n.m_line):2===t?-1*this.compareHorizontal1_(n.m_line,s.m_line):this.compareHorizontal2_(s.m_line,n.m_line)}if(this.m_bIntersectionDetected)return-1;const i=this.m_prevY===this.m_sweepY&&this.m_prevX===this.m_sweepX;let o,a;if(i&&t===this.m_prev1?o=this.m_prevX1:(o=Number.NaN,this.m_prev1=r.n),i&&e===this.m_prev2?a=this.m_prevX2:(a=Number.NaN,this.m_prev2=r.n),this.m_prevY=this.m_sweepY,this.m_prevX=this.m_sweepX,Number.isNaN(o)){this.m_prev1=t;const e=s.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX);o=e,this.m_prevX1=e}if(Number.isNaN(a)){this.m_prev2=e;const t=n.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX);a=t,this.m_prevX2=t}const l=(0,r.Y)(!0,!0,s.m_segment,n.m_segment,this.m_tolerance,!0);return 0!==l?2===l?this.m_bIsSimple?this.errorCoincident():s.m_segmentInfo.equals(n.m_segmentInfo)?0:this.errorCracking():this.errorCracking():Math.abs(o-a)<=this.m_tolerance?this.compareTwoSegments_(s.m_segment,n.m_segment):o<a?-1:o>a?1:0}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1}intersectionDetected(){return this.m_bIntersectionDetected}getLastComparedNode(){return this.m_currentNode}getResult(){return this.m_nonSimpleResult}setSweepY(t,e){this.m_sweepY=t,this.m_sweepX=e,this.m_prev1=r.n,this.m_prev2=r.n,this.m_vertex1=r.n,this.m_vertex2=r.n}compare(t,e,s){if(this.m_bIntersectionDetected)return-1;const n=t.getElement(s),i=e;return this.m_currentNode=s,this.compareSegments(i,i,n,n)}compareSegments(t,e,s,n){let i=this.tryGetCachedEdge_(t);null===i?this.m_vertex1===e?i=this.m_tempSimpleEdge1:(this.m_vertex1=e,i=this.tryCreateCachedEdge_(t),null===i&&(i=this.m_tempSimpleEdge1,this.m_tempSimpleEdge1.m_value=t),this.initSimpleEdge_(i,e)):this.m_vertex1=e;let r=this.tryGetCachedEdge_(s);return null===r?this.m_vertex2===n?r=this.m_tempSimpleEdge2:(this.m_vertex2=n,r=this.tryCreateCachedEdge_(s),null===r&&(r=this.m_tempSimpleEdge2,this.m_tempSimpleEdge2.m_value=s),this.initSimpleEdge_(r,n)):this.m_vertex2=n,this.compareSegments_(e,n,i,r)}onDelete(t){this.tryDeleteCachedEdge_(t)}onSet(t){this.tryDeleteCachedEdge_(t)}onEndSearch(t){this.tryDeleteCachedEdge_(t)}onAddUniqueElementFailed(t){this.tryDeleteCachedEdge_(t)}}class it{constructor(t,e){this.m_bIntersectionDetected=!1,this.m_pointOfInterest=a.P.getNAN(),this.m_line1=new r.L,this.m_seg1=null,this.m_env=a.E.constructEmpty(),this.m_vertex1=-1,this.m_currentNode=-1,this.m_minDist=Number.MAX_VALUE,this.m_shape=t,this.m_tolerance=e}getCurrentNode(){return this.m_currentNode}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1,this.m_minDist=Number.MAX_VALUE}intersectionDetected(){return this.m_bIntersectionDetected}setPoint(t){this.m_pointOfInterest.assign(t)}compare(t,e){const s=t.getElement(e);return this.compareVertex(t,e,s)}compareVertex(t,e,s){let i,o=this.m_shape.getSegment(s),l=!0;if(null==o)this.m_shape.queryLineConnector(s,this.m_line1,!0),this.m_env.setCoordsNoNAN(this.m_line1.getStartX(),this.m_line1.getEndX()),o=this.m_line1,i=this.m_line1.getStartY()===this.m_line1.getEndY();else{const t=n.Envelope2D.constructEmpty();o.queryLooseEnvelope(t),t.queryIntervalX(this.m_env),i=0===t.height(),l=!1}if(this.m_pointOfInterest.x+this.m_tolerance<this.m_env.vmin)return-1;if(this.m_pointOfInterest.x-this.m_tolerance>this.m_env.vmax)return 1;if(i)return this.m_currentNode=e,this.m_bIntersectionDetected=!0,0;let h=0;if(l){(0,r.$)(this.m_line1);const t=this.m_line1.getStartXY(),e=new a.P;e.setSub(this.m_line1.getEndXY(),t),e.rightPerpendicularThis();const s=new a.P;s.setSub(this.m_pointOfInterest,t),h=e.dotProduct(s),h/=e.length()}else h=o.intersectionOfYMonotonicWithAxisX(this.m_pointOfInterest.y,this.m_pointOfInterest.x)-this.m_pointOfInterest.x;return h<10*-this.m_tolerance?-1:h>10*this.m_tolerance?1:(o.isIntersectingPoint(this.m_pointOfInterest,this.m_tolerance)&&(Math.abs(h)<this.m_minDist&&(this.m_currentNode=e,this.m_minDist=h),this.m_bIntersectionDetected=!0),h<0?-1:h>0?1:0)}}class rt{constructor(t,e){this.m_lists=new et(!1),this.m_hash=e,this.m_hashBuckets=new Int32Array(t),this.m_hashBuckets.fill(rt.st_nullNode()),this.m_bitFilter=new Int32Array(10*t+31>>5)}reserveElements(t){this.m_lists.reserveLists(Math.min(this.m_hashBuckets.length,t)),this.m_lists.reserveNodes(t)}addElement(t,e){void 0===e&&(e=this.m_hash.getHash(t));const s=e%(this.m_bitFilter.length<<5);this.m_bitFilter[s>>5]|=1<<(31&s);const n=e%this.m_hashBuckets.length;let i=this.m_hashBuckets[n];return i===et.st_nullNode()&&(i=this.m_lists.createList(),this.m_hashBuckets[n]=i),this.m_lists.addElement(i,t)}deleteElement(t,e){void 0===e&&(e=this.m_hash.getHash(t));const s=e%this.m_hashBuckets.length,n=this.m_hashBuckets[s];n===et.st_nullNode()&&(0,i.a)("");let r=this.m_lists.getFirst(n),o=et.st_nullNode();for(;r!==et.st_nullNode();){const e=this.m_lists.getData(r),i=this.m_lists.getNext(r);e===t?(this.m_lists.deleteElementDirect(n,o,r),this.m_lists.getFirst(n)===et.st_nullNode()&&(this.m_lists.deleteList(n),this.m_hashBuckets[s]=et.st_nullNode())):o=r,r=i}}getFirstInBucket(t){const e=t%(this.m_bitFilter.length<<5);if(!(this.m_bitFilter[e>>5]&1<<(31&e)))return et.st_nullNode();const s=t%this.m_hashBuckets.length,n=this.m_hashBuckets[s];return n===et.st_nullNode()?et.st_nullNode():this.m_lists.getFirst(n)}getNextInBucket(t){return this.m_lists.getNext(t)}findNode(t){const e=this.m_hash.getHash(t);let s=this.getFirstInBucket(e);for(;s!==et.st_nullNode();){const e=this.m_lists.getData(s);if(this.m_hash.equal(e,t))return s;s=this.m_lists.getNext(s)}return et.st_nullNode()}deleteNode(t){const e=this.getElement(t),s=this.m_hash.getHash(e)%this.m_hashBuckets.length,n=this.m_hashBuckets[s];n===et.st_nullNode()&&(0,i.a)(""),this.m_lists.deleteElementSearch(n,t),this.m_lists.getFirst(n)===et.st_nullNode()&&(this.m_lists.deleteList(n),this.m_hashBuckets[s]=et.st_nullNode())}getElement(t){return this.m_lists.getData(t)}static st_nullNode(){return et.st_nullNode()}clear(){(0,i.g)(0)}size(){return this.m_lists.getNodeCount()}dbgPrintBucketHistogram(){}}function ot(t,e,s,n,i){const r=new ct(i);return r.m_shape=t,r.m_sqrTolerance=e*e,r.m_cellSize=2*e,r.m_invCellSize=1/r.m_cellSize,r.m_geometry=s,r.m_bTrackChanges=n,r.m_bHasSegmentParentage=t.hasSegmentParentage(),r.clusterNonReciprocal()}function at(t,e,s,n,i){const r=t-s,o=e-n;return r*r+o*o<=i}function lt(t,e,s,n,i,r){const o={pt:new a.P,weight:0,rank:0,bMerged:!1},l=s+i;let h=!1,u=t.x;t.x!==e.x&&(n===r&&(u=(t.x*s+e.x*i)/l),h=!0);let c=t.y;return t.y!==e.y&&(n===r&&(c=(t.y*s+e.y*i)/l),h=!0),n!==r?n>r?(o.rank=n,o.weight=s,o.pt=t):(o.rank=r,o.weight=i,o.pt=e):(o.pt.setCoords(u,c),o.weight=l,o.rank=n),o.bMerged=h,o}function ht(t,e){const s=(0,a.aK)(t);return(0,a.aF)(s,e)}class ut{constructor(t,e,s,n,i){this.m_workPt=new a.P,this.m_shape=t,this.m_sqrTolerance=s,this.m_invCellSize=n,this.m_origin=e.clone(),this.m_hashValues=i}getHash(t){return this.m_shape.getUserIndex(t,this.m_hashValues)}calculateHashFromVertex(t){this.m_shape.queryXY(t,this.m_workPt);const e=this.m_workPt.x-this.m_origin.x,s=Math.trunc(e*this.m_invCellSize+.5),n=this.m_workPt.y-this.m_origin.y;return ht(s,Math.trunc(n*this.m_invCellSize+.5))}equal(t,e){return(0,i.g)(0),!1}}class ct{constructor(t){this.m_origin=a.P.getNAN(),this.m_sqrTolerance=0,this.m_cellSize=0,this.m_invCellSize=0,this.m_geometry=r.n,this.m_bucketArray=(0,a.d)(4,Number.NaN),this.m_bucketHash=(0,a.d)(4,Number.NaN),this.m_dbgCandidateCheckCount=0,this.m_nsr=new d.NonSimpleResult,this.m_hashValues=-1,this.m_newClusters=-1,this.m_bTrackChanges=!1,this.m_bHasSegmentParentage=!1,this.m_shape=null,this.m_clusters=new et,this.m_hashFunction=null,this.m_hashTable=null,this.m_progressCounter=0,this.m_progressTracker=t}progress_(){}collectClusterCandidates(t,e){const s=a.P.getNAN();this.m_shape.queryXY(t,s);const n=(s.x-this.m_origin.x)*this.m_invCellSize,i=(s.y-this.m_origin.y)*this.m_invCellSize,r=Math.trunc(n),o=Math.trunc(i);let l=0;for(let a=0;a<=1;a+=1)for(let t=0;t<=1;t+=1){const e=ht(r+a,o+t),s=this.m_hashTable.getFirstInBucket(e);s!==rt.st_nullNode()&&(this.m_bucketArray[l]=s,this.m_bucketHash[l]=e,l++)}for(let a=l-1;a>=1;a--){const t=this.m_bucketArray[a];for(let e=a-1;e>=0;e--)if(t===this.m_bucketArray[e]){this.m_bucketHash[e]=-1,l--,a!==l&&(this.m_bucketHash[a]=this.m_bucketHash[l],this.m_bucketArray[a]=this.m_bucketArray[l]);break}}for(let a=0;a<l;a++)this.collectNearestNeighbourCandidates(t,this.m_bucketHash[a],s,this.m_bucketArray[a],e)}collectNearestNeighbourCandidates(t,e,s,n,i){const r=a.P.getNAN();for(let o=n;o!==rt.st_nullNode();o=this.m_hashTable.getNextInBucket(o)){const n=this.m_hashTable.getElement(o);t===n||-1!==e&&this.m_shape.getUserIndex(n,this.m_hashValues)!==e||(this.m_shape.queryXY(n,r),at(s.x,s.y,r.x,r.y,this.m_sqrTolerance)&&i.push(o))}}mergeClusters(t,e,s){let n=this.m_shape.getUserIndex(t,this.m_newClusters);const i=this.m_shape.getUserIndex(e,this.m_newClusters);-1===n&&(n=this.m_clusters.createList(),this.m_clusters.addElement(n,t),this.m_shape.setUserIndex(t,this.m_newClusters,n)),-1===i?this.m_clusters.addElement(n,e):this.m_clusters.concatenateLists(n,i),this.m_shape.setUserIndex(e,this.m_newClusters,o.S.impossibleIndex2());const r=this.mergeVertices(t,e);if(s){const e=this.m_hashFunction.calculateHashFromVertex(t);this.m_shape.setUserIndex(t,this.m_hashValues,e)}return r}mergeVertices(t,e){const s=a.P.getNAN();this.m_shape.queryXY(t,s);const n=a.P.getNAN();this.m_shape.queryXY(e,n);const i=this.m_shape.getRank(t),r=this.m_shape.getRank(e),o=this.m_shape.getWeight(t),l=this.m_shape.getWeight(e);let h,u,c,m,d=!1;if(i===r?(h=i,u=o+l,c=s.x,s.x!==n.x&&(c=(s.x*o+n.x*l)/u,d=!0),m=s.y,s.y!==n.y&&(m=(s.y*o+n.y*l)/u,d=!0)):(i>r?(c=s.x,m=s.y,u=o,h=i):(c=n.x,m=n.y,u=l,h=r),d=!s.equals(n)),d&&(this.m_shape.setXYMonotonic(t,c,m),this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(t,!0),this.m_bHasSegmentParentage)){const s=this.m_shape.getSegmentParentageBreakVertex(t)||this.m_shape.getSegmentParentageBreakVertex(e);this.m_shape.setSegmentParentageBreakVertex(t,s),this.m_shape.setSegmentParentageBreakVertex(e,s)}return this.m_shape.setWeight(t,u),this.m_shape.setRank(t,h),d}needsClustering(){const t={stack:[],error:void 0,hasError:!1};try{(0,l.b)(t,(0,a.h)((()=>{this.m_hashTable=null,this.m_hashFunction=null,this.m_shape.removeUserIndex(this.m_hashValues),this.m_shape.removeUserIndex(this.m_newClusters)})),!1);const e=this.m_shape.getSelectedCount(),s=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin.assign(s.getLowerLeft());const n=Math.max(s.height(),s.width())/((0,a.i)()-1);this.m_cellSize<n&&(this.m_cellSize=n,this.m_invCellSize=1/this.m_cellSize),this.m_clusters.clear(),this.m_clusters.reserveLists(this.m_shape.getSelectedCount()/3+1),this.m_clusters.reserveNodes(this.m_shape.getSelectedCount()/3+1),this.m_hashValues=this.m_shape.createUserIndex(),this.m_newClusters=this.m_shape.createUserIndex(),this.m_hashFunction=new ut(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues),this.m_hashTable=new rt(4*e/3,this.m_hashFunction),this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());let i=!1;for(let t=0;t<2;t++){const e=[],s=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let n=s.next();n!==r.n;n=s.next()){if(this.progress_(),t>0&&this.m_shape.getUserIndex(n,this.m_newClusters)===o.S.impossibleIndex2())continue;let s;if(0===t?(s=this.m_hashFunction.calculateHashFromVertex(n),this.m_shape.setUserIndex(n,this.m_hashValues,s)):s=this.m_shape.getUserIndex(n,this.m_hashValues),this.collectClusterCandidates(n,e),0!==e.length){for(let t=0,s=e.length;t<s;t++){this.progress_();const s=e[t],r=this.m_hashTable.getElement(s);if(this.m_hashTable.deleteNode(s),!this.m_shape.isEqualXY(n,r))return this.m_nsr=new d.NonSimpleResult(5,this.m_shape.getVertexIndex(n),this.m_shape.getVertexIndex(r)),i=!0,i;this.mergeClusters(n,r,!1)}e.length=0}0===t&&this.m_hashTable.addElement(n,s)}}return i}catch(e){t.error=e,t.hasError=!0}finally{(0,l.c)(t)}}clusterNonReciprocal(){const t=this.m_shape.getSelectedCount(),e=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin=e.getLowerLeft();const s=Math.max(e.height(),e.width())/((0,a.i)()-1);this.m_cellSize<s&&(this.m_cellSize=s,this.m_invCellSize=1/this.m_cellSize),this.m_clusters.clear(),this.m_clusters.reserveLists(Math.trunc(this.m_shape.getSelectedCount()/3+1)),this.m_clusters.reserveNodes(Math.trunc(this.m_shape.getSelectedCount()/3+1)),this.m_hashValues=this.m_shape.createUserIndex(),this.m_newClusters=this.m_shape.createUserIndex(),this.m_hashFunction=new ut(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues),this.m_hashTable=new rt(Math.trunc(4*t/3),this.m_hashFunction),this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());let n=!1;{const t=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let e=t.next();e!==r.n;e=t.next()){this.progress_();const t=this.m_hashFunction.calculateHashFromVertex(e);this.m_shape.setUserIndex(e,this.m_hashValues,t),this.m_hashTable.addElement(e,t)}}{const t=[],e=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let s=e.next();s!==r.n;s=e.next()){if(this.m_shape.getUserIndex(s,this.m_newClusters)===o.S.impossibleIndex2())continue;let e=this.m_shape.getUserIndex(s,this.m_hashValues);this.m_hashTable.deleteElement(s,e);let i=!1;for(;this.collectClusterCandidates(s,t),0!==t.length;){let e=0;for(let n=0,i=t.length;n<i;n++){this.progress_();const r=t[n],o=this.m_hashTable.getElement(r);this.m_hashTable.deleteNode(r);const a=n+1===i;e|=this.mergeClusters(s,o,a)?1:0}if(i||=0!==e,n||=0!==e,t.length=0,!e)break}i&&(e=this.m_shape.getUserIndex(s,this.m_hashValues)),this.m_hashTable.addElement(s,e)}t.length=0}return n&&this.applyClusterPositions_(),this.m_hashTable=null,this.m_hashFunction=null,this.m_shape.removeUserIndex(this.m_hashValues),this.m_shape.removeUserIndex(this.m_newClusters),n}applyClusterPositions_(){const t=a.P.getNAN();for(let e=this.m_clusters.getFirstList();e!==et.st_nullNode();e=this.m_clusters.getNextList(e)){let s=this.m_clusters.getFirst(e);const n=this.m_clusters.getElement(s);this.m_shape.queryXY(n,t);const i=this.m_shape.getRank(n),r=this.m_shape.getWeight(n);for(s=this.m_clusters.getNext(s);s!==et.st_nullNode();s=this.m_clusters.getNext(s)){const e=this.m_clusters.getElement(s);if(this.m_bTrackChanges?this.m_shape.isEqualXYPoint2D(e,t)||(this.m_shape.setXYMonotonicPoint2D(e,t),this.m_shape.setGeometryModifiedWithVertex(e,!0)):this.m_shape.setXYMonotonicPoint2D(e,t),this.m_bHasSegmentParentage){const t=this.m_shape.getSegmentParentageBreakVertex(n)||this.m_shape.getSegmentParentageBreakVertex(e);this.m_shape.setSegmentParentageBreakVertex(n,t),this.m_shape.setSegmentParentageBreakVertex(e,t)}this.m_shape.setWeight(e,r),this.m_shape.setRank(e,i)}}}}class mt{constructor(){this.m_inputParts=[],this.m_resultParts1=[],this.m_resultParts2=[],this.m_resultSegments=[],this.m_freeSegments=[],this.m_inputSegments=[],this.m_param1=[],this.m_param2=[],this.m_tolerance=0,this.m_toleranceZ=0,this.m_point=new o.P,this.m_pointWeight=1,this.m_maxDensifyLimit=0,this.m_pointRank=0,this.m_changed1=!1,this.m_changed2=!1,this.m_adaptiveDensify=!1}clear(){this.freeAllResultSegments(),this.m_inputSegments.length=0,this.m_inputParts.length=0,this.m_resultParts1.length=0,this.m_resultParts2.length=0,this.m_param1.length=0,this.m_param2.length=0,this.m_adaptiveDensify=!1,this.m_changed1=!1,this.m_changed2=!1}newIntersectionPart_(t,e,s,n,i,r,o,a,l,h){return function(t,e,s,n,i,r,o,a,l,h){return{segmentIndex:t,weightStart:e,rankStart:s,weightEnd:n,rankEnd:i,weightInterior:r,rankInterior:o,segmentParentage:h,u:dt(a,l)}}(t,e,s,n,i,r,o,a,l,h)}pushSegment(t,e,s,n,i,r,o,a,l,h){return this.m_inputParts.push(this.newIntersectionPart_(this.m_inputSegments.length,e,s,n,i,r,o,a,l,h)),this.m_inputSegments.push(t),this.m_inputParts.length-1}getResultSegmentCount(t){return this.m_adaptiveDensify?0===t?this.m_param1.length-1:this.m_param2.length-1:0===t?this.m_resultParts1.length:this.m_resultParts2.length}getResultPart_(t,e){return 0===t?this.m_resultParts1[e]:this.m_resultParts2[e]}getResultSegment(t,e){return this.m_resultSegments[this.getResultPart_(t,e).segmentIndex].get()}getSegmentChanged(t){return 0===t?this.m_changed1:this.m_changed2}getResultSegmentStartPointWeight(t,e){return this.getResultPart_(t,e).weightStart}getResultSegmentStartPointRank(t,e){return this.getResultPart_(t,e).rankStart}getResultSegmentSegmentParentage(t,e){return this.getResultPart_(t,e).segmentParentage}getResultSegmentStartPointIsBreak(t,e){return this.getResultPart_(t,e).u.bBreakStart}getResultSegmentEndPointWeight(t,e){return this.getResultPart_(t,e).weightEnd}getResultSegmentEndPointRank(t,e){return this.getResultPart_(t,e).rankEnd}getResultSegmentEndPointIsBreak(t,e){return this.getResultPart_(t,e).u.bBreakEnd}getResultSegmentInteriorRank(t,e){return this.getResultPart_(t,e).rankInterior}getResultSegmentInteriorWeight(t,e){return this.getResultPart_(t,e).weightInterior}getResultPoint(){return this.m_point}getResultPointWeight(){return this.m_pointWeight}getResultPointRank(){return this.m_pointRank}getResultPointChanged(){return this.m_changed2}intersectLines(t,e){2!==this.m_inputSegments.length&&(0,i.d)(""),this.m_changed1=!1,this.m_changed2=!1,this.m_tolerance=t;const s=(0,a.a)(t*mt.c_smallToleranceFactor);let n=!1;const o=this.m_inputParts[0],l=this.m_inputParts[1],h=this.m_inputSegments[o.segmentIndex],u=this.m_inputSegments[l.segmentIndex];if(e||5&(0,r.Q)(!0,h,u,t,!0)){const e=(0,r.Z)(!0,h,u,null,this.m_param1,this.m_param2,t);0===e&&(0,i.d)("");const c=new Array(e);for(let t=0;t<e;++t)c[t]=a.P.getNAN();const m=new Float64Array(e),d=new Int32Array(e),g=new Array(e),p=new Array(e);for(let t=0;t<e;++t)g[t]={bBigMove:!1,bIsBreak:!1},p[t]={bBigMove:!1,bIsBreak:!1};for(let t=0;t<e;t++){const e=this.m_param1[t],i=this.m_param2[t];let r,_=o.rankInterior,f=o.weightInterior;0===e?(_=o.rankStart,f=o.weightStart,r=o.u.bBreakStart):1===e?(_=o.rankEnd,f=o.weightEnd,r=o.u.bBreakEnd):(this.m_changed1=!0,r=!1);let y,x=l.rankInterior,v=l.weightInterior;0===i?(x=l.rankStart,v=l.weightStart,y=l.u.bBreakStart):1===i?(x=l.rankEnd,v=l.weightEnd,y=l.u.bBreakEnd):(this.m_changed2=!0,y=!1);const b=_,P=x;let S=1,E=0,C=a.P.getNAN();if(b===P){const n=h.getCoord2D(e),r=u.getCoord2D(i);S=f+v,E=_,(0,a.U)(n,r,v/S,C);const o=a.P.sqrDistance(C,n),l=a.P.sqrDistance(C,r);g[t].bBigMove=o>s,p[t].bBigMove=l>s,this.m_changed1||n.equals(C)||(this.m_changed1=!0),this.m_changed2||r.equals(C)||(this.m_changed2=!0)}else if(b>P){C=h.getCoord2D(e);const n=u.getCoord2D(i);S=f,E=_;const r=a.P.sqrDistance(C,n);g[t].bBigMove=!1,p[t].bBigMove=r>s,this.m_changed2||n.equals(C)||(this.m_changed2=!0)}else{C=u.getCoord2D(i),S=v,E=x;const n=h.getCoord2D(e),r=a.P.sqrDistance(C,n);g[t].bBigMove=r>s,p[t].bBigMove=!1,this.m_changed1||n.equals(C)||(this.m_changed1=!0)}c[t].assign(C),m[t]=S,d[t]=E,g[t].bIsBreak=r||y,p[t].bIsBreak=r||y,n||=g[t].bBigMove||p[t].bBigMove}const _=o.rankInterior,f=o.weightInterior;let y=0,x=-1;for(let s=0;s<=e;s++){const n=s<e?this.m_param1[s]:1;if(n!==y){const i=this.allocResultSegment(),r=this.m_resultSegments[i];let l,u,p,v;h.queryCut(y,n,r,!1),r.get().snapControlPoints(t*t);let b=!1,P=!1,S=!1,E=!1,C=!1,w=a.P.getNAN(),I=a.P.getNAN();-1!==x?(u=d[x],l=m[x],b=g[x].bBigMove,w.assign(c[x]),S=g[x].bIsBreak,C=!0):(l=o.weightStart,u=o.rankStart,w=r.get().getStartXY(),S=o.u.bBreakStart),s<e?(v=d[s],p=m[s],P=g[s].bBigMove,I.assign(c[s]),E=g[s].bIsBreak,C=!0):(p=o.weightEnd,v=o.rankEnd,I=r.get().getEndXY(),E=o.u.bBreakEnd),C&&r.get().setCoordsForIntersector(w,I,!0),this.m_resultParts1.push(this.newIntersectionPart_(i,l,u,p,v,f,_,S,E,o.segmentParentage));const T=this.m_resultParts1.at(-1);T.u.bBigMoveStart=b,T.u.bBigMoveEnd=P,y=n,x=s}else-1===x&&(x=s)}const v=(0,a.d)(e,0);for(let t=0;t<e;t++)v[t]=t;e>2?(v.sort(((t,e)=>this.m_param2[t]<this.m_param2[e]?-1:this.m_param2[t]>this.m_param2[e]?1:0)),(0,a.v)(this.m_param2)):2===e&&this.m_param2[0]>this.m_param2[1]&&(this.m_param2[1]=(0,a.c)(this.m_param2[0],this.m_param2[0]=this.m_param2[1]),v[1]=(0,a.c)(v[0],v[0]=v[1]));const b=l.rankInterior,P=l.weightInterior;y=0,x=-1;for(let s=0;s<=e;s++){const n=s<e?this.m_param2[s]:1;if(n!==y){const i=this.allocResultSegment(),r=this.m_resultSegments[i];let o,h,g,_;u.queryCut(y,n,r,!1),r.get().snapControlPoints(t*t);let f=a.P.getNAN(),S=a.P.getNAN(),E=!1,C=!1,w=!1,I=!1,T=!1;if(-1!==x){const t=v[x];o=m[t],h=d[t],f.assign(c[t]),w=p[t].bBigMove,E=p[t].bIsBreak,T=!0}else o=l.weightStart,h=l.rankStart,f=r.get().getStartXY(),E=l.u.bBreakStart;if(s!==e){const t=v[s];g=m[t],_=d[t],S.assign(c[t]),I=p[t].bBigMove,C=p[t].bIsBreak,T=!0}else g=l.weightEnd,_=l.rankEnd,S=r.get().getEndXY(),C=l.u.bBreakEnd;T&&r.get().setCoordsForIntersector(f,S,!0),this.m_resultParts2.push(this.newIntersectionPart_(i,o,h,g,_,P,b,E,C,l.segmentParentage));const A=this.m_resultParts2.at(-1);A.u.bBigMoveStart=w,A.u.bBigMoveEnd=I,y=n,x=s}else-1===x&&(x=s)}return n?3:2}return 0}intersectLines3D(t,e,s,n){return(0,i.g)(0),1}intersect2D(t,e){const s=this.m_inputParts[0],n=this.m_inputParts[1],r=this.m_inputSegments[s.segmentIndex].getGeometryType(),o=this.m_inputSegments[n.segmentIndex].getGeometryType();return r!==i.G.enumLine||o!==i.G.enumLine?new yt(this).intersectCurves(t,e):this.intersectLines(t,e)}intersect2DEx(t,e,s,n,r){this.m_point.assignCopy(e),1!==this.m_inputSegments.length&&(0,i.d)(""),this.m_tolerance=t,this.m_changed1=!1,this.m_changed2=!1;const o=(0,a.a)(t*mt.c_smallToleranceFactor);let l=!1;const h=this.m_inputParts[0],u=this.m_inputSegments[h.segmentIndex];if(r||u.isIntersectingPoint(e.getXY(),t,!0)){this.m_param1=(0,a.d)(16,Number.NaN);const i=u.getClosestCoordinate(e.getXY(),!1);this.m_param1[0]=i;let r=h.rankInterior,c=h.weightInterior;0===i?(r=h.rankStart,c=h.weightStart):1===i?(r=h.rankEnd,c=h.weightEnd):this.m_changed1=!0;let m=r;const d=s,g=n;m===d&&u.isCurve()&&(m=d+1);let p=1,_=0;const f=new a.P;if(m===d){const t=u.getCoord2D(i),s=e.getXY();p=c+g,_=r,(0,a.U)(t,s,g/p,f),this.m_changed1||t.equals(f)||(this.m_changed1=!0),this.m_changed2||s.equals(f)||(this.m_changed2=!0),l=a.P.sqrDistance(f,t)>o}else m>d?(f.assign(u.getCoord2D(i)),p=c,_=r,this.m_changed2||f.equals(e.getXY())||(this.m_changed2=!0)):(f.assign(u.getCoord2D(i)),p=g,_=d,this.m_changed1||f.equals(e.getXY())||(this.m_changed1=!0),l=a.P.sqrDistance(f,e.getXY())>o);let y=0,x=-1;const v=1;for(let e=0;e<=v;e++){const s=e<v?this.m_param1[0]:1;if(s!==y){const n=this.allocResultSegment(),i=this.m_resultSegments[n];u.queryCut(y,s,i),i.get().snapControlPoints(t*t);let r=h.weightStart,o=h.weightEnd,a=h.rankStart,l=h.rankEnd;const c=h.rankInterior,m=h.weightInterior;let d=h.u.bBreakStart,g=h.u.bBreakEnd;-1!==x&&(r=p,a=_,d=!0,i.get().setCoordsForIntersector(f,i.get().getEndXY(),!0)),e!==v&&(o=p,l=_,g=!0,i.get().setCoordsForIntersector(i.get().getStartXY(),f,!0)),y=s,this.m_resultParts1.push(this.newIntersectionPart_(n,r,a,o,l,m,c,d,g,h.segmentParentage))}x=e}return this.m_point.setXY(f),this.m_pointWeight=p,this.m_pointRank=_,l?3:2}return 0}intersect3D(t,e,s,n){return(0,i.g)(0),1}intersect3DEx(t,e,s,n,r,o,a){return(0,i.g)(0),1}getTolerance(){return this.m_tolerance}freeAllResultSegments(){this.m_resultSegments.length=0,this.m_freeSegments.length=0}freeResultSegment(t){this.m_freeSegments.push(t)}allocResultSegment(){if(this.m_freeSegments.length)return this.m_freeSegments.pop();const t=new r.S,e=this.m_resultSegments.length;return this.m_resultSegments.push(t),e}allocResultSegmentFromBuffer(t){if(this.m_freeSegments.length)return this.m_freeSegments.pop();const e=new r.S({copy:t}),s=this.m_resultSegments.length;return this.m_resultSegments.push(e),s}allocResultSegmentFromSegment(t){if(this.m_freeSegments.length)return this.m_freeSegments.pop();const e=new r.S({segment:t}),s=this.m_resultSegments.length;return this.m_resultSegments.push(e),s}}function dt(t,e){return{bBigMoveStart:!1,bBigMoveEnd:!1,bBreakStart:t,bBreakEnd:e}}function gt(){return{bBigMove:!1,bIsBreak:!1}}mt.maxWeight=.1*Number.MAX_VALUE,mt.c_smallToleranceFactor=.01,mt.c_maxGeometryTypeToRankDelta=8;let pt=class{constructor(){this.start=null,this.end=null,this.equalEdge=null,this.segmentIndex=-1,this.segmentParentage=-1,this.weight=0,this.rank=0}hasSegment(){return this.segmentIndex>=0}transferAttributes(t,e,s){if(1===e.getDescription().getAttributeCount())return;const n=t.parent.m_resultSegments[this.segmentIndex].get().getStartXY(),i=t.parent.m_resultSegments[this.segmentIndex].get().getEndXY(),r=new o.P;e.queryStart(r),s?(r.setXY(n),t.parent.m_resultSegments[this.segmentIndex].get().setStart(r)):(r.setXY(i),t.parent.m_resultSegments[this.segmentIndex].get().setEnd(r)),e.queryEnd(r),s?(r.setXY(i),t.parent.m_resultSegments[this.segmentIndex].get().setEnd(r)):(r.setXY(n),t.parent.m_resultSegments[this.segmentIndex].get().setStart(r))}copyFromWhenOverlap(t,e,s){this.equalEdge=e,e.equalEdge=this,this.segmentIndex=t.parent.allocResultSegmentFromBuffer(t.parent.m_resultSegments[e.segmentIndex]),this.segmentParentage=e.segmentParentage,this.weight=e.weight,this.rank=e.rank,s?(this.start.copyFrom(e.start),this.end.copyFrom(e.end)):(this.start.copyFrom(e.end),this.end.copyFrom(e.start),t.parent.m_resultSegments[this.segmentIndex].get().reverse())}getEnd(){return this.end}getNextInChain(){return this.end.nextInChain}getPrevInChain(){return this.start.prevInChain}};class _t{constructor(){this.hash=0,this.pt=new a.P,this.prevInChain=null,this.nextInChain=null,this.prevInHash=null,this.nextInHash=null,this.prevEqual=null,this.nextEqual=null,this.weight=0,this.rank=0,this.bBigMove=!1,this.bIsBreak=!1}copyFrom(t){this.pt.assign(t.pt),this.weight=t.weight,this.rank=t.rank,this.bBigMove=t.bBigMove,this.bIsBreak=t.bIsBreak}nextNode(){return this.nextInChain?this.nextInChain.end:null}prevNode(){return this.prevInChain?this.prevInChain.start:null}equalListHead(){let t=this;for(;null!==t.prevEqual;t=t.prevEqual);return t}}function ft(t,e,s,n){return{edge1:t,edge2:e,recursion:s,bIsIntersecting:n}}class yt{constructor(t){this.m_pairs=[],this.m_chainOrigin1=null,this.m_chainOrigin2=null,this.m_newNodes=[],this.m_hashTableOfEquals=[],this.m_hashTableOfEqualsSize=0,this.m_origin=new a.P,this.m_cell=new a.P,this.parent=t}addSegment(t,e,s,n,r,o,a,l,h,u,c){const m=this.newNode(this.parent.m_resultSegments[t].get().getStartXY(),s,n,h),d=this.newNode(this.parent.m_resultSegments[t].get().getEndXY(),r,o,u);this.newEdge(m,d,t,a,l,c),null===this.m_chainOrigin1?this.m_chainOrigin1=m:null===this.m_chainOrigin2?this.m_chainOrigin2=m:(0,i.g)(0)}intersectCurvesHelper(t,e,s,n,o){const l=this.getSegment(t).get(),h=this.getSegment(e).get();if(l.isDegenerate(0)||h.isDegenerate(0))return 0;const u=this.tryOverlapIntersectCurves(t,e,s,n);if(0!==u)return u;const c=(0,a.a)(.01*s);let m=!1,d=this.processSharpCorners(l,h,s,o>4);const g=d>0;if(!g){if(!(n||5&(0,r.Y)(!0,!1,l,h,s,!0)))return 0;d=(0,r.Z)(!0,l,h,null,this.parent.m_param1,this.parent.m_param2,s)}0===d&&(0,i.d)("");const p=l.getGeometryType(),_=h.getGeometryType(),f=(0,a.m)(a.P,d),y=(0,a.m)(a.P,d),x=(0,a.d)(d,Number.NaN),v=(0,a.d)(d,Number.NaN),b=(0,a.d)(d,Number.NaN),P=(0,a.d)(d,Number.NaN),S=(0,a.n)(gt,d),E=(0,a.n)(gt,d);let C=!1,w=!1;for(let i=0;i<d;i++){const n=this.parent.m_param1[i],r=this.parent.m_param2[i];let o=t.rank,u=t.weight,d=!0,I=!1;0===n?(o=t.start.rank,u=t.start.weight,I=t.start.bIsBreak):1===n?(o=t.end.rank,u=t.end.weight,I=t.end.bIsBreak):(C=!0,d=!1);let T=e.rank,A=e.weight,M=!1,D=!0;0===r?(T=e.start.rank,A=e.start.weight,M=e.start.bIsBreak):1===r?(T=e.end.rank,A=e.end.weight,M=e.end.bIsBreak):(w=!0,D=!1);let N=o,F=T;if(N===F&&(N*=mt.c_maxGeometryTypeToRankDelta,F*=mt.c_maxGeometryTypeToRankDelta,N+=xt(p,l,!1),F+=xt(_,h,!1)),d&&D&&F===N){const t=l.getCoord2D(n),e=h.getCoord2D(r);t.equals(e)&&(F=N-1)}let R=1,k=0,L=1,G=0;const V=new a.P,z=new a.P,O=l.getCoord2D(n),q=h.getCoord2D(r);if(g&&a.P.distance(O,q)>s)V.setCoordsPoint2D(O),z.setCoordsPoint2D(q),R=u,L=A,k=o,G=T,S[i].bBigMove=!1,E[i].bBigMove=!1,I=!0,M=!0;else if(N===F){L=R=u+A,G=k=o,(0,a.U)(O,q,A/R,V),z.setCoordsPoint2D(V);const t=a.P.sqrDistance(V,O),e=a.P.sqrDistance(V,q);S[i].bBigMove=t>c,E[i].bBigMove=e>c,C||O.equals(V)||(C=!0),w||q.equals(z)||(w=!0)}else if(N>F){V.setCoordsPoint2D(O),z.setCoordsPoint2D(V),L=R=u,G=k=o;const t=a.P.sqrDistance(V,q);S[i].bBigMove=!1,E[i].bBigMove=t>c,w||q.equals(z)||(w=!0)}else{z.setCoordsPoint2D(q),V.setCoordsPoint2D(z),L=R=A,G=k=T;const t=a.P.sqrDistance(V,O);S[i].bBigMove=t>c,E[i].bBigMove=!1,C||O.equals(V)||(C=!0)}f[i].assign(V),y[i].assign(z),x[i]=R,v[i]=L,b[i]=k,P[i]=G,S[i].bIsBreak=I||M,E[i].bIsBreak=I||M,m||=S[i].bBigMove||E[i].bBigMove,i>0&&(n!==this.parent.m_param1[i-1]&&r!==this.parent.m_param2[i-1]||(b[i]<=b[i-1]?(f[i].assign(y[i-1]),x[i]=v[i-1],b[i]=P[i-1],y[i].assign(y[i-1]),v[i]=v[i-1],P[i]=P[i-1],S[i].bBigMove||=S[i-1].bBigMove,E[i].bBigMove||=E[i-1].bBigMove,S[i].bIsBreak||=S[i-1].bIsBreak,E[i].bIsBreak||=E[i-1].bIsBreak):(f[i-1].assign(f[i]),x[i-1]=x[i],b[i-1]=b[i],y[i-1].assign(y[i]),v[i-1]=v[i],P[i-1]=P[i],S[i-1].bBigMove||=S[i].bBigMove,E[i-1].bBigMove||=E[i].bBigMove,S[i-1].bIsBreak||=S[i].bIsBreak,E[i-1].bIsBreak||=E[i].bIsBreak)))}if(!(C||w||2!==d||p===i.G.enumLine&&_===i.G.enumLine)){if(this.processDoublyConnectedEdges(t,e,o+1,s))return this.parent.m_changed1=!0,this.parent.m_changed2=!0,2;(0,i.g)(0)}this.parent.m_changed1||=C,this.parent.m_changed2||=w;let I=t,T=t.end.weight,A=t.end.rank,M=t.end.bBigMove,D=t.end.bIsBreak,N=0,F=-1;for(let i=0;i<=d;i++){const e=i<d?this.parent.m_param1[i]:1;if(e!==N){const n=this.parent.allocResultSegment(),r=this.parent.m_resultSegments[n];let o,h,u,c;l.queryCut(N,e,r,!1),r.get().snapControlPoints(s*s);let m=!1,g=!1,p=!1,_=!1;const y=new a.P,v=new a.P;-1!==F?(h=b[F],o=x[F],p=S[F].bBigMove,m=S[F].bIsBreak,y.assign(f[F])):(o=t.start.weight,h=t.start.rank,p=t.start.bBigMove,m=t.start.bIsBreak,y.assign(r.get().getStartXY())),i<d?(c=b[i],u=x[i],_=S[i].bBigMove,g=S[i].bIsBreak,v.assign(f[i])):(u=T,c=A,_=M,g=D,v.assign(r.get().getEndXY()));let P=I;e<1&&(this.splitEdgeInPlace(I),P=I.getNextInChain()),this.updateSegmentOnly(I,n),0===I.start.hash||I.start.pt.equals(y)||(this.m_newNodes.push(I.start),this.removeNodeFromHash(I.start),I.start.hash=0),0===I.end.hash||I.end.pt.equals(v)||(this.m_newNodes.push(I.end),this.removeNodeFromHash(I.end),I.end.hash=0),I.start.pt.assign(y),I.end.pt.assign(v),I.start.bBigMove||=p,I.end.bBigMove||=_,I.start.bIsBreak||=m,I.end.bIsBreak||=g,I.start.weight=o,I.start.rank=h,I.end.weight=u,I.end.rank=c,I=P,N=e,F=i}else-1===F&&(F=i)}const R=I.getNextInChain(),k=[];k.length=d;for(let i=0;i<d;i++)k[i]=i;d>2?(k.sort(((t,e)=>(0,a.a8)(this.parent.m_param2[t],this.parent.m_param2[e]))),this.parent.m_param2.sort(a.a8)):2===d&&this.parent.m_param2[0]>this.parent.m_param2[1]&&(this.parent.m_param2[1]=(0,a.c)(this.parent.m_param2[0],this.parent.m_param2[0]=this.parent.m_param2[1]),k[1]=(0,a.c)(k[0],k[0]=k[1])),I=e,T=e.end.weight,A=e.end.rank,M=e.end.bBigMove,D=e.end.bIsBreak,N=0,F=-1;for(let i=0;i<=d;i++){const t=i<d?this.parent.m_param2[i]:1;if(t!==N){const n=this.parent.allocResultSegment(),r=this.parent.m_resultSegments[n];let o,l,u,c;h.queryCut(N,t,r,!1),r.get().snapControlPoints(s*s);const m=new a.P,g=new a.P;let p=!1,_=!1,f=!1,x=!1;if(-1!==F){const t=k[F];o=v[t],l=P[t],m.assign(y[t]),f=E[t].bBigMove,p=E[t].bIsBreak}else o=e.start.weight,l=e.start.rank,f=e.start.bBigMove,p=e.start.bIsBreak,m.assign(r.get().getStartXY());if(i!==d){const t=k[i];u=v[t],c=P[t],g.assign(y[t]),x=E[t].bBigMove,_=E[t].bIsBreak}else u=T,c=A,x=M,_=D,g.assign(r.get().getEndXY());let b=I;t<1&&(this.splitEdgeInPlace(I),b=I.getNextInChain()),this.updateSegmentOnly(I,n),0===I.start.hash||I.start.pt.equals(m)||(this.m_newNodes.push(I.start),this.removeNodeFromHash(I.start),I.start.hash=0),0===I.end.hash||I.end.pt.equals(g)||(this.m_newNodes.push(I.end),this.removeNodeFromHash(I.end),I.end.hash=0),I.start.pt.assign(m),I.end.pt.assign(g),I.start.bBigMove||=f,I.end.bBigMove||=x,I.start.bIsBreak||=p,I.end.bIsBreak||=_,I.start.weight=o,I.start.rank=l,I.end.weight=u,I.end.rank=c,I=b,N=t,F=i}else-1===F&&(F=i)}const L=I.getNextInChain();return this.postProcessResultPartsForCurves(t,R,e,L,o+1),m?3:2}intersectCurves(t,e){2!==this.parent.m_inputSegments.length&&(0,i.d)(""),this.parent.m_changed1=!1,this.parent.m_changed2=!1,this.parent.m_tolerance=t,this.m_hashTableOfEqualsSize=0,this.m_hashTableOfEquals=(0,a.av)(16);const s=n.Envelope2D.constructEmpty();for(let i=0;i<2;i++){const t=this.parent.allocResultSegmentFromSegment(this.parent.m_inputSegments[this.parent.m_inputParts[i].segmentIndex]),e=n.Envelope2D.constructEmpty();this.parent.m_inputSegments[this.parent.m_inputParts[i].segmentIndex].queryLooseEnvelope(e),s.mergeEnvelope2D(e);const r=this.parent.m_inputParts[i];this.addSegment(t,0,r.weightStart,r.rankStart,r.weightEnd,r.rankEnd,r.weightInterior,r.rankInterior,r.u.bBreakStart,r.u.bBreakEnd,r.segmentParentage)}s.inflateCoords(100*t,100*t),this.m_origin.assign(s.getLowerLeft()),this.m_cell.setCoords(2*t,2*t),this.m_pairs.push(ft(this.m_chainOrigin1.nextInChain,this.m_chainOrigin2.nextInChain,0,e));let r=0,o=!0;for(;this.m_pairs.length;){const e=this.m_pairs.at(-1);this.m_pairs.pop(),(0,i.g)(e.recursion>=0),(0,i.g)(e.recursion<=256),this.clusterNodes(t);const s=this.intersectCurvesHelper(e.edge1,e.edge2,t,e.bIsIntersecting,e.recursion);o&&(o=!1,r=s)}for(let n=0;n<2;n++){const t=0===n?this.parent.m_resultParts1:this.parent.m_resultParts2;for(let e=(0===n?this.m_chainOrigin1:this.m_chainOrigin2).nextInChain;null!=e;e=e.getNextInChain())t.push(this.parent.newIntersectionPart_(e.segmentIndex,e.start.weight,e.start.rank,e.end.weight,e.end.rank,e.weight,e.rank,e.start.bIsBreak,e.end.bIsBreak,e.segmentParentage)),t.at(-1).u.bBigMoveStart=e.start.bBigMove,t.at(-1).u.bBigMoveEnd=e.end.bBigMove}return r}tryOverlapIntersectCurves(t,e,s,n){const o=this.parent.m_resultSegments[t.segmentIndex].get(),l=this.parent.m_resultSegments[e.segmentIndex].get(),h=o.getStartXY().equals(l.getStartXY())&&o.getEndXY().equals(l.getEndXY()),u=o.getStartXY().equals(l.getEndXY())&&o.getEndXY().equals(l.getStartXY());if(!h&&!u)return 0;const c=(0,r.a1)(o,l,!0);if(0!==c&&(0,r.a2)(o,l)&&t.segmentParentage===e.segmentParentage){let t=!1;if(c>0)t=o.equals(l);else{(0,i.g)(-1===c);const e=new r.S({segment:l});e.get().reverse(),t=o.equals(e.get())}if(t)return 1}const m=s*mt.c_smallToleranceFactor;let d=!1;if(0===c){const t=[.5,.25,.75,.125,.375,.625,.875,.5625,.3125];for(let e=0,n=t.length;e<n;++e){const n=t[e],i=new a.P;o.queryCoord2D(n,i);const r=l.getClosestCoordinate(i,!1),h=new a.P;l.queryCoord2D(r,h);const u=a.P.distance(i,h);if(u>s)return 0;d||=u>m}for(let e=0,n=t.length;e<n;++e){const n=t[e],i=new a.P;l.queryCoord2D(n,i);const r=o.getClosestCoordinate(i,!1),h=new a.P;o.queryCoord2D(r,h);const u=a.P.distance(i,h);if(u>s)return 0;d||=u>m}}let g=t.rank,p=e.rank;return g===p&&(g*=mt.c_maxGeometryTypeToRankDelta,p*=mt.c_maxGeometryTypeToRankDelta,g+=xt(o.getGeometryType(),o,!0),p+=xt(l.getGeometryType(),l,!0)),g>p?(e.copyFromWhenOverlap(this,t,h),e.transferAttributes(this,o,h)):p>g?(t.copyFromWhenOverlap(this,e,h),t.transferAttributes(this,l,h)):t.segmentParentage<=e.segmentParentage?(t.weight=t.weight+e.weight,e.copyFromWhenOverlap(this,t,h),e.transferAttributes(this,o,h)):(e.weight=t.weight+e.weight,t.copyFromWhenOverlap(this,e,h),t.transferAttributes(this,l,h)),d?3:2}postProcessResultPartsForCurves(t,e,s,n,r){r===(0,a.aC)()&&(0,i.d)("curve_helper");for(let i=t;i!==e;i=i.getNextInChain())this.updateSegmentToNodes(i);for(let i=s;i!==n;i=i.getNextInChain())this.updateSegmentToNodes(i);for(let o=t;o!==e;o=o.getNextInChain()){const t=o.end.pt.sub(o.start.pt);for(let e=s;e!==n;e=e.getNextInChain()){let s=0;if(o.start.pt.equals(e.start.pt)&&o.end.pt.equals(e.end.pt)?s=1:o.start.pt.equals(e.end.pt)&&o.end.pt.equals(e.start.pt)&&(s=-1),!s){let s=o.start.pt.equals(e.start.pt)?1:0;if(s||(s=o.end.pt.equals(e.end.pt)?2:0,s||(s=o.end.pt.equals(e.start.pt)?3:0,s||(s=o.start.pt.equals(e.end.pt)?4:0))),s){const n=e.end.pt.sub(e.start.pt),a=t.dotProduct(n);let l;switch(s){case 1:case 2:l=a>0;break;case 3:case 4:l=a<0;break;default:(0,i.d)("post_process_result_parts_for_curves_")}l&&this.m_pairs.push(ft(o,e,r,!1))}continue}const n=this.parent.m_resultSegments[o.segmentIndex],l=this.parent.m_resultSegments[e.segmentIndex],h=[.5,.25,.75];for(let t=0,e=h.length;t<e;++t){const e=h[t],i=new a.P;n.get().queryCoord2D(e,i);const r=l.get().getClosestCoordinate(i,!1),o=new a.P;if(l.get().queryCoord2D(r,o),a.P.distance(i,o)>this.parent.m_tolerance){s=0;break}}if(!s){this.m_pairs.push(ft(o,e,r,!1));continue}for(let t=0,e=h.length;t<e;++t){const e=h[t],i=new a.P;l.get().queryCoord2D(e,i);const r=n.get().getClosestCoordinate(i,!1),o=new a.P;if(n.get().queryCoord2D(r,o),a.P.distance(i,o)>this.parent.m_tolerance){s=0;break}}if(!s){this.m_pairs.push(ft(o,e,r,!1));continue}o.equalEdge=e,e.equalEdge=o;let u=o.rank,c=e.rank;u===c&&(u*=mt.c_maxGeometryTypeToRankDelta,c*=mt.c_maxGeometryTypeToRankDelta,u+=xt(n.get().getGeometryType(),n.get(),!0),c+=xt(l.get().getGeometryType(),l.get(),!0)),u>c||u===c&&o.segmentParentage<=e.segmentParentage?(n.copyTo(l,!1),e.segmentParentage=o.segmentParentage,-1===s&&l.get().reverse()):(l.copyTo(n,!1),o.segmentParentage=e.segmentParentage,-1===s&&n.get().reverse());break}}this.updateAttachedEdgesAfterNodeChange(t.start),e&&this.updateAttachedEdgesAfterNodeChange(e.start),this.updateAttachedEdgesAfterNodeChange(s.start),n&&this.updateAttachedEdgesAfterNodeChange(n.start)}processDoublyConnectedEdges(t,e,s,n){s===(0,a.aC)()&&(0,i.d)("curve_helper");const o=this.getSegment(t).get(),l=this.getSegment(e).get(),h=o.getStartXY().equals(l.getStartXY())&&o.getEndXY().equals(l.getEndXY())?1:o.getEndXY().equals(l.getStartXY())&&o.getStartXY().equals(l.getEndXY())?-1:0;if(0!==h){const i=new r.S;o.queryCut(0,.5,i),i.get().snapControlPoints(n*n);const a=new r.S;o.queryCut(.5,1,a),a.get().snapControlPoints(n*n),this.splitEdgeInPlace(t),t.end.pt=i.get().getEndXY(),t.segmentIndex=this.parent.allocResultSegmentFromBuffer(i),t.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(a);let u=l.getClosestCoordinate(t.end.pt,!1);return Math.abs(u-.5)>.2&&(u=.5),l.queryCut(0,u,i),i.get().snapControlPoints(n*n),l.queryCut(u,1,a),a.get().snapControlPoints(n*n),this.splitEdgeInPlace(e),e.end.pt=i.get().getEndXY(),e.segmentIndex=this.parent.allocResultSegmentFromBuffer(i),e.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(a),h>0?(this.m_pairs.push(ft(t,e,s,!1)),this.m_pairs.push(ft(t.getNextInChain(),e.getNextInChain(),s,!1))):(this.m_pairs.push(ft(t,e.getNextInChain(),s,!1)),this.m_pairs.push(ft(t.getNextInChain(),e,s,!1))),!0}return!1}newNode(t,e,s,n){const i=new _t;return this.m_newNodes.push(i),i.pt=t,i.rank=s,i.weight=e,i.bIsBreak=n,i}newEdge(t,e,s,n,i,r){const o=new pt;return o.start=t,o.end=e,t.nextInChain=o,e.prevInChain=o,o.segmentIndex=s,o.segmentParentage=r,o.rank=i,o.weight=n,o}splitEdgeInPlace(t){t.segmentIndex=-1;const e=new pt,s=new _t;this.m_newNodes.push(s),s.pt.setNAN(),s.nextInChain=e,s.prevInChain=t,s.prevInHash=null,s.nextInHash=null,s.prevEqual=null,s.nextEqual=null,s.weight=t.weight,s.rank=t.rank,s.bIsBreak=!1,s.bBigMove=!1,e.start=s,e.segmentIndex=-1,e.end=t.end,e.end.prevInChain=e,e.rank=t.rank,e.weight=t.weight,e.segmentParentage=t.segmentParentage,t.end=s,t.equalEdge&&(t.equalEdge.equalEdge=null),t.equalEdge=null}updateSegmentOnly(t,e){t.segmentIndex=e}updateAttachedEdgesAfterNodeChange(t){for(let e=t.equalListHead();null!==e;e=e.nextEqual)this.updateAttachedEdgesAfterNodeChangeImpl(e)}updateAttachedEdgesAfterNodeChangeImpl(t){const e=t.prevInChain;if(e&&e.hasSegment()){const s=this.getSegment(e).get();t.pt.equals(s.getEndXY())||(s.setCoordsForIntersector(e.start.pt,e.end.pt,!1),s.ensureXYMonotone())}const s=t.nextInChain;if(s&&s.hasSegment()){const e=this.getSegment(s).get();t.pt.equals(e.getStartXY())||(e.setCoordsForIntersector(s.start.pt,s.end.pt,!1),e.ensureXYMonotone())}}updateSegmentToNodes(t){const e=this.getSegment(t).get();t.start.pt.equals(e.getStartXY())&&t.end.pt.equals(e.getEndXY())||(e.setCoordsForIntersector(t.start.pt,t.end.pt,!1),e.ensureXYMonotone()),this.updateAttachedEdgesAfterNodeChange(t.start),this.updateAttachedEdgesAfterNodeChange(t.end)}getSegment(t){return this.parent.m_resultSegments[t.segmentIndex]}clusterNodes(t){let e=!1;const s=[],n=[],i=[];for(let r=0,o=this.m_newNodes.length;r<o;r++){const t=this.m_newNodes[r];if(null===t)continue;let e=t;for(let s=r+1;s<o;s++){const n=this.m_newNodes[s];null!==n&&t.pt.equals(n.pt)&&(e.nextInHash=n,n.prevInHash=e,e=n,this.m_newNodes[s]=null)}}for(let r=0,o=this.m_newNodes.length;r<o;r++){const o=this.m_newNodes[r];if(null==o)continue;for(o.hash=this.calculateHash(o.pt);;){const r=(0,a.av)(4),l=this.hashTableBinsToCheck(o,r);for(let e=0;e<l;e++)if(null!==r[e])for(let l=r[e];null!==l;){const e=l.nextInHash;a.P.distance(o.pt,l.pt)<=t&&(s.push(l),this.removeNodeFromHash(l),l.hash=0,i.push(l),n.push(l)),l=e}let h=!1;for(const t of s)if(!o.pt.equals(t.pt)){const s=lt(o.pt,t.pt,o.weight,o.rank,t.weight,t.rank);o.pt.assign(s.pt),o.weight=s.weight,o.rank=s.rank,h=!0,e=!0}if(s.length=0,!h)break;o.hash=this.calculateHash(o.pt)}i.push(o),n.push(o);for(let t=o.nextInHash;null!==t;){t.prevInHash=null;const e=t.nextInHash;t.nextInHash=null,i.push(t),n.push(t),t=e}const l=o.hash;let h=null,u=null;for(const t of n)o!==t&&(t.hash=l,t.pt.assign(o.pt),t.rank=o.rank,t.weight=o.weight),t.prevInHash=h,h&&(h.nextInHash=t),t.prevEqual=u,t.nextEqual=null,u&&(u.nextEqual=t),u=t,h=t;const c=l%this.m_hashTableOfEquals.length;h.nextInHash=this.m_hashTableOfEquals[c],null!==this.m_hashTableOfEquals[c]&&(this.m_hashTableOfEquals[c].prevInHash=h),this.m_hashTableOfEquals[c]=n[0],this.m_hashTableOfEqualsSize+=n.length,n.length=0,this.rehashIfNeeded()}if(this.m_newNodes.length=0,e)for(const r of i)this.updateAttachedEdgesAfterNodeChange(r)}rehashIfNeeded(){if(2*this.m_hashTableOfEqualsSize>this.m_hashTableOfEquals.length){const t=this.m_hashTableOfEquals;this.m_hashTableOfEquals=(0,a.av)(2*t.length),this.m_hashTableOfEqualsSize=0;for(const e of t){let t=e;for(;t;){const e=t.nextInHash;t.nextInHash=null,t.prevInHash=null,this.addNodeToHashImpl(t),t=e}}}}addNodeToHashImpl(t){const e=t.hash%this.m_hashTableOfEquals.length,s=this.m_hashTableOfEquals[e];t.nextInHash=s,null!==s&&(s.prevInHash=t),this.m_hashTableOfEquals[e]=t,this.m_hashTableOfEqualsSize++}removeNodeFromHash(t){const e=t.hash%this.m_hashTableOfEquals.length,s=t.prevInHash,n=t.nextInHash;s?s.nextInHash=n:this.m_hashTableOfEquals[e]=n,n&&(n.prevInHash=s),this.m_hashTableOfEqualsSize--,t.prevInHash=null,t.nextInHash=null}hashTableBinsToCheck(t,e){const s=(t.pt.x-this.m_origin.x)/this.m_cell.x,n=(t.pt.y-this.m_origin.y)/this.m_cell.y,i=(0,a.i)()-1,r=Math.round((0,a.s)(s,-2147483646,i)),o=Math.round((0,a.s)(n,-2147483646,i));let l=r|o<<32;l=(0,a.au)(l),e[0]=this.m_hashTableOfEquals[l%this.m_hashTableOfEquals.length];let h=r+1|o<<32;h=(0,a.au)(h);let u=1;e[1]=this.m_hashTableOfEquals[h%this.m_hashTableOfEquals.length],e[1]!==e[0]&&(u=2);let c=r+1|o+1<<32;c=(0,a.au)(c),e[u]=this.m_hashTableOfEquals[c%this.m_hashTableOfEquals.length];for(let a=0;a<u;a++)if(e[u]===e[a]){u--;break}u++;let m=r|o+1<<32;m=(0,a.au)(m),e[u]=this.m_hashTableOfEquals[m%this.m_hashTableOfEquals.length];for(let a=0;a<u;a++)if(e[u]===e[a]){u--;break}return u++,u}calculateHash(t){const e=(t.x-this.m_origin.x)/this.m_cell.x,s=(t.y-this.m_origin.y)/this.m_cell.y,n=(0,a.i)()-1;let i=Math.round((0,a.s)(e,-2147483646,n))|Math.round((0,a.s)(s,-2147483646,n))<<32;return i=(0,a.au)(i),0===i&&(i=1),i}processSharpCorners(t,e,s,n){if(this.parent.m_param1.length=0,this.parent.m_param2.length=0,t.getStartXY().equals(e.getStartXY())){const i=[0,0],o=[0,0],a=(0,r.a3)(t,e,0,0,s,2,i,o,n);if(a){this.parent.m_param1.push(0),this.parent.m_param2.push(0);for(let t=0;t<a;t++)this.parent.m_param1.push(i[t]),this.parent.m_param2.push(o[t]);return a+1}}if(t.getEndXY().equals(e.getEndXY())){const i=[0,0],o=[0,0],a=(0,r.a3)(t,e,1,1,s,2,i,o,n);if(a){for(let t=0;t<a;t++)this.parent.m_param1.push(i[t]),this.parent.m_param2.push(o[t]);return this.parent.m_param1.push(1),this.parent.m_param2.push(1),a+1}}if(t.getStartXY().equals(e.getEndXY())){const i=[0,0],o=[0,0],a=(0,r.a3)(t,e,0,1,s,2,i,o,n);if(a){this.parent.m_param1.push(0),this.parent.m_param2.push(1);for(let t=0;t<a;t++)this.parent.m_param1.push(i[t]),this.parent.m_param2.push(o[t]);return a+1}}if(t.getEndXY().equals(e.getStartXY())){const i=[0,0],o=[0,0],a=(0,r.a3)(t,e,1,0,s,2,i,o,n);if(a){for(let t=0;t<a;t++)this.parent.m_param1.push(i[t]),this.parent.m_param2.push(o[t]);return this.parent.m_param1.push(1),this.parent.m_param2.push(0),a+1}}return 0}}function xt(t,e,s){let n=0;switch(t){case i.G.enumLine:n=0;break;case i.G.enumBezier:n=2;break;case i.G.enumRationalBezier2:n=3;break;case i.G.enumBezier2:n=1;break;case i.G.enumEllipticArc:n=0===e.projectionBehavior()?5:4;break;default:(0,i.d)("")}return s?5-n:n}class vt extends nt{constructor(t){super(t.m_shape,t.m_tolerance,!1),this.m_parent=t}compare(t,e,s){if(this.m_bIntersectionDetected)return-1;const n=t.getElement(s),i=this.m_parent.getEdgeOriginVertices(e),r=this.m_parent.m_edgeVertices.getFirstElement(i),o=this.m_parent.getEdgeOriginVertices(n),a=this.m_parent.m_edgeVertices.getFirstElement(o);return this.m_currentNode=s,this.compareSegments(e,r,n,a)}}class bt extends it{constructor(t){super(t.m_shape,t.m_tolerance),this.m_parent=t}compare(t,e){if(this.m_bIntersectionDetected)return-1;const s=t.getElement(e),n=this.m_parent.getEdgeOriginVertices(s),i=this.m_parent.m_edgeVertices.getFirstElement(n);return this.m_currentNode=e,this.compareVertex(t,e,i)}}class Pt extends o.a3{constructor(t){super(),this.pt1=a.P.getNAN(),this.pt2=a.P.getNAN(),this.m_shape=t}compare(t,e,s){this.m_shape.queryXY(e,this.pt1);const n=t.getElement(s);return this.m_shape.queryXY(n,this.pt2),this.pt1.compare(this.pt2)}}class St{constructor(t){this.m_point=a.P.getNAN(),this.m_pt=a.P.getNAN(),this.m_shape=t}setPoint(t){this.m_point.setCoordsPoint2D(t)}compare(t,e){const s=t.getElement(e);return this.m_shape.queryXY(s,this.m_pt),this.m_point.compare(this.m_pt)}}class Et{constructor(t,e){this.m_shape=null,this.m_progressTracker=null,this.m_edges=new o.S(8),this.m_clusters=new o.S(5),this.m_clusterVertices=new et(!1),this.m_edgeVertices=new et(!1),this.m_helperPoint=new o.P,this.m_eventQ=new o.T,this.m_sweepStructure=new o.T,this.m_bComplications=!1,this.m_sweepComparator=null,this.m_tempEdgeBuffer=[],this.m_modifiedClusters=[],this.m_edgesToInsertInSweepStructure=[],this.m_prevNeighbour=-1,this.m_nextNeighbour=-1,this.m_bContinuingSegmentChainOptimization=!1,this.m_progressCounter=0,this.m_segmentIntersector=new mt,this.m_segBuf1=new r.S,this.m_segBuf2=new r.S,this.m_sweepPoint=new a.P(0,0),this.m_tolerance=0,this.m_toleranceSqr=0,this.m_sweepPointCluster=-1,this.m_vertexClusterIndex=-1,this.m_bCracked=!1,this.m_bSweepPointClusterWasModified=!1,this.m_progressTracker=t,this.m_bTrackChanges=e}hadComplications(){return this.m_bComplications}sweep(t,e){const s=new h.T;s.setSwapCoordinates(),t.applyTransformation(s),this.setEditShape_(t),this.m_bCracked=!1,this.m_tolerance=e,this.m_toleranceSqr=e*e;let n=this.sweepImpl_();return t.applyTransformation(s),n||(this.fillEventQueuePass2(),n=this.sweepImpl_()||n),this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_shape=null,this.m_bCracked}sweepVertical(t,e){this.setEditShape_(t),this.m_bCracked=!1,this.m_tolerance=e,this.m_toleranceSqr=e*e,this.m_bComplications=!1;let s=this.sweepImpl_();if(!this.m_bComplications){const n=t.filterClosePoints(e,!0,!1,this.m_bTrackChanges,r.n);this.m_bComplications=1===n,s||=1===n}return-1!==this.m_vertexClusterIndex&&(this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_vertexClusterIndex=-1),this.m_shape=null,s}getEdgeCluster(t,e){return this.m_edges.getField(t,0+e)}setEdgeCluster_(t,e,s){this.m_edges.setField(t,0+e,s)}getEdgeOriginVertices(t){return this.m_edges.getField(t,2)}setEdgeOriginVertices_(t,e){this.m_edges.setField(t,2,e)}getNextEdgeEx(t,e){return this.m_edges.getField(t,3+e)}setNextEdgeEx_(t,e,s){this.m_edges.setField(t,3+e,s)}getEdgeSweepNode(t){return this.m_edges.getField(t,7)}setEdgeSweepNode_(t,e){this.m_edges.setField(t,7,e)}getNextEdge(t,e){const s=this.getEdgeEnd(t,e);return this.m_edges.getField(t,3+s)}setNextEdge_(t,e,s){const n=this.getEdgeEnd(t,e);this.m_edges.setField(t,3+n,s)}getPrevEdge(t,e){const s=this.getEdgeEnd(t,e);return this.m_edges.getField(t,5+s)}setPrevEdge_(t,e,s){const n=this.getEdgeEnd(t,e);this.m_edges.setField(t,5+n,s)}getClusterVertices(t){return this.m_clusters.getField(t,0)}setClusterVertices_(t,e){this.m_clusters.setField(t,0,e)}getClusterSweepEdgeList(t){return this.m_clusters.getField(t,2)}setClusterSweepEdgeList_(t,e){this.m_clusters.setField(t,2,e)}getClusterFirstEdge(t){return this.m_clusters.getField(t,1)}setClusterFirstEdge_(t,e){this.m_clusters.setField(t,1,e)}getClusterEventQNode(t){return this.m_clusters.getField(t,3)}setClusterEventQNode_(t,e){this.m_clusters.setField(t,3,e)}newCluster_(t){const e=this.m_clusters.newElement(),s=this.m_clusterVertices.createList();return this.setClusterVertices_(e,s),t!==r.n&&(this.m_clusterVertices.addElement(s,t),this.m_shape.setUserIndex(t,this.m_vertexClusterIndex,e)),e}deleteCluster_(t){this.m_clusters.deleteElement(t)}addVertexToCluster_(t,e){const s=this.getClusterVertices(t);this.m_clusterVertices.addElement(s,e),this.m_shape.setUserIndex(e,this.m_vertexClusterIndex,t)}newEdge_(t){const e=this.m_edges.newElement(),s=this.m_edgeVertices.createList();return this.setEdgeOriginVertices_(e,s),-1!==t&&this.m_edgeVertices.addElement(s,t),e}addVertexToEdge_(t,e){const s=this.getEdgeOriginVertices(t);this.m_edgeVertices.addElement(s,e)}deleteEdge_(t){this.m_edges.deleteElement(t);const e=this.m_edgesToInsertInSweepStructure.findIndex((e=>e===t));e>=0&&(0,a.aA)(this.m_edgesToInsertInSweepStructure,e)}addEdgeToCluster(t,e){-1===this.getEdgeCluster(t,0)?this.setEdgeCluster_(t,0,e):-1===this.getEdgeCluster(t,1)?this.setEdgeCluster_(t,1,e):(0,i.d)(""),this.addEdgeToClusterImpl_(t,e)}addEdgeToClusterImpl_(t,e){const s=this.getClusterFirstEdge(e);if(-1!==s){const n=this.getNextEdge(s,e);this.setPrevEdge_(n,e,t),this.setNextEdge_(t,e,n),this.setNextEdge_(s,e,t),this.setPrevEdge_(t,e,s)}else this.setPrevEdge_(t,e,t),this.setNextEdge_(t,e,t),this.setClusterFirstEdge_(e,t)}getEdgeEnd(t,e){return this.getEdgeCluster(t,0)===e?0:1}mergeClusters_(t,e){this.dbgCheckCluster_(t),this.dbgCheckCluster_(e);const s=this.getClusterEventQNode(e);-1!==s&&(this.m_eventQ.deleteNode(s),this.setClusterEventQNode_(e,-1));let n=this.getClusterFirstEdge(t),i=this.getClusterFirstEdge(e);if(-1!==i){let s=i,r=i,o=!1;do{this.dbgCheckEdge_(s),o=!1;const n=this.getEdgeEnd(s,e),a=this.getNextEdgeEx(s,n);if(this.getEdgeCluster(s,n+1&1)===t){this.disconnectEdge_(s);const t=this.getEdgeOriginVertices(s);if(this.m_edgeVertices.deleteList(t),this.deleteEdge_(s),s===a){i=-1;break}i===s&&(i=this.getClusterFirstEdge(e),r=a,o=!0)}s=a}while(s!==r||o);if(-1!==i){do{const n=this.getEdgeEnd(s,e),i=this.getNextEdgeEx(s,n);this.setEdgeCluster_(s,n,t),s=i}while(s!==r);if(n=this.getClusterFirstEdge(t),-1!==n){const e=this.getNextEdge(n,t),s=this.getNextEdge(i,t);e===n?(this.setClusterFirstEdge_(t,i),this.addEdgeToClusterImpl_(n,t),this.setClusterFirstEdge_(t,n)):s===i&&this.addEdgeToClusterImpl_(i,t),this.setNextEdge_(i,t,e),this.setPrevEdge_(e,t,i),this.setNextEdge_(n,t,s),this.setPrevEdge_(s,t,n)}else this.setClusterFirstEdge_(t,i)}}const r=this.getClusterVertices(t),o=this.getClusterVertices(e);for(let a=this.m_clusterVertices.getFirst(o);-1!==a;a=this.m_clusterVertices.getNext(a)){const e=this.m_clusterVertices.getElement(a);this.m_shape.setUserIndex(e,this.m_vertexClusterIndex,t)}this.m_clusterVertices.concatenateLists(r,o),this.deleteCluster_(e),this.dbgCheckCluster_(t)}mergeEdges_(t,e){this.dbgCheckEdge_(t),this.dbgCheckEdge_(e);const s=this.getEdgeCluster(t,0),n=this.getEdgeCluster(t,1),i=this.getEdgeCluster(e,0),r=this.getEdgeCluster(e,1),o=this.getEdgeOriginVertices(t),a=this.getEdgeOriginVertices(e);if(this.m_edgeVertices.concatenateLists(o,a),e===this.getClusterFirstEdge(s)&&this.setClusterFirstEdge_(s,t),e===this.getClusterFirstEdge(n)&&this.setClusterFirstEdge_(n,t),this.disconnectEdge_(e),this.deleteEdge_(e),!(s===i&&n===r||n===i&&s===r)){const t=this.getClusterXY(s),e=this.getClusterXY(i);t.isEqualPoint2D(e)?(s!==i&&this.mergeClusters_(s,i),n!==r&&this.mergeClusters_(n,r)):(n!==i&&this.mergeClusters_(n,i),s!==r&&this.mergeClusters_(s,r))}this.dbgCheckEdge_(t)}disconnectEdge_(t){const e=this.getEdgeCluster(t,0),s=this.getEdgeCluster(t,1);this.disconnectEdgeFromCluster_(t,e),this.disconnectEdgeFromCluster_(t,s)}disconnectEdgeFromCluster_(t,e){const s=this.getNextEdge(t,e),n=this.getPrevEdge(t,e),i=this.getClusterFirstEdge(e);s!==t?(this.setNextEdge_(n,e,s),this.setPrevEdge_(s,e,n),i===t&&this.setClusterFirstEdge_(e,s)):this.setClusterFirstEdge_(e,-1)}applyIntersectorToEditShape_(t,e,s){let n=this.m_edgeVertices.getFirst(t);const i=this.m_edgeVertices.getElement(n),r=this.getClusterFromVertex(i),o=this.m_shape.getNextVertex(i),a=this.getClusterFromVertex(o),l=this.m_shape.getXY(i),h=this.m_shape.getXY(o);let u=!1,c=!1;const m=e.getResultSegment(s,0).getStartXY(),d=e.getResultSegment(s,e.getResultSegmentCount(s)-1).getEndXY();l.equals(m)||(u=!0),h.equals(d)||(c=!0),this.m_shape.splitSegmentWithIntersector(i,e,s,!0,!0);const g=this.m_bTrackChanges&&e.getSegmentChanged(s);for(g&&this.m_shape.setGeometryModifiedWithVertex(i,!0),n=this.m_edgeVertices.getNext(n);-1!==n;n=this.m_edgeVertices.getNext(n)){const t=this.m_edgeVertices.getElement(n),i=this.getClusterFromVertex(t)===r;this.m_shape.splitSegmentWithIntersector(t,e,s,i,!0),g&&this.m_shape.setGeometryModifiedWithVertex(t,!0)}if(u&&this.updateClusterXY(!0,r,m,e.getResultSegmentStartPointWeight(s,0),e.getResultSegmentStartPointRank(s,0)),c){const t=e.getResultSegmentCount(s)-1;this.updateClusterXY(!0,a,d,e.getResultSegmentEndPointWeight(s,t),e.getResultSegmentEndPointRank(s,t))}}createEdgesAndClustersFromSplitEdge_(t,e,s){this.dbgCheckNewEdgesArray_();const n=this.getEdgeOriginVertices(t),i=this.getEdgeCluster(t,0),r=this.getEdgeCluster(t,1);let a=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(a);const l=o.S.impossibleIndex3();this.setEdgeSweepNode_(a,l),this.m_tempEdgeBuffer.push(a),this.addEdgeToCluster(a,i);const h=e.getResultSegmentCount(s);for(let o=1;o<h;o++){const t=this.newCluster_(-1);this.m_modifiedClusters.push(t),this.m_tempEdgeBuffer.push(t),this.addEdgeToCluster(a,t);const e=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(e),this.setEdgeSweepNode_(e,l),this.m_tempEdgeBuffer.push(e),this.addEdgeToCluster(e,t),a=e}this.addEdgeToCluster(a,r);for(let o=this.m_edgeVertices.getFirst(n);-1!==o;o=this.m_edgeVertices.getNext(o)){let t=this.m_edgeVertices.getElement(o);if(this.getClusterFromVertex(t)===i){let e=0;const s=this.m_tempEdgeBuffer.length;do{if(e>0){const s=this.m_tempEdgeBuffer[e-1];this.addVertexToCluster_(s,t)}const s=this.m_tempEdgeBuffer[e];e+=2,this.addVertexToEdge_(s,t),t=this.m_shape.getNextVertex(t)}while(e<s)}else{let e=this.m_tempEdgeBuffer.length-1;do{if(e<this.m_tempEdgeBuffer.length-2){const s=this.m_tempEdgeBuffer[e+1];this.addVertexToCluster_(s,t)}const s=this.m_tempEdgeBuffer[e];e-=2,this.addVertexToEdge_(s,t),t=this.m_shape.getNextVertex(t)}while(e>=0)}}this.m_tempEdgeBuffer.length=0,this.dbgCheckNewEdgesArray_()}getVertexFromClusterIndex(t){const e=this.getClusterVertices(t);return this.m_clusterVertices.getFirstElement(e)}getClusterFromVertex(t){return this.m_shape.getUserIndex(t,this.m_vertexClusterIndex)}processSplitHelper1_(t,e,s){const n=this.getEdgeCluster(e,0),i=this.getClusterXY(n),r=this.getEdgeCluster(e,1),a=this.getClusterXY(r),l=s.getResultSegmentCount(t);let h=s.getResultSegment(t,0);const u=h.getStartXY();if(i.isEqualPoint2D(u)||(this.m_bComplications||i.compare(this.m_sweepPoint)*u.compare(this.m_sweepPoint)<0&&(this.m_bComplications=!0),this.getAffectedEdges(n,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(n)),!this.m_bComplications&&l>1){const t=i.compare(a),e=h.getEndXY();(i.compare(e)!==t||e.compare(a)!==t||e.compare(this.m_sweepPoint)<0)&&(this.m_bComplications=!0)}h=s.getResultSegment(t,l-1);const c=h.getEndXY();a.isEqualPoint2D(c)||(this.m_bComplications||a.compare(this.m_sweepPoint)*c.compare(this.m_sweepPoint)<0&&(this.m_bComplications=!0),this.getAffectedEdges(r,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(r)),this.m_tempEdgeBuffer.push(e);for(let m=0,d=this.m_tempEdgeBuffer.length;m<d;m++){const t=this.m_tempEdgeBuffer[m],s=this.getEdgeSweepNode(t);o.S.isValidElement(s)&&(this.m_sweepStructure.deleteNode(s),this.setEdgeSweepNode_(t,-1));const n=o.S.impossibleIndex3();t!==e&&this.getEdgeSweepNode(t)!==n&&(this.m_edgesToInsertInSweepStructure.push(t),this.setEdgeSweepNode_(t,n))}this.m_tempEdgeBuffer.length=0}checkAndFixIntersection_(t,e){const s=this.m_sweepStructure.getElement(t);return this.m_sweepComparator.compare(this.m_sweepStructure,s,e),!!this.m_sweepComparator.intersectionDetected()&&(this.m_sweepComparator.clearIntersectionDetectedFlag(),this.fixIntersection_(t,e),!0)}fixIntersection_(t,e){this.m_bCracked=!0;const s=this.m_sweepStructure.getElement(t),n=this.m_sweepStructure.getElement(e);let i=null,r=null;const o=this.getEdgeOriginVertices(s),a=this.m_edgeVertices.getFirstElement(o),l=this.getEdgeOriginVertices(n),h=this.m_edgeVertices.getFirstElement(l);this.m_shape.querySegment(a,this.m_segBuf1,!1,!1),i=this.m_segBuf1.get();const u=this.m_shape.getNextVertex(a),c=this.m_shape.getWeight(a),m=this.m_shape.getSegmentParentageBreakVertex(a),d=this.m_shape.getWeight(u),g=this.m_shape.getSegmentParentageBreakVertex(u),p=this.m_shape.getSegmentWeight(a),_=this.m_shape.getRank(a),f=this.m_shape.getRank(u),y=this.m_shape.getSegmentRank(a),x=this.m_shape.getSegmentParentage(a);this.m_shape.querySegment(h,this.m_segBuf2,!1,!1),r=this.m_segBuf2.get();const v=this.m_shape.getNextVertex(h),b=this.m_shape.getWeight(h),P=this.m_shape.getSegmentParentageBreakVertex(h),S=this.m_shape.getWeight(v),E=this.m_shape.getSegmentParentageBreakVertex(v),C=this.m_shape.getSegmentWeight(h),w=this.m_shape.getRank(h),I=this.m_shape.getRank(v),T=this.m_shape.getSegmentRank(h),A=this.m_shape.getSegmentParentage(h);this.m_segmentIntersector.pushSegment(i,c,_,d,f,p,y,m,g,x),this.m_segmentIntersector.pushSegment(r,b,w,S,I,C,T,P,E,A),3===this.m_segmentIntersector.intersect2D(this.m_tolerance,!0)&&(this.m_bComplications=!0),this.splitEdge_(s,n,-1,this.m_segmentIntersector),this.m_segmentIntersector.clear()}fixIntersectionPointSegment_(t,e){this.m_bCracked=!0;const s=this.m_sweepStructure.getElement(e);let n=null;const i=this.getEdgeOriginVertices(s),r=this.m_edgeVertices.getFirstElement(i);this.m_shape.querySegment(r,this.m_segBuf1,!1,!1),n=this.m_segBuf1.get();const o=this.m_shape.getNextVertex(r),a=this.m_shape.getWeight(r),l=this.m_shape.getSegmentParentageBreakVertex(r),h=this.m_shape.getWeight(o),u=this.m_shape.getSegmentParentageBreakVertex(o),c=this.m_shape.getSegmentWeight(r),m=this.m_shape.getRank(r),d=this.m_shape.getRank(o),g=this.m_shape.getSegmentRank(r),p=this.m_shape.getSegmentParentage(r),_=this.getClusterFirstVertex(t);this.m_segmentIntersector.pushSegment(n,a,m,h,d,c,g,l,u,p),this.m_shape.queryPoint(_,this.m_helperPoint);const f=this.m_shape.getWeight(_),y=this.m_shape.getRank(_);this.m_segmentIntersector.intersect2DEx(this.m_tolerance,this.m_helperPoint,y,f,!0),this.splitEdge_(s,-1,t,this.m_segmentIntersector),this.m_segmentIntersector.clear()}insertNewEdges_(){if(0===this.m_edgesToInsertInSweepStructure.length)return!0;this.dbgCheckNewEdgesArray_();let t=!0,e=0;const s=this.m_edgesToInsertInSweepStructure.length,n=Math.max(2*s+200,this.m_sweepStructure.size()+200);for(;this.m_edgesToInsertInSweepStructure.length;){if(this.m_edgesToInsertInSweepStructure.length>Math.max(100,this.m_shape.getTotalPointCount())||e>n){this.m_edgesToInsertInSweepStructure.length=0,this.m_bComplications=!0,t=!1;break}const s=this.m_edgesToInsertInSweepStructure.at(-1);this.m_edgesToInsertInSweepStructure.pop(),this.setEdgeSweepNode_(s,-1);const i=this.isEdgeOnSweepLine_(s);o.S.isValidElement(i)?(this.insertNewEdgeToSweepStructure_(s,i),e++):i!==o.S.impossibleIndex2()&&(t=!1),this.m_bContinuingSegmentChainOptimization=!1}return t}insertNewEdgeToSweepStructure_(t,e){let s;if(this.m_bContinuingSegmentChainOptimization?(s=this.m_sweepStructure.addElementAtPosition(this.m_prevNeighbour,this.m_nextNeighbour,t,!0,!0),this.m_bContinuingSegmentChainOptimization=!1):s=this.m_sweepStructure.addUniqueElement(t),-1===s){const e=this.m_sweepStructure.getDuplicateElement(),s=this.m_sweepStructure.getElement(e);return this.mergeEdges_(s,t),!1}if(this.setEdgeSweepNode_(t,s),this.m_sweepComparator.intersectionDetected()){this.m_sweepComparator.clearIntersectionDetectedFlag();const t=this.m_sweepComparator.getLastComparedNode();return this.m_prevNeighbour===t&&(this.m_prevNeighbour=-1),this.m_nextNeighbour===t&&(this.m_nextNeighbour=-1),this.fixIntersection_(t,s),!0}return!1}isEdgeOnSweepLine_(t){const e=this.getEdgeCluster(t,0),s=this.getEdgeCluster(t,1),n=this.getClusterXY(e),i=this.getClusterXY(s);if(a.P.sqrDistance(n,i)<=this.m_toleranceSqr)return this.m_bComplications=!0,-1;const r=n.compare(this.m_sweepPoint),l=i.compare(this.m_sweepPoint);return r<=0&&l>0?s:l<=0&&r>0?e:r>0&&l>0?o.S.impossibleIndex2():-1}fillEventQueue(){const t=new o.A(0),e=this.m_shape.queryVertexIteratorOnSelection();for(let i=e.next();i!==r.n;i=e.next())-1!==this.m_shape.getUserIndex(i,this.m_vertexClusterIndex)&&t.add(i);this.m_shape.sortVerticesSimpleByY(t,0,t.size()),this.progress_(!0),this.m_eventQ.clear(),this.m_eventQ.setCapacity(t.size()),this.m_eventQ.setComparator(new Pt(this.m_shape));const s=a.P.getNAN();s.setNAN();let n=-1;for(let i=0,r=t.size();i<r;i++){const e=t.read(i);if(this.m_shape.getXY(e).isEqualPoint2D(s)){const t=this.m_shape.getUserIndex(e,this.m_vertexClusterIndex);this.mergeClusters_(n,t);continue}n=this.getClusterFromVertex(e),this.m_shape.queryXY(e,s);const r=this.m_eventQ.addBiggestElement(e);this.setClusterEventQNode_(n,r)}}fillEventQueuePass2(){const t=new o.A(0);for(let e=this.m_eventQ.getFirst();-1!==e;e=this.m_eventQ.getNext(e)){const s=this.m_eventQ.getElement(e);t.add(s)}this.m_eventQ.clear(),this.m_shape.sortVerticesSimpleByY(t,0,t.size()),this.progress_(!0);for(let e=0,s=t.size();e<s;e++){const s=t.read(e),n=this.getClusterFromVertex(s),i=this.m_eventQ.addBiggestElement(s);this.setClusterEventQNode_(n,i)}}getAffectedEdges(t,e){const s=this.getClusterFirstEdge(t);if(-1===s)return;let n=s;do{const s=this.getEdgeSweepNode(n);o.S.isValidElement(s)&&e.push(n),n=this.getNextEdge(n,t)}while(n!==s)}updateClusterXY(t,e,s,n,i){const r=this.getClusterVertices(e);for(let o=this.m_clusterVertices.getFirst(r);-1!==o;o=this.m_clusterVertices.getNext(o)){const e=this.m_clusterVertices.getElement(o);this.m_shape.setXYMonotonicPoint2D(e,s),this.m_shape.setWeight(e,n),this.m_shape.setRank(e,i),t&&this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(e,!0),this.m_shape.setSegmentParentageBreakVertex(e,!0)}}splitEdge_(t,e,s,n){this.dbgCheckEdge_(t),-1!==e&&this.dbgCheckEdge_(e),this.disconnectEdge_(t),-1!==e&&this.disconnectEdge_(e),this.processSplitHelper1_(0,t,n),-1!==e&&this.processSplitHelper1_(1,e,n),-1!==s&&n.getResultPointChanged()&&this.m_modifiedClusters.push(s);for(let o=0,a=this.m_modifiedClusters.length;o<a;o++){const t=this.m_modifiedClusters[o],e=this.getClusterEventQNode(t);-1!==e&&(this.m_eventQ.deleteNode(e),this.setClusterEventQNode_(t,-1))}const i=this.getEdgeOriginVertices(t),r=-1!==e?this.getEdgeOriginVertices(e):-1;if(this.applyIntersectorToEditShape_(i,n,0),-1!==r)this.applyIntersectorToEditShape_(r,n,1);else{const t=n.getResultPoint().getXY();this.updateClusterXY(n.getResultPointChanged(),s,t,n.getResultPointWeight(),n.getResultPointRank())}this.createEdgesAndClustersFromSplitEdge_(t,n,0),-1!==e&&this.createEdgesAndClustersFromSplitEdge_(e,n,1),this.m_edgeVertices.deleteList(i),this.deleteEdge_(t),-1!==e&&(this.m_edgeVertices.deleteList(r),this.deleteEdge_(e));for(let o=0,a=this.m_modifiedClusters.length;o<a;o++){const t=this.m_modifiedClusters[o];t===this.m_sweepPointCluster&&(this.m_bSweepPointClusterWasModified=!0);let e=this.getClusterEventQNode(t);if(-1===e){const s=this.getClusterFirstVertex(t);if(e=this.m_eventQ.addUniqueElement(s),-1===e){const e=this.m_eventQ.getDuplicateElement(),s=this.m_eventQ.getElement(e),n=this.getClusterFromVertex(s);this.mergeClusters_(n,t)}else this.setClusterEventQNode_(t,e)}}this.m_modifiedClusters.length=0}getClusterXY(t){const e=this.getClusterFirstVertex(t);return this.m_shape.getXY(e)}getClusterFirstVertex(t){const e=this.getClusterVertices(t);return this.m_clusterVertices.getFirstElement(e)}dbgCheckEdge_(t){}dbgCheckCluster_(t){}dbgCheckNewEdgesArray_(){}dbgSaveSweepStructure_(t){}sweepImpl_(){this.progress_(!0),this.m_bSweepPointClusterWasModified=!1,this.m_sweepPointCluster=-1,null===this.m_sweepComparator&&(this.m_sweepStructure.disableBalancing(),this.m_sweepComparator=new vt(this),this.m_sweepStructure.setComparator(this.m_sweepComparator));const t=[];let e=null,s=null;this.m_prevNeighbour=-1,this.m_nextNeighbour=-1,this.m_bContinuingSegmentChainOptimization=!1;const n=o.S.impossibleIndex2(),i=o.S.impossibleIndex3();for(let r=this.m_eventQ.getFirst();-1!==r;){this.progress_(),this.dbgCheckSweepStructure_(),this.m_bContinuingSegmentChainOptimization=!1,this.m_prevNeighbour=-1,this.m_nextNeighbour=-1;const o=this.m_eventQ.getElement(r);this.m_sweepPointCluster=this.getClusterFromVertex(o),this.m_shape.queryXY(o,this.m_sweepPoint),this.m_sweepComparator.setSweepY(this.m_sweepPoint.y,this.m_sweepPoint.x);let a=!1;{const e=this.getClusterFirstEdge(this.m_sweepPointCluster);if(a=-1===e,!a){let s=e;do{const e=this.getEdgeSweepNode(s);-1===e?(this.m_edgesToInsertInSweepStructure.push(s),this.setEdgeSweepNode_(s,i)):e!==i&&t.push(e),s=this.getNextEdge(s,this.m_sweepPointCluster)}while(s!==e)}}if(!this.m_sweepStructure.isAutoBalancing()&&(this.m_sweepStructure.getMaxDepthEver()>4||this.m_edgesToInsertInSweepStructure.length>10)&&this.m_sweepStructure.enableBalancing(),t.length>0){this.m_bContinuingSegmentChainOptimization=1===t.length&&1===this.m_edgesToInsertInSweepStructure.length;for(let i=0,r=t.length;i<r;i++){const e=this.m_sweepStructure.getElement(t[i]);this.setEdgeSweepNode_(e,n)}let e=n,s=n;for(let i=0,r=t.length;i<r;i++){const r=t[i];if(e===n){const t=this.m_sweepStructure.getPrev(r);if(-1!==t){const s=this.m_sweepStructure.getElement(t);this.getEdgeSweepNode(s)!==n&&(e=t)}else e=-1}if(s===n){const t=this.m_sweepStructure.getNext(r);if(-1!==t){const e=this.m_sweepStructure.getElement(t);this.getEdgeSweepNode(e)!==n&&(s=t)}else s=-1}if(e!==n&&s!==n)break}for(let n=0,i=t.length;n<i;n++){const e=t[n],s=this.m_sweepStructure.getElement(e);this.m_sweepStructure.deleteNode(e),this.setEdgeSweepNode_(s,-1)}t.length=0,this.m_prevNeighbour=e,this.m_nextNeighbour=s,-1!==e&&-1!==s?this.m_bContinuingSegmentChainOptimization||this.checkAndFixIntersection_(e,s):-1===e&&-1===s&&(this.m_bContinuingSegmentChainOptimization=!1)}else a&&(null===e&&(e=new bt(this)),e.setPoint(this.m_sweepPoint),this.m_sweepStructure.searchUpperBound(e),e.intersectionDetected()&&(e.clearIntersectionDetectedFlag(),this.fixIntersectionPointSegment_(this.m_sweepPointCluster,e.getCurrentNode())));const l=this.m_bContinuingSegmentChainOptimization;!this.insertNewEdges_()&&l&&-1!==this.m_prevNeighbour&&-1!==this.m_nextNeighbour&&this.checkAndFixIntersection_(this.m_prevNeighbour,this.m_nextNeighbour),this.m_bSweepPointClusterWasModified?(this.m_bSweepPointClusterWasModified=!1,null===s&&(s=new St(this.m_shape)),s.setPoint(this.m_sweepPoint),r=this.m_eventQ.searchUpperBound(s)):r=this.m_eventQ.getNext(r)}return this.m_bCracked}setEditShape_(t){this.m_shape=t,this.m_vertexClusterIndex=this.m_shape.createUserIndex(),this.m_edges.setCapacity(t.getSelectedCount()+32),this.m_clusters.setCapacity(t.getSelectedCount()),this.m_clusterVertices.reserveLists(t.getSelectedCount()),this.m_clusterVertices.reserveNodes(t.getSelectedCount()),this.m_edgeVertices.reserveLists(t.getSelectedCount()+32),this.m_edgeVertices.reserveNodes(t.getSelectedCount()+32);for(let e=this.m_shape.getFirstGeometry();e!==r.n;e=this.m_shape.getNextGeometry(e))if((0,i.h)(this.m_shape.getGeometryType(e)))for(let s=this.m_shape.getFirstPath(e);s!==r.n;s=this.m_shape.getNextPath(s)){const e=this.m_shape.getPathSize(s),n=this.m_shape.getFirstVertex(s);if(n===r.n)continue;let i=this.m_shape.getNextVertex(n);if(i===r.n||i===n)continue;let o=-1;t.selected(n)&&(o=this.newCluster_(n));let a=-1;-1!==o&&t.selected(i)&&(a=this.newEdge_(n),this.addEdgeToCluster(a,o));let l=a;for(let t=0,s=e-2;t<s;t++){const t=this.m_shape.getNextVertex(i);let e=-1;if(this.m_shape.selected(i)){const s=this.newCluster_(i);-1!==l&&this.addEdgeToCluster(l,s),this.m_shape.selected(t)&&(e=this.newEdge_(i),this.addEdgeToCluster(e,s))}l=e,i=t}if(this.m_shape.isClosedPath(s)){const t=this.m_shape.getNextVertex(i);if(this.m_shape.selected(i)){const e=this.newCluster_(i);if(-1!==l&&this.addEdgeToCluster(l,e),this.m_shape.selected(t)){const t=this.newEdge_(i);this.addEdgeToCluster(t,e),this.addEdgeToCluster(t,o)}}}else{let t=-1;this.m_shape.selected(i)&&(t=this.newCluster_(i),-1!==l&&this.addEdgeToCluster(l,t))}}else for(let t=this.m_shape.getFirstPath(e);t!==r.n;t=this.m_shape.getNextPath(t)){let e=this.m_shape.getFirstVertex(t);for(let s=0,n=this.m_shape.getPathSize(t);s<n;s++)this.m_shape.selected(e)&&this.newCluster_(e),e=this.m_shape.getNextVertex(e)}this.fillEventQueue()}progress_(t=!1){}dbgCheckSweepStructure_(){}}function Ct(t,e,s){return{vertex0:t,vertex1:e,dir:s}}class wt{constructor(t){this.m_shape=null,this.m_spikes=[],this.m_points=new o.A(0),this.m_pointsIndex=-1,this.m_dissolvedEdges=0,this.m_progressTracker=t}executeImpl_(t,e){if(this.m_shape=t,t.getPathCount(e)<2&&t.getPointCount(e)<6)return;this.m_points.resize(0);for(let i=t.getFirstPath(e);i!==r.n;i=t.getNextPath(i)){let e=t.getFirstVertex(i);for(let s=0,n=t.getPathSize(i);s<n;s++,e=t.getNextVertex(e))this.m_points.add(e)}this.m_pointsIndex=t.createUserIndex();for(let i=0,r=this.m_points.size();i<r;++i)t.setUserIndex(this.m_points.read(i),this.m_pointsIndex,i);t.sortVerticesSimpleByY(this.m_points,0,this.m_points.size());let s=this.m_points.read(0);const n=t.getXY(s);let o=1,a=0;const l=[];for(let i=1;i<this.m_points.size();i++){const e=this.m_points.read(i);if(e===r.n)continue;if(-1===t.getUserIndex(e,this.m_pointsIndex))continue;const h=t.getXY(e);if(h.isEqualPoint2D(n))o++;else{if(o>1){for(let e=a;e<i;e++){const s=this.m_points.read(e);if(-1===t.getUserIndex(s,this.m_pointsIndex))continue;const i=t.getNextVertex(s),r=t.getPrevVertex(s);if(s!==i&&!t.isEqualXYPoint2D(i,n)){const t=Ct(s,i,1);l.push(t)}if(s!==r&&r!==i&&!t.isEqualXYPoint2D(r,n)){const t=Ct(s,r,-1);l.push(t)}}l.length>0&&this.processBunch_(l,n)}s=e,n.assign(h),o=1,a=i}}if(0===this.m_dissolvedEdges)return t.removeUserIndex(this.m_pointsIndex),void(this.m_pointsIndex=-1);let h=t.getPointCount(e);for(let i=0;i<this.m_points.size();i++){const e=this.m_points.read(i);if(e===r.n)continue;if(-1!==t.getUserIndex(e,this.m_pointsIndex)){t.setUserIndex(e,this.m_pointsIndex,-1);continue}const s=t.getPathFromVertex(e);t.getFirstVertex(s)===e&&t.setFirstVertex(s,r.n),t.freeVertex(e),this.m_points.write(i,r.n),h--}const u=t.createPathUserIndex();let c=t.getPathCount(e);for(let m=0,d=this.m_points.size();m<d;++m){if(this.m_points.read(m)===r.n)continue;let s=this.m_points.read(m);if(-1!==t.getUserIndex(s,this.m_pointsIndex))continue;let n=t.getPathFromVertex(s),o=-1;if(2===t.getPathUserIndex(n,u)){n=r.n;for(let e=t.getNextVertex(s);e!==s;e=t.getNextVertex(e)){const i=t.getPathFromVertex(e);if(2!==t.getPathUserIndex(i,u)){n=i,s=e;break}}n===r.n&&(n=t.insertPath(e,r.n),t.setClosedPath(n,!0),c++),(0,i.g)(n!==r.n)}t.setPathUserIndex(n,u,2),o=t.getFirstVertex(n);let a=0,l=!1,h=s;do{o===h&&(l=!0),t.setUserIndex(h,this.m_pointsIndex,1);const e=t.getPathFromVertex(h);e!==n&&(2!==t.getPathUserIndex(e,u)&&(t.setPathUserIndex(e,u,1),t.setFirstVertex(e,r.n)),t.setPathToVertex(h,n)),a++,h=t.getNextVertex(h)}while(h!==s);l||t.setFirstVertex(n,s),t.setPathSize(n,a)}for(let i=t.getFirstPath(e);i!==r.n;){const e=t.getNextPath(i);1!==t.getPathUserIndex(i,u)&&t.getFirstVertex(i)!==r.n||(t.removePathOnly(i),c--),i=e}t.setGeometryVertexCount(e,h),t.setGeometryPathCount(e,c),t.removePathUserIndex(u),t.removeUserIndex(this.m_pointsIndex),this.m_pointsIndex=-1,t.dbgVerifyVertexCounts(),t.filterClosePoints(0,!0,!1,!1,e)}processBunch_(t,e){t.sort(((t,s)=>{const n=this.m_shape.getXY(t.vertex1).sub(e),i=this.m_shape.getXY(s.vertex1).sub(e),r=a.P.compareVectors(n,i);return 0===r?t.dir<s.dir?-1:1:r}));let s=0;const n=this.m_shape.getXY(t[0].vertex1);let i=1;const r=this.m_shape.hasCurves();for(let o=1,a=t.length;o<a;o++){const e=this.m_shape.getXY(t[o].vertex1);if(!(e.isEqualPoint2D(n)&&(i++,o+1<a))){if(2===i){const e=t[s],n=t[s+1],i=e.dir;if(i!==n.dir){let t=!0;if(r&&(t=!this.m_shape.isCurve(1===e.dir?e.vertex0:e.vertex1)&&!this.m_shape.isCurve(1===n.dir?n.vertex0:n.vertex1)),t){if(1===i){const t=e.vertex0,s=n.vertex0;this.m_shape.setNextVertex(t,s),this.m_shape.setPrevVertex(s,t),this.m_shape.getPrevVertex(t)===s&&(this.m_shape.setUserIndex(t,this.m_pointsIndex,-1),this.m_shape.setUserIndex(s,this.m_pointsIndex,-1));const i=e.vertex1,r=n.vertex1;this.m_shape.setPrevVertex(i,r),this.m_shape.setNextVertex(r,i),this.m_shape.getNextVertex(i)===r&&(this.m_shape.setUserIndex(i,this.m_pointsIndex,-1),this.m_shape.setUserIndex(r,this.m_pointsIndex,-1))}else{const t=e.vertex0,s=n.vertex0;this.m_shape.setPrevVertex(t,s),this.m_shape.setNextVertex(s,t),this.m_shape.getNextVertex(t)===s&&(this.m_shape.setUserIndex(t,this.m_pointsIndex,-1),this.m_shape.setUserIndex(s,this.m_pointsIndex,-1));const i=e.vertex1,r=n.vertex1;this.m_shape.setNextVertex(i,r),this.m_shape.setPrevVertex(r,i),this.m_shape.getPrevVertex(i)===r&&(this.m_shape.setUserIndex(i,this.m_pointsIndex,-1),this.m_shape.setUserIndex(r,this.m_pointsIndex,-1))}this.m_dissolvedEdges+=2}}}n.assign(e),s=o,i=1}}t.length=0}}function It(t){for(let e=t.getFirstGeometry();e!==r.n;e=t.getNextGeometry(e))if((0,i.h)(t.getGeometryType(e)))return!0;return!1}function Tt(t,e,s,n,i){if(!It(e))return!1;let r=new Mt(i);if(r.m_shape=e,r.m_tolerance=s,r.m_bAllowCoincident=t,r.m_bNeedsNonSimpleResult=null!==n,r.needsCrackingImpl_())return n&&n.assign(r.m_nonSimpleResult),!0;const o=new h.T;o.setSwapCoordinates(),e.applyTransformation(o),r=new Mt(i),r.m_shape=e,r.m_tolerance=s,r.m_bAllowCoincident=t,r.m_bNeedsNonSimpleResult=null!==n;const a=r.needsCrackingImpl_();return e.applyTransformation(o),!!a&&(n&&n.assign(r.m_nonSimpleResult),!0)}function At(t,e){return{t:t,index:e}}class Mt{crackBruteForce_(){let t=this.crackBruteForceImpl_();if(!t&&this.m_shape.hasCurves()){const e=new h.T;e.setSwapCoordinates(),this.m_shape.applyTransformation(e),t=this.crackBruteForceImpl_(),this.m_shape.applyTransformation(e)}return t}crackBruteForceImpl_(){let t=!1;const e=new r.S,s=new r.S,a=n.Envelope2D.constructEmpty(),l=n.Envelope2D.constructEmpty(),h=!1,u=new o.P,c=new mt,m=this.m_shape.getTotalPointCount(),d=m*m*2,g=this.m_shape.queryVertexIteratorOnSelection();for(let n=g.next();n!==r.n;n=g.next()){const o=this.m_shape.getGeometryType(g.currentGeometry());let m=1,p=1,_=1,f=0,y=0,x=0;const v=this.m_shape.getSegmentParentage(n);let b=!1,P=!1,S=null,E=!1;if((0,i.e)(o))m=this.m_shape.getWeight(n),f=this.m_shape.getRank(n);else{if(S=this.getSegment_(n,e),null===S)continue;const t=this.m_shape.getVertexIndex(n);m=this.m_shape.getWeightWithIndex(t),f=this.m_shape.getRankWithIndex(t),_=this.m_shape.getSegmentWeightWithIndex(t),x=this.m_shape.getSegmentRankWithIndex(t),b=this.m_shape.getSegmentParentageBreakVertex(n);{const t=this.m_shape.getNextVertex(n);p=this.m_shape.getWeight(t),y=this.m_shape.getRank(t),P=this.m_shape.getSegmentParentageBreakVertex(t)}if(S.queryLooseEnvelope(a),a.inflateCoords(this.m_tolerance,this.m_tolerance),S.isDegenerate(this.m_tolerance)){if(!S.isDegenerate(0))continue;E=!0,S=null}}const C=new r.X({copy:g});let w=C.next();w!==r.n&&(w=C.next());let I=0;for(;w!==r.n;w=C.next()){if(0!==I){I--;continue}if(this.m_shape.getTotalPointCount()>d)return t;this.progress_();const o=this.m_shape.getGeometryType(C.currentGeometry());let T=null,A=!1,M=0,D=0,N=0,F=0,R=0,k=0,L=!1,G=!1;const V=this.m_shape.getSegmentParentage(w);if((0,i.e)(o))M=this.m_shape.getWeight(w),F=this.m_shape.getRank(w);else{if(T=this.getSegment_(w,s),null===T)continue;const t=this.m_shape.getVertexIndex(w);M=this.m_shape.getWeightWithIndex(t),F=this.m_shape.getRankWithIndex(t),N=this.m_shape.getSegmentWeightWithIndex(t),k=this.m_shape.getSegmentRankWithIndex(t),L=this.m_shape.getSegmentParentageBreakVertex(w);{const t=this.m_shape.getNextVertex(w);D=this.m_shape.getWeight(t),R=this.m_shape.getRank(t),G=this.m_shape.getSegmentParentageBreakVertex(t)}if(T.queryLooseEnvelope(l),T.isDegenerate(this.m_tolerance)){if(!T.isDegenerate(0))continue;A=!0,T=null}}let z=0,O=0;if(null!==S&&null!==T)a.isIntersectingNe(l)&&0!==(0,r.Y)(!0,!0,S,T,this.m_tolerance,!0)&&(c.pushSegment(S,m,f,p,y,_,x,b,P,v),c.pushSegment(T,M,F,D,R,N,k,L,G,V),c.intersect2D(this.m_tolerance,!0),t||=c.getSegmentChanged(0)||c.getSegmentChanged(1),z=c.getResultSegmentCount(0),O=c.getResultSegmentCount(1),z+O>0&&(this.m_shape.splitSegmentWithIntersector(n,c,0,!0,!0),this.m_shape.splitSegmentWithIntersector(w,c,1,!0,!0),this.m_bTrackChanges&&(c.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(n,!0),c.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(w,!0))),O>1&&(I+=O-1),c.clear());else if(null!==S){const e=this.m_shape.getXY(w);if(a.contains(e)){if(c.pushSegment(S,m,f,p,y,_,x,b,P,v),this.m_shape.queryPoint(w,u),c.intersect2DEx(this.m_tolerance,u,F,M,h),t||=c.getSegmentChanged(0)||c.getResultPointChanged(),z=c.getResultSegmentCount(0),z>0)if(this.m_bTrackChanges&&(c.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(n,!0),c.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(w,!0)),this.m_shape.splitSegmentWithIntersector(n,c,0,!0,!0),A){let t=r.n;for(let e=this.m_shape.getNextVertex(w);e!==r.n&&e!==w&&(T=this.getSegment_(e,s),t=e,null!=T&&T.isDegenerate(0));e=this.m_shape.getNextVertex(e));for(let e=w;e!==r.n&&(this.m_shape.setPoint(e,c.getResultPoint(),!0),e!==t);e=this.m_shape.getNextVertex(e));}else this.m_shape.setPoint(w,c.getResultPoint(),!0);c.clear()}}else{if(null===T)continue;{const e=this.m_shape.getXY(n);if(l.inflateCoords(this.m_tolerance,this.m_tolerance),l.contains(e)){if(c.pushSegment(T,M,F,D,R,N,k,L,G,V),this.m_shape.queryPoint(n,u),c.intersect2DEx(this.m_tolerance,u,f,m,h),t||=c.getSegmentChanged(0)||c.getResultPointChanged(),O=c.getResultSegmentCount(0),O>0)if(this.m_bTrackChanges&&(c.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(w,!0),c.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(n,!0)),this.m_shape.splitSegmentWithIntersector(w,c,0,!0,!0),I+=O-1,E){let t=r.n;for(let e=this.m_shape.getNextVertex(n);e!==r.n&&e!==n&&(T=this.getSegment_(e,s),t=e,null!=T&&T.isDegenerate(0));e=this.m_shape.getNextVertex(e));for(let e=n;e!==r.n&&(this.m_shape.setPoint(e,c.getResultPoint(),!0),e!==t);e=this.m_shape.getNextVertex(e));}else this.m_shape.setPoint(n,c.getResultPoint(),!0);c.clear()}}}if(z+O!==0&&0!==z){let t=!1;for(;S=this.getSegment_(n,e),null!=S&&(S.queryEnvelope(a),S.isDegenerate(this.m_tolerance));){if(!(z>1)){t=!0;break}n=g.next(),z--,(0,i.g)(n!==r.n)}if(t)break}}}return t}crackerPlaneSweep_(){return this.planesweep_()}planesweep_(){return new Et(this.m_progressTracker,this.m_bTrackChanges).sweep(this.m_shape,this.m_tolerance)}needsCrackingImpl_(){let t=!1;const e=new o.A(0);e.resize(this.m_shape.getSelectedCount());const s=this.m_shape.queryVertexIteratorOnSelection();for(let i=0,o=s.next();o!==r.n;++i,o=s.next())e.write(i,o);this.m_shape.sortVerticesSimpleByY(e,0,e.size()),e.add(r.n);const n=this.m_shape.createUserIndex(),l=this.m_shape.createUserIndex();this.m_sweepComparator=new nt(this.m_shape,this.m_tolerance,!this.m_bAllowCoincident),this.m_sweepStructure.setComparator(this.m_sweepComparator);let h=null;const u=[],c=[];let m=0;const g=new a.P;for(let o=e.read(m++);o!==r.n;){this.m_shape.queryXY(o,g);let s=!1;do{let t=this.m_shape.getNextVertex(o),i=this.m_shape.getPrevVertex(o);s||=t!==r.n||i!==r.n,t===r.n||this.m_shape.selected(t)||(t=r.n),i===r.n||this.m_shape.selected(i)||(i=r.n),t!==r.n&&this.m_shape.compareVerticesSimpleY(o,t)<0&&(c.push(o),c.push(t)),i!==r.n&&this.m_shape.compareVerticesSimpleY(o,i)<0&&(c.push(i),c.push(i));const a=this.m_shape.getUserIndex(o,n);-1!==a&&(u.push(a),this.m_shape.setUserIndex(o,n,-1));const h=this.m_shape.getUserIndex(o,l);-1!==h&&(u.push(h),this.m_shape.setUserIndex(o,l,-1)),o=e.read(m++)}while(o!==r.n&&this.m_shape.isEqualXYPoint2D(o,g));if(!s&&(null===h&&(h=new it(this.m_shape,this.m_tolerance)),h.setPoint(g),this.m_sweepStructure.searchUpperBound(h),h.intersectionDetected())){t=!0,this.m_bNeedsNonSimpleResult&&((0,i.d)("needsCrackingIMpl_"),this.m_nonSimpleResult=new d.NonSimpleResult(6,-1,-1));break}let p=1===u.length&&2===c.length;const _=32;u.length>_&&(0,a.v)(u);let f=-1,y=-1;if(!p)for(let e=0,n=u.length;e<n;e++){const s=u[e],n=this.m_sweepStructure.getPrev(s);if(-1!==n&&-1===u.indexOf(n))if(-1===f)f=n;else{if(t=!0,!this.m_bNeedsNonSimpleResult)break;this.m_nonSimpleResult=new d.NonSimpleResult(6,-1,-1)}const i=this.m_sweepStructure.getNext(s);if(-1!==i&&-1===u.indexOf(i))if(-1===y)y=i;else{if(t=!0,!this.m_bNeedsNonSimpleResult)break;this.m_nonSimpleResult=new d.NonSimpleResult(6,-1,-1)}if(-1!==f&&-1!==y)break}if(t&&!this.m_bNeedsNonSimpleResult)break;if(this.m_sweepComparator.setSweepY(g.y,g.x),!p){for(let t=0,e=u.length;t<e;t++){const e=u[t];this.m_sweepStructure.deleteNode(e)}u.length=0}if(!p&&-1!==f&&-1!==y&&this.checkForIntersections_(f,y)){t=!0,this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult());break}for(let e=0,i=c.length;e<i;e+=2){const s=c[e],i=c[e+1];let r;if(p?(r=this.m_sweepStructure.replaceElementAtPosition(u[0],s,!0,!0),u.length=0,p=!1):r=this.m_sweepStructure.addElement(s),this.m_sweepComparator.intersectionDetected()){this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult()),t=!0;break}-1===this.m_shape.getUserIndex(i,n)?this.m_shape.setUserIndex(i,n,r):this.m_shape.setUserIndex(i,l,r)}if(t)break;c.length=0}return this.m_shape.removeUserIndex(n),this.m_shape.removeUserIndex(l),t}checkForIntersections_(t,e){const s=this.m_sweepStructure.getElement(t);this.m_sweepComparator.compare(this.m_sweepStructure,s,e);const n=this.m_sweepComparator.intersectionDetected();return this.m_sweepComparator.clearIntersectionDetectedFlag(),n}getSegment_(t,e){return Mt.st_getSegment(this.m_shape,t,e)}static st_getSegment(t,e,s){return t.querySegment(e,s,!1,!1)?s.get():null}dbgPrintSweepEdge(t){}dbgPrintSweepStructure(){}dbgSaveSweepStructure(t=null){}dbgCheckSweepStructure(){}progress_(t=!1){this.m_progressCounter++}crackAWithBMultiPath_(t,e,s){const l=n.Envelope2D.constructEmpty();t.queryLooseEnvelope(l);const h=n.Envelope2D.constructEmpty();if(e.queryLooseEnvelope(h),h.inflateCoords(s,s),!h.isIntersecting(l))return t;const u=t.getImpl(),c=u.getAccelerators();let m=null,d=null;c&&(d=c.getQuadTree()),function(t,e){const s=t.getPointCount();if(s<16)return!1;const n=1;return 2*s+Math.log(s)/Math.log(2)*1*e<n*s*e}(t,(0,i.v)(e))&&(m=(0,o.F)(u,h),d=m);const g=d?d.getIteratorForQT():null,p=e.querySegmentIterator(),_=t.querySegmentIterator(),f=(0,a.d)(15,Number.NaN),y=[];for(;p.nextPath();)for(;p.hasNextSegment();){const t=p.nextSegment();if(d){g.resetIterator(t,s);for(let e=g.next();-1!==e;e=g.next()){this.progress_();const n=d.getElement(e);if(_.resetToVertex(n,-1),_.hasNextSegment()){const e=_.nextSegment().intersect(t,null,f,null,s);for(let t=0;t<e;t++){const e=f[t];if(0===e||1===e)continue;const s=At(e,_.getStartPointIndex());y.push(s)}}}}else{const e=n.Envelope2D.constructEmpty();if(t.queryLooseEnvelope(e),e.inflateCoords(s,s),!l.isIntersecting(e))continue;for(_.resetToFirstPath();_.nextPath();)for(;_.hasNextSegment();){const i=_.nextSegment(),r=n.Envelope2D.constructEmpty();if(i.queryLooseEnvelope(r),!r.isIntersecting(e))continue;const o=i.intersect(t,null,f,null,s);for(let t=0;t<o;t++){const e=f[t];if(0===e||1===e)continue;const s=At(e,_.getStartPointIndex());y.push(s)}}}}if(0===y.length)return t;y.sort(((t,e)=>t.index<e.index?-1:t.index>e.index?1:t.t<e.t?-1:t.t>e.t?1:0));const x=t.createInstance();for(x.getGeometryType()===i.G.enumPolygon&&x.setFillRule(t.getFillRule()),_.resetToFirstPath();_.nextPath()&&!_.hasNextSegment(););(0,i.g)(_.hasNextSegment());let v=_.nextSegment();const b=new r.S;let P=-1;for(let n=0,r=y.length;n<r;){const t=y[n].index;let e=n+1;for(;e<r&&y[e].index===t;)++e;for(;_.getStartPointIndex()<t;){this.progress_();const t=_.hasNextSegment(),e=_.getPathIndex();if((t||!_.isClosingSegment()||_.isCurve())&&((0,i.g)(null!==v),x.addSegment(v,P!==e)),P=e,!t){for(_.isPathClosed();_.nextPath()&&!_.hasNextSegment(););(0,i.g)(_.hasNextSegment())}v=_.nextSegment()}let s=0;for(let r=n;r<e;r++){const t=y[r].t;if(t===s)continue;(0,i.g)(null!==v),v.queryCut(s,t,b),s=t;const e=_.getPathIndex();x.addSegment(b.get(),P!==e),P=e}const o=_.hasNextSegment();if((o||!_.isClosingSegment()||_.isCurve())&&((0,i.g)(null!=v),v.queryCut(s,1,b),x.addSegment(b.get(),!1)),o)v=_.nextSegment();else{for(;_.nextPath()&&!_.hasNextSegment(););v=_.hasNextSegment()?_.nextSegment():null}n=e}if(null!==v){const t=_.getPathIndex();(_.hasNextSegment()||!_.isClosingSegment()||_.isCurve())&&x.addSegment(v,P!==t),P=t}let S=_.hasNextSegment();for(;;){if(!S){for(;_.nextPath()&&(S=_.hasNextSegment(),!S););if(!S)break}v=_.nextSegment();const t=_.getPathIndex();S=_.hasNextSegment(),(S||!_.isClosingSegment()||_.isCurve())&&x.addSegment(v,P!==t),P=t}return x}constructor(t){this.m_shape=null,this.m_progressTracker=null,this.m_nonSimpleResult=new d.NonSimpleResult,this.m_tolerance=0,this.m_sweepComparator=null,this.m_progressCounter=0,this.m_bTrackChanges=!1,this.m_bNeedsNonSimpleResult=!1,this.m_bAllowCoincident=!0,this.m_sweepStructure=new o.T,this.m_progressTracker=t}}Mt.s_bForceBruteForce=!0;class Dt{constructor(t,e){this.m_monotoneParts=(0,a.m)(r.S,16),this.m_xOrds=(0,a.d)(16,Number.NaN),this.m_inputPoint=a.P.getNAN(),this.m_miny=0,this.m_maxy=0,this.m_windnum=0,this.m_bAlternate=t,this.m_tolerance=e,this.m_toleranceSqr=e*e,this.m_bTestBorder=!!e,this.m_bBreak=!1}_DoOne(t){if(!this.m_bTestBorder&&(this.m_bAlternate&&this.m_inputPoint.equals(t.getStartXY())||this.m_inputPoint.equals(t.getEndXY())))return void(this.m_bBreak=!0);if(t.getStartY()===this.m_inputPoint.y&&t.getStartY()===t.getEndY()){if(this.m_bAlternate&&!this.m_bTestBorder){const e=Math.min(t.getStartX(),t.getEndX()),s=Math.max(t.getStartX(),t.getEndX());this.m_inputPoint.x>e&&this.m_inputPoint.x<s&&(this.m_bBreak=!0)}return}let e=!1;const s=Math.max(t.getStartX(),t.getEndX());if(this.m_inputPoint.x>s)e=!0;else if(this.m_inputPoint.x>=Math.min(t.getStartX(),t.getEndX())){const n=t.intersectionOfYMonotonicWithAxisX(this.m_inputPoint.y,s);e=!Number.isNaN(n)&&n<=this.m_inputPoint.x}if(e){if(this.m_inputPoint.y===t.getStartY()){if(this.m_inputPoint.y<t.getEndY())return}else if(this.m_inputPoint.y===t.getEndY()&&this.m_inputPoint.y<t.getStartY())return;this.m_bAlternate?this.m_windnum^=1:this.m_windnum+=t.getStartY()>t.getEndY()?1:-1}}_Result(){return!!this.m_windnum}testBorder(t){const e=t.getClosestCoordinate(this.m_inputPoint,!1),s=t.getCoord2D(e);return a.P.sqrDistance(s,this.m_inputPoint)<=this.m_toleranceSqr}setInputPoint(t){this.m_inputPoint.setCoordsPoint2D(t),this.m_miny=t.y-this.m_tolerance,this.m_maxy=t.y+this.m_tolerance}processSegment(t){const e=t.queryInterval(0,1);if(e.vmin>this.m_maxy||e.vmax<this.m_miny)return!1;if(this.m_bTestBorder&&this.testBorder(t))return!0;if(e.vmin>this.m_inputPoint.y||e.vmax<this.m_inputPoint.y)return!1;let s=0;if(t.isCurve()&&(0===this.m_monotoneParts.length&&(this.m_monotoneParts.length=128),s=t.getMonotonicParts(this.m_monotoneParts,!0),(0,i.g)(this.m_monotoneParts.length>=s)),s>0)for(let n=0;n<s;n++){const t=this.m_monotoneParts[n].get(),e=a.E.construct(t.getStartY(),t.getEndY());if(!(e.vmin>this.m_inputPoint.y||e.vmax<this.m_inputPoint.y)&&(this._DoOne(t),this.m_bBreak))return!0}else if(this._DoOne(t),this.m_bBreak)return!0;return!1}result(){return(0,i.g)(0),2}}function Nt(t,e,s){if(t.isEmpty())return 0;const r=n.Envelope2D.constructEmpty();if(t.queryLooseEnvelope(r),r.inflateCoords(s,s),!r.contains(e))return 0;const o=t.getImpl().getAccelerators();if(o){o.getRasterizedGeometry()&&(0,i.g)(0);const r=o.getQuadTree();if(r)return function(t,e,s,i){const r=new n.Envelope2D;t.queryLooseEnvelope(r),r.inflateCoords(i,i);const o=0===t.getFillRule(),a=new Dt(o,i);a.setInputPoint(s);const l=r.clone();l.xmax=s.x+i,l.ymin=s.y-i,l.ymax=s.y+i;const h=t.getImpl().querySegmentIterator(),u=e.getIterator(l,i);for(let n=u.next();-1!==n;n=u.next())if(h.resetToVertex(e.getElement(n),-1),h.hasNextSegment()){const t=h.nextSegment();if(a.processSegment(t))return-1}return a._Result()?1:0}(t,r,e,s)}return function(t,e,s){const n=0===t.getFillRule(),i=new Dt(n,s);i.setInputPoint(e);const r=t.getImpl().querySegmentIterator();for(;r.nextPath();)for(;r.hasNextSegment();){const t=r.nextSegment();if(i.processSegment(t))return-1}return i._Result()?1:0}(t,e,s)}function Ft(t,e){const s=t.getPointCount();if(s<16)return!1;return 2*s+Math.log(s)/Math.log(2)*1*e<1*s*e}function Rt(t,e,s){const n=new Vt(s);return n.m_shape=t,n.m_geometry=e,n.m_sortedVertices=null,n.m_bFixSelfTangency=!1,n.fixRingOrientationForMp2sp_()}class kt{getDirection_(t){return this.m_shape.getNextVertex(this.getEnd1(t))===this.getEnd2(t)}getEnd_(t){const e=this.getEnd1(t),s=this.getEnd2(t);return this.m_shape.getNextVertex(e)===s?s:e}constructor(t){this.m_end1Nodes=[],this.m_end2Nodes=[],this.m_directions=[],this.m_shape=t,this.m_firstFree=-1}getSegment(t){return this.m_shape.getSegment(this.getStart(t))}isBottomUp(t){let e=this.getEnd1(t),s=this.getEnd2(t);this.m_shape.getPrevVertex(e)===s&&(s=(0,a.c)(e,e=s));const n=a.P.getNAN(),r=a.P.getNAN();return this.m_shape.queryXY(e,n),this.m_shape.queryXY(s,r),(0,i.g)(!n.equals(r)),n.y<r.y}getStart(t){const e=this.getEnd1(t),s=this.getEnd2(t);return this.m_shape.getNextVertex(e)===s?e:s}getEnd1(t){return this.m_end1Nodes[t]}getEnd2(t){return this.m_end2Nodes[t]}freeEdge(t){this.m_end1Nodes[t]=this.m_firstFree,this.m_firstFree=t}newEdge(t){if(-1!==this.m_firstFree){const e=this.m_firstFree;return this.m_firstFree=this.m_end1Nodes[e],this.m_end1Nodes[e]=t,this.m_end2Nodes[e]=this.m_shape.getNextVertex(t),e}const e=this.m_end1Nodes.length;return this.m_end1Nodes.push(t),this.m_end2Nodes.push(this.m_shape.getNextVertex(t)),e}getShape(){return this.m_shape}getPath(t){return this.m_shape.getPathFromVertex(this.getEnd1(t))}}let Lt=class extends o.a3{constructor(t){super(),this.m_line1=new r.L,this.m_line2=new r.L,this.m_leftElm=-1,this.m_leftx=0,this.m_seg1=null,this.m_helper=t}compare(t,e,s){const n=t.getElement(s),r=this.m_helper.m_edges;let o;this.m_leftElm===e?o=this.m_leftx:(this.m_seg1=r.getSegment(e),this.m_seg1?o=this.m_seg1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(r.getShape().queryLineConnector(r.getStart(e),this.m_line1,!0),this.m_seg1=this.m_line1,o=this.m_line1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),this.m_leftx=o,this.m_leftElm=e);let a,l=r.getSegment(n);if(l?a=l.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(r.getShape().queryLineConnector(r.getStart(n),this.m_line2,!0),l=this.m_line2,a=this.m_line2.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),o===a){const t=r.isBottomUp(e),s=r.isBottomUp(n),h=t?this.m_seg1.getEndY():this.m_seg1.getStartY(),u=s?l.getEndY():l.getStartY(),c=Math.min(h,u);let m=.5*(c+this.m_helper.m_yScanline);m===this.m_helper.m_yScanline&&(m=c),o=this.m_seg1.intersectionOfYMonotonicWithAxisX(m,0),a=l.intersectionOfYMonotonicWithAxisX(m,0),o===a&&(0,i.w)("")}return o<a?-1:o>a?1:0}reset(){this.m_leftElm=-1}};class Gt{constructor(t){this.m_node=-1,this.m_index=0,this.m_sortedVertices=t.m_sortedVertices,this.m_sortedVerticesArray=t.m_sortedVerticesArray,this.m_sortedVertices&&(this.m_node=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList()))}next(){if(this.m_sortedVertices){const t=this.m_node;if(-1===t)return r.n;const e=this.m_sortedVertices.getData(t);return this.m_node=this.m_sortedVertices.getNext(t),e}if(this.m_index<this.m_sortedVerticesArray.size()){const t=this.m_sortedVerticesArray.read(this.m_index);return this.m_index++,t}return r.n}}class Vt{constructor(t){this.m_edges=null,this.m_shape=null,this.m_AET=new o.T,this.m_yScanline=0,this.m_geometry=r.n,this.m_unknownRingOrientationCount=-1,this.m_sortedVertices=null,this.m_sortedVerticesArray=null,this.m_unknownNodes=[],this.m_node1UserIndex=-1,this.m_node2UserIndex=-1,this.m_pathOrientationIndex=-1,this.m_pathParentageIndex=-1,this.m_pathParentsIndex=-1,this.m_progressCounter=0,this.m_bFixSelfTangency=!1,this.m_progressTracker=t,this.m_AET.disableBalancing(),this.m_sweepComparator=new Lt(this),this.m_AET.setComparator(this.m_sweepComparator)}fixRingOrientation_(){const t=this.fixRingOrientationImplMain_();return-1===this.m_pathOrientationIndex||this.fixRingOrientationImplSimplify_(),t}fixRingOrientationForMp2sp_(){return this.fixRingOrientationImplMain_(),-1===this.m_pathOrientationIndex?-1:this.fixRingOrientationImplMp2sp_()}processBunchForRingOrientationTest_(t){return this.processBunchForRingOrientationTestOddEven_(t)}processBunchForRingOrientationTestOddEven_(t){let e=!1;if(this.m_edges||(this.m_edges=new kt(this.m_shape)),this.m_unknownNodes.length=0,this.processBunchForRingOrientationRemoveEdges_(t),!this.m_AET.isAutoBalancing()){let e=0;for(let s=0,n=t.length;s<n;s++)-1!==t[s]&&e++;(e>10||this.m_AET.getMaxDepthEver()>4)&&this.m_AET.enableBalancing()}for(let s=0,n=t.length;s<n;s++){const e=t[s];e!==r.n&&this.insertEdge_(e,-1)}for(let s=0;s<this.m_unknownNodes.length&&this.m_unknownRingOrientationCount>0;s++){const t=this.m_unknownNodes[s],n=this.m_AET.getElement(t),a=this.m_edges.getPath(n),l=this.m_shape.getPathUserIndex(a,this.m_pathOrientationIndex);let h=r.n;if(0===l){let s=this.m_AET.getPrev(t),n=t,r=!1;for(;s!==o.T.st_nullNode();){const t=this.m_AET.getElement(s),e=this.m_edges.getPath(t);if(0!==this.m_shape.getPathUserIndex(e,this.m_pathOrientationIndex)){h=e;break}n=s,s=this.m_AET.getPrev(s)}if(s===o.T.st_nullNode())r=!0,s=n;else{const t=this.m_AET.getElement(s);r=this.m_edges.isBottomUp(t),s=this.m_AET.getNext(s),r=!r}do{const t=this.m_AET.getElement(s),o=this.m_edges.getPath(t);if(0===this.m_shape.getPathUserIndex(o,this.m_pathOrientationIndex)){if(r!==this.m_edges.isBottomUp(t)){const t=this.m_shape.getFirstVertex(o);this.m_shape.reverseRingInternal(t),this.m_shape.setLastVertex(o,this.m_shape.getPrevVertex(t)),e=!0}if(this.m_shape.setPathUserIndex(o,this.m_pathOrientationIndex,r?3:2),!r){let t=this.m_shape.getPathUserIndex(h,this.m_pathOrientationIndex);2===t?(h=this.m_shape.getPathUserIndex(h,this.m_pathParentsIndex),t=this.m_shape.getPathUserIndex(h,this.m_pathOrientationIndex),(0,i.g)(3===t)):(0,i.g)(3===t);const e=this.m_shape.getPathUserIndex(h,this.m_pathParentageIndex);this.m_shape.setPathUserIndex(h,this.m_pathParentageIndex,o),this.m_shape.setPathUserIndex(o,this.m_pathParentageIndex,e),this.m_shape.setPathUserIndex(o,this.m_pathParentsIndex,h)}if(this.m_unknownRingOrientationCount--,!this.m_unknownRingOrientationCount)return e}h=o,n=s,s=this.m_AET.getNext(s),r=!r}while(n!==t)}}return e}processBunchForRingOrientationRemoveEdges_(t){for(let e=0,s=t.length;e<s;e++){const s=t[e],n=this.m_shape.getUserIndex(s,this.m_node1UserIndex),i=this.m_shape.getUserIndex(s,this.m_node2UserIndex);if(-1!==n){const t=this.m_AET.getElement(n);this.m_edges.freeEdge(t),this.m_shape.setUserIndex(s,this.m_node1UserIndex,-1)}if(-1!==i){const t=this.m_AET.getElement(i);this.m_edges.freeEdge(t),this.m_shape.setUserIndex(s,this.m_node2UserIndex,-1)}let o=-1;-1!==n&&-1!==i?(this.m_AET.deleteNode(n),this.m_AET.deleteNode(i),t[e]=r.n):o=-1!==n?n:i,-1!==o&&(this.insertEdge_(s,o)||this.m_AET.deleteNode(o),t[e]=r.n)}}dbgVerifyRingOrientation_(){}insertEdge_(t,e){const s=a.P.getNAN(),n=a.P.getNAN();this.m_shape.queryXY(t,s);const i=this.m_shape.getNextVertex(t);this.m_shape.queryXY(i,n);let r=!1;if(s.y<n.y){r=!0;const s=this.m_edges.newEdge(t);let n;-1===e?n=this.m_AET.addElement(s):(n=e,this.m_AET.setElement(n,s)),-1===this.m_shape.getUserIndex(i,this.m_node1UserIndex)?this.m_shape.setUserIndex(i,this.m_node1UserIndex,n):this.m_shape.setUserIndex(i,this.m_node2UserIndex,n);const o=this.m_shape.getPathFromVertex(t);0===this.m_shape.getPathUserIndex(o,this.m_pathOrientationIndex)&&this.m_unknownNodes.push(n)}const o=this.m_shape.getPrevVertex(t);if(this.m_shape.queryXY(o,n),s.y<n.y){r=!0;const s=this.m_edges.newEdge(o);let n;-1===e?n=this.m_AET.addElement(s):(n=e,this.m_AET.setElement(n,s)),-1===this.m_shape.getUserIndex(o,this.m_node1UserIndex)?this.m_shape.setUserIndex(o,this.m_node1UserIndex,n):this.m_shape.setUserIndex(o,this.m_node2UserIndex,n);const i=this.m_shape.getPathFromVertex(t);0===this.m_shape.getPathUserIndex(i,this.m_pathOrientationIndex)&&this.m_unknownNodes.push(n)}return r}fixRingSelfTangency_(){const t=[],e=[];let s=-1,n=-1;const o=new a.P;let l=r.n,h=r.n,u=-1;const c=new Gt(this);for(let i=c.next();i!==r.n;i=c.next()){const r=new a.P;this.m_shape.queryXY(i,r);const c=this.m_shape.getPathFromVertex(i);o.equals(r)&&h===c?(-1===n&&(s=this.m_shape.createPathUserIndex(),this.m_shape.fillPathUserIndexForGeometry(this.m_geometry,s,-1),n=this.m_shape.createUserIndex(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,n,-1)),-1===u&&(u=e.length,this.m_shape.setUserIndex(l,n,u),e.push(1),-1===this.m_shape.getPathUserIndex(c,s)&&(this.m_shape.setPathUserIndex(c,s,l),t.push(c))),this.m_shape.setUserIndex(i,n,u),e[e.length-1]++):(u=-1,o.assign(r)),l=i,h=c}if(0===t.length)return!1;(0,i.g)(-1!==s);for(let i=0,r=t.length;i<r;i++){const r=t[i];let o=this.m_shape.getPathUserIndex(r,s);const a=this.m_shape.getUserIndex(o,n),l=[],h=[];l.push(o),h.push(a);for(let t=this.m_shape.getNextVertex(o);t!==o;t=this.m_shape.getNextVertex(t)){const s=t,i=this.m_shape.getUserIndex(s,n);if(-1!==i){if(0===h.length){h.push(i),l.push(s);continue}if(h.at(-1)===i){const r=l.at(-1);this.m_shape.peelALoopIntoAPath(r,s),this.m_shape.setUserIndex(t,n,-1),e[i]--,1===e[i]&&(e[i]=0,h.pop(),l.pop()),o=r,t=r}else l.push(t),h.push(i)}}}return this.m_shape.removePathUserIndex(s),this.m_shape.removeUserIndex(n),this.m_shape.dbgVerifyVertexCounts(),!0}progress_(t=!1){}fixRingOrientationImplMain_(){const t={stack:[],error:void 0,hasError:!1};try{let e,s=!1;const n=(0,l.b)(t,(0,a.h)((()=>{this.m_sortedVerticesArray=null})),!1);if(null===this.m_sortedVertices){const t=this.m_shape.getPointCount(this.m_geometry);e=new o.A(0);for(let s=this.m_shape.getFirstPath(this.m_geometry);s!==r.n;s=this.m_shape.getNextPath(s)){let t=this.m_shape.getFirstVertex(s);for(let n=0,i=this.m_shape.getPathSize(s);n<i;n++)e.add(t),t=this.m_shape.getNextVertex(t)}this.m_shape.sortVerticesSimpleByY(e,0,t),this.progress_(!0),this.m_sortedVerticesArray=e}else n.bForget=!0;if(this.m_bFixSelfTangency&&(s=this.fixRingSelfTangency_()),1===this.m_shape.getPathCount(this.m_geometry)){const t=this.m_shape.getFirstPath(this.m_geometry),e=this.m_shape.getRingArea(t);if(this.m_shape.setExterior(t,!0),e<0){const e=this.m_shape.getFirstVertex(t);return this.m_shape.reverseRingInternal(e),this.m_shape.setLastVertex(t,this.m_shape.getPrevVertex(e)),!0}return!1}this.m_shape.dbgVerifyCurves(),this.m_pathOrientationIndex=this.m_shape.createPathUserIndex(),this.m_pathParentageIndex=this.m_shape.createPathUserIndex(),this.m_pathParentsIndex=this.m_shape.createPathUserIndex();for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==r.n;t=this.m_shape.getNextPath(t))this.m_shape.setPathUserIndex(t,this.m_pathOrientationIndex,0),this.m_shape.setPathUserIndex(t,this.m_pathParentageIndex,-1),this.m_shape.setPathUserIndex(t,this.m_pathParentsIndex,-1);const i=[];this.m_yScanline=Number.NaN;const h=a.P.getNAN();this.m_unknownRingOrientationCount=this.m_shape.getPathCount(this.m_geometry),this.m_node1UserIndex=this.m_shape.createUserIndexUninitialized(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node1UserIndex,-1),this.m_node2UserIndex=this.m_shape.createUserIndexUninitialized(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node2UserIndex,-1);const u=new Gt(this);for(let t=u.next();t!==r.n&&(this.progress_(),this.m_shape.queryXY(t,h),h.y!==this.m_yScanline&&i.length&&(s=this.processBunchForRingOrientationTest_(i)||s,this.m_sweepComparator.reset(),i.length=0),i.push(t),this.m_yScanline=h.y,0!==this.m_unknownRingOrientationCount);t=u.next());return this.m_unknownRingOrientationCount>0&&(s=this.processBunchForRingOrientationTest_(i)||s,i.length=0),this.m_shape.removeUserIndex(this.m_node1UserIndex),this.m_shape.removeUserIndex(this.m_node2UserIndex),this.dbgVerifyRingOrientation_(),s}catch(e){t.error=e,t.hasError=!0}finally{(0,l.c)(t)}}fixRingOrientationImplSimplify_(){const t=[];for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==r.n;)if(this.progress_(),3===this.m_shape.getPathUserIndex(e,this.m_pathOrientationIndex)){this.m_shape.setExterior(e,!0);for(let i=this.m_shape.getPathUserIndex(e,this.m_pathParentageIndex);i!==r.n;){const s=this.m_shape.getPathUserIndex(i,this.m_pathParentageIndex);t.push(i),this.m_shape.setExterior(i,!1),this.m_shape.setPathUserIndex(i,this.m_pathParentageIndex,e),i=s}let s=e,n=t.length;for(let t=this.m_shape.getNextPath(e);n>0&&t!==r.n;t=this.m_shape.getNextPath(t),--n){if(this.m_shape.getPathUserIndex(t,this.m_pathParentageIndex)!==e){s=r.n;break}s=t}if(0!==n){s=e;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.m_shape.setPathUserIndex(n,this.m_pathParentageIndex,o.a6),this.m_shape.movePath(this.m_geometry,this.m_shape.getNextPath(s),n),s=n}}t.length=0,e=this.m_shape.getNextPath(s)}else e=this.m_shape.getNextPath(e);this.m_shape.removePathUserIndex(this.m_pathOrientationIndex),this.m_shape.removePathUserIndex(this.m_pathParentageIndex),this.m_shape.removePathUserIndex(this.m_pathParentsIndex)}fixRingOrientationImplMp2sp_(){const t=this.m_shape.createPathUserIndex();let e=0;const s=[];for(let n=this.m_shape.getFirstPath(this.m_geometry);n!==r.n;)if(this.progress_(),3===this.m_shape.getPathUserIndex(n,this.m_pathOrientationIndex)){this.m_shape.setExterior(n,!0),this.m_shape.setPathUserIndex(n,t,e),e++;for(let t=this.m_shape.getPathUserIndex(n,this.m_pathParentageIndex);t!==r.n;){const e=this.m_shape.getPathUserIndex(t,this.m_pathParentageIndex);s.push(t),this.m_shape.setExterior(t,!1),this.m_shape.setPathUserIndex(t,this.m_pathParentageIndex,n),t=e}let i=n,a=s.length,l=e;for(let e=this.m_shape.getNextPath(n);a>0&&e!==r.n;e=this.m_shape.getNextPath(e),--a){if(this.m_shape.getPathUserIndex(e,this.m_pathParentageIndex)!==n){i=r.n;break}i=e,this.m_shape.setPathUserIndex(e,t,-l),l++}if(0!==a){i=n,l=e;for(let e=0,n=s.length;e<n;e++){const n=s[e];this.m_shape.setPathUserIndex(n,t,-l),l++,this.m_shape.setPathUserIndex(n,this.m_pathParentageIndex,o.a6)}i=n}e=l,s.length=0,n=this.m_shape.getNextPath(i)}else n=this.m_shape.getNextPath(n);return this.m_shape.removePathUserIndex(this.m_pathOrientationIndex),this.m_shape.removePathUserIndex(this.m_pathParentageIndex),this.m_shape.removePathUserIndex(this.m_pathParentsIndex),t}}function zt(t,e,s,n,i,r){const o=new Ot(r);return o.m_shape=t,o.m_geometry=e,o.m_knownSimpleResult=s,o.m_bFixSelfTangency=n,o.m_polylineDegeneracies=i,o.m_bHasSegmentParentage=t.hasSegmentParentage(),o.m_bHasSegments=t.hasCurves(),o.simplify_()}class Ot{constructor(t){this.m_shape=null,this.m_geometry=r.n,this.m_sortedVertices=new o.N,this.m_bunchEdgeEndPoints=[],this.m_bunchEdgeCenterPoints=[],this.m_bunchEdgeIndices=[],this.m_sorterSegmentBuffer1=null,this.m_sorterSegmentBuffer2=null,this.m_knownSimpleResult=-1,this.m_sortedVerticesListIndex=-1,this.m_polylineDegeneracies=r.n,this.m_userIndexSortedIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=-1,this.m_nextVertexToProcess=-1,this.m_firstCoincidentVertex=-1,this.m_progressCounter=0,this.m_bFixSelfTangency=!1,this.m_bHasSegmentParentage=!1,this.m_bHasSegments=!1,this.m_progressTracker=t}compareAngles_(t,e){return this.m_bHasSegments?this.compareAnglesCurves_(t,e):this.compareAnglesLines_(t,e)}compareAnglesLines_(t,e){const s=this.m_bunchEdgeEndPoints[t],n=new a.P;this.m_shape.queryXY(s,n);const r=new a.P,o=this.m_bunchEdgeEndPoints[e];if(this.m_shape.queryXY(o,r),n.equals(r))return 0;const l=this.m_bunchEdgeCenterPoints[t],h=new a.P;this.m_shape.queryXY(l,h);const u=this.m_bunchEdgeCenterPoints[e],c=new a.P;this.m_shape.queryXY(u,c);const m=new a.P;m.setSub(n,h);const d=new a.P;return d.setSub(r,c),(m.isZero()||d.isZero())&&(0,i.w)(""),a.P.compareVectors(m,d)}compareAnglesCurves_(t,e){const s=this.m_bunchEdgeEndPoints[t],n=this.m_bunchEdgeEndPoints[e],i=this.m_bunchEdgeCenterPoints[t],o=this.m_bunchEdgeCenterPoints[e],a=this.m_shape.getNextVertex(i)===s,l=this.m_shape.getNextVertex(o)===n,h=a?this.m_shape.isCurve(i):this.m_shape.isCurve(s),u=l?this.m_shape.isCurve(o):this.m_shape.isCurve(n);return h||u?(this.m_sorterSegmentBuffer1||(this.m_sorterSegmentBuffer1=new r.S),this.m_sorterSegmentBuffer2||(this.m_sorterSegmentBuffer2=new r.S),a?this.m_shape.querySegment(i,this.m_sorterSegmentBuffer1,!1,!0):(this.m_shape.querySegment(s,this.m_sorterSegmentBuffer1,!1,!0),this.m_sorterSegmentBuffer1.get().reverse()),l?this.m_shape.querySegment(o,this.m_sorterSegmentBuffer2,!1,!0):(this.m_shape.querySegment(n,this.m_sorterSegmentBuffer2,!1,!0),this.m_sorterSegmentBuffer2.get().reverse()),(0,r.R)(this.m_sorterSegmentBuffer1.get(),this.m_sorterSegmentBuffer2.get())):this.compareAnglesLines_(t,e)}beforeRemoveVertex_(t,e){const s=this.m_shape.getUserIndex(t,this.m_userIndexSortedIndexToVertex);if(this.m_nextVertexToProcess===s&&(this.m_nextVertexToProcess=this.m_sortedVertices.getNext(this.m_nextVertexToProcess)),this.m_firstCoincidentVertex===s&&(this.m_firstCoincidentVertex=this.m_sortedVertices.getNext(this.m_firstCoincidentVertex)),this.m_sortedVertices.deleteElement(this.m_sortedVerticesListIndex,s),this.removeAngleSortInfo_(t),e){const e=this.m_shape.getPathFromVertex(t);if(e!==r.n&&this.m_shape.getFirstVertex(e)===t){const s=this.m_shape.getNextVertex(t);if(s!==t){if(this.m_shape.getPathFromVertex(s)===e)return void this.m_shape.setFirstVertex(e,s);{const s=this.m_shape.getPrevVertex(t);if(s!==t&&this.m_shape.getPathFromVertex(s)===e)return void this.m_shape.setFirstVertex(e,s)}}this.m_shape.setFirstVertex(e,r.n),this.m_shape.setLastVertex(e,r.n)}}}processBunch_(){let t=!1;const e=new a.P(0,0);for(;;){this.m_bunchEdgeEndPoints.length=0,this.m_bunchEdgeCenterPoints.length=0,this.m_bunchEdgeIndices.length=0;let s=this.m_firstCoincidentVertex,n=0,i=!0;for(;s!==this.m_nextVertexToProcess;){const t=this.m_sortedVertices.getData(s);i&&(this.m_shape.queryXY(t,e),i=!1);const r=this.m_shape.getPrevVertex(t),a=this.m_shape.getNextVertex(t);this.m_shape.getUserIndex(r,this.m_userIndexSortedAngleIndexToVertex)!==o.a6&&(this.m_bunchEdgeEndPoints.push(r),this.m_shape.setUserIndex(r,this.m_userIndexSortedAngleIndexToVertex,o.a6),this.m_bunchEdgeCenterPoints.push(t),this.m_bunchEdgeIndices.push(n++)),this.m_shape.getUserIndex(a,this.m_userIndexSortedAngleIndexToVertex)!==o.a6&&(this.m_bunchEdgeEndPoints.push(a),this.m_shape.setUserIndex(a,this.m_userIndexSortedAngleIndexToVertex,o.a6),this.m_bunchEdgeCenterPoints.push(t),this.m_bunchEdgeIndices.push(n++)),s=this.m_sortedVertices.getNext(s)}if(this.m_bunchEdgeEndPoints.length<2){1===this.m_bunchEdgeEndPoints.length&&this.m_shape.setUserIndex(this.m_bunchEdgeEndPoints[0],this.m_userIndexSortedAngleIndexToVertex,-1);break}this.m_bunchEdgeIndices.sort(((t,e)=>this.compareAngles_(t,e)));for(let t=0,e=this.m_bunchEdgeIndices.length;t<e;t++){const e=this.m_bunchEdgeIndices[t],s=this.m_bunchEdgeEndPoints[e];this.m_shape.setUserIndex(s,this.m_userIndexSortedAngleIndexToVertex,t)}const r=this.processCrossOvers_(e);for(let t=0,e=this.m_bunchEdgeIndices.length;t<e;t++){const e=this.m_bunchEdgeIndices[t];if(-1===e)continue;const s=this.m_bunchEdgeEndPoints[e];this.m_shape.setUserIndex(s,this.m_userIndexSortedAngleIndexToVertex,-1)}if(!r)break;t=!0}return t}processCrossOvers_(t){let e=!1,s=!0;for(;s;){s=!1;let n=0;-1===this.m_bunchEdgeIndices[n]&&(n=this.getNextEdgeIndex_(n));let i=this.getNextEdgeIndex_(n);for(let r=0,o=this.m_bunchEdgeIndices.length;r<o&&-1!==n&&-1!==i&&n!==i;r++){const r=this.m_bunchEdgeIndices[n],o=this.m_bunchEdgeIndices[i],a=this.m_bunchEdgeEndPoints[r],l=this.m_bunchEdgeEndPoints[o];let h=this.m_shape.getNextVertex(a),u=!1;this.m_shape.isEqualXYPoint2D(h,t)||(h=this.m_shape.getPrevVertex(a),u=!0);let c=this.m_shape.getNextVertex(l),m=!1;this.m_shape.isEqualXYPoint2D(c,t)||(c=this.m_shape.getPrevVertex(l),m=!0);const d=u?this.m_shape.getPrevVertex(h):this.m_shape.getNextVertex(h),g=m?this.m_shape.getPrevVertex(c):this.m_shape.getNextVertex(c);let p=!1;(this.removeSpike_(h)||this.removeSpike_(c)||this.removeSpike_(a)||this.removeSpike_(l)||this.removeSpike_(d)||this.removeSpike_(g))&&(p=!0),h!==c&&(!p&&this.m_shape.isEqualXY(a,l)&&(p=this.resolveOverlap_(u,m,h,a,c,l)),!p&&this.m_shape.isEqualXY(d,g)&&(p=this.resolveOverlap_(!u,!m,h,d,c,g)),!p&&this.m_shape.isEqualXY(a,g)&&(p=this.resolveOverlap_(u,!m,h,a,c,g)),!p&&this.m_shape.isEqualXY(d,l)&&(p=this.resolveOverlap_(!u,m,h,d,c,l))),p&&(e=!0),s||=p,n=p?this.getNextEdgeIndex_(n):i,i=this.getNextEdgeIndex_(n)}}if(!e){let s=0;-1===this.m_bunchEdgeIndices[s]&&(s=this.getNextEdgeIndex_(s));let n=this.getNextEdgeIndex_(s);for(let i=0,r=this.m_bunchEdgeIndices.length;i<r&&-1!==s&&-1!==n&&s!==n;i++){const i=this.m_bunchEdgeIndices[s],r=this.m_bunchEdgeIndices[n],o=this.m_bunchEdgeEndPoints[i],a=this.m_bunchEdgeEndPoints[r];let l=this.m_shape.getNextVertex(o);this.m_shape.isEqualXYPoint2D(l,t)||(l=this.m_shape.getPrevVertex(o));let h=this.m_shape.getNextVertex(a);this.m_shape.isEqualXYPoint2D(h,t)||(h=this.m_shape.getPrevVertex(a));const u=this.getDirection_(l,o),c=this.getDirection_(h,a),m=u?this.m_shape.getPrevVertex(l):this.m_shape.getNextVertex(l),d=c?this.m_shape.getPrevVertex(h):this.m_shape.getNextVertex(h),g=this.detectAndResolveCrossOver_(u,c,o,l,m,a,h,d);1!==g?0===g?(s=this.getNextEdgeIndex_(s),n=this.getNextEdgeIndex_(s)):(s=this.getPrevEdgeIndex_(s),n=this.getNextEdgeIndex_(s)):e=!0}}return e}simplify_(){this.m_shape.getGeometryType(this.m_geometry)===i.G.enumPolygon&&1===this.m_shape.getFillRule(this.m_geometry)&&new Ys(this.m_progressTracker).planarSimplifyNoCrackingAndCluster(this.m_bFixSelfTangency,this.m_shape,this.m_geometry,0);let t=!1;this.m_userIndexSortedIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=this.m_shape.createUserIndexUninitialized();const e=this.m_shape.getPointCount(this.m_geometry),s=new o.A(0);this.m_shape.dbgVerifyMonotone();for(let i=this.m_shape.getFirstPath(this.m_geometry);i!==r.n;i=this.m_shape.getNextPath(i)){let t=this.m_shape.getFirstVertex(i);for(let e=0,n=this.m_shape.getPathSize(i);e<n;e++)this.m_shape.setUserIndex(t,this.m_userIndexSortedAngleIndexToVertex,-1),s.add(t),t=this.m_shape.getNextVertex(t)}this.m_shape.sortVerticesSimpleByY(s,0,e),this.progress_(!0),this.m_userIndexSortedIndexToVertex=this.m_shape.createUserIndexUninitialized(),this.m_sortedVertices.reserveNodes(e),this.m_sortedVerticesListIndex=this.m_sortedVertices.createList(0);for(let i=0;i<e;i++){const t=s.read(i),e=this.m_sortedVertices.addElement(this.m_sortedVerticesListIndex,t);this.m_shape.setUserIndex(t,this.m_userIndexSortedIndexToVertex,e)}this.m_nextVertexToProcess=-1,this.cleanupSpikes_()&&(t=!0);let n=0,l=!1;do{l=!1,this.m_nextVertexToProcess=-1,this.m_firstCoincidentVertex=this.m_sortedVertices.getFirst(this.m_sortedVerticesListIndex);const e=new a.P(0,0);this.m_firstCoincidentVertex!==o.N.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(this.m_firstCoincidentVertex),e);let s=0,r=this.m_firstCoincidentVertex;for(;r!==o.N.st_nullNode()&&(r=this.m_sortedVertices.getNext(r),r!==o.N.st_nullNode());){this.progress_();const t=this.m_sortedVertices.getData(r),n=a.P.getNAN();if(this.m_shape.queryXY(t,n),e.equals(n))s++;else{if(s>0){this.m_nextVertexToProcess=r;const t=this.processBunch_();r=this.m_nextVertexToProcess,r!==o.N.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(r),n),t&&(l=!0)}e.setCoordsPoint2D(n),this.m_firstCoincidentVertex=r,s=0}}this.m_nextVertexToProcess=-1,s>0&&this.processBunch_()&&(l=!0),n++>10&&(0,i.d)(""),l&&this.fixOrphanVertices_(),this.cleanupSpikes_()&&(l=!0),t||=l}while(l);return this.m_shape.dbgVerifyMonotone(),this.m_shape.dbgVerifyCurves(),this.m_shape.removeUserIndex(this.m_userIndexSortedIndexToVertex),this.m_shape.removeUserIndex(this.m_userIndexSortedAngleIndexToVertex),t=function(t,e,s,n,i){const r=new Vt(i);return r.m_shape=t,r.m_geometry=e,r.m_sortedVertices=s,r.m_bFixSelfTangency=n,r.fixRingOrientation_()}(this.m_shape,this.m_geometry,this.m_sortedVertices,this.m_bFixSelfTangency,this.m_progressTracker)||t,this.m_shape.dbgVerifyCurves(),t}getDirection_(t,e){return this.m_shape.getNextVertex(e)!==t}detectAndResolveCrossOver_(t,e,s,n,i,r,o,l){if(n===o)return this.removeAngleSortInfo_(s),this.removeAngleSortInfo_(r),-1;const h=this.m_shape.getUserIndex(s,this.m_userIndexSortedAngleIndexToVertex),u=this.m_shape.getUserIndex(i,this.m_userIndexSortedAngleIndexToVertex),c=this.m_shape.getUserIndex(r,this.m_userIndexSortedAngleIndexToVertex),m=this.m_shape.getUserIndex(l,this.m_userIndexSortedAngleIndexToVertex),d=(0,a.d)(8,Number.NaN),g=(0,a.d)(4,Number.NaN);d[0]=0,g[0]=h,d[1]=0,g[1]=u,d[2]=1,g[2]=c,d[3]=1,g[3]=m;for(let a=1;a<4;a++){const t=g[a],e=d[a];let s=a-1;for(;s>=0&&g[s]>t;)g[s+1]=g[s],d[s+1]=d[s],s--;g[s+1]=t,d[s+1]=e}let p=0;if(d[0]&&(p|=1),d[1]&&(p|=2),d[2]&&(p|=4),d[3]&&(p|=8),5!==p&&10!==p)return 0;if(t!==e&&(l=(0,a.c)(r,r=l)),t)this.m_shape.setNextVertex(l,n),this.m_shape.setPrevVertex(n,l),this.m_shape.setNextVertex(i,o),this.m_shape.setPrevVertex(o,i),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(n,!0),this.m_shape.setSegmentParentageBreakVertex(o,!0));else{if(this.m_shape.setPrevVertex(l,n),this.m_shape.setNextVertex(n,l),this.m_shape.setPrevVertex(i,o),this.m_shape.setNextVertex(o,i),this.m_bHasSegmentParentage){const t=this.m_shape.getSegmentParentage(n),e=this.m_shape.getSegmentParentage(o);this.m_shape.setSegmentParentageAndBreak(n,e,!0),this.m_shape.setSegmentParentageAndBreak(o,t,!0)}if(this.m_bHasSegments){const t=this.m_shape.getVertexIndex(n),e=this.m_shape.getVertexIndex(o),s=this.m_shape.getSegmentFromIndex(t);this.m_shape.setSegmentToIndex(t,null);const i=this.m_shape.getSegmentFromIndex(e);this.m_shape.setSegmentToIndex(e,null),this.m_shape.setSegmentToIndex(t,i),this.m_shape.setSegmentToIndex(e,s)}}return 1}resolveOverlap_(t,e,s,n,i,r){return this.resolveOverlapOddEven_(t,e,s,n,i,r)}resolveOverlapOddEven_(t,e,s,n,i,r){if(t!==e){t||(i=(0,a.c)(s,s=i),r=(0,a.c)(n,n=r));const e=this.m_shape.getNextVertex(i),o=this.m_shape.getNextVertex(s);if(this.m_shape.setNextVertex(s,e),this.m_shape.setPrevVertex(e,s),this.m_shape.setNextVertex(i,o),this.m_shape.setPrevVertex(o,i),this.m_bHasSegments){const t=this.m_shape.getVertexIndex(s),e=this.m_shape.getVertexIndex(i),n=this.m_shape.getSegmentFromIndex(t);this.m_shape.setSegmentToIndex(t,null);const r=this.m_shape.getSegmentFromIndex(e);this.m_shape.setSegmentToIndex(e,null),this.m_shape.setSegmentToIndex(t,r),this.m_shape.setSegmentToIndex(e,n)}if(this.m_bHasSegmentParentage){const t=this.m_shape.getSegmentParentage(s),e=this.m_shape.getSegmentParentage(i);this.m_shape.setSegmentParentageAndBreak(s,e,!0),this.m_shape.setSegmentParentageAndBreak(i,t,!0),this.m_shape.setSegmentParentageBreakVertex(n,!0),this.m_shape.setSegmentParentageBreakVertex(r,!0)}this.removeSpike_(i)}else{const o=t?s:n,a=e?i:r,l=t?n:s,h=e?r:i;let u=null;if(this.m_bHasSegments){const t=this.m_shape.getVertexIndex(h);u=this.m_shape.getSegmentFromIndex(t),this.m_shape.setSegmentToIndex(t,null);const e=this.m_shape.getVertexIndex(a);this.m_shape.setSegmentToIndex(e,null);const s=this.m_shape.getVertexIndex(o);this.m_shape.setSegmentToIndex(s,null)}let c=-1;this.m_bHasSegmentParentage&&(c=this.m_shape.getSegmentParentage(h));let m=!1;this.m_shape.setNextVertex(o,a),this.m_shape.setNextVertex(a,o),this.m_shape.setPrevVertex(l,h),this.m_shape.setPrevVertex(h,l);let d=h;for(;d!==a;){const t=this.m_shape.getPrevVertex(d),e=this.m_shape.getNextVertex(d);if(this.m_shape.setPrevVertex(d,e),this.m_shape.setNextVertex(d,t),m||=d===o,this.m_bHasSegments&&d!==o){const t=this.m_shape.getVertexIndex(e),s=u;u=this.m_shape.getSegmentFromIndex(t),null!==s&&s.reverse(),this.m_shape.setSegmentToIndex(t,s)}if(this.m_bHasSegmentParentage){const t=this.m_shape.getSegmentParentage(e);this.m_shape.setSegmentParentagePreserveBreak(e,c),c=t}d=e}let g=null;if(!m){const t=this.m_shape.getPrevVertex(a),e=this.m_shape.getNextVertex(a);if(this.m_shape.setPrevVertex(a,e),this.m_shape.setNextVertex(a,t),this.m_bHasSegments){const t=this.m_shape.getVertexIndex(a);g=this.m_shape.getSegmentFromIndex(t),this.m_shape.setSegmentToIndex(t,null)}}let p=-1,_=-1;if(this.m_bHasSegmentParentage&&(p=m?this.m_shape.getSegmentParentage(o):this.m_shape.getSegmentParentage(a),_=this.m_shape.getSegmentParentage(l)),this.transferVertexData_(a,o),this.beforeRemoveVertex_(a,!0),this.m_shape.removeVertexInternal(a,!0),this.removeAngleSortInfo_(o),this.transferVertexData_(h,l),this.beforeRemoveVertex_(h,!0),this.m_shape.removeVertexInternal(h,!0),this.removeAngleSortInfo_(l),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageAndBreak(o,p,!0),this.m_shape.setSegmentParentageAndBreak(l,_,!0)),g){const t=this.m_shape.getVertexIndex(o);this.m_shape.setSegmentToIndex(t,g)}}return!0}cleanupSpikes_(){let t=!1;for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==r.n;){const s=this.m_shape.getNextPath(e);let n=this.m_shape.getFirstVertex(e);for(let i=0,o=this.m_shape.getPathSize(e);i<o&&o>1;){this.progress_();const{v:s,bModified:a}=this.checkAndCleanupSpike_(e,n);if(s===r.n)break;a?(t=!0,n=s,i=0,o=this.m_shape.getPathSize(e)):(n=s,i++)}e=s}return t}checkAndCleanupSpike_(t,e){const s={v:r.n,bModified:!1};let n=this.m_shape.getPrevVertex(e),i=this.m_shape.getNextVertex(e),o=r.n,a=r.n;for(;this.m_shape.isEqualXY(n,i)&&(o=n,a=i,i!==e);)n=this.m_shape.getPrevVertex(n),i=this.m_shape.getNextVertex(i);if(o===r.n)return s.v=i,s;s.bModified=!0;for(let r=this.m_shape.getNextVertex(o);this.beforeRemoveVertex_(r,!1),r!==a;r=this.m_shape.getNextVertex(r));if(o===e)return this.m_polylineDegeneracies!==r.n?this.m_shape.movePath(this.m_polylineDegeneracies,r.n,t):this.m_shape.removePath(t),s.v=r.n,s;{const t=this.m_shape.peelALoopIntoAPath(o,a);this.m_polylineDegeneracies!==r.n?this.m_shape.movePath(this.m_polylineDegeneracies,r.n,t):this.m_shape.removePath(t)}return s.v=o,s}removeSpike_(t){let e=this.m_shape.getPrevVertex(t),s=this.m_shape.getNextVertex(t),n=r.n,i=r.n;for(;this.m_shape.isEqualXY(e,s)&&(n=e,i=s,s!==t);)e=this.m_shape.getPrevVertex(e),s=this.m_shape.getNextVertex(s);if(n===r.n)return!1;if(this.m_shape.peelALoop(n,i),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(n,!0),this.m_shape.setSegmentParentageBreakVertex(i,!0)),this.removeAngleSortInfo_(n),this.m_polylineDegeneracies===r.n)for(let r=this.m_shape.getNextVertex(i);;){const t=this.m_shape.getNextVertex(r);if(this.removeAngleSortInfo_(r),this.beforeRemoveVertex_(r,!0),this.m_shape.setSegmentToIndex(this.m_shape.getVertexIndex(r),null),this.m_shape.removeVertexInternal(r,!1),r===i)break;r=t}else{for(let e=i;;){const t=this.m_shape.getNextVertex(e);if(this.removeAngleSortInfo_(e),this.beforeRemoveVertex_(e,!1),e=t,e===i)break}const t=[!1];this.m_shape.insertClosedPath(this.m_polylineDegeneracies,r.n,i,i,t)}return!0}fixOrphanVertices_(){let t=0;for(let n=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());-1!==n;n=this.m_sortedVertices.getNext(n)){const t=this.m_sortedVertices.getData(n);this.m_shape.setPathToVertex(t,r.n)}let e=0;for(let n=this.m_shape.getFirstPath(this.m_geometry);n!==r.n;){const s=this.m_shape.getFirstVertex(n);if(s===r.n||this.m_shape.getPathFromVertex(s)!==r.n){const t=n;n=this.m_shape.getNextPath(n),this.m_shape.removePathOnly(t);continue}this.m_shape.setPathToVertex(s,n);let i=1;for(let t=this.m_shape.getNextVertex(s);t!==s;t=this.m_shape.getNextVertex(t))this.m_shape.setPathToVertex(t,n),i++;this.m_shape.setRingAreaValid(n,!1),this.m_shape.setPathSize(n,i),this.m_shape.setLastVertex(n,this.m_shape.getPrevVertex(s)),e+=i,t++,n=this.m_shape.getNextPath(n)}for(let n=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());-1!==n;n=this.m_sortedVertices.getNext(n)){const s=this.m_sortedVertices.getData(n);if(this.m_shape.getPathFromVertex(s)!==r.n)continue;const i=[!1],o=this.m_shape.insertClosedPath(this.m_geometry,r.n,s,s,i);e+=this.m_shape.getPathSize(o),t++}this.m_shape.setGeometryPathCount(this.m_geometry,t),this.m_shape.setGeometryVertexCount(this.m_geometry,e);let s=0;for(let n=this.m_shape.getFirstGeometry();n!==r.n;n=this.m_shape.getNextGeometry(n))s+=this.m_shape.getPointCount(n);this.m_shape.setTotalPointCount(s)}getNextEdgeIndex_(t){if(-1===t)return-1;for(let e=0,s=this.m_bunchEdgeIndices.length-1;e<s;e++)if(t=(t+1)%this.m_bunchEdgeIndices.length,-1!==this.m_bunchEdgeIndices[t])return t;return-1}getPrevEdgeIndex_(t){if(-1===t)return-1;for(let e=0,s=this.m_bunchEdgeIndices.length-1;e<s;e++)if(t=(this.m_bunchEdgeIndices.length+t-1)%this.m_bunchEdgeIndices.length,-1!==this.m_bunchEdgeIndices[t])return t;return-1}transferVertexData_(t,e){const s=this.m_shape.getUserIndex(e,this.m_userIndexSortedIndexToVertex),n=this.m_shape.getUserIndex(e,this.m_userIndexSortedAngleIndexToVertex);this.m_shape.transferAllDataToTheVertex(t,e),this.m_shape.setUserIndex(e,this.m_userIndexSortedIndexToVertex,s),this.m_shape.setUserIndex(e,this.m_userIndexSortedAngleIndexToVertex,n)}removeAngleSortInfo_(t){const e=this.m_shape.getUserIndex(t,this.m_userIndexSortedAngleIndexToVertex);-1!==e&&(this.m_bunchEdgeIndices[e]=-1,this.m_shape.setUserIndex(t,this.m_userIndexSortedAngleIndexToVertex,-1))}progress_(t=!1){}}function qt(t,e,s,l,h,u=!0){switch(Bt(l)){case 0:break;case 1:(0,i.a)("relation string length has to be 9 characters");break;default:(0,i.a)("relation string")}if(u){const n=function(t,e,s){return function(t){return"T*F**FFF*"===t}(t)?3:function(t){return"FF*FF****"===t}(t)?4:function(t,e,s){return!(0===e&&0===s||(2===e&&2===s?"F***T****"!==t:2!==e&&1!==e||0!==s||"F**T*****"!==t))}(t,e,s)?8:function(t,e,s){return e>s?"T*****T**"===t:1===e&&1===s&&"0********"===t}(t,e,s)?16:function(t){return"T**FF*FF*"===t}(t)?64:function(t){return"T*****FF*"===t}(t)?1:function(t,e,s){return e===s&&(1!==e?"T*T***T**"===t:"1*T***T**"===t)}(t,e,s)?32:0}(l,t.getDimension(),e.getDimension());if(0!==n)return ie(t,e,s,n,h)}let c=0;if("number"==typeof s)c=s;else{const i=n.Envelope2D.constructEmpty();t.queryEnvelope(i);const r=n.Envelope2D.constructEmpty();e.queryEnvelope(r);const a=n.Envelope2D.constructEmpty();a.setCoords({env2D:i}),a.mergeEnvelope2D(r),c=(0,o.a)(s,a,!1)}const m=Jt(t,c),d=Jt(e,c);if(m.isEmpty()||d.isEmpty())return function(t,e,s){const o=(0,a.d)(9,-1);if(t.isEmpty()&&e.isEmpty())return Wt(o,s);let l,h=!1;t.isEmpty()?(l=e,h=!0):l=t,o[0]=-1,o[1]=-1,o[3]=-1,o[4]=-1,o[6]=-1,o[7]=-1,o[8]=2;const u=l.getGeometryType();if((0,i.h)(u))if(u===i.G.enumPolygon)if(0!==l.calculateArea2D())o[2]=2,o[5]=1;else{o[5]=-1;const t=n.Envelope2D.constructEmpty();l.queryEnvelope(t),o[2]=t.height()||t.width()?1:0}else{const t=0!==l.calculateLength2D();o[2]=t?1:0,o[5]=(0,r.K)(l)?0:-1}else o[2]=0,o[5]=-1;return h&&Qt(o),Wt(o,s)}(m,d,l);const g=m.getGeometryType(),p=d.getGeometryType();let _=!1;switch(g){case i.G.enumPolygon:switch(p){case i.G.enumPolygon:_=function(t,e,s,i,a){const l=new Kt;l.resetMatrix_(),l.setPredicates_(i),l.setAreaAreaPredicates_();const h=n.Envelope2D.constructEmpty(),u=n.Envelope2D.constructEmpty();t.queryEnvelope(h),e.queryEnvelope(u);let c=!1;if(oe(h,u,s)&&(l.areaAreaDisjointPredicates_(t,e),c=!0),c||ae(t,e),!c){const n=new r.E,i=n.addGeometry(t),h=n.addGeometry(e);l.setEditShapeCrackAndCluster_(n,new o.C(s,0),a),l.computeMatrixTopoGraphHalfEdges_(i,h),l.m_topoGraph.removeShape()}return Wt(l.m_matrix,l.m_scl)}(m,d,c,l,h);break;case i.G.enumPolyline:_=Yt(m,d,c,l,h);break;case i.G.enumPoint:_=Xt(m,d,c,l);break;case i.G.enumMultiPoint:_=Ut(m,d,c,l,h)}break;case i.G.enumPolyline:switch(p){case i.G.enumPolygon:_=Yt(d,m,c,te(l),h);break;case i.G.enumPolyline:_=function(t,e,s,i,a){const l=new Kt;l.resetMatrix_(),l.setPredicates_(i),l.setLineLinePredicates_();const h=n.Envelope2D.constructEmpty(),u=n.Envelope2D.constructEmpty();t.queryEnvelope(h),e.queryEnvelope(u);let c=!1;if(oe(h,u,s)&&(l.lineLineDisjointPredicates_(t,e),c=!0),c||ae(t,e),!c){const n=new r.E,i=n.addGeometry(t),h=n.addGeometry(e);l.setEditShapeCrackAndCluster_(n,new o.C(s,0),a),l.m_clusterIndexA=l.m_topoGraph.createUserIndexForClusters(),l.m_clusterIndexB=l.m_topoGraph.createUserIndexForClusters(),$t(i,l.m_topoGraph,l.m_clusterIndexA),$t(h,l.m_topoGraph,l.m_clusterIndexB),l.computeMatrixTopoGraphHalfEdges_(i,h),l.m_topoGraph.deleteUserIndexForClusters(l.m_clusterIndexA),l.m_topoGraph.deleteUserIndexForClusters(l.m_clusterIndexB),l.m_topoGraph.removeShape()}return Wt(l.m_matrix,l.m_scl)}(m,d,c,l,h);break;case i.G.enumPoint:_=jt(m,d,c,l,h);break;case i.G.enumMultiPoint:_=Ht(m,d,c,l,h)}break;case i.G.enumPoint:switch(p){case i.G.enumPolygon:_=Xt(d,m,c,te(l));break;case i.G.enumPolyline:_=jt(d,m,c,te(l),h);break;case i.G.enumPoint:_=function(t,e,s,n){const i=t.getXY(),r=e.getXY(),o=(0,a.d)(9,-1);return a.P.sqrDistance(i,r)<=s*s?o[0]=0:(o[2]=0,o[6]=0),o[8]=2,Wt(o,n)}(m,d,c,l);break;case i.G.enumMultiPoint:_=Zt(d,m,c,te(l))}break;case i.G.enumMultiPoint:switch(p){case i.G.enumPolygon:_=Ut(d,m,c,te(l),h);break;case i.G.enumPolyline:_=Ht(d,m,c,te(l),h);break;case i.G.enumMultiPoint:_=function(t,e,s,i,a){const l=new Kt;l.resetMatrix_(),l.setPredicates_(i),l.setPointPointPredicates_();const h=new n.Envelope2D,u=new n.Envelope2D;t.queryEnvelope(h),e.queryEnvelope(u);let c=!1;if(oe(h,u,s)&&(l.pointPointDisjointPredicates_(),c=!0),!c){const n=new r.E,i=n.addGeometry(t),h=n.addGeometry(e);l.setEditShapeCrackAndCluster_(n,new o.C(s,0),a),l.computeMatrixTopoGraphClusters_(i,h),l.m_topoGraph.removeShape()}return Wt(l.m_matrix,l.m_scl)}(m,d,c,l,h);break;case i.G.enumPoint:_=Zt(m,d,c,l)}break;default:_=!1}return _}function Bt(t){if(9!==t.length)return 1;for(let e=0;e<9;e++){const s=t[e];if("*"!==s&&"T"!==s&&"F"!==s&&"0"!==s&&"1"!==s&&"2"!==s)return 2}return 0}function Yt(t,e,s,i,a){const l=new Kt;l.resetMatrix_(),l.setPredicates_(i),l.setAreaLinePredicates_();const h=n.Envelope2D.constructEmpty(),u=n.Envelope2D.constructEmpty();t.queryEnvelope(h),e.queryEnvelope(u);let c=!1;if(oe(h,u,s)&&(l.areaLineDisjointPredicates_(t,e),c=!0),c||ae(t,e),!c){const n=new r.E,i=n.addGeometry(t),h=n.addGeometry(e);l.setEditShapeCrackAndCluster_(n,new o.C(s,0),a),l.m_clusterIndexB=l.m_topoGraph.createUserIndexForClusters(),$t(h,l.m_topoGraph,l.m_clusterIndexB),l.computeMatrixTopoGraphHalfEdges_(i,h),l.m_topoGraph.deleteUserIndexForClusters(l.m_clusterIndexB),l.m_topoGraph.removeShape()}return Wt(l.m_matrix,l.m_scl)}function Ut(t,e,s,i,a){const l=new Kt;l.resetMatrix_(),l.setPredicates_(i),l.setAreaPointPredicates_();const h=n.Envelope2D.constructEmpty(),u=n.Envelope2D.constructEmpty();t.queryEnvelope(h),e.queryEnvelope(u);let c=!1;if(oe(h,u,s)&&(l.areaPointDisjointPredicates_(t),c=!0),c||ae(t,e),!c){const n=new r.E,i=n.addGeometry(t),h=n.addGeometry(e);l.setEditShapeCrackAndCluster_(n,new o.C(s,0),a),l.computeMatrixTopoGraphClusters_(i,h),l.m_topoGraph.removeShape()}return Wt(l.m_matrix,l.m_scl)}function Ht(t,e,s,i,a){const l=new Kt;l.resetMatrix_(),l.setPredicates_(i),l.setLinePointPredicates_();const h=n.Envelope2D.constructEmpty(),u=n.Envelope2D.constructEmpty();t.queryEnvelope(h),e.queryEnvelope(u);let c=!1;if(oe(h,u,s)&&(l.linePointDisjointPredicates_(t),c=!0),c||ae(t,e),!c){const n=new r.E,i=n.addGeometry(t),h=n.addGeometry(e);l.setEditShapeCrackAndCluster_(n,new o.C(s,0),a),l.m_clusterIndexA=l.m_topoGraph.createUserIndexForClusters(),$t(i,l.m_topoGraph,l.m_clusterIndexA),l.computeMatrixTopoGraphClusters_(i,h),l.m_topoGraph.deleteUserIndexForClusters(l.m_clusterIndexA),l.m_topoGraph.removeShape()}return Wt(l.m_matrix,l.m_scl)}function Xt(t,e,s,i,r){const o=new Kt;o.resetMatrix_(),o.setPredicates_(i),o.setAreaPointPredicates_();const a=n.Envelope2D.constructEmpty();t.queryEnvelope(a);const l=e.getXY();let h=!1;if(le(l,a,s)&&(o.areaPointDisjointPredicates_(t),h=!0),!h){const e=rs(t,l,s);if(1===e)o.m_matrix[0]=0,o.m_matrix[2]=2,o.m_matrix[3]=-1,o.m_matrix[5]=1,o.m_matrix[6]=-1;else if(2===e)if(o.m_matrix[6]=-1,0!==t.calculateArea2D())o.m_matrix[0]=-1,o.m_matrix[3]=0,o.m_matrix[2]=2,o.m_matrix[5]=1;else{o.m_matrix[0]=0,o.m_matrix[3]=-1,o.m_matrix[5]=-1;const e=n.Envelope2D.constructEmpty();t.queryEnvelope(e),o.m_matrix[2]=e.height()||e.width()?1:-1}else o.areaPointDisjointPredicates_(t)}return Wt(o.m_matrix,i)}function jt(t,e,s,i,o){const a=new Kt;a.resetMatrix_(),a.setPredicates_(i),a.setLinePointPredicates_();const l=n.Envelope2D.constructEmpty();t.queryEnvelope(l);let h=!1;if(le(e.getXY(),l,s)&&(a.linePointDisjointPredicates_(t),h=!0),!h){let n=null,i=!1,l=!1;if((a.m_performPredicates[0]||a.m_performPredicates[6])&&(ie(t,e,s,4,o)?(a.m_matrix[0]=-1,a.m_matrix[6]=0):(a.m_performPredicates[0]&&(n=(0,r.c)(t),l=!ie(n,e,s,4,o),i=!0,a.m_matrix[0]=l?-1:0),a.m_matrix[6]=-1)),a.m_performPredicates[3]&&(null!==n&&n.isEmpty()?a.m_matrix[3]=-1:(i||(null==n&&(n=(0,r.c)(t)),l=!ie(n,e,s,4,o),i=!0),a.m_matrix[3]=l?0:-1)),a.m_performPredicates[5])if(null!==n&&n.isEmpty())a.m_matrix[5]=-1;else if(i&&!l)a.m_matrix[5]=0;else{null===n&&(n=(0,r.c)(t));const i=ie(n,e,s,3,o);a.m_matrix[5]=i?-1:0}if(a.m_performPredicates[2])if(0!==t.calculateLength2D())a.m_matrix[2]=1;else{const n=new r.M({vd:t.getDescription()});n.addPoints(t,0,t.getPointCount());const i=ie(n,e,s,3,o);a.m_matrix[2]=i?-1:0}}return Wt(a.m_matrix,a.m_scl)}function Zt(t,e,s,i,r){const o=new Kt;o.resetMatrix_(),o.setPredicates_(i),o.setPointPointPredicates_();const l=n.Envelope2D.constructEmpty();t.queryEnvelope(l);const h=e.getXY(),u=new a.P;let c=!1;if(le(h,l,s)&&(o.pointPointDisjointPredicates_(),c=!0),!c){let e=!1,n=!0;const i=s*s;for(let s=0;s<t.getPointCount()&&(t.queryXY(s,u),a.P.sqrDistance(u,h)<=i?e=!0:n=!1,!e||n);s++);e?(o.m_matrix[0]=0,o.m_matrix[2]=n?-1:0,o.m_matrix[6]=-1):(o.m_matrix[0]=-1,o.m_matrix[2]=0,o.m_matrix[6]=0)}return Wt(o.m_matrix,i)}function Wt(t,e){for(let s=0;s<9;s++)switch(e[s]){case"T":if(-1===t[s])return!1;break;case"F":if(-1!==t[s])return!1;break;case"0":if(0!==t[s])return!1;break;case"1":if(1!==t[s])return!1;break;case"2":if(2!==t[s])return!1}return!0}function $t(t,e,s){const n=e.getGeometryID(t);for(let i=e.getFirstCluster();i!==r.n;i=e.getNextCluster(i)){if(!(e.getClusterParentage(i)&n))continue;const t=e.getClusterHalfEdge(i);if(t===r.n){e.setClusterUserIndex(i,s,0);continue}let o=t,a=0;do{const t=o;!!(e.getHalfEdgeParentage(t)&n)&&a++,o=e.getHalfEdgeNext(e.getHalfEdgeTwin(t))}while(o!==t);e.setClusterUserIndex(i,s,a)}}class Kt{nullFunc(){return(0,i.d)("should not be called"),!1}constructor(){this.m_clusterIndexA=-1,this.m_clusterIndexB=-1,this.m_visitedIndex=-1,this.m_topoGraph=new tt,this.m_matrix=(0,a.d)(9,0),this.m_maxDim=(0,a.d)(9,0),this.m_performPredicates=(0,a.d)(9,!1),this.m_scl="",this.m_predicateCount=0,this.m_predicatesHalfEdge=this.nullFunc,this.m_predicatesCluster=this.nullFunc}resetMatrix_(){this.m_matrix.fill(-2),this.m_maxDim.fill(-2)}setPredicates_(t){this.m_scl=t;for(let e=0;e<9;e++)"*"!==this.m_scl[e]?(this.m_performPredicates[e]=!0,this.m_predicateCount++):this.m_performPredicates[e]=!1}setRemainingPredicatesToFalse_(){for(let t=0;t<9;t++)this.m_performPredicates[t]&&-2===this.m_matrix[t]&&(this.m_matrix[t]=-1,this.m_performPredicates[t]=!1)}isPredicateKnown_(t){return!(-2===this.m_matrix[t]||(-1===this.m_matrix[t]?(this.m_performPredicates[t]=!1,this.m_predicateCount--,0):"T"!==this.m_scl[t]&&"F"!==this.m_scl[t]&&this.m_matrix[t]<this.m_maxDim[t]||(this.m_performPredicates[t]=!1,this.m_predicateCount--,0)))}setAreaAreaPredicates_(){this.m_predicatesHalfEdge=this.areaAreaPredicates_,this.m_maxDim[0]=2,this.m_maxDim[1]=1,this.m_maxDim[2]=2,this.m_maxDim[3]=1,this.m_maxDim[4]=1,this.m_maxDim[5]=1,this.m_maxDim[6]=2,this.m_maxDim[7]=1,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaLinePredicates_(){this.m_predicatesHalfEdge=this.areaLinePredicates_,this.m_predicatesCluster=this.areaPointPredicates_,this.m_maxDim[0]=1,this.m_maxDim[1]=0,this.m_maxDim[2]=2,this.m_maxDim[3]=1,this.m_maxDim[4]=0,this.m_maxDim[5]=1,this.m_maxDim[6]=1,this.m_maxDim[7]=0,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLineLinePredicates_(){this.m_predicatesHalfEdge=this.lineLinePredicates_,this.m_predicatesCluster=this.linePointPredicates_,this.m_maxDim[0]=1,this.m_maxDim[1]=0,this.m_maxDim[2]=1,this.m_maxDim[3]=0,this.m_maxDim[4]=0,this.m_maxDim[5]=0,this.m_maxDim[6]=1,this.m_maxDim[7]=0,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaPointPredicates_(){this.m_predicatesCluster=this.areaPointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=2,this.m_maxDim[3]=0,this.m_maxDim[4]=-1,this.m_maxDim[5]=1,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLinePointPredicates_(){this.m_predicatesCluster=this.linePointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=1,this.m_maxDim[3]=0,this.m_maxDim[4]=-1,this.m_maxDim[5]=0,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setPointPointPredicates_(){this.m_predicatesCluster=this.pointPointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=0,this.m_maxDim[3]=-1,this.m_maxDim[4]=-1,this.m_maxDim[5]=-1,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[3]&&(this.m_matrix[3]=-1,this.m_performPredicates[3]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[5]&&(this.m_matrix[5]=-1,this.m_performPredicates[5]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}areaAreaDisjointPredicates_(t,e){this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.areaGeomContainsOrDisjointPredicates_(t,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5]),this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[6]?6:-1,this.m_scl[6],this.m_performPredicates[7]?7:-1,this.m_scl[7])}areaGeomContainsOrDisjointPredicates_(t,e,s,i,r){const o=-1!==e,a=-1!==i;if(o||a)if(("T"!==s&&"F"!==s&&o||"T"!==r&&"F"!==r&&a)&&0===t.calculateArea2D()){if(a&&(this.m_matrix[i]=-1),o){const s=n.Envelope2D.constructEmpty();t.queryEnvelope(s),this.m_matrix[e]=s.height()||s.width()?1:0}}else o&&(this.m_matrix[e]=2),a&&(this.m_matrix[i]=1)}areaAreaContainsPredicates_(t){this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1,this.m_matrix[7]=-1,this.areaGeomContainsOrDisjointPredicates_(t,this.m_performPredicates[0]?0:-1,this.m_scl[0],this.m_performPredicates[1]?1:-1,this.m_scl[1])}areaAreaWithinPredicates_(t){this.areaAreaContainsPredicates_(t),Qt(this.m_matrix)}areaLineDisjointPredicates_(t,e){if(this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_performPredicates[6]){const t=this.m_scl[6],s="T"===t||"F"===t||0!==e.calculateLength2D();this.m_matrix[6]=s?1:0}if(this.m_performPredicates[7]){const t=(0,r.K)(e);this.m_matrix[7]=t?0:-1}this.areaGeomContainsOrDisjointPredicates_(t,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaLineContainsPredicates_(t,e){if(this.m_performPredicates[0]){const t=this.m_scl[0],s="T"===t||"F"===t||0!==e.calculateLength2D();this.m_matrix[0]=s?1:0}if(this.m_performPredicates[1]){const t=(0,r.K)(e);this.m_matrix[1]=t?0:-1}this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1,this.m_matrix[7]=-1}areaPointDisjointPredicates_(t){this.m_matrix[0]=-1,this.m_matrix[3]=-1,this.m_matrix[6]=0,this.areaGeomContainsOrDisjointPredicates_(t,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaPointContainsPredicates_(t){this.m_matrix[0]=0,this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1}lineLineDisjointPredicates_(t,e){if(this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_performPredicates[2]){const e=this.m_scl[2],s="T"===e||"F"===e||0!==t.calculateLength2D();this.m_matrix[2]=s?1:0}if(this.m_performPredicates[5]){const e=(0,r.K)(t);this.m_matrix[5]=e?0:-1}if(this.m_performPredicates[6]){const t=this.m_scl[6],s="T"===t||"F"===t||0!==e.calculateLength2D();this.m_matrix[6]=s?1:0}if(this.m_performPredicates[7]){const t=(0,r.K)(e);this.m_matrix[7]=t?0:-1}}linePointDisjointPredicates_(t){if(this.m_matrix[0]=-1,this.m_matrix[3]=-1,this.m_performPredicates[2]){const e=this.m_scl[2],s="T"===e||"F"===e||0!==t.calculateLength2D();this.m_matrix[2]=s?1:0}if(this.m_performPredicates[5]){const e=(0,r.K)(t);this.m_matrix[5]=e?0:-1}this.m_matrix[6]=0}pointPointDisjointPredicates_(){this.m_matrix[0]=-1,this.m_matrix[2]=0,this.m_matrix[6]=0}areaAreaPredicates_(t,e,s){let n=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorArea_(t,e,s);const i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[1]){this.interiorAreaBoundaryArea_(t,e,1);const s=this.isPredicateKnown_(1);n&&=s}if(this.m_performPredicates[2]){this.interiorAreaExteriorArea_(t,e,s,2);const i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.interiorAreaBoundaryArea_(t,s,3);const e=this.isPredicateKnown_(3);n&&=e}if(this.m_performPredicates[4]){this.boundaryAreaBoundaryArea_(t,e,s);const i=this.isPredicateKnown_(4);n&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorArea_(t,e,s,5);const i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.interiorAreaExteriorArea_(t,s,e,6);const i=this.isPredicateKnown_(6);n&&=i}if(this.m_performPredicates[7]){this.boundaryAreaExteriorArea_(t,s,e,7);const i=this.isPredicateKnown_(7);n&&=i}return n}areaLinePredicates_(t,e,s){let n=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorLine_(t,e,s);const i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[1]){this.interiorAreaBoundaryLine_(t,e,s,this.m_clusterIndexB);const i=this.isPredicateKnown_(1);n&&=i}if(this.m_performPredicates[2]){this.interiorAreaExteriorLine_(t,e,s);const i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.boundaryAreaInteriorLine_(t,e,s,this.m_clusterIndexB);const i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[4]){this.boundaryAreaBoundaryLine_(t,e,s,this.m_clusterIndexB);const i=this.isPredicateKnown_(4);n&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorLine_(t,e,s);const i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.exteriorAreaInteriorLine_(t,e);const s=this.isPredicateKnown_(6);n&&=s}if(this.m_performPredicates[7]){this.exteriorAreaBoundaryLine_(t,e,s,this.m_clusterIndexB);const i=this.isPredicateKnown_(7);n&&=i}return n}lineLinePredicates_(t,e,s){let n=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorLine_(t,e,s,this.m_clusterIndexA,this.m_clusterIndexB);const i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[1]){this.interiorLineBoundaryLine_(t,e,s,this.m_clusterIndexA,this.m_clusterIndexB,1);const i=this.isPredicateKnown_(1);n&&=i}if(this.m_performPredicates[2]){this.interiorLineExteriorLine_(t,e,s,2);const i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.interiorLineBoundaryLine_(t,s,e,this.m_clusterIndexB,this.m_clusterIndexA,3);const i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[4]){this.boundaryLineBoundaryLine_(t,e,s,this.m_clusterIndexA,this.m_clusterIndexB);const i=this.isPredicateKnown_(4);n&&=i}if(this.m_performPredicates[5]){this.boundaryLineExteriorLine_(t,e,s,this.m_clusterIndexA,5);const i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.interiorLineExteriorLine_(t,s,e,6);const i=this.isPredicateKnown_(6);n&&=i}if(this.m_performPredicates[7]){this.boundaryLineExteriorLine_(t,s,e,this.m_clusterIndexB,7);const i=this.isPredicateKnown_(7);n&&=i}return n}areaPointPredicates_(t,e,s){let n=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorPoint_(t,e);const s=this.isPredicateKnown_(0);n&&=s}if(this.m_performPredicates[2]){this.interiorAreaExteriorPoint_(t,e);const s=this.isPredicateKnown_(2);n&&=s}if(this.m_performPredicates[3]){this.boundaryAreaInteriorPoint_(t,e,s);const i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorPoint_(t,e);const s=this.isPredicateKnown_(5);n&&=s}if(this.m_performPredicates[6]){this.exteriorAreaInteriorPoint_(t,e);const s=this.isPredicateKnown_(6);n&&=s}return n}linePointPredicates_(t,e,s){let n=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorPoint_(t,e,s,this.m_clusterIndexA);const i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[2]){this.interiorLineExteriorPoint_(t,e,s,this.m_clusterIndexA);const i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.boundaryLineInteriorPoint_(t,e,s,this.m_clusterIndexA);const i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[5]){this.boundaryLineExteriorPoint_(t,e,s,this.m_clusterIndexA);const i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.exteriorLineInteriorPoint_(t,e,s);const i=this.isPredicateKnown_(6);n&&=i}return n}pointPointPredicates_(t,e,s){let n=!0;if(this.m_performPredicates[0]){this.interiorPointInteriorPoint_(t,e,s);const i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[2]){this.interiorPointExteriorPoint_(t,e,s,2);const i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[6]){this.interiorPointExteriorPoint_(t,s,e,6);const i=this.isPredicateKnown_(6);n&&=i}return n}interiorAreaInteriorArea_(t,e,s){if(2===this.m_matrix[0])return;const n=this.m_topoGraph.getHalfEdgeFaceParentage(t);n&e&&n&s&&(this.m_matrix[0]=2)}interiorAreaBoundaryArea_(t,e,s){if(1===this.m_matrix[s])return;const n=this.m_topoGraph.getHalfEdgeFaceParentage(t),i=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(t));n&e&&i&e&&(this.m_matrix[s]=1)}interiorAreaExteriorArea_(t,e,s,n){if(2===this.m_matrix[n])return;const i=this.m_topoGraph.getHalfEdgeFaceParentage(t);i&e&&!(i&s)&&(this.m_matrix[n]=2)}boundaryAreaBoundaryArea_(t,e,s){if(1===this.m_matrix[4])return;const n=this.m_topoGraph.getHalfEdgeParentage(t);if(n&e&&n&s)this.m_matrix[4]=1;else if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)){const n=this.m_topoGraph.getHalfEdgeTo(t),i=this.m_topoGraph.getClusterParentage(n);if(i&e&&i&s)return void(this.m_matrix[4]=0)}}boundaryAreaExteriorArea_(t,e,s,n){if(1===this.m_matrix[n])return;const i=this.m_topoGraph.getHalfEdgeFaceParentage(t),r=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(t));!(i&s)&&!(r&s)&&(this.m_matrix[n]=1)}interiorAreaInteriorLine_(t,e,s){if(1===this.m_matrix[0])return;const n=this.m_topoGraph.getHalfEdgeFaceParentage(t),i=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(t));n&e&&i&e&&(this.m_matrix[0]=1)}interiorAreaBoundaryLine_(t,e,s,n){if(0!==this.m_matrix[1]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)){const i=this.m_topoGraph.getHalfEdgeTo(t),r=this.m_topoGraph.getClusterParentage(i);if(!(r&e)&&this.m_topoGraph.getHalfEdgeFaceParentage(t)&e){const t=this.m_topoGraph.getClusterUserIndex(i,n);if(r&s&&t%2!=0)return void(this.m_matrix[1]=0)}}}interiorAreaExteriorLine_(t,e,s){2!==this.m_matrix[2]&&this.m_topoGraph.getHalfEdgeParentage(t)&e&&(this.m_matrix[2]=2)}boundaryAreaInteriorLine_(t,e,s,n){if(1===this.m_matrix[3])return;const i=this.m_topoGraph.getHalfEdgeParentage(t);if(i&e&&i&s)this.m_matrix[3]=1;else if(0!==this.m_matrix[3]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)){const i=this.m_topoGraph.getHalfEdgeTo(t),r=this.m_topoGraph.getClusterParentage(i);if(r&e){const t=this.m_topoGraph.getClusterUserIndex(i,n);if(r&s&&t%2==0)return void(this.m_matrix[3]=0)}}}boundaryAreaBoundaryLine_(t,e,s,n){if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)){const i=this.m_topoGraph.getHalfEdgeTo(t),r=this.m_topoGraph.getClusterParentage(i);if(r&e){const t=this.m_topoGraph.getClusterUserIndex(i,n);if(r&s&&t%2!=0)return void(this.m_matrix[4]=0)}}}boundaryAreaExteriorLine_(t,e,s){if(1===this.m_matrix[5])return;const n=this.m_topoGraph.getHalfEdgeParentage(t);n&e&&!(n&s)&&(this.m_matrix[5]=1)}exteriorAreaInteriorLine_(t,e){if(1===this.m_matrix[6])return;const s=this.m_topoGraph.getHalfEdgeFaceParentage(t),n=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(t));!(s&e)&&!(n&e)&&(this.m_matrix[6]=1)}exteriorAreaBoundaryLine_(t,e,s,n){if(0!==this.m_matrix[7]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)){const i=this.m_topoGraph.getHalfEdgeTo(t),r=this.m_topoGraph.getClusterParentage(i);if(!(r&e||this.m_topoGraph.getHalfEdgeFaceParentage(t)&e)){const t=this.m_topoGraph.getClusterUserIndex(i,n);if(r&s&&t%2!=0)return void(this.m_matrix[7]=0)}}}interiorLineInteriorLine_(t,e,s,n,i){if(1===this.m_matrix[0])return;const r=this.m_topoGraph.getHalfEdgeParentage(t);if(r&e&&r&s)this.m_matrix[0]=1;else if(0!==this.m_matrix[0]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)){const r=this.m_topoGraph.getHalfEdgeTo(t),o=this.m_topoGraph.getClusterParentage(r);if(o&e&&o&s){const t=this.m_topoGraph.getClusterUserIndex(r,n),e=this.m_topoGraph.getClusterUserIndex(r,i);if(t%2==0&&e%2==0)return void(this.m_matrix[0]=0)}}}interiorLineBoundaryLine_(t,e,s,n,i,r){if(0!==this.m_matrix[r]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)){const o=this.m_topoGraph.getHalfEdgeTo(t),a=this.m_topoGraph.getClusterParentage(o);if(a&e&&a&s){const t=this.m_topoGraph.getClusterUserIndex(o,n),e=this.m_topoGraph.getClusterUserIndex(o,i);if(t%2==0&&e%2!=0)return void(this.m_matrix[r]=0)}}}interiorLineExteriorLine_(t,e,s,n){if(1===this.m_matrix[n])return;const i=this.m_topoGraph.getHalfEdgeParentage(t);i&e&&!(i&s)&&(this.m_matrix[n]=1)}boundaryLineBoundaryLine_(t,e,s,n,i){if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)){const r=this.m_topoGraph.getHalfEdgeTo(t),o=this.m_topoGraph.getClusterParentage(r);if(o&e&&o&s){const t=this.m_topoGraph.getClusterUserIndex(r,n),e=this.m_topoGraph.getClusterUserIndex(r,i);if(t%2!=0&&e%2!=0)return void(this.m_matrix[4]=0)}}}boundaryLineExteriorLine_(t,e,s,n,i){if(0!==this.m_matrix[i]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(t)),this.m_visitedIndex)){const e=this.m_topoGraph.getHalfEdgeTo(t);if(!(this.m_topoGraph.getClusterParentage(e)&s)&&this.m_topoGraph.getClusterUserIndex(e,n)%2!=0)return void(this.m_matrix[i]=0)}}interiorAreaInteriorPoint_(t,e){if(0!==this.m_matrix[0]&&!(this.m_topoGraph.getClusterParentage(t)&e)){const s=this.m_topoGraph.getClusterChain(t);if(this.m_topoGraph.getChainParentage(s)&e)return void(this.m_matrix[0]=0)}}interiorAreaExteriorPoint_(t,e){2!==this.m_matrix[2]&&this.m_topoGraph.getClusterParentage(t)&e&&(this.m_matrix[2]=2)}boundaryAreaInteriorPoint_(t,e,s){if(0===this.m_matrix[3])return;const n=this.m_topoGraph.getClusterParentage(t);!(n&e)||!(n&s)||(this.m_matrix[3]=0)}boundaryAreaExteriorPoint_(t,e){1!==this.m_matrix[5]&&this.m_topoGraph.getClusterParentage(t)&e&&(this.m_matrix[5]=1)}exteriorAreaInteriorPoint_(t,e){if(0!==this.m_matrix[6]&&!(this.m_topoGraph.getClusterParentage(t)&e)){const s=this.m_topoGraph.getClusterChain(t);if(!(this.m_topoGraph.getChainParentage(s)&e))return void(this.m_matrix[6]=0)}}interiorLineInteriorPoint_(t,e,s,n){if(0===this.m_matrix[0])return;const i=this.m_topoGraph.getClusterParentage(t);i&e&&i&s&&this.m_topoGraph.getClusterUserIndex(t,n)%2==0&&(this.m_matrix[0]=0)}interiorLineExteriorPoint_(t,e,s,n){if(1!==this.m_matrix[2])if(-1===this.m_topoGraph.getClusterHalfEdge(t)){if(0!==this.m_matrix[2]&&!(this.m_topoGraph.getClusterParentage(t)&s))return void(this.m_matrix[2]=0)}else this.m_matrix[2]=1}boundaryLineInteriorPoint_(t,e,s,n){if(0===this.m_matrix[3])return;const i=this.m_topoGraph.getClusterParentage(t);i&e&&i&s&&this.m_topoGraph.getClusterUserIndex(t,n)%2!=0&&(this.m_matrix[3]=0)}boundaryLineExteriorPoint_(t,e,s,n){if(0===this.m_matrix[5])return;const i=this.m_topoGraph.getClusterParentage(t);!(i&e)||i&s||this.m_topoGraph.getClusterUserIndex(t,n)%2==0||(this.m_matrix[5]=0)}exteriorLineInteriorPoint_(t,e,s){if(0===this.m_matrix[6])return;const n=this.m_topoGraph.getClusterParentage(t);n&e||!(n&s)||(this.m_matrix[6]=0)}interiorPointInteriorPoint_(t,e,s){if(0===this.m_matrix[0])return;const n=this.m_topoGraph.getClusterParentage(t);!(n&e)||!(n&s)||(this.m_matrix[0]=0)}interiorPointExteriorPoint_(t,e,s,n){if(0===this.m_matrix[n])return;const i=this.m_topoGraph.getClusterParentage(t);!(i&e)||i&s||(this.m_matrix[n]=0)}computeMatrixTopoGraphHalfEdges_(t,e){let s=!1;const n=this.m_topoGraph.getGeometryID(t),i=this.m_topoGraph.getGeometryID(e);this.m_visitedIndex=this.m_topoGraph.createUserIndexForHalfEdges();for(let o=this.m_topoGraph.getFirstCluster();o!==r.n;o=this.m_topoGraph.getNextCluster(o)){const t=this.m_topoGraph.getClusterHalfEdge(o);if(t===r.n){if(null!==this.m_predicatesCluster&&(s=this.m_predicatesCluster(o,n,i),s))break;continue}let e=t;do{let t=e;if(1!==this.m_topoGraph.getHalfEdgeUserIndex(t,this.m_visitedIndex))do{if(s=this.m_predicatesHalfEdge(t,n,i),s)break;this.m_topoGraph.setHalfEdgeUserIndex(t,this.m_visitedIndex,1),t=this.m_topoGraph.getHalfEdgeNext(t)}while(t!==e&&!s);if(s)break;e=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(t))}while(e!==t);if(s)break}s||this.setRemainingPredicatesToFalse_(),this.m_topoGraph.deleteUserIndexForHalfEdges(this.m_visitedIndex)}computeMatrixTopoGraphClusters_(t,e){let s=!1;const n=this.m_topoGraph.getGeometryID(t),i=this.m_topoGraph.getGeometryID(e);for(let o=this.m_topoGraph.getFirstCluster();o!==r.n&&(s=this.m_predicatesCluster(o,n,i),!s);o=this.m_topoGraph.getNextCluster(o));s||this.setRemainingPredicatesToFalse_()}setEditShape_(t,e){this.m_topoGraph.setEditShape(t,e)}setEditShapeCrackAndCluster_(t,e,s){let n=0;if(t.hasCurves()){const i=new xs,r=t.getEnvelope2D(s),o=_s(e.total(),r);n=ys(o,0),ms(t,o,e.total(),12e3,i,null,s),i.clearStitcher(t)}bs(t,e.add(n),s,!1,!1),t.filterClosePoints(0,!0,!0,!1,r.n);for(let o=t.getFirstGeometry();o!==r.n;o=t.getNextGeometry(o))t.getGeometryType(o)===i.G.enumPolygon&&zt(t,o,-1,!1,r.n,s);this.setEditShape_(t,s)}}function Qt(t){const e=t[1],s=t[2],n=t[5];t[1]=t[3],t[2]=t[6],t[5]=t[7],t[3]=e,t[6]=s,t[7]=n}function Jt(t,e,s){const a=t.getGeometryType();if((0,i.f)(a)){const e=new r.P({vd:t.getDescription()});return e.addSegment(t,!0),e}if(a===i.G.enumEnvelope){const s=t,i=n.Envelope2D.constructEmpty();if(t.queryEnvelope(i),i.height()<=e&&i.width()<=e){const e=new o.P({vd:t.getDescription()});return s.getCenter(e),e}if(i.height()<=e||i.width()<=e){const e=new r.P({vd:t.getDescription()}),n=new o.P;return s.queryCornerByVal(0,n),e.startPathPoint(n),s.queryCornerByVal(2,n),e.lineToPoint(n),e}const a=new r.a({vd:t.getDescription()});return a.addEnvelope(s,!1),a}return t}function te(t){return`${t[0]}${t[3]}${t[6]}${t[1]}${t[4]}${t[7]}${t[2]}${t[5]}${t[8]}`}class ee{nullFunc(){return(0,i.d)("should not be called"),!1}constructor(t,e,s,r=!1){this.m_bDone=!1,this.m_tolerance=0,this.m_elementHandle=-1,this.m_query=n.Envelope2D.constructEmpty(),this.m_envInter=n.Envelope2D.constructEmpty(),this.m_quadTree=null,this.m_intersector=null,this.m_function=this.nullFunc;const a=t.getAccelerators();let l=null;null!=a&&(l=r?a.getQuadTreeForPaths():a.getQuadTree());const h=e.getAccelerators();let u=null;if(null!=h&&(u=r?h.getQuadTreeForPaths():h.getQuadTree()),null===l&&null===u&&!r){const r=t.getPointCount(),a=e.getPointCount();if(r>10&&a>10){const h=n.Envelope2D.constructEmpty(),c=n.Envelope2D.constructEmpty(),m=n.Envelope2D.constructEmpty();t.queryLooseEnvelope(h),e.queryLooseEnvelope(c),h.inflateCoords(s,s),c.inflateCoords(s,s),m.setCoords({env2D:h}),m.intersect(c),r>=a?l=(0,i.h)(t.getGeometryType())?(0,o.F)(t,m):(0,o.Z)(t,m):u=(0,i.h)(e.getGeometryType())?(0,o.F)(e,m):(0,o.Z)(e,m)}}this.construct_(t,l,e,u,s,r)}next(){if(this.m_bQuadTree){if(this.m_bDone)return!1;for(;this.m_function(););return!this.m_bDone}return!!this.m_intersector&&this.m_intersector.next()}getRedElement(){return this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElement(this.m_elementHandle):(0,i.h)(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_bSwapElements?this.m_intersector.getBlueElement(this.m_intersector.getHandleB()):this.m_intersector.getRedElement(this.m_intersector.getHandleA())}getBlueElement(){return this.m_bQuadTree?this.m_bSwapElements?(0,i.h)(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_quadTree.getElement(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedElement(this.m_intersector.getHandleA()):this.m_intersector.getBlueElement(this.m_intersector.getHandleB())}getRedEnvelope(){return this.m_bPaths||(0,i.p)(""),this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_query:this.m_bSwapElements?this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB()):this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA())}getBlueEnvelope(){return this.m_bPaths||(0,i.p)(""),this.m_bQuadTree?this.m_bSwapElements?this.m_query:this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA()):this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB())}construct_(t,e,s,r,a,l){const h=n.Envelope2D.constructEmpty(),u=n.Envelope2D.constructEmpty();t.queryLooseEnvelope(h),s.queryLooseEnvelope(u),h.inflateCoords(a,a),u.inflateCoords(a,a),this.m_envInter.setCoords({env2D:h}),this.m_envInter.intersect(u),this.m_multiVertexImplA=t,this.m_multiVertexImplB=s;const c=t.getGeometryType(),m=s.getGeometryType();this.m_bPaths=l,this.m_pathIndex=-1,this.m_pointIndex=-1,this.m_bSwapElements=!1,this.m_queryType=i.G.enumUnknown,this.m_bQuadTree=!1,null!==e&&(this.m_bDone=!1,this.m_tolerance=a,this.m_quadTree=e,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!0,(0,i.h)(m)?(this.m_queryType=m,this.m_function=this.nextPath_,l?this.m_pathIndex=s.getPathCount():this.m_segIter=s.querySegmentIterator()):(this.m_queryType=m,this.m_function=this.nextPoint_,this.m_pointIndex=s.getPointCount())),this.m_bQuadTree||null!==r&&(this.m_bDone=!1,this.m_tolerance=a,this.m_quadTree=r,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!1,(0,i.h)(c)?(this.m_queryType=c,this.m_function=this.nextPath_,l?this.m_pathIndex=t.getPathCount():this.m_segIter=t.querySegmentIterator()):(this.m_queryType=c,this.m_function=this.nextPoint_,this.m_pointIndex=t.getPointCount())),this.m_bQuadTree||(l&&(0,i.h)(c)&&(0,i.h)(m)?this.m_intersector=(0,o.a1)(t,s,a):(0,i.h)(c)&&(0,i.h)(m)?(this.m_intersector=(0,o._)(t,s,a),this.m_bSwapElements=!1):(0,i.h)(c)&&!(0,i.h)(m)?(this.m_intersector=(0,o.$)(t,s,a),this.m_bSwapElements=!1):!(0,i.h)(c)&&(0,i.h)(m)?(this.m_intersector=(0,o.$)(s,t,a),this.m_bSwapElements=!0):(this.m_intersector=(0,o.a0)(t,s,a),this.m_bSwapElements=!1))}nextPath_(){return this.m_bPaths?-1==--this.m_pathIndex?(this.m_bDone=!0,!1):(this.m_bSwapElements?this.m_multiVertexImplB.queryPathEnvelope(this.m_pathIndex,this.m_query):this.m_multiVertexImplA.queryPathEnvelope(this.m_pathIndex,this.m_query),this.m_qtIter.resetIterator(this.m_query,this.m_tolerance),this.m_function=this.iterate_,!0):this.m_segIter.nextPath()?(this.m_function=this.nextSegment_,!0):(this.m_bDone=!0,!1)}nextSegment_(){if(!this.m_segIter.hasNextSegment())return this.m_function=this.nextPath_,!0;const t=this.m_segIter.nextSegment(),e=new n.Envelope2D;return t.queryLooseEnvelope(e),!e.isIntersecting(this.m_envInter)||(this.m_qtIter.resetIterator(t,this.m_tolerance),this.m_function=this.iterate_,!0)}nextPoint_(){if(-1==--this.m_pointIndex)return this.m_bDone=!0,!1;const t=new a.P;if(this.m_bSwapElements){const e=this.m_multiVertexImplB.getXY(this.m_pointIndex);t.setCoordsPoint2D(e)}else{const e=this.m_multiVertexImplA.getXY(this.m_pointIndex);t.setCoordsPoint2D(e)}return!this.m_envInter.contains(t)||(this.m_qtIter.resetIterator(n.Envelope2D.construct(t.x,t.y,t.x,t.y),this.m_tolerance),this.m_function=this.iterate_,!0)}iterate_(){return this.m_elementHandle=this.m_qtIter.next(),-1===this.m_elementHandle&&((0,i.h)(this.m_queryType)?(this.m_function=this.m_bPaths?this.nextPath_:this.nextSegment_,!0):(this.m_function=this.nextPoint_,!0))}}function se(t){return 2===t?1:1===t?2:128===t?64:64===t?128:t}function ne(t,e,s){let i;if(t instanceof So||null===t){const r=n.Envelope2D.constructEmpty();r.setCoords({env2D:e}),r.mergeEnvelope2D(s),i=(0,o.a)(t,r,!1)}else i=t;return i}function ie(t,e,s,l,h){if(t.isEmpty()||e.isEmpty())return 4===l;(0,i.c)(t),(0,i.c)(e);let c=t.getGeometryType(),m=e.getGeometryType();if(c===i.G.enumEnvelope){if(m===i.G.enumEnvelope)return function(t,e,s,i){if(t.isEmpty()||e.isEmpty())return 4===i;const r=n.Envelope2D.constructEmpty();t.queryEnvelope(r);const o=n.Envelope2D.constructEmpty();e.queryEnvelope(o);const a=ne(s,r,o);switch(i){case 4:return oe(r,o,a);case 2:return ke(o,r,a,!1);case 128:return ke(o,r,a,!0);case 1:return ke(r,o,a,!1);case 64:return ke(r,o,a,!0);case 3:return Re(r,o,a);case 8:return function(t,e,s){if(t.height()<=s||t.width()<=s||e.height()<=s||e.width()<=s)return!1;const i=new n.Envelope2D;return i.setCoords({env2D:t}),i.inflateCoords(-s,-s),i.intersect(e),!(!i.isEmpty()&&i.height()>s&&i.width()>s||(i.setCoords({env2D:t}),i.inflateCoords(s,s),i.intersect(e),i.isEmpty()))}(r,o,a);case 32:return function(t,e,s){if(t.height()<=s||t.width()<=s||e.height()<=s||e.width()<=s)return!1;if(Ve(t,e,s))return!1;if(Ve(e,t,s))return!1;const i=new n.Envelope2D;return i.setCoords({env2D:t}),i.inflateCoords(-s,-s),i.intersect(e),!i.isEmpty()&&(i.height()>s||i.width()>s)}(r,o,a);case 16:return!1}return!1}(t,e,s,l);if(m===i.G.enumPoint)return re(e,t,s,se(l))}else if(c===i.G.enumPoint){if(m===i.G.enumEnvelope)return re(t,e,s,l);if(m===i.G.enumPoint)return function(t,e,s,i){if(t.isEmpty()||e.isEmpty())return 4===i;const r=t.getXY(),l=e.getXY();let h;if(s instanceof So||null===s){const t=n.Envelope2D.constructEmpty();t.setCoords({pt:r}),t.merge(l),h=(0,o.a)(s,t,!1)}else h=s;switch(i){case 4:return function(t,e,s){return a.P.sqrDistance(t,e)>s*s}(r,l,h);case 2:case 128:return Fe(l,r,h);case 1:case 64:return Fe(r,l,h);case 3:return Ne(r,l,h)}return!1}(t,e,s,l)}const d=n.Envelope2D.constructEmpty();t.queryEnvelope(d);const g=n.Envelope2D.constructEmpty();e.queryEnvelope(g);const p=ne(s,d,g);if(oe(d,g,p))return 4===l;let _=!1,f=null,y=null,x=null,v=null;switch((0,i.f)(c)?(f=new r.P({vd:t.getDescription()}),f.addSegment(t,!0),x=f,c=i.G.enumPolyline):x=t,(0,i.f)(m)?(y=new r.P({vd:e.getDescription()}),y.addSegment(e,!0),v=y,m=i.G.enumPolyline):v=e,c!==i.G.enumEnvelope&&m!==i.G.enumEnvelope?(x.getDimension()<v.getDimension()||c===i.G.enumPoint&&m===i.G.enumMultiPoint)&&(l=se(l)):c!==i.G.enumPolygon&&m!==i.G.enumEnvelope&&(l=se(l)),c){case i.G.enumPolygon:switch(m){case i.G.enumPolygon:_=function(t,e,s,n,i){switch(n){case 4:return function(t,e,s){return ae(t,e,s,!0),1===Le(t,e,s,!0)}(t,e,s);case 2:return xe(e,t,s,i);case 128:return ve(e,t,s);case 1:return xe(t,e,s,i);case 64:return ve(t,e,s);case 3:return ye(t,e,s,i);case 8:return function(t,e,s){return ae(t,e),$e(t,e,s,null)}(t,e,s);case 32:return function(t,e,s,n){return ae(t,e),Ke(t,e,s,n)}(t,e,s,i)}return!1}(x,v,p,l,h);break;case i.G.enumPolyline:_=he(x,v,p,l,h);break;case i.G.enumPoint:_=ue(x,v,p,l);break;case i.G.enumMultiPoint:_=ce(x,v,p,l);break;case i.G.enumEnvelope:_=me(x,v,p,l,h)}break;case i.G.enumPolyline:switch(m){case i.G.enumPolygon:_=he(v,x,p,l,h);break;case i.G.enumPolyline:_=function(t,e,s,i,o){switch(i){case 4:return function(t,e,s){ae(t,e);const n=t.getImpl(),i=e.getImpl();return!new ee(n,i,s,!0).next()||!He(t,e,s)}(t,e,s);case 2:return Ce(e,t,s,o);case 128:return we(e,t,s,o);case 1:return Ce(t,e,s,o);case 64:return we(t,e,s,o);case 3:return function(t,e,s,i){const r=n.Envelope2D.constructEmpty(),o=n.Envelope2D.constructEmpty();if(t.queryEnvelope(r),e.queryEnvelope(o),!Re(r,o,s))return!1;if(ae(t,e),qe(t,e,s))return!0;if(t.hasNonLinearSegments()||e.hasNonLinearSegments())return qt(t,e,s,"**F**FFF*",i,!1);return Ye(t,e,s,!1)}(t,e,s,o);case 8:return function(t,e,s,i){ae(t,e);const o=[],a=Xe(t,e,s,o);if(-2===a){const r=n.Envelope2D.constructEmpty(),o=n.Envelope2D.constructEmpty(),a=n.Envelope2D.constructEmpty();let l,h;if(t.queryEnvelope(r),e.queryEnvelope(o),r.inflateCoords(1e3*s,1e3*s),o.inflateCoords(1e3*s,1e3*s),a.setCoords({env2D:r}),a.intersect(o),t.getPointCount()>10){if(l=(0,u.c)(t,a,s,0,i),l.isEmpty())return!1}else l=t;if(e.getPointCount()>10){if(h=(0,u.c)(e,a,s,0,i),h.isEmpty())return!1}else h=e;return qt(l,h,s,"F********",i,!1)}if(0!==a)return!1;const l=new r.M;for(let n=0;n<o.length;n+=2){const t=o[n],e=o[n+1];l.addXY(t,e)}const h=t.getBoundary(),c=e.getBoundary();return h.addPoints(c,0,c.getPointCount()),!h.isEmpty()&&Te(h,l,s)}(t,e,s,o);case 32:return function(t,e,s,i){ae(t,e);const r=n.Envelope2D.constructEmpty(),o=n.Envelope2D.constructEmpty();t.queryEnvelope(r),e.queryEnvelope(o);const a=Oe(r,o,s),l=Oe(o,r,s),h=t.hasNonLinearSegments(),c=e.hasNonLinearSegments(),m=Xe(t,e,s,null);if(-1===m)return!1;if(1===m){if(a&&l)return!0;if(!h&&!c)return a&&!l?!Ue(e,t,s,!1):l&&!a?!Ue(t,e,s,!1):!Ue(t,e,s,!1)&&!Ue(e,t,s,!1)}const d=n.Envelope2D.constructEmpty(),g=n.Envelope2D.constructEmpty(),p=n.Envelope2D.constructEmpty();let _,f;d.setCoords({env2D:r}),d.inflateCoords(1e3*s,1e3*s),g.setCoords({env2D:o}),g.inflateCoords(1e3*s,1e3*s),p.setCoords({env2D:d}),p.intersect(g);let y="";if(y+="1*",a){if(e.getPointCount()>10){if(f=(0,u.c)(e,p,s,0,i),f.isEmpty())return!1}else f=e;y+="****"}else f=e,y+="T***";if(l){if(t.getPointCount()>10){if(_=(0,u.c)(t,p,s,0,i),_.isEmpty())return!1}else _=t;y+="***"}else _=t,y+="T**";return qt(_,f,s,y,i,!1)}(t,e,s,o);case 16:return function(t,e,s,i){ae(t,e);const o=[],a=Xe(t,e,s,o);if(-2===a){const r=n.Envelope2D.constructEmpty(),o=n.Envelope2D.constructEmpty(),a=n.Envelope2D.constructEmpty();let l,h;if(t.queryEnvelope(r),e.queryEnvelope(o),r.inflateCoords(1e3*s,1e3*s),o.inflateCoords(1e3*s,1e3*s),a.setCoords({env2D:r}),a.intersect(o),t.getPointCount()>10){if(l=(0,u.c)(t,a,s,0,i),l.isEmpty())return!1}else l=t;if(e.getPointCount()>10){if(h=(0,u.c)(e,a,s,0,i),h.isEmpty())return!1}else h=e;return qt(l,h,s,"0********",i,!1)}if(0!==a)return!1;const l=new r.M;for(let n=0;n<o.length;n+=2){const t=o[n],e=o[n+1];l.addXY(t,e)}const h=t.getBoundary(),c=e.getBoundary();return h.addPoints(c,0,c.getPointCount()),!!h.isEmpty()||!Te(h,l,s)}(t,e,s,o)}return!1}(x,v,p,l,h);break;case i.G.enumPoint:_=de(x,v,p,l);break;case i.G.enumMultiPoint:_=ge(x,v,p,l);break;case i.G.enumEnvelope:_=pe(x,v,p,l,h)}break;case i.G.enumPoint:switch(m){case i.G.enumPolygon:_=ue(v,x,p,l);break;case i.G.enumPolyline:_=de(v,x,p,l);break;case i.G.enumMultiPoint:_=_e(v,x,p,l)}break;case i.G.enumMultiPoint:switch(m){case i.G.enumPolygon:_=ce(v,x,p,l);break;case i.G.enumPolyline:_=ge(v,x,p,l);break;case i.G.enumMultiPoint:_=function(t,e,s,i){switch(i){case 4:return function(t,e,s){const n=t,i=e,r=new ee(n,i,s,!1),o=s*s,l=new a.P,h=new a.P;for(;r.next();){const t=r.getRedElement(),e=r.getBlueElement();if(n.queryXY(t,l),i.queryXY(e,h),a.P.sqrDistance(l,h)<=o)return!1}return!0}(t,e,s);case 2:case 128:return Te(e,t,s);case 1:case 64:return Te(t,e,s);case 3:return function(t,e,s){const i=n.Envelope2D.constructEmpty(),r=n.Envelope2D.constructEmpty();return t.queryEnvelope(i),e.queryEnvelope(r),!!Re(i,r,s)&&(!!function(t,e,s){if(t.getPointCount()!==e.getPointCount())return!1;const n=new a.P,i=new a.P;let r=!0;const o=s*s;for(let l=0;l<t.getPointCount();l++)if(t.queryXY(l,n),e.queryXY(l,i),a.P.sqrDistance(n,i)>o){r=!1;break}return!!r}(t,e,s)||Be(t,e,s,!1,!0,!1))}(t,e,s);case 32:return function(t,e,s){return Be(t,e,s,!1,!1,!0)}(t,e,s)}return!1}(x,v,p,l);break;case i.G.enumPoint:_=_e(x,v,p,l);break;case i.G.enumEnvelope:_=fe(x,v,p,l)}break;case i.G.enumEnvelope:switch(m){case i.G.enumPolygon:_=me(v,x,p,l,h);break;case i.G.enumPolyline:_=pe(v,x,p,l,h);break;case i.G.enumMultiPoint:_=fe(v,x,p,l)}}return _}function re(t,e,s,i,r){if(t.isEmpty()||e.isEmpty())return 4===i;const a=t.getXY(),l=n.Envelope2D.constructEmpty();e.queryEnvelope(l);const h=function(t,e,s){let i;if(t instanceof So||null===t){const r=n.Envelope2D.constructEmpty();r.setCoords({pt:e}),r.mergeEnvelope2D(s),i=(0,o.a)(t,r,!1)}else i=t;return i}(s,a,l);switch(i){case 4:return le(a,l,h);case 2:case 128:return function(t,e,s){if(e.height()<=s||e.width()<=s)return!1;const i=n.Envelope2D.constructEmpty();return i.setCoords({env2D:e}),i.inflateCoords(-s,-s),i.containsExclusive(t)}(a,l,h);case 1:case 64:return!1;case 3:return function(t,e,s){const i=new n.Envelope2D;return i.setCoords({pt:t}),Re(i,e,s)}(a,l,h);case 8:return function(t,e,s){if(e.height()<=s||e.width()<=s)return!1;const i=new n.Envelope2D,r=new n.Envelope2D;return i.setCoords({env2D:e}),i.inflateCoords(s,s),!!i.contains(t)&&(r.setCoords({env2D:e}),r.inflateCoords(-s,-s),!r.containsExclusive(t))}(a,l,h)}return!1}function oe(t,e,s){const i=n.Envelope2D.constructEmpty();return i.setCoords({env2D:e}),i.inflateCoords(s,s),!t.isIntersecting(i)}function ae(t,e,s,n=!1){const r=t.getGeometryType(),o=e.getGeometryType();if((0,i.i)(r)){const e=t.getImpl().getAccelerators();if(null!==e){const t=e.getRasterizedGeometry();(0,i.g)(null===t)}}if((0,i.i)(o)){const t=e.getImpl().getAccelerators();if(null!==t){const e=t.getRasterizedGeometry();(0,i.g)(null===e)}}return 0}function le(t,e,s,i){const r=n.Envelope2D.constructEmpty();return r.setCoords({env2D:e}),r.inflateCoords(s,s),!r.contains(t)}function he(t,e,s,i,l){switch(i){case 4:return function(t,e,s){return ae(t,e,0,!0),1===Le(t,e,s,!0)}(t,e,s);case 1:return function(t,e,s,i){const a=n.Envelope2D.constructEmpty(),l=n.Envelope2D.constructEmpty();return t.queryEnvelope(a),e.queryEnvelope(l),!!Ve(a,l,s)&&(ae(t,e),function(t,e,s,i){const a=[!1],l=Ge(t,e,s,a);if(a[0])return l;const h=n.Envelope2D.constructEmpty();let c;if(e.queryEnvelope(h),h.inflateCoords(1e3*s,1e3*s),t.getPointCount()>10){if(c=(0,u.c)(t,h,s,0,i),c.isEmpty())return!1}else c=t;return function(t,e,s,i){const a=new Kt;a.resetMatrix_(),a.setPredicates_("T*****F**"),a.setAreaLinePredicates_();const l=n.Envelope2D.constructEmpty(),h=n.Envelope2D.constructEmpty();t.queryEnvelope(l),e.queryEnvelope(h);let u=!1;if(oe(l,h,s)&&(a.areaLineDisjointPredicates_(t,e),u=!0),u||ae(t,e),u)return Wt(a.m_matrix,a.m_scl);const c=new r.E,m=c.addGeometry(t),d=c.addGeometry(e);return a.setEditShapeCrackAndCluster_(c,new o.C(s,0),i),0!==c.getPointCount(m)&&(a.computeMatrixTopoGraphHalfEdges_(m,d),a.m_topoGraph.removeShape(),Wt(a.m_matrix,a.m_scl))}(c,e,s,i)}(t,e,s,i))}(t,e,s,l);case 64:return function(t,e,s){const i=n.Envelope2D.constructEmpty(),r=n.Envelope2D.constructEmpty();return t.queryEnvelope(i),e.queryEnvelope(r),!!Ve(i,r,s)&&(ae(t,e),2===Le(t,e,s,!1))}(t,e,s);case 8:return be(t,e,s,l);case 16:return function(t,e,s){return ae(t,e),function(t,e,s,i){const r=t.getImpl(),o=e.getImpl(),l=r.querySegmentIterator(),h=o.querySegmentIterator(),c=(0,a.d)(2,Number.NaN),m=(0,a.d)(2,Number.NaN),d=new ee(r,o,s);let g=!1;for(;d.next();){const t=d.getRedElement(),e=d.getBlueElement();l.resetToVertex(t,-1),h.resetToVertex(e,-1);const n=l.nextSegment(),i=h.nextSegment();let r=0;if(es(n,i)?!g&&i.isIntersecting(n,s)&&(g=!0):r=i.intersect(n,null,m,c,s),2===r)g=!0;else if(r){const t=c[0],e=m[0];if(t>0&&t<1&&e>0&&e<1)return!0;g=!0}}if(!g)return!1;const p=n.Envelope2D.constructEmpty(),_=n.Envelope2D.constructEmpty(),f=n.Envelope2D.constructEmpty(),y=n.Envelope2D.constructEmpty(),x=n.Envelope2D.constructEmpty();if(t.queryEnvelope(p),e.queryEnvelope(_),Oe(_,p,s)){let n,r;if(f.setCoords({env2D:p}),f.inflateCoords(1e3*s,1e3*s),y.setCoords({env2D:_}),y.inflateCoords(1e3*s,1e3*s),x.setCoords({env2D:f}),x.intersect(y),t.getPointCount()>10){if(n=(0,u.c)(t,x,s,0,i),n.isEmpty())return!1}else n=t;if(e.getPointCount()>10){if(r=(0,u.c)(e,x,s,0,i),r.isEmpty())return!1}else r=e;return qt(n,r,s,"T********",i,!1)}return qt(t,e,s,"T*****T**",i,!1)}(t,e,s,null)}(t,e,s)}return!1}function ue(t,e,s,n,i){switch(n){case 4:return function(t,e,s){return 0===is(t,e,s)}(t,e,s);case 1:case 64:return function(t,e,s){return function(t,e,s){return 1===rs(t,e,s)}(t,e.getXY(),s)}(t,e,s);case 8:return function(t,e,s){return function(t,e,s){return 2===rs(t,e,s)}(t,e.getXY(),s)}(t,e,s)}return!1}function ce(t,e,s,i,o){switch(i){case 4:return function(t,e,s){return ae(t,e),1===function(t,e,s){const i=n.Envelope2D.constructEmpty();t.queryEnvelope(i),i.inflateCoords(s,s);const o=new a.P,l=t.getImpl(),h=new r.a;let u=t,c=!1,m=!1,d=!1;for(let n=0;n<e.getPointCount();n++){if(e.queryXY(n,o),i.contains(o)){const t=rs(u,o,s);if(1===t)return m=!0,4;if(2===t)return 4;d=!0}else d=!0;c||(!Ft(t,e.getPointCount()-1)||null!==l.getAccelerators()&&null!=l.getAccelerators().getQuadTree()?u=t:(t.copyTo(h),h.getImpl().buildQuadTreeAccelerator(1),u=h),c=!0)}return m?d?4:2:1}(t,e,s)}(t,e,s);case 1:return Pe(t,e,s,!1);case 64:return Pe(t,e,s,!0);case 8:return function(t,e,s){ae(t,e);const i=n.Envelope2D.constructEmpty();t.queryEnvelope(i),i.inflateCoords(s,s);const o=new a.P;let l=!1;const h=t.getImpl(),u=new r.a;let c=t,m=!1;for(let n=0;n<e.getPointCount();n++){if(e.queryXY(n,o),i.contains(o)){const t=rs(c,o,s);if(2===t)l=!0;else if(1===t)return!1}m||(!Ft(t,e.getPointCount()-1)||null!==h.getAccelerators()&&null!==h.getAccelerators().getQuadTree()?c=t:(t.copyTo(u),u.getImpl().buildQuadTreeAccelerator(1),c=u),m=!0)}return!!l}(t,e,s);case 16:return function(t,e,s){ae(t,e);const i=new n.Envelope2D,o=new n.Envelope2D,l=new n.Envelope2D;t.queryEnvelope(i),e.queryEnvelope(l),o.setCoords({env2D:i}),o.inflateCoords(s,s);let h=!1,u=!1;const c=new a.P,m=t.getImpl(),d=new r.a;let g=t,p=!1;for(let n=0;n<e.getPointCount();n++){if(e.queryXY(n,c),o.contains(c)){const t=rs(g,c,s);0===t?u=!0:1===t&&(h=!0)}else u=!0;if(h&&u)return!0;p||(!Ft(t,e.getPointCount()-1)||null!==m.getAccelerators()&&null!==m.getAccelerators().getQuadTree()?g=t:(t.copyTo(d),d.getImpl().buildQuadTreeAccelerator(1),g=d),p=!0)}return!1}(t,e,s)}return!1}function me(t,e,s,i,o){if(function(t,e,s){ae(t,e);const i=n.Envelope2D.constructEmpty(),r=n.Envelope2D.constructEmpty();return t.queryEnvelope(i),e.queryEnvelope(r),!Ve(r,i,s)&&(0===rs(t,r.getLowerLeft(),0)&&!r.contains(t.getXY(0))&&!We(t,r,s))}(t,e,s))return 4===i;if(4===i)return!1;switch(i){case 2:return Se(t,e,s,!1);case 128:return Se(t,e,s,!0);case 1:return Ee(t,e,s,!1,o);case 64:return Ee(t,e,s,!0,o);case 3:return function(t,e,s,i){const o=new n.Envelope2D,a=new n.Envelope2D;if(t.queryEnvelope(o),e.queryEnvelope(a),!Re(o,a,s))return!1;const l=new r.a;return l.addEnvelope(e,!1),ye(t,l,s,i)}(t,e,s,o);case 8:return function(t,e,s,i){ae(t,e);const o=new n.Envelope2D,a=new n.Envelope2D;if(t.queryEnvelope(o),e.queryEnvelope(a),Ve(a,o,s))return!1;if(a.height()<=s||a.width()<=s)return!1;const l=new r.a;return l.addEnvelope(e,!1),$e(t,l,s,i)}(t,e,s,o);case 32:return function(t,e,s,i){ae(t,e);const o=new n.Envelope2D,a=new n.Envelope2D;if(t.queryEnvelope(o),e.queryEnvelope(a),Ve(a,o,s))return!1;if(a.height()<=s||a.width()<=s)return!1;const l=new r.a;return l.addEnvelope(e,!1),Ke(t,l,s,i)}(t,e,s,o);case 16:return!1}return!1}function de(t,e,s,n,i){switch(n){case 4:return function(t,e,s){return ae(t,e),!Ze(t,e.getXY(),s)}(t,e,s);case 1:case 64:return function(t,e,s){return ae(t,e),function(t,e,s){return Ze(t,e,s)&&!ts(t,e,s)}(t,e.getXY(),s)}(t,e,s);case 8:return function(t,e,s){return ae(t,e),ts(t,e.getXY(),s)}(t,e,s)}return!1}function ge(t,e,s,i,o){switch(i){case 4:return function(t,e,s){return ae(t,e),!je(t,e,s,!1)}(t,e,s);case 1:case 64:return function(t,e,s){const i=n.Envelope2D.constructEmpty(),r=n.Envelope2D.constructEmpty();if(t.queryEnvelope(i),e.queryEnvelope(r),!Ve(i,r,s))return!1;ae(t,e);const o=je(t,e,s,!0);if(!o)return o;const a=t.getBoundary();return a.isEmpty()?o:!Te(a,e,s)}(t,e,s);case 8:return function(t,e,s){ae(t,e);const n=t.getImpl(),i=e.getImpl(),o=new r.M,a=new ee(n,i,s,!1),l=n.querySegmentIterator();let h=!1;for(;a.next();){const t=a.getRedElement(),e=a.getBlueElement();l.resetToVertex(t,-1);const n=l.nextSegment(),r=i.getXY(e);n.isIntersectingPoint(r,s)&&(h=!0,o.addPoint2D(r))}if(!h)return!1;const u=t.getBoundary();return!u.isEmpty()&&Te(u,o,s)}(t,e,s);case 16:return function(t,e,s){ae(t,e);const n=t.getImpl(),i=e.getImpl(),o=i.getPointCount(),l=(0,a.d)(o,!1),h=new ee(n,i,s,!1),u=n.querySegmentIterator();let c=!1;for(;h.next();){const t=h.getRedElement(),e=h.getBlueElement();u.resetToVertex(t,-1);const n=u.nextSegment(),r=i.getXY(e);n.isIntersectingPoint(r,s)&&(c=!0,l[e]=!0)}if(!c)return!1;let m=!1;for(let r=0;r<o;r++)if(!l[r]){m=!0;break}if(!m)return!1;const d=t.getBoundary();if(d.isEmpty())return!0;const g=new r.M;for(let r=0;r<o;r++)l[r]&&g.addPoint2D(i.getXY(r));return!Te(d,g,s)}(t,e,s)}return!1}function pe(t,e,s,o,l){if(function(t,e,s){const i=n.Envelope2D.constructEmpty(),r=n.Envelope2D.constructEmpty();t.queryEnvelope(i),e.queryEnvelope(r);const o=function(t,e,s){const i=n.Envelope2D.constructEmpty();return i.setCoords({env2D:t}),i.inflateCoords(s,s),i.containsEnvelope(e)?1073741824:i.isIntersecting(e)?t.isIntersecting(e)?t.xmin<e.xmin&&e.xmax<t.xmax?e.ymin<t.ymin&&e.ymax>t.ymax?0:1073741824:t.ymin<e.ymin&&e.ymax<t.ymax?e.xmin<t.xmin&&e.xmax>t.xmax?0:1073741824:0:0:4}(r,i,s);return 0===o?!We(t,r,s):4===o}(t,e,s))return 4===o;if(4===o)return!1;switch(o){case 2:return Ie(t,e,s,!1);case 128:return Ie(t,e,s,!0);case 1:case 64:case 32:return!1;case 3:return function(t,e,s){const i=new n.Envelope2D,r=new n.Envelope2D;return t.queryEnvelope(i),e.queryEnvelope(r),!(r.height()>s&&r.width()>s)&&Re(i,r,s)}(t,e,s);case 8:return function(t,e,s,o){const l=new n.Envelope2D,h=new n.Envelope2D;if(t.queryEnvelope(l),e.queryEnvelope(h),h.height()<=s||h.width()<=s)return!1;const u=new n.Envelope2D,c=new n.Envelope2D;if(u.setCoords({env2D:h}),c.setCoords({env2D:h}),u.inflateCoords(s,s),c.inflateCoords(-s,-s),c.containsEnvelope(l)||!l.isIntersecting(u))return!1;const m=t.getImpl().querySegmentIterator();m.stripAttributes();const d=t.getImpl().getAccelerators();let g=null,p=null;null!==d&&(g=d.getQuadTree(),null!==g&&(p=g.getIterator(h,s))),p||m.nextPath()||(0,i.d)("relational_operations");let _=!1,f=null;const y=new a.P,x=new a.P,v=t.hasNonLinearSegments();let b=!1;for(;;){if(null!==p){const t=p.next();if(-1===t)break;m.resetToVertex(g.getElement(t),-1),f=m.nextSegment()}else{for(;!m.hasNextSegment()&&m.nextPath(););if(!m.hasNextSegment())break;f=m.nextSegment()}if(v&&f.getGeometryType()!==i.G.enumLine){const t=new n.Envelope2D;if(f.queryEnvelope(t),c.containsEnvelope(t))return!1;if(u.isIntersecting(t)){b=!0;break}}else{y.assign(f.getStartXY()),x.assign(f.getEndXY());let t=c.clipLine(y,x);if(0!==t)return!1;_||(t=u.clipLine(y,x),0!==t&&(_=!0))}}if(!b)return _;const P=new r.a;return P.addEnvelope(h,!1),be(P,t,s,o)}(t,e,s,l);case 16:return function(t,e,s){const o=new n.Envelope2D,l=new n.Envelope2D;if(t.queryEnvelope(o),e.queryEnvelope(l),l.height()<=s||l.width()<=s)return!1;const h=new n.Envelope2D;if(h.setCoords({env2D:l}),h.inflateCoords(s,s),h.containsEnvelope(o))return!1;const u=!0,c=new n.Envelope2D;if(c.setCoords({env2D:l}),c.inflateCoords(-s,-s),!c.isIntersecting(o))return!1;const m=t.getImpl().querySegmentIterator();m.stripAttributes();const d=t.getImpl().getAccelerators();let g=null,p=null;if(null!==d&&(g=d.getQuadTree(),null!==g&&(p=g.getIterator(l,s))),!p){const t=m.nextPath();(0,i.g)(t)}let _=!1,f=null;const y=new a.P,x=new a.P;let v=null,b=null,P=null,S=null;for(t.hasNonLinearSegments()&&(v=new r.L,b=new r.L,P=new r.L,S=new r.L,c.querySide(0,v),c.querySide(1,b),c.querySide(2,P),c.querySide(3,S));;){if(null!==p){const t=p.next();if(-1===t)break;m.resetToVertex(g.getElement(t),-1),f=m.nextSegment()}else{for(;!m.hasNextSegment()&&m.nextPath(););if(!m.hasNextSegment())break;f=m.nextSegment()}if(f.getGeometryType()===i.G.enumLine){if(y.assign(f.getStartXY()),x.assign(f.getEndXY()),0!==c.clipLine(y,x)){_=!0;break}}else{if(v.isIntersecting(f,s)){_=!0;break}if(b.isIntersecting(f,s)){_=!0;break}if(P.isIntersecting(f,s)){_=!0;break}if(S.isIntersecting(f,s)){_=!0;break}}}return _&&u}(t,e,s)}return!1}function _e(t,e,s,n,i){switch(n){case 4:return Me(t,e,s);case 2:case 128:return function(t,e,s){return Ae(t,e,s)}(t,e,s);case 1:case 64:return function(t,e,s){return!Me(t,e,s)}(t,e,s);case 3:return Ae(t,e,s)}return!1}function fe(t,e,s,i,r){switch(i){case 4:return function(t,e,s){const i=n.Envelope2D.constructEmpty(),r=n.Envelope2D.constructEmpty();if(t.queryEnvelope(i),e.queryEnvelope(r),Ve(r,i,s))return!1;const o=n.Envelope2D.constructEmpty();o.setCoords({env2D:r}),o.inflateCoords(s,s);const l=new a.P;for(let n=0;n<t.getPointCount();n++)if(t.queryXY(n,l),o.contains(l))return!1;return!0}(t,e,s);case 2:return De(t,e,s,!1);case 128:return De(t,e,s,!0);case 1:case 64:return!1;case 3:return function(t,e,s){const i=new n.Envelope2D,r=new n.Envelope2D;return t.queryEnvelope(i),e.queryEnvelope(r),!(r.height()>s||r.width()>s)&&Re(i,r,s)}(t,e,s);case 8:return function(t,e,s){const i=new n.Envelope2D,r=new n.Envelope2D,o=new n.Envelope2D;if(e.queryEnvelope(i),i.height()<=s||i.width()<=s)return!1;r.setCoords({env2D:i}),o.setCoords({env2D:i}),r.inflateCoords(s,s),o.inflateCoords(-s,-s);const l=new a.P;let h=!1;for(let n=0;n<t.getPointCount();n++)if(t.queryXY(n,l),r.contains(l)){if(o.containsExclusive(l))return!1;h=!0}return h}(t,e,s);case 16:return function(t,e,s){const i=new n.Envelope2D,r=new n.Envelope2D;if(t.queryEnvelope(i),e.queryEnvelope(r),Ve(r,i,s))return!1;if(r.height()<=s||r.width()<=s)return!1;const o=new n.Envelope2D,l=new n.Envelope2D;o.setCoords({env2D:r}),o.inflateCoords(-s,-s),l.setCoords({env2D:r}),l.inflateCoords(s,s);const h=new a.P;let u=!1,c=!1;for(let n=0;n<t.getPointCount();n++)if(t.queryXY(n,h),!u&&o.containsExclusive(h)&&(u=!0),c||l.contains(h)||(c=!0),u&&c)return!0;return!1}(t,e,s)}return!1}function ye(t,e,s,i){const r=n.Envelope2D.constructEmpty(),o=n.Envelope2D.constructEmpty();if(t.queryEnvelope(r),e.queryEnvelope(o),!Re(r,o,s))return!1;if(ae(t,e),qe(t,e,s))return!0;const a=t.calculateLength2D(),l=e.calculateLength2D(),h=Math.max(t.getPointCount(),e.getPointCount());return!(Math.abs(a-l)>4*h*s)&&(t.hasNonLinearSegments()||e.hasNonLinearSegments()?qt(t,e,s,"**F**FFF*",i,!1):Ye(t,e,s,!0))}function xe(t,e,s,i){const r=n.Envelope2D.constructEmpty(),o=n.Envelope2D.constructEmpty();return t.queryEnvelope(r),e.queryEnvelope(o),!!Ve(r,o,s)&&(ae(t,e),Qe(t,e,s,i))}function ve(t,e,s,i){const r=n.Envelope2D.constructEmpty(),o=n.Envelope2D.constructEmpty();return t.queryEnvelope(r),e.queryEnvelope(o),!!Ve(r,o,s)&&(ae(t,e),2===Le(t,e,s,!1))}function be(t,e,s,i){return ae(t,e),function(t,e,s,i){const r=t.getImpl(),o=e.getImpl(),l=r.querySegmentIterator(),h=o.querySegmentIterator(),c=(0,a.d)(2,Number.NaN),m=(0,a.d)(2,Number.NaN),d=new ee(r,o,s);let g=!1;for(;d.next();){const t=d.getRedElement(),e=d.getBlueElement();l.resetToVertex(t,-1),h.resetToVertex(e,-1);const n=l.nextSegment(),i=h.nextSegment();let r=0;if(es(n,i)?!g&&i.isIntersecting(n,s)&&(g=!0):r=i.intersect(n,null,m,c,s),2===r)g=!0;else if(r){const t=c[0],e=m[0];if(t>0&&t<1&&e>0&&e<1)return!1;g=!0}}if(!g)return!1;const p=n.Envelope2D.constructEmpty(),_=n.Envelope2D.constructEmpty(),f=n.Envelope2D.constructEmpty();let y,x;if(t.queryEnvelope(p),e.queryEnvelope(_),p.inflateCoords(1e3*s,1e3*s),_.inflateCoords(1e3*s,1e3*s),f.setCoords({env2D:p}),f.intersect(_),t.getPointCount()>10){if(y=(0,u.c)(t,f,s,0,i),y.isEmpty())return!1}else y=t;if(e.getPointCount()>10){if(x=(0,u.c)(e,f,s,0,i),x.isEmpty())return!1}else x=e;return qt(y,x,s,"F********",i,!1)}(t,e,s,i)}function Pe(t,e,s,i,o){const l=n.Envelope2D.constructEmpty(),h=n.Envelope2D.constructEmpty();if(t.queryEnvelope(l),e.queryEnvelope(h),!Ve(l,h,s))return!1;ae(t,e);let u=!1;const c=new a.P,m=t.getImpl(),d=new r.a;let g=t,p=!1;for(let n=0;n<e.getPointCount();n++){if(e.queryXY(n,c),!l.contains(c))return!1;const r=rs(g,c,s);if(1===r)u=!0;else if(0===r)return!1;if(i&&2===r)return!1;p||(!Ft(t,e.getPointCount()-1)||null!==m.getAccelerators()&&null!==m.getAccelerators().getQuadTree()?g=t:(t.copyTo(d),d.getImpl().buildQuadTreeAccelerator(1),g=d),p=!0)}return u}function Se(t,e,s,i,r){const o=n.Envelope2D.constructEmpty(),a=n.Envelope2D.constructEmpty();return t.queryEnvelope(o),e.queryEnvelope(a),i?ze(a,o,s):Ve(a,o,s)}function Ee(t,e,s,i,o){const a=n.Envelope2D.constructEmpty(),l=n.Envelope2D.constructEmpty();if(t.queryEnvelope(a),e.queryEnvelope(l),!Ve(a,l,s))return!1;ae(t,e);const h=new r.a;return h.addEnvelope(e,!1),i?2===Le(t,h,s,!1):Qe(t,h,s,o)}function Ce(t,e,s,i){const r=n.Envelope2D.constructEmpty(),o=n.Envelope2D.constructEmpty();return t.queryEnvelope(r),e.queryEnvelope(o),!!Ve(r,o,s)&&(ae(t,e),t.hasNonLinearSegments()||e.hasNonLinearSegments()?qt(t,e,s,"******FF*",i,!1):Ue(e,t,s,!1))}function we(t,e,s,i){const r=n.Envelope2D.constructEmpty(),o=n.Envelope2D.constructEmpty();return t.queryEnvelope(r),e.queryEnvelope(o),!!Ve(r,o,s)&&(ae(t,e),qt(t,e,s,"T**FF*FF*",i,!1))}function Ie(t,e,s,o,a){const l=n.Envelope2D.constructEmpty(),h=n.Envelope2D.constructEmpty();if(t.queryEnvelope(l),e.queryEnvelope(h),h.height()<=s||h.width()<=s)return!1;if(o)return ze(h,l,s);if(!Ve(h,l,s))return!1;const u=n.Envelope2D.constructEmpty();u.setCoords({env2D:h}),u.inflateCoords(-s,-s);const c=n.Envelope2D.constructEmpty();if(c.setCoords({env2D:h}),c.inflateCoords(s,s),u.containsEnvelope(l))return!0;const m=t.getImpl().querySegmentIterator();m.stripAttributes(),m.nextPath()||(0,i.d)("relational_operations");let d,g,p,_,f,y,x=!1;const v=t.hasNonLinearSegments();for(v&&(p=new r.L,_=new r.L,f=new r.L,y=new r.L,u.querySide(0,p),u.querySide(1,_),u.querySide(2,f),u.querySide(3,y));;){for(;!m.hasNextSegment()&&m.nextPath(););if(!m.hasNextSegment())break;const t=m.nextSegment();if(v&&t.getGeometryType()!==i.G.enumLine){if(t.isIntersecting(p,s)){x=!0;break}if(t.isIntersecting(_,s)){x=!0;break}if(t.isIntersecting(f,s)){x=!0;break}if(t.isIntersecting(y,s)){x=!0;break}}else if(d=t.getStartXY(),g=t.getEndXY(),0!==u.clipLine(d,g)){x=!0;break}}return x}function Te(t,e,s,i){const r=n.Envelope2D.constructEmpty(),o=n.Envelope2D.constructEmpty();return t.queryEnvelope(r),e.queryEnvelope(o),!!Ve(r,o,s)&&Be(e,t,s,!0,!1,!1)}function Ae(t,e,s,i){const r=n.Envelope2D.constructEmpty(),o=n.Envelope2D.constructEmpty();return t.queryEnvelope(r),e.queryEnvelope(o),Re(r,o,s)}function Me(t,e,s,n){return Je(t,e.getXY(),s)}function De(t,e,s,i,r){const o=n.Envelope2D.constructEmpty(),l=n.Envelope2D.constructEmpty();if(t.queryEnvelope(o),e.queryEnvelope(l),l.height()<=s||l.width()<=s)return!1;if(i)return ze(l,o,s);if(!Ve(l,o,s))return!1;let h=!1;const u=n.Envelope2D.constructEmpty(),c=n.Envelope2D.constructEmpty();u.setCoords({env2D:l}),c.setCoords({env2D:l}),u.inflateCoords(-s,-s),c.inflateCoords(s,s);const m=new a.P;for(let n=0;n<t.getPointCount();n++){if(t.queryXY(n,m),!c.contains(m))return!1;u.containsExclusive(m)&&(h=!0)}return h}function Ne(t,e,s,n){return a.P.sqrDistance(t,e)<=s*s}function Fe(t,e,s,n){return Ne(t,e,s)}function Re(t,e,s,n){return Ve(t,e,s)&&Ve(e,t,s)}function ke(t,e,s,i,r){if(t.height()<=s||t.width()<=s)return!1;if(i)return ze(t,e,s);if(!Ve(t,e,s))return!1;const o=n.Envelope2D.constructEmpty();return o.setCoords({env2D:t}),o.inflateCoords(-s,-s),o.intersect(e),!o.isEmpty()}function Le(t,e,s,o,l){const h=new a.P,u=new a.P,c=n.Envelope2D.constructEmpty(),m=n.Envelope2D.constructEmpty(),d=t.getImpl(),g=e.getImpl(),p=g.getGeometryType(),_=new ee(d,g,s,!0);if(!_.next())return 1;if(He(t,e,s))return o?4:0;const f=new r.a;let y=t;const x=new r.a;let v=null;p===i.G.enumPolygon&&(v=e);const b=p===i.G.enumPolygon?(0,a.d)(d.getPathCount(),!1):[],P=(0,a.d)(g.getPathCount(),!1);let S=!1,E=!1,C=!1,w=!1,I=!1,T=!1;do{if(C&&I||w&&T)break;if(C&&w)break;const n=_.getRedElement(),r=_.getBlueElement();if(!P[r]&&(u.assign(e.getXY(e.getPathStart(r))),c.setCoords({env2D:_.getRedEnvelope()}),c.inflateCoords(s,s),c.contains(u))){if(0!==rs(y,u,0)){if(w=!0,o)return 4}else T=!0;P[r]=!0}if(p===i.G.enumPolygon&&!b[n]&&(h.assign(t.getXY(t.getPathStart(n))),m.setCoords({env2D:_.getBlueEnvelope()}),m.inflateCoords(s,s),m.contains(h))){if(0!==rs(v,h,0)){if(C=!0,o)return 4}else I=!0;b[n]=!0}if(S||(!Ft(t,e.getPathCount()-1)||null!==d.getAccelerators()&&null!==d.getAccelerators().getQuadTree()?y=t:(t.copyTo(f),f.getImpl().buildQuadTreeAccelerator(1),y=f),S=!0),p===i.G.enumPolygon&&!E){const s=e;!Ft(s,t.getPathCount()-1)||null!==g.getAccelerators()&&null!==g.getAccelerators().getQuadTree()?v=e:(s.copyTo(x),x.getImpl().buildQuadTreeAccelerator(1),v=x),E=!0}}while(_.next());if(!C&&!w)return 1;if(!I||!T){if(p===i.G.enumPolygon)for(let t=0,e=d.getPathCount();t<e;t++)if(!b[t]){I=!0;break}for(let t=0,e=g.getPathCount();t<e;t++)if(!P[t]){T=!0;break}}return C&&I||w&&T||C&&w?4:w?2:3}function Ge(t,e,s,o,a){o[0]=!1;const l=t.getImpl(),h=e.getImpl(),u=l.querySegmentIterator(),c=h.querySegmentIterator(),m=[0,0],d=[0,0],g=new ee(l,h,s);let p=!1;for(;g.next();){const t=g.getRedElement(),e=g.getBlueElement();u.resetToVertex(t,-1),c.resetToVertex(e,-1);const n=u.nextSegment(),i=c.nextSegment();let r=0;if(es(n,i)?!p&&i.isIntersecting(n,s)&&(p=!0):r=i.intersect(n,null,d,m,s),0!==r&&(p=!0,1===r)){const t=m[0],e=d[0];if(t>0&&t<1&&e>0&&e<1)return o[0]=!0,!1}}if(!p){o[0]=!0;const a=n.Envelope2D.constructEmpty();t.queryEnvelope(a),a.inflateCoords(s,s);const u=new r.a;let c=t,m=!1;for(let s=0,r=e.getPathCount();s<r;s++)if(e.getPathSize(s)>0){const r=n.Envelope2D.constructEmpty();if(e.queryPathEnvelope(s,r),!a.isIntersecting(r))return!1;{const t=Nt(c,e.getXY(e.getPathStart(s)),0);if((0,i.g)(-1!==t),0===t)return!1}m||(!Ft(t,e.getPathCount()-1)||null!==l.getAccelerators()&&null!==l.getAccelerators().getQuadTree()?c=t:(t.copyTo(u),u.getImpl().buildQuadTreeAccelerator(1),c=u),m=!0)}if(1===t.getPathCount()||e.getGeometryType()===i.G.enumPolyline)return!0;const d=e,g=n.Envelope2D.constructEmpty();d.queryEnvelope(g),g.inflateCoords(s,s);const p=new r.a;let _=d,f=!1;for(let e=0,s=t.getPathCount();e<s;e++)if(t.getPathSize(e)>0){const s=n.Envelope2D.constructEmpty();if(t.queryPathEnvelope(e,s),g.isIntersecting(s)){const s=Nt(_,t.getXY(t.getPathStart(e)),0);if((0,i.g)(-1!==s),1===s)return!1}f||(!Ft(d,t.getPathCount()-1)||null!==h.getAccelerators()&&null!==h.getAccelerators().getQuadTree()?_=d:(d.copyTo(p),p.getImpl().buildQuadTreeAccelerator(1),_=p),f=!0)}return!0}return!1}function Ve(t,e,s){const i=n.Envelope2D.constructEmpty();return i.setCoords({env2D:t}),i.inflateCoords(s,s),i.containsEnvelope(e)}function ze(t,e,s){const i=n.Envelope2D.constructEmpty();return i.setCoords({env2D:e}),i.inflateCoords(s,s),t.containsExclusiveEnvelope(i)}function Oe(t,e,s){const i=n.Envelope2D.constructEmpty();return i.setCoords({env2D:e}),i.inflateCoords(s,s),!(i.contains(t.getLowerLeft())&&i.contains(t.getLowerRight())&&i.contains(t.getUpperLeft())&&i.contains(t.getUpperRight()))}function qe(t,e,s,n){if(t.getPathCount()!==e.getPathCount()||t.getPointCount()!==e.getPointCount())return!1;if(t.hasNonLinearSegments()||e.hasNonLinearSegments())return t.equals(e);const i=new a.P,r=new a.P;let o=!0;const l=s*s;for(let h=0;h<t.getPathCount();h++){if(t.getPathEnd(h)!==e.getPathEnd(h)){o=!1;break}for(let s=t.getPathStart(h);s<e.getPathEnd(h);s++)if(t.queryXY(s,i),e.queryXY(s,r),a.P.sqrDistance(i,r)>l){o=!1;break}if(!o)break}return!!o}function Be(t,e,s,n,i,r,o){const l=t.getImpl(),h=e.getImpl(),u=l.getPointCount(),c=h.getPointCount(),m=(0,a.d)(u,!1),d=i||r?(0,a.d)(c,!1):[],g=s*s,p=new ee(l,h,s);for(;p.next();){const t=p.getRedElement(),e=p.getBlueElement(),s=l.getXY(t),n=h.getXY(e);a.P.sqrDistance(s,n)<=g&&(m[t]=!0,(i||r)&&(d[e]=!0))}let _=!1,f=!1;for(let a=0;a<u;a++){const t=m[a];if(_||=!t,f||=t,(i||n)&&_)return!1}if(n)return!0;let y=!1,x=!1;for(let a=0;a<c;a++){const t=d[a];if(y||=!t,x||=t,i&&y)return!1}return!!i||_&&f&&y&&x}function Ye(t,e,s,n){return Ue(t,e,s,n)&&Ue(e,t,s,n)}function Ue(t,e,s,r){if((0,i.o)(t),(0,i.o)(e),e.isEmpty())return!1;let l=!0;const h=(0,a.d)(2,Number.NaN),u=(0,a.d)(2,Number.NaN),c=[],m=new ns;let d;const g=n.Envelope2D.constructEmpty(),p=n.Envelope2D.constructEmpty(),_=n.Envelope2D.constructEmpty();t.queryEnvelope(g),e.queryEnvelope(p),g.inflateCoords(s,s),p.inflateCoords(s,s),_.setCoords({env2D:g}),_.intersect(p);const f=t.getImpl().querySegmentIterator(),y=e.getImpl().querySegmentIterator(),x=e.getImpl().getAccelerators();let v=null,b=null,P=null,S=null;if(null!==x&&(v=x.getQuadTree(),b=x.getQuadTreeForPaths(),null!==b&&(S=b.getIteratorForQT())),null===v){const s=t.getPointCount(),n=e.getPointCount();s>10&&n>10&&(v=(0,o.F)(e.getImpl(),_))}for(null!==v&&(P=v.getIteratorForQT());f.nextPath();)for(;f.hasNextSegment();){let t=f.nextSegment();if(t.queryEnvelope(g),!g.isIntersecting(_))return l=!1,!1;if(null!==S&&(S.resetIterator(g,s),-1===S.next()))continue;let e=0,n=null;if(null!=P)P.resetIterator(t,s);else if(y.resetToFirstPath(),!y.nextPath())return l=!1,!1;do{if(e=0,null!==P){const i=P.next();if(-1===i)return l=!1,!1;y.resetToVertex(v.getElement(i),-1),n=y.nextSegment(),e=t.intersect(n,null,h,u,s)}else{for(;!y.hasNextSegment();)if(!y.nextPath())return l=!1,!1;n=y.nextSegment(),n.queryEnvelope(p),p.inflateCoords(s,s),g.isIntersecting(p)&&(e=t.intersect(n,null,h,u,s))}}while(2!==e||0!==h[0]||r&&!(u[0]<=u[1]));let a=Number.NaN,x=!1;do{let i=!1;if(1===h[1]){if(!f.hasNextSegment()){x=!0;break}t=f.nextSegment(),i=!0}if(1===u[1]&&u[0]<=u[1]){if(-1===a)break;if(a=1,!y.hasNextSegment())break;n=y.nextSegment(),i=!0}if(0===u[1]&&u[0]>u[1]){if(1===a)break;if(Number.isNaN(a)){if(!y.hasPreviousSegment())break;y.previousSegment(),a=-1}if(!y.hasPreviousSegment())break;n=y.previousSegment(),i=!0}if(!i)break;e=t.intersect(n,null,h,u,s)}while(2===e&&(!r||u[0]<=u[1]));if(x)continue;const b=t.calculateLength2D();t.queryEnvelope(g),c.length=0,m.m_overlapEvents.length=0;let E=!1,C=!1,w=0;const I=(0,o.a)(null,g,!0);for(null!==P?P.resetIterator(t,s):(y.resetToFirstPath(),y.nextPath()||(0,i.d)("relational_operations"));;){if(e=0,null!==P){const i=P.next();if(-1===i)break;y.resetToVertex(v.getElement(i),-1),n=y.nextSegment(),e=t.intersect(n,null,h,u,s)}else{for(;!y.hasNextSegment()&&y.nextPath(););if(!y.hasNextSegment())break;n=y.nextSegment(),n.queryEnvelope(p),p.inflateCoords(s,s),g.isIntersecting(p)&&(e=t.intersect(n,null,h,u,s))}if(2===e&&(!r||u[0]<=u[1])){const t=f.getStartPointIndex(),e=f.getPathIndex(),n=y.getStartPointIndex(),i=y.getPathIndex();if(d=ss(t,e,h[0],h[1],n,i,u[0],u[1]),m.m_overlapEvents.push(d),c.push(c.length),!(E||d.m_scalarA0<w&&d.m_scalarA1<w))if(0===w&&b*(d.m_scalarA0-w)>s)E=!0;else if(0!==w&&b*(d.m_scalarA0-w)>I)E=!0;else if(w=d.m_scalarA1,b*(1-w)<=s||1===w){C=!0;break}}}if(!C){if(!E)return l=!1,!1;c.length>1&&c.sort(((t,e)=>m.compareOverlapEvents(t,e))),w=0;for(let t=0;t<m.m_overlapEvents.length;t++)if(d=m.m_overlapEvents[c[t]],!(d.m_scalarA0<w&&d.m_scalarA1<w)){if(0===w&&b*(d.m_scalarA0-w)>s)return l=!1,!1;if(0!==w&&b*(d.m_scalarA0-w)>I)return l=!1,!1;if(w=d.m_scalarA1,b*(1-w)<=s||1===w)break}if(b*(1-w)>s)return l=!1,!1;c.length=0,m.m_overlapEvents.length=0}}return l}function He(t,e,s){const n=t.getImpl(),i=e.getImpl(),r=n.querySegmentIterator(),o=i.querySegmentIterator(),a=new ee(n,i,s);for(;a.next();){const t=a.getRedElement(),e=a.getBlueElement();r.resetToVertex(t,-1),o.resetToVertex(e,-1);const n=r.nextSegment();if(o.nextSegment().isIntersecting(n,s))return!0}return!1}function Xe(t,e,s,n){const i=t.getImpl(),r=e.getImpl(),o=i.querySegmentIterator(),l=r.querySegmentIterator(),h=(0,a.d)(2,Number.NaN),u=new ee(i,r,s);let c=!1,m=-1;for(;u.next();){const t=u.getRedElement(),e=u.getBlueElement();o.resetToVertex(t,-1),l.resetToVertex(e,-1);const i=o.nextSegment(),r=l.nextSegment();let d=0;if(es(i,r)){if(r.isIntersecting(i,s))return-2}else d=i.intersect(r,null,h,null,s);if(d)if(2===d){const t=i.calculateLength2D(),e=h[0];if(t*(h[1]-e)>s)return m=1,m;c=!0}else if(m=0,n){const t=h[0],e=new a.P;i.queryCoord2D(t,e),n.push(e.x),n.push(e.y)}}return c?-2:m}function je(t,e,s,n){const i=t.getImpl(),r=e,o=r.getPointCount(),l=n?(0,a.d)(o,!1):[],h=new ee(i,r,s,!1),u=i.querySegmentIterator();for(;h.next();){const t=h.getRedElement(),e=h.getBlueElement();u.resetToVertex(t,-1);const i=u.nextSegment(),o=r.getXY(e);if(i.isIntersectingPoint(o,s)){if(!n)return!0;l[e]=!0}}if(!n)return!1;for(let a=0;a<o;a++)if(!l[a])return!1;return!0}function Ze(t,e,s){const i=new a.P,r=s*s,o=t.querySegmentIterator(),l=t.getImpl().getAccelerators();if(null!==l){const t=l.getQuadTree();if(null!==t){const l=n.Envelope2D.constructEmpty();l.setCoords({pt:e});const h=t.getIterator(l,s);for(let s=h.next();-1!==s;s=h.next())if(o.resetToVertex(t.getElement(s),-1),o.hasNextSegment()){const t=o.nextSegment(),s=t.getClosestCoordinate(e,!1);if(t.queryCoord2D(s,i),a.P.sqrDistance(e,i)<=r)return!0}return!1}}const h=n.Envelope2D.constructEmpty();for(;o.nextPath();)for(;o.hasNextSegment();){const t=o.nextSegment();if(t.queryEnvelope(h),h.inflateCoords(s,s),!h.contains(e))continue;const n=t.getClosestCoordinate(e,!1);if(t.queryCoord2D(n,i),a.P.sqrDistance(e,i)<=r)return!0}return!1}function We(t,e,s,o){const l=t.querySegmentIterator(),h=t.getImpl().getAccelerators(),u=t.hasNonLinearSegments();let c=null,m=null,d=null,g=null;if(null!==h){const t=h.getQuadTree();if(null!==t){const o=t.getIterator(e,s);u&&(c=new r.L,m=new r.L,d=new r.L,g=new r.L,e.querySide(0,c),e.querySide(1,m),e.querySide(2,d),e.querySide(3,g));const a=n.Envelope2D.constructEmpty();a.setCoords({env2D:e}),a.inflateCoords(s,s);for(let n=o.next();-1!==n;n=o.next())if(l.resetToVertex(t.getElement(n),-1),l.hasNextSegment()){const t=l.nextSegment();if(t.getGeometryType()===i.G.enumLine){const e=t.getStartXY(),s=t.getEndXY();if(a.clipLine(e,s))return!0;continue}if(e.contains(t.getStartXY())||e.contains(t.getEndXY()))return!0;if(t.isIntersecting(c,s))return!0;if(t.isIntersecting(m,s))return!0;if(t.isIntersecting(d,s))return!0;if(t.isIntersecting(g,s))return!0}return!1}}if(u){c=new r.L,m=new r.L,d=new r.L,g=new r.L,e.querySide(0,c),e.querySide(1,m),e.querySide(2,d),e.querySide(3,g);const n=t.querySegmentIterator();for(;n.nextPath();)for(;n.hasNextSegment();){const t=n.nextSegment();if(e.contains(t.getStartXY())||e.contains(t.getEndXY()))return!0;if(t.isIntersecting(c,s))return!0;if(t.isIntersecting(m,s))return!0;if(t.isIntersecting(d,s))return!0;if(t.isIntersecting(g,s))return!0}}else{const i=n.Envelope2D.constructEmpty();i.setCoords({env2D:e}),i.inflateCoords(s,s);const r=t.getImpl(),o=r.getAttributeStreamRef(0),l=new a.P;for(let t=0,e=r.getPathCount();t<e;t++){let e=!0;const s=new a.P,n=new a.P,h=new a.P,u=r.getPathStart(t),c=new a.P;for(let a=u,m=r.getPathEnd(t);a<m;a++)if(e)o.queryPoint2D(2*a,s),c.assign(s),e=!1;else{if(o.queryPoint2D(2*a,l),n.setCoordsPoint2D(s),h.setCoordsPoint2D(l),i.clipLine(n,h))return!0;s.assign(l)}if(r.isClosedPath(t)&&!e&&(n.setCoordsPoint2D(s),h.setCoordsPoint2D(c),i.clipLine(n,h)))return!0}}return!1}function $e(t,e,s,i){const r=t.getImpl(),l=e.getImpl(),h=[0],c=(0,o.X)(r.getIsSimple(0,h))&&(0,o.X)(l.getIsSimple(0,h)),m=r.querySegmentIterator(),d=l.querySegmentIterator(),g=(0,a.d)(2,0),p=(0,a.d)(2,0),_=new ee(r,l,s);let f=!1;for(;_.next();){const t=_.getRedElement(),e=_.getBlueElement();m.resetToVertex(t,-1),d.resetToVertex(e,-1);const n=m.nextSegment(),i=d.nextSegment();let r=0;if(es(n,i)){if(i.isIntersecting(n,s)){f=!0;break}}else r=i.intersect(n,null,p,g,s);if(2===r){const t=g[0],e=g[1],i=n.calculateLength2D();if(c&&(e-t)*i>s)return!1;f=!0}else if(r){const t=g[0],e=p[0];if(t>0&&t<1&&e>0&&e<1)return!1;f=!0}}if(!f)return!1;const y=n.Envelope2D.constructEmpty(),x=n.Envelope2D.constructEmpty(),v=n.Envelope2D.constructEmpty();let b,P;if(t.queryEnvelope(y),e.queryEnvelope(x),y.inflateCoords(1e3*s,1e3*s),x.inflateCoords(1e3*s,1e3*s),v.setCoords({env2D:y}),v.intersect(x),t.getPointCount()>10){if(b=(0,u.c)(t,v,s,0,i),b.isEmpty())return!1}else b=t;if(e.getPointCount()>10){if(P=(0,u.c)(e,v,s,0,i),P.isEmpty())return!1}else P=e;return qt(b,P,s,"F********",i,!1)}function Ke(t,e,s,i){const r=t.getImpl(),l=e.getImpl(),h=[0],c=(0,o.X)(r.getIsSimple(0,h))&&(0,o.X)(l.getIsSimple(0,h)),m=n.Envelope2D.constructEmpty(),d=n.Envelope2D.constructEmpty(),g=n.Envelope2D.constructEmpty();t.queryEnvelope(m),e.queryEnvelope(d);let p=!1;const _=Oe(m,d,s),f=Oe(d,m,s),y=r.querySegmentIterator(),x=l.querySegmentIterator(),v=(0,a.d)(2,Number.NaN),b=(0,a.d)(2,Number.NaN),P=new ee(r,l,s);for(;P.next();){const t=P.getRedElement(),e=P.getBlueElement();y.resetToVertex(t,-1),x.resetToVertex(e,-1);const n=y.nextSegment(),i=x.nextSegment();let r=0;if(es(n,i)){if(i.isIntersecting(n,s))break}else r=i.intersect(n,null,b,v,s);if(2===r){const t=v[0],e=v[1],i=n.calculateLength2D();if(c&&(e-t)*i>s&&(p=!0,_&&f))return!0}else if(r){const t=v[0],e=b[0];if(t>0&&t<1&&e>0&&e<1)return!0}}const S=n.Envelope2D.constructEmpty(),E=n.Envelope2D.constructEmpty();let C,w;S.setCoords({env2D:m}),S.inflateCoords(1e3*s,1e3*s),E.setCoords({env2D:d}),E.inflateCoords(1e3*s,1e3*s),g.setCoords({env2D:S}),g.intersect(E);let I="";if(I+=p?"**":"T*",_){if(e.getPointCount()>10){if(w=(0,u.c)(e,g,s,0,i),w.isEmpty())return!1}else w=e;I+="****"}else w=e,I+="T***";if(f){if(t.getPointCount()>10){if(C=(0,u.c)(t,g,s,0,i),C.isEmpty())return!1}else C=t;I+="***"}else C=t,I+="T**";return qt(C,w,s,I,i,!1)}function Qe(t,e,s,i){const a=[!1],l=Ge(t,e,s,a);if(a[0])return l;const h=n.Envelope2D.constructEmpty();let c;if(e.queryEnvelope(h),h.inflateCoords(1e3*s,1e3*s),t.getPointCount()>10){if(c=(0,u.c)(t,h,s,0,i),c.isEmpty())return!1}else c=t;return function(t,e,s,i){const a=new Kt;a.resetMatrix_(),a.setPredicates_("T*****F**"),a.setAreaAreaPredicates_();const l=n.Envelope2D.constructEmpty(),h=n.Envelope2D.constructEmpty();t.queryEnvelope(l),e.queryEnvelope(h);let u=!1;if(oe(l,h,s)&&(a.areaAreaDisjointPredicates_(t,e),u=!0),u||ae(t,e),u)return Wt(a.m_matrix,a.m_scl);let c=new r.E,m=c.addGeometry(t),d=c.addGeometry(e),g=null,p=0;if(t.hasNonLinearSegments()||e.hasNonLinearSegments()){g=new xs;const t=_s(s,c.getEnvelope2D(i));p=ys(t,0),ms(c,t,s,12e3,g,null,i)}bs(c,new o.C(s,0).add(p),i,!1,!1);const _=c.getGeometry(d).getBoundary();if(c.filterClosePoints(0,!0,!0,!1,r.n),zt(c,m,-1,!1,r.n,i),0===c.getPointCount(m))return!1;zt(c,d,-1,!1,r.n,i),a.setEditShape_(c,i);const f=0===c.getPointCount(d);if(!f){a.computeMatrixTopoGraphHalfEdges_(m,d),a.m_topoGraph.removeShape();const t=Wt(a.m_matrix,a.m_scl);if(!t)return t}const y=c.getGeometry(m);return c=new r.E,m=c.addGeometry(y),d=c.addGeometry(_),a.setEditShape_(c,i),a.m_predicateCount=0,a.resetMatrix_(),a.setPredicates_(f?"T*****F**":"******F**"),a.setAreaLinePredicates_(),a.computeMatrixTopoGraphHalfEdges_(m,d),a.m_topoGraph.removeShape(),Wt(a.m_matrix,a.m_scl)}(c,e,s,i)}function Je(t,e,s,n){const i=new a.P,r=s*s;for(let o=0;o<t.getPointCount();o++)if(t.queryXY(o,i),a.P.sqrDistance(i,e)<=r)return!1;return!0}function ts(t,e,s){const n=t.getBoundary();return!n.isEmpty()&&!Je(n,e,s)}function es(t,e){return t.getGeometryType()!==i.G.enumLine||e.getGeometryType()!==i.G.enumLine}function ss(t,e,s,n,i,r,o,a){return{m_ivertexA:t,m_ipathA:e,m_scalarA0:s,m_scalarA1:n,m_ivertexB:i,m_ipathB:r,m_scalarB0:o,m_scalarB1:a}}class ns{constructor(){this.m_overlapEvents=[]}compareOverlapEvents(t,e){const s=this.m_overlapEvents[t],n=this.m_overlapEvents[e];if(s.m_ipathA<n.m_ipathA)return-1;if(s.m_ipathA===n.m_ipathA){if(s.m_ivertexA<n.m_ivertexA)return-1;if(s.m_ivertexA===n.m_ivertexA){if(s.m_scalarA0<n.m_scalarA0)return-1;if(s.m_scalarA0===n.m_scalarA0){if(s.m_scalarA1<n.m_scalarA1)return-1;if(s.m_scalarA1===n.m_scalarA1&&s.m_ivertexB<n.m_ivertexB)return-1}}}return 1}}function is(t,e,s){const n=function(t,e,s){return e.isEmpty()?0:Nt(t,e.getXY(),s)}(t,e,s);return n?1===n?1:2:0}function rs(t,e,s){const n=Nt(t,e,s);return n?1===n?1:2:0}function os(t,e,s,r,o){if(t.getGeometryType()===i.G.enumPolygon)!function(t,e,s,n,i){for(let r=0;r<s;r++)i[r]=rs(t,e[r],n)}(t,e,s,r,o);else if(t.getGeometryType()===i.G.enumEnvelope){const i=n.Envelope2D.constructEmpty();t.queryEnvelope(i),function(t,e,s,n,i){if(t.isEmpty()){for(let t=0;t<s;t++)i[t]=0;return}const r=t.clone();r.inflateCoords(.5*-n,.5*-n);const o=t.clone();o.inflateCoords(.5*n,.5*n);for(let a=0;a<s;a++)r.contains(e[a])?i[a]=1:o.contains(e[a])?i[a]=2:i[a]=0}(i,e,s,r,o)}else(0,i.p)("")}function as(t,e,s,r,a){const l=t.getGeometryType();l===i.G.enumPolyline?function(t,e,s,r,a){const l=t.getImpl(),h=l.getAccelerators();let u=null;h&&(u=h.getRasterizedGeometry());let c=s;for(let n=0;n<s;n++)a[n]=1,u&&(0,i.g)(0);if(c){if(h){let t=null;null!==h&&null!==h.getQuadTree()&&(t=h.getQuadTree());const i=l.getPointCount();if(null===t&&i>20&&i*s>4*i+Math.log(i)*s&&(t=(0,o.F)(l)),t){let i=null;const o=l.querySegmentIterator(),h=new n.Envelope2D;for(let n=0;n<s&&c;n++)if(1===a[n]){h.setCoords(e[n]),null===i?i=t.getIterator(h,r):i.resetIterator(h,r);let s=-1;for(let l=i.next();-1!==l;l=i.next()){if(o.resetToVertex(t.getElement(l),s),s=o.getPathIndex(),o.nextSegment().isIntersectingPoint(e[n],r)){a[n]=2,c--;break}a[n]=0}}return}}const t=l.querySegmentIterator();for(;t.nextPath()&&c;)for(;t.hasNextSegment()&&c;){const n=t.nextSegment();for(let t=0;t<s&&c;t++)1===a[t]&&n.isIntersectingPoint(e[t],r)&&(a[t]=2,c--)}}for(let n=0;n<s;n++)1===a[n]&&(a[n]=0)}(t,e,s,r,a):(0,i.f)(l)?(0,i.g)(0):(0,i.p)("")}function ls(t){if(t.isEmpty())return 0;switch(t.getGeometryType()){case i.G.enumMultiPoint:return t.getImpl().getPointCount();case i.G.enumPolyline:return t.getImpl().getPathCount();case i.G.enumPolygon:return t.getImpl().getOGCPolygonCount();case i.G.enumGeometryCollection:return t.getGeometryCount()}return 1}function hs(){return Number.isNaN(this.radius.value())}function us(t,e,s,n){return{pt:t.clone(),t:e,err:s,checkCount:n}}class cs{constructor(t,e,s,n,i){this.m_left=t,this.m_tracker=i,this.m_eps=s,this.m_trackerCounter=0,this.m_tolerance=n,this.m_circleCheckCounter=0,this.m_bReversedLeft=!1,this.m_leftArc={ptStart:new a.P,ptEnd:new a.P,center:new r.a0,radius:new a.H,fcenter:new r.a4,fradius2:new a.M,maxError:Number.NaN,isLine:hs}}closeToCircularArc(t,e,s,n,i,o){if(this.m_circleCheckCounter++,o.maxError=0,!cs.checkSweepAngle(t,e))return!1;if(o.ptStart.setCoordsPoint2D(s),o.ptEnd.setCoordsPoint2D(i),t.isCircular()){const e=t;return o.fradius2=a.M.constructDouble(e.getSemiMajorAxis()).mulDouble(e.getSemiMajorAxis()),o.radius.set(e.getSemiMajorAxis()),o.fcenter.assignPoint2D(e.getCenter()),o.center.set(e.getCenter()),!0}const l=o.ptEnd.sub(o.ptStart).clone();if(l.leftPerpendicularThis(),l.normalize(),Math.abs(l.dotProduct(n.sub(o.ptStart)))<=this.m_eps)return!!this.confirmIsLine(o,l)&&(o.radius.set(Number.NaN),o.center.setCoords(0,0),!0);{const s=o.ptEnd.sub(o.ptStart),i=n.sub(o.ptStart),r=s.crossProduct(i);if(0===r)return!1;const a=.5*s.sqrLength(),l=.5*i.sqrLength();let h=a*i.y-l*s.y;h/=r;let u=s.x*l-i.x*a;u/=r;const c=Math.sqrt(h*h+u*u);if(4*Number.EPSILON*c>this.m_eps)return!1;const m=h+o.ptStart.x,d=u+o.ptStart.y;o.radius.set(c),o.center.setCoords(m,d);const g=this.maxCircleApproximationError(t,e,o);if(g>this.m_eps)return o.maxError=g,!1}const h=(new r.a4).assignPoint2D(o.ptStart),u=(new r.a4).assignPoint2D(o.ptEnd).sub(h),c=(new r.a4).assignPoint2D(n).sub(h),m=u.crossProduct(c);if(m.isZero())return!1;const d=u.sqrLength().mulDouble(.5),g=c.sqrLength().mulDouble(.5),p=d.mul(c.y).sub(g.mul(u.y)),_=u.x.mul(g).sub(c.x.mul(d)),f=p.mul(p).add(_.mul(_)),y=m.clone();y.invertThis(),o.fradius2=f.mul(y).mul(y),o.fcenter.setCoords(p.mul(y).add(h.x),_.mul(y).add(h.y)),o.center.setWithEps(o.fcenter.asPoint2D()),o.radius.setWithEps(Math.sqrt(o.fradius2.toDouble()));const x=r.a0.constructPoint2D(o.ptStart).subE(o.center),v=r.a0.constructPoint2D(o.ptEnd).subE(o.center);if(!x.dotProduct(v).gt(a.J))return!1;const b=this.maxCircleApproximationError(t,e,o);return o.maxError=b,b<=this.m_eps}static checkSweepAngle(t,e){if(t.getGeometryType()===i.G.enumEllipticArc){const s=t,n=(0,r.a5)(s,e.vmin),i=(0,r.a5)(s,e.vmax);return!(Math.abs(i-n)>.5*a.o)}return!0}confirmIsLine(t,e){const s=t.ptEnd.sub(t.ptStart);return!(Math.abs(e.dotProduct(s.mul(.25)))>this.m_eps||Math.abs(e.dotProduct(s.mul(.75)))>this.m_eps)}maxCircleApproximationError(t,e,s){const n=[.25,.75],r=[.1,.25,.75,.9];let o,l;t.getGeometryType()===i.G.enumEllipticArc?(o=n,l=n.length):(o=r,l=r.length);let h=0;for(let i=0;i<l;++i){const n=new a.P;t.queryCoord2D((0,a.q)(e.vmin,e.vmax,o[i]),n);const r=n.sub(s.center.value()).length(),l=Math.abs(r-s.radius.value());l>h&&(h=l)}return h}approximateWithCirclesImpl(t,e){let s=1;e&&e.push(0);const n=(0,a.d)(9,Number.NaN);let i;t?i=this.m_left.getMonotonicPartParams(n.length,n):(n[0]=0,n[1]=1,i=2);const r=[],o=[],l=new a.P(0,0);for(let h=1;h<i;h++){const t=new a.E(n[h-1],n[h]);for(this.m_bReversedLeft=!cs.goodOrientation(this.m_left,t),this.m_bReversedLeft?(r.push(us(l,t.vmin,0,0)),r.push(us(l,t.vmax,0,0))):(r.push(us(l,t.vmax,0,0)),r.push(us(l,t.vmin,0,0))),r[0].pt=this.m_left.getCoord2D(r[0].t),r[1].pt=this.m_left.getCoord2D(r[1].t);r.length>1;){this.progress_();const t=r.at(-1);let n=t.checkCount,i=t.err;const l=t.pt.clone(),h=t.t,u=r[r.length-2].t,c=.5*(h+u),m=this.m_left.getCoord2D(c);if(i<=this.m_eps||n>=5){const t=new a.E;if(t.setCoords(h,u),this.closeToCircularArc(this.m_left,t,l,m,r[r.length-2].pt,this.m_leftArc)){e&&(this.m_bReversedLeft?o.push(h):e.push(u)),s++,r.pop();continue}n=0,i=this.m_leftArc.maxError}t.t=c,t.pt.setCoordsPoint2D(m),i*=.125,n++,t.err=i,t.checkCount=n,r.push(us(l,h,i,n))}this.m_bReversedLeft&&e&&(e.length=e.length+o.length,(0,a.b)(e,o.reverse(),e.length-o.length,0,o.length),o.length=0),r.length=0}return s}approximateWithCirclesImplPolyline(t){const e=new r.P,s=[];if(!this.approximateWithCirclesImpl(!0,s))return e;let n=0;const i=this.m_left.getStartXY();e.startPath(i);for(let o=1;o<s.length;++o)if(t)e.lineTo(this.m_left.getCoord2D(s[o]));else{const t=new a.P;this.m_left.queryCoord2D(s[o],t);const l=new a.P;this.m_left.queryCoord2D(.5*(s[o]+n),l);const h=new r.l;h.constructCircularArcThreePoint(i,t,l),e.addSegment(h,!1),i.assign(t),n=s[o]}return e}static goodOrientation(t,e){const s=t.getCoord2D(e.vmin),n=t.getCoord2D(e.vmax);return s.compare(n)<0}progress_(t=!1){}}function ms(t,e,s,n,i,r,o){(function(t,e,s,n,i,r){t.hasCurves()?(t.setCurveStitcherPointer(n),n.m_impl=new vs(r,!1,null),n.m_impl.buildMonotonicCurveParentage(t,e,s,i)):n.m_impl=null})(t,e,s,i,r,o),Es(t,s,o)}function ds(t,e,s,n){if(!(0,i.h)(t.getGeometryType()))return t;const a=t.getImpl();if(!a.hasNonLinearSegments())return t;const l=t.createInstance();l.getGeometryType()===i.G.enumPolygon&&l.setFillRule(t.getFillRule()),new r.E;const h=new o.P,u=new r.S,c=[],m=[],d=[],g=t.getDescription().getAttributeCount()>1,p=a.querySegmentIterator();for(;p.nextPath();){let t=!0;for(;p.hasNextSegment();){const n=p.isClosingSegment(),o=p.nextSegment();if(!o.isCurve()){l.addSegment(o,t,n),t=!1;continue}let a,_=!1;const f=!0,y=!0;switch(o.getGeometryType()){case i.G.enumEllipticArc:case i.G.enumRationalBezier2:a=(0,r.O)(o,e,s,f,y,m,d,c),_=!0;break;default:a=(0,r.N)(o,e,s,!0,f,m,c)}const x=_?2:3;m[1].isNAN()?(u.createLine(),u.get().construct(m[0],m[x])):_?(u.createQuadraticRationalBezier(),u.get().constructArrayWeights(m,d)):(u.createCubicBezier(),u.get().constructPoints(m)),g&&t&&(o.queryCoord(c[0],h),u.get().setStart(h)),g&&(o.queryCoord(c[1],h),u.get().setEnd(h)),l.addSegment(u.get(),t,n&&1===a),t=!1;for(let t=1,e=a,s=x;t<e;++t,s+=x)m[s+1].isNAN()?(u.createLine(),u.get().construct(m[s],m[s+x])):_?(u.createQuadraticRationalBezier(),u.get().constructArrayWeights(m.slice(s),d.slice(s))):(u.createCubicBezier(),u.get().constructPoints(m.slice(s))),g&&(o.queryCoord(c[t+1],h),u.get().setEnd(h)),l.addSegment(u.get(),!1,n&&t+1===e)}}return l}function gs(t,e,s,n,i,r,o,a){t.hasCurves()?(t.setCurveStitcherPointer(r),r.m_impl=new vs(a,!0,i),r.m_impl.buildMonotonicCurveParentage(t,e,s,o),Es(t,s,a)):r.m_impl=null}function ps(t){if(!t.hasSegmentParentage())return;const e=t.queryVertexIteratorOnSelection();for(let s=e.next();s!==r.n;s=e.next())if(!t.getSegmentParentageBreakVertex(s)){t.getPathFromVertex(s);const e=t.getPrevVertex(s),n=e!==r.n?t.getSegmentParentage(e):-1,i=t.getSegmentParentage(s);-1!==i&&-1!==n&&i!==n&&t.setSegmentParentageBreakVertex(s,!0)}}function _s(t,e){return e||(e=n.Envelope2D.constructEmpty()),function(t,e){let s=e.isEmpty()?t:(0,o.c)(null,e,!0).total();return s>t&&(s=t),.125*s}(t,e)}function fs(t,e){return.125*t}function ys(t,e){return 3*t+3*e}class xs{constructor(){this.m_impl=null}stitchCurves(t,e,s,n){this.m_impl&&(this.m_impl.stitchCurves(t,e,s),n&&this.clearStitcher(t))}clearStitcher(t){this.m_impl&&(this.m_impl.clearStitcher(t),this.m_impl=null)}getOriginalVertexIndex(t,e){return this.m_impl.getOriginalVertexIndex(t,e)}getOriginalSegmentTypeInfo(t){return this.m_impl.getOriginalSegmentTypeInfo(t)}}class vs{constructor(t,e,s){this.m_originalPlanarSegments=[],this.m_progressTracker=null,this.m_nsr=null,this.m_progressTracker=t,this.m_nsr=s,this.m_tolerance=0,this.m_originalVertexIndex=-1,this.m_type=1,this.m_progressCounter=0,this.m_bIsSimple=e,this.m_densificationDeviation=NaN,this.m_maxSegmentsPerCurve=-1}buildMonotonicCurveParentage(t,e,s,n){const a=!1;if(!t.hasCurves())return;(0,i.g)(!t.hasSegmentParentage()),this.m_originalPlanarSegments.length=0,this.m_bIsSimple&&(this.m_originalVertexIndex=t.createUserIndex()),this.m_tolerance=s;const l=new o.P,h=new r.S,u=[],c=[],m=[];for(let o=t.getFirstGeometry();o!==r.n;o=t.getNextGeometry(o))for(let n=t.getFirstPath(o);n!==r.n;n=t.getNextPath(n)){let o=t.getPathSize(n),g=t.getFirstVertex(n),p=0,_=-1;for(let f=0;f<o;f++){let y=t.getNextVertex(g);if(!t.querySegment(g,h,!0,!1)){g=y;continue}if(0===p){_=t.getVertexIndex(g);const e=vs.regularizeCurve(t,h.get(),g,s);if(e>=0){this.m_nsr&&0===this.m_nsr.m_reason&&this.m_nsr.assign(new d.NonSimpleResult(13,_,-1)),p=e,o=t.getPathSize(n),y=t.getNextVertex(g);const s=t.querySegment(g,h,!0,!1);(0,i.g)(s)}}else p--;const x=t.getVertexIndex(g);let v;-1!==this.m_originalVertexIndex&&t.setUserIndex(g,this.m_originalVertexIndex,_),t.setSegmentToIndex(x,null);let b=!1;switch(h.get().getGeometryType()){case i.G.enumEllipticArc:case i.G.enumRationalBezier2:v=(0,r.O)(h.get(),e,s,a,true,c,m,u),b=!0;break;default:{const t=!this.m_bIsSimple||!h.get().isMonotoneQuickAndDirty();v=(0,r.N)(h.get(),e,s,t,a,c,u)}}const P=this.m_originalPlanarSegments.length;if(t.setSegmentParentageAndBreak(g,P,!0),!c[1].isNAN()){let e=null;e=b?new r.T({points:c,weights:m}):new r.y({cp:c}),e.snapControlPoints(s*s),t.setSegmentToIndex(x,e)}const S=b?2:3;for(let e=1,i=v,o=S;e<i;++e,o+=S){h.get().queryCoord(u[e],l);const i=t.insertVertex(n,y,l);if(-1!==this.m_originalVertexIndex&&t.setUserIndex(i,this.m_originalVertexIndex,_),!c[o+1].isNAN())if(b){const e=new r.T({points:c.slice(o),weights:m.slice(o)});e.snapControlPoints(s*s),t.setSegmentToIndex(t.getVertexIndex(i),e)}else{const e=new r.y({cp:c.slice(o)});e.snapControlPoints(s*s),t.setSegmentToIndex(t.getVertexIndex(i),e)}t.setSegmentParentageAndBreak(i,P,!1)}v>1&&(f+=v-1,o=t.getPathSize(n)),this.m_originalPlanarSegments.push(h.releaseSegment()),g=y}}}buildLinearSegmentParentage(t,e,s,n,a){if(this.m_type=0,this.m_densificationDeviation=e,this.m_maxSegmentsPerCurve=n,!t.hasCurves())return;(0,i.g)(!t.hasSegmentParentage()),this.m_tolerance=s,this.m_originalPlanarSegments=[],this.m_bIsSimple&&(this.m_originalVertexIndex=t.createUserIndex());const l=new o.P,h=new r.S,u=new r.D(0,e,0,this.m_progressTracker,!1,n),c=[];for(let o=t.getFirstGeometry();o!==r.n;o=t.getNextGeometry(o))for(let e=t.getFirstPath(o);e!==r.n;e=t.getNextPath(e)){let n=t.getPathSize(e),r=t.getFirstVertex(e);for(let o=0;o<n;o++){let o=t.getNextVertex(r);if(!t.querySegment(r,h,!0,!1)){r=o;continue}if(vs.regularizeCurve(t,h.get(),r,s)>=0){n=t.getPathSize(e),o=t.getNextVertex(r);const s=t.querySegment(r,h,!0,!1);(0,i.g)(s)}const a=t.getVertexIndex(r);-1!==this.m_originalVertexIndex&&t.setUserIndex(r,this.m_originalVertexIndex,a),t.setSegmentToIndex(a,null),c.length=0,u.densifySegment(h.get(),c),this.progress_();const m=this.m_originalPlanarSegments.length;t.setSegmentParentageAndBreak(r,m,!0);for(let s=1,n=c.length-1;s<n;++s){h.get().queryCoord(c[s],l);const n=t.insertVertex(e,o,l);t.setSegmentParentageAndBreak(n,m,!1),-1!==this.m_originalVertexIndex&&t.setUserIndex(n,this.m_originalVertexIndex,a)}this.m_originalPlanarSegments.push(h.releaseSegment()),r=o}}t.clearSegments()}stitchCurves(t,e,s){vs.st_stitchCurvesImpl(this,t,e,s,!1)}clearStitcher(t){this.m_originalPlanarSegments.length=0,-1!==this.m_originalVertexIndex&&(t.removeUserIndex(this.m_originalVertexIndex),this.m_originalVertexIndex=-1),t.deleteSegmentParentage()}static st_verifyParentage(t){vs.st_stitchCurvesImpl(null,t,r.n,0,!0)}getOriginalVertexIndex(t,e){return-1!==this.m_originalVertexIndex&&e!==r.n?t.getUserIndex(e,this.m_originalVertexIndex):-1}getOriginalSegmentTypeInfo(t){if(-1!==t){const e=this.m_originalPlanarSegments[t];switch(e.getGeometryType()){case i.G.enumEllipticArc:return 0===e.projectionBehavior()?0:1;case i.G.enumBezier:return 2;case i.G.enumBezier2:return 3;case i.G.enumLine:return-1;case i.G.enumRationalBezier2:return 4;default:(0,i.t)("")}}return-1}progress_(t=!1){this.m_progressCounter++}processSpanSmartTe_(t,e,s,n,o,l,h){if(e===s&&0===n)return(0,i.g)(t.getNextVertex(e)===r.n),t.setSegmentToIndex(t.getVertexIndex(e),null),void t.setSegmentParentageAndBreak(e,-1);const u=t.getNextVertex(e),c=t.getXY(e),m=t.getXY(s);let d,g=0;{let e=2,r=c;for(let n=u;n!==s;n=t.getNextVertex(n)){const s=t.getXY(n);g+=a.P.distance(s,r),r=s,e++}g+=a.P.distance(m,r),(0,i.g)(e===n)}if(null===o)return t.setSegmentToIndex(t.getVertexIndex(e),null),void t.removeVertices(u,s);const p=h;let _=o.getClosestCoordinate(c,!1),f=o.getClosestCoordinate(m,!1);const y=o.calculateLength2D();let x=o.tToLength(_),v=o.tToLength(f);const b=Math.abs(x)>10*p&&Math.abs(x-y)>10*p,P=Math.abs(v)>10*p&&Math.abs(v-y)>10*p,S=t=>{const e=t.calculateLength2D();return Math.abs(e-g)>Math.max(.2*g,4*p)?null:t};let E=o.isClosed();if(!E){const t=a.P.distance(o.getStartXY(),o.getEndXY());t<=p&&y>5*t&&(E=!0)}if(E){let r,l,h=new a.P;if(2===n)h=a.P.lerp(c,m,.5),r=o.getClosestCoordinate(h,!1),l=o.tToLength(r);else{let s=t.getNextNthVertex(e,(n-1)/2);h=t.getXY(s),r=o.getClosestCoordinate(h,!1),l=o.tToLength(r);let i=Math.abs(l)>10*p&&Math.abs(l-y)>10*p;if(!i&&(n-1>=4&&(s=t.getNextNthVertex(e,(n-1)/4),r=o.getClosestCoordinate(h,!1),l=o.tToLength(r),i=Math.abs(l)>10*p&&Math.abs(l-y)>10*p),!i))return}let u=!1;const g=x===v;if(g){const s=0;let i=2,r=4;n-1<=4&&(i=s+1,r=s+2);const l=c,h=t.getXY(t.getNextNthVertex(e,i)),m=t.getXY(t.getNextNthVertex(e,r));u=-a.P.orientationNonRobust(l,h,m)*(0,a.e)(o.calculateArea2DHelper())>0}else P?b?u=l>x:l<v?(x=0,_=0):(x=y,_=1):l>x?(v=y,f=1):(v=0,f=0);if(g)d=o.clone(),d.dropAllAttributes(),u||d.reverse(),(0,i.g)(c.equals(m));else{let t=!1;_>f&&(t=!0,[_,f]=[f,_]),d=o.cut(_,f,!0),d.getDescription().getAttributeCount(),t&&d.reverse()}d.setCoordsForIntersector(c,m,!1),d=S(d),d&&(this.removeSpanBetween(t,e,s),t.setSegmentToIndex(t.getVertexIndex(e),d))}else if(b||P){if((!b||!P)&&a.P.distance(o.getStartXY(),o.getEndXY())<10*p){const n=[(0,a.k)(_,f),(0,a.k)(_,f),(0,a.k)(_,f)];b?(n[1].second=0,n[2].second=1):(n[1].first=1,n[2].first=0);const i=[null,null,null],r=[0,0,0];let l=Number.MAX_VALUE,h=0;for(let t=0;t<3;t++){let e=!1;if(n[t].first>n[t].second){e=!0;const s=n[t].first;n[t].first=n[t].second,n[t].second=s}i[t]=o.cut(n[t].first,n[t].second,!0),i[t].dropAllAttributes(),e&&i[t].reverse(),i[t].setCoordsForIntersector(c,m,!1),r[t]=i[t].calculateLength2D();const s=Math.abs(g-r[t]);s<l&&(l=s,h=t)}return d=i[h],d=S(d),void(d&&(this.removeSpanBetween(t,e,s),t.setSegmentToIndex(t.getVertexIndex(e),d)))}let n=!1;_>f&&(n=!0,[_,f]=[f,_]),d=o.cut(_,f,!0),d.dropAllAttributes(),n&&d.reverse(),d.setCoordsForIntersector(c,m,!1),d=S(d),d&&(this.removeSpanBetween(t,e,s),t.setSegmentToIndex(t.getVertexIndex(e),d))}else{if(d=o.clone(),d.dropAllAttributes(),x>v&&d.reverse(),g<Math.max(.75*y,y-this.m_densificationDeviation*(n-1))){const t=_>f?f:_,e=d.tToLength(t)+g;let s=d.lengthToT(e);s=(0,a.s)(s,t,1),d=d.cut(t,s,!0)}d.setCoordsForIntersector(c,m,!1),d=S(d),d&&(this.removeSpanBetween(t,e,s),t.setSegmentToIndex(t.getVertexIndex(e),d))}}processSpanCurves_(t,e,s,n,o,a,l){if(e===s&&0===n)return(0,i.g)(t.getNextVertex(e)===r.n),t.setSegmentToIndex(t.getVertexIndex(e),null),void t.setSegmentParentageAndBreak(e,-1);const h=t.getNextVertex(e);{let e=2;for(let n=h;n!==s;n=t.getNextVertex(n))e++;(0,i.g)(e===n)}if(null===o)return t.setSegmentToIndex(t.getVertexIndex(e),null),void t.removeVertices(h,s);const u=t.getXY(e),c=t.getXY(s);if(o.isClosed()){if(u.isEqualPoint2D(c)&&u.isEqualPoint2D(o.getStartXY())){let i;if(i=this.verifySegmentFitnessCurves(t,e,s,n,o,a,l)){const n=o.clone();return n.dropAllAttributes(),i<0&&n.reverse(),this.removeSpanBetween(t,e,s),void t.setSegmentToIndex(t.getVertexIndex(e),n)}}}else if(u.isEqualPoint2D(o.getStartXY())){if(c.isEqualPoint2D(o.getEndXY())){const r=o.clone();r.dropAllAttributes();const h=this.verifySegmentFitnessCurves(t,e,s,n,r,a,l);if(h)return(0,i.g)(h>0),this.removeSpanBetween(t,e,s),void t.setSegmentToIndex(t.getVertexIndex(e),r)}}else if(c.isEqualPoint2D(o.getStartXY())&&u.isEqualPoint2D(o.getEndXY())){const r=o.getReversed();r.dropAllAttributes();const h=this.verifySegmentFitnessCurves(t,e,s,n,r,a,l);if(h)return(0,i.g)(h>0),this.removeSpanBetween(t,e,s),void t.setSegmentToIndex(t.getVertexIndex(e),r)}this.processSpanSplitSegmentCurves(t,e,s,n,o,a,l)}processSpan_(t,e,s,n,i,r,o){return 0===this.m_type?void this.processSpanSmartTe_(t,e,s,n,i,r,o):void this.processSpanCurves_(t,e,s,n,i,r,o)}processSpanSplitSegmentCurves(t,e,s,n,i,r,o){if(i.isLine())return;if(this.fitSegmentToSpanCurves(t,e,s,n,i,r,o))return;const l=o*o;let h=n,u=e;const c=t.getXY(e);let m=i.getClosestCoordinate(c,!1);const d=i.getCoord2D(m);let g=!1;const p=a.P.sqrDistance(c,d);if(p>l){const n=t.getNextVertex(e);if(this.approximateSpanSectionCurves(t,e,i,r,o),n===s)return;u=n,g=!0,h-=1}let _=s;const f=t.getXY(s);m=i.getClosestCoordinate(f,!1);const y=i.getCoord2D(m);let x=!1;const v=a.P.sqrDistance(f,y);if(v>l){const e=t.getPrevVertex(s);if(this.approximateSpanSectionCurves(t,e,i,r,o),e===u)return;_=e,x=!0,h-=1}if((g||x)&&this.fitSegmentToSpanCurves(t,u,_,h,i,r,o))return;let b=!1;if(!g&&p>0){const s=t.getNextVertex(e);if(this.approximateSpanSectionCurves(t,e,i,r,o),s===_)return;u=s,g=!0,b=!0,h-=1}if(!x&&v>0){const e=t.getPrevVertex(s);if(this.approximateSpanSectionCurves(t,e,i,r,o),e===u)return;_=e,x=!0,b=!0,h-=1}if(b&&this.fitSegmentToSpanCurves(t,u,_,h,i,r,o))return;let P=u;for(;;){const e=t.getNextVertex(P);if(this.approximateSpanSectionCurves(t,P,i,r,o),P=e,P===_)return}}fitSegmentToSpanCurves(t,e,s,n,i,o,l){const h=[];h.push(t.getXY(e));let u=e;const c=new r.S;for(;;){t.querySegment(u,c,!1,!0);const e=[.1,.25,.4,.5,.6,.75,.9,1];let i=0;for(const t of e)(2===n||1&i)&&h.push(c.get().getCoord2D(t)),i++;if(u=t.getNextVertex(u),u===s)break}const m=(()=>{let t=h[0].compare(h.at(-1));if(0===t){const e=new a.K(0);(function(t,e,s){if(s.reset(),e<3)return;const n=t[0].clone(),i=n.x,r=n.y,o=t[1].clone(),l=new a.P;for(let a=2;a<e;a++)l.assign(t[a]),s.pe((l.x-n.x)*(o.y-r)),n.assign(o),o.assign(l);s.pe((i-n.x)*(o.y-r))})(h,h.length,e),t=e.getResult()>=0?-1:1}return t>0})();m&&h.reverse();const d=i.clone();if(d.dropAllAttributes(),m&&d.reverse(),d.setSegmentFromCoordsForStitcher(h,h.length),m&&d.reverse(),d.snapControlPoints(this.m_tolerance*this.m_tolerance),this.verifySegmentFitnessCurves(t,e,s,n,d,o,l)){this.removeSpanBetween(t,e,s);const n=t.getVertexIndex(e);return t.setSegmentToIndex(n,d),!0}return!1}approximateSpanSectionCurves(t,e,s,n,l){const h=new r.S;if(!t.querySegment(e,h,!0,!1))return;const u=s.getGeometryType();if(u!==h.get().getGeometryType()){if(u===i.G.enumEllipticArc){if(h.get().getGeometryType()!==i.G.enumRationalBezier2)return;if(0===s.projectionBehavior()){const s=[];!function(t,e,s,n,i){const o=(0,r._)(e),a=Math.max(4*o,s);new cs(e,null,a,Number.NaN,i).approximateWithCirclesImpl(t,n)}(!1,h.get(),l,s,this.m_progressTracker);const n=t.getNextVertex(e),i=t.getPathFromVertex(e),u=new o.P;let c=e;for(let e=1,o=s.length;e<o;e++){const o=s[e],l=h.get().getCoord2D(s[e-1]),m=h.get().getCoord2D((0,a.q)(s[e-1],o,.5));h.get().queryCoord(o,u);const d=u.getXY(),g=new r.l;g.constructCircularArcThreePoint(l,d,m);let p=r.n;o<1&&(p=t.insertVertex(i,n,u)),t.setSegmentToIndex(t.getVertexIndex(c),g),c=p}return}{const s=(0,a.m)(a.P,3);h.get().queryControlPoints(s);const n=[0,0,0];h.get().queryWeights(n);const i=(0,r.U)(n),o=new r.l;return(0,r.V)(s,i*i,null,!1,o),void t.setSegmentToIndex(t.getVertexIndex(e),o)}}(0,i.d)("approximate_span_section_")}}verifySegmentFitnessCurves(t,e,s,n,i,o,l){const h=t.getXY(e),u=t.getXY(s);if(!h.isEqualPoint2D(i.getStartXY())||!u.isEqualPoint2D(i.getEndXY()))return 0;let c=0;if(i.isClosed()){const t=i.getCoord2D(.1).sub(h);c=i.getCoord2D(.7).sub(h).crossProduct(t)>=0?1:-1}const m=(0,a.d)(r.W.s_maxMonotonicPartParams,Number.NaN);let d=i.getMonotonicPartParams(m.length,m);d--;const g=new r.L,p=[1,.5,.75,.25];let _=0,f=e;const y=h.clone();for(;;){const e=t.getNextVertex(f);let n=t.getSegment(f);null===n&&(t.queryLineConnector(f,g,!0),n=g);for(let t=e===s?1:0;t<p.length;t++){const e=n.getCoord2D(p[t]);if(!i.isCloserThanDistance(e,a.E.unit(),l))return 0}if(d>1)for(let t=1;t<d;){const e=i.getCoord2D(m[t]);n.isCloserThanDistance(e,a.E.unit(),l)?(m[d-1]=(0,a.c)(m[t],m[t]=m[d-1]),d--):t++}if(c){const t=n.getCoord2D(.25);_+=t.sub(h).crossProduct(y.sub(h)),y.assign(t),t.assign(n.getCoord2D(.75)),_+=t.sub(h).crossProduct(y.sub(h)),y.assign(t)}if(f=e,f===s)return d>1?0:c?_<0?-c:c:1}}removeSpanBetween(t,e,s){t.setSegmentToIndex(t.getVertexIndex(e),null);const n=t.getNextVertex(e);n!==s&&t.removeVertices(n,s)}static st_stitchCurvesImpl(t,e,s,n,o){if(!e.hasSegmentParentage())return;ps(e);let a=s===r.n?e.getFirstGeometry():s;for(;a!==r.n;)if((0,i.l)(e.getGeometryType(a))){for(let s=e.getFirstPath(a);s!==r.n;s=e.getNextPath(s)){let a=e.getPathSize(s);const l=e.isClosedPath(s);l&&(a+=1);let h=e.getFirstVertex(s);const u=e.getSegmentParentage(h);if(l){if(-1!==u&&!e.getSegmentParentageBreakVertex(h)){let t=e.getPrevVertex(h);const s=h;for(let n=0;;n++){const r=e.getSegmentParentage(t);if(u!==r){(0,i.g)(-1===r);break}if(h=t,e.getSegmentParentageBreakVertex(t))break;if(t===s){h=s,e.setSegmentParentageBreakVertex(h,!0);break}t=e.getPrevVertex(t),(0,i.g)(n<a)}}}else(0,i.g)(-1===u||e.getSegmentParentageBreakVertex(h));let c=h;for(let s=0;s<a&&c!==r.n;){const l=e.getSegmentParentage(c);if(-1===l){if(s++,c=e.getNextVertex(c),c===h)break;continue}let u=0,m=r.n;const d=c;u=1;let g=e.getNextVertex(d);for(;s<a&&g!==r.n;){s++,m=g,u++;const t=e.getSegmentParentage(g);if(-1===t||e.getSegmentParentageBreakVertex(g))break;(0,i.g)(t===l),g=e.getNextVertex(g)}if(m===r.n){(0,i.g)(0);break}if(!o){const s=t.m_originalPlanarSegments[l];t.processSpan_(e,d,m,u,s,l,n)}if(c=m,c===h)break}}if(s!==r.n)break;a=e.getNextGeometry(a)}else a=s===r.n?e.getNextGeometry(a):r.n}static st_stitchCurvesFromLinesImpl(t,e,s,n,o){let a=s===r.n?e.getFirstGeometry():s;for(;a!==r.n;){for(let s=e.getFirstPath(a);s!==r.n;s=e.getNextPath(s)){let a=e.getPathSize(s);e.isClosedPath(s)&&(a+=1);let l=!0,h=!1;const u=e.getFirstVertex(s);let c=u;for(let s=0;s<a&&c!==r.n;){let m=e.getSegmentParentage(c);if(-1===m||l){l=!1,s++,c=e.getNextVertex(c),h=!0;continue}let d,g,p=0;if(h?(d=e.getPrevVertex(c),g=c,(0,i.g)(d!==r.n),(0,i.g)(g!==d),(0,i.g)(-1===e.getSegmentParentage(d)||u===d)):(d=c,g=e.getNextVertex(d),s++,(0,i.g)(g!==r.n),(0,i.g)(g!==d),m=e.getSegmentParentage(g)),p=2,h=!1,-1===m||e.getSegmentParentageBreakVertex(g)){c=g;continue}let _=e.getNextVertex(g);for(s++;s<a&&_!==r.n;){g=_,p++;const t=e.getSegmentParentage(_);if(-1===t||e.getSegmentParentageBreakVertex(_))break;(0,i.g)(t===m),s++,_=e.getNextVertex(_)}if(!o){const s=t.m_originalPlanarSegments[m];t.processSpan_(e,d,g,p,s,m,n)}c=g}}if(s!==r.n)break;a=e.getNextGeometry(a)}}static st_stitchCurvesFromCurvesImpl(t,e,s,n,o){let a=s===r.n?e.getFirstGeometry():s;for(;a!==r.n;)if((0,i.l)(e.getGeometryType(a))){for(let s=e.getFirstPath(a);s!==r.n;s=e.getNextPath(s)){let a=e.getPathSize(s);const l=e.isClosedPath(s);l&&(a+=1);let h=e.getFirstVertex(s);if(l){if(-1!==e.getSegmentParentage(h)){let t=h;for(let n=0;!e.getSegmentParentageBreakVertex(t);n++){if(n===a){h=e.getFirstVertex(s),e.setSegmentParentageBreakVertex(t,!0);break}t=e.getPrevVertex(t)}}}else(0,i.g)(-1===e.getSegmentParentage(h)||e.getSegmentParentageBreakVertex(h));let u=h;for(let s=0;s<a&&u!==r.n;){const l=e.getSegmentParentage(u);if(-1===l){s++,u=e.getNextVertex(u);continue}let h=0,c=r.n;const m=u;h=1;let d=e.getNextVertex(m);for(;s<a&&d!==r.n;){s++,c=d,h++;const t=e.getSegmentParentage(d);if(-1===t||e.getSegmentParentageBreakVertex(d))break;(0,i.g)(t===l),d=e.getNextVertex(d)}if(c===r.n)break;if(!o){const s=t.m_originalPlanarSegments[l];t.processSpan_(e,m,c,h,s,l,n)}u=c}}if(s!==r.n)break;a=e.getNextGeometry(a)}else a=s===r.n?e.getNextGeometry(a):r.n}static regularizeCurve(t,e,s,n){let i=e.snapControlPoints(n*n);if(i){const n=t.getVertexIndex(s),i=e.clone();t.setSegmentToIndex(n,i)}if(e.getGeometryType()===r.y.type){const r=[],o=e.calculateSpecialPointsForCracking(n,r);if(o>0){const l=[];if(o>1)for(let t=0;t<o;t++)if(l.push(e.getCoord2D(r[t])),t>0){const e=(Math.abs(l[t].x)+Math.abs(l[t].y))*(0,a.g)(),s=a.P.distance(l[t-1],l[t]);if(s<e&&s>0){const e=new a.P;(0,a.U)(l[t-1],l[t],.5,e),l[t-1]=e,l[t]=e}}t.splitSegment(s,r,o),i=t.snapControlPoints(s,o+1,n*n)||i;for(let e=0;e<o;e++)s=t.getNextVertex(s),t.setSegmentParentageBreakVertex(s,!0);return o}}return i?0:-1}}function bs(t,e,s,n,i){return new ws(t,s,e,n,i).do_()}function Ps(t,e,s=1,n=1,i=1,r=1){if(n>r)return t;if(r>n)return e;const a=new o.P;return function(t,e,s,n,i,r,o,a,l){const h=t.equals(e);if(n>r)return o.assignCopy(t),l[0]=n,a[0]=s,h;if(r>n)return o=e,l[0]=r,a[0]=i,h;o.assignCopy(t);const u=lt(t.getXY(),e.getXY(),s,n,i,r);o.setXY(u.pt),a[0]=u.weight,l[0]=u.rank}(t,e,s,n,i,r,a,[0],[0]),a}function Ss(t,e,s){const n=(0,o.e)(e),i=(0,o.Q)(e);return!!function(t,e,s,n,i){const r=new ct(i);return r.m_shape=t,r.m_sqrTolerance=e*e,r.m_cellSize=2*e,r.m_invCellSize=1/r.m_cellSize,r.m_geometry=s,r.m_bTrackChanges=!1,r.needsClustering()}(t,n,r.n,0,s)||Tt(!0,t,i,null,s)}function Es(t,e,s){return ws.fixCurveTwoPointLoops(t,e,s)}function Cs(t){return(0,o.e)(t)}class ws{constructor(t,e,s,n,i){this.m_shape=t,this.m_progressTracker=e,this.m_tolerance=s,this.m_bFilterDegenerateSegments=n,this.m_bTrackChanges=i,this.m_progressCounter=0}do_(){const t=new o.C(this.m_tolerance.tolerance,this.m_tolerance.resolution),e=Cs(t);let s=(0,o.Q)(t);const n=1.00001*s;s*=1.000001;let l=!1;const h=this.m_shape.getTotalPointCount()+10>30?1e3:(this.m_shape.getTotalPointCount()+10)*(this.m_shape.getTotalPointCount()+10),u=this.m_shape.hasPointFeatures();for(let o=0;;o++){this.m_shape.dbgCheckSelection(),o>h&&(0,i.d)("crack_and_cluster_iteration_exceeded"),this.m_shape.dbgVerifyMonotone();let t=-1;0===o&&(t=this.firstCrack_(),l||=t>0);const a=this.cluster_(e);if(this.m_shape.dbgVerifyMonotone(),l||=a,this.m_bFilterDegenerateSegments){const t=0!==this.m_shape.filterClosePoints(e,!0,!1,this.m_bTrackChanges,r.n);l||=t,this.m_shape.dbgVerifyMonotone()}const c=this.m_shape.snapControlPointsOnSelection(n*n);l||=c,this.m_shape.dbgCheckSelection();let m=!1;if((0===o&&-1===t||u||Tt(!0,this.m_shape,s,null,this.m_progressTracker))&&(m=this.crack_(n),l||=m,this.m_shape.dbgVerifyMonotone()),!m&&!ws.fixCurveTwoPointLoops(this.m_shape,e,this.m_progressTracker)){this.m_shape.dbgVerifyMonotone();break}}return l&&function(t){if(!t.hasSegmentParentage())return;ps(t);const e=new o.A(0),s=t.queryVertexIteratorOnSelection();for(let o=s.next();o!==r.n;o=s.next())e.add(o);if(0===e.size())return;t.sortVerticesSimpleByY(e,0,e.size()),e.add(r.n);const n=a.P.getNAN();t.queryXY(e.read(0),n);let i=0;const l=a.P.getNAN();for(let o=1,h=e.size();o<h;o++){{const s=e.read(o);s!==r.n?t.queryXY(s,l):l.setNAN()}if(!l.isEqualPoint2D(n)){if(o-i>1){let s=!1;for(let n=i;n<o;++n){const i=e.read(n);if(t.getSegmentParentageBreakVertex(i)){s=!0;break}}if(!s){const n=(e,s,n)=>{const i=t.getPrevVertex(e),o=t.getNextVertex(e);i!==r.n?s.assign(t.getXY(i)):s.setNAN(),o!==r.n?n.assign(t.getXY(o)):n.setNAN()},l=new a.P,h=new a.P;n(e.read(i),l,h);for(let t=i+1;t<o;++t){const i=e.read(t);if(i===r.n)continue;const o=new a.P,u=new a.P;n(i,o,u);const c=(t,e)=>!!(t.equals(e)||t.isNAN()&&e.isNAN());if(!(c(o,l)&&c(u,h)||c(u,l)&&c(o,h))){s=!0;break}}}if(s)for(let n=i;n<o;++n)t.setSegmentParentageBreakVertex(e.read(n),!0)}n.setCoordsPoint2D(l),i=o}}}(this.m_shape),l}cluster_(t){return ot(this.m_shape,t,r.n,this.m_bTrackChanges,this.m_progressTracker)}crack_(t){return function(t,e,s,n){if(!It(t))return!1;const i=new Mt(n);i.m_shape=t,i.m_tolerance=e,i.m_bTrackChanges=s;let r=!1;const o=t.hasCurves()?5:15;return r=t.getTotalPointCount()<o?i.crackBruteForce_():i.crackerPlaneSweep_(),r}(this.m_shape,t,this.m_bTrackChanges,this.m_progressTracker)}static fixCurveTwoPointLoops(t,e,s){if(!t.hasCurves())return!1;t.dbgVerifyCurves();const n=t.createUserIndexUninitialized(),l=new o.A(0),h=t.queryVertexIteratorOnSelection();for(let i=h.next();i!==r.n;i=h.next())l.add(i),t.setUserIndex(i,n,-1);if(0===l.size())return!1;l.add(r.n),t.sortVerticesSimpleByY(l,0,l.size()-1);let u=0;const c=t.getXY(l.read(u)),m=new a.P(Number.NaN,Number.NaN),d=[];for(let i=1,o=l.size();i<o;++i){const e=l.read(i),s=e!==r.n?t.getXY(e):m;if(s.equals(c))continue;const o=[];for(let h=u;h<i;h++){const e=l.read(h),s=t.getPrevVertex(e);if(s!==r.n&&-1===t.getUserIndex(s,n)){const e=Is(t.getXY(s),t.getSegment(s));0!==a.P.sqrDistance(c,e.otherPt)&&(e.vert=s,e.dir=-1,o.push(e)),t.setUserIndex(s,n,1)}const i=t.getNextVertex(e);if(i!==r.n&&-1===t.getUserIndex(e,n)){const s=Is(t.getXY(i),t.getSegment(e));0!==a.P.sqrDistance(c,s.otherPt)&&(s.vert=e,s.dir=1,o.push(s)),t.setUserIndex(e,n,1)}}if(o.length>1){o.sort(((t,e)=>As(t,e)));const t=Is(m.clone(),null);o.push(t);let e=0;for(let s=1,n=o.length;s<n;s++)if(!o[s].otherPt.equals(o[s-1].otherPt)){if(s-e>1&&null!==o[e].seg){let t=!1;const n=e;for(let i=e+1;i<s;i++)if(!Ts(o[n],o[i])){t=!0;break}if(t)for(let i=e;i<s&&null!==o[i].seg;i++)d.push(o[i].vert)}e=s}}u=i,c.setCoordsPoint2D(s)}for(const r of d){const s=t.getSegment(r);(0,i.g)(null!==s);const n=t.getXY(r),o=t.getXY(t.getNextVertex(r));if(a.P.distance(n,o)<3*e)t.setSegmentToIndex(t.getVertexIndex(r),null);else{const e=s.lengthToT(.5*s.calculateLength2D());t.splitSegment(r,[e],1)}}return t.removeUserIndex(n),d.length>0}firstCrack_(){const t=this.m_shape.getEnvelope2D(this.m_progressTracker),e=(0,o.c)(null,t,!0).total();if(4*e<this.m_tolerance.total()){let t=!1;const s=1.1*e,n=e,i=this.cluster_(s);t||=i;let o=0;this.m_bFilterDegenerateSegments&&(o=this.m_shape.filterClosePoints(0,!0,!1,this.m_bTrackChanges,r.n));const a=this.crack_(n);return t||=a,t?1:o?2:0}return-1}progress_(t=!1){this.m_progressCounter++,!t&&4095&this.m_progressCounter||(this.m_progressCounter=0)}}function Is(t,e){return{otherPt:t,seg:e,vert:-1,dir:0}}function Ts(t,e){if((0,i.g)(t.otherPt.equals(e.otherPt)),null===t.seg)return null===e.seg;if(null===e.seg)return!1;const s=t.seg.getGeometryType();if(s!==e.seg.getGeometryType())return!1;if(s===i.G.enumBezier){const s=t.seg,n=e.seg;let i=s.getControlPoint1(),r=s.getControlPoint2();-1===t.dir&&(r=(0,a.c)(i,i=r));let o=n.getControlPoint1(),l=n.getControlPoint2();return-1===e.dir&&(l=(0,a.c)(o,o=l)),i.equals(o)&&r.equals(l)}if(s===i.G.enumRationalBezier2){const s=t.seg,n=e.seg,i=s.getControlPoint1(),r=n.getControlPoint1();if(!i.equals(r))return!1;const o=[0,0,0];s.queryWeights(o),-1===t.dir&&(o[2]=(0,a.c)(o[0],o[0]=o[2]));const l=[0,0,0];return n.queryWeights(l),-1===e.dir&&(l[2]=(0,a.c)(l[0],l[0]=l[2])),o[0]===l[0]&&o[1]===l[1]&&o[2]===l[2]}(0,i.d)("")}function As(t,e){const s=t.otherPt.compare(e.otherPt);return 0!==s?s:function(t,e){if(null===t.seg||null===e.seg)return null!==t.seg?-1:null!==e.seg?1:0;const s=t.seg.getGeometryType(),n=e.seg.getGeometryType();return s<n?-1:s>n?1:0}(t,e)}var Ms=i.h,Ds=i.f,Ns=i.z;function Fs(t){switch(t){case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 0:return 0;default:(0,i.g)(0,"unrecognized cut side")}return 3}function Rs(t,e,s,n){return new Ys(n).autoCompleteImpl(t,e,s)}function ks(t,e,s,n,r,a,l){const h=new Ys(r);h.m_bOGCOutput=!0;const u=t.getGeometryType()===i.G.enumPolygon&&1===t.getFillRule()&&!(0,o.X)(n);return h.planarSimplifyImpl_(t,e,u,s,n,r,a,l)}function Ls(t,e,s,n,i,r,o,a){return new Ys(r).planarSimplifyImpl_(t,e,s,n,i,r,o,a)}function Gs(t,e,s){return function(t,e,s){const n=t.createInstance(),r=(0,a.m)(a.P,100),o=new Array(100),l=t.getPointCount();let h=!0;const u=2===e.getDimension();1!==e.getDimension()&&2!==e.getDimension()&&(0,i.d)("");for(let i=0;i<l;){const a=t.queryCoordinates(r,r.length,i,-1)-i;u?os(e,r,a,s.total(),o):as(e,r,a,s.total(),o);let l=0;for(let e=0;e<a;e++)0===o[e]&&(h&&(h=!1,n.addPoints(t,0,i)),l!==e&&n.addPoints(t,i+l,i+e),l=e+1);h||l===a||n.addPoints(t,i+l,i+a),i+=a}return h?t:n}(t,e,s)}function Vs(t,e,s,a){if(t.getDimension()>e.getDimension())return Us(Hs(t),t,e,"^");if(t.getDimension()<e.getDimension())return Us(Hs(e),t,e,"^");if(t.isEmpty())return Us(Hs(e),t,e,"^");if(e.isEmpty())return Us(Hs(t),t,e,"^");const l=new n.Envelope2D;t.queryEnvelope(l);const h=new n.Envelope2D;e.queryEnvelope(h);const u=new n.Envelope2D;u.setCoords({env2D:l}),u.mergeEnvelope2D(h);const c=(0,o.c)(s,u,!0),m=new Ys(a),d=new r.E,g=d.addGeometry(Hs(t)),p=d.addGeometry(Hs(e));let _=0,f=null;if(d.hasCurves()){f=new xs;const t=d.getEnvelope2D(a);_=fs(c.total()),ms(d,_s(c.total(),t),c.total(),0,f,null,a)}m.setEditShapeCrackAndCluster(d,c);const y=m.symmetricDifference(g,p);null!==f&&f.stitchCurves(d,y,_,!0);const x=Us(d.getGeometry(y),t,e,"^");return Ms(x.getGeometryType())&&(x.getImpl().setIsSimple(4,c.total()),x.getGeometryType()===i.G.enumPolygon&&x.getImpl().updateOGCFlagsProtected()),x}function zs(t,e,s){return function(t,e,s,n){if(t.isEmpty())return t.createInstance();if(e.isEmpty())return n?t.createInstance():new o.P({copy:t});const r=[new a.P],l=[0],h=2===e.getDimension();return 1!==e.getDimension()&&2!==e.getDimension()&&(0,i.d)(""),r[0]=t.getXY(),h?os(e,r,1,s.total(),l):as(e,r,1,s.total(),l),0===l[0]?t.createInstance():t}(t,e,s,!0)}function Os(t,e,s){return t.isEmpty()||e.isEmpty()?t.createInstance():function(t,e,s){const n=(0,o.e)(t);return at(e.getX(),e.getY(),s.getX(),s.getY(),(0,a.a)(n))}(s,t,e)?new o.P({copy:Ps(t,e)}):t.createInstance()}function qs(t,e,s,n,a,l=!1){0===e&&(0,i.a)("not enough geometries to dissolve");let h=0;for(let i=0,r=e;i<r;i++)h=Math.max(t[i].getDimension(),h);if(2===h||1===h)return new Ys(n).dissolveMultiPaths_(h,!1,t,e,s,a,l);let u=0,c=-1;for(let i=0,r=e;i<r;i++)t[i].getDimension()===h&&(-1===c&&(c=i),t[i].isEmpty()||(c=i,u++));if(u<2)return Hs(t[c]);const m=o.n.constructEmpty(),d=new r.E;let g=r.n;for(let i=0,f=e;i<f;i++)if(t[i].getDimension()===h&&!t[i].isEmpty()){g===r.n?g=d.addGeometry(Hs(t[i])):d.appendGeometry(g,Hs(t[i]));const e=o.n.constructEmpty();t[i].queryLooseEnvelope(e),m.mergeEnv3D(e)}const p=(0,o.c)(s,m.getEnvelope2D(),!0),_=new Ys(n);if(l){const t=(0,o.Y)(s,m.getEnvelopeZs(),!0);return _.planarSimplify3DImpl_(d,p,t,0,!0)}return _.m_bOGCOutput=!0,_.planarSimplifyMultiPoints(d,p,!1,-1)}function Bs(t,e,s,n,a,l=!1){e<2&&(0,i.a)("not enough geometries to dissolve");let h=0;for(let i=0,r=e;i<r;i++)h=Math.max(t[i].getDimension(),h);if(2===h||1===h)return new Ys(n).dissolveMultiPaths_(h,!0,t,e,s,a,l);const u=o.n.constructEmpty(),c=new r.E;let m=r.n,d=0,g=-1;for(let i=0,y=e;i<y;i++)if(t[i].getDimension()===h&&(-1===g&&(g=i),!t[i].isEmpty())){g=i,m===r.n?m=c.addGeometry(Hs(t[i])):c.appendGeometry(m,Hs(t[i]));const e=o.n.constructEmpty();t[i].queryLooseEnvelope(e),u.mergeEnv3D(e),d++}if(d<2)return Hs(t[g]);const p=0===h?s:null,_=(0,o.c)(p,u.getEnvelope2D(),!0),f=new Ys(n);if(l){const t=(0,o.Y)(p,u.getEnvelopeZs(),!0);return f.m_bOGCOutput=!0,f.planarSimplify3DImpl_(c,_,t,0,!0)}return f.planarSimplifyMultiPoints(c,_,!0,-1)}class Ys{constructor(t){this.m_topoGraph=null,this.m_maskLookup=[],this.m_dummyPt1=a.P.getNAN(),this.m_dummyPt2=a.P.getNAN(),this.m_fromEdgeForPolylines=r.n,this.m_progressCounter=0,this.m_bOGCOutput=!1,this.m_progressTracker=t}linesToPolygonsImpl(t,e){let s=0,n=0,i=null;if(t.hasCurves()){i=new xs;const r=t.getEnvelope2D(this.m_progressTracker);n=fs(e.total());const o=_s(e.total(),r);s=ys(o,n),ms(t,o,e.total(),0,i,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(t,e.add(s));const o=this.m_topoGraph.createUserIndexForChains(),a=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(a,o,1);for(let h=this.m_topoGraph.getChainFirstIsland(a);h!==r.n;h=this.m_topoGraph.getChainNextInParent(h))this.m_topoGraph.setChainUserIndex(h,o,1);const l=[];for(let h=this.m_topoGraph.getFirstChain();h!==r.n;h=this.m_topoGraph.getChainNext(h)){if(1===this.m_topoGraph.getChainUserIndex(h,o))continue;this.m_topoGraph.setChainUserIndex(h,o,1);for(let t=this.m_topoGraph.getChainFirstIsland(h);t!==r.n;t=this.m_topoGraph.getChainNextInParent(t))this.m_topoGraph.setChainUserIndex(t,o,1);if(0===this.m_topoGraph.getChainArea(h))continue;const e=this.m_topoGraph.extractPolygonFromChainAndIslands(t,r.n,h,r.n);null!=i&&i.stitchCurves(t,e,n,!1);const s=t.getGeometry(e);l.push(s)}return new m.S(l)}autoCompleteImpl(t,e,s){let n=0,i=0,o=null;if(t.hasCurves()){o=new xs;const e=t.getEnvelope2D(this.m_progressTracker);i=fs(s.total());const r=_s(s.total(),e);n=ys(r,i),ms(t,r,s.total(),0,o,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(t,s.add(n));const a=this.m_topoGraph.getGeometryID(e),l=this.m_topoGraph.createUserIndexForChains(),h=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(h,l,1);for(let c=this.m_topoGraph.getChainFirstIsland(h);c!==r.n;c=this.m_topoGraph.getChainNextInParent(c))this.m_topoGraph.setChainUserIndex(c,l,1);const u=[];for(let c=this.m_topoGraph.getFirstChain();c!==r.n;c=this.m_topoGraph.getChainNext(c)){if(1===this.m_topoGraph.getChainUserIndex(c,l))continue;this.m_topoGraph.setChainUserIndex(c,l,1);for(let t=this.m_topoGraph.getChainFirstIsland(c);t!==r.n;t=this.m_topoGraph.getChainNextInParent(t))this.m_topoGraph.setChainUserIndex(t,l,1);if(0!==this.m_topoGraph.getChainParentage(c))continue;const e=this.m_topoGraph.getChainHalfEdge(c);let s=e,n=!1;do{const t=this.m_topoGraph.getHalfEdgeTwin(s);if(this.m_topoGraph.getHalfEdgeChain(t)!==c&&this.m_topoGraph.getHalfEdgeParentage(s)&a){n=!0;break}s=this.m_topoGraph.getHalfEdgeNext(s)}while(s!==e);if(!n)continue;if(0===this.m_topoGraph.getChainArea(c))continue;const h=this.m_topoGraph.extractPolygonFromChainAndIslands(t,r.n,c,r.n);null!==o&&o.stitchCurves(t,h,i,!1);const m=t.getGeometry(h);u.push(m)}return new m.S(u)}setEditShape(t,e=!1){null===this.m_topoGraph&&(this.m_topoGraph=new tt),this.m_topoGraph.setEditShape(t,this.m_progressTracker,!0,e)}setEditShapeCrackAndCluster(t,e){bs(t,e,this.m_progressTracker,!0,!1);for(let s=t.getFirstGeometry();s!==r.n;s=t.getNextGeometry(s))t.getGeometryType(s)===i.G.enumPolygon&&zt(t,s,-1,this.m_bOGCOutput,r.n,this.m_progressTracker);this.setEditShape(t)}setHalfEdgeOrientations_(t,e){const s=this.m_topoGraph.getShape();for(let n=s.getFirstGeometry();n!==r.n;n=s.getNextGeometry(n))if(n===e)for(let e=s.getFirstPath(n);e!==r.n;e=s.getNextPath(e)){let n=s.getFirstVertex(e);if(n===r.n)continue;let i=s.getNextVertex(n);for(;i!==r.n;){const e=this.m_topoGraph.getClusterFromVertex(n),o=this.m_topoGraph.getClusterFromVertex(i),a=this.m_topoGraph.getHalfEdgeConnector(e,o);if(a!==r.n){const e=this.m_topoGraph.getHalfEdgeTwin(a);this.m_topoGraph.setHalfEdgeUserIndex(a,t,1),this.m_topoGraph.setHalfEdgeUserIndex(e,t,2)}n=i,i=s.getNextVertex(n)}}}flushVertices_(t,e){const s=this.m_topoGraph.getShape(),n=s.hasSegmentParentage(),i=new r.S,o=s.insertPath(t,r.n);e.push(e[0]);const a=e.length;let l=r.n;for(let r=0;r<a;r++){const t=e[r];if(l=s.addVertex(o,t),!n)continue;const h=this.m_topoGraph.getClusterFromVertex(t);if(r>0&&this.m_topoGraph.isBreakNode(h)&&s.setSegmentParentageBreakVertex(l,!0),r<a-1){const t=this.m_topoGraph.getHalfEdgeConnector(h,this.m_topoGraph.getClusterFromVertex(e[r+1])),n=this.m_topoGraph.getSegmentParentage(t);s.setSegmentParentageAndBreak(l,n,r>0||this.m_topoGraph.isBreakNode(h)),this.m_topoGraph.isHalfEdgeCurve(t)&&(this.m_topoGraph.querySegmentXY(t,i),s.setSegmentToIndex(s.getVertexIndex(l),i.get().clone()))}}if(n){const t=this.m_topoGraph.getClusterFromVertex(e[a-1]);this.m_topoGraph.isBreakNode(t)&&s.setSegmentParentageBreakVertex(l,!0)}s.setClosedPath(o,!0)}processPolygonCuts_(t,e,s,n){const o=this.m_topoGraph.getGeometryID(s),a=this.m_topoGraph.getGeometryID(n),l=[],h=this.m_topoGraph.getShape(),u=this.m_topoGraph.createUserIndexForHalfEdges();for(let c=this.m_topoGraph.getFirstCluster();c!==r.n;c=this.m_topoGraph.getNextCluster(c)){const s=this.m_topoGraph.getClusterHalfEdge(c);if(s===r.n)continue;let n=s;do{if(1!==this.m_topoGraph.getHalfEdgeUserIndex(n,u)){let s=n,r=n,c=!1,m=0;do{if(this.m_topoGraph.setHalfEdgeUserIndex(s,u,1),c||this.m_topoGraph.getHalfEdgeParentage(s)&a&&this.m_topoGraph.getHalfEdgeFaceParentage(s)&o&&(r=s,c=!0),c){const e=this.m_topoGraph.getHalfEdgeOrigin(s),n=this.m_topoGraph.getClusterVertexIterator(e),i=this.m_topoGraph.getVertexFromVertexIterator(n);l.push(i),-1!==t&&this.m_topoGraph.getHalfEdgeParentage(s)&a&&(m|=this.m_topoGraph.getHalfEdgeUserIndex(s,t))}s=this.m_topoGraph.getHalfEdgeNext(s)}while(s!==r);if(c&&this.m_topoGraph.getChainArea(this.m_topoGraph.getHalfEdgeChain(r))>0){const t=h.createGeometry(i.G.enumPolygon);this.flushVertices_(t,l),-1!==e&&h.setGeometryUserIndex(t,e,m)}l.length=0}n=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(n))}while(n!==s)}this.m_topoGraph.deleteUserIndexForHalfEdges(u)}cutPolygonPolyline_(t,e,s,n){this.m_topoGraph.removeSpikes_();let i=-1;-1!==t&&(i=this.m_topoGraph.createUserIndexForHalfEdges(),this.setHalfEdgeOrientations_(i,s)),this.processPolygonCuts_(i,t,e,s),-1!==i&&(this.m_topoGraph.deleteUserIndexForHalfEdges(i),i=-1);const o=this.m_topoGraph.getShape();for(let a=o.getFirstGeometry();a!==r.n;a=o.getNextGeometry(a))a!==e&&a!==s&&n.push(a);n.sort(((t,e)=>{const s=o.getFirstPath(t),n=o.getRingArea(s),i=o.getFirstPath(e),r=o.getRingArea(i);return n<r?-1:n>r?1:0}))}cut(t,e,s,n,r){const o=this.m_topoGraph.getShape().getGeometryType(s),a=this.m_topoGraph.getShape().getGeometryType(n),l=(0,i.z)(o),h=(0,i.z)(a);2!==l||1!==h?1!==l||1!==h?(0,i.d)(""):new js(this,t,e,s,n,r).Do():this.cutPolygonPolyline_(e,s,n,r)}progress_(t=!1){}isGoodParentage(t){return t>=0&&t<this.m_maskLookup.length&&this.m_maskLookup[t]}normalizeInputGeometry(t){const e=t.getGeometryType();if(e===i.G.enumEnvelope){const e=new r.a({vd:t.getDescription()});return t.isEmpty()||e.addEnvelope(t,!1),e}if(e===i.G.enumPoint){const e=new r.M({vd:t.getDescription()});return t.isEmpty()||e.add(t),e}if((0,i.f)(e)){const e=new r.P({vd:t.getDescription()});return t.isEmpty()||e.addSegment(t,!0),e}return e!==i.G.enumMultiPoint&&e!==i.G.enumPolyline&&e!==i.G.enumPolygon&&(0,i.a)("Unexpected geometry type"),t}dissolveNonSimplePolygons(t,e,s,n){(0,i.g)(e>0);const o=new r.E;let a=0,l=-1;for(let i=0,r=e;i<r;i++)2===t[i].getDimension()&&(-1===l&&(l=i),t[i].isEmpty()||(a++,o.addGeometry(t[i])));return 0===a?((0,i.g)(l>=0),this.normalizeInputGeometry(t[l])):this.planarSimplifyPolygons(o,s,!0,!1,-1,!0)}dissolveMultiPaths_(t,e,s,l,h,u,c){(0,i.g)(t>=1&&t<=2),(0,i.g)(l>0);const m=8&u?1:2,d=o.n.constructEmpty();let g=0,p=-1,_=!0;for(let n=0,r=l;n<r;n++)if(s[n].getDimension()===t&&(-1===p&&(p=n),!s[n].isEmpty())){p=n,g++;const e=o.n.constructEmpty();if(s[n].queryLooseEnvelope(e),d.mergeEnv3D(e),2===t&&_&&s[n].getGeometryType()===i.G.enumPolygon)if(16&u){const t=[0],e=s[n].getImpl().getIsSimple(0,t),i=this.m_bOGCOutput?5===e:(0,o.i)(e);_&&=i}else{const t=(0,o.h)(s[n],0);_&&=t}}if(g<2&&((0,i.g)(p>=0),0===g||!(16&u)))return this.normalizeInputGeometry(s[p]);if(!_){const t=(0,o.c)(e?null:h,d.getEnvelope2D(),!0);return this.dissolveNonSimplePolygons(s,l,t,u)}const f=s.slice(0,l),y=(0,o.c)(h,d.getEnvelope2D(),!0),x=10*(0,o.e)(y);let v=new o.C(0,0);if(c&&(v=(0,o.Y)(h,d.getEnvelopeZs(),!0)),1===g&&1===t&&2===m&&!e)return c?((0,i.g)(0),{}):this.m_bOGCOutput?ks(f[p],y,!1,-1,this.m_progressTracker,m,!1):Ls(f[p],y,!1,!1,-1,this.m_progressTracker,m,!1);const b=new o.a2;b.startConstruction();let P=2===t?3:4,S=0;for(let r=0,a=l;r<a;r++){if(f[r].getDimension()!==t||f[r].isEmpty())continue;let s=f[r].getGeometryType();if(s!==i.G.enumEnvelope){if((0,i.f)(s)?(f[r]=this.normalizeInputGeometry(f[r]),s=i.G.enumPolyline):(0,i.g)((0,i.h)(s)),1===t){(0,i.g)(s===i.G.enumPolyline);let t=-1;if(c)(0,i.g)(0,"3d not implemented yet");else{const e=[0];t=f[r].getImpl().getIsSimple(y.total(),e)}if(this.m_bOGCOutput?5!==t:!(0,o.i)(t))if(e)P=-1;else{c?(0,i.g)(0,"3d not implemented yet"):this.m_bOGCOutput?f[r]=ks(f[r],y,!1,-1,this.m_progressTracker,m,!1):f[r]=Ls(f[r],y,!1,!1,-1,this.m_progressTracker,m,!1);const t=[0];(0,i.g)((0,o.i)(f[r].getImpl().getIsSimple(y.total(),t)))}}else{(0,i.g)(s===i.G.enumPolygon);const t=[0],e=f[r].getImpl().getIsSimple(0,t);(0,i.g)((0,o.X)(e))}const a=f[r].getImpl();for(let t=0,e=a.getPathCount();t<e;t++){const e=n.Envelope2D.constructEmpty();a.queryLoosePathEnvelope(t,e),e.inflateCoords(x,x),b.addEnvelope(S,e),S++}}else{(0,i.g)(s===i.G.enumEnvelope);const t=n.Envelope2D.constructEmpty();f[r].queryLooseEnvelope(t),t.inflateCoords(x,x),b.addEnvelope(S,t),S++,P=-1}}b.endConstruction();const E=S,C=(0,a.d)(E,-2147483647),w=(0,a.d)(E,-1);let I=0;p=-1,S=0;for(let n=0,r=l;n<r;n++){if(f[n].getDimension()!==t)continue;if(-1===p&&(p=n),f[n].isEmpty())continue;p=n,I++;const e=f[n].getGeometryType();if((0,i.h)(e))for(let t=0,s=f[n].getPathCount();t<s;t++)w[S]=n,C[S]=-t-1,S++;else(0,i.g)(e===i.G.enumEnvelope),w[S]=n,C[S]=-1,S++}if(I<2&&2===t)return(0,i.g)(p>=0),this.normalizeInputGeometry(f[p]);let T=E;for(;b.next()&&T>0;){this.progress_();const t=b.getHandleA(),e=b.getHandleB(),s=b.getElement(t),n=b.getElement(e);w[s]!==w[n]&&(C[s]<0&&(T--,C[s]=-(C[s]+1)),C[n]<0&&(T--,C[n]=-(C[n]+1)))}const A=new r.E;let M,D=!1,N=0;for(let n=0,o=l;n<o;n++){if(f[n].getDimension()!==t||f[n].isEmpty())continue;const e=f[n].getGeometryType(),s=N;let o=0,a=0;const l=(0,i.h)(e)?f[n]:null;for(let t=s,r=C.length;t<r&&w[t]===n;t++)C[t]>=0&&(o++,a+=l?l.getPathSize(C[t]):(0,i.v)(f[n])),N++;if(a>.95*(0,i.v)(f[n])){A.addGeometry(this.normalizeInputGeometry(f[n]));for(let t=s;t<N;t++)C[t]<0&&(C[t]=-(C[t]+1))}else{if(0===o){D=!0;continue}{D=!0,(0,i.g)((0,i.h)(e)),(0,i.g)(null!=l);const t=new r.a({vd:f[n].getDescription()}),o=new r.P({vd:f[n].getDescription()}),a=e===i.G.enumPolygon?t:o;for(let e=s;e<N;e++)C[e]>=0&&a.addPath(l,C[e],!0);A.addGeometry(a)}}}if(A.getFirstGeometry()!==r.n){const s=2===t,n=e?(0,o.c)(null,d.getEnvelope2D(),!0):y;let i=new o.C(0,0);if(c&&(i=e?(0,o.Y)(null,d.getEnvelopeZs(),!0):v),2===t&&!(2&u)){A.collapseAllGeometriesToFirst();let t=0,e=null;if(A.hasCurves()&&!A.hasSegmentParentage()){e=new xs;const s=A.getEnvelope2D(this.m_progressTracker);t=fs(n.total()),ms(A,_s(n.total(),s),n.total(),0,e,null,this.m_progressTracker)}(function(t,e,s,n){s>0&&ot(t,s,e,!1,n),new wt(n).executeImpl_(t,e)})(A,A.getFirstGeometry(),n.total(),this.m_progressTracker),null!==e&&e.stitchCurves(A,r.n,t,!0)}if(c)M=this.planarSimplify3DImpl_(A,n,i,m,!0);else if(2===t)M=this.planarSimplifyPolygons(A,n,s,e,-1,!1);else{const t={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};t.ogcRule=this.m_bOGCOutput,t.allCrossRoadsImpassable=!0,t.unsplitBehavior=m,M=this.planarSimplifyPolylines(A,n,e,t,-1)}if(!D){const t=[0];P=M.getImpl().getIsSimple(n.total(),t)}}else(0,i.g)(D),(0,i.g)(p>=0),M=2===t?new r.a({vd:f[p].getDescription()}):new r.P({vd:f[p].getDescription()});if(D){let t=0;for(let e=0,s=C.length;e<s;e++){const s=w[e];if(!(s<0)&&C[e]<0){const n=f[s].getGeometryType(),r=(0,i.h)(n)?f[s]:null;if(r){const s=-(C[e]+1);t+=r.getPathSize(s)}else t+=4}}M.reserve(M.getPointCount()+t);for(let e=0,s=C.length;e<s;e++){const t=w[e];if(!(t<0)&&C[e]<0){const s=f[t].getGeometryType(),n=(0,i.h)(s)?f[t]:null;if(n){const t=-(C[e]+1);M.addPath(n,t,!0)}else s===i.G.enumEnvelope?M.addEnvelope(f[t],!1):((0,i.g)((0,i.f)(s)),M.addSegment(f[t],!0))}}}let F=0;if(2===t?-1!==P&&(P=3,F=e?0:y.total()):((0,i.g)(1===t),e||-1===P||(F=y.total())),c||M.getImpl().setIsSimple(P,F),!e&&D)if(2===t){if(!c)return(new un).execute(M,h,!1,this.m_progressTracker);(0,i.g)(0,"3d not yet implemented")}else 1===t&&1!==m&&(M=c?((0,i.g)(0),{}):function(t,e,s,n){const o=new Ys(n),a=new r.E,l=a.addGeometry(e),h=o.planarSimplifyNoCrackingAndCluster(t,a,l,s);return(0,i.g)(h,"planar_simplify_no_cracking_and_cluster"),a.getGeometry(l)}(this.m_bOGCOutput,M,m,this.m_progressTracker),M.getImpl().setIsSimple(P,F));return M}dissolveTopoGraphCommonEdges_(){const t=this.m_topoGraph.createUserIndexForHalfEdges(),e=[];for(let s=this.m_topoGraph.getFirstCluster();s!==r.n;s=this.m_topoGraph.getNextCluster(s)){const n=this.m_topoGraph.getClusterHalfEdge(s);let i=n;if(n!==r.n)do{if(this.progress_(),1!==this.m_topoGraph.getHalfEdgeUserIndex(i,t)){const s=this.m_topoGraph.getHalfEdgeTwin(i);this.m_topoGraph.setHalfEdgeUserIndex(s,t,1),this.m_topoGraph.setHalfEdgeUserIndex(i,t,1);const n=this.m_topoGraph.getHalfEdgeFaceParentage(i);if(this.isGoodParentage(n)){const t=this.m_topoGraph.getHalfEdgeFaceParentage(s);this.isGoodParentage(t)&&e.push(i)}}i=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(i))}while(i!==n)}this.m_topoGraph.deleteUserIndexForHalfEdges(t),this.m_topoGraph.deleteEdgesBreakFaces_(e)}chooseVertexByOrder(t,e,s,n){let o=(0,a.j)(),l=r.n;for(let i=this.m_topoGraph.getClusterVertexIterator(t);i!==r.n;i=this.m_topoGraph.incrementVertexIterator(i)){const t=this.m_topoGraph.getVertexFromVertexIterator(i),n=e.getUserIndex(t,s);n>=0&&n<o&&(o=n,l=t)}(0,i.g)(l!==r.n);let h=e.getUserIndex(l,n);return h>0&&(e.setUserIndex(l,n,--h),0===h&&e.setUserIndex(l,s,-1)),l}chooseVertexFromCluster_(t,e){return this.m_topoGraph.getVertexDominantFromCluster(t,e)}chooseVertexFromVertexCluster_(t,e){return this.m_topoGraph.getVertexDominant(t,e)}collectPolygonPathsPreservingFrom_(t,e,s,n,o){const a=this.m_topoGraph.getShape();if(a.getGeometryType(t)!==i.G.enumPolygon)return;const l=a.hasSegmentParentage(),h=new r.S;for(let i=a.getFirstPath(t);i!==r.n;i=a.getNextPath(i)){const t=a.getFirstVertex(i);this.m_topoGraph.getClusterFromVertex(t);const u=this.m_topoGraph.getHalfEdgeFromVertex(t);if(u===r.n)continue;const c=this.m_topoGraph.getHalfEdgeUserIndex(u,s);if(1===c||2===c)continue;const m=this.m_topoGraph.getHalfEdgeFaceParentage(u);if(!this.isGoodParentage(m)){this.m_topoGraph.setHalfEdgeUserIndex(u,s,2);continue}this.m_topoGraph.setHalfEdgeUserIndex(u,s,1);const d=a.insertPath(e,r.n);a.setClosedPath(d,!0);let g=u,p=t,_=this.m_topoGraph.getClusterFromVertex(p),f=1;do{this.progress_();const t=this.chooseVertexFromVertexCluster_(p,o),e=a.addVertex(d,t);if(this.m_topoGraph.isHalfEdgeCurve(g)&&(this.m_topoGraph.querySegmentXY(g,h),a.setSegmentToIndex(a.getVertexIndex(e),h.get().clone())),l){const t=this.m_topoGraph.getSegmentParentage(g);a.setSegmentParentageAndBreak(e,t,this.m_topoGraph.isBreakNode(_))}let i,u;-1!==n&&this.m_topoGraph.setClusterUserIndex(_,n,1),this.m_topoGraph.setHalfEdgeUserIndex(g,s,1),g=this.m_topoGraph.getHalfEdgeNext(g);do{i=1===f?a.getNextVertex(p):a.getPrevVertex(p),u=i!==r.n?this.m_topoGraph.getClusterFromVertex(i):r.n}while(u===_);const c=this.m_topoGraph.getHalfEdgeOrigin(g);if(c!==u){do{i=1===f?a.getPrevVertex(p):a.getNextVertex(p),u=i!==r.n?this.m_topoGraph.getClusterFromVertex(i):r.n}while(u===_);if(c!==u){u=c;const t=this.m_topoGraph.getClusterVertexIterator(u);i=this.m_topoGraph.getVertexFromVertexIterator(t)}else f=-f}_=u,p=i}while(g!==u)}}topoOperationPolygonPolygonHelper_(t,e,s,n,i,o){this.progress_(!0),t!==r.n&&this.collectPolygonPathsPreservingFrom_(t,s,i,o,n),e!==r.n&&this.collectPolygonPathsPreservingFrom_(e,s,i,o,n);const a=new r.S,l=this.m_topoGraph.getShape();l.dbgVerifyCurves();const h=l.hasSegmentParentage();for(let u=this.m_topoGraph.getFirstCluster();u!==r.n;u=this.m_topoGraph.getNextCluster(u)){const t=this.m_topoGraph.getClusterHalfEdge(u);if(t===r.n)continue;let e=t;do{this.progress_();const t=this.m_topoGraph.getHalfEdgeUserIndex(e,i);if(1!==t&&2!==t){const t=this.m_topoGraph.getHalfEdgeFaceParentage(e);if(this.isGoodParentage(t)){const t=l.insertPath(s,r.n);l.setClosedPath(t,!0);let u=e;do{const e=this.m_topoGraph.getHalfEdgeVertexIterator(u);let s=r.n;if(e!==r.n)s=this.m_topoGraph.getVertexFromVertexIterator(e);else{const t=this.m_topoGraph.getHalfEdgeVertexIterator(this.m_topoGraph.getHalfEdgeTwin(u));s=this.m_topoGraph.getVertexFromVertexIterator(t),s=l.getNextVertex(s)}const c=this.chooseVertexFromVertexCluster_(s,n),m=l.addVertex(t,c);if(h){const t=this.m_topoGraph.getSegmentParentage(u),e=this.m_topoGraph.getHalfEdgeOrigin(u);l.setSegmentParentageAndBreak(m,t,this.m_topoGraph.isBreakNode(e))}if(this.m_topoGraph.isHalfEdgeCurve(u)&&(this.m_topoGraph.querySegmentXY(u,a),l.setSegmentToIndex(l.getVertexIndex(m),a.get().clone())),this.m_topoGraph.setHalfEdgeUserIndex(u,i,1),-1!==o){const t=this.m_topoGraph.getClusterFromVertex(c);this.m_topoGraph.setClusterUserIndex(t,o,1)}u=this.m_topoGraph.getHalfEdgeNext(u)}while(u!==e)}else this.m_topoGraph.setHalfEdgeUserIndex(e,i,2)}e=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(e))}while(e!==t)}}topoOperationPolygonPolygon_(t,e,s,n=!1){this.dissolveTopoGraphCommonEdges_();const o=this.m_topoGraph.getShape(),a=o.createGeometry(i.G.enumPolygon),l=this.m_topoGraph.createUserIndexForHalfEdges();return this.topoOperationPolygonPolygonHelper_(t,e,a,s,l,-1),this.m_topoGraph.deleteUserIndexForHalfEdges(l),n||zt(o,a,3,this.m_bOGCOutput,r.n,this.m_progressTracker),a}topoOperationPolyline_(t,e){const s={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};return s.allCrossRoadsImpassable=!1,s.ogcRule=e,s.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(r.n,t,!1,s).first}topoOperationMultiPoint_(){const t=this.m_topoGraph.getShape(),e=t.createGeometry(i.G.enumMultiPoint),s=t.insertPath(e,r.n);for(let n=this.m_topoGraph.getFirstCluster();n!==r.n;n=this.m_topoGraph.getNextCluster(n)){const e=this.m_topoGraph.getClusterParentage(n);if(this.isGoodParentage(e)){let e=r.n;for(let s=this.m_topoGraph.getClusterVertexIterator(n);s!==r.n;s=this.m_topoGraph.incrementVertexIterator(s)){const n=this.m_topoGraph.getVertexFromVertexIterator(s);e===r.n&&(e=n);const i=t.getGeometryFromPath(t.getPathFromVertex(n)),o=this.m_topoGraph.getGeometryID(i);if(this.isGoodParentage(o)){e=n;break}}t.addVertex(s,e)}}return e}intersection(t,e){const s=this.m_topoGraph.getShape().getGeometryType(t),n=this.m_topoGraph.getShape().getGeometryType(e),o=(0,i.z)(s),a=(0,i.z)(n),l=this.m_topoGraph.getGeometryID(t),h=this.m_topoGraph.getGeometryID(e);(0,i.g)(l>=0),(0,i.g)(h>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(l|h),this.m_maskLookup[l|h]=!0;let u=r.n;return this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(u=t),2===o&&2===a?this.topoOperationPolygonPolygon_(t,e,u):1===o&&a>0||1===a&&o>0?this.topoOperationPolyline_(u,this.m_bOGCOutput):0===o||0===a?this.topoOperationMultiPoint_():void(0,i.d)("")}topoOperationPolygonPolygonEx(t,e,s){const n=this.m_topoGraph.getShape(),o=n.createGeometry(i.G.enumPolygon),a=n.createGeometry(i.G.enumPolyline),l=n.createGeometry(i.G.enumMultiPoint);this.dissolveTopoGraphCommonEdges_();let h=r.n;const u=this.m_topoGraph.createUserIndexForHalfEdges(),c=this.m_topoGraph.createUserIndexForClusters();n.dbgVerifyCurves(),this.topoOperationPolygonPolygonHelper_(t,e,o,s,u,c),n.dbgVerifyCurves();const m=n.hasSegmentParentage(),d=new r.S;for(let i=this.m_topoGraph.getFirstCluster();i!==r.n;i=this.m_topoGraph.getNextCluster(i)){const t=this.m_topoGraph.getClusterHalfEdge(i);if(t===r.n)continue;let e=t;do{let t=this.m_topoGraph.getHalfEdgeUserIndex(e,u),o=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(e),u),l=t|o;if(2===l){let h=this.m_topoGraph.getHalfEdgeParentage(e);if(this.isGoodParentage(h)){const g=n.insertPath(a,r.n);let p=e;const _=this.chooseVertexFromCluster_(i,s);let f=n.addVertex(g,_);if(m){const t=this.m_topoGraph.getSegmentParentage(e),s=this.m_topoGraph.getHalfEdgeOrigin(e);n.setSegmentParentageAndBreak(f,t,this.m_topoGraph.isBreakNode(s))}this.m_topoGraph.isHalfEdgeCurve(e)&&(this.m_topoGraph.querySegmentXY(e,d),n.setSegmentToIndex(n.getVertexIndex(f),d.get().clone())),this.m_topoGraph.setClusterUserIndex(i,c,1);do{this.progress_();const i=this.m_topoGraph.getHalfEdgeTo(p),r=this.chooseVertexFromCluster_(i,s);if(f=n.addVertex(g,r),m){const t=this.m_topoGraph.getSegmentParentage(e),s=this.m_topoGraph.getHalfEdgeOrigin(e);n.setSegmentParentageAndBreak(f,t,this.m_topoGraph.isBreakNode(s))}if(this.m_topoGraph.setHalfEdgeUserIndex(p,u,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(p),u,1),this.m_topoGraph.setClusterUserIndex(i,c,1),p=this.m_topoGraph.getHalfEdgeNext(p),t=this.m_topoGraph.getHalfEdgeUserIndex(p,u),o=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(p),u),l=t|o,2!==l)break;if(h=this.m_topoGraph.getHalfEdgeParentage(p),!this.isGoodParentage(h)){this.m_topoGraph.setHalfEdgeUserIndex(p,u,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(p),u,1);break}this.m_topoGraph.isHalfEdgeCurve(e)&&p!==e&&(this.m_topoGraph.querySegmentXY(e,d),n.setSegmentToIndex(n.getVertexIndex(f),d.get().clone()))}while(p!==e)}else this.m_topoGraph.setHalfEdgeUserIndex(e,u,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(e),u,1)}e=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(e))}while(e!==t)}for(let i=this.m_topoGraph.getFirstCluster();i!==r.n;i=this.m_topoGraph.getNextCluster(i)){if(this.progress_(),1===this.m_topoGraph.getClusterUserIndex(i,c))continue;const t=this.m_topoGraph.getClusterParentage(i);if(this.isGoodParentage(t)){h===r.n&&(h=n.insertPath(l,r.n));const t=this.m_topoGraph.getClusterVertexIterator(i);let e=r.n;if(t!==r.n){e=this.m_topoGraph.getVertexFromVertexIterator(t);const i=this.chooseVertexFromVertexCluster_(e,s);n.addVertex(h,i)}}}this.m_topoGraph.deleteUserIndexForClusters(c),this.m_topoGraph.deleteUserIndexForHalfEdges(u),n.dbgVerifyCurves(),zt(n,o,3,this.m_bOGCOutput,r.n,this.m_progressTracker);const g=[r.n,r.n,r.n];return g[0]=l,g[1]=a,g[2]=o,g}topoOperationPolylinePolylineOrPolygonEx(t,e){const s={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};return s.allCrossRoadsImpassable=!1,s.ogcRule=e,s.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(r.n,t,!0,s)}topoOperationMultiPoint(){const t=this.m_topoGraph.getShape(),e=t.createGeometry(i.G.enumMultiPoint),s=t.insertPath(e,r.n);for(let n=this.m_topoGraph.getFirstCluster();n!==r.n;n=this.m_topoGraph.getNextCluster(n)){const e=this.m_topoGraph.getClusterParentage(n);if(this.isGoodParentage(e)){let e=r.n;for(let s=this.m_topoGraph.getClusterVertexIterator(n);s!==r.n;s=this.m_topoGraph.incrementVertexIterator(s)){const n=this.m_topoGraph.getVertexFromVertexIterator(s);e===r.n&&(e=n);const i=t.getGeometryFromPath(t.getPathFromVertex(n)),o=this.m_topoGraph.getGeometryID(i);if(this.isGoodParentage(o)){e=n;break}}t.addVertex(s,e)}}return e}intersectionEx(t,e){const s=this.m_topoGraph.getShape().getGeometryType(t),n=this.m_topoGraph.getShape().getGeometryType(e),o=Ns(s),a=Ns(n),l=this.m_topoGraph.getGeometryID(t),h=this.m_topoGraph.getGeometryID(e);(0,i.g)(l>=0),(0,i.g)(h>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(l|h),this.m_maskLookup[l|h]=!0;let u=r.n;if(this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(u=t),2===o&&2===a)return this.topoOperationPolygonPolygonEx(t,e,u);if(1===o&&a>0||1===a&&o>0){const{first:t,second:e}=this.topoOperationPolylinePolylineOrPolygonEx(u,this.m_bOGCOutput);return[e,t]}if(0===o||0===a){const t=[];return t.push(this.topoOperationMultiPoint()),t}(0,i.d)("")}getCombinedHalfEdgeParentage(t){return this.m_topoGraph.getHalfEdgeParentage(t)|this.m_topoGraph.getHalfEdgeFaceParentage(t)|this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(t))}prevailingDirection(t,e){const s=this.getCombinedHalfEdgeParentage(e),n=this.m_topoGraph.getHalfEdgeOrigin(e),i=this.m_topoGraph.getHalfEdgeTo(e);let o=0,l=0;for(let a=this.m_topoGraph.getClusterVertexIterator(n);a!==r.n;a=this.m_topoGraph.incrementVertexIterator(a)){const n=this.m_topoGraph.getVertexFromVertexIterator(a),h=t.getPathFromVertex(n),u=t.getGeometryFromPath(h),c=this.m_topoGraph.getGeometryID(u),m=t.getFirstVertex(h),d=!!(c&s);d&&m===n&&(this.m_fromEdgeForPolylines=e);const g=t.getNextVertex(n);if(g!==r.n&&this.m_topoGraph.getClusterFromVertex(g)===i){if(o++,d){if(this.m_fromEdgeForPolylines===r.n&&m===g){const t=this.m_topoGraph.getHalfEdgeNext(e);this.isGoodParentage(this.getCombinedHalfEdgeParentage(t))&&(this.m_fromEdgeForPolylines=t)}l++}}else{const s=t.getPrevVertex(n);if(s!==r.n&&this.m_topoGraph.getClusterFromVertex(s)===i&&(o--,d)){if(this.m_fromEdgeForPolylines===r.n&&m===s){const t=this.m_topoGraph.getHalfEdgeNext(e);this.isGoodParentage(this.getCombinedHalfEdgeParentage(t))&&(this.m_fromEdgeForPolylines=t)}l--}}}return this.m_topoGraph.queryXY(n,this.m_dummyPt1),this.m_topoGraph.queryXY(i,this.m_dummyPt2),(0!==l?l:o)*a.P.distance(this.m_dummyPt1,this.m_dummyPt2)}tryMoveThroughCrossroadBackwards(t,e){const s=this.m_topoGraph.getHalfEdgePrev(t),n=this.m_topoGraph.getHalfEdgeTwin(s);if(!e){if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(t)))return r.n;const e=this.m_topoGraph.getHalfEdgeTwin(t);if(n===this.m_topoGraph.getHalfEdgeNext(e))return s}let i=n,o=r.n;for(;i!==t;){const t=this.getCombinedHalfEdgeParentage(i);if(this.isGoodParentage(t)){if(o!==r.n)return r.n;o=this.m_topoGraph.getHalfEdgeTwin(i)}i=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgePrev(i))}return o}tryMoveThroughCrossroadForward(t,e){const s=this.m_topoGraph.getHalfEdgeNext(t),n=this.m_topoGraph.getHalfEdgeTwin(s);if(!e){const e=this.m_topoGraph.getHalfEdgeTwin(t);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(e)))return r.n;if(n===this.m_topoGraph.getHalfEdgePrev(e))return s}let i=n,o=r.n;for(;i!==t;){const t=this.getCombinedHalfEdgeParentage(i);if(this.isGoodParentage(t)){if(o!==r.n)return r.n;o=this.m_topoGraph.getHalfEdgeTwin(i)}i=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgeNext(i))}return o}isOnALoop(t,e){let s=t;const n=2*this.m_topoGraph.getShape().getTotalPointCount()+10;for(let i=0;i<n;i++){if(1===this.m_topoGraph.getHalfEdgeUserIndex(s,e))return!1;const n=this.m_topoGraph.getHalfEdgeNext(s);if(n===this.m_topoGraph.getHalfEdgeTwin(s))return!1;if(s=n,s===t)return!0}(0,i.d)("is_on_a_loop_")}restorePolylineParts(t,e,s,n,o,l,h,u,c,m){(0,i.g)(o===r.n&&l>=0&&h>=0||-1===l&&-1===h),(0,i.g)(-1===u&&1!==m.unsplitBehavior||-1!==u&&1===m.unsplitBehavior);const d=m.ogcRule,g=m.allCrossRoadsImpassable,p=1===m.unsplitBehavior,_=0===m.unsplitBehavior,f=this.m_topoGraph.getShape(),y=f.hasSegmentParentage();let x=t,v=this.m_topoGraph.getHalfEdgeTwin(x);const b=new r.S;this.m_fromEdgeForPolylines=r.n;let P=this.prevailingDirection(f,x),S=x,E=r.n,C=!1,w=!1,I=!1;if(!p)for(;;){const e=this.m_topoGraph.getHalfEdgePrev(x);if(e===v){I=!0;break}const n=this.m_topoGraph.getHalfEdgeNext(v);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(n))){C=!0;break}if(this.m_topoGraph.getHalfEdgeTwin(e)!==n){if(g){C=!0;break}if(x=this.tryMoveThroughCrossroadBackwards(x,!0),x===r.n){C=!0;break}v=this.m_topoGraph.getHalfEdgeTwin(x)}else x=e,v=n;if(1===this.m_topoGraph.getHalfEdgeUserIndex(x,s)){I=!0;break}if(x===t){E=t,w=!0;break}const i=this.getCombinedHalfEdgeParentage(x);if(!this.isGoodParentage(i))break;S=x,P+=this.prevailingDirection(f,x)}if(E===r.n){for(x=t,v=this.m_topoGraph.getHalfEdgeTwin(x),E=x;;){const t=this.m_topoGraph.getHalfEdgeNext(x),e=this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(t));if(e){C=!0;break}if(t===v){I=!0;break}if(-1!==u){const t=this.m_topoGraph.getHalfEdgeOrigin(v);if(1===this.m_topoGraph.getClusterUserIndex(t,u)){C=!0;break}}const n=this.m_topoGraph.getHalfEdgePrev(v);if(this.m_topoGraph.getHalfEdgeTwin(t)!==n){if(e||g){C=!0;break}if(x=this.tryMoveThroughCrossroadForward(x,!0),x===r.n){C=!0;break}v=this.m_topoGraph.getHalfEdgeTwin(x)}else x=t,v=n;if(1===this.m_topoGraph.getHalfEdgeUserIndex(x,s)){I=!0;break}const i=this.getCombinedHalfEdgeParentage(x);if(!this.isGoodParentage(i))break;E=x,P+=this.prevailingDirection(f,x)}const e=this.m_topoGraph.getHalfEdgeOrigin(S);w=this.m_topoGraph.getHalfEdgeTo(E)===e}else if(this.m_fromEdgeForPolylines!==r.n){S=t,E=this.tryMoveThroughCrossroadBackwards(S,!1),(0,i.g)(E!==r.n);const e=this.m_topoGraph.getHalfEdgeTwin(S);this.m_topoGraph.getHalfEdgeNext(e)}let T=w;w||I||c&&(T=this.isOnALoop(t,s),T||(T=this.isOnALoop(v,s)));const A=P>=0;let M=!1;T&&C&&(w?(M=d,A&&(M||p||_)&&S!==t&&((0,i.g)(!p),S=t,M=!1)):(p||A&&_)&&(S=t));let D=0;for(x=S;v=this.m_topoGraph.getHalfEdgeTwin(x),this.m_topoGraph.setHalfEdgeUserIndex(x,s,1),this.m_topoGraph.setHalfEdgeUserIndex(v,s,1),D++,x!==E;)x=g?this.m_topoGraph.getHalfEdgeNext(x):this.tryMoveThroughCrossroadForward(x,!1);A||(E=(0,a.c)(S,S=E),E=this.m_topoGraph.getHalfEdgeTwin(E),S=this.m_topoGraph.getHalfEdgeTwin(S));let N=f.insertPath(e,r.n);x=S;const F=this.m_topoGraph.getHalfEdgeOrigin(S);let R;R=-1!==l?this.chooseVertexByOrder(F,f,l,h):this.chooseVertexFromCluster_(F,o),this.m_topoGraph.isStrongPathNode(F)&&f.setStrongPathStart(N,!0);let k=f.addVertex(N,R),L=k;-1!==n&&this.m_topoGraph.setClusterUserIndex(F,n,1);let G=0;const V=M?Math.trunc((D+1)/2):-1;let z=r.n,O=!0,q=r.n;for(;;){if(y){const t=this.m_topoGraph.getSegmentParentage(x),e=this.m_topoGraph.getHalfEdgeOrigin(x);f.setSegmentParentageAndBreak(L,t,O||this.m_topoGraph.isBreakNode(e))}O=!1,this.m_topoGraph.isHalfEdgeCurve(x)&&(this.m_topoGraph.querySegmentXY(x,b),f.setSegmentToIndex(f.getVertexIndex(L),b.get().clone())),z!==r.n&&-1!==h&&f.addToUserIndex(z,h,-1);const t=g?this.m_topoGraph.getHalfEdgeNext(x):this.tryMoveThroughCrossroadForward(x,!1),s=this.m_topoGraph.getHalfEdgeTo(x);let i;if(i=-1!==l?this.chooseVertexByOrder(s,f,l,h):this.chooseVertexFromCluster_(s,o),k=f.addVertex(N,i),q=s,-1!==n&&this.m_topoGraph.setClusterUserIndex(s,n,1),y&&this.m_topoGraph.isBreakNode(s)&&f.setSegmentParentageBreakVertex(k,!0),z=i,G++,M&&G===V&&(N=f.insertPath(e,r.n),k=f.addVertex(N,i),O=!0,-1!==h&&f.addToUserIndex(i,h,-1),z=r.n),x===E)break;x=t,L=k}q!==r.n&&this.m_topoGraph.isStrongPathNode(q)&&f.setStrongPathEnd(N,!0)}topoOperationPolylineSimplify_(t,e){return this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(t,r.n,!1,e).first}topoOperationPolylineSimplifyOrPolylineTopoHelper_(t,e,s,n){(0,i.g)(e===r.n||t===r.n);const o=this.m_topoGraph.getShape(),l=e=>t===r.n?e===r.n?o.getFirstGeometry():o.getNextGeometry(e):e===r.n?t:r.n,h=o.createGeometry(i.G.enumPolyline);let u=-1;s&&(u=this.m_topoGraph.createUserIndexForClusters());const c=this.m_topoGraph.createUserIndexForHalfEdges(),m=e===r.n?o.createUserIndex():-1,d=e===r.n?o.createUserIndex():-1;let g=-1;if(1===n.unsplitBehavior){g=this.m_topoGraph.createUserIndexForClusters();for(let t=l(r.n);t!==r.n;t=l(t))for(let e=o.getFirstPath(t);e!==r.n;e=o.getNextPath(e)){{const t=o.getFirstVertex(e),s=this.m_topoGraph.getClusterFromVertex(t);this.m_topoGraph.setClusterUserIndex(s,g,1)}if(!o.isClosedPath(e)){const t=o.getLastVertex(e),s=this.m_topoGraph.getClusterFromVertex(t);this.m_topoGraph.setClusterUserIndex(s,g,1)}}}if(e===r.n){let t=0;for(let e=l(r.n);e!==r.n;e=l(e))for(let s=o.getFirstPath(e);s!==r.n;s=o.getNextPath(s))if(o.isClosedPath(s)){let e=o.getFirstVertex(s);for(let n=0,i=o.getPathSize(s);n<i;n++,e=o.getNextVertex(e))o.setUserIndex(e,m,t++),o.setUserIndex(e,d,2)}else{const e=o.getFirstVertex(s);o.setUserIndex(e,m,t++),o.setUserIndex(e,d,1);let n=o.getNextVertex(e);for(let i=1,r=o.getPathSize(s)-1;i<r;++i)o.setUserIndex(n,m,t++),o.setUserIndex(n,d,2),n=o.getNextVertex(n);o.setUserIndex(n,m,t++),o.setUserIndex(n,d,1)}}for(let i=l(r.n);i!==r.n;i=l(i))for(let t=o.getFirstPath(i);t!==r.n;t=o.getNextPath(t)){let s=o.getFirstVertex(t);for(let i=0,a=o.getPathSize(t);i<a;i++,s=o.getNextVertex(s)){const t=this.m_topoGraph.getHalfEdgeFromVertex(s);if(t===r.n)continue;if(1===this.m_topoGraph.getHalfEdgeUserIndex(t,c))continue;const o=this.getCombinedHalfEdgeParentage(t);if(this.isGoodParentage(o)){const s=0===i;this.restorePolylineParts(t,h,c,u,e,m,d,g,s,n)}}}let p=r.n;if(s){p=o.createGeometry(i.G.enumMultiPoint);let t=r.n;for(let s=this.m_topoGraph.getFirstCluster();s!==r.n;s=this.m_topoGraph.getNextCluster(s))if(this.progress_(),1!==this.m_topoGraph.getClusterUserIndex(s,u)){const n=this.m_topoGraph.getClusterParentage(s);if(this.isGoodParentage(n)){t===r.n&&(t=o.insertPath(p,r.n));const n=this.m_topoGraph.getClusterVertexIterator(s);if(n!==r.n){let i;this.m_topoGraph.getVertexFromVertexIterator(n),i=-1!==m?this.chooseVertexByOrder(s,o,m,d):this.chooseVertexFromCluster_(s,e),o.addVertex(t,i)}}}}return-1!==d&&o.removeUserIndex(d),-1!==m&&o.removeUserIndex(m),-1!==u&&o.removeUserIndex(u),this.m_topoGraph.deleteUserIndexForHalfEdges(c),(0,a.k)(h,p)}difference(t,e){const s=this.m_topoGraph.getShape().getGeometryType(t),n=this.m_topoGraph.getShape().getGeometryType(e),o=(0,i.z)(s),a=(0,i.z)(n);if(o>a)return t;const l=this.m_topoGraph.getGeometryID(t),h=this.m_topoGraph.getGeometryID(e);if(this.m_maskLookup.length=0,this.m_maskLookup.length=1+(l|h),this.m_maskLookup[l]=!0,2===o&&2===a){let s=r.n;return this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(s=t),this.topoOperationPolygonPolygon_(t,e,s)}if(1===o&&2===a){const e={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};return e.allCrossRoadsImpassable=!1,e.ogcRule=this.m_bOGCOutput,e.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(t,r.n,!1,e).first}if(1===o&&1===a){const e={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};return e.allCrossRoadsImpassable=!0,e.ogcRule=this.m_bOGCOutput,e.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(t,r.n,!1,e).first}if(0===o)return this.topoOperationMultiPoint_();(0,i.d)("")}symmetricDifference(t,e){const s=this.m_topoGraph.getShape().getGeometryType(t),n=this.m_topoGraph.getShape().getGeometryType(e),o=Ns(s),a=Ns(n),l=this.m_topoGraph.getGeometryID(t),h=this.m_topoGraph.getGeometryID(e);return(0,i.g)(l>=0),(0,i.g)(h>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(l|h),this.m_maskLookup[l]=!0,this.m_maskLookup[l]=!0,this.m_maskLookup[h]=!0,2===o&&2===a?this.topoOperationPolygonPolygon_(t,e,r.n):1===o&&1===a?this.topoOperationPolyline_(r.n,this.m_bOGCOutput):0===o&&0===a?this.topoOperationMultiPoint():void(0,i.d)("")}planarSimplifyNoCrackingAndCluster(t,e,s,n){this.m_bOGCOutput=t,this.m_topoGraph=new tt;const o=e.getFillRule(s),a=e.getGeometryType(s);if(1!==o||a===i.G.enumMultiPoint?this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,s,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeWinding(e,s,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return!1;this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);const l=this.m_topoGraph.getGeometryID(s);if((0,i.g)(l>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=l+1,this.m_maskLookup[l]=!0,e.getGeometryType(s)===i.G.enumPolygon||1===o&&e.getGeometryType(s)!==i.G.enumMultiPoint){e.setFillRule(s,0);const i=this.topoOperationPolygonPolygon_(s,r.n,r.n);if(e.swapGeometry(i,s),e.removeGeometry(i),1===o&&this.m_bOGCOutput)return this.planarSimplifyNoCrackingAndCluster(t,e,s,n)}else if(e.getGeometryType(s)===i.G.enumPolyline){const t={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};t.ogcRule=this.m_bOGCOutput,t.allCrossRoadsImpassable=!0,t.unsplitBehavior=n;const i=this.topoOperationPolylineSimplify_(e.getFirstGeometry(),t);e.swapGeometry(i,s),e.removeGeometry(i)}else if(e.getGeometryType(s)===i.G.enumMultiPoint){const t=this.topoOperationMultiPoint_();e.swapGeometry(t,s),e.removeGeometry(t)}else(0,i.d)("");return!0}unsplitPolylineExact(t){return(0,i.g)(0),new r.P}planarSimplifyPolylines(t,e,s,n,o){for(let g=t.getFirstGeometry();g!==r.n;g=t.getNextGeometry(g)){const e=t.getGeometryType(g);(0,i.g)(e===i.G.enumPolyline)}let a=0,l=0,h=null;if(t.hasCurves()&&!t.hasSegmentParentage()){h=new xs;const s=t.getEnvelope2D(this.m_progressTracker);l=fs(e.total());const n=_s(e.total(),s);a=ys(n,l),ms(t,n,e.total(),0,h,null,this.m_progressTracker)}{const s=Cs(e.add(a));t.filterClosePoints(s,!1,!1,!1,r.n)}if(this.m_topoGraph=new tt,4!==o&&5!==o)if(null===h&&s){const n=new Et(this.m_progressTracker,!1);n.sweepVertical(t,e.total()),n.hadComplications()?(bs(t,e,this.m_progressTracker,!0,!1),s=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(e.total())}else bs(t,e.add(a),this.m_progressTracker,!0,!1),s=!1;else s=!1;t.removeSelection(),t.collapseAllGeometriesToFirst();const u=t.getFirstGeometry();if(this.m_topoGraph.setAndSimplifyEditShapeAlternate(t,u,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return(0,i.g)(s&&null===h),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolylines(t,e,!1,n,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);const c=this.m_topoGraph.getGeometryID(u);(0,i.g)(c>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=c+1,this.m_maskLookup[c]=!0;const m=this.topoOperationPolylineSimplify_(t.getFirstGeometry(),n);null!==h&&h.stitchCurves(t,m,l,!0);const d=t.getGeometry(m);return s||d.getImpl().setIsSimple(4,e.total()),d}planarSimplifyMultiPoints(t,e,s,n){for(let u=t.getFirstGeometry();u!==r.n;u=t.getNextGeometry(u)){const e=t.getGeometryType(u);(0,i.g)(e===i.G.enumMultiPoint)}this.m_topoGraph=new tt,4!==n&&5!==n?(bs(t,e,this.m_progressTracker,!0,!1),s=!1):s=!1,t.removeSelection(),t.collapseAllGeometriesToFirst();const o=t.getFirstGeometry();if(this.m_topoGraph.setAndSimplifyEditShapeAlternate(t,o,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return(0,i.g)(s),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyMultiPoints(t,e,!1,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);const a=this.m_topoGraph.getGeometryID(o);(0,i.g)(a>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=a+1,this.m_maskLookup[a]=!0;const l=this.topoOperationMultiPoint(),h=t.getGeometry(l);return s||h.getImpl().setIsSimple(4,e.total()),h}planarSimplifyPolygons(t,e,s,n,o,a){for(let f=t.getFirstGeometry();f!==r.n;f=t.getNextGeometry(f)){const e=t.getGeometryType(f);(0,i.g)(e===i.G.enumPolygon||e===i.G.enumPolyline&&s)}let l=0,h=0,u=null;if(t.hasCurves()&&!t.hasSegmentParentage()){u=new xs;const s=t.getEnvelope2D(this.m_progressTracker);h=fs(e.total());const n=_s(e.total(),s);l=ys(n,h),ms(t,n,e.total(),0,u,null,this.m_progressTracker)}if(a){bs(t,e.add(l),this.m_progressTracker,!0,!1);for(let e=t.getFirstGeometry();e!==r.n;e=t.getNextGeometry(e))t.getGeometryType(e)===i.G.enumPolygon&&zt(t,e,-1,!1,r.n,this.m_progressTracker)}if(this.m_topoGraph=new tt,a||4===o||5===o)n=!1;else if(null===u&&n){const s=new Et(this.m_progressTracker,!1);s.sweepVertical(t,e.total()),s.hadComplications()?(bs(t,e,this.m_progressTracker,!0,!1),n=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(e.total())}else bs(t,e.add(l),this.m_progressTracker,!0,!1),n=!1;t.removeSelection(),t.collapseAllGeometriesToFirst();const c=t.getFirstGeometry();if(s?this.m_topoGraph.setAndSimplifyEditShapeWinding(t,c,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeAlternate(t,c,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return(0,i.g)(n&&null===u),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolygons(t,e,s,!1,-1,!1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);const m=this.m_topoGraph.getGeometryID(c);(0,i.g)(m>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=m+1,this.m_maskLookup[m]=!0,t.setFillRule(c,0);const d=this.m_bOGCOutput&&s,g=d;let p=this.topoOperationPolygonPolygon_(c,r.n,r.n,g);d&&(this.m_topoGraph.removeShape(),this.m_topoGraph=null,t.removeGeometry(c),this.m_topoGraph=new tt,this.m_topoGraph.setAndSimplifyEditShapeAlternate(t,p,this.m_progressTracker),p=this.topoOperationPolygonPolygon_(p,r.n,r.n,!1)),null!==u&&u.stitchCurves(t,p,h,!0);const _=t.getGeometry(p);return _.setFillRule(0),n?_.getImpl().setIsSimple(3,0):(_.getImpl().setIsSimple(4,e.total()),_.getImpl().updateOGCFlagsProtected()),_}planarSimplify3DImpl_(t,e,s,n,r){return(0,i.g)(0),{}}planarSimplifyImpl_(t,e,s,n,a,l,h,u){if(t.isEmpty())return t.clone();const c=t.getGeometryType(),m=new r.E,d=m.addGeometry(t);if((0,o.X)(a)&&c===i.G.enumPolygon&&(s=!1,m.setFillRule(d,0)),u&&(t.hasAttribute(1)&&m.replaceNaNs(1,0),m.removeNaNVertices()),c===i.G.enumPolygon||c===i.G.enumPolyline&&s)return this.planarSimplifyPolygons(m,e,s,n,a,!1);if(c===r.P.type){const t={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};return t.allCrossRoadsImpassable=!0,t.ogcRule=this.m_bOGCOutput,t.unsplitBehavior=h,this.planarSimplifyPolylines(m,e,n,t,a)}if(c===i.G.enumMultiPoint)return this.planarSimplifyMultiPoints(m,e,n,a);(0,i.d)("what else?")}}function Us(t,e,s,n){const a=t.getGeometryType();if(a===i.G.enumEnvelope){const e=new r.a({vd:t.getDescription()});return t.isEmpty()||e.addEnvelope(t,!1),e}if(a===i.G.enumPoint&&("|"===n||"^"===n)){const e=new r.M({vd:t.getDescription()});return t.isEmpty()||e.add(t),e}if(a===i.G.enumLine){const e=new r.P({vd:t.getDescription()});return t.isEmpty()||e.addSegment(t,!0),e}if(a===i.G.enumMultiPoint&&"-"===n&&e.getGeometryType()===i.G.enumPoint){const e=new o.P({vd:t.getDescription()});return t.isEmpty()||t.getPointByVal(0,e),e}if(a===i.G.enumMultiPoint&&"&"===n&&e.getGeometryType()===i.G.enumPoint){const e=new o.P({vd:t.getDescription()});return t.isEmpty()||t.getPointByVal(0,e),e}return t}function Hs(t){const e=t.getGeometryType();if(e===i.G.enumEnvelope){const e=new r.a({vd:t.getDescription()});return t.isEmpty()||e.addEnvelope(t,!1),e}if(e===i.G.enumPoint){const e=new r.M({vd:t.getDescription()});return t.isEmpty()||e.add(t),e}if(Ds(e)){const e=new r.P({vd:t.getDescription()});return t.isEmpty()||e.addSegment(t,!0),e}return e!==i.G.enumMultiPoint&&e!==i.G.enumPolyline&&e!==i.G.enumPolygon&&(0,i.a)("Unexpected geometry type"),t}function Xs(t,e,s,n){const o=s===r.n?t.getClusterHalfEdge(e):s;let a=o;(0,i.g)(t.getHalfEdgeOrigin(o)===e);do{n(a),a=t.getHalfEdgeNext(t.getHalfEdgeTwin(a))}while(a!==o)}class js{constructor(t,e,s,n,i,o){this.m_rParent=t,this.m_rTopoGraph=t.m_topoGraph,this.m_rShape=this.m_rTopoGraph.getShape(),this.m_IDCuttee=this.m_rTopoGraph.getGeometryID(n),this.m_IDCutter=this.m_rTopoGraph.getGeometryID(i),this.m_IDBoth=this.m_IDCuttee|this.m_IDCutter,this.m_bConsiderTouch=e,this.m_sideIndex=s,this.m_cuttee=n,this.m_cutter=i,this.m_rCutHandles=o,this.m_cutteeBreadcrumbsIndex=this.m_rShape.createUserIndexUninitialized(),this.m_clusterParentageIndex=this.m_rShape.createUserIndexUninitialized();for(let a=this.m_rShape.getFirstPath(this.m_cuttee);a!==r.n;a=this.m_rShape.getNextPath(a)){let t=0;const e=this.m_rShape.getPathSize(a);for(let s=this.m_rShape.getFirstVertex(a);t<e;t++,s=this.m_rShape.getNextVertex(s))this.m_rShape.setUserIndex(s,this.m_clusterParentageIndex,this.m_rTopoGraph.getClusterParentage(this.m_rTopoGraph.getClusterFromVertex(s)))}}Do(){this.cutPolylinePolyline_(),this.m_rShape.removeUserIndex(this.m_cutteeBreadcrumbsIndex),this.m_rShape.removeUserIndex(this.m_clusterParentageIndex)}setTbd(t){return 8|t}classifyStandardCut(t,e,s,n){const i=this.m_rShape.getPrevVertex(t),o=this.m_rShape.getNextVertex(t),a=i===r.n?r.n:this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(i)),l=o===r.n?r.n:this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(o)),h=this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(s)),u=this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(n));let c=1,m=32,d=32;if(Xs(this.m_rTopoGraph,e,u,(t=>{t===h&&(c=2),t===a&&(m=c),t===l&&(d=c)})),this.m_bConsiderTouch)32!==m&&this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|m),32!==d&&this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex)|d);else{if(32===m||32===d)return 1;if(m===d&&a!==h&&a!==u&&l!==h&&l!==u)return 1;this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|m),this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex)|d)}return 0}classifyTouchCut(t,e,s,n){const i=this.m_rShape.getPrevVertex(t),o=this.m_rShape.getNextVertex(t),a=i===r.n?r.n:this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(i)),l=o===r.n?r.n:this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(o)),h=s===r.n?r.n:this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(s)),u=n===r.n?r.n:this.m_rTopoGraph.getHalfEdgeConnector(e,this.m_rTopoGraph.getClusterFromVertex(n));if(!this.m_bConsiderTouch){let e;return(e=h===a||u===a)?this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex))):(e=h===l||u===l)&&this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),e?0:1}if(a===r.n)return this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex))),0;if(l===r.n)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),0;if(a===l)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex))),0;if(u!==r.n){if(a===u)return this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex))),0;if(l===u)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),0;let s=1;Xs(this.m_rTopoGraph,e,u,(e=>{if(e===a){const t=this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|s;this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,t),s=2}else if(e===l){const e=this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex)|s;this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,e),s=2}}))}else{if(a===h)return this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex))),0;if(l===h)return this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex))),0;let s=2;Xs(this.m_rTopoGraph,e,h,(e=>{if(e===a){const t=this.m_rShape.getUserIndex(i,this.m_cutteeBreadcrumbsIndex)|s;this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,t),s=1}else if(e===l){const e=this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex)|s;this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,e),s=1}}))}return 0}classifyCutVertex(t,e){let s=0,n=0;for(let i=this.m_rTopoGraph.getClusterVertexIterator(e);i!==r.n;i=this.m_rTopoGraph.incrementVertexIterator(i)){const o=this.m_rTopoGraph.getVertexFromVertexIterator(i);if(this.m_rShape.getGeometryFromVertex(o)===this.m_cutter){n++;const i=this.m_rShape.getPrevVertex(o),a=this.m_rShape.getNextVertex(o);s+=i===r.n||a===r.n?this.classifyTouchCut(t,e,i,a):this.classifyStandardCut(t,e,i,a)}}n&&s===n&&!this.m_bConsiderTouch&&this.m_rShape.setUserIndex(t,this.m_clusterParentageIndex,this.m_IDCuttee)}cutPolylinePolyline_(){this.m_rShape.getGeometryType(this.m_cuttee),this.m_rShape.getGeometryType(this.m_cutter),this.m_rParent.m_maskLookup.length=0,this.m_rParent.m_maskLookup.length=this.m_IDBoth+1,this.m_rParent.m_maskLookup[this.m_IDBoth]=!0;for(let i=this.m_rShape.getFirstPath(this.m_cuttee);i!==r.n;i=this.m_rShape.getNextPath(i)){const t=this.m_rShape.getPathSize(i);let e=this.m_rShape.getFirstVertex(i);for(let s=0;s<t;++s,e=this.m_rShape.getNextVertex(e))this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,0);e=this.m_rShape.getFirstVertex(i);for(let s=0;s<t;++s,e=this.m_rShape.getNextVertex(e)){const t=this.m_rTopoGraph.getClusterFromVertex(e);this.m_rTopoGraph.getClusterParentage(t)===this.m_IDBoth&&this.classifyCutVertex(e,t)}}const t=(t,e)=>{let s=this.m_rShape.getUserIndex(t,this.m_cutteeBreadcrumbsIndex);const n=this.m_rTopoGraph.getHalfEdgeConnector(this.m_rTopoGraph.getClusterFromVertex(t),this.m_rTopoGraph.getClusterFromVertex(e));return(this.m_rTopoGraph.getHalfEdgeParentage(n)&this.m_IDBoth)===this.m_IDBoth&&(s|=4),s};for(let i=this.m_rShape.getFirstPath(this.m_cuttee);i!==r.n;i=this.m_rShape.getNextPath(i)){let e=this.m_rShape.getFirstVertex(i);const s=this.m_rShape.isClosedPath(i),n=this.m_rShape.getPathSize(i)+(s?1:0);let r=1,o=32;for(let i=this.m_rShape.getNextVertex(e);r<n;++r,e=i,i=this.m_rShape.getNextVertex(i)){const s=t(e,i);this.m_rShape.getUserIndex(e,this.m_clusterParentageIndex)===this.m_IDBoth&&(o=s),32!==o&&this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,o|s)}e=this.m_rShape.getLastVertex(i);let a=32;r=1;for(let i=this.m_rShape.getPrevVertex(e);r<n;++r,e=i,i=this.m_rShape.getPrevVertex(i)){const s=t(i,e);this.m_rShape.getUserIndex(e,this.m_clusterParentageIndex)===this.m_IDBoth&&(a=s),32!==a&&this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,a|s)}}let e=r.n,s=r.n,n=32;const o=this.m_rShape.hasSegmentParentage(),a=new r.S;for(let l=this.m_rShape.getFirstPath(this.m_cuttee);l!==r.n;l=this.m_rShape.getNextPath(l)){const t=this.m_rShape.isClosedPath(l),h=this.m_rShape.getPathSize(l)+(t?1:0);let u=1,c=this.m_rShape.getFirstVertex(l),m=r.n,d=!0;for(let l=this.m_rShape.getNextVertex(c);u<h;++u,l=this.m_rShape.getNextVertex(l)){let t=this.m_rShape.getUserIndex(c,this.m_cutteeBreadcrumbsIndex);8===t?t=3:(t&=-9,4&t?t=4:3&~t||(t=3)),t!==n?(e!==r.n&&(m=this.m_rShape.addVertex(s,c),o&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(c))&&this.m_rShape.setSegmentParentageBreakVertex(m,!0),this.m_rCutHandles.push(e),this.m_rShape.setGeometryUserIndex(e,this.m_sideIndex,n)),e=this.m_rShape.createGeometry(i.G.enumPolyline),s=this.m_rShape.insertPath(e,r.n),n=t,d=!0):this.m_rShape.getUserIndex(c,this.m_clusterParentageIndex)===this.m_IDBoth&&4!==t&&(m=this.m_rShape.addVertex(s,c),o&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(c))&&this.m_rShape.setSegmentParentageBreakVertex(m,!0),s=this.m_rShape.insertPath(e,r.n),d=!0),m=this.m_rShape.addVertex(s,c);const h=this.m_rTopoGraph.getClusterFromVertex(c);!d&&o&&this.m_rTopoGraph.isBreakNode(h)&&this.m_rShape.setSegmentParentageBreakVertex(m,!0);const u=this.m_rTopoGraph.getHalfEdgeFromVertex(c);if(o){const t=this.m_rTopoGraph.getSegmentParentage(u);this.m_rShape.setSegmentParentageAndBreak(m,t,d||this.m_rTopoGraph.isBreakNode(h))}this.m_rTopoGraph.isHalfEdgeCurve(u)&&(this.m_rTopoGraph.querySegmentXY(u,a),this.m_rShape.setSegmentToIndex(this.m_rShape.getVertexIndex(m),a.get().clone())),c=l,d=!1}m=this.m_rShape.addVertex(s,c),o&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(c))&&this.m_rShape.setSegmentParentageBreakVertex(m,!0),this.m_rCutHandles.push(e),this.m_rShape.setGeometryUserIndex(e,this.m_sideIndex,n),e=r.n,s=r.n,n=32}}}function Zs(t,e,s){return new Ys(s).linesToPolygonsImpl(t,e)}function Ws(t,e,s,a,l){if(a&&(a.m_reason=0,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),t.isEmpty())return 5;const h=t.getGeometryType();if(h===i.G.enumPoint)return Js(t,a);const u=(0,o.b)(e,t,!1).total();if(h===i.G.enumEnvelope){const e=t,s=new n.Envelope2D;return e.queryEnvelope(s),s.isDegenerate(u)?(a&&(a.m_reason=4,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),0):5}if((0,i.f)(h)){const n=t,i=new r.P({vd:n.getDescription()});return i.addSegment(n,!0),Ws(i,e,s,a,l)}(0,i.B)(h),(0,i.i)(h)||(0,i.t)("OGC simplify is not implemented for this geometry type");const c=t.getImpl().getIsSimple(u,[0]);let m=s?-1:c;if(5===m||0===m)return m;const d=new hn(t,e,m,l,!0);return h===i.G.enumMultiPoint||h===i.G.enumPolyline||h===i.G.enumPolygon?(m=d.isSimplePlanarImpl(),(0,o.i)(m)&&(m=5)):(0,i.d)(""),t.getImpl().setIsSimple(m,u),a&&a.assign(d.m_nonSimpleResult),m}function $s(t,e,s,a,l){if(a&&(a.m_reason=0,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),t.isEmpty())return 5;const h=t.getGeometryType();if(h===i.G.enumPoint)return Js(t,a);const u=(0,o.b)(e,t,!1).total();if(h===i.G.enumEnvelope){const e=t,s=n.Envelope2D.constructEmpty();return e.queryEnvelope(s),s.isDegenerate(u)?(a&&(a.m_reason=4,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),0):5}if((0,i.f)(h)){const n=t,i=new r.P({vd:n.getDescription()});return i.addSegment(n,!0),$s(i,e,s,a,l)}const c=t.getImpl().getIsSimple(u,[0]);let m=s?-1:c;if(-1!==m)return m;const d=new hn(t,e,m,l,!1);return h===i.G.enumMultiPoint?m=d.multipointIsSimpleAsFeature():h===i.G.enumPolyline?m=d.polylineIsSimpleAsFeature():h===i.G.enumPolygon?m=d.polygonIsSimpleAsFeature():(0,i.d)(""),t.getImpl().setIsSimple(m,u),a&&a.assign(d.m_nonSimpleResult),m}function Ks(t,e,s,a){if(t.isEmpty())return t;const l=t.getGeometryType();if(l===i.G.enumPoint){const e=new d.NonSimpleResult;if(Js(t,e),3===e.m_reason){const e=t.clone();return e.replaceNaNs(1,0),e}return 2===e.m_reason?t.createInstance():t}if(l===i.G.enumEnvelope){const s=(0,o.b)(e,t,!0).total(),i=t,r=n.Envelope2D.constructEmpty();return i.queryEnvelope(r),r.isDegenerate(s)?i.createInstance():t}if((0,i.f)(l)){const n=t,i=new r.P({vd:n.getDescription()});return i.addSegment(n,!0),Ks(i,e,s,a)}(0,i.B)(l);const h=(0,o.b)(e,t,!1).total(),u=t.getImpl().getIsSimple(h,[0]),c=s?-1:u;if((0,o.i)(c)){if(l===i.G.enumPolygon&&0!==t.getFillRule()){const e=t.clone();return e.setFillRule(0),e}return t}if((l===i.G.enumMultiPoint||l===i.G.enumPolyline)&&c>=1)return t;const m=new hn(t,e,c,a,!1);let g;return l===i.G.enumMultiPoint?g=m.multipointSimplifyAsFeature():l===i.G.enumPolyline?g=m.polylineSimplifyAsFeature():l===i.G.enumPolygon?g=m.polygonSimplifyAsFeature():(0,i.d)(""),g}function Qs(t,e,s,a){if(t.isEmpty())return t;const l=t.getGeometryType();if(l===i.G.enumPoint){const e=new d.NonSimpleResult;if(Js(t,e),3===e.m_reason){const e=t.clone();return e.replaceNaNs(1,0),e}return 2===e.m_reason?t.createInstance():t}if(l===i.G.enumEnvelope){const s=t,i=new n.Envelope2D;s.queryEnvelope(i);const r=(0,o.b)(e,t,!0).total();return i.isDegenerate(r)?s.createInstance():t}if((0,i.f)(l)){const n=t,i=new r.P({vd:n.getDescription()});return i.addSegment(n,!0),Qs(i,e,s,a)}(0,i.B)(l),(0,i.i)(l)||(0,i.t)("OGC simplify is not implemented for this geometry type");const h=(0,o.b)(e,t,!1).total(),u=t.getImpl().getIsSimple(h,[0]),c=s?-1:u;if(5===c){if(l===i.G.enumPolygon&&0!==t.getFillRule()){const e=t.clone();return e.setFillRule(0),e}return t}return ks(t,(0,o.b)(e,t,!0),!1,c,a,0,!0)}function Js(t,e){const s=t.getX(),n=t.getY();if(!Number.isFinite(s)||!Number.isFinite(n))return e&&(e.m_reason=2,e.m_vertexIndex1=-1,e.m_vertexIndex2=-1),0;if(t.hasAttribute(1)){const s=t.getZ();if(!Number.isFinite(s))return e&&(e.m_reason=Number.isNaN(s)?3:2,e.m_vertexIndex1=-1,e.m_vertexIndex2=-1),0}return 5}class tn{constructor(){this.m_segment=null,this.m_vertexIndex=-1,this.m_pathIndex=-1,this.m_flags=0}setReversed(t){this.m_flags&=-2,this.m_flags=this.m_flags|(t?1:0)}getReversed(){return!!(1&this.m_flags)}getRightSide(){return this.getReversed()?0:1}}function en(t,e,s,n,i){return{x:t,y:e,ipath:s,ivertex:n,ipolygon:i}}function sn(t,e){return t.x===e.x&&t.y===e.y&&t.ipath===e.ipath&&t.ivertex===e.ivertex&&t.ipolygon===e.ipolygon}function nn(t,e){t.x=e.x,t.y=e.y,t.ipath=e.ipath,t.ivertex=e.ivertex,t.ipolygon=e.ipolygon}function rn(t,e,s,n,i,r){return{x:t,y:e,ipath:s,ivertex:n,bBoundary:i,bEndPoint:r}}function on(t,e){t.x=e.x,t.y=e.y,t.ipath=e.ipath,t.ivertex=e.ivertex,t.bBoundary=e.bBoundary,t.bEndPoint=e.bEndPoint}class an extends o.a3{constructor(t){super(),this.m_helper=t}compare(t,e,s){const n=t.getElement(s),i=this.m_helper.m_xy.read(2*e)-this.m_helper.m_xy.read(2*n);return i<0?-1:i>0?1:0}}class ln extends o.a3{constructor(t){super(),this.m_helper=t}compare(t,e,s){const n=t.getElement(s),i=this.m_helper.m_edges[e],r=this.m_helper.m_edges[n],o=i.getReversed(),a=r.getReversed();let l=i.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0),h=r.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0);if(l===h){const t=o?i.m_segment.getStartY():i.m_segment.getEndY(),e=a?r.m_segment.getStartY():r.m_segment.getEndY(),s=Math.min(t,e);let n=.5*(s-this.m_helper.m_yScanline)+this.m_helper.m_yScanline;n===this.m_helper.m_yScanline&&(n=s),l=i.m_segment.intersectionOfYMonotonicWithAxisX(n,0),h=r.m_segment.intersectionOfYMonotonicWithAxisX(n,0)}return l<h?-1:l>h?1:0}}class hn{constructor(t,e,s,n,i){this.m_multiVertexGeom=null,this.m_edges=[],this.m_freeEdges=[],this.m_lineEdgesRecycle=[],this.m_newEdges=[],this.m_recycledSegIter=null,this.m_crossOverHelperList=new o.N,this.m_progressTracker=null,this.m_progressCounter=0,this.m_AET=new o.T,this.m_xyToNode1=null,this.m_xyToNode2=null,this.m_pathOrientations=null,this.m_pathParentage=null,this.m_xy=null,this.m_pairs=[],this.m_pairIndices=null,this.m_pathsForOGCTests=[],this.m_curveStitcher=null,this.m_editShape=null,this.m_multiPathStitcher=null,this.m_nonSimpleResult=new d.NonSimpleResult,this.m_progressCounter=0,this.m_progressTracker=n,this.m_geometry=t,this.m_knownSimpleResult=s,this.m_sr=e;const r=(0,o.b)(e,t,!1);this.m_toleranceIsSimple=r,this.m_toleranceIsSimpleClustering=(0,o.e)(r),this.m_toleranceIsSimpleCracking=(0,o.Q)(r),this.m_toleranceSimplify=(0,o.b)(e,t,!0),this.m_description=this.m_geometry.getDescription(),this.m_attributeCount=this.m_description.getAttributeCount(),this.m_bOGCRestrictions=i,this.m_bPlanarSimplify=this.m_bOGCRestrictions,this.m_unknownOrientationPathCount=-1,this.m_yScanline=0,this.m_progressCounter=0}isSimplePlanarImpl(){if(this.m_bPlanarSimplify=!0,!this.checkStructure())return 0;const t=this.m_geometry.getGeometryType();return(0,i.h)(t)&&!this.checkDegenerateSegments(!1)?0:this._CheckClustering()?(0,i.h)(t)?this._CheckCracking()?this.m_geometry.getGeometryType()===i.G.enumPolyline?this.checkSelfIntersectionsPolylinePlanar()?4:0:this._CheckSelfIntersections()?this._CheckValidRingOrientation():0:0:5:0}isSimplePlanarImpl3D(){return(0,i.g)(0),7}generateSortedPairs(t){let e=null;(0,i.h)(t.getGeometryType())&&(e=t);const s=(this.m_bPlanarSimplify||this.m_bOGCRestrictions)&&null!==e,n=t.getPointCount();this.m_xy=t.getAttributeStreamRef(0),this.m_pairs.length=0,this.m_pairIndices=new o.A(0),s&&(this.m_pathsForOGCTests.length=0);let r=0;for(let i=0;i<n;i++)if(this.m_pairs.push(2*i),this.m_pairs.push(2*i+1),this.m_pairIndices.add(2*i),this.m_pairIndices.add(2*i+1),s){for(;i>=e.getPathEnd(r);)r++;this.m_pathsForOGCTests.push(r)}const l=new o.B,h={parent:this,workPt:new a.P,userSort(t,e,n){n.sort(t,e,((t,e)=>this.parent.compareVerticesForPlanarClustering(t,e,s)))},getValue(t){const e=this.parent.m_pairs[t],s=e>>1;return this.parent.m_xy.queryPoint2D(2*s,this.workPt),this.workPt.y+(1&e?this.parent.m_toleranceIsSimpleClustering:-this.parent.m_toleranceIsSimpleClustering)}};l.sort(this.m_pairIndices,0,2*n,h)}_TestToleranceDistancePlanar(t,e){const s=this.m_xy.read(2*t),n=this.m_xy.read(2*t+1),i=this.m_xy.read(2*e),r=this.m_xy.read(2*e+1);return!at(s,n,i,r,this.m_toleranceIsSimpleClustering*this.m_toleranceIsSimpleClustering)||0!==this.m_geometry.getDimension()&&(s===i&&n===r)}checkStructure(){const t=this.m_geometry.getGeometryType();if((0,i.h)(t)){const t=this.m_geometry.getImpl(),e=this.m_geometry.getGeometryType()===i.G.enumPolygon?3:2;for(let s=0,n=t.getPathCount();s<n;s++)if(t.getPathSize(s)<e){if(t.hasNonLinearSegments()&&t.hasNonLinearSegmentsPath(s)&&t.getPathSize(s)>0)continue;return this.m_nonSimpleResult=new d.NonSimpleResult(1,s,0),!1}}if((0,i.i)(t)){const t=this.m_geometry.getImpl(),e=t.getAttributeStreamRef(0);for(let s=0,n=t.getPointCount();s<n;s++)if(!e.readPoint2D(2*s).isFinite())return this.m_nonSimpleResult=new d.NonSimpleResult(2,s,0),!1;if(this.m_geometry.hasAttribute(1)){const e=t.getAttributeStreamRef(1);for(let s=0,n=t.getPointCount();s<n;s++){const t=e.read(s);if(!Number.isFinite(t))return Number.isNaN(t)?this.m_nonSimpleResult=new d.NonSimpleResult(3,s,0):this.m_nonSimpleResult=new d.NonSimpleResult(2,s,0),!1}}}return!0}checkDegenerateSegments(t){const e=this.m_geometry.getImpl(),s=e.querySegmentIterator(),n=e.hasAttribute(1),i=n?(0,o.R)(this.m_sr,e,!1).total():0,r=e.hasNonLinearSegments(),a=this.m_toleranceIsSimple.total();for(;s.nextPath();)for(;s.hasNextSegment();){const e=s.nextSegment();let o=e.calculateLowerLength2D();if(!(o>a||r&&e.isCurve()&&(o=e.calculateLength2D(),o>a))){if(t&&n){const t=e.getStartAttributeAsDbl(1,0),s=e.getEndAttributeAsDbl(1,0);if(Math.abs(s-t)>i)continue}return this.m_nonSimpleResult=new d.NonSimpleResult(4,s.getStartPointIndex(),-1),!1}}return!0}checkDegenerateSegments3D(){return(0,i.g)(0),!1}_CheckClustering(){const t=this.m_geometry.getImpl();this.generateSortedPairs(t);const e=t.getPointCount();this.m_AET.clear(),this.m_AET.setComparator(new an(this)),this.m_AET.setCapacity(e);for(let s=0,n=2*e;s<n;s++){this.progress_();const t=this.m_pairIndices.read(s),e=this.m_pairs[t],n=e>>1;if(1&e){const t=this.m_AET.search(n),e=this.m_AET.getPrev(t),s=this.m_AET.getNext(t);if(this.m_AET.deleteNode(t),e!==o.T.st_nullNode()&&s!==o.T.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(e),this.m_AET.getElement(s)))return this.m_nonSimpleResult=new d.NonSimpleResult(5,this.m_AET.getElement(e),this.m_AET.getElement(s)),!1}else{const t=this.m_AET.addElement(n),e=this.m_AET.getPrev(t);if(e!==o.T.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(e),n))return this.m_nonSimpleResult=new d.NonSimpleResult(5,n,this.m_AET.getElement(e)),!1;const s=this.m_AET.getNext(t);if(s!==o.T.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(s),n))return this.m_nonSimpleResult=new d.NonSimpleResult(5,n,this.m_AET.getElement(s)),!1}}return!0}_CheckCracking(){const t=this.m_geometry.getImpl(),e=t.getPointCount();return!t.hasNonLinearSegments()&&e<10?this._CheckCrackingBrute():this._CheckCrackingPlanesweep()}_CheckCrackingPlanesweep(){if(this.m_editShape=new r.E,this.m_editShape.addGeometry(this.m_geometry),this.m_editShape.hasCurves()){this.m_curveStitcher=new xs;const t=n.Envelope2D.constructEmpty();this.m_geometry.queryEnvelope(t);const e=_s(this.m_toleranceSimplify.total(),t),s=new d.NonSimpleResult;if(gs(this.m_editShape,e,this.m_toleranceSimplify.total(),0,s,this.m_curveStitcher,null,this.m_progressTracker),0!==s.m_reason)return this.m_editShape=null,this.m_nonSimpleResult.assign(s),!1}const t=new d.NonSimpleResult;return Tt(!1,this.m_editShape,this.m_toleranceIsSimpleCracking,t,this.m_progressTracker)?(null!=this.m_curveStitcher?(t.m_vertexIndex1=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,t.m_vertexIndex1),t.m_vertexIndex2=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,t.m_vertexIndex2),this.m_curveStitcher=null):(t.m_vertexIndex1=this.m_editShape.getVertexIndex(t.m_vertexIndex1),t.m_vertexIndex2=this.m_editShape.getVertexIndex(t.m_vertexIndex2)),this.m_editShape=null,this.m_nonSimpleResult.assign(t),!1):(null==this.m_curveStitcher&&(this.m_editShape=null),!0)}_CheckCrackingBrute(){const t=this.m_geometry.getImpl(),e=t.querySegmentIterator(),s=t.querySegmentIterator();for(;e.nextPath();)for(;e.hasNextSegment();){const t=e.nextSegment();if(!e.isLastSegmentInPath()||!e.isLastPath()){s.resetTo(e);do{for(;s.hasNextSegment();){const n=s.nextSegment(),i=(0,r.Q)(!0,t,n,this.m_toleranceIsSimpleCracking,!0);if(i){const t=2===i?7:6;return this.m_nonSimpleResult=new d.NonSimpleResult(t,e.getStartPointIndex(),s.getStartPointIndex()),!1}}}while(s.nextPath())}}return!0}_CheckSelfIntersections(){let t=this.m_geometry.getImpl();null!==this.m_curveStitcher&&(this.m_multiPathStitcher=this.m_editShape.getGeometry(this.m_editShape.getFirstGeometry()),t=this.m_multiPathStitcher.getImpl(),this.generateSortedPairs(t)),this.m_edges.length=0,this.m_lineEdgesRecycle.length=0,this.m_recycledSegIter=t.querySegmentIterator(),this.m_recycledSegIter.setCirculator(!0);const e=[],s=t.getPointCount();let n=Number.NaN,i=0;for(let r=0,o=2*s;r<o;r++){this.progress_();const t=this.m_pairIndices.read(r),s=this.m_pairs[t];if(1&s)continue;const o=s>>1,a=this.m_xy.read(2*o),l=this.m_xy.read(2*o+1);if(e.length&&(a!==n||l!==i)){if(!this.processBunchForSelfIntersectionTest(e))return!1;e.length=0}e.push(o),n=a,i=l}return!!this.processBunchForSelfIntersectionTest(e)}checkSelfIntersectionsPolylinePlanar(){const t=this.m_geometry.getImpl(),e=[];for(let o=0,a=t.getPathCount();o<a;o++)e.push(t.isClosedPathInXYPlane(o));const s={x:-1,y:-1,ipath:-1,ivertex:-1,bBoundary:!1,bEndPoint:!1};let n,i,r;{const o=this.m_pairIndices.read(0),a=this.m_pairs[o]>>1,l=this.m_xy.readPoint2D(2*a),h=this.m_pathsForOGCTests[a];n=e[h],i=t.getPathStart(h),r=t.getPathEnd(h)-1,s.bEndPoint=a===i||a===r,this.m_bOGCRestrictions?s.bBoundary=!n&&s.bEndPoint:s.bBoundary=s.bEndPoint,s.ipath=h,s.x=l.x,s.y=l.y,s.ivertex=a}for(let o=1,a=this.m_pairIndices.size();o<a;o++){const a=this.m_pairIndices.read(o),l=this.m_pairs[a];if(1&l)continue;const h=l>>1,u=this.m_xy.readPoint2D(2*h),c=this.m_pathsForOGCTests[h];let m;c!==s.ipath&&(n=e[c],i=t.getPathStart(c),r=t.getPathEnd(c)-1);const g=h===i||h===r;m=this.m_bOGCRestrictions?!n&&g:g;const p=rn(u.x,u.y,c,h,m,g);if(p.x===s.x&&p.y===s.y)if(this.m_bOGCRestrictions){if(!(p.bBoundary&&s.bBoundary||p.ipath===s.ipath&&p.bEndPoint&&s.bEndPoint))return this.m_nonSimpleResult=new d.NonSimpleResult(10,p.ivertex,s.ivertex),!1}else if(!p.bEndPoint||!s.bEndPoint)return this.m_nonSimpleResult=new d.NonSimpleResult(7,p.ivertex,s.ivertex),!1;on(s,p)}return!0}checkSelfIntersectionsPolylinePlanar3D(t){return(0,i.g)(0),!1}checkSelfIntersectionsPolygonsOGC(){const t=this.m_geometry.getImpl(),e=[];let s=-1,n=!1;for(let o=0,a=t.getPathCount();o<a;o++)t.isExteriorRingOGC(o)&&(n=!1,s++,o<a-1&&(t.isExteriorRingOGC(o+1)||(n=!0))),e.push(n?s:-1);const i={x:-1,y:-1,ipath:-1,ivertex:-1,ipolygon:-1};{const t=this.m_pairIndices.read(0),s=this.m_pairs[t]>>1,n=this.m_xy.readPoint2D(2*s),r=this.m_pathsForOGCTests[s];i.ipath=r,i.x=n.x,i.y=n.y,i.ivertex=s,i.ipolygon=e[r]}const r=[];for(let o=1,a=this.m_pairIndices.size();o<a;o++){const t=this.m_pairIndices.read(o),s=this.m_pairs[t];if(1&s)continue;const n=s>>1,a=this.m_xy.readPoint2D(2*n),l=this.m_pathsForOGCTests[n],h=en(a.x,a.y,l,n,e[l]);if(h.x===i.x&&h.y===i.y){if(h.ipath===i.ipath)return this.m_nonSimpleResult=new d.NonSimpleResult(11,h.ivertex,i.ivertex),!1;e[h.ipath]>=0&&e[h.ipath]===e[i.ipath]&&(0!==r.length&&sn(r.at(-1),i)||r.push({...i}),r.push(h))}nn(i,h)}if(0===r.length)return!0;const l=new o.N(!0);e.fill(-1);let h=-1;const u=new a.P;for(let o=0,a=r.length;o<a;o++){const t=r[o];t.x===u.x&&t.y===u.y||(h=l.createList(0),u.x=t.x,u.y=t.y);let s=e[t.ipath];-1===s&&(s=l.createList(2),e[t.ipath]=s),l.addElement(s,h),l.addElement(h,s)}const c=[];for(let o=l.getFirstList();-1!==o;o=l.getNextList(o)){const t=l.getListData(o);if(1&t||!(2&t))continue;let s=-1;for(c.push(o),c.push(-1);c.length;){const t=c.at(-1);c.pop();const e=c.at(-1);c.pop();const n=l.getListData(e);if(1&n){s=2&n?e:t;break}l.setListData(e,1|n);for(let s=l.getFirst(e);-1!==s;s=l.getNext(s)){const n=l.getData(s);n!==t&&(c.push(n),c.push(e))}}if(-1!==s){const t=e.indexOf(s);return this.m_nonSimpleResult=new d.NonSimpleResult(12,t,-1),!1}}return!0}_CheckValidRingOrientation(){const t=null!==this.m_multiPathStitcher?this.m_multiPathStitcher.getImpl():this.m_geometry.getImpl();if(t.calculateArea2D()<=0)return this.m_nonSimpleResult=new d.NonSimpleResult(8,1===t.getPathCount()?1:-1,-1),0;if(1===t.getPathCount())return this.m_bOGCRestrictions&&!this.checkSelfIntersectionsPolygonsOGC()?0:4;this.m_pathOrientations=new o.U(t.getPathCount(),0),this.m_pathParentage=new o.A(t.getPathCount(),-1);let e=-1,s=0;for(let r=0,o=t.getPathCount();r<o;r++){const n=t.calculateRingArea2D(r);if(this.m_pathOrientations.write(r,n<0?0:8),n>0)e=r,s=n;else{if(0===n)return this.m_nonSimpleResult=new d.NonSimpleResult(8,r,-1),0;if((e<0||s<Math.abs(n))&&(this.m_nonSimpleResult=new d.NonSimpleResult(9,r,-1),this.m_bOGCRestrictions))return 0;this.m_pathParentage.write(r,e)}}this.m_unknownOrientationPathCount=t.getPathCount(),this.m_newEdges.length=0;const n=t.getPointCount();this.m_yScanline=Number.NaN;const i=[];this.m_xyToNode1=new o.A(n,o.T.st_nullNode()),this.m_xyToNode2=new o.A(n,o.T.st_nullNode()),this.m_freeEdges.length=0,this.m_AET.clear(),this.m_AET.setComparator(new ln(this));for(let r=0,o=2*n;this.m_unknownOrientationPathCount>0&&r<o;r++){const t=this.m_pairIndices.read(r),e=this.m_pairs[t];if(1&e)continue;const s=e>>1,n=this.m_xy.read(2*s+1);if(n!==this.m_yScanline&&i.length){if(!this.processBunchForRingOrientationTest(i))return 0;i.length=0}i.push(s),this.m_yScanline=n}return this.m_unknownOrientationPathCount>0&&!this.processBunchForRingOrientationTest(i)?0:this.m_bOGCRestrictions?0!==this.m_nonSimpleResult.m_reason?0:this.checkSelfIntersectionsPolygonsOGC()?5:0:0===this.m_nonSimpleResult.m_reason?4:3}processBunchForSelfIntersectionTest(t){if(1===t.length)return!0;for(let o=0,a=t.length;o<a;o++){const e=t[o];this.m_recycledSegIter.resetToVertex(e,-1);const s=this.m_recycledSegIter.previousSegment();this.m_edges.push(this.createEdge(s,e,this.m_recycledSegIter.getPathIndex(),!0)),this.m_recycledSegIter.nextSegment();const n=this.m_recycledSegIter.nextSegment();this.m_edges.push(this.createEdge(n,e,this.m_recycledSegIter.getPathIndex(),!1))}this.m_edges.sort(((t,e)=>this.edgeAngleCompare(t,e)));let e=this.m_crossOverHelperList.getFirstList();-1===e&&(e=this.m_crossOverHelperList.createList(0)),this.m_crossOverHelperList.reserveNodes(this.m_edges.length);for(let o=0,a=this.m_edges.length;o<a;o++)this.m_crossOverHelperList.addElement(e,o);let s=!0,n=-1,i=-1;for(;s;){s=!1;let t=this.m_crossOverHelperList.getFirst(e);if(-1===t)break;let r=this.m_crossOverHelperList.getNext(t);for(;-1!==r;){const o=this.m_crossOverHelperList.getData(t),a=this.m_crossOverHelperList.getData(r);if(n=this.m_edges[o].m_vertexIndex,i=this.m_edges[a].m_vertexIndex,n!==i)t=r,r=this.m_crossOverHelperList.getNext(t);else if(s=!0,this.m_crossOverHelperList.deleteElement(e,t),t=this.m_crossOverHelperList.getPrev(r),r=this.m_crossOverHelperList.deleteElement(e,r),-1===r||-1===t)break}}const r=this.m_crossOverHelperList.getListSize(e);if(this.m_crossOverHelperList.clear(e),r>0)return this.m_nonSimpleResult=new d.NonSimpleResult(7,n,i),!1;for(let o=0,a=t.length;o<a;o++)this.recycleEdge(this.m_edges[o]);return this.m_edges.length=0,!0}processBunchForRingOrientationTest(t){for(let e=0,s=t.length;e<s;e++){const s=t[e];let n=this.m_xyToNode1.read(s);if(n!==o.T.st_nullNode()){const t=this.m_AET.getElement(n);this.m_freeEdges.push(t),this.m_AET.deleteNode(n),this.recycleEdge(this.m_edges[t]),this.m_edges[t]=null,this.m_xyToNode1.write(s,o.T.st_nullNode())}if(n=this.m_xyToNode2.read(s),n!==o.T.st_nullNode()){const t=this.m_AET.getElement(n);this.m_freeEdges.push(t),this.m_AET.deleteNode(n),this.recycleEdge(this.m_edges[t]),this.m_edges[t]=null,this.m_xyToNode2.write(s,o.T.st_nullNode())}}for(let e=0,s=t.length;e<s;e++){const s=t[e];this.m_recycledSegIter.resetToVertex(s,-1);const n=this.m_recycledSegIter.previousSegment();if(n.getStartY()>n.getEndY()){const t=this.m_recycledSegIter.getStartPointIndex(),e=this.createEdge(n,s,this.m_recycledSegIter.getPathIndex(),!0);let i;this.m_freeEdges.length>0?(i=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[i]=e):(i=this.m_edges.length,this.m_edges.push(e));const r=this.m_AET.addElement(i);this.m_xyToNode1.read(t)===o.T.st_nullNode()?this.m_xyToNode1.write(t,r):this.m_xyToNode2.write(t,r),3&this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())||this.m_newEdges.push(r)}this.m_recycledSegIter.nextSegment();const i=this.m_recycledSegIter.nextSegment();if(i.getStartY()<i.getEndY()){const t=this.m_recycledSegIter.getEndPointIndex(),e=this.createEdge(i,s,this.m_recycledSegIter.getPathIndex(),!1);let n;this.m_freeEdges.length>0?(n=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[n]=e):(n=this.m_edges.length,this.m_edges.push(e));const r=this.m_AET.addElement(n);this.m_xyToNode1.read(t)===o.T.st_nullNode()?this.m_xyToNode1.write(t,r):this.m_xyToNode2.write(t,r),3&this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())||this.m_newEdges.push(r)}}for(let e=0,s=this.m_newEdges.length;e<s&&this.m_unknownOrientationPathCount>0;e++){const t=this.m_newEdges[e],s=this.m_AET.getElement(t),n=this.m_edges[s].m_pathIndex;if(!(3&this.m_pathOrientations.read(n))){let e=-1,s=this.m_AET.getPrev(t),n=t,i=0;{let t=-1,r=null,a=-1,l=0;for(;s!==o.T.st_nullNode()&&(t=this.m_AET.getElement(s),r=this.m_edges[t],a=r.m_pathIndex,l=this.m_pathOrientations.read(a),!(3&l));)n=s,s=this.m_AET.getPrev(s);s===o.T.st_nullNode()?(i=1,s=n):(e=1==(3&l)?a:this.m_pathParentage.read(a),i=r.getRightSide()?0:1,s=this.m_AET.getNext(s))}do{const t=this.m_AET.getElement(s),r=this.m_edges[t],o=r.m_pathIndex;let a=this.m_pathOrientations.read(o);if(!(3&a)){if(i!==r.getRightSide())return this.m_nonSimpleResult=new d.NonSimpleResult(8,o,-1),!1;const t=i&&!r.getReversed()?1:2;if(a=-4&a|t,this.m_pathOrientations.write(o,a),2===t&&0===this.m_nonSimpleResult.m_reason){const t=this.m_pathParentage.read(o);if(t!==e&&(this.m_nonSimpleResult=new d.NonSimpleResult(9,o,t),this.m_bOGCRestrictions))return!1}if(this.m_unknownOrientationPathCount--,!this.m_unknownOrientationPathCount)return!0}e=1==(3&a)?o:this.m_pathParentage.read(o),n=s,s=this.m_AET.getNext(s),i=i?0:1}while(n!==t)}}return this.m_newEdges.length=0,!0}createEdge(t,e,s,n){let r;return t.getGeometryType()===i.G.enumLine?r=this.createEdgeLine(t):(r=new tn,r.m_segment=t.clone()),r.m_vertexIndex=e,r.m_pathIndex=s,r.m_flags=0,r.setReversed(n),r}createEdgeLine(t){let e;return this.m_lineEdgesRecycle.length>0?(e=this.m_lineEdgesRecycle.at(-1),this.m_lineEdgesRecycle.pop(),t.copyTo(e.m_segment)):(e=new tn,e.m_segment=t.clone()),e}recycleEdge(t){t.m_segment.getGeometryType()===i.G.enumLine&&this.m_lineEdgesRecycle.push(t)}static isShortSegment(t,e,s,n){let i=t.calculateLowerLength2D();if(i<=s){let r=!0;if(t.isCurve()&&(i=t.calculateLength2D(),r=i<=s),r){if(e){let e=t.getEndAttributeAsDbl(1,0);Number.isNaN(e)&&(e=0);let s=t.getStartAttributeAsDbl(1,0);return Number.isNaN(s)&&(s=0),Math.abs(s-e)<=n}return!0}return!1}return!1}static isShortSegmentPoints(t,e,s,n,i){if(s){const s=t.getXYZ(),r=e.getXYZ();return(0,o.W)(s,r,n,i)}{const s=t.getXY(),i=e.getXY();return a.P.sqrDistance(s,i)<=n*n}}removeDegenerateSegmentsFromCurvedPath(t,e,s,n){const r=t.hasAttribute(1),l=t.querySegmentIterator();l.resetToPath(e),(0,i.g)(l.nextPath());const h=this.m_toleranceSimplify.total();let u=!1,c=!0;const m=new o.P,d=new o.P,g=new a.P;for(;l.hasNextSegment();){this.progress_();const t=l.nextSegment();if(hn.isShortSegment(t,r,h,s))if(u){if(t.queryEnd(d),hn.isShortSegmentPoints(m,d,r,h,s))continue;c&&(n.startPathPoint(m),c=!1),t.queryEnd(m),n.lineToPoint(m),u=!1}else g.assign(t.getStartXY()),t.queryStart(m),u=!0;else if(u)if(t.isCurve()){const e=t.clone();if(e.setCoordsForIntersector(g,t.getEndXY(),!1),e.setStart(m),hn.isShortSegment(e,r,h,s))continue;n.addSegment(e,c),c=!1,u=!1}else{if(t.queryEnd(d),hn.isShortSegmentPoints(m,d,r,h,s))continue;c&&(n.startPathPoint(m),c=!1),n.lineToPoint(d),u=!1}else n.addSegment(t,c),c=!1}if(c)return;if(!u)return;t.isClosedPath(e)?t.getPointByVal(t.getPathStart(e),m):t.getPointByVal(t.getPathEnd(e)-1,m);const p=n.querySegmentIterator();p.resetToLastPath(),p.resetToLastSegment();const _=n.getDescription().getAttributeCount()>1;for((0,i.g)(p.previousPath());p.hasPreviousSegment();){const t=p.previousSegment();if(t.isCurve()){const e=t.clone();if(e.setCoordsForIntersector(t.getStartXY(),m.getXY(),!1),!hn.isShortSegment(e,r,h,s)){_&&e.setEnd(m);const t=p.getEndPointIndex();for(let e=n.getPointCount()-1;e>=t;e--)n.removePoint(e);return void n.addSegment(e,!1)}}else if(t.queryStart(d),!hn.isShortSegmentPoints(d,m,r,h,s)){const t=p.getEndPointIndex();for(let e=n.getPointCount()-1;e>=t;e--)n.removePoint(e);return void n.lineToPoint(m)}}n.removePath(n.getPathCount()-1)}multipointIsSimpleAsFeature(){if(!this.checkStructure())return 0;const t=this.m_geometry.getImpl();this.m_multiVertexGeom=t;const e=t.getPointCount(),s=(0,a.d)(e,0);for(let n=0;n<e;n++)s[n]=n;s.sort(((t,e)=>this.compareVerticesMultiPoint(t,e)));for(let n=1;n<e;n++)if(0===this.compareVerticesMultiPoint(s[n-1],s[n]))return this.m_nonSimpleResult=new d.NonSimpleResult(5,s[n-1],s[n]),0;return 1}polylineIsSimpleAsFeature(){return this.checkStructure()&&this.checkDegenerateSegments(!0)?1:0}polygonIsSimpleAsFeature(){return this.isSimplePlanarImpl()}multipointSimplifyAsFeature(){let t=this.m_geometry.getImpl();const e=hn.hasNanZs(t);let s,n=this.m_geometry;e&&(s=this.m_geometry.clone(),t=s.getImpl(),s.replaceNaNs(1,o.V.getDefaultValue(1)),n=s),this.m_multiVertexGeom=t;const i=t.getPointCount(),r=(0,a.d)(i,0);for(let o=0;o<i;o++)r[o]=o;r.sort(((t,e)=>this.compareVerticesMultiPoint(t,e)));const l=new Array(i);l.fill(!1);let h=-1;for(let o=0;o<i;o++){const e=r[o];t.getXY(e).isFinite()&&((h<0||0!==this.compareVerticesMultiPoint(h,e))&&(l[e]=!0),h=e)}const u=this.m_geometry.createInstance();let c=0,m=0;for(let o=0;o<i;o++)l[o]?m=o+1:(c<m&&u.addPoints(n,c,m),c=o+1);return c<m&&u.addPoints(n,c,m),u.getImpl().setIsSimple(1,this.m_toleranceSimplify.total()),u}polylineSimplifyAsFeature(){const t=this.m_geometry.getImpl(),e=t.querySegmentIterator(),s=t.querySegmentIterator(),n=this.m_geometry.createInstance(),i=this.m_geometry,r=t.hasAttribute(1),l=r?(0,o.R)(this.m_sr,t,!0).total():0,h=[],u=[];let c=null;r&&(c=t.getAttributeStreamRef(1));const m=new o.P,d=t.hasNonLinearSegments(),g=this.m_toleranceSimplify.total();for(;e.nextPath();){if(s.nextPath(),t.getPathSize(e.getPathIndex())<2)continue;if(d&&t.hasNonLinearSegmentsPath(e.getPathIndex())){this.removeDegenerateSegmentsFromCurvedPath(t,e.getPathIndex(),l,n);continue}s.resetToLastSegment();let o=0,p=0,_=!0,f=!0;for(;e.hasNextSegment();){this.progress_();const n=e.nextSegment(),i=s.previousSegment();if(e.getStartPointIndex()>s.getStartPointIndex())break;if(_){const s=e.getStartPointIndex();t.getXY(s).isNAN()||(_=!1,h.push(s))}if(f){const e=s.getEndPointIndex();t.getXY(e).isNAN()||(u.push(e),f=!1)}if(!_){const s=h.at(-1),i=e.getEndPointIndex();if(i-s>1){const e=new a.P;e.setSub(t.getXY(s),t.getXY(i)),o=e.length()}else o=n.calculateLength2D();if(o>g)h.push(i),o=0;else if(r){let t=c.read(s);Number.isNaN(t)&&(t=0);let e=c.read(i);Number.isNaN(e)&&(e=0),Math.abs(e-t)>l&&(h.push(i),o=0)}}if(!f){const e=u.at(-1),n=s.getStartPointIndex();if(n-e>1){const s=new a.P;s.setSub(t.getXY(e),t.getXY(n)),p=s.length()}else p=i.calculateLength2D();if(p>g)u.push(n),p=0;else if(r){let t=c.read(e);Number.isNaN(t)&&(t=0);let s=c.read(n);Number.isNaN(s)&&(s=0),Math.abs(s-t)>l&&(u.push(n),p=0)}}}if(h.length>0&&u.length>0&&(h.at(-1)<u.at(-1)?h.length>u.length?h.pop():u.pop():(h.at(-1)===u.at(-1)||u.pop(),u.pop())),u.length+h.length>=2){let t=!1;for(let e=0,s=h.length;e<s;e++)i.getPointByVal(h[e],m),t?n.lineToPoint(m):(n.startPathPoint(m),t=!0);for(let e=u.length-1;e>0;e--)i.getPointByVal(u[e],m),t?n.lineToPoint(m):(n.startPathPoint(m),t=!0);i.isClosedPath(e.getPathIndex())?n.closePathWithLine():u.length>0&&(i.getPointByVal(u[0],m),n.lineToPoint(m))}h.length=0,u.length=0}return r&&n.replaceNaNs(1,0),n.getImpl().setIsSimple(1,g),n}polygonSimplifyAsFeature(){return this.simplifyPlanar()}simplifyPlanar(){if(1===this.m_geometry.getFillRule()&&!(0,o.X)(this.m_knownSimpleResult))return Ls(this.m_geometry,this.m_toleranceSimplify,!0,!1,this.m_knownSimpleResult,this.m_progressTracker,0,!0);const t=new r.E;if(t.addGeometry(this.m_geometry),this.m_geometry.hasAttribute(1)&&t.replaceNaNs(1,0),t.removeNaNVertices(),0!==t.getTotalPointCount()){let e=null,s=0,r=0;if(t.hasCurves()){e=new xs;const i=n.Envelope2D.constructEmpty();this.m_geometry.queryEnvelope(i);const o=_s(this.m_toleranceSimplify.total(),i);s=fs(this.m_toleranceSimplify.total()),r=ys(o,s),ms(t,o,this.m_toleranceSimplify.total(),0,e,null,this.m_progressTracker)}(0,o.X)(this.m_knownSimpleResult)||bs(t,this.m_toleranceSimplify.add(r),this.m_progressTracker,!0,!1),this.m_geometry.getGeometryType()===i.G.enumPolygon&&zt(t,t.getFirstGeometry(),this.m_knownSimpleResult,!1,-1,this.m_progressTracker),null!==e&&e.stitchCurves(t,t.getFirstGeometry(),s,!0)}const e=t.getGeometry(t.getFirstGeometry());return e.getGeometryType()===i.G.enumPolygon&&(e.getImpl().updateOGCFlagsProtected(),e.setFillRule(0)),e.getImpl().setIsSimple(4,this.m_toleranceSimplify.total()),e}progress_(){}static hasNanZs(t){if(t.hasAttribute(1)){const e=t.getAttributeStreamRef(1);for(let s=0,n=t.getPointCount();s<n;s++){const t=e.read(s);if(Number.isNaN(t))return!0}}return!1}compareVerticesForPlanarClustering(t,e,s){if(t===e)return 0;const n=this.m_pairs[t],i=this.m_pairs[e],r=n>>1,o=i>>1,l=this.m_xy.readPoint2D(2*r);l.y+=1&n?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;const h=this.m_xy.readPoint2D(2*o);h.y+=1&i?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;const u=l.compare(h);if(0===u&&s){const t=this.m_pathsForOGCTests[r]-this.m_pathsForOGCTests[o];return(0,a.e)(t)}return u}compareVerticesMultiPoint(t,e){if(t===e)return 0;const s=this.m_multiVertexGeom.getXY(t),n=this.m_multiVertexGeom.getXY(e),i=!s.isFinite(),r=!n.isFinite();if(i||r)return i<r?-1:i>r?1:0;if(s.y<n.y)return-1;if(s.y>n.y)return 1;if(s.x<n.x)return-1;if(s.x>n.x)return 1;for(let l=1;l<this.m_attributeCount;l++){const s=this.m_description.getSemantics(l),n=o.V.getComponentCount(s);for(let i=0;i<n;i++){const n=this.m_multiVertexGeom.getAttributeAsDbl(s,t,i),r=this.m_multiVertexGeom.getAttributeAsDbl(s,e,i),o=(0,a.r)(n,r);if(0!==o)return o}}return 0}edgeAngleCompare(t,e){if(t===e)return 0;const s=t.m_segment.getTangent(t.getReversed()?1:0);t.getReversed()&&s.negateThis();const n=e.m_segment.getTangent(e.getReversed()?1:0);e.getReversed()&&n.negateThis();const i=s.getQuarter(),r=n.getQuarter();if(r===i){const t=s.crossProduct(n);return t<0?1:t>0?-1:0}return i<r?-1:1}}class un{getOperatorType(){return 10103}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}supportsCurves(){return!0}isSimpleAsFeature(t,e,s,n,i){const r=$s(t,e,s,n,i);return(0,o.M)(t.getGeometryType(),r)}isSimplePlanarDONOTUSE(t,e,s,a,l){const h=function(t,e,s,a,l){if(a&&(a.m_reason=0,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),t.isEmpty())return 5;const h=t.getGeometryType();if(h===i.G.enumPoint)return Js(t,a);const u=(0,o.b)(e,t,!1).total();if(h===i.G.enumEnvelope){const e=t,s=new n.Envelope2D;return e.queryEnvelope(s),s.isDegenerate(u)?(a&&(a.m_reason=4,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),0):5}if((0,i.f)(h)){const n=t,i=new r.P({vd:n.getDescription()});return i.addSegment(n,!0),$s(i,e,s,a,l)}const c=t.getImpl().getIsSimple(u,[0]);let m=s?-1:c;if((0,o.i)(m)||0===m)return m;const d=new hn(t,e,m,l,!1);return h===i.G.enumMultiPoint||h===i.G.enumPolyline||h===i.G.enumPolygon?m=d.isSimplePlanarImpl():(0,i.d)(""),t.getImpl().setIsSimple(m,u),a&&a.assign(d.m_nonSimpleResult),m}(t,e,s,a,l);return(0,o.i)(h)}executeMany(t,e,s,n){return new cn(t,e,s,n)}execute(t,e,s,n){const r=new m.S([t]),o=this.executeMany(r,e,s,n).next();return o||(0,i.d)("null geometry"),o}}class cn extends m.G{constructor(t,e,s,n){super(),this.m_progressTracker=n,this.m_bForceSimplify=s,this.m_index=-1,this.m_inputGeometryCursor=t,this.m_spatialReference=e}next(){const t=this.m_inputGeometryCursor.next();return t?(this.m_index=this.m_inputGeometryCursor.getGeometryID(),this.simplify(t)):null}getGeometryID(){return this.m_index}tock(){return!1}getRank(){return 1}simplify(t){if(t||(0,i.a)(""),t.getGeometryType()===i.G.enumGeometryCollection){const e=(0,r.g)(t,-1),s=(new un).executeMany(e,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker),n=t.createInstance();for(let t=s.next();null!=t;t=s.next())n.addGeometry(t);return n}return Ks(t,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker)}}class mn{constructor(t,e,s,n){this.m_intersectorGeom=null,this.m_sr=null,this.m_dimensionMask=-1,this.m_progressTracker=null,this.m_intersectorGeomType=i.G.enumUnknown,this.m_geomIntersectorEmptyGeom=null,this.m_intersectorGeom=t,this.m_sr=e,this.m_dimensionMask=s,this.m_progressTracker=n,this.m_intersectorGeomType=t.getGeometryType()}intersect(t){const e=this.tryFastImplementation(t);if(null!==e)return e;const s=(0,o.g)(this.m_intersectorGeom,t),l=(0,o.c)(this.m_sr,s,!0).total(),h=n.Envelope2D.constructEmpty();this.m_intersectorGeom.queryEnvelope(h);const c=n.Envelope2D.constructEmpty();t.queryEnvelope(c),h.inflateCoords(2*l,2*l),h.intersect(c),h.inflateCoords(100*l,100*l);let m=(0,u.c)(this.m_intersectorGeom,h,0,0,this.m_progressTracker),d=(0,u.c)(t,h,0,0,this.m_progressTracker);return t.getDimension()>this.m_intersectorGeom.getDimension()&&(m=(0,a.c)(d,d=m)),function(t,e,s,a){const l=n.Envelope2D.constructEmpty();t.queryEnvelope(l);const h=n.Envelope2D.constructEmpty();e.queryEnvelope(h);const u=n.Envelope2D.constructEmpty();u.setCoords({env2D:l}),u.mergeEnvelope2D(h);const c=(0,o.c)(s,u,!0),m=new n.Envelope2D(h),d=(0,o.e)(c);if(m.inflateCoords(d,d),!l.isIntersecting(m)){if(t.getDimension()<=e.getDimension())return Us(Hs(t.createInstance()),t,0,"&");if(t.getDimension()>e.getDimension())return Us(Hs(e.createInstance()),t,0,"&")}const g=new Ys(a),p=new r.E,_=p.addGeometry(Hs(t)),f=p.addGeometry(Hs(e));let y=0,x=0,v=null;if(p.hasCurves()){v=new xs;const t=p.getEnvelope2D(a);x=fs(c.total());const e=_s(c.total(),t);y=ys(e,x),ms(p,e,c.total(),0,v,null,a)}g.setEditShapeCrackAndCluster(p,c.add(y));const b=g.intersection(_,f);null!==v&&v.stitchCurves(p,b,x,!0);const P=Us(p.getGeometry(b),t,0,"&");return Ms(P.getGeometryType())&&(P.getImpl().setIsSimple(4,c.total()),P.getGeometryType()===i.G.enumPolygon&&P.getImpl().updateOGCFlagsProtected()),P}(d,m,this.m_sr,this.m_progressTracker)}intersectEx(t){const e=this.tryFastImplementation(t);if(null!==e){const s=[];return s.length=3,s[e.getDimension()]=e,this.prepareVector(t.getDescription(),this.m_dimensionMask,s)}const s=(0,o.g)(this.m_intersectorGeom,t),l=(0,o.c)(this.m_sr,s,!0).total(),h=n.Envelope2D.constructEmpty();this.m_intersectorGeom.queryEnvelope(h);const c=n.Envelope2D.constructEmpty();t.queryEnvelope(c),h.inflateCoords(2*l,2*l),h.intersect(c),h.inflateCoords(100*l,100*l);let m=(0,u.c)(this.m_intersectorGeom,h,0,0,this.m_progressTracker),d=(0,u.c)(t,h,0,0,this.m_progressTracker);t.getDimension()>this.m_intersectorGeom.getDimension()&&(m=(0,a.c)(d,d=m));const g=function(t,e,s,a){const l=new Array(3),h=n.Envelope2D.constructEmpty();t.queryEnvelope(h);const u=n.Envelope2D.constructEmpty();e.queryEnvelope(u);const c=n.Envelope2D.constructEmpty();c.setCoords({env2D:h}),c.mergeEnvelope2D(u);const m=(0,o.c)(s,c,!0),d=new n.Envelope2D(u),g=(0,o.e)(m);if(d.inflateCoords(g,g),!h.isIntersecting(d)){if(t.getDimension()<=e.getDimension()){const e=Us(Hs(t.createInstance()),t,0,"&");return l[e.getDimension()]=e,l}if(t.getDimension()>e.getDimension()){const s=Us(Hs(e.createInstance()),t,0,"&");return l[s.getDimension()]=s,l}}const p=new Ys(a),_=new r.E,f=_.addGeometry(Hs(t)),y=_.addGeometry(Hs(e));let x=0,v=0,b=null;if(_.hasCurves()){b=new xs;const t=_.getEnvelope2D(a);v=fs(m.total());const e=_s(m.total(),t);x=ys(e,v),ms(_,e,m.total(),0,b,null,a)}p.setEditShapeCrackAndCluster(_,m.add(x)),_.dbgVerifyCurves();const P=p.intersectionEx(f,y);for(const n of P){null!==b&&b.stitchCurves(_,n,v,!1);const e=Us(_.getGeometry(n),t,0,"&");Ms(e.getGeometryType())&&(e.getImpl().setIsSimple(4,m.total()),e.getGeometryType()===i.G.enumPolygon&&e.getImpl().updateOGCFlagsProtected()),l[e.getDimension()]=e}return null!==b&&b.clearStitcher(_),l}(d,m,this.m_sr,this.m_progressTracker);return this.prepareVector(t.getDescription(),this.m_dimensionMask,g)}init(t,e,s,n=null){(0,i.g)(0)}static intersectPoints(t,e,s){const n=(0,o.g)(t,e);return Os(t,e,(0,o.c)(s,n,!0))}tryFastImplementation(t){const e=t.getGeometryType();if(this.m_intersectorGeomType===i.G.enumPoint&&e===i.G.enumPoint){const e=mn.intersectPoints(t,this.m_intersectorGeom,this.m_sr);if(-1!==this.m_dimensionMask){const t=new r.M({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}return e}if(e===i.G.enumEnvelope&&this.m_intersectorGeomType===i.G.enumEnvelope&&(-1===this.m_dimensionMask||4===this.m_dimensionMask)){const e=t,s=this.m_intersectorGeom,n=new o.E({copy:e});return n.intersect(s),n}const s=(0,o.g)(t,this.m_intersectorGeom),a=(0,o.c)(this.m_sr,s,!0),l=t.isEmpty(),h=this.m_intersectorGeom.isEmpty();let c=l||h;if(!c){const e=function(t,e,s){const r=new n.Envelope2D;t.queryEnvelope(r);const o=new n.Envelope2D;e.queryEnvelope(o);const a=new n.Envelope2D(o);if(a.inflate(2*s),!a.isIntersecting(r))return 4;const l=t.getGeometryType(),h=e.getGeometryType();if(l===i.G.enumEnvelope&&r.containsEnvelope(a))return 1;if(h===i.G.enumEnvelope){const t=new n.Envelope2D(r);if(t.inflate(2*s),o.containsEnvelope(t))return 2}return 0}(this.m_intersectorGeom,t,a.total());if(4===e)c=!0;else{if(2&e)return this.m_intersectorGeom;if(1&e)return t}}if(c){const s=(0,i.z)(e),n=(0,i.z)(this.m_intersectorGeomType);return s<n?mn.ReturnEmpty(t,l):s>n||0===s&&e===i.G.enumMultiPoint&&this.m_intersectorGeomType===i.G.enumPoint?this.ReturnEmptyIntersector():mn.ReturnEmpty(t,l)}if(e===i.G.enumEnvelope&&0===(0,i.z)(this.m_intersectorGeomType)||this.m_intersectorGeomType===i.G.enumEnvelope&&0===(0,i.z)(e)){const s=e===i.G.enumEnvelope?t:this.m_intersectorGeom,r=e===i.G.enumEnvelope?this.m_intersectorGeom:t,o=n.Envelope2D.constructEmpty();return s.queryEnvelope(o),(0,u.c)(r,o,a.total(),0,this.m_progressTracker)}if(0===(0,i.z)(e)&&(0,i.z)(this.m_intersectorGeomType)>0||(0,i.z)(e)>0&&0===(0,i.z)(this.m_intersectorGeomType)){if(e===i.G.enumMultiPoint)return Gs(t,this.m_intersectorGeom,a);if(e===i.G.enumPoint)return zs(t,this.m_intersectorGeom,a);if(this.m_intersectorGeomType===i.G.enumMultiPoint)return Gs(this.m_intersectorGeom,t,a);if(this.m_intersectorGeomType===i.G.enumPoint)return zs(this.m_intersectorGeom,t,a);(0,i.d)("")}return null}ReturnEmptyIntersector(){return null===this.m_geomIntersectorEmptyGeom&&(this.m_geomIntersectorEmptyGeom=this.m_intersectorGeom.createInstance()),this.m_geomIntersectorEmptyGeom}static ReturnEmpty(t,e){return e?t:t.createInstance()}prepareVector(t,e,s){let n=0;return 1&e?(s[0]||(s[0]=new r.M({vd:t})),n++):s.shift(),2&e?(s[n]||(s[n]=new r.P({vd:t})),n++):s.splice(n,1),4&e?s[n]||(s[n]=new r.a({vd:t})):s.splice(n,1),new m.S(s)}}class dn extends m.G{constructor(t,e,s,n,r){super(),this.m_smallCursor=null,this.m_progressTracker=n,this.m_geomIntersector=e.next(),this.m_intersector=new mn(this.m_geomIntersector,s,r,n),this.m_index=-1,this.m_inputGeoms=t,this.m_dimensionMask=r,-1!==this.m_dimensionMask&&(this.m_dimensionMask<=0||this.m_dimensionMask>7)&&(0,i.a)("bad dimension mask")}next(){if(!this.m_geomIntersector)return null;let t;if(null!==this.m_smallCursor){if(t=this.m_smallCursor.next(),t)return t;this.m_smallCursor=null}for(;t=this.m_inputGeoms.next();)return(0,i.c)(t),this.m_index=this.m_inputGeoms.getGeometryID(),-1===this.m_dimensionMask?this.m_intersector.intersect(t):(this.m_smallCursor=this.m_intersector.intersectEx(t),this.m_smallCursor.next());return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}class gn{getOperatorType(){return 1e4}accelerateGeometry(t,e,s){if(!this.canAccelerateGeometry(t))return!1;(0,o.b)(e,t,!0);let n=0;return t.getGeometryType()!==i.G.enumPolygon&&t.getGeometryType()!==i.G.enumPolyline||!(0,r.I)(t)||0===s||(n|=t.getImpl().buildQuadTreeAccelerator(s)?1:0),!!n}canAccelerateGeometry(t){return(0,r.I)(t)}supportsCurves(){return!0}executeMany(t,e,s,n,i=-1){return new dn(t,e,s,n,i)}execute(t,e,s,n){if(t.getGeometryType()===i.G.enumPoint&&e.getGeometryType()===i.G.enumPoint)return mn.intersectPoints(t,e,s);const r=new m.S([t]),o=new m.S([e]),a=this.executeMany(r,o,s,n,-1).next();return a||(0,i.d)("null output"),a}}function pn(t,e,s){return e.m_projector.project(t,s)}function _n(t,e,s,n,i){return t.m_projector.transformInPlaceZ(e,null,s,n,null,i)}function fn(t,e,s,a){if(t&&e&&e.isPannable()||(0,i.a)("fold_into_360_range_geodetic"),t.isEmpty())return t;if(4===s)return yn(t,e,a);let l=t;const h=l.getGeometryType();if((0,i.h)(h)){l=zi(t,e);const i=new n.Envelope2D;l.queryEnvelope(i);const r=(0,o.c)(e,i,!1).total(),a=e.getPannableExtent();let h=Math.floor((i.xmin-a.xmin)/a.width())*a.width()+a.xmin,u=l;for(;h<i.xmax;)h>i.xmin+r&&h<i.xmax-r&&(u=Gi(u,e,s,!0,h)),h+=a.width();l=u}else{if(h===i.G.enumEnvelope){const t=new r.a({vd:l.getDescription()});return t.addEnvelope(l,!1),fn(t,e,s,a)}if((0,i.f)(h)){const t=new r.P({vd:l.getDescription()});return t.addSegment(l,!0),fn(t,e,s,a)}}return yn(l,e,a)}function yn(t,e,s){if(t&&e&&e.isPannable()||(0,i.a)(""),t.isEmpty())return t;let n;const o=t.getGeometryType();if(o===i.G.enumEnvelope){const e=new r.a({vd:t.getDescription()});e.addEnvelope(t,!1),n=e}else if((0,i.f)(o)){const e=new r.P({vd:t.getDescription()});e.addSegment(t,!0),n=e}else n=t;const a=zi(n,e);return a.isEmpty()?a:Ni(a,e,0,a!==t,0,s)}function xn(t,e,s,n){const i=e.getXYGridRange(),r=t.hasAttribute(1),l=t.hasAttribute(2);let h=new a.E,c=new a.E;r&&(h=e.getZGridRange()),l&&(c=e.getMGridRange());let m=(new u.O).execute(t,i,s,n);if(r){const e=m.queryInterval(1,0);h.contains(e)||(t===m&&(m=m.clone()),(0,o.a5)(m,h,1,0))}if(l){const e=m.queryInterval(2,0);c.contains(e)||(t===m&&(m=m.clone()),(0,o.a5)(m,c,2,0))}return m}class vn{constructor(t){this.m_inputPCSHorizonClipOption=0,this.m_outputPCSHorizonClipOption=0,this.m_bDontGeonormalizePolygon=!1,this.m_bClipOutCurvedPoles=!1,this.m_bNormalizeOutputGeometry=!1,this.m_bDontHackPolesInGeogToGeog=!1,this.m_centralMeridianOfOutputGCS=0,this.m_densificationStepInput=0,t||(0,i.a)(""),this.m_projTransform=t,this.m_bClipOutCurvedPoles=!1;const e=this.m_projTransform.getExtendedParamsImpl();this.m_bNormalizeOutputGeometry=e.normalizeResultGeometry,this.m_bNormalizeOutputGeometry&&(e.legacyHorizonClipping?this.m_bNormalizeOutputGeometry=!1:this.m_projTransform.getOutputSR().isPannable()||(this.m_bNormalizeOutputGeometry=!1)),e.clipWithInputHorizon?(this.m_inputPCSHorizonClipOption=0,!e.legacyHorizonClipping&&this.m_projTransform.getInputSR().isPannable()&&(this.m_inputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_inputPCSHorizonClipOption=1,e.clipWithOutputHorizon?(this.m_outputPCSHorizonClipOption=0,!e.legacyHorizonClipping&&this.m_projTransform.getOutputSR().isPannable()&&(this.m_outputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_outputPCSHorizonClipOption=1,this.m_centralMeridianOfOutputGCS=e.centralMeridianOfOutputGCS,this.m_densificationStepInput=e.densificationStep;const s=this.m_projTransform.getExtendedParamsInternal();this.m_bDontGeonormalizePolygon=s.hasFlag(2147483648),this.m_bDontHackPolesInGeogToGeog=s.hasFlag(1073741824),this.m_bClipOutCurvedPoles=s.hasFlag(536870912)}project(t,e){if(this.m_projTransform.isIdentity()||t.isEmpty())return t;const s=t.getGeometryType();if(s===i.G.enumPoint)return this.projectPoint(t,e);const n=this.m_projTransform.getInputSR().getCoordinateSystemType(),r=this.m_projTransform.getOutputSR().getCoordinateSystemType(),o=this.m_projTransform.getInputSR(),a=this.m_projTransform.getOutputSR();if(0===n&&n===r){const e=Pn(o,a),s=t.clone();return s.applyTransformation(e),s}switch(s){case i.G.enumPolyline:case i.G.enumPolygon:return this.projectMultiPath(t,e);case i.G.enumMultiPoint:return this.projectMultiPoint(t,e);case i.G.enumEnvelope:return this.projectEnvelope(t,e);case i.G.enumGeometryCollection:return this.projectGeometryCollection(t,e);default:(0,i.d)("")}}projectPoint(t,e){const s=[t.getXY()];let n,i=null;(n=t.hasAttribute(1))&&(i=[t.getZ()]),this.transformInPlaceZ(s,i,1,s,i,null);const r=t.clone();return r.setXY(s[0]),n&&r.setZ(i[0]),r}projectMultiPoint(t,e){let s=new r.M({copy:t});const n=this.m_projTransform.getInputSR(),o=this.m_projTransform.getOutputSR(),a=n.getCoordinateSystemType(),l=o.getCoordinateSystemType();if(3===a&&(0,i.g)(0),s=Hi(s,n,this.m_inputPCSHorizonClipOption,e),s.isEmpty())return s;2===a&&Ji(n,0,s),rr(this.m_projTransform,s,!1);let h=0;3===l&&(0,i.g)(0);const u=2===l;return u?h=o.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(h=this.m_centralMeridianOfOutputGCS),u&&0!==this.m_outputPCSHorizonClipOption||(s=Ni(s,co(o),h,!1,0,e)),u&&(s=Ti(s,o,this.m_outputPCSHorizonClipOption,e),$i(o,s,this.m_bNormalizeOutputGeometry),s.isEmpty()),s}projectMultiPath(t,e){const s=t.getGeometryType();return s===i.G.enumPolygon?this.projectPolygon(t,e):s===i.G.enumPolyline?this.projectPolyline(t,e):void(0,i.d)("project_multi_path_")}projectEnvelope(t,e){this.m_projTransform.getInputSR(),this.m_projTransform.getOutputSR();const s=this.m_projTransform.isVertical()&&t.hasAttribute(1);let n=a.E.constructEmpty();if(s&&(n=t.queryInterval(1,0)),n.width()>0){const s=t.clone();s.setInterval(1,0,n.vmin,n.vmin);const i=this.projectEnvelopeHelper(s,e);s.setInterval(1,0,n.vmax,n.vmax);const r=this.projectEnvelopeHelper(s,e);return i.merge(r),i}return this.projectEnvelopeHelper(t,e)}projectPolygon(t,e){(0,i.g)(t.getGeometryType()===i.G.enumPolygon),(0,i.g)(!this.m_projTransform.isIdentity()),(0,i.g)(!t.isEmpty());const s=this.m_projTransform.getInputSR(),o=this.m_projTransform.getOutputSR(),a=s.getCoordinateSystemType(),l=o.getCoordinateSystemType(),h=new r.a({copy:t});3===a&&(0,i.g)(0),3===l&&(0,i.g)(0);const m=2===a,d=2===l,g=m?s.getGCS():s,p=d?o.getGCS():o,_=!d&&!this.m_bDontHackPolesInGeogToGeog;let f=!1,y=Hi(h,s,this.m_inputPCSHorizonClipOption,e);if(y.isEmpty())return y;let x=this.m_densificationStepInput;const v=!Number.isNaN(x);let b;v&&(y=(new c.O).execute(y,x,0,0,e));let P=d?o.getPCSInfo():null,S=Number.NaN;m&&(S=s.getCentralMeridian());const E=null!==o.getGCSSplitLines();if(this.m_bDontGeonormalizePolygon){const t=y;if(m&&(sr(s,S,t),v)){const t=s.getUnitsPerMillimeter();x*=s.getGCS().getUnitsPerMillimeter()/t}if(ar(this.m_projTransform,t,_),v){const t=s.getGCS().getUnitsPerMillimeter();x*=o.getGCS().getUnitsPerMillimeter()/t}b=t}else{let t=new r.P({vd:y.getDescription()});if(t.addAndExplicitlyOpenAllPaths(y,!1),m){if(sr(s,S,t),v){const t=s.getUnitsPerMillimeter();x*=s.getGCS().getUnitsPerMillimeter()/t}if(this.m_bClipOutCurvedPoles){const i=s.getPCSInfo(),r=i.getSouthPoleGeometry()===Bo.PE_POLE_LINE_CURVED,o=i.getNorthPoleGeometry()===Bo.PE_POLE_LINE_CURVED;if(r||o){const s=n.Envelope2D.constructEmpty();t.queryLooseEnvelope(s),s.inflateCoords(1,1);const i=89.9999*g.getOneDegreeGCSUnit();r&&(s.ymin=-i),o&&(s.ymax=i),t=(0,u.a)(t,s,g,0,0,e)}}}if(ar(this.m_projTransform,t,_),v){const t=co(s).getUnitsPerMillimeter();x*=co(o).getUnitsPerMillimeter()/t}let i=Number.NaN;d?(P=o.getPCSInfo(),i=o.getCentralMeridian()):Number.isNaN(this.m_centralMeridianOfOutputGCS)||(i=this.m_centralMeridianOfOutputGCS);let a=bn(s)|bn(o),l=10*p.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(a=3,l=10*p.getTolerance(0)),b=function(t,e,s,n,i,r,o,a,l){return new ni(t,null,s,e,n,i,o,a,r).geoNormalizePolygonGeometry(l)}(y,s,t,p,i,e,a,l,this.m_bNormalizeOutputGeometry),a=0}if(E&&((0,i.g)(!o.isPannable()),b=Ci(b,o,e)),d){if(!f){const t=p.getPannableExtent().width();if(b.queryInterval(0,0).width()>=t-10*p.getTolerance(0)){const t=P.getNorthPoleLocation(),e=P.getSouthPoleLocation(),s=P.getNorthPoleGeometry(),n=P.getSouthPoleGeometry();let i=0;s===Bo.PE_POLE_POINT&&t!==Bo.PE_POLE_OUTSIDE_BOUNDARY&&(i=1),n===Bo.PE_POLE_POINT&&e!==Bo.PE_POLE_OUTSIDE_BOUNDARY&&(i|=2),f||=0!==i}}b=Ti(b,o,this.m_outputPCSHorizonClipOption,e),v&&(b=(new c.O).execute(b,x,0,0,e)),Qi(o,b,this.m_bNormalizeOutputGeometry)}return b.isEmpty()||f&&(b=(new un).execute(b,o,!1,e)),b}projectPolyline(t,e){(0,i.g)(t.getGeometryType()===i.G.enumPolyline),(0,i.g)(!this.m_projTransform.isIdentity()),(0,i.g)(!t.isEmpty());const s=this.m_projTransform.getInputSR(),n=this.m_projTransform.getOutputSR(),o=s.getCoordinateSystemType(),a=n.getCoordinateSystemType(),l=new r.P({copy:t});3===o&&(0,i.g)(0),3===a&&(0,i.g)(0);const h=2===o,u=2===a;h&&s.getGCS();const m=u?n.getGCS():n,d=!u&&!this.m_bDontHackPolesInGeogToGeog;let g=Hi(l,s,this.m_inputPCSHorizonClipOption,e);if(g.isEmpty())return g;let p=Number.NaN;h&&(p=s.getCentralMeridian());const _=null!==n.getGCSSplitLines();let f=this.m_densificationStepInput;const y=!Number.isNaN(f);let x;if(y&&(g=(new c.O).execute(g,f,0,0,e)),this.m_bDontGeonormalizePolygon){if(h&&(sr(s,p,g),y)){const t=s.getUnitsPerMillimeter();f*=s.getGCS().getUnitsPerMillimeter()/t}if(ar(this.m_projTransform,g,d),y){const t=s.getGCS().getUnitsPerMillimeter();f*=n.getGCS().getUnitsPerMillimeter()/t}x=g}else{const t=new r.P({vd:g.getDescription()});if(t.addAndExplicitlyOpenAllPaths(g,!1),h&&(sr(s,p,t),y)){const t=s.getUnitsPerMillimeter();f*=s.getGCS().getUnitsPerMillimeter()/t}if(ar(this.m_projTransform,t,d),y){const t=s.getGCS().getUnitsPerMillimeter();f*=n.getGCS().getUnitsPerMillimeter()/t}let i=Number.NaN;u?i=n.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(i=this.m_centralMeridianOfOutputGCS);let o=bn(s)|bn(n),a=10*m.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(o=3,a=0),x=function(t,e,s,n,i,r,o,a,l){return new ni(t,null,s,e,n,i,o,a,r).geoNormalizePolylineGeometry(l)}(g,s,t,m,i,e,o,a,this.m_bNormalizeOutputGeometry),o=0}return _&&((0,i.g)(!n.isPannable()),x=Ci(x,n,e)),u&&(x=Ti(x,n,this.m_outputPCSHorizonClipOption,e),y&&(x=(new c.O).execute(x,f,0,0,e)),Qi(n,x,this.m_bNormalizeOutputGeometry)),x.isEmpty(),x}projectGeometryCollection(t,e){return(0,i.g)(0),{}}projectEnvelopeHelper(t,e){const s=(t.height()+t.width())/400;if(0!==s){const i=(new c.O).execute(t,s,0,0,e),a=this.projectMultiPath(i,e),l=new o.E({vd:t.getDescription()});if(a.isEmpty()){const s=Math.min(t.height(),t.width()),a=(0,o.b)(this.m_projTransform.getInputSR(),t,!0).total();if(s>100*a){const t=n.Envelope2D.constructEmpty(),e=(0,o.c)(this.m_projTransform.getOutputSR(),t,!0).total(),i=this.m_projTransform.getInputSR().getOneMeter()/this.m_projTransform.getOutputSR().getOneMeter();if(s>100*Math.max(a,e*i))return l}const h=new r.P;h.addAndExplicitlyOpenAllPaths(i,!1),this.projectMultiPath(h,e).queryEnvelope(l);const u=new r.M({vd:t.getDescription()});u.reserve(4);const c=new o.P;for(let e=0;e<4;e++)t.queryCornerByVal(e,c),u.add(c);const m=this.projectMultiPoint(u,e),d=new o.E;return m.queryEnvelope(d),l.merge(d),l}return a.queryEnvelope(l),l}{const s=t.getCenterXY(),n=new o.P(s),i=this.projectPoint(n,e),r=new o.E({vd:t.getDescription()});if(i.isEmpty())r.setEmpty();else{t.copyTo(r);const e=i.getXY();r.setCoords(e.x,e.y,e.x,e.y)}return r}}transformInPlace(t,e,s,n){return(0,i.g)(0),0}transformInPlaceZ(t,e,s,n,r,o){if(this.m_projTransform.isIdentity())return t!==n&&(0,a.aw)(n,t,s),e!==r&&(0,a.b)(r,e,0,0,s),s;const l=this.m_projTransform,h=l.getInputSR(),u=l.getOutputSR(),c=h.getCoordinateSystemType(),m=u.getCoordinateSystemType();if(0===c&&c===m)return Pn(h,u).transformPoints2D(t,s,n),l.isVertical()&&(0,i.g)(0),s;3===c&&(0,i.t)("image: transform_in_place_"),3===m&&(0,i.t)("image: transform_in_place_"),function(t,e,s,n,r){const o=n.getCoordinateSystemType();if(2===o){if(0===r)s!==t&&(0,a.aw)(s,t,e),function(t,e,s){const n=t.getPCSHorizon();if(n.getGeometryType()!==i.G.enumPolygon)if(n.getGeometryType()!==i.G.enumEnvelope)(0,i.a)("");else{const t=n;for(let n=0;n<s;n++)t.contains(e[n])||e[n].setNAN()}else{const i=t.getDefaultPrecisionSR().getTolerance(0),r=n;for(let t=0;t<s;t++)1!==rs(r,e[t],i)&&e[t].setNAN()}}(n,s,e);else if(s!==t&&(0,a.aw)(s,t,e),n.isPannable()){const t=n.getTolerance(0);(function(t,e,s,n){for(let i=0;i<e;i++){if(t[i].y<s.ymin||t[i].y>s.ymax){t[i].setNAN();continue}const e=t[i].x;t[i].x=ki(e,s,n)}})(s,e,n.getPannableExtent(),t),Fi(s,e,n,0)}}else{(0,i.g)(1===o);const r=n.getTolerance(0),a=n.getPannableExtent();for(let n=0;n<e;n++)s[n].assign(Ui(t[n],a,r))}}(t,s,n,h,this.m_inputPCSHorizonClipOption),r!==e&&(0,a.b)(r,e,0,0,s),2===c&&nr(h,0,n,s),cr(this.m_projTransform,n,r,s,!1);let d=0;const g=2===m;if(g?d=u.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(d=this.m_centralMeridianOfOutputGCS),g&&0!==this.m_outputPCSHorizonClipOption||Fi(n,s,u.getGCS(),d),g){if(!Di(n,s,u,this.m_outputPCSHorizonClipOption))for(let t=0;t<s;++t)n[t].setNAN();ji(u,n,s,!1)}let p=s;for(let i=0;i<s;++i)n[i].isNAN()&&(r&&(r[i]=Number.NaN),p--);return p}}function bn(t){if(2!==t.getCoordinateSystemType())return 0;let e=0;const s=t.getPCSInfo(),n=s.getNorthPoleLocation(),i=s.getSouthPoleLocation(),r=s.getNorthPoleGeometry(),o=s.getSouthPoleGeometry();return r===Bo.PE_POLE_POINT&&n!==Bo.PE_POLE_OUTSIDE_BOUNDARY&&(e=1),o===Bo.PE_POLE_POINT&&i!==Bo.PE_POLE_OUTSIDE_BOUNDARY&&(e|=2),e}function Pn(t,e){const s=t.getHorzUnitFactor(),n=e.getHorzUnitFactor();let i=1,r=1;const o=20015077/180;1===t.getUnit().getUnitType()&&(i=o),1===e.getUnit().getUnitType()&&(r=o);const a=s/n*(i!==r?i/r:1),l=new h.T;return l.setScaleCoords(a,a),l}let Sn=class{getOperatorType(){return 10300}supportsCurves(){return!0}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s){return!e||e.isIdentity()?t:new En(t,e,s)}execute(t,e,s){return e.isIdentity()?t:pn(t,e,s)}transform(t,e,s,n,i=!0){return i?function(t,e,s,n,i){t.m_projector.transformInPlaceZ(e,null,s,n,null,i);const r=n.slice(0,s).filter((t=>!t.isNAN()));for(let o=0,a=r.length;o<a;++o)n[o].assign(r[o]);return r.length}(t,e,s,n,null):_n(t,e,s,n,null)}transform3D(t,e,s,n,r=!0){return(0,i.g)(0),0}foldInto360Range(t,e){return yn(t,e,null)}foldInto360RangeGeodetic(t,e,s){return fn(t,e,s,null)}normalizeGeometryEx(t,e,s,n,l=0){return function(t,e,s,n,l){if(!e.isPannable()||t.isEmpty())return t;const u=t.getGeometryType();u===i.G.enumGeometryCollection&&(0,i.t)("not yet impl for geometry collection");const c=e.getPannableExtent();Number.isNaN(s)&&(s=c.getCenterX());const m=c.width(),d=.5*m,g=l>0,p=t.queryInterval(0,0);if(!g&&p.width()<d||!(0,i.i)(t.getGeometryType())){const e=p.getCenter();if(Math.abs(e-s)<=d)return t;{const n=new h.T,i=(0,a.ax)((s-e)/m)*m;n.setShiftCoords(i,0);const r=t.clone();return r.applyTransformation(n),r}}if(u===i.G.enumPolygon){let i=new r.P({vd:t.getDescription()});i.addAndExplicitlyOpenAllPaths(t,!1),g&&(i=Cn(i,e,2,l,Number.NaN,null,!0));const h=[];if(!n){{let s=t;g&&(s=new r.a,s.add(i,!1));const n=function(t,e,s){const n=Jr();e.querySpheroidData(n);const i=e.getGCS()!==e?e.getSRToGCSTransform():null,r=(0,a.m)(a.P,100),l=new o.d(0,0,0),h=t.getPointCount(),u=e.getGCS().getUnit().getUnitToBaseFactor();for(let o=0,a=h;o<a;){const e=Math.min(100,a-o);t.queryCoordinates(r,e,o,o+e),i&&(new Sn).transform(i,r,e,r,!1);for(let t=0;t<e;t++){if(r[t].isNAN())continue;r[t].scale(u);const e=C(n.majorSemiAxis,n.e2,r[t]);l.addThis(e)}o+=e}const c=T(n.majorSemiAxis,n.e2,l);c.scale(1/u);const m=t;if(!new Kn(e.getGCS(),c).project(m))return 0;s.length=t.getPathCount();const d=m.calculateArea2D()<0;for(let o=0,a=t.getPathCount();o<a;o++){const t=m.calculateRingArea2D(o),e=d?t<0:t>0;s[o]=e}return d?-1:1}(t,e,h);if(n)n<0&&i.reverseAllPaths();else{const t=s.getPathCount();for(let e=0;e<t;e++)h.push(s.calculateRingArea2D(e)>0)}}n=h}return new ni(null,n,i,null,e,s,3,0,null).geoNormalizePolygonGeometry(!0)}if(u===i.G.enumPolyline){let n=new r.P({vd:t.getDescription()});return n.addAndExplicitlyOpenAllPaths(t,!1),g&&(n=Cn(n,e,2,l,Number.NaN,null,!0)),new ni(null,null,n,null,e,s,3,0,null).geoNormalizePolylineGeometry(!0)}if(u===i.G.enumMultiPoint){const e=t,n=e.getAttributeStreamRef(0);let i,r=null,o=s,l=0;const h=.1*m;for(let s=0,u=e.getPointCount();s<u;s++){const e=n.read(2*s);let u=e-o;if(Math.abs(u)>d&&(u=(0,a.ax)(u/m)*m,l-=u,Math.abs(l)<h&&(l=0)),0!==l){r||(i=t.clone(),r=i.getAttributeStreamRef(0));const n=e+l;r.write(2*s,n)}o=e}return r?(i.notifyModified(),i):t}(0,i.d)("")}(t,e,s,n,l)}normalizeGeometry(t,e,s){return function(t,e,s){if(!e.isPannable()||t.isEmpty())return t;const n=e.getPannableExtent().width(),r=.5*n,o=t.queryInterval(0,0);if(o.width()<r||!(0,i.i)(t.getGeometryType())){if(Number.isNaN(s))return t;const e=o.getCenter();if(Math.abs(e-s)<=r)return t;{const i=new h.T,r=(0,a.ax)((s-e)/n)*n;i.setShiftCoords(r,0);const o=t.clone();return o.applyTransformation(i),o}}const l=t.getGeometryType(),u=t,c=u.getAttributeStreamRef(0),m=t.clone(),d=m.getAttributeStreamRef(0);let g=0,p=0,_=0,f=(0,i.h)(l)?0:-1;const y=a.E.constructEmpty();let x=!1;for(let h=0,v=u.getPointCount();h<v;h++){const t=c.read(2*h);h===p&&((0,i.h)(l)?(0===f&&Number.isNaN(s)&&(x=!0),f>0&&Number.isNaN(s)&&(s=y.getCenter(),x=!1),p=u.getPathEnd(f),f++):p=u.getPointCount(),Number.isNaN(s)?_=t:(_=s,g=0));let e=t-_;Math.abs(e)>r&&(e=(0,a.ax)(e/n)*n,g-=e,Math.abs(g)<.1*n&&(g=0));const o=t+g;d.write(2*h,o),x&&y.mergeCoordinate(o),_=t}return m.notifyModified(),m}(t,e,s)}clipToSpatialReference(t,e,s,r=0){return function(t,e,s,r){const o=e.getCoordinateSystemType();if(0===o){const n=new Eo;return e.queryPrecisionDescriptor(n),xn(t,n,e,s)}let a=t;2!==r&&3!==r||!e.isPannable()||(a=yn(a,e,s));const l=new Eo;if(e.queryPrecisionDescriptor(l),a=xn(a,l,e,s),0===r||a.isEmpty())return a;if(1===o){if(1===r){const t=new n.Envelope2D;a.queryLooseEnvelope(t);const i=e.getPannableExtent(),r=.01*i.width();return i.xmin=t.xmin-r,i.xmax=t.xmax+r,(new u.O).execute(a,i,e,s)}return a}if(2===o){const t=e.getPCSHorizon();if(1===r||2===r){const n=(new gn).execute(a,t,e,s);return n===t?n.clone():n}return a}if(3===o)return a;(0,i.d)("missing implementation")}(t,e,s,r)}};class En extends m.G{constructor(t,e,s){super(),this.m_projTrans=e,this.m_progressTracker=s,this.m_index=-1,t||(0,i.a)(""),this.m_inputGeoms=t}next(){const t=this.m_inputGeoms.next();return null!=t?((0,i.o)(t),(0,i.c)(t),this.m_index=this.m_inputGeoms.getGeometryID(),pn(t,this.m_projTrans,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}function Cn(t,e,s,n,o,a,l=!1){t||(0,i.a)("Geometry.Geodetic_densify.densify");let h=t.getGeometryType();if((0,i.c)(t),t.isEmpty()||(0,i.e)(h))return t;const u=new Dn;u.m_sr=e,u.m_gcs=e.getGCS(),u.m_transform=u.m_gcs!==e?e.getSRToGCSTransform():null,u.m_progressTracker=a;const c=Jr();let m,d,g;if(u.m_gcs.querySpheroidData(c),u.m_a=c.majorSemiAxis,u.m_eSquared=c.e2,u.m_rpu=u.m_gcs.getUnit().getUnitToBaseFactor(),u.m_gcsTolerance=u.m_gcs.getTolerance(0),u.m_radTolerance=u.m_gcsTolerance*u.m_rpu,u.m_maxLength=n,u.m_maxDeviation=o,u.m_curveType=s,h===i.G.enumEnvelope){const e=new r.a({vd:t.getDescription()});e.addEnvelope(t,!1),m=e,h=i.G.enumPolygon}else if((0,i.f)(h)){const e=new r.P({vd:t.getDescription()});e.addSegment(t,!0),m=e,h=i.G.enumPolyline}else m=t;if(4!==u.m_curveType){if((0,i.g)((0,i.h)(h)),d=u.replaceCurvesWithLinesAndProjectToGCSAsMultiPoint_(m),d.isEmpty())return d;d=wn(u.m_rpu,d);let t=u.geodeticDensify(d);l||(t=(new Sn).foldInto360RangeGeodetic(t,u.m_gcs,u.m_curveType)),g=u.m_transform&&!u.m_transform.isIdentity()?(new Sn).execute(t,u.m_transform.getInverse(),a):t}else{let t;if((0,i.g)((0,i.h)(h)),e.isPannable())t=zi(m,e);else{const s=e.getPCSHorizon();t=(new gn).execute(m,s,e,a),t===s&&(t=s.clone())}if(d=t,d.isEmpty())return d;g=u.shapePreservingDensify(d)}return g}function wn(t,e){const s=new n.Envelope2D;if(e.queryLooseEnvelope(s),s.width()*t<Math.PI)return e;let i=!1;const r=e.querySegmentIterator(),l=new a.P,h=new a.P;for(;r.nextPath();)for(;r.hasNextSegment();){const e=r.nextSegment();if(l.setCoordsPoint2D(e.getStartXY()),h.setCoordsPoint2D(e.getEndXY()),l.scale(t),h.scale(t),Math.abs(l.x-h.x)>Math.PI){if(!Tn(l,h)){i=!0;break}if(Math.abs(l.x-h.x)>2*Math.PI){i=!0;break}}}if(!i)return e;const u=e.createInstance();u.reserve(e.getPointCount());const c=e.getDescription().getAttributeCount()>1,m=new a.P,d=new a.P,g=new a.P(0,0),p=new a.P(0,0),_=new o.P;for(r.resetToFirstPath();r.nextPath();){let e=Number.NaN,s=0;for(;r.hasNextSegment();){const n=r.nextSegment();if(l.setCoordsPoint2D(n.getStartXY()),h.setCoordsPoint2D(n.getEndXY()),l.scale(t),h.scale(t),Number.isNaN(e)?(s=Yn(l.x,Number.NaN,s),g.setCoordsPoint2D(l)):g.setCoordsPoint2D(p),e=g.x,Tn(l,h)){if(h.x-l.x>2*Math.PI)for(;h.x-l.x>2*Math.PI;)h.x-=2*Math.PI;else if(h.x-l.x<2*-Math.PI)for(;h.x-l.x<2*-Math.PI;)h.x+=2*Math.PI;s=Yn(h.x,Number.NaN,s),p.setCoordsPoint2D(h)}else m.setCoordsPoint2D(h),Zn(m),s=Yn(m.x,e,s),p.setCoords(s+m.x,m.y);if(Math.abs(p.x-h.x)<.5&&p.setCoordsPoint2D(h),c)n.queryCoord(0,_),d.setCoordsPoint2D(g),d.scale(1/t),_.setXY(d),r.isFirstSegmentInPath()?u.startPathPoint(_):u.lineToPoint(_),r.isLastSegmentInPath()&&!r.isPathClosed()&&(n.queryCoord(1,_),d.setCoordsPoint2D(p),d.scale(1/t),_.setXY(d),u.lineToPoint(_));else{r.isFirstSegmentInPath()&&u.insertPath2D(-1,null,0,0,!0);const e=u.getPathCount()-1;d.setCoordsPoint2D(g),d.scale(1/t),u.insertPoint2D(e,-1,d),r.isLastSegmentInPath()&&!r.isPathClosed()&&(d.setCoordsPoint2D(p),d.scale(1/t),u.insertPoint2D(e,-1,d))}}}return u}function In(t,e,s,n,i,r,o,l,h,u,c,m){const d=new a.P,g=new a.P,p=n.compare(i)>0;qn(p,n,i,d,g);const _=Rn(t,e,s,d,g,r,o,l,h,u,null,c,m);return p&&On(h,u,null,c),_}function Tn(t,e){return!(!Lo(t.y,a.o)||!Lo(e.y,a.o))||!(!Lo(t.y,-a.o)||!Lo(e.y,-a.o))}function An(t,e){return!(!Lo(t.y,a.o)||Lo(e.y,a.o))||!(!Lo(t.y,-a.o)||Lo(e.y,-a.o))}function Mn(t,e){return!(!Lo(e.y,a.o)||Lo(t.y,a.o))||!(!Lo(e.y,-a.o)||Lo(t.y,-a.o))}class Dn{constructor(){this.m_sr=null,this.m_gcs=null,this.m_transform=null,this.m_progressTracker=null,this.m_a=0,this.m_eSquared=0,this.m_rpu=0,this.m_gcsTolerance=0,this.m_radTolerance=0,this.m_maxLength=0,this.m_maxDeviation=0,this.m_curveType=0}geodeticDensify(t){const e=t.createInstance(),s=t.querySegmentIterator(),n=[],i=[],o=new r.S,l=t.getDescription().getAttributeCount()>1;for(;s.nextPath();){const t=[0];for(;s.hasNextSegment();){const r=s.nextSegment(),h=r.getStartXY(),u=r.getEndXY();h.scale(this.m_rpu),u.scale(this.m_rpu);const c=new a.P,m=new a.P,d=h.compare(u)>0;qn(d,h,u,c,m),n.length=0,i.length=0,this.m_maxLength>0?Rn(this.m_a,this.m_eSquared,this.m_curveType,c,m,this.m_maxLength,this.m_maxDeviation,this.m_radTolerance,null,null,l?i:null,n,t):kn(),d&&On(null,null,l?i:null,n),n[0].setCoordsPoint2D(r.getStartXY()),n.at(-1).setCoordsPoint2D(r.getEndXY());const g=1/this.m_rpu;for(let t=1,e=n.length-1;t<e;t++)n[t].scale(g);if(l){const t=Bn(d,r,o);Fn(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),r,t,i,n,e)}else Nn(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),n,e)}}return e}shapePreservingDensify(t){const e=t.createInstance(),s=t.querySegmentIterator(),n=[],i=[],o=new r.S,a=t.getDescription().getAttributeCount()>1;for(;s.nextPath();)for(;s.hasNextSegment();){const t=s.nextSegment(),r=t.getStartXY(),l=t.getEndXY(),h=r.compare(l)>0,u=Bn(h,t,o);n.length=0,i.length=0,zn(this.m_a,this.m_eSquared,this.m_rpu,u,this.m_sr,this.m_maxLength,this.m_maxDeviation,a?i:null,n),h&&On(null,null,a?i:null,n),a?Fn(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),t,u,i,n,e):Nn(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),n,e)}return e}replaceCurvesWithLinesAndProjectToGCSAsMultiPoint_(t){const e=t.hasNonLinearSegments();if((!this.m_transform||this.m_transform.isIdentity())&&(t=zi(t,this.m_gcs),!e))return t;const s=t.createInstance();s.reserveParts(t.getPointCount(),t.getPathCount());for(let n=0,i=t.getPathCount();n<i;++n){let e=new r.M;const i=t.getPathStart(n),a=t.getPathEnd(n);e.addPoints(t,i,a);const l=t.isClosedPath(n);let h=!1;if(l&&a-i==1&&t.hasNonLinearSegmentsPath(n)){const s=new o.P;t.getPointByVal(i,s),e.add(s),h=!0}if(this.m_transform&&!this.m_transform.isIdentity()){if(l&&!h){const s=new o.P;t.getPointByVal(i,s),e.add(s)}if(e=(new Sn).execute(e,this.m_transform,this.m_progressTracker),l&&e.getPointCount()>1){const t=e.getXY(0),s=e.getXY(e.getPointCount()-1);t.equals(s)&&e.removePoint(e.getPointCount()-1)}}e.getPointCount()>1&&(s.addPathMultiPoint(e,0,-1,!0),l&&s.closePathWithLine())}return s}}function Nn(t,e,s,n){t&&n.insertPath2D(-1,null,0,0,!0);const i=n.getPathCount()-1;n.insertPointsFromPoints(i,-1,s,0,s.length-1,!0),e&&n.insertPoint2D(i,-1,s.at(-1))}function Fn(t,e,s,n,i,r,a){a.reserve(a.getPointCount()+r.length-1);const l=new o.P;if(s.queryStart(l),t?a.startPathPoint(l):a.lineToPoint(l),r.length>2){const t=n.calculateLength2D();for(let e=1;e<r.length-1;e++){const s=n.lengthToT(i[e]*t);n.queryCoord(s,l),l.setXY(r[e]),a.lineToPoint(l)}}e&&(s.queryEnd(l),a.lineToPoint(l))}function Rn(t,e,s,n,i,r,o,h,u,c,m,d,g){const p={stack:[],error:void 0,hasError:!1};try{const _=(0,l.b)(p,new Go,!1),f=(0,l.b)(p,new Go,!1),y=(0,l.b)(p,new Go,!1);Ho.geodeticDistance(t,e,n.x,n.y,i.x,i.y,y,_,f,s);const x=y.val,v=_.val,b=f.val;let P=v,S=b;P<0&&(P+=2*Math.PI),S<0&&(S+=2*Math.PI),u&&(u[0]=P),c&&(c[0]=S);let E=Number.NaN,C=Number.NaN;if(null!==m){const s=Xo.q90(t,e),i=Xo.q(t,e,n.y);E=(s-i)/x,C=(s+i)/x}const w=An(n,i),I=Mn(n,i),T=w||I,A=function(t,e,s){return!(!jn(t,e,s)||Lo(t.y,a.o)||Lo(t.y,-a.o)||Lo(e.y,a.o)||Lo(e.y,-a.o))}(n,i,h),M=(0,l.b)(p,new a.S(new Go,new Go),!1),D=new a.P,N=new a.P,F=new a.P;g[0]=Yn(n.x,Number.NaN,g[0]);let R=g[0];if(x<=r)return d.push(n.clone()),g[0]=Yn(i.x,Number.NaN,g[0]),null!=m&&m.push(0),T?(w&&Un(n,i,m,d),I&&Hn(n,i,m,d)):A?Xn(n,i,v,E,C,m,d):o>0&&(N.setCoords(n.x-R,n.y),D.setCoords(i.x-g[0],i.y),R=Ln()),d.push(i.clone()),x;const k=1+Math.ceil(x/r),L=x/(k-1),G=new a.P;d.push(n.clone()),G.setCoordsPoint2D(n),N.setCoords(n.x-g[0],n.y),null!==m&&m.push(0);for(let r=1;r<k;r++){let a;if(r<k-1){const i=r*L;Ho.geodeticCoordinate(t,e,n.x,n.y,i,v,M.at(0),M.at(1),s),D.setCoords(M.at(0).val,M.at(1).val),g[0]=Yn(D.x,G.x,g[0]),F.setCoords(g[0]+D.x,D.y),a=r/(k-1)}else g[0]=Yn(i.x,Number.NaN,g[0]),D.setCoords(i.x-g[0],i.y),F.setCoordsPoint2D(i),a=1;T?(1===r&&w&&Un(n,F,m,d),r===k-1&&I&&Hn(G,i,m,d)):A?jn(G,F,h)&&(n.x<i.x?G.x>F.x&&(g[0]+=2*Math.PI,F.setCoords(g[0]+D.x,D.y)):G.x<F.x&&(g[0]-=2*Math.PI,F.setCoords(g[0]+D.x,D.y)),Xn(G,F,v,E,C,m,d)):o>0&&Ln(),d.push(F.clone()),null!=m&&m.push(a),G.setCoordsPoint2D(F),N.setCoordsPoint2D(D),R=g[0]}return x}catch(_){p.error=_,p.hasError=!0}finally{(0,l.c)(p)}}function kn(t,e,s,n,r,o,a,l,h,u){(0,i.g)(0)}function Ln(t,e,s,n,r,o,a,l,h,u,c,m,d,g,p){return(0,i.g)(0),0}function Gn(t,e,s,n){const i=C(t,e,s),r=C(t,e,n);return o.d.distance(i,r)}function Vn(t,e,s,n,r,l,h,u){const c=new Array,m=(0,a.m)(Array,8);let d=2,g=r.getCoord2D(l);m[0][0]=g.x,m[0][1]=g.y,g=r.getCoord2D(h),m[1][0]=g.x,m[1][1]=g.y;const p=t=>{if(null!==s){const e=Oo.projToGeog(s,t,m);(0,i.g)(e===t)}for(const e of m)e[0]*=n,e[1]*=n};p(2),c.push(C(t,e,new a.P(m[0][0],m[0][1]))),c.push(C(t,e,new a.P(m[1][0],m[1][1])));let _=o.d.distance(c[0],c[1]);if(_>u)return _;let f=0;for(d=3;d<=17;){const s=1/(d-1);let n=0;for(let t=1;t<d;++t)if(1&t){const e=(0,a.q)(l,h,t*s);r.queryCoord2D(e,g),m[n][0]=g.x,m[n][1]=g.y,n++}p(n);let y=1;for(let i=0;i<n;++i)c.splice(y,0,C(t,e,new a.P(m[i][0],m[i][1]))),y++;y=0;let x=c[y];y++;let v=0;for(;y!==c.length;++y){const t=c[y];v+=o.d.distance(x,t),x=t}if(v>u)return v;if(f=v-_,(0,i.g)(f>=0||Math.abs(f)<1e-14*v),f<0&&(f=0),_=v,v+f<=u)return v+f;d=2*d-1}return _+f}function zn(t,e,s,n,r,o,l,h,u){const c=n.isCurve(),m=function(t,e){return t*Math.sqrt(1-e)}(t,e)*Math.PI*179/180;let d=o;o>0&&!(o>m)||(d=m);const g=l,p=g>0;let _=Number.NaN;p&&(_=function(t,e,s){const n=s/(2*O(t,e)),i=n*n;return s*(1-i*(.16666666666666666-.008333333333333333*i))}(t,e,g));const f=1===r.getCoordinateSystemType();let y=null;f||(y=r.getPECoordSys());const x=r.getTolerance(0),v=n.getStartXY(),b=n.getEndXY(),P=new a.P,S=new a.P;if(f)P.setCoordsPoint2D(v),P.scale(s),S.setCoordsPoint2D(b),S.scale(s);else{const t=[v.x,v.y,b.x,b.y];Oo.projToGeog(y,2,t),P.setCoords(t[0],t[1]),P.scale(s),S.setCoords(t[2],t[3]),S.scale(s)}let E=0,w=0;const I=[],T=[],A=[];I.push(b.clone()),T.push(S.clone()),A.push(1),u.push(v.clone()),null!==h&&h.push(w);const D=r.isPannable(),N=v.clone(),F=[.5,.33333333333333337,.6666666666666666,.16666666666666669,.8333333333333333];let k=5;c||(p?(F[0]=.5,F[1]=.25,F[2]=.75,k=3):k=1),(0,i.g)(d>0);const L=t=>{if(t=t.clone(),null!==y){const e=[t.x,t.y];Oo.projToGeog(y,1,e),t.setCoords(e[0],e[1])}return t.scale(s),t};for(;T.length>0;){const o=I.at(-1).clone();S.assign(T.at(-1));const l=A.at(-1);let m=!1,g=Number.NaN;const v=Vn(t,e,y,s,n,w,l,d);let b=d>=v&&Math.abs(P.y-S.y)<.9*Math.PI;f&&b&&(b=Math.abs(P.x-S.x)<.9*Math.PI);const G=new a.P,V=new a.P;let z=!1;if(!p&&b&&b&&(z=!0),n.calculateSubLength(w,l)<=x&&(z=!0),!z)for(let h=0;h<k;h++){const u=(0,a.q)(w,l,F[h]),d=new a.P;n.queryCoord2D(u,d);const y=L(d);if(0===h&&(g=u,G.setCoordsPoint2D(d),V.setCoordsPoint2D(y),!b)){m=!0;break}if((0,i.g)(p),f&&Math.abs(P.x-y.x)>=Math.PI){m=!0;break}let x=new a.P,v=new a.P;c?(x=a.P.lerp(N,o,F[h]),v=L(x)):(x=d.clone(),v=y.clone());const E=M(t,e,P,S,F[h]),I=E.clone();if(f?(I.x/=s,I.y/=s):(I.x/=s,I.y/=s,_n(r.getGCSToSRTransform(),[I],1,[I],null)),I.isNAN()){const s=C(t,e,y),n=C(t,e,P),i=C(t,e,S),{second:r}=R(t,e,s,n,i,2,null);if(r>_){m=!0;break}}else{if(D){const t=r.getPannableExtent().width(),e=(0,a.q)(n.getStartX(),n.getEndX(),.5);for(;I.x<e-.5*t;)I.x+=t;for(;I.x>=e+.5*t;)I.x-=t}const s=n.getClosestCoordinateOnInterval(I,new a.E(w,l),-1);let i=n.getCoord2D(s);i=L(i);let o=Gn(t,e,i,E);if(o>_){if(o<4*_){const s=C(t,e,i),n=C(t,e,P),r=C(t,e,S),{second:a}=R(t,e,s,n,r,2,null);o=a}if(o>_){m=!0;break}}else if(c){let s=C(t,e,y);const n=C(t,e,P),i=C(t,e,S);let{second:r}=R(t,e,s,n,i,3,null);if(r<=_){s=C(t,e,v);const{second:o}=R(t,e,s,n,i,3,null);r=o}if(r>_){m=!0;break}}}}m?(I.push(G.clone()),T.push(V.clone()),A.push(g)):(I.pop(),T.pop(),A.pop(),u.push(o.clone()),E+=v,null!==h&&h.push(E),N.setCoordsPoint2D(o),P.setCoordsPoint2D(S),w=l)}if(null!==h){const t=1/E;for(let e=0;e<h.length;e++)h[e]*=t}}function On(t,e,s,n){if(n.reverse(),null!==s&&s.reverse(),t){const s=t[0],n=e[0];t[0]=n,e[0]=s}}function qn(t,e,s,n,i){t?(n.setCoordsPoint2D(s),i.setCoordsPoint2D(e)):(n.setCoordsPoint2D(e),i.setCoordsPoint2D(s))}function Bn(t,e,s){return t?(s.create(e.getGeometryType()),e.copyTo(s.get()),s.get().reverse(),s.get()):e}function Yn(t,e,s){if(Number.isNaN(e)){for(;s-t>Math.PI;)s-=2*Math.PI;for(;t-s>Math.PI;)s+=2*Math.PI;return s}return s+t-e>Math.PI?s-=2*Math.PI:e-(s+t)>Math.PI&&(s+=2*Math.PI),s}function Un(t,e,s,n){if(t.y>0){const i=new a.P;i.setCoords(e.x,a.o),Lo(t.x,i.x)||Lo(e.y,i.y)||(n.push(i),null!==s&&s.push(0))}else{const i=new a.P;i.setCoords(e.x,-a.o),Lo(t.x,i.x)||Lo(e.y,i.y)||(n.push(i),null!==s&&s.push(0))}}function Hn(t,e,s,n){if(e.y>0){const i=new a.P;i.setCoords(t.x,a.o),Lo(e.x,i.x)||Lo(t.y,i.y)||(n.push(i),null!==s&&s.push(1))}else{const i=new a.P;i.setCoords(t.x,-a.o),Lo(e.x,i.x)||Lo(t.y,i.y)||(n.push(i),null!==s&&s.push(1))}}function Xn(t,e,s,n,i,r,o){if(function(t){return function(t,e){return 0===t||Math.abs(t)<=e}(t,ko)}(s)){if(a.o-t.y>0){const e=new a.P;e.setCoords(t.x,a.o),o.push(e),null!==r&&r.push(n)}if(a.o-e.y>0){const t=new a.P;t.setCoords(e.x,a.o),o.push(t),null!==r&&r.push(n)}}else{if(a.o+t.y>0){const e=new a.P;e.setCoords(t.x,-a.o),o.push(e),null!==r&&r.push(i)}if(a.o+e.y>0){const t=new a.P;t.setCoords(e.x,-a.o),o.push(t),null!==r&&r.push(i)}}}function jn(t,e,s){return Math.abs(Math.abs(t.x-e.x)-Math.PI)<=s}function Zn(t){if(t.x<-Math.PI)for(;t.x<-Math.PI;)t.x+=2*Math.PI;else if(t.x>Math.PI)for(;t.x>Math.PI;)t.x-=2*Math.PI}function Wn(t,e,s,n){const i={stack:[],error:void 0,hasError:!1};try{const r=[s.x],o=[s.y-n],a=[s.x],h=[s.y+n];L(r,o),L(a,h);const u=(0,l.b)(i,new Go,!1),c=(0,l.b)(i,new Go,!1);return Ho.greatEllipticDistance(t,e,s.x,s.y,r[0],o[0],u,null,null),Ho.greatEllipticDistance(t,e,s.x,s.y,a[0],h[0],c,null,null),Math.min(u.val,c.val)}catch(r){i.error=r,i.hasError=!0}finally{(0,l.c)(i)}}function $n(t,e,s,i,r){const a=new n.Envelope2D;s.queryEnvelope(a);const l=(0,o.b)(null,s,!0).total();if(e.xmin-a.xmin<=l&&a.xmax-e.xmax<=l)return s;const c=e.width();let m=0;for(;e.xmin+m*c<a.xmin;)m++;for(;e.xmin+m*c>a.xmin;)m--;const d=m*c,g=new h.T;g.setShiftCoords(-d,0);const p=s;p.applyTransformation(g);const _=new n.Envelope2D;p.queryEnvelope(_);let f=null;if(_.xmax>e.xmax){let s=0;const i=new n.Envelope2D;i.setCoords({env2D:e}),i.ymin-=1,i.ymax+=1;let a=p;for(;i.xmin<_.xmax;){_.xmax>i.xmax&&(a=Gi(a,t,2,!0,i.xmax));const n=(0,o.f)(a,i),l=(0,o.c)(null,n,!0).total(),h=(0,u.c)(a,i,l,Number.NaN,r);null===f?f=h===a?h.clone():h:(g.setShiftCoords(-s*c,0),h.applyTransformation(g),f.add(h,!1)),s++,i.xmin=i.xmax,i.xmax=e.xmax+s*c}}else f=p;return f}class Kn{constructor(t,e){this.m_basisX=new o.d,this.m_basisY=new o.d,this.m_normal=new o.d,(0,i.g)(1===t.getCoordinateSystemType()),this.m_gcs=t;const s=Jr();t.querySpheroidData(s),this.m_a=s.majorSemiAxis,this.m_e2=s.e2,this.m_rpu=t.getUnit().getUnitToBaseFactor(),this.m_curvCenterRad=e.mul(this.m_rpu);const n=this.m_curvCenterRad.x,r=this.m_curvCenterRad.y,l=Math.cos(n),h=Math.sin(n),u=Math.cos(r),c=Math.sin(r);this.m_cartCenter3D=function(t,e,s,n,i,r){return w(t,e,s,n,i,r,0)}(this.m_a,this.m_e2,l,h,u,c),this.m_normal.setCoordsPoint3D(this.m_cartCenter3D),this.m_d=this.m_cartCenter3D.length(),this.m_normal.divThis(this.m_d),o.d.selectRightHandedBasisFromNormal(this.m_normal,this.m_basisX,this.m_basisY),this.m_northPolePcs=this.projectPoint(a.P.construct(0,.5*Math.PI/this.m_rpu)),this.m_southPolePcs=this.projectPoint(a.P.construct(0,.5*-Math.PI/this.m_rpu))}project(t){const e=t.getGeometryType();if((0,i.i)(e)){(0,i.o)(t);const e=t;return this.projectMultiVertex(e)}(0,i.a)("Gnomonic.project")}unproject(t,e,s){const l=t.getGeometryType();if((0,i.i)(l)){(0,i.o)(t);let h=t;const u=[];if(l===i.G.enumPolygon){const t=h.getPathCount();for(let e=0;e<t;e++){const t=h.calculateRingArea2D(e);u.push(t)}}return this.unprojectMultiVertex(e,h),(0,i.h)(l)?(function(t,e,s){const n=t.getPannableExtent(),i=a.P.construct(e,0);n.centerAt(i);const r=n.width(),o=.5*r,l=new a.P;l.setNAN();let h=Number.NaN;for(let a=0;a<s.getPathCount();a++)for(let t=s.getPathStart(a);t<s.getPathEnd(a);t++){const e=s.getXY(t),i=Lo(e.y,n.ymax)||Lo(n.ymin,e.y);t===s.getPathStart(a)?(l.setNAN(),h=0):l.isNAN()||i||(h=ti(e.x,l.x,o,r,h)),e.x+=h,s.setXYNoCurves(t,e),i||l.setCoordsPoint2D(e)}s.getImpl().notifyModifiedFlags(2001)}(this.m_gcs,0,h),function(t,e,s,l,h){const u=l.getGeometryType(),c=e.getPannableExtent();let m=l,d=!1,g=!1;if(u===i.G.enumPolygon){const i=new n.Envelope2D,l=a.P.construct(s,0);i.setCoords({env2D:c}),i.centerAt(l),d=function(t,e,s,i,o){const l=function(t,e){const s=new n.Envelope2D;e.queryEnvelope(s);const i=Lo(t.ymax,s.ymax),o=Lo(t.ymin,s.ymin),l=i||o;return!!l&&(function(t,e){const s=new r.a,i=new n.Envelope2D;for(let n=0;n<e.getPathCount();n++){e.queryPathEnvelope(n,i);let r=Lo(t.ymax,i.ymax),o=Lo(t.ymin,i.ymin);if(!r&&!o){s.addPath(e,n,!0);continue}s.insertPath2D(-1,null,0,0,!0);const l=e.getPathStart(n),h=e.getPathEnd(n),u=h-l;let c=-1;for(c=l;c<h;c++){const s=e.getXY(c);if(r=Lo(t.ymax,s.y),o=Lo(t.ymin,s.y),!r&&!o)break}let m=c,d=!1,g=Number.NaN;do{const i=e.getXY(m);r=Lo(t.ymax,i.y),o=Lo(t.ymin,i.y);const h=l+(m+1-l)%u;if(r||o){let r=a.P.construct(g,i.y);s.insertPoint2D(n,-1,r);const o=e.getXY(h),l=Lo(t.ymax,o.y),u=Lo(t.ymin,o.y);l||u||(r=a.P.construct(o.x,i.y),d?s.setXYNoCurves(s.getPointCount()-1,r):s.insertPoint2D(n,-1,r)),d=!0}else s.insertPoint2D(n,-1,i),g=i.x,d=!1;m=h}while(m!==c)}e.setEmpty(),e.add(s,!1)}(t,e),l)}(s,i),h=function(t,e,s,n,i){const o=[],a=[],l=.5*s.width();for(let r=0;r<n.getPathCount();r++){const h=n.getXY(n.getPathStart(r)),u=n.getXY(n.getPathEnd(r)-1),c=t[r]<0;if(Math.abs(h.x-u.x)>l){const t=Qn(c,e,s,r,n,i);o.push(t),a.push(r)}else if(!c&&n.calculateRingArea2D(r)<0){const t=Jn(e,s,r,n,i);o.push(t),a.push(r)}}if(0===o.length)return!1;const h=new r.a({vd:n.getDescription()});let u=0,c=a[u];for(let r=0;r<n.getPathCount();r++)r===c?(h.add(o[u],!1),u++,u<a.length&&(c=a[u])):h.addPath(n,r,!0);return n.setEmpty(),n.add(h,!1),!0}(t,e,s,i,o);return l||h}(t,e,i,m,h);const u=function(t,e,s,i){const r=new n.Envelope2D;s.queryEnvelope(r);const a=(0,o.b)(null,s,!0).total();if(e.xmin-r.xmin<=a&&r.xmax-e.xmax<=a)return s;const l=s.createInstance();let h=s.createInstance();const u=new n.Envelope2D,c=s.getPathCount();for(let n=0;n<c;n++)s.queryPathEnvelope(n,u),e.xmin-u.xmin<=a&&u.xmax-e.xmax<=a?l.addPath(s,n,!0):(h.setEmpty(),h.addPath(s,n,!0),h=$n(t,e,h,0,i),l.add(h,!0));return l}(e,i,m,h);u!==m&&(g=!0),m=u}else m=(new Sn).foldInto360RangeGeodetic(m,e,2);u===i.G.enumPolygon&&(d||g)&&(m=(new un).execute(m,e,!1,h)),m!==l&&(l.setEmpty(),l.add(m,!1))}(u,this.m_gcs,0,h,s)):h=Ni(h,this.m_gcs,0,!0,0,s),h}(0,i.a)("Gnomonic.unproject")}projectPoint(t){const e=t.mul(this.m_rpu),s=C(this.m_a,this.m_e2,e),n=this.m_normal.dotProduct(s);if(n<=0)return a.P.construct(Number.NaN,Number.NaN);const i=this.m_d/n,r=s.mul(i).sub(this.m_cartCenter3D),o=new a.P;return o.x=this.m_basisX.dotProduct(r),o.y=this.m_basisY.dotProduct(r),o}unprojectPoint(t){const e=this.m_cartCenter3D.add(this.m_basisX.mul(t.x).add(this.m_basisY.mul(t.y)));return T(this.m_a,this.m_e2,e).divide(this.m_rpu)}projectMultiVertex(t){const e=t.getImpl();let s=!0;const n=new a.P,i=new a.P;for(let r=0,o=e.getPointCount();r<o;r++)e.queryXY(r,n),n.y*this.m_rpu>.5*Math.PI?i.assign(this.m_northPolePcs):n.y*this.m_rpu<.5*-Math.PI?i.assign(this.m_southPolePcs):i.assign(this.projectPoint(n)),e.setXYNoCurves(r,i),i.isNAN()&&(s=!1);return e.notifyModifiedFlags(2001),s}unprojectMultiVertex(t,e){const s=e.getImpl(),n=t*t,i=!this.m_northPolePcs.isNAN(),r=!this.m_southPolePcs.isNAN();for(let o=0,l=s.getPointCount();o<l;o++){const t=s.getXY(o);let e=new a.P;i&&a.P.sqrDistance(t,this.m_northPolePcs)<=n?(e.setCoords(this.m_curvCenterRad.x,.5*Math.PI),e.scale(1/this.m_rpu)):r&&a.P.sqrDistance(t,this.m_southPolePcs)<=n?(e.setCoords(this.m_curvCenterRad.x,.5*-Math.PI),e.scale(1/this.m_rpu)):e=this.unprojectPoint(t),s.setXYNoCurves(o,e)}s.notifyModifiedFlags(2001)}}function Qn(t,e,s,i,l,c){const m=new r.a,d=new r.a,g=new h.T,p=l.getXY(l.getPathStart(i)),_=l.getXY(l.getPathEnd(i)-1),f=s.width(),y=.5*f,x=new n.Envelope2D;l.queryEnvelope(x);const v=Math.ceil(x.width()/f)+1;let b,P;p.x>_.x?(b=-f,P=t?s.ymin:s.ymax):(b=f,P=t?s.ymax:s.ymin),g.setShiftCoords(b,0),m.addPath(l,i,!0),d.add(m,!1);const S=new o.P;for(let n=0;n<v;n++)d.applyTransformation(g),d.getPointByVal(0,S),m.lineToPoint(S),m.addSegmentsFromPath(d,0,0,d.getSegmentCount()-1,!1);const E=m.getXY(0),C=m.getXY(m.getPointCount()-1);E.y=P,C.y=P,m.lineTo(C);const w=new a.P;for(w.setCoordsPoint2D(C),w.x-=.5*b;Math.abs(w.x-E.x)>y;)m.lineTo(w),w.x-=.5*b;m.lineTo(E);const I=s.getCenter().x,T=new n.Envelope2D;m.queryEnvelope(T);let A=0;const M=T.getCenter().x;M-I>y?A=-Math.ceil((M-I-y)/f):I-M>y&&(A=Math.ceil((I-M-y)/f)),0!==A&&(g.setShiftCoords(A*f,0),m.applyTransformation(g));const D=new r.E,N=D.addGeometry(m);Vi(D,N,e,0,2,!0,s.xmin),Vi(D,N,e,0,2,!0,s.xmax);const F=D.getGeometry(N),R=(0,o.f)(F,s);R.inflateCoords(0,1);const k=(0,o.c)(null,R,!0);return(0,u.c)(F,s,k.total(),Number.NaN,c)}function Jn(t,e,s,i,l){const c=e.width(),m=.5*c,d=e.getCenter().x,g=new n.Envelope2D;i.queryPathEnvelope(s,g);let p,_=0,f=g.getCenter().x;if(f-d>m?_=-Math.ceil((f-d-m)/c):d-f>m&&(_=Math.ceil((d-f-m)/c)),0!==_){const t=new h.T;t.setShiftCoords(_*c,0),i.getImpl().applyTransformationToPath(t,s),i.queryPathEnvelope(s,g),f=g.getCenter().x}const y=new n.Envelope2D;e.containsExclusiveEnvelope(g)?(p=!1,y.setCoords({env2D:e})):(p=!0,y.setCoords({env2D:e}),y.xmin-=c,y.xmax+=c);let x=i.createInstance();x.addPathPoint2D(null,0,!0);const v=new a.P;if(v.setCoords(y.xmin,y.ymin),x.insertPoint2D(0,-1,v),v.setCoords(y.xmin,y.ymax),x.insertPoint2D(0,-1,v),v.setCoords(.5*(y.xmin+y.xmax),y.ymax),x.insertPoint2D(0,-1,v),v.setCoords(y.xmax,y.ymax),x.insertPoint2D(0,-1,v),v.setCoords(y.xmax,y.ymin),x.insertPoint2D(0,-1,v),v.setCoords(.5*(y.xmin+y.xmax),y.ymin),x.insertPoint2D(0,-1,v),p){x.addPath(i,s,!0);const n=new h.T;f<d?n.setShiftCoords(c,0):n.setShiftCoords(-c,0),i.getImpl().applyTransformationToPath(n,s),x.addPath(i,s,!0);const a=new r.E,m=a.addGeometry(x);Vi(a,m,t,0,2,!0,e.xmin),Vi(a,m,t,0,2,!0,e.xmax),x=a.getGeometry(m);const g=(0,o.f)(x,e);g.inflateCoords(0,1);const p=(0,o.c)(null,g,!0).total();x=(0,u.c)(x,e,p,Number.NaN,l)}else x.addPath(i,s,!0);return x}function ti(t,e,s,n,i){return i+t-e>s?i-=n:e-(i+t)>s&&(i+=n),i}function ei(t,e,s,n,i,l){const h=e.getAttributeStreamRef(0),u=e.getPointCount();let c=!1;const m=new a.P;for(let r=0;r<u;++r){if(h.queryPoint2D(2*r,m),1&l&&m.y>=s){c=!0;break}if(2&l&&m.y<=-s){c=!0;break}}if(!c)return!1;let d=!1;t&&(d=e.getImpl().isClosedPathInXYPlane(0));const g=new r.E,p=g.addGeometry(e),_=g.getFirstPath(p);let f=-1,y=!0;const x=new a.P,v=new o.P;let b=r.n;const P=si*i/360;for(let o=g.getFirstVertex(_);o!==r.n;o=g.getNextVertex(o)){g.queryXY(o,m);let t=1&l&&m.y>=s?1:0;if(t|=2&l&&m.y<=-s?2:0,f>0&&f!==t){if(x.x!==m.x){const t=g.getPrevVertex(o);g.queryPoint(t,v);const e=g.insertVertex(_,o,v);x.x=m.x,g.setXY(e,x)}if(d){let t=b!==r.n?g.getNextVertex(b):g.getFirstVertex(_);const e=g.getPrevVertex(o);for(;t!==e;)t=g.removeVertex(t,!1);if(b!==r.n){const t=g.getXY(b),s=g.getXY(e);if(Math.abs(t.x-s.x)>P){g.queryPoint(b,v);const n=g.insertVertex(_,e,v);t.x=(0,a.q)(t.x,s.x,.5),g.setXY(n,t)}}}b=r.n}if(t&&(m.y=(0,a.f)(n,m.y),g.setXY(o,m),!y&&f!==t))if(m.x!==x.x){g.queryPoint(o,v);const t=g.insertVertex(_,o,v);g.setXYCoords(t,x.x,m.y),b=t}else b=o;f=t,x.assign(m),y=!1}if(d){if(b!==r.n){let t=g.getNextVertex(b);for(;t!==r.n;)t=g.removeVertex(t,!1)}const t=g.getFirstVertex(_);let e=g.getLastVertex(_);const s=g.getXY(t),n=g.getXY(e);if(!s.equals(n)&&(g.queryPoint(t,v),e=g.insertVertex(_,r.n,v),Math.abs(s.x-n.x)>P)){const t=g.insertVertex(_,e,v);s.x=(0,a.q)(s.x,n.x,.5),g.setXY(t,s)}}return e.assignCopy(g.getGeometry(p)),!0}const si=210;class ni{constructor(t,e,s,n,r,o,a,l,h){this.m_bAdjustedAtPoles=0,this.m_inputPoly=s,this.m_progressTracker=h,this.m_originalGeometry=t,this.m_originalSR=n,this.m_polygonRingFlags=e,this.m_pannableSR=r,this.m_poleSnappingTolerance=l,this.m_poleFlags=a,this.m_bAdjustedAtPoles=0,this.m_pannableExtent=function(t,e){const s=t.getPannableExtent();return Number.isNaN(e)||s.centerAtCoords(e,0),s}(this.m_pannableSR,o),this.m_centralLongitude=Number.isNaN(o)?this.m_pannableExtent.getCenterX():o,this.m_width360=this.m_pannableExtent.width(),this.m_degree=this.m_width360/360,this.m_GCSLargeDelta=si*this.m_degree,(0,i.g)(null===this.m_originalGeometry&&null===this.m_originalSR||null!==this.m_originalGeometry&&null!==this.m_originalSR)}geonormalizeRing(t,e,s,n,l,h,u){let c=s;const m=new r.P({vd:this.m_inputPoly.getDescription()});m.addPath(this.m_inputPoly,t,!0),0!==this.m_poleFlags&&(this.m_bAdjustedAtPoles|=ei(!0,m,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,this.m_pannableExtent.width(),this.m_poleFlags)?1:0,this.m_bAdjustedAtPoles&&(c=!1));let d=-1;c&&(d=this.m_originalGeometry.getPathStart(t));const g=m.getAttributeStreamRef(0),p=m.getPointCount();let _=0,f=g.read(0),y=0;const x=3*this.m_pannableSR.getTolerance(0);let v=!1;const b=new a.P,P=new a.P;let S=!1;const E=m.hasNonLinearSegments(),C=new a.P;for(let r=1;r<p;++r){g.queryPoint2D(2*r,C);const t=C.x;let e=t+_;const s=e-f;if(C.x=e,Math.abs(s)>this.m_GCSLargeDelta){if(c){const t=d+r-1,e=d+(r+1<p?r:0),i=h.read(2*t),o=(h.read(2*e)-i)*n;Math.abs(s-o)>1*this.m_degree&&(c=!1)}c||(_-=(0,a.f)(this.m_width360,e-f),e=t+_,++y,S=0!==_,C.x=e)}else v||(0,o.a4)(b,P,C,x)&&(v=!0);S&&(E&&(0,i.d)("error in geonormalize_ring_ for curves"),g.write(2*r,e)),f=e,b.setCoordsPoint2D(P),P.setCoordsPoint2D(C)}y&&m.notifyModified();const w=m.getXY(0),I=m.getXY(p-1);if(a.P.distance(w,I)<x){const t=this.finalizeGeoNormalizeClosedRing(m,v,l);u.add(t,!1)}else{e<0&&(null!==this.m_originalGeometry?((0,i.g)(null!==this.m_originalGeometry),e=this.m_originalGeometry.calculateRingArea2D(t)>0?1:0):e=1);const s=this.finalizeGeoNormalizeOpenedRing(e>0,m);u.add(s,!1)}}geoNormalizePolygonGeometry(t){(0,i.g)(this.m_originalSR&&this.m_originalGeometry||!this.m_originalGeometry&&!this.m_originalSR),(0,i.g)(this.m_pannableSR.isPannable());let e=null,s=Number.NaN;const o=!!this.m_originalSR&&this.m_originalSR.isPannable();o&&(e=this.m_originalGeometry.getAttributeStreamRef(0),s=this.m_width360/this.m_originalSR.getPannableExtent().width()),this.m_bAdjustedAtPoles=0;const a=new r.a({vd:this.m_inputPoly.getDescription()});for(let n=0,i=this.m_inputPoly.getPathCount();n<i;++n){const i=this.m_polygonRingFlags?this.m_polygonRingFlags[n]?1:0:-1;this.geonormalizeRing(n,i,o,s,t,e,a)}const l=this.m_pannableSR.getTolerance(0),h=this.m_pannableExtent.width()/180;Yi(a,this.m_pannableExtent,.1*l,!1);const m=n.Envelope2D.constructEmpty();if(m.setCoords({env2D:this.m_pannableExtent}),t){let t=!0;for(let e=0;e<2;e++){t=!0;const e=n.Envelope2D.constructEmpty();for(let s=0,n=a.getPathCount();s<n;s++)if(a.queryPathEnvelope(s,e),!(m.xmin<=e.xmin&&m.xmax>=e.xmax||e.xmin>=m.xmax||e.xmax<=m.xmin)){t=!1;break}if(t)break;m.move(.5*this.m_width360,0)}t||m.setCoords({env2D:this.m_pannableExtent})}let d=(0,u.c)(a,m,l,h,this.m_progressTracker),g=a!==d;const p=this.m_originalGeometry?this.m_originalGeometry.calculateArea2D():1,_=d.calculateArea2D();let f=0;if(_>0&&p<0)f=1;else if(_<=0&&p>0)if(0===_){if(this.m_originalSR){let t=Number.NaN;2===this.m_originalSR.getCoordinateSystemType()?t=this.m_originalSR.getPCSHorizon().calculateArea2D():1===this.m_originalSR.getCoordinateSystemType()&&(t=this.m_originalSR.getPannableExtent().getArea()),p>.99*t&&(f=-1)}}else f=-1;if(0!==f){const t=function(t,e){let s=new r.a({vd:t});s.addEnvelope(e,!1);const n=e.width()/180;return s=(new c.O).execute(s,n,0,0,null),s}(d.getDescription(),m);t.add(d,!1),g=!0,d=t}return g&&(d=(new un).execute(d,this.m_pannableSR,!1,this.m_progressTracker)),d}geoNormalizePolylineGeometry(t){(0,i.g)(this.m_pannableSR.isPannable());let e=null;const s=this.m_originalSR&&this.m_originalSR.isPannable();let o=1;s&&((0,i.g)(this.m_originalGeometry),o=this.m_width360/this.m_originalSR.getPannableExtent().width(),e=this.m_originalGeometry.getAttributeStreamRef(0));const l=this.m_pannableExtent.width(),c=l*(0,a.O)()*4;let m=t,d=Number.NaN;const g=a.E.constructEmpty();this.m_bAdjustedAtPoles=0;let p=new r.P({vd:this.m_inputPoly.getDescription()});for(let u=0,y=this.m_inputPoly.getPathCount();u<y;++u){let t=s;const _=new r.P({vd:this.m_inputPoly.getDescription()});_.addPath(this.m_inputPoly,u,!0);const f=this.m_inputPoly.isClosedPath(u);0!==this.m_poleFlags&&(this.m_bAdjustedAtPoles|=ei(f,_,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,l,this.m_poleFlags)?1:0,this.m_bAdjustedAtPoles&&(t=!1));let y=-1;const x=_.getPointCount();let v=!1;t&&(y=this.m_originalGeometry.getPathStart(u),v=this.m_originalGeometry.isClosedPath(u));const b=_.getAttributeStreamRef(0);let P=0,S=b.read(0),E=0;const C=new a.P,w=new a.P;let I=!1;const T=_.hasNonLinearSegments(),A=new a.P;for(let s=1;s<x;++s){b.queryPoint2D(2*s,A);const n=A.x;let r=n+P;const l=r-S;if(A.x=r,Math.abs(l)>this.m_GCSLargeDelta){if(t){const n=y+s-1;let i=y;(!v||s+1<x)&&(i+=s);const r=e.read(2*n),a=(e.read(2*i)-r)*o;Math.abs(l-a)>1*this.m_degree&&(t=!1)}t||(P-=(0,a.f)(this.m_width360,r-S),r=n+P,++E,I=0!==P,A.x=r)}I&&(T&&(0,i.d)("error in geonormalize_ring_ for curves"),b.write(2*s,r)),S=r,C.setCoordsPoint2D(w),w.setCoordsPoint2D(A)}if(E&&_.notifyModified(),m){let t=!1;if(!_.isEmpty()){const e=n.Envelope2D.constructEmpty();if(_.queryEnvelope(e),e.width()>=l||e.ymin<=this.m_pannableExtent.ymin||e.ymax>=this.m_pannableExtent.ymax)t=!0;else{if(Number.isNaN(d)){const t=this.m_centralLongitude-.5*l;d=e.xmin,d+=Math.round((t-e.xmin)/l)*l,d>t&&(d-=l),(0,i.g)(d<=t),d<t&&(d+=l),(0,i.g)(d>=t)}let s=Math.round((d-e.xmin)/l)*l;if(e.xmin+s>d+c&&(s-=l),e.xmin+s<d-c&&(s+=l),g.mergeCoordinate(e.xmin+s),g.mergeCoordinate(e.xmax+s),t=g.width()>=l,!t){const t=new h.T;t.setShiftCoords(s,0),_.applyTransformation(t)}}}p.add(_,!1),t&&(p=(()=>{const t=new r.P({vd:p.getDescription()});for(let e=0,s=p.getPathCount();e<s;++e){const s=new r.P({vd:p.getDescription()});s.addPath(p,e,!0);const n=Ni(s,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);t.add(n,!1)}return t})(),m=!1)}else{const t=Ni(_,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);p.add(t,!1)}}if(m)return p;const _=this.m_pannableSR.getTolerance(0),f=this.m_pannableExtent.width()/180;return Yi(p,this.m_pannableExtent,.1*_,!1),(0,u.c)(p,this.m_pannableExtent,_,f,this.m_progressTracker)}finalizeGeoNormalizeOpenedRing(t,e){const s=e.getPointCount(),o=e.getXY(0),l=e.getXY(s-1);{const t=Math.abs(l.x-o.x),e=Math.round(t/this.m_width360)*this.m_width360;(0,i.g)(Math.abs(t-e)<this.m_pannableSR.getTolerance(0))}const u=(0,a.e)(l.x-o.x),c=n.Envelope2D.constructEmpty();e.queryLooseEnvelope(c);const m=this.m_pannableExtent.getCenterX();let d=0,g=m-this.m_width360,p=m+this.m_width360;if(u>=0){let t=Math.ceil((g-c.xmin)/this.m_width360);for(t*=this.m_width360;g>c.xmin+t;)t+=this.m_width360;for(;g<c.xmax+t;)t-=this.m_width360;for(d=t,c.width()>720&&(p=g+360*Math.ceil(c.width()/360));p<c.xmax;)p+=this.m_width360}else{let t=Math.ceil((p-c.xmax)/this.m_width360);for(t*=this.m_width360;p<c.xmax+t;)t-=this.m_width360;for(;p>c.xmin+t;)t+=this.m_width360;for(d=t,c.width()>720&&(g=p-360*Math.ceil(c.width()/360));g>c.xmin;)g-=this.m_width360}const _=Math.round(Math.abs(l.x-o.x)/this.m_width360)*this.m_width360,f=u*_,y=c.clone();y.move(d,0);const x=new a.P(0,0),v=new h.T;v.setShiftCoords(d,0),e.applyTransformation(v);const b=new r.P({vd:e.getDescription()});b.add(e,!1),x.assign(e.getXY(s-1));let P=0,S=b.getXY(0).x;for(;u>0?y.xmax<p:y.xmin>g;)y.move(f,0),v.xd=f,e.applyTransformation(v),S+=f,this.m_pannableExtent.xmin<=S&&this.m_pannableExtent.xmax>=S&&(P=b.getPointCount()-1),e.setXY(0,x),x.assign(e.getXY(s-1)),b.addSegmentsFromPath(e,0,0,s-1,!1);const E=new r.a({vd:b.getDescription()});E.add(b,!1);const C=b.getXY(0),w=b.getXY(b.getPointCount()-1),I=u<0?t:!t,T=E.getPointCount()-1;if(I){const t=new a.P(w.x,this.m_pannableExtent.ymax);E.lineTo(t);const e=new a.P(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymax);E.lineTo(e);const s=new a.P(C.x,this.m_pannableExtent.ymax);E.lineTo(s)}else{const t=new a.P(w.x,this.m_pannableExtent.ymin);E.lineTo(t);const e=new a.P(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymin);E.lineTo(e);const s=new a.P(C.x,this.m_pannableExtent.ymin);E.lineTo(s)}if(E.interpolateAttributesPath(0,T,0),E.getImpl().changeRingStartPoint(P),_>this.m_width360){const t=new r.a({copy:E});v.setShiftCoords(this.m_width360,0),t.applyTransformation(v),E.add(t,!1)}return E}finalizeGeoNormalizeClosedRing(t,e,s){const o=new r.a({vd:t.getDescription()});o.add(t,!1);if(o.hasNonLinearSegments()&&(()=>{const t=o.getPointCount()-2;return o.getSegmentType(t)!==i.G.enumLine})()){const t=new r.S,e=o.getPointCount()-2;o.getSegmentBuffer(e,t,!1),o.removePointFromPath(0,e+1),o.closeLastPathWithSegment(t.get())}else o.removePointFromPath(0,o.getPointCount()-1);const l=n.Envelope2D.constructEmpty();o.queryLooseEnvelope(l);let u=Math.ceil((this.m_pannableExtent.xmin-l.xmin)/this.m_width360);for(u*=this.m_width360;this.m_pannableExtent.xmin>l.xmin+u;)u+=this.m_width360;for(;this.m_pannableExtent.xmin<l.xmax+u;)u-=this.m_width360;if(u+=this.m_width360,0!==u){l.move(u,0);const t=new h.T;t.setShiftCoords(u,0),o.applyTransformation(t)}if(this.m_pannableExtent.xmin<=l.xmin&&this.m_pannableExtent.xmax>=l.xmax){if(e){const t=o.calculateArea2D(),e=(new un).execute(o,this.m_pannableSR,!0,this.m_progressTracker);if(e!==o){const s=e.calculateArea2D();(0,a.e)(t)!==(0,a.e)(s)&&e.reverseAllPaths(),o.assignMove(e)}}let t;if(t=new r.a(s?{copy:o}:{move:o}),s)for(;l.xmin<this.m_pannableExtent.xmax;){l.move(this.m_width360,0);const e=new h.T;e.setShiftCoords(this.m_width360,0),o.applyTransformation(e),t.add(o,!1)}return t}let c=new r.a({vd:t.getDescription()});c.add(o,!1);const m=e||l.width()>this.m_width360-10*this.m_pannableSR.getTolerance(0);for(;l.xmin<this.m_pannableExtent.xmax;){l.move(this.m_width360,0);const t=new h.T;t.setShiftCoords(this.m_width360,0),o.applyTransformation(t),c.add(o,!1)}if(m){const t=c.calculateArea2D();c.setFillRule(1),c=(new un).execute(c,this.m_pannableSR,!0,this.m_progressTracker);const e=c.calculateArea2D();(0,a.e)(t)!==(0,a.e)(e)&&c.reverseAllPaths()}return c}geonormalize_ring_(t,e,s,n,r,o,a){(0,i.g)(0)}}function ii(t){(0,i.g)(0);const e=function(t){const e=new vr({},!0);return e.m_WKID=t,e}(t),s=new oi;return s.setVertProj_(e),s}function ri(t){return!1}class oi{constructor(){this.m_hashCode=0,this.m_peVertSysVal=null,this.m_verticalUnit=new Hr,this.m_verticalShift=0,this.m_userVerticalWKID=0,this.m_bIsDepth=!1}getType(){return(0,i.g)(0),0}getID(){return(0,i.g)(0),0}getLatestID(){return this.m_peVertSysVal?this.m_peVertSysVal.getLatestID():0}getOldID(){return this.m_peVertSysVal?this.m_peVertSysVal.getOldID():0}getText(){return(0,i.g)(0),""}getTextExtended(t){return(0,i.g)(0),""}getText2(t){return(0,i.g)(0),""}getUnit(){return(0,i.g)(0),{}}equals(t){return(0,i.g)(0),!1}equalForProjection(t){return(0,i.g)(0),!1}getPeVertcsCopy(){return(0,i.g)(0),{}}getOneMeter(){return 1/this.m_verticalUnit.getUnitToBaseFactor()}getUnitToBaseFactor(){return(0,i.g)(0),0}isDepth(){return(0,i.g)(0),!1}getVerticalShift(){return(0,i.g)(0),0}isCustomWkid(){return!!this.m_peVertSysVal&&this.m_peVertSysVal.isCustomWkid()}getHashCode(){return this.m_hashCode}setVertProj_(t){this.m_peVertSysVal=t}getPEVerticalCoordSys(){return this.m_peVertSysVal?this.m_peVertSysVal.m_peVertcs:null}}function ai(t,e,s,n,i){if(t.equals(e))return!1;if(n){let s=1,r=0,o=1,a=1,l=0,h=1;Number.isNaN(t.m_heightMetersPerUnit)||(s=t.m_heightMetersPerUnit,r=t.m_heightZ0,o=t.m_heightSign,a=e.m_heightMetersPerUnit,l=e.m_heightZ0,h=e.m_heightSign);const u=o*h*s/a;for(let t=0;t<i;t++)n[t]=(n[t]-r)*u+l}let o=1,a=0;if(Number.isNaN(t.m_XYToRadians)||(o=t.m_XYToRadians/e.m_XYToRadians,a=t.m_PrimeMeridianDegrees-e.m_PrimeMeridianDegrees,0!==a&&(a=(0,r.b)(a),a/=e.m_XYToRadians)),Array.isArray(s)){const t=s;for(let e=0;e<i;e++)t[e][0]=t[e][0]*o+a,t[e][1]=t[e][1]*o}else{const t=s;for(let e=0;e<i;e++){const s=e<<1;t[s]=t[s]*o+a,t[s+1]=t[s+1]*o}}return!0}function li(){return{m_heightMetersPerUnit:0,m_heightSign:0,m_heightZ0:0,m_XYToRadians:0,m_PrimeMeridianDegrees:0,assign(t){this.m_heightMetersPerUnit=t.m_heightMetersPerUnit,this.m_heightSign=t.m_heightSign,this.m_heightZ0=t.m_heightZ0,this.m_XYToRadians=t.m_XYToRadians,this.m_PrimeMeridianDegrees=t.m_PrimeMeridianDegrees},equals(t){return(0,a.Q)(this.m_heightSign,t.m_heightSign)&&(0,a.Q)(this.m_heightMetersPerUnit,t.m_heightMetersPerUnit)&&(0,a.Q)(this.m_heightZ0,t.m_heightZ0)&&(0,a.Q)(this.m_XYToRadians,t.m_XYToRadians)&&(0,a.Q)(this.m_PrimeMeridianDegrees,t.m_PrimeMeridianDegrees)},initFromGcsAndVcsPe(t,e){this.m_heightSign=1,this.m_heightMetersPerUnit=Number.NaN,this.m_heightZ0=0,this.m_XYToRadians=Number.NaN,this.m_PrimeMeridianDegrees=Number.NaN,e&&(0,i.g)(0),t&&(this.m_XYToRadians=t.getUnit().getUnitFactor(),this.m_PrimeMeridianDegrees=t.getPrimem().getLongitude())},initFromGcsAndVcs(t,e){const s=t?t.getPECoordSys():null,n=e?e.getPEVerticalCoordSys():null;this.initFromGcsAndVcsPe(s,n)},processUnitParams(t){Number.isNaN(this.m_heightMetersPerUnit)&&(this.m_heightMetersPerUnit=t.m_heightMetersPerUnit,this.m_heightSign=t.m_heightSign,this.m_heightZ0=t.m_heightZ0),Number.isNaN(this.m_XYToRadians)&&(this.m_XYToRadians=t.m_XYToRadians,this.m_PrimeMeridianDegrees=t.m_PrimeMeridianDegrees)}}}class hi{constructor(t){this.m_constantsLoaded=-1,this.m_isUsable=-1,this.m_inputSR=null,this.m_outputSR=null,this.m_inputSRHorz=null,this.m_outputSRHorz=null,this.m_inputVCS=null,this.m_outputVCS=null,this.m_hashCode=0,this.m_areaOfUse=new o.E,this.m_inputUnitParams=li(),this.m_outputUnitParams=li(),(0,i.g)(t),this.m_geogTran=t,this.m_vertTran=null,this.m_latestID=Vo.getCode(this.m_geogTran),this.m_latestID<0&&(this.m_latestID=0);const e=this.m_geogTran.getGeogcs1();Vo.getCode(e);const s=this.m_geogTran.getGeogcs2();Vo.getCode(s),this.initUnitParams()}getLatestId(){return this.m_latestID}getText(){return this.m_geogTran?this.m_geogTran.toString():((0,i.g)(0),"")}getGeogtran(){return this.m_geogTran}getVerttran(){return null}loadConstants(t){let e=this.m_constantsLoaded;if(-1===e){if(!t){this.m_geogTran||(0,i.d)("vcs not impl");const e=this.m_geogTran.getParameters();null!==e[zo.PE_PARM_ND]&&(t=0===e[zo.PE_PARM_ND].getValue())}e=this.m_geogTran.loadConstants()?1:0,this.m_constantsLoaded=e}return 0!==e}isUsable(){let t=this.m_isUsable;return-1===t&&(this.m_geogTran?this.m_isUsable=t=this.m_geogTran?1:0:this.m_isUsable=t=this.m_vertTran?1:0),1===t}getInputSr(t){return this.updateSrs(),t?this.m_inputSR:this.m_inputSRHorz}getOutputSr(t){return this.updateSrs(),t?this.m_outputSR:this.m_outputSRHorz}getHashCode(){let t=this.m_hashCode;return 0===t&&(t=this.m_latestID>0?(0,a.au)(this.m_latestID):(0,a.ay)(this.getText()),0===t&&(t=345),this.m_hashCode=t),t}isGeogtran(){return null!==this.m_geogTran}prepareOrThrow(){}getName(){return this.isGeogtran()?this.getGeogtran().getName():((0,i.t)("vcs not impl"),"")}updateSrs(){if(this.m_inputSR||this.m_inputVCS)return;let t,e,s,n,r,o;if(this.m_geogTran){const i=this.m_geogTran.getGeogcs1(),a=Rr(i),l=this.m_geogTran.getGeogcs2(),h=Rr(l);let u=-1,c=-1;u=a.getVcsCode(),c=h.getVcsCode(),s=oo(i,null,null,1),n=oo(l,null,null,1),u>0&&c>0?(r=ii(u),o=ii(c),t={},e={}):(t=s,e=n)}else(0,i.g)(0);this.m_inputSR||this.m_inputVCS||(this.m_inputSR=t,this.m_outputSR=e,this.m_inputSRHorz=s,this.m_outputSRHorz=n,this.m_inputVCS=r,this.m_outputVCS=o)}initUnitParams(){if(this.m_inputUnitParams.m_heightSign=1,this.m_inputUnitParams.m_heightMetersPerUnit=Number.NaN,this.m_inputUnitParams.m_heightZ0=0,this.m_outputUnitParams.m_heightSign=1,this.m_outputUnitParams.m_heightMetersPerUnit=Number.NaN,this.m_outputUnitParams.m_heightZ0=0,this.m_inputUnitParams.m_XYToRadians=Number.NaN,this.m_inputUnitParams.m_PrimeMeridianDegrees=Number.NaN,this.m_outputUnitParams.m_XYToRadians=Number.NaN,this.m_outputUnitParams.m_PrimeMeridianDegrees=Number.NaN,this.m_vertTran)(0,i.g)(0);else if(this.m_geogTran){const t=this.m_geogTran;let e=t.getGeogcs1();this.m_inputUnitParams.m_XYToRadians=e.getUnit().getUnitFactor(),this.m_inputUnitParams.m_PrimeMeridianDegrees=e.getPrimem().getLongitude(),e=t.getGeogcs2(),this.m_outputUnitParams.m_XYToRadians=e.getUnit().getUnitFactor(),this.m_outputUnitParams.m_PrimeMeridianDegrees=e.getPrimem().getLongitude()}}}function ui(t,e,s,n,i,r,o){let a=null;e&&(a=e.getPEVerticalCoordSys());let l=null;t&&(l=t.getPECoordSys());let h=null;n&&(h=n.getPEVerticalCoordSys());let u=null;if(s&&(u=s.getPECoordSys()),!(l||a||u||h))return!1;const c=li();c.initFromGcsAndVcsPe(l,a);const m=li();return m.initFromGcsAndVcsPe(u,h),ai(c,m,i,r,o)}function ci(t,e,s,n,i,r,o,a){const l=e,h=t,u=li();u.initFromGcsAndVcsPe(h,l),a.assign(n?s.m_outputUnitParams:s.m_inputUnitParams),a.processUnitParams(u),u.processUnitParams(a),o>0&&ai(u,a,i,r,o)}function mi(t,e,s,n,i,r,o,a,l){const h=li(),u=li();h.assign(s?e.m_inputUnitParams:e.m_outputUnitParams),u.assign(i?n.m_outputUnitParams:n.m_inputUnitParams),h.processUnitParams(t),u.processUnitParams(h),h.processUnitParams(u),a>0&&ai(h,u,r,o,a),l.assign(u)}function di(t,e,s,n,i,r,o){const a=e.getVerttran(),l=e.getGeogtran();if(o.assign(s?e.m_inputUnitParams:e.m_outputUnitParams),o.processUnitParams(t),r>0){e.prepareOrThrow();const t=s?zo.PE_TRANSFORM_2_TO_1:zo.PE_TRANSFORM_1_TO_2;a?hr():ur(l,r,n,i,t)}}class gi{supportsCurves(){return!0}accelerateGeometry(t,e,s){return pi(t,e,s)}canAccelerateGeometry(t){return _i(t)}}function pi(t,e,s){if(!_i(t))return!1;(0,o.L)(e,t,!1);let n=0;const a=t.getGeometryType();return(0,i.h)(a)&&(0,r.I)(t)&&0!==s&&(n|=t.getImpl().buildQuadTreeAccelerator(s)?1:0),(0,i.h)(a)&&(0,r.J)(t)&&0!==s&&(n|=t.getImpl().buildQuadTreeForPathsAccelerator(s)?1:0),n>0}function _i(t){return(0,r.I)(t)||(0,r.J)(t)}class fi extends gi{getOperatorType(){return 8}execute(t,e,s,n){return ie(t,e,s,1,n)}}function yi(t,e,s,l){if(t.isEmpty()||e.isEmpty())return t;const h=t.getDimension(),c=e.getDimension();if(h>c)return t;const m=t.getGeometryType(),d=e.getGeometryType(),g=new n.Envelope2D,p=new n.Envelope2D,_=new n.Envelope2D;t.queryEnvelope(g),e.queryEnvelope(p),_.setCoords({env2D:g}),_.mergeEnvelope2D(p);const f=(0,o.c)(s,_,!0),y=(0,o.e)(f),x=new n.Envelope2D;if(x.setCoords({env2D:g}),x.inflateCoords(y,y),!x.isIntersecting(p))return t;if(1===h&&2===c){const a=function(t,e,s,a,l){const h=new o.E;t.queryEnvelope(h);const u=new n.Envelope2D;e.queryEnvelope(u),h.merge(u);const c=.1*h.width(),m=.1*h.height();h.inflateCoords(c,m);const d=new r.a;d.addEnvelope(h,!1);const g=d.getImpl();if(s===i.G.enumPolygon){const t=e.getImpl();g.add(t,!0)}else g.addEnvelope(e,!0);return new mn(d,a,-1,l).tryFastImplementation(t)}(t,e,d,s,l);if(a)return a}if(m===i.G.enumPoint){let s;switch((0,i.f)(d)?(s=new r.P({vd:e.getDescription()}),s.addSegment(e,!0)):s=e,d){case i.G.enumPolygon:return function(t,e,s){return 0===is(e,t,s.total())?t:t.createInstance()}(t,s,f);case i.G.enumPolyline:return function(t,e,s){const i=t.getXY(),r=e.querySegmentIterator(),l=(0,o.e)(s),h=l*l;for(;r.nextPath();)for(;r.hasNextSegment();){const e=r.nextSegment(),o=new n.Envelope2D;if(e.queryEnvelope(o),o.inflateCoords(l,l),!o.contains(i))continue;if(e.isIntersectingPoint(i,s.total()))return t.createInstance();let u=e.getStartXY();if(a.P.sqrDistance(i,u)<=h)return t.createInstance();if(u=e.getEndXY(),a.P.sqrDistance(i,u)<=h)return t.createInstance()}return t}(t,s,f);case i.G.enumMultiPoint:return function(t,e,s){const n=e.getImpl().getAttributeStreamRef(0),i=e.getPointCount(),r=t.getXY(),l=(0,o.e)(s),h=l*l,u=new a.P;for(let o=0;o<i;o++)if(n.queryPoint2D(2*o,u),a.P.sqrDistance(u,r)<=h)return t.createInstance();return t}(t,s,f);case i.G.enumEnvelope:return function(t,e,s){const i=new n.Envelope2D;e.queryEnvelope(i),i.inflate(s.total());const r=t.getXY();return i.contains(r)?t.createInstance():t}(t,s,f);case i.G.enumPoint:return function(t,e,s){const n=(0,o.e)(s),i=n*n,r=t.getXY(),l=e.getXY();return a.P.sqrDistance(r,l)<=i?t.createInstance():t}(t,s,f);default:(0,i.a)("invalid shape type")}}else if(m===i.G.enumMultiPoint)switch(d){case i.G.enumPolygon:return function(t,e,s){const i=new n.Envelope2D;e.queryEnvelope(i),i.inflate(s.total());const r=t.getPointCount();let o=!1;const l=(0,a.d)(r,!1),h=new a.P;for(let n=0;n<r;n++)t.queryXY(n,h),i.contains(h)&&0!==rs(e,h,s.total())&&(o=!0,l[n]=!0);if(!o)return t;const u=t.createInstance();for(let n=0;n<r;n++)l[n]||u.addPoints(t,n,n+1);return u}(t,e,f);case i.G.enumEnvelope:return function(t,e,s){const i=new n.Envelope2D;e.queryEnvelope(i),i.inflate(s.total());const r=t.getPointCount();let o=!1;const l=(0,a.d)(r,!1),h=new a.P;for(let n=0;n<r;n++)t.queryXY(n,h),i.contains(h)&&(o=!0,l[n]=!0);if(!o)return t;const u=t.createInstance();for(let n=0;n<r;n++)l[n]||u.addPoints(t,n,n+1);return u}(t,e,f);case i.G.enumPoint:return function(t,e,s){const n=t.getImpl().getAttributeStreamRef(0),i=t.getPointCount(),r=e.getXY();let l=!1;const h=(0,a.d)(i,!1),u=(0,o.e)(s),c=u*u,m=new a.P;for(let o=0;o<i;o++)n.queryPoint2D(2*o,m),a.P.sqrDistance(m,r)<=c&&(l=!0,h[o]=!0);if(!l)return t;const d=t.createInstance();for(let o=0;o<i;o++)h[o]||d.addPoints(t,o,o+1);return d}(t,e,f)}const v=new n.Envelope2D(g);return v.inflate(100*f.total()),function(t,e,s,a){if(t.isEmpty()||e.isEmpty()||t.getDimension()>e.getDimension())return Us(Hs(t),t,0,"-");const l=new n.Envelope2D;t.queryEnvelope(l);const h=new n.Envelope2D;e.queryEnvelope(h);const u=new n.Envelope2D;u.setCoords({env2D:l}),u.mergeEnvelope2D(h);const c=(0,o.c)(s,u,!0),m=h.clone(),d=(0,o.e)(c);if(m.inflateCoords(d,d),!l.isIntersecting(m))return Us(Hs(t),t,0,"-");const g=new Ys(a),p=new r.E,_=p.addGeometry(Hs(t)),f=p.addGeometry(Hs(e));let y=0,x=0,v=null;if(p.hasCurves()){v=new xs;const t=p.getEnvelope2D(a);x=fs(c.total());const e=_s(c.total(),t);y=ys(e,x),ms(p,e,c.total(),0,v,null,a)}g.setEditShapeCrackAndCluster(p,c.add(y));const b=g.difference(_,f);null!==v&&v.stitchCurves(p,b,x,!0);const P=Us(p.getGeometry(b),t,0,"-");return Ms(P.getGeometryType())&&(P.getImpl().setIsSimple(4,c.total()),P.getGeometryType()===i.G.enumPolygon&&P.getImpl().updateOGCFlagsProtected()),P}(t,(0,u.c)(e,v,0,0,l),s,l)}class xi{getOperatorType(){return 10002}supportsCurves(){return!0}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s,n){return new vi(t,e,s,n)}execute(t,e,s,n){return this.executeMany(new m.S([t]),new m.S([e]),s,n).next()}}class vi extends m.G{constructor(t,e,s,n){super(),this.m_progressTracker=n,this.m_index=-1,this.m_inputGeoms=t,this.m_spatialReference=s;const i=e.next();this.m_geomSubtractor=i||new r.a}next(){const t=this.m_inputGeoms.next();return t?((0,i.c)(t),(0,i.y)(t),this.m_index=this.m_inputGeoms.getGeometryID(),yi(t,this.m_geomSubtractor,this.m_spatialReference,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}class bi{getOperatorType(){return 10001}supportsCurves(){return!0}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s,n=0){return new Si(t,e,s,n)}execute(t,e,s,n){const r=new m.S([t,e]),o=new Si(r,s,n,0).next();return o||(0,i.d)("null output"),o}}class Pi{constructor(){this.binVertexCount=0,this.geometries=[]}addPair(t){this.binVertexCount+=t.vertexCount,this.geometries.push(t)}sort(){this.geometries.sort(((t,e)=>function(t,e){return a.P.compareZorder(t.location,e.location)?-1:t.location.equals(e.location)?0:1}(t,e)))}geomCount(){return this.geometries.length}geomPairs(){return this.geometries}clear(){this.binVertexCount=0,this.geometries.length=0}getBinVertexCount(){return this.binVertexCount}}class Si extends m.G{constructor(t,e,s,n,i=!1){super(),this.m_index=-1,this.m_currentDim=-1,this.m_bDone=!1,this.m_unionBins=[],this.m_readyGeoms=(0,a.av)(4),this.m_dimGeomCounts=(0,a.d)(4,0),this.m_addedGeoms=0,this.m_maxDimension=-1,this.m_bHadGeometry=(0,a.d)(4,!1),this.m_complexUnionGeoms=(0,a.av)(4),this.m_totalNonEmptyGeomCounters=(0,a.d)(4,0),this.m_progressTracker=s,this.m_bUnionAllDimensions=!!(4&n),this.m_bPreserveAllPathEnds=!!(8&n),this.m_inputGeoms=t,this.m_spatialReference=e,this.m_options=n,this.m_bIs3D=i}next(){if(this.m_bDone&&this.m_currentDim===this.m_maxDimension)return null;for(;!this.step_(););if(-1===this.m_maxDimension)return null;if(this.m_bUnionAllDimensions){if(-1===this.m_currentDim)for(let t=0;t<=this.m_maxDimension;t++)if(this.m_bHadGeometry[t]){this.m_complexUnionGeoms[t]=this.getResultGeometry(t);for(let e=t+1;e<=this.m_maxDimension;e++)this.m_complexUnionGeoms[e]=this.getResultGeometry(e),this.m_bHadGeometry[e]&&!this.m_complexUnionGeoms[e].isEmpty()&&(this.m_bIs3D?(0,i.g)(0):this.m_complexUnionGeoms[t]=(new xi).execute(this.m_complexUnionGeoms[t],this.m_complexUnionGeoms[e],this.m_spatialReference,this.m_progressTracker))}for(;this.m_currentDim++,(this.m_currentDim>this.m_maxDimension||this.m_currentDim<0)&&(0,i.d)(""),!this.m_bHadGeometry[this.m_currentDim];);if(this.m_index++,0===this.m_currentDim&&this.m_complexUnionGeoms[this.m_currentDim].getGeometryType()===i.G.enumPoint){const t=new r.M({vd:this.m_complexUnionGeoms[this.m_currentDim].getDescription()});return this.m_complexUnionGeoms[this.m_currentDim].isEmpty()||t.add(this.m_complexUnionGeoms[this.m_currentDim]),t}return this.m_complexUnionGeoms[this.m_currentDim]}return this.m_index=0,this.m_currentDim=this.m_maxDimension,this.getResultGeometry(this.m_maxDimension)}getGeometryID(){return this.m_index}getRank(){return 1}tock(){return this.step_()}getResultGeometry(t){return this.m_readyGeoms[t]}finishDim(t,e,s){let n=e;if(!s)return 16&this.m_options?(n=qs([n],1,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D),n):n;if(1&this.m_options)return n;if(1===t)if(8&this.m_options||!(16&this.m_options||this.m_totalNonEmptyGeomCounters[t]>1))1===this.m_totalNonEmptyGeomCounters[t]&&(this.m_bIs3D?(0,i.g)(0):n=(new un).execute(n,this.m_spatialReference,!1,this.m_progressTracker));else{n=qs([n],1,this.m_spatialReference,this.m_progressTracker,16|this.m_options,this.m_bIs3D);const t=[0],e=n.getImpl().getIsSimple(0,t);(0,i.g)(this.m_bIs3D||(0,o.i)(e))}else this.m_bIs3D?(0,i.g)(0):n=(new un).execute(n,this.m_spatialReference,!1,this.m_progressTracker);if(0===t&&n.getGeometryType()===i.G.enumPoint){const t=new r.M({vd:n.getDescription()});n.isEmpty()||t.add(n),n=t}return n}static getLevel(t){const e=(0,i.v)(t);let s=e>0?(Math.log(e)-Math.log(32))/Math.log(4):0;return s<0&&(s=0),Math.floor(s)}step_(){if(this.m_bDone)return!0;let t;if(this.m_inputGeoms?(t=this.m_inputGeoms.next(),null===t?(this.m_bDone=!0,this.m_inputGeoms=null):(this.checkAndThrow(t),t.isEmpty()||this.m_totalNonEmptyGeomCounters[t.getDimension()]++)):t=null,null!==t){const e=t.getDimension();this.m_bHadGeometry[e]=!0,(e>=this.m_maxDimension||this.m_bUnionAllDimensions)&&(this.addGeom(e,!1,t),e>this.m_maxDimension&&!this.m_bUnionAllDimensions&&this.removeAllBinsWithLowerDimension(e))}if(this.m_addedGeoms>0)for(let e=0;e<=this.m_maxDimension;e++){for(;this.m_dimGeomCounts[e]>1;){const t=this.collectGeometriesToUnion(e);if(null===t)break;{let s;s=1&this.m_options?qs(t,t.length,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D):Bs(t,t.length,this.m_spatialReference,this.m_progressTracker,8|this.m_options,this.m_bIs3D),this.addGeom(e,!0,s)}}if(this.m_bDone&&((0,i.g)(this.m_dimGeomCounts[e]<=1),0!==this.m_dimGeomCounts[e])){const t=this.m_unionBins[e].entries().next().value,s=t[1].geomPairs()[0].geom,n=t[1].geomPairs()[0].bUnioned;this.m_unionBins[e].clear(),this.m_readyGeoms[e]=this.finishDim(e,s,n)}}return this.m_bDone}addGeom(t,e,s){const r={geom:null,vertexCount:-1,bUnioned:!1,location:new a.P};r.geom=s;const o=(0,i.v)(s);r.vertexCount=o;const l=n.Envelope2D.constructEmpty();s.queryEnvelope(l),r.location=o>0?l.getCenter():new a.P(0,0);const h=Si.getLevel(s);if(t+1>this.m_unionBins.length)for(;this.m_unionBins.length<Math.max(2,t+1);)this.m_unionBins.push(new Map);let u=null;const c=this.m_unionBins[t].get(h);c&&(u=c),null===u&&(u=new Pi,this.m_unionBins[t].set(h,u)),r.bUnioned=e,u.addPair(r),this.m_dimGeomCounts[t]++,this.m_addedGeoms++,this.m_maxDimension=Math.max(this.m_maxDimension,t)}removeAllBinsWithLowerDimension(t){for(let e=0;e<t;e++)this.m_unionBins[e].clear(),this.m_addedGeoms-=this.m_dimGeomCounts[e],this.m_dimGeomCounts[e]=0}collectGeometriesToUnion(t){if(1&this.m_options&&!this.m_bDone)return null;let e=null;const s=[];for(const n of this.m_unionBins[t].keys())s.push(n);(0,a.v)(s);for(let n=0;n<s.length;n++){if(-1===s[n])continue;const i=this.m_unionBins[t].get(s[n]);{const r=5e3,o=4,a=i.getBinVertexCount()>r&&i.geomCount()>=o;if(this.m_bDone||a){for(let i=0;i<n;i++){if(-1===s[i])continue;const n=this.m_unionBins[t].get(s[i]);n.sort(),this.m_dimGeomCounts[t]-=n.geomCount(),this.m_addedGeoms-=n.geomCount();for(const t of n.geomPairs())e||(e=new Array),e.push(t.geom);n.clear(),this.m_unionBins[t].delete(s[i]),s[i]=-1}i.sort(),this.m_dimGeomCounts[t]-=i.geomCount(),this.m_addedGeoms-=i.geomCount();for(const t of i.geomPairs())e||(e=new Array),e.push(t.geom);if(i.clear(),this.m_unionBins[t].delete(s[n]),s[n]=-1,!this.m_bDone)break}}}return e}checkAndThrow(t){this.m_bIs3D&&(t.getDimension()>1&&(0,i.A)(),t.hasAttribute(1)||(0,i.a)("Geometry must have Zs")),(0,i.c)(t)}}class Ei extends gi{getOperatorType(){return 3}execute(t,e,s,n=null){return ie(t,e,s,4,n)}}function Ci(t,e,s){const l=e.getGCSSplitLines();if(null===l)return t;const u=e.getGCS(),c=u.getPannableExtent().width(),m=n.Envelope2D.constructEmpty();t.queryLooseEnvelope(m);const d=a.E.constructEmpty();m.queryIntervalX(d);const g=l.querySegmentIterator();let p=null;const _=new h.T;for(;g.nextPath();)for(;g.hasNextSegment();){const t=g.nextSegment(),e=t.queryInterval(0,0),s=a.E.constructEmpty();s.setCoordsFromEnvelope(e);let n=0;for(;s.vmax>d.vmin;)s.move(-c),n--;for(;s.vmin<=d.vmax;){if(s.isIntersecting(d)){null===p&&(p=new r.P);const e=new r.L({start:t.getStartXY(),end:t.getEndXY()});0!==n&&(_.setShiftCoords(n*c,0),e.applyTransformation(_)),p.addSegment(e,!0)}s.move(c),++n}}if(null!==p){const e=(0,o.b)(u,p,!0);return function(t,e,s,n){const r=e.getGeometryType();if((0,i.h)(r))return new Mt(n).crackAWithBMultiPath_(t,e,s);(0,i.t)("crack_A_with_B")}(t,p,(0,o.e)(e),s)}return t}function wi(t,e,s){let n=t.getName();return xo(n)||(s||e>0?(n=t.toString(zo.PE_STR_NAME_CANON|zo.PE_STR_AUTH_NONE),n=function(t){return t.toLocaleUpperCase("en-US")}(n)):n=t.toString(zo.PE_STR_AUTH_TOP)),n}function Ii(t,e=-1){if((e>1||e<-1)&&(0,i.a)("verbosity"),-1===e)return t.toString();{const s=0===e?zo.PE_STR_AUTH_TOP:zo.PE_STR_AUTH_ALL;return t.toString(s)}}function Ti(t,e,s,r){if(t.isEmpty()||1===s)return t;const a=t.getGeometryType();if(a===i.G.enumPoint){const n=t,i=n.getXY();return 0===Di([i],1,e,s)||i.isNAN()?n.setEmpty():n.setXY(i),t}if(a===i.G.enumMultiPoint){const n=t,i=t.createInstance(),r=n.getPointCount();i.reserve(r);const a=n.getAttributeStreamRef(0),l=n.getDescription().getAttributeCount()>1,h=new o.P,u=Float64Array.from(a.getArray());if(Di(u,r,e,s)>0)for(let t=0,e=2*r;t<e;t+=2)Number.isNaN(u[t])||(l?(n.getPointByVal(t>>1,h),h.setXYCoords(u[t],u[t+1]),i.add(h)):i.addXY(u[t],u[t+1]));return i}let l=t;const c=e.getOneDegreeGCSUnit(),m=90*c,d=180*c,g=360*c,p=e.getCentralMeridian(),_=.5*c,f=n.Envelope2D.constructEmpty();l.queryEnvelope(f);const y=e.getGCSHorizon(),x=e.getGCSHorisonIsInclusive(),v=y.getGeometryType()===i.G.enumEnvelope,b=n.Envelope2D.constructEmpty();y.queryEnvelope(b);const P=e.getGCS();if(2!==s&&4!==s||(b.xmin=p-d,b.xmax=b.xmin+g),4===s){if(!(f.width()>g-c)){const t=n.Envelope2D.constructEmpty();t.setCoords({xmin:f.xmin-c,ymin:b.ymin,xmax:f.xmax+c,ymax:b.ymax}),l=(new u.O).execute(l,t,P,r);let e=Math.floor((p-f.getCenterX())/g);for(f.move(e*g,0);f.xmin>b.xmax;)e-=1,f.move(-g,0);for(;f.xmin<b.xmin;)e+=1,f.move(g,0);if(0!==e){const t=new h.T;t.setShiftCoords(e*g,0),l.applyTransformation(t)}return l}s=2}if(2===s&&(b.xmin=p-d,b.xmax=b.xmin+g),f.ymin<-m||f.ymax>m){const t=n.Envelope2D.constructEmpty();if(t.setCoords({xmin:f.xmin-c,ymin:-m,xmax:f.xmax+c,ymax:m}),l=(new u.O).execute(l,t,P,r),l.isEmpty())return l;l.queryEnvelope(f)}if(x&&(b.ymax<f.ymin||b.ymin>f.ymax))return l.createInstance();f.width()>g&&(l=qi(l,p-d,g,P,!0,0,!0,r),l.queryEnvelope(f));let S=function(t,e,s,n,i){return t>=s&&e<=n?0:Oi(.5*(e+t),s,n,i)}(f.xmin,f.xmax,b.xmin,b.xmax,g);if(0!==S&&f.move(S,0),f.xmax>b.xmax||f.xmin<b.xmin){if(f.xmax>b.xmax)for(;f.xmin>=b.xmax;)f.move(-g,0),S-=g;for(;f.xmin<b.xmax-g;)f.move(g,0),S+=g}const E=(0,o.L)(P,y,!1);if(0!==S){const t=new h.T;t.setShiftCoords(S,0),l.applyTransformation(t),S=0}if(x){if(v&&b.containsEnvelope(f))return l;const t=new Array(2);for(let e=0;e<2;e++){let s;if(v?s=(0,i.h)(a)?(0,u.c)(l,b,E,_,r):(0,u.c)(l,b,E,0,r):(s=(new gn).execute(l,y,P,r),s===y&&(s=s.clone())),b.xmin<=f.xmin&&b.xmax>=f.xmax)return s;if(b.xmin>=f.xmin&&b.xmax<=f.xmax)return s;if(t[e]=s,0===e){f.move(-g,0);const t=new h.T;t.setShiftCoords(-g,0),l.applyTransformation(t)}}return(0,i.h)(a)?t[0].add(t[1],!1):(0,i.d)("intersect_with_GCS_horizon: unexpected geometry type"),t[0]}{if(b.ymax<f.ymin||b.ymin>f.ymax)return l;let t=0;for(;!l.isEmpty()&&f.xmax>b.xmin;){if(0!==t){const e=new h.T;e.setShiftCoords(t,0),l.applyTransformation(e)}if((new Ei).execute(l,y,P,r)||(l=(new xi).execute(l,y,P,r),y===l&&(l=l.clone())),0!==t){const e=new h.T;e.setShiftCoords(-t,0),l.applyTransformation(e)}t-=g,f.move(-g,0)}return l}}function Ai(t,e,s,n,i,h){const u={stack:[],error:void 0,hasError:!1};try{if(2===h)return function(t,e,s,n,i){if(Math.abs(s.x-n.x)>Math.PI)return Number.NaN;if(Math.abs(s.y)>a.o||Math.abs(n.y)>a.o)return Number.NaN;if((Math.abs(s.y)===a.o||Math.abs(n.y)===a.o)&&s.x!==n.x)return Number.NaN;const{first:l,second:h}=(0,a.aE)(s.x,n.x);let u=i;if(u=E(u,l,h),!a.E.construct(s.x,n.x).containsCoordinate(u))return Number.NaN;const c=r.a0.constructPoint2D(s),m=r.a0.constructPoint2D(n),d=I(1,e,c),g=I(1,e,m),p=d.crossProductVector(g);if(p.z.isZero())return s.y;const _=p.x.divE(p.z.negate()),f=p.y.divE(p.z.negate()),y=_.mulE(_).addE(f.mulE(f)).sqrt();if(y.isZero()||_.isZero()&&f.isZero())return s.y;const x=Math.atan2(f.value(),_.value());let v=Math.atan2(y.value()*Math.cos(x-u),1-e);const b=C(1,e,a.P.construct(u,v)),P=o.d.construct(b.x,b.y,-b.z),S=p.value().dotProduct(b),w=p.value().dotProduct(P);return Math.abs(w)<Math.abs(S)&&(v=-v),v}(0,e,s,n,i);if(Math.abs(s.x-n.x)>=Math.PI||!pr(s.x,n.x,i))return Number.NaN;s.x>n.x&&(n=(0,a.c)(s,s=n));const c=(0,l.b)(u,new Go,!1),m=(0,l.b)(u,new Go,!1),d=(0,l.b)(u,new Go,!1),g=s.clone();Ho.geodeticDistance(t,e,s.x,s.y,n.x,n.y,m,c,null,h);const p=m.val;let _=0,f=1;for(;p*(f-_)>1e-12*t;){const r=.5*(_+f);if(Ho.geodeticCoordinate(t,e,s.x,s.y,p*r,c.val,m,d,h),g.x=m.val,g.y=d.val,g.x===i)return g.y;if(pr(s.x,g.x,i))f=r;else{if(!pr(n.x,g.x,i))return Number.NaN;_=r}}return g.y}catch(c){u.error=c,u.hasError=!0}finally{(0,l.c)(u)}}function Mi(t,e,s,n){for(let i=0,r=0;i<n;i++,r+=2)e[s+i].x=t[r],e[s+i].y=t[r+1]}function Di(t,e,s,r){if(0===e||1===r)return e;const l=function(t,e){let s;if(Array.isArray(t)){const n=t;s=new Float64Array(2*e);for(let t=0,i=0;t<e;t++,i+=2)s[i]=n[t].x,s[i+1]=n[t].y}else s=t;return s}(t,e);if(2===r){const n=s.getPannableExtentInGCS();let i=e;for(let t=0,s=2*e;t<s;t+=2)(l[t+1]>n.ymax||l[t+1]<n.ymin)&&(l[t]=Number.NaN,i--);return i?(Bi(l,e,n.xmin,n.width(),!0),t!==l&&Mi(l,t,0,e),i):0}const h=s.getOneDegreeGCSUnit(),u=90*h,c=180*h,m=360*h;let d=e;for(let n=0,i=2*e;n<i;n+=2)(l[n+1]>u||l[n+1]<-u)&&(l[n]=Number.NaN,d--);if(!d)return 0;const g=n.Envelope2D.constructEmpty();g.setFromPoints(l,e);const p=s.getGCSHorizon(),_=s.getGCSHorisonIsInclusive(),f=p.getGeometryType()===i.G.enumEnvelope,y=n.Envelope2D.constructEmpty();if(p.queryEnvelope(y),_&&(y.ymax<g.ymin||y.ymin>g.ymax))return 0;if(_)if(Bi(l,e,y.getCenterX()-c,m,!0),d=e,f)for(let n=0,i=2*e;n<i;n+=2)y.containsCoords(l[n],l[n+1])||(l[n]=Number.NaN,d--);else{const t=(0,o.L)(s.getGCS(),p,!1),n=new a.P;for(let s=0,i=2*e;s<i;s+=2)n.setCoords(l[s],l[s+1]),0!==rs(p,n,t)||(l[s]=Number.NaN,d--)}else{Bi(l,e,-c,m,!0),d=e;const t=(0,o.L)(s.getGCS(),p,!1),n=new a.P;for(let s=0,i=2*e;s<i;s+=2){n.setCoords(l[s],l[s+1]),n.isNAN()&&d--;const e=Oi(n.x,y.xmin,y.xmax,m);n.x+=e,0!==rs(p,n,t)&&(l[s]=Number.NaN,d--)}}return d>0&&Array.isArray(t)&&Mi(l,t,0,e),d}function Ni(t,e,s,n,r,o){if(e.isPannable()||(0,i.a)("fold_into_360_degree_range"),t.isEmpty())return t;let a,l;if(2===e.getCoordinateSystemType()){const t=e.getPannableExtent();l=t.xmin,a=t.width()}else{const t=e.getOneDegreeGCSUnit();a=360*t,l=s-180*t}return qi(t,l,a,e,n,r,!0,o)}function Fi(t,e,s,n){let i,r;if(2===s.getCoordinateSystemType()){const t=s.getPannableExtent();i=t.xmin,r=t.width()}else{const t=s.getOneDegreeGCSUnit();r=360*t,i=n-180*t}Bi(t,e,i,r)}function Ri(t,e){const s=e.width();let n=(0,a.l)(t-e.vmin,s);return n<0&&(n+=s),e.snapClip(n+e.vmin)}function ki(t,e,s){return t>e.xmax&&t-e.xmax<s?e.xmax:t<e.xmin&&e.xmin-t<s?e.xmin:t}function Li(t,e,s){if(t[0]<e.vmin||t[0]>e.vmax||s&&t[0]===e.vmax){const s=e.width();return t[0]+=Math.ceil((e.vmin-t[0])/s)*s,t[0]=e.snapClip(t[0]),!0}return!1}function Gi(t,e,s,n,i){const a=new r.E,l=a.addGeometry(t);return Vi(a,l,e,(0,o.L)(e,t,!1),s,n,i),a.getGeometry(l)}function Vi(t,e,s,n,o,h,u){const c={stack:[],error:void 0,hasError:!1};try{(0,i.g)(eo()),s.isPannable()||(0,i.p)("insert_geodetic_points");const m=s.getPannableExtent(),d=s.getGCS(),g=Jr();d.querySpheroidData(g);const p=d.getUnit().getUnitToBaseFactor(),_=g.majorSemiAxis,f=g.e2;let y=0;const x=new a.E;m.queryIntervalX(x);let v=null;const b=(0,a.d)(4,Number.NaN);2===s.getCoordinateSystemType()?(v=s.getPECoordSys(),h?(b[0]=Ri(u,x),b[1]=m.getCenterY(),Oo.projToGeog(v,1,b),y=b[0]*p):(b[0]=m.getCenterX(),b[1]=u,Oo.projToGeog(v,1,b),y=b[1]*p)):y=u*p,h||0===y||2===o||(0,i.p)("insert_geodetic_points: 1");const P=(0,l.b)(c,new Go,!1),S=new a.P,E=new a.P,C=new a.P,w=new a.P,I=new a.P,T=new a.P;for(let i=t.getFirstPath(e);i!==r.n;i=t.getNextPath(i)){const e=t.getFirstVertex(i);t.queryXY(e,C);let l=!1;const c=t.getNextVertex(e);for(let i=c;i!==r.n;i=t.getNextVertex(i)){if(i===c){if(l)break;l=!0}if(t.queryXY(i,w),h&&(n<u-C.x&&w.x-u>n||n<u-w.x&&C.x-u>n)||!h&&(0!==u||n<-C.y&&w.y>n||n<-w.y&&C.y>n))do{if(Math.abs(C.x-w.x)>=.5*x.width())break;2===s.getCoordinateSystemType()?(b[0]=Ri(C.x,x),b[1]=C.y,b[2]=Ri(w.x,x),b[3]=w.y,er(v,2,b,0),I.x=b[0]*p,I.y=b[1]*p,T.y=b[3]*p):(I.x=C.x*p,I.y=C.y*p,T.y=w.y*p),T.x=(w.x-C.x)*Math.PI*2/x.width()+I.x;let e=0;const n=(0,a.m)(a.P,2);if(h){if(E.x=y,E.y=Ai(_,f,I,T,y,o),Number.isNaN(E.y))break;n[0]=E,e=1}else if(2===o){const t=[0,0];if(e=k(0,f,I,T,y,t),!e)break;n[0].x=t[0],n[0].y=y,2===e&&(n[1].x=t[1],n[1].y=y)}else{if(E.x=_r(_,f,I,T,o),Number.isNaN(E.x))break;E.y=0,n[0]=E,e=1}let r=-1;for(let l=0;l<e;l++){Ho.geodeticDistance(_,f,I.x,I.y,T.x,T.y,P,null,null,o);const e=P.val;Ho.geodeticDistance(_,f,I.x,I.y,n[l].x,n[l].y,P,null,null,o);const c=P.val;2===s.getCoordinateSystemType()?(b[0]=n[l].x/p,b[1]=n[l].y/p,Oo.geogToProj(v,1,b),h?(S.y=b[1],S.x=u):(S.x=fr(b[0],C.x,w.x,x),S.y=u)):h?(S.x=u,S.y=n[l].y/p):(S.x=fr(n[l].x/p,C.x,w.x,x),S.y=u);const m=e>0?(0,a.s)(c/e,0,1):.5;if(0===m||1===m)continue;if(r>m)continue;const d=t.getPrevVertex(i);t.splitSegment(d,[m],1);const g=t.getNextVertex(d);t.setXYCoords(g,S.x,S.y),r=m}}while(0);C.setCoordsPoint2D(w)}}}catch(m){c.error=m,c.hasError=!0}finally{(0,l.c)(c)}}function zi(t,e){(0,i.g)(e.isPannable());const s=e.getPannableExtent();if(t.getGeometryType()===i.G.enumPoint){const e=t.getY();return s.ymin<=e&&e<=s.ymax?t:t.createInstance()}const r=n.Envelope2D.constructEmpty();t.queryEnvelope(r);const a=n.Envelope2D.constructEmpty();a.setCoords({env2D:s}),a.xmin=r.xmin,a.xmax=r.xmax,a.inflateCoords(.01*a.height(),0);const l=(0,o.a)(e,r,!1);let h;return h=a.containsEnvelope(r)?t:(0,u.c)(t,a,l,0,null),h}function Oi(t,e,s,n){return(0,a.ax)((.5*(s+e)-t)/n)*n}function qi(t,e,s,o,l,c,m,d){const g=t.getGeometryType(),p=a.E.constructEmpty();p.setCoords(e,e+s);const _=[0];if(g===i.G.enumPoint){const e=t;if(_[0]=e.getX(),Li(_,p,m)){const e=l?t:t.clone();return e.setX(_[0]),e}return t}const f=n.Envelope2D.constructEmpty();if(t.queryEnvelope(f),f.isEmpty())return t;if(g===i.G.enumMultiPoint){const e=l?t:t.clone(),s=e.getImpl(),n=s.getAttributeStreamRef(0),i=2*s.getPointCount();let r=!1;for(let t=0;t<i;t+=2)_[0]=n.read(t),Li(_,p,m)&&(n.write(t,_[0]),r=!0);return r&&s.notifyModifiedFlags(2001),e}const y=a.E.constructEmpty();if(f.queryIntervalX(y),p.contains(y))return p.vmax,y.vmax,t;const x=n.Envelope2D.constructEmpty();if(x.setCoords({env2D:f}),0===y.width()){let e=y.vmin;e+=Math.ceil((p.vmin-e)/s)*s,e=p.snapClip(e);const n=l?t:t.clone();return n.setAttributeBasic(0,0,e),n}if(g===i.G.enumEnvelope){const e=l?t:t.clone();return f.intersect(x),e.setEnvelope(f),e}const v=.1*Math.max(f.height(),f.width())*1;x.inflateCoords(0,v);let b=t;const P=o.getTolerance(0),S=new h.T;for(;;){const t=Math.floor((y.vmin-e)/s),n=Math.ceil((y.vmax-e)/s);if(!(n-t>3))break;{const r=Math.floor(.5*(n+t));x.xmin=f.xmin-v,x.xmax=e+s*r;const a=(0,u.c)(b,x,P,c,d);x.xmin=x.xmax,x.xmax=f.xmax+v;const l=(0,u.c)(b,x,P,c,d);S.setShiftCoords((r-n)*s,0),l.applyTransformation(S),g===i.G.enumPolygon?b=(new bi).execute(a,l,o,d):(b=a,b.add(l,!1)),b.queryEnvelope(f),f.queryIntervalX(y)}}x.xmin=e,x.xmax=e+s;const E=n.Envelope2D.constructEmpty();E.setCoords({env2D:x}),E.inflateCoords(P,0);const C=Math.floor((f.xmin-x.xmin)/s)*s;let w;C?(x.move(C,0),S.setShiftCoords(-C,0)):S.setIdentity(),w=g===i.G.enumPolyline?new r.P({vd:b.getDescription()}):new r.a({vd:b.getDescription()});const I=n.Envelope2D.constructEmpty(),T=n.Envelope2D.constructEmpty();for(;f.xmax>x.xmin;){const t=(0,u.c)(b,x,P,0,d);t.queryEnvelope(T);let e=!1;e=g===i.G.enumPolyline?!t.isEmpty()&&(T.width()>P||T.height()>P):!t.isEmpty()&&(g!==i.G.enumPolygon||T.width()>P),e&&(t.applyTransformation(S),t.queryEnvelope(T),w.queryEnvelope(I),I.inflateCoords(P,P),I.isIntersecting(T)&&g===i.G.enumPolygon?w=(new bi).execute(w,t,o,d):w.add(t,!1)),x.move(s,0),S.shiftCoords(-s,0)}return w}function Bi(t,e,s,n,i=!0){const r=new a.E;r.setCoords(s,s+n);const o=[0];if(Array.isArray(t)){const s=t;for(let t=0;t<e;t++)r.containsRightExclusive(s[t].x)||(o[0]=s[t].x,Li(o,r,i),s[t].x=o[0])}else{const s=t;for(let t=0;t<e;t++){const e=t<<1;r.containsRightExclusive(s[e])||(o[0]=s[e],Li(o,r,i),s[e]=o[0])}}}function Yi(t,e,s,r=!0){if(t.isEmpty())return;const o=t.getGeometryType();if(!r||o!==i.G.enumPolygon)if((0,i.i)(o)){let n=!1;if((0,i.h)(o)&&t.hasNonLinearSegments()){const r=t.getImpl(),o=r.getAttributeStreamRef(0),a=r.getSegmentFlagsStreamRef();(0,i.g)(null!==a);for(let t=0,i=r.getPathCount();t<i;t++){let i=!0;const l=r.isClosedPath(t),h=r.getPathEnd(t);l&&r.getPathSize(t)>0&&(i=1==(31&a.read(h-1)));for(let u=r.getPathStart(t);u<h;u++)if(1==(31&a.read(u))){if(i){const t=o.read(2*u),i=ki(t,e,s);i!==t&&(n=!0,o.write(2*u,i))}i=!0}else i=!1}}else{const i=t.getImpl(),r=i.getAttributeStreamRef(0);for(let t=0,o=i.getPointCount();t<o;t++){const i=r.read(2*t),o=ki(i,e,s);o!==i&&(n=!0,r.write(2*t,o))}}n&&t.getImpl().notifyModifiedFlags(2001)}else if(o===i.G.enumEnvelope){const i=t,r=n.Envelope2D.constructEmpty();i.queryEnvelope(r),r.xmin=ki(r.xmin,e,s),r.xmax=ki(r.xmax,e,s),i.setEnvelope(r)}else if(o===i.G.enumPoint){const n=t;n.setX(ki(n.getX(),e,s))}else(0,i.d)("")}function Ui(t,e,s){const n=new a.P;return n.x=ki(t.x,e,s),n.y=t.y,n}function Hi(t,e,s,r){const l=t.getGeometryType();(0,i.g)(l===i.G.enumPolygon||l===i.G.enumPolyline||l===i.G.enumMultiPoint);const h=e.getCoordinateSystemType();if(2===h){let h=t;if(0===s){const s=function(t,e){if(e.isEmpty())return 0;const s=t.getPECoordSys();if(s.getProjection().getCode()===zo.PE_PRJ_AZIMUTHAL_EQUIDISTANT){const i=Jr();t.querySpheroidData(i);const r=s.getParameters();if(null===r[zo.PE_PARM_LAM0])return 0;if(null===r[zo.PE_PARM_PHI0])return 0;const o=[r[zo.PE_PARM_LAM0].getValue(),r[zo.PE_PARM_PHI0].getValue()];Oo.geogToProj(s,1,o);const l=new a.P(o[0],o[1]),h=n.Envelope2D.constructEmpty();e.queryEnvelope(h);const u=(0,a.m)(a.P,4);h.queryCorners(u);let c=0;const m=t.getOneMeter();let d=Math.max(i.majorSemiAxis,i.minorSemiAxis)*Math.PI,g=Math.min(i.majorSemiAxis,i.minorSemiAxis)*Math.PI;g-=d/180,d*=m,g*=m;for(let t=0;t<4;t++){const e=a.P.distance(u[t],l);if(e>d)c++;else if(e>g)return-1}if(0===c)return 1;if(4===c){const t=n.Envelope2D.constructEmpty();return t.setCoords({center:l,width:d,height:d}),h.isIntersectingNe(t)?-1:0}return-1}return-1}(e,t);if(0===s)return t.createInstance();if(1===s)return t;const l=e.getPCSHorizon(),c=l.getGeometryType(),m=e.getDefaultPrecisionSR();if(c===i.G.enumEnvelope){const s=n.Envelope2D.constructEmpty();l.queryEnvelope(s);const i=(0,o.a)(m,s,!1);h=(0,u.c)(t,s,i,5e4*e.getOneMeterPCSUnit(),r)}else(new fi).execute(l,t,m,r)||(h=(new gn).execute(h,l,m,r),h===l&&(h=h.clone()))}else if(e.isPannable()){const t=n.Envelope2D.constructEmpty();h.queryEnvelope(t);const o=e.getPannableExtent();o.containsEnvelope(t)||(Yi(h,o,e.getTolerance(0)),2!==s&&4!==s||(h=zi(h,e)),4!==s?h=Ni(h,e,0,!0,1e5*e.getOneMeterPCSUnit(),r):l===i.G.enumPolygon&&t.width()>2*o.width()&&(h=qi(h,-2*o.width(),2*o.width(),e,!0,0,!0,r)))}return h}if((0,i.g)(1===h),l===i.G.enumMultiPoint)return Yi(t,e.getPannableExtent(),e.getTolerance(0)),t;{const s=n.Envelope2D.constructEmpty();t.queryEnvelope(s);let o=t;const a=e.getPannableExtent();if(s.ymin<a.ymin||s.ymax>a.ymax){const t=Math.max(1,s.calculateToleranceFromEnvelope()),i=new n.Envelope2D(s.xmin-t,a.ymin,s.xmax+t,a.ymax);if(o=(new u.O).execute(o,i,e,r),o.isEmpty())return o}return l===i.G.enumPolygon&&s.width()>2*a.width()&&(o=qi(o,-2*a.width(),2*a.width(),e,!0,0,!0,r)),o}}function Xi(t,e){const s=e.getPointCount();if(!s)return;const n=e.getImpl(),i=n.getAttributeStreamRef(0),r=t;Oo.geogToProj(r,s,i.getArray()),n.notifyModifiedFlags(2001)}function ji(t,e,s,n){if(!s)return;const i=t.getPECoordSys();if(1===s){const s=[e[0].x,e[0].y];if(Oo.geogToProj(i,1,s),n){const{first:n,second:i}=t.m_peCoordSysVal.getGeogToProjFactors();s[0]=n*(e[0].x-t.getCentralMeridian())+i}return void e[0].setCoords(s[0],s[1])}const r=t.isPannable(),o=r?t.getPannableExtent().width():0,l=179*o/360;let h=0;r&&(h=t.getCentralMeridian());const u=new Float64Array(512);for(let c=0;c<s;){for(let t=c;t<s&&e[t].isNAN();++t)c++;let m=Math.min(256,s-c);if(m>0){for(let t=1,s=c+1;t<m;++t,++s)if(e[s].isNAN()){m=t;break}for(let t=0;t<m;++t){const s=t<<1;u[s]=e[c+t].x,u[s+1]=e[c+t].y}if(Oo.geogToProj(i,m,u),n){const{first:s,second:n}=t.m_peCoordSysVal.getGeogToProjFactors();for(let t=0;t<m;++t)u[t<<1]=s*(e[c+t].x-h)+n}if(r)for(let t=0,s=c;t<m;t++,s++){const n=t<<1,i=u[n],r=(0,a.e)(i),c=e[s].x-h;r*(0,a.e)(c)<0&&Math.abs(i)>l&&(u[n]-=r*o)}Mi(u,e,c,m),c+=m}}}function Zi(t,e,s,n){const i=t.getSRToGCSTransform();return(new Sn).transform(i,e,s,n,!1)}function Wi(t,e,s,i){const o=new r.M({vd:e.getDescription()});let a;o.addPoints(e,0,-1),a=(new Sn).execute(o,t,i);const l=e.getPointCount();if(s.setEmpty(),t.getInputSR().isPannable()){if(l!==a.getPointCount())return!1;const i=new n.Envelope2D;e.queryEnvelope(i);const r=new n.Envelope2D;a.queryEnvelope(r);const o=i.width(),h=r.width();if(0!==o&&0!==h){const e=h/o,s=t.getOutputSR().getPannableExtent().width()/t.getInputSR().getPannableExtent().width();if(Math.abs(e/s-1)>1e-10)return!1}else if(0!==o||0!==h)return!1;s.add(e,!1);for(let t=0;t<l;t++){const e=a.getXY(t);s.setXY(t,e)}return!0}return!1}function $i(t,e,s){(0,i.g)(!s||t.isPannable());const n=e.getPointCount();if(!n)return;const r=e.getImpl(),o=r.getAttributeStreamRef(0),l=t.getPECoordSys();let h=0;const u=o.readRange(0,2*n);let c=()=>{Oo.geogToProj(l,n,u)};const m=t.isPannable()&&!s,d=m?t.getPannableExtent().width():0,g=179*d/360;if(t.isPannable()&&(h=t.getCentralMeridian(),s)){const e=t.m_peCoordSysVal.getGeogToProjFactors(),s=e.first,i=e.second;c=()=>{Oo.geogToProj(l,n,u);for(let t=0;t<n;t++){const e=t<<1,n=o.read(e),r=s*(n-h)+i;u[e]=r}}}if(c(),m)for(let i=0;i<n;i++){const t=i<<1,e=u[t],s=(0,a.e)(e),n=o.read(t)-h;s*(0,a.e)(n)<0&&Math.abs(e)>g&&(u[t]+=-s*d)}o.writeRangeFromArray(0,2*n,u,!0,1),r.notifyModifiedFlags(2001)}function Ki(t,e,s){switch(e.getGeometryType()){case i.G.enumLine:return void function(t,e,s){const n=[e.getStartXY(),e.getEndXY()];ji(t,n,2,s),e.setStartXY(n[0]),e.setEndXY(n[1]),e.normalizeAfterEndpointChange()}(t,e,s);case i.G.enumBezier:return void function(t,e,s){const n=(0,a.m)(a.P,4);e.queryControlPoints(n),mr(t,n,4,s),e.setControlPoints(n)}(t,e,s);case i.G.enumEllipticArc:return void function(t,e,s){if(0===e.projectionBehavior())!function(t,e,s){gr(!0,t,0,e,s)}(t,e,s);else{const n=e.isClosed()&&e.isMajor(),i=[e.getStartXY(),n?e.getCenter():e.getEndXY()],r=[i[0].clone(),i[1].clone()];mr(t,r,2,s);const o=new h.T;o.initializeFromTwoPointsArray(i,r),e.applyTransformation(o);const a=n?0:1;e.setCoordsForIntersector(r[0],r[a],!1)}}(t,e,s);case i.G.enumBezier2:case i.G.enumRationalBezier2:return void(0,i.g)(0);default:(0,i.d)("")}}function Qi(t,e,s){if(!e.hasNonLinearSegments())return void $i(t,e,s);if((0,i.g)(!s||t.isPannable()),e.isEmpty())return;const n=t.getPECoordSys(),l=t.isPannable(),h=l?t.getPannableExtent().width():0,u=179*h/360;let c=0;l&&(c=t.getCentralMeridian());const m=e.createInstance();m.reserveParts(e.getPointCount(),e.getPathCount());const d=e.getImpl(),g=new r.S;for(let i=0,r=e.getPathCount();i<r;++i)if(d.hasNonLinearSegmentsPath(i)){let e=!0,n=-1;const r=d.getPathStart(i),l=r+d.getSegmentCountPath(i);d.isClosedPath(i)&&(n=l-1);const h=new a.P;for(let i=r;i<l;++i){if(d.getSegmentBuffer(i,g,!1),Ki(t,g.get(),s),e||g.get().getStartXY().equals(h)||g.get().moveTo(h),i!==n)m.addSegment(g.get(),e);else{if(e){const t=new o.P;g.get().queryStart(t),m.startPathPoint(t)}m.closeLastPathWithSegment(g.get())}h.assign(g.get().getEndXY()),e=!1}}else{const t=1024;let s,r=d.getPathSize(i),o=Math.min(r,t);m.insertPath(-1,e,i,!0);const g=d.getAttributeStreamRef(0),p=m.getAttributeStreamRef(0);for(let e=d.getPathStart(i),m=d.getPathEnd(i);e<m;){if(s=g.readRange(e,o),Oo.geogToProj(n,o,s),l)for(let t=0;t<o;t++){const e=t<<1,n=s[e],i=(0,a.e)(n),r=g.read(2*(0+t))-c;i*(0,a.e)(r)<0&&Math.abs(n)>u&&(s[e]+=-i*h)}p.writeRangeFromArray(e,o,s,!0,1),e+=o,r-=o,o=Math.min(r,t)}}e.assignMove(m)}function Ji(t,e,s){let n=s.getPointCount();if(!n)return;const i=s.getImpl(),r=i.getAttributeStreamRef(0);let o=Math.min(n,1e3),l=0;const h=t.getPECoordSys();Number.isNaN(e)&&(e=0);const u=t.isPannable(),c=t.getOneDegreeGCSUnit(),m=360*c,d=179*c;let g;for(;n;){if(g=r.readRange(2*l,2*o),er(h,o,g,e),u)for(let t=0;t<o;t++){const s=t<<1,n=g[s]-e,i=(0,a.e)(n),o=r.read(2*(l+t));i*(0,a.e)(o)<0&&Math.abs(n)>d&&(g[s]+=-i*m)}r.writeRangeFromArray(2*l,2*o,g,!0,1),l+=o,n-=o,o=Math.min(n,1e3)}i.notifyModifiedFlags(2001)}function tr(t,e,s){switch(s.getGeometryType()){case i.G.enumLine:return void function(t,e,s){const n=[s.getStartXY(),s.getEndXY()];nr(t,e,n,2),s.setStartXY(n[0]),s.setEndXY(n[1]),s.normalizeAfterEndpointChange()}(t,e,s);case i.G.enumBezier:return void function(t,e,s){const n=(0,a.m)(a.P,4);s.queryControlPoints(n),dr(t,e,n,4),s.setControlPoints(n)}(t,e,s);case i.G.enumEllipticArc:return void function(t,e,s){if(0===s.projectionBehavior())!function(t,e,s){gr(!1,t,e,s,!1)}(t,e,s);else{const n=s.isClosed()&&s.isMajor(),i=[s.getStartXY(),n?s.getCenter():s.getEndXY()],r=[i[0].clone(),i[1].clone()];dr(t,e,r,2);const o=new h.T;o.initializeFromTwoPointsArray(i,r),s.applyTransformation(o);const a=n?0:1;s.setCoordsForIntersector(r[0],r[a],!1)}}(t,e,s);case i.G.enumBezier2:case i.G.enumRationalBezier2:return void(0,i.g)(0);default:(0,i.d)("")}}function er(t,e,s,n){const r=Oo.projToGeogCenter(t,e,s,n);for(let o=0;o<e;++o){const t=o<<1;(0,i.g)(Number.isFinite(s[t]+s[t+1]))}return r}function sr(t,e,s){if(!s.hasNonLinearSegments())return void Ji(t,e,s);if(s.isEmpty())return;const n=t.getPECoordSys();Number.isNaN(e)&&(e=0);const i=t.isPannable(),l=t.getOneDegreeGCSUnit(),h=360*l,u=179*l,c=s.createInstance();c.reserveParts(s.getPointCount(),s.getPathCount());const m=s.getImpl(),d=new r.S;for(let r=0,g=s.getPathCount();r<g;++r)if(m.hasNonLinearSegmentsPath(r)){let s=!0,n=-1;const i=m.getPathStart(r),l=i+m.getSegmentCountPath(r);m.isClosedPath(r)&&(n=l-1);const h=new a.P;for(let r=i;r<l;++r){if(m.getSegmentBuffer(r,d,!1),tr(t,e,d.get()),s||d.get().getStartXY().equals(h)||d.get().moveTo(h),r!==n)c.addSegment(d.get(),s);else{if(s){const t=new o.P;d.get().queryStart(t),c.startPathPoint(t)}c.closeLastPathWithSegment(d.get())}h.assign(d.get().getEndXY()),s=!1}}else{const t=1e3;let o,l=m.getPathSize(r),d=Math.min(l,t);c.insertPath(-1,s,r,!0);const g=m.getAttributeStreamRef(0),p=c.getAttributeStreamRef(0);for(let s=m.getPathStart(r),c=m.getPathEnd(r);s<c;){if(o=g.readRange(2*s,2*d),er(n,d,o,e),i)for(let t=0;t<d;t++){const n=t<<1,i=o[n]-e,r=(0,a.e)(i),l=g.read(2*s);r*(0,a.e)(l)<0&&Math.abs(i)>u&&(o[n]+=-r*h)}p.writeRangeFromArray(2*s,2*d,o,!0,1),s+=d,l-=d,d=Math.min(l,t)}}s.assignMove(c)}function nr(t,e,s,n){const i=t.getPECoordSys();Number.isNaN(e)&&(e=0);const r=t.isPannable(),o=t.getOneDegreeGCSUnit(),l=360*o,h=179*o,u=new Float64Array(512);for(let c=0;c<n;){for(let e=c;e<n&&s[e].isNAN();++e)c++;let t=Math.min(256,n-c);if(t>0){for(let e=1,n=c+1;e<t;++e,++n)if(s[n].isNAN()){t=e;break}for(let e=0;e<t;e++){const t=e<<1;u[t]=s[c+e].x,u[t+1]=s[c+e].y}if(er(i,t,u,e),r)for(let n=0,i=c;n<t;++n,++i){const t=n<<1,r=s[i].x,o=u[t]-e,c=(0,a.e)(o);c*(0,a.e)(r)<0&&Math.abs(o)>h&&(u[t]-=c*l)}for(let e=0;e<t;e++){const t=e<<1;s[c+e].x=u[t],s[c+e].y=u[t+1]}c+=t}}}function ir(t,e,s,n){(0,i.g)(0)}function rr(t,e,s){let n=e.getPointCount();if(!n)return!1;const i=e.getImpl(),r=i.getAttributeStreamRef(0);let o=null;const l=t.getInputSR(),h=t.getOutputSR();l.getVCS(),h.getVCS();const u=l.getOneDegreeGCSUnit(),c=h.getOneDegreeGCSUnit(),m=t.isVertical();m&&e.hasAttribute(1)&&(o=i.getAttributeStreamRef(1));const d=t.getDatumTransformation(),g=!!d&&1===d.getType();if(g||null===o||(ir(o.getArray()),o=null),!d||0===d.count()){const t=l.getGcsUnitFactor()/h.getGcsUnitFactor(),e=(l.getPrimeMeridian()-h.getPrimeMeridian())*c,s=-90*u,o=90*u;let m=0;const d=r.getArray(),g=[0];for(let i=1,r=2*n;i<r;)g[0]=d[i],m|=(0,a.aD)(g,s,o)?1:0,d[i]=g[0],i+=2;if(0!==e||1!==t){m=1;const s=r.getArray();for(let i=0,r=2*n;i<r;){let n=s[i];n*=t,n+=e,s[i]=n,s[i+1]*=t,i+=2}}return 0!==m&&i.notifyModifiedFlags(2001),!!m}let p=Math.min(n,1e3);const _=(0,a.d)(p,Number.NaN),f=(0,a.d)(p,Number.NaN);let y=null;null!==o&&(y=new Float64Array(p));let x=0,v=Number.NaN,b=Number.NaN;const P=360*c,S=c/u;s&&(b=90*c,v=89.9*u,f.fill(0));let E=!0,C=0;for(;n;){let t=!1;const e=r.readRange(2*x,2*p);for(let s=0;s<p;s++)_[s]=e[s<<1];if(s)for(let s=0;s<p;s++){const n=1+(s<<1),i=Math.abs(e[n])-v;if(i>0){const r=e[n];e[n]=(0,a.f)(v,r),f[s]=(0,a.f)(i,r),t=!0}}const i=e[0];if(g){const t=d;y&&o.queryRange(x,p,y,!0,1),t.transform(!1,e,y,p),y&&o.writeRangeFromArray(x,p,y,!0,1)}else d.transform(!1,e,p);E&&(C=e[0]-S*i,E=!1);for(let s=0;s<p;s++){const t=s<<1,n=e[t]-_[s]*S-C;Math.abs(n)>200&&(e[t]+=n>0?-P:P)}if(t){for(let t=0;t<p;t++)if(f[t]){const s=1+(t<<1);e[s]+=S*f[t],e[s]>b?e[s]=b:e[s]<-b&&(e[s]=-b)}f.fill(0)}r.writeRangeFromArray(2*x,2*p,e,!0,1),m&&o&&o.writeRangeFromArray(x,p,y,!0,1),x+=p,n-=p,p=Math.min(n,1e3)}return i.notifyModifiedFlags(2001),!0}function or(t,e,s){switch(e.getGeometryType()){case i.G.enumLine:return function(t,e,s){const n=[e.getStartXY(),e.getEndXY()],i=[0,0];let r=null;e.hasAttribute(1)&&(r=i,r[0]=e.getAttributeAsDbl(0,1,0),r[1]=e.getAttributeAsDbl(1,1,0));const o=cr(t,n,r,2,s);return e.setStartXY(n[0]),e.setEndXY(n[1]),r&&(e.setStartAttribute(1,0,r[0]),e.setEndAttribute(1,0,r[1])),e.normalizeAfterEndpointChange(),o}(t,e,s);case i.G.enumBezier:return function(t,e,s){const n=(0,a.m)(a.P,4);e.queryControlPoints(n);const i=[0,0,0,0];let r=null;e.hasAttribute(1)&&(r=i,r[0]=e.getAttributeAsDbl(0,1,0),r[3]=e.getAttributeAsDbl(1,1,0),r[1]=(0,a.q)(r[0],r[3],.5),r[2]=r[1]);const o=cr(t,n,r||null,n.length,s);return e.setControlPoints(n),r&&(e.setStartAttribute(1,0,r[0]),e.setEndAttribute(1,0,r[3])),e.normalizeAfterEndpointChange(),o}(t,e,s);case i.G.enumEllipticArc:return function(t,e,s){if(0===e.projectionBehavior())return function(t,e,s){const n=[e.getStartXY(),e.getEndXY(),e.getInteriorPoint(),e.getCenter()];let i=4;e.isDegenerateToLine()&&(i=2);const r=[0,0,0,0];let o=null;if(e.hasAttribute(1)){o=r,o[0]=e.getAttributeAsDbl(0,1,0),o[1]=e.getAttributeAsDbl(1,1,0);const t=(0,a.q)(o[0],o[1],.5);o[2]=t,o[3]=t}const l=e.getStartXY().equals(e.getEndXY())&&!e.isDegenerateToLine(),h=cr(t,n,o,i,s);return l?e.constructCircleCenterAndPoint(n[3],n[0],!e.isClockwise()):e.isDegenerateToLine()?e.constructLineCircularArc(n[0],n[1]):e.constructCircularArcThreePoint(n[0],n[1],n[2]),o&&(e.setStartAttribute(1,0,o[0]),e.setEndAttribute(1,0,o[1])),h}(t,e,s);const n=e.getStartXY().equals(e.getEndXY()),i=(0,a.m)(a.P,3),r=(0,a.m)(a.P,3),o=[0,0,0];let l=null;i[0].assign(e.getStartXY()),i[1].assign(n?e.getCenter():e.getEndXY());let u=!1;e.hasAttribute(1)&&(l=o,l[0]=e.getAttributeAsDbl(0,1,0),l[1]=e.getAttributeAsDbl(1,1,0),l[2]=(0,a.q)(l[0],l[1],.5),n&&(l[1]=l[2])),r[0].setCoordsPoint2D(i[0]),r[1].setCoordsPoint2D(i[1]);const c=new h.T;if(n||e.isDegenerateToLine())u=cr(t,r,l,2,s),c.initializeFromTwoPoints(i[0],i[1],r[0],r[1]);else{const n=new a.P;e.queryCoord2D(.5,n),i[2].setCoordsPoint2D(n),r[2].setCoordsPoint2D(n),u=cr(t,r,l,3,s),c.setFromTwoTriangles(i,r)}return c.isIdentity()||(e.applyTransformation(c),e.setStartXY(r[0]),e.setEndXY(n?r[0]:r[1]),e.normalizeAfterEndpointChange()),l&&(e.setStartAttribute(1,0,l[0]),e.setEndAttribute(1,0,n?l[0]:l[1])),u}(t,e,s);case i.G.enumBezier2:case i.G.enumRationalBezier2:return(0,i.g)(0),!1;default:(0,i.d)("")}}function ar(t,e,s){if(!e.hasNonLinearSegments())return rr(t,e,s);if(e.isEmpty())return!1;const n=e.createInstance();n.reserveParts(e.getPointCount(),e.getPathCount());const i=e.getImpl(),l=new r.S;for(let r=0,h=e.getPathCount();r<h;++r){let e=!0,h=-1;const u=i.getPathStart(r),c=u+i.getSegmentCountPath(r);i.isClosedPath(r)&&(h=c-1);const m=new a.P;for(let r=u;r<c;++r){if(i.getSegmentBuffer(r,l,!1),or(t,l.get(),s),e||l.get().getStartXY().equals(m)||l.get().moveTo(m),r!==h)n.addSegment(l.get(),e);else{if(e){const t=new o.P;l.get().queryStart(t),n.startPathPoint(t)}n.closeLastPathWithSegment(l.get())}m.assign(l.get().getEndXY()),e=!1}}return e.assignMove(n),!0}function lr(t,e,s,n,i,r){if(t.isIdentityGeogToGeog()){const s=90*t.getInputSR().getOneDegreeGCSUnit();let i=0;const r=[0];for(let t=0;t<n;t++)r[0]=e[t].y,i|=(0,a.aD)(r,-s,s)?1:0,e[t].y=r[0];return i}const o=t.getInputSR(),l=t.getOutputSR(),h=o.getVCS(),u=l.getVCS(),c=o.getOneDegreeGCSUnit(),m=90*c,d=l.getOneDegreeGCSUnit(),g=t.isVertical(),p=t.getDatumTransformation(),_=!!p&&1===p.getType();if(g||(s=null),!p||0===p.count()){let t=0;const i=[0];for(let s=0;s<n;s++)i[0]=e[s].y,t|=(0,a.aD)(i,-m,m)?1:0,e[s].y=i[0];return t|=ui(o.getGCS(),h,l.getGCS(),u,e,s,n)?1:0,t}_||null===s||ir();let f=Math.min(n,1024);const y=(0,a.d)(f,Number.NaN),x=(0,a.d)(f,Number.NaN);let v=0,b=Number.NaN,P=Number.NaN;const S=360*d,E=d/c;i&&(P=90*d,b=89.9*c);let C=!0,w=0,I=n;for(;I;){let t=!1;for(let s=0;s<f;s++)y[s]=e[s+v].x;if(i)for(let s=0;s<f;s++){const n=Math.abs(e[s+v].y)-b;if(n>0){const i=e[s+v].y;e[s+v].y=(0,a.f)(b,i),x[s]=(0,a.f)(n,i),t=!0}}const n=e[0].x;_?p.transform(!1,e,s,f):p.transform(!1,e,f),C&&(w=e[0].x-E*n,C=!1);for(let s=0;s<f;s++){const t=e[v+s].x-y[s]*E-w;Math.abs(t)>200&&(t>0?e[v+s].x-=S:e[v+s].x+=S)}if(t){for(let t=0;t<f;t++)x[t]&&(e[v+t].y+=E*x[t],e[v+t].y>P?e[v+t].y=P:e[v+t].y<-P&&(e[v+t].y=-P));x.fill(0,0,f)}v+=f,I-=f,f=Math.min(I,1024)}return 1}function hr(t,e,s,n,r){return(0,i.g)(0),0}function ur(t,e,s,n,r){(0,i.g)(null===n),(0,i.g)(e<2147483647);const o=Array.isArray(s);let l;l=o?(0,a.aG)(s):s;const h=qo.geogToGeog(t,e,l,null,r);return o&&(0,a.aH)(l,s),h}function cr(t,e,s,n,i,r){let o=0,a=!0,l=0;for(let h=0;h<n;++h)e[h].isNAN()?a||(o|=lr(t,e.slice(l,h-l),s?s.slice(l,h-l):null,h-l,i),l=h,a=!0):a&&(l=h,a=!1);return a||(o|=lr(t,0===l?e:e.slice(l),s?0===l?s:s.slice(l):null,n-l,i)),0!==o}function mr(t,e,s,n){ji(t,e,s,n)}function dr(t,e,s,i){nr(t,e,s,i);const r=new n.Envelope2D;r.setFromPoints(s,i);const o=t.getOneDegreeGCSUnit(),a=360*o,l=180*o;if(r.width()>l){for(let t=0;t<i;t++)for(;s[t].x<e;)s[t].x+=a;if(r.setFromPoints(s,i),r.xmax>l+e)for(let t=0;t<i;t++)s[t].x-=a}}function gr(t,e,s,n,i){const r=(0,a.m)(a.P,3);let o=0,l=!1,h=!1;const u=n.isDegenerateToLine();u?(r[0].assign(n.getStartXY()),r[1].assign(n.getEndXY()),r[2].setCoords(0,0),o=2):n.isClosed()&&n.isMajor()?(l=!0,h=!n.isClockwise(),r[0].assign(n.getStartXY()),r[1].assign(n.getCenter()),r[2].setCoords(0,0),o=2):(r[0].assign(n.getStartXY()),r[1].assign(n.getEndXY()),r[2].assign(n.getInteriorPoint()),o=3),t?mr(e,r,o,i):dr(e,s,r,o),u?n.constructLineCircularArc(r[0],r[1]):l?n.constructCircleCenterAndPoint(r[1],r[0],h):n.constructCircularArcThreePoint(r[0],r[1],r[2])}function pr(t,e,s){const n=(0,r.a9)(t),i=(0,r.a9)(e),o=(0,r.a7)(n,i),a=(0,r.a7)(n,(0,r.a9)(s));return 0===a||o>0&&a>0&&a<=o||o<0&&a<0&&a>=o}function _r(t,e,s,n,r){const o={stack:[],error:void 0,hasError:!1};try{const h=s.clone(),u=n.clone();if(2===r){const t=[0,0];return k(0,e,h,u,0,t),t[0]}if(h.y>u.y){const t=new a.P;t.assign(h),h.assign(u),u.assign(t)}const c=(0,l.b)(o,new Go,!1),m=(0,l.b)(o,new Go,!1),d=(0,l.b)(o,new Go,!1),g=new a.E;if(g.setCoords(h.y,u.y),!g.containsCoordinate(0)||Math.abs(h.x-u.x)>=Math.PI)return Number.NaN;if(h.x===u.x)return h.x;Ho.geodeticDistance(t,e,h.x,h.y,u.x,u.y,m,c,null,r);const p=m.val;let _=0,f=1;const y=h.clone();for(;p*(f-_)>1e-12*t;){const s=.5*(_+f);if(Ho.geodeticCoordinate(t,e,h.x,h.y,p*s,c.val,m,d,r),y.x=m.val,y.y=d.val,g.setCoords(h.y,y.y),0===y.y)return y.x;if(g.containsCoordinate(0))f=s;else{if(g.setCoords(u.y,y.y),!g.containsCoordinate(0))return(0,i.g)(!1),Number.NaN;_=s}}return y.x}catch(h){o.error=h,o.hasError=!0}finally{(0,l.c)(o)}}function fr(t,e,s,n){const i=new a.E;i.setCoords(e,s);const r=n.width();let o=Math.floor((t-e)/r)*r+t;const l=i.getCenter();for(;Math.abs(o-l)>Math.abs(o+r-l);)o+=r;return o}class yr extends m.G{constructor(){super(),this.m_geometryDeque=[],this.m_index=-1}next(){if(this.m_geometryDeque.length>0){this.m_index++;const t=this.m_geometryDeque[0];return this.m_geometryDeque.shift(),t}return null}getGeometryID(){return this.m_index}tick(t){this.m_geometryDeque.push(t)}tock(){return!0}getRank(){return 1}}class xr{constructor(t,e=!0){this.m_PCSHorizon=null,this.m_GCSHorizon=null,this.m_GCSSplitLines=null,this.m_bGCSHorisonIsInclusive=!1,this.m_oneMeterPCS=0,this.m_oneDegreeGCS=0,this.m_gcsUnitFactor=0,this.m_northPole=a.P.getNAN(),this.m_southPole=a.P.getNAN(),this.m_polesUpdated=0,this.m_domain=n.Envelope2D.constructEmpty(),this.m_primeMeridian=Number.NaN,this.m_geogToProjFactor=1,this.m_geogToProjOffset=0,this.m_geogToProjFactorsUpdated=0,this.m_oneMillimeter=0,this.m_centralMeridian=0,this.m_pPCSInfoNoDomain=null,this.m_oldWKID=-1973,this.m_vcsWKID=-1,this.m_bIsPannable=!1,this.m_bCached=!1,this.m_pannableExtent=n.Envelope2D.constructEmpty(),this.m_pannableExtentGCS=n.Envelope2D.constructEmpty(),this.m_areaOfUse=null,this.m_canonicalWkt="",this.m_peCoordSys=t,this.m_WKID=Vo.getCode(t),this.m_WKID<=0?(this.m_WKID=0,this.m_canonicalWkt=wi(t,0,!0),this.m_hashCode=(0,a.ay)(this.m_canonicalWkt)):this.m_hashCode=(0,a.B)(this.m_WKID);const s=this.m_peCoordSys.getType();this.m_csType=s===zo.PE_TYPE_PROJCS?2:1,(0,i.g)(s===zo.PE_TYPE_PROJCS||s===zo.PE_TYPE_GEOGCS),s===zo.PE_TYPE_PROJCS&&(t.loadConstants()||(0,i.a)("PeProjcs.loadConstants failed"));const r=s===zo.PE_TYPE_GEOGCS?this.m_peCoordSys:this.m_peCoordSys.getGeogcs();s!==zo.PE_TYPE_GEOGCS&&Vo.getCode(r),this.m_unit=x(t),this.m_primeMeridian=r.getPrimem().getLongitude();{const t=r.getUnit().getUnitFactor();this.m_gcsUnitFactor=t;let e=Math.PI/(180*t);Math.abs(e-1)<1e-10&&(e=1),this.m_oneDegreeGCS=e}if(s===zo.PE_TYPE_PROJCS){const t=this.m_peCoordSys,e=t.getUnit().getUnitFactor();this.m_oneMeterPCS=1/e,this.m_oneMillimeter=.001/e,this.m_pPCSInfoNoDomain=Bo.generate(t,Bo.PE_PCSINFO_OPTION_NONE),this.m_pPCSInfoNoDomain||(0,i.d)("cannot create pcs info"),this.m_bIsPannable=this.m_pPCSInfoNoDomain.isPannableRectangle(),this.m_centralMeridian=this.m_pPCSInfoNoDomain.getCentralMeridian()}else{this.m_bIsPannable=!0,this.m_polesUpdated=1,this.m_oneMeterPCS=0;const t=1/r.getUnit().getUnitFactor(),e=r.getDatum().getSpheroid().getAxis();this.m_oneMillimeter=.001/e*t,this.m_centralMeridian=0}this.m_bIsPannable&&(this.updateGCSHorizon(),this.updatePCSHorizon(),this.updatePoles(),this.updateDomain(),this.updatePannableExtent(),this.updatePannableExtentGCS())}[Symbol.dispose](){}getHashCode(){return this.m_hashCode}getPCSHorizonPannable(){return this.m_PCSHorizon}getGCSHorizonPannable(){return this.m_GCSHorizon}getPCSInfo(){return(0,i.g)(this.m_pPCSInfoNoDomain),this.m_pPCSInfoNoDomain}getCentralMeridian(){return this.m_centralMeridian}updateGCSHorizon(){if(this.m_peCoordSys.getType()!==zo.PE_TYPE_PROJCS)return;let t=!0;const e=this.m_peCoordSys,s=e.getGeogcs(),l=e.horizonGcsGenerate();if(!l)return;(0,i.g)(l.length>0);const c=l[0].getNump(),m=l[0].getKind();let d,g;t=l[0].getInclusive()>0;const p=this.getOneDegreeGCSUnit(),_=90*p,f=360*p,y=370*p,x=180*p*zo.PE_HORIZON_DELTA/Math.PI,v=n.Envelope2D.constructEmpty();let b=null;if(c>1)for(let n=1;n<c;n++)if(l[n].getKind()===zo.PE_HORIZON_LINE){b||(b=new r.P);const t=l[n].getCoord();b.startPathCoords(t[0][0],t[0][1]),b.lineToCoords(t[1][0],t[1][1])}if(m===zo.PE_HORIZON_RECT){const e=l[0].getCoord();if(v.setFromPoints([new a.P(e[0][0],e[0][1]),new a.P(e[1][0],e[1][1])],2),Math.abs(v.ymax-_)<1e-7*x&&(v.ymax=_),Math.abs(v.ymin+_)<1e-7*x&&(v.ymin=-_),v.width()>y){const t=-400*p,e=t+5*f;v.setCoords({xmin:t,ymin:v.ymin,xmax:e,ymax:v.ymax})}const s=new o.E({env2D:v});this.m_GCSHorizon||(this.m_GCSHorizon=s,this.m_bGCSHorisonIsInclusive=t)}else{let e=this.getPCSInfo().isGcsHorizonMultiOverlap();const o=oo(s,null,null,1),m=[],y=new a.E;for(let t=0;t<c;t++){if(l[t].getKind()!==zo.PE_HORIZON_POLY)continue;d=l[t].getSize();const e=l[t].getCoord(),s=n.Envelope2D.constructEmpty();s.setFromPoints((0,a.az)(e),d),m.push(new a.E(s.xmin,s.xmax)),s.width(),y.merge(m.at(-1))}let x=!1;const v=new a.E;y.width()>f&&m.length>1?(v.vmin=this.getCentralMeridian()-f,v.vmax=v.vmin+2*f,x=!0,e=!0):(v.vmin=y.vmin,v.vmax=v.vmin+f);const P=t=>{let e=0;for(;m[t].vmin+e<v.vmin;)e+=f;for(;m[t].vmax+e-f>v.vmin;)e-=f;return e};let S=new r.a;if(e){const t=new yr,e=(new bi).executeMany(t,o,null);for(let s=0;s<c;s++){if(l[s].getKind()!==zo.PE_HORIZON_POLY)continue;d=l[s].getSize();const n=l[s].getCoord();g=l[s].getInclusive()>0;const i=new r.a;if(i.addPathPoint2D((0,a.az)(n),d-1,!0),x){const e=P(s),n=m[s].clone();n.move(e);let r=e;const o=new h.T;do{o.setShiftCoords(r,0);const e=i.clone();e.applyTransformation(o),t.tick(e),t.tock(),r+=f,n.move(f)}while(n.vmin<v.vmax)}else t.tick(i),e.tock()}S=e.next()}else{S=new r.a;for(let e=0;e<c;e++){if(l[e].getKind()!==zo.PE_HORIZON_POLY)continue;d=l[e].getSize();const s=l[e].getCoord();if(g=l[e].getInclusive()>0,(0,i.g)(g===t),x){const t=new r.a;t.addPathPoint2D((0,a.az)(s),d-1,!0);const n=P(e),i=m[e].clone();i.move(n);let o=n;const l=new h.T;do{if(0!==o){l.setShiftCoords(o,0);const e=new r.a({copy:t});e.applyTransformation(l),S.addPath(e,0,!0)}else S.addPath(t,0,!0);o+=f,i.move(f)}while(i.vmin<v.vmax)}else S.addPathPoint2D((0,a.az)(s),d-1,!0)}}x&&(S=(new u.O).execute(S,new n.Envelope2D(v.vmin,-_-p,v.vmax,_+p),o,null)),t?(new gn).accelerateGeometry(S,o,1):(new xi).accelerateGeometry(S,o,1),(new Ei).accelerateGeometry(S,o,1),null===this.m_GCSHorizon&&(this.m_GCSHorizon=S,this.m_bGCSHorisonIsInclusive=t,this.m_GCSSplitLines=b)}}updateAreaOfUse(){return null}updatePCSHorizon(){if(this.m_peCoordSys.getType()!==zo.PE_TYPE_PROJCS)return;const t=this.m_peCoordSys.horizonPcsGenerate();if(!t)return;let e;this.getPCSInfo();const s=t[0].getKind();t[0].getInclusive();const l=n.Envelope2D.constructEmpty(),h=t[0].getNump();let u=!1;if(s===zo.PE_HORIZON_RECT){const s=t[0].getCoord();l.setFromPoints((0,a.az)(s),2),e=new o.E({env2D:l})}else{let s=-1;for(let e=0;e<h;e++)t[e].getKind()===zo.PE_HORIZON_POLY&&(s=e);(0,i.g)(s>=0);const n=t[s].getSize()-1,o=t[s].getCoord(),l=new r.a;e=l,l.addPathPoint2D((0,a.az)(o),n,!0),u=!0}if(this.getPCSInfo().isDensificationNeeded()){(0,i.g)(s!==zo.PE_HORIZON_RECT);const t=1e5*this.getOneMeterPCSUnit();e=(new c.O).execute(e,t,0,0,null)}if(u){{const t=new o.E;e.queryEnvelope(t),e.calculateArea2D(),e.calculateLength2D(),e.getExteriorRingCount()}(new gn).accelerateGeometry(e,null,1)}null===this.m_PCSHorizon&&(this.m_PCSHorizon=e)}updatePannableExtent(){const t=this.m_peCoordSys.getType();if(t===zo.PE_TYPE_PROJCS){const t=this.m_peCoordSys,e=this.getPCSInfo().getCentralMeridian(),s=t.getGeogcs();s||(0,i.d)("");const r=[e+1/s.getUnit().getUnitFactor()*Math.PI,0];Oo.geogToProj(t,1,r);const o=r[0],a=t.getParameters()[zo.PE_PARM_X0].getValue(),l=this.getPCSHorizon(),h=n.Envelope2D.constructEmpty();l.queryEnvelope(h);const u=Math.abs(o-a),c=u+a,m=-1*u+a,d=h.ymax,g=h.ymin;this.m_pannableExtent.setCoords({xmin:m,ymin:g,xmax:c,ymax:d})}else if(t===zo.PE_TYPE_GEOGCS){const t=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI;this.m_pannableExtent.setCoords({xmin:-t,ymin:-t/2,xmax:t,ymax:t/2})}else(0,i.d)("")}updatePannableExtentGCS(){const t=this.m_peCoordSys.getType();if(t===zo.PE_TYPE_PROJCS){const t=this.m_peCoordSys,e=this.m_centralMeridian,s=t.getGeogcs();s||(0,i.d)("");const r=1/s.getUnit().getUnitFactor()*Math.PI,o=this.getGCSHorizon(),a=n.Envelope2D.constructEmpty();o.queryEnvelope(a),this.m_pannableExtentGCS.setCoords({xmin:e-r,ymin:a.ymin,xmax:e+r,ymax:a.ymax})}else if(t===zo.PE_TYPE_GEOGCS){const t=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI;this.m_pannableExtentGCS.setCoords({xmin:-t,ymin:-t/2,xmax:t,ymax:t/2})}else(0,i.d)("")}updateDomain(){if(1===this.m_csType){const t=400*this.getOneDegreeGCSUnit();this.m_domain=n.Envelope2D.construct(-t,-t,t,t)}else{(0,i.g)(2===this.m_csType);const t=Bo.generate(this.m_peCoordSys,Bo.PE_PCSINFO_OPTION_DOMAIN);t||(0,i.d)("generate pcs info failed");const e=new n.Envelope2D(t.getDomainMinx(),t.getDomainMiny(),t.getDomainMaxx(),t.getDomainMaxy());this.m_domain.isEmpty()&&this.m_domain.setCoords({env2D:e})}}updatePoles(){if(this.m_peCoordSys.getType()===zo.PE_TYPE_PROJCS){const t=90*this.getOneDegreeGCSUnit(),e=[[0,t],[0,-t]];Oo.geogToProj(this.m_peCoordSys,2,e);const s=this.getPCSInfo().getNorthPoleLocation()!==Bo.PE_POLE_OUTSIDE_BOUNDARY,n=this.getPCSInfo().getSouthPoleLocation()!==Bo.PE_POLE_OUTSIDE_BOUNDARY;this.m_polesUpdated||(s&&this.m_northPole.setCoords(e[0][0],e[0][1]),n&&this.m_southPole.setCoords(e[1][0],e[1][1]),this.m_polesUpdated=1)}else this.m_polesUpdated=1}updateGeogToProjFactors(){if(this.m_peCoordSys.getType()===zo.PE_TYPE_PROJCS){const t=this.getOneDegreeGCSUnit(),e=this.m_pPCSInfoNoDomain.getCentralMeridian(),s=[0,0,0,0];s[0]=e,s[1]=0,s[2]=e+t,s[3]=0;const n=Oo.geogToProj(this.m_peCoordSys,2,s);(0,i.g)(2===n);const r=(s[2]-s[0])/t,o=s[0];0===this.m_geogToProjFactorsUpdated&&(this.m_geogToProjFactor=r,this.m_geogToProjOffset=o,this.m_geogToProjFactorsUpdated=1)}else this.m_geogToProjFactorsUpdated=1}getOneMeterPCSUnit(){return this.m_oneMeterPCS}getOneDegreeGCSUnit(){return this.m_oneDegreeGCS}getGcsUnitFactor(){return this.m_gcsUnitFactor}getUnitsPerMillimeter(){return this.m_oneMillimeter}getGCSSplitLines(){return this.m_bIsPannable?null:(this.m_GCSHorizon||this.updateGCSHorizon(),this.m_GCSSplitLines)}getGCSHorizon(){return this.m_bIsPannable?this.getGCSHorizonPannable():(null!==this.m_GCSHorizon||this.updateGCSHorizon(),this.m_GCSHorizon)}getGCSHorisonIsInclusive(){return this.m_bIsPannable||this.getGCSHorizon(),this.m_bGCSHorisonIsInclusive}getPCSHorizon(){return this.m_bIsPannable?this.getPCSHorizonPannable():(null!==this.m_PCSHorizon||this.updatePCSHorizon(),this.m_PCSHorizon)}getPole(t){return this.m_bIsPannable||0!==this.m_polesUpdated||this.updatePoles(),t?this.m_southPole:this.m_northPole}getGeogToProjFactors(){return 0===this.m_geogToProjFactorsUpdated&&this.updateGeogToProjFactors(),(0,a.k)(this.m_geogToProjFactor,this.m_geogToProjOffset)}getDomainXY(){if(this.m_bIsPannable)return this.m_domain.clone();let t=!1;return t=this.m_domain.isEmpty(),t&&this.updateDomain(),this.m_domain.clone()}getPrimeMeridian(){return this.m_primeMeridian}getLatestID(){return this.m_WKID}getOldID(){let t=this.m_oldWKID;if(t<0){if(t=0,this.m_WKID>0){const e=[0],s=[0];(function(t,e,s,n){return e<=0?(s[0]=0,n[0]=0,!1):(s[0]=e,n[0]=e,!0)})(this.m_peCoordSys.getType(),this.m_WKID,e,s)||(0,i.d)("query_code_change"),t=e[0]}this.m_oldWKID=t}return t}isCustomWkid(){return!1}isPannable(){return this.m_bIsPannable}getPannableExtent(){return this.m_pannableExtent.clone()}getPannableExtentGCS(){return this.m_pannableExtentGCS.clone()}getAreaOfUse(){return null!==this.m_areaOfUse?this.m_areaOfUse:this.updateAreaOfUse()}getVcsCode(){return 0}saveMemory(){}getCSType(){return this.m_csType}getUnit(){return this.m_unit}setCached(){this.m_bCached=!0}getCached(){return this.m_bCached}static equal(t,e){return!1}static equal_for_projection(t,e){return!1}}class vr{constructor(t,e=!0){this.m_oneMeter=0,this.m_WKID=-1,this.m_oldWKID=-1,this.m_canonicalWkt="not yet implemented",this.m_model=0,this.m_unit=new Hr,this.m_cached=!1}setCached(t=!0){this.m_cached=t}getCached(){return this.m_cached}getOneMeterUnit(){return 0}getLatestID(){return this.m_WKID}getOldID(){let t=this.m_oldWKID;return t<0&&(t=0,this.m_WKID>0&&(t=this.m_WKID),this.m_oldWKID=t),t}getModel(){return 0}isCustomWkid(){return!1}getVerticalUnit(){return this.m_unit}static equal(t,e){return!1}static equal_for_projection(t,e){return!1}}function br(t,e,s,r){return function(t,e,s,r,o){return eo()||(0,i.r)("cannot create projection transformation"),e.hasVCS()&&s.hasVCS()?function(){return(0,i.g)(0),{}}():function(t,e,s,r){t&&e||(0,i.a)("!inputSR || !outputSR");const o=t.getLatestID(),a=e.getLatestID();if(3857===o&&4326===a){if(t.m_bDefaultDescriptor&&e.m_bDefaultDescriptor)return Or()}else if(4326===o&&3857===a&&t.m_bDefaultDescriptor&&e.m_bDefaultDescriptor)return Vr||(Vr=Or().getInverse()),Vr;const l=n.Envelope2D.constructEmpty();l.setCoords({env2D:s});const h=t.getCoordinateSystemType(),u=e.getCoordinateSystemType();if(0===h||0===u)return wr(t,e);if(r){const s=r.find(0,t.getGCS(),e.getGCS());if(s)return wr(t,e,s)}const c=t.getGCS().getLatestID(),m=e.getGCS().getLatestID();if(c>0&&c===m)return wr(t,e);const d=new kr(t,e,s);{const t=function(t){if(Lr.has(t.getHashCode()))return Lr.get(t.getHashCode())}(d);if(t)return t}const g=Er(0,t,e,l,1,!0);return function(t,e){return Lr.set(t.getHashCode(),e),e}(d,wr(t,e,g.length?g[0]:void 0))}(e,s,r,o)}(0,t,e,s,r)}function Pr(t,e,s,n){return Sr(!0,t,e,s,n)}function Sr(t,e,s,n,r,o){return eo()||(0,i.r)("cannot create projection transformation"),new Mr(t?2:1,e,s,n,r,o)}function Er(t,e,s,n,r,o=!1){if(e&&s||(0,i.a)(""),eo()||(0,i.r)("cannot obtain geotransformation list"),1===t&&e.hasVCS()&&s.hasVCS())return(0,i.t)("hv xform not impl"),[];{const t=na(e,s,n,r,o),i=[];for(const e of t)i.push(e);return i}}function Cr(){return{centralMeridianOfOutputGCS:Number.NaN,densificationStep:Number.NaN,clipWithInputHorizon:!0,clipWithOutputHorizon:!0,legacyHorizonClipping:!1,normalizeResultGeometry:!1,equals(t){return(0,a.Q)(this.centralMeridianOfOutputGCS,t.centralMeridianOfOutputGCS)&&(0,a.Q)(this.densificationStep,t.densificationStep)&&this.clipWithInputHorizon===t.clipWithInputHorizon&&this.clipWithOutputHorizon===t.clipWithOutputHorizon&&this.legacyHorizonClipping===t.legacyHorizonClipping&&this.normalizeResultGeometry===t.normalizeResultGeometry}}}function wr(t,e,s,n,i){return new Mr(1,t,e,s,n,i)}function Ir(){return{flagsMask:0,setFlag(t,e){e?this.flagsMask|=t:this.flagsMask&=~t},hasFlag(t){return!!(this.flagsMask&t)}}}function Tr(){return{m_extendedParams:Cr(),m_extendedParamsInternal:Ir()}}function Ar(){return Tr()}let Mr=class t{constructor(t,e,s,n,r,o){let a,l;this.m_datumTran=null,this.m_bIdentity=!0,this.m_bIdentityGeogToGeog=!0,this.m_bVertical=!1,this.m_bNormalize=!1,e&&s||(0,i.a)("!inputSR || !outputSR"),n&&0===n.getType()&&(n.m_bReadOnly=!0),this.m_bNormalize=!1,1!==t&&(a=e.getVCS(),l=s.getVCS(),this.m_bVertical=null!=a&&null!=l),this.m_inputSR=e,this.m_outputSR=s,this.m_bIdentity=!1,this.m_bIdentityGeogToGeog=!1,(0,i.g)(!this.m_params),r&&(this.m_params=Tr(),this.m_params.m_extendedParams=r),o&&(this.m_params||(this.m_params=Tr()),this.m_params.m_extendedParamsInternal=o);let h=!1;const u=null!=n,c=e.getCoordinateSystemType(),m=s.getCoordinateSystemType();if(s.isPannable()&&0!==c&&r){const t=r.centralMeridianOfOutputGCS;if(!Number.isNaN(t)&&s.isPannable()){const e=s.getPannableExtent(),n=e.getCenterX();if(n!==t){const s=Math.ceil(e.width());t+s!==n+s&&(h=!0)}}}const d=r&&r.normalizeResultGeometry;if(e.equals(s))return this.m_bIdentity=!h,this.m_bIdentityGeogToGeog=!0,void this.updateProjector();const g=!u&&e.equalForProjection(s,this.m_bVertical);this.m_bIdentity=g&&!h,this.m_bIdentity?this.m_bIdentityGeogToGeog=!0:0!==c&&0!==m&&(d&&this.m_outputSR.isPannable()&&(this.m_bNormalize=d),this.m_datumTran=n||null,this.m_bIdentityGeogToGeog=(!this.m_datumTran||0===this.m_datumTran.count())&&this.m_inputSR.getGCS().equalForProjection(this.m_outputSR.getGCS(),this.m_bVertical)),this.updateProjector()}getInputSR(){return this.m_inputSR}getOutputSR(){return this.m_outputSR}getDatumTransformation(){return this.m_datumTran}getInverse(){const e=new t(1,this.m_outputSR,this.m_inputSR,this.m_datumTran?.createInverse());return e.m_bIdentity=this.m_bIdentity,e.m_bVertical=this.m_bVertical,e.m_bIdentityGeogToGeog=this.m_bIdentityGeogToGeog,e.updateProjector(),e}isIdentity(){return this.m_bIdentity}getExtendedParams(){return this.m_params?this.m_params.m_extendedParams:Ar().m_extendedParams}equals(t){return(0,i.g)(0),!1}isVertical(){return this.m_bVertical}isMatchingTransformation(t,e){return(0,i.g)(0),!1}getGeographicTransformations(){return this.m_datumTran}getExtendedParamsImpl(){return this.m_params?this.m_params.m_extendedParams:Ar().m_extendedParams}getExtendedParamsInternal(){return this.m_params?this.m_params.m_extendedParamsInternal:Ar().m_extendedParamsInternal}isIdentityGeogToGeog(){return this.m_bIdentityGeogToGeog}normalizeOutput(){return this.m_bNormalize}updateProjector(){this.m_projector=new vn(this)}};const Dr=new Map,Nr=new Map,Fr=new Map;function Rr(t){let e=t.getCode();if(e>0){return Ur(e)||Yr(Vo.coordsys(e))}const s=t.getName();if(Nr.has(s)){const e=Nr.get(s);if(e&&e.deref()){const s=e.deref();if(s.m_peCoordSys.isEqual(t))return s}}return e=Vo.getCode(t),Yr(e>0?Vo.coordsys(e):t)}class kr{constructor(t,e,s){this.m_hashCode=-1,t&&(this.m_inputSR=t,this.m_outputSR=e,this.m_env=s.clone(),this.m_hashCode=this.m_inputSR.getHashCode(),this.m_hashCode=(0,a.at)(this.m_hashCode,this.m_outputSR.getHashCode()),this.m_env.isEmpty()||(this.m_hashCode=(0,a.at)(this.m_hashCode,(0,a.aI)(this.m_env.xmin)),this.m_hashCode=(0,a.at)(this.m_hashCode,(0,a.aI)(this.m_env.xmax)),this.m_hashCode=(0,a.at)(this.m_hashCode,(0,a.aI)(this.m_env.ymin)),this.m_hashCode=(0,a.at)(this.m_hashCode,(0,a.aI)(this.m_env.ymax))))}getHashCode(){return this.m_hashCode}equals(t){return!(this.m_inputSR&&!t.m_inputSR||!this.m_inputSR&&t.m_inputSR)&&this.m_env.equals(t.m_env)&&this.m_inputSR.equals(t.m_inputSR)&&this.m_outputSR.equals(t.m_outputSR)}clear(){this.m_inputSR=void 0,this.m_outputSR=void 0,this.m_hashCode=-1,this.m_env=void 0}}const Lr=new Map;let Gr,Vr,zr;function Or(){return Gr||(Gr=Pr(Co(),Io())),Gr}const qr=new Map;function Br(t){if(qr.has(t))return qr.get(t);{const e=function(t){return null!==Zo(Vo.coordsys(t)).get()}(t);return qr.set(t,e),e}}function Yr(t){const e=Zo(t),s=t.getCode();if(s>0){const t=Ur(s);if(t)return t}const n=t.getName();let i=Nr.get(n);if(i){const e=i.deref();if(e&&e.m_peCoordSys.isEqual(t))return e}const r=new xr(e.release());if(s>0)return r.setCached(),Dr.set(s,new WeakRef(r)),Nr.set(n,new WeakRef(r)),r;const o=wi(t,0,!1);if(i=Fr.get(o),i){const t=i.deref();if(t)return t}return r.setCached(),Fr.set(o,new WeakRef(r)),r}function Ur(t){const e=Dr.get(t);if(e)return e.deref()}class Hr extends p{constructor(t){return void 0===t?(super(),this.m_wkid=9001,void(this.m_peUnit=null)):"number"==typeof t?(super(),this.m_factor=t,void(this.m_wkid=0)):(super(t),void(t||(this.m_factor=1,this.m_wkid=9001,this.m_peUnit=(zr||(zr=Vo.unit(9001)),zr))))}getUnitType(){return 0}convertFromMeters(t){return t/this.getUnitToBaseFactor()}convertToMeters(t){return t*this.getUnitToBaseFactor()}}const Xr=["0","1","2","3","4","5","6","7","8","9","b","c","d","e","f","g","h","j","k","m","n","p","q","r","s","t","u","v","w","x","y","z"];function jr(t,e,s,n,r){(0,i.g)(n>>5<r.length);let o=e,a=s;for(let i=n;i>=0;i-=2){const e=31&i,s=.5*(a+o);t>=s?(r[i>>5]|=1<<e,o=s):a=s}}let Zr=new Set;const Wr=2147483645n,$r=9007199254740990n,Kr="operation is not supported for unknown coordinate systems";var Qr;function Jr(){return{majorSemiAxis:0,e2:0,minorSemiAxis:0,flattening:0,isSphere(){return 0===this.e2}}}function to(t){!function(t){Wo=t,(0,i.g)(Wo)}(t)}function eo(){return!!Vo}function so(){return!!Wo}function no(){return!!Vo||!!Wo}function io(t,e,s){return(0,i.g)(no()),No(t,void 0===e?0:e,null,!1)}function ro(t,e){(0,i.g)(no());const s=new So;let n;return eo()?(n=function(t){const e=Zo(Vo.fromString(zo.PE_TYPE_COORDSYS,t));return e.get()||(0,i.D)(t),Rr(e.release())}(t),s.setHorzProj_(n),s.m_vertcs=null,s.m_userWKID=n.getLatestID()):(n=$o(t),s.m_unit=n.isPCS?new Hr(n.metersOrRadiansPerUnit):new f(n.metersOrRadiansPerUnit)),Ao(s.m_precisionDescriptor,n,null,1),s.m_bDefaultDescriptor=!0,s.m_userWKT=t,s.calculateHashCode(),s.initDbgName(),s}function oo(t,e,s,n,r=!0){let o=null;return e&&((0,i.g)(0),o={}),function(t,e,s,n,r){t||(0,i.a)("!PE_coord_sys");const o=new So;let a;return a=r?Rr(t):new xr(t,!1),Ao(o.m_precisionDescriptor,a,e,n),o.m_bDefaultDescriptor=!0,o.setHorzProj_(a),o.m_vertcs=e,o.m_userWKID=a.getLatestID(),o.calculateHashCode(),o.initDbgName(),o}(t,o,0,n,r)}function ao(t,e,s=!1){3===t.getCoordinateSystemType()&&(0,i.a)("image spatial reference cannot be altered");const n=new So,r=t;return n.m_peCoordSysVal=r.m_peCoordSysVal,n.m_vertcs=r.m_vertcs,n.m_unit=r.m_unit,n.m_precisionDescriptor.assign(e),n.m_localZToXYFactor=r.m_localZToXYFactor,(Number.isNaN(n.m_precisionDescriptor.m_falseX)||Number.isNaN(n.m_precisionDescriptor.m_falseY))&&(n.m_precisionDescriptor.m_falseX=r.m_precisionDescriptor.m_falseX,n.m_precisionDescriptor.m_falseY=r.m_precisionDescriptor.m_falseY),n.m_precisionDescriptor.snapPrecision(),n.m_precisionDescriptor.fixTolerance(),n.m_userWKID=r.m_userWKID,n.m_precisionDescriptor.equals(r.m_precisionDescriptor)?n.m_bDefaultDescriptor=r.m_bDefaultDescriptor:n.m_bDefaultDescriptor=!1,s&&(n.m_bDefaultDescriptor=!0),n.calculateHashCode(),n.initDbgName(),n}function lo(t,e,s){return{}}function ho(t,e,s){void 0===e&&(e=1),(e<=0||!Number.isFinite(e))&&(0,i.a)(""),t||1===e||(0,i.a)("null Unit has to have z_to_xy_factor equal to 1");const n=new So;n.m_unit=t;const r=t||new Hr(9001);return Do(n.m_precisionDescriptor,r,null,1),n.m_bDefaultDescriptor=!0,Number.isNaN(n.m_precisionDescriptor.m_falseX)&&(0,i.a)("NAN false X/Y are not allowed here"),n.m_localZToXYFactor=e,n.calculateHashCode(),n.initDbgName(),n}function uo(t,e){return t.snapGeometry(e)}function co(t){const e=t.getCoordinateSystemType();return 1===e?t:(3===e&&(0,i.g)(0),t.getGCS())}function mo(t){return(0,i.g)(no()),so()?function(t){return(0,i.g)(so()),!!Wo(t).isPCS||function(t){return Vo&&(0,i.p)("pe has been loaded. no-pe methods should not be used at this point."),Ro||Qo(),Ro.has(t)}(t)}(t):Br(t)}function go(t){if(eo())return null!==Zo(Vo.fromString(zo.PE_TYPE_COORDSYS,t)).get();try{return $o(t),!0}catch(e){}return!1}let po;function _o(){return po||(po=(()=>{const t=Math.trunc(Math.random()*(0,a.i)()),e=Date.now();return`|abba_000|${t.toString(16)}|${e.toString(16)}|`})()),po}!function(t){t[t.utmDefault=0]="utmDefault",t[t.utmNorthSouth=1]="utmNorthSouth"}(Qr||(Qr={}));let fo=0;function yo(t=""){let e=`${_o()}${fo++}`;return""!==t&&(e+=`|${t}`),e}function xo(t){return t.startsWith(_o())}let vo,bo,Po,So=class t{destroy(){(function(t){Nr.delete(t.m_peCoordSys.getName()),Fr.delete(wi(t.m_peCoordSys,0,!1))})(this.m_peCoordSysVal),1===this.getCoordinateSystemType()||2===this.getCoordinateSystemType()?this.getPECoordSys().destroy():(0,i.d)("SpatialReference.destroy")}constructor(){this.m_vertcs=null,this.m_peCoordSysVal=null,this.m_userWKID=0,this.m_userWKT=null,this.m_geogSpatialReference=null,this.m_srToGcs=null,this.m_gcsToSr=null,this.m_defaultPrecisionSR=null,this.m_localZToXYFactor=-1,this.m_precisionDescriptor=new Eo,this.m_hashCode=0,this.m_bDefaultDescriptor=!1,To(this.m_precisionDescriptor),Zr&&Zr.add(new WeakRef(this))}attachToPe(){(this.m_userWKID>0?io(this.m_userWKID):ro(this.m_userWKT)).copyTo(this,!1)}copyTo(t,e=!0){(e||t.m_bDefaultDescriptor)&&(t.m_bDefaultDescriptor=this.m_bDefaultDescriptor,t.m_precisionDescriptor.assign(this.m_precisionDescriptor)),t.m_defaultPrecisionSR=null,t.m_gcsToSr=this.m_gcsToSr,t.m_geogSpatialReference=this.m_geogSpatialReference,t.m_hashCode=this.m_hashCode,t.m_localZToXYFactor=this.m_localZToXYFactor,t.m_peCoordSysVal=this.m_peCoordSysVal,t.m_srToGcs=this.m_srToGcs,t.m_userWKID=this.m_userWKID,t.m_userWKT=this.m_userWKT,t.m_vertcs=this.m_vertcs,t.m_unit=this.m_unit}getHashCode(){return this.m_hashCode}getHashCodeHorizontal(){let t=0;return t=this.m_peCoordSysVal?this.m_peCoordSysVal.getHashCode():this.m_unit?this.m_unit.getHashCode():305419891,t}updateTransform(t){if(1===this.getCoordinateSystemType())return Pr(this,this,null);let e=t?this.m_srToGcs:this.m_gcsToSr;if(e)return e;const s=this.getGCS();e=t?Pr(this,s,null):Pr(s,this,null);const n=e;return(t?this.m_srToGcs:this.m_gcsToSr)||(t?this.m_srToGcs=n:this.m_gcsToSr=n,e)}getHashCodeVertical(){return this.m_vertcs?this.m_vertcs.getHashCode():0}calculateHashCode(){let t=this.getHashCodeHorizontal();const e=this.getHashCodeVertical(),s=this.m_precisionDescriptor.getHashCode();t=(0,a.at)(t,e),this.m_hashCode=(0,a.at)(t,s)}initDbgName(){}setHorzProj_(t){this.m_peCoordSysVal=t,this.m_unit=this.m_peCoordSysVal.getUnit()}getTolerance(t=0){return this.m_precisionDescriptor.getTolerance(t)}getResolution(t=0){return this.m_precisionDescriptor.getResolution(t)}getPECoordSys(){return this.m_peCoordSysVal?this.m_peCoordSysVal.m_peCoordSys:null}getPCSInfo(){return this.throwIfNotGCSOrPCS(),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getPCSInfo()}getCentralMeridian(){return this.throwIfNotGCSOrPCS(),1===this.getCoordinateSystemType()?0:this.getPCSInfo().getCentralMeridian()}getCoordinateSystemType(){const t=this.getPECoordSys();if(t)switch(t.getType()){case zo.PE_TYPE_GEOGCS:return 1;case zo.PE_TYPE_PROJCS:return 2;default:return 0}else{if((this.m_userWKID>0||this.m_userWKT)&&this.m_unit instanceof Hr)return 2;if(this.m_unit instanceof f)return 1}return 0}getID(){return this.m_userWKID}getLatestID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getLatestID():this.m_userWKID}getOldID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getOldID():this.m_userWKID}getVerticalID(){return(0,i.t)("vcs not implemented"),0}getLatestVerticalID(){return this.m_vertcs?this.m_vertcs.getLatestID():0}getOldVerticalID(){return(0,i.t)("vcs not implemented"),0}getPEVerticalCoordSys(){return null}getPole(t){return this.throwIfNotGCSOrPCS(),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getPole(t)}getText(){const t=this.getPECoordSys();return t?Ii(t):this.m_userWKT??""}getTextExtended(t){const e=this.getPECoordSys();return e?this.getPEVerticalCoordSys()?(this.getPEVerticalCoordSys(),(0,i.g)(0),""):Ii(e,t):this.m_userWKT??""}getText2(t=-1){const e=this.getPECoordSys();return e?function(t,e){(e>1||e<-1)&&(0,i.a)("verbosity");let s=zo.PE_STR_FMT_WKT2;return-1!==e&&(s|=0===e?zo.PE_STR_AUTH_TOP:zo.PE_STR_AUTH_ALL),t.toString(s)}(e,t):this.m_userWKT??""}getUnit(){return this.m_unit}getUnitsPerMillimeter(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getUnitsPerMillimeter():this.m_unit instanceof Hr?.001/this.m_unit.getUnitToBaseFactor():this.m_unit instanceof f?.001/($o(this.m_userWKT??this.m_userWKID).semiMajor*this.m_unit.getUnitToBaseFactor()):((0,i.p)("sr object not in valid state"),0)}getAuthorityName(){return this.getPECoordSys()?((0,i.g)(0),""):""}getVerticalUnit(){return(0,i.t)("vcs not implemented"),{}}getVCS(){return this.m_vertcs}hasVCS(){return!1}getGCSHorisonIsInclusive(){return this.throwIfNotGCSOrPCS(),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSHorisonIsInclusive()}getGCSHorizon(){return this.throwIfNotGCSOrPCS(),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSHorizon()}getGCS(){const t=this.getCoordinateSystemType();if(0===t)(0,i.p)(Kr);else{if(1===t)return this;3===t&&(0,i.p)("image cs not supported")}if(this.m_geogSpatialReference)return this.m_geogSpatialReference;let e;if(this===Co()||this===wo())e=Io();else{(0,i.g)(this.m_peCoordSysVal);const t=this.m_peCoordSysVal.m_peCoordSys.getGeogcs();t||(0,i.d)(""),e=oo(t,this.m_vertcs,0,this.m_precisionDescriptor.getPrecision(),this.m_peCoordSysVal.getCached())}return this.m_geogSpatialReference?e=this.m_geogSpatialReference:this.m_geogSpatialReference=e,e}getGCSSplitLines(){return this.throwIfNotGCSOrPCS(),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSSplitLines()}toGCS(t,e){if(0===t.length)return 0;t.length>e.length&&(0,i.a)("coordsSrc.size() > coordsDst.size()");const s=this.getCoordinateSystemType();if(0===s&&(0,i.p)(Kr),1===s)return(0,a.aw)(e,t,t.length),t.length;(0,i.g)(this.m_peCoordSysVal);const n=this.getSRToGCSTransform();return(new Sn).transform(n,t,t.length,e)}toGeohash(t,e=8){const s=t.clone();s.scale(9102===this.getGCS().getUnit().getID()?1:this.getGCS().getUnit().getUnitToBaseFactor()/Math.PI*180),s.x<-180?(s.x=(0,a.l)(s.x,360),s.x<-180&&(s.x+=360)):s.x>180&&(s.x=(0,a.l)(s.x,360),s.x>180&&(s.x-=360)),s.y>90&&(s.y=90),s.y<-90&&(s.y=-90);const n=5*e,i=new Uint32Array(4);return jr(s.x,-180,180,n-1,i),jr(s.y,-90,90,n-2,i),function(t,e,s){const n=(0,a.d)(e,"R");let i=0,r=0;for(let o=0;o<e;o++){let s=t[i]>>r&31;if(r+=5,r>31){const e=37-r;s&=(1<<e)-1,r-=32,i++,s|=(t[i]&(1<<r)-1)<<e}const a=Xr[s];n[e-1-o]=a}return s>e?n.push(..."0".repeat(s-e)):s<e&&(n.length=s),n.join("")}(i,e,e)}isPannable(){const t=this.getCoordinateSystemType();return 0!==t&&3!==t&&((0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.isPannable())}getPannableExtent(){return this.isPannable()||(0,i.a)("!is_pannable"),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getPannableExtent()}getPannableExtentInGCS(){return this.isPannable()||(0,i.a)("!is_pannable"),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getPannableExtentGCS()}throwIfNotGCSOrPCS(){const t=this.getCoordinateSystemType();1!==t&&2!==t&&(0,i.a)("Not a GCS or PCS")}getDomainXY(){return this.throwIfNotGCSOrPCS(),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getDomainXY()}getFullWorldExtent(){return this.throwIfNotGCSOrPCS(),this.isPannable()?this.getPannableExtent():this.getDomainXY()}queryPrecisionDescriptor(t){if(t.assign(this.m_precisionDescriptor),Number.isNaN(t.m_falseX))if(eo()||(0,i.r)("cannot query precision descriptor"),(0,i.g)(null!==this.m_peCoordSysVal),2!==this.m_precisionDescriptor.m_precision){const e=this.m_peCoordSysVal.getDomainXY();t.m_falseX=e.xmin,t.m_falseY=e.ymin}else t.m_falseX=-Number.MAX_VALUE,t.m_falseY=-Number.MAX_VALUE}queryPrecisionDescriptorWithoutFalseXY(t){t.assign(this.m_precisionDescriptor),t.m_falseX=Number.NaN,t.m_falseY=Number.NaN}queryDefaultPrecisionDescriptorWithoutFalseXY(t){if(this.m_bDefaultDescriptor)t.assign(this.m_precisionDescriptor);else{const e=this.getCoordinateSystemType();0===e?Do(t,this.m_unit,this.m_vertcs,this.m_precisionDescriptor.getPrecision()):3===e?(0,i.t)("image cs"):Ao(t,this.m_peCoordSysVal,this.m_vertcs,this.m_precisionDescriptor.getPrecision())}t.m_falseX=Number.NaN,t.m_falseY=Number.NaN}horizontalEqual(t){return function(t,e){return t===e||null!==t&&null!==e&&t.m_csType===e.m_csType&&(0===t.m_WKID&&0===e.m_WKID?t.m_hashCode===e.m_hashCode&&t.m_canonicalWkt===e.m_canonicalWkt:t.m_WKID===e.m_WKID)}(this.m_peCoordSysVal,t.m_peCoordSysVal)}verticalEqual(t){return null!==this.m_vertcs==(null!==t.m_vertcs)&&(!this.m_vertcs||this.m_vertcs.equals(t.m_vertcs))}equals(t){const e=t;if(this===e)return!0;if(!this.horizontalEqual(e)||!this.verticalEqual(e))return!1;if(!e.m_peCoordSysVal){if((0,i.g)(!this.m_peCoordSysVal),null!==this.m_unit!=(null!==e.m_unit))return!1;if(this.m_unit&&!this.m_unit.equals(e.m_unit))return!1;if(this.m_localZToXYFactor!==e.m_localZToXYFactor)return!1}if(!this.m_bDefaultDescriptor||!e.m_bDefaultDescriptor){if(this.m_peCoordSysVal){if(!this.m_precisionDescriptor.equalsWithoutFalseXY(e.m_precisionDescriptor))return!1;(0,i.g)(e.m_peCoordSysVal);let t=this.m_precisionDescriptor.m_falseX,s=this.m_precisionDescriptor.m_falseY;if(Number.isNaN(t)){const e=this.m_peCoordSysVal.getDomainXY();t=e.xmin,s=e.ymin}let n=e.m_precisionDescriptor.m_falseX,r=e.m_precisionDescriptor.m_falseY;if(Number.isNaN(n)){const t=e.m_peCoordSysVal.getDomainXY();n=t.xmin,r=t.ymin}return t===n&&s===r}return this.m_precisionDescriptor.equals(e.m_precisionDescriptor)}return!0}equalForProjection(t,e){if(this===t)return!0;const s=this.getCoordinateSystemType(),n=t.getCoordinateSystemType();if(0===s||0===n)return 0===s&&0===n?(!e||this.getZToXYFactor()===t.getZToXYFactor())&&(!this.getUnit()||!t.getUnit()||this.getUnit().equals(t.getUnit())):3!==s&&3!==n&&(null===this.getUnit()||null===t.getUnit()||(!e||this.getZToXYFactor()===t.getZToXYFactor())&&this.getUnit().equals(t.getUnit()));if(s!==n)return!1;if(3===s)return this.equals(t);if(function(t,e){return t===e||null!==t&&null!==e&&t.m_csType===e.m_csType&&(0===t.m_WKID&&0===e.m_WKID?1===t.m_csType?t.m_peCoordSys.isEqual(e.m_peCoordSys):t.m_peCoordSys===e.m_peCoordSys:t.m_WKID===e.m_WKID)}(this.m_peCoordSysVal,t.m_peCoordSysVal)){if(!e)return!0;if(null!==this.m_vertcs==(null!==t.m_vertcs))return!this.m_vertcs||this.m_vertcs.equalForProjection(t.m_vertcs)}return!1}equalHorizontal(t){return this.horizontalEqual(t)}equalVertical(t){return(0,i.g)(0),!1}equalVerticalVCS(t){return(0,i.g)(0),!1}convergenceAngle(t){return(0,i.g)(0),0}getPeCoordsysCopy(){if(this.m_peCoordSysVal){const t=this.m_peCoordSysVal.m_peCoordSys;return t||(0,i.d)("cannot clone coord sys"),t}return null}getPeVertcsCopy(){return(0,i.g)(0),0}throwIfLocal(){0===this.getCoordinateSystemType()&&(0,i.a)(Kr)}getPrimeMeridian(){return this.throwIfLocal(),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getPrimeMeridian()}getSRToGCSTransform(){return this.updateTransform(!0)}getGCSToSRTransform(){return this.updateTransform(!1)}getOneMeter(){return 1e3*this.getUnitsPerMillimeter()}getOneMeterPCSUnit(){return this.throwIfNotGCSOrPCS(),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getOneMeterPCSUnit()}getDefaultPrecisionSR(){if(this.m_bDefaultDescriptor)return this;if(null===this.m_defaultPrecisionSR){const t=new Eo;this.queryDefaultPrecisionDescriptorWithoutFalseXY(t),this.m_defaultPrecisionSR=ao(this,t,!0)}return this.m_defaultPrecisionSR}getPCSHorizon(){return this.throwIfNotGCSOrPCS(),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getPCSHorizon()}getHorzUnitFactor(){return this.m_unit?this.m_unit.getUnitToBaseFactor():1}querySpheroidData(t){this.throwIfNotGCSOrPCS(),(0,i.g)(this.m_peCoordSysVal);const e=this.getGCS().getPECoordSys().getDatum().getSpheroid(),s=e.getFlattening();!function(t,e,s){t.majorSemiAxis=e,t.minorSemiAxis=e*(1-s),t.e2=s*(2-s),t.flattening=s}(t,e.getAxis(),s)}getAreaOfUse(){0===this.getCoordinateSystemType()&&(0,i.p)(""),(0,i.g)(this.m_peCoordSysVal);const t=this.m_peCoordSysVal.getAreaOfUse();return null===t?new g:new g({geom:t.clone(),sr:io(4326)})}getZToXYFactor(){return 1}isCustomWkid(){return!1}getOneDegreeGCSUnit(){return this.throwIfNotGCSOrPCS(),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getOneDegreeGCSUnit()}getGcsUnitFactor(){return this.throwIfNotGCSOrPCS(),(0,i.g)(this.m_peCoordSysVal),this.m_peCoordSysVal.getGcsUnitFactor()}snapGeometry(t){if(t.isEmpty())return!1;if(2===this.m_precisionDescriptor.getPrecision())return!1;const e=t.getGeometryType();if((0,i.i)(e))return this.snapMultiVertex_(t);if(e===i.G.enumPoint)return this.snapPoint_(t);if(e===i.G.enumEnvelope)return this.snapEnvelope_(t);if((0,i.f)(e))return this.snapSegment_(t);if(e===i.G.enumGeometryCollection){const e=t;let s=!1;for(let t=0,n=e.getGeometryCount();t<n;++t)s=this.snapGeometry(e.getGeometry(t))||s;return s}(0,i.d)("what else?")}snapMultiVertex_(t){if((0,i.g)(!t.isEmpty()),(0,i.g)(2!==this.m_precisionDescriptor.getPrecision()),(0,i.h)(t.getGeometryType())){const e=t;if(e.hasNonLinearSegments())return this.snapGeometryWithCurves_(e)}const e=t.getImpl(),s=e.getDescription();let n=!1;for(let i=0,r=s.getAttributeCount();i<r;i++){const t=s.getSemantics(i),r=e.getAttributeStreamRef(t);n=this.snapAttributes(t,r,0,e.getPointCount())||n}return n&&e.notifyModifiedFlags(2001),n}snapPoint_(t){return!1}snapEnvelope_(t){return!1}snapSegment_(t){(0,i.g)(!t.isEmpty()),(0,i.g)(2!==this.m_precisionDescriptor.getPrecision());const e=new Eo;this.queryPrecisionDescriptor(e);const s=t.getStartXY(),n=new a.P;n.x=Fo(s.x,e.getFalseX(),e.getGridUnitsXY()),n.y=Fo(s.y,e.getFalseY(),e.getGridUnitsXY());let r=!n.equals(s);const o=t.getEndXY(),l=new a.P;l.x=Fo(o.x,e.getFalseX(),e.getGridUnitsXY()),l.y=Fo(o.y,e.getFalseY(),e.getGridUnitsXY()),r||=!l.equals(o),r&&t.changeEndPoints2D(n,l);const h=(e,s,n)=>{let i=!1;{const r=t.getStartAttributeAsDbl(e,0),o=Fo(r,s,n),l=!(0,a.Q)(o,r);i||=l,l&&t.setStartAttribute(e,0,o)}{const r=t.getEndAttributeAsDbl(e,0),o=Fo(r,s,n),l=!(0,a.Q)(o,r);i||=l,l&&t.setEndAttribute(e,0,o)}return i};let u=r?1:0;return t.hasAttribute(1)&&(u|=h(1,e.getFalseZ(),e.getGridUnitsZ())?1:0),t.hasAttribute(2)&&(u|=h(2,e.getFalseM(),e.getGridUnitsM())?1:0),!!u}snapGeometryWithCurves_(t){(0,i.g)(!t.isEmpty()),(0,i.g)(2!==this.m_precisionDescriptor.getPrecision());const e=t.createInstance(),s=new r.S;let n=0;for(let i=0,r=t.getPathCount();i<r;++i){const r=t.getSegmentCountPath(i);if(0===r){if(e.addPath(t,i,!0),1===e.getPathSize(i)){const t=new o.P;e.getPointByVal(e.getPointCount()-1,t),n|=this.snapGeometry(t)?1:0,e.setPointByVal(e.getPointCount()-1,t)}continue}const a=t.isClosedPath(i);for(let o=0,l=a?r-1:r;o<l;++o)t.getSegmentFromPath(i,o,s,!1),n|=this.snapGeometry(s.get())?1:0,e.addSegment(s.get(),0===o);a&&(t.getSegmentFromPath(i,r-1,s,!1),n|=this.snapGeometry(s.get())?1:0,1===r?e.addPathFromClosedSegment(s.get(),!1):e.closeLastPathWithSegment(s.get()))}return n&&e.copyTo(t),!!n}snapAttributes(e,s,n,i){let r=!1;const o=new Eo;if(this.queryPrecisionDescriptor(o),0===e){const e=s;for(let s=n;s<i;s++){const n=e.read(2*s),i=t.s_SnapValue(n,o.getFalseX(),o.getGridUnitsXY()),a=e.read(2*s+1),l=t.s_SnapValue(a,o.getFalseY(),o.getGridUnitsXY());r=r||i!==n||l!==a,r&&(e.write(2*s,i),e.write(2*s+1,l))}}else if(1===e){const e=s;for(let s=n;s<i;s++){const n=e.read(s),i=t.s_SnapValue(n,o.getFalseZ(),o.getGridUnitsZ());r=r||!(0,a.Q)(i,n),r&&e.write(s,i)}}else if(2===e){const e=s;for(let s=n;s<i;s++){const n=e.read(s),i=t.s_SnapValue(n,o.getFalseM(),o.getGridUnitsM());r=r||!(0,a.Q)(i,n),r&&e.write(s,i)}}return r}static s_SnapValue(t,e,s){return(0,a.ax)((t-e)*s)/s+e}};class Eo{constructor(){const t=$r,e=1e-4,s=.001,n=e*Number(t)*.5;this.m_precision=1,this.m_falseX=-n,this.m_falseY=-n,this.m_unitsXY=Number(t)/(2*n),this.m_falseM=-1e5,this.m_unitsM=1/e,this.m_falseZ=-1e5,this.m_unitsZ=1/e,this.m_toleranceXY=s,this.m_toleranceM=s,this.m_toleranceZ=s}getHashCode(){let t=7777,e=7777;return e=(0,a.at)(e,this.m_falseM),e=(0,a.at)(e,this.m_unitsM),t=(0,a.at)(t,this.m_unitsXY),e=(0,a.at)(e,this.m_toleranceXY),t=(0,a.at)(t,this.m_falseZ),e=(0,a.at)(e,this.m_toleranceZ),t=(0,a.at)(t,this.m_unitsZ),e=(0,a.at)(e,this.m_toleranceM),t=(0,a.at)(t,this.m_precision),(0,a.at)(t,e)}clone(){const t=new Eo;return t.m_falseX=this.m_falseX,t.m_falseY=this.m_falseY,t.m_unitsXY=this.m_unitsXY,t.m_falseZ=this.m_falseZ,t.m_unitsZ=this.m_unitsZ,t.m_falseM=this.m_falseM,t.m_unitsM=this.m_unitsM,t.m_toleranceXY=this.m_toleranceXY,t.m_toleranceZ=this.m_toleranceZ,t.m_toleranceM=this.m_toleranceM,t.m_precision=this.m_precision,t}assign(t){return this.m_falseX=t.m_falseX,this.m_falseY=t.m_falseY,this.m_unitsXY=t.m_unitsXY,this.m_falseZ=t.m_falseZ,this.m_unitsZ=t.m_unitsZ,this.m_falseM=t.m_falseM,this.m_unitsM=t.m_unitsM,this.m_toleranceXY=t.m_toleranceXY,this.m_toleranceZ=t.m_toleranceZ,this.m_toleranceM=t.m_toleranceM,this.m_precision=t.m_precision,this}initialize2D(t,e){}getTolerance(t){switch(t){case 0:return this.m_toleranceXY;case 1:return this.m_toleranceZ;case 2:return this.m_toleranceM;default:return 0}}getResolution(t){if(2===this.m_precision)return 0;switch(t){case 0:return 1/this.m_unitsXY;case 1:return 1/this.m_unitsZ;case 2:return 1/this.m_unitsM;default:return 0}}getFalseX(){return this.m_falseX}getFalseY(){return this.m_falseY}getFalseZ(){return this.m_falseZ}getFalseM(){return this.m_falseM}getGridUnitsXY(){return this.m_unitsXY}getGridUnitsZ(){return this.m_unitsZ}getGridUnitsM(){return this.m_unitsM}getPrecision(){return this.m_precision}static getLimit32(){return 2147483645}static getLimit64(){return 9007199254740990n}static getLimitFloat(){return 0}getXYGridRange(){const t=new n.Envelope2D;switch(this.m_precision){case 0:{const e=Eo.getLimit32()/this.getGridUnitsXY();t.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+e,ymax:this.getFalseY()+e})}break;case 1:{const e=Number(Eo.getLimit64())/this.getGridUnitsXY();t.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+e,ymax:this.getFalseY()+e})}break;case 2:t.setCoords({xmin:-Number.MAX_VALUE,ymin:-Number.MAX_VALUE,xmax:Number.MAX_VALUE,ymax:Number.MAX_VALUE});break;default:t.setEmpty(),(0,i.d)("")}return t}getZGridRange(){const t=new a.E;switch(this.m_precision){case 0:{const e=Eo.getLimit32()/this.getGridUnitsZ();t.setCoords(this.getFalseZ(),this.getFalseZ()+e)}break;case 1:{const e=Number(Eo.getLimit64())/this.getGridUnitsZ();t.setCoords(this.getFalseZ(),this.getFalseZ()+e)}break;case 2:t.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:t.setEmpty(),(0,i.d)("")}return t}getMGridRange(){const t=new a.E;switch(this.m_precision){case 0:{const e=Eo.getLimit32()/this.getGridUnitsM();t.setCoords(this.getFalseM(),this.getFalseM()+e)}break;case 1:{const e=Number(Eo.getLimit64())/this.getGridUnitsM();t.setCoords(this.getFalseM(),this.getFalseM()+e)}break;case 2:t.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:t.setEmpty(),(0,i.d)("")}return t}setTolerance(t,e){switch(e<0&&(0,i.a)("tol < 0"),Number.isFinite(e)||(0,i.a)("tol is not finite"),t){case 0:this.m_toleranceXY=e;break;case 1:this.m_toleranceZ=e;break;case 2:this.m_toleranceM=e;break;default:(0,i.a)("cannot set tolerance for this attribute")}}setGridParams(t,e,s){Number.isFinite(t)&&Number.isFinite(e)&&Number.isFinite(s)||(0,i.a)("grid params are not finite"),s<1&&(0,i.a)("grid units cannot be smaller than 1.0"),this.m_falseX=t,this.m_falseY=e,this.m_unitsXY=s}setZParams(t,e){Number.isFinite(t)&&Number.isFinite(e)||(0,i.a)("grid params are not finite"),e<1&&(0,i.a)("grid units cannot be smaller than 1.0"),this.m_falseZ=t,this.m_unitsZ=e}setMParams(t,e){Number.isFinite(t)&&Number.isFinite(e)||(0,i.a)("grid params are not finite"),e<1&&(0,i.a)("grid units cannot be smaller than 1.0"),this.m_falseM=t,this.m_unitsM=e}setPrecision(t){}equals(t){return this===t||(0,a.Q)(this.m_falseX,t.m_falseX)&&(0,a.Q)(this.m_falseY,t.m_falseY)&&this.equalsWithoutFalseXY(t)}snapPrecision(){if(2===this.m_precision)return;const t=(t,e,s,n)=>{if(!Number.isFinite(e)||!Number.isFinite(s))return s;if(s<1)return 1;if(!n)return s;const i=Number(t)/s;return Math.trunc((e+i-e)*s)>t&&(s=t/(e+i-e)),Math.max(1,s)},e=Number(0===this.m_precision?Wr:$r);this.m_unitsXY=t(e,this.m_falseX,this.m_unitsXY,!0),this.m_unitsXY=t(e,this.m_falseY,this.m_unitsXY,!0),this.m_unitsZ=t(e,this.m_falseZ,this.m_unitsZ,!1),this.m_unitsM=t(e,this.m_falseM,this.m_unitsM,!1)}verifyPrecision(){if(2===this.m_precision)return!0;const t=(t,e,s,n)=>{if(s<1)return!1;if(!Number.isFinite(e)||!Number.isFinite(s))return!1;if(!n)return!0;const i=Number(t)/s;return!(BigInt((e+i-e)*s)>t)},e=0===this.m_precision?Wr:$r;return!!(t(e,this.m_falseX,this.m_unitsXY,!0)&&t(e,this.m_falseY,this.m_unitsXY,!0)&&t(e,this.m_falseZ,this.m_unitsZ,!1)&&t(e,this.m_falseM,this.m_unitsM,!1))}fixTolerance(){2!==this.m_precision&&(this.m_toleranceXY=Math.max(2/this.m_unitsXY,this.m_toleranceXY),this.m_toleranceZ=Math.max(2/this.m_unitsZ,this.m_toleranceZ),this.m_toleranceM=Math.max(2/this.m_unitsM,this.m_toleranceM),(Number.isNaN(this.m_falseX)||Number.isNaN(this.m_falseY))&&(this.m_falseX=this.m_falseY=Number.NaN))}equalsWithoutFalseXY(t){return this===t||this.m_unitsXY===t.m_unitsXY&&this.m_falseZ===t.m_falseZ&&this.m_unitsZ===t.m_unitsZ&&this.m_falseM===t.m_falseM&&this.m_unitsM===t.m_unitsM&&this.m_toleranceXY===t.m_toleranceXY&&this.m_toleranceZ===t.m_toleranceZ&&this.m_toleranceM===t.m_toleranceM&&this.m_precision===t.m_precision}setBestXyDomainFromEnvelope(t,e){}setBestZDomainFromZRange(t,e,s){}setBestMDomainFromMRange(t,e,s){}}function Co(){return(!vo||eo()&&null===vo.getPECoordSys())&&(vo=No(3857,0,null,!0)),vo}function wo(){return(!bo||eo()&&null===bo.getPECoordSys())&&(bo=No(102100,0,null,!0)),bo}function Io(){return(!Po||eo()&&null===Po.getPECoordSys())&&(Po=No(4326,0,null,!0)),Po}function To(t){t.m_falseX=0,t.m_falseY=0,t.m_unitsXY=1,t.m_falseZ=0,t.m_unitsZ=1,t.m_falseM=0,t.m_unitsM=1,t.m_toleranceXY=100*(0,a.O)(),t.m_toleranceZ=100*(0,a.O)(),t.m_toleranceM=100*(0,a.O)(),t.m_precision=2}function Ao(t,e,s,n){const r=e instanceof xr;To(t),t.m_precision=n,t.m_falseX=Number.NaN,t.m_falseY=Number.NaN;const o=1e-4,a=.001,l=r?e.m_csType:e.isPCS?2:1;if(1===l){const s=(0===n?1/18e5:1e-9)*(r?e.getOneDegreeGCSUnit():Math.PI/e.metersOrRadiansPerUnit/180);t.m_unitsXY=1/s}else if(2===l){const s=(0===n?a:o)*(r?e.getOneMeterPCSUnit():1/e.metersOrRadiansPerUnit);t.m_unitsXY=1/s}else(0,i.a)("unrecognized cs type");t.m_falseM=-1e5,t.m_unitsM=1/(0===n?a:o),t.m_unitsM=Math.max(1,t.m_unitsM),t.m_unitsXY=Math.max(1,t.m_unitsXY);let h=0,u=0;0!==n&&1!==n||(h=2/t.m_unitsXY,u=2/t.m_unitsM),t.m_toleranceXY=Math.max(h,r?e.getUnitsPerMillimeter():2===l?.001/e.metersOrRadiansPerUnit:.001/(e.semiMajor*e.metersOrRadiansPerUnit)),t.m_toleranceM=Math.max(a,u),Mo(t,s)}function Mo(t,e){const s=1e-4,n=.001;if(t.m_falseZ=-1e5,e){const i=(0===t.m_precision?n:s)*e.getOneMeter();t.m_unitsZ=1/i}else t.m_unitsZ=1/(0===t.m_precision?n:s);t.m_unitsZ=Math.max(1,t.m_unitsZ);let i=0;0!==t.m_precision&&1!==t.m_precision||(i=2/t.m_unitsZ),t.m_toleranceZ=Math.max(e?e.getOneMeter()*n:n,i)}function Do(t,e,s,n){To(t),t.m_precision=n;const i=0===n?Wr:$r,r=1e-4,o=.001;let a=1,l=1,h=.001;e&&(l=e.getUnitToBaseFactor()),e&&1===e.getUnitType()?(a=400*Math.PI/180,h=8.983152841195215e-9*Math.PI/180/l):(a=(0===n?o:r)*Number(i)*.5,h=o/l),a/=l,t.m_falseX=-a,t.m_falseY=-a,t.m_unitsXY=Number(i)/(2*a),t.m_falseM=-1e5,t.m_unitsM=1/(0===n?o:r),t.m_unitsM=Math.max(1,t.m_unitsM),t.snapPrecision();let u=0,c=0;0!==t.m_precision&&1!==t.m_precision||(c=2/t.m_unitsM,u=2/t.m_unitsXY),t.m_toleranceXY=Math.max(u,h),t.m_toleranceM=Math.max(o,c),Mo(t,s)}function No(t,e,s,n){if(!n&&e<=0){if(3857===t)return Co();if(102100===t)return wo();if(4326===t)return Io()}const r=new So;let o,a=null;return eo()?(o=function(t){t<=0&&(0,i.C)(t);{const e=Ur(t);if(e)return e}const e=Zo(Vo.coordsys(t));e.get()||(0,i.C)(t);const s=Yr(e.release());return s.getLatestID()!==t&&Dr.set(t,new WeakRef(s)),s}(t),e>0?a=null:e=0,r.setHorzProj_(o),r.m_vertcs=a):(o=$o(t),r.m_unit=o.isPCS?new Hr(o.metersOrRadiansPerUnit):new f(o.metersOrRadiansPerUnit)),Ao(r.m_precisionDescriptor,o,a,1),r.m_bDefaultDescriptor=!0,r.m_userWKID=t,r.calculateHashCode(),r.initDbgName(),r}function Fo(t,e,s){return(0,a.ax)((t-e)*s)/s+e}let Ro=null;const ko=3552713678800501e-30;function Lo(t,e){return function(t,e,s){return t===e||Math.abs(t-e)<=s*(1+(Math.abs(t)+Math.abs(e))/2)}(t,e,ko)}let Go,Vo,zo,Oo,qo,Bo,Yo,Uo,Ho,Xo,jo;function Zo(t){return{_this:t,get(){return this._this},reset(t){this._this=t},release(){const t=this._this;return this._this=null,t}}}let Wo=null;function $o(t){(0,i.g)(Wo);const e=Wo(t);return e.semiMajor=e.isPCS?Number.NaN:function(t){if(Vo&&(0,i.p)("pe has been loaded. no-pe methods should not be used at this point."),"string"==typeof t){const e=t.match(Ko);e&&2===e.length||(0,i.a)("bad gcs wkt");const s=Number.parseFloat(e[1]);return Number.isFinite(s)||(0,i.a)("bad gcs wkt"),s}return Ro||Qo(),Ro.has(t)||(0,i.p)("gcs wkid not found"),Ro.get(t)}(t),e}const Ko=/(?:ELLIPSOID|SPHEROID)\["(?:\w|[-()])+",(\d+\.\d+)/;function Qo(){Ro=new Map;for(const t in _){const e=Number.parseFloat(t),s=_[t];if(Array.isArray(s))for(const t of s)Ro.set(t,e);else Ro.set(s,e)}!function(){for(const t in _)delete _[t]}()}function Jo(t,e){return new sa(t,e)}const ta=(0,a.au)(0),ea=(0,a.au)(1);let sa=class t{constructor(e,s){if(e instanceof t)return this.m_geogTranWrapper=e.m_geogTranWrapper,this.m_bInverted=s?!e.m_bInverted:e.m_bInverted,void(this.m_hashCode=(0,a.at)(this.m_geogTranWrapper.getHashCode(),this.m_bInverted?ea:ta));this.m_geogTranWrapper=new hi(e),this.m_bInverted=s,this.m_hashCode=(0,a.at)(this.m_geogTranWrapper.getHashCode(),this.m_bInverted?ea:ta)}getID(){return this.m_geogTranWrapper.getLatestId()}getLatestID(){return this.m_geogTranWrapper.getLatestId()}getText(){return this.m_geogTranWrapper.getText()}getTextExtended(t){if(!this.m_geogTranWrapper.getGeogtran())return"";if(-1===t)return this.m_geogTranWrapper.getGeogtran().toString();{const e=0===t?zo.PE_STR_AUTH_TOP:zo.PE_STR_AUTH_ALL;return this.m_geogTranWrapper.getGeogtran().toString(e)}}getText2(t=-1){let e=zo.PE_STR_FMT_WKT2;return-1!==t&&(e|=0===t?zo.PE_STR_AUTH_TOP:zo.PE_STR_AUTH_ALL),this.m_geogTranWrapper.getGeogtran().toString(e)}getName(){return this.m_geogTranWrapper&&this.m_geogTranWrapper.getGeogtran()?this.m_geogTranWrapper.getGeogtran().getName():""}getInputSpatialReference(){return this.m_bInverted?this.m_geogTranWrapper.getOutputSr(!1):this.m_geogTranWrapper.getInputSr(!1)}getOutputSpatialReference(){return this.m_bInverted?this.m_geogTranWrapper.getInputSr(!1):this.m_geogTranWrapper.getOutputSr(!1)}getInverse(){return new t(this,!0)}isInverted(){return this.m_bInverted}getHashCode(){return this.m_hashCode}GetPeGeogtran(){return this.m_geogTranWrapper.getGeogtran()}equals(t){const e=t;return e===this||this.m_bInverted===e.m_bInverted&&(this.GetPeGeogtran()===e.GetPeGeogtran()||this.getID()===e.getID()&&!(0===this.getID()&&!this.GetPeGeogtran().isEqual(e.GetPeGeogtran())))}referencesMissingData(){return!!this.m_geogTranWrapper&&!this.m_geogTranWrapper.isUsable()}getWrapper(){return this.m_geogTranWrapper}};function na(t,e,s,n,r){const l=t.getGCS(),h=e.getGCS(),u=l.getPECoordSys(),c=h.getPECoordSys();let m=null;if(!s.isEmpty()){const e=s.clone();if(!e.isEmpty()&&2===t.getCoordinateSystemType()){let s=new o.E({env2D:e});const n=Pr(t,l,null);s=(new Sn).execute(s,n,null),s.queryEnvelope(e)}if(!e.isEmpty()){const t=u.getPrimem().getLongitude(),s=u.getUnit().getUnitFactor();m=new jo(e.xmin,e.ymin,e.xmax,e.ymax,t,s)}}let d=n;d>=(0,a.i)()&&(d=0);const g=[];let p=Yo.PE_GTLIST_OPTS_COMMON;r||(p&=~Yo.PE_GTLIST_OPTS_USABLE);for(let o=0;o<2;o++){g.length=0;const t=d,e=Yo.getGTlist(u,c,2,p,m,t);let s=!1;if(e&&e.length>0)for(let o=0,a=e.length;o<a;o++){const t=ia([e[o]]);if((0,i.g)(t),r&&t.referencesMissingData())s=!0;else if(g.push(t),n>0&&g.length===n)break}if(!s)break;0===d||(d=0)}return m&&m.destroy(),g}function ia(t){(0,i.g)(null!==t);const e=new oa,s=t[0].getSteps();if(s){const n=t[0].getEntries();for(let t=0;t<s;t++){const s=0!==n[t].getDirection(),i=Jo(n[t].getGeogtran(),s);e.add(i)}return e.create()}return null}let ra=class{constructor(t,e,s,n){this.m_bReadOnly=!0,this.m_name="",this.m_fastTrack=-1,this.m_bNameIsSet=!1,this.m_transforms=t,e&&(this.m_name=e,this.m_bNameIsSet=!0),this.m_inputSr=s,this.m_outputSr=n}getType(){return 0}getName(){if(this.m_bNameIsSet)return this.m_name;if(0===this.m_transforms.length)return"";let t="";for(const e of this.m_transforms)t.length>0&&(t+=" + "),e.isInverted()&&(t+="~"),t+=e.getName();return t}count(){return this.m_transforms.length}createInverse(){return this.getInverse()}getHashCode(){let t=1973;for(let e=0;e<this.m_transforms.length;e++)t=(0,a.at)(t,this.m_transforms[e].getHashCode());return t}equals(t){return(0,i.g)(0),!1}referencesMissingData(){if(0===this.m_transforms.length)return!1;for(const t of this.m_transforms)if(t.referencesMissingData())return!0;return!1}isMatchingTransformation(t,e){return(0,i.g)(0),!1}validateTransformation(t,e){return(0,i.g)(0),!1}nameIsSet(){return(0,i.g)(0),!1}getInputSpatialReference(){return this.m_inputSr}getOutputSpatialReference(){return this.m_outputSr}getStep(t){return(t<0||t>this.count())&&(0,i.q)(""),this.m_transforms[t]}getInverse(){const t=new oa;return t.addSteps(this,!0),t.setInputSpatialReference(this.m_outputSr),t.setOutputSpatialReference(this.m_inputSr),t.create()}transform(t,e,s){if(0===this.count())return;let n=this.m_inputSr,i=this.m_outputSr;if(t&&(i=(0,a.c)(n,n=i)),0===this.m_transforms.length)return void ui(n,null,i,null,e,null,s);let o=this.m_fastTrack;if(1===o)return void(0,r.a8)(t,this.m_transforms,(n=>{!function(t,e,s,n,i){const r=t.getVerttran(),o=t.getGeogtran();if(i>0){t.prepareOrThrow();const a=e?zo.PE_TRANSFORM_2_TO_1:zo.PE_TRANSFORM_1_TO_2;r?hr():ur(o,i,s,n,a)}}(n.getWrapper(),t!==n.isInverted(),e,null,s)}));const l=li();-1===o&&l.initFromGcsAndVcs(n,null);const h=li();let u=t?this.m_transforms.length-1:0;const c=t?-1:1;for(let r=0,a=this.m_transforms.length;r<a;r++,u+=c){if(0===r){const i=this.m_transforms[u];ci(n.getPECoordSys(),null,i.getWrapper(),t!==i.isInverted(),e,null,s,h),-1===o&&(l.equals(h)||(o=0)),l.assign(h)}else{const n=this.m_transforms[u-c],i=this.m_transforms[u];mi(l,n.getWrapper(),t!==n.isInverted(),i.getWrapper(),t!==i.isInverted(),e,null,s,h),-1===o&&(l.equals(h)||(o=0)),l.assign(h)}const i=this.m_transforms[u];di(l,i.getWrapper(),t!==i.isInverted(),e,null,s,h),l.assign(h)}const m=this.m_transforms[u-c];(function(t,e,s,n,i,r,o,a){const l=li();l.assign(s?e.m_inputUnitParams:e.m_outputUnitParams),l.processUnitParams(t);let h=null;n&&(h=n.getPECoordSys());const u=li();u.initFromGcsAndVcsPe(h,null),u.processUnitParams(l),l.processUnitParams(u),a>0&&ai(l,u,r,o,a)})(l,m.getWrapper(),t!==m.isInverted(),i,0,e,null,s),-1===o&&(h.initFromGcsAndVcs(i,null),l.equals(h)||(o=0)),this.m_fastTrack=0===o?0:1}};class oa{constructor(){this.m_transforms=[],this.m_inputGCS=null,this.m_outputGCS=null,this.m_name="",this.m_bNameIsSet=!1}getInputSpatialReference(){return null!==this.m_inputGCS?this.m_inputGCS:this.count()>0?this.m_transforms[0].getInputSpatialReference():null}setInputSpatialReference(t){this.m_inputGCS=t?t.getGCS():null}getOutputSpatialReference(){return null!==this.m_outputGCS?this.m_outputGCS:this.count()>0?this.m_transforms.at(-1).getOutputSpatialReference():null}setOutputSpatialReference(t){this.m_outputGCS=t?t.getGCS():null}getName(){if(this.m_bNameIsSet)return this.m_name;if(0===this.m_transforms.length)return"";let t="";for(const e of this.m_transforms)t.length>0&&(t+=" + "),e.isInverted()&&(t+="~"),t+=e.getName();return t}count(){return this.m_transforms.length}getStep(t){return(t<0||t>this.count())&&(0,i.q)(""),this.m_transforms[t]}setStep(t,e){(0,i.g)(0)}add(t){this.m_transforms.push(t)}addSteps(t,e){if(e)for(let s=t.count()-1;s>=0;--s)this.add(t.getStep(s).getInverse());else for(let s=0;s<t.count();++s)this.add(t.getStep(s))}clear(){this.m_transforms=[],this.m_name="",this.m_bNameIsSet=!1,this.m_inputGCS=null,this.m_outputGCS=null}remove(t){(0,i.g)(0)}create(){const t=this.getInputSpatialReference(),e=this.getOutputSpatialReference(),s=new ra(this.m_transforms,this.m_bNameIsSet?this.m_name:null,t,e);return s.m_bReadOnly=!0,this.clear(),s}}const aa=Object.freeze(Object.defineProperty({__proto__:null,SpatialReference:So,SpatialReferencePrecisionDescriptor:Eo,create:io,createFromWKT:ro,createImplFromPe:oo,createLocal:ho,createWithNewPrecision:ao,createWithNewVCS:lo,getGCS:co,getTempName:yo,hasNoPe:so,hasPe:eo,injectNoPe:to,injectPe:function(t){if(Vo)return;!function(t){const e=t;Vo=e.PeFactory,(0,i.g)(Vo),jo=e.PeGCSExtent,(0,i.g)(jo),Ho=e.PeLineType,(0,i.g)(Ho),Xo=e.PeMath,(0,i.g)(Xo),Go=e.PeDouble,(0,i.g)(Go),zo=e.PeDefs,(0,i.g)(zo),Oo=e.PeCSTransformations,(0,i.g)(Oo),qo=e.PeGTTransformations,(0,i.g)(qo),Bo=e.PePCSInfo,(0,i.g)(Bo),Yo=e.PeGTlistExtended,(0,i.g)(Yo),Vo.initialize(),Uo=e.PeGTlistExtendedEntry,(0,i.g)(Uo),zo.PE_TYPE_ANGUNIT=512,zo.PE_STR_AUTH_ALL=2,Bo.PE_POLE_LINE_STRAIGHT=2,Bo.PE_POLE_LINE_CURVED=3,zo.PE_PARM_LAM0=2,zo.PE_PARM_PHI0=6,zo.PE_PRJ_AZIMUTHAL_EQUIDISTANT=43032,zo.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA=43033,zo.PE_PRJ_ALBERS=43007,zo.PE_PRJ_CYLINDRICAL_EQAREA=43034,zo.PE_TYPE_VERTCS=8,zo.PE_LINETYPE_GEODESIC=0,zo.PE_LINETYPE_LOXODROME=1,zo.PE_LINETYPE_GREAT_ELLIPTIC=2,zo.PE_LINETYPE_NORMAL_SECTION=3,Yo.PE_GTLIST_OPTS_USABLE=1,Wo=null}(t);const e=Zr;Zr=null,e.forEach((t=>{const e=t.deref();e&&e.attachToPe()}))},isInitialized:no,isTempName:xo,isValidWkid:mo,isValidWkt:go,makeSpheroidData:Jr,snapGeometry:uo,webMercator:Co,webMercator102100:wo,wgs84:Io},Symbol.toStringTag,{value:"Module"})),la=Object.freeze(Object.defineProperty({__proto__:null,OperatorProject:Sn},Symbol.toStringTag,{value:"Module"})),ha=Object.freeze(Object.defineProperty({__proto__:null,CompositeGeographicTransformation:ra,CompositeGeographicTransformationEditor:oa,createImpl:ia,queryGtListImpl:na},Symbol.toStringTag,{value:"Module"})),ua=Object.freeze(Object.defineProperty({__proto__:null,GeographicTransformation:sa,create:function(t,e){const s=Vo.geogtran(t);return s||(0,i.C)(t),new sa(s,e)},createFromPe:Jo,createFromWKT:function(t,e){const s=Vo.fromString(zo.PE_TYPE_GEOGTRAN,t);return s||(0,i.D)(t),new sa(s,e)}},Symbol.toStringTag,{value:"Module"})),ca=Object.freeze(Object.defineProperty({__proto__:null,ProjectionTransformation:Mr,create:function(t,e,s){return br(t,e,n.Envelope2D.constructEmpty(),s)},createEx:Pr,createFromAoi:br,createImplEx:Sr,makeExtendedParams:Cr,makeExtendedParamsInternal:Ir,queryTransformationList:Er},Symbol.toStringTag,{value:"Module"}))},50256:(t,e,s)=>{s.d(e,{G:()=>n,S:()=>i});class n{*[Symbol.iterator](){let t=this.next();for(;t;)yield t,t=this.next()}}class i extends n{constructor(t){super(),this.m_iGeom=-1,this.m_aGeoms=t?t.slice():[]}next(){if(this.m_iGeom<this.m_aGeoms.length-1){const t=this.m_aGeoms[++this.m_iGeom];return this.m_aGeoms[this.m_iGeom]=null,t}return null}tock(){return!1}getGeometryID(){return this.m_iGeom}getRank(){return 1}}},16984:(t,e,s)=>{s.d(e,{T:()=>c});var n=s(66866),i=s(24793),r=s(21877),o=s(46437),a=s(21564),l=(s(39831),s(539),s(9272),s(28902)),h=s(63863),u=s(55134);let c=class extends(i.A.ClonableMixin(r.A)){constructor(t){super(t),this.unit="milliseconds",this.value=0}toMilliseconds(){return(0,o.t)(this.value,this.unit,"milliseconds")}};(0,n._)([(0,l.e)(u.j,{nonNullable:!0})],c.prototype,"unit",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0},nonNullable:!0})],c.prototype,"value",void 0),c=(0,n._)([(0,h.$)("esri.time.TimeInterval")],c)},33147:(t,e,s)=>{s.d(e,{T:()=>a});var n=s(62188),i=s(86330);class r{constructor(t,e,s){if(t instanceof r)return this.data=t.data,this.N=t.N,this.M=t.M,t.data=null,t.N=0,void(t.M=0);this.data=t,this.N=e,this.M=s}assignCopy(t){return this===t||((0,n.g)(this.N*this.M==t.N*t.M),this.data.set(t.data),this.N=t.N,this.M=t.M),this}setZero(){return this.data?.fill(0),this}setIdentity(){for(let t=0;t<this.N;t++)for(let e=0;e<this.M;e++)this.setRowCol(t,e,t===e?1:0);return this}rows(){return this.N}cols(){return this.M}row(t){return(0,n.g)(0),{}}set(t,e){return this.data[t]=e,this}setRowCol(t,e,s){return this.data[t*this.M+e]=s,this}at(t){return this.data[t]}atRowCol(t,e){return this.data[t*this.M+e]}mulScalar(t,e){(0,n.g)(0)}mul(t,e){if((0,n.g)(this.M===t.rows()),(0,n.g)(this.N===e.rows()),(0,n.g)(t.cols()===e.cols()),e===this){const s=new Float64Array(this.N*this.M),n=new r(s,this.N,this.M);return this.mul(t,n),void e.assignCopy(n)}if(e===t){const s=new Float64Array(t.N*t.M),n=new r(s,t.N,t.M);return this.mul(t,n),void e.assignCopy(n)}const s=t.cols();for(let n=0;n<this.N;n++)for(let i=0;i<s;i++){let s=0;for(let e=0;e<this.M;e++)s+=this.atRowCol(n,e)*t.atRowCol(e,i);e.setRowCol(n,i,s)}}mulTranspose(t,e){if((0,n.g)(this.M===t.cols()),(0,n.g)(this.N===e.rows()),(0,n.g)(t.rows()===e.cols()),e===this){const s=new Float64Array(this.N*this.M),n=new r(s,this.N,this.M);return this.mulTranspose(t,n),void e.assignCopy(n)}if(e===t){const s=new Float64Array(t.N*t.M),n=new r(s,t.N,t.M);return this.mulTranspose(t,n),void e.assignCopy(n)}const s=t.rows();for(let n=0;n<this.N;n++)for(let i=0;i<s;i++){let s=0;for(let e=0;e<this.M;e++)s+=this.atRowCol(n,e)*t.atRowCol(i,e);e.setRowCol(n,i,s)}}mulLeft(t,e){(0,n.g)(0)}mulLeftTranspose(t,e){(0,n.g)(0)}mulDiag(t,e){if((0,n.g)(this.M===t.N*t.M),(0,n.g)(this.N===e.rows()),(0,n.g)(this.M===e.cols()),e===this){const s=new Float64Array(this.N*this.M),n=new r(s,this.N,this.M);return this.mulDiag(t,n),void e.assignCopy(n)}const s=this.M;for(let n=0;n<this.N;n++)for(let i=0;i<s;i++)e.setRowCol(n,i,this.atRowCol(n,i)*t.at(i))}transposeInPlace(){if(this.N===this.M){for(let t=0;t<this.N;t++)for(let e=t+1;e<this.M;e++){const s=this.atRowCol(t,e);this.setRowCol(t,e,this.atRowCol(e,t)),this.setRowCol(e,t,s)}return this}const t=new Float64Array(this.N*this.M),e=new r(t,this.N,this.M);return e.assignCopy(this),this.M=(0,i.c)(this.N,this.N=this.M),e.transpose(this),this}transpose(t){if(this!==t){r.checkDims(t,this.M,this.N);for(let e=0;e<this.N;e++)for(let s=0;s<this.M;s++)t.setRowCol(s,e,this.atRowCol(e,s))}else t.transposeInPlace()}add(t,e){}svd(t,e,s,i=!1){if(r.checkDims(t,this.N,this.M),r.checkDims(e,this.M,1),r.checkDims(s,this.M,this.M),i){if((0,n.g)(this.N===this.M),!this.symmetricEigen(e,s))return!1;for(let t=0;t<this.M;++t)e.at(t)<0&&e.set(t,0);return t.assignCopy(s),!0}let o,a,l,h,u,c,m,d=0,g=0,p=0,_=0,f=0;const y=this.M,x=this.N;t.assignCopy(this);const v=new Float64Array(y),b=new r(v,y,1),P=(t,e)=>e>=0?Math.abs(t):-Math.abs(t),S=(t,e)=>{if((t=Math.abs(t))>(e=Math.abs(e))){const s=e/t;return t*Math.sqrt(s*s+1)}if(e>0){const s=t/e;return e*Math.sqrt(s*s+1)}return 0};for(let n=0;n<y;n++){if(d=n+1,b.set(n,_*p),p=h=_=0,n<x){for(let e=n;e<x;e++)_+=Math.abs(t.atRowCol(e,n));if(_){for(let e=n;e<x;e++)t.setRowCol(e,n,t.atRowCol(e,n)/_),h+=t.atRowCol(e,n)*t.atRowCol(e,n);a=t.atRowCol(n,n),p=-P(Math.sqrt(h),a),l=a*p-h,t.setRowCol(n,n,a-p);for(let e=d;e<y;e++){h=0;for(let s=n;s<x;s++)h+=t.atRowCol(s,n)*t.atRowCol(s,e);a=h/l;for(let s=n;s<x;s++)t.setRowCol(s,e,t.atRowCol(s,e)+a*t.atRowCol(s,n))}for(let e=n;e<x;e++)t.setRowCol(e,n,t.atRowCol(e,n)*_)}}if(e.set(n,_*p),p=h=_=0,n<x&&n!==y-1){for(let e=d;e<y;e++)_+=Math.abs(t.atRowCol(n,e));if(_){for(let e=d;e<y;e++)t.setRowCol(n,e,t.atRowCol(n,e)/_),h+=t.atRowCol(n,e)*t.atRowCol(n,e);a=t.atRowCol(n,d),p=-P(Math.sqrt(h),a),l=a*p-h,t.setRowCol(n,d,a-p);for(let e=d;e<y;e++)b.set(e,t.atRowCol(n,e)/l);for(let e=d;e<x;e++){h=0;for(let s=d;s<y;s++)h+=t.atRowCol(e,s)*t.atRowCol(n,s);for(let s=d;s<y;s++)t.setRowCol(e,s,t.atRowCol(e,s)+h*b.at(s))}for(let e=d;e<y;e++)t.setRowCol(n,e,t.atRowCol(n,e)*_)}}const s=Math.abs(e.at(n))+Math.abs(b.at(n));f=s>f?s:f}for(let n=y-1;n>=0;n--){if(n<y-1){if(p){for(let e=d;e<y;e++)s.setRowCol(e,n,t.atRowCol(n,e)/t.atRowCol(n,d)/p);for(let e=d;e<y;e++){h=0;for(let i=d;i<y;i++)h+=t.atRowCol(n,i)*s.atRowCol(i,e);for(let t=d;t<y;t++)s.setRowCol(t,e,s.atRowCol(t,e)+h*s.atRowCol(t,n))}}for(let t=d;t<y;t++)s.setRowCol(n,t,0),s.setRowCol(t,n,0)}s.setRowCol(n,n,1),p=b.at(n),d=n}for(let n=(x<y?x:y)-1;n>=0;n--){d=n+1,p=e.at(n);for(let e=d;e<y;e++)t.setRowCol(n,e,0);if(p){p=1/p;for(let e=d;e<y;e++){h=0;for(let s=d;s<x;s++)h+=t.atRowCol(s,n)*t.atRowCol(s,e);a=h/t.atRowCol(n,n)*p;for(let s=n;s<x;s++)t.setRowCol(s,e,t.atRowCol(s,e)+a*t.atRowCol(s,n))}for(let e=n;e<x;e++)t.setRowCol(e,n,t.atRowCol(e,n)*p)}else for(let e=n;e<x;e++)t.setRowCol(e,n,0);t.setRowCol(n,n,t.atRowCol(n,n)+1)}for(let n=y-1;n>=0;n--)for(let i=1;;i++){let r=1;for(d=n;d>=0;d--){if(g=d-1,Math.abs(b.at(d))+f===f){r=0;break}if(Math.abs(e.at(g))+f===f)break}if(r){o=0,h=1;for(let s=d;s<=n&&(a=h*b.at(s),b.set(s,b.at(s)*o),Math.abs(a)+f!==f);s++){p=e.at(s),l=S(a,p),e.set(s,l),l=1/l,o=p*l,h=-a*l;for(let e=0;e<x;e++)c=t.atRowCol(e,g),m=t.atRowCol(e,s),t.setRowCol(e,g,c*o+m*h),t.setRowCol(e,s,m*o-c*h)}}if(m=e.at(n),d===n){if(m<0){e.set(n,-m);for(let t=0;t<y;t++)s.setRowCol(t,n,-s.atRowCol(t,n))}break}if(100===i)return!1;u=e.at(d),g=n-1,c=e.at(g),p=b.at(g),l=b.at(n),a=((c-m)*(c+m)+(p-l)*(p+l))/(2*l*c),p=S(a,1),a=((u-m)*(u+m)+l*(c/(a+P(p,a))-l))/u,o=h=1;for(let n=d;n<=g;n++){const i=n+1;p=b.at(i),c=e.at(i),l=h*p,p*=o,m=S(a,l),b.set(n,m),o=a/m,h=l/m,a=u*o+p*h,p=p*o-u*h,l=c*h,c*=o;for(let t=0;t<y;t++)u=s.atRowCol(t,n),m=s.atRowCol(t,i),s.setRowCol(t,n,u*o+m*h),s.setRowCol(t,i,m*o-u*h);m=S(a,l),e.set(n,m),m&&(m=1/m,o=a*m,h=l*m),a=o*p+h*c,u=o*c-h*p;for(let e=0;e<x;e++)c=t.atRowCol(e,n),m=t.atRowCol(e,i),t.setRowCol(e,n,c*o+m*h),t.setRowCol(e,i,m*o-c*h)}b.set(d,0),b.set(n,a),e.set(n,u)}const E=new Float64Array(this.N),C=new Float64Array(this.M),w=new r(E,this.N,1),I=new r(C,this.M,1);let T=1;do{T*=3,T++}while(T<=this.M);do{T/=3,T=Math.trunc(T);for(let n=T;n<this.M;n++){const i=e.at(n);for(let e=0;e<this.N;e++)w.set(e,t.atRowCol(e,n));for(let t=0;t<this.M;t++)I.set(t,s.atRowCol(t,n));let r=n;for(;e.at(r-T)<i;){e.set(r,e.at(r-T));for(let e=0;e<this.N;e++)t.setRowCol(e,r,t.atRowCol(e,r-T));for(let t=0;t<this.M;t++)s.setRowCol(t,r,s.atRowCol(t,r-T));if(r-=T,r<T)break}e.set(r,i);for(let e=0;e<this.N;e++)t.setRowCol(e,r,w.at(e));for(let t=0;t<this.M;t++)s.setRowCol(t,r,I.at(t))}}while(T>1);for(let n=0;n<this.M;n++){let e=0;for(let s=0;s<this.N;s++)t.atRowCol(s,n)<0&&e++;for(let t=0;t<this.M;t++)s.atRowCol(t,n)<0&&e++;if(e>Math.trunc((this.N+this.M)/2)){for(let e=0;e<this.N;e++)t.setRowCol(e,n,-t.atRowCol(e,n));for(let t=0;t<this.M;t++)s.setRowCol(t,n,-s.atRowCol(t,n))}}return!0}isSymmetric(){if(this.N!==this.M)return!1;for(let t=0;t<this.N;t++)for(let e=t+1;e<this.M;e++)if(this.atRowCol(t,e)!==this.atRowCol(e,t))return!1;return!0}isZero(){return(0,n.g)(0),!1}isIdentity(){return(0,n.g)(0),!1}equals(t,e){if(void 0!==e&&(0,n.g)(0),this.N!==t.N||this.M!==t.M)return!1;for(let s=0;s<this.N*this.M;s++)if(this.data[s]!==t.data[s])return!1;return!0}maxElement(){return(0,n.g)(0),0}minElement(){return(0,n.g)(0),0}determinant(){if((0,n.g)(this.N===this.M),1===this.N)return this.data[0];if(2===this.N)return this.data[0]*this.data[3]-this.data[1]*this.data[2];if(3===this.N){const t=this;return t.atRowCol(0,0)*(t.atRowCol(1,1)*t.atRowCol(2,2)-t.atRowCol(1,2)*t.atRowCol(2,1))-t.atRowCol(0,1)*(t.atRowCol(1,0)*t.atRowCol(2,2)-t.atRowCol(2,0)*t.atRowCol(1,2))+t.atRowCol(0,2)*(t.atRowCol(1,0)*t.atRowCol(2,1)-t.atRowCol(1,1)*t.atRowCol(2,0))}const t=new Float64Array(this.N*this.N),e=new r(t,this.N,this.N),s=new Float64Array(this.N);if(!this.luDecomposition(e,s))return 0;let i=1;for(let n=0;n<this.N;n++)i*=e.atRowCol(n,n),s[n]!==n&&(i=-i);return i}submatrix(t,e,s){(0,n.g)(0)}inverse(t){(0,n.g)(0)}pseudoInverse(t,e=!1,s=2220446049250313e-31){if(t.setZero(),1===this.N&&1===this.M)return 0!==this.atRowCol(0,0)?t.setRowCol(0,0,1/this.atRowCol(0,0)):t.setRowCol(0,0,0),!0;if(2===this.N&&2===this.M){const e=this.atRowCol(0,0)*this.atRowCol(1,1)-this.atRowCol(0,1)*this.atRowCol(1,0),s=1e-5*(Math.abs(this.atRowCol(0,0)*this.atRowCol(1,1))+Math.abs(this.atRowCol(0,1)*this.atRowCol(1,0)));if(Math.abs(e)>s)return t.setRowCol(0,0,this.atRowCol(1,1)/e),t.setRowCol(0,1,-this.atRowCol(0,1)/e),t.setRowCol(1,0,-this.atRowCol(1,0)/e),t.setRowCol(1,1,this.atRowCol(0,0)/e),!0}const n=new Float64Array(this.N*this.M),i=new r(n,this.N,this.M),o=new Float64Array(this.M),a=new r(o,this.M,1),l=new Float64Array(this.M*this.M),h=new r(l,this.M,this.M);if(!this.svd(i,a,h,e))return!1;const u=Math.max(this.N,this.M),c=s*Math.abs(a.at(0))*u;for(let r=0;r<this.M;r++)a.at(r)>c?a.set(r,1/a.at(r)):a.set(r,0);return h.mulDiag(a,t),t.mulTranspose(i,t),!0}luDecomposition(t,e){return(0,n.g)(0),!1}symmetricEigen(t,e){(0,n.g)(this.rows()===this.cols()),(0,n.g)(this.rows()===t.rows()),(0,n.g)(e.rows()===e.cols()&&e.rows()===this.rows()),(0,n.g)(this.isSymmetric());const s=new Float64Array(this.N*this.M),i=new r(s,this.N,this.M);i.assignCopy(this);const o=100/Number.EPSILON,a=this.rows(),l=new Float64Array(a),h=new Float64Array(a),u=new r(l,a,1),c=new r(h,a,1);for(let n=0;n<a;n++)u.set(n,i.atRowCol(n,n)),t.set(n,i.atRowCol(n,n)),c.set(n,0);e.setIdentity();const m=()=>{const s=u;e.transposeInPlace();let n=1;do{n*=3,n++}while(n<=a);do{n/=3,n=Math.trunc(n);for(let i=n;i<a;i++){const r=t.at(i),o=Math.abs(r);for(let t=0;t<this.M;t++)s.set(t,e.atRowCol(t,i));let a=i;for(;Math.abs(t.at(a-n))<o;){t.set(a,t.at(a-n));for(let t=0;t<this.M;t++)e.setRowCol(t,a,e.atRowCol(t,a-n));if(a-=n,a<n)break}if(a!==i){t.set(a,r);for(let t=0;t<this.M;t++)e.setRowCol(t,a,s.at(t))}}}while(n>1)};for(let n=1;;n++){let s=0;for(let t=1;t<a;t++)for(let e=0;e<t;e++)s+=Math.abs(i.atRowCol(t,e));if(0===s)return m(),!0;const r=n<4?.2*s/(a*a):0;for(let l=0;l<a;l++)for(let s=l+1;s<a;s++){let h=o*Math.abs(i.atRowCol(s,l));if(n>4&&h<=Math.abs(t.at(l))&&h<=Math.abs(t.at(s)))i.setRowCol(s,l,0);else if(Math.abs(i.atRowCol(s,l))>r){let n,r=t.at(s)-t.at(l);if(h<Math.abs(r))n=i.atRowCol(s,l)/r;else{const t=.5*r/i.atRowCol(s,l);n=1/(Math.abs(t)+Math.sqrt(1+t*t)),t<0&&(n=-n)}const o=1/Math.sqrt(1+n*n),u=n*o,m=u/(1+o);r=n*i.atRowCol(s,l),c.set(l,c.at(l)-r),c.set(s,c.at(s)+r),t.set(l,t.at(l)-r),t.set(s,t.at(s)+r),i.setRowCol(s,l,0);let d=0;for(;d<l;d++)h=i.atRowCol(l,d),r=i.atRowCol(s,d),i.setRowCol(l,d,h-u*(r+h*m)),i.setRowCol(s,d,r+u*(h-r*m));for(d++;d<s;d++)h=i.atRowCol(d,l),r=i.atRowCol(s,d),i.setRowCol(d,l,h-u*(r+h*m)),i.setRowCol(s,d,r+u*(h-r*m));for(d++;d<a;d++)h=i.atRowCol(d,l),r=i.atRowCol(d,s),i.setRowCol(d,l,h-u*(r+h*m)),i.setRowCol(d,s,r+u*(h-r*m));for(d=0;d<a;d++)h=e.atRowCol(l,d),r=e.atRowCol(s,d),e.setRowCol(l,d,h-u*(r+h*m)),e.setRowCol(s,d,r+u*(h-r*m))}}for(let e=0;e<a;e++)u.set(e,u.at(e)+c.at(e)),t.set(e,u.at(e)),c.set(e,0)}}static checkDims(t,e,s){(0,n.g)(t.rows()===e&&t.cols()===s)}}class o extends r{constructor(t){if(t.copy){const e=new Float64Array(t.copy.N*t.copy.M);return super(e,t.copy.N,t.copy.M),this.buffer=e,void this.assignCopy(t.copy)}const e=new Float64Array(t.NN*t.MM);super(e,t.NN,t.MM),this.buffer=e,t.initializerList&&(0,i.b)(this.buffer,t.initializerList,0,0,t.initializerList.length)}assignCopy(t){return this===t||super.assignCopy(t),this}}class a{constructor(t){this.m_TransformationType=1,void 0===t?this.setIdentity():t instanceof a?this.set(t):this.setScale(t)}set(t){return this.xx=t.xx,this.xy=t.xy,this.xd=t.xd,this.yx=t.yx,this.yy=t.yy,this.yd=t.yd,this}clone(){return(new a).set(this)}setZero(){this.xx=0,this.yy=0,this.xy=0,this.yx=0,this.xd=0,this.yd=0}isEqual(t){return this===t||this.xx===t.xx&&this.xy===t.xy&&this.xd===t.xd&&this.yx===t.yx&&this.yy===t.yy&&this.yd===t.yd}transformInPlace(t){const e=this.xx*t.x+this.xy*t.y+this.xd,s=this.yx*t.x+this.yy*t.y+this.yd;t.x=e,t.y=s}transform(t){const e=t.clone();return this.transformInPlace(e),e}queryTransform(t,e){const s=this.xx*t.x+this.xy*t.y+this.xd,n=this.yx*t.x+this.yy*t.y+this.yd;e.setCoords(s,n)}transformEnvInPlace(t){if(t.isEmpty())return;const e=(0,i.m)(i.P,4);t.queryCorners(e),this.transformPoints2D(e,4,e),t.setFromPoints(e,4)}queryTransformEnv(t,e){(0,n.g)(0)}transformPoints2D(t,e,s){for(let n=0;n<e;++n)this.queryTransform(t[n],s[n])}transformInterleavedPoints(t,e,s){e*=2;const n=i.P.getNAN();for(let i=0;i<e;i+=2)n.x=t[i],n.y=t[i+1],this.transformInPlace(n),s[i]=n.x,s[i+1]=n.y}multiply(t){return a.st_multiply(this,t,this),this}mulLeft(t){return(0,n.g)(0),this}static st_multiply(t,e,s){const n=t.xx*e.xx+t.yx*e.xy,i=t.xy*e.xx+t.yy*e.xy,r=t.xd*e.xx+t.yd*e.xy+e.xd,o=t.xx*e.yx+t.yx*e.yy,a=t.xy*e.yx+t.yy*e.yy,l=t.xd*e.yx+t.yd*e.yy+e.yd;s.xx=n,s.xy=i,s.xd=r,s.yx=o,s.yy=a,s.yd=l}getCoefficients(t){(0,n.g)(t.length>=6),t[0]=this.xx,t[1]=this.xy,t[2]=this.xd,t[3]=this.yx,t[4]=this.yy,t[5]=this.yd}setCoefficients(t){(0,n.g)(t.length>=6),this.xx=t[0],this.xy=t[1],this.xd=t[2],this.yx=t[3],this.yy=t[4],this.yd=t[5]}copyTo(t){(0,n.g)(0)}initializeFromRect(t,e){t.isEmpty()||e.isEmpty()||!t.width()||!t.height()?this.setZero():(this.xy=this.yx=0,this.xx=e.width()/t.width(),this.yy=e.height()/t.height(),this.xd=e.xmin-t.xmin*this.xx,this.yd=e.ymin-t.ymin*this.yy)}initializeFromRectIsotropic(t,e){if(t.isEmpty()||!t.width()||!t.height()||e.isEmpty())this.setZero();else{this.yx=0,this.xy=0,this.xx=e.width()/t.width(),this.yy=e.height()/t.height(),this.xx>this.yy?this.xx=this.yy:this.yy=this.xx;const s=e.getCenter(),n=t.getCenter();this.xd=s.x-n.x*this.xx,this.yd=s.y-n.y*this.yy}}initializeFromTwoPointsArray(t,e){if(t[0].equals(e[0])&&t[1].equals(e[1]))return void this.setIdentity();if(t[0].equals(t[1])){if(e[0].equals(e[1]))return void this.setShift(e[0].sub(t[0]));(0,n.a)("")}if(!t[0].equals(t[1])&&e[0].equals(e[1]))return this.setZero(),void this.shift(e[0]);this.setShiftCoords(-t[0].x,-t[0].y);const s=i.P.distance(t[0],t[1]),r=i.P.distance(e[0],e[1]),o=r/s;this.scale(o,o);const a=t[1].sub(t[0]);a.divThis(s);const l=e[1].sub(e[0]);l.divThis(r);const h=a.crossProduct(l),u=a.dotProduct(l);this.rotate(u,h),this.shiftCoords(e[0].x,e[0].y)}initializeFromTwoPoints(t,e,s,n){const i=[t,e],r=[s,n];this.initializeFromTwoPointsArray(i,r)}transformSizeInPlace(t){(0,n.g)(0)}transformSize(t,e){(0,n.g)(0)}transformTol(t){return(0,n.g)(0),0}transformWithoutTranslateArray(t,e,s){for(let n=0;n<e;++n)this.transformWithoutTranslate(t[n],s[n])}transformWithoutTranslateInPlace(t){const e=this.xx*t.x+this.xy*t.y,s=this.yx*t.x+this.yy*t.y;t.setCoords(e,s)}transformWithoutTranslate(t,e){const s=this.xx*t.x+this.xy*t.y,n=this.yx*t.x+this.yy*t.y;e.setCoords(s,n)}setIdentity(){this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=1,this.yd=0}isIdentity(){return!(1!==this.xx||1!==this.yy||this.xy||this.xd||this.yx||this.yd)}isIdentityTol(t){const e=t*t;return!((0,i.a)(this.xd)+(0,i.a)(this.yd)>e||(0,i.a)(this.xy+this.xd)+(0,i.a)(this.yy+this.yd-1)>e||(0,i.a)(this.xx+this.xd-1)+(0,i.a)(this.yx+this.yd)>e)}isReflective(){return this.xx*this.yy-this.yx*this.xy<0}isUniform(t){const e=this.xx*this.xx+this.yx*this.yx,s=this.xy*this.xy+this.yy*this.yy,n=(e+s)*t;return Math.abs(e-s)<=n&&Math.abs(this.xx*this.xy+this.yx*this.yy)<=n}isUniformNoRotation(){return 0!==this.xx&&Math.abs(this.xx)===Math.abs(this.yy)&&0===this.xy&&0===this.yx}isTranslate(){return 1===this.xx&&1===this.yy&&!this.xy&&!this.yx}isTranslateTol(t){const e=new i.P;return e.setCoords(0,1),this.transformWithoutTranslateInPlace(e),e.y-=1,!(e.sqrLength()>t*t)&&(e.setCoords(1,0),this.transformWithoutTranslateInPlace(e),e.x-=1,e.sqrLength()<=t*t)}isOrthonormal(t){const e=new a;return e.xx=this.xx*this.xx+this.xy*this.xy,e.xy=this.xx*this.yx+this.xy*this.yy,e.yx=this.yx*this.xx+this.yy*this.xy,e.yy=this.yx*this.yx+this.yy*this.yy,e.xd=0,e.yd=0,e.isIdentityTol(t)}isDegenerate(t){return Math.abs(this.xx*this.yy-this.yx*this.xy)<=2*t*(Math.abs(this.xx*this.yy)+Math.abs(this.yx*this.xy))}isZero(){return 0===this.xx&&0===this.yy&&0===this.xy&&0===this.yx&&0===this.xd&&0===this.yd}isScaleAndTranslateTol(t){return this.xy*this.xy+this.yx*this.yx<=(this.xx*this.xx+this.yy*this.yy)*t}setTranslate(t,e){return this.xx=1,this.xy=0,this.xd=t,this.yx=0,this.yy=1,this.yd=e,this}setShiftCoords(t,e){return this.xx=1,this.xy=0,this.xd=t,this.yx=0,this.yy=1,this.yd=e,this}setShift(t){return this.xx=1,this.xy=0,this.xd=t.x,this.yx=0,this.yy=1,this.yd=t.y,this}setScaleCoords(t,e){return this.xx=t,this.xy=0,this.xd=0,this.yx=0,this.yy=e,this.yd=0,this}setScale(t){return this.setScaleCoords(t,t),this}setFlipX(t,e){return this.xx=-1,this.xy=0,this.xd=t+e,this.yx=0,this.yy=1,this.yd=0,this}setFlipY(t,e){return this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=-1,this.yd=t+e,this}setShear(t,e){return this.xx=1,this.xy=t,this.xd=0,this.yx=e,this.yy=1,this.yd=0,this}scale(t,e){return this.xx*=t,this.xy*=t,this.xd*=t,this.yx*=e,this.yy*=e,this.yd*=e,this}setRotateAngle(t){return this.setRotate(Math.cos(t),Math.sin(t))}setRotate(t,e){return this.xx=t,this.xy=-e,this.xd=0,this.yx=e,this.yy=t,this.yd=0,this}setRotateAngleAbout(t,e){return this.setRotateAbout(Math.cos(t),Math.sin(t),e)}setRotateAbout(t,e,s){return this.setTranslate(-s.x,-s.y),this.rotate(t,e),this.translate(s.x,s.y)}setSwapCoordinates(){return this.xx=0,this.xy=1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}setRotateCw90(){return this.xx=0,this.xy=1,this.xd=0,this.yx=-1,this.yy=0,this.yd=0,this}setRotateCcw90(){return this.xx=0,this.xy=-1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}shiftCoords(t,e){return this.xd+=t,this.yd+=e,this}shift(t){return this.xd+=t.x,this.yd+=t.y,this}translate(t,e){return this.xd+=t,this.yd+=e,this}flipX(t,e){return this.xx=-this.xx,this.xy=-this.xy,this.xd=t+e-this.xd,this}flipY(t,e){return this.yx=-this.yx,this.yy=-this.yy,this.yd=t+e-this.yd,this}shear(t,e){const s=new a;return s.setShear(t,e),this.multiply(s)}rotateAngle(t){const e=new a;return e.setRotateAngle(t),this.multiply(e)}rotate(t,e){const s=new a;return s.setRotate(t,e),this.multiply(s)}rotateAbout(t,e,s){return this.translate(-s.x,-s.y),this.rotate(t,e),this.translate(s.x,s.y)}rotateAngleAbout(t,e){return this.rotateAbout(Math.cos(t),Math.sin(t),e)}setInvert(t){return this.set(t),this.invertThis()}invertThis(){let t=this.xx*this.yy-this.xy*this.yx;if(0===t)return this.setZero(),this;t=1/t;const e=(this.xy*this.yd-this.xd*this.yy)*t,s=(this.xd*this.yx-this.xx*this.yd)*t,n=this.yy*t,i=-this.xy*t,r=-this.yx*t,o=this.xx*t;return this.xd=e,this.yd=s,this.xx=n,this.yy=o,this.xy=i,this.yx=r,this}invertPrecise(t){return this.set(t),this.invertPreciseThis()}invertPreciseThis(){const t=i.M.constructDouble(this.xy),e=i.M.constructDouble(this.xx),s=e.mulDouble(this.yy).sub(t.mulDouble(this.yx));if(s.isZero())return this.setZero(),this;const n=s.clone();n.invertThis();const r=i.M.constructDouble(this.xd),o=t.mulDouble(this.yd).sub(r.mulDouble(this.yy)).mul(n).toDouble(),a=r.mulDouble(this.yx).sub(e.mulDouble(this.yd)).mul(n).toDouble(),l=n.mulDouble(this.yy).toDouble(),h=n.mulDouble(-this.xy).toDouble(),u=n.mulDouble(-this.yx).toDouble(),c=n.mulDouble(this.xx).toDouble();return this.xd=o,this.yd=a,this.xx=l,this.yy=c,this.xy=h,this.yx=u,this}extractScaleTransform(t,e){const s=Math.sqrt(this.xx*this.xx+this.xy*this.xy),n=Math.sqrt(this.yx*this.yx+this.yy*this.yy);e.setScaleCoords(1/s,1/n),e.multiply(this),t.setScaleCoords(s,n)}setFromTwoTriangles(t,e){let s=!0;for(let i=0;i<3;++i)s=s&&t[i].equals(e[i]);if(s)return this.setIdentity(),!0;const n=new i.P;n.setSub(t[0],t[1]);const r=new i.P;r.setSub(t[0],t[2]);const o=new i.P;o.setSub(e[0],e[1]);const a=new i.P;a.setSub(e[0],e[2]);const l=4*Number.EPSILON*(Math.abs(n.x*r.y)+Math.abs(r.x*n.y));let h=n.x*r.y-n.y*r.x;return Math.abs(h)>l?(h=1/h,this.xx=(o.x*r.y-n.y*a.x)*h,this.xy=(n.x*a.x-o.x*r.x)*h,this.yx=(o.y*r.y-n.y*a.y)*h,this.yy=(n.x*a.y-o.y*r.x)*h,this.xd=e[0].x-(this.xx*t[0].x+this.xy*t[0].y),this.yd=e[0].y-(this.yx*t[0].x+this.yy*t[0].y),!0):(this.setZero(),!1)}initializeFromControlPoints(t,e,s,r,u=null){return 0===e?(this.setIdentity(),void(u&&u.setIdentity())):1===e?(this.setShift(r[0].sub(s[0])),void(u&&u.setShift(s[0].sub(r[0])))):(e<3&&(t=1),void(4===t&&e>2?function(t,e,s,r,a){const l=i.P.average(s,e),u=i.P.average(r,e),c=new o({NN:2,MM:2});c.setZero();const m=new o({NN:2,MM:2});m.setZero();for(let n=0;n<e;++n)c.setRowCol(0,0,c.atRowCol(0,0)+(s[n].x-l.x)*(s[n].x-l.x)),c.setRowCol(0,1,c.atRowCol(0,1)+(s[n].x-l.x)*(s[n].y-l.y)),c.setRowCol(1,1,c.atRowCol(1,1)+(s[n].y-l.y)*(s[n].y-l.y)),m.setRowCol(0,0,m.atRowCol(0,0)+(r[n].x-u.x)*(s[n].x-l.x)),m.setRowCol(0,1,m.atRowCol(0,1)+(r[n].x-u.x)*(s[n].y-l.y)),m.setRowCol(1,0,m.atRowCol(1,0)+(r[n].y-u.y)*(s[n].x-l.x)),m.setRowCol(1,1,m.atRowCol(1,1)+(r[n].y-u.y)*(s[n].y-l.y));c.setRowCol(1,0,c.atRowCol(0,1));const d=new o({NN:2,MM:2});c.pseudoInverse(d,!0)||(0,n.b)("Failed to compute pseudo inverse"),m.mul(d,m),h(t,m);const g=l.clone();t.transformInPlace(g),t.xd=u.x-g.x,t.yd=u.y-g.y,a&&(m.pseudoInverse(d,!1)||(0,n.b)("Failed to compute pseudo inverse"),h(a,d),a.transformInPlace(u),a.xd=l.x-u.x,a.yd=l.y-u.y)}(this,e,s,r,u):function(t,e,s,r,u,c){(0,n.g)(1===t||0===t||2===t||3===t),e.setIdentity();const m=i.P.average(r,s),d=i.P.average(u,s);if((0,n.g)(t<l.length&&t>0),8&l[t]){const i=new o({NN:2,MM:2});i.setZero();for(let t=0;t<s;++t)i.setRowCol(0,0,i.atRowCol(0,0)+(u[t].x-d.x)*(r[t].x-m.x)),i.setRowCol(1,0,i.atRowCol(1,0)+(u[t].x-d.x)*(r[t].y-m.y)),i.setRowCol(0,1,i.atRowCol(0,1)+(u[t].y-d.y)*(r[t].x-m.x)),i.setRowCol(1,1,i.atRowCol(1,1)+(u[t].y-d.y)*(r[t].y-m.y));const c=new o({NN:2,MM:2}),g=new o({NN:2,MM:1}),p=new o({NN:2,MM:2});i.svd(c,g,p)||(0,n.b)("Failed to compute svd");const _=new o({NN:2,MM:2});c.transpose(_);const f=new o({NN:2,MM:2});p.mul(_,f),32&l[t]||f.determinant()<0&&(_.setRowCol(1,0,-_.atRowCol(1,0)),_.setRowCol(1,1,-_.atRowCol(1,1)),p.mul(_,f));const y=new a;h(y,f),e.set(y)}if(2&l[t]){let t=0,n=0;for(let i=0;i<s;++i){const s=r[i].sub(m);t+=s.sqrLength(),e.transformInPlace(s),n+=s.dotProduct(u[i].sub(d))}if(0===t)0===n?e.setIdentity():e.setZero();else{const s=n/t;e.scale(s,s)}}else(0,n.g)(!(4&l[t]));const g=m.clone();e.transformInPlace(g),e.xd=d.x-g.x,e.yd=d.y-g.y,c&&(c.set(e),c.invertThis(),c.isZero()&&(c.xd=m.x,c.yd=m.y))}(t,this,e,s,r,u)))}calculateErrors(t,e,s,r){(0,n.g)(t>0&&null!==e&&null!==s);let o=0;for(let n=0;n<t;++n){const t=this.transform(e[n]),a=i.P.sqrDistance(s[n],t);o+=a,r&&(r[n]=Math.sqrt(a))}return Math.sqrt(o/t)}}const l=[43,11,41,9,61];function h(t,e){(0,n.g)(!(2!==e.rows()&&3!==e.rows()||2!==e.cols()&&3!==e.rows())),t.xx=e.atRowCol(0,0),t.xy=e.atRowCol(0,1),t.yx=e.atRowCol(1,0),t.yy=e.atRowCol(1,1),3===e.cols()?(t.xd=e.atRowCol(0,2),t.yd=e.atRowCol(1,2)):(t.xd=0,t.yd=0)}},42784:(t,e,s)=>{s.d(e,{c:()=>n,g:()=>i});var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}},16528:(t,e,s)=>{function n(t,e,s){s=s||2;var n,r,a,l,h,u,m,d=e&&e.length,g=d?e[0]*s:t.length,p=i(t,0,g,s,!0),_=[];if(!p||p.next===p.prev)return _;if(d&&(p=c(t,e,p,s)),t.length>80*s){n=a=t[0],r=l=t[1];for(var f=s;f<g;f+=s)(h=t[f])<n&&(n=h),(u=t[f+1])<r&&(r=u),h>a&&(a=h),u>l&&(l=u);m=0!==(m=Math.max(a-n,l-r))?1/m:0}return o(p,_,s,n,r,m),_}function i(t,e,s,n,i){var r,o;if(i===D(t,e,s,n)>0)for(r=e;r<s;r+=n)o=T(r,t[r],t[r+1],o);else for(r=s-n;r>=e;r-=n)o=T(r,t[r],t[r+1],o);if(o&&P(o,o.next)){var a=o.next;A(o),o=a}return o}function r(t,e){if(!t)return t;e||(e=t);var s,n=t;do{if(s=!1,n.steiner||!P(n,n.next)&&0!==b(n.prev,n,n.next))n=n.next;else{var i=n.prev;if(A(n),(n=e=i)===n.next)break;s=!0}}while(s||n!==e);return e}function o(t,e,s,n,i,c,m){if(t){!m&&c&&_(t,n,i,c);for(var d,g,p=t;t.prev!==t.next;)if(d=t.prev,g=t.next,c?l(t,n,i,c):a(t))e.push(d.i/s),e.push(t.i/s),e.push(g.i/s),A(t),t=g.next,p=g.next;else if((t=g)===p){m?1===m?o(t=h(r(t),e,s),e,s,n,i,c,2):2===m&&u(t,e,s,n,i,c):o(r(t),e,s,n,i,c,1);break}}}function a(t){var e=t.prev,s=t,n=t.next;if(b(e,s,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(x(e.x,e.y,s.x,s.y,n.x,n.y,i.x,i.y)&&b(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function l(t,e,s,n){var i=t.prev,r=t,o=t.next;if(b(i,r,o)>=0)return!1;for(var a=i.x<r.x?i.x<o.x?i.x:o.x:r.x<o.x?r.x:o.x,l=i.y<r.y?i.y<o.y?i.y:o.y:r.y<o.y?r.y:o.y,h=i.x>r.x?i.x>o.x?i.x:o.x:r.x>o.x?r.x:o.x,u=i.y>r.y?i.y>o.y?i.y:o.y:r.y>o.y?r.y:o.y,c=f(a,l,e,s,n),m=f(h,u,e,s,n),d=t.prevZ,g=t.nextZ;d&&d.z>=c&&g&&g.z<=m;){if(d!==t.prev&&d!==t.next&&x(i.x,i.y,r.x,r.y,o.x,o.y,d.x,d.y)&&b(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,g!==t.prev&&g!==t.next&&x(i.x,i.y,r.x,r.y,o.x,o.y,g.x,g.y)&&b(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&x(i.x,i.y,r.x,r.y,o.x,o.y,d.x,d.y)&&b(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;g&&g.z<=m;){if(g!==t.prev&&g!==t.next&&x(i.x,i.y,r.x,r.y,o.x,o.y,g.x,g.y)&&b(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function h(t,e,s){var n=t;do{var i=n.prev,o=n.next.next;!P(i,o)&&S(i,n,n.next,o)&&w(i,o)&&w(o,i)&&(e.push(i.i/s),e.push(n.i/s),e.push(o.i/s),A(n),A(n.next),n=t=o),n=n.next}while(n!==t);return r(n)}function u(t,e,s,n,i,a){var l=t;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&v(l,h)){var u=I(l,h);return l=r(l,l.next),u=r(u,u.next),o(l,e,s,n,i,a),void o(u,e,s,n,i,a)}h=h.next}l=l.next}while(l!==t)}function c(t,e,s,n){var o,a,l,h=[];for(o=0,a=e.length;o<a;o++)(l=i(t,e[o]*n,o<a-1?e[o+1]*n:t.length,n,!1))===l.next&&(l.steiner=!0),h.push(y(l));for(h.sort(m),o=0;o<h.length;o++)s=r(s=g(h[o],s),s.next);return s}function m(t,e){return t.x-e.x}function d(t){if(t.next.prev===t)return t;let e=t;for(;;){const s=e.next;if(s.prev===e||s===e||s===t)break;e=s}return e}function g(t,e){var s=function(t,e){var s,n=e,i=t.x,r=t.y,o=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>o){if(o=a,a===i){if(r===n.y)return n;if(r===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(i===o)return s;var l,h=s,u=s.x,c=s.y,m=1/0;n=s;do{i>=n.x&&n.x>=u&&i!==n.x&&x(r<c?i:o,r,u,c,r<c?o:i,r,n.x,n.y)&&(l=Math.abs(r-n.y)/(i-n.x),w(n,t)&&(l<m||l===m&&(n.x>s.x||n.x===s.x&&p(s,n)))&&(s=n,m=l)),n=n.next}while(n!==h);return s}(t,e);if(!s)return e;var n=I(s,t),i=r(s,s.next);let o=d(n);return r(o,o.next),i=d(i),d(e===s?i:e)}function p(t,e){return b(t.prev,t,e.prev)<0&&b(e.next,t,t.next)<0}function _(t,e,s,n){var i=t;do{null===i.z&&(i.z=f(i.x,i.y,e,s,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,s,n,i,r,o,a,l,h=1;do{for(s=t,t=null,r=null,o=0;s;){for(o++,n=s,a=0,e=0;e<h&&(a++,n=n.nextZ);e++);for(l=h;a>0||l>0&&n;)0!==a&&(0===l||!n||s.z<=n.z)?(i=s,s=s.nextZ,a--):(i=n,n=n.nextZ,l--),r?r.nextZ=i:t=i,i.prevZ=r,r=i;s=n}r.nextZ=null,h*=2}while(o>1)}(i)}function f(t,e,s,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function y(t){var e=t,s=t;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==t);return s}function x(t,e,s,n,i,r,o,a){return(i-o)*(e-a)-(t-o)*(r-a)>=0&&(t-o)*(n-a)-(s-o)*(e-a)>=0&&(s-o)*(r-a)-(i-o)*(n-a)>=0}function v(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==e.i&&s.next.i!==e.i&&S(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(t,e)&&(w(t,e)&&w(e,t)&&function(t,e){var s=t,n=!1,i=(t.x+e.x)/2,r=(t.y+e.y)/2;do{s.y>r!=s.next.y>r&&s.next.y!==s.y&&i<(s.next.x-s.x)*(r-s.y)/(s.next.y-s.y)+s.x&&(n=!n),s=s.next}while(s!==t);return n}(t,e)&&(b(t.prev,t,e.prev)||b(t,e.prev,e))||P(t,e)&&b(t.prev,t,t.next)>0&&b(e.prev,e,e.next)>0)}function b(t,e,s){return(e.y-t.y)*(s.x-e.x)-(e.x-t.x)*(s.y-e.y)}function P(t,e){return t.x===e.x&&t.y===e.y}function S(t,e,s,n){var i=C(b(t,e,s)),r=C(b(t,e,n)),o=C(b(s,n,t)),a=C(b(s,n,e));return i!==r&&o!==a||!(0!==i||!E(t,s,e))||!(0!==r||!E(t,n,e))||!(0!==o||!E(s,t,n))||!(0!==a||!E(s,e,n))}function E(t,e,s){return e.x<=Math.max(t.x,s.x)&&e.x>=Math.min(t.x,s.x)&&e.y<=Math.max(t.y,s.y)&&e.y>=Math.min(t.y,s.y)}function C(t){return t>0?1:t<0?-1:0}function w(t,e){return b(t.prev,t,t.next)<0?b(t,e,t.next)>=0&&b(t,t.prev,e)>=0:b(t,e,t.prev)<0||b(t,t.next,e)<0}function I(t,e){var s=new M(t.i,t.x,t.y),n=new M(e.i,e.x,e.y),i=t.next,r=e.prev;return t.next=e,e.prev=t,s.next=i,i.prev=s,n.next=s,s.prev=n,r.next=n,n.prev=r,n}function T(t,e,s,n){var i=new M(t,e,s);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function M(t,e,s){this.i=t,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function D(t,e,s,n){for(var i=0,r=e,o=s-n;r<s;r+=n)i+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return i}s.d(e,{e:()=>n}),n.deviation=function(t,e,s,n){var i=e&&e.length,r=i?e[0]*s:t.length,o=Math.abs(D(t,0,r,s));if(i)for(var a=0,l=e.length;a<l;a++){var h=e[a]*s,u=a<l-1?e[a+1]*s:t.length;o-=Math.abs(D(t,h,u,s))}var c=0;for(a=0;a<n.length;a+=3){var m=n[a]*s,d=n[a+1]*s,g=n[a+2]*s;c+=Math.abs((t[m]-t[g])*(t[d+1]-t[m+1])-(t[m]-t[d])*(t[g+1]-t[m+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},n.flatten=function(t){for(var e=t[0][0].length,s={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var r=0;r<t[i].length;r++)for(var o=0;o<e;o++)s.vertices.push(t[i][r][o]);i>0&&(n+=t[i-1].length,s.holes.push(n))}return s}},2662:(t,e,s)=>{s.d(e,{a:()=>x,b:()=>g,c:()=>i,d:()=>u,e:()=>v,f:()=>m,g:()=>o,h:()=>_,j:()=>d,l:()=>f,n:()=>p,s:()=>r,t:()=>y});var n=s(65257);function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function r(t,e,s,n,i){return t[0]=e,t[1]=s,t[2]=n,t[3]=i,t}function o(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t[2]=e[2]+s[2],t[3]=e[3]+s[3],t}function a(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t[2]=e[2]-s[2],t[3]=e[3]-s[3],t}function l(t,e,s){return t[0]=e[0]*s[0],t[1]=e[1]*s[1],t[2]=e[2]*s[2],t[3]=e[3]*s[3],t}function h(t,e,s){return t[0]=e[0]/s[0],t[1]=e[1]/s[1],t[2]=e[2]/s[2],t[3]=e[3]/s[3],t}function u(t,e,s){return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t}function c(t,e){const s=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],r=e[3]-t[3];return Math.sqrt(s*s+n*n+i*i+r*r)}function m(t,e){const s=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],r=e[3]-t[3];return s*s+n*n+i*i+r*r}function d(t){const e=t[0],s=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+s*s+n*n+i*i)}function g(t){const e=t[0],s=t[1],n=t[2],i=t[3];return e*e+s*s+n*n+i*i}function p(t,e){const s=e[0],n=e[1],i=e[2],r=e[3];let o=s*s+n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=s*o,t[1]=n*o,t[2]=i*o,t[3]=r*o),t}function _(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function f(t,e,s,n){const i=e[0],r=e[1],o=e[2],a=e[3];return t[0]=i+n*(s[0]-i),t[1]=r+n*(s[1]-r),t[2]=o+n*(s[2]-o),t[3]=a+n*(s[3]-a),t}function y(t,e,s){const n=e[0],i=e[1],r=e[2],o=e[3];return t[0]=s[0]*n+s[4]*i+s[8]*r+s[12]*o,t[1]=s[1]*n+s[5]*i+s[9]*r+s[13]*o,t[2]=s[2]*n+s[6]*i+s[10]*r+s[14]*o,t[3]=s[3]*n+s[7]*i+s[11]*r+s[15]*o,t}function x(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function v(t,e){const s=t[0],i=t[1],r=t[2],o=t[3],a=e[0],l=e[1],h=e[2],u=e[3],c=(0,n.FD)();return Math.abs(s-a)<=c*Math.max(1,Math.abs(s),Math.abs(a))&&Math.abs(i-l)<=c*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-h)<=c*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(o-u)<=c*Math.max(1,Math.abs(o),Math.abs(u))}const b=a,P=l,S=h,E=c,C=m,w=d,I=g;Object.freeze(Object.defineProperty({__proto__:null,add:o,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},copy:i,copyVec3:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},dist:E,distance:c,div:S,divide:h,dot:_,equals:v,exactEquals:x,floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},len:w,length:d,lerp:f,max:function(t,e,s){return t[0]=Math.max(e[0],s[0]),t[1]=Math.max(e[1],s[1]),t[2]=Math.max(e[2],s[2]),t[3]=Math.max(e[3],s[3]),t},min:function(t,e,s){return t[0]=Math.min(e[0],s[0]),t[1]=Math.min(e[1],s[1]),t[2]=Math.min(e[2],s[2]),t[3]=Math.min(e[3],s[3]),t},mul:P,multiply:l,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},normalize:p,random:function(t,e=1){const s=n.Ov;let i,r,o,a,l,h;do{i=2*s()-1,r=2*s()-1,l=i*i+r*r}while(l>=1);do{o=2*s()-1,a=2*s()-1,h=o*o+a*a}while(h>=1);const u=Math.sqrt((1-l)/h);return t[0]=e*i,t[1]=e*r,t[2]=e*o*u,t[3]=e*a*u,t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},scale:u,scaleAndAdd:function(t,e,s,n){return t[0]=e[0]+s[0]*n,t[1]=e[1]+s[1]*n,t[2]=e[2]+s[2]*n,t[3]=e[3]+s[3]*n,t},set:r,sqrDist:C,sqrLen:I,squaredDistance:m,squaredLength:g,str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},sub:b,subtract:a,transformMat4:y,transformQuat:function(t,e,s){const n=e[0],i=e[1],r=e[2],o=s[0],a=s[1],l=s[2],h=s[3],u=h*n+a*r-l*i,c=h*i+l*n-o*r,m=h*r+o*i-a*n,d=-o*n-a*i-l*r;return t[0]=u*h+d*-o+c*-l-m*-a,t[1]=c*h+d*-a+m*-o-u*-l,t[2]=m*h+d*-l+u*-a-c*-o,t[3]=e[3],t}},Symbol.toStringTag,{value:"Module"}))},87176:(t,e,s)=>{s.d(e,{A:()=>w});const n=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["\xab","\xbb"],["\xbb","\xab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]],i=["\u0622","\u0623","\u0625","\u0627"],r=["\ufef5","\ufef7","\ufef9","\ufefb"],o=["\ufef6","\ufef8","\ufefa","\ufefc"],a=["\u0627","\u0628","\u062a","\u062b","\u062c","\u062d","\u062e","\u062f","\u0630","\u0631","\u0632","\u0633","\u0634","\u0635","\u0636","\u0637","\u0638","\u0639","\u063a","\u0641","\u0642","\u0643","\u0644","\u0645","\u0646","\u0647","\u0648","\u064a","\u0625","\u0623","\u0622","\u0629","\u0649","\u0644","\u0645","\u0646","\u0647","\u0648","\u064a","\u0625","\u0623","\u0622","\u0629","\u0649","\u06cc","\u0626","\u0624"],l=["\ufe8d","\ufe8f","\ufe95","\ufe99","\ufe9d","\ufea1","\ufea5","\ufea9","\ufeab","\ufead","\ufeaf","\ufeb1","\ufeb5","\ufeb9","\ufebd","\ufec1","\ufec5","\ufec9","\ufecd","\ufed1","\ufed5","\ufed9","\ufedd","\ufee1","\ufee5","\ufee9","\ufeed","\ufef1","\ufe87","\ufe83","\ufe81","\ufe93","\ufeef","\ufbfc","\ufe89","\ufe85","\ufe70","\ufe72","\ufe74","\ufe76","\ufe78","\ufe7a","\ufe7c","\ufe7e","\ufe80","\ufe89","\ufe85"],h=["\ufe8e","\ufe90","\ufe96","\ufe9a","\ufe9e","\ufea2","\ufea6","\ufeaa","\ufeac","\ufeae","\ufeb0","\ufeb2","\ufeb6","\ufeba","\ufebe","\ufec2","\ufec6","\ufeca","\ufece","\ufed2","\ufed6","\ufeda","\ufede","\ufee2","\ufee6","\ufeea","\ufeee","\ufef2","\ufe88","\ufe84","\ufe82","\ufe94","\ufef0","\ufbfd","\ufe8a","\ufe86","\ufe70","\ufe72","\ufe74","\ufe76","\ufe78","\ufe7a","\ufe7c","\ufe7e","\ufe80","\ufe8a","\ufe86"],u=["\ufe8e","\ufe92","\ufe98","\ufe9c","\ufea0","\ufea4","\ufea8","\ufeaa","\ufeac","\ufeae","\ufeb0","\ufeb4","\ufeb8","\ufebc","\ufec0","\ufec4","\ufec8","\ufecc","\ufed0","\ufed4","\ufed8","\ufedc","\ufee0","\ufee4","\ufee8","\ufeec","\ufeee","\ufef4","\ufe88","\ufe84","\ufe82","\ufe94","\ufef0","\ufbff","\ufe8c","\ufe86","\ufe71","\ufe72","\ufe74","\ufe77","\ufe79","\ufe7b","\ufe7d","\ufe7f","\ufe80","\ufe8c","\ufe86"],c=["\ufe8d","\ufe91","\ufe97","\ufe9b","\ufe9f","\ufea3","\ufea7","\ufea9","\ufeab","\ufead","\ufeaf","\ufeb3","\ufeb7","\ufebb","\ufebf","\ufec3","\ufec7","\ufecb","\ufecf","\ufed3","\ufed7","\ufedb","\ufedf","\ufee3","\ufee7","\ufeeb","\ufeed","\ufef3","\ufe87","\ufe83","\ufe81","\ufe93","\ufeef","\ufbfe","\ufe8b","\ufe85","\ufe70","\ufe72","\ufe74","\ufe76","\ufe78","\ufe7a","\ufe7c","\ufe7e","\ufe80","\ufe8b","\ufe85"],m=["\u0621","\u0622","\u0623","\u0624","\u0625","\u0627","\u0629","\u062f","\u0630","\u0631","\u0632","\u0648","\u0649"],d=["\u064b","\u064b","\u064c","\u061f","\u064d","\u061f","\u064e","\u064e","\u064f","\u064f","\u0650","\u0650","\u0651","\u0651","\u0652","\u0652","\u0621","\u0622","\u0622","\u0623","\u0623","\u0624","\u0624","\u0625","\u0625","\u0626","\u0626","\u0626","\u0626","\u0627","\u0627","\u0628","\u0628","\u0628","\u0628","\u0629","\u0629","\u062a","\u062a","\u062a","\u062a","\u062b","\u062b","\u062b","\u062b","\u062c","\u062c","\u062c","\u062c","\u062d","\u062d","\u062d","\u062d","\u062e","\u062e","\u062e","\u062e","\u062f","\u062f","\u0630","\u0630","\u0631","\u0631","\u0632","\u0632","\u0633","\u0633","\u0633","\u0633","\u0634","\u0634","\u0634","\u0634","\u0635","\u0635","\u0635","\u0635","\u0636","\u0636","\u0636","\u0636","\u0637","\u0637","\u0637","\u0637","\u0638","\u0638","\u0638","\u0638","\u0639","\u0639","\u0639","\u0639","\u063a","\u063a","\u063a","\u063a","\u0641","\u0641","\u0641","\u0641","\u0642","\u0642","\u0642","\u0642","\u0643","\u0643","\u0643","\u0643","\u0644","\u0644","\u0644","\u0644","\u0645","\u0645","\u0645","\u0645","\u0646","\u0646","\u0646","\u0646","\u0647","\u0647","\u0647","\u0647","\u0648","\u0648","\u0649","\u0649","\u064a","\u064a","\u064a","\u064a","\ufef5","\ufef6","\ufef7","\ufef8","\ufef9","\ufefa","\ufefb","\ufefc","\u061f","\u061f","\u061f"],g=["\u0621","\u0641"],p=["\u063a","\u064a"],_=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],f=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],y=10,x=11,v=12,b=18,P=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],S=100,E=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107],C=[[b,b,b,b,b,b,b,b,b,6,5,6,8,5,b,b,b,b,b,b,b,b,b,b,b,b,b,b,5,5,5,6,8,4,4,x,x,x,4,4,4,4,4,y,9,y,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,b,b,b,b,b,b,5,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,9,4,x,x,x,x,4,4,4,4,0,4,4,b,4,4,x,x,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,1,v,1,v,v,1,v,v,1,v,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,x,x,7,9,7,4,4,v,v,v,v,v,v,v,v,v,v,v,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,3,3,3,3,3,3,3,3,3,3,x,3,3,7,7,7,v,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,v,v,v,v,v,v,v,3,4,v,v,v,v,v,v,7,7,v,v,4,v,v,v,v,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,v,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,v,v,v,v,v,v,v,v,v,v,v,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,v,v,v,v,v,v,v,v,v,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,b,b,b,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,b,b,b,b,b,4,4,4,4,4,b,b,b,b,b,b,2,0,4,4,2,2,2,2,2,2,y,y,4,4,4,0,2,2,2,2,2,2,2,2,2,2,y,y,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,v,1,1,1,1,1,1,1,1,1,1,y,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,v,v,v,v,v,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,4,9,4,4,4,4,4,4,4,4,4,x,4,4,y,y,4,4,4,4,4,x,x,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,b],[4,4,4,x,x,x,4,4,4,4,4,y,9,y,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,x,x,4,4,4,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];class w{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(t,e,s){if(this.sourceToTarget=[],this.targetToSource=[],!t)return"";if(function(t,e,s){Z=[],$=[];for(let n=0;n<s;n++)t[n]=n,e[n]=n,Z[n]=n}(this.sourceToTarget,this.targetToSource,t.length),!this.checkParameters(e,s))return t;e=this.inputFormat,s=this.outputFormat;let n=t;const a=K,u=U(e.charAt(1)),m=U(s.charAt(1)),g=("I"===e.charAt(0)?"L":e.charAt(0))+u,p=("I"===s.charAt(0)?"L":s.charAt(0))+m,_=e.charAt(2)+s.charAt(2);a.defInFormat=g,a.defOutFormat=p,a.defSwap=_;const f=I(t,g,p,_,a);let y=!1;return"R"===s.charAt(1)?y=!0:"C"!==s.charAt(1)&&"D"!==s.charAt(1)||(y="rtl"===this.checkContextual(f)),this.sourceToTarget=Z,this.targetToSource=function(t){const e=new Array(t.length);for(let s=0;s<t.length;s++)e[t[s]]=s;return e}(this.sourceToTarget),W=this.targetToSource,n=e.charAt(3)===s.charAt(3)?f:"S"===s.charAt(3)?function(t,e){if(0===e.length)return"";void 0===t&&(t=!0);const s=(e=String(e)).split("");let n=0,i=1,a=s.length;t||(n=s.length-1,i=-1,a=1);const u=function(t,e,s,n){let i=0;const a=[];let u=0;for(let m=e;m*s<n;m+=s)if(R(t[m])||Y(t[m])){if("\u0644"===t[m]&&L(t,m+s,s,n)){t[m]=X(t[m+s],0===i?r:o),m+=s,H(t,m,s,n),a[u]=m,u++,i=0;continue}const e=t[m];1===i?t[m]=k(t,m+s,s,n)?q(t[m]):B(t[m],h):!0===k(t,m+s,s,n)?t[m]=B(t[m],c):t[m]=B(t[m],l),Y(e)||(i=1),!0===O(e)&&(i=0)}else i=0;return a}(s,n,i,a);let m="";for(let r=0;r<s.length;r++)F(u,u.length,r)>-1?(j(W,r,!t,-1),Z.splice(r,1)):m+=s[r];return m}(y,f):function(t,e,s){if(0===t.length)return"";void 0===e&&(e=!0);let n="";const r=(t=String(t)).split("");for(let o=0;o<t.length;o++){let a=!1;if(r[o]>="\ufe70"&&r[o]<"\ufeff"){const l=t.charCodeAt(o);r[o]>="\ufef5"&&r[o]<="\ufefc"?(e?(o>0&&s&&" "===r[o-1]?n=n.slice(0,-1)+"\u0644":(n+="\u0644",a=!0),n+=i[(l-65269)/2]):(n+=i[(l-65269)/2],n+="\u0644",o+1<t.length&&s&&" "===r[o+1]?o++:a=!0),a&&(j(W,o,!0,1),Z.splice(o,0,Z[o]))):n+=d[l-65136]}else n+=r[o]}return n}(f,y,!0),this.sourceToTarget=Z,this.targetToSource=W,this.levels=$,n}_inputFormatSetter(t){if(!st.test(t))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=t}_outputFormatSetter(t){if(!st.test(t))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=t}checkParameters(t,e){return t?this._inputFormatSetter(t):t=this.inputFormat,e?this._outputFormatSetter(e):e=this.outputFormat,t!==e}checkContextual(t){let e=T(t);if("ltr"!==e&&"rtl"!==e){try{e=document.dir.toLowerCase()}catch(f){}"ltr"!==e&&"rtl"!==e&&(e="ltr")}return e}hasBidiChar(t){return nt.test(t)}}function I(t,e,s,n,i){const r=function(t,e,s){if(void 0===e.inFormat&&(e.inFormat=s.defInFormat),void 0===e.outFormat&&(e.outFormat=s.defOutFormat),void 0===e.swap&&(e.swap=s.defSwap),e.inFormat===e.outFormat)return e;const n=e.inFormat.slice(0,1),i=e.outFormat.slice(0,1);let r,o=e.inFormat.slice(1,4),a=e.outFormat.slice(1,4);return"C"===o.charAt(0)&&(r=T(t),o="ltr"===r||"rtl"===r?r.toUpperCase():"L"===e.inFormat.charAt(2)?"LTR":"RTL",e.inFormat=n+o),"C"===a.charAt(0)&&(r=T(t),"rtl"===r?a="RTL":"ltr"===r?(r=function(t){const e=t.split("");return e.reverse(),T(e.join(""))}(t),a=r.toUpperCase()):a="L"===e.outFormat.charAt(2)?"LTR":"RTL",e.outFormat=i+a),e}(t,{inFormat:e,outFormat:s,swap:n},i);if(r.inFormat===r.outFormat)return t;e=r.inFormat,s=r.outFormat,n=r.swap;const o=e.slice(0,1),a=e.slice(1,4),l=s.slice(0,1),h=s.slice(1,4);if(i.inFormat=e,i.outFormat=s,i.swap=n,"L"===o&&"VLTR"===s){if("LTR"===a)return i.dir=tt,A(t,i);if("RTL"===a)return i.dir=et,A(t,i)}if("V"===o&&"V"===l)return i.dir="RTL"===a?et:tt,N(t,i);if("L"===o&&"VRTL"===s)return"LTR"===a?(i.dir=tt,t=A(t,i)):(i.dir=et,t=A(t,i)),N(t);if("VLTR"===e&&"LLTR"===s)return i.dir=tt,A(t,i);if("V"===o&&"L"===l&&a!==h)return t=N(t),"RTL"===a?I(t,"LLTR","VLTR",n,i):I(t,"LRTL","VRTL",n,i);if("VRTL"===e&&"LRTL"===s)return I(t,"LRTL","VRTL",n,i);if("L"===o&&"L"===l){const e=i.swap;return i.swap=e.slice(0,1)+"N","RTL"===a?(i.dir=et,t=A(t,i),i.swap="N"+e.slice(1,3),i.dir=tt,t=A(t,i)):(i.dir=tt,t=A(t,i),i.swap="N"+e.slice(1,3),t=I(t,"VLTR","LRTL",i.swap,i)),t}return t}function T(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function A(t,e){const s=t.split(""),n=[];return M(s,n,e),function(t,e,s){if(0!==s.hiLevel&&s.swap[0]!==s.swap[1])for(let n=0;n<t.length;n++)1===e[n]&&(t[n]=z(t[n]))}(s,n,e),G(2,s,n,e),G(1,s,n,e),$=n,s.join("")}function M(t,e,s){const n=t.length,i=s.dir?f:_;let r=0,o=-1;const a=[],l=[];s.hiLevel=s.dir,s.lastArabic=!1,s.hasUbatAl=!1,s.hasUbatB=!1,s.hasUbatS=!1;for(let h=0;h<n;h++)a[h]=D(t[h]);for(let h=0;h<n;h++){const n=r,u=V(t,a,l,h,s);l[h]=u,r=i[n][u];const c=240&r;r&=15;const m=i[r][Q];if(e[h]=m,c>0)if(16===c){for(let t=o;t<h;t++)e[t]=1;o=-1}else o=-1;if(i[r][J])-1===o&&(o=h);else if(o>-1){for(let t=o;t<h;t++)e[t]=m;o=-1}5===a[h]&&(e[h]=0),s.hiLevel|=m}s.hasUbatS&&function(t,e,s,n){for(let i=0;i<s;i++)if(6===t[i]){e[i]=n.dir;for(let s=i-1;s>=0&&8===t[s];s--)e[s]=n.dir}}(a,e,n,s)}function D(t){const e=t.charCodeAt(0),s=E[e>>8];return s<S?s:C[s-S][255&e]}function N(t,e){const s=t.split("");if(e){const t=[];M(s,t,e),$=t}return s.reverse(),Z.reverse(),s.join("")}function F(t,e,s){for(let n=0;n<e;n++)if(t[n]===s)return n;return-1}function R(t){for(let e=0;e<g.length;e++)if(t>=g[e]&&t<=p[e])return!0;return!1}function k(t,e,s,n){for(;e*s<n&&Y(t[e]);)e+=s;return!!(e*s<n&&R(t[e]))}function L(t,e,s,n){for(;e*s<n&&Y(t[e]);)e+=s;let r=" ";if(!(e*s<n))return!1;r=t[e];for(let o=0;o<i.length;o++)if(i[o]===r)return!0;return!1}function G(t,e,s,n){if(n.hiLevel<t)return;if(1===t&&n.dir===et&&!n.hasUbatB)return e.reverse(),void Z.reverse();const i=e.length;let r,o,a,l,h,u=0;for(;u<i;){if(s[u]>=t){for(r=u+1;r<i&&s[r]>=t;)r++;for(o=u,a=r-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,h=Z[o],Z[o]=Z[a],Z[a]=h;u=r}u++}}function V(t,e,s,n,i){const r=e[n];return{UBAT_L:()=>(i.lastArabic=!1,0),UBAT_R:()=>(i.lastArabic=!1,1),UBAT_ON:()=>4,UBAT_AN:()=>3,UBAT_EN:()=>i.lastArabic?3:2,UBAT_AL:()=>(i.lastArabic=!0,i.hasUbatAl=!0,1),UBAT_WS:()=>4,UBAT_CS:()=>{let t,r;return n<1||n+1>=e.length||2!==(t=s[n-1])&&3!==t||2!==(r=e[n+1])&&3!==r?4:(i.lastArabic&&(r=3),r===t?r:4)},UBAT_ES:()=>2===(n>0?s[n-1]:5)&&n+1<e.length&&2===e[n+1]?2:4,UBAT_ET:()=>{if(n>0&&2===s[n-1])return 2;if(i.lastArabic)return 4;let t=n+1;const r=e.length;for(;t<r&&e[t]===x;)t++;return t<r&&2===e[t]?2:4},UBAT_NSM:()=>{if("VLTR"===i.inFormat){const s=e.length;let i=n+1;for(;i<s&&e[i]===v;)i++;if(i<s){const s=t[n].charCodeAt(0),r=s>=1425&&s<=2303||64286===s,o=e[i];if(r&&(1===o||7===o))return 1}}return n<1||5===e[n-1]?4:s[n-1]},UBAT_B:()=>(i.lastArabic=!0,i.hasUbatB=!0,i.dir),UBAT_S:()=>(i.hasUbatS=!0,4),UBAT_LRE:()=>(i.lastArabic=!1,4),UBAT_RLE:()=>(i.lastArabic=!1,4),UBAT_LRO:()=>(i.lastArabic=!1,4),UBAT_RLO:()=>(i.lastArabic=!1,4),UBAT_PDF:()=>(i.lastArabic=!1,4),UBAT_BN:()=>4}[P[r]]()}function z(t){let e,s=0,i=n.length-1;for(;s<=i;)if(e=Math.floor((s+i)/2),t<n[e][0])i=e-1;else{if(!(t>n[e][0]))return n[e][1];s=e+1}return t}function O(t){for(let e=0;e<m.length;e++)if(m[e]===t)return!0;return!1}function q(t){for(let e=0;e<a.length;e++)if(t===a[e])return u[e];return t}function B(t,e){for(let s=0;s<a.length;s++)if(t===a[s])return e[s];return t}function Y(t){return t>="\u064b"&&t<="\u0655"}function U(t){return"L"===t?"LTR":"R"===t?"RTL":"C"===t?"CLR":"D"===t?"CRL":""}function H(t,e,s,n){for(;e*s<n&&Y(t[e]);)e+=s;return e*s<n&&(t[e]=" ",!0)}function X(t,e){for(let s=0;s<i.length;s++)if(t===i[s])return e[s];return t}function j(t,e,s,n){for(let i=0;i<t.length;i++)(t[i]>e||!s&&t[i]===e)&&(t[i]+=n)}let Z=[],W=[],$=[];const K={dir:0,defInFormat:"LLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,defOutFormat:""},Q=5,J=6,tt=0,et=1,st=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,nt=/[\u0591-\u06ff\ufb1d-\ufefc]/},21870:(t,e,s)=>{s.d(e,{y:()=>i});const n=new(s(87176).A);function i(t){if(null==t)return["",!1];if(!n.hasBidiChar(t))return[t,!1];let e;return e="rtl"===n.checkContextual(t)?"IDNNN":"ICNNN",[n.bidiTransform(t,e,"VLYSN"),!0]}},89926:(t,e,s)=>{s.d(e,{q:()=>i});var n=s(40210);class i{constructor(t,e){this.removeFunc=e,this._storage=new n.F,this.id="",this.name="",this.size=0,this._storage.maxSize=t,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(t,e,s=1){this._storage.put(this,t,e,s,1)}pop(t){return this._storage.pop(this,t)}get(t){return this._storage.get(this,t)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}resetHitRate(){}}},40210:(t,e,s)=>{s.d(e,{F:()=>o,Ti:()=>n});const n=-3,i=n-1;var r;!function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"}(r||(r={}));Symbol.iterator;class o{get size(){return this._size}constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear()}register(t){this._users.set(t.id.slice(0,-1),t)}deregister(t){this.clear(t),this._sizeLimits.delete(t),this._users.delete(t.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,-1),this._checkSize()}getSize(t,e){const s=this._db.get(t.id+e);return s?.size??0}put(t,e,s,o,l){e=t.id+e;const h=this._db.get(e);if(h&&(this._size-=h.size,t.size-=h.size,this._db.delete(e),h.entry!==s&&this._notifyRemove(e,h.entry,h.size,r.ALL)),o>this._maxSize)return void this._notifyRemove(e,s,o,r.ALL);if(void 0===s)return void console.warn("Refusing to cache undefined entry ");if(!o||o<0)return console.warn(`Refusing to cache entry with size ${o} for key ${e}`),void this._notifyRemove(e,s,0,r.ALL);const u=1+Math.max(l,i)-n;this._db.set(e,new a(s,o,u)),this._size+=o,t.size+=o,this._checkSize()}updateSize(t,e,s,n){e=t.id+e;const i=this._db.get(e);if(i&&i.entry===s){for(this._size-=i.size,t.size-=i.size;n>this._maxSize;){const t=this._notifyRemove(e,s,n,r.SOME);if(!(null!=t&&t>0))return void this._db.delete(e);n=t}i.size=n,this._size+=n,t.size+=n,this._checkSize()}}pop(t,e){e=t.id+e;const s=this._db.get(e);if(s)return this._size-=s.size,t.size-=s.size,this._db.delete(e),++this._hit,s.entry;++this._miss}get(t,e){e=t.id+e;const s=this._db.get(e);if(void 0!==s)return this._db.delete(e),s.lives=s.lifetime,this._db.set(e,s),++this._hit,s.entry;++this._miss}peek(t,e){const s=this._db.get(t.id+e);return s?++this._hit:++this._miss,s?.entry}get performanceInfo(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},e={},s=new Array;this._db.forEach(((t,n)=>{const i=t.lifetime;s[i]=(s[i]||0)+t.size,this._users.forEach((s=>{const{id:i,name:r}=s;if(n.startsWith(i)){const s=e[r]||0;e[r]=s+t.size}}))}));const i={};this._users.forEach((t=>{const s=t.name;if("hitRate"in t&&"number"==typeof t.hitRate&&!isNaN(t.hitRate)&&t.hitRate>0){const n=e[s]||0;e[s]=n,i[s]=Math.round(100*t.hitRate)+"%"}else i[s]="0%"}));const r=Object.keys(e);r.sort(((t,s)=>e[s]-e[t])),r.forEach((s=>t[s]=Math.round(e[s]/2**20)+"MB / "+i[s]));for(let o=s.length-1;o>=0;--o){const e=s[o];e&&(t["Priority "+(o+n-1)]=Math.round(e/this._size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forEach((t=>t.resetHitRate()))}clear(t){const e=t.id;this._db.forEach(((t,s)=>{s.startsWith(e)&&(this._size-=t.size,this._db.delete(s),this._notifyRemove(s,t.entry,t.size,r.ALL))})),t.size=0}clearAll(){this._db.forEach(((t,e)=>this._notifyRemove(e,t.entry,t.size,r.ALL))),this._users.forEach((t=>t.size=0)),this._size=0,this._db.clear()}*values(t){for(const[e,s]of this._db)e.startsWith(t.id)&&(yield s.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,e,s,n){const i=this._users.get(t.split(l)[0])?.removeFunc,r=i?.(e,n,s);return"number"==typeof r?r:null}_checkSize(){this._sizeLimits.forEach(((t,e)=>this._checkSizeLimits(t,e))),this._checkSizeLimits(this.maxSize)}setMaxSize(t,e){null==e||e<=0?this._sizeLimits.delete(t):this._sizeLimits.set(t,e)}_checkSizeLimits(t,e){const s=e??this;if(s.size<=t)return;const n=e?.id;let i=!0;for(;i;){i=!1;for(const[r,o]of this._db)if(0===o.lifetime&&(!n||r.startsWith(n))){const n=e??this._users.get(r.split(l)[0]);if(this._purgeItem(r,o,n),s.size<=.9*t)return;i||=this._db.has(r)}}for(const[r,o]of this._db)if(!n||r.startsWith(n)){const n=e??this._users.get(r.split(l)[0]);if(this._purgeItem(r,o,n),s.size<=.9*t)return}}_purgeItem(t,e,s){if(this._db.delete(t),e.lives<=1){this._size-=e.size,s&&(s.size-=e.size);const n=this._notifyRemove(t,e.entry,e.size,r.SOME);null!=n&&n>0&&(this._size+=n,s&&(s.size+=n),e.lives=e.lifetime,e.size=n,this._db.set(t,e))}else--e.lives,this._db.set(t,e)}}class a{constructor(t,e,s){this.entry=t,this.size=e,this.lifetime=s,this.lives=s}}const l=":"},35775:(t,e,s)=>{s.d(e,{P:()=>x,L:()=>v});var n=s(66866),i=s(52495),r=s(52700),o=s(19251),a=s(94255);class l{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(a.AU),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const e=new l,s=this._originStores[a.Gr.DEFAULTS];s&&s.forEach(((t,s)=>{e.set(s,(0,o.o8)(t),a.Gr.DEFAULTS)}));for(let n=a.Gr.SERVICE;n<a.AU;n++){const s=this._originStores[n];s&&s.forEach(((s,i)=>{t&&t.has(i)||e.set(i,(0,o.o8)(s),n)}))}return e}get(t,e){const s=void 0===e?this._values:this._originStores[e];return s?s.get(t):void 0}keys(t){const e=null==t?this._values:this._originStores[t];return e?[...e.keys()]:[]}set(t,e,s=a.Gr.USER){let n=this._originStores[s];if(n||(n=new Map,this._originStores[s]=n),n.set(t,e),!this._values.has(t)||this._propertyOriginMap.get(t)<=s){const n=this._values.get(t);return this._values.set(t,e),this._propertyOriginMap.set(t,s),n!==e}return!1}delete(t,e=a.Gr.USER){const s=this._originStores[e];if(!s)return;const n=s.get(t);if(s.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===e){this._values.delete(t);for(let s=e-1;s>=0;s--){const e=this._originStores[s];if(e&&e.has(t)){this._values.set(t,e.get(t)),this._propertyOriginMap.set(t,s);break}}}return n}has(t,e){const s=void 0===e?this._values:this._originStores[e];return!!s&&s.has(t)}revert(t,e){for(;e>0&&!this.has(t,e);)--e;const s=this._originStores[e],n=s?.get(t),i=this._values.get(t);return this._values.set(t,n),this._propertyOriginMap.set(t,e),i!==n}originOf(t){return this._propertyOriginMap.get(t)||a.Gr.DEFAULTS}isAtOrigin(t,e){return this.has(t,e)&&this.originOf(t)===e}isBelowOrigin(t,e){return!this.has(t)||this.originOf(t)<e}forEach(t){this._values.forEach(t)}}var h=s(83312),u=s(55135),c=s(63863);const m=t=>{let e=class extends t{constructor(...t){super(...t);const e=(0,u.oY)(this),s=e.store,n=new l;e.store=n,(0,r.k)(e,s,n)}read(t,e){(0,h.L)(this,t,e)}getAtOrigin(t,e){const s=d(this),n=(0,a.aB)(e);if("string"==typeof t)return s.get(t,n);const i={};return t.forEach((t=>{i[t]=s.get(t,n)})),i}originOf(t){return(0,a.OL)(this.originIdOf(t))}originIdOf(t){return d(this).originOf(t)}revert(t,e){const s=d(this),n=(0,a.aB)(e),i=(0,u.oY)(this);let r;r="string"==typeof t?"*"===t?s.keys(n):[t]:t,r.forEach((t=>{i.invalidate(t),s.revert(t,n),i.commit(t)}))}};return e=(0,n._)([(0,c.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function d(t){return(0,u.oY)(t).store}let g=class extends(m(i.A)){};g=(0,n._)([(0,c.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],g);var p=s(45066),_=s(77373);const f=t=>{let e=class extends t{constructor(...t){super(...t)}clear(t,e="user"){(0,u.oY)(this).clearOrigin(t,(0,a.aB)(e))}write(t,e){return(0,_.M)(this,t=t||{},e),t}setAtOrigin(t,e,s){(0,u.oY)(this).setAtOrigin(t,e,(0,a.aB)(s))}removeOrigin(t){const e=y(this),s=(0,a.aB)(t),n=e.keys(s);for(const i of n)e.originOf(i)===s&&e.set(i,e.get(i,s),a.Gr.USER)}updateOrigin(t,e){const s=y(this),n=(0,a.aB)(e),i=(0,p.Jt)(this,t);for(let r=n+1;r<a.AU;++r)s.delete(t,r);s.set(t,i,n)}toJSON(t){return this.write({},t)}};return e=(0,n._)([(0,c.$)("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function y(t){return(0,u.oY)(t).store}const x=t=>{let e=class extends(f(m(t))){constructor(...t){super(...t)}};return e=(0,n._)([(0,c.$)("esri.core.MultiOriginJSONSupport")],e),e};let v=class extends(x(i.A)){};v=(0,n._)([(0,c.$)("esri.core.MultiOriginJSONSupport")],v)},92746:(t,e,s)=>{s.d(e,{QueueProcessor:()=>u});var n=s(6267),i=s(40189),r=s(20748),o=s(71416),a=s(61449),l=s(40315);class h{constructor(t,e){this.item=t,this.controller=e,this.promise=null}}class u{constructor(t){this._schedule=null,this._deferreds=new o.A,this._controllers=new o.A,this._processingItems=new o.A,this._pausedSignal=(0,l.v)(!1),this.concurrency=1,t.concurrency&&(this.concurrency=t.concurrency),this._queue=new r.A(t.peeker),this.process=t.process}destroy(){this.clear(),this._schedule=(0,n.xt)(this._schedule)}get updating(){return this.running}get length(){return this._processingItems.size+this._queue.length}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}abort(t){const e=this._controllers.get(t);e&&e.abort()}clear(){this._queue.clear();const t=[];this._controllers.forEach((e=>t.push(e))),this._controllers.clear(),t.forEach((t=>t.abort())),this._processingItems.clear(),this._cancelNext()}forEach(t){this._deferreds.forEach(((e,s)=>t(s)))}get(t){const e=this._deferreds.get(t);return e?e.promise:void 0}isOngoing(t){return this._processingItems.has(t)}has(t){return this._deferreds.has(t)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(t,e){const s=this.get(t);if(s)return s;const n=new AbortController;let r=null;e&&(r=(0,i.u7)(e,(()=>n.abort())));const o=()=>{a.remove(),null!=r&&r.remove(),this._removeItem(t),this._queue.remove(t),this._scheduleNext()},a=(0,i.NY)(n.signal,(()=>{const e=this._processingItems.get(t);e&&e.controller.abort(),o(),l.reject((0,i.NK)())})),l=(0,i.Tw)();return this._deferreds.set(t,l),this._controllers.set(t,n),l.promise.then(o,o),this._queue.push(t),this._scheduleNext(),l.promise}last(){return this._queue.last()}lastPromise(){const t=this.last();return t?this.get(t):null}peek(){return this._queue.peek()}popLast(){const t=this._queue.popLast();return t&&(this._deferreds.get(t)?.reject((0,i.NK)()),this._removeItem(t)),t}reset(){const t=Array.from(this._processingItems.values());this._processingItems.clear();for(const e of t)this._queue.push(e.item),e.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const t=[];for(;this._queue.length;)t.push(this._queue.pop());return this.clear(),t}_removeItem(t){this._deferreds.delete(t),this._controllers.delete(t),this._processingItems.delete(t)}_scheduleNext(){this._pausedSignal.value||this._schedule||(this._schedule=(0,a._)((()=>{this._schedule=null,this._next()})))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(t,e){this._canProcessFulfillment(t)&&(this._scheduleNext(),this._deferreds.get(t.item).resolve(e))}_processError(t,e){this._canProcessFulfillment(t)&&(this._scheduleNext(),this._deferreds.get(t.item).reject(e))}_canProcessFulfillment(t){return!!this._deferreds.get(t.item)&&this._processingItems.get(t.item)===t}_process(t){if(null==t)return;let e;const s=new AbortController,n=new h(t,s);this._processingItems.set(t,n);try{e=this.process(t,s.signal)}catch(r){this._processError(n,r)}(0,i.$X)(e)?(n.promise=e,e.then((t=>this._processResult(n,t)),(t=>this._processError(n,t)))):this._processResult(n,e)}}},64442:(t,e,s)=>{s.d(e,{EB:()=>d,Im:()=>_,Mj:()=>m,Ui:()=>p,w2:()=>g});var n=s(52495),i=s(48982),r=s(55135);const o=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(t){return t instanceof n.A}function l(t){return t instanceof i.A?Object.keys(t.items):a(t)?(0,r.oY)(t).keys():t?Object.keys(t):[]}function h(t,e){return t instanceof i.A?t.items[e]:t[e]}function u(t){return t?t.declaredClass:null}function c(t,e){const s=t.diff;if(s&&"function"==typeof s)return s(t,e);const n=l(t),i=l(e);if(0===n.length&&0===i.length)return;if(!n.length||!i.length||function(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}(t,e))return{type:"complete",oldValue:t,newValue:e};const r=i.filter((t=>!n.includes(t))),m=n.filter((t=>!i.includes(t))),d=n.filter((s=>i.includes(s)&&h(t,s)!==h(e,s))).concat(r,m).sort(),g=u(t);if(g&&o.has(g)&&d.length)return{type:"complete",oldValue:t,newValue:e};let p;const _=a(t)&&a(e);for(const o of d){const n=h(t,o),i=h(e,o);let r;if((_||"function"!=typeof n&&"function"!=typeof i)&&n!==i&&(null!=n||null!=i)){if(s&&s[o]&&"function"==typeof s[o])r=s[o]?.(n,i);else if(n instanceof Date&&i instanceof Date){if(n.getTime()===i.getTime())continue;r={type:"complete",oldValue:n,newValue:i}}else r="object"==typeof n&&"object"==typeof i&&u(n)===u(i)?c(n,i):{type:"complete",oldValue:n,newValue:i};null!=r&&(null!=p?p.diff[o]=r:p={type:"partial",diff:{[o]:r}})}}return p}function m(t,e){return d(t,e)}function d(t,e){if(null==t)return!1;const s=e.split(".");let n=t;for(const i of s){if("complete"===n.type)return!0;if("partial"!==n.type)return!1;{const t=n.diff[i];if(!t)return!1;n=t}}return!0}function g(t,e){if(!t)return!1;if("partial"===t.type){const s=Object.keys(t.diff);return 1===s.length&&s[0]===e}return!1}function p(t,e){if("function"!=typeof t&&"function"!=typeof e&&(null!=t||null!=e))return null==t||null==e||"object"==typeof t&&"object"==typeof e&&u(t)!==u(e)?{type:"complete",oldValue:t,newValue:e}:c(t,e)}function _(t){if(null==t)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const t of e.added)if(!_(t))return!1;for(const t of e.removed)if(!_(t))return!1;for(const t of e.changed)if(!_(t))return!1;return!0}case"partial":for(const e in t.diff)if(!_(t.diff[e]))return!1;return!0}}},73324:(t,e,s)=>{s.d(e,{K:()=>n});const n=["operational-layers","basemap","ground"]},775:(t,e,s)=>{s.d(e,{$:()=>v,IB:()=>a,Iy:()=>R,N2:()=>b,QP:()=>D,RH:()=>S,Vl:()=>M,Ws:()=>C,ZD:()=>P,_L:()=>A,bJ:()=>I,e$:()=>T,f6:()=>F,pW:()=>w,pf:()=>N});var n=s(96220),i=s(85569),r=s(19251),o=(s(92504),s(2662),s(28152));function a(t){return"r"in t&&"g"in t&&"b"in t}function l(t){return"h"in t&&"s"in t&&"v"in t}function h(t){return"l"in t&&"a"in t&&"b"in t}function u(t){return"l"in t&&"c"in t&&"h"in t}const c=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],m=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function d(t,e){const s=[];let n,i;if(t[0].length!==e.length)throw new Error("dimensions do not match");const r=t.length,o=t[0].length;let a=0;for(n=0;n<r;n++){for(a=0,i=0;i<o;i++)a+=t[n][i]*e[i];s.push(a)}return s}function g(t){const e=[t.r/255,t.g/255,t.b/255].map((t=>t<=.04045?t/12.92:((t+.055)/1.055)**2.4)),s=d(c,e);return{x:100*s[0],y:100*s[1],z:100*s[2]}}function p(t){const e=d(m,[t.x/100,t.y/100,t.z/100]).map((t=>{const e=t<=.0031308?12.92*t:1.055*t**(1/2.4)-.055;return Math.min(1,Math.max(e,0))}));return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function _(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map((t=>t>(6/29)**3?t**(1/3):1/3*(29/6)**2*t+4/29));return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function f(t){const e=t.l,s=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map((t=>t>6/29?t**3:3*(6/29)**2*(t-4/29)));return{x:95.047*s[0],y:100*s[1],z:108.883*s[2]}}function y(t){return function(t){const e=t.l,s=t.a,n=t.b,i=Math.sqrt(s*s+n*n);let r=Math.atan2(n,s);return r=r>0?r:r+2*Math.PI,{l:e,c:i,h:r}}(_(g(t)))}function x(t){return p(f(function(t){const e=t.l,s=t.c,n=t.h;return{l:e,a:s*Math.cos(n),b:s*Math.sin(n)}}(t)))}function v(t){return a(t)?t:u(t)?x(t):h(t)?function(t){return p(f(t))}(t):function(t){return"x"in t&&"y"in t&&"z"in t}(t)?p(t):l(t)?function(t){const e=(t.h+360)%360/60,s=t.s/100,n=t.v/100*255,i=n*s,r=i*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:i,g:r,b:0};break;case 1:o={r:r,g:i,b:0};break;case 2:o={r:0,g:i,b:r};break;case 3:o={r:0,g:r,b:i};break;case 4:o={r:r,g:0,b:i};break;case 5:case 6:o={r:i,g:0,b:r};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+n-i),o.g=Math.round(o.g+n-i),o.b=Math.round(o.b+n-i),o}(t):t}function b(t){return l(t)?t:function(t){const e=t.r,s=t.g,n=t.b,i=Math.max(e,s,n),r=i-Math.min(e,s,n);let o=i,a=0===r?0:i===e?(s-n)/r%6:i===s?(n-e)/r+2:(e-s)/r+4,l=0===r?0:r/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}(v(t))}function P(t){return h(t)?t:function(t){return _(g(t))}(v(t))}function S(t){return u(t)?t:y(v(t))}function E(t){let{r:e,g:s,b:i,a:r}=t;return r<1&&(e=Math.round(r*e+255*(1-r)),s=Math.round(r*s+255*(1-r)),i=Math.round(r*i+255*(1-r))),new n.A({r:e,g:s,b:i})}function C(t,e){const{r:s,g:n,b:i}=e?.ignoreAlpha?t:E(t);return.2126*s+.7152*n+.0722*i}var w;function I(t,e=w.High){return C(t,{ignoreAlpha:!0})>e?new n.A([0,0,0,t.a]):new n.A([255,255,255,t.a])}function T(t,e){const s=P(t);s.l*=1-e;const n=v(s),i=t.clone();return i.setColor(n),i.a=t.a,i}function A(t,e){const s=t.clone();return s.a*=e,s}function M(t,e){const s=b(t);s.s*=e;const n=v(s),i=t.clone();return i.setColor(n),i.a=t.a,i}function D(t){return n.A.toUnitRGBA(t)}function N(t){return(0,o.fA)(t[0],t[1],t[2],t.length>3?t[3]:1)}function F(t,e){const s=n.A.toUnitRGBA(t);return s[3]*=e,s}function R(t,e,s={}){if(0===t.length||e<=0)return[];if(1===(t=t.map((t=>"string"==typeof t?new n.A(t):t))).length||1===e){const s=[],n=t[0];for(let t=0;t<e;t++)s.push(n.clone());return s}if(s.shuffle&&(t=(0,i.k4)((0,r.o8)(t),s.seed)),t.length>=e){const s=[],n=(t.length-1)/(e-1);for(let i=0;i<e;i++){const e=Math.round(i*n);s.push(t[e].clone())}return s}return function(t,e,s={}){const n=[],r=t.length-1,o=Math.ceil((e-t.length)/r);t:for(let i=0;i<r;i++){const r=t[i],a=t[i+1];for(let i=1;i<=o;i++){const l=i/(o+1);if(n.push(L(r,a,l,s)),n.length+t.length===e)break t}}return[...t.map((t=>t.clone())),...(0,i.k4)(n,s.seed??1)]}(t,e,s)}!function(t){t[t.Low=160]="Low",t[t.High=225]="High"}(w||(w={}));const k=(t,e)=>{const s=Math.floor(10*e())-5;return Math.min(255,Math.max(0,t+s))};function L(t,e,s,r={}){const o=t.r,a=t.g,l=t.b,h=e.r,u=e.g,c=e.b,m=Math.round(o+(h-o)*s),d=Math.round(a+(u-a)*s),g=Math.round(l+(c-l)*s);if(!r.offset)return new n.A([m,d,g]);const p=(0,i.Mo)(r.seed);return new n.A([k(m,p),k(d,p),k(g,p)])}},51859:(t,e,s)=>{s.d(e,{U:()=>i});var n=s(92504);function i(t,e,s=0){const i=(0,n.qE)(t,0,a);for(let n=0;n<4;n++)e[s+n]=Math.floor(256*l(i*r[n]))}const r=[1,256,65536,16777216],o=[1/256,1/65536,1/16777216,1/4294967296],a=function(t,e=0){let s=0;for(let n=0;n<4;n++)s+=t[e+n]*o[n];return s}(new Uint8ClampedArray([255,255,255,255]));function l(t){return t-Math.floor(t)}},72777:(t,e,s)=>{s.d(e,{Al:()=>h,NZ:()=>u,Vb:()=>i,af:()=>c,rK:()=>m});var n=s(21121);const i="arial-unicode-ms",r="woff2",o=new Map,a=new Set;class l{constructor(t,e){this.fontFace=t,this.promise=e}}async function h(t){const e=d(t),s=m(t),i=o.get(e);if(i)return i.promise;const h=new FontFace(t.family,`url('${n.A.fontsUrl}/woff2/${s}.${r}') format('${r}')`,{style:t.style,weight:t.weight}),u=document.fonts;if(u.has(h)&&"loading"===h.status)return h.loaded;const c=h.load().then((()=>(u.add(h),h)));return o.set(e,new l(h,c)),a.add(h),c}function u(t){return a.has(t)}function c(t){if(!t)return i;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function m(t){const e=g(t)+p(t);return c(t.family)+(e.length>0?e:"-regular")}function d(t){const e=g(t)+p(t);return(t.family||i)+(e.length>0?e:"-regular")}function g(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function p(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}},78607:(t,e,s)=>{function n(){return[1,0,0,0,1,0,0,0,1]}function i(t,e,s,n,i,r,o,a,l){return[t,e,s,n,i,r,o,a,l]}s.d(e,{fA:()=>i,vt:()=>n,zK:()=>r});const r=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:r,clone:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},create:n,fromValues:i},Symbol.toStringTag,{value:"Module"}))},3912:(t,e,s)=>{function n(){return new Float32Array(3)}function i(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function r(t,e,s){const n=new Float32Array(3);return n[0]=t,n[1]=e,n[2]=s,n}function o(){return n()}function a(){return r(1,1,1)}function l(){return r(1,0,0)}function h(){return r(0,1,0)}function u(){return r(0,0,1)}s.d(e,{fA:()=>r,o8:()=>i,vt:()=>n});const c=o(),m=a(),d=l(),g=h(),p=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:m,UNIT_X:d,UNIT_Y:g,UNIT_Z:p,ZEROS:c,clone:i,create:n,fromValues:r,ones:a,unitX:l,unitY:h,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},40275:(t,e,s)=>{function n(){return new Float32Array(4)}function i(t,e,s,n){const i=new Float32Array(4);return i[0]=t,i[1]=e,i[2]=s,i[3]=n,i}function r(){return n()}function o(){return i(1,1,1,1)}function a(){return i(1,0,0,0)}function l(){return i(0,1,0,0)}function h(){return i(0,0,1,0)}function u(){return i(0,0,0,1)}s.d(e,{fA:()=>i,vt:()=>n});const c=r(),m=o(),d=a(),g=l(),p=h(),_=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:m,UNIT_W:_,UNIT_X:d,UNIT_Y:g,UNIT_Z:p,ZEROS:c,clone:function(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},create:n,fromValues:i,ones:o,unitW:u,unitX:a,unitY:l,unitZ:h,zeros:r},Symbol.toStringTag,{value:"Module"}))},28152:(t,e,s)=>{function n(){return[0,0,0,0]}function i(t){return[t[0],t[1],t[2],t[3]]}function r(t,e,s,n){return[t,e,s,n]}function o(t,e,s,n){return[t,e,s,n]}function a(t,e=[0,0,0,0]){const s=Math.min(4,t.length);for(let n=0;n<s;++n)e[n]=t[n];return e}function l(){return[0,0,0,0]}function h(){return r(1,1,1,1)}function u(){return r(1,0,0,0)}function c(){return r(0,1,0,0)}function m(){return r(0,0,1,0)}function d(){return r(0,0,0,1)}s.d(e,{CN:()=>o,S:()=>h,Un:()=>p,ci:()=>a,fA:()=>r,o8:()=>i,uY:()=>g,vt:()=>n});const g=[0,0,0,0],p=h(),_=u(),f=c(),y=m(),x=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:x,UNIT_X:_,UNIT_Y:f,UNIT_Z:y,ZEROS:g,clone:i,create:n,freeze:o,fromArray:a,fromValues:r,ones:h,unitW:d,unitX:u,unitY:c,unitZ:m,zeros:l},Symbol.toStringTag,{value:"Module"}))},42927:(t,e,s)=>{s.d(e,{A6:()=>_,B8:()=>d,Xd:()=>u,Xr:()=>g,Yc:()=>D,hZ:()=>y,lw:()=>c,t2:()=>A,x8:()=>h});var n=s(78607),i=s(38911),r=s(58359),o=s(65257),a=s(24121),l=s(2662);function h(t,e,s){s*=.5;const n=Math.sin(s);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(s),t}function u(t,e){const s=2*Math.acos(e[3]),n=Math.sin(s/2);return n>(0,o.FD)()?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),s}function c(t,e,s){const n=e[0],i=e[1],r=e[2],o=e[3],a=s[0],l=s[1],h=s[2],u=s[3];return t[0]=n*u+o*a+i*h-r*l,t[1]=i*u+o*l+r*a-n*h,t[2]=r*u+o*h+n*l-i*a,t[3]=o*u-n*a-i*l-r*h,t}function m(t,e,s,n){const i=e[0],r=e[1],a=e[2],l=e[3];let h,u,c,m,d,g=s[0],p=s[1],_=s[2],f=s[3];return u=i*g+r*p+a*_+l*f,u<0&&(u=-u,g=-g,p=-p,_=-_,f=-f),1-u>(0,o.FD)()?(h=Math.acos(u),c=Math.sin(h),m=Math.sin((1-n)*h)/c,d=Math.sin(n*h)/c):(m=1-n,d=n),t[0]=m*i+d*g,t[1]=m*r+d*p,t[2]=m*a+d*_,t[3]=m*l+d*f,t}function d(t,e){const s=e[0],n=e[1],i=e[2],r=e[3],o=s*s+n*n+i*i+r*r,a=o?1/o:0;return t[0]=-s*a,t[1]=-n*a,t[2]=-i*a,t[3]=r*a,t}function g(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function p(t,e){const s=e[0]+e[4]+e[8];let n;if(s>0)n=Math.sqrt(s+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const i=(s+1)%3,r=(s+2)%3;n=Math.sqrt(e[3*s+s]-e[3*i+i]-e[3*r+r]+1),t[s]=.5*n,n=.5/n,t[3]=(e[3*i+r]-e[3*r+i])*n,t[i]=(e[3*i+s]+e[3*s+i])*n,t[r]=(e[3*r+s]+e[3*s+r])*n}return t}function _(t,e,s,n){const i=.5*Math.PI/180;e*=i,s*=i,n*=i;const r=Math.sin(e),o=Math.cos(e),a=Math.sin(s),l=Math.cos(s),h=Math.sin(n),u=Math.cos(n);return t[0]=r*l*u-o*a*h,t[1]=o*a*u+r*l*h,t[2]=o*l*h-r*a*u,t[3]=o*l*u+r*a*h,t}const f=l.c,y=l.s,x=l.g,v=c,b=l.d,P=l.h,S=l.l,E=l.j,C=E,w=l.b,I=w,T=l.n,A=l.a,M=l.e;function D(t,e,s){const n=(0,a.e)(e,s);return n<-.999999?((0,a.h)(N,F,e),(0,a.H)(N)<1e-6&&(0,a.h)(N,R,e),(0,a.n)(N,N),h(t,N,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):((0,a.h)(N,e,s),t[0]=N[0],t[1]=N[1],t[2]=N[2],t[3]=1+n,T(t,t))}const N=(0,r.vt)(),F=(0,r.fA)(1,0,0),R=(0,r.fA)(0,1,0);const k=(0,i.vt)(),L=(0,i.vt)();const G=(0,n.vt)();Object.freeze(Object.defineProperty({__proto__:null,add:x,calculateW:function(t,e){const s=e[0],n=e[1],i=e[2];return t[0]=s,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-s*s-n*n-i*i)),t},conjugate:g,copy:f,dot:P,equals:M,exactEquals:A,fromEuler:_,fromMat3:p,getAxisAngle:u,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},invert:d,len:C,length:E,lerp:S,mul:v,multiply:c,normalize:T,random:function(t){const e=o.Ov,s=e(),n=e(),i=e(),r=Math.sqrt(1-s),a=Math.sqrt(s);return t[0]=r*Math.sin(2*Math.PI*n),t[1]=r*Math.cos(2*Math.PI*n),t[2]=a*Math.sin(2*Math.PI*i),t[3]=a*Math.cos(2*Math.PI*i),t},rotateX:function(t,e,s){s*=.5;const n=e[0],i=e[1],r=e[2],o=e[3],a=Math.sin(s),l=Math.cos(s);return t[0]=n*l+o*a,t[1]=i*l+r*a,t[2]=r*l-i*a,t[3]=o*l-n*a,t},rotateY:function(t,e,s){s*=.5;const n=e[0],i=e[1],r=e[2],o=e[3],a=Math.sin(s),l=Math.cos(s);return t[0]=n*l-r*a,t[1]=i*l+o*a,t[2]=r*l+n*a,t[3]=o*l-i*a,t},rotateZ:function(t,e,s){s*=.5;const n=e[0],i=e[1],r=e[2],o=e[3],a=Math.sin(s),l=Math.cos(s);return t[0]=n*l+i*a,t[1]=i*l-n*a,t[2]=r*l+o*a,t[3]=o*l-r*a,t},rotationTo:D,scale:b,set:y,setAxes:function(t,e,s,n){const i=G;return i[0]=s[0],i[3]=s[1],i[6]=s[2],i[1]=n[0],i[4]=n[1],i[7]=n[2],i[2]=-e[0],i[5]=-e[1],i[8]=-e[2],T(t,p(t,i))},setAxisAngle:h,slerp:m,sqlerp:function(t,e,s,n,i,r){return m(k,e,i,r),m(L,s,n,r),m(t,k,L,2*r*(1-r)),t},sqrLen:I,squaredLength:w,str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}},Symbol.toStringTag,{value:"Module"}))},4754:(t,e,s)=>{s.d(e,{$B:()=>i,Qf:()=>h,Qh:()=>a,RS:()=>r,ez:()=>m,i5:()=>d,lM:()=>o,qK:()=>c});var n=s(86942);function i(t){return 32+t.length}const r=16;function o(t){if(!t)return 0;let e=c;for(const s in t)t.hasOwnProperty(s)&&(e+=l(t[s],!1));return e}function a(t){if(!t)return 0;if("number"==typeof t[0])return h(t);if(Array.isArray(t))return function(t){const e=t.length;if(0===e||"number"==typeof t[0])return u(t,8);let s=m;for(let n=0;n<e;n++)s+=l(t[n]);return s}(t);let e=c;for(const s in t)t.hasOwnProperty(s)&&(e+=l(t[s]));return e}function l(t,e=!0){switch(typeof t){case"object":return e?a(t):c;case"string":return i(t);case"number":return r;case"boolean":return 4;default:return 8}}function h(...t){return t.reduce(((t,e)=>t+(e?(0,n.iu)(e)?e.byteLength+d:Array.isArray(e)?u(e,r):0:0)),0)}function u(t,e){return m+t.length*e}const c=32,m=16,d=145},66471:(t,e,s)=>{s.d(e,{A:()=>u});var n,i=s(39831),r=s(4754),o=s(90086);!function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"}(n||(n={}));const a=4294967296,l=new TextDecoder("utf-8"),h=(0,i.A)("safari")||(0,i.A)("ios")?6:(0,i.A)("ff")?12:32;class u{constructor(t,e,s=0,i=(t?t.byteLength:0)){this._tag=0,this._dataType=n.unknown,this._init(t,e,s,i)}_init(t,e,s,n){this._data=t,this._dataView=e,this._pos=s,this._end=n}get usedMemory(){return 64+(0,r.Qf)(this._data)}asUnsafe(){return this}clone(){return new u(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const e=this._decodeVarint();if(this._tag=e>>3,this._dataType=7&e,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;if(t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128)return t;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)}getSInt64(){return this._decodeSVarint()}getBool(){const t=0!==this._data[this._pos];return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,e=this._pos,s=t.getUint32(e,!0)+t.getUint32(e+4,!0)*a;return this._skip(8),s}getSFixed64(){const t=this._dataView,e=this._pos,s=t.getUint32(e,!0)+t.getInt32(e+4,!0)*a;return this._skip(8),s}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),e=this._pos,s=this._toString(this._data,e,e+t);return this._skip(t),s}getBytes(){const t=this._getLength(),e=this._pos,s=this._toBytes(this._data,e,e+t);return this._skip(t),s}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,e,s,n){const i=this.getMessage(),r=t(i,e,s,n);return i.release(),r}processMessage(t){const e=this.getMessage(),s=t(e);return e.release(),s}getMessage(){const t=this._getLength(),e=u.pool.acquire();return e._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),e}release(){u.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case n.varint:this._decodeVarint();break;case n.fixed64:this._skip(8);break;case n.delimited:this._skip(this._getLength());break;case n.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let e=this._pos,s=0,n=0;if(this._end-e>=10)do{if(n=t[e++],s|=127&n,!(128&n))break;if(n=t[e++],s|=(127&n)<<7,!(128&n))break;if(n=t[e++],s|=(127&n)<<14,!(128&n))break;if(n=t[e++],s|=(127&n)<<21,!(128&n))break;if(n=t[e++],s+=268435456*(127&n),!(128&n))break;if(n=t[e++],s+=34359738368*(127&n),!(128&n))break;if(n=t[e++],s+=4398046511104*(127&n),!(128&n))break;if(n=t[e++],s+=562949953421312*(127&n),!(128&n))break;if(n=t[e++],s+=72057594037927940*(127&n),!(128&n))break;if(n=t[e++],s+=0x8000000000000000*(127&n),!(128&n))break;throw new Error("Varint too long!")}while(0);else{let i=1;for(;e!==this._end&&(n=t[e],128&n);)++e,s+=(127&n)*i,i*=128;if(e===this._end)throw new Error("Varint overrun!");++e,s+=n*i}return this._pos=e,s}_decodeSVarint(){const t=this._data;let e,s=0,n=0;const i=1&t[this._pos];if(n=t[this._pos++],s|=127&n,!(128&n))return i?-(s+1)/2:s/2;if(n=t[this._pos++],s|=(127&n)<<7,!(128&n))return i?-(s+1)/2:s/2;if(n=t[this._pos++],s|=(127&n)<<14,!(128&n))return i?-(s+1)/2:s/2;if(n=t[this._pos++],s|=(127&n)<<21,!(128&n))return i?-(s+1)/2:s/2;if(n=t[this._pos++],s+=268435456*(127&n),!(128&n))return i?-(s+1)/2:s/2;if(n=t[this._pos++],s+=34359738368*(127&n),!(128&n))return i?-(s+1)/2:s/2;if(n=t[this._pos++],s+=4398046511104*(127&n),!(128&n))return i?-(s+1)/2:s/2;if(e=BigInt(s),n=t[this._pos++],e+=0x2000000000000n*BigInt(127&n),!(128&n))return Number(i?-(e+1n)/2n:e/2n);if(n=t[this._pos++],e+=0x100000000000000n*BigInt(127&n),!(128&n))return Number(i?-(e+1n)/2n:e/2n);if(n=t[this._pos++],e+=0x8000000000000000n*BigInt(127&n),!(128&n))return Number(i?-(e+1n)/2n:e/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==n.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,e,s){if((s=Math.min(this._end,s))-e>h){const n=t.subarray(e,s);return l.decode(n)}let n="",i="";for(let r=e;r<s;++r){const e=t[r];128&e?i+="%"+e.toString(16):(n+=decodeURIComponent(i)+String.fromCharCode(e),i="")}return i.length&&(n+=decodeURIComponent(i)),n}_toBytes(t,e,s){return s=Math.min(this._end,s),new Uint8Array(t.buffer,e,s-e)}static{this.pool=new o.A(u,void 0,(t=>{t._data=null,t._dataView=null}))}}},45132:(t,e,s)=>{s.d(e,{n:()=>l});var n=s(98918),i=s(91109),r=s(34495);function o(t){t=t.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let e="";const s=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const n of t.match(s)||[])switch(n){case"D":e+="d";break;case"DD":e+="dd";break;case"DDD":e+="o";break;case"d":e+="c";break;case"ddd":e+="ccc";break;case"dddd":e+="cccc";break;case"M":e+="L";break;case"MM":e+="LL";break;case"MMM":e+="LLL";break;case"MMMM":e+="LLLL";break;case"YY":e+="yy";break;case"Y":case"YYYY":e+="yyyy";break;case"Q":e+="q";break;case"X":case"x":e+=n;break;default:n.length>=2&&"["===n.slice(0,1)&&"]"===n.slice(-1)?e+=`'${n.slice(1,-1)}'`:e+=`'${n}'`}return e}const a="esri.core.sql.dateonly";class l{constructor(t,e,s){this._year=t,this._month=e,this._day=s,this.declaredRootClass=a}static isDateOnly(t){return"object"==typeof t&&null!=t&&"declaredRootClass"in t&&t.declaredRootClass===a}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(t){return l.isDateOnly(t)&&t.day===this.day&&t.month===this.month&&t.year===this.year}clone(){return new l(this._year,this._month,this._day)}toDateTime(t){return r.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(t)})}toDateTimeLuxon(t){return r.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(t)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(t=null,e=!0){if(null===t||""===t)return this.toString();if(e&&(t=o(t)),!t)return"";const s=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(s).toFormat(t,{locale:(0,i.JK)(),numberingSystem:"latn"})}toArcadeDate(){const t=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(t)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(t,e){return l.fromDateTime(this.toUTCDateTime().plus({[t]:e}))}toUTCDateTime(){return r.c9.utc(this.year,this.month,this.day,0,0,0,0)}difference(t,e){switch(e.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(t.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===e?this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(t.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(t.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(t.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(t.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(t.toUTCDateTime(),"years").years}}static fromMilliseconds(t){const e=r.c9.fromMillis(t,{zone:r.mQ.utcInstance});return e.isValid?l.fromParts(e.year,e.month,e.day):null}static fromSeconds(t){const e=r.c9.fromSeconds(t,{zone:r.mQ.utcInstance});return e.isValid?l.fromParts(e.year,e.month,e.day):null}static fromReader(t){if(!t)return null;const e=t.split("-");return 3!==e.length?null:new l(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10))}static fromParts(t,e,s){const n=new l(t,e,s);return!1===n.isValid?null:n}static fromDateJS(t){return l.fromParts(t.getFullYear(),t.getMonth()+1,t.getDay())}static fromDateTime(t){return l.fromParts(t.year,t.month,t.day)}static fromSqlTimeStampOffset(t){return this.fromDateTime(t.toDateTime())}static fromString(t,e=null){if(""===t)return null;if(null===t)return null;const s=[];if(e)(e=o(e))&&s.push(e);else if(null===e||""===e){const e=r.c9.fromISO(t,{setZone:!0});return e.isValid?l.fromParts(e.year,e.month,e.day):null}for(const n of s){const s=r.c9.fromFormat(t,e??n);if(s.isValid)return new l(s.year,s.month,s.day)}return null}static fromNow(t="system"){const e=r.c9.fromJSDate(new Date).setZone((0,n.mT)(t));return new l(e.year,e.month,e.day)}}},40845:(t,e,s)=>{s.d(e,{k:()=>l});var n=s(47303),i=s(91109),r=s(34495);function o(t){if(!t)return"";const e=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let s="";for(const n of t.match(e)||[])switch(n){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":s+=n;break;case"A":case"a":s+="a";break;default:s+=`'${n}'`}return s}const a="esri.core.sql.timeonly";class l{constructor(t,e,s,n){this._hour=t,this._minute=e,this._second=s,this._millisecond=n,this.declaredRootClass=a}static isTimeOnly(t){return"object"==typeof t&&null!=t&&"declaredRootClass"in t&&t.declaredRootClass===a}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(t){return l.isTimeOnly(t)&&t.hour===this.hour&&t.minute===this.minute&&t.second===this.second&&t.millisecond===this.millisecond}clone(){return new l(this.hour,this.minute,this.second,this.millisecond)}isValid(){return(0,n.Fq)(this.hour)&&(0,n.Fq)(this.minute)&&(0,n.Fq)(this.second)&&(0,n.Fq)(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(t=null){return null===t||""===t?this.toString():(t=o(t))?r.c9.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(t,{locale:(0,i.JK)(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(t,e,s,n){const i=new l(t,e,s,n);return i.isValid()?i:null}static fromReader(t){if(!t)return null;const e=t.split(":");return 3!==e.length?null:new l(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10),0)}static fromMilliseconds(t){if(t>864e5||t<0)return null;const e=Math.floor(t/1e3%60),s=Math.floor(t/6e4%60),n=Math.floor(t/36e5%24),i=Math.floor(t%1e3);return new l(n,s,e,i)}static fromDateJS(t){return new l(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}static fromDateTime(t){return new l(t.hour,t.minute,t.second,t.millisecond)}static fromSqlTimeStampOffset(t){return this.fromDateTime(t.toDateTime())}static fromString(t,e=null){if(""===t)return null;if(null===t)return null;const s=[];e?(e=o(e))&&s.push(e):null!==e&&""!==e||(s.push("HH:mm:ss"),s.push("HH:mm:ss.SSS"),s.push("hh:mm:ss a"),s.push("hh:mm:ss.SSS a"),s.push("HH:mm"),s.push("hh:mm a"),s.push("H:mm"),s.push("h:mm a"),s.push("H:mm:ss"),s.push("h:mm:ss a"),s.push("H:mm:ss.SSS"),s.push("h:mm:ss.SSS a"));for(const n of s){const e=r.c9.fromFormat(t,n);if(e.isValid)return new l(e.hour,e.minute,e.second,e.millisecond)}return null}plus(t,e){switch(t){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return l.fromDateTime(this.toUTCDateTime().plus({[t]:e}))}return null}toUTCDateTime(){return r.c9.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(t,e){switch(e.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(t.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===e?this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(t.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(t.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(t.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(t.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(t.toUTCDateTime(),"years").years}}}},90709:(t,e,s)=>{s.d(e,{GB:()=>i,Qo:()=>o,Y4:()=>r});var n=s(34495);class i{static{this.instance=new n.oh("Etc/UTC")}}function r(t){return t instanceof n.bo?t===i.instance:"unknown"===t?.toString().toLowerCase()}function o(t){return r(t)?i.instance:t}},14816:(t,e,s)=>{s.d(e,{z:()=>a});var n=s(19251),i=s(18159),r=s(1171),o=s(88443);class a{static fromOptimized(t,e,s=!1,n=!1,i=1){return(new l).initialize(t,e,s,n,i)}static fromJSON(t,e=!1,s=!1){const[n,i]=u(t);return(new c).initialize(n,i,e,s,1)}static fromOptimizedCIM(t,e,s=!1,n=!1,i=1){return(new m).initialize(t,e,s,n,i)}static fromJSONCIM(t,e=!1,s=!1,n=1){const[i,r]=u(t);return(new d).initialize(i,r,e,s,n)}static fromFeatureSetReader(t){const e=t.readGeometryForDisplay(),s=t.geometryType;return e&&s?this.fromOptimized(e,s):null}static fromFeatureSetReaderCIM(t){const e=t.readGeometryForDisplay(),s=t.geometryType;return e&&s?this.fromOptimizedCIM(e,s):null}static createEmptyOptimized(t,e=!1,s=!1,n=1){return(new l).initialize(new o.A,t,e,s,n)}static createEmptyJSON(t,e=!1,s=!1){return(new c).initialize([],t,e,s,1)}static createEmptyOptimizedCIM(t,e=!1,s=!1,n=1){return(new m).initialize(new o.A,t,e,s,n)}static createEmptyJSONCIM(t,e=!1,s=!1,n=1){return(new d).initialize([],t,e,s,n)}asJSON(){const t=(0,i.x)(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:t[0][0][0],ymin:t[0][0][1],xmax:t[0][2][0],ymax:t[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:t.flat()}:"esriGeometryPoint"===this.geometryType?{x:t[0][0][0],y:t[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:t}:{paths:t}}getCurrentRingArea(){if(this.pathSize<3)return 0;let t,e,s=0;if(this.seekPathStart(),!this.nextPoint())return 0;t=this.x,e=this.y;const n=t,i=e;for(;this.nextPoint();)s+=(t-this.x)*(e+this.y),t=this.x,e=this.y;return s+=(t-n)*(e+i),-.5*s}invertY(){this.yFactor*=-1}}class l extends a{constructor(){super(...arguments),this._end=-1}initialize(t,e,s,n,i){return this.hasZ=s,this.hasM=n,this.geometryType=e,this._stride=2+Number(s)+Number(n),this._geometry=t,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=i,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(t){if(t>=0&&t<this.totalSize){if(this._pathIndex<t)for(;this._pathIndex<t&&this.nextPath(););else if(this._pathIndex>t)for(;this._pathIndex>t&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(t){const e=this._pathOffset+t*this._stride;return e>=0&&e<this._end&&(this._pointOffset=e,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1||(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,0))}prevPath(){return!(this.pathIndex<=0||(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,0))}getCurrentPath(){const t=this._end,e=this._geometry.coords,s=this._pathOffset;return(new l).initialize(new o.A([this.pathSize],e.slice(s,t)),this.geometryType,this.hasZ,this.hasM,this.yFactor)}pathLength(){const t=this._end,e=this._stride,s=this._geometry.coords;let n=0;for(let i=this._pathOffset+e;i<t;i+=e){const t=s[i-e],r=s[i-e+1],o=s[i]-t,a=s[i+1]-r;n+=Math.sqrt(o*o+a*a)}return n}startPath(){this._geometry.lengths.push(0)}pushPath(t){this.startPath(),this.pushPoints(t)}pushPoint(t){for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]++}pushXY(t,e){this._geometry.coords.push(t,e),this._geometry.lengths[this.totalSize-1]++}pushPoints(t){for(const e of t)for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]+=t.length}pushCursor(t){const e=t.asOptimized();this._geometry.coords.push(...e.coords),this._geometry.lengths.push(...e.lengths)}asOptimized(){const t=this._geometry.clone();if(1!==this.yFactor)for(let e=1;e<t.coords.length;e+=this._stride)t.coords[e]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(t.lengths.length=0),t}isClosed(){const t=this._geometry.coords,e=this._pathOffset,s=this._end-this._stride;for(let n=0;n<this._stride;n++)if(t[e+n]!==t[s+n])return!1;return!0}clone(){return(new l).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce(((t,e)=>t+e))}get pathSize(){const{lengths:t}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>t.length-1?0:t[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(t){this._geometry.coords[this._pointOffset]=t}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(t){this._geometry.coords[this._pointOffset+1]=this.yFactor*t}get z(){return this._geometry.coords[this._pointOffset+2]}set z(t){this._geometry.coords[this._pointOffset+2]=t}get m(){const t=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+t]}set m(t){this._geometry.coords[this._pointOffset+3]=t}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function h(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function u(t){return(0,r.Bi)(t)?[t.rings,"esriGeometryPolygon"]:(0,r.Rg)(t)?[t.paths,"esriGeometryPolyline"]:(0,r.U9)(t)?[[t.points],"esriGeometryMultipoint"]:(0,r.ZC)(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:(0,r.fT)(t)?[[[h(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class c extends a{initialize(t,e,s,n,i){return this._paths=t,this.geometryType=e,this.hasZ=s,this.hasM=n,this._pathIndex=this._pointIndex=-1,this.yFactor=i,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(t){return this._pathIndex=t,this._pointIndex=-1,t>=0&&t<this.totalSize&&(this._currentPath=this._paths[t],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(t){return t>=0&&t<this._currentPath.length&&(this._pointIndex=t,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const t=this._currentPath.length,e=this._currentPath;let s=0;for(let n=1;n<t;n++){const t=e[n-1],i=e[n],r=t[0],o=t[1],a=i[0]-r,l=i[1]-o;s+=Math.sqrt(a*a+l*l)}return s}startPath(){this._paths.push([])}getCurrentPath(){return(new c).initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(t){this._paths.push(t)}pushPoint(t){this._paths[this.totalSize-1].push(t)}pushXY(t,e){this._paths[this.totalSize-1].push([t,e])}pushPoints(t){this._paths[this.totalSize-1].push(...t)}pushCursor(t){const e=(0,i.x)(t);for(const s of e)this.pushPath(s)}asOptimized(){const t=new o.A;if("esriGeometryPoint"===this.geometryType)t.coords.push(...this._paths[0][0]),t.lengths.length=0;else for(const e of this._paths){for(const s of e)t.coords.push(s[0]),t.coords.push(s[1]*this.yFactor),this.hasZ&&t.coords.push(s[2]),this.hasM&&t.coords.push(s[this._mIndex]);t.lengths.push(e.length)}return t}isClosed(){const t=this._currentPath[0],e=this._currentPath[this._currentPath.length-1];for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}clone(){return(new c).initialize((0,n.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map((t=>t.length)).reduce(((t,e)=>t+e))}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(t){this._currentPoint[0]=t}get y(){return this.yFactor*this._currentPoint[1]}set y(t){this._currentPoint[1]=this.yFactor*t}get z(){return this._currentPoint[2]}set z(t){this._currentPoint[2]=t}get m(){return this._currentPoint[this._mIndex]}set m(t){this._currentPoint[this._mIndex]=t}get pathIndex(){return this._pathIndex}}class m extends l{initialize(t,e,s,n,i){return super.initialize(t,e,s,n,i),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map((t=>new Set))),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const t=(new m).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return t._controlPoints=this._controlPoints,t}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(t){this._controlPoints[this.pathIndex].add(t)}getControlPointAt(t){return this._controlPoints[this.pathIndex].has(t)}}class d extends c{initialize(t,e,s,n,i){return super.initialize(t,e,s,n,i)}clone(){return(new d).initialize((0,n.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(t){this._paths[this.pathIndex][t][4]=1}getControlPointAt(t){return 1===this._paths[this.pathIndex][t][4]}}},27243:(t,e,s)=>{s.d(e,{g:()=>n});const n={convertToGEGeometry:function(t,e){return null==e?null:t.convertJSONToGeometry(e)},exportPoint:function(t,e,s){const n=new i(t.getPointX(e),t.getPointY(e),s),r=t.hasZ(e),o=t.hasM(e);return r&&(n.z=t.getPointZ(e)),o&&(n.m=t.getPointM(e)),n},exportPolygon:function(t,e,s){return new r(t.exportPaths(e),s,t.hasZ(e),t.hasM(e))},exportPolyline:function(t,e,s){return new o(t.exportPaths(e),s,t.hasZ(e),t.hasM(e))},exportMultipoint:function(t,e,s){return new a(t.exportPoints(e),s,t.hasZ(e),t.hasM(e))},exportExtent:function(t,e,s){const n=t.hasZ(e),i=t.hasM(e),r=new l(t.getXMin(e),t.getYMin(e),t.getXMax(e),t.getYMax(e),s);if(n){const s=t.getZExtent(e);r.zmin=s.vmin,r.zmax=s.vmax}if(i){const s=t.getMExtent(e);r.mmin=s.vmin,r.mmax=s.vmax}return r}};class i{constructor(t,e,s){this.x=t,this.y=e,this.spatialReference=s,this.z=void 0,this.m=void 0}}class r{constructor(t,e,s,n){this.rings=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,s&&(this.hasZ=s),n&&(this.hasM=n)}}class o{constructor(t,e,s,n){this.paths=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,s&&(this.hasZ=s),n&&(this.hasM=n)}}class a{constructor(t,e,s,n){this.points=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,s&&(this.hasZ=s),n&&(this.hasM=n)}}class l{constructor(t,e,s,n,i){this.xmin=t,this.ymin=e,this.xmax=s,this.ymax=n,this.spatialReference=i,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},62900:(t,e,s)=>{s.r(e),s.d(e,{fromExtent:()=>x,fromGeometry:()=>y,fromMultipoint:()=>v,fromPoint:()=>b,fromPolygon:()=>P,fromPolyline:()=>S,fromSpatialReference:()=>E,getSpatialReference:()=>f,toExtent:()=>w,toGeometry:()=>C,toMultipoint:()=>I,toPoint:()=>T,toPolygon:()=>A,toPolyline:()=>M});var n=s(86330),i=(s(21566),s(62188)),r=s(75992),o=s(74642),a=s(57592),l=s(84698),h=s(90067),u=s(97066),c=s(62802),m=s(42238),d=(s(84966),s(60628));const g="_gxVersion",p=2,_=1;function f(t){return Array.isArray(t)?t[0].spatialReference:t.spatialReference}function y(t){switch(t.type){case"point":return b(t);case"multipoint":return v(t);case"polyline":return S(t);case"polygon":return P(t);case"extent":return x(t);default:throw new Error(`Unsupported geometry type: ${t.type}`)}}function x(t){if(!t.getCacheValue(g)){const e=new r.E;e.setCoords(t.xmin,t.ymin,t.xmax,t.ymax),t.hasM&&e.setInterval(p,0,t.mmin,t.mmax),t.hasZ&&e.setInterval(_,0,t.zmin,t.zmax),t.setCacheValue(g,e)}return t.getCacheValue(g)}function v(t){if(!t.getCacheValue(g)){const e=new o.M,s=new r.P,n=t.points,i=t.hasM,a=t.hasZ,l=a?3:2;for(let t=0,r=n.length;t<r;t++){const r=n[t];s.setXYCoords(r[0],r[1]),a&&s.setZ(r[2]??0),i&&s.setM(r[l]??NaN),e.add(s)}t.setCacheValue(g,e)}return t.getCacheValue(g)}function b(t){if(!t.getCacheValue(g)){const e=new r.P;e.setXYCoords(t.x,t.y),t.hasM&&e.setM(t.m),t.hasZ&&e.setZ(t.z),t.setCacheValue(g,e)}return t.getCacheValue(g)}function P(t){if(!t.getCacheValue(g)){const{curveRings:e,hasM:s,hasZ:n,rings:i}=t,r=(0,d.fromGeometryToGXGeometry)({curveRings:e,hasM:s,hasZ:n,rings:i});t.setCacheValue(g,r)}return t.getCacheValue(g)}function S(t){if(!t.getCacheValue(g)){const{curvePaths:e,hasM:s,hasZ:n,paths:i}=t,r=(0,d.fromGeometryToGXGeometry)({curvePaths:e,hasM:s,hasZ:n,paths:i});t.setCacheValue(g,r)}return t.getCacheValue(g)}function E(t){if(t.wkid)return(0,a.c)(t.wkid);const e=t.wkt2||t.wkt;return e?(0,a.a)(e):null}function C(t,e){if(t)switch(t.getGeometryType()){case i.G.enumPoint:return T(t,e);case i.G.enumEnvelope:return w(t,e);case i.G.enumMultiPoint:return I(t,e);case i.G.enumPolyline:return M(t,e);case i.G.enumPolygon:return A(t,e)}return null}function w(t,e){if(t.isEmpty())return null;const s=new l.A({xmin:t.getXMin(),ymin:t.getYMin(),xmax:t.getXMax(),ymax:t.getYMax(),spatialReference:e}),n=t.getDescription();if(n.hasM()){const e=t.queryInterval(p,0);s.mmin=e.vmin,s.mmax=e.vmax}if(n.hasZ()){const e=t.queryInterval(_,0);s.zmin=e.vmin,s.zmax=e.vmax}return s.setCacheValue(g,t),s}function I(t,e){if(t.isEmpty())return null;const s=t.getDescription(),n=s.hasM(),i=s.hasZ(),o=[],a=new r.P;for(let r=0,h=t.getPointCount();r<h;r++){t.getPointByVal(r,a);const e=[a.getX(),a.getY()];i&&e.push(a.getZ()),n&&e.push(a.getM()),o.push(e)}const l=new h.A({hasM:n,hasZ:i,points:o,spatialReference:e});return l.setCacheValue(g,t),l}function T(t,e){if(t instanceof n.P)return new u.A({x:t.x,y:t.y,spatialReference:e});if(t.isEmpty())return null;const s=new u.A({x:t.getX(),y:t.getY(),spatialReference:e}),i=t.getDescription();return i.hasM()&&(s.m=t.getM()),i.hasZ()&&(s.z=t.getZ()),s.setCacheValue(g,t),s}function A(t,e){if(t.isEmpty())return null;const s=c.A.fromJSON({spatialReference:e,...(0,d.toGeometry)(t,null)});return s.setCacheValue(g,t),s}function M(t,e){if(t.isEmpty())return null;const s=m.A.fromJSON({spatialReference:e,...(0,d.toGeometry)(t,null)});return s.setCacheValue(g,t),s}},84966:(t,e,s)=>{s(21566),s(62188),s(74642),s(75992),s(86330);var n=s(57592),i=s(92976),r=s(87926);(0,n.i)((t=>{let e,s;"number"==typeof t?e=t:s=t;const n={wkid:e,wkt:s};let o,a;if(s){o=(0,i.x1)(s);const t=(0,r.EA)(n);if(!o&&!t)throw new Error(`Unsupported WKT type: ${s}`)}else o=!(0,r.EA)(n);return a=e&&i.yD.has(e)?Math.PI/200:o?(0,i.Ao)(n):Math.PI/180,{isPCS:o,metersOrRadiansPerUnit:a,semiMajor:0,wkidOrWkt:t}}))},60628:(t,e,s)=>{s.r(e),s.d(e,{fromGeometries:()=>ht,fromGeometry:()=>ut,fromGeometryToGXGeometry:()=>ct,getSpatialReference:()=>at,toGeometry:()=>mt});var n=s(62188),i=s(86330),r=s(57592),o=s(75992),a=s(74642);s(84966);function l(){if(-1===this.m_i)return this.m_i=0,{value:{m_token:1,m_value:null},done:!1};if(this.m_i<this.m_keys.length){const t=this.m_bReturnKey,e=Math.trunc(this.m_i);return this.m_bReturnKey=!this.m_bReturnKey,this.m_i+=.5,t?{value:{m_token:5,m_value:this.m_keys[e]},done:!1}:{value:{m_token:6,m_value:this.m_o[this.m_keys[e]]},done:!1}}return{value:{m_token:3,m_value:null},done:!0}}function h(){if(-1===this.m_i)return this.m_i=0,{value:{m_token:2,m_value:null},done:!1};if(this.m_i<this.m_a.length){const t={value:{m_token:6,m_value:this.m_a[this.m_i++]},done:!1};return this.m_strict||void 0===t.value.m_value&&(t.value.m_value=Number.NaN),t}return{value:{m_token:4,m_value:null},done:!0}}class u{createJSONObjectIterator(t){return{m_iteratorType:"object",m_o:t,m_keys:this.m_options.strict?Object.keys(t):Object.keys(t).filter((e=>void 0!==t[e])),m_i:-1,m_bReturnKey:!0,next:l}}createJSONArrayIterator(t){return{m_iteratorType:"array",m_strict:this.m_options.strict,m_i:-1,m_a:t,next:h}}constructor(t,e){this.m_currentToken=0,this.m_options=e?{...e}:{strict:!0};const s=t;this.m_iteratorStack=[s instanceof Array?this.createJSONArrayIterator(s):this.createJSONObjectIterator(s)],this.m_nextFlatToken={m_value:null,m_token:0}}nextToken(){if(0===this.m_iteratorStack.length)return this.m_currentToken=0;switch(this.m_nextFlatToken=this.m_iteratorStack.at(-1).next().value,this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_currentToken=1;case 3:return this.m_iteratorStack.pop(),this.m_currentToken=3;case 2:return this.m_currentToken=2;case 4:return this.m_iteratorStack.pop(),this.m_currentToken=4;case 5:return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=5;case 6:if(this.m_nextFlatToken.m_value instanceof Array)return this.m_iteratorStack.push(this.createJSONArrayIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(this.m_nextFlatToken.m_value instanceof Object)return this.m_iteratorStack.push(this.createJSONObjectIterator(this.m_nextFlatToken.m_value)),this.nextToken();if("number"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=this.m_nextFlatToken.m_value,Number.isSafeInteger(this.m_currentValue)&&this.m_currentValue>=(0,i.ar)()&&this.m_currentValue<=(0,i.i)()?this.m_currentToken=8:this.m_currentToken=7;if("string"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=6;if("boolean"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=this.m_nextFlatToken.m_value?11:12;if("object"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=null,this.m_currentToken=10;(0,n.d)("unrecognized json element type")}return(0,n.d)("unrecognized json element type"),0}currentToken(){return this.m_currentToken}skipChildren(){if(0!==this.m_iteratorStack.length)switch(this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=3,void(this.m_currentToken=3);case 2:return this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=4,void(this.m_currentToken=4)}}currentString(){return 6!==this.m_currentToken&&5!==this.m_currentToken&&(0,n.a)("invalid token"),this.m_currentValue}currentDoubleValue(){return 7!==this.m_currentToken&&8!==this.m_currentToken&&(0,n.a)("invalid token"),this.m_currentValue}currentInt32Value(){return 8!==this.m_currentToken&&(0,n.a)("invalid token"),this.m_currentValue}currentInt64Value(){return(0,n.g)(0),0n}currentBoolValue(){return 12!==this.m_currentToken&&11!==this.m_currentToken&&(0,n.a)("invalid token"),this.m_currentValue}isError(){return 0}}class c{constructor(t){return this.m_buffer=null,this.m_view=null,this.m_sz=0,this.m_offset=0,this.m_bOwnsBuffer=!0,this.m_bLittleEndian=!0,this.m_element=new ArrayBuffer(8),this.m_elementBytes=new Uint8Array(this.m_element),this.m_elementView=new DataView(this.m_element),this.m_elementDouble=new Float64Array(this.m_element),this.m_elementFloat=new Float32Array(this.m_element),this.m_elementInt64=new BigInt64Array(this.m_element),this.m_elementInt32=new Int32Array(this.m_element),this.m_elementInt16=new Int16Array(this.m_element),void 0!==t.sz?(this.m_sz=t.sz,t.buffer?(this.m_sz<0&&(0,n.q)("size out of range"),this.m_buffer=t.buffer,this.m_offset=void 0!==t.offset?t.offset:0,this.m_view=void 0!==t.offset?new DataView(t.buffer,t.offset,t.sz):new DataView(this.m_buffer),this.m_bOwnsBuffer=!1,void(this.m_bLittleEndian=!0)):(this.m_sz<0&&(0,n.q)("size out of range"),void(this.m_sz>0&&(this.m_buffer=new ArrayBuffer(this.m_sz),this.m_view=new DataView(this.m_buffer))))):t.move?(this.m_sz=t.move.m_sz,this.m_buffer=t.move.m_buffer,this.m_view=t.move.m_view,this.m_bOwnsBuffer=t.move.m_bOwnsBuffer,this.m_bLittleEndian=t.move.m_bLittleEndian,t.move.m_buffer=null,t.move.m_view=null,t.move.m_sz=0,void(t.move.m_bOwnsBuffer=!0)):void(0,n.d)("unrecognized constructor options")}swapBytesDouble(){this.doSwap()&&(this.m_elementDouble[0]=this.m_elementBytes[0]<<56|this.m_elementBytes[1]<<48|this.m_elementBytes[2]<<40|this.m_elementBytes[3]<<32|this.m_elementBytes[4]<<24|this.m_elementBytes[5]<<16|this.m_elementBytes[6]<<8|this.m_elementBytes[7])}swapBytesInt32(){this.doSwap()&&(this.m_elementInt32[0]=this.m_elementBytes[0]<<24|this.m_elementBytes[1]<<16|this.m_elementBytes[2]<<8|this.m_elementBytes[3])}getOffset(){return this.m_offset}assignMove(t){return this===t||(this.clear(),this.m_sz=t.m_sz,this.m_buffer=t.m_buffer,this.m_view=t.m_view,this.m_bOwnsBuffer=t.m_bOwnsBuffer,this.m_bLittleEndian=t.m_bLittleEndian,t.m_buffer=null,t.m_sz=0,t.m_bOwnsBuffer=!0),this}doSwap(){return this.m_bLittleEndian!==(1===c.getNativeByteOrder())}setNativeByteOrder(){this.m_bLittleEndian=1===c.getNativeByteOrder()}setOrder(t){this.m_bLittleEndian=1===t}getOrder(){return this.m_bLittleEndian?1:0}getView(){return this.m_view||(0,n.p)("buffer not defined"),this.m_view}static getNativeByteOrder(){return 1}clear(){this.m_buffer=null,this.m_sz=0,this.m_bOwnsBuffer=!0}size(){return this.m_sz}readDouble(t){return this.doSwap()?(this.m_elementDouble[0]=this.m_view.getFloat64(t,this.m_bLittleEndian),this.swapBytesDouble(),this.m_elementDouble[0]):this.m_view.getFloat64(t,this.m_bLittleEndian)}writeDouble(t,e){this.m_elementDouble[0]=e,this.swapBytesDouble(),this.m_view.setFloat64(t,this.m_elementDouble[0],this.m_bLittleEndian)}readInt32(t){return this.doSwap()?(this.m_elementInt32[0]=this.m_view.getInt32(t,this.m_bLittleEndian),this.swapBytesInt32(),this.m_elementInt32[0]):this.m_view.getInt32(t,this.m_bLittleEndian)}writeInt32(t,e){this.m_elementInt32[0]=e,this.swapBytesInt32(),this.m_view.setInt32(t,this.m_elementInt32[0],this.m_bLittleEndian)}getPtr(){return this.m_buffer}setSizeNoRealloc(t){(0,n.g)(t>=0&&t<=this.m_sz),this.m_sz=t}}function m(t,e,s,i,r,l){let h=!1,u=!1,c=!1,m=!1,d=!1,v=!1,b=!1,P=!1,S=!1,E=!1,C=!1,w=!1,I=!1,T=!1,A=!1,M=!1,D=!1,N=!1,F=!1,R=!1,k=!1,L=!1,G=!1,V=!1,z=Number.NaN,O=Number.NaN,q=Number.NaN,B=Number.NaN,Y=0,U=Number.NaN,H=Number.NaN,X=Number.NaN,j=Number.NaN,Z=Number.NaN,W=Number.NaN,$=Number.NaN,K=Number.NaN,Q=0,J=0,tt=!1,et=!1,st=null,nt=null,it=null,rt=null,ot=null;for(;3!==s.nextToken();){const o=s.currentString();if(s.nextToken(),"spatialReference"===o){if(r&&!h){h=!0,1===s.currentToken()?rt=g(s):10!==s.currentToken()&&(0,n.a)("failed to parse spatial reference: object or null is expected");continue}}else if(i)if("hasZ"===o){if(!u){u=!0,tt=11===s.currentToken();continue}}else if("hasM"===o){if(!c){c=!0,et=11===s.currentToken();continue}}else if("rings"===o){if(!(d||v||t!==n.G.enumUnknown&&t!==n.G.enumPolygon)){d=!0,({geometry:ot,as:st,bs:nt}=p(!0,!1,e,s));continue}}else if("curveRings"===o){if(!v&&(t===n.G.enumUnknown||t===n.G.enumPolygon)){v=!0,({geometry:ot,as:st,bs:nt}=p(!0,!0,e,s));continue}}else if("paths"===o){if(!(b||P||t!==n.G.enumUnknown&&t!==n.G.enumPolyline)){b=!0,({geometry:ot,as:st,bs:nt}=p(!1,!1,e,s));continue}}else if("curvePaths"===o){if(!P&&(t===n.G.enumUnknown||t===n.G.enumPolyline)){P=!0,({geometry:ot,as:st,bs:nt}=p(!1,!0,e,s));continue}}else if("points"===o){if(!S&&(t===n.G.enumUnknown||t===n.G.enumMultiPoint)){S=!0,({geometry:ot,as:st,bs:nt}=_(e,s));continue}}else if("ids"===o){if(!m){m=!0,it=f(e,s);continue}}else if("x"===o){if(!E&&(t===n.G.enumUnknown||t===n.G.enumPoint)){E=!0,z=y(s);continue}}else if("y"===o){if(!C&&(t===n.G.enumUnknown||t===n.G.enumPoint)){C=!0,O=y(s);continue}}else if("z"===o){if(!w&&(t===n.G.enumUnknown||t===n.G.enumPoint)){w=!0,q=y(s);continue}}else if("m"===o){if(!I&&(t===n.G.enumUnknown||t===n.G.enumPoint)){I=!0,B=y(s);continue}}else if("id"===o){if(!T&&(t===n.G.enumUnknown||t===n.G.enumPoint)){T=!0,Y=x(s);continue}}else if("xmin"===o){if(!A&&(t===n.G.enumUnknown||t===n.G.enumEnvelope)){A=!0,U=y(s);continue}}else if("ymin"===o){if(!M&&(t===n.G.enumUnknown||t===n.G.enumEnvelope)){M=!0,H=y(s);continue}}else if("mmin"===o){if(!k&&(t===n.G.enumUnknown||t===n.G.enumEnvelope)){k=!0,$=y(s);continue}}else if("zmin"===o){if(!F&&(t===n.G.enumUnknown||t===n.G.enumEnvelope)){F=!0,Z=y(s);continue}}else if("idmin"===o){if(!G&&(t===n.G.enumUnknown||t===n.G.enumEnvelope)){G=!0,Q=x(s);continue}}else if("xmax"===o){if(!D&&(t===n.G.enumUnknown||t===n.G.enumEnvelope)){D=!0,X=y(s);continue}}else if("ymax"===o){if(!N&&(t===n.G.enumUnknown||t===n.G.enumEnvelope)){N=!0,j=y(s);continue}}else if("mmax"===o){if(!L&&(t===n.G.enumUnknown||t===n.G.enumEnvelope)){L=!0,K=y(s);continue}}else if("zmax"===o){if(!R&&(t===n.G.enumUnknown||t===n.G.enumEnvelope)){R=!0,W=y(s);continue}}else if("idmax"===o){if(!V&&(t===n.G.enumUnknown||t===n.G.enumEnvelope)){V=!0,J=x(s);continue}}else"materials"===o&&(0,n.g)(0);s.skipChildren()}if(d||v||b||P||S){let t=null,e=null;const s=ot;tt&&(ot.addAttribute(1),t=st,t||(t=(0,o.D)(s.getPointCount(),Number.NaN))),et&&(ot.addAttribute(2),e=tt?nt:st),null!=it&&ot.addAttribute(3),tt&&null!=t&&s.setAttributeStreamRef(1,t),et&&null!=e&&s.setAttributeStreamRef(2,e),null!=it&&function(t,e){if(t.isEmpty())return;const s=(0,o.K)(2,0),i=t.getGeometryType();let r=0;i===a.M.type?r=1:i===a.P.type||i===a.a.type?r=t.getPathCount():(0,n.d)("not implemented"),s.resize(t.getPointCount(),0);let l=0;for(let o=0;o<r;++o){const r=e.read(l);l++;const h=l+r;let u=0,c=0;i===a.M.type?u=t.getPointCount():i===a.P.type||i===a.a.type?(u=t.getPathSize(o),c=t.getPathStart(o)):(0,n.d)("not implemented");for(let t=0,n=Math.min(r,u);t<n;++t)s.write(c,e.read(l)),l++,c++;l=h}t.getImpl().setAttributeStreamRef(3,s)}(s,it)}else if(E||C||I||w||T){(0,o.I)(z,O)||(0,n.a)("failed to parse point: x and y must be finite or nan"),(Number.isNaN(O)||Number.isNaN(z))&&(z=Number.NaN,O=Number.NaN);const t=new o.P({x:z,y:O});w&&t.setZ(q),I&&t.setM(B),T&&t.setID(Y),ot=t}else if(A||M||D||N||F||R||k||L||G||V){(Number.isNaN(H)||Number.isNaN(X)||Number.isNaN(j))&&(U=Number.NaN);const t=new o.E({xmin:U,ymin:H,xmax:X,ymax:j});F&&R&&t.setInterval(1,0,Z,W),k&&L&&t.setInterval(2,0,$,K),G&&V&&t.setInterval(3,0,Q,J),ot=t}return{...ot?{geom:ot}:{},...rt?{sr:rt}:{}}}function d(t){let e=!1;for(;3!==t.nextToken();){const s=t.currentString();t.nextToken(),"uwkid"===s?e||(e=!0,8===t.currentToken()&&t.currentInt32Value()):t.skipChildren()}return null}function g(t){let e=!1,s=!1,n=!1,i=!1,o=!1,a=!1,l=!1,h=!1,u=!1,c=!1,m=!1,g=!1,p=!1,_=!1,f=!1,y=!1,x=!1,v=-1,b=-1,P=-1,S=-1,E=0,C=0,w=0,I=0,T=0,A=0,M=0,D=0,N=0,F=0,R="",k="",L=null;for(;3!==t.nextToken();){const r=t.currentString();t.nextToken(),"wkid"===r?e||(e=!0,8===t.currentToken()&&(v=t.currentInt32Value())):"latestWkid"===r?s||(s=!0,8===t.currentToken()&&(b=t.currentInt32Value())):"wkt"===r?o||(o=!0,6===t.currentToken()&&(R=t.currentString())):"wkt2"===r?o||6===t.currentToken()&&(k=t.currentString()):"vcsWkid"===r?n||(n=!0,8===t.currentToken()&&(P=t.currentInt32Value())):"latestVcsWkid"===r?i||(i=!0,8===t.currentToken()&&(S=t.currentInt32Value())):"xyTolerance"===r?l||(l=!0,a=!0,E=t.currentDoubleValue()):"zTolerance"===r?h||(h=!0,a=!0,C=t.currentDoubleValue()):"mTolerance"===r?u||(u=!0,a=!0,w=t.currentDoubleValue()):"falseX"===r?c||(c=!0,a=!0,M=t.currentDoubleValue()):"falseY"===r?m||(m=!0,a=!0,D=t.currentDoubleValue()):"falseZ"===r?g||(g=!0,a=!0,N=t.currentDoubleValue()):"falseM"===r?p||(p=!0,a=!0,F=t.currentDoubleValue()):"xyUnits"===r?_||(_=!0,a=!0,I=t.currentDoubleValue()):"zUnits"===r?f||(f=!0,a=!0,T=t.currentDoubleValue()):"mUnits"===r?y||(y=!0,a=!0,A=t.currentDoubleValue()):"unit"===r?x||(x=!0,L=d(t)):t.skipChildren()}S<=0&&P>0&&(S=P),P<=0&&S>0&&(P=S);let G=null,V=!0;if(0!==R.length&&(V=!1,(0,r.aA)(R)&&(G=(0,r.a)(R))),G||0===k.length||(V=!1,(0,r.aA)(k)&&(G=(0,r.a)(k))),!G&&b>0&&(V=!1,(0,r.aB)(b)&&(S<=0||(0,r.aC)())&&(G=(0,r.c)(b,S))),!G&&v>0&&(V=!1,(0,r.aB)(v)&&(P<=0||(0,r.aC)())&&(G=(0,r.c)(v,P))),V&&(G=(0,r.R)(L)),a&&G){const t=new r.aD;G.queryPrecisionDescriptorWithoutFalseXY(t),l&&t.setTolerance(0,E),h&&t.setTolerance(1,C),u&&t.setTolerance(2,w),_&&c&&m&&t.setGridParams(M,D,I),f&&g&&t.setZParams(N,T),y&&p&&t.setMParams(F,A),G=(0,r.aE)(G,t)}return G}function p(t,e,s,r){2!==r.currentToken()&&(0,n.a)("failed to parse multipath: array of array of vertices is expected");const l=t?new a.a:new a.P,h=l,u=(0,o.y)(0),c=(0,o.D)(2,0),m=(0,o.z)(0);let d=null,g=null,p=null,_=null,f=null,x=0,S=0,E=0;const C=new a.S,w=i.P.getNAN();let I=0,T=0;const A=t?1:0;for(;4!==r.nextToken();){2!==r.currentToken()&&(0,n.a)("failed to parse multipath: ring/path array is expected");let s=2,l=0,M=!0;const D=4;let N=0,F=0;const R=i.P.getNAN(),k=(0,i.d)(D,Number.NaN),L=(0,i.d)(D,Number.NaN);let G=!1;for(r.nextToken();4!==r.currentToken();){if(e&&1===r.currentToken())M&&(0,n.a)("failed to parse multipath: starting vertex array is expected"),p||(p=(0,o.z)(I-1,1),_=(0,o.y)(I-1,-1),f=(0,o.D)(0)),G=!0,s=1,({segFlag:E,toPointSz:N}=P(C,k,w,r));else{for(G=!1,2!==r.currentToken()&&(0,n.a)("failed to parse multipath: array is expected, rings/paths vertices consist of arrays of coordinates"),N=0;4!==r.nextToken();)N===D&&(0,n.a)("failed to parse multipath: each vertex array has to have at most 4 elements"),k[N++]=y(r);N<2&&(0,n.a)("failed to parse multipath: each vertex array has to have at least 2 elements"),(0,o.J)(k[0],k[1])||(0,n.a)("failed to parse multipath: x and y must be finite")}r.nextToken();do{if(c.size()===2*I&&c.resize(v(I)),c.writePoint2D(2*I,R.setCoords(k[0],k[1])),d&&d.size()===I&&d.resize(b(I)),N>2?(d||(d=(0,o.D)(I+1,Number.NaN)),d.write(I,k[2])):d&&d.write(I,Number.NaN),g&&g.size()===I&&g.resize(b(I)),N>3?(g||(g=(0,o.D)(I+1,Number.NaN)),g.write(I,k[3])):g&&g.write(I,Number.NaN),M)T++,u.add(I),m.add(A),M=!1,F=N,(0,i.b)(L,k,0,0,F);else if(null!==p)if(G){const t=(0,a.H)(E),e=f.size();f.resize(e+t),p.add(E),_.add(x),C.get().writeInBufferStream(f,x),x+=t,h.incCurveType(E,1),S++}else p.add(1),_.add(-1);I++,l++,w.setCoords(k[0],k[1])}while(l<s&&4===r.currentToken())}0!==l&&(t&&l>s&&N===F&&0===(0,i.as)(k,L,N)?(I--,l--):null!==p&&(p.add(1),_.add(-1)))}return I&&(u.resize(T),m.resize(T),I>0&&(u.add(I),m.add(0)),h.setAttributeStreamRef(0,c),h.setPathFlagsStreamRef(m),h.setPathStreamRef(u),null!==p&&(h.updateCurveCounter(S),h.setSegmentData(_,f,p,x)),h.notifyModifiedFlags(65535)),{geometry:l,as:d,bs:g}}function _(t,e){2!==e.currentToken()&&(0,n.a)("failed to parse multipoint: array of vertices is expected");let s=0;const r=new a.M,l=(0,o.D)(2,0);let h=0;const u=(0,i.d)(4,Number.NaN),c=new i.P;let m=null,d=null;for(;4!==e.nextToken();){for(2!==e.currentToken()&&(0,n.a)("failed to parse multipoint: array is expected, multipoint vertices consist of arrays of cooridinates"),h=0;4!==e.nextToken();)4===h&&(0,n.a)("failed to parse multipoint: each vertex array has to have at most 4 elements"),u[h++]=y(e);h<2&&(0,n.a)("failed to parse multipoint: each vertex array has to have at least 2 elements"),(0,o.J)(u[0],u[1])||(0,n.a)("failed to parse multipoint: x and y must be finite"),l.size()===2*s&&l.resize(v(s)),l.writePoint2D(2*s,c.setCoords(u[0],u[1])),m&&m.size()===s&&m.resize(b(s)),h>2?(m||(m=(0,o.D)(s+1,Number.NaN)),m.write(s,u[2])):m&&m.write(s,Number.NaN),d&&d.size()===s&&d.resize(b(s)),h>3?(d||(d=(0,o.D)(s+1,Number.NaN)),d.write(s,u[3])):d&&d.write(s,Number.NaN),s++}if(s){const t=r.getImpl();t.setAttributeStreamRef(0,l),t.resizeNoInit(s),t.notifyModifiedFlags(65535)}return{geometry:r,as:m,bs:d}}function f(t,e){2!==e.currentToken()&&(0,n.a)("failed to parse array of IDs: array of array of integers is expected");const s=(0,o.K)(2,0);let i=0,r=-1;for(;4!==e.nextToken();){const t=i;s.size()===i&&s.resize(b(i)),i++;let o=0;for(-1===r?r=2===e.currentToken()?1:0:1===r&&2!==e.currentToken()&&(0,n.a)("failed to parse array of IDs: array of array of integers is expected"),0===r&&(s.size()===i&&s.resize(b(i)),s.write(i,x(e)),o++,i++);4!==e.nextToken();)s.size()===i&&s.resize(b(i)),s.write(i,x(e)),o++,i++;if(s.write(t,o),0===r)break}return s.resize(i),s}function y(t){const e=t.currentToken();if(10===e||6===e&&"NaN"===t.currentString())return Number.NaN;{const e=t.currentDoubleValue();return Number.isNaN(e)?Number.NaN:e}}function x(t){return t.currentInt32Value()}function v(t){let e=2*Math.trunc(3*(t+1)/2);return e<8?e=8:e<32&&(e=32),e}function b(t){let e=Math.trunc(3*(t+1)/2);return e<4?e=4:e<16&&(e=16),e}function P(t,e,s,r,o){const l={segFlag:0,toPointSz:0};let h=r.currentToken();h=r.nextToken();const u=r.currentString(),m=u[0];for((1!==u.length||"a"!==m&&"b"!==m&&"c"!==m&&"n"!==m&&"q"!==m)&&(0,n.a)('failed to parse curve: expecting "a", "b", "n", "q", or "c"'),h=r.nextToken(),2!==h&&(0,n.a)("failed to parse curve: start array is expected for curve parameters"),h=r.nextToken(),2!==h&&(0,n.a)("failed to parse curve: start array is expected for to point"),l.toPointSz=0;4!==r.nextToken();)4===l.toPointSz&&(0,n.a)("failed to parse curve: vertex array cannot have more than 4 elements"),e[l.toPointSz++]=y(r);l.toPointSz<2&&(0,n.a)("failed to parse curve: vertex array must have at least 2 elements");const d=i.P.construct(e[0],e[1]),g=i.P.getNAN();let p=-1,_=-1,f=!1,x=Number.NaN,v=Number.NaN,b=Number.NaN;const P=[i.P.getNAN(),i.P.getNAN(),i.P.getNAN()],E=i.P.getNAN();if("a"===m){h=r.nextToken(),2!==h&&(0,n.a)("failed to parse curve: start array is expected for center point"),h=r.nextToken();const t=y(r);h=r.nextToken();const e=y(r);h=r.nextToken(),4!==h&&(0,n.a)("failed to parse curve: end array is expected for center point"),g.setCoords(t,e),h=r.nextToken(),p=r.currentInt32Value(),h=r.nextToken(),_=r.currentInt32Value(),h=r.nextToken(),4!==h?(f=!1,x=y(r),h=r.nextToken(),v=y(r),h=r.nextToken(),b=y(r),h=r.nextToken(),4!==h&&(0,n.a)("failed to parse curve: end array is expected for curve parameters")):f=!0,l.segFlag=4}else if("b"===m){for(let t=0;t<2;t++){h=r.nextToken(),2!==h&&(0,n.a)("failed to parse curve: start array is expected for control point"),h=r.nextToken();const e=y(r);h=r.nextToken();const s=y(r);h=r.nextToken(),4!==h&&(0,n.a)("failed to parse curve: end array is expected for control point"),P[t].setCoords(e,s)}h=r.nextToken(),4!==h&&(0,n.a)("failed to parse curve: end array is expected for curve parameters"),l.segFlag=2}else if("n"===m){{h=r.nextToken(),2!==h&&(0,n.a)("failed to parse curve: start array is expected for control point"),h=r.nextToken();const t=y(r);h=r.nextToken();const e=y(r);h=r.nextToken(),4!==h&&(0,n.a)("failed to parse curve: end array is expected for control point"),P[0].setCoords(t,e)}h=r.nextToken();const t=y(r);h=r.nextToken();const e=y(r);h=r.nextToken();const s=y(r);P[1].setCoords(t,e),P[2].setCoords(s,s),h=r.nextToken(),4!==h&&(0,n.a)("failed to parse curve: end array is expected for curve parameters"),l.segFlag=8}else if("q"===m){for(let t=0;t<1;t++){h=r.nextToken(),2!==h&&(0,n.a)("failed to parse curve: start array is expected for control point"),h=r.nextToken();const e=y(r);h=r.nextToken();const s=y(r);h=r.nextToken(),4!==h&&(0,n.a)("failed to parse curve: end array is expected for control point"),P[t].setCoords(e,s)}h=r.nextToken(),4!==h&&(0,n.a)("failed to parse curve: end array is expected for curve parameters"),l.segFlag=16}else{h=r.nextToken(),2!==h&&(0,n.a)("failed to parse curve: start array is expected for interior point"),h=r.nextToken();const t=y(r);h=r.nextToken();const e=y(r);h=r.nextToken(),4!==h&&(0,n.a)("failed to parse curve: end array is expected for interior point"),E.setCoords(t,e),h=r.nextToken(),4!==h&&(0,n.a)("failed to parse curve: end array is expected for curve parameters"),l.segFlag=4}if(h=r.nextToken(),3!==h&&(0,n.a)("failed to parse curve: end object is expected for curve"),"a"===m)if(t.createEllipticArc(),f){const e=!0;S(t.get(),s,d,g,e,p,_)}else!function(t,e,s,n,i,r,o,l,h){t.dropAllAttributes();const u=44,m=new ArrayBuffer(u),d=new c({sz:u,buffer:m});let g=0;d.writeDouble(g,n.x),g+=8,d.writeDouble(g,n.y),g+=8,d.writeDouble(g,o),g+=8,d.writeDouble(g,l),g+=8,d.writeDouble(g,h),g+=8;let p=0;r||(p|=2048),i&&(p|=4096),d.writeInt32(g,p),g+=4,function(t,e,s,n,i){t.m_bits=0,t.m_center.x=n.readDouble(i),t.m_center.y=n.readDouble(i+8),t.m_rotation=n.readDouble(i+16),t.m_semiMajorAxis=n.readDouble(i+24),t.m_minorMajorRatio=n.readDouble(i+32),t.m_XStart=e.x,t.m_YStart=e.y,t.m_XEnd=s.x,t.m_YEnd=s.y;const r=n.readInt32(i+40);if(1&r)return!1;let o=!!(64&r),l=!!(128&r);const h=!!(2048&r),u=!!(4096&r);!(512&r)&&!(1024&r)||l||(o=!0),l&&!e.equals(s)?(l=!1,o=!0):o&&e.equals(s)&&(l=!0,o=!1),l?(t.m_center.assign(e),t.m_startAngle=t.m_center.x,t.m_sweepAngle=t.m_center.y,(0,a.F)(t,Number.NaN,h,u),t.m_semiMajorAxis=0,t.m_interior.setCoordsPoint2D(e)):o?(t.m_center.setNAN(),t.m_semiMajorAxis=1,t.m_minorMajorRatio=0,t.m_center.setNAN(),t.m_sweepAngle=0,t.m_startAngle=0,(0,a.A)(t),t.queryCoord2D(.5,t.m_interior)):t.constructEllipticArcEndPointsCenter(e,s,t.m_semiMajorAxis,t.m_minorMajorRatio,t.m_rotation,!u,h,t.m_center),t.setProjectionBehavior(1),(0,a.A)(t)}(t,e,s,d,0)}(t.get(),s,d,g,p,_,x,v,b);else if("b"===m)t.createCubicBezier(),function(t,e,s,r){t.dropAllAttributes();const o=32,a=new ArrayBuffer(o),l=new c({sz:o,buffer:a});let h=0;l.writeDouble(h,r[0].x),h+=8,l.writeDouble(h,r[0].y),h+=8,l.writeDouble(h,r[1].x),h+=8,l.writeDouble(h,r[1].y),h+=8,function(t,e,s,r,o){(0,n.g)(o+32<=r.size()),t.m_cp=(0,i.m)(i.P,2),t.m_cp[0].x=r.readDouble(o),t.m_cp[0].y=r.readDouble(o+8),t.m_cp[1].x=r.readDouble(o+16),t.m_cp[1].y=r.readDouble(o+24),t.m_XStart=e.x,t.m_YStart=e.y,t.m_XEnd=s.x,t.m_YEnd=s.y}(t,e,s,l,0)}(t.get(),s,d,P);else if("n"===m)t.createQuadraticRationalBezier(),function(t,e,s,n,i,r,o){t.dropAllAttributes();const a=40,l=new ArrayBuffer(a),h=new c({sz:a,buffer:l});let u=0;h.writeDouble(u,n.x),u+=8,h.writeDouble(u,n.y),u+=8,h.writeDouble(u,i),u+=8,h.writeDouble(u,r),u+=8,h.writeDouble(u,o),u+=8,function(t,e,s,n,i){t.m_cp.x=n.readDouble(i),t.m_cp.y=n.readDouble(i+8),t.m_weights[0]=n.readDouble(i+16),t.m_weights[1]=n.readDouble(i+24),t.m_weights[2]=n.readDouble(i+32),t.m_XStart=e.x,t.m_YStart=e.y,t.m_XEnd=s.x,t.m_YEnd=s.y}(t,e,s,h,0)}(t.get(),s,d,P[0],P[1].x,P[1].y,P[2].x);else if("q"===m)t.createQuadraticBezier(),t.get().construct(s,P[0],d);else{t.createEllipticArc();const e=!1;S(t.get(),s,d,E,e,-1,-1)}return l}function S(t,e,s,r,o,l,h){t.dropAllAttributes();const u=new ArrayBuffer(20),m=new c({sz:20,buffer:u});let d=0;m.writeDouble(d,r.x),d+=8,m.writeDouble(d,r.y),d+=8;let g=0;o?(h||(g|=8),l&&(g|=16)):g|=128,m.writeInt32(d,g),d+=4,function(t,e,s,r,o){o>=r.size()&&(0,n.q)("Byte_buffer out of range access"),t.m_bits=0,t.m_rotation=0,t.m_cosr=1,t.m_sinr=0,t.setStartXY(e),t.setEndXY(s);const l=i.P.getNAN();l.x=r.readDouble(o),l.y=r.readDouble(o+8);const h=r.readInt32(o+16);if(1&h)return t.m_semiMajorAxis=0,t.m_minorMajorRatio=1,t.m_interior.assign(l),t.m_center.setNAN(),t.m_sweepAngle=0,t.m_startAngle=0,(0,a.A)(t),!1;let u=!!(64&h);const c=!!(128&h);let m=!!(32&h);const d=!!(8&h),g=!!(16&h),p=e.equals(s);u&&!p&&(u=!1,m=!0),m&&p&&(u=!0,m=!1,l.setCoords(0,0)),u||(c?m?(t.m_semiMajorAxis=1,t.m_minorMajorRatio=0,t.m_interior.assign(l),t.m_center.setNAN(),t.m_sweepAngle=0,t.m_startAngle=0):(t.constructCircularArcThreePoint(e,s,l),p&&d===t.isClockwise()&&t.reverse()):m?(t.m_semiMajorAxis=1,t.m_minorMajorRatio=0,t.m_center.setNAN(),t.m_sweepAngle=0,t.m_startAngle=0,(0,a.A)(t),t.queryCoord2D(.5,t.m_interior)):(0,a.B)(t,e,s,l,d,g)),u&&(t.m_center.assign(e),t.m_startAngle=l.x,t.m_sweepAngle=l.y,(0,a.F)(t,Number.NaN,d,g),t.m_semiMajorAxis=0,t.m_minorMajorRatio=1,t.m_interior.setCoordsPoint2D(e)),t.setProjectionBehavior(0),(0,a.A)(t)}(t,e,s,m,0)}function E(t,e,s,i,r){const o=t.getGeometryType();if(o===n.G.enumEllipticArc)return function(t,e,s,i,r){(0,n.g)(!(0,a.z)(t));const o=t.getEndXY(),l=t.hasAttribute(1)&&!e,h=t.hasAttribute(2)&&!s;let u=Number.NaN,c=Number.NaN;if(l&&(u=t.getEndAttributeAsDbl(1,0)),h&&(c=t.getEndAttributeAsDbl(2,0)),t.isDegenerateToLine()||t.isDegenerate(0))return w(l,h,o.x,o.y,u,c,i,r),!0;const m=0===t.projectionBehavior(),d=!!m&&t.isClosed();if(m&&!d)r.startObject(),r.addFieldName("c"),r.startArray(),w(l,h,o.x,o.y,u,c,i,r),I(t.m_interior.x,t.m_interior.y,17,r),r.endArray(),r.endObject();else if(m){r.startObject(),r.addFieldName("a"),r.startArray(),w(l,h,o.x,o.y,u,c,i,r);const e=0,s=0;I(t.m_center.x+e,t.m_center.y+s,17,r);const n=!t.isMajor();r.addInt32(n?1:0);const a=t.isClockwise();r.addInt32(a?1:0),r.endArray(),r.endObject()}else{r.startObject(),r.addFieldName("a"),r.startArray(),w(l,h,o.x,o.y,u,c,i,r);const e=t;I(e.m_center.x,e.m_center.y,17,r);const s=!e.isMajor();r.addInt32(s?1:0);const n=e.isClockwise();r.addInt32(n?1:0),r.addDouble(e.m_rotation,17),r.addDouble(e.m_semiMajorAxis,17),r.addDouble(e.m_minorMajorRatio,17),r.endArray(),r.endObject()}return!1}(t,e,s,i,r);if(o===n.G.enumBezier)return C(t,e,s,i,r);if(o===n.G.enumRationalBezier2)return function(t,e,s,n,i){const r=t.getEndXY(),o=t.hasAttribute(1)&&!e,a=t.hasAttribute(2)&&!s;let l=Number.NaN,h=Number.NaN;o&&(l=t.getEndAttributeAsDbl(1,0)),a&&(h=t.getEndAttributeAsDbl(2,0)),i.startObject(),i.addFieldName("n"),i.startArray(),w(o,a,r.x,r.y,l,h,n,i),I(t.m_cp.x,t.m_cp.y,n,i);const u=n;return i.addDouble(t.m_weights[0],u),i.addDouble(t.m_weights[1],u),i.addDouble(t.m_weights[2],u),i.endArray(),i.endObject(),!1}(t,e,s,i,r);if(o===n.G.enumBezier2){const n=new a.y;return n.constructFromQuadraticSegment(t),C(n,e,s,i,r)}(0,n.t)("")}function C(t,e,s,n,i){const r=t.getEndXY(),o=t.hasAttribute(1)&&!e,a=t.hasAttribute(2)&&!s;let l=Number.NaN,h=Number.NaN;return o&&(l=t.getEndAttributeAsDbl(1,0)),a&&(h=t.getEndAttributeAsDbl(2,0)),i.startObject(),i.addFieldName("b"),i.startArray(),w(o,a,r.x,r.y,l,h,n,i),I(t.m_cp[0].x,t.m_cp[0].y,n,i),I(t.m_cp[1].x,t.m_cp[1].y,n,i),i.endArray(),i.endObject(),!1}function w(t,e,s,n,i,r,o,a){a.startArray(),a.addDouble(s,o),a.addDouble(n,o),t&&a.addDouble(i,o),e&&a.addDouble(r,o),a.endArray()}function I(t,e,s,n){n.startArray(),n.addDouble(t,s),n.addDouble(e,s),n.endArray()}function T(t,e,s,i){const r=s.getImpl(),l=!!(2&e),h=!!(4&e),u=!!(8&e),c=r.hasAttribute(1)&&!l,m=r.hasAttribute(2)&&!h,d=r.hasAttribute(3)&&!u,g=r.hasNonLinearSegments();c&&(i.addFieldName("hasZ"),i.addBool(!0)),m&&(i.addFieldName("hasM"),i.addBool(!0)),t?g?i.addFieldName("curveRings"):i.addFieldName("rings"):g?i.addFieldName("curvePaths"):i.addFieldName("paths");let p=null;const _=[];if(s.isEmpty())i.startArray(),i.endArray();else{const t=17-(31&e>>13);i.startArray();const u=s.getPathCount();let f=0;const y=r.getAttributeStreamRef(0);let x=null,v=null,b=null;const P=new a.S;let S=null,C=null,w=null;g&&(S=r.getSegmentFlagsStreamRef(),C=r.getSegmentIndexStreamRef(),w=r.getSegmentDataStreamRef()),c&&(x=r.getAttributeStreamRef(1)),m&&(v=r.getAttributeStreamRef(2)),d&&(b=r.getAttributeStreamRef(3),p=(0,o.t)(3,0));for(let e=0;e<u;e++){i.startArray(),d&&_.push(0);const r=s.getPathEnd(e);if(f===r){i.endArray();continue}const o=s.isClosedPath(e);let a=y.read(2*f),u=y.read(2*f+1),g=c?x.read(f):Number.NaN,I=m?v.read(f):Number.NaN,T=d?b.read(f):0;A(c,m,a,u,g,I,t,i);let M=1;d&&(p.add(T),_[_.length-1]++);const D=a,N=u,F=g,R=I,k=T;let L=!1,G=0,V=Number.NaN,z=Number.NaN,O=0;for(let e=f+1,s=f,q=o?r+1:r;e<q;e++,s++){const o=null!==S?31&S.read(s):1;let f,q;if(e<r?(f=y.read(2*e),q=y.read(2*e+1),c&&(V=x.read(e)),m&&(z=v.read(e)),d&&(O=b.read(e))):(f=D,q=N,V=F,z=R,O=k),1!==o){L=!0,4===o?P.createEllipticArc():2===o?P.createCubicBezier():16===o?P.createQuadraticBezier():8===o?P.createQuadraticRationalBezier():(0,n.t)("JSON export.unsupported curve");const e=P.get(),r=C.read(s);e.setStartXYCoords(a,u),e.setEndXYCoords(f,q),c&&(e.setStartAttribute(1,0,g),e.setEndAttribute(1,0,V)),m&&(e.setStartAttribute(2,0,I),e.setEndAttribute(2,0,z)),e.readFromBufferStream(w,r),E(P.get(),l,h,t,i)&&G++}else A(c,m,f,q,V,z,t,i);d&&(p.add(O),_[_.length-1]++),M++,a=f,u=q,g=V,I=z,T=O}L&&0===G||(M<2&&G<1&&(A(c,m,a,u,g,I,t,i),M++,d&&(p.add(T),_[_.length-1]++)),o&&M<3&&G<2&&(A(c,m,D,N,F,R,t,i),M++,a=D,u=N,g=F,I=R,T=k,d&&(p.add(k),_[_.length-1]++))),i.endArray(),f=r}i.endArray()}if(d){i.addFieldName("ids"),i.startArray();let t=0;for(let e=0,s=_.length;e<s;++e){const s=_[e];(0,n.g)(0===s||null!==p&&t+s<=p.size()),i.startArray();for(let e=0;e<s;++e)i.addInt32(p.read(t)),t++;i.endArray()}i.endArray()}}function A(t,e,s,n,i,r,o,a){a.startArray(),a.addDouble(s,o),a.addDouble(n,o),t&&a.addDouble(i,o),e&&a.addDouble(r,o),a.endArray()}const M="a".charCodeAt(0),D="A".charCodeAt(0),N="*".charCodeAt(0),F="b".charCodeAt(0),R="\\".charCodeAt(0),k="[".charCodeAt(0),L="{".charCodeAt(0),G=":".charCodeAt(0),V=".".charCodeAt(0),z=",".charCodeAt(0),O='"'.charCodeAt(0),q="]".charCodeAt(0),B="}".charCodeAt(0),Y="e".charCodeAt(0),U="E".charCodeAt(0),H="f".charCodeAt(0),X="F".charCodeAt(0),j="/".charCodeAt(0),Z="-".charCodeAt(0),W="+".charCodeAt(0),$="n".charCodeAt(0),K="N".charCodeAt(0),Q="r".charCodeAt(0),J="t".charCodeAt(0),tt="u".charCodeAt(0),et="0".charCodeAt(0),st="9".charCodeAt(0);class nt{constructor(t){this.m_functionStack=[],this.m_pushPositions=[],this.m_utf8Decoder=new TextDecoder("utf-8",{fatal:!0}),void 0===t?(this.m_startToken=Number.MAX_SAFE_INTEGER,this.m_endToken=0,this.m_currentTokenType=0,this.m_functionStack.push((()=>this.accept_())),this.m_jsonString=null,this.m_bHasEscapes=!1):t.jsonString?this.resetParserFromString(t.jsonString):t.jsonStream?(0,n.t)("streaming json parsing not yet impl"):(0,n.d)("invalid constructor parameter")}prepSubstrString_(){}getCurrentSubstrString_(){return this.m_jsonString.slice(this.m_startToken,this.m_endToken)}stepOverCharString_(){this.m_endToken++}peekCharString_(){return this.m_jsonString.charCodeAt(this.m_endToken)}getString_(t){const e=this.m_jsonString?.slice(this.m_startToken,this.m_startToken+t-1);return this.m_endToken+=t-1,{s:e,bDone:this.m_endToken>=this.m_jsonString.length}}incrementString_(){this.m_endToken++}eofString_(){return this.m_endToken>=this.m_jsonString.length}setStringFunctions_(){this.m_prepSubstr=this.prepSubstrString_,this.m_getCurrentSubstr=this.getCurrentSubstrString_,this.m_stepOverChar=this.stepOverCharString_,this.m_peekChar=this.peekCharString_,this.m_get=this.getString_,this.m_increment=this.incrementString_,this.m_eof=this.eofString_}setStreamFunctions_(){(0,n.t)("streaming json parsing not yet impl")}reset_(){this.m_jsonString=null,this.m_endToken=0,this.m_startToken=Number.MAX_SAFE_INTEGER,this.m_currentTokenType=0,this.m_bHasEscapes=!1,this.m_functionStack.length=0,this.m_functionStack.push((()=>this.start_())),this.m_pushPositions.length=0}resetParserFromString(t){this.reset_(),this.setStringFunctions_(),this.m_jsonString=t}resetParserFromStream(t){(0,n.t)("streaming json parsing not yet impl")}resetToPosition(t){return!!this.m_jsonString&&(this.m_endToken=t,this.m_startToken=Number.MAX_VALUE,this.m_currentTokenType=0,this.m_functionStack.length=0,t>=this.m_jsonString.length?(this.m_functionStack.push((()=>this.accept_())),!1):(this.m_functionStack.push((()=>this.start_())),!0))}nextToken(){return this.m_functionStack.at(-1)(),this.m_currentTokenType}currentToken(){return this.m_currentTokenType}currentTokenStartIndex(){return this.m_startToken}currentTokenEndIndex(){return this.m_endToken}currentText(){return(0,n.g)(0),""}childrenAsString(){return(0,n.g)(0),""}skipChildren(){this.skipChildren_()}skipChildren_(){if(1!==this.m_currentTokenType)if(2!==this.m_currentTokenType);else{let t=1;do{this.m_currentTokenType=this.nextToken(),2===this.m_currentTokenType?t++:4===this.m_currentTokenType&&t--}while(4!==this.m_currentTokenType||0!==t)}else{let t=1;do{this.m_currentTokenType=this.nextToken(),1===this.m_currentTokenType?t++:3===this.m_currentTokenType&&t--}while(3!==this.m_currentTokenType||0!==t)}}currentTerminalAsString_(){switch(this.m_currentTokenType){case 7:case 8:case 9:return this.m_getCurrentSubstr().slice(0,this.m_endToken-this.m_startToken);case 10:return"null";case 11:return"true";case 12:return"false"}(0,n.a)("invalid token")}toUTF8_(t,e){let s=0,n=t;for(;e.charCodeAt(n)===R&&e.charCodeAt(n+1)===tt;)s++,n+=6;n=t;const i=new Uint8Array(s);let r=0;for(;e.charCodeAt(n)===R&&e.charCodeAt(n+1)===tt;)i[r++]=Number.parseInt(e.slice(n+2,n+6),16),n+=6;return{u8s:this.m_utf8Decoder.decode(i),end:n}}unquoteCurrentString_(){let t="",e=1;const s=this.m_endToken-this.m_startToken-1;let n=0;const i=this.m_getCurrentSubstr();for(let r=e;r<s;r++)if(i.charCodeAt(r)!==R)n++;else{switch(n>0&&(t+=i.slice(e,e+n)),i.charCodeAt(++r)){case O:t+='"';break;case tt:{const{u8s:e,end:s}=this.toUTF8_(r-1,i);r=s-1,t+=e;break}case R:t+="\\";break;case j:t+="/";break;case F:t+="\b";break;case H:t+="\f";break;case $:t+="\n";break;case Q:t+="\r";break;case J:t+="\t"}e=r+1,n=0}return n>0&&(t+=i.slice(e,e+n)),t}currentString(){return 5!==this.m_currentTokenType&&6!==this.m_currentTokenType?this.currentTerminalAsString_():this.m_bHasEscapes?this.unquoteCurrentString_():this.m_getCurrentSubstr().slice(1,this.m_endToken-this.m_startToken-2+1)}currentDoubleValue(){if(7!==this.m_currentTokenType&&8!==this.m_currentTokenType&&9!==this.m_currentTokenType&&6!==this.m_currentTokenType&&10!==this.m_currentTokenType&&(0,n.a)("invalid token"),10===this.m_currentTokenType)return Number.NaN;let t=this.m_getCurrentSubstr(),e=this.m_endToken-this.m_startToken;if(6===this.m_currentTokenType){if("NaN"===this.currentString())return Number.NaN;t=t.slice(1),e-=2,0===e&&(0,n.a)("invalid token")}const s=Number.parseFloat(t);if(6===this.m_currentTokenType)Number.isNaN(s)&&(0,n.a)("invalid token");else if(Number.isNaN(s))return Number.NaN;return s}currentInt32Value(){8!==this.m_currentTokenType&&6!==this.m_currentTokenType&&(0,n.a)("invalid token");let t=this.m_getCurrentSubstr(),e=this.m_endToken-this.m_startToken;6===this.m_currentTokenType&&(t=t.slice(1),e-=2,0===e&&(0,n.a)("invalid token"));const s=parseInt(t);return Number.isNaN(s)&&(0,n.a)("invalid token"),s}currentInt64Value(){return(0,n.g)(0),0n}currentBoolValue(){return(0,n.g)(0),!1}isError(){return 0}JSONString(){return(0,n.g)(0),""}pushPosition(){return(0,n.g)(0),!1}popPosition(){return(0,n.g)(0),!1}skipCStyleComments_(){(0,n.g)(0)}skipCppStyleComments_(){(0,n.g)(0)}skipComments_(){this.m_prepSubstr();let t=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&(0,n.a)("invalid token"),t=this.m_peekChar(),t===N?this.skipCStyleComments_():t===j?this.skipCppStyleComments_():(0,n.a)("invalid token")}skipWhiteSpace_(){let t;do{this.m_eof()&&(0,n.a)("invalid token");let e=this.m_peekChar();for(;e>=9&&e<=13||32===e;)this.m_increment(),this.m_eof()&&(0,n.a)("invalid token"),e=this.m_peekChar();e===j?(this.m_startToken=this.m_endToken,t=!0,this.skipComments_()):t=!1}while(t)}rightBracket_(){return this.m_peekChar()===q&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=4,!0)}rightBrace_(){return this.m_peekChar()===B&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=3,!0)}string_(){this.m_prepSubstr(),this.m_bHasEscapes=!1,this.m_stepOverChar(),this.m_eof()&&(0,n.a)("invalid token");let t=this.m_peekChar();for(;t!==O;){const e=t===R;if(this.m_stepOverChar(),this.m_eof()&&(0,n.a)("invalid token"),t=this.m_peekChar(),e)if(this.m_bHasEscapes=!0,t===O||t===R||t===j||t===F||t===H||t===$||t===Q||t===J)this.m_stepOverChar(),this.m_eof()&&(0,n.a)("invalid token"),t=this.m_peekChar();else if(t===tt)for(let s=0;s<4;s++)this.m_stepOverChar(),this.m_eof()&&(0,n.a)("invalid token"),t=this.m_peekChar(),t>=et&&t<=st||t>=M&&t<=H||t>=D&&t<=X||(0,n.a)("invalid token");else(0,n.a)("invalid token")}this.m_stepOverChar()}comma_(){return this.m_peekChar()===z&&(this.m_increment(),!0)}colon_(){return this.m_peekChar()===G&&(this.m_increment(),!0)}fieldNameEnd_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.colon_()?(this.skipWhiteSpace_(),this.value_()):(0,n.a)("invalid token")}fieldNameStart_(){this.m_startToken=this.m_endToken,this.m_peekChar()!==O&&(0,n.a)("invalid token"),this.string_(),this.m_currentTokenType=5,this.m_functionStack.push((()=>this.fieldNameEnd_()))}pairEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.fieldNameStart_()):this.rightBrace_()?this.m_functionStack.pop():(0,n.a)("invalid token")}arrayStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBracket_()||(this.m_functionStack.push((()=>this.elementEnd_())),this.value_())}elementEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.value_()):this.rightBracket_()?this.m_functionStack.pop():(0,n.a)("invalid token")}objectStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBrace_()||(this.m_functionStack.push((()=>this.pairEnd_())),this.fieldNameStart_())}valueStartObject_(){this.m_increment(),this.m_currentTokenType=1,this.m_functionStack.push((()=>this.objectStart_()))}valueStartArray_(){this.m_increment(),this.m_currentTokenType=2,this.m_functionStack.push((()=>this.arrayStart_()))}valueString_(){this.string_(),this.m_currentTokenType=6}int_(){this.m_peekChar()!==et?this.digits_():this.m_stepOverChar()}digits_(){let t=this.m_peekChar();do{this.m_stepOverChar(),this.m_eof()&&(0,n.a)("invalid token"),t=this.m_peekChar()}while(t>=et&&t<=st)}frac_(){let t=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&(0,n.a)("invalid token"),t=this.m_peekChar(),t>=et&&t<=st||(0,n.a)("invalid token"),this.digits_()}exp_(){let t=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&(0,n.a)("invalid token"),t=this.m_peekChar(),t!==W&&t!==Z||(this.m_stepOverChar(),this.m_eof()&&(0,n.a)("invalid token"),t=this.m_peekChar()),t>=et&&t<=st||(0,n.a)("invalid token"),this.digits_()}valueNumber_(){this.m_prepSubstr();let t=!1,e=this.m_peekChar();if(e===Z?(this.m_stepOverChar(),this.m_eof()&&(0,n.a)("invalid token"),e=this.m_peekChar(),t=!0,e>=et&&e<=st||(0,n.a)("invalid token"),this.int_()):this.int_(),e=this.m_peekChar(),e===V)this.m_currentTokenType=7,this.frac_(),e=this.m_peekChar(),e!==Y&&e!==U||this.exp_();else if(e===Y||e===U)this.m_currentTokenType=7,this.exp_();else{let e=0;t&&e++;const s=this.m_endToken-this.m_startToken-e;if(s<10)this.m_currentTokenType=8;else if(10===s){const s=this.m_getCurrentSubstr();t?s.slice(e)<="2147483648"?this.m_currentTokenType=8:this.m_currentTokenType=9:s.slice(e)<="2147483647"?this.m_currentTokenType=8:this.m_currentTokenType=9}else if(s<19)this.m_currentTokenType=9;else if(19===s){const s=this.m_getCurrentSubstr();t?s.slice(e)<="9223372036854775808"?this.m_currentTokenType=9:this.m_currentTokenType=7:s.slice(e)<="9223372036854775807"?this.m_currentTokenType=9:this.m_currentTokenType=7}else this.m_currentTokenType=7}}valueNull_(){const{s:t,bDone:e}=this.m_get(5);e&&(0,n.a)("invalid token"),"null"!==t&&(0,n.a)("invalid token"),this.m_currentTokenType=10}valueTrue_(){const{s:t,bDone:e}=this.m_get(5);e&&(0,n.a)("invalid token"),"true"!==t&&(0,n.a)("invalid token"),this.m_currentTokenType=11}valueFalse_(){const{s:t,bDone:e}=this.m_get(6);e&&(0,n.a)("invalid token"),"false"!==t&&(0,n.a)("invalid token"),this.m_currentTokenType=12}valueNan_(){const{s:t,bDone:e}=this.m_get(4);e&&(0,n.a)("invalid token"),"NaN"!==t&&(0,n.a)("invalid token"),this.m_currentTokenType=7}value_(){this.m_startToken=this.m_endToken;const t=this.m_peekChar();t===L?this.valueStartObject_():t===k?this.valueStartArray_():t===O?this.valueString_():t===Z||t>=et&&t<=et+9?this.valueNumber_():t===$?this.valueNull_():t===J?this.valueTrue_():t===H?this.valueFalse_():t===K?this.valueNan_():(0,n.a)("invalid token")}start_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.m_functionStack.push((()=>this.accept_()));const t=this.m_peekChar();t!==L&&t!==k&&(0,n.a)("invalid token"),this.value_()}accept_(){this.m_startToken=this.m_endToken,this.m_currentTokenType=0}}const it=new class{constructor(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject=[]}reset(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject.length=0}startObject(){const t={};this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=t,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(t),this.m_currentObject.push(t)}startArray(){const t=[];this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=t,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(t),this.m_currentObject.push(t)}endObject(){this.m_acceptedObject=this.m_currentObject.at(-1),this.m_currentObject.pop()}endArray(){this.m_currentObject.pop()}addFieldName(t){this.m_pendingKey=t}addValue_(t){this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=t,this.m_pendingKey=null):this.m_currentObject.at(-1).push(t)}addString(t){this.addValue_(t)}addDouble(t,e){this.addValue_(t)}addInt64(t){(0,n.g)(0)}addInt32(t){this.addValue_(t)}addBool(t){this.addValue_(t)}addNull(){this.addValue_(null)}getObject(){return this.m_acceptedObject}},rt=new class{getOperatorType(){return 10405}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}supportsCurves(){return!0}execute(t,e,s,i,o,a){!function(t,e,s,i){if(e||s){if(i.startObject(),null!==e)switch(e.getGeometryType()){case n.G.enumPolygon:T(!0,t,e,i);break;case n.G.enumPolyline:T(!1,t,e,i);break;case n.G.enumMultiPoint:!function(t,e,s){const i=e.getImpl(),r=i.hasAttribute(1)&&!(2&t),o=i.hasAttribute(2)&&!(4&t),a=i.hasAttribute(3)&&!(8&t);r&&(s.addFieldName("hasZ"),s.addBool(!0)),o&&(s.addFieldName("hasM"),s.addBool(!0)),s.addFieldName("points");const l=e.getPointCount();if(e.isEmpty())s.startArray(),s.endArray();else{const e=17-(31&t>>13);s.startArray();const n=i.getAttributeStreamRef(0);let a=null,h=null;r&&(a=i.getAttributeStreamRef(1)),o&&(h=i.getAttributeStreamRef(2));for(let t=0;t<l;t++){const i=n.read(2*t),l=n.read(2*t+1);let u=Number.NaN,c=Number.NaN;r&&(u=a.read(t)),o&&(c=h.read(t)),A(r,o,i,l,u,c,e,s)}s.endArray()}if(a){let t=null;i.isEmpty()||(t=i.getAttributeStreamRef(3)),(0,n.g)(0===l||null!==t&&t.size()>=l),s.addFieldName("ids"),s.startArray();for(let e=0;e<l;e++)s.addInt32(t.read(e));s.endArray()}}(t,e,i);break;case n.G.enumPoint:!function(t,e,s){const n=e.hasAttribute(1)&&!(2&t),i=e.hasAttribute(2)&&!(4&t),r=e.hasAttribute(3)&&!(8&t);if(e.isEmpty())return s.addFieldName("x"),s.addNull(),s.addFieldName("y"),s.addNull(),n&&(s.addFieldName("z"),s.addNull()),i&&(s.addFieldName("m"),s.addNull()),void(r&&(s.addFieldName("id"),s.addInt32(0)));const o=17-(31&t>>13);s.addFieldName("x"),s.addDouble(e.getX(),o),s.addFieldName("y"),s.addDouble(e.getY(),o),n&&(s.addFieldName("z"),s.addDouble(e.getZ(),o)),i&&(s.addFieldName("m"),s.addDouble(e.getM(),o)),r&&(s.addFieldName("id"),s.addInt32(e.getID()))}(t,e,i);break;case n.G.enumEnvelope:!function(t,e,s){const n=e.hasAttribute(1)&&!(2&t),i=e.hasAttribute(2)&&!(4&t),r=e.hasAttribute(3)&&!(8&t);if(e.isEmpty())return s.addFieldName("xmin"),s.addNull(),s.addFieldName("ymin"),s.addNull(),s.addFieldName("xmax"),s.addNull(),s.addFieldName("ymax"),s.addNull(),n&&(s.addFieldName("zmin"),s.addNull(),s.addFieldName("zmax"),s.addNull()),i&&(s.addFieldName("mmin"),s.addNull(),s.addFieldName("mmax"),s.addNull()),void(r&&(s.addFieldName("idmin"),s.addInt32(0),s.addFieldName("idmax"),s.addInt32(0)));const o=17-(31&t>>13);if(s.addFieldName("xmin"),s.addDouble(e.getXMin(),o),s.addFieldName("ymin"),s.addDouble(e.getYMin(),o),s.addFieldName("xmax"),s.addDouble(e.getXMax(),o),s.addFieldName("ymax"),s.addDouble(e.getYMax(),o),n){const t=e.queryInterval(1,0);s.addFieldName("zmin"),s.addDouble(t.vmin,o),s.addFieldName("zmax"),s.addDouble(t.vmax,o)}if(i){const t=e.queryInterval(2,0);s.addFieldName("mmin"),s.addDouble(t.vmin,o),s.addFieldName("mmax"),s.addDouble(t.vmax,o)}if(r){const t=e.queryInterval(3,0);s.addFieldName("idmin"),s.addInt32(t.vmin),s.addFieldName("idmax"),s.addInt32(t.vmax)}}(t,e,i);break;case n.G.enumMultipatch:(0,n.g)(0);break;default:(0,n.d)("exportToJSON")}null!==s&&(i.addFieldName("spatialReference"),function(t,e,s){s.startObject();let i=0;e.isCustomWkid()||(i=e.getOldID());let o=0;const a=e.getVCS();if(null!==a&&(a.isCustomWkid()||(o=a.getOldID()),o<=0&&(i=0)),i>0){s.addFieldName("wkid"),s.addInt32(i);const t=e.getLatestID();if(t>0&&t!==i&&(s.addFieldName("latestWkid"),s.addInt32(t)),o>0){s.addFieldName("vcsWkid"),s.addInt32(o);const t=e.getLatestVerticalID();t!==o&&(s.addFieldName("latestVcsWkid"),s.addInt32(t))}}if(0===e.getCoordinateSystemType())s.addFieldName("wkid"),s.addNull(),null!==e.getUnit()&&(s.addFieldName("unit"),function(t,e,s){s.startObject();const i=e.getID();i<=0&&(0,n.a)("cannot export unit that has no valid WKID"),s.addFieldName("uwkid"),s.addInt32(i),s.endObject()}(0,e.getUnit(),s));else if(i<=0||1&t){let n="";64&t&&(n=e.getText2(),s.addFieldName("wkt2"),s.addString(n));const i=e.getText();i!==n&&(s.addFieldName("wkt"),s.addString(i))}if(16&t){const t=new r.aD;e.queryPrecisionDescriptor(t),s.addFieldName("xyTolerance"),s.addDouble(t.getTolerance(0)),s.addFieldName("zTolerance"),s.addDouble(t.getTolerance(1)),s.addFieldName("mTolerance"),s.addDouble(t.getTolerance(2)),s.addFieldName("falseX"),s.addDouble(t.getFalseX()),s.addFieldName("falseY"),s.addDouble(t.getFalseY()),s.addFieldName("xyUnits"),s.addDouble(t.getGridUnitsXY()),s.addFieldName("falseZ"),s.addDouble(t.getFalseZ()),s.addFieldName("zUnits"),s.addDouble(t.getGridUnitsZ()),s.addFieldName("falseM"),s.addDouble(t.getFalseM()),s.addFieldName("mUnits"),s.addDouble(t.getGridUnitsM())}s.endObject()}(t,s,i)),i.endObject()}}(t,e,s,i)}exportSpatialReference(t,e,s,i){(0,n.g)(0)}exportProjectionTransformation(t,e,s,i){(0,n.g)(0)}exportDatumTransformation(t,e,s,i){(0,n.g)(0)}static geometryTypeToString(t){return(0,n.g)(0),""}},ot=new class{getOperatorType(){return 10404}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}supportsCurves(){return!0}execute(t,e,s,i,o,a,l){let h;"string"==typeof s?(h=new nt({jsonString:s}),h.nextToken()):h=s,1!==h.currentToken()&&(0,n.a)("failed to import map geometry: start of object is expected");const u=m(e,t,h,i,o);return new r.aF(u)}importSpatialReference(t){const e=g(t);return null===e&&(0,n.d)("failed to import spatial reference"),e}importProjectionTransformation(t,e){return(0,n.g)(0),{}}importDatumTransformation(t,e){return(0,n.g)(0),{}}static stringToGeometryType(t){return(t=t.toLowerCase()).startsWith("esrigeometry")||(0,n.a)("string_to_geometry_type"),t.endsWith("point")?n.G.enumPoint:t.endsWith("envelope")?n.G.enumEnvelope:t.endsWith("multipoint")?n.G.enumMultiPoint:t.endsWith("polyline")?n.G.enumPolyline:t.endsWith("polygon")?n.G.enumPolygon:void(0,n.a)("string_to_geometry_type")}};function at(t){return Array.isArray(t)?t[0].spatialReference:t.spatialReference}function lt(t,e){const s=new u(t,{strict:!1});return s.nextToken(),ot.execute(0,n.G.enumUnknown,s,!0,e)}function ht(t){let e=null;return[t.map((t=>{if(null==e){const s=ut(t);return e=s.getSpatialReference(),s.getGeometry()}return ct(t)})),e]}function ut(t){return lt(t,!0)}function ct(t){return lt(t,!1).getGeometry()}function mt(t,e){return t instanceof r.aF&&(e=t.getSpatialReference(),t=t.getGeometry()),t?.isEmpty()?null:(it.reset(),rt.execute(0,t,e,it),it.getObject())}},97557:(t,e,s)=>{s.d(e,{A:()=>u});var n,i=s(66866),r=s(24793),o=s(21877),a=s(21564),l=(s(39831),s(539),s(9272),s(28902)),h=s(63863);let u=class extends(r.A.ClonableMixin(o.A)){static{n=this}constructor(t){super(t),this.type="georeferenced",this.origin=null}static{this.absolute=new n}};(0,i._)([(0,l.e)({georeferenced:"georeferenced"},{readOnly:!0})],u.prototype,"type",void 0),(0,i._)([(0,a.MZ)({type:[Number],nonNullable:!1,json:{write:!0}})],u.prototype,"origin",void 0),u=n=(0,i._)([(0,h.$)("esri.geometry.support.MeshGeoreferencedVertexSpace")],u)},99218:(t,e,s)=>{s.d(e,{A:()=>u});var n=s(66866),i=s(24793),r=s(21877),o=s(21564),a=(s(39831),s(539),s(9272),s(28902)),l=s(63863),h=s(58359);let u=class extends(i.A.ClonableMixin(r.A)){constructor(t){super(t),this.type="local",this.origin=(0,h.vt)()}};(0,n._)([(0,a.e)({local:"local"},{readOnly:!0})],u.prototype,"type",void 0),(0,n._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],u.prototype,"origin",void 0),u=(0,n._)([(0,l.$)("esri.geometry.support.MeshLocalVertexSpace")],u)},58127:(t,e,s)=>{s.d(e,{A:()=>n});class n{constructor(){this._polyline=[]}beginPath(t){this._polyline.push([t])}lineTo(t){if(0===this._polyline.length)throw new Error("No path started. Call beginPath first.");this._polyline[this._polyline.length-1].push(t)}getPointCount(){return this._polyline.reduce(((t,e)=>t+e.length),0)}addSegment(t,e,s){s&&this.beginPath(t),this.lineTo(e)}getXY(t){let e=0;for(const s of this._polyline){if(t<e+s.length)return s[t-e];e+=s.length}return null}getGeometry(){return this._polyline}}},87569:(t,e,s)=>{s.d(e,{O3:()=>a,Ox:()=>l,bR:()=>r,dC:()=>n});var n,i;!function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"}(n||(n={}));class r{constructor(t,e){this.x=t,this.y=e}static fromArray(t){return new r(t[0],t[1])}clone(){return new r(this.x,this.y)}equals(t,e){return t===this.x&&e===this.y}isEqual(t){return t.x===this.x&&t.y===this.y}setCoords(t,e){return this.x=t,this.y=e,this}normalize(){const t=this.x,e=this.y,s=Math.sqrt(t*t+e*e);return this.x/=s,this.y/=s,this}rightPerpendicular(){const t=this.x;return this.x=this.y,this.y=-t,this}leftPerpendicular(){const t=this.x;return this.x=-this.y,this.y=t,this}move(t,e){return this.x+=t,this.y+=e,this}assign(t){return this.x=t.x,this.y=t.y,this}assignAdd(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}assignSub(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}rotate(t,e){const s=this.x,n=this.y;return this.x=s*t-n*e,this.y=s*e+n*t,this}rotateReverse(t,e){const s=this.x,n=this.y;return this.x=s*t+n*e,this.y=-s*e+n*t,this}scale(t){return this.x*=t,this.y*=t,this}length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}sub(t){return this.x-=t.x,this.y-=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}static distance(t,e){const s=e.x-t.x,n=e.y-t.y;return Math.sqrt(s*s+n*n)}static add(t,e){return new r(t.x+e.x,t.y+e.y)}static sub(t,e){return new r(t.x-e.x,t.y-e.y)}}class o{constructor(t,e,s){this.ratio=t,this.x=e,this.y=s}}class a{constructor(t,e,s,n=8,i=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=n,this._pixelMargin=i,this._tileSize=512*n,this._dz=t,this._yPos=e,this._xPos=s}setPixelMargin(t){t!==this._pixelMargin&&(this._pixelMargin=t,this.setExtent(this._extent))}setExtent(t){this._extent=t,this._finalRatio=this._tileSize/t*(1<<this._dz);let e=this._pixelRatio*this._pixelMargin;e/=this._finalRatio;const s=t>>this._dz;e>s&&(e=s),this._margin=e,this._xmin=s*this._xPos-e,this._ymin=s*this._yPos-e,this._xmax=this._xmin+s+2*e,this._ymax=this._ymin+s+2*e}reset(t){this._type=t,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(t,e){this._pushLine(),this._prevIsIn=this._isIn(t,e),this._moveTo(t,e,this._prevIsIn),this._prevPt=new r(t,e),this._firstPt=new r(t,e),this._dist=0}lineTo(t,e){const s=this._isIn(t,e),n=new r(t,e),i=r.distance(this._prevPt,n);let a,l,h,u,c,m,d,g;if(s)this._prevIsIn?this._lineTo(t,e,!0):(a=this._prevPt,l=n,h=this._intersect(l,a),this._start=this._dist+i*(1-this._r),this._lineTo(h.x,h.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,a=n,h=this._intersect(l,a),this._lineTo(h.x,h.y,!0),this._lineTo(a.x,a.y,!1);else{const t=this._prevPt,e=n;if(t.x<=this._xmin&&e.x<=this._xmin||t.x>=this._xmax&&e.x>=this._xmax||t.y<=this._ymin&&e.y<=this._ymin||t.y>=this._ymax&&e.y>=this._ymax)this._lineTo(e.x,e.y,!1);else{const s=[];if((t.x<this._xmin&&e.x>this._xmin||t.x>this._xmin&&e.x<this._xmin)&&(u=(this._xmin-t.x)/(e.x-t.x),g=t.y+u*(e.y-t.y),g<=this._ymin?m=!1:g>=this._ymax?m=!0:s.push(new o(u,this._xmin,g))),(t.x<this._xmax&&e.x>this._xmax||t.x>this._xmax&&e.x<this._xmax)&&(u=(this._xmax-t.x)/(e.x-t.x),g=t.y+u*(e.y-t.y),g<=this._ymin?m=!1:g>=this._ymax?m=!0:s.push(new o(u,this._xmax,g))),(t.y<this._ymin&&e.y>this._ymin||t.y>this._ymin&&e.y<this._ymin)&&(u=(this._ymin-t.y)/(e.y-t.y),d=t.x+u*(e.x-t.x),d<=this._xmin?c=!1:d>=this._xmax?c=!0:s.push(new o(u,d,this._ymin))),(t.y<this._ymax&&e.y>this._ymax||t.y>this._ymax&&e.y<this._ymax)&&(u=(this._ymax-t.y)/(e.y-t.y),d=t.x+u*(e.x-t.x),d<=this._xmin?c=!1:d>=this._xmax?c=!0:s.push(new o(u,d,this._ymax))),0===s.length)c?m?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):m?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(s.length>1&&s[0].ratio>s[1].ratio)this._start=this._dist+i*s[1].ratio,this._lineTo(s[1].x,s[1].y,!0),this._lineTo(s[0].x,s[0].y,!0);else{this._start=this._dist+i*s[0].ratio;for(let t=0;t<s.length;t++)this._lineTo(s[t].x,s[t].y,!0)}this._lineTo(e.x,e.y,!1)}}this._dist+=i,this._prevIsIn=s,this._prevPt=n}close(){if(this._line.length>2){const t=this._firstPt,e=this._prevPt;t.x===e.x&&t.y===e.y||this.lineTo(t.x,t.y);const s=this._line;let n=s.length;for(;n>=4&&(s[0].x===s[1].x&&s[0].x===s[n-2].x||s[0].y===s[1].y&&s[0].y===s[n-2].y);)s.pop(),s[0].x=s[n-2].x,s[0].y=s[n-2].y,--n}}result(t=!0){return this._pushLine(),0===this._lines.length?null:(this._type===n.Polygon&&t&&h.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==n.LineString)throw new Error("Only valid for lines");this._pushLine();const t=this._lines,e=t.length;if(0===e)return null;const s=[];for(let n=0;n<e;n++)s.push({line:t[n],start:this._starts[n]||0});return s}_isIn(t,e){return t>=this._xmin&&t<=this._xmax&&e>=this._ymin&&e<=this._ymax}_intersect(t,e){let s,n,i;if(e.x>=this._xmin&&e.x<=this._xmax)n=e.y<=this._ymin?this._ymin:this._ymax,i=(n-t.y)/(e.y-t.y),s=t.x+i*(e.x-t.x);else if(e.y>=this._ymin&&e.y<=this._ymax)s=e.x<=this._xmin?this._xmin:this._xmax,i=(s-t.x)/(e.x-t.x),n=t.y+i*(e.y-t.y);else{n=e.y<=this._ymin?this._ymin:this._ymax,s=e.x<=this._xmin?this._xmin:this._xmax;const r=(s-t.x)/(e.x-t.x),o=(n-t.y)/(e.y-t.y);r<o?(i=r,n=t.y+r*(e.y-t.y)):(i=o,s=t.x+o*(e.x-t.x))}return this._r=i,new r(s,n)}_pushLine(){this._line&&(this._type===n.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===n.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===n.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(t,e,s){this._type!==n.Polygon?s&&(t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),e=Math.round((e-(this._ymin+this._margin))*this._finalRatio),this._line.push(new r(t,e))):(s||(t<this._xmin&&(t=this._xmin),t>this._xmax&&(t=this._xmax),e<this._ymin&&(e=this._ymin),e>this._ymax&&(e=this._ymax)),t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),e=Math.round((e-(this._ymin+this._margin))*this._finalRatio),this._line.push(new r(t,e)),this._isH=!1,this._isV=!1)}_lineTo(t,e,s){let i,o;if(this._type!==n.Polygon)if(s){if(t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),e=Math.round((e-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(i=this._line[this._line.length-1],i.equals(t,e)))return;this._line.push(new r(t,e))}else this._line&&this._line.length>0&&this._pushLine();else if(s||(t<this._xmin&&(t=this._xmin),t>this._xmax&&(t=this._xmax),e<this._ymin&&(e=this._ymin),e>this._ymax&&(e=this._ymax)),t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),e=Math.round((e-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){i=this._line[this._line.length-1];const s=i.x===t,n=i.y===e;if(s&&n)return;this._isH&&s||this._isV&&n?(i.x=t,i.y=e,o=this._line[this._line.length-2],o.x===t&&o.y===e?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(o=this._line[this._line.length-2],this._isH=o.x===t,this._isV=o.y===e)):(this._isH=o.x===t,this._isV=o.y===e)):(this._line.push(new r(t,e)),this._isH=s,this._isV=n)}else this._line.push(new r(t,e))}}class l{setExtent(t){this._ratio=4096===t?1:4096/t}get validateTessellation(){return this._ratio<1}reset(t){this._lines=[],this._line=null}moveTo(t,e){this._line&&this._lines.push(this._line),this._line=[];const s=this._ratio;this._line.push(new r(t*s,e*s))}lineTo(t,e){const s=this._ratio;this._line.push(new r(t*s,e*s))}close(){const t=this._line;t&&!t[0].isEqual(t[t.length-1])&&t.push(t[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}!function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"}(i||(i={}));class h{static simplify(t,e,s){if(!s)return;const n=-e,r=t+e,o=-e,a=t+e,l=[],u=[],c=s.length;for(let h=0;h<c;++h){const t=s[h];if(!t||t.length<2)continue;let e,c=t[0];const m=t.length;for(let s=1;s<m;++s)e=t[s],c.x===e.x&&(c.x<=n&&(c.y>e.y?(l.push(h),l.push(s),l.push(i.sideLeft),l.push(-1)):(u.push(h),u.push(s),u.push(i.sideLeft),u.push(-1))),c.x>=r&&(c.y<e.y?(l.push(h),l.push(s),l.push(i.sideRight),l.push(-1)):(u.push(h),u.push(s),u.push(i.sideRight),u.push(-1)))),c.y===e.y&&(c.y<=o&&(c.x<e.x?(l.push(h),l.push(s),l.push(i.sideTop),l.push(-1)):(u.push(h),u.push(s),u.push(i.sideTop),u.push(-1))),c.y>=a&&(c.x>e.x?(l.push(h),l.push(s),l.push(i.sideBottom),l.push(-1)):(u.push(h),u.push(s),u.push(i.sideBottom),u.push(-1)))),c=e}if(0===l.length||0===u.length)return;h.fillParent(s,u,l),h.fillParent(s,l,u);const m=[];h.calcDeltas(m,u,l),h.calcDeltas(m,l,u),h.addDeltas(m,s)}static fillParent(t,e,s){const n=s.length,r=e.length;for(let o=0;o<r;o+=4){const r=e[o],a=e[o+1],l=e[o+2],h=t[r][a-1],c=t[r][a];let m=8092,d=-1;for(let e=0;e<n;e+=4){if(s[e+2]!==l)continue;const n=s[e],r=s[e+1],o=t[n][r-1],a=t[n][r];switch(l){case i.sideLeft:case i.sideRight:if(u(h.y,o.y,a.y)&&u(c.y,o.y,a.y)){const t=Math.abs(a.y-o.y);t<m&&(m=t,d=e)}break;case i.sideTop:case i.sideBottom:if(u(h.x,o.x,a.x)&&u(c.x,o.x,a.x)){const t=Math.abs(a.x-o.x);t<m&&(m=t,d=e)}}}e[o+3]=d}}static calcDeltas(t,e,s){const n=e.length;for(let i=0;i<n;i+=4){const n=[],r=h.calcDelta(i,e,s,n);t.push(e[i]),t.push(e[i+1]),t.push(e[i+2]),t.push(r)}}static calcDelta(t,e,s,n){const i=e[t+3];if(-1===i)return 0;const r=n.length;return r>1&&n[r-2]===i?0:(n.push(i),h.calcDelta(i,s,e,n)+1)}static addDeltas(t,e){const s=t.length;let n=0;for(let i=0;i<s;i+=4){const e=t[i+3];e>n&&(n=e)}for(let r=0;r<s;r+=4){const s=e[t[r]],o=t[r+1],a=n-t[r+3];switch(t[r+2]){case i.sideLeft:s[o-1].x-=a,s[o].x-=a,1===o&&(s[s.length-1].x-=a),o===s.length-1&&(s[0].x-=a);break;case i.sideRight:s[o-1].x+=a,s[o].x+=a,1===o&&(s[s.length-1].x+=a),o===s.length-1&&(s[0].x+=a);break;case i.sideTop:s[o-1].y-=a,s[o].y-=a,1===o&&(s[s.length-1].y-=a),o===s.length-1&&(s[0].y-=a);break;case i.sideBottom:s[o-1].y+=a,s[o].y+=a,1===o&&(s[s.length-1].y+=a),o===s.length-1&&(s[0].y+=a)}}}}const u=(t,e,s)=>t>=e&&t<=s||t>=s&&t<=e},73138:(t,e,s)=>{s.d(e,{d:()=>h});var n=s(80510),i=s(36358),r=s(23806),o=s(65319),a=s(43525);const l=222045e-19;function h(t){if(0===t.totalSize)return null;const e=(0,i.z8)(t);if(!e)return null;const s=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*l;let o=0,a=0;t.reset();for(let n=0;t.nextPath();n++){const e=t.getCurrentRingArea();e>a&&(a=e,o=n)}if(t.seekPath(o),0===t.pathSize)return null;t.seekPathStart();const h=(0,i.B$)(t);if(Math.abs(a)<=2*s*s)return[(h[0]+h[2])/2,(h[1]+h[3])/2];t.seekPathStart();const d=(0,r.w2)(t,(0,n.vt)());if(null===d)return null;if(t.totalPoints<4)return d;const g=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],p=[NaN,NaN,NaN,NaN],_=[NaN,NaN,NaN,NaN];let f=!1,y=c(d,t,!0);0===y.distance&&(f=!0,g[0][0]=d[0],g[0][1]=d[1],y=c(d,t,!1)),p[0]=y.distance,_[0]=0;const x=[NaN,NaN];let S=!1,E=.25,C=-1,w=NaN;do{if(w=NaN,g[1]=m(t,v(h[0],h[2],E),s,e),isNaN(g[1][0])||isNaN(g[1][1])||(y=c(g[1],t,!1),w=y.distance),!isNaN(w)&&w>s&&u(g[1],t))S=!0,p[1]=w,_[1]=b(g[1],d);else if(!isNaN(w)&&w>C&&(C=w,x[0]=g[1][0],x[1]=g[1][1]),E-=.01,E<.1){if(!(C>=0))break;S=!0,p[1]=C,g[1][0]=x[0],g[1][1]=x[1],_[1]=b(g[1],d)}}while(!S);S=!1,E=.5,C=-1;let I=.01,T=1;do{if(w=NaN,g[2]=m(t,v(h[0],h[2],E),s,e),isNaN(g[2][0])||isNaN(g[2][1])||(y=c(g[2],t,!1),w=y.distance),!isNaN(w)&&w>s&&u(g[2],t))S=!0,p[2]=w,_[2]=b(g[2],d);else if(!isNaN(w)&&w>C)C=w,x[0]=g[2][0],x[1]=g[2][1];else if(w>C&&(C=w,x[0]=g[2][0],x[1]=g[2][1]),E=.5+I*T,I+=.01,T*=-1,E<.3||E>.7){if(!(C>=0))break;S=!0,p[2]=C,g[2][0]=x[0],g[2][1]=x[1],_[2]=b(g[2],d)}}while(!S);S=!1,E=.75,C=-1;do{if(w=NaN,g[3]=m(t,v(h[0],h[2],E),s,e),isNaN(g[3][0])||isNaN(g[3][1])||(y=c(g[3],t,!1),w=y.distance),!isNaN(w)&&w>s&&u(g[3],t))S=!0,p[3]=w,_[3]=b(g[3],d);else if(w>C&&(C=w,x[0]=g[3][0],x[1]=g[3][1]),E+=.01,E>.9){if(!(C>=0))break;S=!0,p[3]=C,g[3][0]=x[0],g[3][1]=x[1],_[3]=b(g[3],d)}}while(!S);const A=[0,1,2,3],M=f?0:1;let D;for(let n=M;n<4;n++)for(let t=M;t<3;t++){const e=_[t],s=_[t+1];P(e,s)>0&&(D=A[t],A[t]=A[t+1],A[t+1]=D,_[t]=s,_[t+1]=e)}let N=M,F=0,R=0;for(let n=M;n<4;n++){switch(n){case 0:R=2*p[A[n]];break;case 1:R=1.66666666*p[A[n]];break;case 2:R=1.33333333*p[A[n]];break;case 3:R=p[A[n]]}R>F&&(F=R,N=A[n])}return g[N]}function u(t,e){let s,n,i,r,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(s=e.x,n=e.y;e.nextPoint();s=i,n=r)i=e.x,r=e.y,n>t[1]!=r>t[1]&&((i-s)*(t[1]-n)-(r-n)*(t[0]-s)>0?o++:o--);return 0!==o}function c(t,e,s){if(s&&u(t,e))return{coord:t,distance:0};let n=1/0,i=0,r=0,a=[0,0],l=[0,0];const h=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(a[0]=e.x,a[1]=e.y;e.nextPoint();a=l){l=[e.x,e.y],(0,o.gR)(h,t,a,l);const s=b(t,h);s<n&&(n=s,i=h[0],r=h[1])}return{coord:[i,r],distance:Math.sqrt(n)}}function m(t,e,s,i){const r=[e,0];let o=1/0,l=1/0,h=!1,u=!1;const c=[[e,i[1]-1],[e,i[3]+1]],m=[0,0],g=[0,0],p=[0,0],_=[[0,0],[0,0]],f=(0,n.vt)();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(_[0][0]=t.x,_[0][1]=t.y;t.nextPoint();_[0][0]=_[1][0],_[0][1]=_[1][1]){if(_[1][0]=t.x,_[1][1]=t.y,null===d(f,_))continue;if(g[0]=c[0][0],g[1]=c[0][1],p[0]=c[1][0],p[1]=c[1][1],0===y(f,g,p))continue;if(!(0,a.Ql)(c[0],c[1],_[0],_[1],m))continue;const e=m[1];o>l?e<o&&(o=e,h=!0):e<l&&(l=e,u=!0)}return h&&u?r[1]=(o+l)/2:r[0]=r[1]=NaN,r}function d(t,e){if(e.length<2)return null;t||(t=(0,n.vt)());const[s,i]=e[0],[r,o]=e[1];return t[0]=Math.min(s,r),t[1]=Math.min(i,o),t[2]=Math.max(s,r),t[3]=Math.max(i,o),t}const g=1,p=4,_=3,f=12;function y(t,e,s){let n=x(e,t),i=x(s,t);const r=t[0],o=t[1],a=t[2],l=t[3];if(n&i)return 0;if(!(n|i))return 4;const h=(n?1:0)|(i?2:0);do{const h=s[0]-e[0],u=s[1]-e[1];if(h>u)n&_?(n&g?(e[1]+=u*(r-e[0])/h,e[0]=r):(e[1]+=u*(a-e[0])/h,e[0]=a),n=x(e,t)):i&_?(i&g?(s[1]+=u*(r-s[0])/h,s[0]=r):(s[1]+=u*(a-s[0])/h,s[0]=a),i=x(s,t)):n?(n&p?(e[0]+=h*(o-e[1])/u,e[1]=o):(e[0]+=h*(l-e[1])/u,e[1]=l),n=x(e,t)):(i&p?(s[0]+=h*(o-s[1])/u,s[1]=o):(s[0]+=h*(l-s[1])/u,s[1]=l),i=x(s,t));else if(n&f?(n&p?(e[0]+=h*(o-e[1])/u,e[1]=o):(e[0]+=h*(l-e[1])/u,e[1]=l),n=x(e,t)):i&f?(i&p?(s[0]+=h*(o-s[1])/u,s[1]=o):(s[0]+=h*(l-s[1])/u,s[1]=l),i=x(s,t)):n?(n&g?(e[1]+=u*(r-e[0])/h,e[0]=r):(e[1]+=u*(a-e[0])/h,e[0]=a),n=x(e,t)):(i&g?(s[1]+=u*(r-s[0])/h,s[0]=r):(s[1]+=u*(a-s[0])/h,s[0]=a),i=x(s,t)),n&i)return 0}while(n|i);return h}function x(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function v(t,e,s){return t+(e-t)*s}function b(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function P(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const s=isNaN(t),n=isNaN(e);return s<n?-1:s>n?1:0}},1114:(t,e,s)=>{s.d(e,{CK:()=>h,E9:()=>a,Hq:()=>l,MW:()=>u,TE:()=>c,yJ:()=>m});var n=s(24121),i=s(97066),r=s(97557),o=s(99218);function a(t){return null==t.origin}function l(t){return null!=t.origin}function h(t){return l(t.vertexSpace)}function u(t,e){if(!l(t))return null;const[s,n,r]=t.origin;return new i.A({x:s,y:n,z:r,spatialReference:e})}function c(t,e){const{x:s,y:n,z:i,spatialReference:a}=t,l=[s,n,i??0];return"local"===(e?.vertexSpace??function(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}(a))?new o.A({origin:l}):new r.A({origin:l})}function m(t,e){return t.type===e.type&&(t.origin===e.origin||null!=t.origin&&null!=e.origin&&(0,n.q)(t.origin,e.origin))}},20698:(t,e,s)=>{s.d(e,{$X:()=>A,B2:()=>o,Gy:()=>E,IE:()=>r,P5:()=>M,Q1:()=>i,QE:()=>w,SW:()=>I,Tr:()=>T,VV:()=>n,wp:()=>C});s(1171);function n(t){return t?{originPosition:"upper-left"===t.originPosition?"upperLeft":"lower-left"===t.originPosition?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance,1,1]:[1,1,1,1],translate:null!=t.extent?[t.extent.xmin,t.extent.ymax,t.extent.zmin??0,t.extent.mmin??0]:[0,0,0,0]}:null}function i(t){if(function(t){return"lowerLeft"===t.originPosition&&4===t.scale.length&&4===t.translate.length}(t))return t;const{originPosition:e,scale:s,translate:n}=t,i=s[0]??1,r=s[1]??1;return{originPosition:"lowerLeft",scale:[i,"lowerLeft"===e?r:-r,s[2]??1,s[3]??1],translate:[n[0]??0,n[1]??0,n[2]??0,n[3]??0]}}function r({scale:t,translate:e},s){return Math.round((s-e[0])/t[0])}function o({scale:t,translate:e},s){return Math.round((s-e[1])/t[1])}function a({scale:t,translate:e},s){return Math.round(((s??0)-e[2])/t[2])}function l({scale:t,translate:e},s){return s?Math.round((s-e[3])/t[3]):0}function h(t,e){return t&&e?d:t&&!e?c:!t&&e?m:u}const u=(t,e)=>{const s=[];if(!e.length)return null;const n=e[0];let i=r(t,n[0]),a=o(t,n[1]);s.push([i,a]);for(let l=1;l<e.length;l++){const[n,h]=e[l],u=r(t,n),c=o(t,h);u===i&&c===a||s.push([u-i,c-a]),i=u,a=c}return s},c=(t,e)=>{const s=[];if(!e.length)return null;const n=e[0];let i=r(t,n[0]),l=o(t,n[1]),h=a(t,n[2]);s.push([i,l,h]);for(let u=1;u<e.length;u++){const[n,c,m]=e[u],d=r(t,n),g=o(t,c),p=a(t,m);d===i&&g===l&&p===h||s.push([d-i,g-l,p]),i=d,l=g,h=p}return s},m=(t,e)=>{const s=[];if(!e.length)return null;const n=e[0];let i=r(t,n[0]),a=o(t,n[1]),h=l(t,n[2]);s.push([i,a,h]);for(let u=1;u<e.length;u++){const[n,c,m]=e[u],d=r(t,n),g=o(t,c),p=l(t,m);d===i&&g===a&&p===h||s.push([d-i,g-a,p]),i=d,a=g,h=p}return s},d=(t,e)=>{const s=[];if(!e.length)return null;const n=e[0];let i=r(t,n[0]),h=o(t,n[1]),u=a(t,n[2]),c=l(t,n[3]);s.push([i,h,u,c]);for(let m=1;m<e.length;m++){const[n,d,g,p]=e[m],_=r(t,n),f=o(t,d),y=a(t,g),x=l(t,p);_===i&&f===h&&y===u&&x===c||s.push([_-i,f-h,y,x]),i=_,h=f,u=y,c=x}return s};function g({scale:t,translate:e},s){return s*t[0]+e[0]}function p({scale:t,translate:e},s){return s*t[1]+e[1]}function _({scale:t,translate:e},s){return(s??0)*t[2]+e[2]}function f({scale:t,translate:e},s){return s?s*t[3]+e[3]:0}function y(t,e){return t&&e?P:t&&!e?v:!t&&e?b:x}const x=(t,e)=>{const s=new Array(e.length);if(!e.length)return s;const n=e[0];let i=g(t,n[0]),r=p(t,n[1]);s[0]=[i,r];const{scale:o,originPosition:a}=t,l=o[0],h="lowerLeft"===a?o[1]:-o[1];for(let u=1;u<e.length;u++){const[t,n]=e[u];i+=l*t,r+=h*n,s[u]=[i,r]}return s},v=(t,e)=>{const s=new Array(e.length);if(!e.length)return s;const n=e[0];let i=g(t,n[0]),r=p(t,n[1]);s[0]=[i,r,_(t,n[2])];const{scale:o,originPosition:a}=t,l=o[0],h="lowerLeft"===a?o[1]:-o[1];for(let u=1;u<e.length;u++){const[n,o,a]=e[u];i+=l*n,r+=h*o,s[u]=[i,r,_(t,a)]}return s},b=(t,e)=>{const s=new Array(e.length);if(!e.length)return s;const n=e[0];let i=g(t,n[0]),r=p(t,n[1]);s[0]=[i,r,f(t,n[2])];const{scale:o,originPosition:a}=t,l=o[0],h="lowerLeft"===a?o[1]:-o[1];for(let u=1;u<e.length;u++){const[n,o,a]=e[u];i+=l*n,r+=h*o,s[u]=[i,r,f(t,a)]}return s},P=(t,e)=>{const s=new Array(e.length);if(!e.length)return s;const n=e[0];let i=g(t,n[0]),r=p(t,n[1]);s[0]=[i,r,_(t,n[2]),f(t,n[3])];const{scale:o,originPosition:a}=t,l=o[0],h="lowerLeft"===a?o[1]:-o[1];for(let u=1;u<e.length;u++){const[n,o,a,c]=e[u];i+=l*n,r+=h*o,s[u]=[i,r,_(t,a),f(t,c)]}return s};function S(t,e,s){const n=new Array(s.length);for(let i=0;i<s.length;i++)n[i]=e(t,s[i]);return n}function E(t,e,s){const n=i(t);return e.x=r(n,s.x),e.y=o(n,s.y),null!=s.z&&(e.z=a(n,s.z)),null!=s.m&&(e.m=l(n,s.m)),e}function C(t,e,s){const n=function(t,e,s,n){const i=[],r=h(s,n);for(let o=0;o<e.length;o++){const s=r(t,e[o]);s&&s.length>=3&&i.push(s)}return i.length?i:null}(i(t),s.rings,s.hasZ,s.hasM);return n?(e.rings=n,e.hasZ=s.hasZ??!1,e.hasM=s.hasM??!1,e):null}function w(t,e,s){const n=function(t,e,s,n){const i=[],r=h(s,n);for(let o=0;o<e.length;o++){const s=r(t,e[o]);s&&s.length>=2&&i.push(s)}return i.length?i:null}(i(t),s.paths,s.hasZ,s.hasM);return n?(e.paths=n,e.hasZ=s.hasZ??!1,e.hasM=s.hasM??!1,e):null}function I(t,e,s,n=s?.hasZ??!1,r=s?.hasM??!1){if(null!=s){const o=i(t);e.points=y(n,r)(o,s.points),e.hasZ=n,e.hasM=r}return e}function T(t,e,s,n=null!=s?.z,r=null!=s?.m){if(null==s)return e;const o=i(t);return e.x=g(o,s.x),e.y=p(o,s.y),n&&(e.z=_(o,s.z)),r&&(e.m=f(o,s.m)),e}function A(t,e,s,n=s?.hasZ??!1,r=s?.hasM??!1){if(null!=s){const o=i(t);e.rings=S(o,y(n,r),s.rings),e.hasZ=n,e.hasM=r}return e}function M(t,e,s,n=s?.hasZ??!1,r=s?.hasM??!1){if(null!=s){const o=i(t);e.paths=S(o,y(n,r),s.paths),e.hasZ=n,e.hasM=r}return e}},61781:(t,e,s)=>{s.d(e,{X_:()=>o,eU:()=>l,i1:()=>a,oW:()=>u,zx:()=>h});var n=s(92504),i=s(92976);const r=96;function o(t,e){const s=e||t.extent,n=t.width,o=(0,i.GA)(s?.spatialReference);return s&&n?s.width/n*o*i.dy*r:0}function a(t,e){return t/((0,i.GA)(e)*i.dy*r)}function l(t,e){const s=t.extent,n=t.width-(t.padding?t.padding.left+t.padding.right:0),i=a(e,s.spatialReference);return s.clone().expand(i*n/s.width)}function h(t,e,s){return function(t,e){return 0===e||(0,n.Sp)(t,e)||t<e}(t,e)&&function(t,e){return 0===e||(0,n.Sp)(t,e)||t>e}(t,s)}function u(t,e){return(0,n.Sp)(t,e)?0:(t||Number.POSITIVE_INFINITY)>(e||Number.POSITIVE_INFINITY)?1:-1}},57079:(t,e,s)=>{s.d(e,{$B:()=>d});var n=s(66866),i=s(52495),r=s(39831),o=s(19251),a=s(539),l=s(21564),h=s(63863),u=s(81816),c=s(57922);const m=-1;let d=class extends i.A{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=(0,r.A)("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(g(t))}catch(e){this._transitionTo([]),a.A.getLogger(this).warn("Invalid Effect",{effect:t,error:e})}}}get final(){return this._final}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return null!==this._to}canTransitionTo(t){try{return this.scale>0&&p(this._current,g(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}endTransition(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&p(this._current,t,this.scale)?(this._final=t,this._to=(0,o.o8)(t),function(t,e,s){const n=t.length>e.length?t:e,i=t.length>e.length?e:t,r=i[i.length-1],o=r?.scale??s,a=r?.effects??[];for(let l=i.length;l<n.length;l++)i.push({scale:o,effects:[...a]});for(let l=0;l<n.length;l++)i[l].scale=i[l].scale===m?s:i[l].scale,n[l].scale=n[l].scale===m?s:n[l].scale,(0,c.O9)(i[l].effects,n[l].effects)}(this._current,this._to,this.scale),this._from=(0,o.o8)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?(0,o.o8)(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let s=0;s<this._current.length;s++){const t=this._current[s],n=this._from[s],i=this._to[s];t.scale=_(n.scale,i.scale,e);for(let s=0;s<t.effects.length;s++){const r=t.effects[s],o=n.effects[s],a=i.effects[s];r.interpolate(o,a,e)}}1===e&&(this._current=this._final,this._set("effects",this._current[0]?(0,o.o8)(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),0===this._current.length)return;const e=this._current,s=this._current.length-1;let n,i,r=1;if(1===e.length||t>=e[0].scale)i=n=e[0].effects;else if(t<=e[s].scale)i=n=e[s].effects;else for(let o=0;o<s;o++){const s=e[o],a=e[o+1];if(s.scale>=t&&a.scale<=t){r=(t-s.scale)/(a.scale-s.scale),n=s.effects,i=a.effects;break}}for(let o=0;o<this.effects.length;o++)this.effects[o].interpolate(n[o],i[o],r)}};function g(t){const e=(0,u.q)(t)||[];return function(t){const e=t[0];return!!e&&"type"in e}(e)?[{scale:m,effects:e}]:e}function p(t,e,s){return!t[0]?.effects||!e[0]?.effects||!((t[0]?.scale===m||e[0]?.scale===m)&&(t.length>1||e.length>1)&&s<=0)&&(0,c.mj)(t[0].effects,e[0].effects)}function _(t,e,s){return t+(e-t)*s}(0,n._)([(0,l.MZ)()],d.prototype,"_to",void 0),(0,n._)([(0,l.MZ)()],d.prototype,"duration",void 0),(0,n._)([(0,l.MZ)({value:""})],d.prototype,"effect",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"effects",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"final",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"hasEffects",null),(0,n._)([(0,l.MZ)({value:0})],d.prototype,"scale",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"transitioning",null),d=(0,n._)([(0,h.$)("esri.layers.effects.EffectView")],d)},27664:(t,e,s)=>{s.d(e,{LF:()=>a,M9:()=>l,zu:()=>h});var n=s(98849),i=s(76724),r=s(81816),o=s(57922);function a(t,e,s){try{return function(t){if(!t||0===t.length)return null;if(function(t){const e=t[0];return!!e&&"scale"in e}(t)){const e=[];for(const s of t)e.push({scale:s.scale,value:h(s.value)});return e}return h(t)}(t)}catch(n){s?.messages?.push(n)}return null}function l(t,e,s,n){try{const n=function(t){const e=(0,r.q)(t);return e?(0,o.dw)(e)?e.map((t=>t.toJSON())):e.map((({scale:t,effects:e})=>({scale:t,value:e.map((t=>t.toJSON()))}))):null}(t);(0,i.sM)(s,n,e)}catch(l){n.messages&&n.messages.push(l)}}function h(t){if(!t?.length)return"";const e=[];for(const s of t){let t=[];switch(s.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":t=[u(s,"amount")];break;case"blur":t=[u(s,"radius","pt")];break;case"hue-rotate":t=[u(s,"angle","deg")];break;case"drop-shadow":t=[u(s,"xoffset","pt"),u(s,"yoffset","pt"),u(s,"blurRadius","pt"),c(s,"color")];break;case"bloom":t=[u(s,"strength"),u(s,"radius","pt"),u(s,"threshold")]}const n=`${s.type}(${t.filter(Boolean).join(" ")})`;(0,r.q)(n),e.push(n)}return e.join(" ")}function u(t,e,s){if(null==t[e])throw new n.A("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return s?t[e]+s:""+t[e]}function c(t,e){if(null==t[e])throw new n.A("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const s=t[e];return`rgba(${s[0]||0}, ${s[1]||0}, ${s[2]||0}, ${s[3]/255||0})`}},81816:(t,e,s)=>{s.d(e,{q:()=>h});var n=s(31415),i=s(98849),r=s(47740),o=s(57922);class a extends SyntaxError{constructor(t,e,s,n){super(t),this.expected=e,this.found=s,this.location=n,this.name="SyntaxError"}format(t){let e="Error: "+this.message;if(this.location){let s=null;const n=t.find((t=>t.source===this.location.source));n&&(s=n.text.split(/\r\n|\n|\r/g));const i=this.location.start,r=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(i):i,o=this.location.source+":"+r.line+":"+r.column;if(s){const t=this.location.end,n="".padEnd(r.line.toString().length," "),a=s[i.line-1],l=(i.line===t.line?t.column:a.length+1)-i.column||1;e+="\n --\x3e "+o+"\n"+n+" |\n"+r.line+" | "+a+"\n"+n+" | "+"".padEnd(i.column-1," ")+"".padEnd(l,"^")}else e+="\n at "+o}return e}static buildMessage(t,e){function s(t){return t.codePointAt(0).toString(16).toUpperCase()}const n=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function i(t){return n?t.replace(n,(t=>"\\u{"+s(t)+"}")):t}function r(t){return i(t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(t=>"\\x0"+s(t))).replace(/[\x10-\x1F\x7F-\x9F]/g,(t=>"\\x"+s(t))))}function o(t){return i(t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(t=>"\\x0"+s(t))).replace(/[\x10-\x1F\x7F-\x9F]/g,(t=>"\\x"+s(t))))}const a={literal:t=>'"'+r(t.text)+'"',class(t){const e=t.parts.map((t=>Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t)));return"["+(t.inverted?"^":"")+e.join("")+"]"+(t.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:t=>t.description};function l(t){return a[t.type](t)}return"Expected "+function(t){const e=t.map(l);if(e.sort(),e.length>0){let t=1;for(let s=1;s<e.length;s++)e[s-1]!==e[s]&&(e[t]=e[s],t++);e.length=t}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(t)+" but "+function(t){return t?'"'+r(t)+'"':"end of input"}(e)+" found."}}function l(t,e){const s={},n=(e=void 0!==e?e:{}).grammarSource,i={start:Pt};let r=Pt;const o="none",l=")",h=",",u="(",c="%",m="px",d="cm",g="mm",p="in",_="pt",f="pc",y="deg",x="rad",v="grad",b="turn",P="#",S=".",E="e",C=/^[ \t\n\r]/,w=/^[a-z\-]/,I=/^[0-9a-fA-F]/,T=/^[+\-]/,A=/^[0-9]/,M=yt("none"),D=_t("none",!1),N=_t(")",!1),F=_t(",",!1),R=ft([" ","\t","\n","\r"],!1,!1,!1),k=yt("function"),L=_t("(",!1),G=yt("identifier"),V=ft([["a","z"],"-"],!1,!1,!1),z=yt("percentage"),O=_t("%",!1),q=yt("length"),B=_t("px",!1),Y=_t("cm",!1),U=_t("mm",!1),H=_t("in",!1),X=_t("pt",!1),j=_t("pc",!1),Z=yt("angle"),W=_t("deg",!1),$=_t("rad",!1),K=_t("grad",!1),Q=_t("turn",!1),J=yt("number"),tt=yt("color"),et=_t("#",!1),st=ft([["0","9"],["a","f"],["A","F"]],!1,!1,!1),nt=ft(["+","-"],!1,!1,!1),it=ft([["0","9"]],!1,!1,!1),rt=_t(".",!1),ot=_t("e",!1);function at(t,e){return e.length>0?function(t,e,s){return[t].concat(function(t,e){return t.map((function(t){return t[e]}))}(e,s))}(t,e,3):[t]}let lt=0|e.peg$currPos,ht=lt;const ut=[{line:1,column:1}];let ct,mt=lt,dt=e.peg$maxFailExpected||[],gt=0|e.peg$silentFails;if(e.startRule){if(!(e.startRule in i))throw new Error("Can't start parsing from rule \""+e.startRule+'".');r=i[e.startRule]}function pt(){return t.substring(ht,lt)}function _t(t,e){return{type:"literal",text:t,ignoreCase:e}}function ft(t,e,s,n){return{type:"class",parts:t,inverted:e,ignoreCase:s,unicode:n}}function yt(t){return{type:"other",description:t}}function xt(e){let s,n=ut[e];if(n)return n;if(e>=ut.length)s=ut.length-1;else for(s=e;!ut[--s];);for(n=ut[s],n={line:n.line,column:n.column};s<e;)10===t.charCodeAt(s)?(n.line++,n.column=1):n.column++,s++;return ut[e]=n,n}function vt(t,e,s){const i=xt(t),r=xt(e);return{source:n,start:{offset:t,line:i.line,column:i.column},end:{offset:e,line:r.line,column:r.column}}}function bt(t){lt<mt||(lt>mt&&(mt=lt,dt=[]),dt.push(t))}function Pt(){let t;return t=St(),t===s&&(t=function(){let t,e;if(t=[],e=Et(),e!==s)for(;e!==s;)t.push(e),e=Et();else t=s;return t}()),t}function St(){let e,n;return gt++,e=lt,wt(),t.substr(lt,4)===o?(n=o,lt+=4):(n=s,0===gt&&bt(D)),n!==s?(wt(),ht=e,e=[]):(lt=e,e=s),gt--,e===s&&0===gt&&bt(M),e}function Et(){let e,n,i,r;return e=lt,wt(),n=function(){let e,n,i;return gt++,e=lt,n=It(),n!==s?(40===t.charCodeAt(lt)?(i=u,lt++):(i=s,0===gt&&bt(L)),i!==s?(ht=e,e=n):(lt=e,e=s)):(lt=e,e=s),gt--,e===s&&(n=s,0===gt&&bt(k)),e}(),n!==s?(wt(),i=function(){let e,n,i,r,o,a,l,u;if(e=lt,n=Ct(),n!==s){for(i=[],r=lt,o=wt(),44===t.charCodeAt(lt)?(a=h,lt++):(a=s,0===gt&&bt(F)),a===s&&(a=null),l=wt(),u=Ct(),u!==s?(o=[o,a,l,u],r=o):(lt=r,r=s);r!==s;)i.push(r),r=lt,o=wt(),44===t.charCodeAt(lt)?(a=h,lt++):(a=s,0===gt&&bt(F)),a===s&&(a=null),l=wt(),u=Ct(),u!==s?(o=[o,a,l,u],r=o):(lt=r,r=s);ht=e,e=at(n,i)}else lt=e,e=s;return e}(),i===s&&(i=null),wt(),41===t.charCodeAt(lt)?(r=l,lt++):(r=s,0===gt&&bt(N)),r!==s?(wt(),ht=e,e=function(t,e){return{type:"function",name:t,parameters:e||[]}}(n,i)):(lt=e,e=s)):(lt=e,e=s),e}function Ct(){let t,e;return t=lt,e=Tt(),e===s&&(e=At(),e===s&&(e=Mt(),e===s&&(e=function(){let t,e;return gt++,t=lt,wt(),e=Nt(),e!==s?(ht=t,t=function(t){return{value:t,unit:null}}(e)):(lt=t,t=s),gt--,t===s&&0===gt&&bt(J),t}()))),e!==s&&(ht=t,e=function(t){return{type:"quantity",value:t.value,unit:t.unit}}(e)),t=e,t===s&&(t=lt,e=Dt(),e!==s&&(ht=t,e=function(t){return{type:"color",colorType:t.type,value:t.value}}(e)),t=e),t}function wt(){let e,n;for(gt++,e=[],n=t.charAt(lt),C.test(n)?lt++:(n=s,0===gt&&bt(R));n!==s;)e.push(n),n=t.charAt(lt),C.test(n)?lt++:(n=s,0===gt&&bt(R));return gt--,e}function It(){let e,n,i;if(gt++,e=lt,n=[],i=t.charAt(lt),w.test(i)?lt++:(i=s,0===gt&&bt(V)),i!==s)for(;i!==s;)n.push(i),i=t.charAt(lt),w.test(i)?lt++:(i=s,0===gt&&bt(V));else n=s;return n!==s&&(ht=e,n=pt()),e=n,gt--,e===s&&(n=s,0===gt&&bt(G)),e}function Tt(){let e,n,i;return gt++,e=lt,wt(),n=Nt(),n!==s?(37===t.charCodeAt(lt)?(i=c,lt++):(i=s,0===gt&&bt(O)),i!==s?(ht=e,e=function(t){return{value:t,unit:"%"}}(n)):(lt=e,e=s)):(lt=e,e=s),gt--,e===s&&0===gt&&bt(z),e}function At(){let e,n,i;return gt++,e=lt,wt(),n=Nt(),n!==s?(t.substr(lt,2)===m?(i=m,lt+=2):(i=s,0===gt&&bt(B)),i!==s?(ht=e,e=function(t){return{value:t,unit:"px"}}(n)):(lt=e,e=s)):(lt=e,e=s),e===s&&(e=lt,wt(),n=Nt(),n!==s?(t.substr(lt,2)===d?(i=d,lt+=2):(i=s,0===gt&&bt(Y)),i!==s?(ht=e,e=function(t){return{value:t,unit:"cm"}}(n)):(lt=e,e=s)):(lt=e,e=s),e===s&&(e=lt,wt(),n=Nt(),n!==s?(t.substr(lt,2)===g?(i=g,lt+=2):(i=s,0===gt&&bt(U)),i!==s?(ht=e,e=function(t){return{value:t,unit:"mm"}}(n)):(lt=e,e=s)):(lt=e,e=s),e===s&&(e=lt,wt(),n=Nt(),n!==s?(t.substr(lt,2)===p?(i=p,lt+=2):(i=s,0===gt&&bt(H)),i!==s?(ht=e,e=function(t){return{value:t,unit:"in"}}(n)):(lt=e,e=s)):(lt=e,e=s),e===s&&(e=lt,wt(),n=Nt(),n!==s?(t.substr(lt,2)===_?(i=_,lt+=2):(i=s,0===gt&&bt(X)),i!==s?(ht=e,e=function(t){return{value:t,unit:"pt"}}(n)):(lt=e,e=s)):(lt=e,e=s),e===s&&(e=lt,wt(),n=Nt(),n!==s?(t.substr(lt,2)===f?(i=f,lt+=2):(i=s,0===gt&&bt(j)),i!==s?(ht=e,e=function(t){return{value:t,unit:"pc"}}(n)):(lt=e,e=s)):(lt=e,e=s)))))),gt--,e===s&&0===gt&&bt(q),e}function Mt(){let e,n,i;return gt++,e=lt,n=Nt(),n!==s?(t.substr(lt,3)===y?(i=y,lt+=3):(i=s,0===gt&&bt(W)),i!==s?(ht=e,e=function(t){return{value:t,unit:"deg"}}(n)):(lt=e,e=s)):(lt=e,e=s),e===s&&(e=lt,n=Nt(),n!==s?(t.substr(lt,3)===x?(i=x,lt+=3):(i=s,0===gt&&bt($)),i!==s?(ht=e,e=function(t){return{value:t,unit:"rad"}}(n)):(lt=e,e=s)):(lt=e,e=s),e===s&&(e=lt,n=Nt(),n!==s?(t.substr(lt,4)===v?(i=v,lt+=4):(i=s,0===gt&&bt(K)),i!==s?(ht=e,e=function(t){return{value:t,unit:"grad"}}(n)):(lt=e,e=s)):(lt=e,e=s),e===s&&(e=lt,n=Nt(),n!==s?(t.substr(lt,4)===b?(i=b,lt+=4):(i=s,0===gt&&bt(Q)),i!==s?(ht=e,e=function(t){return{value:t,unit:"turn"}}(n)):(lt=e,e=s)):(lt=e,e=s)))),gt--,e===s&&(n=s,0===gt&&bt(Z)),e}function Dt(){let e,n,i,r;if(gt++,e=lt,35===t.charCodeAt(lt)?(n=P,lt++):(n=s,0===gt&&bt(et)),n!==s){if(i=[],r=t.charAt(lt),I.test(r)?lt++:(r=s,0===gt&&bt(st)),r!==s)for(;r!==s;)i.push(r),r=t.charAt(lt),I.test(r)?lt++:(r=s,0===gt&&bt(st));else i=s;i!==s?(ht=e,e={type:"hex",value:pt()}):(lt=e,e=s)}else lt=e,e=s;return e===s&&(e=lt,n=Et(),n!==s&&(ht=e,n=function(t){return{type:"function",value:t}}(n)),e=n,e===s&&(e=lt,n=It(),n!==s&&(ht=e,n={type:"named",value:pt()}),e=n)),gt--,e===s&&(n=s,0===gt&&bt(tt)),e}function Nt(){let e,n,i,r,o,a,l,h;for(e=lt,n=t.charAt(lt),T.test(n)?lt++:(n=s,0===gt&&bt(nt)),n===s&&(n=null),i=lt,r=[],o=t.charAt(lt),A.test(o)?lt++:(o=s,0===gt&&bt(it));o!==s;)r.push(o),o=t.charAt(lt),A.test(o)?lt++:(o=s,0===gt&&bt(it));if(46===t.charCodeAt(lt)?(o=S,lt++):(o=s,0===gt&&bt(rt)),o!==s){if(a=[],l=t.charAt(lt),A.test(l)?lt++:(l=s,0===gt&&bt(it)),l!==s)for(;l!==s;)a.push(l),l=t.charAt(lt),A.test(l)?lt++:(l=s,0===gt&&bt(it));else a=s;a!==s?(r=[r,o,a],i=r):(lt=i,i=s)}else lt=i,i=s;if(i===s)if(i=[],r=t.charAt(lt),A.test(r)?lt++:(r=s,0===gt&&bt(it)),r!==s)for(;r!==s;)i.push(r),r=t.charAt(lt),A.test(r)?lt++:(r=s,0===gt&&bt(it));else i=s;if(i!==s){if(r=lt,101===t.charCodeAt(lt)?(o=E,lt++):(o=s,0===gt&&bt(ot)),o!==s){if(a=t.charAt(lt),T.test(a)?lt++:(a=s,0===gt&&bt(nt)),a===s&&(a=null),l=[],h=t.charAt(lt),A.test(h)?lt++:(h=s,0===gt&&bt(it)),h!==s)for(;h!==s;)l.push(h),h=t.charAt(lt),A.test(h)?lt++:(h=s,0===gt&&bt(it));else l=s;l!==s?(o=[o,a,l],r=o):(lt=r,r=s)}else lt=r,r=s;r===s&&(r=null),ht=e,e=parseFloat(pt())}else lt=e,e=s;return e}ct=r();const Ft=ct!==s&&lt===t.length;function Rt(){throw ct!==s&&lt<t.length&&bt({type:"end"}),function(t,e,s){return new a(a.buildMessage(t,e),t,e,s)}(dt,mt<t.length?function(e=lt){const s=t.codePointAt(e);return void 0===s?"":String.fromCodePoint(s)}(mt):null,mt<t.length?vt(mt,mt+1):vt(mt,mt))}return e.peg$library?{peg$result:ct,peg$currPos:lt,peg$FAILED:s,peg$maxFailExpected:dt,peg$maxFailPos:mt,peg$success:Ft,peg$throw:Ft?void 0:Rt}:Ft?ct:void Rt()}function h(t){if(!t||0===t.length)return null;if("string"==typeof t){const e=u(t);return e&&0!==e.length?e:null}const e=t.map((t=>{if(!Number.isFinite(t.scale)||t.scale<=0)throw new i.A("effect:invalid-scale","scale must be finite and greater than 0",{stop:t});return{scale:t.scale,effects:u(t.value)}}));e.sort(((t,e)=>e.effects.length-t.effects.length));for(let s=0;s<e.length-1;s++){if(!(0,o.mj)(e[s].effects,e[s+1].effects))throw new i.A("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[s].effects,b:e[s+1].effects});(0,o.O9)(e[s].effects,e[s+1].effects)}return e.sort(((t,e)=>e.scale-t.scale)),e}function u(t){let e;if(!t)return[];try{e=l(t)}catch(s){throw new i.A("effect:invalid-syntax","Invalid effect syntax",{value:t,error:s})}return e.map((t=>function(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(t){let e=1;return c(t.parameters,1),1===t.parameters.length&&(e=_(t.parameters[0])),new r.yG(t.name,e)}(t);case"opacity":return function(t){let e=1;return c(t.parameters,1),1===t.parameters.length&&(e=_(t.parameters[0])),new r.jm(e)}(t);case"hue-rotate":return function(t){let e=0;return c(t.parameters,1),1===t.parameters.length&&(e=function(t){return function(t){if("quantity"!==t.type||!(0===t.value&&null===t.unit||t.unit&&null!=g[t.unit]))throw new i.A("effect:type-error",`Expected <angle>, Actual: ${m(t)}`,{term:t})}(t),t.value*g[t.unit]||0}(t.parameters[0])),new r.Nd(e)}(t);case"blur":return function(t){let e=0;return c(t.parameters,1),1===t.parameters.length&&(e=y(t.parameters[0]),d(e,t.parameters[0])),new r.Fk(e)}(t);case"drop-shadow":return function(t){const e=[];let s=null;for(const n of t.parameters)if("color"===n.type){if(e.length&&Object.freeze(e),s)throw new i.A("effect:type-error","Accepts only one color",{});s=x(n)}else{const t=y(n);if(Object.isFrozen(e))throw new i.A("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(t),3===e.length&&d(t,n)}if(e.length<2||e.length>3)throw new i.A("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new r.$b(e[0],e[1],e[2]||0,s||v("black"))}(t);case"bloom":return function(t){let e=1,s=0,n=0;return c(t.parameters,3),t.parameters[0]&&(e=_(t.parameters[0])),t.parameters[1]&&(s=y(t.parameters[1]),d(s,t.parameters[1])),t.parameters[2]&&(n=_(t.parameters[2])),new r.bv(e,s,n)}(t)}}catch(e){throw e.details.filter=t,e}throw new i.A("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}(t)))}function c(t,e){if(t.length>e)throw new i.A("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function m(t){if("color"===t.type)return"<color>";if(t.unit){if(t.unit in p)return"<length>";if(t.unit in g)return"<angle>";if("%"===t.unit)return"<percentage>"}return"<double>"}function d(t,e){if(t<0)throw new i.A("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}const g={deg:1,grad:.9,rad:180/Math.PI,turn:360};const p={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function _(t){!function(t){if("quantity"!==t.type||null!==t.unit&&"%"!==t.unit)throw new i.A("effect:type-error",`Expected <double> or <percentage>, Actual: ${m(t)}`,{term:t})}(t);const e=t.value;return d(e,t),"%"===t.unit?.01*e:e}function f(t){return function(t){if("quantity"!==t.type||null!==t.unit)throw new i.A("effect:type-error",`Expected <double>, Actual: ${m(t)}`,{term:t})}(t),d(t.value,t),t.value}function y(t){return function(t){if("quantity"!==t.type||!(0===t.value&&null===t.unit||t.unit&&null!=p[t.unit]))throw new i.A("effect:type-error",`Expected <length>, Actual: ${m(t)}`,{term:t})}(t),t.value*p[t.unit]||0}function x(t){switch(t.colorType){case"hex":return(0,n.j5)(t.value);case"named":return v(t.value);case"function":return function(t){if(c(t.parameters,4),b.test(t.name))return[_(t.parameters[0]),_(t.parameters[1]),_(t.parameters[2]),t.parameters[3]?_(t.parameters[3]):1];if(P.test(t.name))return(0,n.ay)(f(t.parameters[0]),_(t.parameters[1]),_(t.parameters[2]),t.parameters[3]?_(t.parameters[3]):1);throw new i.A("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}(t.value)}}function v(t){if(!(0,n.V6)(t))throw new i.A("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return(0,n.c4)(t)}const b=/^rgba?/i,P=/^hsla?/i},32597:(t,e,s)=>{s.d(e,{N3:()=>a,Om:()=>o});var n=s(4754),i=s(8964),r=s(88443);class o{constructor(t=null,e={},s,n,i=0){this.geometry=t,this.attributes=e,this.centroid=s,this.objectId=n,this.displayId=i}static fromJSON(t){const e=t.geometry?r.A.fromJSON(t.geometry):null,s=t.centroid?r.A.fromJSON(t.centroid):null,n=t.objectId;return new o(e,t.attributes,s,n)}weakClone(){const t=new o(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t}clone(){const t=this.geometry?.clone(),e=new o(t,{...this.attributes},this.centroid?.clone(),this.objectId);return e.displayId=this.displayId,e}ensureCentroid(t){return this.centroid??=(0,i.Q)(new r.A,this.geometry,t.hasZ,t.hasM),this.centroid}get usedMemory(){return 128+(0,n.lM)(this.attributes)+(this.geometry?.usedMemory??0)}}function a(t){return!!t.geometry?.coords?.length}},46461:(t,e,s)=>{s.d(e,{A:()=>n});class n{constructor(){this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new n;return t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}},88443:(t,e,s)=>{s.d(e,{A:()=>i});var n=s(4754);class i{constructor(t=[],e=[]){this.lengths=t??[],this.coords=e??[]}static fromJSON(t){return new i(t.lengths,t.coords)}static fromRect(t){const[e,s,n,r]=t,o=n-e,a=r-s;return new i([5],[e,s,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((t,e)=>t+e))}get usedMemory(){return 64+(0,n.Qf)(this.lengths,this.coords)}area(){let t=0,e=0;if(!this.lengths.length)return 0;for(let s=0;s<this.lengths.length;s++){const n=this.lengths[s];if(n<3)continue;let i=this.coords[2*e],r=this.coords[2*e+1];for(let s=1;s<n;s+=1){const n=this.coords[2*(s+e)],o=this.coords[2*(s+e)+1];t+=-.5*(n-i)*(o+r),i=n,r=o}e+=n}return t}forEachVertex(t){let e=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let s=0;s<this.lengths.length;s++){const n=this.lengths[s];for(let s=0;s<n;s++)t(this.coords[2*(s+e)],this.coords[2*(s+e)+1]);e+=n}}deltaDecode(){const t=this.clone(),{coords:e,lengths:s}=t;let n=0;for(const i of s){for(let t=1;t<i;t++)e[2*(n+t)]+=e[2*(n+t)-2],e[2*(n+t)+1]+=e[2*(n+t)-1];n+=i}return t}clone(t){if(0===this.lengths.length)return new i([],[this.coords[0],this.coords[1]]);const e=2*(0===this.lengths.length?1:this.lengths.reduce(((t,e)=>t+e))),s=this.coords.slice(0,e);return t?(t.set(s),new i(this.lengths,t)):new i(Array.from(this.lengths),Array.from(s))}}},8964:(t,e,s)=>{function n(t,e){return t?e?4:3:e?3:2}function i(t,e,s,i){if(!e?.lengths.length)return null;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const a=t.coords,l=[],h=s?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:u,coords:c}=e,m=n(s,i);let d=0;for(const n of u){const t=r(h,c,d,n,s,i);t&&l.push(t),d+=n*m}if(l.sort(((t,e)=>{let n=t[2]-e[2];return 0===n&&s&&(n=t[4]-e[4]),n})),l.length){let t=6*l[0][2];a[0]=l[0][0]/t,a[1]=l[0][1]/t,s&&(t=6*l[0][4],a[2]=0!==t?l[0][3]/t:0),(a[0]<h[0]||a[0]>h[1]||a[1]<h[2]||a[1]>h[3]||s&&(a[2]<h[4]||a[2]>h[5]))&&(a.length=0)}if(!a.length){const t=e.lengths[0]?o(c,0,u[0],s,i):null;if(!t)return null;a[0]=t[0],a[1]=t[1],s&&t.length>2&&(a[2]=t[2])}return t}function r(t,e,s,i,r,o){const a=n(r,o);let l=s,h=s+a,u=0,c=0,m=0,d=0,g=0;for(let n=0,_=i-1;n<_;n++,l+=a,h+=a){const s=e[l],n=e[l+1],i=e[l+2],o=e[h],a=e[h+1],p=e[h+2];let _=s*a-o*n;d+=_,u+=(s+o)*_,c+=(n+a)*_,r&&(_=s*p-o*i,m+=(i+p)*_,g+=_),s<t[0]&&(t[0]=s),s>t[1]&&(t[1]=s),n<t[2]&&(t[2]=n),n>t[3]&&(t[3]=n),r&&(i<t[4]&&(t[4]=i),i>t[5]&&(t[5]=i))}if(d>0&&(d*=-1),g>0&&(g*=-1),!d)return null;const p=[u,c,.5*d];return r&&(p[3]=m,p[4]=.5*g),p}function o(t,e,s,i,r){const o=n(i,r);let c=e,m=e+o,d=0,g=0,p=0,_=0;for(let n=0,f=s-1;n<f;n++,c+=o,m+=o){const e=t[c],s=t[c+1],n=t[c+2],r=t[m],o=t[m+1],f=t[m+2],y=i?l(e,s,n,r,o,f):a(e,s,r,o);if(y)if(d+=y,i){const t=u(e,s,n,r,o,f);g+=y*t[0],p+=y*t[1],_+=y*t[2]}else{const t=h(e,s,r,o);g+=y*t[0],p+=y*t[1]}}return d>0?i?[g/d,p/d,_/d]:[g/d,p/d]:s>0?i?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function a(t,e,s,n){const i=s-t,r=n-e;return Math.sqrt(i*i+r*r)}function l(t,e,s,n,i,r){const o=n-t,a=i-e,l=r-s;return Math.sqrt(o*o+a*a+l*l)}function h(t,e,s,n){return[t+.5*(s-t),e+.5*(n-e)]}function u(t,e,s,n,i,r){return[t+.5*(n-t),e+.5*(i-e),s+.5*(r-s)]}s.d(e,{Q:()=>i})},95694:(t,e,s)=>{s.d(e,{LQ:()=>h,ag:()=>c,pL:()=>u});var n=s(21355),i=s(88443);const r=new i.A,o=new i.A,a=new i.A,l={esriGeometryPoint:n.DF,esriGeometryPolyline:n.BW,esriGeometryPolygon:n.z5,esriGeometryMultipoint:n.qK};function h(t,e,s,i=t.hasZ,r=t.hasM){if(null==e)return null;const o=t.hasZ&&i,l=t.hasM&&r;if(s){const h=(0,n.Nl)(a,e,t.hasZ,t.hasM,"esriGeometryPoint",s,i,r);return(0,n.DF)(h,o,l)}return(0,n.DF)(e,o,l)}function u(t,e,s,i,h,u,c=e,m=s){const d=e&&c,g=s&&m,p=null!=i?"coords"in i?i:i.geometry:null;if(null==p)return null;if(h){let i=(0,n.kz)(o,p,e,s,t,h,c,m);return u&&(i=(0,n.Nl)(a,i,d,g,t,u)),l[t]?.(i,d,g)??null}if(u){const i=(0,n.Nl)(a,p,e,s,t,u,c,m);return l[t]?.(i,d,g)??null}return(0,n.Q4)(r,p,e,s,c,m),l[t]?.(r,d,g)??null}function c(t){return t&&m in t?JSON.parse(JSON.stringify(t,d)):t}const m="_geVersion",d=(t,e)=>t===m?void 0:e},23783:(t,e,s)=>{s.d(e,{Cv:()=>_,Nk:()=>d,lK:()=>y});var n=s(85569),i=s(40189),r=s(68490),o=s(27243),a=s(87926),l=s(96082);const h=[0,0];function u(t,e){if(!e)return null;if("x"in e){const s={x:0,y:0};return[s.x,s.y]=t(e.x,e.y,h),null!=e.z&&(s.z=e.z),null!=e.m&&(s.m=e.m),s}if("xmin"in e){const s={xmin:0,ymin:0,xmax:0,ymax:0};return[s.xmin,s.ymin]=t(e.xmin,e.ymin,h),[s.xmax,s.ymax]=t(e.xmax,e.ymax,h),e.hasZ&&(s.zmin=e.zmin,s.zmax=e.zmax,s.hasZ=!0),e.hasM&&(s.mmin=e.mmin,s.mmax=e.mmax,s.hasM=!0),s}return"rings"in e?{rings:c(e.rings,t),hasM:e.hasM,hasZ:e.hasZ}:"paths"in e?{paths:c(e.paths,t),hasM:e.hasM,hasZ:e.hasZ}:"points"in e?{points:m(e.points,t),hasM:e.hasM,hasZ:e.hasZ}:null}function c(t,e){const s=[];for(const n of t)s.push(m(n,e));return s}function m(t,e){const s=[];for(const n of t){const t=e(n[0],n[1],[0,0]);s.push(t),n.length>2&&t.push(n[2]),n.length>3&&t.push(n[3])}return s}async function d(t,e){if(!t||!e)return;const s=Array.isArray(t)?t.map((t=>null!=t.geometry?t.geometry.spatialReference:null)).filter(n.Ru):[t];await(0,r.initializeProjection)(s.map((t=>({source:t,dest:e}))))}const g=u.bind(null,l.je),p=u.bind(null,l.tD);function _(t,e,s,n){if(!t)return null;if(s||(s=e,e=t.spatialReference),!(0,a.fn)(e)||!(0,a.fn)(s)||(0,a.aI)(e,s))return t;if((0,l.y7)(e,s)){const e=(0,a.K8)(s)?g(t):p(t);return e.spatialReference=s,e}return(0,r.projectMany)(o.g,[t],e,s,null,n)[0]}const f=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,e,s,n){if(!t?.length||!e||!s||(0,a.aI)(e,s))return t;const r={geometries:t,inSpatialReference:e,outSpatialReference:s,geographicTransformation:n,resolve:(0,i.Tw)()};return this._jobs.push(r),this._timer??=setTimeout(this._process,10),r.resolve.promise}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:e,inSpatialReference:s,outSpatialReference:n,resolve:i,geographicTransformation:h}=t;(0,l.y7)(s,n)?(0,a.K8)(n)?i(e.map(g)):i(e.map(p)):i((0,r.projectMany)(o.g,e,s,n,h,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function y(t,e,s,n){return f.push(t,e,s,n)}},35746:(t,e,s)=>{s.d(e,{GC:()=>_,T2:()=>f,VY:()=>m,dO:()=>x,iJ:()=>p,v8:()=>d});var n=s(98849),i=s(59851),r=s(92976),o=s(68490),a=s(90557),l=s(1171),h=s(65231),u=s(87926),c=s(23783);const m=new i.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),d=Object.freeze({}),g="frequency";async function p(t,e,s){const n=t.bin;return n.onField&&(n.onField=n.onField.trim()),n.onExpression?.value&&(n.onExpression.value=n.onExpression.value.trim()),n.splitBy&&(n.splitBy.value&&(n.splitBy.value=n.splitBy.value.trim()),n.splitBy.outAlias&&(n.splitBy.outAlias=n.splitBy.outAlias.trim())),n.stackBy&&(n.stackBy.value&&(n.stackBy.value=n.stackBy.value.trim()),n.stackBy.outAlias&&(n.stackBy.outAlias=n.stackBy.outAlias.trim())),"normalizationField"in n.parameters&&n.parameters.normalizationField&&(n.parameters.normalizationField=n.parameters.normalizationField.trim()),t.outStatistics?.length||(t.outStatistics=[{statisticType:"count",onStatisticField:"1",outStatisticFieldName:g}]),_(t,e,s)}async function _(t,e,s){const{outFields:n,orderByFields:i,groupByFieldsForStatistics:r,outStatistics:o}=t;if(n)for(let a=0;a<n.length;a++)n[a]=n[a].trim();if(i)for(let a=0;a<i.length;a++)i[a]=i[a].trim();if(r)for(let a=0;a<r.length;a++)r[a]=r[a].trim();if(o)for(let a=0;a<o.length;a++)o[a].onStatisticField&&(o[a].onStatisticField=o[a].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),f(t,e,s)}async function f(t,e,i){if(!t)return null;let{where:o}=t;if(t.where=o=o?.trim(),(!o||/^1 *= *1$/.test(o)||e&&e===o)&&(t.where=null),!t.geometry)return t;let g=await async function(t){const{distance:e,units:i}=t,o=t.geometry;if(null==e||"vertexAttributes"in o)return o;const a=o.spatialReference,h=i?m.fromJSON(i):(0,r.Ij)(a),d=a&&((0,u.EA)(a)||(0,u.K8)(a))?o:await(0,c.Nk)(a,u.KK).then((()=>(0,c.Cv)(o,u.KK))),g=await Promise.all([s.e(2076),s.e(9219)]).then(s.bind(s,31600));await g.load();const p=g.execute(d,e||1,{unit:h})??void 0;if(!p||!(0,l.Bi)(p)||0===p.rings.length)throw new n.A("unsupported-query:invalid-parameters","Invalid parameters for query by distance");return p}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:e}=t.geometry;g=(0,a.HA)(g),g.spatialReference=e}if(g){await(0,c.Nk)(g.spatialReference,i),g=function(t,e){const s=t.spatialReference;return y(t,e)&&(0,l.ZC)(t)?{spatialReference:s,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t}(g,i);const e=(await(0,h.el)((0,l.rS)(g)))[0];if(null==e)throw d;const s="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,n=s&&y(g,i)?{densificationStep:8*s}:void 0,r=e.toJSON(),o=(0,c.Cv)(r,r.spatialReference,i,n);if(!o)throw d;o.spatialReference=i,t.geometry=o}return t}function y(t,e){if(!t)return!1;const s=t.spatialReference;return((0,l.ZC)(t)||(0,l.Bi)(t)||(0,l.Rg)(t))&&!(0,u.aI)(s,e)&&!(0,o.canProjectWithoutEngine)(s,e)}function x(t,e){return null==t?null:"string"==typeof t?e?new Date(`1970-01-01T${t}Z`).getTime():new Date(t).getTime():t instanceof Date?t.getTime():t}},70759:(t,e,s)=>{s.d(e,{tC:()=>b,c0:()=>v,xt:()=>x});var n=s(98849),i=s(1364),r=s(43525);var o=s(1171),a=s(87926);function l(t,e){return t?e?4:3:e?3:2}function h(t,e,s,n,i,r){const o=l(i,r),{coords:a,lengths:h}=n;if(!h)return!1;for(let l=0,c=0;l<h.length;l++,c+=o)if(!u(t,e,s,a[c],a[c+1]))return!1;return!0}function u(t,e,s,n,i){if(!t)return!1;const r=l(e,s),{coords:o,lengths:a}=t;let h=!1,u=0;for(const l of a)h=c(h,o,r,u,l,n,i),u+=l*r;return h}function c(t,e,s,n,i,r,o){let a=t,l=n;for(let h=n,u=n+i*s;h<u;h+=s){l=h+s,l===u&&(l=n);const t=e[h],i=e[h+1],c=e[l],m=e[l+1];(i<o&&m>=o||m<o&&i>=o)&&t+(o-i)/(m-i)*(c-t)<r&&(a=!a)}return a}var m=s(21355),d=s(88443),g=s(95694),p=s(23783);const _="unsupported-query",f={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};const y={esriSpatialRelIntersects:()=>Promise.all([s.e(2076),s.e(4619)]).then(s.bind(s,4619)),esriSpatialRelContains:()=>Promise.all([s.e(2076),s.e(720)]).then(s.bind(s,80720)),esriSpatialRelCrosses:()=>Promise.all([s.e(2076),s.e(2569)]).then(s.bind(s,22569)),esriSpatialRelDisjoint:()=>Promise.all([s.e(2076),s.e(8537)]).then(s.bind(s,8537)),esriSpatialRelEnvelopeIntersects:null,esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:()=>Promise.all([s.e(2076),s.e(561)]).then(s.bind(s,50561)),esriSpatialRelTouches:()=>Promise.all([s.e(2076),s.e(3294)]).then(s.bind(s,23294)),esriSpatialRelWithin:()=>Promise.all([s.e(2076),s.e(102)]).then(s.bind(s,80102)),esriSpatialRelRelation:null};async function x(t,e,s,n,a){if((0,o.Bi)(e)){if("esriGeometryPoint"===s&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t)){const t=(0,m.Ye)(new d.A,e,!1,!1);return e=>function(t,e,s,n){return u(t,e,s,n.coords[0],n.coords[1])}(t,!1,!1,e)}if("esriGeometryMultipoint"===s){const s=(0,m.Ye)(new d.A,e,!1,!1);if("esriSpatialRelContains"===t)return t=>h(s,!1,!1,t,n,a)}}if((0,o.ZC)(e)){if("esriGeometryPoint"===s&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t))return t=>(0,i.qz)(e,(0,g.pL)(s,n,a,t));if("esriGeometryMultipoint"===s&&"esriSpatialRelContains"===t)return t=>(0,i.rL)(e,(0,g.pL)(s,n,a,t));if("esriSpatialRelIntersects"===t){const t=function(t){return"mesh"===t?r.xB:(0,r.xK)(t)}(s);return i=>t(e,(0,g.pL)(s,n,a,i))}}"esriSpatialRelEnvelopeIntersects"===t&&(t="esriSpatialRelIntersects");const l=await function(t){const e=y[t];if(null==e)throw new Error(`Cannot load unsupported spatial operator: ${t}`);return e()}(t);return t=>l.execute(e,(0,g.pL)(s,n,a,t))}async function v(t,e,s){const{spatialRel:i,geometry:r}=t;if(r){if(!function(t){return null!=t&&!0===f.spatialRelationship[t]}(i))throw new n.A(_,"Unsupported query spatial relationship",{query:t});if((0,a.fn)(r.spatialReference)&&(0,a.fn)(s)){if(!function(t){return null!=t&&!0===f.queryGeometry[(0,o.$B)(t)]}(r))throw new n.A(_,"Unsupported query geometry type",{query:t});if(!function(t){return null!=t&&!0===f.layerGeometry[t]}(e))throw new n.A(_,"Unsupported layer geometry type",{query:t});if(t.outSR)return(0,p.Nk)(t.geometry?.spatialReference,t.outSR)}}}function b(t){if((0,o.ZC)(t))return!0;if((0,o.Bi)(t)){for(const e of t.rings){if(5!==e.length)return!1;if(e[0][0]!==e[1][0]||e[0][0]!==e[4][0]||e[2][0]!==e[3][0]||e[0][1]!==e[3][1]||e[0][1]!==e[4][1]||e[1][1]!==e[2][1])return!1}return!0}return!1}},71339:(t,e,s)=>{s.d(e,{I:()=>r,W:()=>i});var n=s(73345);async function i(t,e){if(!t)return null;const s=e.featureAdapter,{startTimeField:i,endTimeField:r}=t;let o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(i&&r)await e.forEach((t=>{const e=s.getAttribute((0,n.zI)(t),i),l=s.getAttribute((0,n.zI)(t),r);null==e||isNaN(e)||(o=Math.min(o,e)),null==l||isNaN(l)||(a=Math.max(a,l))}));else{const t=i||r;await e.forEach((e=>{const i=s.getAttribute((0,n.zI)(e),t);null==i||isNaN(i)||(o=Math.min(o,i),a=Math.max(a,i))}))}return{start:o,end:a}}function r(t,e,s){if(!e||!t)return null;const{startTimeField:n,endTimeField:i}=t;if(!n&&!i)return null;const{start:r,end:o}=e;if(null===r&&null===o)return null;if(void 0===r&&void 0===o)return()=>!1;const a=s.getAttributeAsTimestamp?.bind(s)??s.getAttribute.bind(s);return n&&i?function(t,e,s,n,i){return null!=n&&null!=i?r=>{const o=t(r,e),a=t(r,s);return(null==o||o<=i)&&(null==a||a>=n)}:null!=n?e=>{const i=t(e,s);return null==i||i>=n}:null!=i?s=>{const n=t(s,e);return null==n||n<=i}:void 0}(a,n,i,r,o):function(t,e,s,n){return null!=s&&null!=n&&s===n?n=>t(n,e)===s:null!=s&&null!=n?i=>{const r=t(i,e);return null!=r&&r>=s&&r<=n}:null!=s?n=>{const i=t(n,e);return null!=i&&i>=s}:null!=n?s=>{const i=t(s,e);return null!=i&&i<=n}:void 0}(a,n||i,r,o)}},9723:(t,e,s)=>{s.d(e,{CI:()=>r,fk:()=>o});s(39831);var n=s(92504),i=s(87926);function r(t,e){return t===e||null!=t&&null!=e&&(0,i.aI)(t.spatialReference,e.spatialReference)&&t.x===e.x&&t.y===e.y&&t.z===e.z&&t.m===e.m}function o(t,e,s){return t===e||null!=t&&null!=e&&(0,i.aI)(t.spatialReference,e.spatialReference)&&(0,n.Sp)(t.x,e.x,s)&&(0,n.Sp)(t.y,e.y,s)&&(0,n.Sp)(t.z??0,e.z??0,s)&&(0,n.Sp)(t.m??0,e.m??0,s)}},21355:(t,e,s)=>{s.d(e,{B2:()=>P,BW:()=>z,Ch:()=>at,DF:()=>w,Di:()=>j,E2:()=>X,IE:()=>b,Nl:()=>st,Q4:()=>lt,Rk:()=>ut,Ux:()=>W,Ye:()=>B,ZF:()=>Q,eU:()=>Y,eY:()=>tt,hK:()=>mt,jH:()=>et,jQ:()=>ot,kz:()=>nt,oN:()=>Z,q3:()=>J,qK:()=>G,qN:()=>L,z5:()=>q,zv:()=>$});var n=s(98849),i=s(539),r=s(6267),o=s(4675),a=s(80510),l=s(1171),h=s(32597),u=s(46461),c=s(88443),m=s(17324);function d(t,e){return t?e?4:3:e?3:2}const g=()=>i.A.getLogger("esri.layers.graphics.featureConversionUtils"),p={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},_=(t,e,s,n,i,r)=>{t[s]=i,t[s+1]=r},f=(t,e,s,n,i,r)=>{t[s]=i,t[s+1]=r,t[s+2]=e[n+2]},y=(t,e,s,n,i,r)=>{t[s]=i,t[s+1]=r,t[s+2]=e[n+3]},x=(t,e,s,n,i,r)=>{t[s]=i,t[s+1]=r,t[s+2]=e[n+2],t[s+3]=e[n+3]};function v(t,e,s,n){if(t){if(s)return e&&n?x:f;if(e&&n)return y}else if(e&&n)return f;return _}function b({scale:t,translate:e},s){return Math.round((s-e[0])/t[0])}function P({scale:t,translate:e},s){return Math.round((e[1]-s)/t[1])}function S({scale:t,translate:e},s){return Math.round((s-e[0])/t[0])}function E({scale:t,translate:e},s){return Math.round((s-e[1])/t[1])}function C({scale:t,translate:e},s,n){return s*t[n]+e[n]}function w(t,e,s){return t?e?s?F(t):A(t):s?D(t):I(t):null}function I(t){const e=t.coords;return{x:e[0],y:e[1]}}function T(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function A(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function M(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function D(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function N(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function F(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function R(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function k(t,e){return t&&e?R:t?M:e?N:T}function L(t,e,s=k(null!=e.z,null!=e.m)){return s(t,e)}function G(t,e,s){if(null==t)return null;const n=d(e,s),i=[];for(let r=0;r<t.coords.length;r+=n){const e=[];for(let s=0;s<n;s++)e.push(t.coords[r+s]);i.push(e)}return e?s?{points:i,hasZ:e,hasM:s}:{points:i,hasZ:e}:s?{points:i,hasM:s}:{points:i}}function V(t,e,s=d(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const n=t.coords;let i=0;for(const r of e.points)for(let t=0;t<s;t++)n[i++]=r[t];return t}function z(t,e,s){if(!t)return null;const n=d(e,s),{coords:i,lengths:r}=t,o=[];let a=0;for(const l of r){const t=[];for(let e=0;e<l;e++){const e=[];for(let t=0;t<n;t++)e.push(i[a++]);t.push(e)}o.push(t)}return e?s?{paths:o,hasZ:e,hasM:s}:{paths:o,hasZ:e}:s?{paths:o,hasM:s}:{paths:o}}function O(t,e,s=d(e.hasZ,e.hasM)){const{lengths:n,coords:i}=t;let r=0;for(const o of e.paths){for(const t of o)for(let e=0;e<s;e++)i[r++]=t[e];n.push(o.length)}return t}function q(t,e,s){if(!t)return null;const n=d(e,s),{coords:i,lengths:r}=t,o=[];let a=0;for(const l of r){const t=[];for(let e=0;e<l;e++){const e=[];for(let t=0;t<n;t++)e.push(i[a++]);t.push(e)}o.push(t)}return e?s?{rings:o,hasZ:e,hasM:s}:{rings:o,hasZ:e}:s?{rings:o,hasM:s}:{rings:o}}function B(t,e,s=e.hasZ,n=e.hasM){return Y(t,e.rings,s,n)}function Y(t,e,s,n){const i=d(s,n),{lengths:r,coords:o}=t;let a=0;dt(t);for(const l of e){for(const t of l)for(let e=0;e<i;e++)o[a++]=t[e];r.push(l.length)}return t}const U=[],H=[];function X(t,e,s,n,i){U[0]=t;const[r]=j(H,U,e,s,n,i);return gt(U),gt(H),r}function j(t,e,s,i,r,o){if(gt(t),!s){for(const s of e){const e=(0,m.W)(s,o);t.push(new h.Om(null,s.attributes,null,e))}return t}switch(s){case"esriGeometryPoint":return function(t,e,s,n,i){const r=k(s,n);for(const o of e){const e=null!=o.geometry?r(new c.A,o.geometry):null;t.push(new h.Om(e,o.attributes,null,(0,m.W)(o,i)))}return t}(t,e,i,r,o);case"esriGeometryMultipoint":return function(t,e,s,n,i){const r=d(s,n);for(const o of e){const e=null!=o.geometry?V(new c.A,o.geometry,r):null;t.push(new h.Om(e,o.attributes,null,(0,m.W)(o,i)))}return t}(t,e,i,r,o);case"esriGeometryPolyline":return function(t,e,s,n,i){const r=d(s,n);for(const o of e){const e=null!=o.geometry?O(new c.A,o.geometry,r):null,s=null!=o.centroid?L(new c.A,o.centroid):null;t.push(new h.Om(e,o.attributes,s,(0,m.W)(o,i)))}return t}(t,e,i,r,o);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(t,e,s,n,i){for(const r of e){const e=null!=r.geometry?B(new c.A,r.geometry,s,n):null,o=(0,m.W)(r,i);null!=r.centroid?t.push(new h.Om(e,r.attributes,T(new c.A,r.centroid),o)):t.push(new h.Om(e,r.attributes,null,o))}return t}(t,e,i,r,o);default:g().error("convertToFeatureSet:unknown-geometry",new n.A("internal:geometry",`Unable to parse unknown geometry type '${s}'`)),gt(t)}return t}function Z(t,e,s,n){H[0]=t,K(U,H,e,s,n);const i=U[0];return gt(U),gt(H),i}function W(t,e,s){if(null==t)return null;const i=new c.A;return"hasZ"in t&&null==e&&(e=t.hasZ),"hasM"in t&&null==s&&(s=t.hasM),(0,l.fT)(t)?k(null!=e?e:null!=t.z,null!=s?s:null!=t.m)(i,t):(0,l.Bi)(t)?B(i,t,e,s):(0,l.Rg)(t)?O(i,t,d(e,s)):(0,l.U9)(t)?V(i,t,d(e,s)):void g().error("convertFromGeometry:unknown-geometry",new n.A("internal:geometry",`Unable to parse unknown geometry type '${t}'`))}function $(t,e,s,i){const r=t&&("coords"in t?t:t.geometry);if(null==r)return null;switch(e){case"esriGeometryPoint":{let t=I;return s&&i?t=F:s?t=A:i&&(t=D),t(r)}case"esriGeometryMultipoint":return G(r,s,i);case"esriGeometryPolyline":return z(r,s,i);case"esriGeometryPolygon":return q(r,s,i);default:return g().error("convertToGeometry:unknown-geometry",new n.A("internal:geometry",`Unable to parse unknown geometry type '${e}'`)),null}}function K(t,e,s,i,r){if(gt(t),null==s)return function(t,e){for(const s of e)t.push({attributes:s.attributes});return t}(t,e);switch(s){case"esriGeometryPoint":return function(t,e,s,n){let i=I;s&&n?i=F:s?i=A:n&&(i=D);for(const r of e){const{geometry:e,attributes:s}=r,n=null!=e?i(e):null;t.push({attributes:s,geometry:n})}return t}(t,e,i,r);case"esriGeometryMultipoint":return function(t,e,s,n){for(const{geometry:i,attributes:r}of e)t.push({attributes:r,geometry:null!=i?G(i,s,n):null});return t}(t,e,i,r);case"esriGeometryPolyline":return function(t,e,s,n){for(const{geometry:i,attributes:r}of e)t.push({attributes:r,geometry:null!=i?z(i,s,n):null});return t}(t,e,i,r);case"esriGeometryPolygon":return function(t,e,s,n){for(const{geometry:i,attributes:r,centroid:o}of e){const e=null!=i?q(i,s,n):null;if(null!=o){const s=I(o);t.push({attributes:r,centroid:s,geometry:e})}else t.push({attributes:r,geometry:e})}return t}(t,e,i,r);default:g().error("convertToFeatureSet:unknown-geometry",new n.A("internal:geometry",`Unable to parse unknown geometry type '${s}'`))}return t}function Q(t){const{spatialReference:e,transform:s,fields:n,hasM:i,hasZ:r,features:o,geometryType:a,exceededTransferLimit:l,queryGeometry:h,queryGeometryType:u}=t,c={features:K([],o,a,r,i),fields:n,geometryType:a,spatialReference:e,queryGeometry:$(h,u,!1,!1)};return s&&(c.transform=s),l&&(c.exceededTransferLimit=l),i&&(c.hasM=i),r&&(c.hasZ=r),c}function J(t,e){const s=new u.A,{hasM:n,hasZ:i,features:r,spatialReference:o,geometryType:a,exceededTransferLimit:l,transform:h,fields:c}=t;return c&&(s.fields=c),s.geometryType=a??null,s.spatialReference=o??null,r&&j(s.features,r,a,i,n,e),l&&(s.exceededTransferLimit=l),n&&(s.hasM=n),i&&(s.hasZ=i),h&&(s.transform=h),s}function tt(t){const{transform:e,features:s,hasM:n,hasZ:i}=t;if(!e)return t;for(const r of s)null!=r.geometry&&at(r.geometry,r.geometry,n,i,e),null!=r.centroid&&at(r.centroid,r.centroid,n,i,e);return t.transform=null,t}function et(t,e){const{geometryType:s,features:n,hasM:i,hasZ:r}=e;if(!t)return e;for(let o=0;o<n.length;o++){const e=n[o],a=e.weakClone();a.geometry=new c.A,st(a.geometry,e.geometry,i,r,s,t),e.centroid&&(a.centroid=new c.A,st(a.centroid,e.centroid,i,r,"esriGeometryPoint",t)),n[o]=a}return e.transform=t,e}function st(t,e,s,n,i,r,o=s,a=n){if(dt(t),!e?.coords.length)return null;const l=p[i],{coords:h,lengths:u}=e,c=d(s,n),m=d(s&&o,n&&a),g=v(s,n,o,a);if(!u.length)return g(t.coords,h,0,0,b(r,h[0]),P(r,h[1])),dt(t,c,0),t;let _,f,y,x,S=0,E=0,C=E;for(const d of u){if(d<l)continue;let e=0;E=C,y=_=b(r,h[S]),x=f=P(r,h[S+1]),g(t.coords,h,E,S,y,x),e++,S+=c,E+=m;for(let s=1;s<d;s++,S+=c)y=b(r,h[S]),x=P(r,h[S+1]),y===_&&x===f||(g(t.coords,h,E,S,y-_,x-f),E+=m,e++,_=y,f=x);e>=l&&(t.lengths.push(e),C=E)}return gt(t.coords,C),t.coords.length?t:null}function nt(t,e,s,n,i,r,o=s,a=n){if(dt(t),!e?.coords.length)return null;const l=p[i],{coords:h,lengths:u}=e,c=d(s,n),m=d(s&&o,n&&a),g=v(s,n,o,a);if(!u.length)return g(t.coords,h,0,0,h[0],h[1]),dt(t,c,0),t;let _=0;const f=r*r;for(const d of u){if(d<l){_+=d*c;continue}const e=t.coords.length/m,s=_,n=_+(d-1)*c;g(t.coords,h,t.coords.length,s,h[s],h[s+1]),rt(t.coords,h,c,f,g,s,n),g(t.coords,h,t.coords.length,n,h[n],h[n+1]);const i=t.coords.length/m-e;i>=l?t.lengths.push(i):gt(t.coords,e*m),_+=d*c}return t.coords.length?t:null}function it(t,e,s,n){const i=t[e],r=t[e+1],o=t[s],a=t[s+1],l=t[n],h=t[n+1];let u=o,c=a,m=l-u,d=h-c;if(0!==m||0!==d){const t=((i-u)*m+(r-c)*d)/(m*m+d*d);t>1?(u=l,c=h):t>0&&(u+=m*t,c+=d*t)}return m=i-u,d=r-c,m*m+d*d}function rt(t,e,s,n,i,r,o){let a,l=n,h=0;for(let u=r+s;u<o;u+=s)a=it(e,u,r,o),a>l&&(h=u,l=a);l>n&&(h-r>s&&rt(t,e,s,n,i,r,h),i(t,e,t.length,h,e[h],e[h+1]),o-h>s&&rt(t,e,s,n,i,h,o))}function ot(t,e,s,n){if(!e?.coords?.length)return null;const i=d(s,n);let r=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(e&&e.coords){const t=e.coords;for(let e=0;e<t.length;e+=i){const s=t[e],n=t[e+1];r=Math.min(r,s),h=Math.max(h,s),l=Math.min(l,n),u=Math.max(u,n)}}return(0,o.is)(t)?(0,o.BI)(t,r,l,h,u):(0,a.fA)(r,l,h,u,t),t}function at(t,e,s,n,i){const{coords:o,lengths:a}=e,l=d(s,n);if(!o.length)return t!==e&&dt(t),t;(0,r.Lw)(i);const{originPosition:h,scale:u,translate:c}=i,m=pt;m.originPosition=h;const g=m.scale;g[0]=u[0]??1,g[1]=-(u[1]??1),g[2]=u[2]??1,g[3]=u[3]??1;const p=m.translate;if(p[0]=c[0]??0,p[1]=c[1]??0,p[2]=c[2]??0,p[3]=c[3]??0,!a.length){for(let e=0;e<l;++e)t.coords[e]=C(m,o[e],e);return t!==e&&dt(t,l,0),t}let _=0;for(let r=0;r<a.length;r++){const e=a[r];t.lengths[r]=e;for(let i=0;i<l;++i)t.coords[_+i]=C(m,o[_+i],i);let s=t.coords[_],n=t.coords[_+1];_+=l;for(let i=1;i<e;i++,_+=l){s+=o[_]*g[0],n+=o[_+1]*g[1],t.coords[_]=s,t.coords[_+1]=n;for(let e=2;e<l;++e)t.coords[_+e]=C(m,o[_+e],e)}}return t!==e&&dt(t,o.length,a.length),t}function lt(t,e,s,n,i,r){if(dt(t),t.lengths.push(...e.lengths),s===i&&n===r)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=d(s,n),a=v(s,n,i,r),l=e.coords;for(let e=0;e<l.length;e+=o)a(t.coords,l,t.coords.length,e,l[e],l[e+1])}return t}function ht(t,e,s,n){let i=0,r=t[n*e],o=t[n*(e+1)];for(let a=1;a<s;a++){const s=r+t[n*(e+a)],l=o+t[n*(e+a)+1],h=(s-r)*(l+o);r=s,o=l,i+=h}return.5*i}function ut(t,e){const{coords:s,lengths:n}=t;let i=0,r=0;for(let o=0;o<n.length;o++){const t=n[o];r+=ht(s,i,t,e),i+=t}return Math.abs(r)}function ct(t,e,s,n){return 0==t*n-s*e&&t*s+e*n>0}function mt(t,e,s,n,i){const r=d(n,i);if(!t.lengths.length){if(t.coords.length<2)return null;const[s,n]=t.coords,i=S(e,s),r=E(e,n);return new c.A([],[i,r])}const o=new c.A([],[0,0]),a=p[s],l="esriGeometryPolygon"===s||"esriGeometryPolyline"===s;let h=0,u=0;for(let c=0;c<t.lengths.length;c++){const s=t.lengths[c],n=u;let i=S(e,t.coords[r*h]),m=E(e,t.coords[r*h+1]);o.coords[u++]=i,o.coords[u++]=m;let d=0,g=0,p=1;for(let a=1;a<s;a++){const s=S(e,t.coords[r*(a+h)]),n=E(e,t.coords[r*(a+h)+1]);if(s!==i||n!==m){const t=s-i,e=n-m;l&&ct(d,g,t,e)?(o.coords[u-2]+=t,o.coords[u-1]+=e,i+=t,m+=e):(o.coords[u++]=s,o.coords[u++]=n,i=s,m=n,d=t,g=e,p+=1)}}p<a?u=n:o.lengths.push(p),h+=s}return 0===o.lengths.length?null:o}function dt(t,e=0,s=0){gt(t.lengths,s),gt(t.coords,e)}function gt(t,e=0){t.length!==e&&(t.length=e)}const pt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},50193:(t,e,s)=>{s.d(e,{p:()=>o});var n=s(66866),i=s(21564),r=(s(39831),s(539),s(9272),s(63863));const o=t=>{let e=class extends t{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):function(t){return"portalItem"in t}(this)?this.portalItem?.apiKey:null}set apiKey(t){null!=t?this._override("apiKey",t):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,n._)([(0,i.MZ)({type:String})],e.prototype,"apiKey",null),e=(0,n._)([(0,r.$)("esri.layers.mixins.APIKeyMixin")],e),e}},45681:(t,e,s)=>{s.d(e,{b:()=>l});var n=s(66866),i=s(539),r=s(21564),o=(s(39831),s(9272),s(63863)),a=s(16123);const l=t=>{let e=class extends t{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const t=(0,a.qg)(this.url);if(t?.title)return t.title}return this._get("title")||""}set title(t){this._set("title",t)}set url(t){this._set("url",(0,a.Jf)(t,i.A.getLogger(this)))}};return(0,n._)([(0,r.MZ)()],e.prototype,"title",null),(0,n._)([(0,r.MZ)({type:String})],e.prototype,"url",null),e=(0,n._)([(0,o.$)("esri.layers.mixins.ArcGISService")],e),e}},15305:(t,e,s)=>{s.d(e,{LF:()=>u,dM:()=>c,sU:()=>l});var n=s(66866),i=s(21564),r=(s(39831),s(539),s(9272),s(63863)),o=s(73324),a=s(27664);const l={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:{layerContainerTypes:o.K}},"portal-item":{read:!0,write:{layerContainerTypes:o.K}}}}},h={read:{reader:a.LF},write:{allowNull:!0,writer:a.M9,layerContainerTypes:o.K}},u={json:{read:!1,write:!1,origins:{"web-map":h,"portal-item":h}}},c=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return(0,n._)([(0,i.MZ)(l)],e.prototype,"blendMode",void 0),(0,n._)([(0,i.MZ)(u)],e.prototype,"effect",void 0),e=(0,n._)([(0,r.$)("esri.layers.mixins.BlendLayer")],e),e}},16161:(t,e,s)=>{s.d(e,{d:()=>o});var n=s(66866),i=s(21564),r=(s(39831),s(539),s(9272),s(63863));const o=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return(0,n._)([(0,i.MZ)({type:Object,json:{write:{overridePolicy:t=>({enabled:!!(t&&Object.keys(t).length>0)})}}})],e.prototype,"customParameters",void 0),e=(0,n._)([(0,r.$)("esri.layers.mixins.CustomParametersMixin")],e),e}},54576:(t,e,s)=>{s.d(e,{FJ:()=>y,Dp:()=>x,KV:()=>v});var n=s(66866),i=s(76724),r=s(21564),o=(s(39831),s(539),s(9272),s(63863)),a=s(73324),l=s(24793),h=s(48982),u=s(21877),c=s(77542),m=s(61781),d=s(33880);const g={write:{overridePolicy:(t,e,s)=>({enabled:!s||"scale"===s.filterMode})}};let p=class extends(l.A.ClonableMixin(u.A)){constructor(t){super(t),this.id=(0,d.lk)(),this.maxScale=0,this.minScale=0,this.title="",this.where=null}};(0,n._)([(0,r.MZ)({type:String,json:{write:!0}})],p.prototype,"id",void 0),(0,n._)([(0,r.MZ)({type:Number,json:g})],p.prototype,"maxScale",void 0),(0,n._)([(0,r.MZ)({type:Number,json:g})],p.prototype,"minScale",void 0),(0,n._)([(0,r.MZ)({type:String,json:{write:!0}})],p.prototype,"title",void 0),(0,n._)([(0,r.MZ)({type:String,json:{write:!0}})],p.prototype,"where",void 0),p=(0,n._)([(0,o.$)("esri.layers.support.DisplayFilter")],p);var _=s(6117);let f=class extends(l.A.ClonableMixin(u.A)){constructor(t){super(t),this.activeFilterId=null,this.filters=new(h.A.ofType(p)),this.mode="manual"}writeFilters(t,e,s,n){const i=t.toArray();"scale"===this.mode&&i.sort(((t,e)=>{const s=(0,m.oW)(e.minScale,t.minScale),n=t.maxScale-e.maxScale;return 0===s?n:s})),e[s]=i.map((t=>t.toJSON(n)))}write(t,e){return super.write(t,(0,_.mW)(this,e))}};(0,n._)([(0,r.MZ)({type:String,json:{write:{overridePolicy:(t,e,s)=>({enabled:"manual"===s.filterMode,isRequired:!0})}}})],f.prototype,"activeFilterId",void 0),(0,n._)([(0,r.MZ)({type:h.A.ofType(p),nonNullable:!0,json:{write:!0}})],f.prototype,"filters",void 0),(0,n._)([(0,c.K)("filters")],f.prototype,"writeFilters",null),(0,n._)([(0,r.MZ)({type:["manual","scale"],nonNullable:!0,json:{name:"filterMode",write:!0}})],f.prototype,"mode",void 0),f=(0,n._)([(0,o.$)("esri.layers.support.DisplayFilterInfo")],f);const y=t=>{let e=class extends t{constructor(){super(...arguments),this.displayFilterEnabled=!0,this.displayFilterInfo=null}};return(0,n._)([(0,r.MZ)(x)],e.prototype,"displayFilterEnabled",void 0),(0,n._)([(0,r.MZ)(v)],e.prototype,"displayFilterInfo",void 0),e=(0,n._)([(0,o.$)("esri.layers.mixins.DisplayFilteredLayer")],e),e},x={type:Boolean,json:{name:"layerDefinition.disableDisplayFilter",read:{reader:t=>!t},write:{layerContainerTypes:a.K,writer(t,e,s){(0,i.sM)(s,!t,e)}},origins:{"web-scene":{write:!1,read:!1}}}},v={type:f,json:{name:"layerDefinition.displayFilterInfo",write:{enabled:!0,allowNull:!0,layerContainerTypes:a.K},origins:{"web-scene":{write:!1,read:!1}}}}},15053:(t,e,s)=>{s.d(e,{F:()=>l,Y:()=>a});var n=s(66866),i=s(21564),r=(s(39831),s(539),s(9272),s(63863));const o={write:{allowNull:!0}},a={type:s(76137).A,json:{origins:{"web-map":o,"portal-item":o}}},l=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return(0,n._)([(0,i.MZ)(a)],e.prototype,"featureEffect",void 0),e=(0,n._)([(0,r.$)("esri.layers.mixins.FeatureEffectLayer")],e),e}},94783:(t,e,s)=>{s.d(e,{J:()=>C});var n=s(66866),i=s(85251),r=s(21564),o=s(39831),a=s(539),l=(s(9272),s(63863)),h=s(94301),u=s(92568),c=s(47347),m=s(63926),d=s(68745),g=s(98849),p=s(69075),_=s(54746),f=s(18443),y=s(23369);o.A.add("esri-cluster-arcade-enabled",!0);const x=(0,o.A)("esri-cluster-arcade-enabled"),v=new Set(["simple-line","simple-fill","picture-fill"]);function b(t,e){let s=e.clone();if(!P(s))return s;if(e.symbols.some((t=>v.has(t.type)))&&(s=new c.A({symbol:new y.A})),s.authoringInfo||(s.authoringInfo=new f.A),s.authoringInfo.isAutoGenerated=!0,"visualVariables"in s){const e=(s.visualVariables||[]).filter((t=>"$view.scale"!==t.valueExpression));e.forEach((e=>{"rotation"===e.type?e.field?e.field=E(t,e.field,"avg_angle","number"):e.valueExpression&&(e.field=S(t,e.valueExpression,"avg_angle","number"),e.valueExpression=null):e.normalizationField?(e.field=E(t,e.field,"avg_norm","number",e.normalizationField),e.normalizationField=null):e.field?e.field=E(t,e.field,"avg","number"):e.valueExpression&&(e.field=S(t,e.valueExpression,"avg","number"),e.valueExpression=null)})),s.visualVariables=e}switch(s.type){case"simple":break;case"pie-chart":for(const e of s.attributes)e.field?e.field=E(t,e.field,"sum","number"):e.valueExpression&&(e.field=S(t,e.valueExpression,"sum","number"),e.valueExpression=null);break;case"unique-value":s.field?s.field=E(t,s.field,"mode","string"):s.valueExpression&&(s.field=S(t,s.valueExpression,"mode","string"),s.valueExpression=null);break;case"class-breaks":s.normalizationField?(s.field=E(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=E(t,s.field,"avg","number"):s.valueExpression&&(s.field=S(t,s.valueExpression,"avg","number"),s.valueExpression=null)}return s}const P=t=>{const e=e=>a.A.getLogger("esri.views.2d.layers.support.clusterUtils").error(new g.A("Unsupported-renderer",e,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const s=t.normalizationType;if("field"!==s)return e(`FeatureReductionCluster does not support a normalizationType of ${s}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!x){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some((t=>!(!("valueExpression"in t)||!t.valueExpression))))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function S(t,e,s,n){const i=(0,p.d)(e),r="mode"===s?`cluster_type_${i}`:"sum"===s?`cluster_sum_${i}`:`cluster_avg_${i}`;return t.some((t=>t.name===r))||t.push(new h.A({name:r,isAutoGenerated:!0,onStatisticExpression:new _.A({expression:e,returnType:n}),statisticType:s})),r}function E(t,e,s,n,i){if("cluster_count"===e||t.some((t=>t.name===e)))return e;const r=function(t,e,s){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const t=s,n="field",i=e.toLowerCase()+",norm:"+n+","+t.toLowerCase();return"cluster_avg_"+(0,p.d)(i)}}}(s,e,i);return t.some((t=>t.name===r))||("avg_norm"===s?t.push(new h.A({name:r,isAutoGenerated:!0,onStatisticExpression:new _.A({expression:`$feature.${e} / $feature.${i}`,returnType:n}),statisticType:"avg"})):t.push(new h.A({name:r,isAutoGenerated:!0,onStatisticField:e,statisticType:s}))),r}const C=t=>{let e=class extends t{constructor(...t){super(...t),this.addHandles((0,i.wB)((()=>this.renderer),(()=>{if(this.featureReduction){const t=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",t)}}),i.OH))}set featureReduction(t){const e=this._normalizeFeatureReduction(t);this._set("featureReduction",e)}set renderer(t){}_withClusterVariable(t,e,s){const n=t.clone();return"visualVariables"in n&&(n.visualVariables||(n.visualVariables=[]),n.visualVariables.some((t=>"size"===t.type))||n.visualVariables.push(new m.A({field:"cluster_count",stops:[new d.A({value:1}),new d.A({useMinValue:!0,size:e}),new d.A({useMaxValue:!0,size:s})]}))),n}_normalizeFeatureReduction(t){if("cluster"!==t?.type)return t;const e=t.clone(),s=[new h.A({name:"cluster_count",alias:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(e.fields??[]).filter((t=>!t.isAutoGenerated)),i=t.renderer&&!t.renderer.authoringInfo?.isAutoGenerated,{clusterMinSize:r,clusterMaxSize:o}=e;if(i){e.fields=[...s,...n];const t=this._withClusterVariable(e.renderer,r,o);return e.effectiveFeatureRenderer=t,e.effectiveClusterRenderer=t,e}if(t.symbol){if(e.fields=[...s,...n],e.renderer=null,!this.renderer)return e.effectiveFeatureRenderer=null,e.effectiveClusterRenderer=null,e;const i=b(s,this.renderer),a=this._withClusterVariable(i,r,o),l="visualVariables"in a&&a.visualVariables?a.visualVariables:[],h=new c.A({symbol:t.symbol,visualVariables:l});return e.fields=[...s,...n],e.effectiveFeatureRenderer=a,e.effectiveClusterRenderer=h,e}if(!this.renderer)return t;const a=b(s,this.renderer);e.fields=[...s,...n],e.renderer=a;const l=this._withClusterVariable(a,r,o);return e.effectiveFeatureRenderer=l,e.effectiveClusterRenderer=l,e}};return(0,n._)([(0,r.MZ)(u.d)],e.prototype,"featureReduction",null),e=(0,n._)([(0,l.$)("esri.layers.mixins.FeatureReductionLayer")],e),e}},41506:(t,e,s)=>{s.d(e,{q:()=>v});var n=s(66866),i=s(98849),r=s(20909),o=s(21564),a=s(73446),l=(s(39831),s(9272),s(75094)),h=s(63863),u=s(77542),c=s(73324),m=s(83312),d=s(77373);const g={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,ArcGISVideoLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},p={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},_={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},f={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,Object3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,ViewshedLayer:!0,Voxel:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":g,"web-map/basemap":p,"web-map/tables":_,"link-chart/operational-layers":{...g,LinkChartLayer:!0},"link-chart/basemap":p,"link-chart/tables":_,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0,WCS:!0},"portal-item/tables":{ArcGISFeatureLayer:!0,SubtypeGroupTable:!0}};var y=s(76592),x=s(17197);const v=t=>{let e=class extends t{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(t,e,s){return"Group Layer"===s?.portalItem?.type?void 0:t}writeListMode(t,e,s,n){(n&&"ground"===n.layerContainerType||t&&(0,d.R)(this,s,{},n))&&(e[s]=t)}writeOperationalLayerType(t,e,s){t&&(e[s]=t)}writeTitle(t,e){e.title=t??"Layer"}readVisibilityTimeExtent(t){return t?x.T.fromArray(t):null}writeVisibilityTimeExtent(t,e,s,n){t&&"tables"!==n.layerContainerType&&(t.isEmpty?n?.messages&&n.messages.push(new i.A("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):e[s]=t.toArray())}read(t,e){e&&(e.layer=this),(0,m.t)(this,t,(e=>super.read(t,e)),e)}write(t,e){if(!this.persistenceEnabled&&!e?.ignorePersistenceEnabled)return null;if(e?.origin){const t=`${e.origin}/${e.layerContainerType||"operational-layers"}`,s=f[t];let n=!!s?.[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===t&&(n=!1),"ArcGISDimensionLayer"===this.operationalLayerType&&"web-map/operational-layers"===t&&(n=!1),!n)return e.messages?.push(new i.A("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${t}'`,{layer:this})),null}const s=super.write(t,{...e,layer:this}),n=!!e&&!!e.messages&&!!e.messages.filter((t=>t instanceof i.A&&"web-document-write:property-required"===t.name)).length;return(0,r.w8)(s?.url)?(e?.messages?.push(new i.A("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return(0,n._)([(0,o.MZ)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),(0,n._)([(0,l.w)("id",["id"])],e.prototype,"readId",null),(0,n._)([(0,o.MZ)(y.C1)],e.prototype,"listMode",void 0),(0,n._)([(0,u.K)("listMode")],e.prototype,"writeListMode",null),(0,n._)([(0,o.MZ)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:c.K,isRequired:!0}}}}})],e.prototype,"operationalLayerType",void 0),(0,n._)([(0,u.K)("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),(0,n._)([(0,o.MZ)(y.ke)],e.prototype,"opacity",void 0),(0,n._)([(0,o.MZ)({type:Boolean,readOnly:!1})],e.prototype,"persistenceEnabled",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),(0,n._)([(0,u.K)("title"),(0,u.K)(["web-scene"],"title")],e.prototype,"writeTitle",null),(0,n._)([(0,o.MZ)({type:x.T,json:{origins:{"web-scene":{write:{layerContainerTypes:c.K}}}}})],e.prototype,"visibilityTimeExtent",void 0),(0,n._)([(0,l.w)("visibilityTimeExtent")],e.prototype,"readVisibilityTimeExtent",null),(0,n._)([(0,u.K)(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[a.jz,a.Uv]]}})],e.prototype,"writeVisibilityTimeExtent",null),(0,n._)([(0,o.MZ)({type:Boolean,json:{name:"visibility",write:{layerContainerTypes:c.K}}})],e.prototype,"visible",void 0),e=(0,n._)([(0,h.$)("esri.layers.mixins.OperationalLayer")],e),e}},30111:(t,e,s)=>{s.d(e,{Rr:()=>l,fY:()=>u,ne:()=>h});var n=s(66866),i=s(76724),r=s(21564),o=(s(39831),s(539),s(9272),s(63863)),a=s(3243);function l(t,e,s){if(!t)return null;const n=t.find((t=>!!t.field));if(!n)return null;const i=new a.A;return i.read(n,s),[i]}const h={type:[a.A],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:l},write:{writer:function(t,e,s,n){const r=t.find((t=>!!t.field));r&&(0,i.sM)(s,[r.toJSON()],e)}}}},u=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return(0,n._)([(0,r.MZ)(h)],e.prototype,"orderBy",void 0),e=(0,n._)([(0,o.$)("esri.layers.mixins.OrderedLayer")],e),e}},34722:(t,e,s)=>{s.d(e,{A:()=>P});var n=s(66866),i=s(21121),r=s(28830),o=s(86394),a=s(12690),l=s(98849),h=s(539),u=s(6267),c=s(40189),m=s(20909),d=s(21564),g=(s(39831),s(9272),s(75094)),p=s(63863),_=s(77542),f=s(40454),y=s(10282),x=s(26099),v=s(68770),b=s(39532);const P=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,u.pR)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(t){t!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",t))}readPortalItem(t,e,s){if(e.itemId)return new x.default({id:e.itemId,portal:s?.portal})}writePortalItem(t,e){t?.id&&(e.itemId=t.id)}async loadFromPortal(t,e){if(this.portalItem?.id)try{const{load:n}=await Promise.all([s.e(2076),s.e(4085)]).then(s.bind(s,14085));return(0,c.Te)(e),await n({instance:this,supportedTypes:t.supportedTypes,validateItem:t.validateItem,supportsData:t.supportsData,layerModuleTypeMap:t.layerModuleTypeMap,populateGroupLayer:t.populateGroupLayer},e)}catch(n){throw(0,c.zf)(n)||h.A.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${n}`),n}}async finishLoadEditablePortalLayer(t){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(t).catch((t=>((0,c.QP)(t),!0))))}async setUserPrivileges(t,e){if(!i.A.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(e);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:i}}=await this._fetchUserPrivileges(t,e);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",i)}catch(s){(0,c.QP)(s)}}async _fetchUserPrivileges(t,e){let s=this.portalItem;if(!t||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(e);const n=!r.id?.findCredential(this.url),i=t===s.id;if(i&&s.portal.user)return this._getUserPrivileges(s,n);let o,a;if(i)o=s.portal.url;else try{o=await(0,f.wI)(this.url,e)}catch(d){(0,c.QP)(d)}if(!o||!(0,m.b8)(o,s.portal.url))return this._fetchFallbackUserPrivileges(e);try{const t=null!=e?e.signal:null;a=await(r.id?.getCredential(`${o}/sharing`,{prompt:!1,signal:t}))}catch(d){(0,c.QP)(d)}const l=!0,h=!1,u=!1;if(!a)return{features:{edit:l,fullEdit:h},content:{updateItem:u}};try{if(i?await s.reload():(s=new x.default({id:t,portal:{url:o}}),await s.load(e)),s.portal.user)return this._getUserPrivileges(s,n)}catch(d){(0,c.QP)(d)}return{features:{edit:l,fullEdit:h},content:{updateItem:u}}}_getUserPrivileges(t,e){const s=(0,b.It)(t);return e&&(s.features.edit=!0),s}async _fetchFallbackUserPrivileges(t){let e=!0;try{e=await this._fetchUserHasEditingPrivileges(t)}catch(s){(0,c.QP)(s)}return{features:{edit:e,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(t){const e=this.url?r.id?.findCredential(this.url):null;if(!e)return!0;const s=S.credential===e?S.user:await this._fetchEditingUser(t);return S.credential=e,S.user=s,null==s?.privileges||s.privileges.includes("features:user:edit")}async _fetchEditingUser(t){const e=this.portalItem?.portal?.user;if(e)return e;const s=r.id?.findServerInfo(this.url??"");if(!s?.owningSystemUrl)return null;const n=`${s.owningSystemUrl}/sharing/rest`,i=y.A.getDefault();if(i&&i.loaded&&(0,m.S8)(i.restUrl)===(0,m.S8)(n))return i.user;const l=`${n}/community/self`,h=null!=t?t.signal:null,u=await(0,a.Ke)((0,o.A)(l,{authMode:"no-prompt",query:{f:"json"},signal:h}));return u.ok?v.A.fromJSON(u.value.data):null}read(t,e){e&&(e.layer=this),super.read(t,e)}write(t,e){const s=e?.portal,n=this.portalItem?.id&&(this.portalItem.portal||y.A.getDefault());return s&&n&&!(0,m.ut)(n.restUrl,s.restUrl)?(e.messages&&e.messages.push(new l.A("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(t,{...e,layer:this})}};return(0,n._)([(0,d.MZ)({type:x.default})],e.prototype,"portalItem",null),(0,n._)([(0,g.w)("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),(0,n._)([(0,_.K)("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),(0,n._)([(0,d.MZ)({clonable:!1})],e.prototype,"resourceReferences",void 0),(0,n._)([(0,d.MZ)({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),(0,n._)([(0,d.MZ)({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),(0,n._)([(0,d.MZ)({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=(0,n._)([(0,p.$)("esri.layers.mixins.PortalLayer")],e),e},S={credential:null,user:null}},50508:(t,e,s)=>{s.d(e,{J:()=>v});var n=s(66866),i=(s(39831),s(539)),r=s(40189),o=s(21564),a=s(4130),l=(s(9272),s(63863)),h=s(73324),u=s(48982),c=s(85251),m=s(97996);const d=new u.A,g=new WeakMap;function p(t){return null!=t&&"object"==typeof t&&"refreshInterval"in t&&"refresh"in t}function _(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:_(e,t%e):0}let f=0,y=0;function x(){const t=Date.now();let e=!1;for(const s of d){const n=s.deref();n?n.refreshInterval&&t-(g.get(n)??0)+5>=6e4*n.refreshInterval&&(g.set(n,t),n.refresh(t)):e=!0}if(e)for(let s=d.length-1;s>=0;s--)d.at(s).deref()||d.removeAt(s)}(0,m.fm)((()=>{const t=Date.now();let e=0;for(const s of d){const n=s.deref();n&&(e=_(Math.round(6e4*n.refreshInterval),e),n.refreshInterval?g.get(n)||g.set(n,t):g.delete(n))}if(e!==y){if(y=e,clearInterval(f),0===y)return void(f=0);f=setInterval(x,y)}}),c.OH);const v=t=>{let e=class extends t{constructor(...t){super(...t),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,r.sg)((()=>this.hasDataChanged())),this.when().then((()=>{this.destroyed||function(t){p(t)&&d.push(new WeakRef(t))}(this)}),(()=>{}))}destroy(){!function(t){const e=d.find((e=>e.deref()===t));e&&d.remove(e)}(this)}castRefreshInterval(t){return t>=.1?t:t<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(t=Date.now()){(0,r.QZ)(this._debounceHasDataChanged()).then((e=>{e&&this._set("refreshTimestamp",t),this.emit("refresh",{dataChanged:e})}),(t=>{i.A.getLogger(this).error(t),this.emit("refresh",{dataChanged:!1,error:t})}))}async hasDataChanged(){return!0}get test(){}};return(0,n._)([(0,o.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:h.K}}}}})],e.prototype,"refreshInterval",void 0),(0,n._)([(0,a.w)("refreshInterval")],e.prototype,"castRefreshInterval",null),(0,n._)([(0,o.MZ)({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),(0,n._)([(0,o.MZ)({readOnly:!0})],e.prototype,"refreshParameters",null),e=(0,n._)([(0,l.$)("esri.layers.mixins.RefreshableLayer")],e),e}},25389:(t,e,s)=>{s.d(e,{j:()=>o});var n=s(66866),i=s(21564),r=(s(39831),s(539),s(9272),s(63863));const o=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const t={minScale:this.minScale,maxScale:this.maxScale},e=this.parent;e&&"effectiveScaleRange"in e&&function(t,e){t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale}(t,e.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===t.minScale&&s.maxScale===t.maxScale?s:t}};return(0,n._)([(0,i.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),(0,n._)([(0,i.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),(0,n._)([(0,i.MZ)({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=(0,n._)([(0,r.$)("esri.layers.mixins.ScaleRangeLayer")],e),e}},90826:(t,e,s)=>{s.d(e,{B:()=>d,e:()=>g});var n=s(66866),i=s(21564),r=(s(39831),s(539),s(9272),s(75094)),o=s(63863),a=s(73324),l=s(42453),h=s(83849),u=s(55134),c=s(17197),m=s(16984);const d={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:a.K}}},g=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(t,e){const s=e.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,i=u.j.fromJSON(s.timeOffsetUnits);return n&&i?new m.T({value:n,unit:i}):null}set timeInfo(t){(0,l.sv)(t,this.fieldsIndex),this._set("timeInfo",t)}};return(0,n._)([(0,i.MZ)({type:c.T,json:{write:!1}})],e.prototype,"timeExtent",void 0),(0,n._)([(0,i.MZ)({type:m.T})],e.prototype,"timeOffset",void 0),(0,n._)([(0,r.w)("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),(0,n._)([(0,i.MZ)({value:null,type:h.A,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),(0,n._)([(0,i.MZ)(d)],e.prototype,"useViewTime",void 0),e=(0,n._)([(0,o.$)("esri.layers.mixins.TemporalLayer")],e),e}},94301:(t,e,s)=>{s.d(e,{A:()=>u});var n,i=s(66866),r=s(21877),o=s(19251),a=s(21564),l=(s(39831),s(539),s(63863)),h=s(54746);let u=class extends r.A{static{n=this}constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new n({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:(0,o.o8)(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],u.prototype,"isAutoGenerated",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"name",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"alias",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"onStatisticField",void 0),(0,i._)([(0,a.MZ)({type:h.A,json:{write:!0}})],u.prototype,"onStatisticExpression",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"statisticType",void 0),u=n=(0,i._)([(0,l.$)("esri.layers.support.AggregateField")],u)},54746:(t,e,s)=>{s.d(e,{A:()=>l});var n=s(66866),i=s(24793),r=s(21877),o=s(21564),a=(s(39831),s(539),s(9272),s(63863));let l=class extends(i.A.ClonableMixin(r.A)){constructor(t){super(t),this.expression=null,this.title=null,this.returnType=null}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"expression",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"title",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"returnType",void 0),l=(0,n._)([(0,a.$)("esri.layers.support.ExpressionInfo")],l)},76137:(t,e,s)=>{s.d(e,{A:()=>p});var n,i=s(66866),r=s(98849),o=s(21877),a=s(76724),l=s(21564),h=(s(39831),s(539),s(9272),s(63863)),u=s(27664),c=s(25758);const m={read:{reader:u.LF},write:{writer:u.M9,overridePolicy(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},d={read:{reader:u.LF},write:{writer:u.M9,overridePolicy(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},g={name:"showExcludedLabels",default:!0};let p=n=class extends o.A{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){const s=super.write(t,e);if(e?.origin){if(s.filter){const t=Object.keys(s.filter);if(t.length>1||"where"!==t[0])return e.messages?.push(new r.A("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in s)return e.messages?.push(new r.A("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return s}clone(){return new n({filter:null!=this.filter?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,i._)([(0,l.MZ)({type:c.A,json:{write:{allowNull:!0,writer(t,e,s,n){const i=t?.write({},n);i&&0!==Object.keys(i).length?(0,a.sM)(s,i,e):(0,a.sM)(s,null,e)}}}})],p.prototype,"filter",void 0),(0,i._)([(0,l.MZ)({json:{read:u.LF,write:{writer:u.M9,allowNull:!0},origins:{"web-map":m,"portal-item":m}}})],p.prototype,"includedEffect",void 0),(0,i._)([(0,l.MZ)({json:{read:u.LF,write:{writer:u.M9,allowNull:!0},origins:{"web-map":d,"portal-item":d}}})],p.prototype,"excludedEffect",void 0),(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":g,"portal-item":g}}})],p.prototype,"excludedLabelsVisible",void 0),p=n=(0,i._)([(0,h.$)("esri.layers.support.FeatureEffect")],p)},25758:(t,e,s)=>{s.d(e,{A:()=>_});var n,i=s(66866),r=s(59851),o=s(21877),a=s(19251),l=s(21564),h=(s(39831),s(539),s(63863)),u=s(12433),c=s(14474),m=s(17197);const d=new r.J({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),g=new r.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let p=n=class extends o.A{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:s,spatialRelationship:n,timeExtent:i,objectIds:r,units:o,distance:l}=this;return new c.A({geometry:(0,a.o8)(s),objectIds:(0,a.o8)(r),spatialRelationship:n,timeExtent:(0,a.o8)(i),where:e,units:o,distance:l,...t})}clone(){const{where:t,geometry:e,spatialRelationship:s,timeExtent:i,objectIds:r,units:o,distance:l}=this;return new n({geometry:(0,a.o8)(e),objectIds:(0,a.o8)(r),spatialRelationship:s,timeExtent:(0,a.o8)(i),where:t,units:o,distance:l})}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],p.prototype,"where",void 0),(0,i._)([(0,l.MZ)({types:u.yR,json:{write:!0}})],p.prototype,"geometry",void 0),(0,i._)([(0,l.MZ)({type:d.apiValues,json:{name:"spatialRel",read:{reader:d.read},write:{allowNull:!1,writer:d.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],p.prototype,"spatialRelationship",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:{overridePolicy(t){return{enabled:null!=t&&null!=this.geometry}}}}})],p.prototype,"distance",void 0),(0,i._)([(0,l.MZ)({type:[Number],json:{write:!0}})],p.prototype,"objectIds",void 0),(0,i._)([(0,l.MZ)({type:g.apiValues,json:{read:g.read,write:{writer:g.write,overridePolicy(t){return{enabled:null!=t&&null!=this.geometry}}}}})],p.prototype,"units",void 0),(0,i._)([(0,l.MZ)({type:m.T,json:{write:!0}})],p.prototype,"timeExtent",void 0),p=n=(0,i._)([(0,h.$)("esri.layers.support.FeatureFilter")],p);const _=p},18475:(t,e,s)=>{s.d(e,{c:()=>a});var n=s(66866),i=s(21877),r=s(21564),o=(s(39831),s(539),s(9272),s(63863));let a=class extends i.A{constructor(){super(...arguments),this.type=null}};(0,n._)([(0,r.MZ)({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,n._)([(0,o.$)("esri.layers.support.FeatureReduction")],a)},99989:(t,e,s)=>{s.d(e,{A:()=>l});var n,i=s(66866),r=s(21564),o=(s(39831),s(539),s(9272),s(63863)),a=s(18475);let l=n=class extends a.c{constructor(t){super(t),this.type="selection"}clone(){return new n}};(0,i._)([(0,r.MZ)({type:["selection"]})],l.prototype,"type",void 0),l=n=(0,i._)([(0,o.$)("esri.layers.support.FeatureReductionSelection")],l)},79005:(t,e,s)=>{s.d(e,{A:()=>d});var n=s(98849),i=s(539),r=s(82256),o=s(90709),a=s(59372),l=s(42453),h=s(54088),u=s(12129),c=s(34495);const m=new Map;class d{static fromJSON(t){return new d(t.fields,t.timeZoneByFieldName)}static fromLayer(t){return new d(t.fields??[],f(t))}static fromLayerJSON(t){return new d(t.fields??[],f(t))}constructor(t=[],e){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=t||[],this._timeZoneByFieldName=e?new Map(e):null;const s=[];for(const n of this.fields){const t=n?.name,e=p(t);if(t&&e){const i=g(t);this._fieldsMap.set(t,n),this._fieldsMap.set(i,n),this._normalizedFieldsMap.set(e,n),s.push(`${i}:${n.type}:${this._timeZoneByFieldName?.get(t)}`),(0,l.vE)(n)?(this.dateFields.push(n),this._dateFieldsSet.add(n)):(0,l.WA)(n)&&(this._numericFieldsSet.add(n),this.numericFields.push(n)),(0,l.te)(n)||(0,l.Xz)(n)||(n.editable=null==n.editable||!!n.editable,n.nullable=null==n.nullable||!!n.nullable)}}s.sort(),this.uid=s.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)(0,l.te)(t)||(0,l.Xz)(t)||t.nullable||void 0!==(0,l.lD)(t)||this._requiredFields.push(t)}return this._requiredFields}equals(t){return this.uid===t?.uid}has(t){return null!=this.get(t)}get(t){if(!t)return;let e=this._fieldsMap.get(t);return e||(e=this._fieldsMap.get(g(t))??this._normalizedFieldsMap.get(p(t)),e&&this._fieldsMap.set(t,e),e)}getTimeZone(t){const e=this.get(t&&"string"!=typeof t?t.name:t);return e?this._timeZoneByFieldName?this._timeZoneByFieldName.get(e.name):"date"===e.type||"esriFieldTypeDate"===e.type?(i.A.getLogger("esri.layers.support.FieldsIndex").errorOnce(new n.A("getTimeZone:no-timezone-information",`no time zone information for field '${e.name}'`)),h.n$):_.has(e.type)?h.L5:null:null}getLuxonTimeZone(t){const e=this.getTimeZone(t);return e?e===h.L5?o.GB.instance:e===h.n$?c.mQ.utcInstance:(0,r.tE)(m,e,(()=>c.oh.create(e))):null}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isTimeOnlyField(t){return(0,l.OH)(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){return this.get(t)?.name??void 0}toJSON(){return{fields:this.fields.map((t=>(0,a.W)(t)?t.toJSON():t)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function g(t){return t.trim().toLowerCase()}function p(t){return(0,l.rS)(t)?.toLowerCase()??""}const _=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function f(t){const e=new Map;if(!t.fields)return e;const s=!0===t.datesInUnknownTimezone,{timeInfo:n,editFieldsInfo:i}=t,r=(n?"startField"in n?n.startField:n.startTimeField:"")??"",o=(n?"endField"in n?n.endField:n.endTimeField:"")??"",a=function(t){return"dateFieldsTimeZone"in t}(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?(0,u.ZS)(t.dateFieldsTimeReference):null,l=i?function(t){return"timeZone"in t}(i)?i.timeZone??a:i.dateFieldsTimeReference?(0,u.ZS)(i.dateFieldsTimeReference):a??h.n$:null,c=n?function(t){return"timeZone"in t}(n)?n.timeZone??a:n.timeReference?(0,u.ZS)(n.timeReference):a:null,m=new Map([[g(i?.creationDateField??""),l],[g(i?.editDateField??""),l],[g(r),c],[g(o),c]]);for(const{name:u,type:d}of t.fields)if(_.has(d))e.set(u,h.L5);else if("date"!==d&&"esriFieldTypeDate"!==d)e.set(u,null);else if(s)e.set(u,h.L5);else{const t=m.get(g(u??""))??a;e.set(u,t)}return e}},61826:(t,e,s)=>{s.d(e,{A:()=>S});var n,i=s(66866),r=(s(39831),s(59851)),o=s(21877),a=s(19251),l=s(89882),h=s(21564),u=(s(539),s(75094)),c=s(63863),m=s(77542),d=s(6402),g=s(74639),p=s(40454),_=s(26207),f=s(57974),y=s(66961);const x=new r.J({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function v(t,e,s){return{enabled:!(0,p.TU)(s?.layer)}}function b(t){return!t||"service"!==t.origin&&!("map-image"===t.layer?.type)}function P(t){return!!function(t){return"map-image"===t?.type}(t)&&!!t.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}let S=class extends o.A{static{n=this}static evaluateWhere(t,e){const s=(t,e,s)=>{switch(e){case"=":return t==s;case"<>":return t!=s;case">":return t>s;case">=":return t>=s;case"<":return t<s;case"<=":return t<=s}return!1};try{if(null==t)return!0;const n=t.split(" ");if(3===n.length)return s(e[n[0]],n[1],n[2]);if(7===n.length){const t=s(e[n[0]],n[1],n[2]),i=n[3],r=s(e[n[4]],n[5],n[6]);switch(i){case"AND":return t&&r;case"OR":return t||r}}return!1}catch(n){}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=_.Hk,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const s=e.labelExpressionInfo;if(!s||!s.value&&!s.expression)return t}writeLabelExpression(t,e,s){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)t=(0,g.D3)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const e=(0,g.tH)(this.labelExpressionInfo.expression);e&&(t="["+e+"]")}null!=t&&(e[s]=t)}writeLabelExpressionInfo(t,e,s,n){if(null==t&&null!=this.labelExpression&&b(n))t=new d.A({expression:this.getLabelExpressionArcade()});else if(!t)return;const i=t.toJSON(n);i.expression&&(e[s]=i)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return(0,g.XJ)(this)}getLabelExpressionArcade(){return(0,g.BI)(this)}getLabelExpressionSingleField(){return(0,g.rU)(this)}hash(){return JSON.stringify(this)}clone(){return new n({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:(0,a.o8)(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:(0,a.o8)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};(0,i._)([(0,h.MZ)({type:String,json:{write:!0}})],S.prototype,"name",void 0),(0,i._)([(0,h.MZ)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:v}}}}})],S.prototype,"allowOverrun",void 0),(0,i._)([(0,h.MZ)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:v}}}}})],S.prototype,"deconflictionStrategy",void 0),(0,i._)([(0,h.MZ)({type:String,json:{write:{overridePolicy(t,e,s){return this.labelExpressionInfo&&"service"===s?.origin&&P(s.layer)?{enabled:!1}:{allowNull:!0}}}}})],S.prototype,"labelExpression",void 0),(0,i._)([(0,u.w)("labelExpression")],S.prototype,"readLabelExpression",null),(0,i._)([(0,m.K)("labelExpression")],S.prototype,"writeLabelExpression",null),(0,i._)([(0,h.MZ)({type:d.A,json:{write:{overridePolicy:(t,e,s)=>function(t){return b(t)||P(t?.layer)}(s)?{allowNull:!0}:{enabled:!1}}}})],S.prototype,"labelExpressionInfo",void 0),(0,i._)([(0,m.K)("labelExpressionInfo")],S.prototype,"writeLabelExpressionInfo",null),(0,i._)([(0,h.MZ)({type:x.apiValues,json:{type:x.jsonValues,read:x.read,write:x.write}})],S.prototype,"labelPlacement",void 0),(0,i._)([(0,h.MZ)({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],S.prototype,"labelPosition",void 0),(0,i._)([(0,h.MZ)({type:Number})],S.prototype,"maxScale",void 0),(0,i._)([(0,m.K)("maxScale")],S.prototype,"writeMaxScale",null),(0,i._)([(0,h.MZ)({type:Number})],S.prototype,"minScale",void 0),(0,i._)([(0,m.K)("minScale")],S.prototype,"writeMinScale",null),(0,i._)([(0,h.MZ)({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:v}}}}})],S.prototype,"repeatLabel",void 0),(0,i._)([(0,h.MZ)({type:Number,cast:l.cr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:v}}}}})],S.prototype,"repeatLabelDistance",void 0),(0,i._)([(0,h.MZ)({types:y.em,json:{origins:{"web-scene":{types:y.Rv,write:f.oO,default:null}},write:f.oO,default:null}})],S.prototype,"symbol",void 0),(0,i._)([(0,h.MZ)({type:Boolean,json:{write:!0}})],S.prototype,"useCodedValues",void 0),(0,i._)([(0,h.MZ)({type:String,json:{write:!0}})],S.prototype,"where",void 0),S=n=(0,i._)([(0,c.$)("esri.layers.support.LabelClass")],S)},6402:(t,e,s)=>{s.d(e,{A:()=>c});var n,i=s(66866),r=s(21877),o=s(21564),a=(s(39831),s(539),s(9272),s(75094)),l=s(63863),h=s(77542),u=s(74639);let c=class extends r.A{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}static{n=this}readExpression(t,e){return e.value?(0,u.mX)(e.value):t}writeExpression(t,e,s){null!=this.value&&(t=(0,u.mX)(this.value)),null!=t&&(e[s]=t)}clone(){return new n({expression:this.expression,title:this.title,value:this.value})}};(0,i._)([(0,o.MZ)({type:String,json:{write:{writerEnsuresNonNull:!0}}})],c.prototype,"expression",void 0),(0,i._)([(0,a.w)("expression",["expression","value"])],c.prototype,"readExpression",null),(0,i._)([(0,h.K)("expression")],c.prototype,"writeExpression",null),(0,i._)([(0,o.MZ)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],c.prototype,"title",void 0),(0,i._)([(0,o.MZ)({json:{read:!1,write:!1}})],c.prototype,"value",void 0),c=n=(0,i._)([(0,l.$)("esri.layers.support.LabelExpressionInfo")],c)},3243:(t,e,s)=>{s.d(e,{A:()=>u});var n,i=s(66866),r=s(59851),o=s(21877),a=s(21564),l=(s(39831),s(539),s(9272),s(63863));const h=new r.J({asc:"ascending",desc:"descending"});let u=class extends o.A{static{n=this}constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new n({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"field",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],u.prototype,"valueExpression",void 0),(0,i._)([(0,a.MZ)({type:h.apiValues,json:{type:h.jsonValues,read:h.read,write:h.write}})],u.prototype,"order",void 0),u=n=(0,i._)([(0,l.$)("esri.layers.support.OrderByInfo")],u)},83849:(t,e,s)=>{s.d(e,{A:()=>g});var n=s(66866),i=s(24793),r=s(21877),o=s(21564),a=(s(39831),s(539),s(9272),s(75094)),l=s(63863),h=s(77542),u=s(17197),c=s(16984),m=s(12129);function d(t,e){return c.T.fromJSON({value:t,unit:e})}let g=class extends(i.A.ClonableMixin(r.A)){constructor(t){super(t),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(t,e){return e.timeExtent&&Array.isArray(e.timeExtent)&&2===e.timeExtent.length?u.T.fromArray(e.timeExtent):null}writeFullTimeExtent(t,e){null!=t?.start&&null!=t.end?e.timeExtent=t.toArray():e.timeExtent=null}readInterval(t,e){return e.timeInterval&&e.timeIntervalUnits?d(e.timeInterval,e.timeIntervalUnits):e.defaultTimeInterval&&e.defaultTimeIntervalUnits?d(e.defaultTimeInterval,e.defaultTimeIntervalUnits):null}writeInterval(t,e){e.timeInterval=t?.toJSON().value??null,e.timeIntervalUnits=t?.toJSON().unit??null}};(0,n._)([(0,o.MZ)({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],g.prototype,"cumulative",void 0),(0,n._)([(0,o.MZ)({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],g.prototype,"endField",void 0),(0,n._)([(0,o.MZ)({type:u.T,json:{write:{enabled:!0,allowNull:!0}}})],g.prototype,"fullTimeExtent",void 0),(0,n._)([(0,a.w)("fullTimeExtent",["timeExtent"])],g.prototype,"readFullTimeExtent",null),(0,n._)([(0,h.K)("fullTimeExtent")],g.prototype,"writeFullTimeExtent",null),(0,n._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],g.prototype,"hasLiveData",void 0),(0,n._)([(0,o.MZ)({type:c.T,json:{write:{enabled:!0,allowNull:!0}}})],g.prototype,"interval",void 0),(0,n._)([(0,a.w)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],g.prototype,"readInterval",null),(0,n._)([(0,h.K)("interval")],g.prototype,"writeInterval",null),(0,n._)([(0,o.MZ)({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],g.prototype,"startField",void 0),(0,n._)([(0,o.MZ)((0,m.P6)("timeReference",!0))],g.prototype,"timeZone",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],g.prototype,"trackIdField",void 0),(0,n._)([(0,o.MZ)({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],g.prototype,"useTime",void 0),(0,n._)([(0,o.MZ)({type:[Date],json:{read:!1}})],g.prototype,"stops",void 0),g=(0,n._)([(0,l.$)("esri.layers.support.TimeInfo")],g)},76592:(t,e,s)=>{s.d(e,{C1:()=>E,Fm:()=>v,Ih:()=>x,M6:()=>c,OZ:()=>d,PY:()=>u,Qo:()=>_,Yj:()=>p,fV:()=>g,hG:()=>S,hn:()=>P,id:()=>b,kF:()=>m,ke:()=>y,zQ:()=>C});var n=s(73324),i=s(84698),r=s(78983),o=s(63680),a=s(60973),l=s(56530),h=s(48904);const u={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:n.K}}},c={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,s){e[s]=!t}}}},m={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:n.K}}},d={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:o.w}}},g={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:n.K}}},p={value:null,type:a.A,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:n.K}}};function _(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const f={write:{enabled:!0,layerContainerTypes:n.K},read:!0},y={type:Number,json:{origins:{"web-document":f,"portal-item":{write:{layerContainerTypes:n.K}}}}},x={...y,json:{...y.json,origins:{"web-document":{...f,write:{enabled:!0,layerContainerTypes:n.K,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,s)=>s&&"service"!==s.origin||!e.drawingInfo||void 0===e.drawingInfo.transparency?e.layerDefinition?.drawingInfo&&void 0!==e.layerDefinition.drawingInfo.transparency?(0,h.D)(e.layerDefinition.drawingInfo.transparency):void 0:(0,h.D)(e.drawingInfo.transparency)}}},v={type:i.A,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const s=i.A.fromJSON(t);return null!=e.spatialReference&&"object"==typeof e.spatialReference&&(s.spatialReference=r.A.fromJSON(e.spatialReference)),s}}}},read:!1}},b={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},P={type:Number,json:{origins:{service:{write:{enabled:!1}}},name:"layerDefinition.minScale",write:{layerContainerTypes:n.K}}},S={type:Number,json:{origins:{service:{write:{enabled:!1}}},name:"layerDefinition.maxScale",write:{layerContainerTypes:n.K}}},E={json:{write:{ignoreOrigin:!0,layerContainerTypes:n.K},origins:{"web-map":{read:!1,write:!1}}}},C={type:l.A,json:{name:"attributeTableInfo",write:!0}}},6117:(t,e,s)=>{s.d(e,{Ch:()=>a,mW:()=>r,u2:()=>o});var n=s(92504),i=s(76859);function r(t,e){return{...e,filterMode:t.mode}}function o(t,e){return l(t,e).next().value??null}function a(t,e,s){const r=function(t){if("manual"===u(t))return null;const e=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:s,maxScale:n}of t.filters)e[0]=Math.max(e[0],c(s)),e[1]=Math.min(e[1],m(n));return e}(t);if(r&&((0,n.gg)(e,r[0])||(0,n.ZH)(s,r[1])))return"";const o=Array.from(l(t,e,s)),a=function(t,e,s){if(0===t.length)return!0;const i=c(t.at(0)?.minScale),r=m(t.at(-1)?.maxScale);if((0,n.ZH)(i,e)||(0,n.gg)(r,s))return!0;for(let o=0;o<t.length-1;o++){const e=t[o],s=t[o+1];if((0,n.ZH)(c(s.minScale),m(e.maxScale)))return!0}return!1}(o,e,s)?"1=1":o.map((t=>t.where||"1=1")).reduce(((t,e)=>(0,i.IW)(t,e)),"");return a&&"1=1"!==a?a:""}function*l(t,e,s){if("manual"===u(t)){const e=t.filters.find((e=>e.id===t.activeFilterId));e&&(yield e)}else{"object"==typeof e&&(e=e.scale);for(const n of t.filters)h(n.minScale,n.maxScale,e,s)&&(yield n)}}function h(t,e,s,i){return t=c(t),s=c(s),e=m(e),!(!(0,n.Sp)(s,t)&&(i??s)>t||(0,n.Hx)(e,s)||void 0!==i&&(0,n.Sp)(i,t))}function u(t){return"mode"in t?t.mode:t.filterMode}function c(t){return t||Number.POSITIVE_INFINITY}function m(t){return t||0}},52506:(t,e,s)=>{s.d(e,{$4:()=>O,B5:()=>F,C$:()=>K,GA:()=>et,Nv:()=>B,PD:()=>J,Pt:()=>nt,S2:()=>k,VA:()=>Z,VZ:()=>G,Vq:()=>q,WP:()=>A,Xl:()=>S,Ye:()=>N,ZJ:()=>it,Zm:()=>z,bt:()=>C,ct:()=>w,d$:()=>W,fE:()=>X,hM:()=>R,iX:()=>P,jD:()=>V,jp:()=>L,lV:()=>M,mm:()=>T,pc:()=>Y,rQ:()=>$,rn:()=>I,sg:()=>D,tG:()=>tt,xd:()=>st});var n=s(28830),i=s(12690),r=s(98849),o=s(59851),a=s(76859),l=s(33880),h=s(61985),u=s(43052),c=s(67112),m=s(13495),d=s(42453),g=s(40454),p=s(47347),_=s(2692),f=s(27973),y=s(67281),x=s(14474),v=s(97724),b=s(66961);const P=new o.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function S(t,e,s,n){const i=await H(t);if(await E(t,e,n),!i.addAttachment)throw new r.A(n,"Layer source does not support addAttachment capability");return i.addAttachment(e,s)}function E(t,e,s){const{attributes:n}=e,{objectIdField:i}=t;return t.capabilities?.data?.supportsAttachment?e?n?i&&n[i]?Promise.resolve():Promise.reject(new r.A(s,`feature is missing the identifying attribute ${i}`)):Promise.reject(new r.A(s,"'attributes' are required on a feature to query attachments")):Promise.reject(new r.A(s,"A feature is required to add/delete/update attachments")):Promise.reject(new r.A(s,"this layer doesn't support attachments"))}async function C(t,e,s,n,i){const o=await H(t);if(await E(t,e,i),!o.updateAttachment)throw new r.A(i,"Layer source does not support updateAttachment capability");return o.updateAttachment(e,s,n)}async function w(t,e,n){const{applyEdits:i}=await Promise.all([s.e(2076),s.e(5903)]).then(s.bind(s,75903)),r=await t.load();let o=n;return"feature"===r.type&&r.infoFor3D&&null!=e.deleteFeatures&&null!=r.globalIdField&&(o={...o,globalIdToObjectId:await et(r,e.deleteFeatures,r.globalIdField)}),i(r,r.source,e,n)}async function I(t,e,n){const{uploadAssets:i}=await Promise.all([s.e(2076),s.e(5903)]).then(s.bind(s,75903)),r=await t.load();return i(r,r.source,e,n)}async function T(t,e,s,n){const i=await H(t);if(await E(t,e,n),!i.deleteAttachments)throw new r.A(n,"Layer source does not support deleteAttachments capability");return i.deleteAttachments(e,s)}async function A(t,e,s){const n=(await t.load({signal:e?.signal})).source;if(!n.fetchRecomputedExtents)throw new r.A(s,"Layer source does not support fetchUpdates capability");return n.fetchRecomputedExtents(e)}async function M(t,e,s,n){e=f.A.from(e),await t.load();const i=t.source,o=t.capabilities;if(!o?.data?.supportsAttachment)throw new r.A(n,"this layer doesn't support attachments");const{attachmentTypes:a,objectIds:l,globalIds:h,num:u,size:c,start:m,where:d}=e;if(!o?.operations?.supportsQueryAttachments&&(a?.length>0||h?.length>0||c?.length>0||u||m||d))throw new r.A(n,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(l?.length||h?.length||d))throw new r.A(n,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!i.queryAttachments)throw new r.A(n,"Layer source does not support queryAttachments capability",e);return!o?.attachment?.supportsOrderByFields&&e.orderByFields?.length&&((e=e.clone()).orderByFields=null),i.queryAttachments(e)}async function D(t,e,s,n){const i=await H(t);if(!i.queryObjectIds)throw new r.A(n,"Layer source does not support queryObjectIds capability");return i.queryObjectIds(x.A.from(e)??t.createQuery(),s)}async function N(t,e,s,n){const i=await H(t);if(!i.queryFeatureCount)throw new r.A(n,"Layer source does not support queryFeatureCount capability");return i.queryFeatureCount(x.A.from(e)??t.createQuery(),s)}async function F(t,e,s,n){const i=await H(t);if(!i.queryExtent)throw new r.A(n,"Layer source does not support queryExtent capability");return i.queryExtent(x.A.from(e)??t.createQuery(),s)}async function R(t,e,s,n){const i=await H(t);if(!i.queryRelatedFeatures)throw new r.A(n,"Layer source does not support queryRelatedFeatures capability");return i.queryRelatedFeatures(v.default.from(e),s)}async function k(t,e,s,n){const i=await H(t);if(!i.queryRelatedFeaturesCount)throw new r.A(n,"Layer source does not support queryRelatedFeaturesCount capability");return i.queryRelatedFeaturesCount(v.default.from(e),s)}async function L(t){const e=t.source;if(e?.refresh)try{const{dataChanged:s,updates:n}=await e.refresh();if(null!=n&&(t.sourceJSON={...t.sourceJSON,...n},t.read(n,{origin:"service",url:t.parsedUrl})),s)return!0}catch{}if(t.definitionExpression)try{return(await(0,a.GP)(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function G(t){const e=new x.A;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,e.outFields=["*"],e.multipatchOption="multipatch"===t.geometryType?"xyFootprint":null;const s=t.capabilities?.query;s&&(e.compactGeometryEnabled=s.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=s.supportsDefaultSpatialReference);const n=t.capabilities?.data;n?.supportsZ&&null!=t.returnZ&&(e.returnZ=t.returnZ),n?.supportsM&&null!=t.returnM&&(e.returnM=t.returnM);const{timeOffset:i,timeExtent:r}=t;return e.timeExtent=null!=i&&null!=r?r.offset(-i.value,i.unit):r||null,e}function V(t){const{globalIdField:e,fields:s}=t;if(e)return e;if(s)for(const n of s)if("esriFieldTypeGlobalID"===n.type)return n.name}function z(t){const{objectIdField:e,fields:s}=t;if(e)return e;if(s)for(const n of s)if("esriFieldTypeOID"===n.type)return n.name}function O(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function q(t,e,s,n){const i=s?.feature,r=!!t.subtypes?.length;if(r&&!s?.excludeImpliedDomains){const s=Y(t,e);if(s)return s}const o=r&&B(t,i);if(o){const t=o?.domains?.[e];return"inherited"===t?.type?n:t}const a=st(t.types,t.typeIdField,i);if(a){const t=a.domains&&a.domains[e];if(t&&"inherited"!==t?.type)return t}if(n)return n;if(!s?.excludeImpliedDomains){const s=function(t,e){const{fieldsIndex:s}=t,{name:n,type:i}=s.get(e)??{};if(!n)return null;if(("typeIdField"in t?s.get(t.typeIdField)?.name:null)===n&&"types"in t&&t.types?.length){const e=t.types.map((t=>new u.H({code:U(t.id,i),name:t.name})));return new c.A({codedValues:e})}return null}(t,e);if(s)return s}return null}function B(t,e){const{subtypes:s,subtypeField:n}=t;if(!e?.attributes||!s?.length||!n)return null;const i=e.attributes[n];return null==i?null:s.find((t=>t.code===i))}function Y(t,e){const{fieldsIndex:s,subtypeField:n}=t,{name:i,type:r}=s.get(e)??{};if(!i)return null;if((n&&s.get(n)?.name)===i&&t.subtypes?.length){const e=t.subtypes.map((t=>new u.H({code:U(t.code,r),name:t.name})));if(e?.length)return new c.A({codedValues:e})}return null}function U(t,e){return e?(0,d.yM)({type:e})&&"number"==typeof t?`${t}`:(0,d.R3)({type:e})&&"string"==typeof t?Number.parseInt(t,10):t:t}async function H(t){return(await t.load()).source}async function X(t,e){if(!n.id)return;const s=n.id.findCredential(t);if(s)return s.userId;let i;try{const s=await(0,g.wI)(t,e);s&&(i=await n.id.checkSignInStatus(`${s}/sharing`))}catch(r){}return i?i.userId:null}async function j(t,e){if(!n.id)return;if(n.id.findCredential(t))return;let s;try{const i=await(0,g.wI)(t,e);i&&(s=await n.id.checkSignInStatus(`${i}/sharing`))}catch(i){}if(s)try{const s=null!=e?e.signal:null;await n.id.getCredential(t,{signal:s})}catch(i){}}async function Z(t,e,s){const n=t.parsedUrl?.path;n&&t.authenticationTriggerEvent===e&&await j(n,s)}async function W(t){const e=t.parsedUrl?.path;e&&function(t){return function(t){return!(!(0,g.CF)(t)||!t.capabilities?.query.supportsCurrentUser)}(t)&&("serviceDefinitionExpression"in t&&$(t.serviceDefinitionExpression)||"definitionExpression"in t&&$(t.definitionExpression))}(t)&&await j(e)}function $(t){return!!t?.toLowerCase().includes("current_user")}function K(t){return!nt(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const Q=(0,h.C)({types:b.xK});function J(t,e){if(t.defaultSymbol)return t.types?.length?new _.A({defaultSymbol:Q(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map((t=>({id:t.id,symbol:Q(t.symbol,t,e)})))}):new p.A({symbol:Q(t.defaultSymbol,t,e)})}function tt(t){let e=t.sourceJSON?.cacheMaxAge;if(!e)return!1;const s=t.editingInfo?.lastEditDate?.getTime();return null==s||(e*=1e3,Date.now()-s<e)}async function et(t,e,s){if(null==e)return null;const n=[],{objectIdField:r}=t;if(e.forEach((t=>{let e=null;if("attributes"in t){const{attributes:n}=t;e={globalId:n[s],objectId:null!=n[r]&&-1!==n[r]?n[r]:null}}else e={globalId:t.globalId,objectId:null!=t.objectId&&-1!==t.objectId?t.objectId:null};null!=e.globalId&&(null!=e.objectId&&-1!==e.objectId||n.push(e.globalId))})),0===n.length)return null;const o=t.createQuery();o.where=n.map((t=>`${s}='${t}'`)).join(" OR "),o.returnGeometry=!1,o.outFields=[r,s],o.cacheHint=!1;const a=await(0,i.DZ)((0,m.SE)(t,o));if(!a.ok)return null;const h=new Map,u=a.value.features;for(const i of u){const t=i.attributes[s],e=i.attributes[r];null!=t&&null!=e&&-1!==e&&h.set((0,l.AG)(t),e)}return h}function st(t,e,s){if(!e||!s||!t)return null;const n=s.getAttribute(e);return null==n?null:t.find((t=>{const{id:e}=t;return null!=e&&e.toString()===n.toString()}))??null}function nt(t){return t.sourceJSON?.isMultiServicesView||function(t){return!!t.sourceJSON?.capabilities?.toLowerCase().split(",").map((t=>t.trim())).includes("map")}(t)}function it(t,e,s){const n=e?.queryAttributeBins;if(!e?.operations?.supportsQueryBins||!n)throw new r.A(s,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!n.supportsAutoInterval)throw new r.A(s,"Layer source does not support auto-interval binning");if(t.binParameters.normalizationType&&(!n.supportsNormalization||!rt(t.binParameters.normalizationType,n.supportedNormalizationTypes)))throw new r.A(s,"Layer source does not support normalization binning");break;case"date":if(!n.supportsDate)throw new r.A(s,"Layer source does not support date binning");if(t.binParameters.snapToData&&!n.supportsSnapToData)throw new r.A(s,"Layer source does not support snapToData binning");if(t.binParameters.returnFullIntervalBin&&!n.supportsReturnFullIntervalBin)throw new r.A(s,"Layer source does not support returnFullIntervalBin binning");break;case"fixed-boundaries":if(!n.supportsFixedBoundaries)throw new r.A(s,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!n.supportsFixedInterval)throw new r.A(s,"Layer source does not support fixed-interval binning");if(t.binParameters.normalizationType&&(!n.supportsNormalization||!rt(t.binParameters.normalizationType,n.supportedNormalizationTypes)))throw new r.A(s,"Layer source does not support normalization binning")}if(t.binParameters.stackBy&&!n.supportsStackBy)throw new r.A(s,"Layer source does not support stackBy binning");if(t.binParameters.splitBy&&!n.supportsSplitBy)throw new r.A(s,"Layer source does not support splitBy binning");if(t.binParameters.firstDayOfWeek&&!n.supportsFirstDayOfWeek)throw new r.A(s,"Layer source does not support firstDayOfWeek binning");const i=n?.supportedStatistics;if(t.outStatistics&&i){const e=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(const{statisticType:n}of t.outStatistics){const t=e.get(n);if(t&&!i[t])throw new r.A(s,`Layer source does not support ${n} statistic type`)}}}function rt(t,e){return null!=t&&!!e?.[y.Q.toJSON(t)]}},13495:(t,e,s)=>{s.d(e,{SE:()=>i});var n=s(14474);async function i(t,e,s){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=o(t));const n=r(t),i=t.capabilities.query.supportsPagination;e.start=0,e.num=n;let a=null;for(;;){const r=await t.source.queryFeaturesJSON(e,s);if(null==a?a=r:a.features=a.features.concat(r.features),a.exceededTransferLimit=r.exceededTransferLimit,!i||!r.exceededTransferLimit)break;e.start+=n}return a}function r(t){return o(t)*function(t){return t.capabilities.query.maxRecordCount||2e3}(t)}function o(t){return t.capabilities.query.supportsMaxRecordCountFactor?n.A.MAX_MAX_RECORD_COUNT_FACTOR:1}},92568:(t,e,s)=>{s.d(e,{d:()=>N});var n,i=s(73324),r=s(18475),o=s(66866),a=s(56542),l=s(19251),h=s(76724),u=s(89882),c=s(21564),m=s(73446),d=s(28902),g=s(75094),p=s(63863),_=s(77542),f=s(94301),y=s(76592),x=s(52506),v=s(61826),b=s(48887),P=s(53835);let S=n=class extends r.c{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=(0,u.cr)("12px"),this.fields=[],this.renderer=null}writeFields(t,e,s){const n=t.filter((t=>"avg_angle"!==t.statisticType)).map((t=>t.toJSON()));(0,h.sM)(s,n,e)}readRenderer(t,e,s){const n=e.drawingInfo?.renderer;return n?(0,b.L)(n,e,s)??void 0:(0,x.PD)(e,s)}clone(){return new n({fields:(0,l.o8)(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:(0,l.o8)(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:(0,l.o8)(this.popupTemplate),renderer:(0,l.o8)(this.renderer),binType:(0,l.o8)(this.binType),size:this.size})}};(0,o._)([(0,d.e)({binning:"binning"})],S.prototype,"type",void 0),(0,o._)([(0,d.e)({geohash:"geohash",square:"square"}),(0,c.MZ)({type:["geohash","square"]})],S.prototype,"binType",void 0),(0,o._)([(0,c.MZ)({type:Number,json:{write:!0}})],S.prototype,"fixedBinLevel",void 0),(0,o._)([(0,c.MZ)({type:[v.A],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],S.prototype,"labelingInfo",void 0),(0,o._)([(0,c.MZ)(y.kF)],S.prototype,"labelsVisible",void 0),(0,o._)([(0,c.MZ)({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],S.prototype,"maxScale",void 0),(0,o._)([(0,c.MZ)(y.M6)],S.prototype,"popupEnabled",void 0),(0,o._)([(0,c.MZ)({type:a.A,json:{name:"popupInfo",write:!0}})],S.prototype,"popupTemplate",void 0),(0,o._)([(0,c.MZ)({cast:t=>"auto"===t?t:(0,m.GB)((0,u.cr)(t))})],S.prototype,"size",void 0),(0,o._)([(0,c.MZ)({type:[f.A],json:{write:!0}})],S.prototype,"fields",void 0),(0,o._)([(0,_.K)("fields")],S.prototype,"writeFields",null),(0,o._)([(0,c.MZ)({types:P.Hg,json:{write:{target:"drawingInfo.renderer"}}})],S.prototype,"renderer",void 0),(0,o._)([(0,g.w)("renderer",["drawingInfo.renderer"])],S.prototype,"readRenderer",null),S=n=(0,o._)([(0,p.$)("esri.layers.support.FeatureReductionBinning")],S);var E,C=s(21877),w=s(47347),I=s(66961);function T(t){return"simple"===t.type&&!t.visualVariables?.length}let A=E=class extends C.A{constructor(t){super(t),this.type="cluster",this.clusterRadius=(0,u.cr)("80px"),this.clusterMinSize=(0,u.cr)("12px"),this.clusterMaxSize=(0,u.cr)("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(t,e,s){const n=e.drawingInfo?.renderer;return n?.authoringInfo?.isAutoGenerated?null:n?T(n)?null:(0,b.L)(n,e,s)??void 0:(0,x.PD)(e,s)}readSymbol(t,e,s){const n=e.drawingInfo?.renderer;if(n?.authoringInfo?.isAutoGenerated)return null;if(n&&T(n)){const t=(0,b.L)(n,e,s);return t?.symbol}return null}writeSymbol(t,e,s,n){const i=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||i){const s=new w.A({symbol:t});e.drawingInfo={renderer:s.write({},n)}}}writeFields(t,e,s){const n=t.filter((t=>"avg_angle"!==t.statisticType)).map((t=>t.toJSON()));(0,h.sM)(s,n,e)}readFields(t,e,s){return t.filter((t=>!t.isAutoGenerated)).map((t=>f.A.fromJSON(t)))}clone(){return new E({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:(0,l.o8)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:(0,l.o8)(this.fields),maxScale:this.maxScale,renderer:(0,l.o8)(this.renderer),symbol:(0,l.o8)(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:(0,l.o8)(this.popupTemplate)})}};(0,o._)([(0,c.MZ)({type:["cluster"],readOnly:!0,json:{write:!0}})],A.prototype,"type",void 0),(0,o._)([(0,c.MZ)({cast:t=>"auto"===t?t:(0,m.GB)((0,u.cr)(t)),json:{write:!0}})],A.prototype,"clusterRadius",void 0),(0,o._)([(0,c.MZ)({type:Number,cast:u.cr,json:{write:!0}})],A.prototype,"clusterMinSize",void 0),(0,o._)([(0,c.MZ)({type:Number,cast:u.cr,json:{write:!0}})],A.prototype,"clusterMaxSize",void 0),(0,o._)([(0,c.MZ)({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],A.prototype,"maxScale",void 0),(0,o._)([(0,c.MZ)(y.M6)],A.prototype,"popupEnabled",void 0),(0,o._)([(0,c.MZ)({type:a.A,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],A.prototype,"popupTemplate",void 0),(0,o._)([(0,c.MZ)({types:P.Hg,json:{write:{target:"drawingInfo.renderer"}}})],A.prototype,"renderer",void 0),(0,o._)([(0,g.w)("renderer",["drawingInfo.renderer"])],A.prototype,"readRenderer",null),(0,o._)([(0,c.MZ)({types:I.q8})],A.prototype,"symbol",void 0),(0,o._)([(0,g.w)("symbol",["drawingInfo.renderer"])],A.prototype,"readSymbol",null),(0,o._)([(0,_.K)("symbol")],A.prototype,"writeSymbol",null),(0,o._)([(0,c.MZ)({type:[v.A],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],A.prototype,"labelingInfo",void 0),(0,o._)([(0,c.MZ)(y.kF)],A.prototype,"labelsVisible",void 0),(0,o._)([(0,c.MZ)({type:[f.A],json:{write:!0}})],A.prototype,"fields",void 0),(0,o._)([(0,_.K)("fields")],A.prototype,"writeFields",null),(0,o._)([(0,g.w)("fields")],A.prototype,"readFields",null),A=E=(0,o._)([(0,p.$)("esri.layers.support.FeatureReductionCluster")],A);var M=s(99989);const D={key:"type",base:r.c,typeMap:{cluster:A,binning:S}},N={types:{key:"type",base:r.c,typeMap:{selection:M.A,cluster:A,binning:S}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:D},"portal-item":{types:D},"web-scene":{types:{key:"type",base:r.c,typeMap:{selection:M.A}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:i.K}}}}}},77567:(t,e,s)=>{s.d(e,{p:()=>l});var n=s(39831),i=s(539),r=s(24738),o=s(79005),a=s(42453);function l(){return{fields:{type:[r.A],value:null,set:function(t){if(t&&(0,n.A)("big-integer-warning-enabled")){const e=t.filter((t=>"big-integer"===t.type||"oid"===t.type&&(t.length||0)>=8));if(e.length){const t=e.map((t=>`'${t.name}'`)).join(", ");i.A.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${t}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",t)}},fieldsIndex:{readOnly:!0,get(){return o.A.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){const t=this._userOutFields;if(!t?.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const e of t){const s=this.fieldsIndex?.has(e);s||i.A.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${e} found in outFields`,{layer:this,outFields:t})}return(0,a.DB)(this.fieldsIndex,t)}}}}},40906:(t,e,s)=>{s.d(e,{CW:()=>d,Fm:()=>l,Hz:()=>g,JQ:()=>m,JZ:()=>P,ND:()=>_,R_:()=>o,U9:()=>c,fu:()=>i,nr:()=>p,oF:()=>r,rq:()=>h,z$:()=>u});const n=[["binary","application/octet-stream","bin",""]];function i(t,e){return null!=y(e.name,t?.supportedFormats??[])}function r(t,e){if(!t)return!1;const s=h(e,t.supportedFormats??[]);return null!=s&&t.editFormats.includes(s)}function o(t,e){return x(function(t,e){const s=t.toLowerCase();return f(e).find((t=>v(t)===s))}(t,e))}function a(t,e){return x(y(t,e))}function l(t,e){return v(function(t,e){return f(e).find((e=>x(e)===t))}(t,e))}function h(t,e){return a(t.name,e)??o(t.type,e)}function u(t,e,s){return o(t,s)??a(e,s)}function c({supportedFormats:t}){return u("model/gltf-binary","glb",t)}function m(t){const e=c(t);return null!=e&&t.editFormats.includes(e)}function d({supportedFormats:t}){return u("model/gltf+json","gltf",t)}function g(t){if(!t)return null;const e=c(t),s=d(t);let n=null;for(const i of t.queryFormats){if(i===e)return i;i===s&&(n=i)}return n}function p({supportedFormats:t}){return u("application/esri3do-SR_world","wld",t)}function _({supportedFormats:t}){return u("application/esri3do-SR_prj","prj",t)}function f(t){return[...n,...t]}function y(t,e){const s=t.toLowerCase();return f(e).find((t=>b(t).some((t=>s.endsWith(t)))))}function x(t){return t?.[0]}function v(t){return t?.[1].toLowerCase()}function b(t){return t?.[2].split(",").map((t=>t.toLowerCase()))??[]}function P(t){return t.tables?.find((t=>"assetMaps"===t.role))}},74639:(t,e,s)=>{s.d(e,{BI:()=>_,D3:()=>g,XJ:()=>p,lc:()=>d,mX:()=>y,rU:()=>f,tH:()=>S});var n=s(96274);const i="__begin__",r="__end__",o=new RegExp(i,"ig"),a=new RegExp(r,"ig"),l=new RegExp("^"+i,"i"),h=new RegExp(r+"$","i"),u='"',c=u+" + ",m=" + "+u;function d(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function g(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function p(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):null!=t.labelExpression&&(e.expression=d(t.labelExpression),e.type="conventional"),e}function _(t){const e=p(t);if(!e)return null;switch(e.type){case"conventional":return y(e.expression);case"arcade":return e.expression}return null}function f(t){const e=p(t);if(!e)return null;switch(e.type){case"conventional":return function(t){const e=t?.match(x);return e?.[1].trim()||null}(e.expression);case"arcade":return S(e.expression)}return null}function y(t){let e;return t?(e=(0,n.HC)(t,(t=>i+'$feature["'+t+'"]'+r)),e=l.test(e)?e.replace(l,""):u+e,e=h.test(e)?e.replace(h,""):e+u,e=e.replaceAll(o,c).replaceAll(a,m)):e='""',e}const x=/^\s*\{([^}]+)\}\s*$/i;const v=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,b=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,P=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function S(t){if(!t)return null;let e=v.exec(t)||b.exec(t);return e?e[1]||e[3]:(e=P.exec(t),e?e[2]:null)}},79682:(t,e,s)=>{s.d(e,{w:()=>l,z:()=>c});var n=s(98849),i=s(539),r=s(61826);const o=()=>i.A.getLogger("esri.layers.support.labelingInfo"),a=/\[([^[\]]+)\]/gi;function l(t,e,s){return t?t.map((t=>{const n=new r.A;if(n.read(t,s),n.labelExpression){const t=e.fields||e.layerDefinition?.fields||this.fields;n.labelExpression=n.labelExpression.replaceAll(a,((e,s)=>`[${function(t,e){if(!e)return t;const s=t.toLowerCase();for(let n=0;n<e.length;n++){const t=e[n].name;if(t.toLowerCase()===s)return t}return t}(s,t)}]`))}return n})):null}const h=["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],u={esriGeometryPoint:h,esriGeometryMultiPatch:["always-horizontal"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:h,esriGeometryEnvelope:null};function c(t,e){const s=[];for(const i of t){const t=i.labelPlacement,r=u[e];if(!i.symbol)return o().warn("No ILabelClass symbol specified."),[];if(!r)return o().error(new n.A("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),[];if(r.includes(t))s.push(i);else{const n=r[0];t&&o().warn(`Found invalid label placement type ${t} for ${e}. Defaulting to ${n}`);const a=i.clone();a.labelPlacement=n,s.push(a)}}return s}},47393:(t,e,s)=>{function n(t){return null!=t&&"object"==typeof t&&"2d"===t.type&&"linkchart"===t.view2dType}s.d(e,{O:()=>n})},39532:(t,e,s)=>{s.d(e,{It:()=>d,LG:()=>o,OM:()=>h,Sm:()=>u,Y:()=>a,bK:()=>l,mm:()=>m,sQ:()=>c});var n=s(68490),i=s(78983),r=s(96082);function o(t,e){if(!a(t,e)){const s=t.typeKeywords;s?s.push(e):t.typeKeywords=[e]}}function a(t,e){return!!t.typeKeywords?.includes(e)}function l(t){return a(t,m.HOSTED_SERVICE)}function h(t,e){const s=t.typeKeywords;if(s){const t=s.indexOf(e);t>-1&&s.splice(t,1)}}function u(t,e,s){s?o(t,e):h(t,e)}async function c(t){const e=t.clone().normalize();let s;if(e.length>1)for(const n of e)s?n.width>s.width&&(s=n):s=n;else s=e[0];return async function(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return(0,r.ci)(t);const s=i.A.WGS84;return await(0,n.initializeProjection)(e,s),(0,n.project)(t,s)}(s)}const m={CHARTS:"Charts",DYNAMIC:"Dynamic",DEVELOPER_BASEMAP:"DeveloperBasemap",GROUP_LAYER_MAP:"Map",HOSTED_SERVICE:"Hosted Service",JSAPI:"ArcGIS API for JavaScript",LOCAL_SCENE:"ViewingMode-Local",METADATA:"Metadata",MULTI_LAYER:"Multilayer",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer",SINGLE_LAYER:"Singlelayer",SUBTYPE_GROUP_LAYER:"SubtypeGroupLayer",SUBTYPE_GROUP_TABLE:"SubtypeGroupTable",TABLE:"Table",TILED_IMAGERY:"Tiled Imagery"};function d(t){const{portal:e,isOrgItem:s,itemControl:n}=t,i=e.user?.privileges;let r=!i||i.includes("features:user:edit"),o=!!s&&!!i?.includes("features:user:fullEdit");const a="update"===n||"admin"===n;return a?o=r=!0:o&&(r=!0),{features:{edit:r,fullEdit:o},content:{updateItem:a}}}},55134:(t,e,s)=>{s.d(e,{j:()=>n});const n=(0,s(59851).O)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},17671:(t,e,s)=>{s.d(e,{A:()=>I});var n,i=s(66866),r=s(59851),o=s(19251),a=s(539),l=s(21564),h=s(4130),u=s(28902),c=s(75094),m=s(63863),d=s(77542),g=s(73446),p=s(42453),_=s(76589),f=s(61856),y=s(87729),x=s(16758),v=s(49900),b=s(35387),P=s(66961);const S="percent-of-total",E="field",C=new r.J({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:S,esriNormalizeByField:E}),w=(0,g.dp)(y.A);let I=n=class extends((0,f.h)(_.A)){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,s){if(!Array.isArray(t))return;let n=e.minValue;return t.map((t=>{const e=new y.A;return e.read(t,s),null==e.minValue&&(e.minValue=n),null==e.maxValue&&(e.maxValue=e.minValue),n=e.maxValue,e}))}writeClassBreakInfos(t,e,s,n){const i=t.map((t=>t.write({},n)));this._areClassBreaksConsecutive()&&i.forEach((t=>delete t.classMinValue)),e[s]=i}castField(t){return null==t?t:"function"==typeof t?(a.A.getLogger(this).error(".field: field must be a string value"),null):(0,g.GX)(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,s=null!=this.normalizationTotal;return e||s?(t=e&&E||s&&S||null,e&&s&&a.A.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==E&&t!==S||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,s){let n=null;n="number"==typeof t?new y.A({minValue:t,maxValue:e,symbol:(0,P.dp)(s)}):w((0,o.o8)(t)),this.classBreakInfos.push(n),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const s=this.classBreakInfos.length;for(let n=0;n<s;n++){const s=[this.classBreakInfos[n].minValue,this.classBreakInfos[n].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(n,1);break}}}getBreakIndex(t,e){return this.valueExpression&&null==e?.arcade&&a.A.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let s=e;this.valueExpression&&null==e?.arcade&&(s={...s,arcade:await(0,b.l)()});const n=this.getBreakIndex(t,s);return-1!==n?this.classBreakInfos[n]:null}getSymbol(t,e){if(this.valueExpression&&null==e?.arcade)return void a.A.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const s=this.getBreakIndex(t,e);return s>-1?this.classBreakInfos[s].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let s=e;if(this.valueExpression&&null==e?.arcade){const t=await(0,b.l)(),{arcadeUtils:e}=t;e.hasGeometryOperations(this.valueExpression)&&await e.enableGeometryOperations(),s={...s,arcade:t}}const n=this.getBreakIndex(t,s);return n>-1?this.classBreakInfos[n].symbol:this.defaultSymbol}get symbols(){const t=[];return this.classBreakInfos.forEach((e=>{e.symbol&&t.push(e.symbol)})),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables?.reduce(((t,e)=>t+e.getAttributeHash()),"")??""}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),s=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce(((t,e)=>t+e.getMeshHash()),"")}.${s}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new n({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:(0,o.o8)(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:(0,o.o8)(this.visualVariables),legendOptions:(0,o.o8)(this.legendOptions),authoringInfo:(0,o.o8)(this.authoringInfo)})}async collectRequiredFields(t,e){const s=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(s)}async collectSymbolFields(t,e){const s=[...this.symbols.map((s=>s.collectRequiredFields(t,e))),(0,p.Dx)(t,e,this.valueExpression)];(0,p.rq)(t,e,this.field),(0,p.rq)(t,e,this.normalizationField),await Promise.all(s)}_getBreakIndexForExpression(t,e){const{viewingMode:s,scale:n,spatialReference:i,arcade:r,timeZone:o}=e??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const h=r.arcadeUtils;if(!l){const t=h.createSyntaxTree(a);l=h.createFunction(t),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const u=h.executeFunction(l,h.createExecContext(t,h.getViewInfo({viewingMode:s,scale:n,spatialReference:i}),o));return this._getBreakIndexfromInfos(u)}_getBreakIndexForField(t){const e=this.field,s=t.attributes,n=this.normalizationType;let i=parseFloat(s[e]);if(n){const t=this.normalizationTotal,e=parseFloat(this.normalizationField?s[this.normalizationField]:void 0);if("log"===n)i=Math.log(i)*Math.LOG10E;else if(n!==S||null==t||isNaN(t)){if(n===E&&!isNaN(e)){if(isNaN(i)||isNaN(e))return-1;i/=e}}else i=i/t*100}return this._getBreakIndexfromInfos(i)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(null!=t&&"number"==typeof t&&!isNaN(t))for(let s=0;s<this.classBreakInfos.length;s++){const n=[this.classBreakInfos[s].minValue,this.classBreakInfos[s].maxValue];if(n[0]<=t&&(e?t<=n[1]:t<n[1]))return s}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let s=1;s<e;s++)if(t[s-1].maxValue!==t[s].minValue)return!1;return!0}};(0,i._)([(0,l.MZ)(x.As)],I.prototype,"backgroundFillSymbol",void 0),(0,i._)([(0,l.MZ)({type:[y.A],json:{write:{isRequired:!0}}})],I.prototype,"classBreakInfos",void 0),(0,i._)([(0,c.w)("classBreakInfos")],I.prototype,"readClassBreakInfos",null),(0,i._)([(0,d.K)("classBreakInfos")],I.prototype,"writeClassBreakInfos",null),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],I.prototype,"defaultLabel",void 0),(0,i._)([(0,l.MZ)(x.z4)],I.prototype,"defaultSymbol",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],I.prototype,"field",void 0),(0,i._)([(0,h.w)("field")],I.prototype,"castField",null),(0,i._)([(0,l.MZ)({type:Boolean})],I.prototype,"isMaxInclusive",void 0),(0,i._)([(0,l.MZ)({type:v.A,json:{write:!0}})],I.prototype,"legendOptions",void 0),(0,i._)([(0,l.MZ)({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],I.prototype,"minValue",null),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],I.prototype,"normalizationField",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],I.prototype,"normalizationTotal",void 0),(0,i._)([(0,l.MZ)({type:C.apiValues,value:null,json:{type:C.jsonValues,read:C.read,write:C.write}})],I.prototype,"normalizationType",null),(0,i._)([(0,u.e)({classBreaks:"class-breaks"})],I.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],I.prototype,"valueExpression",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],I.prototype,"valueExpressionTitle",void 0),I=n=(0,i._)([(0,m.$)("esri.renderers.ClassBreaksRenderer")],I)},76589:(t,e,s)=>{s.d(e,{A:()=>u});var n=s(66866),i=s(59851),r=s(21877),o=s(21564),a=(s(39831),s(539),s(9272),s(63863)),l=s(18443);const h=new i.J({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let u=class extends r.A{constructor(t){super(t),this.authoringInfo=null,this.type=null}async getRequiredFields(t){if(!this.collectRequiredFields)return[];const e=new Set;return await this.collectRequiredFields(e,t),Array.from(e).sort()}getSymbol(t,e){}async getSymbolAsync(t,e){}get symbols(){return[]}get arcadeRequired(){return!1}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};(0,n._)([(0,o.MZ)({type:l.A,json:{write:!0}})],u.prototype,"authoringInfo",void 0),(0,n._)([(0,o.MZ)({type:h.apiValues,readOnly:!0,json:{type:h.jsonValues,read:!1,write:{writer:h.write,ignoreOrigin:!0,isRequired:!0}}})],u.prototype,"type",void 0),u=(0,n._)([(0,a.$)("esri.renderers.Renderer")],u)},47347:(t,e,s)=>{s.d(e,{A:()=>m});var n,i=s(66866),r=s(19251),o=s(21564),a=(s(39831),s(539),s(28902)),l=s(63863),h=s(76589),u=s(61856),c=s(16758);let m=n=class extends((0,u.h)(h.A)){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.symbols.map((s=>s.collectRequiredFields(t,e))))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}get symbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables?.reduce(((t,e)=>t+e.getAttributeHash()),"")??""}getMeshHash(){return this.symbols.reduce(((t,e)=>t+JSON.stringify(e)),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new n({description:this.description,label:this.label,symbol:(0,r.o8)(this.symbol),visualVariables:(0,r.o8)(this.visualVariables),authoringInfo:(0,r.o8)(this.authoringInfo)})}};(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],m.prototype,"description",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],m.prototype,"label",void 0),(0,i._)([(0,o.MZ)(c.Wp)],m.prototype,"symbol",void 0),(0,i._)([(0,a.e)({simple:"simple"})],m.prototype,"type",void 0),m=n=(0,i._)([(0,l.$)("esri.renderers.SimpleRenderer")],m)},2692:(t,e,s)=>{s.d(e,{A:()=>O});var n=s(66866),i=s(98849),r=s(19251),o=s(539),a=s(76724),l=s(85251),h=s(21564),u=s(4130),c=s(28902),m=s(75094),d=s(63863),g=s(77542),p=s(64442),_=s(73446),f=s(42453),y=s(10282),x=s(76589),v=s(61856),b=s(16758),P=s(49900),S=s(24793),E=s(21877);s(39831),s(9272);let C=class extends(S.A.ClonableMixin(E.A)){constructor(t){super(t),this.value=null,this.value2=null,this.value3=null}};(0,n._)([(0,h.MZ)(b.Ug)],C.prototype,"value",void 0),(0,n._)([(0,h.MZ)(b.Ug)],C.prototype,"value2",void 0),(0,n._)([(0,h.MZ)(b.Ug)],C.prototype,"value3",void 0),C=(0,n._)([(0,d.$)("esri.renderers.support.UniqueValue")],C);var w=s(85569);let I=class extends(S.A.ClonableMixin(E.A)){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(t){if(null==t)return null;const e=typeof(t=Array.isArray(t)?t:[t])[0];return"string"===e||"number"===e?t.map((t=>new C({value:t}))):"object"===e?t[0]instanceof C?t:t.map((t=>new C(t))):null}};(0,n._)([(0,h.MZ)({type:String,json:{write:!0}})],I.prototype,"description",void 0),(0,n._)([(0,h.MZ)({type:String,json:{write:!0}})],I.prototype,"label",void 0),(0,n._)([(0,h.MZ)(b.z4)],I.prototype,"symbol",void 0),(0,n._)([(0,h.MZ)({type:[C],json:{type:[[String]],read:{reader:t=>t?t.map((t=>new C({value:t[0],value2:t[1],value3:t[2]}))):null},write:{writer:(t,e)=>{const s=[];for(const n of t){const t=[n.value,n.value2,n.value3].filter(w.Ru).map((t=>t.toString()));s.push(t)}e.values=s}}}})],I.prototype,"values",void 0),(0,n._)([(0,u.w)("values")],I.prototype,"castValues",null),I=(0,n._)([(0,d.$)("esri.renderers.support.UniqueValueClass")],I);let T=class extends(S.A.ClonableMixin(E.A)){constructor(t){super(t),this.heading=null,this.classes=null}};(0,n._)([(0,h.MZ)({type:String,json:{write:!0}})],T.prototype,"heading",void 0),(0,n._)([(0,h.MZ)({type:[I],json:{write:{isRequired:!0}}})],T.prototype,"classes",void 0),T=(0,n._)([(0,d.$)("esri.renderers.support.UniqueValueGroup")],T);var A,M=s(3324),D=s(35387),N=s(63680),F=s(75162),R=s(59890),k=s(66961);const L="uvInfos-watcher",G="uvGroups-watcher",V=(0,_.dp)(M.A);function z(t){return null!=t&&""!==t&&("string"!=typeof t||""!==t.trim()&&"<null>"!==t.toLowerCase())||(t=null),t+""}let O=A=class extends((0,v.h)(x.A)){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,e){if(!t&&!e)return;if(!t||!e)return{type:"complete",oldValue:t,newValue:e};let s=!1;const n={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let i=0;i<e.length;i++){const r=t.find((t=>t.value===e[i].value));r?(0,p.Ui)(r,e[i])?(n.changed.push({type:"complete",oldValue:r,newValue:e[i]}),s=!0):n.unchanged.push({oldValue:r,newValue:e[i]}):(n.added.push(e[i]),s=!0)}for(let i=0;i<t.length;i++)e.find((e=>e.value===t[i].value))||(n.removed.push(t[i]),s=!0);return s?n:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return null==t||"function"==typeof t?t:(0,_.GX)(t)}writeField(t,e,s,n){"string"==typeof t?e[s]=t:n?.messages?n.messages.push(new i.A("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):o.A.getLogger(this).error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,s){return s.portal||y.A.getDefault()}readStyleOrigin(t,e,s){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const t=(0,N.f)(e.styleUrl,s);return Object.freeze({styleUrl:t})}}writeStyleOrigin(t,e,s,n){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=(0,N.t)(t.styleUrl,n))}set uniqueValueGroups(t){this.styleOrigin?o.A.getLogger(this).error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?o.A.getLogger(this).error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){if(this.styleOrigin)return void o.A.getLogger(this).error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let s;s="object"==typeof t?V(t):new M.A({value:t,symbol:(0,k.dp)(e)}),this.uniqueValueInfos?.push(s),this._valueInfoMap[z(s.value)]=s,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void o.A.getLogger(this).error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e)for(let s=0;s<e.length;s++){const n=e[s];if(String(n.value)===String(t)){delete this._valueInfoMap[z(t)],e.splice(s,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let s=e;return this.valueExpression&&null==e?.arcade&&(s={...s,arcade:await(0,D.l)()}),this._getUniqueValueInfo(t,s)}getSymbol(t,e){if(this.valueExpression&&null==e?.arcade)return void o.A.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const s=this._getUniqueValueInfo(t,e);return s?.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let s=e;if(this.valueExpression&&null==s?.arcade){const t=await(0,D.l)(),{arcadeUtils:e}=t;e.hasGeometryOperations(this.valueExpression)&&await e.enableGeometryOperations(),s={...s,arcade:t}}const n=this._getUniqueValueInfo(t,s);return n?.symbol||this.defaultSymbol}get symbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables?.reduce(((t,e)=>t+e.getAttributeHash()),"")??""}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),s=this.uniqueValueInfos?.reduce(((t,e)=>t+e.getMeshHash()),"");return`${t}.${e}.${s}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const t=new A({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:(0,r.o8)(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:(0,r.o8)(this.visualVariables),legendOptions:(0,r.o8)(this.legendOptions),authoringInfo:(0,r.o8)(this.authoringInfo),backgroundFillSymbol:(0,r.o8)(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=(0,r.o8)(this.uniqueValueInfos),s=(0,r.o8)(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze((0,r.o8)(this.styleOrigin))),Object.freeze(e),Object.freeze(s)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",s),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const s=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(s)}async collectSymbolFields(t,e){const s=[...this.symbols.map((s=>s.collectRequiredFields(t,e))),(0,f.Dx)(t,e,this.valueExpression)];(0,f.rq)(t,e,this.field),(0,f.rq)(t,e,this.field2),(0,f.rq)(t,e,this.field3),await Promise.all(s)}populateFromStyle(){return(0,R.cF)(this.styleOrigin,{portal:this.portal}).then((t=>{const e=[];return this._valueInfoMap={},t?.data&&Array.isArray(t.data.items)&&t.data.items.forEach((s=>{const n=new F.A({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:s.name});this.defaultSymbol||s.name!==t.data.defaultItem||(this.defaultSymbol=n,this._isDefaultSymbolDerived=!0);const i=new M.A({value:s.name,symbol:n});e.push(i),this._valueInfoMap[z(s.name)]=i})),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",",")}_updateUniqueValues(){null!=this._isInfosSource&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[z(e.value)]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(L);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const s of t)e.push((0,l.wB)((()=>({symbol:s.symbol,value:s.value,label:s.label,description:s.description})),((t,e)=>{t!==e&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)}),{sync:!0}));this.addHandles(e,L)}}_watchUniqueValueGroups(){this.removeHandles(G);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const s of t){e.push((0,l.wB)((()=>({classes:s.classes})),((t,e)=>{t!==e&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}));for(const t of s.classes??[])e.push((0,l.wB)((()=>({symbol:t.symbol,values:t.values,label:t.label,description:t.description})),((t,e)=>{t!==e&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}))}this.addHandles(e,G)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:s,field3:n,fieldDelimiter:i,uniqueValueGroups:r,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!s);for(const l of r)for(const e of l.classes??[]){const{symbol:r,label:o,values:l,description:h}=e;for(const e of l??[]){const{value:l,value2:u,value3:c}=e,m=[l];s&&m.push(u),n&&m.push(c);const d=a?m.join(i||""):m[0]??void 0;t.push(new M.A({symbol:r,label:o,value:d,description:h}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:s,valueExpression:n,fieldDelimiter:i,uniqueValueInfos:r}=this;if(!e&&!n||!r.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!s),a=r.map((t=>{const{symbol:e,label:s,value:n,description:r}=t,[a,l,h]=o?n?.toString()?.split(i||"")||[]:[n];return new I({symbol:e,label:s,description:r,values:[new C({value:a,value2:l,value3:h})]})})),l=[new T({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:s,scale:n,spatialReference:i,arcade:r,timeZone:o}=e??{};let a=this._cache.compiledFunc;const l=r.arcadeUtils;if(!a){const t=l.createSyntaxTree(this.valueExpression);a=l.createFunction(t),this._cache.compiledFunc=a}const h=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:s,scale:n,spatialReference:i}),o));return this._valueInfoMap[z(h)]}_getUnqiueValueInfoForFields(t){const e=this.field,s=t.attributes;let n;if(this.field2){const t=this.field2,i=this.field3,r=[];e&&r.push(s[e]),t&&r.push(s[t]),i&&r.push(s[i]),n=r.join(this.fieldDelimiter||"")}else e&&(n=s[e]);return this._valueInfoMap[z(n)]}static fromPortalStyle(t,e){const s=new A(e?.properties);s._set("styleOrigin",Object.freeze({styleName:t})),s._set("portal",e?.portal||y.A.getDefault());const n=s.populateFromStyle();return n.catch((e=>{o.A.getLogger(this.prototype).error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",e)})),n}static fromStyleUrl(t,e){const s=new A(e?.properties);s._set("styleOrigin",Object.freeze({styleUrl:t}));const n=s.populateFromStyle();return n.catch((e=>{o.A.getLogger(this.prototype).error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",e)})),n}};(0,n._)([(0,h.MZ)({readOnly:!0})],O.prototype,"_cache",null),(0,n._)([(0,c.e)({uniqueValue:"unique-value"})],O.prototype,"type",void 0),(0,n._)([(0,h.MZ)(b.As)],O.prototype,"backgroundFillSymbol",void 0),(0,n._)([(0,h.MZ)({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],O.prototype,"field",null),(0,n._)([(0,u.w)("field")],O.prototype,"castField",null),(0,n._)([(0,g.K)("field")],O.prototype,"writeField",null),(0,n._)([(0,h.MZ)({type:String,value:null,json:{write:!0}})],O.prototype,"field2",null),(0,n._)([(0,h.MZ)({type:String,value:null,json:{write:!0}})],O.prototype,"field3",null),(0,n._)([(0,h.MZ)({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],O.prototype,"orderByClassesEnabled",void 0),(0,n._)([(0,h.MZ)({type:String,value:null,json:{write:!0}})],O.prototype,"valueExpression",null),(0,n._)([(0,h.MZ)({type:String,json:{write:!0}})],O.prototype,"valueExpressionTitle",void 0),(0,n._)([(0,h.MZ)({type:P.A,json:{write:!0}})],O.prototype,"legendOptions",void 0),(0,n._)([(0,h.MZ)({type:String,json:{write:!0}})],O.prototype,"defaultLabel",void 0),(0,n._)([(0,h.MZ)((0,a.$N)({...b.z4},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],O.prototype,"defaultSymbol",null),(0,n._)([(0,h.MZ)({type:String,value:null,json:{write:!0}})],O.prototype,"fieldDelimiter",null),(0,n._)([(0,h.MZ)({type:y.A,readOnly:!0})],O.prototype,"portal",void 0),(0,n._)([(0,m.w)("portal",["styleName"])],O.prototype,"readPortal",null),(0,n._)([(0,h.MZ)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],O.prototype,"styleOrigin",void 0),(0,n._)([(0,m.w)("styleOrigin",["styleName","styleUrl"])],O.prototype,"readStyleOrigin",null),(0,n._)([(0,g.K)("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],O.prototype,"writeStyleOrigin",null),(0,n._)([(0,h.MZ)({type:[T],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,s)=>(e.uniqueValueGroups||function(t){const{field1:e,field2:s,field3:n,fieldDelimiter:i,uniqueValueInfos:r,valueExpression:o}=t,a=!(!e||!s);return[{classes:(r??[]).map((t=>{const{symbol:r,label:l,value:h,description:u}=t,[c,m,d]=a?h?.toString()?.split(i||"")||[]:[h],g=[];return(e||o)&&g.push(c),s&&g.push(m),n&&g.push(d),{symbol:r,label:l,values:[g],description:u}}))}]}(e)).map((t=>T.fromJSON(t,s)))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],O.prototype,"uniqueValueGroups",null),(0,n._)([(0,h.MZ)({type:[M.A],json:{read:!1,write:{isRequired:!0,overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0,isRequired:!0}}}}})],O.prototype,"uniqueValueInfos",null),O=A=(0,n._)([(0,d.$)("esri.renderers.UniqueValueRenderer")],O)},61856:(t,e,s)=>{s.d(e,{h:()=>E});var n=s(66866),i=s(21564),r=(s(39831),s(539)),o=(s(9272),s(75094)),a=s(63863),l=s(77542),h=s(42453),u=s(24909),c=s(8692),m=s(68090),d=s(63926),g=s(57860),p=s(52495),_=s(59851),f=s(68659);const y={color:u.A,size:d.A,opacity:c.A,rotation:m.A},x=new _.J({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),v=/^\[([^\]]+)\]$/i;let b=class extends p.A{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(t){if(this._resetVariables(),t=t?.filter((t=>!!t)),t?.length){for(const e of t)switch(e.type){case"color":this.colorVariables.push(e);break;case"opacity":this.opacityVariables.push(e);break;case"rotation":this.rotationVariables.push(e);break;case"size":this.sizeVariables.push(e)}this.sizeVariables.length&&this.sizeVariables.some((t=>!!t.target))&&t.sort(((t,e)=>{let s=null;return s=t.target===e.target?0:t.target?1:-1,s}));for(let e=0;e<t.length;e++)t[e].index=e;this._set("visualVariables",t)}else this._set("visualVariables",t)}readVariables(t,e,s){const{rotationExpression:n,rotationType:i}=e,o=n?.match(v),a=o?.[1];if(a&&(t||(t=[]),t.push({type:"rotationInfo",rotationType:i,field:a})),t)return t.map((t=>{const e=x.read(t.type),n=y[e];n||(r.A.getLogger(this).warn(`Unknown variable type: ${e}`),s?.messages&&s.messages.push(new f.A("visual-variable:unsupported",`visualVariable of type '${e}' is not supported`,{definition:t,context:s})));const i=new n;return i.read(t,s),i}))}writeVariables(t,e){const s=[];for(const n of t){const t=n.toJSON(e);t&&s.push(t)}return s}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};(0,n._)([(0,i.MZ)()],b.prototype,"visualVariables",null),b=(0,n._)([(0,a.$)("esri.renderers.visualVariables.VisualVariableFactory")],b);var P=s(11868);const S={base:g.A,key:"type",typeMap:{opacity:c.A,color:u.A,rotation:m.A,size:d.A}},E=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new b}set visualVariables(t){this._vvFactory.visualVariables=t,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(t,e,s){return this._vvFactory.readVariables(t,e,s)}writeVisualVariables(t,e,s,n){e[s]=this._vvFactory.writeVariables(t,n)}get arcadeRequiredForVisualVariables(){return this.visualVariables?.some((({arcadeRequired:t})=>t))??!1}hasVisualVariables(t,e){return t?this.getVisualVariablesForType(t,e).length>0:this.getVisualVariablesForType("size",e).length>0||this.getVisualVariablesForType("color",e).length>0||this.getVisualVariablesForType("opacity",e).length>0||this.getVisualVariablesForType("rotation",e).length>0}getVisualVariablesForType(t,e){return this.visualVariables?.filter((s=>s.type===t&&("string"==typeof e?s.target===e:!1!==e||!s.target)))??[]}async collectVVRequiredFields(t,e){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&(0,h.rq)(t,e,n.field),n.normalizationField&&(0,h.rq)(t,e,n.normalizationField),n.valueExpression&&(C(n.valueExpression,t,e)||await(0,h.Dx)(t,e,n.valueExpression)))}};return(0,n._)([(0,i.MZ)({types:[S],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),(0,n._)([(0,o.w)("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),(0,n._)([(0,l.K)("visualVariables")],e.prototype,"writeVisualVariables",null),e=(0,n._)([(0,a.$)("esri.renderers.mixins.VisualVariablesMixin")],e),e};function C(t,e,s){const n=(0,P.D)(t);return null!=n&&((0,h.rq)(e,s,n),!0)}},18443:(t,e,s)=>{s.d(e,{A:()=>R});var n,i=s(66866),r=s(59851),o=s(21877),a=s(19251),l=s(21564),h=s(73446),u=s(75094),c=s(63863);s(39831),s(539),s(9272);let m=n=class extends o.A{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new n({minValue:this.minValue,maxValue:this.maxValue})}};var d;(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],m.prototype,"minValue",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],m.prototype,"maxValue",void 0),m=n=(0,i._)([(0,c.$)("esri.renderers.support.AuthoringInfoClassBreakInfo")],m);let g=d=class extends o.A{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new d({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:(0,a.o8)(this.classBreakInfos)})}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],g.prototype,"field",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],g.prototype,"normalizationField",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],g.prototype,"label",void 0),(0,i._)([(0,l.MZ)({type:[m],json:{write:!0}})],g.prototype,"classBreakInfos",void 0),g=d=(0,i._)([(0,c.$)("esri.renderers.support.AuthoringInfoFieldInfo")],g);var p,_=s(4130);let f=p=class extends o.A{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new p({label:this.label,value:this.value,size:this.size})}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],f.prototype,"label",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],f.prototype,"size",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],f.prototype,"value",void 0),f=p=(0,i._)([(0,c.$)("esri.renderers.support.AuthoringInfoSizeStop")],f);const y=f;var x;const v=new r.J({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),b=new r.J({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),P={key:t=>"number"==typeof t?"number":"string",typeMap:{number:Number,string:String},base:null},S=["high-to-low","above-and-below","centered-on","extremes"],E=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size","spike"])],C=["seconds","minutes","hours","days","months","years"];let w=x=class extends o.A{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return"string"==typeof t||"number"==typeof t?t:null}get normalizationField(){return"reference-size"===this.theme||"spike"===this.theme?this._get("normalizationField"):null}set normalizationField(t){this._set("normalizationField",t)}get referenceSizeScale(){return"reference-size"===this.theme?this._get("referenceSizeScale"):null}set referenceSizeScale(t){this._set("referenceSizeScale",t)}get referenceSizeSymbolStyle(){return"reference-size"===this.theme?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(t){this._set("referenceSizeSymbolStyle",t)}get spikeSymbolStyle(){return"spike"===this.theme?this._get("spikeSymbolStyle"):null}set spikeSymbolStyle(t){this._set("spikeSymbolStyle",t)}castStartTime(t){return"string"==typeof t||"number"==typeof t?t:null}get sizeStops(){return"reference-size"===this.theme||"spike"===this.theme?this._get("sizeStops"):null}set sizeStops(t){this._set("sizeStops",t)}get style(){return"color"===this.type?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new x({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,spikeSymbolStyle:this.spikeSymbolStyle,sizeStops:(0,a.o8)(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};(0,i._)([(0,l.MZ)({types:P,json:{write:!0}})],w.prototype,"endTime",void 0),(0,i._)([(0,_.w)("endTime")],w.prototype,"castEndTime",null),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],w.prototype,"field",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],w.prototype,"maxSliderValue",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],w.prototype,"minSliderValue",void 0),(0,i._)([(0,l.MZ)({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],w.prototype,"normalizationField",null),(0,i._)([(0,l.MZ)({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],w.prototype,"referenceSizeScale",null),(0,i._)([(0,l.MZ)({type:["circle","diamond","hexagon-flat","hexagon-pointy","square"],value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],w.prototype,"referenceSizeSymbolStyle",null),(0,i._)([(0,l.MZ)({type:["triangle-closed-outline","triangle-gradient-fill-closed","triangle-gradient-fill-closed-outline","triangle-gradient-fill-open","triangle-gradient-fill-open-outline","triangle-open-outline","triangle-solid-fill-closed","triangle-solid-fill-closed-outline","triangle-solid-fill-open","triangle-solid-fill-open-outline"],value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],w.prototype,"spikeSymbolStyle",null),(0,i._)([(0,l.MZ)({types:P,json:{write:!0}})],w.prototype,"startTime",void 0),(0,i._)([(0,_.w)("startTime")],w.prototype,"castStartTime",null),(0,i._)([(0,l.MZ)({type:[y],json:{origins:{"web-scene":{write:!1}},write:!0}})],w.prototype,"sizeStops",null),(0,i._)([(0,l.MZ)({type:v.apiValues,value:null,json:{type:v.jsonValues,read:v.read,write:v.write}})],w.prototype,"style",null),(0,i._)([(0,l.MZ)({type:E,value:null,json:{type:E,origins:{"web-scene":{type:S,write:{writer:(t,e)=>{S.includes(t)&&(e.theme=t)}}}},write:!0}})],w.prototype,"theme",null),(0,i._)([(0,l.MZ)({type:b.apiValues,json:{type:b.jsonValues,read:b.read,write:b.write}})],w.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:C,json:{type:C,write:!0}})],w.prototype,"units",void 0),w=x=(0,i._)([(0,c.$)("esri.renderers.support.AuthoringInfoVisualVariable")],w);const I=w;var T,A=s(59740);const M=new r.J({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),D=new r.J({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),N=new r.J({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),F=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers"];let R=T=class extends o.A{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&"relationship"!==e?"class-breaks-size"===e||"class-breaks-color"===e?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?(0,A.r)(t):void 0}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return"flow"===this.type?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&"relationship"!==t&&"class-breaks-size"!==t&&"class-breaks-color"!==t||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;"classed-size"===t?e="class-breaks-size":"classed-color"===t&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new T({classificationMethod:this.classificationMethod,colorRamp:(0,a.o8)(this.colorRamp),fadeRatio:(0,a.o8)(this.fadeRatio),fields:this.fields?.slice(),field1:(0,a.o8)(this.field1),field2:(0,a.o8)(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map((t=>t.clone())),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};(0,i._)([(0,l.MZ)({type:M.apiValues,value:null,json:{type:M.jsonValues,read:M.read,write:M.write,origins:{"web-document":{default:"manual",type:M.jsonValues,read:M.read,write:M.write}}}})],R.prototype,"classificationMethod",null),(0,i._)([(0,l.MZ)({types:A.g,json:{write:!0}})],R.prototype,"colorRamp",void 0),(0,i._)([(0,u.w)("colorRamp")],R.prototype,"readColorRamp",null),(0,i._)([(0,l.MZ)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],R.prototype,"fadeRatio",void 0),(0,i._)([(0,l.MZ)({type:[String],value:null,json:{write:!0}})],R.prototype,"fields",null),(0,i._)([(0,l.MZ)({type:g,value:null,json:{write:!0}})],R.prototype,"field1",null),(0,i._)([(0,l.MZ)({type:g,value:null,json:{write:!0}})],R.prototype,"field2",null),(0,i._)([(0,l.MZ)({type:["flow-line","wave-front"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],R.prototype,"flowTheme",null),(0,i._)([(0,l.MZ)({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],R.prototype,"focus",null),(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],R.prototype,"isAutoGenerated",void 0),(0,i._)([(0,l.MZ)({type:Number,value:null,json:{type:h.jz,write:!0}})],R.prototype,"numClasses",null),(0,i._)([(0,l.MZ)({type:F,json:{type:F,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],R.prototype,"lengthUnit",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],R.prototype,"maxSliderValue",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],R.prototype,"minSliderValue",void 0),(0,i._)([(0,l.MZ)({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],R.prototype,"statistics",null),(0,i._)([(0,l.MZ)({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],R.prototype,"standardDeviationInterval",null),(0,i._)([(0,l.MZ)({type:D.apiValues,value:null,json:{type:D.jsonValues,read:D.read,write:D.write,origins:{"web-scene":{type:N.jsonValues,write:{writer:N.write,overridePolicy:t=>({enabled:"flow"!==t})}}}}})],R.prototype,"type",null),(0,i._)([(0,l.MZ)({type:[I],json:{write:!0}})],R.prototype,"visualVariables",void 0),(0,i._)([(0,l.MZ)({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],R.prototype,"univariateSymbolStyle",null),(0,i._)([(0,l.MZ)({type:["high-to-low","above-and-below","above","below"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],R.prototype,"univariateTheme",null),R=T=(0,i._)([(0,c.$)("esri.renderers.support.AuthoringInfo")],R)},87729:(t,e,s)=>{s.d(e,{A:()=>h});var n,i=s(66866),r=s(21877),o=s(21564),a=(s(39831),s(539),s(9272),s(63863)),l=s(16758);let h=n=class extends r.A{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new n({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],h.prototype,"description",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],h.prototype,"label",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],h.prototype,"minValue",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],h.prototype,"maxValue",void 0),(0,i._)([(0,o.MZ)(l.Wp)],h.prototype,"symbol",void 0),h=n=(0,i._)([(0,a.$)("esri.renderers.support.ClassBreakInfo")],h)},87332:(t,e,s)=>{s.d(e,{n:()=>l});var n=s(98849),i=s(539),r=s(50579),o=s(79005),a=s(46709);class l{static async from(t,e,s){const o=t.dictionary_version?r.R.parse(t.dictionary_version):null,u=new Set(t.itemsNames),c={};if(e)for(const n in e)c[n]=e[n];if(t.authoringInfo.configuration)for(const n of t.authoringInfo.configuration)c.hasOwnProperty(n.name)||(c[n.name]=n.value);const m=new Set(t.authoringInfo.symbol);for(const n of Object.keys(s))m.delete(n);m.size&&i.A.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("missing-fields: fieldMap entries for the following symbol fields are missing",{symbolFields:m});const d=await(0,a.xR)(t.expression,null,c);if(!d)throw new n.A("dictionary-renderer:expression-error","Unable to create dictionary renderer expression");const g=!o||!o.greaterEqual(4,0);g&&i.A.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("Dictionary script does not support native field types. Applying fallback",{version:o});const p=new h(s,g);return new l(g,u,d,p)}constructor(t,e,s,n){this._requiresFieldCoercionToString=t,this._itemNames=e,this._compiled=s,this._reader=n}get itemNames(){return this._itemNames}evaluate(t,e,s,n){try{return this._reader.bind(t,s,n),this._compiled.evaluate(this._reader,{$view:{scale:e}})}catch(r){i.A.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("arcade: dictionary script evaluation failed",{error:r})}return null}createDictionaryFieldsIndex(t){if(!this._requiresFieldCoercionToString)return new o.A(t);const e=t.map((t=>({...t,type:"esriFieldTypeString"})));return new o.A(e)}}class h extends a.Gj{constructor(t,e){super(),this._fieldMap=t,this._requiresFieldCoercionToString=e}_getField(t){const e=this._fieldMap[t]??t;return this._boundSchema.fieldsIndex.get(e)}field(t){if(!this._requiresFieldCoercionToString)return super.field(t,!1);const e=this._getField(t);return null==e||null==this._boundTarget.attributes[e.name]?"":""+this._boundTarget.attributes[e.name]}}},50769:(t,e,s)=>{s.d(e,{A:()=>u});var n,i=s(66866),r=s(96220),o=s(21877),a=s(21564),l=s(73446),h=(s(39831),s(9272),s(63863));let u=n=class extends o.A{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new n({color:this.color&&this.color.clone(),ratio:this.ratio})}};(0,i._)([(0,a.MZ)({type:r.A,json:{type:[l.jz],default:null,write:{isRequired:!0}}})],u.prototype,"color",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:{isRequired:!0}}})],u.prototype,"ratio",void 0),u=n=(0,i._)([(0,h.$)("esri.renderers.support.HeatmapColorStop")],u)},49900:(t,e,s)=>{s.d(e,{A:()=>g});var n,i=s(66866),r=s(24793),o=s(59851),a=s(21877),l=s(21564),h=s(73446),u=(s(39831),s(9272),s(28902)),c=s(63863);const m=(0,o.O)()({ascendingValues:"ascending-values",descendingValues:"descending-values"});let d=n=class extends(r.A.ClonableMixin(a.A)){static from(t){return(0,h.PZ)(n,t)}constructor(t){super(t),this.title=null,this.order=null}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"title",void 0),(0,i._)([(0,u.e)(m)],d.prototype,"order",void 0),d=n=(0,i._)([(0,c.$)("esri.renderers.support.RendererLegendOptions")],d);const g=d},3324:(t,e,s)=>{s.d(e,{A:()=>h});var n,i=s(66866),r=s(21877),o=s(21564),a=(s(39831),s(539),s(9272),s(63863)),l=s(16758);let h=n=class extends r.A{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new n({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${t}`}};(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],h.prototype,"description",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],h.prototype,"label",void 0),(0,i._)([(0,o.MZ)(l.Wp)],h.prototype,"symbol",void 0),(0,i._)([(0,o.MZ)(l.Ug)],h.prototype,"value",void 0),h=n=(0,i._)([(0,a.$)("esri.renderers.support.UniqueValueInfo")],h)},16758:(t,e,s)=>{s.d(e,{As:()=>c,Ug:()=>m,Wp:()=>u,z4:()=>h});var n=s(76724),i=s(61985),r=s(65216),o=s(77441),a=s(57974),l=s(66961);const h={types:l.xK,json:{write:{writer:a.M9},origins:{"web-scene":{types:l.On,write:{writer:a.M9},read:{reader:(0,i.C)({types:l.On})}}}}},u=(0,n.$N)({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},h),c={types:{base:o.A,key:"type",typeMap:{"simple-fill":l.Es.typeMap["simple-fill"],"picture-fill":l.Es.typeMap["picture-fill"],"polygon-3d":l.Es.typeMap["polygon-3d"],cim:l.Es.typeMap.cim}},json:{write:{writer:a.M9},origins:{"web-scene":{type:r.A,write:{writer:a.M9}}}}},m={cast:t=>null==t||"string"==typeof t||"number"==typeof t?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t?.toString()}}}}},27927:(t,e,s)=>{s.d(e,{O3:()=>c,PU:()=>h,YW:()=>d,ex:()=>a,hv:()=>m,zp:()=>l});var n=s(92504),i=s(89882),r=s(2662),o=s(28152);const a=2.4;function l(t){return(0,i.PN)(t*a)}function h(t){return(0,i.Lz)(t)/a}function u(t,e,s,i){let{color:o,ratio:a}=e,{color:l,ratio:h}=s;if(h===a){const t=1e-6;1===h?a-=t:h+=t}const u=(0,n.qE)((i-a)/(h-a),0,1);(0,r.l)(t,o.toArray(),l.toArray(),u)}function c(t){const e=new Uint8ClampedArray(2048);if(t=t.filter((({ratio:t})=>t>=0&&t<=1)).sort(((t,e)=>t.ratio-e.ratio)).map((({color:t,ratio:e})=>({color:t,ratio:Math.max(e,.001)}))),t.length<1)return e;let s=t[0],n=t[0],i=1;const r=(0,o.vt)();for(let o=0;o<512;o++){const a=(o+.5)/512;for(;a>n.ratio&&i<t.length;)s=n,n=t[i++];u(r,s,n,a),e.set(r,4*o)}return e}function m(t,e,s){const n=Math.sqrt(t**2+e**2)/s;return n>1?0:3/(Math.PI*s**2)*(1-n**2)**2}function d(t){return"function"==typeof t?t:t?e=>+e[t]:()=>1}},48887:(t,e,s)=>{s.d(e,{L:()=>l,r:()=>o});var n=s(68659),i=s(61985),r=s(53835);function o(t,e){return l(t,null,e)}const a=(0,i.C)({types:r.Hg});function l(t,e,s){return t?t&&(t.styleName||t.styleUrl)&&"uniqueValue"!==t.type?(s?.messages&&s.messages.push(new n.A("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:s})),null):a(t,e,s):null}},10301:(t,e,s)=>{s.d(e,{j:()=>r});var n=s(92976),i=s(99817);const r={unknown:1,inches:(0,n.oU)(1,"meters","inches"),feet:(0,n.oU)(1,"meters","feet"),"us-feet":(0,n.oU)(1,"meters","us-feet"),yards:(0,n.oU)(1,"meters","yards"),miles:(0,n.oU)(1,"meters","miles"),"nautical-miles":(0,n.oU)(1,"meters","nautical-miles"),millimeters:(0,n.oU)(1,"meters","millimeters"),centimeters:(0,n.oU)(1,"meters","centimeters"),decimeters:(0,n.oU)(1,"meters","decimeters"),meters:(0,n.oU)(1,"meters","meters"),kilometers:(0,n.oU)(1,"meters","kilometers"),"decimal-degrees":1/(0,n.vl)(1,"meters",i.$O.radius)}},21484:(t,e,s)=>{s.d(e,{L:()=>o});var n=s(12690),i=s(40189),r=s(68659);async function o(t,e,s){const o=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(o&&"unique-value"===o.type&&o.styleOrigin){const a=await(0,n.Ke)(o.populateFromStyle());if((0,i.Te)(s),!1===a.ok){const s=a.error;e?.messages&&e.messages.push(new r.A("renderer:style-reference",`Failed to create unique value renderer from style reference: ${s.message}`,{error:s,context:e})),t.clear("renderer",e?.origin)}}}},53835:(t,e,s)=>{s.d(e,{Hg:()=>ut,XJ:()=>ct});var n=s(539),i=s(17671),r=s(66866),o=s(86394),a=s(19251),l=s(21564),h=(s(39831),s(63863)),u=s(77542),c=s(42453),m=s(76589),d=s(61856),g=s(89926),p=s(1171),_=s(96220);class f{static parse(t,e,s){const n=[],i=[],r=t.split(";");for(let o=0;o<r.length;o++){const t=r[o];if(t)if(t.includes("po:")){const e=t.slice(3).split("|");if(3===e.length){const[t,s,n]=e,r=x(t,s,n);r&&i.push(r)}}else if(t.includes("|")){for(const s of t.split("|"))if(e.has(s)){n.push(s);break}}else if(e.has(t))n.push(t);else if(0===o){n.length=0,n.push(v(s));break}}return new f(n,i)}constructor(t,e){this.partNames=t,this.overrides=e}}function y(t,e){if("DashTemplate"===t)return e.split(" ").map((t=>Number(t)));if("Color"===t){const t=new _.A(e).toRgba();return[t[0],t[1],t[2],255*t[3]]}return Number(e)}function x(t,e,s){return{primitiveName:t,propertyName:e,value:y(e,s),defaultValue:null}}function v(t){switch(t){case"esriGeometryPolyline":return"Invalid_L";case"esriGeometryPolygon":return"Invalid_A";default:return"Invalid_P"}}var b=s(87332),P=s(46709),S=s(54394),E=s(50072);const C={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class w{constructor(t,e,s,n){this.url=t,this.fieldMap=s,this.dictionaryInfo=n,this._symbolPartCache=new g.q(100);this._evaluator=(async()=>b.n.from(await n,e,s))()}async getSymbolAsync(t,e,s=!0){const n=await this._evaluator,i=e?.fields??(0,P.lL)(t.attributes),r=n.createDictionaryFieldsIndex(i),o=n.evaluate(t,e?.scale??0,r,e?.spatialReference);if(null==o)return null;const a=(0,p.$B)(t.geometry),l=f.parse(o,n.itemNames,a),h="esriGeometryPoint"===a&&!t.geometry?.hasZ;return await this._cimPartsToCIMSymbol(t,l.partNames,l.overrides,h,e,s,r)}async getSymbolForControlString(t,e,s){const n=await this._evaluator,i=f.parse(t,n.itemNames,e),r="esriGeometryPoint"===e&&!s,o=I(await Promise.all(i.partNames.map((t=>this._getSymbolPart(t)))),i.overrides,r);return new S.A({data:o})}async _cimPartsToCIMSymbol(t,e,n,i,r,o,l){const h=e.map((t=>this._getSymbolPart(t,r)));let u=await Promise.all(h);if(o&&this.fieldMap&&u.length>0){const{OverrideHelper:e}=await Promise.all([s.e(2076),s.e(7125)]).then(s.bind(s,17125));u=(0,a.o8)(u);for(const s of u)e.applyDictionaryTextOverrides(s,t,this.fieldMap,l,(0,E.bs)(s))}const c=I(u,n,i);return new S.A({data:c})}async _fetchSymbolPart(t,e){const s=await this.dictionaryInfo,n=(this.url+"/"+s.cimRefTemplateUrl).replaceAll(/\{itemName\}/gi,t),{data:i}=await(0,o.A)(n,{responseType:"json",query:{f:"json"},...e});return i}async _getSymbolPart(t,e){let s=this._symbolPartCache.get(t);return s||(s=this._fetchSymbolPart(t,e),this._symbolPartCache.put(t,s)),s}}function I(t,e,s){if(!t||0===t.length)return null;const n={...t[0]};if(t.length>1){n.effects=null,n.symbolLayers=[];for(const e of t){const t=e;if(null!=t.effects)for(const e of t.symbolLayers)null==e.effects?e.effects=t.effects:e.effects.unshift(...t.effects);n.symbolLayers.unshift(...t.symbolLayers)}}return s&&(n.callout=C),{type:"CIMSymbolReference",symbol:n,primitiveOverrides:e}}var T;let A=T=class extends((0,d.h)(m.A)){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){const t=this.getDictionaryInfo();return new w(this.url,this.config,this.fieldMap??{},t)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,s,n){n?.origin||super.writeVisualVariables(t,e,s,n)}clone(){return new T({config:(0,a.o8)(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:(0,a.o8)(this.fieldMap),url:(0,a.o8)(this.url),visualVariables:(0,a.o8)(this.visualVariables)})}async getSymbolAsync(t,e,s=!0){return this._loader.getSymbolAsync(t,e,s)}async getSymbolForControlString(t,e,s){return this._loader.getSymbolForControlString(t,e,s)}getDictionaryInfo(){return this._dictionaryInfoPromise||(this._dictionaryInfoPromise=this._fetchDictionaryInfo()),this._dictionaryInfoPromise}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await(0,c.Dx)(t,e,this.scaleExpression);for(const s in this.fieldMap){const n=this.fieldMap[s];e.has(n)&&t.add(n)}}get arcadeRequired(){return!0}getSymbol(){return null}get symbols(){return[]}getAttributeHash(){return this.visualVariables?.reduce(((t,e)=>t+e.getAttributeHash()),"")??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}async _fetchDictionaryInfo(){const{data:t}=await(0,o.A)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"}});return t}};(0,r._)([(0,l.MZ)({type:w})],A.prototype,"_loader",null),(0,r._)([(0,l.MZ)({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],A.prototype,"config",void 0),(0,r._)([(0,l.MZ)({type:Object,json:{write:!0}})],A.prototype,"fieldMap",void 0),(0,r._)([(0,l.MZ)({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],A.prototype,"scaleExpression",void 0),(0,r._)([(0,u.K)("scaleExpression")],A.prototype,"writeData",null),(0,r._)([(0,l.MZ)({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],A.prototype,"scaleExpressionTitle",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],A.prototype,"url",void 0),(0,r._)([(0,u.K)("visualVariables")],A.prototype,"writeVisualVariables",null),A=T=(0,r._)([(0,h.$)("esri.renderers.DictionaryRenderer")],A);var M,D=s(28902),N=s(21877),F=s(4130),R=(s(9272),s(73446));let k=M=class extends N.A{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return null==t?t:"function"==typeof t?(n.A.getLogger(this).error(".field: field must be a string value"),null):(0,R.GX)(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new M({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,r._)([(0,l.MZ)({type:_.A,json:{type:[Number],write:!0}})],k.prototype,"color",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],k.prototype,"field",void 0),(0,r._)([(0,F.w)("field")],k.prototype,"castField",null),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],k.prototype,"label",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],k.prototype,"valueExpression",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],k.prototype,"valueExpressionTitle",void 0),k=M=(0,r._)([(0,h.$)("esri.renderers.support.AttributeColorInfo")],k);const L=k;var G;let V=G=class extends N.A{constructor(){super(...arguments),this.unit=null}clone(){return new G({unit:this.unit})}};(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],V.prototype,"unit",void 0),V=G=(0,r._)([(0,h.$)("esri.renderers.support.DotDensityLegendOptions")],V);const z=V;var O,q=s(68882),B=s(40241);let Y=O=class extends((0,d.h)(m.A)){constructor(t){super(t),this.attributes=null,this.backgroundColor=new _.A([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new B.A,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(null==this.referenceScale)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new q.A({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce(((t,e)=>t+e.getAttributeHash()),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new O({attributes:(0,a.o8)(this.attributes),backgroundColor:(0,a.o8)(this.backgroundColor),dotBlendingEnabled:(0,a.o8)(this.dotBlendingEnabled),dotShape:(0,a.o8)(this.dotShape),dotSize:(0,a.o8)(this.dotSize),dotValue:(0,a.o8)(this.dotValue),legendOptions:(0,a.o8)(this.legendOptions),outline:(0,a.o8)(this.outline),referenceScale:(0,a.o8)(this.referenceScale),seed:(0,a.o8)(this.seed),visualVariables:(0,a.o8)(this.visualVariables),authoringInfo:(0,a.o8)(this.authoringInfo)})}getControllerHash(){const t=this.attributes?.map((t=>t.field||t.valueExpression||""));return`${t}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const s of this.attributes??[])s.valueExpression&&await(0,c.Dx)(t,e,s.valueExpression),s.field&&t.add(s.field)}};(0,r._)([(0,l.MZ)({type:[L],json:{write:!0}})],Y.prototype,"attributes",void 0),(0,r._)([(0,l.MZ)({type:_.A,json:{write:!0}})],Y.prototype,"backgroundColor",void 0),(0,r._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],Y.prototype,"dotBlendingEnabled",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!1}})],Y.prototype,"dotShape",void 0),(0,r._)([(0,l.MZ)({type:Number,json:{write:!0}})],Y.prototype,"dotSize",void 0),(0,r._)([(0,l.MZ)({type:z,json:{write:!0}})],Y.prototype,"legendOptions",void 0),(0,r._)([(0,l.MZ)({type:B.A,json:{default:null,write:!0}})],Y.prototype,"outline",void 0),(0,r._)([(0,l.MZ)({type:Number,json:{write:!0}})],Y.prototype,"dotValue",void 0),(0,r._)([(0,l.MZ)({type:Number,json:{write:!0}})],Y.prototype,"referenceScale",void 0),(0,r._)([(0,l.MZ)({type:Number,json:{write:!0}})],Y.prototype,"seed",void 0),(0,r._)([(0,D.e)({dotDensity:"dot-density"})],Y.prototype,"type",void 0),Y=O=(0,r._)([(0,h.$)("esri.renderers.DotDensityRenderer")],Y);var U=s(89882),H=s(18443),X=s(50769),j=s(24793);let Z=class extends(j.A.ClonableMixin(N.A)){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],Z.prototype,"minLabel",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],Z.prototype,"maxLabel",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],Z.prototype,"title",void 0),Z=(0,r._)([(0,h.$)("esri.renderers.support.HeatmapLegendOptions")],Z);var W,$=s(27927),K=s(23369);function Q(t){if(null!=t){const{maxDensity:e,minDensity:s,radius:n}=t;if(null!=e||null!=s||null!=n){const{blurRadius:e,maxPixelIntensity:s,minPixelIntensity:n,...i}=t;return i}}return t}let J=W=class extends m.A{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new X.A({ratio:0,color:new _.A("rgba(255, 140, 0, 0)")}),new X.A({ratio:.75,color:new _.A("rgba(255, 140, 0, 1)")}),new X.A({ratio:.9,color:new _.A("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(t){return Q(t)}get blurRadius(){return(0,$.PU)(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,s=this.minPixelIntensity;this._set("radius",(0,$.zp)(t)),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",s*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/($.ex**2*this.blurRadius**4)}read(t,e){t=Q(t),super.read(t,e)}getSymbol(){return new K.A}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const s=this.field,n=this.valueExpression;s&&"string"==typeof s&&(0,c.rq)(t,e,s),n&&"string"==typeof n&&await(0,c.Dx)(t,e,n)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new W({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:(0,a.o8)(this.colorStops),field:this.field,legendOptions:(0,a.o8)(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,r._)([(0,l.MZ)({type:H.A,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],J.prototype,"authoringInfo",void 0),(0,r._)([(0,l.MZ)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],J.prototype,"blurRadius",null),(0,r._)([(0,l.MZ)({type:[X.A],json:{write:{isRequired:!0}}})],J.prototype,"colorStops",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],J.prototype,"field",void 0),(0,r._)([(0,l.MZ)({type:Z,json:{write:!0}})],J.prototype,"legendOptions",void 0),(0,r._)([(0,l.MZ)({type:Number,json:{write:!0}})],J.prototype,"maxDensity",void 0),(0,r._)([(0,l.MZ)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],J.prototype,"maxPixelIntensity",null),(0,r._)([(0,l.MZ)({type:Number,json:{write:!0}})],J.prototype,"minDensity",void 0),(0,r._)([(0,l.MZ)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],J.prototype,"minPixelIntensity",null),(0,r._)([(0,l.MZ)({type:Number,cast:U.cr,json:{write:!0}})],J.prototype,"radius",void 0),(0,r._)([(0,l.MZ)({type:Number,range:{min:0},json:{default:0,write:!0}})],J.prototype,"referenceScale",void 0),(0,r._)([(0,D.e)({heatmap:"heatmap"})],J.prototype,"type",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],J.prototype,"valueExpression",void 0),(0,r._)([(0,l.MZ)({type:String})],J.prototype,"valueExpressionTitle",void 0),(0,r._)([(0,l.MZ)({readOnly:!0})],J.prototype,"_pixelIntensityToDensity",null),J=W=(0,r._)([(0,h.$)("esri.renderers.HeatmapRenderer")],J);var tt=s(85569),et=s(16758);let st=class extends(j.A.ClonableMixin(N.A)){constructor(){super(...arguments),this.color=new _.A([0,0,0,0]),this.label=null,this.threshold=0}};(0,r._)([(0,l.MZ)({type:_.A,json:{write:!0}})],st.prototype,"color",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],st.prototype,"label",void 0),(0,r._)([(0,l.MZ)({type:Number,range:{min:0,max:1},json:{write:!0}})],st.prototype,"threshold",void 0),st=(0,r._)([(0,h.$)("esri.renderers.support.OthersCategory")],st);var nt=s(49900),it=s(8692),rt=s(63926);const ot={base:s(57860).A,key:"type",typeMap:{size:rt.A,opacity:it.A}};let at=class extends((0,d.h)(j.A.ClonableMixin(m.A))){constructor(t){super(t),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new _.A([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new st,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){return new K.A({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(tt.Ru)}getAttributeHash(){return this.visualVariables?.reduce(((t,e)=>t+e.getAttributeHash()),"")??""}getMeshHash(){return this.symbols.reduce(((t,e)=>t+JSON.stringify(e)),"")}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const s of this.attributes)s.valueExpression&&await(0,c.Dx)(t,e,s.valueExpression),s.field&&t.add(s.field)}};(0,r._)([(0,l.MZ)({type:[L],json:{write:!0}})],at.prototype,"attributes",void 0),(0,r._)([(0,l.MZ)(et.As)],at.prototype,"backgroundFillSymbol",void 0),(0,r._)([(0,l.MZ)({type:_.A,json:{write:!0}})],at.prototype,"defaultColor",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],at.prototype,"defaultLabel",void 0),(0,r._)([(0,l.MZ)({type:Number,range:{min:0,max:1},json:{write:!0}})],at.prototype,"holePercentage",void 0),(0,r._)([(0,l.MZ)({type:st,json:{write:!0}})],at.prototype,"othersCategory",void 0),(0,r._)([(0,l.MZ)({type:nt.A,json:{write:!0}})],at.prototype,"legendOptions",void 0),(0,r._)([(0,l.MZ)({type:B.A,json:{default:null,write:!0}})],at.prototype,"outline",void 0),(0,r._)([(0,l.MZ)({type:Number,cast:U.cr,json:{write:!0}})],at.prototype,"size",void 0),(0,r._)([(0,D.e)({pieChart:"pie-chart"})],at.prototype,"type",void 0),(0,r._)([(0,l.MZ)({types:[ot]})],at.prototype,"visualVariables",void 0),at=(0,r._)([(0,h.$)("esri.renderers.PieChartRenderer")],at);var lt=s(47347),ht=s(2692);const ut={key:"type",base:m.A,typeMap:{heatmap:J,simple:lt.A,"unique-value":ht.A,"class-breaks":i.A,"dot-density":Y,dictionary:A,"pie-chart":at},errorContext:"renderer"},ct={key:"type",base:m.A,typeMap:{simple:lt.A,"unique-value":ht.A,"class-breaks":i.A,heatmap:J},errorContext:"renderer",validate:function(t){switch(t.type){case"simple":return function(t){if(t.symbol)return t;n.A.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}(t);case"unique-value":return function(t){const e=t.uniqueValueInfos,s=e?.filter((({symbol:t,label:e},s)=>(t||n.A.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${s}] ${e}) without a symbol from web scene.`),!!t)));return s?.length!==e?.length&&(t.uniqueValueInfos=s),t}(t);case"class-breaks":return function(t){const e=t.classBreakInfos,s=e?.filter((({symbol:t,label:e},s)=>(t||n.A.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${s}] ${e}) without a symbol from web scene.`),!!t)));return s?.length!==e?.length&&(t.classBreakInfos=s),t}(t);case"heatmap":return t}}}},24909:(t,e,s)=>{s.d(e,{A:()=>h});var n,i=s(66866),r=s(21564),o=(s(39831),s(539),s(9272),s(63863)),a=s(57860),l=s(5001);let h=n=class extends a.A{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter((t=>!!t))).sort(((t,e)=>t.value-e.value)),this._set("stops",t)}clone(){return new n({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((t=>t.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((t=>t.value||0))}};(0,i._)([(0,r.MZ)({readOnly:!0})],h.prototype,"cache",null),(0,i._)([(0,r.MZ)({type:["color"],json:{type:["colorInfo"]}})],h.prototype,"type",void 0),(0,i._)([(0,r.MZ)({type:String,json:{write:!0}})],h.prototype,"normalizationField",void 0),(0,i._)([(0,r.MZ)({type:[l.A],json:{write:!0}})],h.prototype,"stops",null),h=n=(0,i._)([(0,o.$)("esri.renderers.visualVariables.ColorVariable")],h)},8692:(t,e,s)=>{s.d(e,{A:()=>_});var n,i=s(66866),r=s(21564),o=(s(39831),s(539),s(9272),s(63863)),a=s(57860),l=s(21877),h=s(73446),u=s(75094),c=s(77542),m=s(48904);let d=n=class extends l.A{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return(0,m.D)(e.transparency)}writeOpacity(t,e,s){e[s]=(0,m.p)(t)}clone(){return new n({label:this.label,opacity:this.opacity,value:this.value})}};(0,i._)([(0,r.MZ)({type:String,json:{write:!0}})],d.prototype,"label",void 0),(0,i._)([(0,r.MZ)({type:Number,json:{type:h.jz,write:{target:"transparency",isRequired:!0}}})],d.prototype,"opacity",void 0),(0,i._)([(0,u.w)("opacity",["transparency"])],d.prototype,"readOpacity",null),(0,i._)([(0,c.K)("opacity")],d.prototype,"writeOpacity",null),(0,i._)([(0,r.MZ)({type:Number,json:{write:{isRequired:!0}}})],d.prototype,"value",void 0),d=n=(0,i._)([(0,o.$)("esri.renderers.visualVariables.support.OpacityStop")],d);const g=d;var p;let _=p=class extends a.A{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter((t=>!!t))).sort(((t,e)=>t.value-e.value)),this._set("stops",t)}clone(){return new p({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((t=>t.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((t=>t.value||0))}};(0,i._)([(0,r.MZ)({readOnly:!0})],_.prototype,"cache",null),(0,i._)([(0,r.MZ)({type:["opacity"],json:{type:["transparencyInfo"]}})],_.prototype,"type",void 0),(0,i._)([(0,r.MZ)({type:String,json:{write:!0}})],_.prototype,"normalizationField",void 0),(0,i._)([(0,r.MZ)({type:[g],json:{write:!0}})],_.prototype,"stops",null),_=p=(0,i._)([(0,o.$)("esri.renderers.visualVariables.OpacityVariable")],_)},68090:(t,e,s)=>{s.d(e,{A:()=>l});var n,i=s(66866),r=s(21564),o=(s(39831),s(539),s(9272),s(63863)),a=s(57860);let l=n=class extends a.A{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic"}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}clone(){return new n({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};(0,i._)([(0,r.MZ)({readOnly:!0})],l.prototype,"cache",null),(0,i._)([(0,r.MZ)({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],l.prototype,"axis",void 0),(0,i._)([(0,r.MZ)({type:["rotation"],json:{type:["rotationInfo"]}})],l.prototype,"type",void 0),(0,i._)([(0,r.MZ)({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],l.prototype,"rotationType",void 0),l=n=(0,i._)([(0,o.$)("esri.renderers.visualVariables.RotationVariable")],l)},63926:(t,e,s)=>{s.d(e,{A:()=>S});var n=s(66866),i=s(98849),r=s(59851),o=s(539),a=s(21564),l=s(4130),h=s(75094),u=s(63863),c=s(77542),m=s(57860),d=s(89882);var g,p=s(68745),_=s(82140),f=s(99412),y=s(28479);const x=new r.J({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),v=new r.J({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});function b(t){if(null!=t)return"string"==typeof t||"number"==typeof t?function(t){return(0,d.cr)(t)}(t):"size"===t.type?(0,f.of)(t)?t:(delete(t={...t}).type,new S(t)):void 0}function P(t,e,s){if("object"!=typeof t)return t;const n=new S;return n.read(t,s),n}let S=g=class extends m.A{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:null!=this.valueExpression&&y.viewScaleRE.test(this.valueExpression)}}set index(t){(0,f.of)(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),(0,f.of)(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return(0,f.eh)(this)}set maxDataValue(t){t&&this.stops&&(o.A.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(o.A.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return b(t)}readMaxSize(t,e,s){return P(t,0,s)}set minDataValue(t){t&&this.stops&&(o.A.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(o.A.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return b(t)}readMinSize(t,e,s){return P(t,0,s)}get arcadeRequired(){return!!this.valueExpression||null!=this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||null!=this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(t){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?t&&Array.isArray(t)&&(t=t.filter((t=>!!t))).sort(((t,e)=>t.value-e.value)):t&&(o.A.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return(0,f.KZ)(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,s,n){if("$view.scale"===t){if(n?.messages){const t=this.index,e="string"==typeof t?t:`visualVariables[${t}]`;n.messages.push(new i.A("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:e+".valueExpression",context:n}))}}else e[s]=t}readValueUnit(t){return t?v.read(t):null}clone(){return new g({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,f.of)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,f.of)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map((t=>t.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType===f._w.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===f._w.Stops){const t=this.stops;if(!t)return this;const e=t.map((t=>t.size)).reverse(),s=t.length;for(let n=0;n<s;n++)t[n].size=e[n];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map((t=>t.value||0))}};(0,n._)([(0,a.MZ)({readOnly:!0})],S.prototype,"cache",null),(0,n._)([(0,a.MZ)({type:x.apiValues,json:{type:x.jsonValues,origins:{"web-map":{read:!1}},read:x.read,write:x.write}})],S.prototype,"axis",void 0),(0,n._)([(0,a.MZ)()],S.prototype,"index",null),(0,n._)([(0,a.MZ)({type:String,readOnly:!0})],S.prototype,"inputValueType",null),(0,n._)([(0,a.MZ)({type:_.A,json:{write:!0}})],S.prototype,"legendOptions",void 0),(0,n._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],S.prototype,"maxDataValue",null),(0,n._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],S.prototype,"maxSize",null),(0,n._)([(0,l.w)("maxSize")],S.prototype,"castMaxSize",null),(0,n._)([(0,h.w)("maxSize")],S.prototype,"readMaxSize",null),(0,n._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],S.prototype,"minDataValue",null),(0,n._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],S.prototype,"minSize",null),(0,n._)([(0,l.w)("minSize")],S.prototype,"castMinSize",null),(0,n._)([(0,h.w)("minSize")],S.prototype,"readMinSize",null),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],S.prototype,"normalizationField",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],S.prototype,"arcadeRequired",null),(0,n._)([(0,a.MZ)({type:String})],S.prototype,"scaleBy",void 0),(0,n._)([(0,a.MZ)({type:[p.A],value:null,json:{write:!0}})],S.prototype,"stops",null),(0,n._)([(0,a.MZ)({type:["outline"],json:{write:!0}})],S.prototype,"target",void 0),(0,n._)([(0,a.MZ)({type:String,readOnly:!0})],S.prototype,"transformationType",null),(0,n._)([(0,a.MZ)({type:["size"],json:{type:["sizeInfo"]}})],S.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],S.prototype,"useSymbolValue",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],S.prototype,"valueExpression",void 0),(0,n._)([(0,h.w)("valueExpression",["valueExpression","expression"])],S.prototype,"readValueExpression",null),(0,n._)([(0,c.K)("web-scene","valueExpression")],S.prototype,"writeValueExpressionWebScene",null),(0,n._)([(0,a.MZ)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],S.prototype,"valueRepresentation",void 0),(0,n._)([(0,a.MZ)({type:v.apiValues,json:{write:v.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],S.prototype,"valueUnit",void 0),(0,n._)([(0,h.w)("valueUnit")],S.prototype,"readValueUnit",null),S=g=(0,n._)([(0,u.$)("esri.renderers.visualVariables.SizeVariable")],S)},57860:(t,e,s)=>{s.d(e,{A:()=>d});var n=s(66866),i=s(59851),r=s(21877),o=s(539),a=s(21564),l=s(4130),h=s(63863),u=s(73446),c=s(45327);const m=new i.J({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let d=class extends r.A{constructor(t){super(t),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(t){return null==t?t:"function"==typeof t?(o.A.getLogger(this).error(".field: field must be a string value"),null):(0,u.GX)(t)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};(0,n._)([(0,a.MZ)()],d.prototype,"index",void 0),(0,n._)([(0,a.MZ)({type:m.apiValues,readOnly:!0,json:{read:m.read,write:{writer:m.write,isRequired:!0}}})],d.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],d.prototype,"field",void 0),(0,n._)([(0,l.w)("field")],d.prototype,"castField",null),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],d.prototype,"valueExpression",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],d.prototype,"valueExpressionTitle",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],d.prototype,"arcadeRequired",null),(0,n._)([(0,a.MZ)({type:c.A,json:{write:!0}})],d.prototype,"legendOptions",void 0),d=(0,n._)([(0,h.$)("esri.renderers.visualVariables.VisualVariable")],d)},5001:(t,e,s)=>{s.d(e,{A:()=>m});var n,i=s(66866),r=s(96220),o=s(21877),a=s(21564),l=s(73446),h=(s(39831),s(9272),s(63863)),u=s(77542);let c=n=class extends o.A{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,s){e[s]=t??0}clone(){return new n({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};(0,i._)([(0,a.MZ)({type:r.A,json:{type:[l.jz],write:{isRequired:!0}}})],c.prototype,"color",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"label",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],c.prototype,"value",void 0),(0,i._)([(0,u.K)("value")],c.prototype,"writeValue",null),c=n=(0,i._)([(0,h.$)("esri.renderers.visualVariables.support.ColorStop")],c);const m=c},68745:(t,e,s)=>{s.d(e,{A:()=>h});var n,i=s(66866),r=s(21877),o=s(89882),a=s(21564),l=(s(39831),s(539),s(9272),s(63863));let h=n=class extends r.A{constructor(t){super(t),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new n({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],h.prototype,"label",void 0),(0,i._)([(0,a.MZ)({type:Number,cast:o.cr,json:{write:{isRequired:!0}}})],h.prototype,"size",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:{isRequired:!0}}})],h.prototype,"value",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!1}})],h.prototype,"useMinValue",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!1}})],h.prototype,"useMaxValue",void 0),h=n=(0,i._)([(0,l.$)("esri.renderers.visualVariables.support.SizeStop")],h)},82140:(t,e,s)=>{s.d(e,{A:()=>l});var n=s(66866),i=s(21564),r=(s(39831),s(539),s(9272),s(63863)),o=s(45327);let a=class extends o.A{constructor(){super(...arguments),this.customValues=null}};(0,n._)([(0,i.MZ)({type:[Number],json:{write:!0}})],a.prototype,"customValues",void 0),a=(0,n._)([(0,r.$)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],a);const l=a},45327:(t,e,s)=>{s.d(e,{A:()=>h});var n=s(66866),i=s(24793),r=s(21877),o=s(21564),a=(s(39831),s(539),s(9272),s(63863));let l=class extends(i.A.ClonableMixin(r.A)){constructor(){super(...arguments),this.showLegend=null,this.title=null}};(0,n._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],l.prototype,"showLegend",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=(0,n._)([(0,a.$)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l);const h=l},99412:(t,e,s)=>{var n,i;function r(t){return t&&"esri.renderers.visualVariables.SizeVariable"===t.declaredClass}function o(t){return null!=t&&!isNaN(t)&&isFinite(t)}function a(t){return t.valueExpression?n.Expression:t.field&&"string"==typeof t.field?n.Field:n.Unknown}function l(t,e){const s=e||a(t),r=t.valueUnit||"unknown";return s===n.Unknown?i.Constant:t.stops?i.Stops:null!=t.minSize&&null!=t.maxSize&&null!=t.minDataValue&&null!=t.maxDataValue?i.ClampedLinear:"unknown"===r?null!=t.minSize&&null!=t.minDataValue?t.minSize&&t.minDataValue?i.Proportional:i.Additive:i.Identity:i.RealWorldSize}s.d(e,{KZ:()=>l,Yf:()=>n,_w:()=>i,eh:()=>a,gf:()=>o,of:()=>r}),function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"}(n||(n={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(i||(i={}))},28479:(t,e,s)=>{s.r(e),s.d(e,{getAllSizes:()=>C,getColor:()=>p,getOpacity:()=>_,getRotationAngle:()=>f,getSize:()=>y,getSizeForValue:()=>b,getSizeFromNumberOrVariable:()=>x,getSizeRangeAtScale:()=>P,getVisualVariableValues:()=>S,viewScaleRE:()=>g});var n=s(96220),i=s(25707),r=s(73345),o=s(539),a=s(10301),l=s(99412);const h=()=>o.A.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),u=t=>h().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${t}`),c=()=>h().error("Use of arcade expressions requires an arcade context"),m=new i.A,d=Math.PI,g=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function p(t,e,s){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find((t=>"color"===t.type)):t;if(!i)return;if("esri.renderers.visualVariables.ColorVariable"!==i.declaredClass)return void u("ColorVariable");const r="number"==typeof e,o=r?null:e,a=o?.attributes;let h=r?e:null;const m=i.field,{ipData:d,hasExpression:g}=i.cache;let p=i.cache.compiledFunc;if(!m&&!g){const t=i.stops;return t&&t[0]&&t[0].color}if("number"!=typeof h)if(g){if(null==s?.arcade)return void c();const t={viewingMode:s.viewingMode,scale:s.scale,spatialReference:s.spatialReference},e=s.arcade.arcadeUtils,n=e.getViewInfo(t),r=e.createExecContext(o,n,s.timeZone);if(!p){const t=e.createSyntaxTree(i.valueExpression);p=e.createFunction(t),i.cache.compiledFunc=p}h=e.executeFunction(p,r)}else a&&(h=a[m]);const _=i.normalizationField,f=null!=a&&null!=_?parseFloat(a[_]):void 0;if(null!=h&&(!_||r||!isNaN(f)&&0!==f)){(0,l.gf)(f)&&!r&&(h/=f);const t=E(h,d);if(t){const e=t[0],r=t[1],o=e===r?i.stops[e].color:n.A.blendColors(i.stops[e].color,i.stops[r].color,t[2],null!=s?s.color:void 0);return new n.A(o)}}}function _(t,e,s){const n="visualVariables"in t&&t.visualVariables?t.visualVariables.find((t=>"opacity"===t.type)):t;if(!n)return;if("esri.renderers.visualVariables.OpacityVariable"!==n.declaredClass)return void u("OpacityVariable");const i="number"==typeof e,r=i?null:e,o=r?.attributes;let a=i?e:null;const h=n.field,{ipData:m,hasExpression:d}=n.cache;let g=n.cache.compiledFunc;if(!h&&!d){const t=n.stops;return t&&t[0]&&t[0].opacity}if("number"!=typeof a)if(d){if(null==s?.arcade)return void c();const t={viewingMode:s.viewingMode,scale:s.scale,spatialReference:s.spatialReference},e=s.arcade.arcadeUtils,i=e.getViewInfo(t),o=e.createExecContext(r,i,s.timeZone);if(!g){const t=e.createSyntaxTree(n.valueExpression);g=e.createFunction(t),n.cache.compiledFunc=g}a=e.executeFunction(g,o)}else o&&(a=o[h]);const p=n.normalizationField,_=null!=o&&null!=p?parseFloat(o[p]):void 0;if(null!=a&&(!p||i||!isNaN(_)&&0!==_)){(0,l.gf)(_)&&!i&&(a/=_);const t=E(a,m);if(t){const e=t[0],s=t[1];if(e===s)return n.stops[e].opacity;{const i=n.stops[e].opacity;return i+(n.stops[s].opacity-i)*t[2]}}}}function f(t,e,s){const n="visualVariables"in t&&t.visualVariables?t.visualVariables.find((t=>"rotation"===t.type)):t;if(!n)return;if("esri.renderers.visualVariables.RotationVariable"!==n.declaredClass)return void u("RotationVariable");const i=n.axis||"heading",r="heading"===i&&"arithmetic"===n.rotationType?90:0,o="heading"===i&&"arithmetic"===n.rotationType?-1:1,a="number"==typeof e?null:e,l=a?.attributes,h=n.field,{hasExpression:m}=n.cache;let d=n.cache.compiledFunc,g=null;if(!h&&!m)return g;if(m){if(null==s?.arcade)return void c();const t={viewingMode:s.viewingMode,scale:s.scale,spatialReference:s.spatialReference},e=s.arcade.arcadeUtils,i=e.getViewInfo(t),r=e.createExecContext(a,i,s.timeZone);if(!d){const t=e.createSyntaxTree(n.valueExpression);d=e.createFunction(t),n.cache.compiledFunc=d}g=e.executeFunction(d,r)}else l&&(g=l[h]);return g="number"!=typeof g||isNaN(g)?null:r+o*g,g}function y(t,e,s){const n="visualVariables"in t&&t.visualVariables?t.visualVariables.find((t=>"size"===t.type)):t;if(!n)return;if("esri.renderers.visualVariables.SizeVariable"!==n.declaredClass)return void u("SizeVariable");const i=b(function(t,e,s){const n="number"==typeof e,i=n?null:e,r=i?.attributes;let o=n?e:null;const{isScaleDriven:a}=t.cache;let h=t.cache.compiledFunc;if(a){const e=null!=s?s.scale:void 0,n=null!=s?s.view:void 0;o=null==e||"3d"===n?function(t){let e=null,s=null;const n=t.stops;return n?(e=n[0].value,s=n[n.length-1].value):(e=t.minDataValue||0,s=t.maxDataValue||0),(e+s)/2}(t):e}else if(!n)switch(t.inputValueType){case l.Yf.Expression:{if(null==s?.arcade)return void c();const e={viewingMode:s.viewingMode,scale:s.scale,spatialReference:s.spatialReference},n=s.arcade.arcadeUtils,r=n.getViewInfo(e),a=n.createExecContext(i,r,s.timeZone);if(!h){const e=n.createSyntaxTree(t.valueExpression);h=n.createFunction(e),t.cache.compiledFunc=h}o=n.executeFunction(h,a);break}case l.Yf.Field:r&&(o=r[t.field]);break;case l.Yf.Unknown:o=null}if(!(0,l.gf)(o))return null;if(n||!t.normalizationField)return o;const u=r?parseFloat(r[t.normalizationField]):null;return(0,l.gf)(u)&&0!==u?o/u:null}(n,e,s),n,e,s,n.cache.ipData);return null==i||isNaN(i)?void 0:i}function x(t,e,s){return null==t?null:(0,l.of)(t)?y(t,e,s):(0,l.gf)(t)?t:null}function v(t,e,s){return(0,l.gf)(s)&&t>s?s:(0,l.gf)(e)&&t<e?e:t}function b(t,e,s,n,i){switch(e.transformationType){case l._w.Additive:return function(t,e,s,n){const i=x(e.minSize,s,n)||e.minDataValue;return null==t&&null==i?null:(t??0)+(i??0)}(t,e,s,n);case l._w.Constant:return function(t,e,s){const n=t.stops;let i=n?.length&&n[0].size;return null==i&&(i=t.minSize),x(i,e,s)}(e,s,n);case l._w.ClampedLinear:return function(t,e,s,n){const i=x(e.minSize,s,n);if(null==t)return i;const{minDataValue:r,maxDataValue:o}=e;if(null==r||null==o)return null;const a=(t-r)/(o-r),l=x(e.maxSize,s,n),h=null!=n?n.shape:void 0;if(t<=r)return i;if(t>=o)return l;if(null==i||null==l)return null;if("area"===e.scaleBy&&h){const t="circle"===h,e=t?d*(i/2)**2:i*i,s=e+a*((t?d*(l/2)**2:l*l)-e);return t?2*Math.sqrt(s/d):Math.sqrt(s)}return i+a*(l-i)}(t,e,s,n);case l._w.Proportional:return function(t,e,s,n){const i=x(e.minSize,s,n);if(null==t||null==i)return i;const r=null!=n?n.shape:void 0,{minDataValue:o}=e;if(null==o)return null;const a=t/o,l=x(e.maxSize,s,n);let h=null;return h="circle"===r?2*Math.sqrt(a*(i/2)**2):"square"===r||"diamond"===r||"image"===r?Math.sqrt(a*i**2):a*i,v(h,i,l)}(t,e,s,n);case l._w.Stops:return function(t,e,s,n,i){if(null==t)return null;const[r,o,a]=E(t,i);if(r===o)return x(e.stops?.[r].size,s,n);{const t=x(e.stops?.[r].size,s,n),i=x(e.stops?.[o].size,s,n);return null==t||null==i?null:t+(i-t)*a}}(t,e,s,n,i);case l._w.RealWorldSize:return function(t,e,s,n){const i=(n?.resolution??1)*a.j[e.valueUnit],r=x(e.minSize,s,n),o=x(e.maxSize,s,n),{valueRepresentation:l}=e;if(null==t)return r;let h=null;return h="area"===l?2*Math.sqrt(t/d)/i:"radius"===l||"distance"===l?2*t/i:t/i,v(h,r,o)}(t,e,s,n);case l._w.Identity:return t;case l._w.Unknown:return null}}function P(t,e,s){const{isScaleDriven:n}=t.cache;if(!(n&&"3d"===s||e))return null;const i={scale:e,view:s};let r=x(t.minSize,m,i),o=x(t.maxSize,m,i);if(null!=r||null!=o){if(r>o){const t=o;o=r,r=t}return{minSize:r,maxSize:o}}}function S(t,e,s){if(!t.visualVariables)return;const n=[],i=[],r=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":i.push(l);break;case"opacity":r.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return i.forEach((t=>{const i=p(t,e,s);n.push({variable:t,value:i})})),r.forEach((t=>{const i=_(t,e,s);n.push({variable:t,value:i})})),a.forEach((t=>{const i=f(t,e,s);n.push({variable:t,value:i})})),o.forEach((t=>{const i=y(t,e,s);n.push({variable:t,value:i})})),n}function E(t,e){if(!e)return;let s=0,n=e.length-1;return e.some(((e,i)=>t<e?(n=i,!0):(s=i,!1))),[s,n,(t-e[s])/(e[n]-e[s])]}function C(t,e,s){const n=["proportional","proportional","proportional"];for(const i of t){const t=i.useSymbolValue?"symbol-value":y(i,e,s)??"proportional";switch(i.axis){case"width":n[0]=t;break;case"depth":n[1]=t;break;case"height":n[2]=t;break;case"width-and-depth":n[0]=t,n[1]=t;break;case"all":case void 0:case null:n[0]=t,n[1]=t,n[2]=t;break;default:(0,r.Xb)(i.axis)}}return n}},27604:(t,e,s)=>{s.d(e,{q:()=>i});var n=s(8034);function i(t,e,s){if(!s?.features||!s.hasZ)return;const i=(0,n.N)(s.geometryType,e,t.outSpatialReference);if(null!=i)for(const n of s.features)i(n.geometry)}},80196:(t,e,s)=>{s.d(e,{A:()=>m});var n,i=s(66866),r=s(96220),o=s(19251),a=s(21564),l=s(73446),h=s(28902),u=s(63863),c=s(87673);let m=n=class extends c.A{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new n({fromColor:(0,o.o8)(this.fromColor),toColor:(0,o.o8)(this.toColor),algorithm:this.algorithm})}};(0,i._)([(0,h.e)({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],m.prototype,"algorithm",void 0),(0,i._)([(0,a.MZ)({type:r.A,json:{type:[l.jz],write:!0}})],m.prototype,"fromColor",void 0),(0,i._)([(0,a.MZ)({type:r.A,json:{type:[l.jz],write:!0}})],m.prototype,"toColor",void 0),(0,i._)([(0,a.MZ)({type:["algorithmic"]})],m.prototype,"type",void 0),m=n=(0,i._)([(0,u.$)("esri.rest.support.AlgorithmicColorRamp")],m)},27973:(t,e,s)=>{s.d(e,{A:()=>c});var n,i=s(66866),r=s(21877),o=s(19251),a=s(21564),l=s(73446),h=s(63863),u=s(77542);let c=class extends r.A{static{n=this}constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.orderByFields=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new n((0,o.o8)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};(0,i._)([(0,a.MZ)({type:[String],json:{write:!0}})],c.prototype,"attachmentTypes",void 0),(0,i._)([(0,a.MZ)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],c.prototype,"attachmentsWhere",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],c.prototype,"cacheHint",void 0),(0,i._)([(0,a.MZ)({type:[String],json:{write:!0}})],c.prototype,"keywords",void 0),(0,i._)([(0,a.MZ)({type:[String],json:{write:!0}})],c.prototype,"globalIds",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],c.prototype,"name",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{read:{source:"resultRecordCount"}}})],c.prototype,"num",void 0),(0,i._)([(0,a.MZ)({type:[Number],json:{write:!0}})],c.prototype,"objectIds",void 0),(0,i._)([(0,a.MZ)({type:[String],json:{write:!0}})],c.prototype,"orderByFields",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{default:!1,write:!0}})],c.prototype,"returnMetadata",void 0),(0,i._)([(0,a.MZ)({type:[Number],json:{write:!0}})],c.prototype,"size",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{read:{source:"resultOffset"}}})],c.prototype,"start",void 0),(0,i._)([(0,u.K)("start"),(0,u.K)("num")],c.prototype,"writeStart",null),(0,i._)([(0,a.MZ)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],c.prototype,"where",void 0),c=n=(0,i._)([(0,h.$)("esri.rest.support.AttachmentQuery")],c),c.from=(0,l.dp)(c)},30245:(t,e,s)=>{s.d(e,{A:()=>m});var n=s(66866),i=s(76724),r=s(21564),o=s(73446),a=(s(39831),s(9272),s(28902)),l=s(63863),h=s(18370),u=s(67281);function c(t,e,s){(0,i.sM)(s,t instanceof Date?t.getTime():t,e)}let m=class extends((0,u.K)(h.A)){constructor(t){super(t),this.numBins=null,this.end=null,this.start=null,this.type="auto-interval"}};(0,n._)([(0,r.MZ)({type:Number,json:{name:"parameters.numberOfBins",write:!0}})],m.prototype,"numBins",void 0),(0,n._)([(0,r.MZ)({json:{name:"parameters.end",write:{writer:c}}})],m.prototype,"end",void 0),(0,n._)([(0,r.MZ)({json:{name:"parameters.start",write:{writer:c}}})],m.prototype,"start",void 0),(0,n._)([(0,a.e)({autoIntervalBin:"auto-interval"},{readOnly:!0})],m.prototype,"type",void 0),m=(0,n._)([(0,l.$)("esri.rest.support.AutoIntervalBinParameters")],m),m.from=(0,o.dp)(m)},18370:(t,e,s)=>{s.d(e,{A:()=>_});var n=s(66866),i=s(24793),r=s(59851),o=s(21877),a=s(21564),l=(s(39831),s(539),s(9272),s(28902)),h=s(63863),u=s(73446);const c=new r.J({esriFieldTypeInteger:"integer",esriFieldTypeString:"string"});let m=class extends(i.A.ClonableMixin(o.A)){constructor(t){super(t),this.alias=null,this.responseType=null,this.type=null,this.value=null,this.valueType=null}};(0,n._)([(0,a.MZ)({type:String,json:{name:"outAlias",write:!0}})],m.prototype,"alias",void 0),(0,n._)([(0,a.MZ)({type:String})],m.prototype,"responseType",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],m.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],m.prototype,"value",void 0),(0,n._)([(0,l.e)(c)],m.prototype,"valueType",void 0),m=(0,n._)([(0,h.$)("esri.rest.support.AttributeBinsGrouping")],m);const d=m;m.from=(0,u.dp)(m);const g=new r.J({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeDate:"date",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"}),p=new r.J({naturalLog:"natural-log",squareRoot:"square-root"});let _=class extends(i.A.ClonableMixin(o.A)){constructor(t){super(t),this.expression=null,this.expressionValueType=null,this.field=null,this.firstDayOfWeek=null,this.hideUpperBound=null,this.splitBy=null,this.stackBy=null,this.transformation=null}};(0,n._)([(0,a.MZ)({type:String,json:{name:"onExpression.value",write:!0}})],_.prototype,"expression",void 0),(0,n._)([(0,l.e)(g,{name:"onExpression.valueType"})],_.prototype,"expressionValueType",void 0),(0,n._)([(0,a.MZ)({type:String,json:{name:"onField",write:!0}})],_.prototype,"field",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],_.prototype,"firstDayOfWeek",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],_.prototype,"hideUpperBound",void 0),(0,n._)([(0,a.MZ)({type:d,json:{write:{overridePolicy(){return{enabled:null!=this.splitBy?.value||null!=this.splitBy?.type}}}}})],_.prototype,"splitBy",void 0),(0,n._)([(0,a.MZ)({type:d,json:{write:{target:{stackBy:{type:d},jsonStyle:{type:String}},writer:(t,e)=>{t&&(e.stackBy=t.toJSON(),null!=t.responseType&&(e.jsonStyle=t.responseType))},overridePolicy(){return{enabled:null!=this.stackBy?.value||null!=this.stackBy?.type}}},read:{source:["stackBy","jsonStyle"],reader:(t,e)=>d.fromJSON({...e.stackBy,responseType:e.jsonStyle})}}})],_.prototype,"stackBy",void 0),(0,n._)([(0,l.e)(p)],_.prototype,"transformation",void 0),_=(0,n._)([(0,h.$)("esri.rest.support.BinParametersBase")],_)},87673:(t,e,s)=>{s.d(e,{A:()=>a});var n=s(66866),i=s(21877),r=s(21564),o=(s(39831),s(539),s(9272),s(63863));let a=class extends i.A{constructor(t){super(t),this.type=null}};(0,n._)([(0,r.MZ)({readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,n._)([(0,o.$)("esri.rest.support.ColorRamp")],a)},24465:(t,e,s)=>{s.d(e,{A:()=>f});var n=s(66866),i=s(76724),r=s(21564),o=s(73446),a=(s(39831),s(9272),s(28902)),l=s(63863),h=s(18370),u=s(24793),c=s(21877),m=s(77018);let d=class extends(u.A.ClonableMixin(c.A)){constructor(t){super(t),this.value=null,this.unit=null}};(0,n._)([(0,r.MZ)({type:Number,json:{name:"number",write:!0}})],d.prototype,"value",void 0),(0,n._)([(0,a.e)(m.g)],d.prototype,"unit",void 0),d=(0,n._)([(0,l.$)("esri.rest.support.DateBinTimeInterval")],d);const g=d;function p(t,e,s){(0,i.sM)(s,"string"==typeof t?t:t?.getTime(),e)}function _(t,e){const s=t.parameters[e];return s?"string"==typeof s?s:new Date(s):null}d.from=(0,o.dp)(d);let f=class extends h.A{constructor(t){super(t),this.end=null,this.interval=null,this.offset=null,this.returnFullIntervalBin=!1,this.start=null,this.snapToData=null,this.type="date"}};(0,n._)([(0,r.MZ)({cast:t=>null!=t?"string"==typeof t?t:new Date(t):null,json:{name:"parameters.end",read:{reader:(t,e)=>_(e,"end")},write:{writer:p}}})],f.prototype,"end",void 0),(0,n._)([(0,r.MZ)({type:g,json:{name:"parameters",write:!0}})],f.prototype,"interval",void 0),(0,n._)([(0,r.MZ)({type:g,json:{name:"parameters.offset",write:!0}})],f.prototype,"offset",void 0),(0,n._)([(0,r.MZ)({type:Boolean,json:{name:"parameters.returnFullIntervalBin",write:!0}})],f.prototype,"returnFullIntervalBin",void 0),(0,n._)([(0,r.MZ)({cast:t=>null!=t?"string"==typeof t?t:new Date(t):null,json:{name:"parameters.start",read:{reader:(t,e)=>_(e,"start")},write:{writer:p}}})],f.prototype,"start",void 0),(0,n._)([(0,r.MZ)({type:String,json:{name:"parameters.snapToData",write:!0}})],f.prototype,"snapToData",void 0),(0,n._)([(0,a.e)({dateBin:"date"},{readOnly:!0})],f.prototype,"type",void 0),f=(0,n._)([(0,l.$)("esri.rest.support.DateBinParameters")],f),f.from=(0,o.dp)(f)},77018:(t,e,s)=>{s.d(e,{g:()=>n});const n=(0,s(59851).O)()({year:"years",quarter:"quarters",month:"months",week:"weeks",day:"days",hour:"hours",minute:"minutes",second:"seconds"})},57822:(t,e,s)=>{s.d(e,{A:()=>y});var n,i=s(66866),r=s(25707),o=s(59851),a=s(21877),l=s(19251),h=s(21564),u=(s(39831),s(539),s(75094)),c=s(63863),m=s(77542),d=s(78983),g=s(1171),p=s(12433),_=s(24738);const f=new o.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let y=n=class extends a.A{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){return this.readFeaturesWithClass(t,e,r.A)}writeGeometryType(t,e,s,n){if(t)return void f.write(t,e,s,n);const{features:i}=this;if(i)for(const r of i)if(null!=r?.geometry)return void f.write(r.geometry.type,e,s,n)}readQueryGeometry(t,e){if(!t)return null;const s=!!t.spatialReference,n=(0,g.rS)(t);return n&&!s&&e.spatialReference&&(n.spatialReference=d.A.fromJSON(e.spatialReference)),n}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:s}=this;if(s)for(const n of s)if(n&&null!=n.geometry&&n.geometry.spatialReference)return void(e.spatialReference=n.geometry.spatialReference.toJSON())}clone(){return new n(this.cloneProperties())}cloneProperties(){return(0,l.o8)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let s=0;s<e.features.length;s++){const n=e.features[s];if(n.geometry){const e=t?.[s];n.geometry=e?.toJSON()||n.geometry}}return e}quantize(t){const{scale:[e,s],translate:[n,i]}=t,r=this.features,o=this._getQuantizationFunction(this.geometryType,(t=>Math.round((t-n)/e)),(t=>Math.round((i-t)/s)));for(let a=0,l=r.length;a<l;a++)o?.(r[a].geometry)||(r.splice(a,1),a--,l--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:s}=this;if(!s)return this;const{translate:[n,i],scale:[r,o]}=s;let a=null,l=null;if(this.hasZ&&null!=s?.scale?.[2]){const{translate:[,,t],scale:[,,e]}=s;a=s=>s*e+t}if(this.hasM&&null!=s?.scale?.[3]){const{translate:[,,,t],scale:[,,,e]}=s;l=s=>null==s?s:s*e+t}const h=this._getHydrationFunction(t,(t=>t*r+n),(t=>i-t*o),a,l);for(const{geometry:u}of e)null!=u&&h&&h(u);return this.transform=null,this}readFeaturesWithClass(t,e,s){const n=d.A.fromJSON(e.spatialReference),i=[];for(let r=0;r<t.length;r++){const e=t[r],o=s.fromJSON(e),a=e.geometry?.spatialReference;null==o.geometry||a||(o.geometry.spatialReference=n);const l=e.aggregateGeometries,h=o.aggregateGeometries;if(l&&null!=h)for(const t in h){const e=h[t],s=l[t],i=s?.spatialReference;null==e||i||(e.spatialReference=n)}i.push(o)}return i}_quantizePoints(t,e,s){let n,i;const r=[];for(let o=0,a=t.length;o<a;o++){const a=t[o];if(o>0){const t=e(a[0]),o=s(a[1]);t===n&&o===i||(r.push([t-n,o-i]),n=t,i=o)}else n=e(a[0]),i=s(a[1]),r.push([n,i])}return r.length>0?r:null}_getQuantizationFunction(t,e,s){return"point"===t?t=>(t.x=e(t.x),t.y=s(t.y),t):"polyline"===t||"polygon"===t?t=>{const n=(0,g.Bi)(t)?t.rings:t.paths,i=[];for(let r=0,o=n.length;r<o;r++){const t=n[r],o=this._quantizePoints(t,e,s);o&&i.push(o)}return i.length>0?((0,g.Bi)(t)?t.rings=i:t.paths=i,t):null}:"multipoint"===t?t=>{const n=this._quantizePoints(t.points,e,s);return n&&n.length>0?(t.points=n,t):null}:"extent"===t?t=>t:null}_getHydrationFunction(t,e,s,n,i){return"point"===t?t=>{t.x=e(t.x),t.y=s(t.y),n&&(t.z=n(t.z))}:"polyline"===t||"polygon"===t?t=>{const r=(0,g.Bi)(t)?t.rings:t.paths;let o,a;for(let n=0,i=r.length;n<i;n++){const t=r[n];for(let n=0,i=t.length;n<i;n++){const i=t[n];n>0?(o+=i[0],a+=i[1]):(o=i[0],a=i[1]),i[0]=e(o),i[1]=s(a)}}if(n&&i)for(let e=0,s=r.length;e<s;e++){const t=r[e];for(let e=0,s=t.length;e<s;e++){const s=t[e];s[2]=n(s[2]),s[3]=i(s[3])}}else if(n)for(let e=0,s=r.length;e<s;e++){const t=r[e];for(let e=0,s=t.length;e<s;e++){const s=t[e];s[2]=n(s[2])}}else if(i)for(let e=0,s=r.length;e<s;e++){const t=r[e];for(let e=0,s=t.length;e<s;e++){const s=t[e];s[2]=i(s[2])}}}:"extent"===t?t=>{t.xmin=e(t.xmin),t.ymin=s(t.ymin),t.xmax=e(t.xmax),t.ymax=s(t.ymax),n&&null!=t.zmax&&null!=t.zmin&&(t.zmax=n(t.zmax),t.zmin=n(t.zmin)),i&&null!=t.mmax&&null!=t.mmin&&(t.mmax=i(t.mmax),t.mmin=i(t.mmin))}:"multipoint"===t?t=>{const r=t.points;let o,a;for(let n=0,i=r.length;n<i;n++){const t=r[n];n>0?(o+=t[0],a+=t[1]):(o=t[0],a=t[1]),t[0]=e(o),t[1]=s(a)}if(n&&i)for(let e=0,s=r.length;e<s;e++){const t=r[e];t[2]=n(t[2]),t[3]=i(t[3])}else if(n)for(let e=0,s=r.length;e<s;e++){const t=r[e];t[2]=n(t[2])}else if(i)for(let e=0,s=r.length;e<s;e++){const t=r[e];t[2]=i(t[2])}}:null}};(0,i._)([(0,h.MZ)({type:String,json:{write:!0}})],y.prototype,"displayFieldName",void 0),(0,i._)([(0,h.MZ)({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],y.prototype,"exceededTransferLimit",void 0),(0,i._)([(0,h.MZ)({type:[r.A],json:{write:!0}})],y.prototype,"features",void 0),(0,i._)([(0,u.w)("features")],y.prototype,"readFeatures",null),(0,i._)([(0,h.MZ)({type:[_.A],json:{write:!0}})],y.prototype,"fields",void 0),(0,i._)([(0,h.MZ)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:f.read}}})],y.prototype,"geometryType",void 0),(0,i._)([(0,m.K)("geometryType")],y.prototype,"writeGeometryType",null),(0,i._)([(0,h.MZ)({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],y.prototype,"hasM",void 0),(0,i._)([(0,h.MZ)({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],y.prototype,"hasZ",void 0),(0,i._)([(0,h.MZ)({types:p.yR,json:{write:!0}})],y.prototype,"queryGeometry",void 0),(0,i._)([(0,u.w)("queryGeometry")],y.prototype,"readQueryGeometry",null),(0,i._)([(0,h.MZ)({type:d.A,json:{write:!0}})],y.prototype,"spatialReference",void 0),(0,i._)([(0,m.K)("spatialReference")],y.prototype,"writeSpatialReference",null),(0,i._)([(0,h.MZ)({json:{write:!0}})],y.prototype,"transform",void 0),y=n=(0,i._)([(0,c.$)("esri.rest.support.FeatureSet")],y),y.prototype.toJSON.isDefaultToJSON=!0},35985:(t,e,s)=>{s.d(e,{A:()=>u});var n=s(66866),i=s(76724),r=s(21564),o=s(73446),a=(s(39831),s(9272),s(28902)),l=s(63863),h=s(18370);let u=class extends h.A{constructor(t){super(t),this.boundaries=[],this.type="fixed-boundaries"}};(0,n._)([(0,r.MZ)({json:{name:"parameters.boundaries",write:{writer:function(t,e,s){(0,i.sM)(s,t&&function(t){return t[0]instanceof Date}(t)?t.map((t=>t.getTime())):t,e)}}}})],u.prototype,"boundaries",void 0),(0,n._)([(0,a.e)({fixedBoundariesBin:"fixed-boundaries"},{readOnly:!0})],u.prototype,"type",void 0),u=(0,n._)([(0,l.$)("esri.rest.support.FixedBoundariesBinParameters")],u),u.from=(0,o.dp)(u)},34344:(t,e,s)=>{s.d(e,{A:()=>m});var n=s(66866),i=s(76724),r=s(21564),o=s(73446),a=(s(39831),s(9272),s(28902)),l=s(63863),h=s(18370),u=s(67281);function c(t,e,s){(0,i.sM)(s,t instanceof Date?t.getTime():t,e)}let m=class extends((0,u.K)(h.A)){constructor(t){super(t),this.end=null,this.interval=null,this.start=null,this.type="fixed-interval"}};(0,n._)([(0,r.MZ)({json:{name:"parameters.end",write:{writer:c}}})],m.prototype,"end",void 0),(0,n._)([(0,r.MZ)({type:Number,json:{name:"parameters.interval",write:!0}})],m.prototype,"interval",void 0),(0,n._)([(0,r.MZ)({json:{name:"parameters.start",write:{writer:c}}})],m.prototype,"start",void 0),(0,n._)([(0,a.e)({fixedIntervalBin:"fixed-interval"},{readOnly:!0})],m.prototype,"type",void 0),m=(0,n._)([(0,l.$)("esri.rest.support.FixedIntervalBinParameters")],m),m.from=(0,o.dp)(m)},17771:(t,e,s)=>{s.d(e,{A:()=>u});var n,i=s(66866),r=s(19251),o=s(21564),a=(s(39831),s(539),s(63863)),l=s(80196),h=s(87673);let u=n=class extends h.A{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new n({colorRamps:(0,r.o8)(this.colorRamps)})}};(0,i._)([(0,o.MZ)({type:[l.A],json:{write:!0}})],u.prototype,"colorRamps",void 0),(0,i._)([(0,o.MZ)({type:["multipart"]})],u.prototype,"type",void 0),u=n=(0,i._)([(0,a.$)("esri.rest.support.MultipartColorRamp")],u)},67281:(t,e,s)=>{s.d(e,{K:()=>m,Q:()=>h});var n=s(66866),i=s(59851),r=s(539),o=s(21564),a=(s(39831),s(9272),s(28902)),l=s(63863);const h=(0,i.O)()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),u="percent-of-total",c="field",m=t=>{let e=class extends t{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,s=null!=this.normalizationTotal;return e||s?(t=e&&c||s&&u||null,e&&s&&r.A.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==c&&t!==u||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}};return(0,n._)([(0,o.MZ)({type:String,json:{name:"parameters.normalizationField",write:!0}})],e.prototype,"normalizationField",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],e.prototype,"normalizationMaxValue",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],e.prototype,"normalizationMinValue",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],e.prototype,"normalizationTotal",void 0),(0,n._)([(0,a.e)(h,{name:"parameters.normalizationType"})],e.prototype,"normalizationType",null),e=(0,n._)([(0,l.$)("esri.rest.support.NormalizationBinParametersMixin")],e),e}},97724:(t,e,s)=>{s.r(e),s.d(e,{default:()=>d});var n,i=s(66866),r=s(21877),o=s(19251),a=s(21564),l=s(73446),h=s(63863),u=s(77542),c=s(78983),m=s(44360);let d=class extends r.A{static{n=this}constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&null==this.where&&(e.definitionExpression="1=1")}clone(){return new n((0,o.o8)({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],d.prototype,"cacheHint",void 0),(0,i._)([(0,a.MZ)({type:m.L,json:{write:!0}})],d.prototype,"dynamicDataSource",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],d.prototype,"gdbVersion",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],d.prototype,"geometryPrecision",void 0),(0,i._)([(0,a.MZ)({type:Date})],d.prototype,"historicMoment",void 0),(0,i._)([(0,u.K)("historicMoment")],d.prototype,"_writeHistoricMoment",null),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],d.prototype,"maxAllowableOffset",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],d.prototype,"objectIds",void 0),(0,i._)([(0,a.MZ)({type:[String],json:{write:!0}})],d.prototype,"orderByFields",void 0),(0,i._)([(0,a.MZ)({type:[String],json:{write:!0}})],d.prototype,"outFields",void 0),(0,i._)([(0,a.MZ)({type:c.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],d.prototype,"outSpatialReference",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],d.prototype,"relationshipId",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{read:{source:"resultOffset"}}})],d.prototype,"start",void 0),(0,i._)([(0,u.K)("start"),(0,u.K)("num")],d.prototype,"writeStart",null),(0,i._)([(0,a.MZ)({type:Number,json:{read:{source:"resultRecordCount"}}})],d.prototype,"num",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],d.prototype,"returnGeometry",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],d.prototype,"returnM",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],d.prototype,"returnZ",void 0),(0,i._)([(0,a.MZ)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],d.prototype,"where",void 0),d=n=(0,i._)([(0,h.$)("esri.rest.support.RelationshipQuery")],d),d.from=(0,l.dp)(d)},59740:(t,e,s)=>{s.d(e,{g:()=>o,r:()=>a});var n=s(80196),i=s(87673),r=s(17771);const o={key:"type",base:i.A,typeMap:{algorithmic:n.A,multipart:r.A}};function a(t){return t?.type?"algorithmic"===t.type?n.A.fromJSON(t):"multipart"===t.type?r.A.fromJSON(t):null:null}},46709:(t,e,s)=>{s.d(e,{Ad:()=>d,Gj:()=>_,QY:()=>m,lL:()=>f,xR:()=>g});var n=s(98918),i=s(98849),r=(s(39831),s(45132)),o=s(40845),a=s(1171),l=s(79005),h=s(35387),u=s(54088);const c=["geometry","scale","timeProperties"];function m(t,e){if(null!=e)for(const s of c)e.hasArcadeDependency(s)&&t.add(s);return t}function d(t,e){return p.create(t,e,null,["$feature","$view"])}function g(t,e,s){return p.create(t,e,s,["$feature","$view","$config"])}class p{static async create(t,e,s,n){const{arcade:r,Dictionary:o}=await(0,h.l)();let a;try{a=r.parseScript(t)}catch(_){throw new i.A("arcade-bad-expression","Failed to parse arcade script",{script:t,error:_})}const l=r.scriptUsesGeometryEngine(a);l&&await r.enableGeometrySupport(),await r.loadDependentModules(new Set,a,null,!1,l);const u={vars:n.reduce(((t,e)=>({...t,[e]:null})),{}),spatialReference:e,useAsync:!1},c=r.compileScript(a,u);let m=null;null!=s&&(m=new o(s),m.immutable=!0);const d=new o;return d.immutable=!1,d.setField("scale",0),new p(t,r,a,c,e,d,m,o)}constructor(t,e,s,n,i,r,o,a){this.script=t,this._arcade=e,this._syntaxTree=s,this._compiled=n,this._spatialReference=i,this._viewDict=r,this._configDict=o,this._dictionaryCtor=a,this._dependencies=new Map,this._featureReader=new _,this._dependencies.set("geometry",e.scriptTouchesGeometry(this._syntaxTree)),this._dependencies.set("scale",this._arcade.referencesMember(this._syntaxTree,"scale")),this._dependencies.set("timeProperties",this._arcade.scriptUsesViewProperties(this._syntaxTree,["timeProperties"]))}evaluate(t,e){const s=e.$view?.timeZone;if(e.$view){let t;if(this._viewDict.setField("scale",e.$view.scale),null!=e.$view.timeProperties){const{currentStart:i,currentEnd:r}=e.$view.timeProperties;t=new this._dictionaryCtor({currentStart:null!=i?null!=s?n.lY.epochToArcadeDate(i,s):n.lY.unknownEpochToArcadeDate(i):void 0,currentEnd:null!=r?null!=s?n.lY.epochToArcadeDate(r,s):n.lY.unknownEpochToArcadeDate(r):void 0,startIncluded:!0,endIncluded:!0})}this._viewDict.setField("timeProperties",t)}return this._compiled({vars:{$view:this._viewDict,$config:this._configDict,$feature:t},spatialReference:this._spatialReference,timeZone:s})}repurposeFeature(t,e){return this._featureReader.bind(t,e,this._spatialReference),this._featureReader}references(t){return this._dependencies.get(t)??!1}}class _{constructor(){this._boundTarget=null,this._boundSchema={fields:null,fieldsIndex:null,spatialReference:null,get geometryType(){return null},get objectIdField(){return null}},this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}bind(t,e,s){const n=e??new l.A(f(t.attributes));this._boundTarget=t,this._boundSchema.fields=n.fields,this._boundSchema.fieldsIndex=n,this._boundSchema.spatialReference=s}_getField(t){return this._boundSchema.fieldsIndex.get(t)}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(t){this._contextTimeZone=t}readArcadeFeature(){return this}hasField(t){return this._boundSchema.fieldsIndex.has(t)}geometry(){if("fromJSON"in this._boundTarget)return this._boundTarget.geometry;const t=(0,a.rS)(this._boundTarget.geometry);if(t){if(!this._boundSchema.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");t.spatialReference=this._boundSchema.spatialReference}return t}isUnknownDateTimeField(t){return this._boundSchema.fieldsIndex.getTimeZone(t)===u.L5}field(t,e=!0){const s=this._getField(t);if(s){const e=this._boundTarget.attributes[s.name];if(null==e)return null;switch(s.type){case"date-only":case"esriFieldTypeDateOnly":return r.n.fromReader(e);case"time-only":case"esriFieldTypeTimeOnly":return o.k.fromReader(e);case"esriFieldTypeTimestampOffset":case"timestamp-offset":return n.lY.fromReaderAsTimeStampOffset(e);case"date":case"esriFieldTypeDate":return this.isUnknownDateTimeField(t)?n.lY.unknownEpochToArcadeDate(e):n.lY.epochToArcadeDate(e,this.contextTimeZone??u.qU);default:return e}}if(e)throw new Error(`Field ${t} does not exist`);return null}setField(t,e){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this._boundSchema.fieldsIndex.fields.map((t=>t.name))}castToText(t=!1){return JSON.stringify(this._boundTarget)}gdbVersion(){return null}fullSchema(){return this._boundSchema}castAsJson(t=null){return{attributes:this._boundTarget.attributes,geometry:!0===t?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(t=null,e=null){return Promise.resolve(this.castAsJson(e))}}function f(t){const e=[];for(const s in t)e.push({name:s,alias:s,type:"string"==typeof t[s]?"esriFieldTypeString":"esriFieldTypeDouble"});return e}},44116:(t,e,s)=>{s.d(e,{tn:()=>h});var n=s(56542),i=s(42453),r=s(51777),o=(s(27597),s(80004),s(44395),s(3082)),a=(s(53155),s(73875),s(23676),s(39723),s(31386)),l=s(56473);function h({displayField:t,editFieldsInfo:e,fields:s,objectIdField:a,title:l},h){if(!s)return null;const u=m({editFieldsInfo:e,fields:s,objectIdField:a},h);if(!u.length)return null;const c=function(t){const e=(0,i.mB)(t),{titleBase:s}=t;return e?`${s}: {${e.trim()}}`:s??""}({titleBase:l,fields:s,displayField:t}),d=[new o.A,new r.A];return new n.A({title:c,content:d,fieldInfos:u})}const u=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):(0,i.Bz)(t,e);function c(t,e){return"oid"===t.type?-1:"oid"===e.type?1:g(t)?-1:g(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function m(t,e){const s=e?.visibleFieldNames;return function({fields:t,ignoreFieldTypes:e,sortDisabled:s}){const n=t;return e&&(t=t.filter((t=>!e.includes(t.type)))),t===n&&(t=t.slice()),!0!==s&&t.sort(c),t}({fields:t.fields??[],ignoreFieldTypes:e?.ignoreFieldTypes||p,sortDisabled:e?.sortDisabled}).map((e=>new a.A({fieldName:e.name,isEditable:(0,i.R$)(e,t),label:e.alias,format:d(e),visible:u(e,{...t,visibleFieldNames:s})})))}function d(t){switch(t.type){case"small-integer":case"integer":case"single":return new l.A({digitSeparator:!0,places:0});case"double":return new l.A({digitSeparator:!0,places:2});case"string":return(0,i.JL)(t.name)?new l.A({digitSeparator:!0,places:0}):void 0;default:return}}function g(t){if("name"===(t.name&&t.name.toLowerCase()))return!0;const e=t.alias?.toLowerCase();return"name"===e}const p=["geometry","blob","raster","guid","xml"]},61716:(t,e,s)=>{s.d(e,{Aq:()=>i,pC:()=>r,rx:()=>o});var n=s(82250);function i(t,e){t[4]=e}class r{constructor(t,e=!0,s=!0,i=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!e&&"esriGeometryPolygon"===t.geometryType||!s&&"esriGeometryPolyline"===t.geometryType?null:t,this.geomUnitsPerPoint=i,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new n.W}next(){if(!this.geometryCursor)return null;const t=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&t||(this.geometryCursor=null),t}processMultiPath(t){for(;this.iteratePath||t.pathIndex<t.totalSize-1;){this.iteratePath||t.nextPath(),this.iterateMultiPath=!0;const e=this.processPath(t);if(e)return e}return this.iterateMultiPath=!1,null}}class o{constructor(t,e,s,n=0){this.isClosed=!1,this.inputGeometries=t,this.acceptPolygon=e,this.acceptPolyline=s,this.geomUnitsPerPoint=n,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let t=this.inputGeometries.next();for(;t&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===t.geometryType||"esriGeometryEnvelope"===t.geometryType,this.multiPathCursor=t,!this.multiPathCursor);)t=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const t=this.processPath(this.multiPathCursor);if(t)return t}this.multiPathCursor=null}}}},13022:(t,e,s)=>{s.d(e,{k:()=>a,q:()=>l});var n=s(14816),i=s(87569);const r=512;let o;class a{constructor(t){this._geometry=t}next(){const t=this._geometry;return this._geometry=null,t}}function l(t,e,s){if(!t)return null;o||(o=new i.O3(0,0,0,1));const a=s?-1:1,l="esriGeometryPolygon"===t.geometryType,h=l?i.dC.Polygon:i.dC.LineString,u=l?3:2;let c,m;for(o.reset(h),o.setPixelMargin(e+1),o.setExtent(r);t.nextPath();)if(!(t.pathSize<u)){for(t.nextPoint(),c=t.x,m=a*t.y,o.moveTo(c,m);t.nextPoint();)c=t.x,m=a*t.y,o.lineTo(c,m);l&&o.close()}const d=o.result(!1);if(d){const e=n.z.createEmptyOptimizedCIM(t.geometryType);for(const t of d){e.startPath();for(const s of t)e.pushXY(s.x,a*s.y)}return e.reset(),e}return null}},90157:(t,e,s)=>{s.d(e,{A:()=>T,c:()=>A});var n=s(96788),i=s(75158),r=s(80097),o=s(77346),a=s(71443),l=s(60459),h=s(59191),u=s(12727),c=s(3687),m=s(37330),d=s(96876),g=s(46764),p=s(35893),_=s(26768),f=s(3465),y=s(68652),x=s(42088),v=s(18814),b=s(66045),P=s(98537),S=s(90957),E=s(1127),C=s(22682),w=s(11712),I=s(48358);function T(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return n.N.local();case"CIMGeometricEffectArrow":return i.B.local();case"CIMGeometricEffectBuffer":return r.s.local();case"CIMGeometricEffectControlMeasureLine":return o.v.local();case"CIMGeometricEffectCut":return a.y.local();case"CIMGeometricEffectDashes":return l.I.local();case"CIMGeometricEffectDonut":return h.O.local();case"CIMGeometricEffectJog":return c.U.local();case"CIMGeometricEffectMove":return m.V.local();case"CIMGeometricEffectOffset":return d.V.local();case"CIMGeometricEffectRadial":return g.h.local();case"CIMGeometricEffectReverse":return p.C.local();case"CIMGeometricEffectRotate":return _.v.local();case"CIMGeometricEffectScale":return f.W.local();case"CIMGeometricEffectSuppress":return y.L.local();case"CIMGeometricEffectTaperedPolygon":return x.t.local();case"CIMGeometricEffectWave":return v.l.local();case"CIMGeometricEffectEnclosingPolygon":return u.g.local()}return null}function A(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return b.e.local();case"CIMMarkerPlacementAtExtremities":return P.y.local();case"CIMMarkerPlacementAtRatioPositions":return S.S.local();case"CIMMarkerPlacementInsidePolygon":return E.M.local();case"CIMMarkerPlacementOnLine":return C.R.local();case"CIMMarkerPlacementOnVertices":return w.A.local();case"CIMMarkerPlacementPolygonCenter":return I.L.local()}return null}},82250:(t,e,s)=>{s.d(e,{W:()=>n});class n{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(t,e){this.tx=t,this.ty=e}setTranslateZ(t){this.tz=t}setRotateCS(t,e){this.rz=void 0,this.rzCos=t,this.rzSin=e}setRotate(t){this.rz=t,this.rzCos=void 0,this.rzSin=void 0}setRotateY(t){this.ry=t}setScale(t){this.s=t}setMeasure(t){this.m=t}}},26502:(t,e,s)=>{s.d(e,{Rj:()=>O,mx:()=>V,CK:()=>z,IT:()=>L,QF:()=>U});var n=s(72777),i=s(39831),r=s(19251),o=s(539),a=s(92504),l=s(90086),h=s(89882),u=s(14816),c=s(80510),m=s(36358),d=s(23806),g=s(1171),p=s(13022);class _{applyColorSubstitution(t,e){if(!e)return t;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:s,height:n}=t,i=this._rasterizationCanvas,r=i.getContext("2d",{willReadFrequently:!0});t!==i&&(i.width=s,i.height=n,r.drawImage(t,0,0,s,n));const o=r.getImageData(0,0,s,n).data;if(e)for(const l of e)if(l&&l.oldColor&&4===l.oldColor.length&&l.newColor&&4===l.newColor.length){const[t,e,s,n]=l.oldColor,[i,r,a,h]=l.newColor;if(t===i&&e===r&&s===a&&n===h)continue;for(let l=0;l<o.length;l+=4)t===o[l]&&e===o[l+1]&&s===o[l+2]&&n===o[l+3]&&(o[l]=i,o[l+1]=r,o[l+2]=a,o[l+3]=h)}const a=new ImageData(o,s,n);return r.putImageData(a,0,0),i}tintImageData(t,e){if(!e||e.length<4)return t;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:s,height:n}=t,i=this._rasterizationCanvas,r=i.getContext("2d",{willReadFrequently:!0});t!==i&&(i.width=s,i.height=n,r.drawImage(t,0,0,s,n));const o=r.getImageData(0,0,s,n),a=new Uint8Array(o.data),l=[e[0]/255,e[1]/255,e[2]/255,e[3]/255];for(let u=0;u<a.length;u+=4)a[u]*=l[0],a[u+1]*=l[1],a[u+2]*=l[2],a[u+3]*=l[3];const h=new ImageData(new Uint8ClampedArray(a.buffer),s,n);return r.putImageData(h,0,0),i}}var f=s(90157),y=s(82250),x=s(7591),v=s(63643);function b(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const s=document.createElement("canvas");s.width=t.width,s.height=t.height;const n=s.getContext("2d");return e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0),s}function P(t,e=0){if(0===e)return t;const s=Math.cos(e),n=Math.sin(e),[i,r]=t;return[i*s+r*-n,i*n+r*s]}var S=s(79126),E=s(76715),C=s(51481);function w(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}class I{constructor(t){t&&(this._textRasterizationCanvas=t)}rasterizeText(t,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const s=this._textRasterizationCanvas,n=s.getContext("2d",{willReadFrequently:!0});T(n,e),this._parameters=e,this._textLines=t.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:i,weight:r}=e.font;this._lineThroughWidthOffset=i&&"line-through"===i?.1*this._lineHeight:0;const o=null!=e.backgroundColor||null!=e.borderLine,a=o?C.y7:0,l=this._computeTextWidth(n,e)+2*a,h=this._lineHeight*this._textLines.length+2*a;if(s.width=l+2*this._lineThroughWidthOffset,s.height=h,0===s.width||0===s.height)return s.width=s.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:s};this._renderedLineHeight=Math.round(this._lineHeight),this._renderedOutlineSize=(e.outline.size||0)*e.pixelRatio,this._renderedHaloSize=(e.halo.size||0)*e.pixelRatio,this._renderedWidth=l,this._renderedHeight=h,this._lineThroughWidthOffset*=e.pixelRatio;const u=(e.outline&&e.outline.color)??[0,0,0,0],c=e.color??[0,0,0,0],m=e.halo&&e.halo.color?e.halo.color:[0,0,0,0];this._fillStyle=w(c),this._outlineStyle=w(u),this._haloStyle=function(t){return`rgb(${t.slice(0,3).toString()})`}(m);const d=this._renderedLineHeight,g=this._renderedOutlineSize,p=this._renderedHaloSize;n.save(),n.clearRect(0,0,s.width,s.height),T(n,e);const _=a*e.pixelRatio,f=function(t,e,s){return"center"===t?.5*e:"right"===t?e-s:s}(n.textAlign,this._renderedWidth-2*_,this._renderedHaloSize+this._renderedOutlineSize)+_,y=p+g+_,x=p>0;let v=this._lineThroughWidthOffset,b=0;if(o){n.save();const t=e.backgroundColor??[0,0,0,0],i=e.borderLine?.color??[0,0,0,0],r=2*(e.borderLine?.size??0);n.fillStyle=w(t),n.strokeStyle=w(i),n.lineWidth=r,n.fillRect(0,0,s.width,s.height),n.strokeRect(0,0,s.width,s.height),n.restore()}x&&this._renderHalo(n,f,y,v,b,e),g>0&&this._renderOutline(n,f,y,v,b,e),b+=y,v+=f;for(const C of this._textLines)x?(n.globalCompositeOperation="destination-out",n.fillStyle="rgb(0, 0, 0)",n.fillText(C,v,b),n.globalCompositeOperation="source-over",n.fillStyle=this._fillStyle,n.fillText(C,v,b)):(n.fillStyle=this._fillStyle,n.fillText(C,v,b)),i&&"none"!==i&&this._renderDecoration(n,v,b,i,r),b+=d;n.restore();const P=this._renderedWidth+2*this._lineThroughWidthOffset,S=this._renderedHeight,E=n.getImageData(0,0,P,S),I=new Uint8Array(E.data);if(e.premultiplyColors){let t;for(let e=0;e<I.length;e+=4)t=I[e+3]/255,I[e]=I[e]*t,I[e+1]=I[e+1]*t,I[e+2]=I[e+2]*t}let A,M;switch(e.horizontalAlignment){case"left":A=-.5;break;case"right":A=.5;break;default:A=0}switch(e.verticalAlignment){case"bottom":M=-.5;break;case"top":M=.5;break;case"baseline":M=-1/6;break;default:M=0}return{size:[P,S],image:new Uint32Array(I.buffer),sdf:!1,simplePattern:!1,anchorX:A,anchorY:M,canvas:s}}_renderHalo(t,e,s,n,i,r){const o=this._renderedWidth,a=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=a;const l=this._outlineRasterizationCanvas,h=l.getContext("2d");h.clearRect(0,0,o,a),T(h,r);const{decoration:u,weight:c}=r.font;h.fillStyle=this._haloStyle,h.strokeStyle=this._haloStyle,h.lineJoin="round",this._renderOutlineNative(h,e,s,u,c,this._renderedHaloSize+this._renderedOutlineSize),t.globalAlpha=this._parameters.halo.color[3],t.drawImage(l,0,0,o,a,n,i,o,a),t.globalAlpha=1}_renderOutline(t,e,s,n,i,r){const o=this._renderedWidth,a=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=a;const l=this._outlineRasterizationCanvas,h=l.getContext("2d");h.clearRect(0,0,o,a),T(h,r);const{decoration:u,weight:c}=r.font;h.fillStyle=this._outlineStyle,h.strokeStyle=this._outlineStyle,h.lineJoin="round",this._renderOutlineNative(h,e,s,u,c,this._renderedOutlineSize),t.globalAlpha=this._parameters.outline.color[3],t.drawImage(l,0,0,o,a,n,i,o,a),t.globalAlpha=1}_renderOutlineNative(t,e,s,n,i,r){const o=this._renderedLineHeight;for(const a of this._textLines){const l=2*r,h=5,u=.1;for(let r=0;r<h;r++){const o=(1-(h-1)*u+r*u)*l;t.lineWidth=o,t.strokeText(a,e,s),n&&"none"!==n&&this._renderDecoration(t,e,s,n,i,o)}s+=o}}computeTextSize(t,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const s=this._textRasterizationCanvas,n=s.getContext("2d");T(n,e),this._parameters=e,this._textLines=t.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const i=this._computeTextWidth(n,e),r=this._lineHeight*this._textLines.length;return s.width=i,s.height=r,[i*e.pixelRatio,r*e.pixelRatio]}_computeTextWidth(t,e){let s=0;for(const i of this._textLines)s=Math.max(s,t.measureText(i).width);const n=e.font;return("italic"===n.style||"oblique"===n.style||"string"==typeof n.weight&&("bold"===n.weight||"bolder"===n.weight)||"number"==typeof n.weight&&n.weight>600)&&(s+=.3*t.measureText("w").width),s+=2*(0,h.Lz)(this._parameters.halo.size),Math.round(s)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let t=this._computeLineHeightBase();const e=this._parameters.font.decoration;return e&&"underline"===e&&(t*=1.3),Math.round(t+2*(0,h.Lz)(this._parameters.halo.size))}_renderDecoration(t,e,s,n,i,r){let o=.9*this._lineHeight;const a="bold"===i?.06:"bolder"===i?.09:.04;switch(t.textAlign){case"center":e-=this._renderedWidth/2;break;case"right":e-=this._renderedWidth}const l=t.textBaseline;if("underline"===n)switch(o=.9*this._computeLineHeightBase(),l){case"top":s+=o;break;case"middle":s+=o/2}else if("line-through"===n)switch(l){case"top":s+=o/1.5;break;case"middle":s+=o/3}const h=r?1.5*r:Math.ceil(o*a);t.save(),t.beginPath(),t.strokeStyle=t.fillStyle,t.lineWidth=h,t.moveTo(e-this._lineThroughWidthOffset,s),t.lineTo(e+this._renderedWidth+2*this._lineThroughWidthOffset,s),t.stroke(),t.restore()}}function T(t,e){const s=Math.max(e.size,.5),n=e.font,i=`${n.style} ${n.weight} ${(0,h.Lz)(s).toFixed(1)}px ${n.family}, sans-serif`;let r;switch(t.font=i,t.textBaseline="top",e.horizontalAlignment){case"left":default:r="left";break;case"right":r="right";break;case"center":r="center"}t.textAlign=r}var A=s(50072),M=s(77545),D=s(43556),N=s(42695),F=s(98502);const R=Math.PI/180,k=()=>o.A.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");class L{constructor(t){this._t=t}static createIdentity(){return new L([1,0,0,0,1,0])}clone(){const t=this._t;return new L(t.slice())}transform(t){const e=this._t;return[e[0]*t[0]+e[1]*t[1]+e[2],e[3]*t[0]+e[4]*t[1]+e[5]]}static createScale(t,e){return new L([t,0,0,0,e,0])}scale(t,e){const s=this._t;return s[0]*=t,s[1]*=t,s[2]*=t,s[3]*=e,s[4]*=e,s[5]*=e,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(t,e){return new L([0,0,t,0,0,e])}translate(t,e){const s=this._t;return s[2]+=t,s[5]+=e,this}static createRotate(t){const e=Math.cos(t),s=Math.sin(t);return new L([e,-s,0,s,e,0])}rotate(t){return L.multiply(this,L.createRotate(t),this)}angle(){const t=this._t[0],e=this._t[3],s=Math.sqrt(t*t+e*e);return[t/s,e/s]}static multiply(t,e,s){const n=t._t,i=e._t,r=n[0]*i[0]+n[3]*i[1],o=n[1]*i[0]+n[4]*i[1],a=n[2]*i[0]+n[5]*i[1]+i[2],l=n[0]*i[3]+n[3]*i[4],h=n[1]*i[3]+n[4]*i[4],u=n[2]*i[3]+n[5]*i[4]+i[5],c=s._t;return c[0]=r,c[1]=o,c[2]=a,c[3]=l,c[4]=h,c[5]=u,s}invert(){const t=this._t;let e=t[0]*t[4]-t[1]*t[3];if(0===e)return new L([0,0,0,0,0,0]);e=1/e;const s=(t[1]*t[5]-t[2]*t[4])*e,n=(t[2]*t[3]-t[0]*t[5])*e,i=t[4]*e,r=-t[1]*e,o=-t[3]*e,a=t[0]*e;return new L([i,r,s,o,a,n])}}class G{constructor(t,e){this._resourceManager=t,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new l.A(y.W,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(e||L.createIdentity()),this._sizeTransfos.push(e?e.scaleRatio():1)}setTransform(t,e){this._transfos=[t||L.createIdentity()],this._sizeTransfos=[e||(t?t.scaleRatio():1)]}setGeomUnitsPerPoint(t){this._geomUnitsPerPoint=t}transformPt(t){return this._transfos[this._transfos.length-1].transform(t)}transformSize(t){return t*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(t){return this._transfos[this._transfos.length-1].invert().transform(t)}reverseTransformSize(t){return t/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(t){return t/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(t,e){const s=e?t.scaleRatio():1;L.multiply(t,this.back(),t),this._transfos.push(t),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*s)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(t,e,s){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(t,e);break;case"CIMTextSymbol":this.drawTextSymbol(t,e,s)}}drawMultiLayerSymbol(t,e){if(!t||!e)return;const s=t.symbolLayers;if(!s)return;const n=t.effects;if(n&&n.length>0){const t=this.executeEffects(n,e);if(t){let e=t.next();for(;e;)this.drawSymbolLayers(s,e.asJSON()),e=t.next()}}else this.drawSymbolLayers(s,e)}executeEffects(t,e){const s=this._resourceManager.geometryEngine;let n=new p.k(u.z.fromJSONCIM(e));for(const i of t){const t=(0,f.A)(i);t&&(n=t.execute(n,i,this.geomUnitsPerPoint(),null,s))}return n}drawSymbolLayers(t,e){let s=t.length;for(;s--;){const n=t[s];if(!n||!1===n.enable)continue;const i=n.effects;if(i&&i.length>0){const t=this.executeEffects(i,e);if(t){let e=null;for(;(e=t.next())&&(this.drawSymbolLayer(n,e.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(n,e);if(this._earlyReturn)return}}drawSymbolLayer(t,e){switch(t.type){case"CIMSolidFill":this.drawSolidFill(e,t.color,t.path);break;case"CIMHatchFill":this.drawHatchFill(e,t);break;case"CIMPictureFill":this.drawPictureFill(e,t);break;case"CIMGradientFill":this.drawGradientFill(e,t);break;case"CIMSolidStroke":this.drawSolidStroke(e,t.color,t.width,t.capStyle,t.joinStyle,t.miterLimit,t.path);break;case"CIMPictureStroke":this.drawPictureStroke(e,t);break;case"CIMGradientStroke":this.drawGradientStroke(e,t);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(t,e)}}drawHatchFill(t,e){const s=function(t,e,s){let n=(0,A.$w)(t.separation,x.D.CIMHatchFill.separation)*s,i=(0,A.$w)(t.rotation);if(0===n)return null;n<0&&(n=-n);let r=0;const o=.5*n;for(;r>o;)r-=n;for(;r<-o;)r+=n;const a=(0,c.vt)();(0,m.Rg)(a,e),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;i>180;)i-=180;for(;i<0;)i+=180;const h=Math.cos(i*R),u=Math.sin(i*R),d=-n*u,g=n*h;let p,_,f,y;r=(0,A.$w)(t.offsetX)*s*u-(0,A.$w)(t.offsetY)*s*h,p=f=Number.MAX_VALUE,_=y=-Number.MAX_VALUE;for(const c of l){const t=c[0],e=c[1],s=h*t+u*e,n=-u*t+h*e;p=Math.min(p,s),f=Math.min(f,n),_=Math.max(_,s),y=Math.max(y,n)}f=Math.floor(f/n)*n;let v=h*p-u*f-d*r/n,b=u*p+h*f-g*r/n,P=h*_-u*f-d*r/n,S=u*_+h*f-g*r/n;const E=1+Math.round((y-f)/n),C=[];for(let c=0;c<E;c++)v+=d,b+=g,P+=d,S+=g,C.push([[v,b],[P,S]]);return{paths:C}}(e,t,this.geomUnitsPerPoint());s&&(this.pushClipPath(t),this.drawMultiLayerSymbol(e.lineSymbol,s),this.popClipPath())}drawPictureFill(t,e){}drawGradientFill(t,e){}drawPictureStroke(t,e){}drawGradientStroke(t,e){}drawMarkerLayer(t,e){const s=t.markerPlacement;if(s){const n=(0,f.c)(s);if(n){const i="CIMMarkerPlacementInsidePolygon"===s.type||"CIMMarkerPlacementPolygonCenter"===s.type&&s.clipAtBoundary;i&&this.pushClipPath(e);const r=n.execute(u.z.fromJSONCIM(e),s,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(r){let e=null;for(;(e=r.next())&&(this.drawMarker(t,e),!this._earlyReturn););}i&&this.popClipPath()}}else{const s=this._placementPool.acquire();if((0,g.fT)(e))s.tx=e.x,s.ty=e.y,this.drawMarker(t,s);else if((0,g.Bi)(e)){const n=(0,d.l8)(e);n&&([s.tx,s.ty]=n,this.drawMarker(t,s))}else if((0,g.Rg)(e)){for(const n of e.paths)for(const e of n)if(s.tx=e[0],s.ty=e[1],this.drawMarker(t,s),this._earlyReturn)break}else for(const n of e.points)if(s.tx=n[0],s.ty=n[1],this.drawMarker(t,s),this._earlyReturn)break;this._placementPool.release(s)}}drawMarker(t,e){switch(t.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(t,e);break;case"CIMVectorMarker":this.drawVectorMarker(t,e)}}drawPictureMarker(t,e){if(!t)return;const s=this._resourceManager.getResource(t.url),n=(0,A.$w)(t.size,x.D.CIMPictureMarker.size);if(null==s||n<=0)return;const i=s.width,r=s.height;if(!i||!r)return;const o=i/r,a=(0,A.$w)(t.scaleX,1),l=L.createIdentity(),h=t.anchorPoint;if(h){let e=h.x,s=h.y;"Absolute"!==t.anchorPointUnits&&(e*=n*o*a,s*=n),l.translate(-e,-s)}let u=(0,A.$w)(t.rotation);t.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*R);let c=(0,A.$w)(t.offsetX),m=(0,A.$w)(t.offsetY);if(c||m){if(this._mapRotation){const t=R*this._mapRotation,e=Math.cos(t),s=Math.sin(t),n=c*s+m*e;c=c*e-m*s,m=n}l.translate(c,m)}const d=this.geomUnitsPerPoint();1!==d&&l.scale(d,d);const g=e.getAngle();g&&l.rotate(g),l.translate(e.tx,e.ty),this.push(l,!1),this.drawImage(t,n),this.pop()}drawVectorMarker(t,e){if(!t)return;const s=t.markerGraphics;if(!s)return;const n=(0,A.$w)(t.size,x.D.CIMVectorMarker.size),i=t.frame,r=i?i.ymax-i.ymin:0,o=n&&r?n/r:1,a=L.createIdentity();i&&a.translate(.5*-(i.xmax+i.xmin),.5*-(i.ymax+i.ymin));const l=t.anchorPoint;if(l){let e=l.x,s=l.y;"Absolute"!==t.anchorPointUnits?i&&(e*=i.xmax-i.xmin,s*=i.ymax-i.ymin):(e/=o,s/=o),a.translate(-e,-s)}1!==o&&a.scale(o,o);let h=(0,A.$w)(t.rotation);t.rotateClockwise&&(h=-h),this._mapRotation&&(h+=this._mapRotation),h&&a.rotate(h*R);let u=(0,A.$w)(t.offsetX),c=(0,A.$w)(t.offsetY);if(u||c){if(this._mapRotation){const t=R*this._mapRotation,e=Math.cos(t),s=Math.sin(t),n=u*s+c*e;u=u*e-c*s,c=n}a.translate(u,c)}const m=this.geomUnitsPerPoint();1!==m&&a.scale(m,m);const d=e.getAngle();d&&a.rotate(d),a.translate(e.tx,e.ty),this.push(a,t.scaleSymbolsProportionally);for(const g of s){g?.symbol&&g.geometry||k().error("Invalid marker graphic",g);let t=g.textString;if("number"==typeof t&&(t=t.toString()),this.drawSymbol(g.symbol,g.geometry,t),this._earlyReturn)break}this.pop()}drawTextSymbol(t,e,s){if(!t)return;if(!(0,g.fT)(e))return;if((0,A.$w)(t.height,x.D.CIMTextSymbol.height)<=0)return;const n=L.createIdentity();let i=(0,A.$w)(t.angle);i=-i,i&&n.rotate(i*R);const r=(0,A.$w)(t.offsetX),o=(0,A.$w)(t.offsetY);(r||o)&&n.translate(r,o);const a=this.geomUnitsPerPoint();1!==a&&n.scale(a,a),n.translate(e.x,e.y),this.push(n,!1),this.drawText(t,s),this.pop()}}class V extends G{constructor(t,e){super(t,e),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new E.A(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return(0,c.fA)(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(t){if(t&&!(this._clipCount>0))if((0,g.Bi)(t))this._processPath(t.rings,0);else if((0,g.Rg)(t))this._processPath(t.paths,0);else if((0,g.ZC)(t)){const e=Y(t);e&&this._processPath(e.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(t,e,s){if(!t||this._clipCount>0||null==s||s<=0)return;const n=Math.max(.5*this.transformSize((0,A.$w)(s,x.D.CIMSolidStroke.width)),.25);if((0,g.Bi)(t))this._processPath(t.rings,n);else if((0,g.Rg)(t))this._processPath(t.paths,n);else if((0,g.ZC)(t)){const e=Y(t);e&&this._processPath(e.rings,n)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(t,e){(0,g.Bi)(e)&&t.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===t.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===t.markerPlacement.type&&t.markerPlacement.clipAtBoundary)?this._processPath(e.rings,0):super.drawMarkerLayer(t,e)}drawHatchFill(t,e){this.drawSolidFill(t)}drawPictureFill(t,e){this.drawSolidFill(t)}drawGradientFill(t,e){this.drawSolidFill(t)}drawPictureStroke(t,e){this.drawSolidStroke(t,null,e.width)}drawGradientStroke(t,e){this.drawSolidStroke(t,null,e.width)}pushClipPath(t){this.drawSolidFill(t),this._clipCount++}popClipPath(){this._clipCount--}drawImage(t,e){const{url:s}=t,n=(0,A.$w)(t.scaleX,1);let i=n*e,r=e;const o=this._resourceManager.getResource(s);if(null!=o){const t=o.height/o.width;i=n*(e?t>1?e:e/t:o.width),r=e?t>1?e*t:e:o.height}this._merge(this.transformPt([-i/2,-r/2]),0),this._merge(this.transformPt([-i/2,r/2]),0),this._merge(this.transformPt([i/2,-r/2]),0),this._merge(this.transformPt([i/2,r/2]),0)}drawText(t,e){if(!e||0===e.length)return;this._textRasterizer||(this._textRasterizer=new I);const s=H(t);let[n,i]=this._textRasterizer.computeTextSize(e,s);n=(0,h.PN)(n),i=(0,h.PN)(i);const r=this.transformSize(1)*this.reverseTransformScalar(1);n*=r,i*=r;let o=0;switch(t.horizontalAlignment){case"Left":o=n/2;break;case"Right":o=-n/2}let a=0;switch(t.verticalAlignment){case"Bottom":a=i/2;break;case"Top":a=-i/2;break;case"Baseline":a=i/6}this._merge(this.transformPt([-n/2+o,-i/2+a]),0),this._merge(this.transformPt([-n/2+o,i/2+a]),0),this._merge(this.transformPt([n/2+o,-i/2+a]),0),this._merge(this.transformPt([n/2+o,i/2+a]),0)}_processPath(t,e){if(t)for(const s of t){const t=s?s.length:0;if(t>1){this._merge(this.transformPt(s[0]),e);for(let n=1;n<t;n++)this._merge(this.transformPt(s[n]),e)}}}_merge(t,e){t[0]-e<this._xmin&&(this._xmin=t[0]-e),t[0]+e>this._xmax&&(this._xmax=t[0]+e),t[1]-e<this._ymin&&(this._ymin=t[1]-e),t[1]+e>this._ymax&&(this._ymax=t[1]+e)}}class z extends G{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null,this._svg=null,this._path=null,this._canvas=null}destroy(){this._svg=(0,M.pK)(this._svg),this._path=null,this._canvas=null}hitTest(t,e,s,n,r,o){const a=o*(0,h.Lz)(1);this.setTransform(),this.setGeomUnitsPerPoint(a),this._searchPoint=[(t[0]+t[2])/2,(t[1]+t[3])/2],this._searchDistPoint=(t[2]-t[0])/2/a,this._textInfo=n;const l=e&&("CIMPointSymbol"===e.type&&"Map"!==e.angleAlignment||"CIMTextSymbol"===e.type);if(this._mapRotation=l?r:0,!(0,i.A)("esri-mobile")){const t=(0,h.PN)(D._M*window.devicePixelRatio),s=(0,h.PN)(D.ie);("CIMLineSymbol"!==e?.type&&"CIMPolygonSymbol"!==e?.type||!e.symbolLayers?.some(A.jn))&&"CIMMeshSymbol"!==e?.type&&((0,A.YC)(e)??0)<s&&(this._searchDistPoint=t)}return this._earlyReturn=!1,this.drawSymbol(e,s),this._earlyReturn}executeEffects(t,e){return"CIMGeometricEffectDashes"===t.at(-1)?.type&&(t=t.slice(0,-1)),super.executeEffects(t,e)}drawSolidFill(t,e,s){null!=s?this._hittestSvgPath(t,s,!0):this._hitTestFill(t)}drawHatchFill(t,e){this._hitTestFill(t)}drawPictureFill(t,e){this._hitTestFill(t)}drawGradientFill(t,e){this._hitTestFill(t)}drawSolidStroke(t,e,s,n,i,r,o){null!=o?this._hittestSvgPath(t,o,!1,s):this._hitTestStroke(t,s)}drawPictureStroke(t,e){this._hitTestStroke(t,e.width)}drawGradientStroke(t,e){this._hitTestStroke(t,e.width)}drawMarkerLayer(t,e){t.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===t.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===t.markerPlacement.type&&t.markerPlacement.clipAtBoundary)?this._hitTestFill(e):super.drawMarkerLayer(t,e)}pushClipPath(t){}popClipPath(){}drawImage(t,e){const{url:s}=t,n=(0,A.$w)(t.scaleX,1),i=this._resourceManager.getResource(s);if(null==i||0===i.height||0===e)return;const r=e*this.geomUnitsPerPoint(),o=r*n*(i.width/i.height),a=this.reverseTransformPt(this._searchPoint),l=this._searchDistPoint;Math.abs(a[0])<o/2+l&&Math.abs(a[1])<r/2+l&&(this._earlyReturn=!0)}drawText(t,e){const s=this._textInfo;if(!s)return;const n=s.get(t);if(!n)return;if(!n.glyphMosaicItems.glyphs.length)return;const i=(0,F.hV)((0,A.$w)(t.height,x.D.CIMTextSymbol.height)),{lineGapType:r,lineGap:o}=t,a=r?U(r,(0,A.$w)(o),i):0,l="CIMBackgroundCallout"===t.callout?.type,h=(0,N.Tl)(n.glyphMosaicItems,{scale:i/D.eG,angle:0,xOffset:0,yOffset:0,horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,maxLineWidth:(0,F.Lu)(t.lineWidth),lineHeight:D.DY*Math.max(.25,Math.min(a||1,4)),decoration:t.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}),u=this.reverseTransformPt(this._searchPoint),c=u[0],m=u[1];for(const d of h.glyphs)if(c>d.xTopLeft&&c<d.xBottomRight&&m>-d.yBottomRight&&m<-d.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(t){let e=null;if((0,g.ZC)(t)){const s=t;e=[[[s.xmin,s.ymin],[s.xmin,s.ymax],[s.xmax,s.ymax],[s.xmax,s.ymin],[s.xmin,s.ymin]]]}else if((0,g.Bi)(t))e=t.rings;else{if(!(0,g.Rg)(t))return;e=t.paths}const s=this.reverseTransformPt(this._searchPoint);(function(t,e){let s=0;for(const n of e){const e=n.length;for(let i=1;i<e;i++){const e=n[i-1],r=n[i];e[1]>t[1]!=r[1]>t[1]&&((r[0]-e[0])*(t[1]-e[1])-(r[1]-e[1])*(t[0]-e[0])>0?s++:s--)}}return 0!==s})(s,e)&&(this._earlyReturn=!0),this._earlyReturn||q(s,e,this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}_getSvgPath(){return null!=this._svg&&null!=this._path||(this._svg??=(0,M.p)(),this._path??=(0,M.FJ)("path"),this._svg.appendChild(this._path)),this._path}_getCanvasContext(t,e){return this._canvas??=document.createElement("canvas"),this._canvas.width=t,this._canvas.height=e,this._canvas.getContext("2d",{willReadFrequently:!0})}_hittestSvgPath(t,e,s,n=0){const i=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),r=this.reverseTransformPt(this._searchPoint),o=(0,c.vt)();(0,m.Rg)(o,t);const a=o[0],l=o[1],h=o[2]-o[0],u=o[3]-o[1],d=this._getSvgPath();d.setAttribute("d",e);const g=d.getBBox();let p=Math.max(g.width/h,g.height/u),_=1;const f=2*i*p;f<1&&(_=2/f,p*=_,g.x*=_,g.y*=_,g.width*=_,g.height*=_);const y=1+n*p/2,x=this._getCanvasContext(g.width+2*y,g.height+2*y);x.setTransform(_,0,0,_,-g.x+y,-g.y+y);const v=new Path2D(e);s?x.fill(v):(x.lineWidth=n*(p/_),x.stroke(v));const b=(h*p-g.width)/2,P=(u*p-g.height)/2,S=Math.floor((r[0]-a-i)*p-b+y),E=Math.floor((u-(r[1]-l)-i)*p+P+y),C=Math.ceil(2*i*p),w=Math.ceil(2*i*p),I=x.getImageData(S,E,C,w).data;for(let c=3;c<I.length;c+=4)if(I[c]>127.5)return void(this._earlyReturn=!0)}_hitTestStroke(t,e){let s=null;if((0,g.ZC)(t)){const e=t;s=[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}else if((0,g.Bi)(t))s=t.rings;else{if(!(0,g.Rg)(t))return;s=t.paths}q(this.reverseTransformPt(this._searchPoint),s,(0,A.$w)(e,x.D.CIMSolidStroke.width)*this.geomUnitsPerPoint()/2+this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}}class O extends G{constructor(t,e,s,n){super(e,s),this._applyAdditionalRenderProps=n,this._colorSubstitutionHelper=new _,this._ctx=t}drawSolidFill(t,e){if(!t)return;if((0,g.Bi)(t))this._buildPath(t.rings,!0);else if((0,g.Rg)(t))this._buildPath(t.paths,!0);else if((0,g.ZC)(t))this._buildPath(Y(t).rings,!0);else{if(!(0,g.U9)(t))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const s=this._ctx;s.fillStyle="string"==typeof e?e:"rgba("+Math.round(e[0])+","+Math.round(e[1])+","+Math.round(e[2])+","+(e[3]??255)/255+")",s.fill("evenodd")}drawSolidStroke(t,e,s,n,i,r){if(!t||!e||0===s)return;if((0,g.Bi)(t))this._buildPath(t.rings,!0);else if((0,g.Rg)(t))this._buildPath(t.paths,!1);else{if(!(0,g.ZC)(t))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(Y(t).rings,!0)}const o=this._ctx;o.strokeStyle="string"==typeof e?e:"rgba("+Math.round(e[0])+","+Math.round(e[1])+","+Math.round(e[2])+","+(e[3]??255)/255+")",o.lineWidth=Math.max(this.transformSize(s),.5),this._setCapStyle(n),this._setJoinStyle(i),o.miterLimit=r,o.stroke()}pushClipPath(t){if(this._ctx.save(),(0,g.Bi)(t))this._buildPath(t.rings,!0);else if((0,g.Rg)(t))this._buildPath(t.paths,!0);else{if(!(0,g.ZC)(t))return;this._buildPath(Y(t).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(t,e){const{colorSubstitutions:s,url:n,tintColor:i}=t,r=(0,A.$w)(t.scaleX,1),o=this._resourceManager.getResource(n);if(null==o)return;let a=e*(o.width/o.height),l=e;e||(a=o.width,l=o.height);const h=(0,A.UE)(n)||"src"in o&&(0,A.UE)(o.src);let u="getFrame"in o?b(o):o;s&&(u=this._colorSubstitutionHelper.applyColorSubstitution(u,s)),this._applyAdditionalRenderProps&&!h&&i&&(u=this._colorSubstitutionHelper.tintImageData(u,i));const c=this.transformPt([0,0]),[m,d]=this.getTransformAngle(),g=this.transformSize(1),p=this._ctx;p.save(),p.setTransform({m11:r*g*m,m12:r*g*d,m21:-g*d,m22:g*m,m41:c[0],m42:c[1]}),p.drawImage(u,-a/2,-l/2,a,l),p.restore()}drawText(t,e){if(!e||0===e.length)return;this._textRasterizer||(this._textRasterizer=new I);const s=H(t,this.transformSize((0,h.PN)(1))),n=this._textRasterizer.rasterizeText(e,s);if(!n)return;const{size:i,anchorX:r,anchorY:o,canvas:a}=n,l=i[0]*(r+.5),u=i[1]*(o-.5),c=this._ctx,m=this.transformPt([0,0]),[d,g]=this.getTransformAngle();c.save(),c.setTransform({m11:1*d,m12:1*g,m21:-1*g,m22:1*d,m41:m[0]-1*l,m42:m[1]+1*u}),c.drawImage(a,0,0),c.restore()}drawPictureFill(t,e){if(!t)return;let{colorSubstitutions:s,height:n,offsetX:i,offsetY:r,rotation:o,scaleX:a,tintColor:l,url:h}=e;const u=this._resourceManager.getResource(h);if(null==u)return;if((0,g.Bi)(t))this._buildPath(t.rings,!0);else if((0,g.Rg)(t))this._buildPath(t.paths,!0);else if((0,g.ZC)(t))this._buildPath(Y(t).rings,!0);else{if(!(0,g.U9)(t))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const c=this._ctx,m=(0,A.UE)(h)||"src"in u&&(0,A.UE)(u.src);let d,p="getFrame"in u?b(u):u;if(s&&(p=this._colorSubstitutionHelper.applyColorSubstitution(p,s)),this._applyAdditionalRenderProps){m||l&&(p=this._colorSubstitutionHelper.tintImageData(p,l)),d=c.createPattern(p,"repeat");const t=this.transformSize(1);o||(o=0),i?i*=t:i=0,r?r*=t:r=0,n&&(n*=t);const e=n?n/u.height:1,s=a&&n?a*n/u.width:1;if(0!==o||1!==e||1!==s||0!==i||0!==r){const t=new DOMMatrix;t.rotateSelf(0,0,-o).translateSelf(i,r).scaleSelf(s,e,1),d.setTransform(t)}}else d=c.createPattern(p,"repeat");c.save(),c.fillStyle=d,c.fill("evenodd"),c.restore()}drawPictureStroke(t,e){if(!t)return;let{colorSubstitutions:s,capStyle:n,joinStyle:i,miterLimit:o,tintColor:a,url:l,width:u}=e;const c=this._resourceManager.getResource(l);if(null==c)return;let m;if((0,g.Bi)(t))m=t.rings;else if((0,g.Rg)(t))m=t.paths;else{if(!(0,g.ZC)(t))return(0,g.U9)(t)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;m=Y(t).rings}u||(u=c.width);const d=(0,A.UE)(l)||"src"in c&&(0,A.UE)(c.src);let p="getFrame"in c?b(c):c;s&&(p=this._colorSubstitutionHelper.applyColorSubstitution(p,s)),this._applyAdditionalRenderProps&&(d||a&&(p=this._colorSubstitutionHelper.tintImageData(p,a)));const _=Math.max(this.transformSize((0,h.Lz)(u)),.5),f=_/p.width,y=this._ctx,x=y.createPattern(p,"repeat-y");let v,P;y.save(),this._setCapStyle(n),this._setJoinStyle(i),void 0!==o&&(y.miterLimit=o),y.lineWidth=_;for(let h of m)if(h=(0,r.o8)(h),j(h),h&&!(h.length<=1)){v=this.transformPt(h[0]);for(let t=1;t<h.length;t++){P=this.transformPt(h[t]);const e=B(v,P),s=new DOMMatrix;s.translateSelf(0,v[1]-_/2).scaleSelf(f,f,1).rotateSelf(0,0,90-e),x.setTransform(s),y.strokeStyle=x,y.beginPath(),y.moveTo(v[0],v[1]),y.lineTo(P[0],P[1]),y.stroke(),v=P}}y.restore()}drawGradientFill(t,e){if(!t)return;let s;if((0,g.Bi)(t))s=t.rings;else if((0,g.Rg)(t))s=t.paths;else{if(!(0,g.ZC)(t))return void k().error("Unable to draw gradient fill");s=Y(t).rings}this._buildPath(s,!0);const{angle:n,gradientMethod:i,gradientSize:r,gradientSizeUnits:o}=e,l=x.D.CIMGradientFill,u=e.gradientType??l.gradientType,m=-(0,a.kU)(n??0),d=(0,c.Ie)();for(const a of s){const t=a?a.length:0;if(t>1)for(let e=0;e<t;e++){let t=this.transformPt(a[e]);"Linear"!==i&&"Rectangular"!==i||(t=P(t,-m)),(0,c.tK)(d,t)}}const[p,_,f,y]=d,v=this._ctx;switch(v.save(),i){case"Buffered":k().error(`Gradient method "${i}" currently unsupported.`);break;case"Linear":{const t=(_+y)/2,s="Absolute"===o?this.transformSize((0,h.Lz)(r)):(0,A.yX)(r,l.gradientSize)*(f-p),[n,i]="Discrete"===u?[f,f-s]:[p+s,p],a=P([n,t],m),c=P([i,t],m),d=v.createLinearGradient(a[0],a[1],c[0],c[1]);(0,S.AH)(d,e),v.fillStyle=d,v.fill("evenodd");break}case"Circular":{const t=(0,c.gX)(d),s=(0,c.ib)(d)/2,n="Absolute"===o?this.transformSize((0,h.Lz)(r)):(0,A.yX)(r,l.gradientSize)*s,[i,a]="Discrete"===u?[s,s-n]:[n,0],m=v.createRadialGradient(t[0],t[1],i,t[0],t[1],a);(0,S.AH)(m,e),v.fillStyle=m,v.fill("evenodd");break}case"Rectangular":{const s=(0,c.gX)(d),n=s[0],i=s[1],a=P(s,m),g=(s,n,i,r,o,l,h,u)=>{v.save(),this.pushClipPath(t);const c=P([o,l],m),d=P([h,u],m);v.beginPath(),v.moveTo(a[0],a[1]),v.lineTo(c[0],c[1]),v.lineTo(d[0],d[1]),v.lineTo(a[0],a[1]),v.clip();const g=P([s,n],m),p=P([i,r],m),_=v.createLinearGradient(g[0],g[1],p[0],p[1]);(0,S.AH)(_,e),v.fillStyle=_,v.fill("evenodd"),v.restore()};let x="Absolute"===o?this.transformSize((0,h.Lz)(r)):(0,A.yX)(r,l.gradientSize)*((0,c.VL)(d)/2),[b,E]="Discrete"===u?[f,f-x]:[n+x,n];g(b,i,E,i,f,_,f,y),[b,E]="Discrete"===u?[p,p+x]:[n-x,n],g(b,i,E,i,p,y,p,_),x="Absolute"===o?this.transformSize((0,h.Lz)(r)):(0,A.yX)(r,l.gradientSize)*((0,c.uJ)(d)/2);let[C,w]="Discrete"===u?[y,y-x]:[i+x,i];g(n,C,n,w,f,y,p,y),[C,w]="Discrete"===u?[_,_+x]:[i-x,i],g(n,C,n,w,p,_,f,_);break}}v.restore()}drawGradientStroke(t,e){const{capStyle:s,gradientMethod:n,gradientSize:i,gradientSizeUnits:o,joinStyle:a,miterLimit:l,width:u}=e;if(!t||0===u)return;let c;if((0,g.Bi)(t))c=t.rings;else if((0,g.Rg)(t))c=t.paths;else{if(!(0,g.ZC)(t))return void k().error("Unable to draw gradient stroke");c=Y(t).rings}const m=e.gradientType??x.D.CIMGradientStroke.gradientType,d=Math.max(this.transformSize((0,h.Lz)(u)),.5),p=this._ctx;let _,f;p.save(),this._setCapStyle(s),this._setJoinStyle(a),void 0!==l&&(p.miterLimit=l),p.lineWidth=d;for(let g of c){if(g=(0,r.o8)(g),j(g),!g||g.length<=1)continue;let t=0;_=this.transformPt(g[0]);for(let e=1;e<g.length;e++){f=this.transformPt(g[e]);const s=f[0]-_[0],n=f[1]-_[1];t+=Math.sqrt(s*s+n*n),_=f}const s="Absolute"===o?this.transformSize((0,h.Lz)(i)):(0,A.yX)(i,x.D.CIMGradientStroke.gradientSize)*("AcrossLine"===n?d:t);let a=0;_=this.transformPt(g[0]);for(let i=1;i<g.length;i++){f=this.transformPt(g[i]);const r=f[0]-_[0],o=f[1]-_[1],l=Math.sqrt(r*r+o*o);let h,u,c,y;switch(n){case"AcrossLine":{const[t,e]=P([r/l,o/l],-Math.PI/2),n=d/2,i="Discrete"===m?n:s-n;h=(_[0]+f[0])/2+t*i,u=(_[1]+f[1])/2+e*i,c=h-t*s,y=u-e*s;break}case"AlongLine":{const e=r/l,n=o/l;"Discrete"===m?(h=_[0]-e*a,u=_[1]-n*a,c=h+e*s,y=u+n*s):(c=_[0]+e*(t-a),y=_[1]+n*(t-a),h=c-e*s,u=y-n*s);break}default:return k().error("Unrecognized gradient method:",n),void p.restore()}const x=p.createLinearGradient(h,u,c,y);(0,S.AH)(x,e),p.strokeStyle=x,p.beginPath(),p.moveTo(_[0],_[1]),p.lineTo(f[0],f[1]),p.stroke(),a+=l,_=f}}p.restore()}_buildPath(t,e){const s=this._ctx;if(s.beginPath(),t)for(const n of t){const t=n?n.length:0;if(t>1){let i=this.transformPt(n[0]);s.moveTo(i[0],i[1]);for(let e=1;e<t;e++)i=this.transformPt(n[e]),s.lineTo(i[0],i[1]);e&&s.closePath()}}}_setCapStyle(t){switch(t){case v.uT.Butt:this._ctx.lineCap="butt";break;case v.uT.Round:this._ctx.lineCap="round";break;case v.uT.Square:this._ctx.lineCap="square"}}_setJoinStyle(t){switch(t){case v.wd.Bevel:this._ctx.lineJoin="bevel";break;case v.wd.Round:this._ctx.lineJoin="round";break;case v.wd.Miter:this._ctx.lineJoin="miter"}}}function q(t,e,s){for(const n of e){const e=n.length;for(let i=1;i<e;i++){const e=n[i-1],r=n[i];let o=(r[0]-e[0])*(r[0]-e[0])+(r[1]-e[1])*(r[1]-e[1]);if(0===o)continue;o=Math.sqrt(o);const a=((r[0]-e[0])*(t[1]-e[1])-(r[1]-e[1])*(t[0]-e[0]))/o;if(Math.abs(a)<s){const n=((r[0]-e[0])*(t[0]-e[0])+(r[1]-e[1])*(t[1]-e[1]))/o;if(n>-s&&n<o+s)return!0}}}return!1}function B(t,e){const s=e[0]-t[0],n=e[1]-t[1];return 180/Math.PI*Math.atan2(n,s)}const Y=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null,U=(t,e,s)=>{switch(t){case"ExtraLeading":return 1+e/s;case"Multiple":return e;case"Exact":return e/s}};function H(t,e=1){const s=(0,A.DW)(t),i=(0,A._d)(t.fontStyleName),r=t.fontFamilyName??n.Vb,{weight:o,style:a}=i,l=e*(t.height||5),h=(0,A.Bu)(t.horizontalAlignment),u=(0,A.Nl)(t.verticalAlignment),c=(0,A.pM)(t),m=(0,A.pM)(t.haloSymbol),d=null!=m?e*(t.haloSize??0):0,g=(0,A._1)(t.symbol),p=e*((0,A.xo)(t.symbol)||0),_="CIMBackgroundCallout"===t.callout?.type?t.callout.backgroundSymbol:null,f=(0,A.pM)(_),y=(0,A.xo)(_),x=(0,A._1)(_);return{color:c,size:l,horizontalAlignment:h,verticalAlignment:u,font:{family:r,style:(0,A.pV)(a),weight:(0,A.Kn)(o),decoration:s},outline:{size:p||0,color:g},halo:{size:d||0,color:m,style:a},backgroundColor:f,borderLine:null!=y&&null!=x?{size:y,color:x}:null,pixelRatio:1,premultiplyColors:!0}}const X=1e-4;function j(t){let e,s,n,i,r,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],s=t[a][1]-o[1],i=0!==e?s/e:Math.PI/2,void 0!==n&&Math.abs(i-n)<=X?(t.splice(a-1,1),o=r):(r=o,o=t[a],a++),n=i}},48002:(t,e,s)=>{s.d(e,{BW:()=>Y,Sc:()=>N,Vb:()=>I,ll:()=>D,wp:()=>F});var n=s(21870),i=s(39831),r=s(19251),o=s(539),a=s(9272),l=s(89882),h=s(80510),u=s(36358),c=s(60340),m=s(82250),d=s(26502),g=s(7591),p=s(63643),_=s(50072),f=s(26207),y=s(15946),x=s(43556),v=s(42695),b=s(98502);const P=Math.PI,S=P/2,E=Math.PI/180,C=96/72,w=()=>o.A.getLogger("esri.symbols.cim.CIMSymbolHelper");function I(t){let e;switch(t.type){case"cim":return t.data;case"web-style":return t;case"simple-marker":{const s=F.fromSimpleMarker(t);if(!s)throw new Error("InternalError: Cannot convert symbol to CIM");e=s;break}case"picture-marker":e=F.fromPictureMarker(t);break;case"simple-line":e=F.fromSimpleLineSymbol(t);break;case"simple-fill":e=F.fromSimpleFillSymbol(t);break;case"picture-fill":e=F.fromPictureFillSymbol(t);break;case"text":e=F.fromTextSymbol(t)}return{type:"CIMSymbolReference",symbol:e}}function T(t,e,s){switch(e.type){case"CIMSymbolReference":return T(t,e.symbol,s);case"CIMPointSymbol":null==s&&(s={x:0,y:0}),t.drawSymbol(e,s);break;case"CIMLineSymbol":null==s&&(s={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,s);break;case"CIMPolygonSymbol":null==s&&(s={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,s);break;case"CIMTextSymbol":{const s={x:0,y:0};t.drawSymbol(e,s);break}case"CIMVectorMarker":{const s=new m.W;t.drawMarker(e,s);break}}return t.envelope()}function A(t){if(!t)return 0;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAtExtremities":case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementAtRatioPositions":case"CIMMarkerPlacementOnLine":case"CIMMarkerPlacementOnVertices":return Math.abs(t.offset);default:return 0}}function M(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs((0,_.$w)(t.offsetX)),Math.abs((0,_.$w)(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function D(t){if(!t)return 0;let e=0;for(const s of t)e+=M(s);return e}class N{static getSymbolInflateSize(t,e,s,n,i){return t||(t=[0,0,0,0]),e?this._getInflateSize(t,e,s,n,i):t}static safeSize(t){const e=Math.max(Math.abs(t[0]),Math.abs(t[2])),s=Math.max(Math.abs(t[1]),Math.abs(t[3]));return Math.sqrt(e*e+s*s)}static _vectorMarkerBounds(t,e,s,n){let i=!0;const r=(0,h.vt)();if(e?.markerGraphics)for(const o of e.markerGraphics){const e=[0,0,0,0];o.geometry&&((0,u.Rg)(r,o.geometry),e[0]=0,e[1]=0,e[2]=0,e[3]=0,this.getSymbolInflateSize(e,o.symbol,s,0,n),r[0]+=e[0],r[1]+=e[1],r[2]+=e[2],r[3]+=e[3],i?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],i=!1):(t[0]=Math.min(t[0],r[0]),t[1]=Math.min(t[1],r[1]),t[2]=Math.max(t[2],r[2]),t[3]=Math.max(t[3],r[3])))}return t}static _getInflateSize(t,e,s,n,i){if(function(t){return void 0!==t.symbolLayers}(e)){const r=this._getLayersInflateSize(t,e.symbolLayers,s,n,i),o=D(e.effects);return o>0&&(r[0]-=o,r[1]-=o,r[2]+=o,r[3]+=o),r}return this._getTextInflatedSize(t,e,i)}static _getLayersInflateSize(t,e,s,n,i){let r=!0;if(!e)return t;for(const o of e){if(!o)continue;let e=[0,0,0,0];switch(o.type){case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const t=o;let s=t.width;null!=s&&(t.capStyle===p.uT.Square||t.joinStyle===p.wd.Miter?s/=1.4142135623730951:s/=2,e[0]=-s,e[1]=-s,e[2]=s,e[3]=s);break}case"CIMCharacterMarker":case"CIMVectorMarker":case"CIMPictureMarker":{const t=o;if("CIMVectorMarker"===o.type){const t=o;if(e=this._vectorMarkerBounds(e,t,s,i),t.frame){const s=(t.frame.xmin+t.frame.xmax)/2,n=(t.frame.ymin+t.frame.ymax)/2;if(e[0]-=s,e[1]-=n,e[2]-=s,e[3]-=n,null!=t.size){const s=t.size/(t.frame.ymax-t.frame.ymin);e[0]*=s,e[1]*=s,e[2]*=s,e[3]*=s}}}else if("CIMPictureMarker"===o.type){const n=o,i=s.getResource(n.url);let r=1;if(null!=i&&i.height&&(r=i.width/i.height),null!=t.size){const s=t.size/2,i=t.size*r*n.scaleX/2;e=[-i,-s,i,s]}}else if(null!=t.size){const s=t.size/2;e=[-s,-s,s,s]}if(t.anchorPoint){let s,n;"Absolute"===t.anchorPointUnits?(s=t.anchorPoint.x,n=t.anchorPoint.y):(s=t.anchorPoint.x*(e[2]-e[0]),n=t.anchorPoint.y*(e[3]-e[1]));const i=1.25*Math.sqrt(s*s+n*n);e[0]-=i,e[1]-=i,e[2]+=i,e[3]+=i}let r=(0,_.$w)(t.rotation);if(t.rotateClockwise&&(r=-r),n&&(r-=n),r){const t=E*r,s=Math.cos(t),n=Math.sin(t),i=(0,h.vt)([y.MG,y.MG,-y.MG,-y.MG]);(0,h.tK)(i,[e[0]*s-e[1]*n,e[0]*n+e[1]*s]),(0,h.tK)(i,[e[0]*s-e[3]*n,e[0]*n+e[3]*s]),(0,h.tK)(i,[e[2]*s-e[1]*n,e[2]*n+e[1]*s]),(0,h.tK)(i,[e[2]*s-e[3]*n,e[2]*n+e[3]*s]),e=i}let a=(0,_.$w)(t.offsetX),l=(0,_.$w)(t.offsetY);if(n){const t=E*n,e=Math.cos(t),s=Math.sin(t),i=a*s+l*e;a=a*e-l*s,l=i}e[0]+=a,e[1]+=l,e[2]+=a,e[3]+=l;const u=A(t.markerPlacement);u>0&&(e[0]-=u,e[1]-=u,e[2]+=u,e[3]+=u);break}}const a=D(o.effects);a>0&&(e[0]-=a,e[1]-=a,e[2]+=a,e[3]+=a),r?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],r=!1):(t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[2]),t[3]=Math.max(t[3],e[3]))}return t}static _getTextInflatedSize(t,e,s){const n=(0,b.hV)(e.height??g.D.CIMTextSymbol.height);if(t[0]=-n/2,t[1]=-n/2,t[2]=n/2,t[3]=n/2,!s)return t;const i=s.get(e);if(!i)return t;if(!i.glyphMosaicItems.glyphs.length)return t;const{lineGapType:r,lineGap:o}=e,a=r?(0,d.QF)(r,o??0,n):0,l="CIMBackgroundCallout"===e.callout?.type,h=(0,v.Tl)(i.glyphMosaicItems,{scale:n/x.eG,angle:(0,_.$w)(e.angle),xOffset:(0,_.$w)(e.offsetX),yOffset:(0,_.$w)(e.offsetY),horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:(0,b.Lu)(e.lineWidth),lineHeight:x.DY*Math.max(.25,Math.min(a||1,4)),decoration:e.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}).boundsT,u=Math.sqrt(h.width*h.width+h.height*h.height);return t[0]-=h.x+u,t[1]-=h.y-u,t[2]+=h.x+u,t[3]+=-h.y+u,t}}class F{static getEnvelope(t,e,s){if(!t)return null;const n=new d.mx(s);if(Array.isArray(t)){let s;for(const i of t)s?s.union(T(n,i,e)):s=T(n,i,e);return s}return T(n,t,e)}static getTextureInfo(t,e,s,n,i){const r=n??this.getEnvelope(t,null,e);if(!r)return[0,0,0,0,1];const o=Math.max(r.width,r.height)*C;let a=null!=i?Math.max(i/o,1):1;a*=C,r.x*=a,r.y*=a,r.width*=a,r.height*=a,r.width=Math.max(Math.ceil(r.x+r.width)-Math.floor(r.x),1)-1,r.height=Math.max(Math.ceil(r.y+r.height)-Math.floor(r.y),1)-1;let l=r.x+.5*r.width,h=r.y+.5*r.height;return l+=r.x-Math.floor(r.x),h+=r.y-Math.floor(r.y),n||(r.width+=s,r.height+=s,l+=s/2,h+=s/2),[r.width,r.height,l,h,a]}static getTextureAnchor(t,e,s){const[n,i,r,o,a]=this.getTextureInfo(t,e,2,null,s);return[-r/n,-o/i,i/a*C]}static rasterize(t,e,s,n,i=!0,r){const[o,a,l,h,u]=this.getTextureInfo(e,n,2,s,r);t.width=o,t.height=a;const c=t.getContext("2d",{willReadFrequently:!0}),g=d.IT.createScale(u,-u);g.translate(.5*o-l,.5*a+h);const p=new d.Rj(c,n,g);switch(e.type){case"CIMPointSymbol":{const t={type:"point",x:0,y:0};p.drawSymbol(e,t);break}case"CIMVectorMarker":{const t=new m.W;p.drawMarker(e,t);break}}const _=c.getImageData(0,0,t.width,t.height),f=new Uint8Array(_.data);if(i){let t;for(let e=0;e<f.length;e+=4)t=f[e+3]/255,f[e]=f[e]*t,f[e+1]=f[e+1]*t,f[e+2]=f[e+2]*t}return[f,t.width,t.height,-l/o,-h/a]}static fromTextSymbol(t){const{text:e}=t;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:F.createCIMTextSymbolfromTextSymbol(t),textString:e}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(t){const{height:e,outline:s,width:n,xoffset:i,xscale:r,yoffset:o,yscale:a}=t,l=[],h={type:"CIMPolygonSymbol",symbolLayers:l};if(s){const t=X(s);t&&l.push(t)}let u=t.url;"esriPFS"===t.type&&t.imageData&&(u=t.imageData);const c="angle"in t?t.angle??0:0,m=(n??0)*(r||1),d=(e??0)*(a||1);return l.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:p.O$.Picture,tintColor:null,url:u,height:d,width:m,offsetX:(0,_.$w)(i),offsetY:(0,_.$w)(o),rotation:(0,_.$w)(-c),colorSubstitutions:null}),h}static fromSimpleFillSymbol(t){const{color:e,style:s,outline:n}=t,i=[],o={type:"CIMPolygonSymbol",symbolLayers:i};if(n){const t=X(n);t&&i.push(t)}if(s&&"solid"!==s&&"none"!==s&&"esriSFSSolid"!==s&&"esriSFSNull"!==s){const t={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:z(e),capStyle:p.uT.Butt,joinStyle:p.wd.Miter,width:.75}]};let n=0;const o=(0,l.PN)(H(s)?8:10);switch(s){case"vertical":case"esriSFSVertical":n=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":n=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":n=45;break;case"cross":case"esriSFSCross":n=0}i.push({type:"CIMHatchFill",lineSymbol:t,offsetX:0,offsetY:0,rotation:n,separation:o}),"cross"===s||"esriSFSCross"===s?i.push({type:"CIMHatchFill",lineSymbol:(0,r.o8)(t),offsetX:0,offsetY:0,rotation:90,separation:o}):"diagonal-cross"!==s&&"esriSFSDiagonalCross"!==s||i.push({type:"CIMHatchFill",lineSymbol:(0,r.o8)(t),offsetX:0,offsetY:0,rotation:45,separation:o})}else!s||"solid"!==s&&"esriSFSSolid"!==s||i.push({type:"CIMSolidFill",enable:!0,color:z(e)});return o}static fromSimpleLineSymbol(t){const{cap:e,color:s,join:n,marker:i,miterLimit:r,style:o,width:a}=t;let l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:Y(o,e),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const h=[];if(i){let t;switch(i.placement){case"begin-end":t=p.$2.Both;break;case"begin":t=p.$2.JustBegin;break;case"end":t=p.$2.JustEnd;break;default:t=p.$2.None}const e=F.fromSimpleMarker(i,a,s).symbolLayers[0];e.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:t,offsetAlongLine:0},h.push(e)}return h.push({type:"CIMSolidStroke",color:"none"!==o&&"esriSLSNull"!==o?z(s):[0,0,0,0],capStyle:k(e),joinStyle:L(n),miterLimit:r,width:a,effects:l}),{type:"CIMLineSymbol",symbolLayers:h}}static fromPictureMarker(t){const{angle:e,height:s,width:n,xoffset:i,yoffset:r}=t;let o=t.url;return"esriPMS"===t.type&&t.imageData&&(o=t.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:p.O$.Picture,tintColor:null,url:o,size:s,width:n,offsetX:(0,_.$w)(i),offsetY:(0,_.$w)(r),rotation:(0,_.$w)(-e)}]}}static createCIMTextSymbolfromTextSymbol(t){const{angle:e,color:s,font:i,haloColor:r,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:h,text:u,verticalAlignment:c,xoffset:m,yoffset:d,backgroundColor:g,borderLineColor:f,borderLineSize:y}=t;let x,v,b,P,S,E;i&&(x=i.family,v=i.style,b=i.weight,P=i.size,S=i.decoration);let C=!1;return u&&(C=(0,n.y)(u)[1]),(g||y)&&(E={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:z(g)},{type:"CIMSolidStroke",color:z(f),width:y}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:e,blockProgression:p.TZ.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:p.Y.Normal,fontEncoding:p.bj.Unicode,fontFamilyName:x||"Arial",fontStyleName:O(v,b),fontType:p.g7.Unspecified,haloSize:o,height:P,hinting:p.mU.Default,horizontalAlignment:G(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:h,offsetX:(0,_.$w)(m),offsetY:(0,_.$w)(d),strikethrough:"line-through"===S,underline:"underline"===S,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:z(s)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:z(r)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:C?p.f0.RTL:p.f0.LTR,verticalAlignment:V(c??"baseline"),verticalGlyphOrientation:p.vG.Right,wordSpacing:100,billboardMode3D:p.xn.FaceNearPlane,callout:E}}static createPictureMarkerRasterizationParam(t){const{angle:e,height:s,width:n,xoffset:i,yoffset:r}=t,o=t.url??t.source?.url??t.source?.imageData;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:p.O$.Picture,tintColor:null,url:o,size:s,width:n,offsetX:(0,_.$w)(i),offsetY:(0,_.$w)(r),rotation:(0,_.$w)(-e)}}:null}static createPictureFillRasterizationParam(t){const{width:e,height:s,xoffset:n,yoffset:i,url:r}=t;return r?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:p.O$.Picture,tintColor:null,url:r,width:e,height:s,offsetX:(0,_.$w)(n),offsetY:(0,_.$w)(i),rotation:0}}:null}static fromSimpleMarker(t,e,s){const{style:n}=t,i=t.color??s;if("path"===n||"esriSMSPath"===n){const e=[];if("outline"in t&&t.outline){const s=t.outline;e.push({type:"CIMSolidStroke",enable:!0,width:s.width,color:z(s.color),path:t.path})}e.push({type:"CIMSolidFill",enable:!0,color:z(i),path:t.path});const[s,n]=U("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-(0,_.$w)(t.angle),size:(0,_.$w)(t.size||6),offsetX:(0,_.$w)(t.xoffset),offsetY:(0,_.$w)(t.yoffset),scaleSymbolsProportionally:!1,frame:s,markerGraphics:[{type:"CIMMarkerGraphic",geometry:n,symbol:{type:"CIMPolygonSymbol",symbolLayers:e}}]}]}}const r=[];let o,a,l=t.size;if("outline"in t&&t.outline&&"none"!==t.outline.style&&"esriSLSNull"!==t.outline.style){const e=t.outline,s="solid"!==e.style&&"esriSLSSolid"!==e.style;[o,a]=s?U(n,t.size):U(n);const i=e.width??f.A7.width;if(s){const e=i/t.size,s=(o.xmax-o.xmin)*e/2,n=(o.ymax-o.ymin)*e/2;o.xmin-=s,o.xmax+=s,o.ymin-=n,o.ymax+=n,l&&(l+=i)}const h="cross"!==t.style&&"x"!==t.style||"dot"===t?.outline.style||"short-dot"===t?.outline.style?p.yS.HalfGap:p.yS.FullPattern,u=s?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:Y(e.style,null).map((t=>e.width&&e.width>0?t*e.width:t)),lineDashEnding:h,controlPointEnding:p.yS.FullPattern}]:void 0;r.push({type:"CIMSolidStroke",capStyle:s?p.uT.Round:p.uT.Butt,enable:!0,width:i,color:z(e.color),effects:u})}else!e||"line-marker"!==t.type||"cross"!==t.style&&"x"!==t.style?[o,a]=U(n):([o,a]=U(n),r.push({type:"CIMSolidStroke",enable:!0,width:e,color:z(i)}));r.push({type:"CIMSolidFill",enable:!0,color:z(i)});const h={type:"CIMPolygonSymbol",symbolLayers:r};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:(0,_.$w)(-t.angle),size:(0,_.$w)(l||6*e),offsetX:(0,_.$w)(t.xoffset),offsetY:(0,_.$w)(t.yoffset),scaleSymbolsProportionally:!1,frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:h}]}]}}static fromCIMHatchFill(t,e){const s=e*(t.separation??g.D.CIMHatchFill.separation),n=s/2,i=(0,r.o8)(t.lineSymbol);i.symbolLayers?.forEach((t=>{switch(t.type){case"CIMSolidStroke":null!=t.width&&(t.width*=e),t.effects?.forEach((t=>{if("CIMGeometricEffectDashes"===t.type){const s=t.dashTemplate;t.dashTemplate=s?.map((t=>t*e))}}));break;case"CIMVectorMarker":{null!=t.size&&(t.size*=e);const s=t.markerPlacement;null!=s&&"placementTemplate"in s&&(s.placementTemplate=s.placementTemplate.map((t=>t*e)));break}}}));let o=this._getLineSymbolPeriod(i)||4;for(;o<4;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-n,ymax:n},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:i}],size:s}}static fetchResources(t,e,s,n=null){return t&&e?(R(t,(t=>{(function(t,e,s){if(!t.effects||null!=e.geometryEngine)return;if(e.geometryEnginePromise)return void s.push(e.geometryEnginePromise);(0,_.yH)(t.effects)&&(e.geometryEnginePromise=(0,_._H)(),s.push(e.geometryEnginePromise),e.geometryEnginePromise.then((t=>e.geometryEngine=t)))})(t,e,s),"url"in t&&t.url&&s.push(e.fetchResource(t.url,{signal:n}))})),s):s}static fetchFonts(t,e,s){if(t&&e)if("symbolLayers"in t&&t.symbolLayers){for(const n of t.symbolLayers)if("CIMVectorMarker"===n.type&&n.markerGraphics)for(const t of n.markerGraphics)t?.symbol&&F.fetchFonts(t.symbol,e,s)}else if("CIMTextSymbol"===t.type){const{fontFamilyName:n,fontStyleName:i}=t;if(!n||"calcitewebcoreicons"===n.toLowerCase())return;const{style:r,weight:o}=(0,_._d)(i),a=(0,_.DW)(t),l=new c.A({family:n,style:r,weight:o,decoration:a});s.push(e.loadFont(l).catch((()=>{w().error(`Unsupported font ${n} in CIM symbol`)})))}}static _getLineSymbolPeriod(t){if(t){const e=this._getEffectsRepeat(t.effects);if(e)return e;if(t.symbolLayers)for(const s of t.symbolLayers)if(s){const t=this._getEffectsRepeat(s.effects);if(t)return t;switch(s.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const t=this._getPlacementRepeat(s.markerPlacement);if(t)return t}}}}return 0}static _getEffectsRepeat(t){if(t)for(const e of t)if(e)switch(e.type){case"CIMGeometricEffectDashes":{const t=e.dashTemplate;if(t&&t.length){let e=0;for(const s of t)e+=s;return 1&t.length&&(e*=2),e}break}case"CIMGeometricEffectWave":return e.period;default:w().error(`unsupported geometric effect type ${e.type}`)}return 0}static _getPlacementRepeat(t){if(t)switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const e=t.placementTemplate;if(e&&e.length){let t=0;for(const s of e)t+=+s;return 1&e.length&&(t*=2),t}break}}return 0}static fromCIMInsidePolygon(t){const e=t.markerPlacement,s={...t};s.markerPlacement=null,s.anchorPoint=null;const n=Math.abs(e.stepX),i=Math.abs(e.stepY),r=(e.randomness??100)/100;let o,h,u,c;if("Random"===e.gridType){const t=(0,l.PN)(x.yv),s=Math.max(Math.floor(t/n),1),m=Math.max(Math.floor(t/i),1);o=s*n/2,h=m*i/2,u=2*h;const d=new a.A(e.seed),g=r*n/1.5,p=r*i/1.5;c=[];for(let e=0;e<s;e++)for(let t=0;t<m;t++){const s=e*n-o+g*(.5-d.getFloat()),r=t*i-h+p*(.5-d.getFloat());c.push({x:s,y:r}),0===e&&c.push({x:s+2*o,y:r}),0===t&&c.push({x:s,y:r+2*h})}}else!0===e.shiftOddRows?(o=n/2,h=i,u=2*i,c=[{x:-o,y:0},{x:o,y:0},{x:0,y:h},{x:0,y:-h}]):(o=n/2,h=i/2,u=i,c=[{x:-n,y:0},{x:0,y:-i},{x:-n,y:-i},{x:0,y:0},{x:n,y:0},{x:0,y:i},{x:n,y:i},{x:-n,y:i},{x:n,y:-i}]);return{type:"CIMVectorMarker",frame:{xmin:-o,xmax:o,ymin:-h,ymax:h},markerGraphics:c.map((t=>({type:"CIMMarkerGraphic",geometry:t,symbol:{type:"CIMPointSymbol",symbolLayers:[s]}}))),size:u}}}function R(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const s=t.symbolLayers;if(!s)return;for(const t of s)if(e(t),"CIMVectorMarker"===t.type){const s=t.markerGraphics;if(!s)continue;for(const t of s)if(t){const s=t.symbol;s&&R(s,e)}}break}}}const k=t=>{if(!t)return p.uT.Butt;switch(t){case"butt":return p.uT.Butt;case"square":return p.uT.Square;case"round":return p.uT.Round}},L=t=>{if(!t)return p.wd.Miter;switch(t){case"miter":return p.wd.Miter;case"round":return p.wd.Round;case"bevel":return p.wd.Bevel}},G=t=>{if(null==t)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},V=t=>{if(null==t)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},z=t=>{if(!t)return[0,0,0,0];const{r:e,g:s,b:n,a:i}=t;return[e,s,n,255*i]},O=(t,e)=>{const s=q(e),n=B(t);return s&&n?`${s}-${n}`:`${s}${n}`},q=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},B=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},Y=(t,e)=>{const s=(0,i.A)("safari")?.001:0,n="butt"===e;switch(t){case"dash":case"esriSLSDash":return n?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return n?[4,3,1,3]:[3,4,s,4];case"dot":case"esriSLSDot":return n?[1,3]:[s,4];case"long-dash":case"esriSLSLongDash":return n?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return n?[8,3,1,3]:[7,4,s,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return n?[8,3,1,3,1,3]:[7,4,s,4,s,4];case"short-dash":case"esriSLSShortDash":return n?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return n?[4,1,1,1]:[3,2,s,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return n?[4,1,1,1,1,1]:[3,2,s,2,s,2];case"short-dot":case"esriSLSShortDot":return n?[1,1]:[s,2];case"solid":case"esriSLSSolid":case"none":return w().error("Unexpected: style does not require rasterization"),[0,0];default:return w().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}};const U=(t,e=100)=>{const s=e/2;let n,i;const r=t;if("circle"===r||"esriSMSCircle"===r){const t=.25;let e=Math.acos(1-t/s),r=Math.ceil(P/e/4);0===r&&(r=1),e=S/r,r*=4;const o=[];o.push([s,0]);for(let n=1;n<r;n++)o.push([s*Math.cos(n*e),-s*Math.sin(n*e)]);o.push([s,0]),n={rings:[o]},i={xmin:-s,ymin:-s,xmax:s,ymax:s}}else if("cross"===r||"esriSMSCross"===r){const t=0;n={paths:[[[t,s],[t,-s]],[[s,t],[-s,t]]]},i={xmin:-s,ymin:-s,xmax:s,ymax:s}}else if("diamond"===r||"esriSMSDiamond"===r)n={rings:[[[-s,0],[0,s],[s,0],[0,-s],[-s,0]]]},i={xmin:-s,ymin:-s,xmax:s,ymax:s};else if("square"===r||"esriSMSSquare"===r)n={rings:[[[-s,-s],[-s,s],[s,s],[s,-s],[-s,-s]]]},i={xmin:-s,ymin:-s,xmax:s,ymax:s};else if("x"===r||"esriSMSX"===r)n={paths:[[[s,s],[-s,-s]],[[s,-s],[-s,s]]]},i={xmin:-s,ymin:-s,xmax:s,ymax:s};else if("triangle"===r||"esriSMSTriangle"===r){const t=.5773502691896257*e,s=-t,r=2/3*e,o=r-e;n={rings:[[[s,o],[0,r],[t,o],[s,o]]]},i={xmin:s,ymin:o,xmax:t,ymax:r}}else"arrow"===r&&(n={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},i={xmin:-s,ymin:-s,xmax:s,ymax:s});return[i,n]},H=t=>"vertical"===t||"horizontal"===t||"cross"===t||"esriSFSCross"===t||"esriSFSVertical"===t||"esriSFSHorizontal"===t;function X(t){if(!t)return null;let e=null;const{cap:s,color:n,join:i,miterLimit:r,style:o,width:a}=t;return"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:Y(o,s),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==o&&"none"!==o?z(n):[0,0,0,0],capStyle:k(s),joinStyle:L(i),miterLimit:r,width:a,effects:e}}},95994:(t,e,s)=>{s.d(e,{I:()=>o,U:()=>r});var n=s(14816),i=s(63643);const r=.03;class o{constructor(t=0,e=!1){}isEmpty(t){if(!t.nextPoint())return!0;let e,s,n,i;for(e=t.x,s=t.y;t.nextPoint();e=s,s=i)if(n=t.x,i=t.y,n!==e||i!==s)return t.seekPathStart(),!1;return t.seekPathStart(),!0}normalize(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);0!==e&&(t[0]/=e,t[1]/=e)}getLength(t,e,s,n){const i=s-t,r=n-e;return Math.sqrt(i*i+r*r)}getSegLength(t){const[[e,s],[n,i]]=t;return this.getLength(e,s,n,i)}getCoord2D(t,e,s,n,i){return[t+(s-t)*i,e+(n-e)*i]}getSegCoord2D(t,e){const[[s,n],[i,r]]=t;return this.getCoord2D(s,n,i,r,e)}getAngle(t,e,s,n,i){const r=s-t,o=n-e;return Math.atan2(o,r)}getAngleCS(t,e,s,n,i,r){null==t&&(t=[0,0]);const o=n-e,a=i-s,l=Math.sqrt(o*o+a*a);return 0!==l?(t[0]=o/l,t[1]=a/l,t):(t[0]=1,t[1]=0,t)}getSegAngleCS(t,e,s){const[[n,i],[r,o]]=e;return this.getAngleCS(t,n,i,r,o,s)}cut(t,e,s,n,i,r){return[i<=0?[t,e]:this.getCoord2D(t,e,s,n,i),r>=1?[s,n]:this.getCoord2D(t,e,s,n,r)]}getSubCurve(t,e,s){const i=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(i,t,e,s)?i:null}appendSubCurve(t,e,s,n){t.startPath(),e.seekPathStart();let i=0,r=!0;if(!e.nextPoint())return!1;let o=e.x,a=e.y;for(;e.nextPoint();){const l=this.getLength(o,a,e.x,e.y);if(0!==l){if(r){if(i+l>s){const h=(s-i)/l;let u=1,c=!1;i+l>=n&&(u=(n-i)/l,c=!0);const m=this.cut(o,a,e.x,e.y,h,u);if(m&&t.pushPoints(m),c)break;r=!1}}else{if(i+l>n){const s=this.cut(o,a,e.x,e.y,0,(n-i)/l);s&&t.pushPoint(s[1]);break}t.pushXY(e.x,e.y)}i+=l,o=e.x,a=e.y}else o=e.x,a=e.y}return!0}getCIMPointAlong(t,e){if(!t.nextPoint())return null;let s,n,i,r,o=0;for(s=t.x,n=t.y;t.nextPoint();s=i,n=r){i=t.x,r=t.y;const a=this.getLength(s,n,i,r);if(0!==a){if(o+a>e){const t=(e-o)/a;return this.getCoord2D(s,n,i,r,t)}o+=a}}return null}offset(t,e,s,n,r){if(!t||t.length<2)return null;let o=0,a=t[o++],l=o;for(;o<t.length;){const e=t[o];e[0]===a[0]&&e[1]===a[1]||(o!==l&&(t[l]=t[o]),a=t[l++]),o++}const h=t[0][0]===t[l-1][0]&&t[0][1]===t[l-1][1];if(h&&--l,l<(h?3:2))return null;const u=[];a=h?t[l-1]:null;let c=t[0];for(let m=0;m<l;m++){const r=m===l-1?h?t[0]:null:t[m+1];if(a)if(r){const t=[r[0]-c[0],r[1]-c[1]];this.normalize(t);const o=[c[0]-a[0],c[1]-a[1]];this.normalize(o);const l=o[0]*t[1]-o[1]*t[0],h=o[0]*t[0]+o[1]*t[1];if(0===l&&1===h){c=r;continue}if(l>=0==e<=0){if(h<1){const s=[t[0]-o[0],t[1]-o[1]];this.normalize(s);const i=Math.sqrt((1+h)/2);if(i>1/n){const t=-Math.abs(e)/i;u.push([c[0]-s[0]*t,c[1]-s[1]*t])}}}else switch(s){case i.xw.Mitered:{const s=Math.sqrt((1+h)/2);if(s>0&&1/s<n){const n=[t[0]-o[0],t[1]-o[1]];this.normalize(n);const i=Math.abs(e)/s;u.push([c[0]-n[0]*i,c[1]-n[1]*i]);break}}case i.xw.Bevelled:u.push([c[0]+o[1]*e,c[1]-o[0]*e]),u.push([c[0]+t[1]*e,c[1]-t[0]*e]);break;case i.xw.Rounded:if(h<1){u.push([c[0]+o[1]*e,c[1]-o[0]*e]);const s=Math.floor(2.5*(1-h));if(s>0){const n=1/s;let i=n;for(let r=1;r<s;r++,i+=n){const s=[o[1]*(1-i)+t[1]*i,-o[0]*(1-i)-t[0]*i];this.normalize(s),u.push([c[0]+s[0]*e,c[1]+s[1]*e])}}u.push([c[0]+t[1]*e,c[1]-t[0]*e])}break;case i.xw.Square:default:if(l<0)u.push([c[0]+(o[1]+o[0])*e,c[1]+(o[1]-o[0])*e]),u.push([c[0]+(t[1]-t[0])*e,c[1]-(t[0]+t[1])*e]);else{const s=Math.sqrt((1+Math.abs(h))/2),n=[t[0]-o[0],t[1]-o[1]];this.normalize(n);const i=e/s;u.push([c[0]-n[0]*i,c[1]-n[1]*i])}}}else{const t=[c[0]-a[0],c[1]-a[1]];this.normalize(t),u.push([c[0]+t[1]*e,c[1]-t[0]*e])}else{const t=[r[0]-c[0],r[1]-c[1]];this.normalize(t),u.push([c[0]+t[1]*e,c[1]-t[0]*e])}a=c,c=r}return u.length<(h?3:2)?null:(h&&u.push([u[0][0],u[0][1]]),u)}}},42471:(t,e,s)=>{s.d(e,{VA:()=>r,YQ:()=>a,Z1:()=>h,ps:()=>o});var n=s(14816),i=s(95994);class r{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(t,e,s=!0){if(this._setEmpty(),!t||0===t.length)return!1;for(let n=0;n<t.length;n++){let e=Math.abs(t[n]);s&&e<1e-7&&(e=1e-7),this._values.push(e),this._length+=e}return e&&1&t.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(t){const e=this._values?this._values.length:0;for(let s=0;s<e;++s)this._values[s]*=t;this._length*=t,this.extPtGap*=t,this.ctrlPtGap*=t}addValue(t){this._length+=t,this._values.push(t)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}class o{constructor(){this.pt=null,this.ca=0,this.sa=0}}var a;!function(t){t[t.FAIL=0]="FAIL",t[t.END=1]="END",t[t.CONTINUE=2]="CONTINUE"}(a||(a={}));class l{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(t){t.segment=this.segment,t.segmentLength=this.segmentLength,t.abscissa=this.abscissa,t.isPathEnd=this.isPathEnd,t.isPartEnd=this.isPartEnd}}class h extends i.I{constructor(t=0,e=!1){super(t,e),this._tempPos=new l,this._tempPt=[0,0],this._tolerance=i.U,this._currentPosition=new l}updateTolerance(t){this._tolerance=i.U*t}init(t,e,s=!0){return s?(this._patternLength=e.length(),this._partExtPtGap=e.extPtGap,this._partCtrlPtGap=e.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=t,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(t,e=a.FAIL){const s=new l;return!!this._nextPosition(t,s,null,e)&&(s.copyTo(this._currentPosition),!0)}curPointAndAngle(t){t.pt=this._getPoint(this._currentPosition);const[e,s]=this._getAngleCS(this._tempPt,this._currentPosition);t.ca=e,t.sa=s}nextPointAndAngle(t,e,s=a.FAIL){const n=this._tempPos;if(!this._nextPosition(t,n,null,s))return!1;n.copyTo(this._currentPosition),e.pt=this._getPoint(n);const[i,r]=this._getAngleCS(this._tempPt,n);return e.ca=i,e.sa=r,!0}nextCurve(t){if(0===t)return null;const e=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");e.startPath(),e.nextPath();const s=new l;return this._nextPosition(t,s,e,a.END)?(s.copyTo(this._currentPosition),e):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(t){return this._pathCursor.seekInPath(t),[this._pathCursor.x,this._pathCursor.y]}getSeg(t){return[this.getPt(t),this.getPt(t+1)]}_nextPosition(t,e,s,n){if(this._currentPosition.isPathEnd)return!1;let i=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(i/=this._currentPosition.segmentLength),this._currentPosition.copyTo(e);e.abscissa+t*this._partLengthRatio>e.segmentLength+this._tolerance;){if(s){if(0===s.pathSize)if(0===i){const t=e.segment[0];s.pushXY(t[0],t[1])}else s.pushPoint(this.getSegCoord2D(e.segment,i));const t=e.segment[1];s.pushXY(t[0],t[1])}if(i=0,t-=(e.segmentLength-e.abscissa)/this._partLengthRatio,this._partSegCount)e.segment=this._nextSegment(),e.segmentLength=this.getSegLength(e.segment),e.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return n!==a.FAIL&&(e.segmentLength=this.getSegLength(e.segment),e.isPartEnd=!0,n===a.END?(e.abscissa=e.segmentLength,e.isPathEnd=!0):e.abscissa=e.segmentLength+t,!0);this._currentPosition.copyTo(e)}}if(e.abscissa+=t*this._partLengthRatio,s){0===s.pathSize&&(0===i?s.pushPoint(e.segment[0]):s.pushPoint(this.getSegCoord2D(e.segment,i)));const t=e.abscissa/e.segmentLength;1===t?s.pushPoint(e.segment[1]):s.pushPoint(this.getSegCoord2D(e.segment,t))}return this._partSegCount||Math.abs(e.abscissa-e.segmentLength)<this._tolerance&&(e.isPathEnd=this._partIsLast,e.isPartEnd=!0),!0}_getPoint(t){const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,e)}_getAngleCS(t,e){const s=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(t,this._currentPosition.segment,s)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let t=this._partSegCount;for(;t;)this._previousSegment(),--t;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const e=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(e);let s=e+this._partSegCount+1;if(s>=this._pathCursor.pathSize&&(s=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(s),this._patternLength>0){const t=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,e=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let s=Math.round((this._partLength-(t+e))/this._patternLength);s<=0&&(s=t+e>0?0:1),this._partLengthRatio=this._partLength/(t+e+s*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}},76715:(t,e,s)=>{s.d(e,{A:()=>n});class n{constructor(t=0,e=0,s=0,n=0){this.x=t,this.y=e,this.width=s,this.height=n}static fromExtent(t){return new n(t.xmin,-t.ymax,t.xmax-t.xmin,t.ymax-t.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}}},6276:(t,e,s)=>{s.d(e,{$o:()=>i,$u:()=>a,Nw:()=>l,gR:()=>o,zA:()=>r});var n=s(7591);const i=15.5,r=4,o=64,a=1024,l={outlineWidth:.75,referenceWidth:.75,cap:n.D.CIMSolidStroke.capstyle,join:n.D.CIMSolidStroke.joinstyle,miterLimit:n.D.CIMSolidStroke.miterlimit}},7591:(t,e,s)=>{s.d(e,{D:()=>r,K:()=>i});var n=s(63643);const i={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},r={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1,gradientMethod:"AcrossLine",gradientSize:75,gradientSizeUnits:n.OW.Relative,gradientType:"Discrete",interval:5},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGradientFill:{enable:!0,angle:90,gradientMethod:"Linear",gradientSize:75,gradientSizeUnits:n.OW.Relative,gradientType:"Discrete",interval:5},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRadial:{angle:0,length:5},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:n.fu.Loop,repeatdelay:0,easing:n.Hz.Linear},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0,rotateclockwise:!1},CIMSymbolAnimationOffset:{offsetx:0,offsety:0},CIMSymbolAnimationMoveAlongLine:{speed:30,distanceAlong:100}}},96788:(t,e,s)=>{s.d(e,{N:()=>n});class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,s,n){return new i(t,e)}}class i{constructor(t,e){this._inputGeometries=t,this._angleTolerance=void 0!==e.angleTolerance?e.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let t=this._inputGeometries.next();if(!t)return null;for(;t;){if("esriGeometryPolygon"===t.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===t.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==t.geometryType){t=this._inputGeometries.next();continue}if(this._maxCosAngle)return t;this._isClosed=!0}for(;t.nextPath();)this._processPath(t);return t.reset(),t}return null}_processPath(t){if(t.nextPoint()){const e=t.x,s=t.y;let n=e,i=s,r=t.pathSize,o=0,a=0,l=0,h=0,u=0,c=0;this._isClosed&&++r;for(let m=1;t.nextPoint()||m<r;++m){let d,g;this._isClosed&&m===r-1?(d=e,g=s):(d=t.x,g=t.y);const p=d-n,_=g-i,f=Math.sqrt(p*p+_*_);m>1&&f>0&&l>0&&(o*p+a*_)/f/l<=this._maxCosAngle&&t.setControlPointAt(m-1),1===m&&(h=p,u=_,c=f),f>0&&(n=d,i=g,o=p,a=_,l=f)}this._isClosed&&l>0&&c>0&&(o*h+a*u)/c/l<=this._maxCosAngle&&t.setControlPointAt(0)}}}},75158:(t,e,s)=>{s.d(e,{B:()=>u});var n=s(14816),i=s(18159),r=s(61716),o=s(95994),a=s(63643);const l=1.7320508075688772,h=a.oF.OpenEnded;class u{static{this.instance=null}static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(t,e,s,n,i){return new c(t,e,s)}}class c extends r.rx{constructor(t,e,s){super(t,!1,!0),this._curveHelper=new o.I,this._width=(void 0!==e.width?e.width:5)*s,this._arrowType=void 0!==e.geometricEffectArrowType?e.geometricEffectArrowType:void 0!==e.arrowType?e.arrowType:h,this._offsetFlattenError=o.U*s}processPath(t){const e=n.z.createEmptyOptimizedCIM(t.geometryType);switch(this._arrowType){case a.oF.OpenEnded:default:this._constructSimpleArrow(e,t,!0);break;case a.oF.Block:this._constructSimpleArrow(e,t,!1);break;case a.oF.Crossed:this._constructCrossedArrow(e,t)}return e}_constructSimpleArrow(t,e,s){const n=e.pathLength();let r=this._width;n<2*r&&(r=n/2);const o=this._curveHelper.getSubCurve(e,0,n-r);if(!o||!o.nextPath())return;o.seekPathStart();const a=r/2;if(this._curveHelper.isEmpty(o))return;const l=(0,i.A)(o),h=this._constructOffset(l,-a);if(!h)return;const u=this._constructOffset(l,a);if(!u)return;const c=this._constructArrowBasePoint(h,-a/2);if(!c)return;const m=this._constructArrowBasePoint(u,a/2);if(!m)return;e.seekInPath(e.pathSize-1);const d=[e.x,e.y];t.pushPath(u),t.nextPath(),t.nextPoint(),t.setControlPoint(),t.pushPoint(m),t.nextPoint(),t.setControlPoint(),t.pushPoint(d),t.nextPoint(),t.setControlPoint(),t.pushPoint(c),t.nextPoint(),t.setControlPoint(),t.pushPoints(h.reverse()),t.setControlPoint(),s||(t.setControlPointAt(0),t.setControlPointAt(t.pathSize-1),t.pushPoint(u[0])),t.reset()}_constructCrossedArrow(t,e){const s=e.pathLength();let n=this._width;s<n*(1+l+1)&&(n=s/(1+l+1)),e.seekPathStart();const r=this._curveHelper.getSubCurve(e,0,s-n*(1+l));if(!r)return;r.nextPath();const o=n/2;if(this._curveHelper.isEmpty(r))return;const a=(0,i.A)(r),h=this._constructOffset(a,o);if(!h)return;const u=this._constructOffset(a,-o);if(!u)return;const c=this._curveHelper.getSubCurve(e,0,s-n);if(!c)return;if(c.nextPath(),this._curveHelper.isEmpty(c))return;const m=(0,i.A)(c),d=this._constructOffset(m,o);if(!d)return;const g=this._constructOffset(m,-o);if(!g)return;const p=d[d.length-1],_=this._constructArrowBasePoint(d,o/2);if(!_)return;const f=g[g.length-1],y=this._constructArrowBasePoint(g,-o/2);if(!y)return;e.seekInPath(e.pathSize-1);const x=[e.x,e.y];t.pushPath(h),t.nextPath(),t.nextPoint(),t.setControlPoint(),t.pushPoint(f),t.nextPoint(),t.setControlPoint(),t.pushPoint(y),t.nextPoint(),t.setControlPoint(),t.pushPoint(x),t.nextPoint(),t.setControlPoint(),t.pushPoint(_),t.nextPoint(),t.setControlPoint(),t.pushPoint(p),t.nextPoint(),t.setControlPoint(),t.pushPoints(u.reverse()),t.nextPoint(),t.setControlPoint(),t.reset()}_constructOffset(t,e){return this._curveHelper.offset(t,e,a.xw.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(t,e){if(!t||t.length<2)return null;const s=t[t.length-2],n=t[t.length-1],i=[n[0]-s[0],n[1]-s[1]];return this._curveHelper.normalize(i),[n[0]+i[1]*e,n[1]-i[0]*e]}}},80097:(t,e,s)=>{s.d(e,{s:()=>h});var n=s(14816),i=s(18159),r=s(78983),o=s(13022),a=s(95994),l=s(63643);class h{static{this.instance=null}static local(){return null===h.instance&&(h.instance=new h),h.instance}execute(t,e,s,n,i,r,o){return new u(t,e,s,n,i,r,o)}}class u{constructor(t,e,s,n,i,r,o){this._preventClipping=o,this._inputGeometries=t,this._tileKey=n,this._geometryEngine=i,this._curveHelper=new a.I,this._size=(void 0!==e.size?e.size:1)*s,this._maxInflateSize=r*s,this._offsetFlattenError=a.U*s}next(){let t;for(;t=this._inputGeometries.next();){if(0===this._size)return t;if("esriGeometryEnvelope"===t.geometryType)if(this._size>0){const e=n.z.createEmptyOptimizedCIM(t.geometryType),s=(0,i.x)(t)[0],r=this._curveHelper.offset(s,this._size,l.xw.Rounded,4,this._offsetFlattenError);if(r)return e.pushPath(r),e}else if(this._size<0){const e=t.asJSON();if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._size>0)return n.z.fromJSONCIM({xmin:e.xmin-this._size,xmax:e.xmax+this._size,ymin:e.ymin-this._size,ymax:e.ymax+this._size})}const e=this._geometryEngine;if(null==e)return null;const s=!this._preventClipping&&this._tileKey?(0,o.q)(t,this._maxInflateSize,!0):t;if(!s)continue;const a=e.buffer(r.A.WebMercator,s.asJSON(),this._size,1);return a?n.z.fromJSONCIM(a):null}return null}}},77346:(t,e,s)=>{s.d(e,{v:()=>l});var n=s(14816),i=s(18159),r=s(65319),o=s(61716),a=s(63643);class l{static{this.instance=null}static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(t,e,s,n,i){return new h(t,e,s)}}class h{constructor(t,e,s){this._defaultPointSize=20,this._inputGeometries=t,this._geomUnitsPerPoint=s,this._rule=e.rule??a.uQ.FullGeometry,this._defaultSize=this._defaultPointSize*s}next(){let t;for(;t=this._inputGeometries.next();){const e=this._processGeom((0,i.x)(t));if(e?.length)return n.z.fromJSONCIM({paths:e})}return null}_clone(t){return[t[0],t[1]]}_mid(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}_mix(t,e,s,n){return[t[0]*e+s[0]*n,t[1]*e+s[1]*n]}_add(t,e){return[t[0]+e[0],t[1]+e[1]]}_add2(t,e,s){return[t[0]+e,t[1]+s]}_sub(t,e){return[t[0]-e[0],t[1]-e[1]]}_dist(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}_norm(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}_normalize(t,e=1){const s=e/this._norm(t);t[0]*=s,t[1]*=s}_leftPerpendicular(t){const e=-t[1],s=t[0];t[0]=e,t[1]=s}_leftPerp(t){return[-t[1],t[0]]}_rightPerpendicular(t){const e=t[1],s=-t[0];t[0]=e,t[1]=s}_rightPerp(t){return[t[1],-t[0]]}_dotProduct(t,e){return t[0]*e[0]+t[1]*e[1]}_crossProduct(t,e){return t[0]*e[1]-t[1]*e[0]}_rotateDirect(t,e,s){const n=t[0]*e-t[1]*s,i=t[0]*s+t[1]*e;t[0]=n,t[1]=i}_makeCtrlPt(t){const e=[t[0],t[1]];return(0,o.Aq)(e,1),e}_addAngledTicks(t,e,s,n){const i=this._sub(s,e);this._normalize(i);const r=this._crossProduct(i,this._sub(n,e));let o;o=r>0?this._rightPerp(i):this._leftPerp(i);const a=Math.abs(r)/2,l=[];l.push([e[0]+(o[0]-i[0])*a,e[1]+(o[1]-i[1])*a]),l.push(e),l.push(s),l.push([s[0]+(o[0]+i[0])*a,s[1]+(o[1]+i[1])*a]),t.push(l)}_addBezier2(t,e,s,n,i){if(0==i--)return void t.push(n);const r=this._mid(e,s),o=this._mid(s,n),a=this._mid(r,o);this._addBezier2(t,e,r,a,i),this._addBezier2(t,a,o,n,i)}_addBezier3(t,e,s,n,i,r){if(0==r--)return void t.push(i);const o=this._mid(e,s),a=this._mid(s,n),l=this._mid(n,i),h=this._mid(o,a),u=this._mid(a,l),c=this._mid(h,u);this._addBezier3(t,e,o,h,c,r),this._addBezier3(t,c,u,l,i,r)}_add90DegArc(t,e,s,n,i){const r=i??this._crossProduct(this._sub(s,e),this._sub(n,e))>0,o=this._mid(e,s),a=this._sub(o,e);r?this._leftPerpendicular(a):this._rightPerpendicular(a),o[0]+=a[0],o[1]+=a[1],this._addBezier3(t,e,this._mix(e,.33333,o,.66667),this._mix(s,.33333,o,.66667),s,4)}_addArrow(t,e,s){const n=e[0],i=e[1],r=e[e.length-1],o=this._sub(n,i),a=this._norm(o);this._normalize(o);const l=Math.abs(this._crossProduct(o,this._sub(r,i)));let h=this._dotProduct(o,this._sub(r,i));h<.05*a?h=.05*a:h>.95*a&&(h=.95*a);const u=.5*l,c=this._leftPerp(o),m=[i[0]+o[0]*h,i[1]+o[1]*h],d=e.length-1,g=[];g.push(s?[-c[0],-c[1]]:c);let p=[-o[0],-o[1]];for(let _=1;_<d-1;_++){const t=this._sub(e[_+1],e[_]);this._normalize(t);const s=this._dotProduct(t,p),n=this._crossProduct(t,p),i=Math.sqrt((1+s)/2),r=this._sub(t,p);this._normalize(r),r[0]/=i,r[1]/=i,g.push(n<0?[-r[0],-r[1]]:r),p=t}g.push(this._rightPerp(p));for(let _=g.length-1;_>0;_--)t.push([e[_][0]+g[_][0]*u,e[_][1]+g[_][1]*u]);t.push([m[0]+g[0][0]*u,m[1]+g[0][1]*u]),t.push([m[0]+g[0][0]*l,m[1]+g[0][1]*l]),t.push(n),t.push([m[0]-g[0][0]*l,m[1]-g[0][1]*l]),t.push([m[0]-g[0][0]*u,m[1]-g[0][1]*u]);for(let _=1;_<g.length;_++)t.push([e[_][0]-g[_][0]*u,e[_][1]-g[_][1]*u])}_addDash(t,e,s){const n=this._norm(s)/7;this._normalize(s);let i=[];for(let r=0;r<=7;r++)i.push([e[0]+s[0]*r*n,e[1]+s[1]*r*n]),1&r&&(t.push(i),i=[])}_cp2(t,e,s){return t.length>=2?t[1]:this._add2(t[0],e*this._defaultSize,s*this._defaultSize)}_cp3(t,e,s,n){if(t.length>=3)return t[2];const i=this._mix(t[0],1-s,e,s),r=this._sub(e,t[0]);return this._normalize(r),this._rightPerpendicular(r),[i[0]+r[0]*n*this._defaultSize,i[1]+r[1]*n*this._defaultSize]}_arrowPath(t){if(t.length>2)return t;const e=t[0],s=this._cp2(t,-4,0),n=this._sub(e,s);this._normalize(n);const i=this._rightPerp(n);return[e,s,[e[0]+(i[0]-n[0])*this._defaultSize,e[1]+(i[1]-n[1])*this._defaultSize]]}_arrowLastSeg(t){const e=t[0],s=this._cp2(t,-4,0);let n;if(t.length>=3)n=t[t.length-1];else{const t=this._sub(e,s);this._normalize(t);const i=this._rightPerp(t);n=[e[0]+(i[0]-t[0])*this._defaultSize,e[1]+(i[1]-t[1])*this._defaultSize]}return[s,n]}_processGeom(t){if(!t)return null;const e=[];for(const s of t){const t=s.length>1&&(0,r.Yl)(s)<this._defaultSize;if(!s||0===s.length||t)continue;const n=s.length;let i=s[0];switch(this._rule){case a.uQ.PerpendicularFromFirstSegment:{const t=this._cp2(s,0,-1),n=this._cp3(s,t,.5,4),r=[];r.push(n),r.push(this._mid(i,t)),e.push(r);break}case a.uQ.ReversedFirstSegment:{const t=this._cp2(s,0,-1);e.push([t,i]);break}case a.uQ.PerpendicularToSecondSegment:{if(s.length<3)return[];const t=this._cp2(s,-4,1),n=this._cp3(s,t,.882353,-1.94),r=[];r.push(this._mid(t,n)),r.push(i),e.push(r);break}case a.uQ.SecondSegmentWithTicks:{if(s.length<3)return[];const t=this._cp2(s,-4,1),n=this._cp3(s,t,.882353,-1.94),r=this._sub(n,t);let o;o=this._crossProduct(r,this._sub(i,t))>0?this._rightPerp(r):this._leftPerp(r);const a=[];a.push([t[0]+(o[0]-r[0])/3,t[1]+(o[1]-r[1])/3]),a.push(t),a.push(n),a.push([n[0]+(o[0]+r[0])/3,n[1]+(o[1]+r[1])/3]),e.push(a);break}case a.uQ.DoublePerpendicular:{const t=this._cp2(s,0,-1),n=this._cp3(s,t,.5,3),r=this._mid(i,t),o=this._sub(r,n);this._normalize(o);const a=this._crossProduct(o,this._sub(i,n));this._leftPerpendicular(o);const l=[];l.push(i),l.push([n[0]+o[0]*a,n[1]+o[1]*a]),e.push(l);const h=[];h.push([n[0]-o[0]*a,n[1]-o[1]*a]),h.push(t),e.push(h);break}case a.uQ.OppositeToFirstSegment:{const t=this._cp2(s,0,-1),n=this._cp3(s,t,.5,3),r=this._mid(i,t),o=this._sub(r,n);this._normalize(o);const a=this._crossProduct(o,this._sub(i,n));this._leftPerpendicular(o);const l=[];l.push([n[0]+o[0]*a,n[1]+o[1]*a]),l.push([n[0]-o[0]*a,n[1]-o[1]*a]),e.push(l);break}case a.uQ.TriplePerpendicular:{const t=this._cp2(s,0,-1),n=this._cp3(s,t,.5,4),r=this._mid(i,t),o=this._sub(r,n);this._normalize(o);const a=this._crossProduct(o,this._sub(i,n));this._leftPerpendicular(o);const l=[];l.push([n[0]+o[0]*a*.8,n[1]+o[1]*a*.8]),l.push([r[0]+.8*(i[0]-r[0]),r[1]+.8*(i[1]-r[1])]),e.push(l),e.push([n,r]);const h=[];h.push([n[0]-o[0]*a*.8,n[1]-o[1]*a*.8]),h.push([r[0]+.8*(t[0]-r[0]),r[1]+.8*(t[1]-r[1])]),e.push(h);break}case a.uQ.HalfCircleFirstSegment:{const t=this._cp2(s,0,-1),n=this._cp3(s,t,.5,4),r=this._mid(i,t);let o=this._sub(t,i);const a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18),h=Math.sqrt((1+a)/2),u=Math.sqrt((1-a)/2),c=[];let m;this._crossProduct(o,this._sub(n,i))>0?(c.push(i),o=this._sub(i,r),m=t):(c.push(t),o=this._sub(t,r),m=i),this._rotateDirect(o,h,u),o[0]/=h,o[1]/=h;for(let e=1;e<=18;e++)c.push(this._add(r,o)),this._rotateDirect(o,a,l);c.push(m),e.push(c);break}case a.uQ.HalfCircleSecondSegment:{const t=this._cp2(s,0,-1),n=this._cp3(s,t,1,-1);let r=this._sub(i,t);this._normalize(r);const o=this._crossProduct(r,this._sub(n,t))/2;this._leftPerpendicular(r);const a=[t[0]+r[0]*o,t[1]+r[1]*o];r=this._sub(t,a);const l=Math.cos(Math.PI/18);let h=Math.sin(Math.PI/18);o>0&&(h=-h);const u=[t];for(let e=1;e<=18;e++)this._rotateDirect(r,l,h),u.push(this._add(a,r));e.push(u);break}case a.uQ.HalfCircleExtended:{const t=this._cp2(s,0,-2),r=this._cp3(s,t,1,-1);let o;if(n>=4)o=s[3];else{const e=this._sub(i,t);o=this._add(r,e)}const a=this._dist(t,r)/2/.75,l=this._sub(t,i);this._normalize(l,a);const h=this._sub(r,o);this._normalize(h,a);const u=[o,r];e.push(u);const c=[this._clone(r)];this._addBezier3(c,r,this._add(r,h),this._add(t,l),t,4),c.push(i),e.push(c);break}case a.uQ.OpenCircle:{const t=this._cp2(s,-2,0),n=this._sub(t,i),r=Math.cos(Math.PI/18),o=-Math.sin(Math.PI/18),a=[t];for(let e=1;e<=33;e++)this._rotateDirect(n,r,o),a.push(this._add(i,n));e.push(a);break}case a.uQ.CoverageEdgesWithTicks:{const t=this._cp2(s,0,-1);let r,o;if(n>=3)r=s[2];else{const e=this._sub(t,i),s=this._leftPerp(e);r=[i[0]+s[0]-.25*e[0],i[1]+s[1]-.25*e[1]]}if(n>=4)o=s[3];else{const e=this._mid(i,t),s=this._sub(i,t);this._normalize(s),this._leftPerpendicular(s);const n=this._crossProduct(s,this._sub(r,e));this._rightPerpendicular(s),o=[r[0]+s[0]*n*2,r[1]+s[1]*n*2]}const a=this._sub(t,i);let l,h;l=this._crossProduct(a,this._sub(r,i))>0?this._rightPerp(a):this._leftPerp(a),h=[],h.push(r),h.push(i),h.push([i[0]+(l[0]-a[0])/3,i[1]+(l[1]-a[1])/3]),e.push(h),l=this._crossProduct(a,this._sub(o,t))>0?this._rightPerp(a):this._leftPerp(a),h=[],h.push([t[0]+(l[0]+a[0])/3,t[1]+(l[1]+a[1])/3]),h.push(t),h.push(o),e.push(h);break}case a.uQ.GapExtentWithDoubleTicks:{const t=this._cp2(s,0,2),r=this._cp3(s,t,0,1);let o;if(n>=4)o=s[3];else{const e=this._sub(t,i);o=this._add(r,e)}this._addAngledTicks(e,i,t,this._mid(r,o)),this._addAngledTicks(e,r,o,this._mid(i,t));break}case a.uQ.GapExtentMidline:{const t=this._cp2(s,2,0),r=this._cp3(s,t,0,1);let o;if(n>=4)o=s[3];else{const e=this._sub(t,i);o=this._add(r,e)}const a=[];a.push(this._mid(i,r)),a.push(this._mid(t,o)),e.push(a);break}case a.uQ.Chevron:{const t=this._cp2(s,-1,-1);let r;if(n>=3)r=s[2];else{const e=this._sub(t,i);this._leftPerpendicular(e),r=this._add(i,e)}e.push([t,this._makeCtrlPt(i),r]);break}case a.uQ.PerpendicularWithArc:{const t=this._cp2(s,0,-2),r=this._cp3(s,t,.5,-1),o=this._sub(t,i),a=this._norm(o);o[0]/=a,o[1]/=a;const l=this._crossProduct(o,this._sub(r,i));let h=this._dotProduct(o,this._sub(r,i));h<.05*a?h=.05*a:h>.95*a&&(h=.95*a);const u=[i[0]+o[0]*h,i[1]+o[1]*h];let c=this._leftPerp(o),m=[];if(m.push([u[0]-c[0]*l,u[1]-c[1]*l]),m.push([u[0]+c[0]*l,u[1]+c[1]*l]),e.push(m),n>=4){const t=s[3];let n=this._dotProduct(o,this._sub(t,i));n<.1*a?n=.1*a:n>.9*a&&(n=.9*a);const r=[i[0]+o[0]*n,i[1]+o[1]*n],l=this._crossProduct(o,this._sub(t,i)),h=[];h.push([r[0]-c[0]*l,r[1]-c[1]*l]),h.push([r[0]+c[0]*l,r[1]+c[1]*l]),e.push(h)}const d=[t[0]+c[0]*l,t[1]+c[1]*l];c=this._sub(t,d);const g=Math.cos(Math.PI/18);let p=Math.sin(Math.PI/18);l<0&&(p=-p),m=[i,t];for(let e=1;e<=9;e++)this._rotateDirect(c,g,p),m.push(this._add(d,c));e.push(m);break}case a.uQ.ClosedHalfCircle:{const t=this._cp2(s,2,0),n=this._mid(i,t),r=this._sub(t,n),o=Math.cos(Math.PI/18),a=Math.sin(Math.PI/18),l=[i,t];for(let e=1;e<=18;e++)this._rotateDirect(r,o,a),l.push(this._add(n,r));e.push(l);break}case a.uQ.TripleParallelExtended:{const t=this._cp2(s,0,-2),n=this._cp3(s,t,1,-2),r=this._mid(i,t),a=this._sub(n,t);this._normalize(a);const l=Math.abs(this._crossProduct(a,this._sub(r,t)))/2,h=this._dist(t,n),u=[t,i];u.push([i[0]+a[0]*h*.5,i[1]+a[1]*h*.5]),e.push(u);const c=[];c.push([r[0]-a[0]*l,r[1]-a[1]*l]),c.push([r[0]+a[0]*h*.375,r[1]+a[1]*h*.375]),(0,o.Aq)(c[c.length-1],1),c.push([r[0]+a[0]*h*.75,r[1]+a[1]*h*.75]),e.push(c);const m=[t,n];e.push(m);break}case a.uQ.ParallelWithTicks:{const t=this._cp2(s,3,0),n=this._cp3(s,t,.5,-1),r=this._sub(n,t);this._normalize(r);const o=this._crossProduct(r,this._sub(n,i));this._leftPerpendicular(r),this._addAngledTicks(e,i,t,n),this._addAngledTicks(e,this._mix(i,1,r,o),this._mix(t,1,r,o),this._mid(i,t));break}case a.uQ.Parallel:{const t=this._cp2(s,3,0),n=this._cp3(s,t,.5,-1),r=this._sub(t,i);this._normalize(r);const o=this._leftPerp(r),a=this._crossProduct(r,this._sub(n,i));let l=[i,t];e.push(l),l=[],l.push([i[0]+o[0]*a,i[1]+o[1]*a]),l.push([t[0]+o[0]*a,t[1]+o[1]*a]),e.push(l);break}case a.uQ.PerpendicularToFirstSegment:{const t=this._cp2(s,3,0),n=this._cp3(s,t,.5,-1),r=this._mid(i,t),o=this._sub(t,i);this._normalize(o);const a=this._crossProduct(o,this._sub(n,i));this._leftPerpendicular(o);const l=[];l.push([r[0]-o[0]*a*.25,r[1]-o[1]*a*.25]),l.push([r[0]+o[0]*a*1.25,r[1]+o[1]*a*1.25]),e.push(l);break}case a.uQ.ParallelOffset:{const t=this._cp2(s,3,0),n=this._cp3(s,t,.5,-1),r=this._sub(t,i);this._normalize(r);const o=this._crossProduct(r,this._sub(n,i));this._leftPerpendicular(r);const a=[];a.push([i[0]-r[0]*o,i[1]-r[1]*o]),a.push([t[0]-r[0]*o,t[1]-r[1]*o]),e.push(a);const l=[];l.push([i[0]+r[0]*o,i[1]+r[1]*o]),l.push([t[0]+r[0]*o,t[1]+r[1]*o]),e.push(l);break}case a.uQ.OffsetOpposite:{const t=this._cp2(s,3,0),n=this._cp3(s,t,.5,-1),r=this._sub(t,i);this._normalize(r);const o=this._crossProduct(r,this._sub(n,i));this._leftPerpendicular(r);const a=[];a.push([i[0]-r[0]*o,i[1]-r[1]*o]),a.push([t[0]-r[0]*o,t[1]-r[1]*o]),e.push(a);break}case a.uQ.OffsetSame:{const t=this._cp2(s,3,0),n=this._cp3(s,t,.5,-1),r=this._sub(t,i);this._normalize(r);const o=this._crossProduct(r,this._sub(n,i));this._leftPerpendicular(r);const a=[];a.push([i[0]+r[0]*o,i[1]+r[1]*o]),a.push([t[0]+r[0]*o,t[1]+r[1]*o]),e.push(a);break}case a.uQ.CircleWithArc:{let t=this._cp2(s,3,0);const r=this._cp3(s,t,.5,-1);let a,l;if(n>=4)a=s[3],l=this._crossProduct(this._sub(a,t),this._sub(r,t))>0;else{a=t,l=this._crossProduct(this._sub(a,i),this._sub(r,i))>0;const e=24*this._geomUnitsPerPoint,s=this._sub(a,i);this._normalize(s,e);const n=Math.sqrt(2)/2;this._rotateDirect(s,n,l?n:-n),t=this._add(i,s)}const h=this._sub(t,i),u=Math.cos(Math.PI/18),c=Math.sin(Math.PI/18),m=[t];for(let e=1;e<=36;e++)this._rotateDirect(h,u,c),m.push(this._add(i,h));this._add90DegArc(m,t,a,r,l),(0,o.Aq)(m[m.length-8],1),e.push(m);break}case a.uQ.DoubleJog:{let t,r=this._cp2(s,-3,1),o=this._cp3(s,r,-1,-.5);if(n>=4)t=s[3];else{const e=i;i=r,t=o;const s=this._dist(i,e),n=this._dist(t,e);let a=30*this._geomUnitsPerPoint;.5*s<a&&(a=.5*s),.5*n<a&&(a=.5*n),r=this._mix(i,a/s,e,(s-a)/s),o=this._mix(t,a/n,e,(n-a)/n)}const a=this._mid(i,r),l=this._mid(t,o),h=this._dist(i,r),u=this._dist(o,t);let c=Math.min(h,u)/8;c=Math.min(c,24*this._geomUnitsPerPoint);const m=Math.cos(Math.PI/4);let d=this._sub(i,r);this._normalize(d,c),this._crossProduct(d,this._sub(t,r))>0?this._rotateDirect(d,m,-m):this._rotateDirect(d,m,m);let g=[];g.push(r),g.push(this._add(a,d)),g.push(this._sub(a,d)),g.push(i),e.push(g),d=this._sub(t,o),this._normalize(d,c),this._crossProduct(d,this._sub(i,o))<0?this._rotateDirect(d,m,m):this._rotateDirect(d,m,-m),g=[],g.push(o),g.push(this._add(l,d)),g.push(this._sub(l,d)),g.push(t),e.push(g);break}case a.uQ.PerpendicularOffset:{const t=this._cp2(s,-4,1),n=this._cp3(s,t,.882353,-1.94),r=this._sub(n,t);this._crossProduct(r,this._sub(i,t))>0?this._rightPerpendicular(r):this._leftPerpendicular(r);const o=[r[0]/8,r[1]/8],a=this._sub(this._mid(t,n),o);e.push([a,i]);break}case a.uQ.LineExcludingLastSegment:{const t=this._arrowPath(s),n=[];let i=t.length-2;for(;i--;)n.push(t[i]);e.push(n);break}case a.uQ.MultivertexArrow:{const t=this._arrowPath(s),n=[];this._addArrow(n,t,!1),e.push(n);break}case a.uQ.CrossedArrow:{const t=this._arrowPath(s),n=[];this._addArrow(n,t,!0),e.push(n);break}case a.uQ.ChevronArrow:{const[t,n]=this._arrowLastSeg(s),r=10*this._geomUnitsPerPoint,o=this._sub(i,t),a=this._norm(o);this._normalize(o);const l=this._crossProduct(o,this._sub(n,t));let h=this._dotProduct(o,this._sub(n,t));h<.05*a?h=.05*a:h>.95*a-r&&(h=.95*a-r);const u=[t[0]+o[0]*h,t[1]+o[1]*h],c=this._leftPerp(o),m=[];m.push([u[0]+c[0]*l+o[0]*r,u[1]+c[1]*l+o[1]*r]),m.push(i),m.push([u[0]-c[0]*l+o[0]*r,u[1]-c[1]*l+o[1]*r]),e.push(m);break}case a.uQ.ChevronArrowOffset:{const[t,n]=this._arrowLastSeg(s),r=this._sub(i,t),o=this._norm(r);this._normalize(r);const a=this._crossProduct(r,this._sub(n,t));let l=this._dotProduct(r,this._sub(n,t));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const h=[t[0]+r[0]*l,t[1]+r[1]*l];this._leftPerpendicular(r);const u=[];u.push([h[0]+r[0]*a*.5,h[1]+r[1]*a*.5]),u.push(this._mid(h,i)),u.push([h[0]-r[0]*a*.5,h[1]-r[1]*a*.5]),e.push(u);break}case a.uQ.PartialFirstSegment:{const[t,n]=this._arrowLastSeg(s),r=this._sub(i,t),o=this._norm(r);this._normalize(r);let a=this._dotProduct(r,this._sub(n,t));a<.05*o?a=.05*o:a>.95*o&&(a=.95*o);const l=[t[0]+r[0]*a,t[1]+r[1]*a];e.push([t,l]);break}case a.uQ.Arch:{const t=this._cp2(s,0,-1),n=this._cp3(s,t,.5,1),r=this._sub(i,t),o=this._mix(n,1,r,.55),a=this._mix(n,1,r,-.55),l=[i];this._addBezier2(l,i,o,n,4),this._addBezier2(l,n,a,t,4),e.push(l);break}case a.uQ.CurvedParallelTicks:{const t=this._cp2(s,-4,1),n=this._cp3(s,t,.882353,-1.94),r=this._sub(n,t);this._crossProduct(r,this._sub(i,t))>0?this._rightPerpendicular(r):this._leftPerpendicular(r);const o=[r[0]/8,r[1]/8],a=this._sub(this._mid(t,n),o),l=this._sub(this._mix(t,.75,n,.25),o),h=this._sub(this._mix(t,.25,n,.75),o),u=[t];this._addBezier2(u,t,l,a,3),this._addBezier2(u,a,h,n,3),e.push(u);for(let s=0;s<8;s++){const t=u[2*s+1],n=[this._clone(t)];n.push(this._add(t,[r[0]/4,r[1]/4])),e.push(n)}break}case a.uQ.Arc90Degrees:{const t=this._cp2(s,0,-1),n=this._cp3(s,t,.5,1),r=[t];this._add90DegArc(r,t,i,n),e.push(r);break}case a.uQ.TipWithPerpendicularAndTicks:{const[t,n]=this._arrowLastSeg(s),r=10*this._geomUnitsPerPoint,o=this._sub(i,t),a=this._norm(o);this._normalize(o);let l=this._crossProduct(o,this._sub(n,t)),h=this._dotProduct(o,this._sub(n,t));h<.05*a?h=.05*a:h>.95*a-r&&(h=.95*a-r);const u=this._leftPerp(o),c=[i[0]-o[0]*r,i[1]-o[1]*r],m=.5*Math.max(a-h-r,r);l=Math.abs(l);const d=[];d.push([c[0]+u[0]*(l+m)-o[0]*m,c[1]+u[1]*(l+m)-o[1]*m]),d.push([c[0]+u[0]*l,c[1]+u[1]*l]),d.push([c[0]-u[0]*l,c[1]-u[1]*l]),d.push([c[0]-u[0]*(l+m)-o[0]*m,c[1]-u[1]*(l+m)-o[1]*m]),e.push(d),e.push([c,i]);break}case a.uQ.ConcentricCircles:{const t=this._cp2(s,1,0),r=this._cp3(s,t,2,0),a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18);let h=this._dist(t,i),u=[h,0],c=[];for(let e=0;e<=36;e++)c.push(this._add(i,u)),this._rotateDirect(u,a,l);if(e.push(c),n>=4){c=[];const t=s[3];h=this._dist(t,i),u=[h,0];for(let e=0;e<=36;e++)c.push(this._add(i,u)),0===e&&(c.push(this._add(i,u)),(0,o.Aq)(c[1],1)),this._rotateDirect(u,a,l);e.push(c)}c=[],h=this._dist(r,i),u=[h,0];for(let e=0;e<=36;e++)c.push(this._add(i,u)),this._rotateDirect(u,a,l);e.push(c);break}case a.uQ.DoubleJogArrow:{i=this._arrowPath(s)[0];const[t,n]=this._arrowLastSeg(s),r=this._sub(i,t),o=this._norm(r);this._normalize(r);const a=Math.abs(this._crossProduct(r,this._sub(n,i)));let l=Math.abs(this._dotProduct(r,this._sub(n,i)));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const h=Math.max(a,l),u=this._leftPerp(r);let c=[];const m=[i[0]-r[0]*l*.5+u[0]*a*.5,i[1]-r[1]*l*.5+u[1]*a*.5];c.push([m[0],m[1]]),m[0]+=r[0]*h*.5+u[0]*h*.4,m[1]+=r[1]*h*.5+u[1]*h*.4,c.push([m[0],m[1]]),m[0]-=u[0]*h*.25,m[1]-=u[1]*h*.25,c.push([m[0],m[1]]),m[0]+=r[0]*h*.5+u[0]*h*.4,m[1]+=r[1]*h*.5+u[1]*h*.4,c.push([m[0],m[1]]),e.push(c),c=[],m[0]=i[0]-r[0]*l*.5-u[0]*a*.5,m[1]=i[1]-r[1]*l*.5-u[1]*a*.5,c.push([m[0],m[1]]),m[0]+=r[0]*h*.5-u[0]*h*.4,m[1]+=r[1]*h*.5-u[1]*h*.4,c.push([m[0],m[1]]),m[0]+=u[0]*h*.25,m[1]+=u[1]*h*.25,c.push([m[0],m[1]]),m[0]+=r[0]*h*.5-u[0]*h*.4,m[1]+=r[1]*h*.5-u[1]*h*.4,c.push([m[0],m[1]]),e.push(c);break}case a.uQ.LinkedChevrons:{const t=this._cp2(s,-5,0),n=this._cp3(s,t,-.2,1),r=this._sub(i,t);this._normalize(r);const o=this._leftPerp(r),a=Math.abs(this._crossProduct(r,this._sub(n,t)));e.push([t,i]);const l=[];l.push([i[0]-r[0]*a+o[0]*a,i[1]-r[1]*a+o[1]*a]),l.push(i),l.push([i[0]-r[0]*a-o[0]*a,i[1]-r[1]*a-o[1]*a]),e.push(l),this._addDash(e,t,[-r[0]*a+o[0]*a,-r[1]*a+o[1]*a]),this._addDash(e,t,[-r[0]*a-o[0]*a,-r[1]*a-o[1]*a]);break}case a.uQ.SegmentThenHalfCircle:{const t=this._cp2(s,2,0),r=this._cp3(s,t,1.5,0);let o;o=n>=4?s[3]:this._cp3(s,t,1.25,-.5);const a=this._sub(t,i);this._normalize(a);const l=.5*this._dist(t,r),h=this._crossProduct(a,this._sub(o,i))>0,u=Math.cos(Math.PI/18);let c=Math.sin(Math.PI/18);h&&(c=-c);const m=[i,t];a[0]*=l,a[1]*=l;const d=this._add(t,a);a[0]=-a[0],a[1]=-a[1];for(let e=1;e<=18;e++)this._rotateDirect(a,u,c),m.push(this._add(d,a));e.push(m);break}case a.uQ.LineWithStraightTicks:{const t=this._cp2(s,-2,1),n=this._cp3(s,t,-1,-.5),r=this._sub(n,t);this._normalize(r);const o=this._dotProduct(r,this._sub(t,i)),a=this._dotProduct(r,this._sub(n,i));let l=[i];l.push([i[0]+r[0]*o,i[1]+r[1]*o]),l.push(t),e.push(l),l=[i],l.push([i[0]+r[0]*a,i[1]+r[1]*a]),l.push(n),e.push(l);break}case a.uQ.DoubleCurve:{const t=this._cp2(s,-5,-1),n=this._cp3(s,t,2,0),r=Math.atan2(1,5),a=Math.cos(r),l=Math.sin(r),h=this._sub(t,i),u=this._dist(i,t);this._normalize(h),this._rotateDirect(h,a,-l);const c=[i];c.push([i[0]+h[0]*u*.5,i[1]+h[1]*u*.5]),(0,o.Aq)(c[1],1),c.push([i[0]+h[0]*u*.8,i[1]+h[1]*u*.8]),this._addBezier2(c,c[2],[i[0]+h[0]*u,i[1]+h[1]*u],t,3);const m=this._sub(n,t),d=this._dist(t,n);this._normalize(m),this._rotateDirect(m,a,-l),this._addBezier2(c,t,[n[0]-m[0]*d,n[1]-m[1]*d],[n[0]-m[0]*d*.8,n[1]-m[1]*d*.8],3),c.push(n),e.push(c);break}case a.uQ.ParallelWithTicksByWidth:{const t=this._cp2(s,0,-1),n=this._cp3(s,t,.5,3),r=this._sub(t,i);this._normalize(r);const o=this._crossProduct(r,this._sub(n,i));this._leftPerpendicular(r),o>0?(this._addAngledTicks(e,i,[i[0]+r[0]*o,i[1]+r[1]*o],t),this._addAngledTicks(e,t,[t[0]+r[0]*o,t[1]+r[1]*o],i)):(this._addAngledTicks(e,[i[0]+r[0]*o,i[1]+r[1]*o],i,t),this._addAngledTicks(e,[t[0]+r[0]*o,t[1]+r[1]*o],i,t));break}case a.uQ.EnclosingRoundedRectangle:{const t=this._cp2(s,3,-2),e=[Math.min(i[0],t[0]),Math.max(i[1],t[1])],n=[Math.max(i[0],t[0]),Math.min(i[1],t[1])],r=n[0]-e[0],o=e[1]-n[1],a=Math.min(r,o)/10,l=[];l.push([e[0]+a+.75*(r-2*a),e[1]]),l.push([n[0]-a,e[1]]),this._add90DegArc(l,[n[0]-a,e[1]],[n[0],e[1]-a],[n[0],e[1]]),l.push([n[0],n[1]+a]),this._add90DegArc(l,[n[0],n[1]+a],[n[0]-a,n[1]],n),l.push([e[0]+a,n[1]]),this._add90DegArc(l,[e[0]+a,n[1]],[e[0],n[1]+a],[e[0],n[1]]),l.push([e[0],e[1]-a]),this._add90DegArc(l,[e[0],e[1]-a],[e[0]+a,e[1]],e),l.push([e[0]+a+.75*(r-2*a),e[1]]);break}case a.uQ.FullGeometry:default:e.push(s)}}return e}}},71443:(t,e,s)=>{s.d(e,{y:()=>o});var n=s(14816),i=s(61716),r=s(95994);class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,s,n,i){return new a(t,e,s)}}class a extends i.rx{constructor(t,e,s){super(t,!0,!0),this._curveHelper=new r.I,this._beginCut=(void 0!==e.beginCut?e.beginCut:1)*s,this._endCut=(void 0!==e.endCut?e.endCut:1)*s,this._middleCut=(void 0!==e.middleCut?e.middleCut:0)*s,this._invert=void 0!==e.invert&&e.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(t){const{_beginCut:e,_endCut:s,_middleCut:i}=this,r=t.pathLength(),o=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==e||0!==s||0!==i)if(e+s+i>=r)for(o.startPath();t.nextPoint();)o.pushXY(t.x,t.y);else this._curveHelper.appendSubCurve(o,t,0,e),this._curveHelper.appendSubCurve(o,t,.5*(r-i),.5*(r+i)),this._curveHelper.appendSubCurve(o,t,r-s,s)}else if(0===e&&0===s&&0===i)for(o.startPath();t.nextPoint();)o.pushXY(t.x,t.y);else e+s+i<r&&(0===i?this._curveHelper.appendSubCurve(o,t,e,r-s):(this._curveHelper.appendSubCurve(o,t,e,.5*(r-i)),this._curveHelper.appendSubCurve(o,t,.5*(r+i),r-s)));return 0===o.totalSize?null:o}}},60459:(t,e,s)=>{s.d(e,{I:()=>h});var n=s(14816),i=s(18159),r=s(61716),o=s(63643),a=s(42471),l=s(50072);class h{static{this.instance=null}static local(){return null===h.instance&&(h.instance=new h),h.instance}execute(t,e,s,n,i){return new u(t,e,s)}}class u extends r.rx{constructor(t,e,s){super(t,!0,!0),this._firstCurve=null,this._walker=new a.Z1,this._walker.updateTolerance(s),this._endings=e.lineDashEnding,this._customDashPos=-(e.offsetAlongLine??0)*s,this._offsetAtEnd=(e.customEndingOffset??0)*s;let n=(0,l.FH)(e).dashTemplate;null==n&&(n=[]),n.length%2&&(n=[...n,...n]),this._pattern=new a.VA,this._pattern.init(n,!0),this._pattern.scale(s)}processPath(t){if(0===this._pattern.length()){this.iteratePath=!1;const e=(0,i.A)(t);return n.z.fromJSONCIM({paths:[e]})}if(!this.iteratePath){let e=!0;switch(this._endings){case o.yS.HalfPattern:case o.yS.HalfGap:default:this._pattern.extPtGap=0;break;case o.yS.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case o.yS.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case o.yS.NoConstraint:this.isClosed||(e=!1);break;case o.yS.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const s=t.pathLength();if(this._pattern.isEmpty()||s<.1*this._pattern.length()){const e=(0,i.A)(t);return n.z.fromJSONCIM({paths:[e]})}if(!this._walker.init(t,this._pattern,e)){const e=(0,i.A)(t);return n.z.fromJSONCIM({paths:[e]})}}let e;if(this.iteratePath)e=this._pattern.nextValue();else{let t;switch(this._endings){case o.yS.HalfPattern:default:t=.5*this._pattern.firstValue();break;case o.yS.HalfGap:t=.5*-this._pattern.lastValue();break;case o.yS.FullGap:t=-this._pattern.lastValue();break;case o.yS.FullPattern:t=0;break;case o.yS.NoConstraint:case o.yS.Custom:t=-this._customDashPos}let s=t/this._pattern.length();s-=Math.floor(s),t=s*this._pattern.length(),this._pattern.reset(),e=this._pattern.nextValue();let n=!1;for(;t>=e;)t-=e,e=this._pattern.nextValue(),n=!n;e-=t,n?(this._walker.nextPosition(e),e=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(e),e=this._pattern.nextValue(),this._walker.nextPosition(e),e=this._pattern.nextValue())}let s=this._walker.nextCurve(e);if(s)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)s.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else e=this._pattern.nextValue(),!this._walker.nextPosition(e)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(s.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,s=this._firstCurve,this._firstCurve=null;return s?.reset(),s}}},59191:(t,e,s)=>{s.d(e,{O:()=>a});var n=s(14816),i=s(78983),r=s(13022),o=s(63643);class a{static{this.instance=null}static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(t,e,s,n,i,r,o){return new l(t,e,s,n,i,r,o)}}class l{constructor(t,e,s,n,i,r,a){switch(this._preventClipping=a,this._inputGeometries=t,this._tileKey=n,this._geometryEngine=i,this._maxInflateSize=r*s,this._width=(void 0!==e.width?e.width:2)*s,e.method){case o.M1.Mitered:case o.M1.Bevelled:case o.M1.Rounded:case o.M1.TrueBuffer:case o.M1.Square:}this._option=e.option}next(){let t;for(;t=this._inputGeometries.next();){if("esriGeometryEnvelope"===t.geometryType&&this._width>0){const e=t.asJSON();return Math.min(e.xmax-e.xmin,e.ymax-e.ymin)-2*this._width<0?t:n.z.fromJSONCIM({paths:[[[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]],[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}if("esriGeometryPolygon"===t.geometryType){if(0===this._width)return t.clone();const e=this._geometryEngine;if(null==e)return null;const s=!this._preventClipping&&this._tileKey?(0,r.q)(t,this._maxInflateSize,!0):t.clone();if(!s)continue;const n=e.buffer(i.A.WebMercator,s.asJSON(),-this._width,1);if(n)for(const t of n.rings)if(t){s.startPath();for(const e of t.reverse())s.pushXY(e[0],s.yFactor*e[1])}return s}}return null}}},12727:(t,e,s)=>{s.d(e,{g:()=>a});var n=s(14816),i=s(78983),r=s(36358),o=s(63643);class a{static{this.instance=null}static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(t,e,s,n,i){return new l(t,e,s,i)}}class l{constructor(t,e,s,n){this._inputGeometries=t,this._medhod=e.method,this._geometryEngine=n}next(){let t=this._inputGeometries.next();const e=this._medhod;for(;null!=t;){if(t.totalSize>0)switch(e){case o.Ao.RectangularBox:return h(t);case o.Ao.ConvexHull:return this._constructConvexHull(t);default:return u(t)}t=this._inputGeometries.next()}return null}_constructConvexHull(t){switch(t.geometryType){case"esriGeometryPolyline":case"esriGeometryPolygon":{const e=this._geometryEngine;if(null==e)return null;const s=e.convexHull(i.A.WebMercator,t.asJSON());return s?n.z.fromJSONCIM(s):null}case"esriGeometryEnvelope":return t;default:return null}}}function h(t){const e=(0,r.z8)(t),s={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]};return n.z.fromJSONCIM(s)}function u(t){switch(t.geometryType){case"esriGeometryPolyline":{const e=[];for(;t.nextPath();)c(t,e);return n.z.fromJSONCIM({rings:e})}case"esriGeometryPolygon":case"esriGeometryEnvelope":return t;default:return null}}function c(t,e){if(t.seekPathStart(),!t.nextPoint())return;const s=t.x,n=t.y,i=[[s,n]];for(e.push(i);t.nextPoint();)i.push([t.x,t.y]);i.push([s,n])}},3687:(t,e,s)=>{s.d(e,{U:()=>o});var n=s(14816),i=s(61716),r=s(95994);class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,s,n,i){return new a(t,e,s)}}class a extends i.rx{constructor(t,e,s){super(t,!1,!0),this._curveHelper=new r.I,this._length=(void 0!==e.length?e.length:20)*s,this._angle=void 0!==e.angle?e.angle:225,this._position=void 0!==e.position?e.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(t){const e=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(t))return null;t.seekInPath(0);const s=t.x,i=t.y;t.seekInPath(t.pathSize-1);const r=t.x,o=t.y,a=[r-s,o-i];this._curveHelper.normalize(a);const l=s+(r-s)*this._position/100,h=i+(o-i)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let c=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(c=-c),this._mirror=!this._mirror;const m=[l-this._length/2*u,h-this._length/2*c],d=[l+this._length/2*u,h+this._length/2*c];return e.pushPath([[s,i],m,d,[r,o]]),e}}},37330:(t,e,s)=>{s.d(e,{V:()=>n});class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,s,n,r){return new i(t,e,s)}}class i{constructor(t,e,s){this._inputGeometries=t,this._offsetX=void 0!==e.offsetX?e.offsetX*s:0,this._offsetY=void 0!==e.offsetY?e.offsetY*s:0}next(){let t=this._inputGeometries.next();for(;t;){if(t.totalSize>0)return this._move(t.clone(),this._offsetX,this._offsetY);t=this._inputGeometries.next()}return null}_move(t,e,s){for(;t.nextPath();)for(;t.nextPoint();)t.x=t.x+e,t.y=t.y+s;return t.reset(),t}}},96876:(t,e,s)=>{s.d(e,{V:()=>u});var n=s(14816),i=s(18159),r=s(78983),o=s(1171),a=s(13022),l=s(95994),h=s(63643);class u{static{this.instance=null}static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(t,e,s,n,i,r,o){return new c(t,e,s,n,i,r,o)}}class c{constructor(t,e,s,n,i,r,o){this._preventClipping=o,this._inputGeometries=t,this._tileKey=n,this._geometryEngine=i,this._curveHelper=new l.I,this._offset=(e.offset??1)*s,this._method=e.method,this._maxInflateSize=Math.max(Math.abs(r*s),10),this._option=e.option,this._offsetFlattenError=l.U*s}next(){let t;for(;t=this._inputGeometries.next();){if(0===this._offset)return t.clone();if("esriGeometryEnvelope"===t.geometryType){if(this._method===h.xw.Rounded&&this._offset>0){const e=(0,i.A)(t),s=this._curveHelper.offset(e,-this._offset,this._method,4,this._offsetFlattenError);if(s){const e=n.z.createEmptyOptimizedCIM(t.geometryType);return e.pushPath(s),e}return null}const e=t.asJSON();if((0,o.ZC)(e)&&Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._offset>0)return n.z.fromJSONCIM({xmin:e.xmin-this._offset,xmax:e.xmax+this._offset,ymin:e.ymin-this._offset,ymax:e.ymax+this._offset})}const e=this._geometryEngine;if(null==e)continue;const s=!this._preventClipping&&this._tileKey?(0,a.q)(t,this._maxInflateSize,!0):t.clone();if(!s)continue;const l=e.offset(r.A.WebMercator,s.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return l?n.z.fromJSONCIM(l):null}return null}}},46764:(t,e,s)=>{s.d(e,{h:()=>o});var n=s(14816),i=s(23806),r=s(7591);class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,s,n,i){return new a(t,e,s)}}class a{constructor(t,e,s){this._inputGeometries=t,this._length=(void 0!==e.length?e.length:r.D.CIMGeometricEffectRadial.length)*s,this._angle=void 0!==e.angle?e.angle*Math.PI/180:r.D.CIMGeometricEffectRadial.angle,this._lx=Math.cos(this._angle)*this._length,this._ly=Math.sin(this._angle)*this._length}next(){let t=this._inputGeometries.next();for(;t;){if("esriGeometryPoint"===t.geometryType||"esriGeometryMultipoint"===t.geometryType){const e=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");return t.nextPath()&&t.nextPoint()&&e.pushPath([[t.x,t.y],[t.x+this._lx,t.y+this._ly]]),e}if("esriGeometryPolygon"===t.geometryType){const e=(0,i.IK)(t);if(!e)return null;const s=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");return s.pushPath([[e[0],e[1]],[e[0]+this._lx,e[1]+this._ly]]),s}t=this._inputGeometries.next()}return null}}},35893:(t,e,s)=>{s.d(e,{C:()=>n});class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,s,n,r){return new i(t,e,s)}}class i{constructor(t,e,s){this._inputGeometries=t,this._reverse=void 0===e.reverse||e.reverse}next(){let t=this._inputGeometries.next();for(;t;){if(!this._reverse)return t;if("esriGeometryPolyline"===t.geometryType)return r(t.clone());t=this._inputGeometries.next()}return null}}function r(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const s=t.x,n=t.y;t.seekInPath(t.pathSize-e-1);const i=t.x,r=t.y;t.x=s,t.y=n,t.seekInPath(e),t.x=i,t.y=r}return t.reset(),t}},26768:(t,e,s)=>{s.d(e,{v:()=>i});var n=s(36358);class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(t,e,s,n,i){return new r(t,e,s)}}class r{constructor(t,e,s){this._inputGeometries=t,this._rotateAngle=void 0!==e.angle?e.angle*Math.PI/180:0}next(){let t=this._inputGeometries.next();for(;t;){if(0===this._rotateAngle||"esriGeometryPoint"===t.geometryType)return t;if(t.totalSize>0){const e=(0,n.z8)(t),s=(e[2]+e[0])/2,i=(e[3]+e[1])/2;return t.reset(),this._rotate(t.clone(),s,i)}t=this._inputGeometries.next()}return null}_rotate(t,e,s){const n=Math.cos(this._rotateAngle),i=Math.sin(this._rotateAngle);for(;t.nextPath();)for(;t.nextPoint();){const r=t.x-e,o=t.y-s;t.x=e+r*n-o*i,t.y=s+r*i+o*n}return t.reset(),t}}},3465:(t,e,s)=>{s.d(e,{W:()=>i});var n=s(36358);class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(t,e,s,n,i){return new r(t,e,s)}}class r{constructor(t,e,s){this._inputGeometries=t,this._xFactor=void 0!==e.xScaleFactor?e.xScaleFactor:1.15,this._yFactor=void 0!==e.yScaleFactor?e.yScaleFactor:1.15}next(){const t=this._inputGeometries.next();if(t){if(1===this._xFactor&&1===this._yFactor)return t;if("esriGeometryPoint"===t.geometryType)return t;if(t.totalSize>0){const e=(0,n.z8)(t),s=(e[2]+e[0])/2,i=(e[3]+e[1])/2;return t.reset(),this._scaleCursor(t.clone(),s,i)}}return null}_scaleCursor(t,e,s){for(;t.nextPath();)for(;t.nextPoint();)t.x=e+(t.x-e)*this._xFactor,t.y=s+(t.y-s)*this._yFactor;return t.reset(),t}}},68652:(t,e,s)=>{s.d(e,{L:()=>o});var n=s(14816),i=s(58127),r=s(61716);class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,s,n,i){return new a(t,e,s)}}class a extends r.rx{constructor(t,e,s){super(t,!1,!0),this._suppress=void 0!==e.suppress&&e.suppress,this._invert=void 0!==e.invert&&e.invert}processPath(t){if(t.totalSize<=0)return null;if(!this._suppress){const e=n.z.createEmptyOptimizedCIM("esriGeometryPolygon",!1,!1,t.yFactor);for(t.seekPathEnd();t.nextPoint();)e.pushXY(t.x,t.y);return e}const e=[],s=new Array(t.pathSize);let r=0;for(t.seekPathStart();t.nextPoint();)s[r++]=t.getControlPoint(),e.push([t.x,t.y]);let o=!0,a=!0,l=!1,h=!this._invert;r=0;const u=new i.A;let c=e[0];for(;r<e.length;){const t=e[r+1],n=s[r],i=s[r+1];r++,a&&(h=n||i?this._invert:!this._invert,a=!1),h?(u.addSegment(c,t,o),o=!1):l=!0,c=t,i&&(h?(h=!1,o=!0):h=!0)}const m=u.getGeometry();if(0===m.length)return null;if(!l&&e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]){const t=m[m.length-1];return t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]]),n.z.fromJSONCIM({paths:m})}const d=m[m.length-1];return u.getPointCount()>1&&"esriGeometryPolygon"===t.geometryType&&d[0][0]===d[d.length-1][0]&&d[0][1]===d[d.length-1][1]&&m.length>1&&(m[m.length-1].push(...m[0]),m.splice(0,1)),n.z.fromJSONCIM({paths:m})}}},42088:(t,e,s)=>{s.d(e,{t:()=>g});var n=s(98849),i=s(539),r=s(14816),o=s(78983),a=s(65319),l=s(1171),h=s(58127),u=s(87569),c=s(61716),m=s(71474);const d=()=>i.A.getLogger("esri.symbols.cim.effects.EffectTaperedPolygon");class g{static{this.instance=null}static local(){return null===g.instance&&(g.instance=new g),g.instance}execute(t,e,s,n,i){return new p(t,e,s,n,i)}}class p extends c.rx{constructor(t,e,s,n,i){super(t,!1,!0),this._slopeS=0,this._slopeC=1,this._lastTangent1=new u.bR(NaN,NaN),this._lastWidth=0,this._tileKey=null,this._halfFromWidth=Math.abs(void 0!==e.fromWidth?e.fromWidth:0)*s*.5,this._halfToWidth=Math.abs(void 0!==e.toWidth?e.toWidth:1)*s*.5,this._originalLength=(void 0!==e.length?e.length:0)*s,this._length=0,this._tileKey=n,this._geometryEngine=i}processPath(t){if(t.totalSize<=0)return null;if(this._halfFromWidth<=0&&this._halfToWidth<=0){const e=r.z.createEmptyOptimizedCIM("esriGeometryPolygon",!1,!1,t.yFactor);for(t.seekPathEnd();t.prevPoint();)e.pushXY(t.x,t.y);for(t.seekPathStart();t.nextPoint();)e.pushXY(t.x,t.y);return e}const e=[];t.seekPathStart();let s=0,i=0;for(;t.nextPoint();)e.push([t.x-s,t.y-i]),s=t.x,i=t.y;let u=this._geometryEngine?.simplify(o.A.WebMercator,{paths:[e]});u||null!=this._tileKey||(u={paths:[e]});const c=(0,l.Bi)(u)?u.rings:(0,l.Rg)(u)?u.paths:null;if(!c)return d().error(new n.A("mapview-bad-resource","Unable to process geometry")),null;const g=new h.A,p=new h.A;let _=0;for(const n of c){s=n[0][0],i=n[0][1];for(let t=1;t<n.length;t++){const e=s+n[t][0],r=i+n[t][1];_+=Math.sqrt((e-s)*(e-s)+(r-i)*(r-i)),s=e,i=r}}if(0===this._originalLength||this._originalLength>_){this._length=_;const t=(this._halfToWidth-this._halfFromWidth)/this._length;if(Math.abs(t)<1){const e=t*t;this._slopeC=Math.sqrt(1/(1+e)),this._slopeS=Math.sqrt(e/(1+e)),t<0&&(this._slopeS=-this._slopeS)}else this._slopeC=this._slopeS=.7071}else this._length=this._originalLength,this._slopeC=1,this._slopeS=0;let f=0;const y=[];for(const n of c){const t=m.Wk.create(n),e=m.Wk.create(n);this._setFromOffset(e,g,p);let s=e.next(),i=t;for(;s&&i;)f=this._setOffset(i,s,f,g,p),i=t.next(),s=e.next();i=t,i&&this._setToOffset(i,f,g,p);const r=g.getGeometry(),o=p.getGeometry(),a=[];for(const n of r)a.push(...n);for(let n=o.length-1;n>=0;n--){const t=o[n];for(let e=t.length-1;e>=0;e--)a.push(t[e])}y.push(a)}const x={rings:y};(0,a.uC)(x);let v=this._geometryEngine?.simplify(o.A.WebMercator,x);if(!v){if(null!=this._tileKey)return null;v=x}return r.z.fromJSONCIM(v)}_setFromOffset(t,e,s){const n=this._halfFromWidth,i=new u.bR(t.xEnd-t.xStart,t.yEnd-t.yStart);i.normalize(),i.scale(n),e.beginPath([t.xStart-i.y,t.yStart+i.x]),s.beginPath([t.xStart+i.y,t.yStart-i.x])}_setToOffset(t,e,s,n){let i;i=(e+=Math.sqrt((t.xEnd-t.xStart)*(t.xEnd-t.xStart)+(t.yEnd-t.yStart)*(t.yEnd-t.yStart)))>=this._length?this._halfToWidth:this._halfFromWidth+(this._halfToWidth-this._halfFromWidth)*e/this._length;const r=new u.bR(t.xEnd-t.xStart,t.yEnd-t.yStart);r.normalize(),r.scale(i),s.lineTo([t.xEnd-r.y,t.yEnd+r.x]),n.lineTo([t.xEnd+r.y,t.yEnd-r.x])}_setOffset(t,e,s,i,r){const o=Math.sqrt((t.xEnd-t.xStart)*(t.xEnd-t.xStart)+(t.yEnd-t.yStart)*(t.yEnd-t.yStart));let a;a=s+o>=this._length?this._halfToWidth:this._halfFromWidth+(this._halfToWidth-this._halfFromWidth)*(s+o)/this._length,s+=o;const l=new u.bR(t.xEnd,t.yEnd),h=new u.bR(t.xEnd-t.xStart,t.yEnd-t.yStart);h.normalize();const c=new u.bR(e.xEnd-e.xStart,e.yEnd-e.yStart);c.normalize();const m=h.x*c.y-h.y*c.x;let g;g=0===Math.abs(m)?new u.bR(c.x,c.y):new u.bR((c.x-h.x)/m,(c.y-h.y)/m);const p=i.getPointCount(),_=r.getPointCount();h.leftPerpendicular(),c.leftPerpendicular();const f=h.x*c.x+h.y*c.y;if(f>.99){const t=new u.bR((h.x+c.x)*a/2,(h.y+c.y)*a/2),e=t.clone();e.rotate(this._slopeC,this._slopeS),i.lineTo([l.x+e.x,l.y+e.y]);const s=t.clone();s.rotateReverse(this._slopeC,this._slopeS),r.lineTo([l.x-s.x,l.y-s.y])}else{if(m<0){const t=g.clone().scale(-a);t.rotateReverse(this._slopeC,this._slopeS);const e=r.getXY(_-1);e||d().error(new n.A("mapview-bad-resource","Unable to process geometry, index out of scope"));const s=u.bR.add(l,t),i=u.bR.sub(s,u.bR.fromArray(e));if(h.x*i.y-h.y*i.x>0){const t=new u.bR(-h.x*a,-h.y*a);t.rotateReverse(this._slopeC,this._slopeS);const e=new u.bR(-c.x*a,-c.y*a);e.rotateReverse(this._slopeC,this._slopeS),r.lineTo([l.x+t.x,l.y+t.y]),r.lineTo([l.x,l.y]),r.lineTo([l.x+e.x,l.y+e.y])}else r.lineTo([l.x+t.x,l.y+t.y])}else{const t=g.clone().scale(a);t.rotate(this._slopeC,this._slopeS);const e=i.getXY(p-1);e||d().error(new n.A("mapview-bad-resource","Unable to process geometry, index out of scope"));const s=u.bR.add(l,t),r=u.bR.sub(s,u.bR.fromArray(e));if(h.x*r.y-h.y*r.x>0){const t=h.clone().scale(a);t.rotate(this._slopeC,this._slopeS);const e=c.clone().scale(a);e.rotate(this._slopeC,this._slopeS),i.lineTo([l.x+t.x,l.y+t.y]),i.lineTo([l.x,l.y]),i.lineTo([l.x+e.x,l.y+e.y])}else i.lineTo([l.x+t.x,l.y+t.y])}const e=Math.acos(f);let s=1;if(a>.25){const t=2*Math.acos(1-.25/a);t<e&&(s=Math.round(e/t))}const o=Math.cos(e/s),y=Math.sin(e/s),x=h.clone();if(m<0){x.rotate(this._slopeC,this._slopeS);const e=i.getXY(p-1);e||d().error(new n.A("mapview-bad-resource","Unable to process geometry, index out of scope"));const s=u.bR.add(l,x.clone().scale(this._lastWidth)),r=u.bR.sub(s,u.bR.fromArray(e)),o=h.x*r.y-h.y*r.x;if(!isNaN(this._lastTangent1.x)&&!isNaN(this._lastTangent1.y)&&o>0){const e=new u.bR(t.xStart,t.yStart),s=this._lastTangent1.clone().scale(this._lastWidth);s.rotate(this._slopeC,this._slopeS);const n=h.clone().scale(this._lastWidth);n.rotate(this._slopeC,this._slopeS),i.lineTo([e.x+s.x,e.y+s.y]),i.lineTo([e.x,e.y]),i.lineTo([e.x+n.x,e.y+n.y])}}else{x.scale(-1).rotateReverse(this._slopeC,this._slopeS);const e=r.getXY(_-1);e||d().error(new n.A("mapview-bad-resource","Unable to process geometry, index out of scope"));const s=u.bR.add(l,x.clone().scale(this._lastWidth)),i=u.bR.sub(s,u.bR.fromArray(e)),o=h.x*i.y-h.y*i.x;if(!isNaN(this._lastTangent1.x)&&!isNaN(this._lastTangent1.y)&&o>0){const e=new u.bR(t.xStart,t.yStart),s=this._lastTangent1.clone().scale(-this._lastWidth);s.rotateReverse(this._slopeC,this._slopeS);const n=h.clone().scale(-this._lastWidth);n.rotateReverse(this._slopeC,this._slopeS),r.lineTo([e.x+s.x,e.y+s.y]),r.lineTo([e.x,e.y]),r.lineTo([e.x+n.x,e.y+n.y])}}x.scale(a);for(let t=0;t<=s;t++)m<0?(i.lineTo([l.x+x.x,l.y+x.y]),x.rotateReverse(o,y)):(r.lineTo([l.x+x.x,l.y+x.y]),x.rotate(o,y))}return this._lastTangent1.setCoords(h.x,h.y),this._lastWidth=a,s}}},18814:(t,e,s)=>{s.d(e,{l:()=>o});var n=s(14816),i=s(63643),r=s(42471);class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,s,n,i){return new a(t,e,s)}}class a{constructor(t,e,s){this._inputGeometries=t,this._height=(void 0!==e.amplitude?e.amplitude:2)*s,this._period=(void 0!==e.period?e.period:3)*s,this._style=e.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new r.VA,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new r.Z1,this._walker.updateTolerance(s)}next(){let t=this._inputGeometries.next();for(;t;){if(0===this._height||0===this._period)return t;const e=this._processGeom(t);if(e)return e;t=this._inputGeometries.next()}return null}_processGeom(t){const e=n.z.createEmptyOptimizedCIM(t.geometryType);for(;t.nextPath();){e.startPath();const s=t.pathLength();if(this._walker.init(t,this._pattern))switch(this._style){case i.WE.Sinus:default:this._constructCurve(e,s,!1);break;case i.WE.Square:this._constructSquare(e,s);break;case i.WE.Triangle:this._constructTriangle(e,s);break;case i.WE.Random:this._constructCurve(e,s,!0)}else for(;t.nextPoint();)e.pushXY(t.x,t.y)}return e}_constructCurve(t,e,s){let n=Math.round(e/this._period);0===n&&(n=1);const i=16*n+1,o=e/n,a=this._period/16,l=1/i,h=2*Math.PI*e/o,u=2*Math.PI*Math.random(),c=2*Math.PI*Math.random(),m=2*Math.PI*Math.random(),d=.75-Math.random()/2,g=.75-Math.random()/2,p=new r.ps;this._walker.curPointAndAngle(p),t.pushPoint(p.pt);let _=0;for(;;){if(!this._walker.nextPointAndAngle(a,p)){t.pushPoint(this._walker.getPathEnd());break}{const e=_;let n;if(_+=l,s){const t=this._height/2*(1+.3*Math.sin(d*h*e+u));n=t*Math.sin(h*e+c),n+=t*Math.sin(g*h*e+m),n/=2}else n=.5*this._height*Math.sin(.5*h*e);t.pushXY(p.pt[0]-n*p.sa,p.pt[1]+n*p.ca)}}}_constructSquare(t,e){Math.round(e/this._period);let s=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const n=new r.ps;this._walker.curPointAndAngle(n);const i=new r.ps;if(this._walker.nextPointAndAngle(this._period,i)){const o=new r.ps;this._walker.nextPointAndAngle(this._period,o)&&(s?(t.pushPoint(n.pt),s=!1):t.pushPoint(n.pt),t.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),t.pushXY(i.pt[0]-this._height/2*i.sa,i.pt[1]+this._height/2*i.ca),t.pushXY(i.pt[0]+this._height/2*i.sa,i.pt[1]-this._height/2*i.ca),t.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e=!0)}}if(!e){t.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(t,e){Math.round(e/this._period);let s=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const n=new r.ps;this._walker.curPointAndAngle(n);const i=new r.ps;if(this._walker.nextPointAndAngle(this._period/2,i)){const o=new r.ps;this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(s?(t.pushPoint(n.pt),s=!1):t.pushPoint(n.pt),t.pushXY(i.pt[0]-this._height/2*i.sa,i.pt[1]+this._height/2*i.ca),t.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca)),e=!0)}}if(!e){t.pushPoint(this._walker.getPathEnd());break}}}}},63643:(t,e,s)=>{var n,i,r,o,a,l,h,u,c,m,d,g,p,_,f,y,x,v,b,P,S,E,C,w,I,T,A,M,D,N,F,R,k,L,G,V,z,O,q,B,Y,U,H,X,j,Z,W,$,K,Q,J,tt,et,st,nt,it,rt,ot,at,lt,ht,ut,ct;s.d(e,{$2:()=>a,Ao:()=>w,C1:()=>r,Hz:()=>g,JO:()=>i,M1:()=>C,O$:()=>at,OW:()=>it,Q1:()=>$,TZ:()=>x,WE:()=>D,Y:()=>h,YI:()=>Q,bj:()=>u,e_:()=>W,f0:()=>ot,fu:()=>d,g7:()=>c,h5:()=>st,ip:()=>K,mU:()=>N,oF:()=>S,uQ:()=>E,uT:()=>O,vG:()=>ht,wd:()=>U,xR:()=>n,xn:()=>v,xw:()=>T,yS:()=>q}),function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"}(n||(n={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(i||(i={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(r||(r={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(o||(o={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(a||(a={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(l||(l={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(h||(h={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(u||(u={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(c||(c={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(m||(m={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(d||(d={})),function(t){t.Linear="Linear",t.EaseIn="EaseIn",t.EaseOut="EaseOut",t.EaseInOut="EaseInOut"}(g||(g={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(p||(p={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(_||(_={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(f||(f={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(y||(y={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(x||(x={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(v||(v={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(b||(b={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(P||(P={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(S||(S={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees",t.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks",t.ConcentricCircles="ConcentricCircles",t.DoubleJogArrow="DoubleJogArrow",t.LinkedChevrons="LinkedChevrons",t.SegmentThenHalfCircle="SegmentThenHalfCircle",t.LineWithStraightTicks="LineWithStraightTicks",t.DoubleCurve="DoubleCurve",t.ParallelWithTicksByWidth="ParallelWithTicksByWidth",t.EnclosingRoundedRectangle="EnclosingRoundedRectangle"}(E||(E={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(C||(C={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(w||(w={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(I||(I={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(T||(T={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(A||(A={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(M||(M={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(D||(D={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(N||(N={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(F||(F={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(R||(R={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(k||(k={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AlongLine=1]="AlongLine"}(L||(L={})),function(t){t[t.Auto=0]="Auto",t[t.Clockwise=1]="Clockwise",t[t.Counterclockwise=2]="Counterclockwise"}(G||(G={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(V||(V={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(z||(z={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(O||(O={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(q||(q={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(B||(B={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(Y||(Y={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(U||(U={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(H||(H={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(X||(X={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(j||(j={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(Z||(Z={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(W||(W={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}($||($={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(K||(K={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(Q||(Q={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(J||(J={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(tt||(tt={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(et||(et={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(st||(st={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(nt||(nt={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(it||(it={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(rt||(rt={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(ot||(ot={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(at||(at={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(lt||(lt={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(ht||(ht={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(ut||(ut={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(ct||(ct={}))},66045:(t,e,s)=>{s.d(e,{e:()=>o});var n=s(61716),i=s(63643),r=s(42471);class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,s,n,i){return new a(t,e,s)}}class a extends n.pC{constructor(t,e,s){super(t),this._geometryWalker=new r.Z1,this._geometryWalker.updateTolerance(s),this._angleToLine=e.angleToLine??!0,this._offset=(e.offset?e.offset:0)*s,this._originalEndings=e.endings,this._offsetAtEnd=(e.customEndingOffset?e.customEndingOffset:0)*s,this._position=-(e.offsetAlongLine?e.offsetAlongLine:0)*s,this._pattern=new r.VA,this._pattern.init(e.placementTemplate,!1),this._pattern.scale(s),this._endings=this._originalEndings}processPath(t){if(this._pattern.isEmpty())return null;let e;if(this.iteratePath)e=this._pattern.nextValue();else{this._originalEndings===i.e_.WithFullGap&&this.isClosed?this._endings=i.e_.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let s,n=!0;switch(this._endings){case i.e_.NoConstraint:s=-this._position,s=this._adjustPosition(s),n=!1;break;case i.e_.WithHalfGap:default:s=-this._pattern.lastValue()/2;break;case i.e_.WithFullGap:s=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case i.e_.WithMarkers:s=0;break;case i.e_.Custom:s=-this._position,s=this._adjustPosition(s),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(t,this._pattern,n))return null;this._pattern.reset();let r=0;for(;s>r;)s-=r,r=this._pattern.nextValue();r-=s,e=r,this.iteratePath=!0}const s=new r.ps;return this._geometryWalker.nextPointAndAngle(e,s)?this._endings===i.e_.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===i.e_.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(s.pt[0]-this._offset*s.sa,s.pt[1]+this._offset*s.ca),this._angleToLine&&this.internalPlacement.setRotateCS(s.ca,s.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(t){let e=t/this._pattern.length();return e-=Math.floor(e),e*this._pattern.length()}}},98537:(t,e,s)=>{s.d(e,{y:()=>o});var n=s(61716),i=s(95994),r=s(63643);class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,s,n,i){return new a(t,e,s)}}class a extends n.pC{constructor(t,e,s){super(t,!1,!0),this._curveHelper=new i.I,this._placePerPart=e.placePerPart??!1,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*s:0,this._type=e.extremityPlacement,this._position=void 0!==e.offsetAlongLine?e.offsetAlongLine*s:0,this._beginProcessed=!1}processMultiPath(t){return this._placePerPart?super.processMultiPath(t):this.processPath(t)}processPath(t){let e;switch(this._type){case r.$2.Both:default:this._beginProcessed?(e=this._atExtremities(t,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(e=this._atExtremities(t,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case r.$2.JustBegin:e=this._atExtremities(t,this._position,!0);break;case r.$2.JustEnd:e=this._atExtremities(t,this._position,!1);case r.$2.None:}return e}_atExtremities(t,e,s){if(this._placePerPart||(s?t.seekPath(0):t.seekPath(t.totalSize-1)),s||t.seekPathEnd(),s?t.nextPoint():t.prevPoint()){let n=0,[i,r]=[0,0],[o,a]=[t.x,t.y];const l=[0,0];for(;s?t.nextPoint():t.prevPoint();){i=o,r=a,o=t.x,a=t.y;const s=this._curveHelper.getLength(i,r,o,a);if(n+s>e){const t=(e-n)/s,[h,u]=this._curveHelper.getAngleCS(l,i,r,o,a,t),c=this._curveHelper.getCoord2D(i,r,o,a,t);return this.internalPlacement.setTranslate(c[0]-this._offset*u,c[1]+this._offset*h),this._angleToLine&&this.internalPlacement.setRotateCS(-h,-u),this.internalPlacement}n+=s}}return null}}},90957:(t,e,s)=>{s.d(e,{S:()=>r});var n=s(61716),i=s(42471);class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(t,e,s,n,i){return new o(t,e,s)}}class o extends n.pC{constructor(t,e,s){super(t),this._walker=new i.Z1,this._walker.updateTolerance(s),this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*s:0,this._beginGap=void 0!==e.beginPosition?e.beginPosition*s:0,this._endGap=void 0!==e.endPosition?e.endPosition*s:0,this._flipFirst=void 0===e.flipFirst||e.flipFirst,this._pattern=new i.VA,this._pattern.init(e.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(t){if(this._pattern.isEmpty())return null;let e;if(this.iteratePath){const t=this._pattern.nextValue()*this._subPathLen,s=this._beginGap+t;e=s-this._prevPos,this._prevPos=s}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=t.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(t,this._pattern,!1))return null;this._pattern.reset();const s=this._pattern.nextValue()*this._subPathLen,n=this._beginGap+s;e=n-this._prevPos,this._prevPos=n,this.iteratePath=!0}const s=new i.ps;if(!this._walker.nextPointAndAngle(e,s,i.YQ.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(s.pt[0]-this._offset*s.sa,s.pt[1]+this._offset*s.ca);const n=this._isFirst&&this._flipFirst;let r,o;return this._angleToLine?(r=s.ca,o=s.sa):(r=1,o=0),n&&(r=-r,o=-o),this.internalPlacement.setRotateCS(r,o),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}},1127:(t,e,s)=>{s.d(e,{M:()=>h});var n=s(9272),i=s(82250),r=s(63643);const o=512,a=24,l=1e-6;class h{static{this.instance=null}static local(){return null===h.instance&&(h.instance=new h),h.instance}execute(t,e,s,n,i){return new u(t,e,s,n,i)}}class u{constructor(t,e,s,a,l){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(e.stepX??16)*s,this._stepY=Math.abs(e.stepY??16)*s,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=e.gridType??r.Q1.Fixed,this._gridType===r.Q1.Random){const t=e.seed??13,s=1;this._randomLCG=new n.A(t*s),this._randomness=(e.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=e.gridAngle??0,this._shiftOddRows=e.shiftOddRows??!1,this._offsetX=(e.offsetX??0)*s,this._offsetY=(e.offsetY??0)*s,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=a){const[t,e,s,n]=a.split("/"),i=parseFloat(t),r=parseFloat(e),l=parseFloat(s),h=parseFloat(n);this._graphicOriginX=-(h*2**i+l)*o,this._graphicOriginY=r*o,this._testInsidePolygon=!0}this._internalPlacement=new i.W,this._calculateMinMax(t),this._geometryCursor=t}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!u._randValues){u._randValues=[];for(let t=0;t<a;t++)for(let e=0;e<a;e++)u._randValues.push(this._randomLCG.getFloat()),u._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(t){let e,s,n,i,r,a,l,h,u,c,m,d,g,p;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=h=g=m=Number.MAX_VALUE,u=c=p=d=-Number.MAX_VALUE;const _=1!==this._cosAngle;for(t.reset();t.nextPath();)for(;t.nextPoint();)a=t.x,r=t.y,e=a-this._graphicOriginX-this._offsetX,s=r-this._graphicOriginY-this._offsetY,_?(n=this._cosAngle*e-this._sinAngle*s,i=this._sinAngle*e+this._cosAngle*s):(n=e,i=s),l=Math.min(l,n),u=Math.max(u,n),h=Math.min(h,i),c=Math.max(c,i),m=Math.min(m,r),d=Math.max(d,r),g=Math.min(g,a),p=Math.max(p,a);m=m!==Number.MAX_VALUE?m:-512-this._stepY,d=d!==-Number.MAX_VALUE?d:this._stepY,g=g!==Number.MAX_VALUE?g:-this._stepX,p=p!==-Number.MAX_VALUE?p:o+this._stepX;const f=d-m,y=p-g;if(this._verticalSubdivision=f>=y,this._polygonMin=this._verticalSubdivision?m:g,this._testInsidePolygon){let t=0-this._graphicOriginX-this._offsetX-this._stepX,e=o-this._graphicOriginX-this._offsetX+this._stepX,s=-512-this._graphicOriginY-this._offsetY-this._stepY,n=0-this._graphicOriginY-this._offsetY+this._stepY;if(_){const i=[[t,s],[t,n],[e,s],[e,n]];t=s=Number.MAX_VALUE,e=n=-Number.MAX_VALUE;for(const r of i){const i=this._cosAngle*r[0]-this._sinAngle*r[1],o=this._sinAngle*r[0]+this._cosAngle*r[1];t=Math.min(t,i),e=Math.max(e,i),s=Math.min(s,o),n=Math.max(n,o)}}l=l!==Number.MAX_VALUE?Math.max(l,t):t,h=h!==Number.MAX_VALUE?Math.max(h,s):s,u=u!==-Number.MAX_VALUE?Math.min(u,e):e,c=c!==-Number.MAX_VALUE?Math.min(c,n):n}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(h/this._stepY),this._yMax=Math.round(c/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(t,g,p,m,d)}_buildAccelerationMap(t,e,s,n,i){t.reset();const r=new Map,a=this._verticalSubdivision,l=a?i-n:s-e;let h=Math.ceil(l/10);if(h<=1)return;const u=Math.floor(l/h);let m,d,g,p,_,f,y,x,v,b,P;for(h++,this._delta=u,a?(v=-512-2*this._stepY,b=2*this._stepY,P=n):(v=-2*this._stepX,b=o+2*this._stepX,P=e);t.nextPath();)if(!(t.pathSize<2)&&t.nextPoint())for(m=t.x,d=t.y;t.nextPoint();m=g,d=p){if(g=t.x,p=t.y,a){if(d===p||d<v&&p<v||d>b&&p>b)continue;_=Math.min(d,p),f=Math.max(d,p)}else{if(m===g||m<v&&g<v||m>b&&g>b)continue;_=Math.min(m,g),f=Math.max(m,g)}for(;_<f;)y=Math.floor((_-P)/u),c(y,m,d,g,p,r),_+=u;x=Math.floor((f-P)/u),x>y&&c(x,m,d,g,p,r)}this._accelerationMap=r}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let t=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(t+=.5*this._stepX);const e=this._currentY*this._stepY+this._offsetY;let s,n;if(this._currentX++,this._gridType===r.Q1.Random){const i=(this._currentX%a+a)%a,r=(this._currentY%a+a)%a;s=this._graphicOriginX+t+this._stepX*this._randomness*(.5-u._randValues[r*a+i])*2/3,n=this._graphicOriginY+e+this._stepY*this._randomness*(.5-u._randValues[r*a+i+1])*2/3}else s=this._graphicOriginX+this._cosAngle*t+this._sinAngle*e,n=this._graphicOriginY-this._sinAngle*t+this._cosAngle*e;if(!this._testInsidePolygon||this._isInsidePolygon(s,n,this._geometryCursor))return this._internalPlacement.setTranslate(s,n),this._internalPlacement}}_isInsidePolygon(t,e,s){if(null==this._accelerationMap)return function(t,e,s){let n,i,r,o,a=0;for(t+=l,e+=l,s.reset();s.nextPath();)if(s.nextPoint())for(n=s.x,i=s.y;s.nextPoint();n=r,i=o)r=s.x,o=s.y,i>e!=o>e&&((r-n)*(e-i)-(o-i)*(t-n)>0?a++:a--);return 0!==a}(t,e,s);t+=l,e+=l;const n=this._verticalSubdivision,i=n?e:t,r=Math.floor((i-this._polygonMin)/this._delta),o=this._accelerationMap.get(r);if(!o)return!1;let a,h,u,c=0;for(const l of o){if(a=l[0],h=l[1],n){if(a[1]>e==h[1]>e)continue;u=(h[0]-a[0])*(e-a[1])-(h[1]-a[1])*(t-a[0])}else{if(a[0]>t==h[0]>t)continue;u=(h[1]-a[1])*(t-a[0])-(h[0]-a[0])*(e-a[1])}u>0?c++:c--}return 0!==c}}function c(t,e,s,n,i,r){let o=r.get(t);o||(o=[],r.set(t,o)),o.push([[e,s],[n,i]])}},22682:(t,e,s)=>{s.d(e,{R:()=>o});var n=s(61716),i=s(95994),r=s(63643);class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,s,n,i){return new a(t,e,s)}}class a extends n.pC{constructor(t,e,s){super(t),this._curveHelper=new i.I,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*s:0,this._relativeTo=e.relativeTo,this._position=void 0!==e.startPointOffset?e.startPointOffset*s:0,this._epsilon=.001*s}processPath(t){const e=this._position;if(this._relativeTo===r.ip.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),t.nextPoint()){let[e,s]=[t.x,t.y],[n,i]=[0,0];const r=[0,0];for(;t.nextPoint();){n=t.x,i=t.y;const o=this._curveHelper.getLength(e,s,n,i);if(o<this._epsilon){e=n,s=i;continue}const a=.5+this._position/o,[l,h]=this._curveHelper.getAngleCS(r,e,s,n,i,a),u=this._curveHelper.getCoord2D(e,s,n,i,a);return this.internalPlacement.setTranslate(u[0]-this._offset*h,u[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(l,h),this.internalPlacement}}return this.iteratePath=!1,null}const s=this._relativeTo===r.ip.LineEnd;return this.onLine(t,e,s)}onLine(t,e,s){let n,i=!1;switch(this._relativeTo){case r.ip.LineMiddle:default:t.seekPathStart(),n=t.pathLength()/2+e;break;case r.ip.LineBeginning:n=e;break;case r.ip.LineEnd:n=e,i=!0}s?t.seekPathEnd():t.seekPathStart();let o=0;if(s?t.prevPoint():t.nextPoint()){let[e,r]=[t.x,t.y],[a,l]=[0,0];const h=[0,0];for(;s?t.prevPoint():t.nextPoint();){a=t.x,l=t.y;const s=this._curveHelper.getLength(e,r,a,l);if(o+s>n){const t=(n-o)/s,[u,c]=this._curveHelper.getAngleCS(h,e,r,a,l,t),m=this._curveHelper.getCoord2D(e,r,a,l,t),d=i?-this._offset:this._offset;return this.internalPlacement.setTranslate(m[0]-d*c,m[1]+d*u),this._angleToLine&&(i?this.internalPlacement.setRotateCS(-u,-c):this.internalPlacement.setRotateCS(u,c)),this.internalPlacement}e=a,r=l,o+=s}}return null}}},11712:(t,e,s)=>{s.d(e,{A:()=>r});var n=s(61716),i=s(95994);class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(t,e,s,n,i){return new o(t,e,s)}}class o extends n.pC{constructor(t,e,s){super(t),this._curveHelper=new i.I,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*s:0,this._endPoints=void 0===e.placeOnEndPoints||e.placeOnEndPoints,this._controlPoints=void 0===e.placeOnControlPoints||e.placeOnControlPoints,this._regularVertices=void 0===e.placeOnRegularVertices||e.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(t){if(this.iteratePath||(this._preparePath(t),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const e=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(e[2]);let s=e[0],n=e[1];if(0!==this._offset){const t=Math.cos(e[2]),i=Math.sin(e[2]);s-=this._offset*i,n+=this._offset*t}return this.internalPlacement.setTranslate(s,n),this._tagIterator++,this.internalPlacement}_preparePath(t){this._tags.length=0,this._tagIterator=0,t.seekPathStart();const e=t.isClosed();let s=0,n=!1,i=0,r=0;if(t.seekPathStart(),t.nextPoint()){let o=t.x,l=t.y,h=t.getControlPoint(),u=!0,c=t.nextPoint();for(;c;){const m=t.x,d=t.y,g=t.getControlPoint();(this._angleToLine||0!==this._offset)&&(i=this._curveHelper.getAngle(o,l,m,d,0)),u?(u=!1,e?(s=i,n=h):(this._endPoints||this._controlPoints&&h)&&this._tags.push([o,l,i])):h?this._controlPoints&&this._tags.push([o,l,a(r,i)]):this._regularVertices&&this._tags.push([o,l,a(r,i)]),(this._angleToLine||0!==this._offset)&&(r=this._curveHelper.getAngle(o,l,m,d,1)),c=t.nextPoint(),c||(e?g||n?this._controlPoints&&this._tags.push([m,d,a(r,s)]):this._regularVertices&&this._tags.push([m,d,a(r,s)]):(this._endPoints||this._controlPoints&&g)&&this._tags.push([m,d,r])),o=m,l=d,h=g}}this._tagIterator=0}}function a(t,e){const s=Math.PI;for(;Math.abs(e-t)>s+2e-15;)e-t>s?e-=2*s:e+=2*s;return(t+e)/2}},48358:(t,e,s)=>{s.d(e,{L:()=>l});var n=s(36358),i=s(23806),r=s(73138),o=s(82250),a=s(63643);class l{static{this.instance=null}static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(t,e,s,n,i){return new h(t,e,s)}}class h{constructor(t,e,s){this._geometryCursor=t,this._offsetX=void 0!==e.offsetX?e.offsetX*s:0,this._offsetY=void 0!==e.offsetY?e.offsetY*s:0,this._method=void 0!==e.method?e.method:a.YI.OnPolygon,this._placementPerPart=void 0!==e.placePerPart&&e.placePerPart,this._internalPlacement=new o.W}next(){const t=this._geometryCursor;if(!t)return null;if(!this._placementPerPart)return this._geometryCursor=null,this._polygonCenter(t);for(;t.nextPath();)if(!(t.getCurrentRingArea()<0))return this._polygonCenter(t.getCurrentPath());return this._geometryCursor=null,null}_polygonCenter(t){let e=!1;switch(this._method){case a.YI.CenterOfMass:{const s=(0,i.TP)(t);s&&(this._internalPlacement.setTranslate(s[0]+this._offsetX,s[1]+this._offsetY),e=!0)}break;case a.YI.BoundingBoxCenter:{const s=(0,n.z8)(t);s&&(this._internalPlacement.setTranslate((s[2]+s[0])/2+this._offsetX,(s[3]+s[1])/2+this._offsetY),e=!0)}break;case a.YI.OnPolygon:default:{const s=(0,r.d)(t);null!==s&&(this._internalPlacement.setTranslate(s[0]+this._offsetX,s[1]+this._offsetY),e=!0)}}return e?this._internalPlacement:null}}},79126:(t,e,s)=>{s.d(e,{AH:()=>f,Kj:()=>p,Tl:()=>E,c5:()=>m,f0:()=>d,hs:()=>S,k2:()=>g});var n=s(51859),i=s(539),r=s(92504),o=s(6276),a=s(7591),l=s(43556);const h=()=>i.A.getLogger("esri.symbols.cim.rasterizingUtils"),u=32,c=t=>"vertical"===t||"horizontal"===t||"cross"===t||"esriSFSCross"===t||"esriSFSVertical"===t||"esriSFSHorizontal"===t;function m(t,e,s){const n=e.style,i=(0,r.yR)(Math.ceil(s)),o=c(n)?8*i:16*i,a=2*i;t.width=o,t.height=o;const l=t.getContext("2d");l.strokeStyle="#ffffff",l.lineWidth=i,l.beginPath(),"vertical"!==n&&"cross"!==n&&"esriSFSCross"!==n&&"esriSFSVertical"!==n||(l.moveTo(o/2,-a),l.lineTo(o/2,o+a)),"horizontal"!==n&&"cross"!==n&&"esriSFSCross"!==n&&"esriSFSHorizontal"!==n||(l.moveTo(-a,o/2),l.lineTo(o+a,o/2)),"backward-diagonal"!==n&&"diagonal-cross"!==n&&"esriSFSDiagonalCross"!==n&&"esriSFSBackwardDiagonal"!==n||(l.moveTo(-a,-a),l.lineTo(o+a,o+a),l.moveTo(o-a,-a),l.lineTo(o+a,a),l.moveTo(-a,o-a),l.lineTo(a,o+a)),"forward-diagonal"!==n&&"diagonal-cross"!==n&&"esriSFSForwardDiagonal"!==n&&"esriSFSDiagonalCross"!==n||(l.moveTo(o+a,-a),l.lineTo(-a,o+a),l.moveTo(a,-a),l.lineTo(-a,a),l.moveTo(o+a,o-a),l.lineTo(o-a,o+a)),l.stroke();const h=l.getImageData(0,0,t.width,t.height),u=new Uint8Array(h.data);let m;for(let r=0;r<u.length;r+=4)m=u[r+3]/255,u[r]=u[r]*m,u[r+1]=u[r+1]*m,u[r+2]=u[r+2]*m;return[u,t.width,t.height,i]}function d(t){t.length%2==1&&(t=[...t,...t]);const e=t.reduce(((t,e)=>t+e),0),s=Math.round(e*o.zA),i=new Float32Array(1*s);let r=0,a=0,l=.5,h=!0;for(const n of t){for(r=a,a+=n*o.zA;l<=a;){const t=l-.5,e=Math.min(Math.abs(l-r),Math.abs(l-a));i[t]=h?-e:e,l++}h=!h}const u=i.length,c=new Uint8Array(4*u);for(let m=0;m<u;++m){const t=i[m]/o.zA;(0,n.U)(t/o.gR*.5+.5,c,4*m)}return[c,s,1]}function g(t,e){null==t&&(t=[]);const s="Butt"===e,i="Square"===e,r=!s&&!i;t.length%2==1&&(t=[...t,...t]);const a=o.$o,l=2*a;let h=0;for(const n of t)h+=n;const u=Math.round(h*a),c=new Float32Array(u*l),m=.5*a;let d=0,g=0,p=.5,_=!0;for(const n of t){for(d=g,g+=n*a;p<=g;){let t=.5;for(;t<l;){const e=(t-.5)*u+p-.5,n=r?(t-a)*(t-a):Math.abs(t-a);c[e]=_?s?Math.max(Math.max(d+m-p,n),Math.max(p-g+m,n)):n:r?Math.min((p-d)*(p-d)+n,(p-g)*(p-g)+n):i?Math.min(Math.max(p-d,n),Math.max(g-p,n)):Math.min(Math.max(p-d+m,n),Math.max(g+m-p,n)),t++}p++}_=!_}const f=c.length,y=new Uint8Array(4*f);for(let o=0;o<f;++o){const t=(r?Math.sqrt(c[o]):c[o])/a;(0,n.U)(t,y,4*o)}return[y,u,l]}function p(t,e){const{colorRamp:s,gradientType:n}=e,i="CIMFixedColorRamp"===s.type,r=e.interval||a.D.CIMGradientFill.interval;let o=y(s);return i&&(o=x(o,r)),"Discrete"===n||i?function(t,e,s){return b(t,e,s,1,l.MZ),P(t)}(t,o,r):function(t,e){return b(t,e,u,1,l.MZ),P(t)}(t,o)}let _;function f(t,e){const{colorRamp:s,gradientType:n}=e,i=y(s),r="CIMFixedColorRamp"===s.type;if("Continuous"===n&&!r)return v(t,i);const o=e.interval??a.D.CIMGradientFill.interval;if(r)return v(t,x(i,o));const l=[];_??=document.createElement("canvas"),b(_,i,o,1,0);const h=_.getContext("2d").getImageData(0,0,o,1).data;for(let a=0,u=0;a<o;a++,u=4*a){const t=[h[u+0],h[u+1],h[u+2],h[u+3]];l.push({offset:a/o,color:t}),l.push({offset:(a+1)/o,color:t})}return v(t,l)}function y(t){const e=[];switch(t.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{"CIMPolarContinuousColorRamp"===t.type&&h().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");const s=t;e.push({offset:0,color:[s.fromColor[0],s.fromColor[1],s.fromColor[2],s.fromColor[3]/255]}),e.push({offset:1,color:[s.toColor[0],s.toColor[1],s.toColor[2],s.toColor[3]/255]});break}case"CIMFixedColorRamp":{const s=t,n=1/(s.colors.length-1);let i=0;for(const t of s.colors)e.push({offset:i,color:[t[0],t[1],t[2],t[3]/255]}),i+=n;break}case"CIMMultipartColorRamp":{const s=t,n=s.weights.reduce(((t,e)=>t+e),0);let i=0;for(let t=0;t<s.colorRamps.length;t++){const r=s.colorRamps[t],o=s.weights[t],a=y(r);for(const t of a)e.push({offset:(i+t.offset*o)/n,color:t.color});i+=o}break}default:h().error(`Color ramp "${t.type}" currently unsupported.`)}return e}function x(t,e){const s=[],n=(t.length-1)/(e-1);for(let i=0;i<e;i++){const r=t[Math.round(i*n)].color;s.push({offset:i/e,color:r}),s.push({offset:(i+1)/e,color:r})}return s}function v(t,e,s=0){for(const{offset:n,color:i}of e)t.addColorStop(Math.min(Math.max(n,s),1-s),`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${i[3]})`)}function b(t,e,s,n,i){const r=s+2*i;t.width=r,t.height=n;const o=(i+1)/r,a=t.getContext("2d",{willReadFrequently:!0});if(e.length>0){const t=a.createLinearGradient(0,0,r,n);v(t,e,o),a.fillStyle=t}else a.fillStyle="rgba(128, 128, 128, 1)";a.fillRect(0,0,r,n)}function P(t){const{width:e,height:s}=t,n=t.getContext("2d").getImageData(0,0,e,s),i=new Uint8Array(n.data);for(let r=0;r<i.length;r+=4){const t=i[r+3]/255;i[r]*=t,i[r+1]*=t,i[r+2]*=t}return[i,e,s]}function S(t,e){const s=function(t){const e=t[0]?.[0]?.[0]??0,s=t[0]?.[0]?.[1]??0,n={ymin:s,xmin:e,ymax:s,xmax:e,width:0,height:0};for(let i=0;i<t.length;i++){const e=t[i];for(let t=0;t<e.length;t++){const s=e[t][0],i=e[t][1];s<n.xmin&&(n.xmin=s),s>n.xmax&&(n.xmax=s),i<n.ymin&&(n.ymin=i),i>n.ymax&&(n.ymax=i)}}return n.width=Math.abs(n.xmax-n.xmin),n.height=Math.abs(n.ymax-n.ymin),n}(t),n=0===s.width?1:s.width,i=0===s.height?1:s.height,r=[];for(let o=0;o<t.length;o++){const a=t[o],l=[];for(let t=0;t<a.length;t++){let r=Math.round(a[t][0]-s.xmin),o=Math.round(a[t][1]-s.ymin);if(r=e.xmin+r*e.width/n,o=e.ymin+o*e.height/i,isNaN(r)||isNaN(o))throw new Error("Scaled shape has NaN values");l.push([r,o])}r.push(l)}return r}function E(t,e,s){const n=[];for(let i=0;i<t.length;i++){const r=t[i],o=[];for(let t=0;t<r.length;t++){const n=r[t][0]+e,i=r[t][1]+s;if(isNaN(n)||isNaN(i))throw new Error("Scaled shape has NaN values");o.push([n,i])}n.push(o)}return n}},50072:(t,e,s)=>{s.d(e,{$w:()=>x,Bu:()=>F,DW:()=>T,FH:()=>Y,FM:()=>u,G9:()=>r,GV:()=>b,Go:()=>m,Je:()=>J,K3:()=>B,Ke:()=>D,Kn:()=>w,MM:()=>p,Nl:()=>R,Ny:()=>P,O2:()=>k,UE:()=>L,YC:()=>H,YF:()=>V,ZO:()=>O,_1:()=>M,_H:()=>E,_W:()=>v,_d:()=>I,_h:()=>h,bs:()=>U,dI:()=>Q,e6:()=>d,gQ:()=>l,iA:()=>q,jn:()=>f,lW:()=>g,mA:()=>_,n5:()=>G,pM:()=>A,pV:()=>C,pk:()=>j,rB:()=>Z,s4:()=>i,xo:()=>N,yH:()=>S,yX:()=>tt,zb:()=>z,zr:()=>y});var n=s(7591);function i(t,e,s,n){return function(t){return"function"==typeof t}(t)?t(e,s,n):t}function r(t){return[t.r,t.g,t.b,t.a]}const o=" /-,\n";function a(t){let e=t.length;for(;e--;)if(!o.includes(t.charAt(e)))return!1;return!0}function l(t,e){const s=[];let n=0,i=-1;do{if(i=t.indexOf("[",n),i>=n){if(i>n){const e=t.slice(n,i);s.push([e,null,a(e)])}if(n=i+1,i=t.indexOf("]",n),i>=n){if(i>n){const r=e[t.slice(n,i)];r&&s.push([null,r,!1])}n=i+1}}}while(-1!==i);if(n<t.length){const e=t.slice(n);s.push([e,null,a(e)])}return s}function h(t,e,s){let n="",i=null;for(const r of e){const[e,s,o]=r;if(null!=e&&""!==e)o?i=e:(null!=i&&(n+=i,i=null),n+=e);else{const e=t.readAttribute(s);null!=e&&""!==e&&(null!==i&&(n+=i,i=null),n+=e)}}return c(n,s)}function u(t,e,s,n){let i="",r=null;for(const o of e){const[e,n,a]=o;if(null!=e&&""!==e)a?r=e:(null!=r&&(i+=r,r=null),i+=e);else{let e=n;null!=s&&(e=X(n,s));const o=t.attributes[e];null!=o&&""!==o&&(null!=r&&(i+=r,r=null),i+=o)}}return c(i,n)}function c(t,e){switch("string"!=typeof t&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function m(t,e,s,n,i,r,o=!0){const a=e/i,l=s/r,h=Math.ceil(a/2),u=Math.ceil(l/2);for(let c=0;c<r;c++)for(let s=0;s<i;s++){const m=4*(s+(o?r-c-1:c)*i);let d=0,g=0,p=0,_=0,f=0,y=0,x=0;const v=(c+.5)*l;for(let n=Math.floor(c*l);n<(c+1)*l;n++){const i=Math.abs(v-(n+.5))/u,r=(s+.5)*a,o=i*i;for(let l=Math.floor(s*a);l<(s+1)*a;l++){let s=Math.abs(r-(l+.5))/h;const i=Math.sqrt(o+s*s);i>=-1&&i<=1&&(d=2*i*i*i-3*i*i+1,d>0&&(s=4*(l+n*e),x+=d*t[s+3],p+=d,t[s+3]<255&&(d=d*t[s+3]/250),_+=d*t[s],f+=d*t[s+1],y+=d*t[s+2],g+=d))}}n[m]=_/g,n[m+1]=f/g,n[m+2]=y/g,n[m+3]=x/p}}function d(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function g(t){return t.data?.symbol??null}function p(t){return"CIMVectorMarker"===t.type||"CIMPictureMarker"===t.type||"CIMBarChartMarker"===t.type||"CIMCharacterMarker"===t.type||"CIMPieChartMarker"===t.type||"CIMStackedBarChartMarker"===t.type}function _(t){return"CIMGradientStroke"===t.type||"CIMPictureStroke"===t.type||"CIMSolidStroke"===t.type}function f(t){return null!=t&&("CIMGradientFill"===t.type||"CIMHatchFill"===t.type||"CIMPictureFill"===t.type||"CIMSolidFill"===t.type||"CIMWaterFill"===t.type)}function y(t){return null!=t&&("CIMMarkerPlacementAlongLineRandomSize"===t.type||"CIMMarkerPlacementAlongLineSameSize"===t.type||"CIMMarkerPlacementAlongLineVariableSize"===t.type||"CIMMarkerPlacementAtExtremities"===t.type||"CIMMarkerPlacementAtMeasuredUnits"===t.type||"CIMMarkerPlacementAtRatioPositions"===t.type||"CIMMarkerPlacementOnLine"===t.type||"CIMMarkerPlacementOnVertices"===t.type)}const x=(t,e=0)=>null==t||isNaN(t)?e:t,v=(t,e)=>null!=t?t:e,b=(t,e)=>t??e,P=t=>t.tintColor?d(t.tintColor):[255,255,255,1],S=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectDonut":case"CIMGeometricEffectOffset":case"CIMGeometricEffectTaperedPolygon":case"CIMGeometricEffectEnclosingPolygon":return!0}return!1};function E(){return Promise.all([s.e(2076),s.e(835),s.e(3366)]).then(s.bind(s,53366))}function C(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function w(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function I(t){let e="normal",s="normal";if(t){const n=t.toLowerCase();n.includes("italic")?e="italic":n.includes("oblique")&&(e="oblique"),n.includes("bold")?s="bold":n.includes("light")&&(s="lighter")}return{style:e,weight:s}}function T(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function A(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const t=A(e);if(null!=t)return t}break;case"CIMTextSymbol":return A(t.symbol);case"CIMSolidFill":return t.color}return null}function M(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const t of e){const e=M(t);if(null!=e)return e}break}case"CIMTextSymbol":return M(t.symbol);case"CIMSolidStroke":return t.color}}function D(t){for(const e of t)if(e.enable)switch(e.type){case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return!0}return!1}function N(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const t=N(e);if(void 0!==t)return t}break;case"CIMTextSymbol":return N(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function F(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function R(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function k(t){return(t?Object.keys(t):[]).map((e=>({name:e,alias:e,type:"string"==typeof t[e]?"esriFieldTypeString":"esriFieldTypeDouble"})))}const L=t=>t.includes("data:image/svg+xml");function G(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function V(t){return t?t.charAt(0).toLowerCase()+t.slice(1):t}function z(t,e,s,n,i,r,o=!0){const{infos:a}=r;let l=1,h=0,u=0,c=0,m=1;for(const{absoluteAnchorPoint:p,offsetX:_,offsetY:f,rotation:y,size:x,frameHeight:v,rotateClockWise:b,scaleSymbolsProportionally:P}of a)m=p?1:l,u=$(_,f,h,m,u),c=W(_,f,h,m,c),v&&(P||o)&&(l*=x/v),h=K(y,b,h);const d=$(n,i,h,m,u),g=W(n,i,h,m,c);return{size:t*l,rotation:K(e,s,h),offsetX:d,offsetY:g}}function O(t){if(null==t)return!1;if(Array.isArray(t))return t.every((t=>O(t)));switch(typeof t){case"string":return!!t;case"number":return!isNaN(t)}}function q(t,e){if("color"===e||"outlinecolor"===e||"backgroundcolor"===e||"borderlinecolor"===e||"tintcolor"===e)return[...n.K[e]];const s=n.D[t];if(!s)throw new Error(`InternalError: default value for type ${t}.`);return s[e]}function B(t){return"string"==typeof t?function(t){return t.split(" ").map((t=>Number(t)))}(t):t}function Y(t){return t?.dashTemplate&&(t.dashTemplate=B(t.dashTemplate)),t}function U(t){if(null==t)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const t of e)if("CIMVectorMarker"===t.type)return U(t)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const t of e)if(t.symbol)return U(t.symbol)}}return"Normal"}function H(t){if(t)switch(t.type){case"CIMTextSymbol":return t.height;case"CIMPointSymbol":{let e=0;if(t.symbolLayers)for(const s of t.symbolLayers)if(s)switch(s.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const t=s.size??n.D.CIMVectorMarker.size;t>e&&(e=t);break}}return e}case"CIMLineSymbol":case"CIMPolygonSymbol":{let e=0;if(t.symbolLayers)for(const s of t.symbolLayers)if(s)switch(s.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const t=s.width;null!=t&&t>e&&(e=t);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(s.markerPlacement&&y(s.markerPlacement)){const t=s.size??n.D.CIMVectorMarker.size;t>e&&(e=t)}break;case"CIMPictureFill":{const t=s.height;null!=t&&t>e&&(e=t)}}return e}}}function X(t,e){if(null!==e){const s=e.get(t);return s?s.name:t}return t}function j(t){return t.map((t=>({...t,propertyName:V(t.propertyName)})))}function Z(t){const e={};for(const s in t){const n=t[s];e[V(s)]=n}return e}function W(t,e,s,n,i){const r=s*Math.PI/180;if(r){const s=Math.cos(r);return(Math.sin(r)*t+s*e)*n+i}return e*n+i}function $(t,e,s,n,i){const r=s*Math.PI/180;return r?(Math.cos(r)*t-Math.sin(r)*e)*n+i:t*n+i}function K(t,e,s){return e?s-t:s+t}function Q(t,e,s){const n="Color"===s||"TintColor"===s||"ToColor"===s,i="Rotation"===s||"Angle"===s||"ToRotation"===s;let r=e[V(s)];if(null!=r&&(n?r=[r[0]/255,r[1]/255,r[2]/255,r[3]/255]:i&&(r*=Math.PI/180)),null==r&&(r=q(e.type,s.toLowerCase()),null!=r&&(n?r=[r[0]/255,r[1]/255,r[2]/255,r[3]]:i&&(r*=Math.PI/180))),null!=e.primitiveName){const o=t[e.primitiveName];if(null!=o){const t=o[s];null==t||("string"==typeof t||"number"==typeof t||Array.isArray(t)?(r=t,null!=r&&(n?r=[r[0]/255,r[1]/255,r[2]/255,r[3]/255]:i&&(r*=Math.PI/180))):(r={valueExpressionInfo:t,defaultValue:r},null!=r&&(n?r={type:"Process",op:"ArcadeColor",value:r}:i&&(r={type:"Process",op:"Divide",left:r,right:180/Math.PI}))))}}if(null==r)throw new Error(`Failed to derive a value or an expression for "${s}".`);return r}function J(t,e,s){if(null!=e[V(s)])return!0;if(null!=e.primitiveName){const n=t[e.primitiveName];if(null!=n&&null!=n[s])return!0}return!1}function tt(t,e){return Math.max(Math.min((t??e)/100,1),0)}},60973:(t,e,s)=>{s.d(e,{A:()=>x});var n,i=s(66866),r=s(59851),o=s(21877),a=s(6267),l=s(21564),h=(s(39831),s(539),s(9272),s(75094)),u=s(63863),c=s(77542),m=s(42453);let d=n=class extends o.A{constructor(t){super(t)}async collectRequiredFields(t,e){return(0,m.Dx)(t,e,this.expression)}clone(){return new n({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};(0,i._)([(0,l.MZ)({type:String,json:{write:{isRequired:!0}}})],d.prototype,"expression",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"title",void 0),d=n=(0,i._)([(0,u.$)("esri.symbols.support.FeatureExpressionInfo")],d);const g=d;var p,_=s(97046);const f=(0,r.O)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),y=new r.J({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let x=class extends o.A{static{p=this}constructor(t){super(t),this.featureExpressionInfo=void 0,this.offset=null}readFeatureExpressionInfo(t,e){return null!=t?t.expression?t:void 0:e.featureExpression&&0===e.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(t,e,s,n){e[s]=t.write({},n),"0"===t.expression&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):null!=t||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new p({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&(0,a.CM)(this.featureExpressionInfo,t.featureExpressionInfo)}};(0,i._)([(0,l.MZ)({type:g,json:{write:!0}})],x.prototype,"featureExpressionInfo",void 0),(0,i._)([(0,h.w)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],x.prototype,"readFeatureExpressionInfo",null),(0,i._)([(0,c.K)("featureExpressionInfo",{featureExpressionInfo:{type:g},"featureExpression.value":{type:[0]}})],x.prototype,"writeFeatureExpressionInfo",null),(0,i._)([(0,l.MZ)({type:f.apiValues,nonNullable:!0,json:{type:f.jsonValues,read:f.read,write:{writer:f.write,isRequired:!0}}})],x.prototype,"mode",null),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],x.prototype,"offset",void 0),(0,i._)([(0,l.MZ)({type:_.KQ,json:{type:String,read:y.read,write:y.write}})],x.prototype,"unit",null),x=p=(0,i._)([(0,u.$)("esri.symbols.support.ElevationInfo")],x)},77573:(t,e,s)=>{s.d(e,{Fe:()=>d,KU:()=>f,Km:()=>r,Nk:()=>l});var n=s(96220),i=s(50072);function r(t,e,s,n){if(t)if("CIMTextSymbol"!==t.type){if(s&&t.effects)for(const s of t.effects)a(s,e);if(t.symbolLayers)for(const s of t.symbolLayers){switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":o(s,e,n);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!n?.preserveOutlineWidth&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":r(s.lineSymbol,e,!0,{...n,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}if(s.effects)for(const t of s.effects)a(t,e)}}else null!=t.height&&(t.height*=e)}function o(t,e,s){if(t&&(t.markerPlacement&&function(t,e){switch((0,i.zr)(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const s=t.placementTemplate.map((t=>t*e));t.placementTemplate=s}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const s=t.placementTemplate.map((t=>t*e));t.placementTemplate=s}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&"Absolute"===t.anchorPointUnits&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=null!=t.size?t.size*e:0,"CIMVectorMarker"===t.type&&t.markerGraphics))for(const n of t.markerGraphics)t.scaleSymbolsProportionally||r(n.symbol,e,!0,s)}function a(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const s=t.dashTemplate.map((t=>t*e));t.dashTemplate=s}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function l(t){const e=[];return h((0,i.lW)(t),e),e.length?new n.A((0,i.e6)(e[0])):null}function h(t,e){if(!t)return;let s;s="CIMTextSymbol"===t.type?t.symbol:t;const n="CIMPolygonSymbol"===t.type;if(s?.symbolLayers)for(const r of s.symbolLayers)if(!(r.colorLocked||n&&((0,i.mA)(r)||(0,i.MM)(r)&&r.markerPlacement&&(0,i.zr)(r.markerPlacement))))switch(r.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":r.tintColor&&u(e,r.tintColor);break;case"CIMVectorMarker":r.markerGraphics?.forEach((t=>{h(t.symbol,e)}));break;case"CIMSolidStroke":case"CIMSolidFill":u(e,r.color);break;case"CIMGradientFill":c(e,r);break;case"CIMHatchFill":h(r.lineSymbol,e)}}function u(t,e){for(const s of t)if(s.join(".")===e.join("."))return;t.push(e)}function c(t,e){const s=e.colorRamp?.type;switch(s){case"CIMMultipartColorRamp":e.colorRamp.colorRamps?.forEach((e=>{"CIMLinearContinuousColorRamp"===e.type&&m(t,e)}));break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":m(t,e.colorRamp)}}function m(t,e){e&&(e.fromColor&&u(t,e.fromColor),e.toColor&&u(t,e.toColor))}function d(t,e,s){e instanceof n.A||(e=new n.A(e));const r=(0,i.lW)(t);r&&g(r,e,s)}function g(t,e,s){if(!t)return;let n;n="CIMTextSymbol"===t.type?t.symbol:t;const r="CIMPolygonSymbol"===n?.type;if(n?.symbolLayers)for(const o of n.symbolLayers){if(o.colorLocked)continue;if(r)if(s){const{layersToColor:t}=s;if(((0,i.mA)(o)||(0,i.MM)(o)&&o.markerPlacement&&(0,i.zr)(o.markerPlacement))&&"fill"===t||(0,i.jn)(o)&&"outline"===t)continue}else if((0,i.mA)(o)||(0,i.MM)(o)&&o.markerPlacement&&(0,i.zr)(o.markerPlacement))continue;const t=e.toArray();switch(o.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":o.tintColor=t;break;case"CIMVectorMarker":o.markerGraphics?.forEach((t=>{g(t.symbol,e,s)}));break;case"CIMSolidStroke":case"CIMSolidFill":o.color=t;break;case"CIMGradientFill":p(o,e);break;case"CIMHatchFill":g(o.lineSymbol,e,s)}}}function p(t,e){const s=t.colorRamp?.type;switch(s){case"CIMMultipartColorRamp":t.colorRamp.colorRamps?.forEach((t=>{"CIMLinearContinuousColorRamp"===t.type&&_(t,e)}));break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":_(t.colorRamp,e)}}function _(t,e){if(t&&(t.fromColor&&(t.fromColor=e.toArray()),t.toColor)){const s=e.clone();s.a=0,t.toColor=s.toArray()}}function f(t,e,s=!1){const n=(0,i.lW)(t);if(s&&(e=360-e),"CIMTextSymbol"!==n?.type){if("CIMPointSymbol"===n?.type&&n.symbolLayers){const t=e-(n.angle||0);for(const e of n.symbolLayers)if((0,i.MM)(e)){let s=e.rotation||0;e.rotateClockwise?s-=t:s+=t,e.rotation=s}n.angle=e}}else n.angle=e}},26207:(t,e,s)=>{s.d(e,{A7:()=>h,Cx:()=>u,Hk:()=>c,JJ:()=>p,SF:()=>m,UK:()=>l,jM:()=>d,x3:()=>g});s(39831);var n=s(68882),i=s(40241),r=s(23369),o=s(42602),a=s(23173);const l=r.A.fromJSON(a.Cb),h=i.A.fromJSON(a.yM),u=n.A.fromJSON(a.WR),c=o.A.fromJSON(a.JZ);function m(t){if(null==t)return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return l;case"polyline":return h;case"polygon":case"extent":return u}return null}const d=r.A.fromJSON(a.nC),g=i.A.fromJSON(a.HW),p=n.A.fromJSON(a.b6)},1676:(t,e,s)=>{s.d(e,{af:()=>v,al:()=>x,dX:()=>b});var n=s(96220),i=s(48982),r=(s(39831),s(89882)),o=s(88506),a=s(68324),l=s(93731),h=s(50151),u=s(66960),c=s(65216),m=s(38366),d=s(26207),g=s(23173);const p=u.A.fromSimpleMarkerSymbol(d.UK),_=a.A.fromSimpleLineSymbol(d.A7),f=c.A.fromSimpleFillSymbol(d.Cx),y=new h.A({symbolLayers:new i.A([new o.A({material:{color:g.fT},edges:new m.A({size:(0,r.PN)(1),color:new n.A(g.JR)})})])}),x=new a.A({symbolLayers:new i.A([new l.A({material:{color:new n.A([0,0,0])},size:(0,r.PN)(1)})])}),v=new c.A({symbolLayers:new i.A([new o.A({outline:{color:new n.A([0,0,0]),size:(0,r.PN)(1)}})])});function b(t){if(null==t)return null;switch(t.type){case"mesh":return y;case"point":case"multipoint":return p;case"polyline":return _;case"polygon":case"extent":return f}return null}},23173:(t,e,s)=>{s.d(e,{Cb:()=>r,HW:()=>u,JR:()=>i,JZ:()=>l,WR:()=>a,b6:()=>c,fT:()=>n,nC:()=>h,yM:()=>o});const n=[252,146,31,255],i=[153,153,153,255],r={type:"esriSMS",style:"esriSMSCircle",size:6,color:n,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},o={type:"esriSLS",style:"esriSLSSolid",width:.75,color:n},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},h={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},u={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},c={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},57974:(t,e,s)=>{s.d(e,{M9:()=>h,oO:()=>u,rS:()=>d});var n=s(98849),i=s(76724),r=s(40454),o=s(75162),a=s(79689),l=s(66961);function h(t,e,s,n){const r=m(t,{},{context:n,isLabelSymbol:!1});null!=r&&(0,i.sM)(s,r,e)}function u(t,e,s,n){const i=m(t,{},{context:n,isLabelSymbol:!0});null!=i&&(e[s]=i)}function c(t){return(0,l.wk)(t)||t instanceof o.A}function m(t,e,s){if(null==t)return null;const{context:i,isLabelSymbol:o}=s,l=i?.origin,h=i?.messages;if("web-scene"===l&&!c(t)){const s=(0,a.t)(t,{retainCIM:!0,hasLabelingContext:o});return null!=s.symbol?s.symbol.write(e,i):(h?.push(new n.A("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:s.error})),null)}return(0,r.TU)(i?.layer)&&function(t){return"polygon-3d"===t?.type||"line-3d"===t?.type}(t)?(h?.push(new n.A("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported on layers of type '${i?.layer?.declaredClass}'.`,{symbol:t,context:i})),null):("web-map"===l||"portal-item"===l&&!(0,r.TU)(i?.layer))&&c(t)?(h?.push(new n.A("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function d(t,e){return(0,l.Bu)(t,null,e)}},59890:(t,e,s)=>{s.d(e,{jg:()=>x,cF:()=>m,bo:()=>d,yA:()=>_,o5:()=>g});var n=s(86394),i=s(98849),r=s(39831),o=s(40189),a=s(20909),l=s(10282),h=s(99990);const u=new Map;function c(t,e,s){const n=null!=e.portal?e.portal:l.A.getDefault();let r;const o=`${n.url} - ${n.user?.username} - ${t}`,a=u.get(o);if(a)return a;const c=function(t,e,s){return e.load(s).then((()=>{const n=new h.A({disableExtraQuery:!0,query:`owner:${f} AND type:${y} AND typekeywords:"${t}"`});return e.queryItems(n,s)})).then((({results:e})=>{let n=null;const r=t.toLowerCase();if(e&&Array.isArray(e))for(const t of e){const e=t.typeKeywords?.some((t=>t.toLowerCase()===r));if(e&&t.type===y&&t.owner===f){n=t;break}}if(!n)throw new i.A("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(s)}))}(t,n,s).then((t=>(r=t,t.fetchData()))).then((e=>({data:e,baseUrl:r.itemUrl??"",styleName:t})));return u.set(o,c),c}function m(t,e,s){return null!=t?.styleUrl?async function(t,e){try{return{data:(await _(t,e)).data,baseUrl:(0,a.nM)(t),styleUrl:t}}catch(s){return(0,o.QP)(s),null}}(t.styleUrl,s):null!=t?.styleName?c(t.styleName,e,s):Promise.reject(new i.A("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function d(t){return null===t||"CIMSymbolReference"===t.type?t:{type:"CIMSymbolReference",symbol:t}}function g(t,e){for(const s of e)switch(s){case"cim":if(t.cimRef)return{format:s,url:encodeURI(t.cimRef)};break;case"web-gltf-basisu":{const e=p(t,"gltf_basisu");if(e)return{format:s,url:e};break}case"web-gltf":{const e=p(t,"gltf");if(e)return{format:s,url:e};break}case"web":{const e=p(t,"gltf");if(e)return{format:"web-gltf",url:e};if(t.webRef)return{format:s,url:encodeURI(t.webRef)};break}}}function p(t,e){if(!(0,r.A)("enable-feature:force-wosr"))return t.formatInfos?.find((t=>t.type===e))?.href}function _(t,e){const s={responseType:"json",query:{f:"json"},...e};return(0,n.A)((0,a.S8)(t),s)}const f="esri_en",y="Style",x="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"},79689:(t,e,s)=>{s.d(e,{c:()=>y,t:()=>x});var n=s(98849),i=s(27372),r=s(68324),o=s(50151),a=s(72001),l=s(66960),h=s(65216),u=s(68882),c=s(40241),m=s(23369),d=s(42602),g=s(75162),p=s(1676),_=s(66961);const f="#useCIMFallbackSymbology()",y={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function x(t,e=y){if(!t)return{symbol:null};const{retainId:s=y.retainId,ignoreDrivers:x=y.ignoreDrivers,hasLabelingContext:v=y.hasLabelingContext,retainCIM:b=y.retainCIM,cimFallbackEnabled:P=y.cimFallbackEnabled}=e;let S=null;if((0,_.wk)(t)||t instanceof g.A)S=t.clone();else if("cim"===t.type){const s=t.data?.symbol?.type;switch(s){case"CIMPointSymbol":S=b?t.clone():l.A.fromCIMSymbol(t);break;case"CIMLineSymbol":P&&(S=p.al.clone(),e?.logWarning?.(f,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":P&&(S=p.af.clone(),e?.logWarning?.(f,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!S)return{error:new n.A("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${s||"unknown"}' is unsupported in 3D`,{symbol:t})}}else if(t instanceof c.A)S=r.A.fromSimpleLineSymbol(t);else if(t instanceof m.A)S=l.A.fromSimpleMarkerSymbol(t);else if(t instanceof a.A)S=l.A.fromPictureMarkerSymbol(t);else if(t instanceof u.A)S=e.geometryType&&"mesh"===e.geometryType?o.A.fromSimpleFillSymbol(t):h.A.fromSimpleFillSymbol(t);else{if(!(t instanceof d.A))return{error:new n.A("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};S=v?i.A.fromTextSymbol(t):l.A.fromTextSymbol(t)}return s&&S&&"cim"!==S.type&&(S.id=t.id),!x||"cim"===S.type||S instanceof g.A||S.symbolLayers.forEach((t=>t.ignoreDrivers=!0)),{symbol:S}}},97046:(t,e,s)=>{s.d(e,{Ao:()=>o,KQ:()=>a,Tg:()=>r});var n=s(85569),i=s(10301);function r(t){return!!t&&null!=i.j[t]}function o(t){return 1/(i.j[t]||1)}const a=function(){const t=Object.keys(i.j);return(0,n.TF)(t,"decimal-degrees"),t.sort(),t}()},56530:(t,e,s)=>{s.d(e,{A:()=>w});var n=s(66866),i=s(21877),r=s(19251),o=s(21564),a=(s(39831),s(539),s(63863)),l=s(24793);s(9272);let h=class extends i.A{constructor(t){super(t),this.description=null,this.label=null,this.type=null}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],h.prototype,"description",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],h.prototype,"label",void 0),(0,n._)([(0,o.MZ)()],h.prototype,"type",void 0),h=(0,n._)([(0,a.$)("esri.tables.elements.AttributeTableElement")],h);const u=h;let c=class extends(l.A.ClonableMixin(u)){constructor(t){super(t),this.displayType="auto",this.type="attachment"}clone(){return super.clone()}};(0,n._)([(0,o.MZ)({type:["auto"],json:{write:!0}})],c.prototype,"displayType",void 0),(0,n._)([(0,o.MZ)({type:["attachment"],readOnly:!0,json:{read:!1,write:{enabled:!0,isRequired:!0}}})],c.prototype,"type",void 0),c=(0,n._)([(0,a.$)("esri.tables.elements.AttributeTableAttachmentElement")],c);const m=c;let d=class extends(l.A.ClonableMixin(u)){constructor(t){super(t),this.description=null,this.fieldName=null,this.label=null,this.type="field"}clone(){return super.clone()}};(0,n._)([(0,o.MZ)({type:String,json:{read:!1,write:!1}})],d.prototype,"description",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:{enabled:!0,isRequired:!0}}})],d.prototype,"fieldName",void 0),(0,n._)([(0,o.MZ)({type:String,json:{read:!1,write:!1}})],d.prototype,"label",void 0),(0,n._)([(0,o.MZ)({type:["field"],readOnly:!0,json:{read:!1,write:{enabled:!0,isRequired:!0}}})],d.prototype,"type",void 0),d=(0,n._)([(0,a.$)("esri.tables.elements.AttributeTableFieldElement")],d);const g=d;var p=s(73446);let _=class extends(l.A.ClonableMixin(u)){constructor(t){super(t),this.relationshipId=null,this.type="relationship"}clone(){return super.clone()}};(0,n._)([(0,o.MZ)({type:Number,json:{type:p.jz,write:{enabled:!0,isRequired:!0}}})],_.prototype,"relationshipId",void 0),(0,n._)([(0,o.MZ)({type:["relationship"],readOnly:!0,json:{read:!1,write:{enabled:!0,isRequired:!0}}})],_.prototype,"type",void 0),_=(0,n._)([(0,a.$)("esri.tables.elements.AttributeTableRelationshipElement")],_);const f=_,y={base:u,key:"type",typeMap:{attachment:m,field:g,relationship:f}};let x=class extends(l.A.ClonableMixin(u)){constructor(t){super(t),this.elements=null,this.type="group"}clone(){return super.clone()}};(0,n._)([(0,o.MZ)({types:[y],json:{name:"attributeTableElements",write:!0}})],x.prototype,"elements",void 0),(0,n._)([(0,o.MZ)({type:["group"],readOnly:!0,json:{read:!1,write:{enabled:!0,isRequired:!0}}})],x.prototype,"type",void 0),x=(0,n._)([(0,a.$)("esri.tables.elements.AttributeTableGroupElement")],x);const v=x;let b=class extends(l.A.ClonableMixin(i.A)){constructor(t){super(t),this.field=null,this.order=null}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],b.prototype,"field",void 0),(0,n._)([(0,o.MZ)({type:["asc","desc"],json:{write:!0}})],b.prototype,"order",void 0),b=(0,n._)([(0,a.$)("esri.tables.support.FieldOrder")],b);const P=b;var S;const E=function(t){return{typesWithGroup:{base:u,key:"type",typeMap:{attachment:m,field:g,group:t,relationship:f}},typesWithoutGroup:y}}(v);let C=S=class extends i.A{constructor(t){super(t),this.elements=null,this.orderByFields=null}clone(){return new S({elements:(0,r.o8)(this.elements),orderByFields:(0,r.o8)(this.orderByFields)})}};(0,n._)([(0,o.MZ)({types:[E.typesWithGroup],json:{name:"attributeTableElements",write:!0}})],C.prototype,"elements",void 0),(0,n._)([(0,o.MZ)({type:[P],json:{write:!0}})],C.prototype,"orderByFields",void 0),C=S=(0,n._)([(0,a.$)("esri.tables.AttributeTableTemplate")],C);const w=C},7715:(t,e,s)=>{s.d(e,{m:()=>l});var n=s(41573),i=s(62879),r=s(99776),o=s(57079),a=s(37353);class l extends a.q{constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this._children=[],this._childrenObservable=new i.I,this._effectView=null,this._highlightGradient=null}get blendMode(){return this._blendMode}set blendMode(t){this._blendMode=t,this.requestRender()}get children(){return(0,n.gc)(this._childrenObservable),this._children}get clips(){return this._clips}set clips(t){this._clips=t,this.children.forEach((e=>e.clips=t))}get computedEffects(){return this._effectView?.effects??null}get effect(){return this._effectView?.effect??""}set effect(t){(this._effectView||t)&&(this._effectView||(this._effectView=new o.$B,this.addTransitionable(this._effectView)),this._effectView.effect=t,this.requestRender())}get highlightGradient(){return this._highlightGradient}set highlightGradient(t){this._highlightGradient=t,this.requestRender()}get hasBlending(){return!!this.blendMode}get hasHighlight(){return this.children.some((t=>t.hasHighlight))}get hasLabels(){return this.children.some((t=>t.hasLabels))}get requiresDedicatedFBO(){return this.children.some((t=>"blendMode"in t&&t.blendMode&&"normal"!==t.blendMode))}get isReady(){return this.children.every((t=>t.isReady))}get sortFunction(){return this._sortFunction}set sortFunction(t){this._sortFunction=t,t&&(this._needsSort=!0)}doRender(t){const e=this.createRenderParams(t),{painter:s}=e;s.beforeRenderLayer(e,this._clips?.length?255:0,this.computedOpacity),this.renderChildren(e),s.afterRenderLayer(e,this.computedOpacity)}addChild(t){return this.addChildAt(t,this.children.length)}addChildAt(t,e=this.children.length){if(!t)return t;if(this.contains(t))return t;this._needsSort=!0;const s=t.parent;return s&&s!==this&&s.removeChild(t),e>=this.children.length?this.children.push(t):this.children.splice(e,0,t),this._childrenSet.add(t),t.parent=this,t.stage=this.stage,this!==this.stage&&(t.clips=this.clips),this.requestRender(),this._childrenObservable.notify(),t}contains(t){return(0,n.gc)(this._childrenObservable),this._childrenSet.has(t)}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const t of this.children)this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null;this.children.length=0,this._childrenObservable.notify()}removeChild(t){return this.contains(t)?this.removeChildAt(this.children.indexOf(t)):t}removeChildAt(t){if(t<0||t>=this.children.length)return null;this._needsSort=!0;const e=this.children.splice(t,1)[0];return this._childrenSet.delete(e),this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null,this._childrenObservable.notify(),e}beforeRender(t){super.beforeRender(t),this.sortFunction&&this._needsSort&&(this.children.sort(this.sortFunction),this._needsSort=!1,this._childrenObservable.notify());for(const e of this.children)e.beforeRender(t)}afterRender(t){super.afterRender(t);for(const e of this.children)e.afterRender(t)}_createTransforms(){return{displayViewScreenMat3:(0,r.vt)()}}onAttach(){super.onAttach();const t=this.stage;for(const e of this.children)e.stage=t}onDetach(){super.onDetach();for(const t of this.children)t.stage=null}renderChildren(t){for(const e of this.children)e.processRender(t)}createRenderParams(t){return{...t,requireFBO:this.requiresDedicatedFBO,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:t.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition,highlightGradient:this._highlightGradient||t.highlightGradient}}isTransitioning(){return super.isTransitioning()||this.children.some((t=>t.transitioning))}}},37353:(t,e,s)=>{s.d(e,{q:()=>o});var n=s(85569),i=s(17306),r=s(87430);class o extends i.A{constructor(){super(...arguments),this._transitionables=null,this._clips=null,this._fadeTransition=null,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get computedOpacity(){return this._fadeTransition?.computedOpacity??this.opacity}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get fadeTransitionEnabled(){return null!==this._fadeTransition}set fadeTransitionEnabled(t){!this._fadeTransition&&t?(this._fadeTransition=new r.A({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!t&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){return this._fadeTransition?.transitioning??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this._fadeTransition&&(this._fadeTransition.opacity=this._opacity),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const e=this._stage;this._stage=t,t?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):e?.trashDisplayObject(this)}get transforms(){return null==this._transforms&&(this._transforms=this._createTransforms()),this._transforms}get transitioning(){return this.isTransitioning()}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this._fadeTransition&&(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(t){this._transitionables??=[],this._transitionables.push(t),this.requestRender()}removeTransitionable(t){t.endTransition(),this._transitionables&&(0,n.TF)(this._transitionables,t),this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const t=this._fadeTransition.fadeIn();return this.opacity=1,this.requestRender(),t}fadeOut(){this.fadeTransitionEnabled=!0;const t=this._fadeTransition.fadeOut();return this.opacity=0,this.requestRender(),t}endTransitions(){if(this._transitionables){for(const t of this._transitionables)t.endTransition();this.requestRender()}}beforeRender(t){this.transitionStep(t.deltaTime,t.state.scale),this.setTransform(t.state)}afterRender(t){this.transitioning&&this.requestRender()}remove(){this.parent?.removeChild(this)}setTransform(t){}processRender(t){this.stage&&(this._fadeTransition?.computedVisible??this.visible)&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions(),this.onDetach(),this.emit("detach")}isTransitioning(){return this._transitionables?.some((t=>t.transitioning))??!1}transitionStep(t,e){if(this._transitionables)for(const s of this._transitionables)s.transitionStep(t,e)}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}},54185:(t,e,s)=>{s.d(e,{d:()=>T});var n=s(40275),i=s(38403),r=s(95031),o=s(97394),a=s(41746),l=s(50122);class h extends r.A{constructor(){super(...arguments),this._color=(0,n.fA)(0,1,0,1)}dispose(){this._program&&this._program.dispose()}prepareState({context:t}){t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setFaceCullingEnabled(!1),t.setColorMask(!1,!1,!1,!1),t.setStencilOp(a.eA.KEEP,a.eA.KEEP,a.eA.REPLACE),t.setStencilWriteMask(255),t.setStencilFunction(a.MT.ALWAYS,0,255)}draw(t,e){const{context:s,state:n,requestRender:r,allowDelayedRender:h}=t,u=(0,i.ES)("clip",{geometry:[{location:0,name:"a_pos",count:2,type:a.pe.SHORT}]}),c=e.getVAO(s,n,u.attributes,u.bufferLayouts);null!=c.indexBuffer&&(this._program||(this._program=(0,l.r)(s,o.T)),!h||null==r||this._program.compiled?(s.useProgram(this._program),this._program.setUniform2fv("u_coord_range",[1,1]),this._program.setUniform4fv("u_color",this._color),this._program.setUniformMatrix3fv("u_dvsMat3",n.displayMat3),s.bindVAO(c),s.drawElements(a.WR.TRIANGLES,c.indexBuffer.size,a.pe.UNSIGNED_INT,0),s.bindVAO()):r())}}var u=s(46419),c=s(29588),m=s(92504),d=s(99776),g=s(43556),p=s(89423),_=s(80976);class f extends r.A{constructor(){super(...arguments),this._color=(0,n.fA)(1,0,0,1),this._patternMatrix=(0,d.vt)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(t,e){const{context:s,painter:n,requestRender:i,allowDelayedRender:r}=t;this._loadWGLResources(t);const o=t.displayLevel,l=t.styleLayer,h=l.backgroundMaterial,u=n.vectorTilesMaterialManager,c=l.getPaintValue("background-color",o),d=l.getPaintValue("background-opacity",o),p=l.getPaintValue("background-pattern",o),_=void 0!==p,f=1|window.devicePixelRatio,y=t.spriteMosaic;let x,v;const b=f>g.C_?2:1,P=this._programOptions;P.pattern=_;const S=u.getMaterialProgram(s,h,P);if(!r||null==i||S.compiled){if(s.bindVAO(this._vao),s.useProgram(S),_){const t=y.getMosaicItemPosition(p,!0);if(null!=t){const{tl:e,br:n,page:i}=t;x=n[0]-e[0],v=n[1]-e[1];const r=y.getPageSize(i);null!=r&&(y.bind(s,a.Cj.LINEAR,i,g.$U),S.setUniform4f("u_tlbr",e[0],e[1],n[0],n[1]),S.setUniform2fv("u_mosaicSize",r),S.setUniform1i("u_texture",g.$U))}S.setUniform1f("u_opacity",d)}else{const t=c[3]*d;this._color[0]=t*c[0],this._color[1]=t*c[1],this._color[2]=t*c[2],this._color[3]=t,S.setUniform4fv("u_color",this._color)}S.setUniform1f("u_depth",l.z||0);for(const t of e){if(S.setUniform1f("u_coord_range",t.rangeX),S.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),_){const e=Math.max(2**(Math.round(o)-t.key.level),1),s=b*t.width*e,n=s/(0,m.yR)(x),i=s/(0,m.yR)(v);this._patternMatrix[0]=n,this._patternMatrix[4]=i,S.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}s.setStencilFunction(a.MT.EQUAL,0,255),s.drawArrays(a.WR.TRIANGLE_STRIP,0,4)}}else i()}_loadWGLResources(t){if(this._vao)return;const{context:e,styleLayer:s}=t,n=s.backgroundMaterial,i=new Int8Array([0,0,1,0,0,1,1,1]),r=p.g.createVertex(e,a._U.STATIC_DRAW,i),o=new _.Z(e,n.getAttributeLocations(),n.getLayoutInfo(),new Map([["geometry",r]]));this._vao=o}}var y=s(31541);class x extends r.A{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(t,e){const{context:s,displayLevel:n,requiredLevel:i,state:r,painter:o,spriteMosaic:l,styleLayerUID:h,requestRender:u,allowDelayedRender:c}=t;if(!e.some((t=>t.layerData.get(h)?.circleIndexCount??!1)))return;const m=t.styleLayer,d=m.circleMaterial,g=o.vectorTilesMaterialManager,p=m.getPaintValue("circle-translate",n),_=m.getPaintValue("circle-translate-anchor",n),f=this._programOptions,x=g.getMaterialProgram(s,d,f);if(c&&null!=u&&!x.compiled)return void u();s.useProgram(x),x.setUniformMatrix3fv("u_displayMat3",_===y.Cq.VIEWPORT?r.displayMat3:r.displayViewMat3),x.setUniform2fv("u_circleTranslation",p),x.setUniform1f("u_depth",m.z),x.setUniform1f("u_antialiasingWidth",1.2);let v=-1;for(const y of e){if(!y.layerData.has(h))continue;y.key.level!==v&&(v=y.key.level,d.setDataUniforms(x,n,m,v,l));const t=y.layerData.get(h);if(!t.circleIndexCount)continue;t.prepareForRendering(s);const e=t.vao;null!=e&&(s.bindVAO(e),x.setUniformMatrix3fv("u_dvsMat3",y.transforms.displayViewScreenMat3),i!==y.key.level?s.setStencilFunction(a.MT.EQUAL,y.stencilRef,255):s.setStencilFunction(a.MT.GREATER,255,255),s.drawElements(a.WR.TRIANGLES,t.circleIndexCount,a.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.circleIndexStart),y.triangleCount+=t.circleIndexCount/3)}}}const v=1/65536;class b extends r.A{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(t,e){const{displayLevel:s,renderPass:n,spriteMosaic:i,styleLayerUID:r}=t;let o=!1;for(const y of e)if(y.layerData.has(r)){const t=y.layerData.get(r);if(t.fillIndexCount>0||t.outlineIndexCount>0){o=!0;break}}if(!o)return;const a=t.styleLayer,l=a.getPaintProperty("fill-pattern"),h=void 0!==l,u=h&&l.isDataDriven;let c;if(h&&!u){const t=l.getValue(s);c=i.getMosaicItemPosition(t,!0)}const m=!h&&a.getPaintValue("fill-antialias",s);let d=!0,g=1;if(!h){const t=a.getPaintProperty("fill-color"),e=a.getPaintProperty("fill-opacity");if(!t?.isDataDriven&&!e?.isDataDriven){const t=a.getPaintValue("fill-color",s);g=a.getPaintValue("fill-opacity",s)*t[3],g>=1&&(d=!1)}}if(d&&"opaque"===n)return;const p=a.getPaintValue("fill-translate",s),_=a.getPaintValue("fill-translate-anchor",s);(d||"translucent"!==n)&&this._drawFill(t,r,a,e,p,_,h,c,u);const f=!a.hasDataDrivenOutlineColor&&a.outlineUsesFillColor&&g<1;m&&"opaque"!==n&&!f&&this._drawOutline(t,r,a,e,p,_)}_drawFill(t,e,s,n,i,r,o,l,h){if(o&&!h&&null==l)return;const{context:u,displayLevel:c,state:m,painter:d,pixelRatio:p,spriteMosaic:_,requestRender:f,allowDelayedRender:x}=t,b=s.fillMaterial,P=d.vectorTilesMaterialManager,S=p>g.C_?2:1,E=this._fillProgramOptions;E.pattern=o;const C=P.getMaterialProgram(u,b,E);if(x&&null!=f&&!C.compiled)return void f();if(u.useProgram(C),null!=l){const{page:t}=l,e=_.getPageSize(t);null!=e&&(_.bind(u,a.Cj.LINEAR,t,g.$U),C.setUniform2fv("u_mosaicSize",e),C.setUniform1i("u_texture",g.$U))}C.setUniformMatrix3fv("u_displayMat3",r===y.Cq.VIEWPORT?m.displayMat3:m.displayViewMat3),C.setUniform2fv("u_fillTranslation",i),C.setUniform1f("u_depth",s.z+v);let w=-1;for(const y of n){if(!y.layerData.has(e))continue;y.key.level!==w&&(w=y.key.level,b.setDataUniforms(C,c,s,w,_));const t=y.layerData.get(e);if(!t.fillIndexCount)continue;t.prepareForRendering(u);const n=t.fillVAO;if(null!=n){if(u.bindVAO(n),C.setUniformMatrix3fv("u_dvsMat3",y.transforms.displayViewScreenMat3),u.setStencilFunction(a.MT.EQUAL,y.stencilRef,255),o){const t=Math.max(2**(Math.round(c)-y.key.level),1),e=y.rangeX/(S*y.width*t);C.setUniform1f("u_patternFactor",e)}if(h){const e=t.patternMap;if(!e)continue;for(const[t,s]of e){const e=_.getPageSize(t);null!=e&&(_.bind(u,a.Cj.LINEAR,t,g.$U),C.setUniform2fv("u_mosaicSize",e),C.setUniform1i("u_texture",g.$U),u.drawElements(a.WR.TRIANGLES,s[1],a.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*s[0]))}}else u.drawElements(a.WR.TRIANGLES,t.fillIndexCount,a.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.fillIndexStart);y.triangleCount+=t.fillIndexCount/3}}}_drawOutline(t,e,s,n,i,r){const{context:o,displayLevel:l,state:h,painter:u,pixelRatio:c,spriteMosaic:m,requestRender:d,allowDelayedRender:g}=t,p=s.outlineMaterial,_=u.vectorTilesMaterialManager,f=.75/c,x=this._outlineProgramOptions,b=_.getMaterialProgram(o,p,x);if(g&&null!=d&&!b.compiled)return void d();o.useProgram(b),b.setUniformMatrix3fv("u_displayMat3",r===y.Cq.VIEWPORT?h.displayMat3:h.displayViewMat3),b.setUniform2fv("u_fillTranslation",i),b.setUniform1f("u_depth",s.z+v),b.setUniform1f("u_outline_width",f);let P=-1;for(const y of n){if(!y.layerData.has(e))continue;y.key.level!==P&&(P=y.key.level,p.setDataUniforms(b,l,s,P,m));const t=y.layerData.get(e);if(t.prepareForRendering(o),!t.outlineIndexCount)continue;const n=t.outlineVAO;null!=n&&(o.bindVAO(n),b.setUniformMatrix3fv("u_dvsMat3",y.transforms.displayViewScreenMat3),o.setStencilFunction(a.MT.EQUAL,y.stencilRef,255),o.drawElements(a.WR.TRIANGLES,t.outlineIndexCount,a.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.outlineIndexStart),y.triangleCount+=t.outlineIndexCount/3)}}}class P extends r.A{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(t,e){const{context:s,displayLevel:n,state:i,painter:r,pixelRatio:o,spriteMosaic:l,styleLayerUID:h,requestRender:u,allowDelayedRender:c}=t;if(!e.some((t=>t.layerData.get(h)?.lineIndexCount??!1)))return;const m=t.styleLayer,d=m.lineMaterial,p=r.vectorTilesMaterialManager,_=m.getPaintValue("line-translate",n),f=m.getPaintValue("line-translate-anchor",n),x=m.getPaintProperty("line-pattern"),v=void 0!==x,b=v&&x.isDataDriven;let P,S;if(v&&!b){const t=x.getValue(n);P=l.getMosaicItemPosition(t)}let E=!1;if(!v){const t=m.getPaintProperty("line-dasharray");if(S=void 0!==t,E=S&&t.isDataDriven,S&&!E){const e=t.getValue(n),s=m.getDashKey(e,m.getLayoutValue("line-cap",n));P=l.getMosaicItemPosition(s)}}const C=1/o,w=this._programOptions;w.pattern=v,w.sdf=S;const I=p.getMaterialProgram(s,d,w);if(c&&null!=u&&!I.compiled)return void u();if(s.useProgram(I),I.setUniformMatrix3fv("u_displayViewMat3",i.displayViewMat3),I.setUniformMatrix3fv("u_displayMat3",f===y.Cq.VIEWPORT?i.displayMat3:i.displayViewMat3),I.setUniform2fv("u_lineTranslation",_),I.setUniform1f("u_depth",m.z),I.setUniform1f("u_antialiasing",C),P&&null!=P){const{page:t}=P,e=l.getPageSize(t);null!=e&&(l.bind(s,a.Cj.LINEAR,t,g.$U),I.setUniform2fv("u_mosaicSize",e),I.setUniform1i("u_texture",g.$U))}let T=-1;for(const y of e){if(!y.layerData.has(h))continue;y.key.level!==T&&(T=y.key.level,d.setDataUniforms(I,n,m,T,l));const t=2**(n-T)/o;I.setUniform1f("u_zoomFactor",t);const e=y.layerData.get(h);if(!e.lineIndexCount)continue;e.prepareForRendering(s);const i=e.vao;if(null!=i){if(s.bindVAO(i),I.setUniformMatrix3fv("u_dvsMat3",y.transforms.displayViewScreenMat3),s.setStencilFunction(a.MT.EQUAL,y.stencilRef,255),b||E){const t=e.patternMap;if(!t)continue;for(const[e,n]of t){const t=l.getPageSize(e);null!=t&&(l.bind(s,a.Cj.LINEAR,e,g.$U),I.setUniform2fv("u_mosaicSize",t),I.setUniform1i("u_texture",g.$U),s.drawElements(a.WR.TRIANGLES,n[1],a.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n[0]))}}else s.drawElements(a.WR.TRIANGLES,e.lineIndexCount,a.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.lineIndexStart);y.triangleCount+=e.lineIndexCount/3}}}}var S=s(17845),E=s(59992),C=s(59339);const w=1/65536;class I extends r.A{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=(0,S.vt)()}dispose(){}drawMany(t,e){const s=t.styleLayer;this._drawIcons(t,s,e),this._drawText(t,s,e)}_drawIcons(t,e,s){const{context:n,displayLevel:i,painter:r,spriteMosaic:o,state:a,styleLayerUID:l,requestRender:h,allowDelayedRender:u}=t,c=e.iconMaterial,m=r.vectorTilesMaterialManager;let d,p=!1;for(const g of s)if(g.layerData.has(l)&&(d=g.layerData.get(l),d.iconPerPageElementsMap.size>0)){p=!0;break}if(!p)return;const _=e.getPaintValue("icon-translate",i),f=e.getPaintValue("icon-translate-anchor",i);let x=e.getLayoutValue("icon-rotation-alignment",i);x===y.I5.AUTO&&(x=e.getLayoutValue("symbol-placement",i)===y.kt.POINT?y.I5.VIEWPORT:y.I5.MAP);const v=x===y.I5.MAP,b=e.getLayoutValue("icon-keep-upright",i)&&v,P=d.isIconSDF,S=this._iconProgramOptions;S.sdf=P;const w=m.getMaterialProgram(n,c,S);if(u&&null!=h&&!w.compiled)return void h();n.useProgram(w),w.setUniformMatrix3fv("u_displayViewMat3",x===y.I5.MAP?a.displayViewMat3:a.displayMat3),w.setUniformMatrix3fv("u_displayMat3",f===y.Cq.VIEWPORT?a.displayMat3:a.displayViewMat3),w.setUniform2fv("u_iconTranslation",_),w.setUniform1f("u_depth",e.z),w.setUniform1f("u_mapRotation",(0,C.wV)(a.rotation)),w.setUniform1f("u_keepUpright",b?1:0),w.setUniform1f("u_level",10*i),w.setUniform1i("u_texture",g.$U),w.setUniform1f("u_fadeDuration",E.zk/1e3);let I=-1;for(const g of s){if(!g.layerData.has(l))continue;if(g.key.level!==I&&(I=g.key.level,c.setDataUniforms(w,i,e,I,o)),d=g.layerData.get(l),0===d.iconPerPageElementsMap.size)continue;d.prepareForRendering(n),d.updateOpacityInfo();const s=d.iconVAO;if(null!=s){n.bindVAO(s),w.setUniformMatrix3fv("u_dvsMat3",g.transforms.displayViewScreenMat3),w.setUniform1f("u_time",(performance.now()-d.lastOpacityUpdate)/1e3);for(const[e,s]of d.iconPerPageElementsMap)this._renderIconRange(t,w,s,e,g)}}}_renderIconRange(t,e,s,n,i){const{context:r,spriteMosaic:o}=t;this._spritesTextureSize[0]=o.getWidth(n)/4,this._spritesTextureSize[1]=o.getHeight(n)/4,e.setUniform2fv("u_mosaicSize",this._spritesTextureSize),o.bind(r,a.Cj.LINEAR,n,g.$U),this._setStencilState(t,i),r.drawElements(a.WR.TRIANGLES,s[1],a.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*s[0]),i.triangleCount+=s[1]/3}_drawText(t,e,s){const{context:n,displayLevel:i,glyphMosaic:r,painter:o,pixelRatio:a,spriteMosaic:l,state:h,styleLayerUID:u,requestRender:c,allowDelayedRender:m}=t,d=e.textMaterial,p=o.vectorTilesMaterialManager;let _,f=!1;for(const g of s)if(g.layerData.has(u)&&(_=g.layerData.get(u),_.glyphPerPageElementsMap.size>0)){f=!0;break}if(!f)return;const x=e.getPaintProperty("text-opacity");if(x&&!x.isDataDriven&&0===x.getValue(i))return;const v=e.getPaintProperty("text-color"),b=!v||v.isDataDriven||v.getValue(i)[3]>0,P=e.getPaintProperty("text-halo-width"),I=e.getPaintProperty("text-halo-color"),T=(!P||P.isDataDriven||P.getValue(i)>0)&&(!I||I.isDataDriven||I.getValue(i)[3]>0);if(!b&&!T)return;let A=e.getLayoutValue("text-rotation-alignment",i);A===y.I5.AUTO&&(A=e.getLayoutValue("symbol-placement",i)===y.kt.POINT?y.I5.VIEWPORT:y.I5.MAP);const M=A===y.I5.MAP,D=e.getLayoutValue("text-keep-upright",i)&&M,N=.8*3/a;this._glyphTextureSize||(this._glyphTextureSize=(0,S.fA)(r.width/4,r.height/4));const F=e.getPaintValue("text-translate",i),R=e.getPaintValue("text-translate-anchor",i),k=this._sdfProgramOptions,L=p.getMaterialProgram(n,d,k);if(m&&null!=c&&!L.compiled)return void c();n.useProgram(L),L.setUniformMatrix3fv("u_displayViewMat3",A===y.I5.MAP?h.displayViewMat3:h.displayMat3),L.setUniformMatrix3fv("u_displayMat3",R===y.Cq.VIEWPORT?h.displayMat3:h.displayViewMat3),L.setUniform2fv("u_textTranslation",F),L.setUniform1f("u_depth",e.z+w),L.setUniform2fv("u_mosaicSize",this._glyphTextureSize),L.setUniform1f("u_mapRotation",(0,C.wV)(h.rotation)),L.setUniform1f("u_keepUpright",D?1:0),L.setUniform1f("u_level",10*i),L.setUniform1i("u_texture",g.mg),L.setUniform1f("u_antialiasingWidth",N),L.setUniform1f("u_fadeDuration",E.zk/1e3);let G=-1;for(const g of s){if(!g.layerData.has(u))continue;if(g.key.level!==G&&(G=g.key.level,d.setDataUniforms(L,i,e,G,l)),_=g.layerData.get(u),0===_.glyphPerPageElementsMap.size)continue;_.prepareForRendering(n),_.updateOpacityInfo();const s=_.textVAO;if(null==s)continue;n.bindVAO(s),L.setUniformMatrix3fv("u_dvsMat3",g.transforms.displayViewScreenMat3),this._setStencilState(t,g);const o=(performance.now()-_.lastOpacityUpdate)/1e3;L.setUniform1f("u_time",o),_.glyphPerPageElementsMap.forEach(((t,e)=>{this._renderGlyphRange(n,t,e,r,L,T,b,g)}))}}_renderGlyphRange(t,e,s,n,i,r,o,l){n.bind(t,a.Cj.LINEAR,s,g.mg),r&&(i.setUniform1f("u_halo",1),t.drawElements(a.WR.TRIANGLES,e[1],a.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e[0]),l.triangleCount+=e[1]/3),o&&(i.setUniform1f("u_halo",0),t.drawElements(a.WR.TRIANGLES,e[1],a.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e[0]),l.triangleCount+=e[1]/3)}_setStencilState(t,e){const{context:s,is3D:n,stencilSymbols:i}=t;if(s.setStencilTestEnabled(!0),i)return s.setStencilWriteMask(255),void s.setStencilFunction(a.MT.ALWAYS,e.stencilRef,255);s.setStencilWriteMask(0),n?s.setStencilFunction(a.MT.EQUAL,e.stencilRef,255):s.setStencilFunction(a.MT.GREATER,255,255)}}const T={clip:h,stencil:u.A,tileDebugInfo:c.A,vtlBackground:f,vtlFill:b,vtlLine:P,vtlCircle:x,vtlSymbol:I}},77545:(t,e,s)=>{function n(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function i(){const t=n("svg");return t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),t}function r(t){return null!=t&&document.body.removeChild(t),null}s.d(e,{FJ:()=>n,p:()=>i,pK:()=>r})},87430:(t,e,s)=>{s.d(e,{A:()=>h});var n=s(66866),i=s(52495),r=s(39831),o=s(40189),a=s(21564),l=(s(539),s(9272),s(63863));let h=class extends i.A{constructor(t){super(t),this.computedOpacity=1,this.computedVisible=!0,this.opacity=1,this.visible=!0,this._fadeOutResolver=null,this._fadeInResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeInResolver=this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0}fadeIn(){return this._fadeInResolver||(this.opacity=1,this.computedOpacity=0,this._fadeOutResolver?.(),this._fadeOutResolver=null,this._fadeInResolver=(0,o.Tw)()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver=(0,o.Tw)()),this._fadeOutResolver.promise}transitionStep(t,e){const s=(0,r.A)("mapview-transitions-duration"),n=s?1/s:0;if(0===n)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{const e=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===e)this.computedVisible=this.visible;else{const i=t*n;this.computedOpacity=s>e?Math.max(e,s-i):Math.min(e,s+i),this.computedVisible=this.computedOpacity>0}}this.transitioning||(this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeOutResolver=this._fadeInResolver=null)}};(0,n._)([(0,a.MZ)()],h.prototype,"computedOpacity",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"computedVisible",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"opacity",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"visible",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"transitioning",null),(0,n._)([(0,a.MZ)()],h.prototype,"_fadeOutResolver",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"_fadeInResolver",void 0),h=(0,n._)([(0,l.$)("esri.views.2d.engine.transitions.FadeTransition")],h)},15946:(t,e,s)=>{s.d(e,{GW:()=>_,IU:()=>v,Jo:()=>o,MG:()=>r,Wh:()=>m,cP:()=>E,os:()=>u,p6:()=>p,pJ:()=>a,ru:()=>P,s3:()=>b,w4:()=>S,wV:()=>g,yM:()=>C,z0:()=>d});var n=s(65319),i=s(87569);const r=Number.POSITIVE_INFINITY,o=Math.PI,a=2*o,l=128/o,h=256/360,u=o/180,c=1/Math.LN2;function m(t,e){return(t%=e)>=0?t:t+e}function d(t){return m(t*l,256)}function g(t){return m(t*h,256)}function p(t){return Math.log(t)*c}function _(t,e,s){return t*(1-s)+e*s}const f=8,y=14,x=16;function v(t){return f+Math.max((t-y)*x,0)}function b(t,e,s){let n,i,r,o=0;for(const a of s){n=a.length;for(let s=1;s<n;++s)i=a[s-1],r=a[s],i.y>e!=r.y>e&&((r.x-i.x)*(e-i.y)-(r.y-i.y)*(t-i.x)>0?o++:o--)}return 0!==o}function P(t,e,s,i){let r,o,a,l;const h=i*i;for(const u of s){const s=u.length;if(!(s<2)){r=u[0].x,o=u[0].y;for(let i=1;i<s;++i){if(a=u[i].x,l=u[i].y,(0,n.Ng)(t,e,r,o,a,l)<h)return!0;r=a,o=l}}}return!1}function S(t,e,s,n,i,r,o){const a=Math.max(n,Math.min(e,r))-e,l=Math.max(i,Math.min(s,o))-s;return a*a+l*l<=t*t}function E(t,e){if(0===e||Number.isNaN(e))return t;const s=[],n=new i.bR(0,0),r=new i.bR(0,0),o=new i.bR(0,0);for(let a=0;a<t.length;a++){const l=t[a],h=[];for(let t=0;t<l.length;t++){const s=l[t-1],a=l[t],u=l[t+1];0===t?n.setCoords(0,0):n.assignSub(a,s).normalize().rightPerpendicular(),t===l.length-1?r.setCoords(0,0):r.assignSub(u,a).normalize().rightPerpendicular(),o.assignAdd(n,r).normalize();const c=o.x*r.x+o.y*r.y;0!==c&&o.scale(1/c),h.push(i.bR.add(a,o.scale(e)))}s.push(h)}return s}function C(t,e,s,n){const r=new i.bR(t[0],t[1]);if(r.scale(n),"viewport"===e){const t=-s*(Math.PI/180),e=Math.cos(t),n=Math.sin(t);r.rotate(e,n)}return r}},59992:(t,e,s)=>{s.d(e,{IT:()=>n,av:()=>r,o2:()=>i,zk:()=>o});const n=!0,i=32,r=1.5,o=200},31541:(t,e,s)=>{s.d(e,{$u:()=>d,Cq:()=>u,Dc:()=>n,I5:()=>o,KI:()=>l,Ms:()=>h,O6:()=>a,bv:()=>i,kt:()=>r,v9:()=>c});var n,i,r,o,a,l,h,u,c,m=s(63643);!function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"}(n||(n={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(i||(i={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(r||(r={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(o||(o={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(a||(a={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(l||(l={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(h||(h={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(u||(u={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(c||(c={}));class d{static{this.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:i.VISIBLE}}}static{this.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:i.VISIBLE}}}static{this.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:i.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:m.xR.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:m.JO.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}}}static{this.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:i.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:r.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:l.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:o.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:l.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:a.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:o.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:h.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[c.HORIZONTAL]}}}static{this.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:i.VISIBLE}}}static{this.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}}}static{this.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP}}}static{this.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP},"line-width":{type:"number",minimum:0,default:1}}}static{this.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP}}}static{this.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}}}static{this.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:u.MAP}}}}},92947:(t,e,s)=>{s.d(e,{u:()=>d});var n=s(79190),i=s(78835),r=s(25423),o=s(99776),a=s(24121),l=s(3912),h=s(43556),u=s(61409);const c=(0,o.vt)(),m=(0,l.vt)();class d extends u.Y{constructor(t,e,s,n){super(t,e,s,n,h.CQ,h.CQ)}destroy(){super.destroy()}setTransform(t){const e=this.resolution/t.resolution,s=this.transforms.tileMat3,[o,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),l=this.width/this.rangeX*e,h=this.height/this.rangeY*e;(0,r.hZ)(s,l,0,0,0,h,0,o,a,1),(0,r.lw)(this.transforms.displayViewScreenMat3,t.displayViewMat3,s);const u=(0,n.hZ)((0,i.vt)(),l,0,0,h,o,a);(0,n.lw)(this.transforms.labelMat2d,t.viewMat2d,u);const c=[0,0];t.toScreen(c,[this.x,this.y]);const m=this.transforms.tileUnitsToPixels;(0,r.D_)(m),(0,r.Tl)(m,m,c),(0,r.e$)(m,m,Math.PI*t.rotation/180),(0,r.hs)(m,m,[l,h,1])}_createTransforms(){return{labelMat2d:(0,i.vt)(),tileMat3:(0,o.vt)(),displayViewScreenMat3:(0,o.vt)(),tileUnitsToPixels:(0,o.vt)()}}containsScreenPoint(t,e,s){const n=(0,r.lw)(c,t.viewMat3,this.transforms.tileMat3),i=(0,r.B8)(c,n);if(null==i)return!0;(0,a.i)(m,...e,1);const o=(0,a.o)(m,m,i),l=s*(this.resolution/t.resolution);return o[0]>=-l&&o[0]<this.width+l&&o[1]>=-l&&o[1]<this.height+l}}},7370:(t,e,s)=>{s.d(e,{Pd:()=>r,VS:()=>a,oI:()=>o});var n=s(41746),i=s(69955);const r=new Map([["geometry",[new i._("a_pos",2,n.pe.BYTE,0,2)]]]),o=new Map([["geometry",[new i._("a_pos",2,n.pe.BYTE,0,4),new i._("a_tex",2,n.pe.BYTE,2,4)]]]),a=new Map([["geometry",[new i._("a_pos",2,n.pe.UNSIGNED_SHORT,0,4)]]])},18507:(t,e,s)=>{s.d(e,{A:()=>r});var n=s(20053),i=s(1314);class r{static{this.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+n.A.byteSizeHint}constructor(t,e){this.id=t,this.sortKey=e,this.records=[]}serialize(t){return t.push(this.id),t.writeF32(this.sortKey),(0,i.j)(t,this.records),t}static deserialize(t){const e=t.readInt32(),s=t.readF32(),o=new r(e,s);return o.records=(0,i._)(t,n.A)??[],o}}},20053:(t,e,s)=>{s.d(e,{A:()=>n});class n{static{this.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT}constructor(t,e,s,n,i,r,o){this.instanceId=t,this.textureKey=e,this.indexStart=s,this.indexCount=n,this.vertexStart=i,this.vertexCount=r,this.overlaps=o}updateBaseOffsets(t){this.vertexStart+=t.vertexFrom,this.indexStart+=t.indexFrom}clone(){return new n(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(t,e,s,n,i,r,o,a){t.push(e),t.push(s),t.push(n),t.push(i),t.push(r),t.push(o),t.push(a)}serialize(t){return t.push(this.instanceId),t.push(this.textureKey),t.push(this.indexStart),t.push(this.indexCount),t.push(this.vertexStart),t.push(this.vertexCount),t.push(this.overlaps),t}static deserialize(t){const e=t.readInt32(),s=t.readInt32(),i=t.readInt32(),r=t.readInt32(),o=t.readInt32(),a=t.readInt32(),l=t.readInt32();return new n(e,s,i,r,o,a,l)}}},90819:(t,e,s)=>{s.d(e,{R:()=>w});var n=s(39831),i=s(539),r=s(78835),o=s(99776),a=s(92947),l=s(43556),h=s(18507),u=s(79432),c=s(93540),m=s(43901),d=s(41746);function g(t,e){return t<<16|255&e}class p{constructor(t,e,s,n,i){this.instance=t,this.materialKey=e,this.target=s,this.start=n,this.count=i}get textureKey(){return function(t){return 255&t}(this.materialKey)}get indexEnd(){return this.start+this.count}extend(t){this.count+=t}render(t){this.instance.techniqueRef.render(t,this)}get key(){return this.target.key}getStencilReference(){return this.target.stencilRef}getAttributePrecisionPackFactors(){const t=this.instance.instanceId;return this.target.getMesh(t).getAttributePrecisionPackFactors()}draw(t,e){(0,m.Eq)(t)?this.drawCompute(t.context,e):this.drawGeometry(t.context,e)}drawCompute(t,e){const s=this.instance.instanceId,n=this.target.getMesh(s).getComputeVAO(t,e),i=this.start*Uint32Array.BYTES_PER_ELEMENT/3;t.bindVAO(n),t.drawElements(d.WR.POINTS,this.count/3,d.pe.UNSIGNED_INT,i),t.bindVAO(null)}drawGeometry(t,e){const s=this.instance.instanceId,n=this.target.getMesh(s).getGeometryVAO(t,e),i=this.start*Uint32Array.BYTES_PER_ELEMENT;t.bindVAO(n),t.drawElements(d.WR.TRIANGLES,this.count,d.pe.UNSIGNED_INT,i),t.bindVAO(null)}}class _{constructor(){this._length=0,this._minOrderedLength=0,this._materialKeys=new Set}static fromDisplayEntities(t,e,s,n){const i=new _;for(const r of t.values())for(const t of r.records){const r=s.getInstance(t.instanceId),o=g(r.instanceId,t.textureKey);i.addRecord(r,o,t.indexStart,t.indexCount,t.vertexStart,t.vertexCount,e,n)}return i}get length(){return this._length}get minOrderedLength(){return this._minOrderedLength}get minUnorderedLength(){return this._materialKeys.size}render(t,e){const{drawPhase:s}=t;for(const n of this.infos()){const i=n.instance.techniqueRef;i.drawPhase&s&&(null==e||i.type===e)&&n.render(t)}}addRecord(t,e,s,n,i,r,o,a){let l=s,h=n;if(h||(l=i,h=r),!h)return;if(null==this._head){const s=new p(t,e,o,l,h);return this._head=new c.B(s),this._tail=this._head,this._length++,void this._minOrderedLength++}if(a===u.ch.STRICT_ORDER)return this._insert(t,e,o,l,h,this._tail,null);let m=null,d=this._head;const g=t.instanceId,_=t.techniqueRef.symbologyPlane;if(a===u.ch.STRICT_MARKERS_AND_TEXT&&(_===u.uC.MARKER||_===u.uC.TEXT))return this._insert(t,e,o,l,h,this._tail,null);for(;d;){const s=d.data.instance,n=s.instanceId,i=s.techniqueRef.symbologyPlane,r=m?.data.instance.instanceId;if(_<i||g===r&&g!==n)return this._insert(t,e,o,l,h,m,d);m=d,d=d.next}this._insert(t,e,o,l,h,m,null)}*infos(){if(null!=this._head)for(const t of this._head.values())yield t}_insert(t,e,s,n,i,r,o){if(null==r&&null==o){const r=new p(t,e,s,n,i);return this._head=new c.B(r),this._tail=this._head,this._length++,void this._minOrderedLength++}return e!==this._tail.data.materialKey&&this._minOrderedLength++,this._materialKeys.add(e),null==r&&null!=o?this._insertAtHead(t,e,s,n,i,o):null!=r&&null==o?this._insertAtEnd(t,e,s,n,i,r):null!=r&&null!=o?this._insertAtMiddle(t,e,s,n,i,r,o):void 0}_insertAtHead(t,e,s,n,i,r){const o=n+i;if(e===r.data.materialKey&&s===r.data.target&&o===r.data.start)r.data.start=n,r.data.count+=i;else{const o=new p(t,e,s,n,i);this._head=new c.B(o),this._head.next=r,this._length++}}_insertAtEnd(t,e,s,n,i,r){if(r.data.materialKey===e&&r.data.indexEnd===n)r.data.count+=i;else{const o=new p(t,e,s,n,i);this._tail=new c.B(o),r.next=this._tail,this._length++}}_insertAtMiddle(t,e,s,n,i,r,o){const a=n+i;if(r.data.materialKey===e&&r.data.target===s&&r.data.indexEnd===n)r.data.count+=i,r.data.materialKey===o.data.materialKey&&r.data.target===o.data.target&&r.data.indexEnd===o.data.start&&(r.data.count+=o.data.count,r.next=o.next,this._length--);else if(e===o.data.materialKey&&s===o.data.target&&a===o.data.start)o.data.start=n,o.data.count+=i;else{const a=new p(t,e,s,n,i),l=new c.B(a);r.next=l,l.next=o,this._length++}}}class f{constructor(t){this._indexOnly=t,this.vertex={count:0,operations:[]},this.index={count:0,operations:[]}}copyRecord(t){let e=0;this._indexOnly||(e=this.vertex.count-t.vertexStart,this.vertex.operations.push({srcFrom:t.vertexStart,dstFrom:this.vertex.count,count:t.vertexCount,mutate:0}),t.vertexStart=this.vertex.count,this.vertex.count+=t.vertexCount);let s=!1;if(this._indexOnly&&this.index.operations.length>=1){const e=this.index.operations[this.index.operations.length-1];e.srcFrom+e.count===t.indexStart&&(e.count+=t.indexCount,s=!0)}s||this.index.operations.push({srcFrom:t.indexStart,dstFrom:this.index.count,count:t.indexCount,mutate:e}),t.indexStart=this.index.count,this.index.count+=t.indexCount}}var y=s(51688),x=s(56670),v=s(17906);class b{constructor(t){this._pos=0,this._buffer=t,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}}var P=s(1314);function S(t){return t?{entities:(0,P._)(new b(t.entities),h.A),vertexData:t.data.map(E)}:null}function E(t){const e=t.layout.stride,s=new DataView(t.vertices),n=[],i=t.vertices.byteLength/e;let r=0;for(let a=0;a<i;a++){const i={};for(const e of t.layout.attributes){let t=`${e.offset} ${e.name}`,n=(0,v.q)(s,e,r);if(e.packPrecisionFactor)if(t+=` (precision: ${e.packPrecisionFactor})`,"number"==typeof n)n/=e.packPrecisionFactor;else for(let s=0;s<n.length;s++)n[s]/=e.packPrecisionFactor;i[t]=n}r+=e,n.push(i)}const o=t.metrics?(0,P._)(new b(t.metrics),y.f)??[]:[];return{vertices:n,layout:t.layout,metrics:o}}let C=0;class w extends a.u{constructor(t,e,s,n,i,a,l=!1){super(t,e,s,n),this._fader=i,this._labelInstanceId=a,this._meshes=new Map,this._entities=[],this._entityIndex=new Map,this._invalidated=!1,this._nextUploadAllowed=!1,this.tileAge=C++,this._metrics=[],this._metricsVisibility=new Set,this._entityIds=new Set,this._entityIdsFromBuffer=new Set,this._attributeEpoch=0,this._encounteredEnd=!1,this.neededForCoverage=!1,this.isCoverage=!1,this.rendering=!1,this._decluttered=!1,this._objectIdMap=null,this.visible=!0,this.transforms.labelMat2d=(0,r.vt)(),this.transforms.tileUnitsToPixels=(0,o.vt)(),this.enableDeferredUploads=l}destroy(){super.destroy(),this.clear()}clear(){for(const t of this._meshes.values())t.destroy();this._meshes.clear(),this._entities=[],this._fader?.removeFeatureTileMetrics(this,this._metrics),this._metrics=[],this._displayList=null,this._invalidated=!0,this._entityIds.clear(),this._nextUploadAllowed=!0}beforeRender(t){super.beforeRender(t),this._needsReshuffle&&t.reshuffleManager.schedule(this)}tryReady(t){const e=this._invalidated&&!this._uploadAllowed;return!(this.isReady||e||!this._encounteredEnd||!(t>=this._attributeEpoch)||((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.ready [epoch=${t}]`),this.ready(),this.requestRender(),this.decluttered=!1,0))}get symbols(){const t=new Map;for(const e of this._metrics)t.get(e.labelClassId)||t.set(e.labelClassId,[]),t.get(e.labelClassId).push(e);return t}get decluttered(){return this._decluttered}set decluttered(t){this._decluttered=t,this.requestRender()}get id(){return this.key.id}get hasData(){return!!this._meshes.size}get hasAnimations(){return!!this._objectIdMap}get needsUpload(){return this._invalidated}get _uploadAllowed(){return!this.enableDeferredUploads||this._nextUploadAllowed}get _hasMetrics(){return this._metrics.length>0}upload(){this._nextUploadAllowed=!0}getDisplayList(t,e){if(this._uploadAllowed&&this._invalidated){this._entities.sort(((t,e)=>{const s=e.sortKey,n=t.sortKey;return n===s?t.id-e.id:n-s})),e===u.ch.BATCHING&&this.reshuffle(!0),this._displayList=_.fromDisplayEntities(this._entities,this,t,e);for(const t of this._meshes.values())t.upload();this.debugInfo.display.length=this._displayList.length,this.debugInfo.display.minOrderedLength=this._displayList.minOrderedLength,this.debugInfo.display.minUnorderedLength=this._displayList.minUnorderedLength,this.requestRender(),this._invalidated=!1,this._nextUploadAllowed=!1}return this._displayList}getMesh(t){if(!this._meshes.has(t))throw new Error(`InternalError: Unable to find VAO for instance: ${t}`);return this._meshes.get(t)}getSortKeys(t){const e=new Map;for(const{id:s,sortKey:n}of this._entities)if(t.has(s)&&e.set(s,n),e.size===t.size)break;return e}onMessage(t){if(t.objectIdMap)for(const e in t.objectIdMap)this._objectIdMap||(this._objectIdMap={}),this._objectIdMap[e]=t.objectIdMap[e];switch(t.type){case"append":this._onAppendMessage(t);break;case"update":this._onUpdateMessage(t)}if(this._aggregateMemoryStats(),this.requestRender(),t.end){if((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.end [epoch=${t.attributeEpoch}]`),!t.attributeEpoch)throw new Error("InternalError: Attribute epoch not defined.");this._attributeEpoch=t.attributeEpoch,this._encounteredEnd=!0}this._writeLabelVisibilityToMesh()}_onAppendMessage(t){if((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.append`,{append:S(t?.append)}),t.clear&&this.clear(),!t.append)return;const e=(0,P._)(new b(t.append.entities),h.A);this._insert(e,t.append.data,!1)}_onUpdateMessage(t){(0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.update`,{isPixelBuffer:t.isPixelBuffer,modify:S(t.modify),remove:t.remove});const e=(0,P._)(new b(t.modify.entities),h.A),s=e.map((t=>t.id)),i=t.isPixelBuffer??!1,r=[...t.remove,...s];i?this._removeByIdsFromBuffer(r):this._removeByIds(r),this._insert(e,t.modify.data,i)}reshuffle(t=!1){if(this.destroyed)return;const e=new Map;for(const s of this._entities)for(const n of s.records){const s=this._meshes.get(n.instanceId);let i=e.get(s);i||(i=new f(t),e.set(s,i)),i.copyRecord(n)}for(const[s,n]of e)s.reshuffle(n);this._invalidated=!0,this._aggregateMemoryStats(),(0,n.A)("esri-2d-update-debug")&&i.A.getLogger("esri.views.2d.engine.webgl.FeatureTile").info(`Tile ${this.key.id} was reshuffled.`)}copyPixelBufferedEntitesFrom(t,e,s,n){const i=s*l.CQ,r=n*l.CQ;for(const o of t._entities){let s=null;for(const n of o.records)if(n.overlaps&e){const e=t.getMesh(n.instanceId),a=this._ensureMesh(n.instanceId,e.layout,e.useVisibility).copyRecordFrom(e,n,i,r);s||(s=new h.A(o.id,o.sortKey),this._entityIdsFromBuffer.add(o.id),this._entityIndex.set(s.id,s),this._entities.push(s)),s.records.push(a)}}this._invalidated=!0}get metricsVisibility(){return this._metricsVisibility}copyMetricsVisibility(t){for(const e of t)this._metricsVisibility.add(e);this._writeLabelVisibilityToMesh()}updateLabelVisibility(){this._metricsVisibility.clear();for(const t of this._metrics)t.uniqueSymbol.show&&t.selectedForRendering&&this._metricsVisibility.add(t.hash);this._writeLabelVisibilityToMesh()}_writeLabelVisibilityToMesh(){const t=this._meshes.get(this._labelInstanceId);if(t&&this._hasMetrics){for(const e of this._metrics){const s=this._entityIndex.get(e.id);if(!s)continue;const n=this._metricsVisibility.has(e.hash);t.setEntityRecordRangeVisibility(s.records,e.recordStart,e.recordCount,n?0:255)}this._invalidated=!0}}_ensureMesh(t,e,s){return this._meshes.has(t)||this._meshes.set(t,new x.X(this._stage.bufferPool,e,s)),this._meshes.get(t)}_insert(t,e,s){if(!t.length)return;this._removeDuplicatedBufferedEntites(t);const n=this._insertVertexData(e);for(const i of t){for(const t of i.records)t.updateBaseOffsets(n.get(t.instanceId));s?this._tryInsertBufferedEntity(i):this._insertEntity(i)}this._invalidated=!0}_insertMetrics(t){for(const e of t)e.tile=this;this._metrics.push(...t),this._fader?.insertFeatureTileMetrics(this,t)}_insertVertexData(t){const e=new Map;for(const s of t){const{instanceId:t,layout:n}=s,i=n.attributes.some((t=>"visibility"===t.name)),r=this._ensureMesh(t,n,i).append(s);if(s.metrics){const t=(0,P._)(new b(s.metrics),y.f)??[];this._insertMetrics(t)}e.set(t,r)}return e}_insertEntity(t){(0,n.A)("esri-2d-update-debug")&&this._entityIds.has(t.id)&&console.error(`Tile ${this.key.id} insertEntity: Already have entityId ${t.id}`),this._entityIds.add(t.id),this._entityIndex.set(t.id,t),this._entities.push(t)}_tryInsertBufferedEntity(t){this._entityIds.has(t.id)?this._removeRecordsFromMesh(t.records):(this._entityIdsFromBuffer.add(t.id),this._entityIndex.set(t.id,t),this._entities.push(t))}_removeDuplicatedBufferedEntites(t){if(!this._entityIdsFromBuffer.size)return;const e=[];for(const s of t)this._entityIdsFromBuffer.has(s.id)&&e.push(s.id);this._removeByIds(e)}_removeByIdsFromBuffer(t){this._removeByIds(t.filter((t=>this._entityIdsFromBuffer.has(t))))}_removeByIds(t){if(0===t.length)return;const e=new Set(t),s=[];for(const i of this._entities)e.has(i.id)?(this._remove(i),this._entityIndex.delete(i.id)):s.push(i);this._entities=s;const n=this._metrics.filter((t=>e.has(t.displayId)));this._metrics=this._metrics.filter((t=>!e.has(t.displayId))),this._fader?.removeFeatureTileMetrics(this,n),this._invalidated=!0}_remove(t){this._removeRecordsFromMesh(t.records),this._entityIds.delete(t.id),this._entityIdsFromBuffer.delete(t.id)}_removeRecordsFromMesh(t){for(const e of t){const{instanceId:t,indexStart:s,indexCount:n,vertexStart:i,vertexCount:r}=e;this._meshes.get(t)?.remove(s,n,i,r)}}_aggregateMemoryStats(){this.debugInfo.memory.bytesUsed=0,this.debugInfo.memory.bytesReserved=0;for(const t of this._meshes.values())this.debugInfo.memory.bytesUsed+=t.memoryStats.bytesUsed,this.debugInfo.memory.bytesReserved+=t.memoryStats.bytesReserved}get _needsReshuffle(){if(this.destroyed)return!1;const{bytesUsed:t,bytesReserved:e}=this.debugInfo.memory,s=t/e,{minOrderedLength:n,length:i}=this.debugInfo.display;return e>l._x&&s<l.eI||i>l.Xh&&n/i<l.Vl}get entityIds(){return this._objectIdMap?this._entities.map((({id:t})=>({objectId:this._objectIdMap[t],displayId:t}))):[]}}},59339:(t,e,s)=>{s.d(e,{p6:()=>a,wV:()=>o});Math.PI;const n=256/360,i=1/Math.LN2;function r(t,e){return(t%=e)>=0?t:t+e}function o(t){return r(t*n,256)}function a(t){return Math.log(t)*i}},49357:(t,e,s)=>{s.d(e,{W:()=>a,o:()=>h});var n=s(39831),i=s(6267),r=s(93540);const o=(0,n.A)("esri-2d-log-allocations");class a{static create(t,e){const s=e.acquireUint32Array(t);return new a(s,e)}constructor(t,e){this._array=t,this._pool=e}get array(){return this._array}get length(){return this._array.length}getUint32View(t,e){return new Uint32Array(this._array.buffer,t+this._array.byteOffset,e)}expand(t){if(t<=this._array.byteLength)return;const e=this._pool.acquireUint32Array(t);e.set(this._array),this._pool.releaseUint32Array(this._array),this._array=e}destroy(){this._pool.releaseUint32Array(this._array)}}class l{constructor(){this._data=new ArrayBuffer(l.BYTE_LENGTH),this._freeList=new r.P({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 16e6}get buffer(){return this._data}acquireUint32Array(t){const e=this._freeList.firstFit(t);return null==e?null:new Uint32Array(this._data,e,t/Uint32Array.BYTES_PER_ELEMENT)}releaseUint32Array(t){this._freeList.free(t.byteOffset,t.byteLength)}}class h{constructor(){this._pages=[],this._pagesByBuffer=new Map,this._bytesAllocated=0}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*l.BYTE_LENGTH}acquireUint32Array(t){if(this._bytesAllocated+=t,o&&console.log(`Allocating ${t}, (${this._bytesAllocated} / ${this._bytesTotal})`),t>=l.BYTE_LENGTH)return new Uint32Array(t/Uint32Array.BYTES_PER_ELEMENT);for(const s of this._pages){const e=s.acquireUint32Array(t);if(null!=e)return e}const e=this._addPage().acquireUint32Array(t);return(0,i.Lw)(e,"Expected to allocate page"),e}releaseUint32Array(t){this._bytesAllocated-=t.byteLength,o&&console.log(`Freeing ${t.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const e=this._pagesByBuffer.get(t.buffer);e&&e.releaseUint32Array(t)}_addPage(){const t=new l;return this._pages.push(t),this._pagesByBuffer.set(t.buffer,t),t}}},60470:(t,e,s)=>{s.d(e,{A:()=>n});class n{constructor(t=0,e=0,s=0,n=0){this.x=t,this.y=e,this.width=s,this.height=n}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}}},61409:(t,e,s)=>{s.d(e,{Y:()=>o});var n=s(25423),i=s(37353),r=s(42482);class o extends i.q{constructor(t,e,s,n,i,o,a=i,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new r.A(t),this.resolution=e,this.x=s,this.y=n,this.width=i,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let t=this;for(;t.parent!==this._stage;){if(!t.parent)return 0;t=t.parent}return this._stage.children.indexOf(t)}setTransform(t){const e=this.resolution/(t.resolution*t.pixelRatio),s=this.transforms.tileMat3,[i,r]=t.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*e,a=this.height/this.rangeY*e;(0,n.hZ)(s,o,0,0,0,a,0,i,r,1),(0,n.lw)(this.transforms.displayViewScreenMat3,t.displayViewMat3,s)}get destroyed(){return this._destroyed}}},38403:(t,e,s)=>{s.d(e,{$Y:()=>f,AV:()=>h,ES:()=>g,Qz:()=>u,UE:()=>p,bX:()=>_});var n=s(98849),i=s(539),r=s(41746),o=s(60501),a=s(69955);const l=()=>i.A.getLogger("esri.views.2d.engine.webgl.Utils");function h(t){switch(t){case r.ld.UNSIGNED_BYTE:return 1;case r.ld.UNSIGNED_SHORT_4_4_4_4:return 2;case r.ld.FLOAT:return 4;default:return void l().error(new n.A("webgl-utils",`Unable to handle type ${t}`))}}function u(t){switch(t){case r.ld.UNSIGNED_BYTE:return Uint8Array;case r.ld.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case r.ld.FLOAT:return Float32Array;default:return void l().error(new n.A("webgl-utils",`Unable to handle type ${t}`))}}const c=t=>{const e=new Map;for(const s in t)for(const n of t[s])e.set(n.name,n.location);return e},m=t=>{const e={};return t.forEach(((t,s)=>e[s]=t?.length?t[0].stride:0)),e},d=new Map,g=(t,e)=>{if(!d.has(t)){const s=function(t){const e=new Map;for(const s in t){const n=t[s];let i=0;e.set(s,n.map((t=>{const e=new a._(t.name,t.count,t.type,i,0,t.normalized||!1);return i+=t.count*(0,o._)(t.type),e}))),e.get(s).forEach((t=>t.stride=i))}return e}(e),n={strides:m(s),bufferLayouts:s,attributes:c(e)};d.set(t,n)}return d.get(t)},p=t=>t.includes("data:image/svg+xml");function _(t){const e=[];for(let s=0;s<t.length;s++)e.push(t.charCodeAt(s));return e}function f(t){if(null==t)return"";const{type:e}=t;switch(e){case"CIMMarkerPlacementAlongLineRandomSize":return`${e}-${t.seed}-${t.randomization}`;case"CIMMarkerPlacementAlongLineVariableSize":return`${e}-${t.maxRandomOffset}-${t.numberOfSizes}-${t.seed}-${t.variationMethod}`;case"CIMMarkerPlacementAtExtremities":return`${e}-${t.extremityPlacement}-${t.offsetAlongLine}`;case"CIMMarkerPlacementAtRatioPositions":return`${e}-${t.beginPosition}-${t.endPosition}-${t.flipFirst}-${JSON.stringify(t.positionArray)}`;case"CIMMarkerPlacementAtMeasuredUnits":return`${e}-${t.interval}-${t.skipMarkerRate}-${t.placeAtExtremities}`;case"CIMMarkerPlacementInsidePolygon":return`${e}-${t.stepX}-${t.stepY}-${t.randomness}-${t.gridType}-${t.seed}-${t.shiftOddRows}`;case"CIMMarkerPlacementOnLine":return`${e}-${t.relativeTo}-${t.startPointOffset}`;case"CIMMarkerPlacementOnVertices":return`${e}-${t.placeOnControlPoints}-${t.placeOnEndPoints}-${t.placeOnRegularVertices}`;case"CIMMarkerPlacementPolygonCenter":return`${e}-${t.method}`;default:return`${e}`}}},49195:(t,e,s)=>{s.d(e,{A:()=>C});s(39831);var n=s(54185),i=s(7715),r=s(98849),o=s(539),a=s(85251),l=s(99776),h=s(37353),u=s(16528),c=s(60704),m=s(59646),d=s(21355),g=s(88443),p=s(55429),_=s(89423),f=s(41746);const y=(t,e,s,n)=>{let i=0;for(let r=1;r<s;r++){const s=t[2*(e+r-1)],n=t[2*(e+r-1)+1];i+=(t[2*(e+r)]-s)*(t[2*(e+r)+1]+n)}return n?i>0:i<0},x=({coords:t,lengths:e},s)=>{const n=[];for(let i=0,r=0;i<e.length;r+=e[i],i+=1){const o=r,a=[];for(;i<e.length-1&&y(t,r+e[i],e[i+1],s);i+=1,r+=e[i])a.push(r+e[i]-o);const l=t.slice(2*o,2*(r+e[i])),h=(0,u.e)(l,a,2);for(const t of h)n.push(t+o)}return n};class v{constructor(t,e,s,n=!1){this._cache={},this.vertices=t,this.indices=e,this.primitiveType=s,this.isMapSpace=n}static fromPath(t){const e=(0,d.eU)(new g.A,t.path,!1,!1),s=e.coords,n=new Uint32Array(x(e,!0)),i=new Uint32Array(s.length/2);for(let r=0;r<i.length;r++)i[r]=(0,p.M9)(Math.floor(s[2*r]),Math.floor(s[2*r+1]));return new v({geometry:i},n,f.WR.TRIANGLES)}static fromGeometry(t,e){const s=e.geometry?.type;switch(s){case"polygon":return v.fromPolygon(t,e.geometry);case"extent":return v.fromMapExtent(t,e.geometry);default:return o.A.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new r.A("mapview-bad-type",`Unable to create a mesh from type ${s}`,e)),v.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}static fromPolygon(t,e){const s=(0,d.Ye)(new g.A,e,!1,!1),n=s.coords,i=new Uint32Array(x(s,!1)),r=new Uint32Array(n.length/2),o=(0,m.vt)(),a=(0,m.vt)();for(let l=0;l<r.length;l++)(0,c.hZ)(o,n[2*l],n[2*l+1]),t.toScreen(a,o),r[l]=(0,p.M9)(Math.floor(a[0]),Math.floor(a[1]));return new v({geometry:r},i,f.WR.TRIANGLES,!0)}static fromScreenExtent({xmin:t,xmax:e,ymin:s,ymax:n}){const i={geometry:new Uint32Array([(0,p.M9)(t,s),(0,p.M9)(e,s),(0,p.M9)(t,n),(0,p.M9)(t,n),(0,p.M9)(e,s),(0,p.M9)(e,n)])},r=new Uint32Array([0,1,2,3,4,5]);return new v(i,r,f.WR.TRIANGLES)}static fromMapExtent(t,e){const[s,n]=t.toScreen([0,0],[e.xmin,e.ymin]),[i,r]=t.toScreen([0,0],[e.xmax,e.ymax]),o={geometry:new Uint32Array([(0,p.M9)(s,n),(0,p.M9)(i,n),(0,p.M9)(s,r),(0,p.M9)(s,r),(0,p.M9)(i,n),(0,p.M9)(i,r)])},a=new Uint32Array([0,1,2,3,4,5]);return new v(o,a,f.WR.TRIANGLES)}destroy(){null!=this._cache.indexBuffer&&this._cache.indexBuffer.dispose(),this._cache.vertexBuffers?.forEach((t=>t?.dispose())),this._cache.indexBuffer=this._cache.vertexBuffers=null}getIndexBuffer(t,e=f._U.STATIC_DRAW){return this._cache.indexBuffer??=_.g.createIndex(t,e,this.indices),this._cache.indexBuffer}getVertexBuffers(t,e=f._U.STATIC_DRAW){return this._cache.vertexBuffers??=new Map(Object.keys(this.vertices).reduce(((s,n)=>(s.push([n,_.g.createVertex(t,e,this.vertices[n])]),s)),new Array)),this._cache.vertexBuffers}}var b=s(6166),P=s(80976);class S extends h.q{constructor(t,e){super(),this._clip=e,this._cache={},this.stage=t,this._handle=(0,a.wB)((()=>e.version),(()=>this._invalidate())),this.ready()}static fromClipArea(t,e){return new S(t,e)}_destroyGL(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),this._cache.mesh=null),null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(t,e,s,n){const[i,r]=e.size;if("geometry"!==this._clip.type&&this._lastWidth===i&&this._lastHeight===r||(this._lastWidth=i,this._lastHeight=r,this._destroyGL()),null==this._cache.vao){const i=this._createMesh(e,this._clip),r=i.getIndexBuffer(t),o=i.getVertexBuffers(t);this._cache.mesh=i,this._cache.vao=new P.Z(t,s,n,o,r)}return this._cache.vao}_createTransforms(){return{displayViewScreenMat3:(0,l.vt)()}}_invalidate(){this._destroyGL(),this.requestRender()}_createMesh(t,e){switch(e.type){case"rect":return v.fromScreenExtent((0,b.p)(e,t.size[0],t.size[1]));case"path":return v.fromPath(e);case"geometry":return v.fromGeometry(t,e);default:return o.A.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new r.A("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),v.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}}var E=s(79432);class C extends i.m{set clips(t){super.clips=t,this._updateClippingInfo(t)}renderChildren(t){t.painter.setPipelineState(null),null==this._renderPasses&&(this._renderPasses=this.prepareRenderPasses(t.painter));for(const s of this._renderPasses)try{s.render(t)}catch(e){}}prepareRenderPasses(t){return[t.registerRenderPass({name:"clip",brushes:[n.d.clip],target:()=>this._clippingInfos,drawPhase:E.S5.MAP|E.S5.LABEL|E.S5.LABEL_ALPHA|E.S5.DEBUG|E.S5.HIGHLIGHT})]}_updateClippingInfo(t){null!=this._clippingInfos&&(this._clippingInfos.forEach((t=>t.destroy())),this._clippingInfos=null),null!=t&&t.length&&(this._clippingInfos=t.items.map((t=>S.fromClipArea(this.stage,t)))),this.requestRender()}}},22610:(t,e,s)=>{s.d(e,{Dy:()=>c,UD:()=>l,fO:()=>h,gy:()=>o,iT:()=>u,xy:()=>a});var n=s(539);const i=()=>n.A.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var r,o;function a(t){if(!t)return r.Center;switch(t){case"Left":case"left":return r.Left;case"Right":case"right":return r.Right;case"Justify":return i().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),r.Center;case"Center":case"center":return r.Center}}function l(t){if(!t)return o.Center;switch(t){case"Top":case"top":return o.Top;case"Center":case"middle":return o.Center;case"Baseline":case"baseline":return o.Baseline;case"Bottom":case"bottom":return o.Bottom}}function h(t){switch(t){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return["center","bottom"];case"above-right":case"esriServerPointLabelPlacementAboveRight":return["left","bottom"];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return["right","middle"];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];case"center-right":case"esriServerPointLabelPlacementCenterRight":return["left","middle"];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return["right","top"];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return["center","top"];case"below-right":case"esriServerPointLabelPlacementBelowRight":return["left","top"];default:return console.debug(`Found invalid placement type ${t}`),["center","middle"]}}function u(t){switch(t){case r.Right:case"right":return-1;case r.Center:case"center":return 0;case r.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function c(t){switch(t){case o.Top:case"top":return 1;case o.Center:case"middle":return 0;case o.Bottom:case o.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}!function(t){t[t.Left=-1]="Left",t[t.Center=0]="Center",t[t.Right=1]="Right"}(r||(r={})),function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(o||(o={}))},95031:(t,e,s)=>{s.d(e,{A:()=>n});class n{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(t,e){}draw(t,e,s){}drawMany(t,e,s){for(const n of e)n.visible&&this.draw(t,n,s)}}},46419:(t,e,s)=>{s.d(e,{A:()=>c});var n=s(40275),i=s(7370),r=s(95031),o=s(97394),a=s(89423),l=s(41746),h=s(50122),u=s(80976);class c extends r.A{constructor(){super(...arguments),this._color=(0,n.fA)(1,0,0,1),this._initialized=!1}dispose(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null),this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)}prepareState({context:t}){t.setDepthWriteEnabled(!1),t.setDepthTestEnabled(!1),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!1),t.setStencilOp(l.eA.KEEP,l.eA.KEEP,l.eA.REPLACE),t.setStencilWriteMask(255)}draw(t,e){const{context:s,requestRender:n,allowDelayedRender:i}=t;this._initialized||this._initialize(s),!i||null==n||this._solidProgram.compiled?(s.setStencilFunctionSeparate(l.Y7.FRONT_AND_BACK,l.MT.GREATER,e.stencilRef,255),s.bindVAO(this._solidVertexArrayObject),s.useProgram(this._solidProgram),this._solidProgram.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),this._solidProgram.setUniform2fv("u_coord_range",[e.rangeX,e.rangeY]),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),s.drawArrays(l.WR.TRIANGLE_STRIP,0,4),s.bindVAO()):n()}_initialize(t){if(this._initialized)return!0;const e=(0,h.r)(t,o.T);if(!e)return!1;const s=new Int8Array([0,0,1,0,0,1,1,1]),n=a.g.createVertex(t,l._U.STATIC_DRAW,s),r=new u.Z(t,o.T.attributes,i.Pd,new Map([["geometry",n]]));return this._solidProgram=e,this._solidVertexArrayObject=r,this._initialized=!0,!0}}},29588:(t,e,s)=>{s.d(e,{A:()=>_});var n=s(40275),i=s(7370),r=s(90819),o=s(95031),a=s(97394),l=s(13294),h=s(89423),u=s(41746),c=s(50122),m=s(8595),d=s(45758),g=s(80976);const p=16;class _ extends o.A{constructor(){super(...arguments),this._color=(0,n.fA)(1,0,0,1)}dispose(){this._outlineProgram?.dispose(),this._outlineProgram=null,this._tileInfoProgram?.dispose(),this._tileInfoProgram=null,this._outlineVertexArrayObject?.dispose(),this._outlineVertexArrayObject=null,this._tileInfoVertexArrayObject?.dispose(),this._tileInfoVertexArrayObject=null,this._ctx=null}prepareState({context:t}){t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(u.dn.ONE,u.dn.ONE_MINUS_SRC_ALPHA,u.dn.ONE,u.dn.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1)}draw(t,e){const{context:s,requestRender:n,allowDelayedRender:i}=t;if(!e.isReady&&e instanceof r.R&&e.hasData)return;if(this._loadWGLResources(s),i&&null!=n&&(!this._outlineProgram.compiled||!this._tileInfoProgram.compiled))return void n();s.bindVAO(this._outlineVertexArrayObject),s.useProgram(this._outlineProgram),this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),this._outlineProgram.setUniform2f("u_coord_range",e.rangeX,e.rangeY),this._outlineProgram.setUniform1f("u_depth",0),this._outlineProgram.setUniform4fv("u_color",this._color),s.drawArrays(u.WR.LINE_STRIP,0,4);const o=this._getTexture(s,e);o?(s.bindVAO(this._tileInfoVertexArrayObject),s.useProgram(this._tileInfoProgram),s.bindTexture(o,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",e.rangeX/e.width,e.rangeY/e.height),this._tileInfoProgram.setUniform2f("u_delta",0,0),this._tileInfoProgram.setUniform2f("u_dimensions",o.descriptor.width,o.descriptor.height),s.drawArrays(u.WR.TRIANGLE_STRIP,0,4),s.bindVAO()):s.bindVAO()}_loadWGLResources(t){if(this._outlineProgram&&this._tileInfoProgram)return;const e=(0,c.r)(t,a.T),s=(0,c.r)(t,l.H),n=new Int8Array([0,0,1,0,1,1,0,1]),r=h.g.createVertex(t,u._U.STATIC_DRAW,n),o=new g.Z(t,a.T.attributes,i.Pd,new Map([["geometry",r]])),m=new Int8Array([0,0,1,0,0,1,1,1]),d=h.g.createVertex(t,u._U.STATIC_DRAW,m),p=new g.Z(t,l.H.attributes,i.Pd,new Map([["geometry",d]]));this._outlineProgram=e,this._tileInfoProgram=s,this._outlineVertexArrayObject=o,this._tileInfoVertexArrayObject=p}_getTexture(t,e){if(!this._ctx){const t=document.createElement("canvas");t.width=512,t.height=512,this._ctx=t.getContext("2d")}if(!e.tileDebugInfoTexture){const s=new d.R;s.wrapMode=u.pF.CLAMP_TO_EDGE,s.samplingMode=u.Cj.LINEAR,s.isImmutable=!0,s.width=512,s.height=512,e.tileDebugInfoTexture=new m.g(t,s)}const s=this._ctx;s.clearRect(0,0,s.canvas.width,s.canvas.height),s.textAlign="left",s.textBaseline="top",s.font="14px sans-serif",s.lineWidth=2,s.fillStyle="white",s.strokeStyle="black";const{debugSlot:n}=e;let i=8+99.2*n;const r=`${n}) ${e.key.id} (${e.constructor.name})`;s.strokeText(r,8,i),s.fillText(r,8,i),i+=p;const{debugInfo:o}=e;if(o){const{length:t,minOrderedLength:e,minUnorderedLength:n,triangleCount:r}=o.display;if(t>0){const e=`Length: ${t}`;s.strokeText(e,8,i),s.fillText(e,8,i),i+=p}if(e){const t=`Min ordered length: ${e}`;s.strokeText(t,8,i),s.fillText(t,8,i),i+=p}if(n){const t=`Min unordered length: ${n}`;s.strokeText(t,8,i),s.fillText(t,8,i),i+=p}if(r>0){r>1e5&&(s.fillStyle="red",s.strokeStyle="white");const t=`Triangle count: ${r}`;s.strokeText(t,8,i),s.fillText(t,8,i),i+=p}const{bytesUsed:a,bytesReserved:l}=o.memory;if(s.fillStyle="white",s.strokeStyle="black",a>0||l>0){const t=`Memory usage: ${a} of ${l} bytes`;s.strokeText(t,8,i),s.fillText(t,8,i),i+=p}}return e.tileDebugInfoTexture.setData(s.canvas),e.tileDebugInfoTexture}}},1339:(t,e,s)=>{s.d(e,{A:()=>i});var n=s(17845);class i{constructor(t,e,s,i){this.transformedX=0,this.transformedY=0,this.center=(0,n.fA)(t,e),this.centerT=(0,n.vt)(),this.halfWidth=s/2,this.halfHeight=i/2,this.width=s,this.height=i}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(t){this.center[0]=t}set y(t){this.center[1]=t}clone(){return new i(this.x,this.y,this.width,this.height)}serialize(t){return t.writeF32(this.center[0]),t.writeF32(this.center[1]),t.push(this.width),t.push(this.height),t}findCollisionDelta(t,e=4){const s=Math.abs(t.centerT[0]-this.centerT[0]),n=Math.abs(t.centerT[1]-this.centerT[1]),i=(t.halfWidth+this.halfWidth+e)/s,r=(t.halfHeight+this.halfHeight+e)/n,o=Math.min(i,r);return Math.log2(o)}extend(t){const e=Math.min(this.xmin,t.xmin),s=Math.min(this.ymin,t.ymin),n=Math.max(this.xmax,t.xmax)-e,i=Math.max(this.ymax,t.ymax)-s,r=e+n/2,o=s+i/2;this.width=n,this.height=i,this.halfWidth=n/2,this.halfHeight=i/2,this.x=r,this.y=o}static deserialize(t){const e=t.readF32(),s=t.readF32(),n=t.readInt32(),r=t.readInt32();return new i(e,s,n,r)}}},51688:(t,e,s)=>{s.d(e,{f:()=>a});var n=s(43556),i=s(79432),r=s(1339),o=s(1314);class a{constructor(t,e,s,n,i,r,o,a,l,h,u=[],c=0,m=0){this.displayId=t,this.labelClassId=e,this.hash=s,this.anchorX=n,this.anchorY=i,this.directionX=r,this.directionY=o,this.maxScale=a,this.minScale=l,this.referenceBounds=h,this.bounds=u,this.recordStart=c,this.recordCount=m,this.priority=0,this._colliders=null,this.uniqueSymbol=null,this.selectedForRendering=!1}get xTile(){return this.anchorX}get yTile(){return this.anchorY}colliders(t){if(!this._colliders){const e=t.attributeView,s=n.C2;let r=this.referenceBounds?.size??0;const o=t.layerView.labelingCollisionInfos[0].vvEvaluators[0];if(null!=o){const t=o(e.getVisualVariableData(this.displayId,i.Gn.SIZE));r=isNaN(t)||null==t||t===1/0?r:t}const a=this.minScale?t.layerView.view.featuresTilingScheme.scaleToZoom(this.minScale):0,l=this.maxScale?t.layerView.view.featuresTilingScheme.scaleToZoom(this.maxScale):25,h=this.directionX*(s+r/2),u=this.directionY*(s+r/2);this._colliders=this.bounds.map((t=>({xTile:this.anchorX,yTile:this.anchorY,dxPixels:t.x-t.halfWidth+h,dyPixels:t.y-t.halfHeight+u,hard:!0,partIndex:1,width:t.width+2,height:t.height+2,angle:0,xScreen:0,yScreen:0,dxScreen:0,dyScreen:0,enabled:!0,minLod:a,maxLod:l})))}return this._colliders}get id(){return this.displayId}serialize(t){t.push(this.displayId),t.push(this.labelClassId),t.push(this.hash),t.push(this.recordStart),t.push(this.recordCount),t.writeF32(this.anchorX),t.writeF32(this.anchorY),t.writeF32(this.directionX),t.writeF32(this.directionY),t.writeF32(this.maxScale),t.writeF32(this.minScale),this.referenceBounds?(t.writeF32(this.referenceBounds.size),t.writeF32(this.referenceBounds.offsetX),t.writeF32(this.referenceBounds.offsetY)):(t.writeF32(0),t.writeF32(0),t.writeF32(0)),(0,o.j)(t,this.bounds)}static deserialize(t){const e=t.readInt32(),s=t.readInt32(),n=t.readInt32(),i=t.readInt32(),l=t.readInt32(),h=t.readF32(),u=t.readF32(),c=t.readF32(),m=t.readF32(),d=t.readF32(),g=t.readF32(),p=t.readF32(),_=t.readF32(),f=t.readF32(),y=(0,o._)(t,r.A)??[];return new a(e,s,n,h,u,c,m,d,g,{size:p,offsetX:_,offsetY:f},y,i,l)}}},93540:(t,e,s)=>{s.d(e,{B:()=>n,P:()=>i});class n{constructor(t){if(this.next=null,!Array.isArray(t))return void(this.data=t);this.data=t[0];let e=this;for(let s=1;s<t.length;s++)e.next=new n([t[s]]),e=e.next}*values(){let t=this;for(;t;)yield t.data,t=t.next}forEach(t){let e=this;for(;e;)t(e.data),e=e.next}get last(){return this.next?this.next.last:this}}class i{constructor(t){this._head=null,null!=t&&(this._head=new n(t))}get head(){return this._head}maxAvailableSpace(){if(null==this._head)return 0;let t=0;return this._head.forEach((e=>{const s=e.end-e.start;t=Math.max(t,s)})),t}firstFit(t){if(null==this._head)return null;let e=null,s=this._head;for(;s;){const n=s.data.end-s.data.start;if(n===t)return e?e.next=s.next:this._head=s.next,s.data.start;if(n>t){const e=s.data.start;return s.data.start+=t,e}e=s,s=s.next}return null}free(t,e){const s=t+e;if(null==this._head){const e=new n({start:t,end:s});return void(this._head=e)}if(s<=this._head.data.start){if(s===this._head.data.start)return void(this._head.data.start-=e);const i=new n({start:t,end:s});return i.next=this._head,void(this._head=i)}let i=this._head,r=i.next;for(;r;){if(r.data.start>=s){if(i.data.end===t){if(i.data.end+=e,i.data.end===r.data.start){const t=r.data.end-r.data.start;return i.data.end+=t,void(i.next=r.next)}return}if(r.data.start===s)return void(r.data.start-=e);const o=new n({start:t,end:s});return o.next=i.next,void(i.next=o)}i=r,r=r.next}if(t===i.data.end)return void(i.data.end+=e);const o=new n({start:t,end:s});i.next=o}clear(){this._head=null}}},56670:(t,e,s)=>{s.d(e,{X:()=>f});var n=s(6267),i=s(55429),r=(s(39831),s(49357)),o=s(93540),a=s(89423),l=s(41746);class h{constructor(t,e,s,n){this._pool=n;const i=r.W.create(e*s*Uint32Array.BYTES_PER_ELEMENT,this._pool);this.size=e,this.strideInt=s,this.bufferType=t,this.dirty={start:1/0,end:0},this.memoryStats={bytesUsed:0,bytesReserved:e*s*Uint32Array.BYTES_PER_ELEMENT},this._gpu=null,this._cpu=i,this.clear()}get elementSize(){return this._cpu.length/this.strideInt}get intSize(){return this.fillPointer*this.strideInt}get byteSize(){return this.intSize*Uint32Array.BYTES_PER_ELEMENT}get invalidated(){return this.bufferSize>0&&!this._gpu}get invalidatedComputeBuffer(){return this.bufferSize>0&&!this._gpuComputeTriangles}invalidate(){this._invalidateTriangleBuffer(),this._gpu?.dispose(),this._gpu=null}_invalidateTriangleBuffer(){this._gpuComputeTriangles?.dispose(),this._gpuComputeTriangles=null}destroy(){this._gpu?.dispose(),this._gpuComputeTriangles?.dispose(),this._cpu?.destroy()}clear(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new o.P({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}ensure(t){if(!(this.maxAvailableSpace()>=t)&&t*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const e=this._cpu.length/this.strideInt,s=Math.round(1.25*(e+t)),n=s*this.strideInt;this._cpu.expand(n*Uint32Array.BYTES_PER_ELEMENT),this.freeList.free(e,s-e),this.memoryStats.bytesReserved+=(s-e)*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}}setU32(t,e){this._cpu.array[t]!==e&&(this._cpu.array[t]=e,this.dirty.start=Math.min(t,this.dirty.start),this.dirty.end=Math.max(t+1,this.dirty.end))}setF32(t,e){this.setU32(t,(0,i.jT)(e))}setF32Range(t,e,s){const n=(0,i.jT)(s);this._cpu.array.fill(n,t,e),this.dirty.start=Math.min(t,this.dirty.start),this.dirty.end=Math.max(e,this.dirty.end)}getF32(t){return(0,i.fG)(this._cpu.array[t])}getGPUBuffer(t,e=!1){if(!this.bufferSize)return null;if(e){if("index"!==this.bufferType)throw new Error("Tired to get triangle buffer, but target is not an index buffer");return null==this._gpuComputeTriangles&&(this._gpuComputeTriangles=this._createComputeBuffer(t)),this._gpuComputeTriangles}return null==this._gpu&&(this._gpu=this._createBuffer(t)),this._gpu}getView(t,e){return this._cpu.getUint32View(t,e/Uint32Array.BYTES_PER_ELEMENT)}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(t,e,s,i){const r=s*this.strideInt;if(!r)return 0;const o=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a=new Uint32Array(t,o,r),l=this.freeList.firstFit(s);(0,n.Lw)(l,"First fit region must be defined");const h=l*this.strideInt,u=r;if(this._cpu.array.set(a,h),0!==i)for(let n=0;n<a.length;n++)this._cpu.array[n+h]+=i;return this.dirty.start=Math.min(this.dirty.start,h),this.dirty.end=Math.max(this.dirty.end,h+u),this.fillPointer=Math.max(this.fillPointer,h+u),this.memoryStats.bytesUsed+=s*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,l}copyFrom(t,e,s,i,r){const o=s*this.strideInt;if(!o)return 0;const a=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,l=t._cpu.getUint32View(a,o),h=this.freeList.firstFit(s);(0,n.Lw)(h,"First fit region must be defined");const u=h*this.strideInt,c=o;if(this._cpu.array.set(l,u),0!==i)for(let n=0;n<o;n++)this._cpu.array[u+n*this.strideInt+r]+=i;return this.dirty.start=Math.min(this.dirty.start,u),this.dirty.end=Math.max(this.dirty.end,u+c),this.fillPointer=Math.max(this.fillPointer,u+c),this.memoryStats.bytesUsed+=s*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,h}free(t,e,s){const n=t*this.strideInt,i=(t+e)*this.strideInt;if(!0===s)for(let r=t;r!==t+e;r++)this._cpu.array[r*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,n),this.dirty.end=Math.max(this.dirty.end,i),this.freeList.free(t,e),this.memoryStats.bytesUsed-=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}upload(){if(this.dirty.end){if(this._invalidateTriangleBuffer(),null==this._gpu)return this.dirty.start=1/0,void(this.dirty.end=0);this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}reshuffle(t,e){if(0===e.length)return;const s=this.byteSize,n=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,i=s>n,o=this._cpu,a=r.W.create(n,this._pool);i||a.array.set(this._cpu.getUint32View(0,this.intSize));for(const r of e)if(i||r.srcFrom!==r.dstFrom||0!==r.mutate){this.dirty.start=Math.min(this.dirty.start,r.dstFrom*this.strideInt),this.dirty.end=Math.max(this.dirty.end,(r.dstFrom+r.count)*this.strideInt);for(let t=0;t<r.count;t++){const e=(r.dstFrom+t)*this.strideInt,s=(r.srcFrom+t)*this.strideInt;for(let t=0;t<this.strideInt;t++)a.array[e+t]=o.array[s+t]+r.mutate}}this._cpu.destroy(),this._cpu=a,i&&this.invalidate(),this.freeList.clear(),this.memoryStats.bytesUsed=this.memoryStats.bytesReserved=n}_createBuffer(t){const e=l._U.DYNAMIC_DRAW;return"index"===this.bufferType?a.g.createIndex(t,e,this._cpu.array):a.g.createVertex(t,e,this._cpu.array)}_createComputeBuffer(t){const e=l._U.DYNAMIC_DRAW,s=new Uint32Array(this.fillPointer/3);for(let n=0;n<this.fillPointer;n+=3)s[n/3]=this._cpu.array[n];return a.g.createIndex(t,e,s)}}var u=s(17906),c=s(12453),m=s(80976);const d=1e3,g=[{name:"visibility",offset:0,type:l.pe.FLOAT,count:1}],p={hash:(0,c.hU)(g),attributes:g,stride:4};function _(t,e){const s=t.attributes.filter((t=>e.locations.has(t.name))).map((e=>({name:e.name,type:e.type,count:e.count,divisor:0,normalized:e.normalized??!1,offset:e.offset,stride:t.stride})));return new Map([["geometry",s]])}class f{constructor(t,e,s){if(this._bufferPool=t,this._layout=e,this.useVisibility=s,this._invalidatedGeometry=!1,this._invalidatedCompute=!1,this._position=this._layout.attributes.find((t=>"pos"===t.name||"position"===t.name)),!this._position)throw new Error("InternalError: Unable to find position attribute")}destroy(){this._indexBuffer=(0,n.pR)(this._indexBuffer),this._vertexBuffer=(0,n.pR)(this._vertexBuffer),this._visibilityBuffer=(0,n.pR)(this._visibilityBuffer),this._computeVAO?.disposeVAOOnly(),this._geometryVAO?.disposeVAOOnly()}get layout(){return this._layout}getDrawArgs(t,e,s,n){return n?{primitive:l.WR.POINTS,count:e/3,offset:s/3}:{primitive:t,count:e,offset:s}}getAttributePrecisionPackFactors(){const t={};for(const e of this.layout.attributes)e.packPrecisionFactor&&(t[e.name]=e.packPrecisionFactor);return t}getDebugVertexInfo(t=!1,e){if(!this._vertexBuffer)return null;const s=this._layout,n=s.stride,i=this._vertexBuffer.getView(0,this._vertexBuffer.byteSize),r=[];if(t)if(null==e)console.log("must provide location info to see compute attributes");else for(const u of s.attributes){const t=e.computeAttributeMap[u.name];null!=t&&2===t.length&&(r.push({...u,name:t[0],offset:u.offset+n}),r.push({...u,name:t[1],offset:u.offset+2*n}))}const o=new DataView(i.slice().buffer);let a=i.byteLength/n;t&&(a=this._indexBuffer.fillPointer/3);const l=this._indexBuffer.getView(0,this._indexBuffer.byteSize);let h=0;const c=[];for(let m=0;m<a;m++){t&&(h=l[3*m]*n);const e={};for(const t of[...s.attributes,...r]){let s=`${t.offset} ${t.name}`,n=(0,u.q)(o,t,h);if(t.packPrecisionFactor)if(s+=` (precision: ${t.packPrecisionFactor})`,"number"==typeof n)n/=t.packPrecisionFactor;else for(let e=0;e<n.length;e++)n[e]/=t.packPrecisionFactor;e[s]=n}h+=n,c.push(e)}return{vertices:c,layout:s}}_ensure(t,e){if(this._vertexBuffer&&this._indexBuffer)this._indexBuffer.ensure(Math.max(t,d)),this._vertexBuffer.ensure(Math.max(e,d)),this._visibilityBuffer&&this._visibilityBuffer.ensure(Math.max(e,d));else{const s=this._layout.stride/Uint32Array.BYTES_PER_ELEMENT;this._indexBuffer=new h("index",Math.max(t,d),1,this._bufferPool),this._vertexBuffer=new h("vertex",Math.max(e,d),s,this._bufferPool),this.useVisibility&&(this._visibilityBuffer=new h("vertex",Math.max(e,d),4/Uint32Array.BYTES_PER_ELEMENT,this._bufferPool))}}append(t){const e=t.layout.stride,s=t.indices.byteLength/Uint32Array.BYTES_PER_ELEMENT,n=t.vertices.byteLength/e;this._ensure(s,n);const{vertices:i,indices:r}=t,o=this._vertexBuffer.insert(i,0,i.byteLength/e,0),a=new Uint32Array(n);return new Float32Array(a.buffer).fill(255),this._visibilityBuffer&&this._visibilityBuffer.insert(a,0,a.byteLength/4,0),{vertexFrom:o,indexFrom:this._indexBuffer.insert(r,0,r.byteLength/4,o)}}setEntityRecordRangeVisibility(t,e,s,n){for(let i=e;i<e+s;i++){const{vertexStart:e,vertexCount:s}=t[i];this._visibilityBuffer.setF32Range(e,e+s,n)}}getEntityRecordVisibility(t,e){const s=t.records[e];return this._visibilityBuffer.getF32(s.vertexStart)}copyRecordFrom(t,e,s,n){const{indexStart:r,indexCount:o,vertexStart:a,vertexCount:l}=e;this._ensure(o,l);const h=t._position,u=s*(h.packPrecisionFactor??1),c=n*(h.packPrecisionFactor??1),m=h.offset,d=(0,i.M9)(u,c),g=this._vertexBuffer.copyFrom(t._vertexBuffer,a,l,d,m);this._visibilityBuffer&&t._visibilityBuffer&&this._visibilityBuffer.copyFrom(t._visibilityBuffer,a,l,0,0);const p=this._indexBuffer.copyFrom(t._indexBuffer,r,o,g-a,0),_=e.clone();return _.vertexStart=g,_.indexStart=p,_.overlaps=0,_}remove(t,e,s,n){this._indexBuffer.free(t,e),this._vertexBuffer.free(s,n),this._visibilityBuffer&&this._visibilityBuffer.free(s,n)}upload(){this._invalidatedGeometry=!0,this._invalidatedCompute=!0}getGeometryVAO(t,e){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedGeometry){(this._vertexBuffer.invalidated||this._indexBuffer.invalidated||this._visibilityBuffer?.invalidated)&&(this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._visibilityBuffer&&this._visibilityBuffer.invalidate(),this._geometryVAO?.disposeVAOOnly(),this._geometryVAO=null),this._vertexBuffer.upload(),this._indexBuffer.upload(),this._visibilityBuffer&&this._visibilityBuffer.upload();const s=this._indexBuffer.getGPUBuffer(t,!1),n=new Map([["geometry",this._vertexBuffer.getGPUBuffer(t)]]);if(this._visibilityBuffer&&n.set("visibility",this._visibilityBuffer.getGPUBuffer(t)),!this._geometryVAO){const i=_(this.layout,e);i.set("visibility",_(p,e).get("geometry")),this._geometryVAO=new m.Z(t,e.locations,i,n,s)}this._invalidatedGeometry=!1}return this._geometryVAO}getComputeVAO(t,e){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedCompute){(this._vertexBuffer.invalidated||this._indexBuffer.invalidatedComputeBuffer)&&(this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._visibilityBuffer&&this._visibilityBuffer.invalidate(),this._computeVAO?.disposeVAOOnly(),this._computeVAO=null),this._vertexBuffer.upload(),this._indexBuffer.upload(),this._visibilityBuffer&&this._visibilityBuffer.upload();const s=this._indexBuffer.getGPUBuffer(t,!0),n=new Map([["geometry",this._vertexBuffer.getGPUBuffer(t)]]);if(this._visibilityBuffer&&n.set("visibility",this._visibilityBuffer.getGPUBuffer(t)),!this._computeVAO){const i=function(t,e){const s=[],n=t.attributes.filter((t=>e.locations.has(t.name)));for(const i of n){s.push({name:i.name,type:i.type,count:i.count,divisor:0,normalized:i.normalized??!1,offset:i.offset,stride:t.stride});const n=e.computeAttributeMap[i.name];null!=n&&2===n.length&&(s.push({name:n[0],count:i.count,divisor:0,type:i.type,normalized:i.normalized??!1,offset:i.offset+t.stride,stride:t.stride}),s.push({name:n[1],count:i.count,divisor:0,type:i.type,normalized:i.normalized??!1,offset:i.offset+2*t.stride,stride:t.stride}))}return new Map([["geometry",s]])}(this.layout,e);i.set("visibility",_(p,e).get("geometry")),this._computeVAO=new m.Z(t,e.locations,i,n,s),this._invalidatedCompute=!1}}return this._computeVAO}get memoryStats(){return{bytesUsed:this._vertexBuffer.memoryStats.bytesUsed+this._indexBuffer.memoryStats.bytesUsed,bytesReserved:this._vertexBuffer.memoryStats.bytesReserved+this._indexBuffer.memoryStats.bytesReserved,vertex:this._vertexBuffer.memoryStats,index:this._indexBuffer.memoryStats}}reshuffle(t){this._vertexBuffer&&this._vertexBuffer.reshuffle(t.vertex.count,t.vertex.operations),this._indexBuffer&&this._indexBuffer.reshuffle(t.index.count,t.index.operations),this._visibilityBuffer&&this._visibilityBuffer.reshuffle(t.vertex.count,t.vertex.operations)}}},71474:(t,e,s)=>{s.d(e,{Nd:()=>m,Wk:()=>c,Zy:()=>d});var n=s(43556);function i(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t}function r(t,e){return Math.sqrt(t*t+e*e)}function o(t){const e=r(t[0],t[1]);t[0]/=e,t[1]/=e}function a(t,e){return r(t[0]-e[0],t[1]-e[1])}function l(t){return t.length-1}function h(t){let e=0;for(let s=0;s<l(t);s++)e+=u(t,s);return e}function u(t,e,s=1){let[n,i]=function(t,e){return t[e+1]}(t,e);return[n,i]=[Math.round(n),Math.round(i)],Math.sqrt(n*n+i*i)*s}class c{constructor(t,e,s,n,i){this._segments=t,this._index=e,this._distance=s,this._xStart=n,this._yStart=i,this._done=!1}static create(t){return new c(t,0,0,t[0][0],t[0][1])}clone(){return new c(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(t){return this._index===t._index||t._index===this._index-1&&(0===this._distance||1===t._distance)||t._index===this._index+1&&(1===this._distance||0===t._distance)}leq(t){return this._index<t._index||this._index===t._index&&this._distance<=t._distance}geq(t){return this._index>t._index||this._index===t._index&&this._distance>=t._distance}get _segment(){return this._segments[this._index+1]}get angle(){const t=this.dy,e=(0*t+-1*-this.dx)/(1*this.length);let s=Math.acos(e);return t>0&&(s=2*Math.PI-s),s}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:t,dy:e}=this;return Math.sqrt(t*t+e*e)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<l(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(t,e){const s=this.backwardLength;if(t<=s)return this._distance=(s-t)/this.length,this;let n=this.backwardLength;for(;this.prev();){if(n+this.length>t)return this._seekBackwards(t-n);n+=this.length}return this._distance=0,e?this:null}seek(t,e=!1){if(t<0)return this._seekBackwards(Math.abs(t),e);if(t<=this.remainingLength)return this._distance=(this.backwardLength+t)/this.length,this;let s=this.remainingLength;for(;this.next();){if(s+this.length>t)return this.seek(t-s,e);s+=this.length}return this._distance=1,e?this:null}}function m(t,e,s,i=!0){const r=h(t),o=c.create(t),a=r/2;if(!i)return o.seek(a),void(o.x<n.CQ&&o.y<n.CQ&&o.x>=0&&o.y>=0&&s(o.clone(),0,a+0*e,r));const l=Math.max((r-e)/2,0),u=Math.floor(l/e),m=a-u*e;o.seek(m);for(let h=-u;h<=u;h++)o.x<n.CQ&&o.y<n.CQ&&o.x>=0&&o.y>=0&&s(o.clone(),h,a+h*e,r),o.seek(e)}function d(t,e){const s=e;for(let n=0;n<t.length;n++){let e=t[n];g(e,s);const i=[];i.push(e[0]);for(let t=1;t<e.length;t++){const[s,n]=e[t-1],[r,o]=e[t],a=r-s,l=o-n;i.push([a,l])}t[n]=i,e=i}return t}function g(t,e){const s=1e-6;if(e<=0)return;const n=t.length;if(n<3)return;const r=[];let l=0;r.push(0);for(let i=1;i<n;i++)l+=a(t[i],t[i-1]),r.push(l);e=Math.min(e,.2*l);const h=[];h.push(t[0][0]),h.push(t[0][1]);const u=t[n-1][0],c=t[n-1][1],m=i([0,0],t[0],t[1]);o(m),t[0][0]+=e*m[0],t[0][1]+=e*m[1],i(m,t[n-1],t[n-2]),o(m),t[n-1][0]+=e*m[0],t[n-1][1]+=e*m[1];for(let i=1;i<n;i++)r[i]+=e;r[n-1]+=e;const d=.5*e;for(let i=1;i<n-1;i++){let o=0,a=0,l=0;for(let n=i-1;n>=0&&!(r[n+1]<r[i]-d);n--){const h=d+r[n+1]-r[i],u=r[n+1]-r[n],c=r[i]-r[n]<d?1:h/u;if(Math.abs(c)<s)break;const m=c*c,g=c*h-.5*m*u,p=c*u/e,_=t[n+1],f=t[n][0]-_[0],y=t[n][1]-_[1];o+=p/g*(_[0]*c*h+.5*m*(h*f-u*_[0])-m*c*u*f/3),a+=p/g*(_[1]*c*h+.5*m*(h*y-u*_[1])-m*c*u*y/3),l+=p}for(let h=i+1;h<n&&!(r[h-1]>r[i]+d);h++){const n=d-r[h-1]+r[i],u=r[h]-r[h-1],c=r[h]-r[i]<d?1:n/u;if(Math.abs(c)<s)break;const m=c*c,g=c*n-.5*m*u,p=c*u/e,_=t[h-1],f=t[h][0]-_[0],y=t[h][1]-_[1];o+=p/g*(_[0]*c*n+.5*m*(n*f-u*_[0])-m*c*u*f/3),a+=p/g*(_[1]*c*n+.5*m*(n*y-u*_[1])-m*c*u*y/3),l+=p}h.push(o/l),h.push(a/l)}h.push(u),h.push(c);for(let i=0,o=0;i<n;i++)t[i][0]=h[o++],t[i][1]=h[o++]}},42695:(t,e,s)=>{s.d(e,{Tl:()=>P});var n=s(79190),i=s(78835),r=s(60704),o=s(17845),a=s(22610),l=s(60470),h=s(1339);const u=4,c=22+u,m=3,d=Math.PI/180;class g{constructor(t,e,s,n){this._rotationT=(0,i.vt)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const r=s.rect,o=new Float32Array(8);t*=n,e*=n;const a=s.code?r.width*n:s.metrics.width,l=s.code?r.height*n:s.metrics.height;this.width=a,this.height=l,o[0]=t,o[1]=e,o[2]=t+a,o[3]=e,o[4]=t,o[5]=e+l,o[6]=t+a,o[7]=e+l,this._data=o,this._setTextureCoords(r),this._scale=n,this._mosaic=s,this.x=t,this.y=e,this.maxOffset=Math.max(t+a,e+l)}get mosaic(){return this._mosaic}set angle(t){this._angle=t,(0,n.$0)(this._rotationT,-t),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:t,width:e}=this._mosaic.metrics,s=e*this._scale,r=Math.abs(t)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+s,o[3]=this.y,o[4]=this.x,o[5]=this.y+r,o[6]=this.x+s,o[7]=this.y+r;const a=(0,n.lw)((0,i.vt)(),this._rotationT,this._transform);(0,i.gb)(o,o,a);let l=1/0,u=1/0,c=-1/0,m=-1/0;for(let n=0;n<4;n++){const t=o[2*n],e=o[2*n+1];l=Math.min(l,t),u=Math.min(u,e),c=Math.max(c,t),m=Math.max(m,e)}const d=c-l,g=m-u,p=l+d/2,_=u+g/2;this._bounds=new h.A(p,_,d,g)}return this._bounds}setTransform(t){this._transform=t,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const t=(0,n.lw)((0,i.vt)(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],(0,r.l0)(this._offsets.topLeft,this._offsets.topLeft,t),(0,r.l0)(this._offsets.topRight,this._offsets.topRight,t),(0,r.l0)(this._offsets.bottomLeft,this._offsets.bottomLeft,t),(0,r.l0)(this._offsets.bottomRight,this._offsets.bottomRight,t)}_setTextureCoords({x:t,y:e,width:s,height:n}){this._texcoords={topLeft:[t,e],topRight:[t+s,e],bottomLeft:[t,e+n],bottomRight:[t+s,e+n]}}}const p=(t,e)=>({code:0,page:0,sdf:!0,rect:new l.A(0,0,11,8),textureBinding:e,metrics:{advance:0,height:4,width:t,left:0,top:0}});function _(t,e){return t.forEach((t=>(0,r.l0)(t,t,e))),{topLeft:t[0],topRight:t[1],bottomLeft:t[2],bottomRight:t[3]}}class f{constructor(t,e,s){this._rotation=0,this._decorate(t,e,s),this.glyphs=t,this.bounds=this._createBounds(t),this.isMultiline=e.length>1,this._hasRotation=0!==s.angle,this._transform=this._createGlyphTransform(this.bounds,s),this._borderLineSizePx=s.borderLineSizePx,(s.borderLineSizePx||s.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(const n of t)n.setTransform(this._transform)}setRotation(t){if(0===t&&0===this._rotation)return;this._rotation=t;const e=this._transform,s=(0,n.$0)((0,i.vt)(),t);(0,n.lw)(e,s,e);for(const n of this.glyphs)n.setTransform(this._transform)}_decorate(t,e,s){if(!s.decoration||"none"===s.decoration||!t.length)return;const n=s.scale,i="underline"===s.decoration?c:16,r=t[0].textureBinding;for(const o of e){const e=o.startX*n,s=o.startY*n,a=(o.width+o.glyphWidthEnd)*n;t.push(new g(e,s+i*n,p(a,r),1))}}shapeBackground(t){const e=(1.5+(this._borderLineSizePx||0))/2,s=this._borderLineSizePx?e:0,{xmin:n,ymin:i,xmax:r,ymax:o,x:a,y:l,width:u,height:c}=this.bounds,m=[n-8,i-8],d=[r+8,i-8],g=[n-8,o+8],p=[r+8,o+8],f=_([[m[0]-e,m[1]-e],[d[0]+e,d[1]-e],[m[0]+s,m[1]+s],[d[0]-s,d[1]+s]],t),y=_([[g[0]+s,g[1]-s],[p[0]-s,p[1]-s],[g[0]-e,g[1]+e],[p[0]+e,p[1]+e]],t),x=_([[m[0]-e,m[1]-e],[m[0]+s,m[1]+s],[g[0]-e,g[1]+e],[g[0]+s,g[1]-s]],t),v=_([[d[0]-s,d[1]+s],[d[0]+e,d[1]-e],[p[0]-s,p[1]-s],[p[0]+e,p[1]+e]],t),b={main:_([m,d,g,p],t),top:f,bot:y,left:x,right:v};return[new h.A(a,l,u+2*e,c+2*e),b]}get boundsT(){const t=this.bounds,e=(0,r.hZ)((0,o.vt)(),t.x,t.y);if((0,r.l0)(e,e,this._transform),this._hasRotation){const s=Math.max(t.width,t.height);return new h.A(e[0],e[1],s,s)}return new h.A(e[0],e[1],t.width,t.height)}_createBounds(t){let e=1/0,s=1/0,n=0,i=0;for(const a of t)e=Math.min(e,a.xTopLeft),s=Math.min(s,a.yTopLeft),n=Math.max(n,a.xBottomRight),i=Math.max(i,a.yBottomRight);const r=n-e,o=i-s;return new h.A(e+r/2,s+o/2,r,o)}_createGlyphTransform(t,e){const s=d*e.angle,a=(0,i.vt)(),l=(0,o.vt)();return(0,n.Tl)(a,a,(0,r.hZ)(l,e.xOffset,-e.yOffset)),e.useCIMAngleBehavior?(0,n.e$)(a,a,s):((0,n.Tl)(a,a,(0,r.hZ)(l,t.x,t.y)),(0,n.e$)(a,a,s),(0,n.Tl)(a,a,(0,r.hZ)(l,-t.x,-t.y))),a}}class y{constructor(t,e,s,n,i,r){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(e,s)),this.end=Math.max(0,Math.max(e,s)),this.end<t.length&&(this.glyphWidthEnd=t[this.end].metrics.width),this.width=n,this.yMin=i,this.yMax=r}}const x=t=>10===t,v=t=>32===t;function b(t,e){let s=0;for(let r=0;r<t.length;r++){const{width:e}=t[r];s=Math.max(e,s)}const n="underline"===e.decoration?u:0,i=t[0].yMin;return{x:0,y:i,height:t[t.length-1].yMax+e.lineHeight*(t.length-1)+n-i,width:s}}function P(t,e){const s=e.scale,n=new Array,{glyphs:i,isRightToLeft:r}=t,o=function(t,e,s){const n=new Array,i=1/s.scale,r=s.maxLineWidth*i,o=e?t.length-1:0,a=e?-1:t.length,l=e?-1:1;let h=o,u=0,c=0,m=h,d=m,g=0,p=1/0,_=0;for(;h!==a;){const{code:e,metrics:s}=t[h],i=Math.abs(s.top);if(x(e)||v(e)||(p=Math.min(p,i),_=Math.max(_,i+s.height)),x(e))h!==o&&(n.push(new y(t,m,h-l,u,p===1/0?0:p,_)),p=1/0,_=0),u=0,m=h+l,d=h+l,c=0;else if(v(e))d=h+l,c=0,g=s.advance,u+=s.advance;else if(u>r){if(d!==m){const e=d-2*l;u-=g,n.push(new y(t,m,e,u-c,p,_)),p=1/0,_=0,m=d,u=c}else n.push(new y(t,m,h-l,u,p,_)),p=1/0,_=0,m=h,d=h,u=0;u+=s.advance,c+=s.advance}else u+=s.advance,c+=s.advance;h+=l}const f=new y(t,m,h-l,u,p,_);return f.start>=0&&f.end<t.length&&n.push(f),n}(i,r,e),l=o.length?b(o,e):{y:0,height:0},h=(0,a.xy)(e.horizontalAlignment),u=(0,a.UD)(e.verticalAlignment),c=u===a.gy.Baseline?1:0,d=c?0:u-1,p=(1-c)*-l.y+d*(l.height/2)+-22*(c?1:0);for(let a=0;a<o.length;a++){const{start:r,end:l,width:u}=o[a];let c=-1*(h+1)*(u/2)-m;const d=(t.isRightToLeft?o.length-1-a:a)*e.lineHeight+p-m;o[a].startX=c,o[a].startY=d;for(let t=r;t<=l;t++){const e=i[t];if(x(e.code))continue;const r=new g(c+e.metrics.left,d-e.metrics.top,e,s);c+=e.metrics.advance,n.push(r)}}return new f(n,o,e)}},55429:(t,e,s)=>{s.d(e,{Kl:()=>h,M9:()=>a,fG:()=>o,fw:()=>l,jT:()=>r});const n=new Float32Array(1),i=new Uint32Array(n.buffer);function r(t){return n[0]=t,i[0]}function o(t){return i[0]=t,n[0]}function a(t,e){return 65535&t|e<<16}function l(t){const e=r(t),s=e>>>31;let n=e>>>23&255,i=8388607&e;return n-=127,n>15?s<<15|31744:n<-25?0:(n<-14&&(i+=8388608,i/=2**(-14-n),n=-15),n+=15,i/=8192,i=function(t,e){const s=Math.floor(t),n=t-s;return s<e&&(n>.5||.5===n&&s%2==1)?s+1:s}(i,1023),s<<15|n<<10|i)}function h(t){let e=t>>>15,s=t>>10&31,n=1023&t;return e=e?-1:1,s-=15,n/=1024,s>-15?n+=1:s=-14,e*2**s*n}},47381:(t,e,s)=>{s.d(e,{Y7:()=>E,HS:()=>C,mm:()=>w,A:()=>T,k2:()=>I,ZA:()=>S,E8:()=>b,hF:()=>y,C5:()=>f,uK:()=>v,Pi:()=>x});var n=s(66866),i=(s(39831),s(539)),r=s(96274),o=s(39689);function a(t,e,s){const n=e.split("\n");for(const i of n)if(i.trim().length){{let e="";null!=s&&(e+=`/*id:${s??"000"}*/   `),t.body+=e.padEnd(14)}t.body+=" ".repeat(t.indent)+i+"\n"}}class l{write(t){for(const e of t.rootOutputNodes())t.shouldPruneOutputNode(e)||(e.variableName=this._write(t,e.node));return t}_createVarName(t,e){let s="";return"boolean"!=typeof e&&"number"!=typeof e&&e.debugInfo.name&&(s=`${e.debugInfo.name}_`),`${s}v${t.varCount++}`}_write(t,e,s=!1){if("number"==typeof e)return e.toString();if("boolean"==typeof e)return e.toString();let n=t.getEmit(e);if(n)return n;switch(e.shaderType){case"scope-node":n=this._writeScopeNode(t,e);break;case"primitive-node":n=this._writePrimitiveNode(t,e,s);break;case"function-node":n=this._writeFunctionNode(t,e);break;case"property-access-node":n=this._writePropertyAccessNode(t,e);break;case"property-access-2d-node":n=this._writePropertyAccess2DNode(t,e);break;case"text-node":n=e.text;break;case"block-node":n=this._writeBlockNode(t,e);break;case"condition-node":n=this._writeConditionNode(t,e)}return t.setEmit(e,n),n}_writeScopeNode(t,e){const s=new e.child.constructor;s.setDebugName(e.debugInfo.name);const n=this._write(t,s,!0);return a(t,`{ /*ScopeStart: ${e.uid} ${e.debugInfo.name}*/`),t.indent+=2,a(t,`${n} = ${this._write(t,e.child)};`),t.indent-=2,a(t,`} /*ScopeEnd: ${e.uid} ${e.debugInfo.name}*/`),n}_writeConditionNode(t,e){const s=new e.ifTrue.constructor,n=this._write(t,s,!0);a(t,`if (${this._write(t,e.condition)}) {`),t.indent+=2;const i=t.createSubgraphContext(),r=this._write(i,e.ifTrue);if(t.body+=i.body,r&&a(t,`${n} = ${r};`),t.indent-=2,a(t,"}"),e.ifFalse){a(t,"else {"),t.indent+=2;const s=t.createSubgraphContext(),i=this._write(s,e.ifFalse);t.body+=s.body,i&&a(t,`${n} = ${i};`),t.indent-=2,a(t,"}")}return n}_writeBlockNode(t,e){const{captureList:s,generator:n,returnType:i}=e,r={};for(const a in s){if(!s[a])continue;const e=this._write(t,s[a]);r[a]=e}const o=new i,l=this._write(t,o,!0);if(r.out=l,e.subgraph){const s=t.createSubgraphContext(),n=this._write(s,e.subgraph.child),i=s.body;r.subgraph={varName:n,body:i}}const h=n(r);return a(t,"{\n"),t.indent+=2,a(t,h),t.indent-=2,a(t,"}\n"),l}_writePropertyAccessNode(t,e){const s=this._write(t,e.target);return"string"==typeof e.property&&e.property.includes("[")?`${s}${e.property}`:"string"!=typeof e.property?`${s}[${this._write(t,e.property)}]`:`${s}.${e.property}`}_writePropertyAccess2DNode(t,e){return`${this._write(t,e.target)}[${this._write(t,e.x)}][${this._write(t,e.y)}]`}_writeFunctionNode(t,e){const s=e.returnType.type;if(e.isInfix){const[n,i]=e.children.map((e=>this._write(t,e))),r=this._createVarName(t,e);return a(t,`${s.padEnd(5)} ${r} = ${n} ${e.token} ${i};`,e.uid),r}const n=e.children.map((e=>this._write(t,e))).join(", "),i=this._createVarName(t,e);return a(t,`${s.padEnd(5)} ${i} = ${e.token}(${n});`,e.uid),i}_writePrimitiveNode(t,e,s=!1){const n=t.getInput(e);if(n)return n.isUsed=!0,n.variableName;const i=1===e.children.length&&e.children[0]?.type===e.type;if(!e.isMutable&&(e.isImplicit||i))return this._write(t,e.children[0]);const r=this._createVarName(t,e);if(s)return a(t,`${e.type.padEnd(5)} ${r};`,e.uid),r;const o=!e.debugInfo.name&&!e.isMutable;if(o&&"float"===e.type&&"number"==typeof e.children[0])return Number.isInteger(e.children[0])?e.children[0].toFixed(1):e.children[0].toString();if(o&&"int"===e.type&&"number"==typeof e.children[0]&&Number.isInteger(e.children[0]))return e.children[0].toString();const l=e.children.map((e=>this._write(t,e))).join(", ");return"array"===e.type?(a(t,`${e.type.padEnd(5)} ${r} = [${l}];`,e.uid),r):o?`${e.type}(${l})`:(a(t,`${e.type.padEnd(5)} ${r} = ${e.type}(${l});`,e.uid),r)}}var h=s(52954);class u{constructor(t,e,s){this.variableName=t,this.variableInputType=e,this.node=s,this.type="shader-input",this.isUsed=!1}clone(){return new u(this.variableName,this.variableInputType,(0,h.vA)(this.node))}}class c{constructor(t,e,s){this.outVariableName=t,this.outVariableType=e,this.node=s,this.type="shader-output"}clone(){const t=new c(this.outVariableName,this.outVariableType,(0,h.vA)(this.node));return t.variableName=this.variableName,t}}class m{static createVertex(t,e,s,n,i,r){const o=[];for(const l in t){const e=t[l],n=s.get(l);n?o.push(new u(n,"builtin",e)):o.push(new u("a_"+l,"in",e))}for(const l of n){const t=l.uniformHydrated;o.push(new u(l.uniformName,"uniform",t))}const a=[];for(const l in e){const t=e[l];"glPosition"===l?a.push(new c("gl_Position","builtin",t)):"glPointSize"===l?a.push(new c("gl_PointSize","builtin",t)):a.push(new c("v_"+l,"out",t))}return new m(o,a,i,r)}static createFragment(t,e,s,n,i,r){const o=[],a=Array.from(i.rootOutputNodes());for(const h in t){const e=t[h],n=s.get(h);if(n){o.push(new u(n,"builtin",e));continue}const i=a.find((t=>t.node===e));i&&o.push(new u(i.outVariableName,"in",e))}for(const h of n){const t=h.uniformHydrated;o.push(new u(h.uniformName,"uniform",t))}const l=[];for(const h in e){const t=e[h],n=s.get(h);"discard"===h?l.push(new c(null,"discard",t)):n?l.push(new c(n,"builtin",t)):l.push(new c(h,"out",t))}return new m(o,l,r)}constructor(t,e,s,n){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const i of t)this._inputShaderTypesByNodeUid.set(i.node.uid,i);this._outputShaderTypes=e,this._transformFeedbackBindings=s,this._transformFeedbackNames=new Set(s.map((t=>"v_"+t.propertyKey))),this._usedInFragmentShader=n}shouldPruneOutputNode(t){return!!this._usedInFragmentShader&&"builtin"!==t.outVariableType&&!this._transformFeedbackNames.has(t.outVariableName)&&!this._usedInFragmentShader.has(t.node.uid)}setEmit(t,e){this._nodeEmitMap.set(t.uid,e)}getEmit(t){return this._nodeEmitMap.get(t.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(t){return this._inputShaderTypesByNodeUid.get(t.uid)}*rootOutputNodes(){for(const t of this._outputShaderTypes)yield t}*nodes(){const t=[];for(const e of this._outputShaderTypes.values())t.push(e.node);for(;t.length;){const e=t.pop();"number"!=typeof e&&"boolean"!=typeof e&&t.push(...e.children.filter(Boolean)),yield e}}*nodesOfTypeOrFunction(){for(const t of this.nodes())"number"!=typeof t&&"boolean"!=typeof t&&(yield t)}createSubgraphContext(){const t=this.clone();return t.body="",t.indent=this.indent+2,t._nodeEmitMap=new Map(this._nodeEmitMap),t}clone(){const t=new m([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return t._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,t.indent=this.indent,t.body=this.body,t.varCount=this.varCount,t._nodeEmitMap=this._nodeEmitMap,t}insertVertexShader(t){t.vertex.code.add(""),this._insertInputs(t,"vertex"),t.vertex.code.add(""),t.vertex.code.add("// OUTPUTS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this.rootOutputNodes()){const s="builtin"===e.outVariableType;this.shouldPruneOutputNode(e)||(s?t.vertex.code.add(`// ${e.outVariableType.padEnd(7)} ${e.node.type.padEnd(9)} ${e.outVariableName};`):t.vertex.code.add(`${e.outVariableType.padEnd(10)} ${e.node.type.padEnd(9)} ${e.outVariableName};`))}t.vertex.code.add(""),t.vertex.code.add("void main() {"),t.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const e of this.rootOutputNodes())this.shouldPruneOutputNode(e)||t.vertex.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.vertex.code.add("}")}insertFragmentShader(t){this._insertInputs(t,"fragment"),t.fragment.code.add(""),t.fragment.code.add("// OUTPUTS: "),t.fragment.code.add("// --------------------------------------------------------- ");let e=0;for(const s of this.rootOutputNodes())"builtin"===s.outVariableType?t.fragment.code.add(`// ${s.outVariableType.padEnd(7)} ${s.node.type.padEnd(9)} ${s.outVariableName};`):t.outputs.add(s.outVariableName,s.node.type,e++);t.fragment.code.add(""),t.fragment.code.add("void main() {"),t.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const s of this.rootOutputNodes())"discard"===s.outVariableType?(t.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),t.fragment.code.add(`  if (${s.variableName}) {`),t.fragment.code.add("    discard;"),t.fragment.code.add("  }"),t.fragment.code.add("  ")):t.fragment.code.add(`  ${s.outVariableName} = ${s.variableName};`);t.fragment.code.add("}")}_insertInputs(t,e){t[e].code.add("// INPUTS: "),t[e].code.add("// --------------------------------------------------------- ");for(const s of this.inputs())s.isUsed&&"builtin"!==s.variableInputType&&("array"===s.node.type?t[e].code.add(`${s.variableInputType.padEnd(10)} ${s.node.elementType.type.padEnd(9)} ${s.variableName}[${s.node.size}];`):"array-2d"===s.node.type?t[e].code.add(`${s.variableInputType.padEnd(10)} ${s.node.elementType.type.padEnd(9)} ${s.variableName}[${s.node.size}]; // Emulated 2D Array. Not supported by ES3.0`):t[e].code.add(`${s.variableInputType.padEnd(10)} ${s.node.type.padEnd(9)} ${s.variableName};`))}}var d=s(51487),g=s(96028);function p(t){return new t}function _(t,e,s){const n=t.constructor[e]??[];t.constructor.hasOwnProperty(e)||Object.defineProperty(t.constructor,e,{value:n.slice()}),t.constructor[e].push(s)}function f(t,e){return(s,n)=>{_(s,"locations",{typeCtor:e,propertyKey:n,parameterIndex:null,index:t})}}const y=t=>(e,s,n)=>{_(e,"inputs",{inputCtor:t,propertyKey:s,parameterIndex:n})},x=t=>(e,s)=>{_(e,"uniforms",{typeCtor:t,propertyKey:s})},v=t=>(e,s)=>{_(e,"options",{typeCtor:t,propertyKey:s})},b=(t,e)=>{_(t,"defines",{propertyKey:e})};const P=(t,e)=>(s,n)=>{s.constructor.builtins.push({builtin:t,propertyKey:n,typeCtor:e})};class S{static{this.builtins=[]}}(0,n._)([P("gl_VertexID",o.Ai)],S.prototype,"glVertexID",void 0);class E{}class C{static{this.builtins=[]}}(0,n._)([P("gl_FragCoord",o.Zb)],C.prototype,"glFragCoord",void 0),(0,n._)([P("gl_PointCoord",o.ZY)],C.prototype,"glPointCoord",void 0);class w{}(0,n._)([(t=>(e,s)=>{_(e,"builtins",{builtin:t,propertyKey:s})})("gl_FragDepth")],w.prototype,"glFragDepth",void 0);class I{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class T{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const t=this._shaderModuleClass.inputs.findLast((t=>"vertex"===t.propertyKey&&0===t.parameterIndex));if(!t)throw new Error("Unable to find vertex input parameter");return t}get computeInput(){return this._shaderModuleClass.inputs.findLast((t=>"vertex"===t.propertyKey&&1===t.parameterIndex))}get fragmentInput(){const t=this._shaderModuleClass.inputs.findLast((t=>"fragment"===t.propertyKey));if(!t)throw new Error("Unable to find fragment input parameter");return t}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){const t=new Map,e=new Set;for(const s of this.locations)e.has(s.index)?i.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${s.propertyKey} to ${s.index}. Index already in use`,{locationsMap:t}):(t.set(s.propertyKey,s.index),e.add(s.index));return t}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,e=Array.from(t.entries()).map((([t,e])=>`${t}.${e}`)).join("."),s=(0,r.Wm)(e),n=this.computeAttributes;this._locationInfo={hash:s,stringHash:e,locations:t,computeAttributeMap:n}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const e of this.locations)t.set("a_"+e.propertyKey,e.index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set;for(const e of this._options)t.add(e.propertyKey);this._optionPropertyKeys=t}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(t,e,s,n){try{const{vertex:i,fragment:r,uniformBindings:o}=this._generateShaders(t,e,s,n);return new d.K(i,r,this.renamedLocationsMap,this.locationInfo,o,this.transformFeedbackBindings)}catch(i){return new d.K("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(t){const e=this._options.find((e=>e.propertyKey===t));if(e)return{type:"option",className:e.typeCtor};const s=this._uniforms.find((e=>e.propertyKey===t));if(!s)throw new Error(`Unable to find uniform class type for property: ${t}`);return{type:"required",className:s.typeCtor}}getShaderKey(t,e,s,n){const i=Object.keys(t).map((e=>`${e}.${t[e]}`)).join("."),r=Object.keys(s).map((t=>`${t}.${s[t]}`)).join("."),o=Object.keys(n).map((t=>`${t}.${n[t]}`)).join("."),a=Object.keys(e).filter((t=>this.optionPropertyKeys.has(t)&&e[t])).join(".");return`${this.type}.${i}.${r}.${o}.${a}`}_generateShaders(t,e,s,n){const i=[];this._setDefines(s),this._setOptionalUniforms(i,e),this._setRequiredUniforms(i);const r=this._hydrateVertexInput(n),o=this._injectPackPrecisionFactor(r,t),a=this._hydrateComputeInput(),u=a&&this._injectComputePackPrecisionFactor(a,t),c=this.vertex(o,u),d=this._hydrateFragmentInput(c),g=this.fragment(d),p=new Set;for(const l in g){const t=g[l];(0,h.rz)(p,t)}const _=this._getVertexInputBuiltins(),f=m.createVertex({...r,...a},c,_,i,this.transformFeedbackBindings,p);(new l).write(f);const y=this._getFragmentInputBuiltins(g);y.set("glPointCoord","gl_PointCoord");const x=m.createFragment(d,g,y,i,f,this.transformFeedbackBindings);(new l).write(x);const v=this._createShaderBuilder(f,x),b=v.generate("vertex"),P=v.generate("fragment");return this.logShader&&(console.log(b),console.log(P)),{vertex:b,fragment:P,uniformBindings:i}}_setDefines(t){for(const e in t)this[e]=t[e]}_setOptionalUniforms(t,e){for(const s of this._options)e[s.propertyKey]?this[s.propertyKey]=this._hydrateUniformGroup(t,s):this[s.propertyKey]=null}_setRequiredUniforms(t){for(const e of this._uniforms)this[e.propertyKey]=this._hydrateUniformGroup(t,e)}_hydrateUniformGroup(t,e){const s=new(0,e.typeCtor);for(const n of s._uniforms??[]){const i=p(n.typeCtor),r=`u_${e.propertyKey}_${n.propertyKey}`,o=i.type,a=[e.propertyKey,n.propertyKey].join(".");if("type"in n.typeCtor&&"array"===n.typeCtor.type){const e=i;t.push({shaderModulePath:a,uniformName:r,uniformType:o,uniformArrayLength:e.size,uniformArrayElementType:e.elementType.type,uniformHydrated:i})}else if("type"in n.typeCtor&&"array-2d"===n.typeCtor.type){const e=i;t.push({shaderModulePath:a,uniformName:r,uniformType:o,uniformArrayLength:e.size,uniformArrayElementType:e.elementType.type,uniformHydrated:i})}else t.push({shaderModulePath:a,uniformName:r,uniformType:o,uniformHydrated:i});s[n.propertyKey]=i}return s}_hydrateVertexInput(t){const e=this.vertexInput.inputCtor,s=e.locations.reduce(((e,s)=>!1===t[s.propertyKey]?e:{...e,[s.propertyKey]:p(s.typeCtor)}),{});for(const{propertyKey:n,typeCtor:i}of e.builtins){const t=p(i);s[n]=t}return s}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce(((t,e)=>({...t,[e.propertyKey]:p(e.typeCtor)})),{})}_injectPackPrecisionFactor(t,e){const s={};for(const n in t){const i=t[n],r=e[n];if(r){if("float"!==i.type&&"vec2"!==i.type&&"vec3"!==i.type&&"vec4"!==i.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${i.type}`);s[n]=i.divide(new o.nt(r))}else s[n]=i}return s}_injectComputePackPrecisionFactor(t,e){const s={},n=new Map;for(const i in this.computeAttributes)for(const t of this.computeAttributes[i]??[])n.set(t,i);for(const i in t){const r=t[i],a=n.get(i);if(!a)continue;const l=e[a];if(l){if("float"!==r.type&&"vec2"!==r.type&&"vec3"!==r.type&&"vec4"!==r.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${r.type}`);s[i]=r.divide(new o.nt(l))}else s[i]=r}return s}_hydrateFragmentInput(t){const e={};for(const s in t)e[s]=t[s];for(const{propertyKey:s,typeCtor:n}of C.builtins){const t=p(n);e[s]=t}return e}_getVertexInputBuiltins(){const t=this.vertexInput.inputCtor,e=new Map;for(const{builtin:s,propertyKey:n}of t.builtins)e.set(n,s);return e}_getFragmentInputBuiltins(t){const e=t.constructor,s=new Map;for(const n of e.builtins??[])s.set(n.propertyKey,n.builtin);return s}_createShaderBuilder(t,e){const s=new g.N5;return this._insertDebugInfo(s),t.insertVertexShader(s),e.insertFragmentShader(s),s}_insertDebugInfo(t){t.vertex.code.add("// DEFINES: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._defines)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`);t.vertex.code.add(""),t.vertex.code.add("// OPTIONS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._options)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`)}}},52954:(t,e,s)=>{function n(t,e){const s=[];for(s.push(e);s.length;){const e=s.pop();if("object"==typeof e&&!t.has(e.uid)){t.add(e.uid);for(const t of e.children)s.push(t)}}}s.d(e,{XL:()=>u,aw:()=>m,ff:()=>h,rR:()=>c,rz:()=>n,vA:()=>r,vL:()=>o,zg:()=>l});class i{constructor(){this.uid=i.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}static{this.NodeCount=0}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(t){return t=function(t){return t.split(" ").map(((t,e)=>e>0?t.charAt(0).toUpperCase()+t.slice(1):t)).join("")}(t),this._debugName=t,this.isImplicit&&this.children[0]instanceof i&&this.children[0].setDebugName(t),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(t){t._debugName=this._debugName,t._isMutable=this._isMutable,t.isImplicit=this.isImplicit,t.uid=this.uid}}function r(t){return"object"==typeof t?t.clone():t}class o extends i{constructor(){super(...arguments),this.shaderType="primitive-node"}}class a extends i{constructor(t){super(),this.child=t,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const t=new a(r(this.child));return this.cloneInto(t),t}}class l extends i{constructor(t,e,s){super(),this.property=t,this.target=e,this.returnType=s,this.shaderType="property-access-node"}get children(){const t=[this.target];return"string"!=typeof this.property&&t.push(this.property),t}clone(){const t=new l(this.property,r(this.target),this.returnType);return this.cloneInto(t),t}}class h extends i{constructor(t,e,s,n){super(),this.x=t,this.y=e,this.target=s,this.returnType=n,this.shaderType="property-access-2d-node"}get children(){return[this.target,this.x,this.y]}clone(){const t=new h(this.x,this.y,r(this.target),this.returnType);return this.cloneInto(t),t}}class u extends i{constructor(t,e,s){super(),this.condition=t,this.ifTrue=e,this.ifFalse=s,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const t=r(this.ifTrue),e=this.ifFalse?r(this.ifFalse):null,s=new u(this.condition,t,e);return this.cloneInto(s),s}}class c extends i{constructor(t,e,s,n){super(),this.captureList=t,this.returnType=e,this.generator=n,this.shaderType="block-node",s&&(this.subgraph=new a(s))}get children(){return Object.keys(this.captureList).map((t=>this.captureList[t])).concat(this.subgraph??[])}clone(){const t={};for(const s in this.captureList)t[s]=r(this.captureList[s]);const e=new c(t,this.returnType,this.subgraph?r(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(e),e}}class m extends i{constructor(t,e,s,n,i,r=!1){super(),this.token=t,this._children=e,this.isInfix=s,this.isPropertyAccess=n,this.returnType=i,this.isTernary=r,this.shaderType="function-node"}get children(){return this._children}clone(){const t=new m(this.token,this._children.map(r),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(t),t}}},39689:(t,e,s)=>{s.d(e,{$5:()=>Pt,$I:()=>U,$T:()=>de,AU:()=>te,Ai:()=>V,Bw:()=>Xt,Cq:()=>z,Ec:()=>vt,F8:()=>ie,FM:()=>yt,Gb:()=>mt,HQ:()=>At,I8:()=>wt,Io:()=>qt,L0:()=>re,LC:()=>xt,LI:()=>se,MM:()=>St,Ml:()=>he,My:()=>P,Ny:()=>B,Om:()=>Bt,PM:()=>le,RI:()=>Ut,RZ:()=>ae,Rm:()=>jt,S8:()=>Jt,Sj:()=>gt,T9:()=>Wt,TF:()=>oe,Tk:()=>ot,U:()=>Y,US:()=>me,Uo:()=>It,Wh:()=>X,Xe:()=>bt,YN:()=>Mt,ZY:()=>w,Zb:()=>T,Zc:()=>Z,_S:()=>ne,_i:()=>S,aX:()=>Et,eB:()=>I,eR:()=>W,fV:()=>j,gn:()=>zt,hC:()=>ft,j1:()=>at,jc:()=>Ht,jh:()=>Kt,jk:()=>$t,ln:()=>$,lw:()=>lt,mk:()=>Gt,n7:()=>ee,nP:()=>ce,nf:()=>pt,nt:()=>C,oN:()=>Yt,om:()=>rt,or:()=>Ct,p6:()=>Zt,pu:()=>_t,qE:()=>Vt,qR:()=>Ft,rY:()=>kt,rf:()=>Lt,tn:()=>Tt,w0:()=>K,wH:()=>dt,x:()=>F,yH:()=>Rt,yI:()=>Ot,ym:()=>ue,z7:()=>E,ze:()=>it,zi:()=>Qt});var n,i,r,o,a,l,h,u,c,m,d,g,p,_,f=s(66866),y=s(52954);function x(t){return new Proxy(t,{get(e,s){if("constructor"===s)return new Proxy(e.constructor,{construct:(t,e,s)=>x(new t(...e))});if(s in e)return e[s];if("string"==typeof s){const e=function(t){const e=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const s of e)if(s.includes(t))return s.map((t=>H[t]));throw new Error("Unable to find type family")}(t.type);return Q(t,s,e[s.length-1])}}})}function v(t){return new Proxy(t,{construct:(t,e,s)=>x(new t(...e))})}class b extends Error{}let P=class extends y.vL{static{n=this}static{this.type="array"}constructor(t,e){super(),this.elementType=t,this.size=e,this.children=[],this.type="array"}clone(){const t=new n(this.elementType,this.size);return super.cloneInto(t),t}get(t,e){const s=new V(t),n=null!=e?new V(e):null;return null!=n?J(this,s,n,function(t){switch(t.type){case"bool":case"bvec2":case"bvec3":case"bvec4":return F;case"float":case"vec2":case"vec3":case"vec4":return C;case"int":case"ivec2":case"ivec3":case"ivec4":return V;case"uint":case"uvec2":case"uvec3":case"uvec4":return A;default:throw new Error("Unable to handle type")}}(this.elementType.constructor)):Q(this,s,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(t,e,s){return function(t,e,s=0,n=t.size){const i=new V(s).setMutable().setDebugName("FindIndexIterator"),r=e(t.get(i)).setDebugName("FindIndexPredicate"),o=rt({iter:i},V,r,(({out:t,iter:e,subgraph:s})=>`\n${t} = -1;\n\nfor (; ${e} < ${n}; ${e}++) {\n\n${s.body}\n\n  if (${s.varName}) {\n    ${t} = ${e};\n    break;\n  }\n\n}\n`)).setDebugName("FindIndexBlock");return o}(this,t,e,s)}glslFindIndex(t,e,s){return function(t,e,s=0,n=t.size){const i=rt({array:t},V,null,(({out:t,array:i})=>`\n${t} = -1;\nfor (int i = ${s}; i < ${n}; i++) {\n  bool condition;\n  ${e({array:i,i:"i",out:"condition"})}\n  if (condition) {\n    ${t} = i;\n    break;\n  }\n}\n`)).setDebugName("GlslFindIndexBlock");return i}(this,t,e,s)}static ofType(t,e){const s={construct:(s,i)=>new n(new t,e)};return new Proxy(n,s)}};P=n=(0,f._)([function(t){return new Proxy(t,{construct:(t,e,s)=>function(t){return new Proxy(t,{get(e,s){if(s in e)return e[s];if("string"==typeof s){const e=parseInt(s,10);if(!isNaN(e))return Q(t,`[${e}]`,t.elementType.constructor)}}})}(new t(...e))})}],P);class S extends y.vL{static{this.type="array-2d"}constructor(t,e,s,n=!1){super(),this.elementType=t,this.xSize=e,this.ySize=s,this.isRowMajor=n,this.children=[],this.type="array-2d"}clone(){const t=new S(this.elementType,this.xSize,this.ySize,this.isRowMajor);return super.cloneInto(t),t}get size(){return this.xSize*this.ySize}get(t,e){return this.isRowMajor?this._getRowMajor(t,e):this._getColumnMajor(t,e)}_getColumnMajor(t,e){const s=new V(t);return Q(this,new V(e).add(s.multiply(this.xSize)),this.elementType.constructor)}_getRowMajor(t,e){const s=new V(t),n=new V(e);return Q(this,s.add(n.multiply(this.ySize)),this.elementType.constructor)}static ofType(t,e,s,n=!1){return new Proxy(P,{construct:(i,r)=>new S(new t,e,s,n)})}}class E extends y.vL{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}static{this.type="sampler2D"}clone(){const t=new E;return t.children=this.children.map(y.vA),super.cloneInto(t),t}}class C extends y.vL{static{this.type="float"}constructor(t){super(),this.type="float",this.children=[t]}clone(){const t=new C((0,y.vA)(this.children[0]));return super.cloneInto(t),t}multiply(t){return lt(this,"number"==typeof t?L(t,C):t)}divide(t){return ht(this,"number"==typeof t?L(t,C):t)}add(t){return ut(this,"number"==typeof t?L(t,C):t)}subtract(t){return ct(this,"number"==typeof t?L(t,C):t)}}let w=class extends y.vL{static{i=this}static{this.type="vec2"}constructor(t,e){super(),this.type="vec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new i((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}get 0(){return Q(this,"[0]",C)}get 1(){return Q(this,"[1]",C)}get 2(){throw new b}get 3(){throw new b}multiply(t){return lt(this,"number"==typeof t?L(t,C):t)}divide(t){return ht(this,"number"==typeof t?L(t,C):t)}add(t){return ut(this,"number"==typeof t?L(t,C):t)}subtract(t){return ct(this,"number"==typeof t?L(t,C):t)}};w=i=(0,f._)([v],w);let I=class extends y.vL{static{r=this}static{this.type="vec3"}constructor(t,e,s){super(),this.type="vec3",this.children=[t,e,s].filter((t=>null!=t))}get 0(){return Q(this,"[0]",C)}get 1(){return Q(this,"[1]",C)}get 2(){return Q(this,"[2]",C)}get 3(){throw new b}clone(){const t=new r((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}multiply(t){return lt(this,"number"==typeof t?L(t,C):t)}divide(t){return ht(this,"number"==typeof t?L(t,C):t)}add(t){return ut(this,"number"==typeof t?L(t,C):t)}subtract(t){return ct(this,"number"==typeof t?L(t,C):t)}};I=r=(0,f._)([v],I);let T=class extends y.vL{static{o=this}static{this.type="vec4"}constructor(t,e,s,n){super(),this.type="vec4",this.children=[t,e,s,n].filter((t=>null!=t))}clone(){const t=new o((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}get 0(){return Q(this,"[0]",C)}get 1(){return Q(this,"[1]",C)}get 2(){return Q(this,"[2]",C)}get 3(){return Q(this,"[3]",C)}multiply(t){return lt(this,"number"==typeof t?L(t,C):t)}divide(t){return ht(this,"number"==typeof t?L(t,C):t)}add(t){return ut(this,"number"==typeof t?L(t,C):t)}subtract(t){return ct(this,"number"==typeof t?L(t,C):t)}};T=o=(0,f._)([v],T);let A=class extends y.vL{static{a=this}static{this.type="uint"}constructor(t){super(),this.type="uint",this.children=[t]}clone(){const t=new a((0,y.vA)(this.children[0]));return super.cloneInto(t),t}};A=a=(0,f._)([v],A);let M=class extends y.vL{static{l=this}static{this.type="uvec2"}constructor(t,e){super(),this.type="uvec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new l((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}};M=l=(0,f._)([v],M);let D=class extends y.vL{static{h=this}static{this.type="uvec3"}constructor(t,e,s){super(),this.type="uvec3",this.children=[t,e,s].filter((t=>null!=t))}clone(){const t=new h((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}};D=h=(0,f._)([v],D);let N=class extends y.vL{static{u=this}static{this.type="uvec4"}constructor(t,e,s,n){super(),this.type="uvec4",this.children=[t,e,s,n].filter((t=>null!=t))}clone(){const t=new u((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}};N=u=(0,f._)([v],N);class F extends y.vL{static{this.type="bool"}constructor(t){super(),this.type="bool",this.children=[t]}and(t){return It(this,t)}or(t){return Ct(this,t)}xor(t){return wt(this,t)}clone(){const t=new F((0,y.vA)(this.children[0]));return super.cloneInto(t),t}}let R=class extends y.vL{static{c=this}static{this.type="bvec2"}constructor(t,e){super(),this.type="bvec2",this.children=[t,e].filter((t=>null!=t))}all(){return Dt(this)}any(){return Nt(this)}clone(){const t=new c((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}};R=c=(0,f._)([v],R);let k=class extends y.vL{static{m=this}static{this.type="bvec3"}constructor(t,e,s){super(),this.type="bvec3",this.children=[t,e,s].filter((t=>null!=t))}all(){return Dt(this)}any(){return Nt(this)}clone(){const t=new m((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}};function L(t,e){return"number"==typeof t?new e(t):t}k=m=(0,f._)([v],k);let G=class extends y.vL{static{d=this}static{this.type="bvec4"}constructor(t,e,s,n){super(),this.type="bvec4",this.children=[t,e,s,n].filter((t=>null!=t))}all(){return Dt(this)}any(){return Nt(this)}clone(){const t=new d((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}};G=d=(0,f._)([v],G);class V extends y.vL{static{this.type="int"}constructor(t){super(),this.type="int",this.children=[t]}multiply(t){return lt(this,L(t,V))}add(t){return ut(this,L(t,V))}subtract(t){return ct(this,L(t,V))}divide(t){return ht(this,L(t,V))}clone(){const t=new V((0,y.vA)(this.children[0]));return super.cloneInto(t),t}}let z=class extends y.vL{static{g=this}static{this.type="ivec2"}constructor(t,e){super(),this.type="ivec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new g((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}};z=g=(0,f._)([v],z);let O=class extends y.vL{static{p=this}static{this.type="ivec3"}constructor(t,e,s){super(),this.type="ivec3",this.children=[t,e,s].filter((t=>null!=t))}clone(){const t=new p((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}};O=p=(0,f._)([v],O);let q=class extends y.vL{static{_=this}static{this.type="ivec4"}constructor(t,e,s,n){super(),this.type="ivec4",this.children=[t,e,s,n].filter((t=>null!=t))}clone(){const t=new _((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}};q=_=(0,f._)([v],q);class B extends y.vL{static{this.type="mat2"}constructor(t,e,s,n){super(),this.type="mat2",this.children=[t,e,s,n]}clone(){const t=new B((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}get(t,e){return J(this,new V(t),new V(e),C)}multiply(t){return lt(this,t)}}class Y extends y.vL{static{this.type="mat3"}static identity(){return new Y(1,0,0,0,1,0,0,0,1)}static fromRotation(t){const e=ie(t),s=zt(t);return new Y(s,e,0,it(e),s,0,0,0,1)}constructor(t,e,s,n,i,r,o,a,l){super(),this.type="mat3",this.children=[t,e,s,n,i,r,o,a,l]}add(t){return ut(this,t)}multiply(t){return lt(this,t)}get(t,e){return J(this,new V(t),new V(e),C)}clone(){const t=new Y((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]),(0,y.vA)(this.children[4]),(0,y.vA)(this.children[5]),(0,y.vA)(this.children[6]),(0,y.vA)(this.children[7]),(0,y.vA)(this.children[8]));return super.cloneInto(t),t}}class U extends y.vL{static{this.type="mat4"}static identity(){return new U(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(t,e,s,n,i,r,o,a,l,h,u,c,m,d,g,p){super(),this.type="mat4",this.children=[t,e,s,n,i,r,o,a,l,h,u,c,m,d,g,p]}static fromColumns(t,e,s,n){return new U(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,s.x,s.y,s.z,s.w,n.x,n.y,n.z,n.w)}multiply(t){return lt(this,t)}get(t,e){return J(this,new V(t),new V(e),C)}clone(){const t=new U((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]),(0,y.vA)(this.children[4]),(0,y.vA)(this.children[5]),(0,y.vA)(this.children[6]),(0,y.vA)(this.children[7]),(0,y.vA)(this.children[8]),(0,y.vA)(this.children[9]),(0,y.vA)(this.children[10]),(0,y.vA)(this.children[11]),(0,y.vA)(this.children[12]),(0,y.vA)(this.children[13]),(0,y.vA)(this.children[14]),(0,y.vA)(this.children[15]));return super.cloneInto(t),t}}const H={float:C,vec2:w,vec3:I,vec4:T,int:V,ivec2:z,ivec3:O,ivec4:q,uint:A,uvec2:M,uvec3:D,uvec4:N,bool:F,bvec2:R,bvec3:k,bvec4:G},X=(...t)=>new V(...t),j=(...t)=>new C(...t),Z=(...t)=>new w(...t),W=(...t)=>new I(...t),$=(...t)=>new T(...t),K=(...t)=>new Y(...t);function Q(t,e,s){const n=new s(new y.zg(e,t,s));return n.isImplicit=!0,n}function J(t,e,s,n){const i=new n(new y.ff(e,s,t,n));return i.isImplicit=!0,i}function tt(t,e,s,n=null){if(n){const i=new n,r=new n(new y.aw(t,[e,s],!0,!1,i));return r.isImplicit=!0,r}if("float"===e.type||"int"===e.type){const n=new s.constructor(new y.aw(t,[e,s],!0,!1,s.constructor));return n.isImplicit=!0,n}if(("mat2"===e.type||"mat3"===e.type||"mat4"===e.type)&&"float"!==s.type){const n=new s.constructor(new y.aw(t,[e,s],!0,!1,s.constructor));return n.isImplicit=!0,n}const i=new e.constructor(new y.aw(t,[e,s],!0,!1,e.constructor));return i.isImplicit=!0,i}function et(t,e,s=e.constructor){const n=new s(new y.aw(t,[e],!1,!1,s));return n.isImplicit=!0,n}function st(t,e,s,n=e.constructor){const i=new n(new y.aw(t,[e,s],!1,!1,n));return i.isImplicit=!0,i}function nt(t,e,s,n,i=e.constructor){const r=new i(new y.aw(t,[e,s,n],!1,!1,i));return r.isImplicit=!0,r}function it(t){return lt(t,j(-1))}function rt(t,e,s,n){return new e(new y.rR(t,e,s,n))}function ot(t,e,s){const n="function"==typeof e?e():e,i="function"==typeof s?s():s,r=new n.constructor(new y.XL(t,n,i));return r.isImplicit=!0,r}function at(...t){const e=t.map((([t,e])=>"function"==typeof e?[t,e()]:[t,e])),s=e[0][1].constructor,n=e.findIndex((t=>!0===t[0]));if(-1===n)throw new Error("A cond must have a fallthrough case with `true`/; ");const i=e.slice(0,n),r=e[n][1],o=new s(i.reduceRight(((t,e)=>ot(e[0],e[1],t)),r));return o.isImplicit=!0,o}function lt(t,e){return tt("*",t,e)}function ht(t,e){return tt("/",t,e)}function ut(t,e){return tt("+",t,e)}function ct(t,e){return tt("-",t,e)}function mt(t,e){return tt("%",t,e)}function dt(t,e){return tt("<<",t,e)}function gt(t,e){return tt(">>",t,e)}function pt(t,e){return tt("&",t,e)}function _t(t,e){return tt("|",t,e)}function ft(t,e){return tt("^",t,e)}function yt(t){return et("~",t)}function xt(t,e){return tt("==",t,e,F)}function vt(t,e){return tt("!=",t,e,F)}function bt(t,e){return tt("<",t,e,F)}function Pt(t,e){return tt("<=",t,e,F)}function St(t,e){return tt(">",t,e,F)}function Et(t,e){return tt(">=",t,e,F)}function Ct(...t){return t.length<=1?t[0]:t.slice(1).reduce(((t,e)=>function(t,e){return tt("||",t,e,F)}(t,e)),t[0])}function wt(...t){return t.length<=1?t[0]:t.slice(1).reduce(((t,e)=>function(t,e){return tt("^^",t,e,F)}(t,e)),t[0])}function It(...t){return t.length<=1?t[0]:t.slice(1).reduce(((t,e)=>function(t,e){return tt("&&",t,e,F)}(t,e)),t[0])}function Tt(t){return et("abs",t)}function At(t){return et("acos",t)}function Mt(t){return et("acosh",t)}function Dt(t){return et("all",t,F)}function Nt(t){return et("any",t,F)}function Ft(t){return et("asin",t)}function Rt(t){return et("asinh",t)}function kt(t,e){return null==e?et("atan",t):st("atan",t,e,t.constructor)}function Lt(t){return et("atanh",t)}function Gt(t){return et("ceil",t)}function Vt(t,e,s){return nt("clamp",t,e,s,t.constructor)}function zt(t){return et("cos",t)}function Ot(t){return et("cosh",t)}function qt(t,e){return st("distance",t,e,C)}function Bt(t,e){return st("dot",t,e,C)}function Yt(t){return et("exp",t)}function Ut(t){return et("floor",t)}function Ht(t){return et("fract",t)}function Xt(t){return et("length",t,C)}function jt(t){return et("log",t)}function Zt(t){return et("log2",t)}function Wt(t,e){return st("max",t,e)}function $t(t,e){return st("min",t,e)}function Kt(t,e,s){return nt("mix",t,e,s)}function Qt(t,e){return st("mod",t,e)}function Jt(t){return et("normalize",t)}function te(t){return"bool"===t.type?et("!",t):et("not",t)}function ee(t,e){return st("pow",t,e)}function se(t){return et("round",t)}function ne(t){return et("sign",t)}function ie(t){return et("sin",t)}function re(t){return et("sinh",t)}function oe(t,e,s){return nt("smoothstep",t,e,s)}function ae(t){return et("sqrt",t)}function le(t,e){return st("step",t,e,e.constructor)}function he(t){return et("tan",t)}function ue(t){return et("tanh",t)}function ce(t,e,s){return nt("texelFetch",t,e,s,T)}function me(t,e){return st("texture",t,e,T)}function de(t,e){const{initialValue:s,xRange:n,yRange:i,callback:r}=e,[o,a]=n,[l,h]=i,u=new V(0).setMutable().setDebugName("iterX"),c=new V(0).setMutable().setDebugName("iterY"),m=s.setMutable().setDebugName("accumulator"),d=r(m,t.get(u,c),u,c).setDebugName("callback"),g=rt({iterX:u,iterY:c,accumulator:m},s.constructor,d,(({out:t,iterX:e,iterY:s,accumulator:n,subgraph:i})=>`\nfor (${s} = ${l}; ${s} < ${h}; ${s}++) {\n  for (${e} = ${o}; ${e} < ${a}; ${e}++) {\n\n  ${i.body}\n\n  ${n} = ${i.varName};\n  }\n}\n${t} = ${n};\n`)).setDebugName("reduce2DBody");return g}},17730:(t,e,s)=>{s.d(e,{j:()=>i});var n=s(79432);class i{constructor(){this.drawPhase=n.S5.MAP|n.S5.HITTEST|n.S5.HIGHLIGHT|n.S5.DEBUG}startup(){}shutdown(t){}}},98826:(t,e,s)=>{var n,i;s.d(e,{N:()=>n,Y:()=>i}),function(t){t[t.AnimatedFill=0]="AnimatedFill",t[t.AnimatedLine=1]="AnimatedLine",t[t.AnimatedMarker=2]="AnimatedMarker",t[t.AnimatedMarkerShift=3]="AnimatedMarkerShift",t[t.Bitmap=4]="Bitmap",t[t.Blend=5]="Blend",t[t.ComplexFill=6]="ComplexFill",t[t.ComplexOutlineFill=7]="ComplexOutlineFill",t[t.DotDensity=8]="DotDensity",t[t.Fill=9]="Fill",t[t.GradientFill=10]="GradientFill",t[t.GradientStroke=11]="GradientStroke",t[t.Grid=12]="Grid",t[t.Heatmap=13]="Heatmap",t[t.Label=14]="Label",t[t.Line=15]="Line",t[t.Magnifier=16]="Magnifier",t[t.Marker=17]="Marker",t[t.OutlineFill=18]="OutlineFill",t[t.Overlay=19]="Overlay",t[t.PatternFill=20]="PatternFill",t[t.PatternOutlineFill=21]="PatternOutlineFill",t[t.PieChart=22]="PieChart",t[t.Test=23]="Test",t[t.Text=24]="Text",t[t.TexturedLine=25]="TexturedLine",t[t.VideoScreen=26]="VideoScreen"}(n||(n={})),function(t){t[t.RasterColorizer=0]="RasterColorizer",t[t.RasterProcessor=1]="RasterProcessor",t[t.Aspect=2]="Aspect",t[t.BandArithmetic=3]="BandArithmetic",t[t.ColormapToRGB=4]="ColormapToRGB",t[t.CompositeBand=5]="CompositeBand",t[t.ComputeChange=6]="ComputeChange",t[t.ContrastBrightness=7]="ContrastBrightness",t[t.Convolution=8]="Convolution",t[t.Curvature=9]="Curvature",t[t.ExtractBand=10]="ExtractBand",t[t.Grayscale=11]="Grayscale",t[t.Hillshade=12]="Hillshade",t[t.Local=13]="Local",t[t.Mask=14]="Mask",t[t.NDVI=15]="NDVI",t[t.Remap=16]="Remap",t[t.Reproject=17]="Reproject",t[t.ShadedRelief=18]="ShadedRelief",t[t.Slope=19]="Slope",t[t.Statistics=20]="Statistics",t[t.Stretch=21]="Stretch"}(i||(i={}))},17906:(t,e,s)=>{s.d(e,{F:()=>r,q:()=>o});var n=s(55429),i=s(41746);function r(t,e,s,r){const o=s.packPrecisionFactor??1;switch(s.type){case i.pe.BYTE:if(1===s.count)t.setInt8(r+s.offset,e*o);else for(let n=0;n<s.count;n++){const i=n*Int8Array.BYTES_PER_ELEMENT;t.setInt8(r+s.offset+i,e[n]*o)}break;case i.pe.UNSIGNED_BYTE:if(1===s.count)t.setUint8(r+s.offset,e*o);else for(let n=0;n<s.count;n++){const i=n*Uint8Array.BYTES_PER_ELEMENT;t.setUint8(r+s.offset+i,e[n]*o)}break;case i.pe.SHORT:if(1===s.count)t.setInt16(r+s.offset,e*o,!0);else for(let n=0;n<s.count;n++){const i=n*Int16Array.BYTES_PER_ELEMENT;t.setInt16(r+s.offset+i,e[n]*o,!0)}break;case i.pe.UNSIGNED_SHORT:if(1===s.count)t.setUint16(r+s.offset,e*o,!0);else for(let n=0;n<s.count;n++){const i=n*Uint16Array.BYTES_PER_ELEMENT;t.setUint16(r+s.offset+i,e[n]*o,!0)}break;case i.pe.INT:if(1===s.count)t.setInt32(r+s.offset,e*o,!0);else for(let n=0;n<s.count;n++){const i=n*Int32Array.BYTES_PER_ELEMENT;t.setInt32(r+s.offset+i,e[n]*o,!0)}break;case i.pe.UNSIGNED_INT:if(1===s.count)t.setUint32(r+s.offset,e*o,!0);else for(let n=0;n<s.count;n++){const i=n*Uint32Array.BYTES_PER_ELEMENT;t.setUint32(r+s.offset+i,e[n]*o,!0)}break;case i.pe.FLOAT:if(1===s.count)t.setFloat32(r+s.offset,e*o,!0);else for(let n=0;n<s.count;n++){const i=n*Float32Array.BYTES_PER_ELEMENT;t.setFloat32(r+s.offset+i,e[n]*o,!0)}break;case i.pe.HALF_FLOAT:if(1===s.count)t.setUint16(r+s.offset,(0,n.fw)(e*o),!0);else for(let i=0;i<s.count;i++){const a=i*Uint16Array.BYTES_PER_ELEMENT;t.setUint16(r+s.offset+a,(0,n.fw)(e[i]*o),!0)}}}function o(t,e,s){switch(e.type){case i.pe.BYTE:{if(1===e.count)return t.getInt8(s+e.offset);const n=[];for(let i=0;i<e.count;i++){const r=i*Int8Array.BYTES_PER_ELEMENT;n.push(t.getInt8(s+e.offset+r))}return n}case i.pe.UNSIGNED_BYTE:{if(1===e.count)return t.getUint8(s+e.offset);const n=[];for(let i=0;i<e.count;i++){const r=i*Uint8Array.BYTES_PER_ELEMENT;n.push(t.getUint8(s+e.offset+r))}return n}case i.pe.SHORT:{if(1===e.count)return t.getInt16(s+e.offset,!0);const n=[];for(let i=0;i<e.count;i++){const r=i*Int16Array.BYTES_PER_ELEMENT;n.push(t.getInt16(s+e.offset+r,!0))}return n}case i.pe.UNSIGNED_SHORT:{if(1===e.count)return t.getUint16(s+e.offset,!0);const n=[];for(let i=0;i<e.count;i++){const r=i*Uint16Array.BYTES_PER_ELEMENT;n.push(t.getUint16(s+e.offset+r,!0))}return n}case i.pe.INT:{if(1===e.count)return t.getInt32(s+e.offset,!0);const n=[];for(let i=0;i<e.count;i++){const r=i*Int32Array.BYTES_PER_ELEMENT;n.push(t.getInt32(s+e.offset+r,!0))}return n}case i.pe.UNSIGNED_INT:{if(1===e.count)return t.getUint32(s+e.offset,!0);const n=[];for(let i=0;i<e.count;i++){const r=i*Uint32Array.BYTES_PER_ELEMENT;n.push(t.getUint32(s+e.offset+r,!0))}return n}case i.pe.FLOAT:{if(1===e.count)return t.getFloat32(s+e.offset,!0);const n=[];for(let i=0;i<e.count;i++){const r=i*Float32Array.BYTES_PER_ELEMENT;n.push(t.getFloat32(s+e.offset+r,!0))}return n}case i.pe.HALF_FLOAT:{if(1===e.count)return(0,n.Kl)(t.getUint16(s+e.offset,!0));const i=[];for(let r=0;r<e.count;r++){const o=r*Uint16Array.BYTES_PER_ELEMENT;i.push((0,n.Kl)(t.getUint16(s+e.offset+o,!0)))}return i}}}},12453:(t,e,s)=>{s.d(e,{Ph:()=>r,Z0:()=>a,hU:()=>i});var n=s(96274);function i(t){const e=t.map((({name:t,count:e,type:s})=>`${t}.${e}.${s}`)).join(",");return(0,n.Wm)(e)}function r(t,e,s,n,i,o,a){if(t.primitiveName===e){let e=n?.readWithDefault(i,o,t[s]&&a);return"text"===t.type&&(e=e.toString()),void(t[s]=e)}if("type"in t&&null!=t.type){if(t.effects)for(const l of t.effects)r(l,e,s,n,i,o,a);switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.symbolLayers)for(const l of t.symbolLayers)r(l,e,s,n,i,o,a);break;case"CIMTextSymbol":t.symbol&&r(t.symbol,e,s,n,i,o,a);break;case"CIMHatchFill":t.lineSymbol&&r(t.lineSymbol,e,s,n,i,o,a);break;case"CIMPictureMarker":case"CIMCharacterMarker":case"CIMVectorMarker":if(t.markerPlacement&&r(t.markerPlacement,e,s,n,i,o,a),"CIMVectorMarker"===t.type&&t.markerGraphics)for(const l of t.markerGraphics)r(l,e,s,n,i,o,a),r(l.symbol,e,s,n,i,o,a)}}}const o=400;function a(t){const e=Math.max(1.25*t.width,20);return null!=t.effects&&t.effects.length>0?o:e}},51487:(t,e,s)=>{s.d(e,{K:()=>c});var n=s(98849),i=s(539),r=s(76724),o=(s(39831),s(9272),s(16541),s(41746),s(84852),s(68449)),a=(s(35644),s(8595)),l=s(45758);function h(t,e,s){const n=new l.R(e.width,e.height);return n.dataType=e.dataType,e.depth&&(n.depth=e.depth),e.flipped&&(n.flipped=e.flipped),e.hasMipmap&&(n.hasMipmap=e.hasMipmap),n.internalFormat=e.internalFormat,e.isImmutable&&(n.isImmutable=e.isImmutable),e.isOpaque&&(n.isOpaque=e.isOpaque),e.maxAnisotropy&&(n.maxAnisotropy=e.maxAnisotropy),n.pixelFormat=e.pixelFormat,e.preMultiplyAlpha&&(n.preMultiplyAlpha=e.preMultiplyAlpha),e.samplingMode&&(n.samplingMode=e.samplingMode),e.target&&(n.target=e.target),n.uniform=e.uniform,e.unpackAlignment&&(n.unpackAlignment=e.unpackAlignment),e.wrapMode&&(n.wrapMode=e.wrapMode),new a.g(t,n,s)}function u(t,e,s){const r=e.length;if(r!==s){const o=new n.A("Invalid Uniform",`Invalid length, expected ${s} but got ${r}`,{uniformName:t,values:e});i.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(o)}}class c{constructor(t,e,s,n,i,r){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=t,this.fragmentShader=e,this._locations=s,this._locationInfo=n,this._uniformBindings=i,this._transformFeedbackBindings=r}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(const t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){const e=this._uniforms;if(!this._program){const e=new Map;for(const[t,n]of this._locations)e.set(t,n);const s=[];for(const t of this._transformFeedbackBindings??[]){const{index:e,propertyKey:n}=t;s[e]=`v_${n}`}this._program=new o.B(t,this.vertexShader,this.fragmentShader,e,new Map,s)}const s=this._program;t.useProgram(s);for(const n of this._uniformBindings){const{shaderModulePath:i,uniformName:o,uniformType:a,uniformArrayLength:l}=n,c=(0,r.wc)(i,e);if(null==c){if("sampler2D"===a)continue;throw new Error(`Failed to find uniform value for ${i}`)}switch("array"===a||"array-2d"===a?n.uniformArrayElementType:a){case"sampler2D":{const{unit:e,texture:n}=c;if(s.setUniform1i(o,e),"type"in n)t.bindTexture(n,e);else{const s=h(t,n.descriptor,n.data);t.bindTexture(s,e)}break}case"int":if(!l){s.setUniform1i(o,c);break}u(n.uniformName,c,l),s.setUniform1iv(o,c);break;case"float":if(!l){s.setUniform1f(o,c);break}u(n.uniformName,c,l),s.setUniform1fv(o,c);break;case"vec2":if(!l){s.setUniform2f(o,c[0],c[1]);break}u(n.uniformName,c,l),s.setUniform2fv(o,c.flat());break;case"vec3":if(!l){s.setUniform3f(o,c[0],c[1],c[2]);break}u(n.uniformName,c,l),s.setUniform3fv(o,c.flat());break;case"vec4":if(!l){s.setUniform4f(o,c[0],c[1],c[2],c[3]);break}u(n.uniformName,c,l),s.setUniform4fv(o,c.flat());break;case"mat3":s.setUniformMatrix3fv(o,c);break;case"mat4":s.setUniformMatrix4fv(o,c);break;default:throw new Error(`Unable to set uniform for type ${a}`)}}}}},97394:(t,e,s)=>{s.d(e,{T:()=>i});var n=s(75472);const i={shaders:{vertexShader:(0,n.Q)("background/background.vert"),fragmentShader:(0,n.Q)("background/background.frag")},attributes:new Map([["a_pos",0]])}},13294:(t,e,s)=>{s.d(e,{H:()=>i});var n=s(75472);const i={shaders:{vertexShader:(0,n.Q)("tileInfo/tileInfo.vert"),fragmentShader:(0,n.Q)("tileInfo/tileInfo.frag")},attributes:new Map([["a_pos",0]])}},75472:(t,e,s)=>{s.d(e,{Q:()=>i});const n=new(s(29638).Z)(function(t){return function(e){let s=t;return e.split("/").forEach((t=>{s&&(s=s[t])})),s}}({background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\ngl_FragColor = u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\nvec3 v_pos = u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\ngl_Position = vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nlowp vec4 color = texture2D(u_tex, v_uv);\ngl_FragColor = color * u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position = vec4(a_pos , 0.0, 1.0);\nv_uv = a_tex;\n}"},debug:{overlay:{"overlay.frag":"precision mediump float;\nvarying vec4 v_color;\nvoid main(void) {\ngl_FragColor = v_color;\n}","overlay.vert":"attribute vec3 a_PositionAndFlags;\nuniform mat3 u_dvsMat3;\nuniform vec4 u_colors[4];\nuniform float u_opacities[4];\nvarying vec4 v_color;\nvoid main(void) {\nvec2 position = a_PositionAndFlags.xy;\nfloat flags = a_PositionAndFlags.z;\nint colorIndex = int(mod(flags, 4.0));\nvec4 color;\nfor (int i = 0; i < 4; i++) {\ncolor = u_colors[i];\nif (i == colorIndex) {\nbreak;\n}\n}\nint opacityIndex = int(mod(floor(flags / 4.0), 4.0));\nfloat opacity;\nfor (int i = 0; i < 4; i++) {\nopacity = u_opacities[i];\nif (i == opacityIndex) {\nbreak;\n}\n}\nv_color = color * opacity;\ngl_Position = vec4((u_dvsMat3 * vec3(position, 1.0)).xy, 0.0, 1.0);\n}"}},dot:{dot:{"dot.frag":"precision mediump float;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nuniform highp float u_tileZoomFactor;\nvoid main()\n{\nfloat dist = length(gl_PointCoord - vec2(.5, .5)) * 2.;\nfloat alpha = smoothstep(0., 1., v_invEdgeRatio * (dist - v_dotRatio) + 1.);\ngl_FragColor = v_color * alpha;\n}","dot.vert":"precision highp float;\nattribute vec2 a_pos;\nuniform sampler2D u_texture;\nuniform highp mat3 u_dvsMat3;\nuniform highp float u_tileZoomFactor;\nuniform highp float u_dotSize;\nuniform highp float u_pixelRatio;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nconst float EPSILON = 0.000001;\nvoid main()\n{\nmat3 tileToTileTexture = mat3(  1., 0., 0.,\n0., -1., 0.,\n0., 1., 1.  );\nvec3 texCoords = tileToTileTexture * vec3(a_pos.xy / 512., 1.);\nv_color = texture2D(u_texture, texCoords.xy);\nfloat smoothEdgeWidth = max(u_dotSize / 2., 1.) ;\nfloat z = 0.;\nz += 2.0 * step(v_color.a, EPSILON);\ngl_PointSize = (smoothEdgeWidth + u_dotSize);\ngl_Position = vec4((u_dvsMat3 * vec3(a_pos + .5, 1.)).xy, z, 1.);\nv_dotRatio = u_dotSize / gl_PointSize;\nv_invEdgeRatio = -1. / ( smoothEdgeWidth / gl_PointSize );\ngl_PointSize  *= (u_pixelRatio * u_tileZoomFactor);\n}"}},filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\nfloat b = 1.0 / 6.0;\nfloat v2 = v * v;\nfloat v3 = v2 * v;\nfloat w0 = b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\nfloat w1 = b * (3.0 * v3  - 6.0 * v2 + 4.0);\nfloat w2 = b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\nfloat w3 = b * v3;\nreturn vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\nvec4 w = computeWeights(v);\nfloat g0 = w.x + w.y;\nfloat g1 = w.z + w.w;\nfloat h0 = 1.0 - (w.y / g0) + v;\nfloat h1 = 1.0 + (w.w / g1) - v;\nreturn vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 eX = vec2(1.0 / texSize.x, 0.0);\nvec2 eY = vec2(0.0, 1.0 / texSize.y);\nvec2 texel = coords * texSize - 0.5;\nvec3 hgX = bicubicOffsetsAndWeights(fract(texel).x).xyz;\nvec3 hgY = bicubicOffsetsAndWeights(fract(texel).y).xyz;\nvec2 coords10 = coords + hgX.x * eX;\nvec2 coords00 = coords - hgX.y * eX;\nvec2 coords11 = coords10 + hgY.x * eY;\nvec2 coords01 = coords00 + hgY.x * eY;\ncoords10 = coords10 - hgY.y * eY;\ncoords00 = coords00 - hgY.y * eY;\nvec4 color00 = texture2D(sampler, coords00);\nvec4 color10 = texture2D(sampler, coords10);\nvec4 color01 = texture2D(sampler, coords01);\nvec4 color11 = texture2D(sampler, coords11);\ncolor00 = mix(color00, color01, hgY.z);\ncolor10 = mix(color10, color11, hgY.z);\ncolor00 = mix(color00, color10, hgX.z);\nreturn color00;\n}","bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 texelStart = floor(coords * texSize);\nvec2 coord0 = texelStart / texSize;\nvec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;\nvec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;\nvec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;\nvec4 color0 = texture2D(sampler, coord0);\nvec4 color1 = texture2D(sampler, coord1);\nvec4 color2 = texture2D(sampler, coord2);\nvec4 color3 = texture2D(sampler, coord3);\nvec2 blend = fract(coords * texSize);\nvec4 color01 = mix(color0, color1, blend.x);\nvec4 color23 = mix(color2, color3, blend.x);\nvec4 color = mix(color01, color23, blend.y);\n#ifdef NNEDGE\nfloat alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);\ncolor = color * alpha + (1.0 - alpha) * texture2D(sampler, coords);\n#endif\nreturn color;\n}","epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\nvec2 invSize = 1.0 / texSize;\nvec2 texel = coords * texSize;\nvec2 texel_i = floor(texel);\nvec2 texel_frac = fract(texel);\nvec4 colorP = texture2D(sampler, texel_i * invSize);\nvec4 colorP1 = vec4(colorP);\nvec4 colorP2 = vec4(colorP);\nvec4 colorP3 = vec4(colorP);\nvec4 colorP4 = vec4(colorP);\nvec4 colorA = texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\nvec4 colorB = texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\nvec4 colorC = texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\nvec4 colorD = texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\nif (colorC == colorA && colorC != colorD && colorA != colorB) {\ncolorP1 = colorA;\n}\nif (colorA == colorB && colorA != colorC && colorB != colorD) {\ncolorP2 = colorB;\n}\nif (colorD == colorC && colorD != colorB && colorC != colorA) {\ncolorP3 = colorC;\n}\nif (colorB == colorD && colorB != colorA && colorD != colorC) {\ncolorP4 = colorD;\n}\nvec4 colorP12 = mix(colorP1, colorP2, texel_frac.x);\nvec4 colorP34 = mix(colorP1, colorP2, texel_frac.x);\nreturn mix(colorP12, colorP34, texel_frac.y);\n}"},heatmap:{heatmapResolve:{"heatmapResolve.frag":"precision highp float;\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 4.0\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform sampler2D u_texture;\nuniform sampler2D u_gradient;\nuniform vec2 u_densityMinAndInvRange;\nuniform float u_densityNormalization;\nvarying vec2 v_uv;\nvoid main() {\nvec4 data = texture2D(u_texture, v_uv);\nfloat density = data.r * COMPRESSION_FACTOR;\ndensity *= u_densityNormalization;\ndensity = (density - u_densityMinAndInvRange.x) * u_densityMinAndInvRange.y;\nvec4 color = texture2D(u_gradient, vec2(density, 0.5));\ngl_FragColor = vec4(color.rgb * color.a, color.a);\n}","heatmapResolve.vert":"precision highp float;\nattribute vec2 a_pos;\nvarying vec2 v_uv;\nvoid main() {\nv_uv = a_pos;\ngl_Position = vec4(a_pos * 2.0 - 1.0, 1., 1.);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump float u_sigma;\nuniform sampler2D u_texture;\nmediump float gauss1(mediump vec2 dir) {\nreturn exp(-dot(dir, dir) / (2.0 * u_sigma * u_sigma));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\nreturn u_channelSelector * sample;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\nmediump float w = gauss1(i * u_direction.xy);\ntot += selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\nweight += w;\n}\nvoid main(void) {\nmediump float tot = 0.0;\nmediump float weight = 0.0;\naccumGauss1(-5.0, tot, weight);\naccumGauss1(-4.0, tot, weight);\naccumGauss1(-3.0, tot, weight);\naccumGauss1(-2.0, tot, weight);\naccumGauss1(-1.0, tot, weight);\naccumGauss1(0.0, tot, weight);\naccumGauss1(1.0, tot, weight);\naccumGauss1(2.0, tot, weight);\naccumGauss1(3.0, tot, weight);\naccumGauss1(4.0, tot, weight);\naccumGauss1(5.0, tot, weight);\ngl_FragColor = vec4(0.0, 0.0, 0.0, tot / weight);\n}","highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump float u_sigma;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\nmediump float y = texture2D(u_texture, v_texcoord)[3];\nconst mediump float y0 = 0.5;\nmediump float m0 = 1.0 / (sqrt(2.0 * 3.1415) * u_sigma);\nmediump float d = (y - y0) / m0;\nreturn d;\n}\nmediump vec4 shade(mediump float d) {\nmediump float mappedDistance = (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\nmappedDistance = clamp(mappedDistance, 0.0, 1.0);\nreturn texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\nmediump float d = estimateDistance();\ngl_FragColor = shade(d);\n}","textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\ngl_Position = vec4(a_position, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D filterFlags;\nuniform highp sampler2D animation;\nuniform highp sampler2D gpgpu;\nuniform highp sampler2D visualVariableData;\nuniform highp sampler2D dataDriven0;\nuniform highp sampler2D dataDriven1;\nuniform highp sampler2D dataDriven2;\nuniform float size;\nhighp vec2 getAttributeDataCoords(in highp vec3 id) {\nhighp vec3  texel = unpackDisplayIdTexel(id);\nhighp float u32 = float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256);\nhighp float col = mod(u32, size);\nhighp float row = (u32 - col) / size;\nhighp float u = col / size;\nhighp float v = row / size;\nreturn vec2(u, v);\n}\nhighp vec2 getAttributeDataTextureCoords(in highp vec3 id) {\nreturn (getAttributeDataCoords(id) * 2.0) - 1.0 + (.5 / vec2(size));\n}\nhighp vec4 getFilterData(in highp vec3 id) {\nvec2 coords = getAttributeDataCoords(id);\nreturn texture2D(filterFlags, coords);\n}\nhighp vec4 getAnimation(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(animation, coords);\n}\nhighp vec4 getVisualVariableData(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(visualVariableData, coords);\n}\nhighp vec4 getDataDriven0(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven0, coords);\n}\nhighp vec4 getDataDriven1(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven1, coords);\n}\nhighp vec4 getGPGPU(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(gpgpu, coords);\n}\nhighp vec4 getDataDriven2(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven2, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\nbool isMagic = v.x == 255.0 && v.y == 255.0;\nif (isMagic) {\nreturn NAN_MAGIC_NUMBER;\n}\nreturn (v.x + v.y * float(0x100)) - 32768.0;\n}","barycentric.glsl":"float inTriangle(vec3 bary) {\nvec3 absBary = abs(bary);\nreturn step((absBary.x + absBary.y + absBary.z), 1.05);\n}\nvec3 xyToBarycentric(in vec2 pos, in vec2 v0,  in vec2 v1, in vec2 v2) {\nmat3 xyToBarycentricMat3 = mat3(\nv1.x * v2.y - v2.x * v1.y, v2.x * v0.y - v0.x * v2.y, v0.x * v1.y - v1.x * v0.y,\nv1.y - v2.y, v2.y - v0.y, v0.y - v1.y,\nv2.x - v1.x, v0.x - v2.x, v1.x - v0.x\n);\nfloat A2 = v0.x * (v1.y - v2.y) + v1.x * (v2.y - v0.y) + v2.x * (v0.y - v1.y);\nreturn (1. / A2) * xyToBarycentricMat3 * vec3(1., pos);\n}","constants.glsl":"const float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_RAD_TO_DEG = 180.0 / 3.141592654;\nconst float POSITION_PRECISION = 1.0 / 8.0;\nconst float FILL_POSITION_PRECISION = 1.0 / 1.0;\nconst float SOFT_EDGE_RATIO = 1.0;\nconst float THIN_LINE_WIDTH_FACTOR = 1.1;\nconst float THIN_LINE_HALF_WIDTH = 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING = 1.0 / 4.0;\nconst float OFFSET_PRECISION = 1.0 / 8.0;\nconst float OUTLINE_SCALE = 1.0 / 5.0;\nconst float SDF_FONT_SIZE = 24.0;\nconst float MAX_SDF_DISTANCE = 8.0;\nconst float PLACEMENT_PADDING = 8.0;\nconst float EPSILON = 0.00001;\nconst float EPSILON_HITTEST = 0.05;\nconst int MAX_FILTER_COUNT = 2;\nconst int ATTR_VV_SIZE = 0;\nconst int ATTR_VV_COLOR = 1;\nconst int ATTR_VV_OPACITY = 2;\nconst int ATTR_VV_ROTATION = 3;\nconst highp float NAN_MAGIC_NUMBER = 1e-30;\nconst int BITSET_GENERIC_LOCK_COLOR = 1;\nconst int BITSET_GENERIC_CONSIDER_ALPHA_ONLY = 4;\nconst int BITSET_MARKER_ALIGNMENT_MAP = 0;\nconst int BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE = 2;\nconst int BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY = 3;\nconst int BITSET_TYPE_FILL_OUTLINE = 0;\nconst int BITSET_FILL_RANDOM_PATTERN_OFFSET = 2;\nconst int BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR = 3;\nconst int BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR = 5;\nconst int BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR = 6;\nconst int BITSET_LINE_SCALE_DASH = 2;",fill:{"common.glsl":"#include <materials/symbologyTypeUtils.glsl>\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying highp vec3 v_id;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying mediump vec4 v_aux1;\n#ifdef PATTERN\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvarying lowp float v_isOutline;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif","fill.frag":"precision highp float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/fill/common.glsl>\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.frag>\nlowp vec4 drawLine() {\nfloat v_lineWidth = v_aux1.x;\nvec2  v_normal    = v_aux1.yz;\nLineData inputs = LineData(\nv_color,\nv_normal,\nv_lineWidth,\nv_opacity,\nv_id\n);\nreturn shadeLine(inputs);\n}\n#endif\nlowp vec4 drawFill() {\nlowp vec4 out_color = vec4(0.);\n#ifdef HITTEST\nout_color = v_color;\n#elif defined(PATTERN)\nmediump vec4 v_tlbr = v_aux1;\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\nif (v_sampleAlphaOnly > 0.5) {\ncolor.rgb = vec3(color.a);\n}\nout_color = v_opacity * v_color * color;\n#elif SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY && !defined(HIGHLIGHT)\nvec4 textureThresholds0 = texture2D(u_dotTextures[0], v_dotTextureCoords);\nvec4 textureThresholds1 = texture2D(u_dotTextures[1], v_dotTextureCoords);\nvec4 difference0 = v_dotThresholds[0] - textureThresholds0;\nvec4 difference1 = v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\nvec4 isPositive0 = step(0.0, difference0);\nvec4 isPositive1 = step(0.0, difference1);\nfloat weightSum = dot(isPositive0, difference0) + dot(isPositive1, difference1);\nfloat lessThanEqZero = step(weightSum, 0.0);\nfloat greaterThanZero = 1.0 - lessThanEqZero ;\nfloat divisor = (weightSum + lessThanEqZero);\nvec4 weights0 = difference0 * isPositive0 / divisor;\nvec4 weights1 = difference1 * isPositive1 / divisor;\nvec4 dotColor = u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\nvec4 preEffectColor = greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\nfloat diffMax = max(max4(difference0), max4(difference1));\nfloat lessThanZero = step(diffMax, 0.0);\nfloat greaterOrEqZero = 1.0 - lessThanZero;\nvec4 isMax0 = step(diffMax, difference0);\nvec4 isMax1 = step(diffMax, difference1);\nvec4 dotColor = u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\nvec4 preEffectColor = greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\nout_color = preEffectColor;\n#else\nout_color = v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\nout_color.a = 1.0;\n#endif\nreturn out_color;\n}\nvoid main() {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (v_isOutline > 0.5) {\ngl_FragColor = drawLine();\n} else {\ngl_FragColor = drawFill();\n}\n#else\ngl_FragColor = drawFill();\n#endif\n}","fill.vert":"#include <materials/symbologyTypeUtils.glsl>\n#define PACKED_LINE\nprecision highp float;\nattribute float a_bitset;\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color = vec4(0.0, 0.0, 0.0, 1.0);\nvec2 a_zoomRange = vec2(0.0, 10000.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_aux2;\nattribute vec4 a_aux3;\n#ifndef SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\nattribute vec4 a_aux1;\nattribute vec2 a_zoomRange;\n#else\nvec2 a_zoomRange = vec2(0.0, 10000.0);\n#endif\n#endif\nuniform vec2 u_tileOffset;\nuniform vec2 u_maxIntNumOfCrossing;\n#include <util/encoding.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/fill/common.glsl>\n#include <materials/fill/hittest.glsl>\nconst float INV_SCALE_COMPRESSION_FACTOR = 1.0 / 128.0;\nconst float MAX_REPRESENTABLE_INT = 16777216.0;\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\nreturn featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.vert>\nvoid drawLine(out lowp vec4 out_color, out highp vec3 out_pos) {\nLineData outputs = buildLine(\nout_pos,\na_id,\na_pos,\na_color,\n(a_aux3.xy - 128.) / 16.,\n(a_aux3.zw - 128.) / 16.,\n0.,\na_aux2.z / 16.,\na_bitset,\nvec4(0.),\nvec2(0.),\na_aux2.w / 16.\n);\nv_id      = outputs.id;\nv_opacity = outputs.opacity;\nv_aux1    = vec4(outputs.lineHalfWidth, outputs.normal, 0.);\nout_color = outputs.color;\n}\n#endif\nvoid drawFill(out lowp vec4 out_color, out highp vec3 out_pos) {\nfloat a_bitSet = a_bitset;\nout_color = getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity = getOpacity();\nv_id      = norm(a_id);\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nmat3 tileToTileNormalized = mat3(  2. / 512.,  0.,  0.,\n0., -2. / 512.,  0.,\n-1.,  1.,  1.  );\nout_pos   = tileToTileNormalized * vec3((a_pos * FILL_POSITION_PRECISION), 1.);\n#else\nout_pos   = u_dvsMat3 * vec3(a_pos * FILL_POSITION_PRECISION, 1.);\n#endif\n#ifdef PATTERN\nvec4  a_tlbr   = a_aux1;\nfloat a_width  = a_aux2.x;\nfloat a_height = a_aux2.y;\nvec2  a_offset = a_aux2.zw;\nvec2  a_scale  = a_aux3.xy;\nfloat a_angle  = a_aux3.z;\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR) > 0.5) {\na_width *= INV_SCALE_COMPRESSION_FACTOR;\n}\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR) > 0.5) {\na_height *= INV_SCALE_COMPRESSION_FACTOR;\n}\nvec2 scale = INV_SCALE_COMPRESSION_FACTOR * a_scale;\nfloat width = u_zoomFactor * a_width * scale.x;\nfloat height = u_zoomFactor * a_height * scale.y;\nfloat angle = C_256_TO_RAD * a_angle;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nfloat dx = 0.0;\nfloat dy = 0.0;\nif (getBit(a_bitset, BITSET_FILL_RANDOM_PATTERN_OFFSET) > 0.5) {\nfloat id = rgba2float(vec4(a_id, 0.0));\ndx = rand(vec2(id, 0.0));\ndy = rand(vec2(0.0, id));\n}\nmat3 patternMatrix = mat3(cosA / width, sinA / height, 0,\n-sinA / width, cosA / height, 0,\ndx,            dy,           1);\nvec2 patternSize = vec2(a_width, a_height);\nvec2 numPatternsPerMaxInt = vec2(MAX_REPRESENTABLE_INT) / patternSize;\nvec2 maxIntCrossingOffsetCorrection = patternSize * fract(u_maxIntNumOfCrossing * numPatternsPerMaxInt);\nvec2 tileOffset = u_tileOffset + maxIntCrossingOffsetCorrection - 0.5 * patternSize;\ntileOffset = vec2(tileOffset.x * cosA - tileOffset.y * sinA, tileOffset.x * sinA + tileOffset.y * cosA);\ntileOffset = mod(tileOffset, patternSize);\nvec2 symbolOffset = u_zoomFactor * scale * vec2(a_offset - tileOffset) / vec2(width, height);\nv_tileTextureCoord = (patternMatrix * vec3(a_pos * FILL_POSITION_PRECISION, 1.0)).xy - symbolOffset;\nv_aux1 = a_tlbr / u_mosaicSize.xyxy;\nv_sampleAlphaOnly = getBit(a_bitset, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\nif (getBit(a_bitSet, BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR) > 0.5) {\n#ifdef VV_COLOR\nv_sampleAlphaOnly *= (1.0 - float(isNan(VV_ADATA[ATTR_VV_COLOR]))) * (1.0 - getBit(a_bitSet, BITSET_GENERIC_LOCK_COLOR));\n#else\nv_sampleAlphaOnly = 0.0;\n#endif\n}\n#elif SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 ddAttributeData0 = getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\nvec4 ddAttributeData1 = getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\nfloat size = u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\nv_dotThresholds[0] = dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\nv_dotThresholds[1] = dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\nv_dotTextureCoords = (a_pos * FILL_POSITION_PRECISION + 0.5) / size;\n#endif\n}\n#ifdef HITTEST\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE) > 0.5) {\nout_pos = vec3(0., 0., 2.);\nreturn;\n}\n#endif\nhittestFill(out_color, out_pos);\ngl_PointSize = 1.0;\n}\n#elif defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\nv_isOutline = getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE);\nif (v_isOutline > 0.5) {\ndrawLine(out_color, out_pos);\n} else {\ndrawFill(out_color, out_pos);\n}\n}\n#else\n#define draw drawFill\n#endif\nvoid main()\n{\nINIT;\nhighp vec3 pos  = vec3(0.);\nhighp vec4 color  = vec4(0.);\ndraw(color, pos);\nv_color = color;\ngl_Position = vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}","hittest.glsl":"#ifdef HITTEST\n#include <materials/hittest/common.glsl>\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestFill(\nout lowp vec4 out_color,\nout highp vec3 out_pos\n) {\nvec3 pos        = u_viewMat3 * u_tileMat3 * vec3(a_pos  * FILL_POSITION_PRECISION, 1.);\nvec3 pos1       = u_viewMat3 * u_tileMat3 * vec3(a_pos1 * FILL_POSITION_PRECISION, 1.);\nvec3 pos2       = u_viewMat3 * u_tileMat3 * vec3(a_pos2 * FILL_POSITION_PRECISION, 1.);\nfloat hittestDist = u_hittestDist;\nfloat dist = distPointTriangle(u_hittestPos, pos.xy, pos1.xy, pos2.xy);\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist < 0. || dist >= hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, dist == 0. ? (1. / 255.) : 0.);\n}\n#endif"},hittest:{"common.glsl":"#ifdef HITTEST\nuniform float hittestDist;\nuniform highp vec2 hittestPos;\nfloat projectScalar(vec2 a, vec2 b) {\nreturn dot(a, normalize(b));\n}\nfloat distPointSegment(vec2 p0, vec2 p1, vec2 p2) {\nvec2 L = p2 - p1;\nvec2 A = p0 - p1;\nfloat projAL = projectScalar(A, L);\nfloat t = clamp(projAL / length(L), 0., 1.);\nreturn distance(p0, p1 + t * (p2 - p1));\n}\nvoid hittestMarker(out lowp vec4 out_color, out highp vec3 out_pos, in highp vec3 pos, float size) {\nfloat dist = distance(pos, vec3(hittestPos, 1.));\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif ((dist - size) > hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, (dist - size) < 0. ? (1. / 255.) : 0.);\n}\nfloat intersectPointTriangleBary(vec2 p, vec2 a, vec2 b, vec2 c) {\nreturn inTriangle(xyToBarycentric(p, a, b, c));\n}\nfloat distPointTriangle(vec2 p, vec2 a, vec2 b, vec2 c) {\nvec2 ba = b - a;\nvec2 ca = c - a;\nfloat crossProduct = ba.x * ca.y - ca.x * ba.y;\nbool isParallel = crossProduct < EPSILON_HITTEST && crossProduct > -EPSILON_HITTEST;\nif (isParallel) {\nreturn -1.;\n}\nif (intersectPointTriangleBary(p.xy, a, b, c) == 1.) {\nreturn 0.;\n}\nfloat distAB = distPointSegment(p, a, b);\nfloat distBC = distPointSegment(p, b, c);\nfloat distCA = distPointSegment(p, c, a);\nreturn min(min(distAB, distBC), distCA);\n}\n#endif"},icon:{"common.glsl":"#include <util/encoding.glsl>\nuniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif\n#ifdef SDF\nvec4 getColor(vec2 v_size, vec2 v_tex) {\n#ifdef HITTEST\nlowp vec4 fillPixelColor = vec4(1.0);\n#else\nlowp vec4 fillPixelColor = v_color;\n#endif\nfloat d = 0.5 - rgba2float(texture2D(u_texture, v_tex));\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * size * SOFT_EDGE_RATIO * v_distRatio;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nfloat outlineWidth = v_outlineWidth;\n#ifdef HIGHLIGHT\noutlineWidth = max(outlineWidth, 4.0 * v_isThin);\n#endif\nif (outlineWidth > 0.25) {\nlowp vec4 outlinePixelColor = v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\nfloat clampedOutlineSize = min(outlineWidth, size);\noutlinePixelColor *= clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\nreturn v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n}\nreturn v_opacity * fillPixelColor;\n}\n#else\nvec4 getColor(vec2 _v_size, vec2 v_tex) {\nlowp vec4 texColor = texture2D(u_texture, v_tex);\nreturn v_opacity * texColor * v_color;\n}\n#endif",heatmapAccumulate:{"common.glsl":"varying lowp vec4 v_hittestResult;\nvarying mediump vec2 v_offsetFromCenter;\nvarying highp float v_fieldValue;","heatmapAccumulate.frag":"precision mediump float;\n#include <materials/icon/heatmapAccumulate/common.glsl>\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 0.25\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform lowp sampler2D u_texture;\nvoid main() {\n#ifdef HITTEST\ngl_FragColor = v_hittestResult;\n#else\nfloat radius = length(v_offsetFromCenter);\nfloat shapeWeight = step(radius, 1.0);\nfloat oneMinusRadiusSquared = 1.0 - radius * radius;\nfloat kernelWeight = oneMinusRadiusSquared * oneMinusRadiusSquared;\ngl_FragColor = vec4(shapeWeight * kernelWeight * v_fieldValue * COMPRESSION_FACTOR);\n#endif\n}","heatmapAccumulate.vert":"precision highp float;\nattribute vec2 a_vertexOffset;\nvec4 a_color = vec4(0.0);\nvec2 a_zoomRange = vec2(0.0, 10000.0);\nuniform float u_radius;\nuniform float u_isFieldActive;\n#include <materials/vcommon.glsl>\n#include <materials/hittest/common.glsl>\n#include <materials/icon/heatmapAccumulate/common.glsl>\nvoid main() {\nfloat filterFlags = getFilterFlags();\n#ifdef HITTEST\nhighp vec4 out_hittestResult = vec4(0.);\nhighp vec3 out_pos = vec3(0.);\nvec3 pos = u_viewMat3 * u_tileMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nhittestMarker(out_hittestResult, out_pos, pos, u_radius);\nv_hittestResult = out_hittestResult;\ngl_PointSize = 1.;\ngl_Position = vec4(clip(a_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\nv_offsetFromCenter = sign(a_vertexOffset);\nv_fieldValue = getAttributeData2(a_id).x * u_isFieldActive + 1.0 - u_isFieldActive;\nvec3 centerPos = u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nvec3 vertexPos = centerPos + u_displayViewMat3 * vec3(v_offsetFromCenter, 0.0) * u_radius;\ngl_Position = vec4(clip(a_color, vertexPos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},"hittest.glsl":"#ifdef HITTEST\n#include <materials/hittest/common.glsl>\nattribute vec2 a_vertexOffset1;\nattribute vec2 a_vertexOffset2;\nattribute vec2 a_texCoords1;\nattribute vec2 a_texCoords2;\nvec2 getTextureCoords(in vec3 bary, in vec2 texCoords0, in vec2 texCoords1, in vec2 texCoords2) {\nreturn texCoords0 * bary.x + texCoords1 * bary.y + texCoords2 * bary.z;\n}\nvoid hittestIcon(\ninout lowp vec4 out_color,\nout highp vec3 out_pos,\nin vec3 pos,\nin vec3 offset,\nin vec2 size,\nin float scaleFactor,\nin float isMapAligned\n) {\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nvec3 posBase = u_viewMat3 * u_tileMat3  * pos;\nvec3 offset1 = scaleFactor * vec3(a_vertexOffset1 / 16.0, 0.);\nvec3 offset2 = scaleFactor * vec3(a_vertexOffset2 / 16.0, 0.);\nvec2 pos0    = (posBase + getMatrixNoDisplay(isMapAligned) * offset).xy;\nvec2 pos1    = (posBase + getMatrixNoDisplay(isMapAligned) * offset1).xy;\nvec2 pos2    = (posBase + getMatrixNoDisplay(isMapAligned) * offset2).xy;\nvec3 bary0 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary1 = xyToBarycentric(u_hittestPos + vec2(0., -u_hittestDist), pos0, pos1, pos2);\nvec3 bary2 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary3 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary4 = xyToBarycentric(u_hittestPos, pos0, pos1, pos2);\nvec3 bary5 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary6 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec3 bary7 = xyToBarycentric(u_hittestPos + vec2(0., u_hittestDist), pos0, pos1, pos2);\nvec3 bary8 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec2 tex0 = a_texCoords  / u_mosaicSize;\nvec2 tex1 = a_texCoords1 / u_mosaicSize;\nvec2 tex2 = a_texCoords2 / u_mosaicSize;\nfloat alphaSum = 0.;\nalphaSum += inTriangle(bary0) * getColor(size, getTextureCoords(bary0, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary1) * getColor(size, getTextureCoords(bary1, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary2) * getColor(size, getTextureCoords(bary2, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary3) * getColor(size, getTextureCoords(bary3, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary4) * getColor(size, getTextureCoords(bary4, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary5) * getColor(size, getTextureCoords(bary5, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary6) * getColor(size, getTextureCoords(bary6, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary7) * getColor(size, getTextureCoords(bary7, tex0, tex1, tex2)).a;\nout_pos.z += step(alphaSum, .05) * 2.0;\nout_color = vec4(1. / 255., 0., 0., alphaSum / 255.);\n}\n#endif","icon.frag":"precision mediump float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/icon/common.glsl>\nvoid main()\n{\n#ifdef HITTEST\nvec4 color = v_color;\n#else\nvec4 color = getColor(v_sizeTex.xy, v_sizeTex.zw);\n#endif\n#ifdef HIGHLIGHT\ncolor.a = step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor = color;\n}","icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\n#include <materials/vcommon.glsl>\n#include <materials/icon/common.glsl>\n#include <materials/icon/hittest.glsl>\nfloat getMarkerScaleFactor(inout vec2 size, in float referenceSize) {\n#ifdef VV_SIZE\nfloat f = getSize(size.y) / size.y;\nfloat sizeFactor = size.y / referenceSize;\nreturn getSize(referenceSize) / referenceSize;\n#else\nreturn 1.;\n#endif\n}\nvoid main()\n{\nINIT;\nfloat a_bitSet = a_bitSetAndDistRatio.x;\nvec3  pos           = vec3(a_pos * POSITION_PRECISION, 1.0);\nvec2  size          = a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec3  offset        = vec3(a_vertexOffset / 16.0, 0.);\nfloat outlineSize   = a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\nfloat isMapAligned  = getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nfloat referenceSize = a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0;\nfloat scaleSymbolProportionally = getBit(a_bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\nfloat scaleFactor               = getMarkerScaleFactor(size, referenceSize);\nsize.xy     *= scaleFactor;\noffset.xy   *= scaleFactor;\noutlineSize *= scaleSymbolProportionally * (scaleFactor - 1.0) + 1.0;\nvec2 v_tex   = a_texCoords / u_mosaicSize;\nfloat filterFlags = getFilterFlags();\nv_color    = getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity  = getOpacity();\nv_id       = norm(a_id);\nv_pos      = u_dvsMat3 * pos + getMatrix(isMapAligned) * getRotation()  * offset;\nv_sizeTex  = vec4(size.xy, v_tex.xy);\n#ifdef SDF\nv_isThin   = getBit(a_bitSet, BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE);\n#ifdef VV_COLOR\nv_overridingOutlineColor = v_isThin;\n#else\nv_overridingOutlineColor = 0.0;\n#endif\nv_outlineWidth = min(outlineSize, max(max(size.x, size.y) - 0.99, 0.0));\nv_outlineColor = a_outlineColor;\nv_distRatio = a_bitSetAndDistRatio.y / 128.0;\n#endif\n#ifdef HITTEST\nhighp vec4 out_color = vec4(0.);\nhighp vec3 out_pos   = vec3(0.);\nhittestIcon(out_color, out_pos, pos, offset, size, scaleFactor, isMapAligned);\nv_color = out_color;\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position = vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include <materials/text/text.frag>","label.vert":"precision highp float;\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\nfloat glyphAngle = angle * 360.0 / 254.0;\nfloat mapAngle = u_mapRotation * 360.0 / 254.0;\nfloat diffAngle = min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\nfloat z = 0.0;\nz += u_mapAligned * (2.0 * (1.0 - step(minZoom, u_currentZoom)));\nz += u_mapAligned * 2.0 * step(90.0, diffAngle);\nz += 2.0 * (1.0 - step(u_currentZoom, maxZoom));\nreturn z;\n}\nvoid main()\n{\nINIT;\nfloat groupMinZoom    = getMinZoom();\nfloat glyphMinZoom    = a_glyphData.x;\nfloat glyphMaxZoom    = a_glyphData.y;\nfloat glyphAngle      = a_glyphData.z;\nfloat a_isBackground  = a_glyphData.w;\nfloat a_minZoom          = max(groupMinZoom, glyphMinZoom);\nfloat a_placementPadding = a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\nvec2  a_placementDir     = unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\nfloat a_refSymbolSize    = a_refSymbolAndPlacementOffset.y;\nfloat fontSize           = a_texAndSize.z;\nfloat haloSize           = a_texAndSize.w * OUTLINE_SCALE;\nvec2  vertexOffset = a_vertexOffset * OFFSET_PRECISION;\nvec3  pos          = vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat z            = getZ(a_minZoom, glyphMaxZoom, glyphAngle);\nfloat fontScale    = fontSize / SDF_FONT_SIZE;\nfloat halfSize     = getSize(a_refSymbolSize) / 2.0;\nfloat animation    = pow(getAnimationState(), vec4(2.0)).r;\nfloat isText = 1.0 - a_isBackground;\nfloat isBackground = u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor = (isBackground + isText) * a_color;\nv_color     = animation * ((1.0 - u_isHaloPass) * nonHaloColor + (u_isHaloPass * a_haloColor));\nv_opacity   = 1.0;\nv_tex       = a_texCoords / u_mosaicSize;\nv_edgeDistanceOffset = u_isHaloPass * haloSize / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\nvec2 placementOffset = a_placementDir * (halfSize + a_placementPadding);\nvec3 glyphOffset     = u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\nvec3 v_pos           = vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\nfloat isHidden = u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z += 2.0 * isHidden;\ngl_Position = vec4(v_pos, 1.0);\n#ifdef DEBUG\nv_color = vec4(a_color.rgb, z == 0.0 ? 1.0 : 0.645);\n#endif\n}"},line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif\n#ifdef SDF\nvarying mediump float v_lineWidthRatio;\n#endif","hittest.glsl":"#include <materials/hittest/common.glsl>\n#ifdef HITTEST\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestLine(out lowp vec4 out_color, out highp vec3 out_pos, float halfWidth) {\nvec3 pos        = u_viewMat3 * u_tileMat3 * vec3(a_pos  * POSITION_PRECISION, 1.);\nvec3 pos1       = u_viewMat3 * u_tileMat3 * vec3(a_pos1 * POSITION_PRECISION, 1.);\nvec3 pos2       = u_viewMat3 * u_tileMat3 * vec3(a_pos2 * POSITION_PRECISION, 1.);\nvec3 outTextureCoords = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nfloat dist = min(distPointSegment(u_hittestPos, pos.xy, pos1.xy),\ndistPointSegment(u_hittestPos, pos.xy, pos2.xy)) - halfWidth;\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist >= u_hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, dist <= 0. ? (1. / 255.) : 0.);\n}\n#endif","line.frag":"precision lowp float;\n#include <util/encoding.glsl>\n#include <materials/constants.glsl>\n#include <materials/symbologyTypeUtils.glsl>\n#include <materials/line/common.glsl>\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.frag>\n#ifdef HITTEST\nvoid main() {\ngl_FragColor = v_color;\n}\n#else\nvoid main() {\nLineData inputs = LineData(\nv_color,\nv_normal,\nv_lineHalfWidth,\nv_opacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr,\nv_patternSize,\n#endif\n#ifdef SDF\nv_lineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance,\n#endif\n#endif\nv_id\n);\ngl_FragColor = shadeLine(inputs);\n}\n#endif","line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\nattribute vec2 a_zoomRange;\n#include <materials/vcommon.glsl>\n#include <materials/symbologyTypeUtils.glsl>\n#include <materials/line/common.glsl>\n#include <materials/line/hittest.glsl>\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.vert>\n#ifdef HITTEST\nvoid draw() {\nfloat aa        = 0.5 * u_antialiasing;\nfloat a_halfWidth = a_accumulatedDistanceAndHalfWidth.y / 16.;\nfloat a_cimHalfWidth = a_aux.x / 16. ;\nvec2  a_offset = a_offsetAndNormal.xy / 16.;\nfloat baseWidth = getBaseLineHalfWidth(a_halfWidth, a_cimHalfWidth);\nfloat halfWidth = getLineHalfWidth(baseWidth, aa);\nhighp vec3 pos  = vec3(0.);\nv_color = vec4(0.);\nhittestLine(v_color, pos, halfWidth);\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#else\nvoid draw()\n{\nhighp vec3 pos = vec3(0.);\nLineData outputs = buildLine(\npos,\na_id,\na_pos,\na_color,\na_offsetAndNormal.xy / 16.,\na_offsetAndNormal.zw / 16.,\na_accumulatedDistanceAndHalfWidth.x,\na_accumulatedDistanceAndHalfWidth.y / 16.,\na_segmentDirection.w,\na_tlbr,\na_segmentDirection.xy / 16.,\na_aux.x / 16.\n);\nv_id              = outputs.id;\nv_color           = outputs.color;\nv_normal          = outputs.normal;\nv_lineHalfWidth   = outputs.lineHalfWidth;\nv_opacity         = outputs.opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr          = outputs.tlbr;\nv_patternSize   = outputs.patternSize;\n#endif\n#ifdef SDF\nv_lineWidthRatio = outputs.lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance = outputs.accumulatedDistance;\n#endif\n#endif\ngl_Position = vec4(clip(outputs.color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#endif\nvoid main() {\nINIT;\ndraw();\n}"},pie:{"pie.common.glsl":"uniform float outlineWidth;\nuniform mediump float sectorThreshold;\nvarying vec3  v_id;\nvarying vec3  v_pos;\nvarying vec2  v_offset;\nvarying vec4  v_color;\nvarying float v_size;\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nvarying vec2  v_filteredSectorToColorId[numberOfFields];\nvarying vec2  v_texCoords;\nvarying float v_outlineWidth;\nvarying float v_opacity;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};","pie.frag":"precision highp float;\n#include <util/atan2.glsl>\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/pie/pie.common.glsl>\nuniform lowp vec4 colors[numberOfFields];\nuniform lowp vec4 defaultColor;\nuniform lowp vec4 othersColor;\nuniform lowp vec4 outlineColor;\nuniform float donutRatio;\nlowp vec4 getSectorColor(in int index, in vec2 filteredSectorToColorId[numberOfFields]) {\nmediump int colorIndex = int(filteredSectorToColorId[index].y);\nreturn colors[colorIndex];\n}\nconst int OTHER_SECTOR_ID = 255;\n#ifdef HITTEST\nvec4 getColor() {\nfloat distanceSize = length(v_offset) * v_size;\nfloat donutSize = donutRatio * v_size;\nfloat alpha = step(donutSize, distanceSize) * (1.0 - step(v_size, distanceSize));\nreturn v_color;\n}\n#else\nvec4 getColor() {\nfloat angle = 90.0 - C_RAD_TO_DEG * atan2(v_offset.y, v_offset.x);\nif (angle < 0.0) {\nangle += 360.0;\n} else if (angle > 360.0) {\nangle = mod(angle, 360.0);\n}\nint numOfEntries = int(v_numOfEntries);\nfloat maxSectorAngle = v_maxSectorAngle;\nlowp vec4 fillColor = (maxSectorAngle > 0.0 || sectorThreshold > 0.0) ? othersColor : defaultColor;\nlowp vec4 prevColor = vec4(0.0);\nlowp vec4 nextColor = vec4(0.0);\nfloat startSectorAngle = 0.0;\nfloat endSectorAngle = 0.0;\nif (angle < maxSectorAngle) {\nfor (int index = 0; index < numberOfFields; ++index) {\nstartSectorAngle = endSectorAngle;\nendSectorAngle = v_filteredSectorToColorId[index].x;\nif (endSectorAngle > angle) {\nfillColor = getSectorColor(index, v_filteredSectorToColorId);\nprevColor = sectorThreshold != 0.0 && index == 0 && abs(360.0 - maxSectorAngle) < EPSILON ? othersColor :\ngetSectorColor(index > 0 ? index - 1 : numOfEntries - 1, v_filteredSectorToColorId);\nnextColor = sectorThreshold != 0.0 && abs(endSectorAngle - maxSectorAngle) < EPSILON ? othersColor :\ngetSectorColor(index < numOfEntries - 1 ? index + 1 : 0, v_filteredSectorToColorId);\nbreak;\n}\nif (index == numOfEntries - 1) {\nbreak;\n}\n}\n} else {\nprevColor = getSectorColor(numOfEntries - 1, v_filteredSectorToColorId);\nnextColor = getSectorColor(0, v_filteredSectorToColorId);\nstartSectorAngle = maxSectorAngle;\nendSectorAngle = 360.0;\n}\nlowp vec4 outlineColor = outlineColor;\nfloat offset = length(v_offset);\nfloat distanceSize = offset * v_size;\nif (startSectorAngle != 0.0 || endSectorAngle != 360.0) {\nfloat distanceToStartSector = (angle - startSectorAngle);\nfloat distanceToEndSector = (endSectorAngle - angle);\nfloat sectorThreshold = 0.6;\nfloat beginSectorAlpha = smoothstep(0.0, sectorThreshold, distanceToStartSector * offset);\nfloat endSectorAlpha = smoothstep(0.0, sectorThreshold, distanceToEndSector * offset);\nif (endSectorAlpha > 0.0) {\nfillColor = mix(nextColor, fillColor, endSectorAlpha);\n} else if (beginSectorAlpha > 0.0) {\nfillColor = mix(prevColor, fillColor, beginSectorAlpha);\n}\n}\nfloat donutSize = donutRatio * (v_size - v_outlineWidth);\nfloat endOfDonut = donutSize - v_outlineWidth;\nfloat aaThreshold = 0.75;\nfloat innerCircleAlpha = endOfDonut - aaThreshold > 0.0 ? smoothstep(endOfDonut - aaThreshold, endOfDonut + aaThreshold, distanceSize) : 1.0;\nfloat outerCircleAlpha = 1.0 - smoothstep(v_size - aaThreshold, v_size + aaThreshold , distanceSize);\nfloat circleAlpha = innerCircleAlpha * outerCircleAlpha;\nfloat startOfOutline = v_size - v_outlineWidth;\nif (startOfOutline > 0.0 && v_outlineWidth > 0.25) {\nfloat outlineFactor = smoothstep(startOfOutline - aaThreshold, startOfOutline + aaThreshold, distanceSize);\nfloat innerLineFactor = donutSize - aaThreshold > 0.0 ? 1.0 - smoothstep(donutSize - aaThreshold, donutSize + aaThreshold , distanceSize) : 0.0;\nfillColor = mix(fillColor, outlineColor, innerLineFactor + outlineFactor);\n}\nreturn v_opacity * circleAlpha * fillColor;\n}\n#endif\nvoid main()\n{\nvec4 color = getColor();\n#ifdef highlight\ncolor.a = step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor = color;\n}","pie.vert":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/barycentric.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/vv.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/pie/pie.common.glsl>\n#include <materials/hittest/common.glsl>\nattribute float a_bitSet;\nattribute vec2  a_offset;\nattribute vec2  a_texCoords;\nattribute vec2  a_size;\nattribute float a_referenceSize;\nattribute vec2  a_zoomRange;\nint filterValue(in float sectorAngle,\nin int currentIndex,\ninout FilteredChartInfo filteredInfo,\ninout vec2 filteredSectorToColorId[numberOfFields]) {\nif (sectorAngle > sectorThreshold * 360.0) {\nfilteredInfo.endSectorAngle += sectorAngle;\nfilteredSectorToColorId[filteredInfo.colorId] = vec2(filteredInfo.endSectorAngle, currentIndex);\n++filteredInfo.colorId;\n}\nreturn 0;\n}\nint filterValues(inout vec2 filteredSectorToColorId[numberOfFields],\ninout FilteredChartInfo filteredInfo,\nin float sectorAngles[numberOfFields]) {\nfor (int index = 0; index < numberOfFields; ++index) {\nfloat sectorValue = sectorAngles[index];\nfilterValue(sectorValue, index, filteredInfo, filteredSectorToColorId);\n}\nreturn filteredInfo.colorId;\n}\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float a_referenceSize, in float bitSet) {\nvec2 outSize = baseSize;\n#ifdef VV_SIZE\nfloat r = getSize(a_referenceSize, currentScale) / a_referenceSize;\noutSize.xy *= r;\noffset.xy *= r;\nfloat scaleSymbolProportionally = getBit(bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\noutlineSize *= scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\nreturn outSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\nfloat isMapAligned = getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nvec3  offset       = vec3(in_offset, 0.0);\nreturn getMatrix(isMapAligned) * offset;\n}\nfloat filterNaNValues(in float value) {\nreturn value != NAN_MAGIC_NUMBER && value > 0.0 ? value : 0.0;\n}\nvoid main()\n{\nINIT;\nvec2  a_size   = a_size;\nvec2  a_offset = a_offset / 16.0;\nfloat outlineSize = outlineWidth;\nfloat a_bitSet = a_bitSet;\nfloat a_referenceSize = a_referenceSize;\nvec2 a_texCoords = a_texCoords / 4.0;\nvec2 markerSize = getMarkerSize(a_offset, a_size, outlineSize, a_referenceSize, a_bitSet);\nfloat filterFlags = getFilterFlags();\nvec3  pos         = vec3(a_pos / 10.0, 1.0);\nv_opacity      = getOpacity();\nv_id           = norm(a_id);\nv_pos          = displayViewScreenMat3 * pos + getOffset(a_offset, a_bitSet);\nv_offset       = sign(a_texCoords - 0.5);\nv_size         = max(markerSize.x, markerSize.y);\nv_outlineWidth = outlineSize;\nfloat attributeData[10];\nvec4 attributeData3 = getDataDriven0(a_id);\nattributeData[0] = filterNaNValues(attributeData3.x);\nattributeData[1] = filterNaNValues(attributeData3.y);\nattributeData[2] = filterNaNValues(attributeData3.z);\nattributeData[3] = filterNaNValues(attributeData3.w);\n#if (numberOfFields > 4)\nvec4 attributeData4 = getDataDriven1(a_id);\nattributeData[4] = filterNaNValues(attributeData4.x);\nattributeData[5] = filterNaNValues(attributeData4.y);\nattributeData[6] = filterNaNValues(attributeData4.z);\nattributeData[7] = filterNaNValues(attributeData4.w);\n#endif\n#if (numberOfFields > 8)\nvec4 attributeData5 = getDataDriven2(a_id);\nattributeData[8] = filterNaNValues(attributeData5.x);\nattributeData[9] = filterNaNValues(attributeData5.y);\n#endif\nfloat sum = 0.0;\nfor (int i = 0; i < numberOfFields; ++i) {\nsum += attributeData[i];\n}\nfloat sectorAngles[numberOfFields];\nfor (int i = 0; i < numberOfFields; ++i) {\nsectorAngles[i] = 360.0 * attributeData[i] / sum;\n}\nvec2 filteredSectorToColorId[numberOfFields];\nFilteredChartInfo filteredInfo = FilteredChartInfo(0.0, 0);\nint numOfEntries = filterValues(filteredSectorToColorId, filteredInfo, sectorAngles);\nv_numOfEntries = float(numOfEntries);\nv_maxSectorAngle = filteredInfo.endSectorAngle;\nv_filteredSectorToColorId = filteredSectorToColorId;\n#ifdef HITTEST\nhighp vec3 out_pos = vec3(0.0);\nv_color            = vec4(0.0);\nhittestMarker(v_color, out_pos, viewMat3 * tileMat3 *  pos, v_size);\ngl_PointSize = 1.0;\ngl_Position = vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position = vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},shared:{line:{"common.glsl":"#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && defined(PATTERN)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\nstruct LineData {\nlowp vec4 color;\nmediump vec2 normal;\nmediump float lineHalfWidth;\nlowp float opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nmediump vec4 tlbr;\nmediump vec2 patternSize;\n#endif\n#ifdef SDF\nmediump float lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nhighp float accumulatedDistance;\n#endif\n#endif\nhighp vec3 id;\n};","line.frag":"uniform lowp float u_blur;\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && !defined(HIGHLIGHT)\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\nuniform highp float u_pixelRatio;\n#endif\n#endif\n#if defined(SDF) && !defined(HIGHLIGHT) && !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float adjustedPatternWidth = line.patternSize.x * 2.0 * line.lineWidthRatio;\nmediump float relativeTexX = fract(line.accumulatedDistance / adjustedPatternWidth);\nmediump float relativeTexY = 0.5 + 0.25 * line.normal.y;\nmediump vec2 texCoord = mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * line.lineHalfWidth;\nreturn line.opacity * clamp(0.5 - dist, 0.0, 1.0) * line.color;\n}\n#elif defined(PATTERN) && !defined(HIGHLIGHT) && !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float lineHalfWidth = line.lineHalfWidth;\nmediump float adjustedPatternHeight = line.patternSize.y * 2.0 * lineHalfWidth / line.patternSize.x;\nmediump float relativeTexY = fract(line.accumulatedDistance / adjustedPatternHeight);\nmediump float relativeTexX = 0.5 + 0.5 * line.normal.y;\nmediump vec2 texCoord = mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\n#ifdef VV_COLOR\nif (v_sampleAlphaOnly > 0.5) {\ncolor.rgb = vec3(color.a);\n}\n#endif\nreturn line.opacity * line.color * color;\n}\n#else\nlowp vec4 getLineColor(LineData line) {\nreturn line.opacity * line.color;\n}\n#endif\nvec4 shadeLine(LineData line)\n{\nmediump float thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(line.lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nmediump float fragDist = length(line.normal) * line.lineHalfWidth;\nlowp float alpha = clamp(thinLineFactor * (line.lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\nlowp vec4 out_color = getLineColor(line) * alpha;\n#ifdef HIGHLIGHT\nout_color.a = step(1.0 / 255.0, out_color.a);\n#endif\n#ifdef ID\nif (out_color.a < 1.0 / 255.0) {\ndiscard;\n}\nout_color = vec4(line.id, 0.0);\n#endif\nreturn out_color;\n}","line.vert":"float getBaseLineHalfWidth(in float lineHalfWidth, in float referenceHalfWidth) {\n#ifdef VV_SIZE\nfloat refLineWidth = 2.0 * referenceHalfWidth;\nreturn 0.5 * (lineHalfWidth / max(referenceHalfWidth, EPSILON)) * getSize(refLineWidth);\n#else\nreturn lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\nfloat halfWidth = max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\nhalfWidth = max(halfWidth, 2.0);\n#endif\nreturn halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\nfloat thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nreturn thinLineFactor * halfWidth * offset;\n}\nLineData buildLine(\nout vec3 out_pos,\nin vec3 in_id,\nin vec2 in_pos,\nin vec4 in_color,\nin vec2 in_offset,\nin vec2 in_normal,\nin float in_accumulatedDist,\nin float in_lineHalfWidth,\nin float in_bitSet,\nin vec4 in_tlbr,\nin vec2 in_segmentDirection,\nin float in_referenceHalfWidth\n)\n{\nfloat aa        = 0.5 * u_antialiasing;\nfloat baseWidth = getBaseLineHalfWidth(in_lineHalfWidth, in_referenceHalfWidth);\nfloat halfWidth = getLineHalfWidth(baseWidth, aa);\nfloat z         = 2.0 * step(baseWidth, 0.0);\nvec2  dist      = getDist(in_offset, halfWidth);\nvec3  offset    = u_displayViewMat3 * vec3(dist, 0.0);\nvec3  pos       = u_dvsMat3 * vec3(in_pos * POSITION_PRECISION, 1.0) + offset;\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvec4  color     = in_color;\nfloat opacity   = 1.0;\n#else\nvec4  color     = getColor(in_color, in_bitSet, BITSET_GENERIC_LOCK_COLOR);\nfloat opacity   = getOpacity();\n#ifdef SDF\nconst float SDF_PATTERN_HALF_WIDTH = 15.5;\nfloat scaleDash = getBit(in_bitSet, BITSET_LINE_SCALE_DASH);\nfloat lineWidthRatio = (scaleDash * max(halfWidth - 0.55 * u_antialiasing, 0.25) + (1.0 - scaleDash)) / SDF_PATTERN_HALF_WIDTH;\n#endif\n#endif\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && defined(PATTERN)\nv_sampleAlphaOnly = getBit(in_bitSet, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\n#endif\nout_pos = vec3(pos.xy, z);\nreturn LineData(\ncolor,\nin_normal,\nhalfWidth,\nopacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nin_tlbr / u_mosaicSize.xyxy,\nvec2(in_tlbr.z - in_tlbr.x, in_tlbr.w - in_tlbr.y),\n#endif\n#ifdef SDF\nlineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nin_accumulatedDist * u_zoomFactor + dot(in_segmentDirection, dist),\n#endif\n#endif\nnorm(in_id)\n);\n}"}},"symbologyTypeUtils.glsl":"#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL || SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_SIMPLE || SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\n#endif",text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec3 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","hittest.glsl":"#include <materials/hittest/common.glsl>","text.frag":"precision mediump float;\n#include <materials/text/common.glsl>\nuniform lowp sampler2D u_texture;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor()\n{\nfloat SDF_CUTOFF = (2.0 / 8.0);\nfloat SDF_BASE_EDGE_DIST = 1.0 - SDF_CUTOFF;\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float edge = SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\nedge /= 2.0;\n#endif\nlowp float aa = v_antialiasingWidth;\nlowp float alpha = smoothstep(edge - aa, edge + aa, dist);\nreturn alpha * v_color * v_opacity;\n}\n#endif\nvoid main()\n{\ngl_FragColor = getColor();\n}","text.vert":"precision highp float;\n#include <materials/utils.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\n#include <materials/text/hittest.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_zoomRange;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nfloat getTextSize(inout vec2 offset, inout float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\nfloat r = getSize(referenceSize) / referenceSize;\nbaseSize *= r;\noffset.xy *= r;\nreturn baseSize;\n#endif\nreturn baseSize;\n}\nvoid main()\n{\nINIT;\nfloat a_isBackground  = a_aux.y;\nfloat a_referenceSize = a_aux.z * a_aux.z / 256.0;\nfloat a_bitSet        = a_aux.w;\nfloat a_fontSize      = a_texFontSize.z;\nvec2  a_offset        = a_vertexOffset * OFFSET_PRECISION;\nvec3  in_pos        = vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat fontSize      = getTextSize(a_offset, a_fontSize, a_referenceSize);\nfloat fontScale     = fontSize / SDF_FONT_SIZE;\nvec3  offset        = getRotation() * vec3(a_offset, 0.0);\nmat3  extrudeMatrix = getBit(a_bitSet, 0) == 1.0 ? u_displayViewMat3 : u_displayMat3;\nfloat isText = 1.0 - a_isBackground;\nfloat isBackground = u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor  = (isBackground * a_color) + (isText * getColor(a_color, a_bitSet, 1));\nv_color   = u_isHaloPass * a_haloColor + (1.0 - u_isHaloPass) * nonHaloColor;\nv_opacity = getOpacity();\nv_id      = norm(a_id);\nv_tex     = a_texCoords / u_mosaicSize;\nv_pos     = u_dvsMat3 * in_pos + extrudeMatrix * offset;\nfloat isHidden = u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z += 2.0 * isHidden;\nv_edgeDistanceOffset = u_isHaloPass * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n#ifdef HITTEST\nhighp vec3 out_pos  = vec3(0.);\nv_color = vec4(0.);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  vec3(a_pos * POSITION_PRECISION, 1.0)\n+ u_tileMat3 * offset, fontSize / 2.);\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, out_pos, getFilterFlags(), a_zoomRange), 1.0);\n#else\ngl_Position =  vec4(clip(v_color, v_pos, getFilterFlags(), a_zoomRange), 1.0);\n#endif\n}"},"utils.glsl":"float rshift(in float u32, in int amount) {\nreturn floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\nfloat offset = pow(2.0, float(bitIndex));\nreturn mod(floor(bitset / offset), 2.0);\n}\nconst int maxHighlightReasons = 6;\nfloat getFilterBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex + maxHighlightReasons);\n}\nfloat getHighlightBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex);\n}\nhighp vec3 unpackDisplayIdTexel(in highp vec3 bitset) {\nfloat isAggregate = getBit(bitset.b, 7);\nreturn (1.0 - isAggregate) * bitset + isAggregate * (vec3(bitset.rgb) - vec3(0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\nfloat r = mod(rshift(u32, 0), 255.0);\nfloat g = mod(rshift(u32, 8), 255.0);\nfloat b = mod(rshift(u32, 16), 255.0);\nfloat a = mod(rshift(u32, 24), 255.0);\nreturn vec4(r, g, b, a);\n}\nvec3 norm(in vec3 v) {\nreturn v /= 255.0;\n}\nvec4 norm(in vec4 v) {\nreturn v /= 255.0;\n}\nfloat max4(vec4 target) {\nreturn max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\nreturn (bytes - 127.0) / 127.0;\n}\nhighp float rand(in vec2 co) {\nhighp float a = 12.9898;\nhighp float b = 78.233;\nhighp float c = 43758.5453;\nhighp float dt = dot(co, vec2(a,b));\nhighp float sn = mod(dt, 3.14);\nreturn fract(sin(sn) * c);\n}","vcommon.glsl":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/vv.glsl>\n#include <materials/barycentric.glsl>\nattribute vec2 a_pos;\nattribute highp vec3 a_id;\nuniform highp mat3 displayViewScreenMat3;\nuniform highp mat3 displayViewMat3;\nuniform highp mat3 displayMat3;\nuniform highp mat3 tileMat3;\nuniform highp mat3 viewMat3;\nuniform highp float pixelRatio;\nuniform mediump float zoomFactor;\nuniform mediump float antialiasing;\nuniform mediump float currentScale;\nuniform mediump float currentZoom;\nuniform mediump float metersPerSRUnit;\nuniform mediump float activeReasons;\nuniform mediump float highlightAll;\nvec4 VV_ADATA = vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\ntarget.rgba = getVisualVariableData(a_id);\n}\n#ifdef VV\n#define INIT loadVisualVariableData(VV_ADATA)\n#else\n#define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\nfloat isColorLocked   = getBit(a_bitSet, index);\nreturn getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\nreturn a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\nreturn getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\nreturn 1.0;\n#endif\n}\nfloat getSize(in float in_size, in float currentScale) {\n#ifdef VV_SIZE\nreturn getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE], currentScale);\n#else\nreturn in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\nreturn getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\nreturn mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\nreturn ceil(getFilterData(a_id).x * 255.0);\n#else\nreturn getFilterData(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\nreturn getAnimation(a_id);\n}\nfloat getMinZoom() {\nvec4 data0 = getFilterData(a_id) * 255.0;\nreturn data0.g;\n}\nmat3 getMatrixNoDisplay(float isMapAligned) {\nreturn isMapAligned * viewMat3 * tileMat3 + (1.0 - isMapAligned) * tileMat3;\n}\nmat3 getMatrix(float isMapAligned) {\nreturn isMapAligned * displayViewMat3 + (1.0 - isMapAligned) * displayMat3;\n}\nfloat checkHighlightBit(float filterFlags, int index) {\nreturn getHighlightBit(filterFlags, index) * getBit(activeReasons, index);\n}\nfloat checkHighlight(float filterFlags) {\nfloat result = checkHighlightBit(filterFlags, 0);\nfor (int i = 1; i < maxHighlightReasons; i++) {\nresult = result + checkHighlightBit(filterFlags, i);\n}\nreturn step(0.1, result + highlightAll);\n}\nvec3 clip(inout vec4 color, inout vec3 pos, in float filterFlags, in vec2 minMaxZoom) {\npos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef inside\npos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 1));\n#elif defined(outside)\npos.z += 2.0 * getFilterBit(filterFlags, 1);\n#elif defined(highlight)\npos.z += 2.0 * (1.0 - checkHighlight(filterFlags));\n#endif\npos.z += 2.0 * (step(minMaxZoom.y, currentZoom) + (1.0 - step(minMaxZoom.x, currentZoom)));\nreturn pos;\n}","vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n#define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n#define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float colorValues[8];\nuniform vec4 colors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 minMaxValueAndSize;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float unitMeterRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float opacityValues[8];\nuniform float opacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float rotationType;\n#endif\nbool isNan(float val) {\nreturn (val == NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nfloat interpolationRatio = (sizeValue  - minMaxValueAndSize.x) / (minMaxValueAndSize.y - minMaxValueAndSize.x);\ninterpolationRatio = clamp(interpolationRatio, 0.0, 1.0);\nreturn minMaxValueAndSize.z + interpolationRatio * (minMaxValueAndSize.w - minMaxValueAndSize.z);\n}\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nfloat getVVScaleStopsSize(float currentScale) {\nfloat outSize;\nif (currentScale <= values[0]) {\noutSize = sizes[0];\n} else {\nif (currentScale >= values[7]) {\noutSize = sizes[7];\n} else {\nint index;\nindex = -1;\nfor (int i = 0; i < 8; i++) {\nif (values[i] > currentScale) {\nindex = i;\nbreak;\n}\n}\nint prevIndex = index - 1;\nfloat a = currentScale - values[prevIndex];\nfloat b = values[index] - values[prevIndex];\noutSize = mix(sizes[prevIndex], sizes[index], a / b);\n}\n}\nreturn outSize;\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N = 8;\nfloat getVVStopsSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nif (sizeValue <= values[0]) {\nreturn sizes[0];\n}\nif (sizeValue >= values[VV_SIZE_N - 1]) {\nreturn sizes[VV_SIZE_N - 1];\n}\nfor (int i = 1; i < VV_SIZE_N; ++i) {\nif (values[i] >= sizeValue) {\nfloat f = (sizeValue - values[i-1]) / (values[i] - values[i-1]);\nreturn mix(sizes[i-1], sizes[i], f);\n}\n}\nreturn sizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nreturn sizeValue * (metersPerSRUnit / unitMeterRatio);\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N = 8;\nfloat getVVOpacity(float opacityValue) {\nif (isNan(opacityValue)) {\nreturn 1.0;\n}\nif (opacityValue <= opacityValues[0]) {\nreturn opacities[0];\n}\nfor (int i = 1; i < VV_OPACITY_N; ++i) {\nif (opacityValues[i] >= opacityValue) {\nfloat f = (opacityValue - opacityValues[i-1]) / (opacityValues[i] - opacityValues[i-1]);\nreturn mix(opacities[i-1], opacities[i], f);\n}\n}\nreturn opacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat4(1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\n0, 0, 0, 1);\n}\nfloat rotation = rotationValue;\nif (rotationType == 1.0) {\nrotation = 90.0 - rotation;\n}\nfloat angle = C_DEG_TO_RAD * rotation;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nreturn mat4(cosA, sinA, 0, 0,\n-sinA,  cosA, 0, 0,\n0,     0, 1, 0,\n0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat3(1, 0, 0,\n0, 1, 0,\n0, 0, 1);\n}\nfloat rotation = rotationValue;\nif (rotationType == 1.0) {\nrotation = 90.0 - rotation;\n}\nfloat angle = C_DEG_TO_RAD * -rotation;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nreturn mat3(cosA, -sinA, 0,\nsinA, cosA, 0,\n0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N = 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\nif (isNan(colorValue) || isColorLocked == 1.0) {\nreturn fallback;\n}\nif (colorValue <= colorValues[0]) {\nreturn colors[0];\n}\nfor (int i = 1; i < VV_COLOR_N; ++i) {\nif (colorValues[i] >= colorValue) {\nfloat f = (colorValue - colorValues[i-1]) / (colorValues[i] - colorValues[i-1]);\nreturn mix(colors[i-1], colors[i], f);\n}\n}\nreturn colors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize, in float currentScale)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\nreturn getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\nfloat outSize = getVVScaleStopsSize(currentScale);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_FIELD_STOPS)\nfloat outSize = getVVStopsSize(vvSize, size);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\nreturn getVVUnitValue(vvSize, size);\n#else\nreturn size;\n#endif\n}"},"post-processing":{blit:{"blit.frag":"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\ngl_FragColor = texture2D(u_texture, v_uv);\n}"},bloom:{composite:{"composite.frag":"precision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D u_blurTexture1;\nuniform sampler2D u_blurTexture2;\nuniform sampler2D u_blurTexture3;\nuniform sampler2D u_blurTexture4;\nuniform sampler2D u_blurTexture5;\nuniform float u_bloomStrength;\nuniform float u_bloomRadius;\nuniform float u_bloomFactors[NUMMIPS];\nuniform vec3 u_bloomTintColors[NUMMIPS];\nfloat lerpBloomFactor(const in float factor) {\nfloat mirrorFactor = 1.2 - factor;\nreturn mix(factor, mirrorFactor, u_bloomRadius);\n}\nvoid main() {\nvec4 color = u_bloomStrength * (\nlerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\nlerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\nlerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\nlerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\nlerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n);\ngl_FragColor = clamp(color, 0.0, 1.0);\n}"},gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\n#define SIGMA RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / u_texSize;\nfloat fSigma = float(SIGMA);\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i ++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = u_direction * invSize * x;\nvec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = pixelColorSum /weightSum;\n}"},luminosityHighPass:{"luminosityHighPass.frag":"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec3 u_defaultColor;\nuniform float u_defaultOpacity;\nuniform float u_luminosityThreshold;\nuniform float u_smoothWidth;\nvarying vec2 v_uv;\nvoid main() {\nvec4 texel = texture2D(u_texture, v_uv);\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat v = dot(texel.xyz, luma);\nvec4 outputColor = vec4(u_defaultColor.rgb, u_defaultOpacity);\nfloat alpha = smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\ngl_FragColor = mix(outputColor, texel, alpha);\n}"}},blur:{gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nuniform float u_sigma;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / u_texSize;\nfloat fSigma = u_sigma;\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i ++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = u_direction * invSize * x;\nvec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = pixelColorSum /weightSum;\n}"},"radial-blur":{"radial-blur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nconst float sampleDist = 1.0;\nconst float sampleStrength = 2.2;\nvoid main(void) {\nfloat samples[10];\nsamples[0] = -0.08;\nsamples[1] = -0.05;\nsamples[2] = -0.03;\nsamples[3] = -0.02;\nsamples[4] = -0.01;\nsamples[5] =  0.01;\nsamples[6] =  0.02;\nsamples[7] =  0.03;\nsamples[8] =  0.05;\nsamples[9] =  0.08;\nvec2 dir = 0.5 - v_uv;\nfloat dist = sqrt(dir.x * dir.x + dir.y * dir.y);\ndir = dir / dist;\nvec4 color = texture2D(u_colorTexture,v_uv);\nvec4 sum = color;\nfor (int i = 0; i < 10; i++) {\nsum += texture2D(u_colorTexture, v_uv + dir * samples[i] * sampleDist);\n}\nsum *= 1.0 / 11.0;\nfloat t = dist * sampleStrength;\nt = clamp(t, 0.0, 1.0);\ngl_FragColor = mix(color, sum, t);\n}"}},dra:{"dra.frag":"precision mediump float;\nuniform sampler2D u_minColor;\nuniform sampler2D u_maxColor;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\nvec4 minColor = texture2D(u_minColor, vec2(0.5));\nvec4 maxColor = texture2D(u_maxColor, vec2(0.5));\nvec4 color = texture2D(u_texture, v_uv);\nvec3 minColorUnpremultiply = minColor.rgb / minColor.a;\nvec3 maxColorUnpremultiply = maxColor.rgb / maxColor.a;\nvec3 colorUnpremultiply = color.rgb / color.a;\nvec3 range = maxColorUnpremultiply - minColorUnpremultiply;\ngl_FragColor = vec4(color.a * (colorUnpremultiply - minColorUnpremultiply) / range, color.a);\n}","min-max":{"min-max.frag":"#extension GL_EXT_draw_buffers : require\nprecision mediump float;\n#define CELL_SIZE 2\nuniform sampler2D u_minTexture;\nuniform sampler2D u_maxTexture;\nuniform vec2 u_srcResolution;\nuniform vec2 u_dstResolution;\nvarying vec2 v_uv;\nvoid main() {\nvec2 srcPixel = floor(gl_FragCoord.xy) * float(CELL_SIZE);\nvec2 onePixel = vec2(1.0) / u_srcResolution;\nvec2 uv = (srcPixel + 0.5) / u_srcResolution;\nvec4 minColor = vec4(1.0);\nvec4 maxColor = vec4(0.0);\nfor (int y = 0; y < CELL_SIZE; ++y) {\nfor (int x = 0; x < CELL_SIZE; ++x) {\nvec2 offset = uv + vec2(x, y) * onePixel;\nminColor = min(minColor, texture2D(u_minTexture, offset));\nmaxColor = max(maxColor, texture2D(u_maxTexture, offset));\n}\n}\ngl_FragData[0] = minColor;\ngl_FragData[1] = maxColor;\n}"}},"drop-shadow":{composite:{"composite.frag":"precision mediump float;\nuniform sampler2D u_layerFBOTexture;\nuniform sampler2D u_blurTexture;\nuniform vec4 u_shadowColor;\nuniform vec2 u_shadowOffset;\nuniform highp mat3 u_displayViewMat3;\nvarying vec2 v_uv;\nvoid main() {\nvec3 offset = u_displayViewMat3 * vec3(u_shadowOffset, 0.0);\nvec4 layerColor = texture2D(u_layerFBOTexture, v_uv);\nvec4 blurColor = texture2D(u_blurTexture, v_uv - offset.xy / 2.0);\ngl_FragColor = ((1.0 - layerColor.a) * blurColor.a * u_shadowColor + layerColor);\n}"}},"edge-detect":{"frei-chen":{"frei-chen.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nvarying vec2 v_uv;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[9];\nconst mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main() {\nG[0] = g0,\nG[1] = g1,\nG[2] = g2,\nG[3] = g3,\nG[4] = g4,\nG[5] = g5,\nG[6] = g6,\nG[7] = g7,\nG[8] = g8;\nmat3 I;\nfloat cnv[9];\nvec3 sample;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D(u_colorTexture, v_uv + texel * vec2(i - 1.0,j - 1.0)).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 9; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\nfloat M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\nfloat S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\ngl_FragColor = vec4(vec3(sqrt(M / S)), texture2D(u_colorTexture, v_uv).a);\n}"},sobel:{"sobel.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] = g0;\nG[1] = g1;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 2; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\ngl_FragColor = vec4(vec3(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1])), texture2D(u_colorTexture, v_uv).a);\n}"}},"edge-enhance":{"edge-enhance.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 0.0, -1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] = g0;\nG[1] = g1;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 2; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\nvec4 color = texture2D(u_colorTexture, v_uv);\ngl_FragColor = vec4(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1]) * color);\n}"},filterEffect:{"filterEffect.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform mat4 u_coefficients;\nvarying vec2 v_uv;\nvoid main() {\nvec4 color = texture2D(u_colorTexture, v_uv);\nvec4 rgbw = u_coefficients * vec4(color.a > 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\nfloat a = color.a;\ngl_FragColor = vec4(a * rgbw.rgb, a);\n}"},pp:{"pp.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying vec2 v_uv;\nvoid main() {\ngl_Position = vec4(a_position, 0.0, 1.0);\nv_uv = (a_position + 1.0) / 2.0;\n}"}},raster:{common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include <raster/common/projection.glsl>\n#endif\n#ifdef BICUBIC\n#include <filtering/bicubic.glsl>\n#endif\n#ifdef BILINEAR\n#include <filtering/bilinear.glsl>\n#endif\nvec2 getPixelLocation(vec2 coords) {\nvec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\ntargetLocation = projectPixelLocation(targetLocation);\n#endif\nreturn targetLocation;\n}\nbool isOutside(vec2 coords){\nif (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {\nreturn true;\n} else {\nreturn false;\n}\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\nvec4 color = sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#elif defined(BILINEAR)\nvec4 color = sampleBilinear(u_image, pixelLocation, u_srcImageSize);\n#else\nvec4 color = texture2D(u_image, pixelLocation);\n#endif\nreturn color;\n}","projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n#ifdef LOOKUP_PROJECTION\nvec4 pv = texture2D(u_transformGrid, coords);\nreturn vec2(pv.r, pv.g);\n#endif\nvec2 index_image = floor(coords * u_targetImageSize);\nvec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location = index_transform + oneTransformPixel * 0.5;\nif (pos.s <= pos.t) {\nvec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;\n}"},flow:{"getFadeOpacity.glsl":"uniform float u_decayRate;\nuniform float u_fadeToZero;\nfloat getFadeOpacity(float x) {\nfloat cutOff = mix(0.0, exp(-u_decayRate), u_fadeToZero);\nreturn (exp(-u_decayRate * x) - cutOff) / (1.0 - cutOff);\n}","getFragmentColor.glsl":"vec4 getFragmentColor(vec4 color, float dist, float size, float featheringSize) {\nfloat featheringStart = clamp(0.5 - featheringSize / size, 0.0, 0.5);\nif (dist > featheringStart) {\ncolor *= 1.0 - (dist - featheringStart) / (0.5 - featheringStart);\n}\nreturn color;\n}",imagery:{"imagery.frag":"precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform float u_Min;\nuniform float u_Max;\nuniform float u_featheringSize;\n#include <raster/flow/vv.glsl>\nfloat getIntensity(float v) {\nreturn u_Min + v * (u_Max - u_Min);\n}\nvoid main(void) {\nvec4 sampled = texture2D(u_texture, v_texcoord);\nfloat intensity = getIntensity(sampled.r);\ngl_FragColor = getColor(intensity);\ngl_FragColor.a *= getOpacity(sampled.r);\ngl_FragColor.a *= sampled.a;\ngl_FragColor.rgb *= gl_FragColor.a;\n}","imagery.vert":"attribute vec2 a_position;\nattribute vec2 a_texcoord;\nuniform mat3 u_dvsMat3;\nvarying vec2 v_texcoord;\nvoid main(void) {\nvec2 xy = (u_dvsMat3 * vec3(a_position, 1.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"},particles:{"particles.frag":"precision highp float;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\n#include <raster/flow/getFragmentColor.glsl>\nvoid main(void) {\ngl_FragColor = getFragmentColor(v_color, length(v_texcoord - 0.5), v_size, u_featheringSize);\n}","particles.vert":"attribute vec4 a_xyts0;\nattribute vec4 a_xyts1;\nattribute vec4 a_typeIdDurationSeed;\nattribute vec4 a_extrudeInfo;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include <raster/flow/vv.glsl>\n#include <raster/flow/getFadeOpacity.glsl>\nvoid main(void) {\nvec2 position0 = a_xyts0.xy;\nfloat t0 = a_xyts0.z;\nfloat speed0 = a_xyts0.w;\nvec2 position1 = a_xyts1.xy;\nfloat t1 = a_xyts1.z;\nfloat speed1 = a_xyts1.w;\nfloat type = a_typeIdDurationSeed.x;\nfloat id = a_typeIdDurationSeed.y;\nfloat duration = a_typeIdDurationSeed.z;\nfloat seed = a_typeIdDurationSeed.w;\nvec2 e0 = a_extrudeInfo.xy;\nvec2 e1 = a_extrudeInfo.zw;\nfloat animationPeriod = duration + u_trailLength;\nfloat scaledTime = u_time * u_flowSpeed;\nfloat randomizedTime = scaledTime + seed * animationPeriod;\nfloat t = mod(randomizedTime, animationPeriod);\nfloat fUnclamped = (t - t0) / (t1 - t0);\nfloat f = clamp(fUnclamped, 0.0, 1.0);\nfloat clampedTime = mix(t0, t1, f);\nfloat speed = mix(speed0, speed1, f);\nvec2 extrude;\nvec2 position;\nfloat fadeOpacity;\nfloat introOpacity;\nif (type == 2.0) {\nif (fUnclamped < 0.0 || (fUnclamped > 1.0 && t1 != duration)) {\ngl_Position = vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nvec2 ortho = mix(e0, e1, f);\nvec2 parallel;\nparallel = normalize(position1 - position0) * 0.5;\nif (id == 1.0) {\nextrude = ortho;\nv_texcoord = vec2(0.5, 0.0);\n} else if (id == 2.0) {\nextrude = -ortho;\nv_texcoord = vec2(0.5, 1.0);\n} else if (id == 3.0) {\nextrude = ortho + parallel;\nv_texcoord = vec2(1.0, 0.0);\n} else if (id == 4.0) {\nextrude = -ortho + parallel;\nv_texcoord = vec2(1.0, 1.0);\n}\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n} else {\nif (fUnclamped < 0.0) {\ngl_Position = vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nif (id == 1.0) {\nextrude = e0;\nv_texcoord = vec2(0.5, 0.0);\nfadeOpacity = getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity = 1.0 - exp(-t0);\nv_size = getSize(speed0);\nv_color = getColor(speed0);\nv_color.a *= getOpacity(speed0);\nposition = position0;\n} else if (id == 2.0) {\nextrude = -e0;\nv_texcoord = vec2(0.5, 1.0);\nfadeOpacity = getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity = 1.0 - exp(-t0);\nv_size = getSize(speed0);\nv_color = getColor(speed0);\nv_color.a *= getOpacity(speed0);\nposition = position0;\n} else if (id == 3.0) {\nextrude = mix(e0, e1, f);\nv_texcoord = vec2(0.5, 0.0);\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n} else if (id == 4.0) {\nextrude = -mix(e0, e1, f);\nv_texcoord = vec2(0.5, 1.0);\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n}\n}\nvec2 xy = (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(extrude * v_size, 0.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_color.a *= fadeOpacity;\nv_color.a *= mix(1.0, introOpacity, u_introFade);\nv_color.rgb *= v_color.a;\n}"},streamlines:{"streamlines.frag":"precision highp float;\nvarying float v_side;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_size;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include <raster/flow/getFragmentColor.glsl>\n#include <raster/flow/getFadeOpacity.glsl>\nvoid main(void) {\nfloat t = mod(v_timeSeed * (v_totalTime + u_trailLength) + u_time * u_flowSpeed, v_totalTime + u_trailLength) - v_time;\nvec4 color = v_color * step(0.0, t) * getFadeOpacity(t / u_trailLength);\ncolor *= mix(1.0, 1.0 - exp(-v_time), u_introFade);\ngl_FragColor = getFragmentColor(color, length((v_side + 1.0) / 2.0 - 0.5), v_size, u_featheringSize);\n}","streamlines.vert":"attribute vec3 a_positionAndSide;\nattribute vec3 a_timeInfo;\nattribute vec2 a_extrude;\nattribute float a_speed;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_side;\nvarying float v_size;\nuniform float u_featheringSize;\n#include <raster/flow/vv.glsl>\nvoid main(void) {\nvec4 lineColor = getColor(a_speed);\nfloat lineOpacity = getOpacity(a_speed);\nfloat lineSize = getSize(a_speed);\nvec2 position = a_positionAndSide.xy;\nv_side = a_positionAndSide.z;\nvec2 xy = (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(a_extrude * lineSize, 0.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_time = a_timeInfo.x;\nv_totalTime = a_timeInfo.y;\nv_timeSeed = a_timeInfo.z;\nv_color = lineColor;\nv_color.a *= lineOpacity;\nv_color.rgb *= v_color.a;\nv_size = lineSize;\n}"},"vv.glsl":"#define MAX_STOPS 8\n#ifdef VV_COLOR\nuniform float u_color_stops[MAX_STOPS];\nuniform vec4 u_color_values[MAX_STOPS];\nuniform int u_color_count;\n#else\nuniform vec4 u_color;\n#endif\n#ifdef VV_OPACITY\nuniform float u_opacity_stops[MAX_STOPS];\nuniform float u_opacity_values[MAX_STOPS];\nuniform int u_opacity_count;\n#else\nuniform float u_opacity;\n#endif\n#ifdef VV_SIZE\nuniform float u_size_stops[MAX_STOPS];\nuniform float u_size_values[MAX_STOPS];\nuniform int u_size_count;\n#else\nuniform float u_size;\n#endif\nuniform float u_featheringOffset;\nvec4 getColor(float x) {\n#ifdef VV_COLOR\nvec4 color = u_color_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_color_count) {\nbreak;\n}\nfloat x1 = u_color_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_color_stops[i];\nvec4 y2 = u_color_values[i];\nif (x < x2) {\nvec4 y1 = u_color_values[i - 1];\ncolor = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\ncolor = y2;\n}\n}\n}\n#else\nvec4 color = u_color;\n#endif\nreturn color;\n}\nfloat getOpacity(float x) {\n#ifdef VV_OPACITY\nfloat opacity = u_opacity_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_opacity_count) {\nbreak;\n}\nfloat x1 = u_opacity_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_opacity_stops[i];\nfloat y2 = u_opacity_values[i];\nif (x < x2) {\nfloat y1 = u_opacity_values[i - 1];\nopacity = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nopacity = y2;\n}\n}\n}\n#else\nfloat opacity = u_opacity;\n#endif\nreturn opacity;\n}\nfloat getSize(float x) {\n#ifdef VV_SIZE\nfloat size = u_size_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_size_count) {\nbreak;\n}\nfloat x1 = u_size_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_size_stops[i];\nfloat y2 = u_size_values[i];\nif (x < x2) {\nfloat y1 = u_size_values[i - 1];\nsize = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nsize = y2;\n}\n}\n}\n#else\nfloat size = u_size;\n#endif\nreturn size + 2.0 * u_featheringSize * u_featheringOffset;\n}"},magdir:{"magdir.frag":"precision mediump float;\nvarying vec4 v_color;\nuniform lowp float u_opacity;\nvoid main() {\ngl_FragColor = v_color * u_opacity;\n}","magdir.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nuniform float u_rotation;\nuniform vec4 u_colors[12];\nvarying vec4 v_color;\nvoid main()\n{\nfloat angle = a_offset.y + u_rotation;\n#ifndef ROTATION_GEOGRAPHIC\nangle = 3.14159265359 * 2.0 - angle - 3.14159265359 / 2.0;\n#endif\nvec2 offset = vec2(cos(angle), sin(angle)) * a_offset.x;\n#ifdef DATA_RANGE\nfloat valuePercentage = clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio = u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage = clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage = (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 pos = a_pos + offset * sizePercentage * u_symbolSize;\nv_color = u_colors[int(a_vv.x)];\ngl_Position = vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},reproject:{"reproject.frag":"precision mediump float;\nvarying vec2 v_texcoord;\n#include <raster/common/common.glsl>\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\ngl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\n}","reproject.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_position;\ngl_Position = vec4(2.0 * (a_position - 0.5), 0.0, 1.0);\n}"},scalar:{"scalar.frag":"precision mediump float;\nuniform lowp float u_opacity;\nvarying vec2 v_pos;\nconst vec4 outlineColor = vec4(0.2, 0.2, 0.2, 1.0);\nconst float outlineSize = 0.02;\nconst float innerRadius = 0.25;\nconst float outerRadius = 0.42;\nconst float innerSquareLength = 0.15;\nvoid main() {\nmediump float dist = length(v_pos);\nmediump float fillalpha1 = smoothstep(outerRadius, outerRadius + outlineSize, dist);\nfillalpha1 *= (1.0-smoothstep(outerRadius + outlineSize, outerRadius + 0.1 + outlineSize, dist));\n#ifdef INNER_CIRCLE\nmediump float fillalpha2 = smoothstep(innerRadius, innerRadius + outlineSize, dist);\nfillalpha2 *= (1.0-smoothstep(innerRadius + outlineSize, innerRadius + 0.1 + outlineSize, dist));\n#else\nmediump float fillalpha2 = (abs(v_pos.x) < innerSquareLength ? 1.0 : 0.0) * (abs(v_pos.y) < innerSquareLength ? 1.0 : 0.0);\n#endif\ngl_FragColor = (fillalpha2 + fillalpha1) * outlineColor * u_opacity;\n}","scalar.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nvarying vec2 v_pos;\nvoid main()\n{\n#ifdef DATA_RANGE\nfloat valuePercentage = clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio = u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage = clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage = (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 size = u_symbolSize * sizePercentage;\nvec2 pos = a_pos + a_offset * size;\nv_pos = a_offset;\ngl_Position = vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"}},stencil:{"stencil.frag":"void main() {\ngl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nuniform mat3 u_worldExtent;\nvoid main() {\ngl_Position = vec4(u_worldExtent * vec3(a_pos, 1.0), 1.0);\n}"},test:{"TestShader.common.glsl":"#ifndef RETURN_RED\nvarying    vec4      v_color;\n#endif\nvarying    vec2      v_offset;","TestShader.frag":"precision highp float;\n#include <test/TestShader.common.glsl>\nvoid main() {\nif (v_offset.x > -.5 && v_offset.y > -.5 && v_offset.x < .5 && v_offset.y < .5) {\ndiscard;\n}\n#ifdef RETURN_RED\ngl_FragColor = vec4(1., 0., 0., 1.);\n#else\ngl_FragColor = v_color;\n#endif\n}","TestShader.vert":"const float POS_PRECISION_FACTOR = 10.;\nconst float OFFSET_PRECISION_FACTOR = 10.;\nconst float SIZE_PRECISION_FACTOR = 10.;\nattribute  vec2      a_pos_packed;\nattribute  vec2      a_offset_packed;\nattribute  float     a_size_packed;\n#ifdef DATA_DRIVEN_COLOR\nconst float u_dataDrivenColor_validValues[4] = float[4](0., 0., 1., 0.);\nuniform    vec4      u_dataDrivenColor_colorFallback;\nuniform    vec4      u_dataDrivenColor_color;\n#endif\nuniform    float     u_view_zoomLevel;\n#include <test/TestShader.common.glsl>\n#ifdef DATA_DRIVEN_COLOR\nvec4 getColor(float value) {\nint index = -1;\nfor (int i = 0; i < 4; i++) {\nif (u_dataDrivenColor_validValues[i] == value) {\nindex = i;\nbreak;\n}\n}\nif (index == -1) {\nreturn u_dataDrivenColor_colorFallback;\n}\nreturn u_dataDrivenColor_color;\n}\n#endif\nvoid main() {\nvec2  a_pos = a_pos_packed / POS_PRECISION_FACTOR;\nvec2  a_offset = a_offset_packed / OFFSET_PRECISION_FACTOR;\nfloat a_size = a_size_packed / SIZE_PRECISION_FACTOR;\nvec4 color = vec4(1., 0., 0., 1.);\n#ifdef DATA_DRIVEN_COLOR\ncolor = getColor(1.);\n#endif\nvec2 offsetScaled = a_offset * a_size;\nvec4 pos = vec4(a_pos.xy + offsetScaled, 0., 1.);\ngl_Position = pos;\n#ifndef RETURN_RED\nv_color = color;\n#endif\nv_offset = a_offset;\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\nlowp vec4 color = texture2D(u_texture, v_tex);\ncolor.rgb *= color.a;\ngl_FragColor = color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\nmediump vec2 offset = u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\nvec3 v_pos = u_dvsMat3 * vec3(offset, 1.0);\ngl_Position = vec4(v_pos.xy, 0.0, 1.0);\nv_tex = a_pos;\n}"},util:{"atan2.glsl":"float atan2(in float y, in float x) {\nfloat t0, t1, t2, t3, t4;\nt3 = abs(x);\nt1 = abs(y);\nt0 = max(t3, t1);\nt1 = min(t3, t1);\nt3 = 1.0 / t0;\nt3 = t1 * t3;\nt4 = t3 * t3;\nt0 =         - 0.013480470;\nt0 = t0 * t4 + 0.057477314;\nt0 = t0 * t4 - 0.121239071;\nt0 = t0 * t4 + 0.195635925;\nt0 = t0 * t4 - 0.332994597;\nt0 = t0 * t4 + 0.999995630;\nt3 = t0 * t3;\nt3 = (abs(y) > abs(x)) ? 1.570796327 - t3 : t3;\nt3 = x < 0.0 ?  3.141592654 - t3 : t3;\nt3 = y < 0.0 ? -t3 : t3;\nreturn t3;\n}","encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}"}}));function i(t){return n.resolveIncludes(t)}},1314:(t,e,s)=>{function n(t,e){if(null!==e){t.push(e.length);for(const s of e)s.serialize(t);return t}t.push(0)}function i(t,e,s){const n=t.readInt32(),i=new Array(n);for(let r=0;r<i.length;r++)i[r]=e.deserialize(t,s);return i}s.d(e,{_:()=>i,j:()=>n})},24342:(t,e,s)=>{s.d(e,{e:()=>I});var n=s(66866),i=s(48982),r=s(4194),o=s(98849),a=s(85251),l=s(21564),h=(s(39831),s(539),s(9272),s(63863)),u=s(47393),c=s(7715),m=s(52495),d=s(82256),g=s(71416);let p=class extends m.A{constructor(){super(...arguments),this._idToCounters=new g.A}get size(){return this._idToCounters.size}get objectIds(){return this._idToCounters.keys()}get highlightNamesByObjectId(){return function*(t){for(const[e,s]of t)yield[e,s.keys()]}(this._idToCounters)}add(t,e){let s=!1;for(const n of t){const t=(0,d.tE)(this._idToCounters,n,(()=>(s=!0,new Map))),i=t.get(e)??0;i||(s=!0),t.set(e,i+1)}return s}delete(t,e){let s=!1;for(const n of t){const t=this._idToCounters.get(n);if(!t)continue;let i=t.get(e);null!=i&&(i--,i>0?t.set(e,i):(t.delete(e),s=!0),0===t.size&&(this._idToCounters.delete(n),s=!0))}return s}};p=(0,n._)([(0,h.$)("esri.views.2d.layers.support.HighlightCounter")],p);var _,f=s(19257),y=s(41010),x=s(61226);let v=_=class extends x.A{constructor(t){super(t),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new _({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,n._)([(0,l.MZ)({type:[Number,String],json:{write:!0}})],v.prototype,"left",void 0),(0,n._)([(0,l.MZ)({type:[Number,String],json:{write:!0}})],v.prototype,"right",void 0),(0,n._)([(0,l.MZ)({type:[Number,String],json:{write:!0}})],v.prototype,"top",void 0),(0,n._)([(0,l.MZ)({type:[Number,String],json:{write:!0}})],v.prototype,"bottom",void 0),v=_=(0,n._)([(0,h.$)("esri.views.layers.support.ClipRect")],v);var b=s(8565);let P=class extends x.A{constructor(t){super(t),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,n._)([(0,l.MZ)({type:[[[Number]]],json:{write:!0}})],P.prototype,"path",void 0),P=(0,n._)([(0,h.$)("esri.views.layers.support.Path")],P);var S=s(96058),E=s(38201);const C=i.A.ofType({key:"type",base:null,typeMap:{rect:v,path:P,geometry:b.A}}),w=new(i.A.ofType(S.A)),I=t=>{let e=class extends t{constructor(){super(...arguments),this._highlightCounter=new p,this.attached=!1,this.clips=new C,this.highlights=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){const t=this.view?.spatialReferenceLocked??!0,e=this.view?.spatialReference;e&&t&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new o.A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new c.m),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([(0,a.wB)((()=>this.suspended),(t=>{this.container&&(this.container.visible=!t)}),a.pc),(0,a.wB)((()=>this.updateSuspended),(t=>{this.view&&!t&&this.updateRequested&&this.view.requestUpdate()}),a.pc),(0,a.wB)((()=>this.layer?.opacity??1),(t=>{this.container&&(this.container.opacity=t)}),a.pc),(0,a.wB)((()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal"),(t=>{this.container&&(this.container.blendMode=t)}),a.pc),(0,a.wB)((()=>this.layer&&"effect"in this.layer?this.layer.effect:null),(t=>{this.container&&(this.container.effect=t)}),a.pc),(0,a.wB)((()=>this._mergedHighlights.items.map((t=>({name:t.name,options:{fillColor:t.color,haloColor:t.haloColor,fillOpacity:t.fillOpacity,haloOpacity:t.haloOpacity,haloWidth:t.haloWidth,haloBlur:t.haloBlur}})))),(()=>{this.container.highlightGradient=(0,f.u4)(this.container.highlightGradient,this._mergedHighlights.items)}),a.pc),(0,a.wB)((()=>this._mergedHighlights.items.map((t=>t.name))),(()=>{this._processHighlight()})),(0,a.on)((()=>this.clips),"change",(()=>{this.container&&(this.container.clips=this.clips)}),a.pc),(0,a.wB)((()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null})),(({scale:t,scaleRange:e})=>{const s=(0,E.E5)(e,t);s!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=s)}),a.pc)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then((t=>{t===this&&this.processAttach()}),(()=>{})):this.when().then((()=>{this.processAttach()}),(()=>{})))}destroy(){this.processDetach(),this.updateRequested=!1}get highlightOptions(){return(0,y.a)(this)}set highlightOptions(t){(0,y.o)(this,t)}get hasHighlight(){return this._highlightCounter.size>0}get _mergedHighlights(){if(!this.view)return w;if(!this.highlights)return this.view.highlights;const t=this.view.highlights.clone();for(const e of this.highlights){const s=t.find((t=>t.name===e.name));s&&s.assignFrom(e)}return t}get highlightIds(){return Array.from(this._highlightCounter.objectIds)}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const t=this.view?.spatialReference;return null==t||this.supportsSpatialReference(t)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(t){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",t),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(t))):this.updateRequested=!1}hitTest(t,e){return Promise.resolve(null)}supportsSpatialReference(t){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;switch(this.layer?.type){case"link-chart":case"knowledge-graph-sublayer":case"graphics":break;default:if((0,u.O)(this.view)&&!this.view.inGeographicLayout)return!1}return!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const t=super.getSuspendInfo(),e=!this.spatialReferenceSupported;return e&&(t.spatialReferenceNotSupported=e),t}addAttachHandles(t){this.addHandles(t,"attach")}_addHighlights(t,e){this._highlightCounter.add(t,e)&&this._processHighlight()}_removeHighlights(t,e){this._highlightCounter.delete(t,e)&&this._processHighlight()}_processHighlight(){}_getHighlights(){const t=[];for(const[e,s]of this._highlightCounter.highlightNamesByObjectId){const n=this._getHighlightBits(s);t.push({objectId:e,highlightFlags:n})}return t}_getHighlightBits(t){const e=new Set(t);let s=1,n=0;if(!this.view)return 0;const i=this._mergedHighlights;for(const{name:r}of i)e.delete(r)&&(n=s),s<<=1;return n}};return(0,n._)([(0,l.MZ)()],e.prototype,"attached",void 0),(0,n._)([(0,l.MZ)({type:C,set(t){const e=(0,r.V)(t,this._get("clips"),C);this._set("clips",e)}})],e.prototype,"clips",void 0),(0,n._)([(0,l.MZ)()],e.prototype,"container",void 0),(0,n._)([(0,l.MZ)({type:S.A})],e.prototype,"highlightOptions",null),(0,n._)([(0,l.MZ)({type:i.A.ofType(S.A)})],e.prototype,"highlights",void 0),(0,n._)([(0,l.MZ)()],e.prototype,"_mergedHighlights",null),(0,n._)([(0,l.MZ)()],e.prototype,"moving",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],e.prototype,"spatialReferenceSupported",null),(0,n._)([(0,l.MZ)({readOnly:!0})],e.prototype,"updateParameters",void 0),(0,n._)([(0,l.MZ)()],e.prototype,"updateRequested",void 0),(0,n._)([(0,l.MZ)()],e.prototype,"updating",null),(0,n._)([(0,l.MZ)()],e.prototype,"view",void 0),(0,n._)([(0,l.MZ)()],e.prototype,"_visibleAtCurrentScale",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],e.prototype,"visibleAtCurrentScale",null),e=(0,n._)([(0,h.$)("esri.views.2d.layers.LayerView2D")],e),e}},98502:(t,e,s)=>{s.d(e,{DF:()=>a,Lu:()=>h,RA:()=>o,hV:()=>l});var n=s(89882),i=s(62802),r=s(43556);const o=50;function a(t){if(!t)return null;const{xmin:e,ymin:s,xmax:n,ymax:r,spatialReference:o}=t;return new i.A({rings:[[[e,s],[e,r],[n,r],[n,s],[e,s]]],spatialReference:o})}function l(t){return(0,n.PN)(Math.round((0,n.Lz)(t)))}function h(t){const e=(0,n.PN)(r.GR),s=(0,n.PN)(r.cp);return Math.max(e,Math.min(t||s,s))}},9049:(t,e,s)=>{s.d(e,{A:()=>g});var n=s(66866),i=s(52495),r=s(17306),o=s(65667),a=s(539),l=s(6267),h=s(84410),u=s(21564),c=(s(39831),s(9272),s(63863)),m=s(4238),d=s(38201);let g=class extends(o.A.IdentifiableMixin(h.A.EsriPromiseMixin(r.A.EventedMixin(i.A)))){get spatialReferenceSupported(){return!0}constructor(t){super(t),this._updatingHandles=new m.U,this.layer=null,this.parent=null}initialize(){this.when().catch((t=>{if("layerview:create-error"!==t.name){const e=this.layer&&this.layer.id||"no id",s=this.layer?.title||"no title";a.A.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${s}', id: '${e}')`,t)}}))}destroy(){this._updatingHandles=(0,l.pR)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(t){this._overrideIfSome("visible",t)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const t=this.view.timeExtent,e=this.layer?.visibilityTimeExtent;return!t||!e||!t.intersection(e).isEmpty}canResume(){const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&this.parent&&!this.parent.suspended&&this.view?.ready&&(0,d.g7)(t)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const t=this.parent?.suspended?this.parent.suspendInfo:{};this.view?.ready||(t.viewNotReady=!0),this.layer&&this.layer.loaded||(t.layerNotLoaded=!0);const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,d.g7)(e)&&this.visibleAtCurrentScale||(t.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(t.outsideVisibilityTimeExtent=!0),this.visible||(t.layerInvisible=!0),t}isUpdating(){return!1}};(0,n._)([(0,u.MZ)({readOnly:!0})],g.prototype,"spatialReferenceSupported",null),(0,n._)([(0,u.MZ)()],g.prototype,"view",void 0),(0,n._)([(0,u.MZ)()],g.prototype,"fullOpacity",null),(0,n._)([(0,u.MZ)()],g.prototype,"layer",void 0),(0,n._)([(0,u.MZ)()],g.prototype,"parent",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],g.prototype,"suspended",null),(0,n._)([(0,u.MZ)({readOnly:!0})],g.prototype,"suspendInfo",null),(0,n._)([(0,u.MZ)({readOnly:!0})],g.prototype,"legendEnabled",null),(0,n._)([(0,u.MZ)({type:Boolean,readOnly:!0})],g.prototype,"updating",null),(0,n._)([(0,u.MZ)({readOnly:!0})],g.prototype,"updatingProgress",null),(0,n._)([(0,u.MZ)()],g.prototype,"updateSuspended",null),(0,n._)([(0,u.MZ)()],g.prototype,"visible",null),(0,n._)([(0,u.MZ)({readOnly:!0})],g.prototype,"visibleAtCurrentScale",null),(0,n._)([(0,u.MZ)({readOnly:!0})],g.prototype,"visibleAtCurrentTimeExtent",null),g=(0,n._)([(0,c.$)("esri.views.layers.LayerView")],g)},61226:(t,e,s)=>{s.d(e,{A:()=>a});var n=s(66866),i=s(21877),r=s(21564),o=(s(39831),s(539),s(9272),s(63863));let a=class extends i.A{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,n._)([(0,r.MZ)({readOnly:!0})],a.prototype,"version",null),a=(0,n._)([(0,o.$)("esri.views.layers.support.ClipArea")],a)},8565:(t,e,s)=>{s.d(e,{A:()=>d});var n,i=s(66866),r=s(21564),o=(s(39831),s(539),s(9272),s(63863)),a=s(84698),l=s(88266),h=s(62802),u=s(1171),c=s(61226);const m={base:l.A,key:"type",typeMap:{extent:a.A,polygon:h.A}};let d=n=class extends c.A{constructor(t){super(t),this.type="geometry",this.geometry=null}clone(){return new n({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,i._)([(0,r.MZ)({types:m,json:{read:u.rS,write:!0}})],d.prototype,"geometry",void 0),d=n=(0,i._)([(0,o.$)("esri.views.layers.support.Geometry")],d)},38201:(t,e,s)=>{s.d(e,{E5:()=>o,JU:()=>r,Of:()=>i,g7:()=>a,j:()=>l,lO:()=>h});s(98849);var n=s(39831);function i(t){return t&&"function"==typeof t.highlight}function r(t,e,s){return null==t||t>=s&&(0===e||t<=e)}function o(t,e){if(e&&t){const{minScale:s,maxScale:n}=t;if(function(t,e){return null!=t&&t>0||null!=e&&e>0}(s,n))return r(e,s,n)}return!0}function a(t){return!t?.minScale||!t.maxScale||t.minScale>=t.maxScale}const l=()=>!(0,n.A)("disable-feature:layer-based-scale-visibility");function h(t){return null!=t&&"object"==typeof t&&"createQuery"in t&&"queryFeatures"in t&&"layer"in t&&"view"in t}},11809:(t,e,s)=>{var n;s.d(e,{c:()=>n}),function(t){t[t.Bind=0]="Bind",t[t.Pass=1]="Pass",t[t.Draw=2]="Draw"}(n||(n={}))},89423:(t,e,s)=>{s.d(e,{g:()=>h});var n=s(85569),i=(s(39831),s(539)),r=s(86942),o=s(16541),a=s(41746);const l=()=>i.A.getLogger("esri.views.webgl.BufferObject");class h{static createIndex(t,e,s){return new h(t,a.NZ.ELEMENT_ARRAY_BUFFER,e,s)}static createVertex(t,e,s){return new h(t,a.NZ.ARRAY_BUFFER,e,s)}static createUniform(t,e,s){return new h(t,a.NZ.UNIFORM_BUFFER,e,s)}static createPixelPack(t,e=a._U.STREAM_READ,s){const n=new h(t,a.NZ.PIXEL_PACK_BUFFER,e);return s&&n.setSize(s),n}static createPixelUnpack(t,e=a._U.STREAM_DRAW,s){return new h(t,a.NZ.PIXEL_UNPACK_BUFFER,e,s)}static createTransformFeedback(t,e=a._U.STATIC_DRAW,s){const n=new h(t,a.NZ.TRANSFORM_FEEDBACK_BUFFER,e);return n.setSize(s),n}constructor(t,e,s,n){this._context=t,this.bufferType=e,this.usage=s,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,o.Y2)(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER){if(this._indexType===a.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(t,e=null){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=e)switch(this._indexType=e,e){case a.pe.UNSIGNED_SHORT:t*=2;break;case a.pe.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let e=t.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,r.mg)(t)?this._indexType=a.pe.UNSIGNED_BYTE:(0,r.jq)(t)?(e/=2,this._indexType=a.pe.UNSIGNED_SHORT):(0,r.XJ)(t)&&(e/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(e,t)}_setBufferData(t,e=null){this._size=t;const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;null!=e?n.bufferData(this.bufferType,e,this.usage):n.bufferData(this.bufferType,t,this.usage),(0,o.Y2)(n),this._isVAOAware&&this._context.bindVAO(s)}setSubData(t,e,s,n){if(!t)return;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:r}=this._context;r.bufferSubData(this.bufferType,e*t.BYTES_PER_ELEMENT,t,s,n-s),(0,o.Y2)(r),this._isVAOAware&&this._context.bindVAO(i)}getSubData(t,e=0,s,i){if(s<0||i<0)return;const r=function(t){return(0,n.Xj)(t)}(t)?t.BYTES_PER_ELEMENT:1;if(r*((s??0)+(i??0))>t.byteLength)return;e+r*(i??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,e,t,s,i),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),o.getBufferSubData(a.NZ.COPY_READ_BUFFER,e,t,s,i),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(t,e=0,s,n){await this._context.clientWaitAsync(),this.getSubData(t,e,s,n)}}},84852:(t,e,s)=>{s.d(e,{H:()=>c});s(39831);var n=s(539),i=s(6267),r=s(89423),o=s(16541),a=s(41746),l=s(35644),h=s(74416),u=s(8595);class c{constructor(t,e,s){if(this._context=t,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,t.instanceCounter.increment(a.vt.FramebufferObject,this),null!=e){const s=m(e)?e:new u.g(t,e);this._colorAttachments.set(a.r6,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(a.r6)}if(null!=s)if(function(t){return m(t)||function(t){return d(t)===l.d.TextureDescriptor}(t)}(s))this._depthStencilTexture=m(s)?s:new u.g(t,s),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const e=function(t){return d(t)===l.d.Renderbuffer}(s)?s:new h.l(t,s);this._depthStencilBuffer=e,this._validateRenderbufferDescriptor(e.descriptor)}}dispose(){const{_colorAttachments:t,_glName:e}=this;if(0===t.size&&!this._depthStencilBuffer&&!this._depthStencilTexture&&!e)return;const{_context:s}=this,n=s.getBoundFramebufferObject();t.forEach(((t,e)=>this.detachColorTexture(e)?.dispose())),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),s.gl.deleteFramebuffer(e),this._glName=null,s.bindFramebuffer(n===this?null:n),s.instanceCounter.decrement(a.vt.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(a.r6)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){const t=this._colorAttachments.get(a.r6)??this._depthStencilTexture??this._depthStencilBuffer;return t?.descriptor?.width??0}get height(){const t=this._colorAttachments.get(a.r6)??this._depthStencilTexture??this._depthStencilBuffer;return t?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce(((t,[e,s])=>t+s.usedMemory),this.depthStencil?.usedMemory??0)}static{this._MAX_COLOR_ATTACHMENTS=-1}getColorTexture(t){const e=this._colorAttachments.get(t);return e&&m(e)?e:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(t,e=a.r6){if(!t)return;this._validateColorAttachmentPoint(e);const{descriptor:s}=t;this._validateTextureDescriptor(s),this.detachColorTexture(e)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,e)),this._colorAttachments.set(e,t)}detachColorTexture(t=a.r6){const e=this._colorAttachments.get(t);if(e)return this._initialized&&this._context.temporaryBindFramebufferObject(this,(()=>{this._framebufferTexture2D(null,t)})),this._colorAttachments.delete(t),e}setColorTextureTarget(t,e=a.r6,s=0){const n=this._colorAttachments.get(e);n&&(t===a.Ap.TEXTURE_2D_ARRAY?this._framebufferTextureLayer(n.glName,e,a.R.FRAMEBUFFER,0,s):this._framebufferTexture2D(n.glName,e,t,a.R.FRAMEBUFFER,0))}attachDepthStencil(t){if(t)switch(t.type){case l.d.Texture:return this._attachDepthStencilTexture(t);case l.d.Renderbuffer:return this._attachDepthStencilBuffer(t)}}_attachDepthStencilTexture(t){if(null==t)return;const{descriptor:e}=t,{pixelFormat:s,dataType:n}=e;s===a.j7.DEPTH_STENCIL||s===a.j7.DEPTH_COMPONENT?s!==a.j7.DEPTH_STENCIL||n===a.ld.UNSIGNED_INT_24_8?s!==a.j7.DEPTH_COMPONENT||n===a.ld.UNSIGNED_INT||n===a.ld.UNSIGNED_SHORT?(this._validateTextureDescriptor(e),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,_(s))),this._depthStencilTexture?.dispose(),this._depthStencilTexture=t):console.error("Depth texture must have data type of UNSIGNED_INT or UNSIGNED_SHORT!"):console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"):console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!")}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&this._context.temporaryBindFramebufferObject(this,(()=>{this._framebufferTexture2D(null,_(t.descriptor.pixelFormat))})),this._depthStencilTexture=null,t}_attachDepthStencilBuffer(t){if(null==t)return;const e=t.descriptor;if(this._validateRenderbufferDescriptor(e),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const{gl:s}=this._context,n=this._getGLAttachmentPoint(e);s.framebufferRenderbuffer(a.R.FRAMEBUFFER,n,s.RENDERBUFFER,t.glName)}this._depthStencilBuffer=t}detachDepthStencilBuffer(){const t=this._depthStencilBuffer;if(t&&this._initialized){const{_context:e}=this,s=e.getBoundFramebufferObject();e.bindFramebuffer(this);const{gl:n}=e,i=this._getGLAttachmentPoint(t.descriptor);n.framebufferRenderbuffer(a.R.FRAMEBUFFER,i,n.RENDERBUFFER,null),e.bindFramebuffer(s)}return this._depthStencilBuffer=null,t}invalidateAttachments(t){const{_context:e}=this;e.temporaryBindFramebufferObject(this,(()=>e.gl.invalidateFramebuffer(a.R.FRAMEBUFFER,t)),!0)}copyToTexture(t,e,s,n,i,r,o){(t<0||e<0||i<0||r<0)&&console.error("Offsets cannot be negative!"),(s<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=o.descriptor;o.descriptor.target!==a.Ap.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(null==l?.width||null==l?.height||t+s>this.width||e+n>this.height||i+s>l.width||r+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,c=h.bindTexture(o,u.g.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(u.g.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(a.Ap.TEXTURE_2D,0,i,r,t,e,s,n),h.bindTexture(c,u.g.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,e,s,n,i,r,o){(s<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,e,s,n,i,r,o)}async readPixelsAsync(t,e,s,n,i,o,l){const{gl:h}=this._context,u=r.g.createPixelPack(this._context,a._U.STREAM_READ,l.byteLength);this._context.bindBuffer(u);const c=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),h.readPixels(t,e,s,n,i,o,0),this._context.unbindBuffer(a.NZ.PIXEL_PACK_BUFFER),this._context.bindFramebuffer(c),await u.getSubDataAsync(l),u.dispose()}resize(t,e){if(this.width===t&&this.height===e)return;const s={width:t,height:e};g(s,this._context.parameters.maxTextureSize),this._colorAttachments.forEach((t=>t.resize(s.width,s.height))),this._depthStencilTexture?.resize(s.width,s.height),this._initialized&&(g(s,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(s.width,s.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(t=a.R.FRAMEBUFFER){const{gl:e}=this._context;if(this._initialized)return void e.bindFramebuffer(t,this.glName);this._glName&&e.deleteFramebuffer(this._glName);const s=e.createFramebuffer();if(e.bindFramebuffer(t,s),this._colorAttachments.forEach(((e,s)=>{const n=p(e);n===a.Ap.TEXTURE_2D_ARRAY?this._framebufferTextureLayer(e.glName,s,t,0,0):this._framebufferTexture2D(e.glName,s,n,t)})),this._depthStencilBuffer){const s=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(t,s,e.RENDERBUFFER,this._depthStencilBuffer.glName)}else if(this._depthStencilTexture){const e=_(this._depthStencilTexture.descriptor.pixelFormat);this._framebufferTexture2D(this._depthStencilTexture.glName,e,p(this._depthStencilTexture),t)}(0,o.en)()&&e.checkFramebufferStatus(t)!==e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(t,e=a.r6,s=a.Ap.TEXTURE_2D,n=a.R.FRAMEBUFFER,i=0){this._context.gl.framebufferTexture2D(n,e,s,t,i)}_framebufferTextureLayer(t,e=a.r6,s=a.R.FRAMEBUFFER,n=0,i=0){this._context.gl.framebufferTextureLayer(s,e,t,n,i)}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const e=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(a.R.FRAMEBUFFER,e,t.RENDERBUFFER,null)}this._depthStencilBuffer=(0,i.WD)(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,_(this._depthStencilTexture.descriptor.pixelFormat))),this._depthStencilTexture=(0,i.WD)(this._depthStencilTexture))}_validateTextureDescriptor(t){t.target!==a.Ap.TEXTURE_2D&&t.target!==a.Ap.TEXTURE_CUBE_MAP&&t.target!==a.Ap.TEXTURE_2D_ARRAY&&console.error("Texture type must be TEXTURE_2D, TEXTURE_2D_ARRAY or TEXTURE_CUBE_MAP!"),g(t,this._context.parameters.maxTextureSize),this._validateBufferDimensions(t)}_validateRenderbufferDescriptor(t){g(t,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(t)}_validateBufferDimensions(t){t.width<=0&&(t.width=this.width),t.height<=0&&(t.height=this.height),this.width>0&&this.height>0&&(this.width===t.width&&this.height===t.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(t){switch(t.internalFormat){case a.SB.DEPTH_COMPONENT16:case a.SB.DEPTH_COMPONENT24:case a.SB.DEPTH_COMPONENT32F:return a.xL;case a.iE.DEPTH24_STENCIL8:case a.iE.DEPTH32F_STENCIL8:return a.nI;case a.Xo.STENCIL_INDEX8:return a.uH}}_validateColorAttachmentPoint(t){if(-1===c._MAX_COLOR_ATTACHMENTS){const{gl:t}=this._context;c._MAX_COLOR_ATTACHMENTS=t.getParameter(t.MAX_COLOR_ATTACHMENTS)}const e=t-a.r6;e+1>c._MAX_COLOR_ATTACHMENTS&&n.A.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${e+1}. Implementation supports up to ${c._MAX_COLOR_ATTACHMENTS} color attachments`)}}function m(t){return d(t)===l.d.Texture}function d(t){return null!=t&&"type"in t?t.type:null}function g(t,e){const s=Math.max(t.width,t.height);if(s>e){n.A.getLogger("esri.views.webgl.FramebufferObject").warnOnce(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/s;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function p(t){return t.descriptor.target===a.Ap.TEXTURE_CUBE_MAP?a.Ap.TEXTURE_CUBE_MAP_POSITIVE_X:t.descriptor.target===a.Ap.TEXTURE_2D_ARRAY?a.Ap.TEXTURE_2D_ARRAY:a.Ap.TEXTURE_2D}function _(t){return t===a.j7.DEPTH_COMPONENT?a.xL:a.nI}},68449:(t,e,s)=>{s.d(e,{B:()=>S});s(39831);var n=s(16541),i=s(41746);const r=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],o=!1,a=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","uvec2","uvec3","uvec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","usampler1D","usampler2D","usampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],l=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],h=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var u=999,c=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function m(){var t,e,s,n=0,i=0,r=u,o=[],m=[],d=1,g=0,p=0,_=!1,f=!1,y="";return function(t){return m=[],null!==t?v(t.replace?t.replace(/\r\n/g,"\n"):t):(o.length&&x(o.join("")),r=10,x("(eof)"),m)};function x(t){t.length&&m.push({type:c[r],data:t,position:p,line:d,column:g})}function v(e){var o;for(n=0,s=(y+=e).length;t=y[n],n<s;){switch(o=n,r){case 0:n=E();break;case 1:case 2:n=S();break;case 3:n=C();break;case 4:n=T();break;case 11:n=I();break;case 5:n=A();break;case 9999:n=M();break;case 9:n=P();break;case u:n=b()}o!==n&&("\n"===y[o]?(g=0,++d):++g)}return i+=n,y=y.slice(n),m}function b(){return o=o.length?[]:o,"/"===e&&"*"===t?(p=i+n-1,r=0,e=t,n+1):"/"===e&&"/"===t?(p=i+n-1,r=1,e=t,n+1):"#"===t?(r=2,p=i+n,n):/\s/.test(t)?(r=9,p=i+n,n):(_=/\d/.test(t),f=/[^\w_]/.test(t),p=i+n,r=_?4:f?3:9999,n)}function P(){return/[^\s]/g.test(t)?(x(o.join("")),r=u,n):(o.push(t),e=t,n+1)}function S(){return"\r"!==t&&"\n"!==t||"\\"===e?(o.push(t),e=t,n+1):(x(o.join("")),r=u,n)}function E(){return"/"===t&&"*"===e?(o.push(t),x(o.join("")),r=u,n+1):(o.push(t),e=t,n+1)}function C(){if("."===e&&/\d/.test(t))return r=5,n;if("/"===e&&"*"===t)return r=0,n;if("/"===e&&"/"===t)return r=1,n;if("."===t&&o.length){for(;w(o););return r=5,n}if(";"===t||")"===t||"("===t){if(o.length)for(;w(o););return x(t),r=u,n+1}var s=2===o.length&&"="!==t;if(/[\w_\d\s]/.test(t)||s){for(;w(o););return r=u,n}return o.push(t),e=t,n+1}function w(t){for(var e,s,n=0;;){if(e=l.indexOf(t.slice(0,t.length+n).join("")),s=l[e],-1===e){if(n--+t.length>0)continue;s=t.slice(0,1).join("")}return x(s),p+=s.length,(o=o.slice(s.length)).length}}function I(){return/[^a-fA-F0-9]/.test(t)?(x(o.join("")),r=u,n):(o.push(t),e=t,n+1)}function T(){return"."===t||/[eE]/.test(t)?(o.push(t),r=5,e=t,n+1):"x"===t&&1===o.length&&"0"===o[0]?(r=11,o.push(t),e=t,n+1):/[^\d]/.test(t)?(x(o.join("")),r=u,n):(o.push(t),e=t,n+1)}function A(){return"f"===t&&(o.push(t),e=t,n+=1),/[eE]/.test(t)||"-"===t&&/[eE]/.test(e)?(o.push(t),e=t,n+1):/[^\d]/.test(t)?(x(o.join("")),r=u,n):(o.push(t),e=t,n+1)}function M(){if(/[^\d\w_]/.test(t)){var s=o.join("");return r=a.indexOf(s)>-1?8:h.indexOf(s)>-1?7:6,x(o.join("")),r=u,n}return o.push(t),e=t,n+1}}function d(t){return function(t){var e=m(),s=[];return(s=s.concat(e(t))).concat(e(null))}(t)}const g=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function p(t,e){for(let s=e-1;s>=0;s--){const e=t[s];if("whitespace"!==e.type&&"block-comment"!==e.type){if("keyword"!==e.type)break;if("attribute"===e.data||"in"===e.data)return!0}}return!1}function _(t,e,s,n){n=n||s;for(const i of t)if("ident"===i.type&&i.data===s)return n in e?e[n]++:e[n]=0,_(t,e,n+"_"+e[n],n);return s}function f(t,e,s="afterVersion"){function n(t,e){for(let s=e;s<t.length;s++){const e=t[s];if("operator"===e.type&&";"===e.data)return s}return null}const i={data:"\n",type:"whitespace"},r=e=>e<t.length&&/[^\r\n]$/.test(t[e].data);let o=function(t){let e=-1,i=0,r=-1;for(let o=0;o<t.length;o++){const a=t[o];if("preprocessor"===a.type&&(/#(if|ifdef|ifndef)\s+.+/.test(a.data)?++i:/#endif\s*.*/.test(a.data)&&--i),"afterVersion"!==s&&"afterPrecision"!==s||"preprocessor"===a.type&&a.data.startsWith("#version")&&(r=Math.max(r,o)),"afterPrecision"===s&&"keyword"===a.type&&"precision"===a.data){const e=n(t,o);if(null===e)throw new Error("precision statement not followed by any semicolons!");r=Math.max(r,e)}e<r&&0===i&&(e=o)}return e+1}(t);r(o-1)&&t.splice(o++,0,i);for(const a of e)t.splice(o++,0,a);r(o-1)&&r(o)&&t.splice(o,0,i)}function y(t,e,s,n="lowp"){f(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function x(t,e,s,n,i="lowp"){f(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:n.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function v(t,e){let s,n,i=-1;for(let r=e;r<t.length;r++){const e=t[r];if("operator"===e.type&&("["===e.data&&(s=r),"]"===e.data)){n=r;break}"integer"===e.type&&(i=parseInt(e.data,10))}return s&&n&&t.splice(s,n-s+1),i}function b(t,e){if(t.startsWith("#version 300"))return t;const s=function(t){return o?P.get(t):null}(t);if(null!=s)return s;const n=d(t);if("300 es"===function(t,e="100",s="300 es"){const n=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const i of t)if("preprocessor"===i.type){const t=n.exec(i.data);if(t){const n=t[1].replaceAll(/\s{2,}/g," ");if(n===s)return n;if(n===e)return i.data="#version "+s,e;throw new Error("unknown glsl version: "+n)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+s},{type:"whitespace",data:"\n"}),null}(n,"100","300 es"))return t;let a=null,l=null;const h={},u={};for(let o=0;o<n.length;++o){const t=n[o];switch(t.type){case"keyword":e===i.Co.VERTEX_SHADER&&"attribute"===t.data?t.data="in":"varying"===t.data&&(t.data=e===i.Co.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(t.data.trim())&&(t.data=t.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===i.Co.FRAGMENT_SHADER&&"gl_FragColor"===t.data&&(a||(a=_(n,h,"fragColor"),y(n,a,"vec4")),t.data=a),e===i.Co.FRAGMENT_SHADER&&"gl_FragData"===t.data){const e=v(n,o+1),s=_(n,h,"fragData");x(n,s,"vec4",e,"mediump"),t.data=s}else e===i.Co.FRAGMENT_SHADER&&"gl_FragDepthEXT"===t.data&&(l||(l=_(n,h,"gl_FragDepth")),t.data=l);break;case"ident":if(r.includes(t.data)){if(e===i.Co.VERTEX_SHADER&&p(n,o))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");t.data in u||(u[t.data]=_(n,h,t.data)),t.data=u[t.data]}}}for(let i=n.length-1;i>=0;--i){const t=n[i];if("preprocessor"===t.type){const e=t.data.match(/#extension\s+(.*):/);if(e?.[1]&&g.has(e[1].trim())){const t=n[i+1];n.splice(i,t&&"whitespace"===t.type?2:1)}const s=t.data.match(/#ifdef\s+(.*)/);s?.[1]&&g.has(s[1].trim())&&(t.data="#if 1");const r=t.data.match(/#ifndef\s+(.*)/);r?.[1]&&g.has(r[1].trim())&&(t.data="#if 0")}}return function(t,e){return o&&P.set(t,e),e}(t,function(t){return t.map((t=>"eof"!==t.type?t.data:"")).join("")}(n))}const P=new Map;class S{constructor(t,e,s,r,o=new Map,a=[]){this._context=t,this._locations=r,this._uniformBlockBindings=o,this._transformFeedbackVaryings=a,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),0===e.length&&console.error("Shaders source should not be empty!"),e=b(e,i.Co.VERTEX_SHADER),s=b(s,i.Co.FRAGMENT_SHADER),this._vShader=E(this._context,i.Co.VERTEX_SHADER,e),this._fShader=E(this._context,i.Co.FRAGMENT_SHADER,s),w.enabled&&(this._linesOfCode=e.match(/\n/g).length+s.match(/\n/g).length+2,this._context.instanceCounter.increment(i.vt.LinesOfCode,this._vShader,this._linesOfCode)),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(i.vt.Shader,this),(0,n.Xc)()&&(this.vertexShader=e,this.fragmentShader=s),this.usedMemory=e.length+s.length;const l=this._context.gl,h=l.createProgram();l.attachShader(h,this._vShader),l.attachShader(h,this._fShader),this._locations.forEach(((t,e)=>l.bindAttribLocation(h,t,e))),this._transformFeedbackVaryings?.length&&l.transformFeedbackVaryings(h,this._transformFeedbackVaryings,l.SEPARATE_ATTRIBS),l.linkProgram(h),(0,n.Xc)()&&!l.getProgramParameter(h,l.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${l.getProgramParameter(h,l.VALIDATE_STATUS)}, gl error ${l.getError()}, vertex: ${l.getShaderParameter(this._vShader,l.COMPILE_STATUS)}, fragment: ${l.getShaderParameter(this._fShader,l.COMPILE_STATUS)}, info log: ${l.getProgramInfoLog(h)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[n,i]of this._uniformBlockBindings){const t=l.getUniformBlockIndex(h,n);t<4294967295&&l.uniformBlockBinding(h,t,i)}this._glName=h,this._context.instanceCounter.increment(i.vt.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){return!!this._compiled||(this._context.capabilities.parallelShaderCompile&&null!=this.glName?(this._compiled=!!this._context.gl.getProgramParameter(this.glName,i.YY.COMPLETION_STATUS_KHR),this._compiled):(this._compiled=!0,!0))}dispose(){if(--this._refCount>0)return;const t=this._context.gl,e=this._context.instanceCounter;this._nameToUniformLocation.forEach((t=>t&&e.decrement(i.vt.Uniform,t))),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(e.decrement(i.vt.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),t.deleteShader(this._vShader),this._vShader=null,e.decrement(i.vt.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,e.decrement(i.vt.Program,this))}ref(){++this._refCount}_getUniformLocation(t){const e=this._nameToUniformLocation.get(t);if(void 0!==e)return e;if(this.glName){const e=this._context.gl.getUniformLocation(this.glName,t);return this._nameToUniformLocation.set(t,e),e&&this._context.instanceCounter.increment(i.vt.Uniform,e),e}return null}hasUniform(t){return null!=this._getUniformLocation(t)}setUniform1i(t,e){I(e);const s=this._nameToUniform1.get(t);void 0!==s&&e===s||(this._context.gl.uniform1i(this._getUniformLocation(t),e),this._nameToUniform1.set(t,e))}setUniform1iv(t,e){T(e),C(this._nameToUniform1v,t,e)&&this._context.gl.uniform1iv(this._getUniformLocation(t),e)}setUniform2iv(t,e){T(e),C(this._nameToUniform2,t,e)&&this._context.gl.uniform2iv(this._getUniformLocation(t),e)}setUniform3iv(t,e){T(e),C(this._nameToUniform3,t,e)&&this._context.gl.uniform3iv(this._getUniformLocation(t),e)}setUniform4iv(t,e){T(e),C(this._nameToUniform4,t,e)&&this._context.gl.uniform4iv(this._getUniformLocation(t),e)}setUniform1f(t,e){I(e);const s=this._nameToUniform1.get(t);void 0!==s&&e===s||(this._context.gl.uniform1f(this._getUniformLocation(t),e),this._nameToUniform1.set(t,e))}setUniform1fv(t,e){T(e),C(this._nameToUniform1v,t,e)&&this._context.gl.uniform1fv(this._getUniformLocation(t),e)}setUniform2f(t,e,s){I(e,s);const n=this._nameToUniform2.get(t);void 0===n?(this._context.gl.uniform2f(this._getUniformLocation(t),e,s),this._nameToUniform2.set(t,[e,s])):e===n[0]&&s===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),e,s),n[0]=e,n[1]=s)}setUniform2fv(t,e){T(e),C(this._nameToUniform2,t,e)&&this._context.gl.uniform2fv(this._getUniformLocation(t),e)}setUniform3f(t,e,s,n){I(e,s,n);const i=this._nameToUniform3.get(t);void 0===i?(this._context.gl.uniform3f(this._getUniformLocation(t),e,s,n),this._nameToUniform3.set(t,[e,s,n])):e===i[0]&&s===i[1]&&n===i[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),e,s,n),i[0]=e,i[1]=s,i[2]=n)}setUniform3fv(t,e){T(e);const s=this._getUniformLocation(t);null!=s&&C(this._nameToUniform3,t,e)&&this._context.gl.uniform3fv(s,e)}setUniform4f(t,e,s,n,i){I(e,s,n,i);const r=this._nameToUniform4.get(t);void 0===r?(this._context.gl.uniform4f(this._getUniformLocation(t),e,s,n,i),this._nameToUniform4.set(t,[e,s,n,i])):void 0!==r&&e===r[0]&&s===r[1]&&n===r[2]&&i===r[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),e,s,n,i),r[0]=e,r[1]=s,r[2]=n,r[3]=i)}setUniform4fv(t,e){T(e);const s=this._getUniformLocation(t);null!=s&&C(this._nameToUniform4,t,e)&&this._context.gl.uniform4fv(s,e)}setUniformMatrix3fv(t,e,s=!1){T(e);const n=this._getUniformLocation(t);null!=n&&C(this._nameToUniformMatrix3,t,e)&&this._context.gl.uniformMatrix3fv(n,s,e)}setUniformMatrix4fv(t,e,s=!1){T(e);const n=this._getUniformLocation(t);null!=n&&C(this._nameToUniformMatrix4,t,e)&&this._context.gl.uniformMatrix4fv(n,s,e)}stop(){}}function E(t,e,s){const r=t.gl,o=r.createShader(e);return r.shaderSource(o,s),r.compileShader(o),(0,n.Xc)()&&!r.getShaderParameter(o,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===i.Co.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(o)),console.error(function(t){let e=2;return t.replaceAll("\n",(()=>"\n"+function(t){return t>=1e3?t.toString():("  "+t).slice(-3)}(e++)+":"))}(s))),o}function C(t,e,s){const n=t.get(e);if(!n)return t.set(e,Array.from(s)),!0;const i=s.length;if(n.length!==i)return t.set(e,Array.from(s)),!0;for(let r=0;r<i;++r){const t=s[r];if(n[r]!==t){for(n[r]=t;r<i;++r)n[r]=s[r];return!0}}return!1}const w={enabled:!1},I=(0,n.en)()?(...t)=>T(t):()=>{},T=(0,n.en)()?t=>{const e=t.length;for(let s=0;s<e;++s){const e=t[s];Number.isNaN(e)&&console.error(`Got ${e} as uniform value from ${(new Error).stack}`)}}:()=>{}},50122:(t,e,s)=>{s.d(e,{r:()=>i});var n=s(68449);function i(t,e,s=""){return new n.B(t,s+e.shaders.vertexShader,s+e.shaders.fragmentShader,e.attributes)}},74416:(t,e,s)=>{s.d(e,{l:()=>o});var n=s(41746),i=s(35644),r=s(94669);class o{constructor(t,e){this._context=t,this._descriptor=e,this.type=i.d.Renderbuffer,this._context.instanceCounter.increment(n.vt.Renderbuffer,this);const s=this._context.gl;this.glName=s.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:r,height:o,internalFormat:a,multisampled:l}=e;l?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,a,r,o):s.renderbufferStorage(s.RENDERBUFFER,a,r,o),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const t=this._descriptor.samples,e=this._context.parameters.maxSamples;return t?Math.min(t,e):e}get usedMemory(){return(0,r.e)(this._descriptor)}resize(t,e){const s=this._descriptor;if(s.width===t&&s.height===e)return;s.width=t,s.height=e;const n=this._context.gl;this._context.bindRenderbuffer(this),s.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,s.internalFormat,s.width,s.height):n.renderbufferStorage(n.RENDERBUFFER,s.internalFormat,s.width,s.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(n.vt.Renderbuffer,this),this._context=null)}}},94669:(t,e,s)=>{s.d(e,{e:()=>r,q:()=>i});var n=s(19282);class i{constructor(t,e=0,s=e){this.internalFormat=t,this.width=e,this.height=s,this.multisampled=!1,this.samples=1}}function r(t){return t.width<=0||t.height<=0||null==t.internalFormat?0:t.width*t.height*(0,n.IB)(t.internalFormat)}},96028:(t,e,s)=>{s.d(e,{N5:()=>l});var n=s(98849),i=(s(39831),s(539)),r=s(11809);const o=()=>i.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class a{constructor(){this._includedModules=new Map}include(t,e){this._includedModules.has(t)?this._includedModules.get(t):(this._includedModules.set(t,e),t(this.builder,e))}}class l extends a{constructor(){super(...arguments),this.vertex=new m,this.fragment=new m,this.attributes=new d,this.varyings=new g,this.extensions=new p,this.outputs=new _}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t,e=!1){const s=this.extensions.generateSource(t),n=this.attributes.generateSource(t),i=this.varyings.generateSource(t),r="vertex"===t?this.vertex:this.fragment,o=r.uniforms.generateSource(),a=r.code.generateSource(),l=r.main.generateSource(e),h="vertex"===t?x:y,u=r.constants.generateSource(),c=this.outputs.generateSource(t);return`#version 300 es\n${s.join("\n")}\n${h}\n${u.join("\n")}\n${o.join("\n")}\n${n.join("\n")}\n${i.join("\n")}\n${c.join("\n")}\n${a.join("\n")}\n${l.join("\n")}`}generateBind(t){const e=new Map;this.vertex.uniforms.entries.forEach((t=>{const s=t.bind[r.c.Bind];s&&e.set(t.name,s)})),this.fragment.uniforms.entries.forEach((t=>{const s=t.bind[r.c.Bind];s&&e.set(t.name,s)}));const s=Array.from(e.values()),n=s.length;return e=>{for(let i=0;i<n;++i)s[i](t,e)}}generateBindPass(t){const e=new Map;this.vertex.uniforms.entries.forEach((t=>{const s=t.bind[r.c.Pass];s&&e.set(t.name,s)})),this.fragment.uniforms.entries.forEach((t=>{const s=t.bind[r.c.Pass];s&&e.set(t.name,s)}));const s=Array.from(e.values()),n=s.length;return(e,i)=>{for(let r=0;r<n;++r)s[r](t,e,i)}}generateBindDraw(t){const e=new Map;this.vertex.uniforms.entries.forEach((t=>{const s=t.bind[r.c.Draw];s&&e.set(t.name,s)})),this.fragment.uniforms.entries.forEach((t=>{const s=t.bind[r.c.Draw];s&&e.set(t.name,s)}));const s=Array.from(e.values()),n=s.length;return(e,i,r)=>{for(let o=0;o<n;++o)s[o](t,r,e,i)}}}class h{constructor(t){this._stage=t,this._entries=new Map}add(...t){for(const e of t)this._add(e);return this._stage}get(t){return this._entries.get(t)}_add(t){if(null!=t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new n.A("shaderbuilder:duplicate-uniform",`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}else o().error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((({name:t,arraySize:e,type:s})=>null!=e?`uniform ${s} ${t}[${e}];`:`uniform ${s} ${t};`))}get entries(){return Array.from(this._entries.values())}}class u{constructor(t){this._stage=t,this._bodies=new Array}add(t){return this._bodies.push(t),this._stage}generateSource(t){if(this._bodies.length>0)return[`void main() {\n ${this._bodies.join("\n")||""} \n}`];if(t)throw new n.A("shaderbuilder:missing-main","Shader does not contain main function body.");return[]}}class c{constructor(t){this._stage=t,this._entries=new Array}add(t){return this._entries.push(t),this._stage}generateSource(){return this._entries}}class m extends a{constructor(){super(...arguments),this.uniforms=new h(this),this.main=new u(this),this.code=new c(this),this.constants=new f(this)}get builder(){return this}}class d{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(t){return"fragment"===t?[]:this._entries.map((t=>`in ${t[1]} ${t[0]};`))}}class g{constructor(){this._entries=new Map}add(t,e,s){this._entries.has(t)?o().warn(`Ignoring duplicate varying ${e} ${t}`):this._entries.set(t,{type:e,invariant:s?.invariant??!1})}generateSource(t){const e=new Array;return this._entries.forEach(((s,n)=>e.push((s.invariant&&"vertex"===t?"invariant ":"")+("vertex"===t?"out":"in")+` ${s.type} ${n};`))),e}}class p{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const e="vertex"===t?p.ALLOWLIST_VERTEX:p.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((t=>e.includes(t))).map((t=>`#extension ${t} : enable`))}static{this.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"]}static{this.ALLOWLIST_VERTEX=[]}}class _{constructor(){this._entries=new Map}add(t,e,s=0){const n=this._entries.get(s);n?.name!==t||n?.type!==e?this._entries.set(s,{name:t,type:e}):o().warn(`Fragment shader output location ${s} occupied`)}static{this.DEFAULT_TYPE="vec4"}static{this.DEFAULT_NAME="fragColor"}generateSource(t){if("vertex"===t)return[];0===this._entries.size&&this._entries.set(0,{name:_.DEFAULT_NAME,type:_.DEFAULT_TYPE});const e=new Array;return this._entries.forEach(((t,s)=>e.push(`layout(location = ${s}) out ${t.type} ${t.name};`))),e}}class f{constructor(t){this._stage=t,this._entries=new Set}add(t,e,s){let n="ERROR_CONSTRUCTOR_STRING";switch(e){case"float":n=f._numberToFloatStr(s);break;case"int":n=f._numberToIntStr(s);break;case"bool":n=s.toString();break;case"vec2":n=`vec2(${f._numberToFloatStr(s[0])},                            ${f._numberToFloatStr(s[1])})`;break;case"vec3":n=`vec3(${f._numberToFloatStr(s[0])},                            ${f._numberToFloatStr(s[1])},                            ${f._numberToFloatStr(s[2])})`;break;case"vec4":n=`vec4(${f._numberToFloatStr(s[0])},                            ${f._numberToFloatStr(s[1])},                            ${f._numberToFloatStr(s[2])},                            ${f._numberToFloatStr(s[3])})`;break;case"ivec2":n=`ivec2(${f._numberToIntStr(s[0])},                             ${f._numberToIntStr(s[1])})`;break;case"ivec3":n=`ivec3(${f._numberToIntStr(s[0])},                             ${f._numberToIntStr(s[1])},                             ${f._numberToIntStr(s[2])})`;break;case"ivec4":n=`ivec4(${f._numberToIntStr(s[0])},                             ${f._numberToIntStr(s[1])},                             ${f._numberToIntStr(s[2])},                             ${f._numberToIntStr(s[3])})`;break;case"uvec2":n=`uvec2(${f._numberToIntStr(s[0])},                             ${f._numberToIntStr(s[1])})`;break;case"uvec3":n=`uvec3(${f._numberToIntStr(s[0])},                             ${f._numberToIntStr(s[1])},                             ${f._numberToIntStr(s[2])})`;break;case"uvec4":n=`uvec4(${f._numberToIntStr(s[0])},                             ${f._numberToIntStr(s[1])},                             ${f._numberToIntStr(s[2])},                             ${f._numberToIntStr(s[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${e}(${Array.prototype.map.call(s,(t=>f._numberToFloatStr(t))).join(", ")})`}return this._entries.add(`const ${e} ${t} = ${n};`),this._stage}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const y="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n  precision highp sampler2D;\n  precision highp usampler2D;\n  precision highp sampler2DArray;\n  precision highp sampler2DShadow;\n#else\n  precision mediump float;\n  precision mediump int;\n  precision mediump sampler2D;\n  precision mediump usampler2D;\n  precision mediump sampler2DArray;\n  precision mediump sampler2DShadow;\n#endif",x="precision highp float;\n precision highp sampler2D;\n precision highp usampler2D;\n precision highp sampler2DArray;\n precision highp sampler2DShadow;\n\n\n invariant gl_Position;\n "},29638:(t,e,s)=>{s.d(e,{Z:()=>n});class n{constructor(t){this._readFile=t}resolveIncludes(t){return this._resolve(t)}_resolve(t,e=new Map){if(e.has(t))return e.get(t);const s=this._read(t);if(!s)throw new Error(`cannot find shader file ${t}`);const n=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let i=n.exec(s);const r=[];for(;null!=i;)r.push({path:i[1],start:i.index,length:i[0].length}),i=n.exec(s);let o=0,a="";return r.forEach((t=>{a+=s.slice(o,t.start),a+=e.has(t.path)?"":this._resolve(t.path,e),o=t.start+t.length})),a+=s.slice(o),e.set(t,a),a}_read(t){return this._readFile(t)}}},80976:(t,e,s)=>{s.d(e,{Z:()=>h});var n=s(539),i=s(6267),r=s(4754),o=s(41746),a=s(19282);const l=()=>n.A.getLogger("esri.views.webgl.VertexArrayObject");let h=class{constructor(t,e,s,n,i=null){this._context=t,this._locations=e,this._layout=s,this._buffers=n,this._indexBuffer=i,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}getByteLength(t){return this._buffers.get(t)?.usedMemory??0}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return Array.from(this._buffers.values()).reduce(((t,e)=>t+e.usedMemory),this._indexBuffer?.usedMemory??0+(this._buffers.size+(this._indexBuffer?1:0))*r.i5)}get cachedMemory(){return this.usedMemory}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this._indexBuffer=(0,i.WD)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:t}=this._context,e=t.createVertexArray();t.bindVertexArray(e),this._bindLayout(),t.bindVertexArray(null),this._glName=e,this._context.instanceCounter.increment(o.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:t,_layout:e,_indexBuffer:s}=this;t||l().error("Vertex buffer dictionary is empty!");const n=this._context.gl;this._buffers.forEach(((t,s)=>{const n=e.get(s);n?(0,a.yu)(this._context,this._locations,t,n):l().error("Vertex element descriptor is empty!")})),null!=s&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},69955:(t,e,s)=>{s.d(e,{_:()=>n});class n{constructor(t,e,s,n,i,r=!1,o=0){this.name=t,this.count=e,this.type=s,this.offset=n,this.stride=i,this.normalized=r,this.divisor=o}}},15954:(t,e,s)=>{var n;s.d(e,{X:()=>n}),function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"}(n||(n={}))},73339:(t,e,s)=>{s.d(e,{aK:()=>l,yr:()=>g,oW:()=>m});var n=s(74833);const i=(t,{host:e,key:s,isReactive:i},r)=>{const o=e,a=o[s]!==t.exports,l=o[s]!==r,h=r!==t.exports;a&&!l&&h&&(o[s]=t.exports);if(e===t.component){if(i){const e=t.component.manager;l&&e.W(t,o[s]),t.onUpdate((n=>{if(n.has(s)){const n=o[s];n!==t.exports&&e.W(t,n)}}))}t.O=i?void 0:s}const u=t.component.constructor.elementProperties.get(s)?.readOnly;t.watchExports((()=>{o[s]!==t.exports&&(u?(0,n.h)((()=>{o[s]=t.exports})):o[s]=t.exports)}))};var r=s(41331),o=s(37685);const a=t=>u(void 0,t),l=t=>e=>u(e,t);class h extends n.C{constructor(t,e){super(t);const s=this.exports;try{(0,n.s)(this.component);const t=e(this.component,this),i=this.exports!==s;if((0,n.i)(t)){i||this.setProvisionalExports(t);const e=t.then((t=>{this.exports=t,super.catchUpLifecycle()})).catch((t=>{this.P.reject(t),console.error(t)}));this.onLoad((async()=>await e))}else i&&void 0===t||(this.exports=t),queueMicrotask((()=>super.catchUpLifecycle()))}catch(i){this.P.reject(i),console.error(i)}}catchUpLifecycle(){}}const u=(c=h,(...t)=>{const e=(0,n.e)(),s=new c(...t),r=s.exports;(0,n.d)(e.at(-1));const o=s.component.manager;o.W(s,r),s.watchExports(o.W.bind(o,s)),(0,n.o)(s);const a=[s.component,...e].reverse();return(0,n.t)(a,(t=>void 0===t?void 0:i(s,t,r)),r)});var c;const m=(t,e)=>new d(t,e);class d extends n.C{#t;#e;#s;constructor(t,e){super(),r.S$||(this.#e=t,this.#s=e,this.#t=new MutationObserver((s=>{s.forEach((s=>{t.includes(s.attributeName)&&e.call(this.component,this.component.el.getAttribute(s.attributeName),s.oldValue,s.attributeName)}))})))}hostConnected(){this.#e.forEach((t=>{this.component.el.hasAttribute(t)&&this.#s.call(this.component,null,this.component.el.getAttribute(t),t)})),this.#t.observe(this.component.el,{attributes:!0,attributeOldValue:!0,attributeFilter:this.#e})}hostDisconnected(){this.#t.disconnect()}}const g=t=>(e={})=>a(((s,n)=>{const i=(0,o.kn)(s.el),r={_lang:i.lang,_t9nLocale:i.t9nLocale,_loading:!0},a=s;n.onLifecycle((()=>(0,o.hd)(s.el,(()=>t("./assets")),(({t9nLocale:t,t9nStrings:e,lang:i})=>{const r={...e,_lang:i,_t9nLocale:t,_loading:!1};n.exports=r;const o=e.componentLabel;"string"==typeof o&&"label"in s&&null==s.label&&(s.label??=o),l(a.messageOverrides)}),e.name)));const l=t=>{const e=n.exports,s=e._original??e,i=p(s,t);t&&(i._original=s),n.exports=i};return"messageOverrides"in a&&n.onUpdate((t=>{t.has("messageOverrides")&&l(a.messageOverrides)})),e.blocking?(n.setProvisionalExports(r,!1),n.ready):r})),p=(t,e)=>{if(!e)return t;const s={...t};return Object.entries(e).forEach((([e,n])=>{s[e]="object"==typeof n?p(t[e],n):n??t[e]})),s}},70605:(t,e,s)=>{s.d(e,{F:()=>u});var n=s(95191),i=s(44068),r=s(54714),o=s(44603);const a="calcite-floating-ui-arrow",l="calcite-floating-ui-arrow__stroke",h={width:12,height:6,strokeWidth:1},u=({floatingLayout:t,key:e,ref:s})=>{const{width:u,height:c,strokeWidth:m}=h,d=u/2,g="vertical"===t,p=`M0,0 H${u} L${u-d},${c} Q${d},${c} ${d},${c} Z`;return(0,i.D)(e,r.qy`<svg aria-hidden=true class=${(0,o.CP)(a)} height=${u} viewBox=${`0 0 ${u} ${u+(g?0:m)}`} width=${u+(g?m:0)} ${(0,n.K)(s)}>${r.JW`${r.JW`<path class=${(0,o.CP)(l)} d=${p??r.s6} fill=none stroke-width=${m+1} />`||""}<path d=${p??r.s6} stroke=none />`}</svg>`)}},64708:(t,e,s)=>{s.d(e,{H:()=>o});var n=s(44068),i=s(66905),r=s(44603);const o=({children:t,...e})=>{const s=e.level?(0,i.Bk)(`h${e.level}`):i.eu`div`;return(0,n.D)(e.key,i.qy`<${s} class=${(0,r.CP)(e.class)}>${t}</${s}>`)}},695:(t,e,s)=>{function n(t,e){return(t+e)%e}s.d(e,{g:()=>n})},66865:(t,e,s)=>{s.d(e,{c:()=>i,g:()=>n});s(23424);function n(t){return"l"===t?"m":"s"}async function i(t){await t.componentOnReady(),await t.updateComplete}},25450:(t,e,s)=>{s.d(e,{C:()=>w,D:()=>O,a:()=>q,b:()=>F,c:()=>A,d:()=>X,e:()=>Y,f:()=>L,g:()=>I,h:()=>k,i:()=>U,k:()=>J,l:()=>N,m:()=>j,n:()=>C,o:()=>E,p:()=>S,q:()=>D,r:()=>z,s:()=>B,t:()=>V,u:()=>H,v:()=>G,w:()=>W,x:()=>R,y:()=>T,z:()=>Z});var n=s(7025),i=s(14558),r=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"].join(","),o="undefined"==typeof Element,a=o?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,l=!o&&Element.prototype.getRootNode?function(t){var e;return null==t||null===(e=t.getRootNode)||void 0===e?void 0:e.call(t)}:function(t){return null==t?void 0:t.ownerDocument},h=function t(e,s){var n;void 0===s&&(s=!0);var i=null==e||null===(n=e.getAttribute)||void 0===n?void 0:n.call(e,"inert");return""===i||"true"===i||s&&e&&t(e.parentNode)},u=function t(e,s,n){for(var i=[],o=Array.from(e);o.length;){var l=o.shift();if(!h(l,!1))if("SLOT"===l.tagName){var u=l.assignedElements(),c=t(u.length?u:l.children,!0,n);n.flatten?i.push.apply(i,c):i.push({scopeParent:l,candidates:c})}else{a.call(l,r)&&n.filter(l)&&(s||!e.includes(l))&&i.push(l);var m=l.shadowRoot||"function"==typeof n.getShadowRoot&&n.getShadowRoot(l),d=!h(m,!1)&&(!n.shadowRootFilter||n.shadowRootFilter(l));if(m&&d){var g=t(!0===m?l.children:m.children,!0,n);n.flatten?i.push.apply(i,g):i.push({scopeParent:l,candidates:g})}else o.unshift.apply(o,l.children)}}return i},c=function(t){return!isNaN(parseInt(t.getAttribute("tabindex"),10))},m=function(t){if(!t)throw new Error("No node provided");return t.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||function(t){var e,s=null==t||null===(e=t.getAttribute)||void 0===e?void 0:e.call(t,"contenteditable");return""===s||"true"===s}(t))&&!c(t)?0:t.tabIndex},d=function(t,e){return t.tabIndex===e.tabIndex?t.documentOrder-e.documentOrder:t.tabIndex-e.tabIndex},g=function(t){return"INPUT"===t.tagName},p=function(t){return function(t){return g(t)&&"radio"===t.type}(t)&&!function(t){if(!t.name)return!0;var e,s=t.form||l(t),n=function(t){return s.querySelectorAll('input[type="radio"][name="'+t+'"]')};if("undefined"!=typeof window&&void 0!==window.CSS&&"function"==typeof window.CSS.escape)e=n(window.CSS.escape(t.name));else try{e=n(t.name)}catch(r){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",r.message),!1}var i=function(t,e){for(var s=0;s<t.length;s++)if(t[s].checked&&t[s].form===e)return t[s]}(e,t.form);return!i||i===t}(t)},_=function(t){var e=t.getBoundingClientRect(),s=e.width,n=e.height;return 0===s&&0===n},f=function(t,e){var s=e.displayCheck,n=e.getShadowRoot;if("hidden"===getComputedStyle(t).visibility)return!0;var i=a.call(t,"details>summary:first-of-type")?t.parentElement:t;if(a.call(i,"details:not([open]) *"))return!0;if(s&&"full"!==s&&"legacy-full"!==s){if("non-zero-area"===s)return _(t)}else{if("function"==typeof n){for(var r=t;t;){var o=t.parentElement,h=l(t);if(o&&!o.shadowRoot&&!0===n(o))return _(t);t=t.assignedSlot?t.assignedSlot:o||h===t.ownerDocument?o:h.host}t=r}if(function(t){var e,s,n,i,r=t&&l(t),o=null===(e=r)||void 0===e?void 0:e.host,a=!1;if(r&&r!==t)for(a=!!(null!==(s=o)&&void 0!==s&&null!==(n=s.ownerDocument)&&void 0!==n&&n.contains(o)||null!=t&&null!==(i=t.ownerDocument)&&void 0!==i&&i.contains(t));!a&&o;){var h,u,c;a=!(null===(u=o=null===(h=r=l(o))||void 0===h?void 0:h.host)||void 0===u||null===(c=u.ownerDocument)||void 0===c||!c.contains(o))}return a}(t))return!t.getClientRects().length;if("legacy-full"!==s)return!0}return!1},y=function(t,e){return!(e.disabled||h(e)||function(t){return g(t)&&"hidden"===t.type}(e)||f(e,t)||function(t){return"DETAILS"===t.tagName&&Array.prototype.slice.apply(t.children).some((function(t){return"SUMMARY"===t.tagName}))}(e)||function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var e=t.parentElement;e;){if("FIELDSET"===e.tagName&&e.disabled){for(var s=0;s<e.children.length;s++){var n=e.children.item(s);if("LEGEND"===n.tagName)return!!a.call(e,"fieldset[disabled] *")||!n.contains(t)}return!0}e=e.parentElement}return!1}(e))},x=function(t,e){return!(p(e)||m(e)<0||!y(t,e))},v=function(t){var e=parseInt(t.getAttribute("tabindex"),10);return!!(isNaN(e)||e>=0)},b=function t(e){var s=[],n=[];return e.forEach((function(e,i){var r=!!e.scopeParent,o=r?e.scopeParent:e,a=function(t,e){var s=m(t);return s<0&&e&&!c(t)?0:s}(o,r),l=r?t(e.candidates):o;0===a?r?s.push.apply(s,l):s.push(o):n.push({documentOrder:i,tabIndex:a,item:e,isScope:r,content:l})})),n.sort(d).reduce((function(t,e){return e.isScope?t.push.apply(t,e.content):t.push(e.content),t}),[]).concat(s)},P=function(t,e){var s;return s=(e=e||{}).getShadowRoot?u([t],e.includeContainer,{filter:x.bind(null,e),flatten:!1,getShadowRoot:e.getShadowRoot,shadowRootFilter:v}):function(t,e,s){if(h(t))return[];var n=Array.prototype.slice.apply(t.querySelectorAll(r));return e&&a.call(t,r)&&n.unshift(t),n.filter(s)}(t,e.includeContainer,x.bind(null,e)),b(s)};const S={getShadowRoot:!0};function E(t){return t?t.id=t.id||`${t.tagName.toLowerCase()}-${(0,n.g)()}`:""}function C(t){return Array.isArray(t)?t:Array.from(t)}function w(t){const e=N(t,`.${i.C.darkMode}, .${i.C.lightMode}, .${i.C.autoMode}`);return e?.classList.contains("calcite-mode-dark")||e?.classList.contains("calcite-mode-auto")&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function I(t){const e=N(t,"[dir]");return e?e.getAttribute("dir"):"ltr"}function T(t){return t.getRootNode()}function A(t){const e=T(t);return"host"in e?e:null}function M(t){return t.host||null}function D(t,{selector:e,id:s}){if(!t)return null;t.assignedSlot&&(t=t.assignedSlot);const n=T(t);return(s?"getElementById"in n?n.getElementById(s):null:e?n.querySelector(e):null)||D(M(n),{selector:e,id:s})}function N(t,e){return t?t.closest(e)||N(M(T(t)),e):null}async function F(t){if(t)return function(t){return"function"==typeof t?.setFocus}(t)?t.setFocus():t.focus()}function R(t){if(t)return P(t,S)[0]??t}function k(t){R(t)?.focus()}function L(t,e){return Array.from(t.children).filter((t=>t.matches(e)))}function G(t,e,s){return"string"==typeof e&&""!==e?e:""===e||!0===e?t[s]:void 0}function V(t){return Boolean(t).toString()}function z(t){return q(t)||function(t){return!!function(t){return function(t){return t.currentTarget.assignedNodes({flatten:!0})}(t).filter((t=>t.nodeType===Node.TEXT_NODE)).map((t=>t.textContent)).join("").trim()}(t)}(t)}function O(t){for(const e of t.childNodes)if(e.nodeType===Node.TEXT_NODE&&""!==e.textContent?.trim()||e.nodeType===Node.ELEMENT_NODE)return!0;return!1}function q(t){return!!B(t).length}function B(t,e){return Y(t.target,e)}function Y(t,e){const s=t.assignedElements({flatten:!0});return e?function(t,e){return t.filter((t=>t.matches(e)))}(s,e):s}function U(t){return!(!t.isPrimary||0!==t.button)}function H(t){return 0===t.detail}const X=(t,e,s,n=!0)=>{const i=t.indexOf(e),r=0===i,o=i===t.length-1;let a;return n&&(s="previous"===s&&r?"last":"next"===s&&o?"first":s),a="previous"===s?t[i-1]||t[n?t.length-1:i]:"next"===s?t[i+1]||t[n?0:i]:"last"===s?t[t.length-1]:t[0],F(a),a};function j(t,e){if(t.parentNode!==e.parentNode)return!1;const s=Array.from(t.parentNode.children);return s.indexOf(t)<s.indexOf(e)}async function Z(t,e,s,n){return K(t,e,"animation",s,n)}async function W(t,e,s,n){return K(t,e,"transition",s,n)}function $(t,e,s){const n="transition"===e?"transitionProperty":"animationName";return t.getAnimations().find((t=>t[n]===s))}async function K(t,e,s,n,i){let r=$(t,s,e);if(r||(await Q(),r=$(t,s,e)),!r)return async function(t,e){await Q(),t?.(),await Q(),e?.()}(n,i);n?.();try{await r.finished}catch{}finally{i?.()}}function Q(){return new Promise((t=>requestAnimationFrame((()=>t()))))}function J(t){switch(!0){case t.endsWith("px"):return parseFloat(t);case t.endsWith("vw"):return window.innerWidth/100*parseFloat(t);case t.endsWith("vh"):return window.innerHeight/100*parseFloat(t);default:return 0}}},36249:(t,e,s)=>{s.d(e,{F:()=>Zt,a:()=>re,b:()=>Xt,c:()=>ie,d:()=>oe,e:()=>jt,f:()=>$t,h:()=>ne,r:()=>Qt});var n=s(41331);const i=["top","right","bottom","left"],r=["start","end"],o=i.reduce(((t,e)=>t.concat(e,e+"-"+r[0],e+"-"+r[1])),[]),a=Math.min,l=Math.max,h=Math.round,u=Math.floor,c=t=>({x:t,y:t}),m={left:"right",right:"left",bottom:"top",top:"bottom"},d={start:"end",end:"start"};function g(t,e,s){return l(t,a(e,s))}function p(t,e){return"function"==typeof t?t(e):t}function _(t){return t.split("-")[0]}function f(t){return t.split("-")[1]}function y(t){return"x"===t?"y":"x"}function x(t){return"y"===t?"height":"width"}const v=new Set(["top","bottom"]);function b(t){return v.has(_(t))?"y":"x"}function P(t){return y(b(t))}function S(t,e,s){void 0===s&&(s=!1);const n=f(t),i=P(t),r=x(i);let o="x"===i?n===(s?"end":"start")?"right":"left":"start"===n?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=M(o)),[o,M(o)]}function E(t){return t.replace(/start|end/g,(t=>d[t]))}const C=["left","right"],w=["right","left"],I=["top","bottom"],T=["bottom","top"];function A(t,e,s,n){const i=f(t);let r=function(t,e,s){switch(t){case"top":case"bottom":return s?e?w:C:e?C:w;case"left":case"right":return e?I:T;default:return[]}}(_(t),"start"===s,n);return i&&(r=r.map((t=>t+"-"+i)),e&&(r=r.concat(r.map(E)))),r}function M(t){return t.replace(/left|right|bottom|top/g,(t=>m[t]))}function D(t){return"number"!=typeof t?function(t){return{top:0,right:0,bottom:0,left:0,...t}}(t):{top:t,right:t,bottom:t,left:t}}function N(t){const{x:e,y:s,width:n,height:i}=t;return{width:n,height:i,top:s,left:e,right:e+n,bottom:s+i,x:e,y:s}}function F(t,e,s){let{reference:n,floating:i}=t;const r=b(e),o=P(e),a=x(o),l=_(e),h="y"===r,u=n.x+n.width/2-i.width/2,c=n.y+n.height/2-i.height/2,m=n[a]/2-i[a]/2;let d;switch(l){case"top":d={x:u,y:n.y-i.height};break;case"bottom":d={x:u,y:n.y+n.height};break;case"right":d={x:n.x+n.width,y:c};break;case"left":d={x:n.x-i.width,y:c};break;default:d={x:n.x,y:n.y}}switch(f(e)){case"start":d[o]-=m*(s&&h?-1:1);break;case"end":d[o]+=m*(s&&h?-1:1)}return d}async function R(t,e){var s;void 0===e&&(e={});const{x:n,y:i,platform:r,rects:o,elements:a,strategy:l}=t,{boundary:h="clippingAncestors",rootBoundary:u="viewport",elementContext:c="floating",altBoundary:m=!1,padding:d=0}=p(e,t),g=D(d),_=a[m?"floating"===c?"reference":"floating":c],f=N(await r.getClippingRect({element:null==(s=await(null==r.isElement?void 0:r.isElement(_)))||s?_:_.contextElement||await(null==r.getDocumentElement?void 0:r.getDocumentElement(a.floating)),boundary:h,rootBoundary:u,strategy:l})),y="floating"===c?{x:n,y:i,width:o.floating.width,height:o.floating.height}:o.reference,x=await(null==r.getOffsetParent?void 0:r.getOffsetParent(a.floating)),v=await(null==r.isElement?void 0:r.isElement(x))&&await(null==r.getScale?void 0:r.getScale(x))||{x:1,y:1},b=N(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:y,offsetParent:x,strategy:l}):y);return{top:(f.top-b.top+g.top)/v.y,bottom:(b.bottom-f.bottom+g.bottom)/v.y,left:(f.left-b.left+g.left)/v.x,right:(b.right-f.right+g.right)/v.x}}function k(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function L(t){return i.some((e=>t[e]>=0))}const G=new Set(["left","top"]);function V(){return"undefined"!=typeof window}function z(t){return B(t)?(t.nodeName||"").toLowerCase():"#document"}function O(t){var e;return(null==t||null==(e=t.ownerDocument)?void 0:e.defaultView)||window}function q(t){var e;return null==(e=(B(t)?t.ownerDocument:t.document)||window.document)?void 0:e.documentElement}function B(t){return!!V()&&(t instanceof Node||t instanceof O(t).Node)}function Y(t){return!!V()&&(t instanceof Element||t instanceof O(t).Element)}function U(t){return!!V()&&(t instanceof HTMLElement||t instanceof O(t).HTMLElement)}function H(t){return!(!V()||"undefined"==typeof ShadowRoot)&&(t instanceof ShadowRoot||t instanceof O(t).ShadowRoot)}const X=new Set(["inline","contents"]);function j(t){const{overflow:e,overflowX:s,overflowY:n,display:i}=rt(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+s)&&!X.has(i)}const Z=new Set(["table","td","th"]);function W(t){return Z.has(z(t))}const $=[":popover-open",":modal"];function K(t){return $.some((e=>{try{return t.matches(e)}catch(s){return!1}}))}const Q=["transform","translate","scale","rotate","perspective"],J=["transform","translate","scale","rotate","perspective","filter"],tt=["paint","layout","strict","content"];function et(t){const e=st(),s=Y(t)?rt(t):t;return Q.some((t=>!!s[t]&&"none"!==s[t]))||!!s.containerType&&"normal"!==s.containerType||!e&&!!s.backdropFilter&&"none"!==s.backdropFilter||!e&&!!s.filter&&"none"!==s.filter||J.some((t=>(s.willChange||"").includes(t)))||tt.some((t=>(s.contain||"").includes(t)))}function st(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}const nt=new Set(["html","body","#document"]);function it(t){return nt.has(z(t))}function rt(t){return O(t).getComputedStyle(t)}function ot(t){return Y(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function at(t){if("html"===z(t))return t;const e=t.assignedSlot||t.parentNode||H(t)&&t.host||q(t);return H(e)?e.host:e}function lt(t){const e=at(t);return it(e)?t.ownerDocument?t.ownerDocument.body:t.body:U(e)&&j(e)?e:lt(e)}function ht(t,e,s){var n;void 0===e&&(e=[]),void 0===s&&(s=!0);const i=lt(t),r=i===(null==(n=t.ownerDocument)?void 0:n.body),o=O(i);if(r){const t=ut(o);return e.concat(o,o.visualViewport||[],j(i)?i:[],t&&s?ht(t):[])}return e.concat(i,ht(i,[],s))}function ut(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function ct(t){const e=rt(t);let s=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const i=U(t),r=i?t.offsetWidth:s,o=i?t.offsetHeight:n,a=h(s)!==r||h(n)!==o;return a&&(s=r,n=o),{width:s,height:n,$:a}}function mt(t){return Y(t)?t:t.contextElement}function dt(t){const e=mt(t);if(!U(e))return c(1);const s=e.getBoundingClientRect(),{width:n,height:i,$:r}=ct(e);let o=(r?h(s.width):s.width)/n,a=(r?h(s.height):s.height)/i;return o&&Number.isFinite(o)||(o=1),a&&Number.isFinite(a)||(a=1),{x:o,y:a}}const gt=c(0);function pt(t){const e=O(t);return st()&&e.visualViewport?{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}:gt}function _t(t,e,s,n){void 0===e&&(e=!1),void 0===s&&(s=!1);const i=t.getBoundingClientRect(),r=mt(t);let o=c(1);e&&(n?Y(n)&&(o=dt(n)):o=dt(t));const a=function(t,e,s){return void 0===e&&(e=!1),!(!s||e&&s!==O(t))&&e}(r,s,n)?pt(r):c(0);let l=(i.left+a.x)/o.x,h=(i.top+a.y)/o.y,u=i.width/o.x,m=i.height/o.y;if(r){const t=O(r),e=n&&Y(n)?O(n):n;let s=t,i=ut(s);for(;i&&n&&e!==s;){const t=dt(i),e=i.getBoundingClientRect(),n=rt(i),r=e.left+(i.clientLeft+parseFloat(n.paddingLeft))*t.x,o=e.top+(i.clientTop+parseFloat(n.paddingTop))*t.y;l*=t.x,h*=t.y,u*=t.x,m*=t.y,l+=r,h+=o,s=O(i),i=ut(s)}}return N({width:u,height:m,x:l,y:h})}function ft(t,e){const s=ot(t).scrollLeft;return e?e.left+s:_t(q(t)).left+s}function yt(t,e,s){void 0===s&&(s=!1);const n=t.getBoundingClientRect();return{x:n.left+e.scrollLeft-(s?0:ft(t,n)),y:n.top+e.scrollTop}}const xt=new Set(["absolute","fixed"]);function vt(t,e,s){let n;if("viewport"===e)n=function(t,e){const s=O(t),n=q(t),i=s.visualViewport;let r=n.clientWidth,o=n.clientHeight,a=0,l=0;if(i){r=i.width,o=i.height;const t=st();(!t||t&&"fixed"===e)&&(a=i.offsetLeft,l=i.offsetTop)}return{width:r,height:o,x:a,y:l}}(t,s);else if("document"===e)n=function(t){const e=q(t),s=ot(t),n=t.ownerDocument.body,i=l(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),r=l(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let o=-s.scrollLeft+ft(t);const a=-s.scrollTop;return"rtl"===rt(n).direction&&(o+=l(e.clientWidth,n.clientWidth)-i),{width:i,height:r,x:o,y:a}}(q(t));else if(Y(e))n=function(t,e){const s=_t(t,!0,"fixed"===e),n=s.top+t.clientTop,i=s.left+t.clientLeft,r=U(t)?dt(t):c(1);return{width:t.clientWidth*r.x,height:t.clientHeight*r.y,x:i*r.x,y:n*r.y}}(e,s);else{const s=pt(t);n={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return N(n)}function bt(t,e){const s=at(t);return!(s===e||!Y(s)||it(s))&&("fixed"===rt(s).position||bt(s,e))}function Pt(t,e,s){const n=U(e),i=q(e),r="fixed"===s,o=_t(t,!0,r,e);let a={scrollLeft:0,scrollTop:0};const l=c(0);function h(){l.x=ft(i)}if(n||!n&&!r)if(("body"!==z(e)||j(i))&&(a=ot(e)),n){const t=_t(e,!0,r,e);l.x=t.x+e.clientLeft,l.y=t.y+e.clientTop}else i&&h();r&&!n&&i&&h();const u=!i||n||r?c(0):yt(i,a);return{x:o.left+a.scrollLeft-l.x-u.x,y:o.top+a.scrollTop-l.y-u.y,width:o.width,height:o.height}}function St(t){return"static"===rt(t).position}function Et(t,e){if(!U(t)||"fixed"===rt(t).position)return null;if(e)return e(t);let s=t.offsetParent;return q(t)===s&&(s=s.ownerDocument.body),s}function Ct(t,e){const s=O(t);if(K(t))return s;if(!U(t)){let e=at(t);for(;e&&!it(e);){if(Y(e)&&!St(e))return e;e=at(e)}return s}let n=Et(t,e);for(;n&&W(n)&&St(n);)n=Et(n,e);return n&&it(n)&&St(n)&&!et(n)?s:n||function(t){let e=at(t);for(;U(e)&&!it(e);){if(et(e))return e;if(K(e))return null;e=at(e)}return null}(t)||s}const wt={convertOffsetParentRelativeRectToViewportRelativeRect:function(t){let{elements:e,rect:s,offsetParent:n,strategy:i}=t;const r="fixed"===i,o=q(n),a=!!e&&K(e.floating);if(n===o||a&&r)return s;let l={scrollLeft:0,scrollTop:0},h=c(1);const u=c(0),m=U(n);if((m||!m&&!r)&&(("body"!==z(n)||j(o))&&(l=ot(n)),U(n))){const t=_t(n);h=dt(n),u.x=t.x+n.clientLeft,u.y=t.y+n.clientTop}const d=!o||m||r?c(0):yt(o,l,!0);return{width:s.width*h.x,height:s.height*h.y,x:s.x*h.x-l.scrollLeft*h.x+u.x+d.x,y:s.y*h.y-l.scrollTop*h.y+u.y+d.y}},getDocumentElement:q,getClippingRect:function(t){let{element:e,boundary:s,rootBoundary:n,strategy:i}=t;const r=[..."clippingAncestors"===s?K(e)?[]:function(t,e){const s=e.get(t);if(s)return s;let n=ht(t,[],!1).filter((t=>Y(t)&&"body"!==z(t))),i=null;const r="fixed"===rt(t).position;let o=r?at(t):t;for(;Y(o)&&!it(o);){const e=rt(o),s=et(o);s||"fixed"!==e.position||(i=null),(r?!s&&!i:!s&&"static"===e.position&&i&&xt.has(i.position)||j(o)&&!s&&bt(t,o))?n=n.filter((t=>t!==o)):i=e,o=at(o)}return e.set(t,n),n}(e,this._c):[].concat(s),n],o=r[0],h=r.reduce(((t,s)=>{const n=vt(e,s,i);return t.top=l(n.top,t.top),t.right=a(n.right,t.right),t.bottom=a(n.bottom,t.bottom),t.left=l(n.left,t.left),t}),vt(e,o,i));return{width:h.right-h.left,height:h.bottom-h.top,x:h.left,y:h.top}},getOffsetParent:Ct,getElementRects:async function(t){const e=this.getOffsetParent||Ct,s=this.getDimensions,n=await s(t.floating);return{reference:Pt(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}},getClientRects:function(t){return Array.from(t.getClientRects())},getDimensions:function(t){const{width:e,height:s}=ct(t);return{width:e,height:s}},getScale:dt,isElement:Y,isRTL:function(t){return"rtl"===rt(t).direction}};function It(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Tt(t,e,s,n){void 0===n&&(n={});const{ancestorScroll:i=!0,ancestorResize:r=!0,elementResize:o="function"==typeof ResizeObserver,layoutShift:h="function"==typeof IntersectionObserver,animationFrame:c=!1}=n,m=mt(t),d=i||r?[...m?ht(m):[],...ht(e)]:[];d.forEach((t=>{i&&t.addEventListener("scroll",s,{passive:!0}),r&&t.addEventListener("resize",s)}));const g=m&&h?function(t,e){let s,n=null;const i=q(t);function r(){var t;clearTimeout(s),null==(t=n)||t.disconnect(),n=null}return function o(h,c){void 0===h&&(h=!1),void 0===c&&(c=1),r();const m=t.getBoundingClientRect(),{left:d,top:g,width:p,height:_}=m;if(h||e(),!p||!_)return;const f={rootMargin:-u(g)+"px "+-u(i.clientWidth-(d+p))+"px "+-u(i.clientHeight-(g+_))+"px "+-u(d)+"px",threshold:l(0,a(1,c))||1};let y=!0;function x(e){const n=e[0].intersectionRatio;if(n!==c){if(!y)return o();n?o(!1,n):s=setTimeout((()=>{o(!1,1e-7)}),1e3)}1!==n||It(m,t.getBoundingClientRect())||o(),y=!1}try{n=new IntersectionObserver(x,{...f,root:i.ownerDocument})}catch(v){n=new IntersectionObserver(x,f)}n.observe(t)}(!0),r}(m,s):null;let p,_=-1,f=null;o&&(f=new ResizeObserver((t=>{let[n]=t;n&&n.target===m&&f&&(f.unobserve(e),cancelAnimationFrame(_),_=requestAnimationFrame((()=>{var t;null==(t=f)||t.observe(e)}))),s()})),m&&!c&&f.observe(m),f.observe(e));let y=c?_t(t):null;return c&&function e(){const n=_t(t);y&&!It(y,n)&&s();y=n,p=requestAnimationFrame(e)}(),s(),()=>{var t;d.forEach((t=>{i&&t.removeEventListener("scroll",s),r&&t.removeEventListener("resize",s)})),null==g||g(),null==(t=f)||t.disconnect(),f=null,c&&cancelAnimationFrame(p)}}const At=function(t){return void 0===t&&(t=0),{name:"offset",options:t,async fn(e){var s,n;const{x:i,y:r,placement:o,middlewareData:a}=e,l=await async function(t,e){const{placement:s,platform:n,elements:i}=t,r=await(null==n.isRTL?void 0:n.isRTL(i.floating)),o=_(s),a=f(s),l="y"===b(s),h=G.has(o)?-1:1,u=r&&l?-1:1,c=p(e,t);let{mainAxis:m,crossAxis:d,alignmentAxis:g}="number"==typeof c?{mainAxis:c,crossAxis:0,alignmentAxis:null}:{mainAxis:c.mainAxis||0,crossAxis:c.crossAxis||0,alignmentAxis:c.alignmentAxis};return a&&"number"==typeof g&&(d="end"===a?-1*g:g),l?{x:d*u,y:m*h}:{x:m*h,y:d*u}}(e,t);return o===(null==(s=a.offset)?void 0:s.placement)&&null!=(n=a.arrow)&&n.alignmentOffset?{}:{x:i+l.x,y:r+l.y,data:{...l,placement:o}}}}},Mt=function(t){return void 0===t&&(t={}),{name:"autoPlacement",options:t,async fn(e){var s,n,i;const{rects:r,middlewareData:a,placement:l,platform:h,elements:u}=e,{crossAxis:c=!1,alignment:m,allowedPlacements:d=o,autoAlignment:g=!0,...y}=p(t,e),x=void 0!==m||d===o?function(t,e,s){return(t?[...s.filter((e=>f(e)===t)),...s.filter((e=>f(e)!==t))]:s.filter((t=>_(t)===t))).filter((s=>!t||f(s)===t||!!e&&E(s)!==s))}(m||null,g,d):d,v=await R(e,y),b=(null==(s=a.autoPlacement)?void 0:s.index)||0,P=x[b];if(null==P)return{};const C=S(P,r,await(null==h.isRTL?void 0:h.isRTL(u.floating)));if(l!==P)return{reset:{placement:x[0]}};const w=[v[_(P)],v[C[0]],v[C[1]]],I=[...(null==(n=a.autoPlacement)?void 0:n.overflows)||[],{placement:P,overflows:w}],T=x[b+1];if(T)return{data:{index:b+1,overflows:I},reset:{placement:T}};const A=I.map((t=>{const e=f(t.placement);return[t.placement,e&&c?t.overflows.slice(0,2).reduce(((t,e)=>t+e),0):t.overflows[0],t.overflows]})).sort(((t,e)=>t[1]-e[1])),M=(null==(i=A.filter((t=>t[2].slice(0,f(t[0])?2:3).every((t=>t<=0))))[0])?void 0:i[0])||A[0][0];return M!==l?{data:{index:b+1,overflows:I},reset:{placement:M}}:{}}}},Dt=function(t){return void 0===t&&(t={}),{name:"shift",options:t,async fn(e){const{x:s,y:n,placement:i}=e,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:t=>{let{x:e,y:s}=t;return{x:e,y:s}}},...l}=p(t,e),h={x:s,y:n},u=await R(e,l),c=b(_(i)),m=y(c);let d=h[m],f=h[c];if(r){const t="y"===m?"bottom":"right";d=g(d+u["y"===m?"top":"left"],d,d-u[t])}if(o){const t="y"===c?"bottom":"right";f=g(f+u["y"===c?"top":"left"],f,f-u[t])}const x=a.fn({...e,[m]:d,[c]:f});return{...x,data:{x:x.x-s,y:x.y-n,enabled:{[m]:r,[c]:o}}}}}},Nt=function(t){return void 0===t&&(t={}),{name:"flip",options:t,async fn(e){var s,n;const{placement:i,middlewareData:r,rects:o,initialPlacement:a,platform:l,elements:h}=e,{mainAxis:u=!0,crossAxis:c=!0,fallbackPlacements:m,fallbackStrategy:d="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:f=!0,...y}=p(t,e);if(null!=(s=r.arrow)&&s.alignmentOffset)return{};const x=_(i),v=b(a),P=_(a)===a,C=await(null==l.isRTL?void 0:l.isRTL(h.floating)),w=m||(P||!f?[M(a)]:function(t){const e=M(t);return[E(t),e,E(e)]}(a)),I="none"!==g;!m&&I&&w.push(...A(a,f,g,C));const T=[a,...w],D=await R(e,y),N=[];let F=(null==(n=r.flip)?void 0:n.overflows)||[];if(u&&N.push(D[x]),c){const t=S(i,o,C);N.push(D[t[0]],D[t[1]])}if(F=[...F,{placement:i,overflows:N}],!N.every((t=>t<=0))){var k,L;const t=((null==(k=r.flip)?void 0:k.index)||0)+1,e=T[t];if(e){if(!("alignment"===c&&v!==b(e))||F.every((t=>t.overflows[0]>0&&b(t.placement)===v)))return{data:{index:t,overflows:F},reset:{placement:e}}}let s=null==(L=F.filter((t=>t.overflows[0]<=0)).sort(((t,e)=>t.overflows[1]-e.overflows[1]))[0])?void 0:L.placement;if(!s)switch(d){case"bestFit":{var G;const t=null==(G=F.filter((t=>{if(I){const e=b(t.placement);return e===v||"y"===e}return!0})).map((t=>[t.placement,t.overflows.filter((t=>t>0)).reduce(((t,e)=>t+e),0)])).sort(((t,e)=>t[1]-e[1]))[0])?void 0:G[0];t&&(s=t);break}case"initialPlacement":s=a}if(i!==s)return{reset:{placement:s}}}return{}}}},Ft=function(t){return void 0===t&&(t={}),{name:"hide",options:t,async fn(e){const{rects:s}=e,{strategy:n="referenceHidden",...i}=p(t,e);switch(n){case"referenceHidden":{const t=k(await R(e,{...i,elementContext:"reference"}),s.reference);return{data:{referenceHiddenOffsets:t,referenceHidden:L(t)}}}case"escaped":{const t=k(await R(e,{...i,altBoundary:!0}),s.floating);return{data:{escapedOffsets:t,escaped:L(t)}}}default:return{}}}}},Rt=t=>({name:"arrow",options:t,async fn(e){const{x:s,y:n,placement:i,rects:r,platform:o,elements:l,middlewareData:h}=e,{element:u,padding:c=0}=p(t,e)||{};if(null==u)return{};const m=D(c),d={x:s,y:n},_=P(i),y=x(_),v=await o.getDimensions(u),b="y"===_,S=b?"top":"left",E=b?"bottom":"right",C=b?"clientHeight":"clientWidth",w=r.reference[y]+r.reference[_]-d[_]-r.floating[y],I=d[_]-r.reference[_],T=await(null==o.getOffsetParent?void 0:o.getOffsetParent(u));let A=T?T[C]:0;A&&await(null==o.isElement?void 0:o.isElement(T))||(A=l.floating[C]||r.floating[y]);const M=w/2-I/2,N=A/2-v[y]/2-1,F=a(m[S],N),R=a(m[E],N),k=F,L=A-v[y]-R,G=A/2-v[y]/2+M,V=g(k,G,L),z=!h.arrow&&null!=f(i)&&G!==V&&r.reference[y]/2-(G<k?F:R)-v[y]/2<0,O=z?G<k?G-k:G-L:0;return{[_]:d[_]+O,data:{[_]:V,centerOffset:G-V-O,...z&&{alignmentOffset:O}},reset:z}}}),kt=(t,e,s)=>{const n=new Map,i={platform:wt,...s},r={...i.platform,_c:n};return(async(t,e,s)=>{const{placement:n="bottom",strategy:i="absolute",middleware:r=[],platform:o}=s,a=r.filter(Boolean),l=await(null==o.isRTL?void 0:o.isRTL(e));let h=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:u,y:c}=F(h,n,l),m=n,d={},g=0;for(let p=0;p<a.length;p++){const{name:s,fn:r}=a[p],{x:_,y:f,data:y,reset:x}=await r({x:u,y:c,initialPlacement:n,placement:m,strategy:i,middlewareData:d,rects:h,platform:o,elements:{reference:t,floating:e}});u=null!=_?_:u,c=null!=f?f:c,d={...d,[s]:{...d[s],...y}},x&&g<=50&&(g++,"object"==typeof x&&(x.placement&&(m=x.placement),x.rects&&(h=!0===x.rects?await o.getElementRects({reference:t,floating:e,strategy:i}):x.rects),({x:u,y:c}=F(h,m,l))),p=-1)}return{x:u,y:c,placement:m,strategy:i,middlewareData:d}})(t,e,{...i,platform:r})};var Lt=s(54559);function Gt(t){return zt(t)}function Vt(t){return t.assignedSlot?t.assignedSlot:t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}function zt(t){for(let e=t;e;e=Vt(e))if(e instanceof Element&&"none"===getComputedStyle(e).display)return null;for(let e=Vt(t);e;e=Vt(e)){if(!(e instanceof Element))continue;const t=getComputedStyle(e);if("contents"!==t.display){if("static"!==t.position||et(t))return e;if("BODY"===e.tagName)return e}}return null}var Ot=s(14558),qt=s(25450);function Bt(t){const e=window.devicePixelRatio||1;return Math.round(t*e)/e}!function(){if(!n.S$){const t=wt.getOffsetParent;wt.getOffsetParent=e=>t(e,Gt)}}();const Yt=async(t,{referenceEl:e,floatingEl:s,overlayPositioning:n="absolute",placement:i,flipDisabled:r,flipPlacements:o,offsetDistance:a,offsetSkidding:l,arrowEl:h,type:u})=>{if(!e||!s)return;const c="rtl"===(0,qt.g)(s),{x:m,y:d,placement:g,strategy:p,middlewareData:_}=await kt(e,s,{strategy:n,placement:"auto"===i||"auto-start"===i||"auto-end"===i?void 0:Kt(i,c),middleware:Wt({placement:i,flipDisabled:r,flipPlacements:o?.map((t=>Kt(t,c))),offsetDistance:a,offsetSkidding:l,arrowEl:h,type:u})});if(h&&_.arrow){const{x:e,y:s}=_.arrow,n=g.split("-")[0],i=null!=e?"left":"top",r=Jt[n],o={left:"",top:"",bottom:"",right:""};"floatingLayout"in t&&(t.floatingLayout="left"===n||"right"===n?"horizontal":"vertical"),Object.assign(h.style,{...o,[i]:`${"left"==i?e:s}px`,[n]:"100%",transform:r})}const f=_.hide?.referenceHidden,y=f?"hidden":null,x=y?"none":null;s.setAttribute(Ut,g),Object.assign(s.style,{pointerEvents:x,position:p,transform:`translate(${Bt(m)}px,${Bt(d)}px)`,visibility:y})},Ut="data-placement",Ht=["top","bottom","right","left","top-start","top-end","bottom-start","bottom-end","right-start","right-end","left-start","left-end","leading","trailing","leading-start","leading-end","trailing-start","trailing-end"],Xt="bottom-start",jt="bottom-end",Zt={animation:"calcite-floating-ui-anim",animationActive:"calcite-floating-ui-anim--active"};function Wt({placement:t,flipDisabled:e,flipPlacements:s,offsetDistance:n,offsetSkidding:i,arrowEl:r,type:o}){const a=[Dt(),Ft()];return"menu"===o&&a.push(Nt({fallbackPlacements:s||["top-start","top","top-end","bottom-start","bottom","bottom-end"]})),a.push(At({mainAxis:"number"==typeof n?n:0,crossAxis:"number"==typeof i?i:0})),"auto"===t||"auto-start"===t||"auto-end"===t?a.push(Mt({alignment:"auto-start"===t?"start":"auto-end"===t?"end":null})):e||a.push(Nt(s?{fallbackPlacements:s}:{})),r&&a.push(Rt({element:r})),a}function $t(t,e){const s=t.filter((t=>Ht.includes(t)));return s.length!==t.length&&console.warn(`${e.tagName}: Invalid value found in: flipPlacements. Try any of these: ${Ht.map((t=>`"${t}"`)).join(", ").trim()}`,{el:e}),s}function Kt(t,e=!1){const s=["left","right"];return e&&s.reverse(),t.replace(/leading/gi,s[0]).replace(/trailing/gi,s[1])}async function Qt(t,e,s=!1){if(!t.open||!e.floatingEl||!e.referenceEl)return;Object.assign(e.floatingEl.style,{display:"block",position:e.overlayPositioning??"absolute"});if(!te.get(t))return se(t);const n=s?function(t){let e=ee.get(t);if(e)return e;return e=(0,Lt.A)(Yt,Ot.D.reposition,{leading:!0,maxWait:Ot.D.reposition}),ee.set(t,e),e}(t):Yt;await n(t,e)}const Jt={top:"",left:"rotate(-90deg)",bottom:"rotate(180deg)",right:"rotate(90deg)"},te=new WeakMap,ee=new WeakMap;async function se(t){const{referenceEl:e,floatingEl:s}=t;if(!s.isConnected)return;const i=n.S$?(t,e,s)=>(s(),()=>{}):Tt;let r;te.set(t,{state:"pending"});const o=i(e,s,(()=>{const e=t.reposition();r||(r=e)}));return te.set(t,{state:"active",cleanUp:o}),r}function ne(t){const{floatingEl:e}=t;e&&Object.assign(e.style,{display:"",pointerEvents:"",position:"",transform:"",visibility:""})}async function ie(t){const{floatingEl:e,referenceEl:s}=t;if(ne(t),e&&s&&(re(t),t.open))return se(t)}function re(t){const e=te.get(t);"active"===e?.state&&e.cleanUp(),te.delete(t),ee.get(t)?.cancel(),ee.delete(t)}const oe=Math.ceil(Math.hypot(4,4))},67226:(t,e,s)=>{s.d(e,{H:()=>E,a:()=>x,c:()=>p,d:()=>y,f:()=>_,i:()=>v,r:()=>g,s:()=>d});var n=s(41331),i=s(25450);const r=["calcite-input","calcite-input-number","calcite-input-text","calcite-text-area"];const o="hidden-form-input";function a(t){return"checked"in t}const l=new WeakMap,h=new WeakSet;function u(t){return"CALCITE-RADIO-BUTTON"===t.nodeName?(0,i.l)(t,"calcite-radio-button-group"):t}const c=new CustomEvent("calciteInvalid",{bubbles:!0,composed:!0});function m(t){const e=t?.target,s=e?.validationMessage,n=u(e?.parentElement);if(!n)return;const i=n?.nodeName?.toLowerCase(),o=i?.split("-");if(o.length<2||"calcite"!==o[0])return;t?.preventDefault(),"validity"in n&&(n.validity=e?.validity),n.dispatchEvent(c),function(t,{status:e,message:s,icon:n}){"status"in t&&(t.status=e),"validationIcon"in t&&"string"!=typeof t.validationIcon&&(t.validationIcon=n),"validationMessage"in t&&!t.validationMessage&&(t.validationMessage=s)}(n,{message:s,icon:!0,status:"invalid"});const a=function(t){return`${t.split("-").map(((t,e)=>0===e?t:`${t[0].toUpperCase()}${t.slice(1)}`)).join("")}${r.includes(t)?"Input":"Change"}`}(i);n.addEventListener(a,(()=>{"status"in n&&(n.status="idle"),!("validationIcon"in n)||""!==n.validationIcon&&!0!==n.validationIcon||(n.validationIcon=!1),"validationMessage"in n&&n.validationMessage===s&&(n.validationMessage=""),"validity"in n&&(n.validity=e?.validity)}),{once:!0})}function d(t){const{formEl:e}=t;return!!e&&(e.addEventListener("invalid",m,!0),e.requestSubmit(),e.removeEventListener("invalid",m,!0),requestAnimationFrame((()=>{const t=e.querySelectorAll("[status=invalid]");for(const e of t)if(e?.validationMessage){e?.setFocus();break}})),!0)}function g(t){t.formEl?.reset()}function p(t){const{el:e,value:s}=t,n=_(t);if(!n||function(t,e){if((0,i.l)(e.parentElement,"[form]"))return!0;const s="calciteInternalFormComponentRegister";let n=!1;return t.addEventListener(s,(t=>{n=t.composedPath().some((t=>h.has(t))),t.stopPropagation()}),{once:!0}),e.dispatchEvent(new CustomEvent(s,{bubbles:!0,composed:!0})),n}(n,e))return;t.formEl=n,t.defaultValue=s,a(t)&&(t.defaultChecked=t.checked);const r=f.bind(t);n.addEventListener("reset",r),l.set(t.el,r),h.add(e)}function _(t){const{el:e,form:s}=t;return s?(0,i.q)(e,{id:s}):(0,i.l)(e,"form")}function f(){"status"in this&&(this.status="idle"),"validationIcon"in this&&(this.validationIcon=!1),"validationMessage"in this&&(this.validationMessage=""),a(this)?this.checked=this.defaultChecked:(this.value=this.defaultValue,this.onFormReset?.())}function y(t){const{el:e,formEl:s}=t;if(!s)return;const n=l.get(e);s.removeEventListener("reset",n),l.delete(e),t.formEl=null,h.delete(e)}function x(t,e){t.defaultValue=e}const v="calciteInternalHiddenInputInput",b=t=>{t.target.dispatchEvent(new CustomEvent(v,{bubbles:!0}))},P=t=>t.removeEventListener("input",b);function S(t,e,s){const{defaultValue:n,disabled:i,form:r,name:o,required:l}=t;e.defaultValue=n,e.disabled=i,e.name=o,e.required=l,e.tabIndex=-1,r?e.setAttribute("form",r):e.removeAttribute("form"),a(t)?(e.checked=t.checked,e.defaultChecked=t.defaultChecked,e.value=t.checked?s||"on":""):e.value=s||"",t.syncHiddenFormInput?.(e);const h=u(t.el);if(h&&"validity"in h)for(const a in{...e?.validity})h.validity[a]=e.validity[a]}const E=({component:t})=>(function(t){const{el:e,formEl:s,name:i,value:r}=t,{ownerDocument:a}=e;if(n.S$)return;const l=e.querySelectorAll(`input[slot="${o}"]`);if(!s||!i)return void l.forEach((t=>{P(t),t.remove()}));const h=Array.isArray(r)?r:[r],u=[],c=new Set;let m;l.forEach((e=>{const s=h.find((t=>t==e.value));null!=s?(c.add(s),S(t,e,s)):u.push(e)})),h.forEach((e=>{if(c.has(e))return;let s=u.pop();s||(s=a.createElement("input"),s.ariaHidden="true",s.slot=o),m||(m=a.createDocumentFragment()),m.append(s),s.addEventListener("input",b),S(t,s,e)})),m&&e.append(m),u.forEach((t=>{P(t),t.remove()}))}(t),n.qy`<slot name=${o}></slot>`)},7025:(t,e,s)=>{s.d(e,{g:()=>n});const n=()=>[2,1,1,1,3].map((t=>{let e="";for(let s=0;s<t;s++)e+=(65536*(1+Math.random())|0).toString(16).substring(1);return e})).join("-")},28070:(t,e,s)=>{s.d(e,{I:()=>m,u:()=>u});var n=s(54714),i=s(44603);function r(){const{disabled:t}=this;t||HTMLElement.prototype.click.call(this)}function o(t){t.target.disabled&&t.preventDefault()}const a=["mousedown","mouseup","click"];function l(t){t.target.disabled&&(t.stopImmediatePropagation(),t.preventDefault())}const h={capture:!0};function u(t){if(t.disabled)return t.el.setAttribute("aria-disabled","true"),t.el.contains(document.activeElement)&&document.activeElement.blur(),void function(t){t.el.click=r,e=t.el,e.addEventListener("pointerdown",o,h),a.forEach((t=>e.addEventListener(t,l,h)));var e}(t);!function(t){delete t.el.click,e=t.el,e.removeEventListener("pointerdown",o,h),a.forEach((t=>e.removeEventListener(t,l,h)));var e}(t),t.el.removeAttribute("aria-disabled")}const c="interaction-container",m=({children:t,disabled:e})=>n.qy`<div class=${(0,i.CP)(c)} .inert=${e}>${t}</div>`},14357:(t,e,s)=>{function n(t){return"Enter"===t||" "===t}s.d(e,{i:()=>n,n:()=>i});const i=["0","1","2","3","4","5","6","7","8","9"]},85352:(t,e,s)=>{s.d(e,{a:()=>b,b:()=>o,c:()=>g,d:()=>p,g:()=>f,l:()=>r});var n=s(25450);const i="calciteInternalLabelClick",r="calciteInternalLabelConnected",o="calciteInternalLabelDisconnected",a="calcite-label",l=new WeakMap,h=new WeakMap,u=new WeakMap,c=new WeakMap,m=new Set,d=t=>{const{id:e}=t,s=e&&(0,n.q)(t,{selector:`${a}[for="${e}"]`});if(s)return s;const i=(0,n.l)(t,a);return!i||function(t,e){let s;const n="custom-element-ancestor-check",i=n=>{n.stopImmediatePropagation();const i=n.composedPath();s=i.slice(i.indexOf(e),i.indexOf(t))};t.addEventListener(n,i,{once:!0}),e.dispatchEvent(new CustomEvent(n,{composed:!0,bubbles:!0})),t.removeEventListener(n,i);const r=s.filter((s=>s!==e&&s!==t)).filter((t=>t.tagName?.includes("-")));return r.length>0}(i,t)?null:i};function g(t){if(!t)return;const e=d(t.el);if(h.has(e)&&e===t.labelEl||!e&&m.has(t))return;const s=v.bind(t);if(e){t.labelEl=e;const n=l.get(e)||[];n.push(t),l.set(e,n.sort(_)),h.has(t.labelEl)||(h.set(t.labelEl,y),t.labelEl.addEventListener(i,y)),m.delete(t),document.removeEventListener(r,u.get(t)),c.set(t,s),document.addEventListener(o,s)}else m.has(t)||(s(),document.removeEventListener(o,c.get(t)))}function p(t){if(!t)return;if(m.delete(t),document.removeEventListener(r,u.get(t)),document.removeEventListener(o,c.get(t)),u.delete(t),c.delete(t),!t.labelEl)return;const e=l.get(t.labelEl);1===e.length&&(t.labelEl.removeEventListener(i,h.get(t.labelEl)),h.delete(t.labelEl)),l.set(t.labelEl,e.filter((e=>e!==t)).sort(_)),t.labelEl=null}function _(t,e){return(0,n.m)(t.el,e.el)?-1:1}function f(t){return t.label||t.labelEl?.textContent?.trim()||""}function y(t){const e=t.detail.sourceEvent.target,s=l.get(this),n=s.find((t=>t.el===e));if(s.includes(n))return;const i=s[0];i.disabled||i.onLabelClick(t)}function x(){m.has(this)&&g(this)}function v(){m.add(this);const t=u.get(this)||x.bind(this);u.set(this,t),document.addEventListener(r,t)}async function b(t){await t.componentOnReady();if(l.has(t))return;const e=t.ownerDocument?.getElementById(t.for);e&&requestAnimationFrame((()=>{for(const t of m)if(t.el===e){g(t);break}}))}},23424:(t,e,s)=>{s.d(e,{l:()=>l});var n=s(14558);const i=new Set,r={trace:0,debug:1,info:2,warn:4,error:8,off:10};function o(t,...e){if(!function(t){return r[t]>=r[n.l]}(t))return;console[t].call(this,"%ccalcite","background: #007AC2; color: #fff; border-radius: 4px; padding: 2px 4px;",...e)}let a;const l={debug:t=>o("debug",t),info:t=>o("info",t),warn:t=>o("warn",t),error:t=>o("error",t),trace:t=>o("trace",t),deprecated:function(t,{component:e,name:s,suggested:n,removalVersion:r}){const l=`${t}:${"component"===t?"":e}${s}`;if(i.has(l))return;i.add(l);const h=Array.isArray(n);h&&!a&&(a=new Intl.ListFormat("en",{style:"long",type:"disjunction"}));o("warn",`[${s}] ${t} is deprecated and will be removed in ${"future"===r?"a future version":`v${r}`}.${n?` Use ${h?a.format(n.map((t=>`"${t}"`))):`"${n}"`} instead.`:""}`)}}},13061:(t,e,s)=>{s.d(e,{c:()=>i});var n=s(41331);function i(t,e,s){if(n.S$)return;const i=function(t){class e extends window.MutationObserver{constructor(t){super(t),this.observedEntry=[],this.callback=t}observe(t,e){return this.observedEntry.push({target:t,options:e}),super.observe(t,e)}unobserve(t){const e=this.observedEntry.filter((e=>e.target!==t));this.observedEntry=[],this.callback(super.takeRecords(),this),this.disconnect(),e.forEach((t=>this.observe(t.target,t.options)))}}return"intersection"===t?window.IntersectionObserver:"mutation"===t?e:window.ResizeObserver}(t);return new i(e,s)}},36607:(t,e,s)=>{s.d(e,{o:()=>r});var n=s(25450);function i(t){return t[t.openProp||"open"]}function r(t){requestAnimationFrame((()=>{t.transitionEl&&(0,n.w)(t.transitionEl,t.transitionProp,(()=>{i(t)?t.onBeforeOpen():t.onBeforeClose()}),(()=>{i(t)?t.onOpen():t.onClose()}))}))}},90477:(t,e,s)=>{s.d(e,{C:()=>n,I:()=>r,S:()=>i,a:()=>o});const n={menu:"menu",defaultTrigger:"default-trigger"},i={tooltip:"tooltip",trigger:"trigger"},r={menu:"ellipsis"},o="data-active"},44148:(t,e,s)=>{s.d(e,{u:()=>X});var n=s(73339),i=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],r=i.join(","),o="undefined"==typeof Element,a=o?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,l=!o&&Element.prototype.getRootNode?function(t){var e;return null==t||null===(e=t.getRootNode)||void 0===e?void 0:e.call(t)}:function(t){return null==t?void 0:t.ownerDocument},h=function t(e,s){var n;void 0===s&&(s=!0);var i=null==e||null===(n=e.getAttribute)||void 0===n?void 0:n.call(e,"inert");return""===i||"true"===i||s&&e&&t(e.parentNode)},u=function(t,e,s){if(h(t))return[];var n=Array.prototype.slice.apply(t.querySelectorAll(r));return e&&a.call(t,r)&&n.unshift(t),n=n.filter(s)},c=function t(e,s,n){for(var i=[],o=Array.from(e);o.length;){var l=o.shift();if(!h(l,!1))if("SLOT"===l.tagName){var u=l.assignedElements(),c=t(u.length?u:l.children,!0,n);n.flatten?i.push.apply(i,c):i.push({scopeParent:l,candidates:c})}else{a.call(l,r)&&n.filter(l)&&(s||!e.includes(l))&&i.push(l);var m=l.shadowRoot||"function"==typeof n.getShadowRoot&&n.getShadowRoot(l),d=!h(m,!1)&&(!n.shadowRootFilter||n.shadowRootFilter(l));if(m&&d){var g=t(!0===m?l.children:m.children,!0,n);n.flatten?i.push.apply(i,g):i.push({scopeParent:l,candidates:g})}else o.unshift.apply(o,l.children)}}return i},m=function(t){return!isNaN(parseInt(t.getAttribute("tabindex"),10))},d=function(t){if(!t)throw new Error("No node provided");return t.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||function(t){var e,s=null==t||null===(e=t.getAttribute)||void 0===e?void 0:e.call(t,"contenteditable");return""===s||"true"===s}(t))&&!m(t)?0:t.tabIndex},g=function(t,e){return t.tabIndex===e.tabIndex?t.documentOrder-e.documentOrder:t.tabIndex-e.tabIndex},p=function(t){return"INPUT"===t.tagName},_=function(t){return function(t){return p(t)&&"radio"===t.type}(t)&&!function(t){if(!t.name)return!0;var e,s=t.form||l(t),n=function(t){return s.querySelectorAll('input[type="radio"][name="'+t+'"]')};if("undefined"!=typeof window&&void 0!==window.CSS&&"function"==typeof window.CSS.escape)e=n(window.CSS.escape(t.name));else try{e=n(t.name)}catch(r){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",r.message),!1}var i=function(t,e){for(var s=0;s<t.length;s++)if(t[s].checked&&t[s].form===e)return t[s]}(e,t.form);return!i||i===t}(t)},f=function(t){var e=t.getBoundingClientRect(),s=e.width,n=e.height;return 0===s&&0===n},y=function(t,e){var s=e.displayCheck,n=e.getShadowRoot;if("hidden"===getComputedStyle(t).visibility)return!0;var i=a.call(t,"details>summary:first-of-type")?t.parentElement:t;if(a.call(i,"details:not([open]) *"))return!0;if(s&&"full"!==s&&"legacy-full"!==s){if("non-zero-area"===s)return f(t)}else{if("function"==typeof n){for(var r=t;t;){var o=t.parentElement,h=l(t);if(o&&!o.shadowRoot&&!0===n(o))return f(t);t=t.assignedSlot?t.assignedSlot:o||h===t.ownerDocument?o:h.host}t=r}if(function(t){var e,s,n,i,r=t&&l(t),o=null===(e=r)||void 0===e?void 0:e.host,a=!1;if(r&&r!==t)for(a=!!(null!==(s=o)&&void 0!==s&&null!==(n=s.ownerDocument)&&void 0!==n&&n.contains(o)||null!=t&&null!==(i=t.ownerDocument)&&void 0!==i&&i.contains(t));!a&&o;){var h,u,c;a=!(null===(u=o=null===(h=r=l(o))||void 0===h?void 0:h.host)||void 0===u||null===(c=u.ownerDocument)||void 0===c||!c.contains(o))}return a}(t))return!t.getClientRects().length;if("legacy-full"!==s)return!0}return!1},x=function(t,e){return!(e.disabled||h(e)||function(t){return p(t)&&"hidden"===t.type}(e)||y(e,t)||function(t){return"DETAILS"===t.tagName&&Array.prototype.slice.apply(t.children).some((function(t){return"SUMMARY"===t.tagName}))}(e)||function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var e=t.parentElement;e;){if("FIELDSET"===e.tagName&&e.disabled){for(var s=0;s<e.children.length;s++){var n=e.children.item(s);if("LEGEND"===n.tagName)return!!a.call(e,"fieldset[disabled] *")||!n.contains(t)}return!0}e=e.parentElement}return!1}(e))},v=function(t,e){return!(_(e)||d(e)<0||!x(t,e))},b=function(t){var e=parseInt(t.getAttribute("tabindex"),10);return!!(isNaN(e)||e>=0)},P=function t(e){var s=[],n=[];return e.forEach((function(e,i){var r=!!e.scopeParent,o=r?e.scopeParent:e,a=function(t,e){var s=d(t);return s<0&&e&&!m(t)?0:s}(o,r),l=r?t(e.candidates):o;0===a?r?s.push.apply(s,l):s.push(o):n.push({documentOrder:i,tabIndex:a,item:e,isScope:r,content:l})})),n.sort(g).reduce((function(t,e){return e.isScope?t.push.apply(t,e.content):t.push(e.content),t}),[]).concat(s)},S=function(t,e){if(e=e||{},!t)throw new Error("No node provided");return!1!==a.call(t,r)&&v(e,t)},E=i.concat("iframe").join(","),C=function(t,e){if(e=e||{},!t)throw new Error("No node provided");return!1!==a.call(t,E)&&x(e,t)};function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,n=Array(e);s<e;s++)n[s]=t[s];return n}function I(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var n=s.call(t,e);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function T(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,n)}return s}function A(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?T(Object(s),!0).forEach((function(e){I(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):T(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function M(t){return function(t){if(Array.isArray(t))return w(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return w(t,e);var s={}.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?w(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var D=function(t,e){if(t.length>0){var s=t[t.length-1];s!==e&&s._setPausedState(!0)}var n=t.indexOf(e);-1===n||t.splice(n,1),t.push(e)},N=function(t,e){var s=t.indexOf(e);-1!==s&&t.splice(s,1),t.length>0&&!t[t.length-1]._isManuallyPaused()&&t[t.length-1]._setPausedState(!1)},F=function(t){return"Tab"===(null==t?void 0:t.key)||9===(null==t?void 0:t.keyCode)},R=function(t){return F(t)&&!t.shiftKey},k=function(t){return F(t)&&t.shiftKey},L=function(t){return setTimeout(t,0)},G=function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];return"function"==typeof t?t.apply(void 0,s):t},V=function(t){return t.target.shadowRoot&&"function"==typeof t.composedPath?t.composedPath()[0]:t.target},z=[],O=function(t,e){var s,n=(null==e?void 0:e.document)||document,i=(null==e?void 0:e.trapStack)||z,r=A({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:R,isKeyBackward:k},e),o={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,manuallyPaused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},a=function(t,e,s){return t&&void 0!==t[e]?t[e]:r[s||e]},l=function(t,e){var s="function"==typeof(null==e?void 0:e.composedPath)?e.composedPath():void 0;return o.containerGroups.findIndex((function(e){var n=e.container,i=e.tabbableNodes;return n.contains(t)||(null==s?void 0:s.includes(n))||i.find((function(e){return e===t}))}))},h=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=e.hasFallback,i=void 0!==s&&s,o=e.params,a=void 0===o?[]:o,l=r[t];if("function"==typeof l&&(l=l.apply(void 0,M(a))),!0===l&&(l=void 0),!l){if(void 0===l||!1===l)return l;throw new Error("`".concat(t,"` was specified but was not a node, or did not return a node"))}var h=l;if("string"==typeof l){try{h=n.querySelector(l)}catch(u){throw new Error("`".concat(t,'` appears to be an invalid selector; error="').concat(u.message,'"'))}if(!h&&!i)throw new Error("`".concat(t,"` as selector refers to no known node"))}return h},m=function(){var t=h("initialFocus",{hasFallback:!0});if(!1===t)return!1;if(void 0===t||t&&!C(t,r.tabbableOptions))if(l(n.activeElement)>=0)t=n.activeElement;else{var e=o.tabbableGroups[0];t=e&&e.firstTabbableNode||h("fallbackFocus")}else null===t&&(t=h("fallbackFocus"));if(!t)throw new Error("Your focus-trap needs to have at least one focusable element");return t},g=function(){if(o.containerGroups=o.containers.map((function(t){var e=function(t,e){var s;return s=(e=e||{}).getShadowRoot?c([t],e.includeContainer,{filter:v.bind(null,e),flatten:!1,getShadowRoot:e.getShadowRoot,shadowRootFilter:b}):u(t,e.includeContainer,v.bind(null,e)),P(s)}(t,r.tabbableOptions),s=function(t,e){return(e=e||{}).getShadowRoot?c([t],e.includeContainer,{filter:x.bind(null,e),flatten:!0,getShadowRoot:e.getShadowRoot}):u(t,e.includeContainer,x.bind(null,e))}(t,r.tabbableOptions),n=e.length>0?e[0]:void 0,i=e.length>0?e[e.length-1]:void 0,o=s.find((function(t){return S(t)})),a=s.slice().reverse().find((function(t){return S(t)})),l=!!e.find((function(t){return d(t)>0}));return{container:t,tabbableNodes:e,focusableNodes:s,posTabIndexesFound:l,firstTabbableNode:n,lastTabbableNode:i,firstDomTabbableNode:o,lastDomTabbableNode:a,nextTabbableNode:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=e.indexOf(t);return i<0?n?s.slice(s.indexOf(t)+1).find((function(t){return S(t)})):s.slice(0,s.indexOf(t)).reverse().find((function(t){return S(t)})):e[i+(n?1:-1)]}}})),o.tabbableGroups=o.containerGroups.filter((function(t){return t.tabbableNodes.length>0})),o.tabbableGroups.length<=0&&!h("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(o.containerGroups.find((function(t){return t.posTabIndexesFound}))&&o.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},p=function(t){var e=t.activeElement;if(e)return e.shadowRoot&&null!==e.shadowRoot.activeElement?p(e.shadowRoot):e},_=function(t){!1!==t&&t!==p(document)&&(t&&t.focus?(t.focus({preventScroll:!!r.preventScroll}),o.mostRecentlyFocusedNode=t,function(t){return t.tagName&&"input"===t.tagName.toLowerCase()&&"function"==typeof t.select}(t)&&t.select()):_(m()))},f=function(t){var e=h("setReturnFocus",{params:[t]});return e||!1!==e&&t},y=function(t){var e=t.target,s=t.event,n=t.isBackward,i=void 0!==n&&n;e=e||V(s),g();var a=null;if(o.tabbableGroups.length>0){var u=l(e,s),c=u>=0?o.containerGroups[u]:void 0;if(u<0)a=i?o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:o.tabbableGroups[0].firstTabbableNode;else if(i){var m=o.tabbableGroups.findIndex((function(t){var s=t.firstTabbableNode;return e===s}));if(m<0&&(c.container===e||C(e,r.tabbableOptions)&&!S(e,r.tabbableOptions)&&!c.nextTabbableNode(e,!1))&&(m=u),m>=0){var p=0===m?o.tabbableGroups.length-1:m-1,_=o.tabbableGroups[p];a=d(e)>=0?_.lastTabbableNode:_.lastDomTabbableNode}else F(s)||(a=c.nextTabbableNode(e,!1))}else{var f=o.tabbableGroups.findIndex((function(t){var s=t.lastTabbableNode;return e===s}));if(f<0&&(c.container===e||C(e,r.tabbableOptions)&&!S(e,r.tabbableOptions)&&!c.nextTabbableNode(e))&&(f=u),f>=0){var y=f===o.tabbableGroups.length-1?0:f+1,x=o.tabbableGroups[y];a=d(e)>=0?x.firstTabbableNode:x.firstDomTabbableNode}else F(s)||(a=c.nextTabbableNode(e))}}else a=h("fallbackFocus");return a},E=function(t){var e=V(t);l(e,t)>=0||(G(r.clickOutsideDeactivates,t)?s.deactivate({returnFocus:r.returnFocusOnDeactivate}):G(r.allowOutsideClick,t)||t.preventDefault())},w=function(t){var e=V(t),s=l(e,t)>=0;if(s||e instanceof Document)s&&(o.mostRecentlyFocusedNode=e);else{var n;t.stopImmediatePropagation();var i=!0;if(o.mostRecentlyFocusedNode)if(d(o.mostRecentlyFocusedNode)>0){var a=l(o.mostRecentlyFocusedNode),h=o.containerGroups[a].tabbableNodes;if(h.length>0){var u=h.findIndex((function(t){return t===o.mostRecentlyFocusedNode}));u>=0&&(r.isKeyForward(o.recentNavEvent)?u+1<h.length&&(n=h[u+1],i=!1):u-1>=0&&(n=h[u-1],i=!1))}}else o.containerGroups.some((function(t){return t.tabbableNodes.some((function(t){return d(t)>0}))}))||(i=!1);else i=!1;i&&(n=y({target:o.mostRecentlyFocusedNode,isBackward:r.isKeyBackward(o.recentNavEvent)})),_(n||(o.mostRecentlyFocusedNode||m()))}o.recentNavEvent=void 0},I=function(t){(r.isKeyForward(t)||r.isKeyBackward(t))&&function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o.recentNavEvent=t;var s=y({event:t,isBackward:e});s&&(F(t)&&t.preventDefault(),_(s))}(t,r.isKeyBackward(t))},T=function(t){(function(t){return"Escape"===(null==t?void 0:t.key)||"Esc"===(null==t?void 0:t.key)||27===(null==t?void 0:t.keyCode)})(t)&&!1!==G(r.escapeDeactivates,t)&&(t.preventDefault(),s.deactivate())},O=function(t){var e=V(t);l(e,t)>=0||G(r.clickOutsideDeactivates,t)||G(r.allowOutsideClick,t)||(t.preventDefault(),t.stopImmediatePropagation())},q=function(){if(o.active)return D(i,s),o.delayInitialFocusTimer=r.delayInitialFocus?L((function(){_(m())})):_(m()),n.addEventListener("focusin",w,!0),n.addEventListener("mousedown",E,{capture:!0,passive:!1}),n.addEventListener("touchstart",E,{capture:!0,passive:!1}),n.addEventListener("click",O,{capture:!0,passive:!1}),n.addEventListener("keydown",I,{capture:!0,passive:!1}),n.addEventListener("keydown",T),s},B=function(){if(o.active)return n.removeEventListener("focusin",w,!0),n.removeEventListener("mousedown",E,!0),n.removeEventListener("touchstart",E,!0),n.removeEventListener("click",O,!0),n.removeEventListener("keydown",I,!0),n.removeEventListener("keydown",T),s},Y="undefined"!=typeof window&&"MutationObserver"in window?new MutationObserver((function(t){t.some((function(t){return Array.from(t.removedNodes).some((function(t){return t===o.mostRecentlyFocusedNode}))}))&&_(m())})):void 0,U=function(){Y&&(Y.disconnect(),o.active&&!o.paused&&o.containers.map((function(t){Y.observe(t,{subtree:!0,childList:!0})})))};return s={get active(){return o.active},get paused(){return o.paused},activate:function(t){if(o.active)return this;var e=a(t,"onActivate"),s=a(t,"onPostActivate"),i=a(t,"checkCanFocusTrap");i||g(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=p(n),null==e||e();var r=function(){i&&g(),q(),U(),null==s||s()};return i?(i(o.containers.concat()).then(r,r),this):(r(),this)},deactivate:function(t){if(!o.active)return this;var e=A({onDeactivate:r.onDeactivate,onPostDeactivate:r.onPostDeactivate,checkCanReturnFocus:r.checkCanReturnFocus},t);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,B(),o.active=!1,o.paused=!1,U(),N(i,s);var n=a(e,"onDeactivate"),l=a(e,"onPostDeactivate"),h=a(e,"checkCanReturnFocus"),u=a(e,"returnFocus","returnFocusOnDeactivate");null==n||n();var c=function(){L((function(){u&&_(f(o.nodeFocusedBeforeActivation)),null==l||l()}))};return u&&h?(h(f(o.nodeFocusedBeforeActivation)).then(c,c),this):(c(),this)},pause:function(t){return o.active?(o.manuallyPaused=!0,this._setPausedState(!0,t)):this},unpause:function(t){return o.active?(o.manuallyPaused=!1,i[i.length-1]!==this?this:this._setPausedState(!1,t)):this},updateContainerElements:function(t){var e=[].concat(t).filter(Boolean);return o.containers=e.map((function(t){return"string"==typeof t?n.querySelector(t):t})),o.active&&g(),U(),this}},Object.defineProperties(s,{_isManuallyPaused:{value:function(){return o.manuallyPaused}},_setPausedState:{value:function(t,e){if(o.paused===t)return this;if(o.paused=t,t){var s=a(e,"onPause"),n=a(e,"onPostPause");null==s||s(),B(),U(),null==n||n()}else{var i=a(e,"onUnpause"),r=a(e,"onPostUnpause");null==i||i(),g(),q(),U(),null==r||r()}return this}}}),s.updateContainerElements(t),s},q=s(25450),B=s(14558);const Y=new WeakSet;function U(t,{focusTrapOptions:e},s){return e?.extraContainers||s?[t,...H(e?.extraContainers),...H(s)]:t}function H(t=[]){return Array.isArray(t)?t:[t]}const X=t=>(0,n.aK)(((e,s)=>{let n,i,r;const o=t.focusTrapOptions;s.onConnected((()=>{e[t.triggerProp]&&n&&a.activate()})),s.onUpdate((t=>{e.hasUpdated&&t.has("focusTrapDisabled")&&(e.focusTrapDisabled?a.deactivate():a.activate())})),s.onDisconnected((()=>a.deactivate()));const a={activate:()=>{const t=i||e.el;if(t.isConnected){if(!n){const s={...o,...e.focusTrapOptions};r||=U(t,e),n=O(r,function(t,e){const s=e?.fallbackFocus||t,n=e?.clickOutsideDeactivates??!0;return{fallbackFocus:s,setReturnFocus:e=>(Y.has(t)||(0,q.b)(e),!1),...e,document:t.ownerDocument,tabbableOptions:q.p,trapStack:B.f,clickOutsideDeactivates:e=>(Y.has(t)||Y.add(t),"function"==typeof n?n(e):n),onPostDeactivate:()=>{Y.delete(t)}}}(t,s))}("function"==typeof e.focusTrapDisabledOverride?e.focusTrapDisabledOverride():e.focusTrapDisabled)||n.activate()}},deactivate:()=>n?.deactivate(),overrideFocusTrapEl:t=>{if(n)throw new Error("Focus trap already created");i=t},setExtraContainers:t=>{const s=i||e.el;r=U(s,e,t)},updateContainerElements:()=>n?.updateContainerElements(r)};return a}))},13478:(t,e,s)=>{s.d(e,{u:()=>r});var n=s(73339),i=s(14558);const r=(0,n.yr)(i.g)},93297:(t,e,s)=>{s.r(e),s.d(e,{ActionMenu:()=>p});s(13847),s(78568);var n=s(14558),i=s(95191),r=s(41331),o=s(44603),a=s(695),l=s(25450),h=s(7025),u=s(14357),c=s(66865),m=s(90477);const d=s(82136).AH`:host{box-sizing:border-box;display:flex;flex-direction:column;font-size:var(--calcite-font-size-1)}::slotted(calcite-action-group:not(:last-of-type)){border-block-end-width:var(--calcite-border-width-sm)}.default-trigger{position:relative;block-size:100%;flex:0 1 auto;align-self:stretch}slot[name=trigger]::slotted(calcite-action),calcite-action::slotted([slot=trigger]){position:relative;block-size:100%;flex:0 1 auto;align-self:stretch}.menu{display:flex;max-block-size:45vh;flex-direction:column;flex-wrap:nowrap;overflow-y:auto;overflow-x:hidden;outline:2px solid transparent;outline-offset:2px;gap:var(--calcite-action-menu-items-space, 0)}:host([hidden]){display:none}[hidden]{display:none}`,g=["ArrowUp","ArrowDown","End","Home"];class p extends o.WF{constructor(){super(...arguments),this.guid=`calcite-action-menu-${(0,h.g)()}`,this.actionElements=[],this.menuButtonClick=()=>{this.toggleOpen()},this.menuButtonId=`${this.guid}-menu-button`,this.menuButtonKeyDown=t=>{const{key:e}=t,{actionElements:s,activeMenuItemIndex:n,open:i}=this;if(s.length){if((0,u.i)(e)){if(t.preventDefault(),!i)return void this.toggleOpen();const e=s[n];e?e.click():this.toggleOpen(!1)}if("Tab"!==e)return"Escape"===e?(this.toggleOpen(!1),void t.preventDefault()):void this.handleActionNavigation(t,e,s);this.open=!1}},this.menuId=`${this.guid}-menu`,this._open=!1,this.updateAction=(t,e)=>{const{guid:s,activeMenuItemIndex:n}=this,i=`${s}-action-${e}`;t.tabIndex=-1,t.setAttribute("role","menuitem"),t.id||(t.id=i),t.toggleAttribute(m.a,e===n)},this.activeMenuItemIndex=-1,this.appearance="solid",this.expanded=!1,this.overlayPositioning="absolute",this.placement="auto",this.scale="m",this.calciteActionMenuOpen=(0,o.lh)({cancelable:!1})}static{this.properties={activeMenuItemIndex:[16,{},{state:!0}],menuButtonEl:[16,{},{state:!0}],appearance:[3,{},{reflect:!0}],expanded:[7,{},{reflect:!0,type:Boolean}],flipPlacements:[0,{},{attribute:!1}],label:1,open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],placement:[3,{},{reflect:!0}],scale:[3,{},{reflect:!0}]}}static{this.styles=d}get open(){return this._open}set open(t){t!==this._open&&(this._open=t,this.openHandler(t))}async setFocus(){return await(0,c.c)(this),(0,l.b)(this.menuButtonEl)}connectedCallback(){super.connectedCallback(),this.connectMenuButtonEl()}willUpdate(t){t.has("expanded")&&(this.hasUpdated||!1!==this.expanded)&&this.expandedHandler(),t.has("activeMenuItemIndex")&&(this.hasUpdated||-1!==this.activeMenuItemIndex)&&this.updateActions(this.actionElements)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectMenuButtonEl()}expandedHandler(){this.open=!1,this.setTooltipReferenceElement()}openHandler(t){this.menuButtonEl&&(this.menuButtonEl.active=t),this.popoverEl&&(this.popoverEl.open=t),this.activeMenuItemIndex=this.open?0:-1,this.calciteActionMenuOpen.emit(),this.setTooltipReferenceElement()}connectMenuButtonEl(){const{menuButtonId:t,menuId:e,open:s,label:n}=this,i=this.slottedMenuButtonEl||this.defaultMenuButtonEl;this.menuButtonEl!==i&&(this.disconnectMenuButtonEl(),this.menuButtonEl=i,this.setTooltipReferenceElement(),i&&(i.active=s,i.setAttribute("aria-controls",e),i.setAttribute("aria-expanded",(0,l.t)(s)),i.setAttribute("aria-haspopup","true"),i.id||(i.id=t),i.label||(i.label=n),i.text||(i.text=n),i.addEventListener("click",this.menuButtonClick),i.addEventListener("keydown",this.menuButtonKeyDown)))}disconnectMenuButtonEl(){const{menuButtonEl:t}=this;t&&(t.removeEventListener("click",this.menuButtonClick),t.removeEventListener("keydown",this.menuButtonKeyDown),this.menuButtonEl=null)}setMenuButtonEl(t){const e=t.target.assignedElements({flatten:!0}).filter((t=>t?.matches("calcite-action")));this.slottedMenuButtonEl=e[0],this.connectMenuButtonEl()}setDefaultMenuButtonEl(t){this.defaultMenuButtonEl=t,t&&this.connectMenuButtonEl()}setPopoverEl(t){t&&(this.popoverEl=t,t.open=this.open)}handleCalciteActionClick(){this.open=!1,this.setFocus()}updateTooltip(t){const e=t.target.assignedElements({flatten:!0}).filter((t=>t?.matches("calcite-tooltip")));this.tooltipEl=e[0],this.setTooltipReferenceElement()}setTooltipReferenceElement(){const{tooltipEl:t,expanded:e,menuButtonEl:s,open:n}=this;t&&(t.referenceElement=e||n?null:s)}updateActions(t){t?.forEach(this.updateAction)}handleDefaultSlotChange(t){const e=t.target.assignedElements({flatten:!0}).reduce(((t,e)=>e?.matches("calcite-action")?(t.push(e),t):e?.matches("calcite-action-group")?t.concat(Array.from(e.querySelectorAll("calcite-action"))):t),[]);this.actionElements=e.filter((t=>!t.disabled&&!t.hidden))}isValidKey(t,e){return!!e.find((e=>e===t))}handleActionNavigation(t,e,s){if(!this.isValidKey(e,g))return;if(t.preventDefault(),!this.open)return this.toggleOpen(),"Home"!==e&&"ArrowDown"!==e||(this.activeMenuItemIndex=0),void("End"!==e&&"ArrowUp"!==e||(this.activeMenuItemIndex=s.length-1));"Home"===e&&(this.activeMenuItemIndex=0),"End"===e&&(this.activeMenuItemIndex=s.length-1);const n=this.activeMenuItemIndex;"ArrowUp"===e&&(this.activeMenuItemIndex=(0,a.g)(Math.max(n-1,-1),s.length)),"ArrowDown"===e&&(this.activeMenuItemIndex=(0,a.g)(n+1,s.length))}toggleOpen(t=!this.open){this.open=t}handlePopoverOpen(t){t.stopPropagation(),this.open=!0,this.setFocus()}handlePopoverClose(t){t.stopPropagation(),this.open=!1}renderMenuButton(){const{appearance:t,label:e,scale:s,expanded:n}=this;return r.qy`<slot name=${m.S.trigger} @slotchange=${this.setMenuButtonEl}><calcite-action .appearance=${t} class=${(0,o.CP)(m.C.defaultTrigger)} .icon=${m.I.menu} .scale=${s} .text=${e} .textEnabled=${n} ${(0,i.K)(this.setDefaultMenuButtonEl)}></calcite-action></slot>`}renderMenuItems(){const{actionElements:t,activeMenuItemIndex:e,menuId:s,menuButtonEl:n,label:a,placement:l,overlayPositioning:h,flipPlacements:u}=this,c=t[e],d=c?.id||null;return r.qy`<calcite-popover auto-close .flipPlacements=${u} focus-trap-disabled .label=${a} offset-distance=0 @calcitePopoverClose=${this.handlePopoverClose} @calcitePopoverOpen=${this.handlePopoverOpen} .overlayPositioning=${h} .placement=${l} pointer-disabled .referenceElement=${n} trigger-disabled ${(0,i.K)(this.setPopoverEl)}><div aria-activedescendant=${d??r.s6} aria-labelledby=${n?.id??r.s6} class=${(0,o.CP)(m.C.menu)} id=${s??r.s6} @click=${this.handleCalciteActionClick} role=menu tabindex=-1><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></calcite-popover>`}render(){return r.qy`${this.renderMenuButton()}${this.renderMenuItems()}<slot name=${m.S.tooltip} @slotchange=${this.updateTooltip}></slot>`}}(0,n.c)("calcite-action-menu",p)},13847:(t,e,s)=>{s.r(e),s.d(e,{Action:()=>I});s(32524),s(96446);var n=s(14558),i=s(54714),r=s(44068),o=s(95191),a=s(44603),l=s(7025),h=s(28070),u=s(66865),c=s(13061),m=s(13478),d=s(82136);const g="button",p="button--text-visible",_="button--compact",f="indicator-text",y="icon-container",x="slot-container",v="slot-container--hidden",b="text-container",P="text-container--visible",S="indicator-with-icon",E="indicator-without-icon",C="tooltip",w=d.AH`:host{box-sizing:border-box;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-2);font-size:var(--calcite-font-size--1)}:host *{box-sizing:border-box}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:flex;cursor:pointer;background-color:transparent;--calcite-internal-action-text-color: var(--calcite-color-text-3);border-radius:var(--calcite-action-corner-radius, var(--calcite-action-corner-radius-start-start, var(--calcite-corner-radius)) var(--calcite-action-corner-radius-start-end, var(--calcite-corner-radius)) var(--calcite-action-corner-radius-end-end, var(--calcite-corner-radius)) var(--calcite-action-corner-radius-end-start, var(--calcite-corner-radius)))}.interaction-container{border-radius:inherit}:host([drag-handle]){cursor:move;--calcite-internal-action-text-color: var(--calcite-color-border-input);--calcite-internal-action-padding-inline: var(--calcite-spacing-xxs)}.button{border-radius:inherit;position:relative;margin:0;display:flex;inline-size:auto;align-items:center;justify-content:flex-start;border-style:none;font-family:var(--calcite-font-family);font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-medium);outline-color:transparent;background-color:var(--calcite-action-background-color, var(--calcite-color-foreground-1));color:var(--calcite-action-text-color, var(--calcite-internal-action-text-color));text-align:unset;flex:1 0 auto;cursor:inherit}.button:hover{background-color:var(--calcite-action-background-color-hover, var(--calcite-color-foreground-2));color:var(--calcite-action-text-color-press, var(--calcite-action-text-color-pressed, var(--calcite-color-text-1)))}.button:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}.button:active{background-color:var(--calcite-action-background-color-press, var(--calcite-action-background-color-pressed, var(--calcite-color-foreground-3)))}.icon-container{pointer-events:none;margin:0;display:flex;align-items:center;justify-content:center;min-inline-size:1rem;min-block-size:1.5rem}.text-container{margin:0;inline-size:0px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:1.5rem;opacity:0;transition-property:opacity;transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-property:margin;transition-property:inline-size}.text-container--visible{inline-size:auto;flex:1 1 auto;opacity:1}:host([active]) .button,:host([active]) .button:hover,:host([active]) .button:focus{color:var(--calcite-action-text-color-press, var(--calcite-action-text-color-pressed, var(--calcite-color-text-1)));background-color:var(--calcite-action-background-color-press, var(--calcite-action-background-color-pressed, var(--calcite-color-foreground-3)))}:host([active]) .button:active{background-color:var(--calcite-action-background-color, var(--calcite-color-foreground-1))}:host([loading]) .button:hover,:host([loading]) .button:focus{background-color:var(--calcite-action-background-color, var(--calcite-color-foreground-1))}:host([loading]) .text-container{opacity:var(--calcite-opacity-disabled)}:host([loading]) calcite-loader[inline]{margin-inline-end:0px}:host([appearance=transparent]):host([active]) .button{background-color:var(--calcite-color-transparent-press)}:host([appearance=transparent]) .button{background-color:transparent;transition-property:box-shadow;transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1)}:host([appearance=transparent]) .button:hover{background-color:var(--calcite-color-transparent-hover)}:host([appearance=transparent]) .button:active{background-color:var(--calcite-color-transparent-press)}:host([data-active]) .button{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(-2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))))}:host([scale=s]) .button{font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-normal);padding-inline:var(--calcite-internal-action-padding-inline, .5rem);padding-block:var(--calcite-internal-action-padding-block, var(--calcite-spacing-xxs))}:host([scale=s]) .button--text-visible .icon-container{margin-inline-end:.5rem}:host([scale=m]) .button{font-size:var(--calcite-font-size--1);line-height:1rem;font-weight:var(--calcite-font-weight-normal);padding-inline:var(--calcite-internal-action-padding-inline, 1rem);padding-block:var(--calcite-internal-action-padding-block, var(--calcite-spacing-md))}:host([scale=m]) .button--text-visible .icon-container{margin-inline-end:.75rem}:host([scale=l]) .button{font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-normal);padding-inline:var(--calcite-internal-action-padding-inline, 1.25rem);padding-block:var(--calcite-internal-action-padding-block, var(--calcite-spacing-xl))}:host([scale=l]) .button--text-visible .icon-container{margin-inline-end:1rem}:host([alignment=center]) .button{justify-content:center}:host([alignment=end]) .button{justify-content:flex-end}:host([alignment=center]) .button .text-container--visible,:host([alignment=end]) .button .text-container--visible{flex:0 1 auto}:host([scale=s][compact]) .button,:host([scale=m][compact]) .button,:host([scale=l][compact]) .button{padding-inline:0px}.slot-container{display:flex}.slot-container--hidden{display:none}.button--text-visible{inline-size:100%}.indicator-with-icon{position:relative}.indicator-with-icon:after{content:"";position:absolute;block-size:.5rem;inline-size:.5rem;border-radius:9999px;inset-block-end:-.275rem;inset-inline-end:-.275rem;background-color:var(--calcite-action-indicator-color, var(--calcite-color-brand))}.indicator-without-icon{margin-inline:.25rem;inline-size:1rem;position:relative}.indicator-without-icon:after{content:"";position:absolute;block-size:.5rem;inline-size:.5rem;border-radius:9999px;inset-block-end:-.275rem;inset-inline-end:-.275rem;background-color:var(--calcite-action-indicator-color, var(--calcite-color-brand))}.indicator-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) .button,:host([disabled]) .button:hover,:host([disabled]) .button:focus{cursor:default;opacity:var(--calcite-opacity-disabled);background-color:var(--calcite-action-background-color, var(--calcite-action-background-color, var(--calcite-color-foreground-1)))}:host([disabled]):host([active]) .button,:host([disabled]):host([active]) .button:hover,:host([disabled]):host([active]) .button:focus{opacity:var(--calcite-opacity-disabled);background-color:var(--calcite-action-background-color-press, var(--calcite-action-background-color-press, var(--calcite-action-background-color-pressed, var(--calcite-color-foreground-3))))}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`;class I extends a.WF{constructor(){super(...arguments),this.guid=`calcite-action-${(0,l.g)()}`,this.buttonEl=(0,o._)(),this.buttonId=`${this.guid}-button`,this.indicatorId=`${this.guid}-indicator`,this.mutationObserver=(0,c.c)("mutation",(()=>this.requestUpdate())),this.messages=(0,m.u)({blocking:!0}),this.active=!1,this.appearance="solid",this.compact=!1,this.disabled=!1,this.dragHandle=!1,this.iconFlipRtl=!1,this.indicator=!1,this.loading=!1,this.scale="m",this.textEnabled=!1}static{this.properties={active:[7,{},{reflect:!0,type:Boolean}],alignment:[3,{},{reflect:!0}],appearance:[3,{},{reflect:!0}],compact:[7,{},{reflect:!0,type:Boolean}],disabled:[7,{},{reflect:!0,type:Boolean}],dragHandle:[7,{},{reflect:!0,type:Boolean}],icon:[3,{},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],indicator:[7,{},{reflect:!0,type:Boolean}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}],scale:[3,{},{reflect:!0}],text:1,textEnabled:[7,{},{reflect:!0,type:Boolean}]}}static{this.styles=w}async setFocus(){await(0,u.c)(this),this.buttonEl.value?.focus()}connectedCallback(){super.connectedCallback(),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}updated(){(0,h.u)(this)}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect()}handleTooltipSlotChange(t){const e=t.target.assignedElements({flatten:!0}).filter((t=>t?.matches("calcite-tooltip")))[0];e&&(e.referenceElement=this.buttonEl.value)}renderTextContainer(){const{text:t,textEnabled:e}=this,s={[b]:!0,[P]:e};return t?(0,r.D)("text-container",i.qy`<div class=${(0,a.CP)(s)}>${t}</div>`):null}renderIndicatorText(){const{indicator:t,messages:e,indicatorId:s,buttonId:n}=this;return i.qy`<div aria-labelledby=${n??a.s6} aria-live=polite class=${(0,a.CP)(f)} id=${s??a.s6} role=region>${t?e.indicator:null}</div>`}renderIconContainer(){const{loading:t,icon:e,scale:s,el:n,iconFlipRtl:o,indicator:l}=this,h="l"===s?"l":"m",c=t?i.qy`<calcite-loader inline .label=${this.messages.loading} .scale=${h}></calcite-loader>`:null,m=e?i.qy`<calcite-icon class=${(0,a.CP)({[S]:l})} .flipRtl=${o} .icon=${e} .scale=${(0,u.g)(this.scale)}></calcite-icon>`:null,d=c||m,g=d||n.children?.length,p=i.qy`<div class=${(0,a.CP)({[x]:!0,[v]:t})}><slot></slot></div>`;return g?(0,r.D)("icon-container",i.qy`<div aria-hidden=true class=${(0,a.CP)(y)}>${d}${p}</div>`):null}renderButton(){const{active:t,compact:e,disabled:s,icon:n,loading:l,textEnabled:h,label:u,text:c,indicator:m,indicatorId:d,buttonId:f,messages:y}=this,x=u||c||"",v=m?y.indicatorLabel.replace("{label}",x):x,b={[g]:!0,[p]:h,[_]:e},P=i.qy`${this.renderIconContainer()}${this.renderTextContainer()}${!n&&m&&(0,r.D)("indicator-no-icon",i.qy`<div class=${(0,a.CP)(E)}></div>`)||""}`;return this.dragHandle?i.qy`<span aria-controls=${(m?d:null)??a.s6} .ariaBusy=${l} .ariaDisabled=${this.disabled?this.disabled:null} .ariaLabel=${v} .ariaPressed=${t} class=${(0,a.CP)(b)} id=${f??a.s6} role=button tabindex=${(this.disabled?null:0)??a.s6} ${(0,o.K)(this.buttonEl)}>${P}</span>`:i.qy`<button aria-controls=${(m?d:null)??a.s6} .ariaBusy=${l} .ariaLabel=${v} .ariaPressed=${t} class=${(0,a.CP)(b)} .disabled=${s} id=${f??a.s6} tabindex=${(s?null:0)??a.s6} ${(0,o.K)(this.buttonEl)}>${P}</button>`}render(){return(0,h.I)({disabled:this.disabled,children:i.qy`${this.renderButton()}<slot name=${C} @slotchange=${this.handleTooltipSlotChange}></slot>${this.renderIndicatorText()}`})}}(0,n.c)("calcite-action",I)},96446:(t,e,s)=>{s.r(e),s.d(e,{Icon:()=>f});var n=s(14558),i=s(41331),r=s(44603),o=s(25450),a=s(13061),l=s(23424),h=s(82136);const u="flip-rtl",c={},m={},d={s:16,m:24,l:32};function g({icon:t,scale:e}){const s=d[e],n=function(t){const e=!isNaN(Number(t.charAt(0))),s=t.split("-");if(s.length>0){const e=/[a-z]/i;t=s.map(((t,s)=>t.replace(e,(function(t,e){return 0===s&&0===e?t:t.toUpperCase()})))).join("")}return e?`i${t}`:t}(t),i="F"===n.charAt(n.length-1);return`${i?n.substring(0,n.length-1):n}${s}${i?"F":""}`}function p(t){return c[t]}const _=h.AH`:host{display:inline-flex;color:var(--calcite-icon-color, var(--calcite-ui-icon-color, currentColor))}:host([scale=s]){inline-size:16px;block-size:16px;min-inline-size:16px;min-block-size:16px}:host([scale=m]){inline-size:24px;block-size:24px;min-inline-size:24px;min-block-size:24px}:host([scale=l]){inline-size:32px;block-size:32px;min-inline-size:32px;min-block-size:32px}.flip-rtl{transform:scaleX(-1)}.svg{display:block}:host([hidden]){display:none}[hidden]{display:none}`;class f extends r.WF{constructor(){super(...arguments),this.visible=!1,this.flipRtl=!1,this.icon=null,this.preload=!1,this.scale="m"}static{this.properties={pathData:[16,{},{state:!0}],visible:[16,{},{state:!0}],flipRtl:[7,{},{reflect:!0,type:Boolean}],icon:[3,{},{reflect:!0}],preload:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],textLabel:1}}static{this.styles=_}connectedCallback(){if(super.connectedCallback(),this.preload)return this.visible=!0,void this.loadIconPathData();this.visible||this.waitUntilVisible((()=>{this.visible=!0,this.loadIconPathData()}))}willUpdate(t){(t.has("icon")&&(this.hasUpdated||null!==this.icon)||t.has("scale")&&(this.hasUpdated||"m"!==this.scale))&&this.loadIconPathData()}disconnectedCallback(){super.disconnectedCallback(),this.intersectionObserver?.disconnect(),this.intersectionObserver=null}async loadIconPathData(){const{icon:t,scale:e,visible:s}=this;if(i.S$||!t||!s)return;const r={icon:t,scale:e},o=p(g(r))||await async function(t){const e=g(t),s=p(e);if(s)return s;m[e]||(m[e]=fetch((0,n.g)(`./assets/icon/${e}.json`)).then((t=>t.json())).catch((()=>(l.l.error(`${t.icon} (${t.scale}) icon failed to load`),""))));const i=await m[e];return c[e]=i,i}(r);t===this.icon&&(this.pathData=o)}waitUntilVisible(t){this.intersectionObserver=(0,a.c)("intersection",(e=>{e.forEach((e=>{e.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,t())}))}),{rootMargin:"50px"}),this.intersectionObserver?this.intersectionObserver.observe(this.el):t()}render(){const{el:t,flipRtl:e,pathData:s,scale:n,textLabel:a}=this,l=(0,o.g)(t),h=d[n],c=!!a,m=[].concat(s||"");return this.el.ariaHidden=(0,o.t)(!c),this.el.ariaLabel=c?a:null,this.el.role=c?"img":null,i.qy`<svg aria-hidden=true class=${(0,r.CP)({[u]:"rtl"===l&&e,svg:!0})} fill=currentColor height=100% viewBox=${`0 0 ${h} ${h}`} width=100% xmlns=http://www.w3.org/2000/svg>${m.map((t=>"string"==typeof t?i.JW`<path d=${t??i.s6} />`:i.JW`<path d=${t.d??i.s6} opacity=${("opacity"in t?t.opacity:1)??i.s6} />`))}</svg>`}}(0,n.c)("calcite-icon",f)},32524:(t,e,s)=>{s.r(e),s.d(e,{Loader:()=>_});var n=s(14558),i=s(41331),r=s(44603),o=s(7025),a=s(13478),l=s(82136);const h="percentage",u="ring--progress",c="ring",m="rings",d="text",g="ring--track",p=l.AH`:host{position:relative;margin-inline:auto;display:flex;align-items:center;justify-content:center;opacity:1;flex-direction:column;min-block-size:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke-width:var(--calcite-internal-stroke-width);fill:none;transform:scale(1);padding-block:var(--calcite-loader-spacing, 4rem)}:host([scale=s]){--calcite-internal-stroke-width: 3;--calcite-internal-text-offset: var(--calcite-spacing-xxs);--calcite-internal-loader-font-size: var(--calcite-font-size--3);--calcite-internal-loader-size: 2rem;--calcite-internal-loader-size-inline: .75rem;--calcite-internal-loader-value-line-height: .625rem}:host([scale=m]){--calcite-internal-stroke-width: 6;--calcite-internal-text-offset: var(--calcite-spacing-sm);--calcite-internal-loader-font-size: var(--calcite-font-size-0);--calcite-internal-loader-size: 4rem;--calcite-internal-loader-size-inline: 1rem;--calcite-internal-loader-value-line-height: 1.375rem}:host([scale=l]){--calcite-internal-stroke-width: 8;--calcite-internal-text-offset: var(--calcite-spacing-md);--calcite-internal-loader-font-size: var(--calcite-font-size-2);--calcite-internal-loader-size: 6rem;--calcite-internal-loader-size-inline: 1.5rem;--calcite-internal-loader-value-line-height: 1.71875rem}.text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;margin-block-start:var(--calcite-loader-text-spacing, var(--calcite-internal-text-offset));font-weight:var(--calcite-loader-text-weight, var(--calcite-font-weight-normal));color:var(--calcite-loader-text-color, var(--calcite-color-text-1))}.percentage{display:block;text-align:center;font-size:var(--calcite-loader-font-size);inline-size:var(--calcite-loader-size, var(--calcite-internal-loader-size));line-height:var(--calcite-internal-loader-value-line-height);align-self:center;color:var(--calcite-loader-text-color, var(--calcite-color-text-1))}.rings{position:relative;display:flex;overflow:visible;opacity:1;inline-size:var(--calcite-loader-size, var(--calcite-internal-loader-size));block-size:var(--calcite-loader-size, var(--calcite-internal-loader-size))}.ring{position:absolute;inset-block-start:0px;transform-origin:center;overflow:visible;inset-inline-start:0;inline-size:var(--calcite-loader-size, var(--calcite-internal-loader-size));block-size:var(--calcite-loader-size, var(--calcite-internal-loader-size))}.ring--track{stroke:var(--calcite-loader-track-color, var(--calcite-color-transparent-press))}.ring--progress{stroke:var(--calcite-loader-progress-color, var(--calcite-color-brand));transform:rotate(-90deg);transition:all var(--calcite-internal-animation-timing-fast) linear}:host([type=indeterminate]) .ring--progress{animation:loader-clockwise calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 2 / var(--calcite-internal-duration-factor)) linear infinite}:host([inline]){--calcite-internal-stroke-width: 2;position:relative;margin:0;stroke:currentColor;stroke-width:2;padding-block:0px;block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));min-block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));inline-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));vertical-align:calc(var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline))) * -1 * .2)}:host([inline]) .rings{inset-block-start:0px;margin:0;inset-inline-start:0;inline-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)))}:host([inline]) .ring{inline-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)));block-size:var(--calcite-loader-size, var(--calcite-loader-size-inline, var(--calcite-internal-loader-size-inline)))}:host([inline]) .ring--progress{stroke:var(--calcite-loader-progress-color-inline, currentColor)}:host([complete]){opacity:0;transform:scale(.75);transform-origin:center;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1s,transform var(--calcite-internal-animation-timing-medium) linear 1s}:host([complete]) .rings{opacity:0;transform:scale(.75);transform-origin:center;transition:opacity calc(.18s * var(--calcite-internal-duration-factor)) linear .8s,transform calc(.18s * var(--calcite-internal-duration-factor)) linear .8s}:host([complete]) .percentage{color:var(--calcite-color-brand);transform:scale(1.05);transform-origin:center;transition:color var(--calcite-internal-animation-timing-medium) linear,transform var(--calcite-internal-animation-timing-medium) linear}@keyframes loader-clockwise{0%{transform:rotate(0)}to{transform:rotate(360deg)}}:host([hidden]){display:none}[hidden]{display:none}`;class _ extends r.WF{constructor(){super(...arguments),this.messages=(0,a.u)({name:null}),this.complete=!1,this.inline=!1,this.scale="m",this.text="",this.type="indeterminate",this.value=0}static{this.properties={complete:[7,{},{reflect:!0,type:Boolean}],inline:[7,{},{reflect:!0,type:Boolean}],label:1,scale:[3,{},{reflect:!0}],text:1,type:[3,{},{reflect:!0}],value:[9,{},{type:Number}]}}static{this.styles=p}connectedCallback(){super.connectedCallback(),this.updateFormatter()}load(){requestAnimationFrame((()=>this.valueChangeHandler()))}willUpdate(t){t.has("value")&&(this.hasUpdated||0!==this.value)&&this.valueChangeHandler(),(t.has("type")&&(this.hasUpdated||"indeterminate"!==this.type)||t.has("messages"))&&this.updateFormatter()}valueChangeHandler(){this.complete=this.type.startsWith("determinate")&&100===this.value}formatValue(){return"determinate-value"!==this.type?`${this.value}`:this.formatter.format(this.value/100)}getSize(t){return{s:32,m:64,l:96}[t]}getInlineSize(t){return{s:12,m:16,l:24}[t]}updateFormatter(){"determinate-value"===this.type&&this.formatter?.resolvedOptions().locale!==this.messages._lang&&(this.formatter=new Intl.NumberFormat(this.messages._lang,{style:"percent"}))}render(){const{el:t,inline:e,label:s,text:n,type:a,value:l}=this,u=t.id||(0,o.g)(),c="indeterminate"!==a,g=Math.floor(l);return this.el.ariaLabel=s,this.el.ariaValueMax=c?"100":void 0,this.el.ariaValueMin=c?"0":void 0,this.el.ariaValueNow=c?g.toString():void 0,(0,r.Bq)(this.el,"id",u),this.el.role="progressbar",i.qy`<div class=${(0,r.CP)(m)}>${this.renderRing("track")}${this.renderRing("progress")}${!e&&c&&i.qy`<div class=${(0,r.CP)(h)}>${this.formatValue()}</div>`||""}</div>${!e&&n&&i.qy`<div class=${(0,r.CP)(d)}>${n}</div>`||""}`}renderRing(t){const{inline:e,scale:s,value:n}=this,o=e?this.getInlineSize(s):this.getSize(s),a=.45*o;let l;if("progress"===t){const t=2*a*Math.PI,e=(this.type.startsWith("determinate")?n:24)/100*t;l={"stroke-dasharray":`${e} ${t-e}`}}return i.qy`<svg aria-hidden=true class=${(0,r.CP)({[c]:!0,[g]:"track"===t,[u]:"progress"===t})} style=${(0,r.zl)(l)} viewBox=${`0 0 ${o} ${o}`}>${i.JW`<circle cx=${o/2} cy=${o/2} r=${a??i.s6} />`}</svg>`}}(0,n.c)("calcite-loader",_)},78568:(t,e,s)=>{s.r(e),s.d(e,{Popover:()=>R});s(13847),s(96446);var n=s(14558),i=s(44068),r=s(41331),o=s(95191),a=s(44603),l=s(36249),h=s(25450),u=s(7025),c=s(36607),m=s(64708),d=s(66865),g=s(13061),p=s(70605),_=s(13478),f=s(44148),y=s(14357),x=s(82136);const v="position-container",b="container",P="close-button-container",S="close-button",E="content",C="has-header",w="header",I="header-container",T="heading",A="auto",M="aria-controls",D="aria-expanded",N=x.AH`:host{display:contents;--calcite-floating-ui-z-index: var(--calcite-popover-z-index, var(--calcite-z-index-popup))}.position-container{inline-size:max-content;display:none;max-inline-size:100vw;max-block-size:100vh;inset-block-start:0;left:0;z-index:var(--calcite-floating-ui-z-index)}.position-container .calcite-floating-ui-anim{position:relative;transition:var(--calcite-floating-ui-transition);transition-property:inset,left,opacity;opacity:0;box-shadow:0 0 16px #00000029;z-index:var(--calcite-z-index);border-radius:.25rem}.position-container[data-placement^=bottom] .calcite-floating-ui-anim{inset-block-start:-5px}.position-container[data-placement^=top] .calcite-floating-ui-anim{inset-block-start:5px}.position-container[data-placement^=left] .calcite-floating-ui-anim{left:5px}.position-container[data-placement^=right] .calcite-floating-ui-anim{left:-5px}.position-container[data-placement] .calcite-floating-ui-anim--active{opacity:1;inset-block-start:0;left:0}.calcite-floating-ui-arrow{pointer-events:none;position:absolute;z-index:calc(var(--calcite-z-index) * -1);fill:var(--calcite-color-foreground-1)}.calcite-floating-ui-arrow__stroke{stroke:var(--calcite-color-border-3)}:host([scale=s]) .heading{padding:.5rem .75rem;font-size:var(--calcite-font-size--1);line-height:1.375}:host([scale=m]) .heading{padding:.75rem 1rem;font-size:var(--calcite-font-size-0);line-height:1.375}:host([scale=l]) .heading{padding:1rem 1.25rem;font-size:var(--calcite-font-size-1);line-height:1.375}.position-container .calcite-floating-ui-anim{border-width:1px;border-style:solid;background-color:var(--calcite-popover-background-color, var(--calcite-color-foreground-1));border-color:var(--calcite-popover-border-color, var(--calcite-color-border-3));border-radius:var(--calcite-popover-corner-radius, var(--calcite-corner-radius-round))}.calcite-floating-ui-arrow{fill:var(--calcite-popover-background-color, var(--calcite-color-foreground-1))}.calcite-floating-ui-arrow__stroke{stroke:var(--calcite-popover-border-color, var(--calcite-color-border-3))}.header{display:flex;flex:1 1 auto;align-items:stretch;justify-content:flex-start;border-width:0px;border-bottom-width:1px;border-style:solid;border-block-end-color:var(--calcite-popover-border-color, var(--calcite-color-border-3))}.heading{margin:0;display:block;flex:1 1 auto;align-self:center;white-space:normal;font-weight:var(--calcite-font-weight-medium);word-wrap:break-word;word-break:break-word;color:var(--calcite-popover-text-color, var(--calcite-color-text-1))}.header-container{position:relative;display:flex;height:100%;flex-direction:row;flex-wrap:nowrap;border-radius:.25rem;color:var(--calcite-popover-text-color, var(--calcite-color-text-1))}.header-container.has-header{flex-direction:column}.content{display:flex;height:100%;width:100%;flex-direction:column;flex-wrap:nowrap;align-self:center;word-wrap:break-word;word-break:break-word}.close-button-container{display:flex;overflow:hidden;flex:0 0 auto;border-start-end-radius:var(--calcite-popover-corner-radius, var(--calcite-corner-radius-round));border-end-end-radius:var(--calcite-popover-corner-radius, var(--calcite-corner-radius-round));--calcite-action-corner-radius-start-end: var(--calcite-popover-corner-radius, var(--calcite-corner-radius-sharp));--calcite-action-corner-radius-end-end: var(--calcite-popover-corner-radius, var(--calcite-corner-radius-sharp))}::slotted(calcite-panel),::slotted(calcite-flow){height:100%}:host([hidden]){display:none}[hidden]{display:none}`,F=new class{constructor(){this.registeredElements=new Map,this.registeredElementCount=0,this.queryPopover=t=>{const{registeredElements:e}=this,s=t.find((t=>e.has(t)));return e.get(s)},this.togglePopovers=t=>{const e=t.composedPath(),s=this.queryPopover(e);s&&!s.triggerDisabled&&(s.open=!s.open),Array.from(this.registeredElements.values()).filter((t=>t!==s&&t.autoClose&&t.open&&!e.includes(t))).forEach((t=>t.open=!1))},this.keyDownHandler=t=>{t.defaultPrevented||("Escape"===t.key?this.closeAllPopovers():(0,y.i)(t.key)&&this.togglePopovers(t))},this.clickHandler=t=>{(0,h.u)(t)||t.defaultPrevented||this.togglePopovers(t)}}registerElement(t,e){this.registeredElementCount++,this.registeredElements.set(t,e),1===this.registeredElementCount&&this.addListeners()}unregisterElement(t){this.registeredElements.delete(t)&&this.registeredElementCount--,0===this.registeredElementCount&&this.removeListeners()}closeAllPopovers(){Array.from(this.registeredElements.values()).forEach((t=>t.open=!1))}addListeners(){window.addEventListener("click",this.clickHandler),window.addEventListener("keydown",this.keyDownHandler)}removeListeners(){window.removeEventListener("click",this.clickHandler),window.removeEventListener("keydown",this.keyDownHandler)}};class R extends a.WF{constructor(){super(...arguments),this.closeButtonEl=(0,o._)(),this.focusTrap=(0,f.u)({triggerProp:"open",focusTrapOptions:{allowOutsideClick:!0,escapeDeactivates:t=>(t.defaultPrevented||(this.open=!1,t.preventDefault()),!1)}})(this),this.guid=`calcite-popover-${(0,u.g)()}`,this.hasLoaded=!1,this.mutationObserver=(0,g.c)("mutation",(()=>this.focusTrap.updateContainerElements())),this.transitionProp="opacity",this.messages=(0,_.u)(),this.floatingLayout="vertical",this.autoClose=!1,this.closable=!1,this.flipDisabled=!1,this.focusTrapDisabled=!1,this.offsetDistance=l.d,this.offsetSkidding=0,this.open=!1,this.overlayPositioning="absolute",this.placement=A,this.pointerDisabled=!1,this.scale="m",this.triggerDisabled=!1,this.calcitePopoverBeforeClose=(0,a.lh)({cancelable:!1}),this.calcitePopoverBeforeOpen=(0,a.lh)({cancelable:!1}),this.calcitePopoverClose=(0,a.lh)({cancelable:!1}),this.calcitePopoverOpen=(0,a.lh)({cancelable:!1})}static{this.properties={floatingLayout:[16,{},{state:!0}],referenceEl:[16,{},{state:!0}],autoClose:[7,{},{reflect:!0,type:Boolean}],closable:[7,{},{reflect:!0,type:Boolean}],flipDisabled:[7,{},{reflect:!0,type:Boolean}],flipPlacements:[0,{},{attribute:!1}],focusTrapDisabled:[7,{},{reflect:!0,type:Boolean}],focusTrapOptions:[0,{},{attribute:!1}],heading:1,headingLevel:[11,{},{type:Number,reflect:!0}],label:1,messageOverrides:[0,{},{attribute:!1}],offsetDistance:[11,{},{type:Number,reflect:!0}],offsetSkidding:[11,{},{reflect:!0,type:Number}],open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],placement:[3,{},{reflect:!0}],pointerDisabled:[7,{},{reflect:!0,type:Boolean}],referenceElement:1,scale:[3,{},{reflect:!0}],triggerDisabled:[7,{},{reflect:!0,type:Boolean}]}}static{this.styles=N}async reposition(t=!1){const{referenceEl:e,placement:s,overlayPositioning:n,flipDisabled:i,filteredFlipPlacements:r,offsetDistance:o,offsetSkidding:a,arrowEl:h,floatingEl:u}=this;return(0,l.r)(this,{floatingEl:u,referenceEl:e,overlayPositioning:n,placement:s,flipDisabled:i,flipPlacements:r,offsetDistance:o,offsetSkidding:a,arrowEl:h,type:"popover"},t)}async setFocus(){await(0,d.c)(this),this.requestUpdate(),(0,h.h)(this.el)}async updateFocusTrapElements(){this.focusTrap.updateContainerElements()}connectedCallback(){super.connectedCallback(),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0}),this.setFilteredPlacements(),requestAnimationFrame((()=>this.setUpReferenceElement(this.hasLoaded)))}willUpdate(t){t.has("flipPlacements")&&this.flipPlacementsHandler(),t.has("open")&&(this.hasUpdated||!1!==this.open)&&this.openHandler(),(t.has("offsetDistance")&&(this.hasUpdated||this.offsetDistance!==l.d)||t.has("offsetSkidding")&&(this.hasUpdated||0!==this.offsetSkidding)||t.has("overlayPositioning")&&(this.hasUpdated||"absolute"!==this.overlayPositioning)||t.has("placement")&&(this.hasUpdated||this.placement!==A))&&this.reposition(!0),t.has("referenceElement")&&this.referenceElementHandler()}loaded(){this.referenceElement&&!this.referenceEl&&this.setUpReferenceElement(),this.hasLoaded=!0}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect(),this.removeReferences(),(0,l.a)(this)}flipPlacementsHandler(){this.setFilteredPlacements(),this.reposition(!0)}openHandler(){(0,c.o)(this),this.reposition(!0),this.setExpandedAttr()}referenceElementHandler(){this.setUpReferenceElement(),this.reposition(!0)}setFloatingEl(t){this.floatingEl=t,t&&requestAnimationFrame((()=>this.setUpReferenceElement()))}setTransitionEl(t){t&&(this.transitionEl=t)}setFilteredPlacements(){const{el:t,flipPlacements:e}=this;this.filteredFlipPlacements=e?(0,l.f)(e,t):null}setUpReferenceElement(t=!0){this.removeReferences(),this.referenceEl=this.getReferenceElement(),(0,l.c)(this);const{el:e,referenceElement:s,referenceEl:n}=this;t&&s&&!n&&console.warn(`${e.tagName}: reference-element id "${s}" was not found.`,{el:e}),this.addReferences()}getId(){return this.el.id||this.guid}setExpandedAttr(){const{referenceEl:t,open:e}=this;t&&"setAttribute"in t&&t.setAttribute(D,(0,h.t)(e))}addReferences(){const{referenceEl:t}=this;if(!t)return;const e=this.getId();"setAttribute"in t&&t.setAttribute(M,e),F.registerElement(t,this.el),this.setExpandedAttr()}removeReferences(){const{referenceEl:t}=this;t&&("removeAttribute"in t&&(t.removeAttribute(M),t.removeAttribute(D)),F.unregisterElement(t))}getReferenceElement(){const{referenceElement:t,el:e}=this;return("string"==typeof t?(0,h.q)(e,{id:t}):t)||null}hide(){this.open=!1}onBeforeOpen(){this.calcitePopoverBeforeOpen.emit()}onOpen(){this.calcitePopoverOpen.emit(),this.focusTrap.activate()}onBeforeClose(){this.calcitePopoverBeforeClose.emit()}onClose(){this.calcitePopoverClose.emit(),(0,l.h)(this),this.focusTrap.deactivate()}storeArrowEl(t){this.arrowEl=t,this.reposition(!0)}renderCloseButton(){const{messages:t,closable:e}=this;return e?(0,i.D)(P,r.qy`<div class=${(0,a.CP)(P)}><calcite-action appearance=transparent class=${(0,a.CP)(S)} @click=${this.hide} .scale=${this.scale} .text=${t.close} ${(0,o.K)(this.closeButtonEl)}><calcite-icon icon=x .scale=${(0,d.g)(this.scale)}></calcite-icon></calcite-action></div>`):null}renderHeader(){const{heading:t,headingLevel:e}=this,s=t?(0,m.H)({class:T,level:e,children:t}):null;return s?(0,i.D)(w,r.qy`<div class=${(0,a.CP)(w)}>${s}${this.renderCloseButton()}</div>`):null}render(){const{referenceEl:t,heading:e,label:s,open:n,pointerDisabled:h,floatingLayout:u}=this,c=t&&n,m=!c,d=h?null:(0,i.D)("floating-arrow",(0,p.F)({floatingLayout:u,ref:this.storeArrowEl}));return this.el.inert=m,this.el.ariaLabel=s,this.el.ariaLive="polite",(0,a.Bq)(this.el,"id",this.getId()),this.el.role="dialog",r.qy`<div class=${(0,a.CP)(v)} ${(0,o.K)(this.setFloatingEl)}><div class=${(0,a.CP)({[b]:!0,[l.F.animation]:!0,[l.F.animationActive]:c})} ${(0,o.K)(this.setTransitionEl)}>${d}<div class=${(0,a.CP)({[C]:!!e,[I]:!0})}>${this.renderHeader()}<div class=${(0,a.CP)(E)}><slot></slot></div>${e?null:this.renderCloseButton()}</div></div></div>`}}(0,n.c)("calcite-popover",R)},24293:(t,e,s)=>{s.r(e),s.d(e,{Scrim:()=>_});s(32524);var n=s(14558),i=s(95191),r=s(54714),o=s(44603),a=s(13061),l=s(25450),h=s(13478),u=s(82136);const c="scrim",m="content",d=72,g=480,p=u.AH`:host{position:absolute;inset:0;z-index:var(--calcite-z-index-overlay);display:flex;block-size:100%;inline-size:100%;flex-direction:column;align-items:stretch}@keyframes calcite-scrim-fade-in{0%{--tw-bg-opacity: 0 }to{--tw-text-opacity: 1 }}.scrim{position:absolute;inset:0;display:flex;flex-direction:column;align-content:center;align-items:center;justify-content:center;overflow:hidden;animation:calcite-scrim-fade-in var(--calcite-internal-animation-timing-medium) ease-in-out;background-color:var(--calcite-scrim-background, var(--calcite-color-transparent-scrim))}.content{padding:1rem}:host([hidden]){display:none}[hidden]{display:none}`;class _ extends o.WF{constructor(){super(...arguments),this.resizeObserver=(0,a.c)("resize",(()=>this.handleResize())),this.messages=(0,h.u)(),this.hasContent=!1,this.loading=!1}static{this.properties={hasContent:[16,{},{state:!0}],loaderScale:[16,{},{state:!0}],loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}]}}static{this.styles=p}connectedCallback(){super.connectedCallback(),this.resizeObserver?.observe(this.el)}disconnectedCallback(){super.disconnectedCallback(),this.resizeObserver?.disconnect()}handleDefaultSlotChange(t){this.hasContent=(0,l.r)(t)}storeLoaderEl(t){this.loaderEl=t,this.handleResize()}getScale(t){return t<d?"s":t>=g?"l":"m"}handleResize(){const{loaderEl:t,el:e}=this;t&&(this.loaderScale=this.getScale(Math.min(e.clientHeight,e.clientWidth)??0))}render(){const{hasContent:t,loading:e,messages:s}=this;return r.qy`<div class=${(0,o.CP)(c)}>${e?r.qy`<calcite-loader .label=${s.loading} .scale=${this.loaderScale} ${(0,i.K)(this.storeLoaderEl)}></calcite-loader>`:null}<div class=${(0,o.CP)(m)} .hidden=${!t}><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></div>`}}(0,n.c)("calcite-scrim",_)},44068:(t,e,s)=>{s.d(e,{D:()=>o});var n=s(54714),i=s(31926),r=s(15290);const o=(0,i.u$)(class extends i.WL{constructor(){super(...arguments),this.key=n.s6}render(t,e){return this.key=t,e}update(t,[e,s]){return e!==this.key&&((0,r.mY)(t),this.key=e),s}})},95191:(t,e,s)=>{s.d(e,{_:()=>d,K:()=>_});var n=s(54714),i=s(15290),r=s(31926);const o=(t,e)=>{const s=t._$AN;if(void 0===s)return!1;for(const n of s)n._$AO?.(e,!1),o(n,e);return!0},a=t=>{let e,s;do{if(void 0===(e=t._$AM))break;s=e._$AN,s.delete(t),t=e}while(0===s?.size)},l=t=>{for(let e;e=t._$AM;t=e){let s=e._$AN;if(void 0===s)e._$AN=s=new Set;else if(s.has(t))break;s.add(t),c(e)}};function h(t){void 0!==this._$AN?(a(this),this._$AM=t,l(this)):this._$AM=t}function u(t,e=!1,s=0){const n=this._$AH,i=this._$AN;if(void 0!==i&&0!==i.size)if(e)if(Array.isArray(n))for(let r=s;r<n.length;r++)o(n[r],!1),a(n[r]);else null!=n&&(o(n,!1),a(n));else o(this,t)}const c=t=>{t.type==r.OA.CHILD&&(t._$AP??=u,t._$AQ??=h)};class m extends r.WL{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,s){super._$AT(t,e,s),l(this),this.isConnected=t._$AU}_$AO(t,e=!0){t!==this.isConnected&&(this.isConnected=t,t?this.reconnected?.():this.disconnected?.()),e&&(o(this,t),a(this))}setValue(t){if((0,i.Rt)(this._$Ct))this._$Ct._$AI(t,this);else{const e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}}const d=()=>new g;class g{}const p=new WeakMap,_=(0,r.u$)(class extends m{render(t){return n.s6}update(t,[e]){const s=e!==this.G;return s&&void 0!==this.G&&this.rt(void 0),(s||this.lt!==this.ct)&&(this.G=e,this.ht=t.options?.host,this.rt(this.ct=t.element)),n.s6}rt(t){if(this.isConnected||(t=void 0),"function"==typeof this.G){const e=this.ht??globalThis;let s=p.get(e);void 0===s&&(s=new WeakMap,p.set(e,s)),void 0!==s.get(this.G)&&this.G.call(this.ht,void 0),s.set(this.G,t),void 0!==t&&this.G.call(this.ht,t)}else this.G.value=t}get lt(){return"function"==typeof this.G?p.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}})},66905:(t,e,s)=>{s.d(e,{Bk:()=>o,eu:()=>a,qy:()=>u});var n=s(54714);const i=Symbol.for(""),r=t=>{if(t?.r===i)return t?._$litStatic$},o=t=>({_$litStatic$:t,r:i}),a=(t,...e)=>({_$litStatic$:e.reduce(((e,s,n)=>e+(t=>{if(void 0!==t._$litStatic$)return t._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${t}. Use 'unsafeStatic' to pass non-literal values, but\n            take care to ensure page security.`)})(s)+t[n+1]),t[0]),r:i}),l=new Map,h=t=>(e,...s)=>{const n=s.length;let i,o;const a=[],h=[];let u,c=0,m=!1;for(;c<n;){for(u=e[c];c<n&&void 0!==(o=s[c],i=r(o));)u+=i+e[++c],m=!0;c!==n&&h.push(o),a.push(u),c++}if(c===n&&a.push(e[n]),m){const t=a.join("$$lit$$");void 0===(e=l.get(t))&&(a.raw=a,l.set(t,e=a)),s=h}return t(e,...s)},u=h(n.qy);h(n.JW),h(n.ej)},93188:(t,e,s)=>{s.d(e,{A:()=>n});const n=s(29283).A.Symbol},36798:(t,e,s)=>{s.d(e,{A:()=>m});var n=s(93188),i=Object.prototype,r=i.hasOwnProperty,o=i.toString,a=n.A?n.A.toStringTag:void 0;const l=function(t){var e=r.call(t,a),s=t[a];try{t[a]=void 0;var n=!0}catch(l){}var i=o.call(t);return n&&(e?t[a]=s:delete t[a]),i};var h=Object.prototype.toString;const u=function(t){return h.call(t)};var c=n.A?n.A.toStringTag:void 0;const m=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":c&&c in Object(t)?l(t):u(t)}},67054:(t,e,s)=>{s.d(e,{A:()=>n});const n="object"==typeof global&&global&&global.Object===Object&&global},29283:(t,e,s)=>{s.d(e,{A:()=>r});var n=s(67054),i="object"==typeof self&&self&&self.Object===Object&&self;const r=n.A||i||Function("return this")()},54559:(t,e,s)=>{s.d(e,{A:()=>y});var n=s(17731),i=s(29283);const r=function(){return i.A.Date.now()};var o=/\s/;const a=function(t){for(var e=t.length;e--&&o.test(t.charAt(e)););return e};var l=/^\s+/;const h=function(t){return t?t.slice(0,a(t)+1).replace(l,""):t};var u=s(40932),c=/^[-+]0x[0-9a-f]+$/i,m=/^0b[01]+$/i,d=/^0o[0-7]+$/i,g=parseInt;const p=function(t){if("number"==typeof t)return t;if((0,u.A)(t))return NaN;if((0,n.A)(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=(0,n.A)(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=h(t);var s=m.test(t);return s||d.test(t)?g(t.slice(2),s?2:8):c.test(t)?NaN:+t};var _=Math.max,f=Math.min;const y=function(t,e,s){var i,o,a,l,h,u,c=0,m=!1,d=!1,g=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(e){var s=i,n=o;return i=o=void 0,c=e,l=t.apply(n,s)}function x(t){var s=t-u;return void 0===u||s>=e||s<0||d&&t-c>=a}function v(){var t=r();if(x(t))return b(t);h=setTimeout(v,function(t){var s=e-(t-u);return d?f(s,a-(t-c)):s}(t))}function b(t){return h=void 0,g&&i?y(t):(i=o=void 0,l)}function P(){var t=r(),s=x(t);if(i=arguments,o=this,u=t,s){if(void 0===h)return function(t){return c=t,h=setTimeout(v,e),m?y(t):l}(u);if(d)return clearTimeout(h),h=setTimeout(v,e),y(u)}return void 0===h&&(h=setTimeout(v,e)),l}return e=p(e)||0,(0,n.A)(s)&&(m=!!s.leading,a=(d="maxWait"in s)?_(p(s.maxWait)||0,e):a,g="trailing"in s?!!s.trailing:g),P.cancel=function(){void 0!==h&&clearTimeout(h),c=0,i=u=o=h=void 0},P.flush=function(){return void 0===h?l:b(r())},P}},17731:(t,e,s)=>{s.d(e,{A:()=>n});const n=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},19196:(t,e,s)=>{s.d(e,{A:()=>n});const n=function(t){return null!=t&&"object"==typeof t}},40932:(t,e,s)=>{s.d(e,{A:()=>r});var n=s(36798),i=s(19196);const r=function(t){return"symbol"==typeof t||(0,i.A)(t)&&"[object Symbol]"==(0,n.A)(t)}}}]);