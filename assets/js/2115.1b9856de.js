"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2115,2023],{14816:(t,e,i)=>{i.d(e,{z:()=>o});var s=i(19251),r=i(18159),n=i(1171),a=i(88443);class o{static fromOptimized(t,e,i=!1,s=!1){return(new h).initialize(t,e,i,s,1)}static fromJSON(t,e=!1,i=!1){const[s,r]=c(t);return(new u).initialize(s,r,e,i,1)}static fromOptimizedCIM(t,e,i=!1,s=!1){return(new m).initialize(t,e,i,s,1)}static fromJSONCIM(t,e=!1,i=!1){const[s,r]=c(t);return(new d).initialize(s,r,e,i,1)}static fromFeatureSetReader(t){const e=t.readGeometryForDisplay(),i=t.geometryType;return e&&i?this.fromOptimized(e,i):null}static fromFeatureSetReaderCIM(t){const e=t.readGeometryForDisplay(),i=t.geometryType;return e&&i?this.fromOptimizedCIM(e,i):null}static createEmptyOptimized(t,e=!1,i=!1){return(new h).initialize(new a.A,t,e,i,1)}static createEmptyJSON(t,e=!1,i=!1){return(new u).initialize([],t,e,i,1)}static createEmptyOptimizedCIM(t,e=!1,i=!1){return(new m).initialize(new a.A,t,e,i,1)}static createEmptyJSONCIM(t,e=!1,i=!1){return(new d).initialize([],t,e,i,1)}asJSON(){const t=(0,r.x)(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:t[0][0][0],ymin:t[0][0][1],xmax:t[0][2][0],ymax:t[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:t.flat()}:"esriGeometryPoint"===this.geometryType?{x:t[0][0][0],y:t[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:t}:{paths:t}}getCurrentRingArea(){if(!this||this.pathSize<3)return 0;let t,e,i=0;if(this.seekPathStart(),!this.nextPoint())return 0;t=this.x,e=this.y;const s=t,r=e;for(;this.nextPoint();)i+=(t-this.x)*(e+this.y),t=this.x,e=this.y;return i+=(t-s)*(e+r),-.5*i}invertY(){this.yFactor*=-1}}class h extends o{constructor(){super(...arguments),this._end=-1}initialize(t,e,i,s,r){return this.hasZ=i,this.hasM=s,this.geometryType=e,this._stride=2+Number(i)+Number(s),this._geometry=t,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=r,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(t){if(t>=0&&t<this.totalSize){if(this._pathIndex<t)for(;this._pathIndex<t&&this.nextPath(););else if(this._pathIndex>t)for(;this._pathIndex>t&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(t){const e=this._pathOffset+t*this._stride;return e>=0&&e<this._end&&(this._pointOffset=e,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){if(this._pathIndex>=0){const t=this._geometry.isPoint?1:this._geometry.lengths[this._pathIndex];this._pathOffset+=this._stride*t}this._pointOffset=this._pathOffset-this._stride;const t=this._geometry.isPoint?1:this._geometry.lengths[this._pathIndex+1];return this._end=this._pointOffset+this._stride+this._stride*t,++this._pathIndex<this.totalSize}prevPath(){this._end=this._pathOffset;const t=this._geometry.isPoint?1:this._geometry.lengths[this._pathIndex-1];return this._pathOffset-=this._stride*t,this._pointOffset=this._pathOffset-this._stride,--this._pathIndex>=0}pathLength(){const t=this._end,e=this._stride,i=this._geometry.coords;let s=0;for(let r=this._pathOffset+e;r<t;r+=e){const t=i[r-e],n=i[r-e+1],a=i[r]-t,o=i[r+1]-n;s+=Math.sqrt(a*a+o*o)}return s}startPath(){this._geometry.lengths.push(0)}pushPath(t){this.startPath(),this.pushPoints(t)}pushPoint(t){for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]++}pushXY(t,e){this._geometry.coords.push(t,e),this._geometry.lengths[this.totalSize-1]++}pushPoints(t){for(const e of t)for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]+=t.length}pushCursor(t){const e=t.asOptimized();this._geometry.coords.push(...e.coords),this._geometry.lengths.push(...e.lengths)}asOptimized(){const t=this._geometry.clone();if(1!==this.yFactor)for(let e=1;e<t.coords.length;e+=this._stride)t.coords[e]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(t.lengths.length=0),t}isClosed(){const t=this._geometry.coords,e=this._pathOffset,i=this._end-this._stride;for(let s=0;s<this._stride;s++)if(t[e+s]!==t[i+s])return!1;return!0}clone(){return(new h).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.coords.length/this._stride}get pathSize(){const{lengths:t}=this._geometry;return this._pathIndex<0||this._pathIndex>t.length-1?0:t[this._pathIndex]}get totalSize(){return this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(t){this._geometry.coords[this._pointOffset]=t}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(t){this._geometry.coords[this._pointOffset+1]=this.yFactor*t}get z(){return this._geometry.coords[this._pointOffset+2]}set z(t){this._geometry.coords[this._pointOffset+2]=t}get m(){const t=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+t]}set m(t){this._geometry.coords[this._pointOffset+3]=t}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function l(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function c(t){return(0,n.Bi)(t)?[t.rings,"esriGeometryPolygon"]:(0,n.Rg)(t)?[t.paths,"esriGeometryPolyline"]:(0,n.U9)(t)?[[t.points],"esriGeometryMultipoint"]:(0,n.ZC)(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:(0,n.fT)(t)?[[[l(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class u extends o{initialize(t,e,i,s,r){return this._paths=t,this.geometryType=e,this.hasZ=i,this.hasM=s,this._pathIndex=this._pointIndex=-1,this.yFactor=r,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(t){return t>=0&&t<this.totalSize&&(this._pathIndex=t,this._pointIndex=-1,this._currentPath=this._paths[t],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(t){return t>=0&&t<this._currentPath.length&&(this._pointIndex=t,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this._pointIndex=-1,this._currentPath=this._paths[--this._pathIndex],this._pathIndex>=0}pathLength(){const t=this._currentPath.length,e=this._currentPath;let i=0;for(let s=1;s<t;s++){const t=e[s-1],r=e[s],n=t[0],a=t[1],o=r[0]-n,h=r[1]-a;i+=Math.sqrt(o*o+h*h)}return i}startPath(){this._paths.push([])}pushPath(t){this._paths.push(t)}pushPoint(t){this._paths[this.totalSize-1].push(t)}pushXY(t,e){this._paths[this.totalSize-1].push([t,e])}pushPoints(t){this._paths[this.totalSize-1].push(...t)}pushCursor(t){const e=(0,r.x)(t);for(const i of e)this.pushPath(i)}asOptimized(){const t=new a.A;if("esriGeometryPoint"===this.geometryType)t.coords.push(...this._paths[0][0]),t.lengths.length=0;else for(const e of this._paths){for(const i of e)t.coords.push(i[0]),t.coords.push(i[1]*this.yFactor),this.hasZ&&t.coords.push(i[2]),this.hasM&&t.coords.push(i[this._mIndex]);t.lengths.push(e.length)}return t}isClosed(){const t=this._currentPath[0],e=this._currentPath[this._currentPath.length-1];for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}clone(){return(new u).initialize((0,s.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map((t=>t.length)).reduce(((t,e)=>t+e))}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(t){this._currentPoint[0]=t}get y(){return this.yFactor*this._currentPoint[1]}set y(t){this._currentPoint[1]=this.yFactor*t}get z(){return this._currentPoint[2]}set z(t){this._currentPoint[2]=t}get m(){return this._currentPoint[this._mIndex]}set m(t){this._currentPoint[this._mIndex]=t}get pathIndex(){return this._pathIndex}}class m extends h{initialize(t,e,i,s,r){return super.initialize(t,e,i,s,r),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map((t=>new Set))),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const t=(new m).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return t._controlPoints=this._controlPoints,t}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(t){this._controlPoints[this.pathIndex].add(t)}getControlPointAt(t){return this._controlPoints[this.pathIndex].has(t)}}class d extends u{initialize(t,e,i,s,r){return super.initialize(t,e,i,s,r)}clone(){return(new d).initialize((0,s.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,1)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(t){this._paths[this.pathIndex][t][4]=1}getControlPointAt(t){return 1===this._paths[this.pathIndex][t][4]}}},73138:(t,e,i)=>{i.d(e,{d:()=>l});var s=i(80510),r=i(36358),n=i(23806),a=i(65319),o=i(43525);const h=222045e-19;function l(t){if(0===t.totalSize)return null;const e=(0,r.z8)(t);if(!e)return null;const i=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*h;let a=0,o=0;t.reset();for(let s=0;t.nextPath();s++){const e=t.getCurrentRingArea();e>o&&(o=e,a=s)}if(t.seekPath(a),0===t.pathSize)return null;t.seekPathStart();const l=(0,r.B$)(t);if(Math.abs(o)<=2*i*i)return[(l[0]+l[2])/2,(l[1]+l[3])/2];t.seekPathStart();const d=(0,n.w2)(t,(0,s.vt)());if(null===d)return null;if(t.totalPoints<4)return d;const g=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],f=[NaN,NaN,NaN,NaN],p=[NaN,NaN,NaN,NaN];let y=!1,_=u(d,t,!0);0===_.distance&&(y=!0,g[0][0]=d[0],g[0][1]=d[1],_=u(d,t,!1)),f[0]=_.distance,p[0]=0;const x=[NaN,NaN];let M=!1,I=.25,C=-1,S=NaN;do{if(S=NaN,g[1]=m(t,w(l[0],l[2],I),i,e),isNaN(g[1][0])||isNaN(g[1][1])||(_=u(g[1],t,!1),S=_.distance),!isNaN(S)&&S>i&&c(g[1],t))M=!0,f[1]=S,p[1]=P(g[1],d);else if(!isNaN(S)&&S>C&&(C=S,x[0]=g[1][0],x[1]=g[1][1]),I-=.01,I<.1){if(!(C>=0))break;M=!0,f[1]=C,g[1][0]=x[0],g[1][1]=x[1],p[1]=P(g[1],d)}}while(!M);M=!1,I=.5,C=-1;let v=.01,N=1;do{if(S=NaN,g[2]=m(t,w(l[0],l[2],I),i,e),isNaN(g[2][0])||isNaN(g[2][1])||(_=u(g[2],t,!1),S=_.distance),!isNaN(S)&&S>i&&c(g[2],t))M=!0,f[2]=S,p[2]=P(g[2],d);else if(!isNaN(S)&&S>C)C=S,x[0]=g[2][0],x[1]=g[2][1];else if(S>C&&(C=S,x[0]=g[2][0],x[1]=g[2][1]),I=.5+v*N,v+=.01,N*=-1,I<.3||I>.7){if(!(C>=0))break;M=!0,f[2]=C,g[2][0]=x[0],g[2][1]=x[1],p[2]=P(g[2],d)}}while(!M);M=!1,I=.75,C=-1;do{if(S=NaN,g[3]=m(t,w(l[0],l[2],I),i,e),isNaN(g[3][0])||isNaN(g[3][1])||(_=u(g[3],t,!1),S=_.distance),!isNaN(S)&&S>i&&c(g[3],t))M=!0,f[3]=S,p[3]=P(g[3],d);else if(S>C&&(C=S,x[0]=g[3][0],x[1]=g[3][1]),I+=.01,I>.9){if(!(C>=0))break;M=!0,f[3]=C,g[3][0]=x[0],g[3][1]=x[1],p[3]=P(g[3],d)}}while(!M);const b=[0,1,2,3],R=y?0:1;let F;for(let s=R;s<4;s++)for(let t=R;t<3;t++){const e=p[t],i=p[t+1];z(e,i)>0&&(F=b[t],b[t]=b[t+1],b[t+1]=F,p[t]=i,p[t+1]=e)}let k=R,O=0,A=0;for(let s=R;s<4;s++){switch(s){case 0:A=2*f[b[s]];break;case 1:A=1.66666666*f[b[s]];break;case 2:A=1.33333333*f[b[s]];break;case 3:A=f[b[s]]}A>O&&(O=A,k=b[s])}return g[k]}function c(t,e){let i,s,r,n,a=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(i=e.x,s=e.y;e.nextPoint();i=r,s=n)r=e.x,n=e.y,s>t[1]!=n>t[1]&&((r-i)*(t[1]-s)-(n-s)*(t[0]-i)>0?a++:a--);return 0!==a}function u(t,e,i){if(i&&c(t,e))return{coord:t,distance:0};let s=1/0,r=0,n=0,o=[0,0],h=[0,0];const l=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(o[0]=e.x,o[1]=e.y;e.nextPoint();o=h){h=[e.x,e.y],(0,a.gR)(l,t,o,h);const i=P(t,l);i<s&&(s=i,r=l[0],n=l[1])}return{coord:[r,n],distance:Math.sqrt(s)}}function m(t,e,i,r){const n=[e,0];let a=1/0,h=1/0,l=!1,c=!1;const u=[[e,r[1]-1],[e,r[3]+1]],m=[0,0],g=[0,0],f=[0,0],p=[[0,0],[0,0]],y=(0,s.vt)();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(p[0][0]=t.x,p[0][1]=t.y;t.nextPoint();p[0][0]=p[1][0],p[0][1]=p[1][1]){if(p[1][0]=t.x,p[1][1]=t.y,null===d(y,p))continue;if(g[0]=u[0][0],g[1]=u[0][1],f[0]=u[1][0],f[1]=u[1][1],0===_(y,g,f))continue;if(!(0,o.Ql)(u[0],u[1],p[0],p[1],m))continue;const e=m[1];a>h?e<a&&(a=e,l=!0):e<h&&(h=e,c=!0)}return l&&c?n[1]=(a+h)/2:n[0]=n[1]=NaN,n}function d(t,e){if(e.length<2)return null;t||(t=(0,s.vt)());const[i,r]=e[0],[n,a]=e[1];return t[0]=Math.min(i,n),t[1]=Math.min(r,a),t[2]=Math.max(i,n),t[3]=Math.max(r,a),t}const g=1,f=4,p=3,y=12;function _(t,e,i){let s=x(e,t),r=x(i,t);const n=t[0],a=t[1],o=t[2],h=t[3];if(s&r)return 0;if(!(s|r))return 4;const l=(s?1:0)|(r?2:0);do{const l=i[0]-e[0],c=i[1]-e[1];if(l>c)s&p?(s&g?(e[1]+=c*(n-e[0])/l,e[0]=n):(e[1]+=c*(o-e[0])/l,e[0]=o),s=x(e,t)):r&p?(r&g?(i[1]+=c*(n-i[0])/l,i[0]=n):(i[1]+=c*(o-i[0])/l,i[0]=o),r=x(i,t)):s?(s&f?(e[0]+=l*(a-e[1])/c,e[1]=a):(e[0]+=l*(h-e[1])/c,e[1]=h),s=x(e,t)):(r&f?(i[0]+=l*(a-i[1])/c,i[1]=a):(i[0]+=l*(h-i[1])/c,i[1]=h),r=x(i,t));else if(s&y?(s&f?(e[0]+=l*(a-e[1])/c,e[1]=a):(e[0]+=l*(h-e[1])/c,e[1]=h),s=x(e,t)):r&y?(r&f?(i[0]+=l*(a-i[1])/c,i[1]=a):(i[0]+=l*(h-i[1])/c,i[1]=h),r=x(i,t)):s?(s&g?(e[1]+=c*(n-e[0])/l,e[0]=n):(e[1]+=c*(o-e[0])/l,e[0]=o),s=x(e,t)):(r&g?(i[1]+=c*(n-i[0])/l,i[0]=n):(i[1]+=c*(o-i[0])/l,i[0]=o),r=x(i,t)),s&r)return 0}while(s|r);return l}function x(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function w(t,e,i){return t+(e-t)*i}function P(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function z(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const i=isNaN(t),s=isNaN(e);return i<s?-1:i>s?1:0}},74339:(t,e,i)=>{i.d(e,{A:()=>n});var s=i(72777),r=i(25801);class n{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(t){return this._resourceMap.get(t)??null}async fetchResource(t,e){const i=this._resourceMap.get(t);if(i)return{width:i.width,height:i.height};let s=this._inFlightResourceMap.get(t);return s?s.then((t=>({width:t.width,height:t.height}))):(s=(0,r.M5)(t,e),this._inFlightResourceMap.set(t,s),s.then((e=>(this._inFlightResourceMap.delete(t),this._resourceMap.set(t,e),{width:e.width,height:e.height})),(()=>({width:0,height:0}))))}deleteResource(t){this._inFlightResourceMap.delete(t),this._resourceMap.delete(t)}loadFont(t){return(0,s.Al)(t)}}},79851:(t,e,i)=>{i.r(e),i.d(e,{CIMSymbolRasterizer:()=>_});var s=i(96220),r=i(86394),n=i(40189),a=i(89882),o=i(80047),h=i(74339),l=i(48655),c=i(48002),u=i(68724),m=i(95159),d=i(50072),g=i(77573),f=i(15790);const p=t=>t?.scaleFactor?t.scaleFactor:1,y=96/72;class _{constructor(t,e){this._spatialReference=t,this._avoidSDF=e,this._resourceCache=new Map,this._lazyImageDataCanvas=null,this._pictureMarkerCache=new Map,this._textRasterizer=new m.A,this._cimResourceManager=new h.A,this._rasterizer=new u.A(this._cimResourceManager)}get _imageDataCanvas(){return this._lazyImageDataCanvas??=document.createElement("canvas"),this._lazyImageDataCanvas}get _imageDataContext(){return this._imageDataCanvas.getContext("2d",{willReadFrequently:!0})}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(t,e,i,s,r,n,a,o,h){if(!t)return null;const{data:u}=t;if(!u||"CIMSymbolReference"!==u.type||!u.symbol)return null;const{symbol:m}=u;n||(n=(0,d.n5)(m));const g=await c.$N.resolveSymbolOverrides(u,e,this._spatialReference,r,n,a,o),f=this._imageDataCanvas,p=this._cimResourceManager,_=[];c.wp.fetchResources(g,p,_),c.wp.fetchFonts(g,p,_),_.length>0&&await Promise.all(_);const{width:x,height:w}=i,P=function(t,e,i,s){const r=1,n=-e/2+r,a=e/2-r,o=i/2-r,h=-i/2+r;switch(t){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[n,0],[0,0],[a,0]]]};default:return"legend"===s?{rings:[[[n,o],[a,0],[a,h],[n,h],[n,o]]]}:{rings:[[[n,o],[a,o],[a,h],[n,h],[n,o]]]}}}(n,x,w,s),z=c.wp.getEnvelope(g,P,p);if(!z)return null;const M=(window.devicePixelRatio||1)*y;let I=1,C=0,S=0;switch(m.type){case"CIMPointSymbol":case"CIMTextSymbol":{let t=1;z.width>x&&(t=x/z.width);let e=1;z.height>w&&(e=w/z.height),"preview"===s&&(z.width<x&&(t=x/z.width),z.height<w&&(e=w/z.height)),I=Math.min(t,e),C=z.x+z.width/2,S=z.y+z.height/2}break;case"CIMLineSymbol":{(h||z.height>w)&&(I=w/z.height),S=z.y+z.height/2;const t=z.x*I+x/2,e=(z.x+z.width)*I+x/2,{paths:i}=P;i[0][0][0]-=t/I,i[0][2][0]-=(e-x)/I}break;case"CIMPolygonSymbol":{C=z.x+z.width/2,S=z.y+z.height/2;const t=z.x*I+x/2,e=(z.x+z.width)*I+x/2,i=z.y*I+w/2,s=(z.y+z.height)*I+w/2,{rings:r}=P;t<0&&(r[0][0][0]-=t,r[0][3][0]-=t,r[0][4][0]-=t),i<0&&(r[0][0][1]+=i,r[0][1][1]+=i,r[0][4][1]+=i),e>x&&(r[0][1][0]-=e-x,r[0][2][0]-=e-x),s>w&&(r[0][2][1]+=s-w,r[0][3][1]+=s-w)}}f.width=x*M,f.height=w*M;f.width+=2,f.height+=2;const v=this._imageDataContext,N=l.IT.createIdentity();return N.translate(-C,-S),N.scale(I*M,-I*M),N.translate(x*M/2+1,w*M/2+1),v.clearRect(0,0,f.width,f.height),new l.Rj(v,p,N,!0).drawSymbol(g,P),v.getImageData(0,0,f.width,f.height)}async analyzeCIMSymbol3D(t,e,i,s,r){const a=[],h=e?{geometryType:s,spatialReference:this._spatialReference,fields:e}:null,l=[];c.wp.fetchFonts(t.data.symbol,this._cimResourceManager,l),await Promise.all(l);const u=new o.U(this._cimResourceManager,h);let m;await u.analyzeSymbolReference(t.data,this._avoidSDF,a),(0,n.Te)(r);for(const n of a)"CIMPictureMarker"!==n.cim.type&&"CIMPictureFill"!==n.cim.type&&"CIMPictureStroke"!==n.cim.type||(m||(m=[]),m.push(this._fetchPictureMarkerResource(n,r))),i&&"text"===n.type&&"string"==typeof n.text&&n.text.includes("[")&&(n.text=(0,d.P3)(i,n.text,n.cim.textCase));return m&&await Promise.all(m),a}rasterizeCIMSymbol3D(t,e,i,s,r,n){const a=[];for(const o of t){s&&"function"==typeof s.scaleFactor&&(s.scaleFactor=s.scaleFactor(e,r,n));const t=this._getRasterizedResource(o,e,i,s,r,n);if(!t)continue;let h=0,l=t.anchorX||0,c=t.anchorY||0,u=!1,m=0,g=0;if("esriGeometryPoint"===i){const t=p(s);if(m=(0,d.s4)(o.offsetX,e,r,n)*t||0,g=(0,d.s4)(o.offsetY,e,r,n)*t||0,"marker"===o.type)h=(0,d.s4)(o.rotation,e,r,n)||0,u=o.rotateClockwise??!1;else if("text"===o.type){if(h=(0,d.s4)(o.angle,e,r,n)||0,void 0!==o.horizontalAlignment)switch(o.horizontalAlignment){case"left":l=-.5;break;case"right":l=.5;break;default:l=0}if(void 0!==o.verticalAlignment)switch(o.verticalAlignment){case"top":c=.5;break;case"bottom":c=-.5;break;case"baseline":c=-.25;break;default:c=0}}}null!=t&&a.push({angle:h,rotateClockWise:u,anchorX:l,anchorY:c,offsetX:m,offsetY:g,rasterizedResource:t})}return this.getSymbolImage(a)}getSymbolImage(t){const e=document.createElement("canvas"),i=e.getContext("2d");let s=0,r=0,n=0,o=0;const h=[];for(let m=0;m<t.length;m++){const e=t[m],l=e.rasterizedResource;if(!l)continue;const c=l.size,u=e.offsetX,d=e.offsetY,g=e.anchorX,f=e.anchorY,p=e.rotateClockWise||!1;let y=e.angle,_=(0,a.Lz)(u)-c[0]*(.5+g),x=(0,a.Lz)(d)-c[1]*(.5+f),w=_+c[0],P=x+c[1];if(y){p&&(y=-y);const t=Math.sin(y*Math.PI/180),e=Math.cos(y*Math.PI/180),i=_*e-x*t,s=_*t+x*e,r=_*e-P*t,n=_*t+P*e,a=w*e-P*t,o=w*t+P*e,h=w*e-x*t,l=w*t+x*e;_=Math.min(i,r,a,h),x=Math.min(s,n,o,l),w=Math.max(i,r,a,h),P=Math.max(s,n,o,l)}s=_<s?_:s,r=x<r?x:r,n=w>n?w:n,o=P>o?P:o;const z=i.createImageData(l.size[0],l.size[1]);z.data.set(new Uint8ClampedArray(l.image.buffer));const M={offsetX:u,offsetY:d,rotateClockwise:p,angle:y,rasterizedImage:z,anchorX:g,anchorY:f};h.push(M)}e.width=n-s,e.height=o-r;const l=-s,c=o;for(let m=0;m<h.length;m++){const t=h[m],e=this._imageDataToCanvas(t.rasterizedImage),s=t.rasterizedImage.width,r=t.rasterizedImage.height,n=l-s*(.5+t.anchorX),o=c-r*(.5-t.anchorY);if(t.angle){const s=(360-t.angle)*Math.PI/180;i.save(),i.translate((0,a.Lz)(t.offsetX),-(0,a.Lz)(t.offsetY)),i.translate(l,c),i.rotate(s),i.translate(-l,-c),i.drawImage(e,n,o),i.restore()}else i.drawImage(e,n+(0,a.Lz)(t.offsetX),o-(0,a.Lz)(t.offsetY))}const u=new f.Q({x:l/e.width-.5,y:c/e.height-.5});return{imageData:0!==e.width&&0!==e.height?i.getImageData(0,0,e.width,e.height):i.createImageData(1,1),anchorPosition:u}}async _fetchPictureMarkerResource(t,e){const i=t.materialHash;if(!this._pictureMarkerCache.get(i)){const s=(await(0,r.A)(t.cim.url,{responseType:"image",signal:e?.signal})).data;this._pictureMarkerCache.set(i,s)}}_imageDataToCanvas(t){const e=this._imageDataCanvas,i=this._imageDataContext;return e.width=t.width,e.height=t.height,i.putImageData(t,0,0),e}_imageTo32Array(t,e,i,r){const n=this._imageDataCanvas,a=this._imageDataContext;if(n.width=e,n.height=i,a.drawImage(t,0,0,e,i),r){a.save();const n=new s.A(r);a.fillStyle=n.toHex(),a.globalCompositeOperation="multiply",a.fillRect(0,0,e,i),a.globalCompositeOperation="destination-atop",a.drawImage(t,0,0,e,i),a.restore()}return new Uint32Array(a.getImageData(0,0,e,i).data.buffer)}_getRasterizedResource(t,e,i,s,r,n){let a,h,l;if("text"===t.type)return this._rasterizeTextResource(t,e,s,r,n);({analyzedCIM:a,hash:h}=function(t,e,i,s){let r,n;"function"==typeof t.materialHash?(r=(0,t.materialHash)(e,i,s),n=(0,o.G)(t.cim,t.materialOverrides)):(r=t.materialHash,n=t.cim);return{analyzedCIM:n,hash:r}}(t,e,r,n));const c=p(s);if("CIMPictureMarker"===t.cim.type){const i=(0,d.s4)(t.size,e,r,n)*c,{image:s,width:a,height:o}=this._getPictureResource(t,i,(0,d.s4)(t.color,e,r,n));return l={image:s,size:[a,o],sdf:!1,simplePattern:!1,anchorX:t.anchorPoint?t.anchorPoint.x:0,anchorY:t.anchorPoint?t.anchorPoint.y:0},l}(0,g.mR)(a,c,{preserveOutlineWidth:!1});const u=a;h+=i,s&&(h+=JSON.stringify(s));const m=this._resourceCache;return m.has(h)?m.get(h):(l=this._rasterizer.rasterizeJSONResource({cim:u,type:t.type,url:t.url,mosaicHash:h,size:null,path:null},window.devicePixelRatio||1,this._avoidSDF),m.set(h,l),l)}_rasterizeTextResource(t,e,i,s,r){const n=p(i),a=(0,d.s4)(t.text,e,s,r);if(!a||0===a.length)return null;const o=t.cim,h=(0,d.s4)(o?.fontFamilyName||t.fontName,e,s,r),l=(0,d.s4)(o?.font?.style||t.style,e,s,r),c=(0,d.s4)(o?.font?.weight||t.weight,e,s,r),u=(0,d.s4)(o?.font?.decoration||t.decoration,e,s,r),m=(0,d.s4)(t.size,e,s,r)*n,g=(0,d.s4)(t.horizontalAlignment,e,s,r),f=(0,d.s4)(t.verticalAlignment,e,s,r),y=(0,d.G9)((0,d.s4)(t.color,e,s,r)),_=(0,d.G9)((0,d.s4)(t.outlineColor,e,s,r)),x=(0,d.s4)(t.outlineSize,e,s,r),w=null!=t.backgroundColor?(0,d.G9)(t.backgroundColor):null,P=null!=t.borderLineColor?(0,d.G9)(t.borderLineColor):null,z=null!=t.borderLineWidth?t.borderLineWidth:null,M={color:y,size:m,horizontalAlignment:g,verticalAlignment:f,font:{family:h,style:l,weight:c,decoration:u},halo:{size:x||0,color:_,style:l},backgroundColor:w,borderLine:null!=P&&null!=z?{color:P,size:z}:null,pixelRatio:1,premultiplyColors:!this._avoidSDF};return this._textRasterizer.rasterizeText(a,M)}_getPictureResource(t,e,i){const s=this._pictureMarkerCache.get(t.materialHash);if(!s)return null;const r=s.height/s.width,n=e?r>1?(0,a.Lz)(e):(0,a.Lz)(e)/r:s.width,o=e?r>1?(0,a.Lz)(e)*r:(0,a.Lz)(e):s.height;return{image:this._imageTo32Array(s,n,o,i),width:n,height:o}}}},68724:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(92504),r=i(48002),n=i(79126),a=i(76715),o=i(21422),h=i(50072);class l{constructor(t){this._resourceManager=t,this._lazyRasterizationCanvas=null}dispose(){this._lazyRasterizationCanvas=null}get _rasterizationCanvas(){return null==this._lazyRasterizationCanvas&&(this._lazyRasterizationCanvas=document.createElement("canvas"),this._lazyRasterizationCanvas.getContext("2d",{willReadFrequently:!0})),this._lazyRasterizationCanvas}rasterizeJSONResource(t,e,i){if("simple-fill"===t.type||"esriSFS"===t.type){const[i,r,a]=(0,n.r)(this._rasterizationCanvas,t.style,e);return{size:[r,a],image:new Uint32Array(i.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:(0,s.yR)(Math.ceil(e))}}if("simple-line"===t.type||"esriSLS"===t.type||"line"===t.type&&t.dashTemplate){let e,i;if("simple-line"===t.type||"esriSLS"===t.type)switch(e=(0,r.BW)(t.style,t.cap),t.cap){case"butt":i="Butt";break;case"square":i="Square";break;default:i="Round"}else e=t.dashTemplate,i=t.cim.capStyle;const[s,a,o]=(0,n.k)(e,i);return{size:[a,o],image:new Uint32Array(s.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let h,l=null,c=null,u=1;if("simple-marker"===t.type||"esriSMS"===t.type||"line-marker"===t.type?(h=r.wp.fromSimpleMarker(t),c=(0,o.eR)(h)):t.cim&&"CIMHatchFill"===t.cim.type?(h=r.wp.fromCIMHatchFill(t.cim,e),l=new a.A(h.frame.xmin,-h.frame.ymax,h.frame.xmax-h.frame.xmin,h.frame.ymax-h.frame.ymin),u=e):t.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===t.cim.markerPlacement.type?(h=r.wp.fromCIMInsidePolygon(t.cim),l=new a.A(h.frame.xmin,-h.frame.ymax,h.frame.xmax-h.frame.xmin,h.frame.ymax-h.frame.ymin)):(h=t.cim,t.avoidSDFRasterization||(c=(0,o.eR)(h))),c&&!i){const[t,e,i]=(0,o.ce)(c);return t?{size:[e,i],image:new Uint32Array(t.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:u}:null}const[m,d,g,f,p]=r.wp.rasterize(this._rasterizationCanvas,h,l,this._resourceManager,!i);return m?{size:[d,g],image:new Uint32Array(m.buffer),sdf:!1,simplePattern:!1,anchorX:f,anchorY:p}:null}rasterizeImageResource(t,e,i,s){this._rasterizationCanvas.width=t,this._rasterizationCanvas.height=e;const r=this._rasterizationCanvas.getContext("2d");i instanceof ImageData?r.putImageData(i,0,0):(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`),r.drawImage(i,0,0,t,e));const n=r.getImageData(0,0,t,e),a=new Uint8Array(n.data);if(s)for(const h of s)if(h&&h.oldColor&&4===h.oldColor.length&&h.newColor&&4===h.newColor.length){const[t,e,i,s]=h.oldColor,[r,n,o,l]=h.newColor;if(t===r&&e===n&&i===o&&s===l)continue;for(let h=0;h<a.length;h+=4)t===a[h]&&e===a[h+1]&&i===a[h+2]&&s===a[h+3]&&(a[h]=r,a[h+1]=n,a[h+2]=o,a[h+3]=l)}let o;for(let h=0;h<a.length;h+=4)o=a[h+3]/255,a[h]=a[h]*o,a[h+1]=a[h+1]*o,a[h+2]=a[h+2]*o;let l=a,c=t,u=e;const m=512;if(c>=m||u>=m){const i=c/u;i>1?(c=m,u=Math.round(m/i)):(u=m,c=Math.round(m*i)),l=new Uint8Array(4*c*u);const s=new Uint8ClampedArray(l.buffer);(0,h.Go)(a,t,e,s,c,u,!1)}return{size:[c,u],image:new Uint32Array(l.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}},79126:(t,e,i)=>{i.d(e,{k:()=>o,r:()=>a});var s=i(51859),r=i(92504);const n=t=>"vertical"===t||"horizontal"===t||"cross"===t||"esriSFSCross"===t||"esriSFSVertical"===t||"esriSFSHorizontal"===t;function a(t,e,i){const s=(0,r.yR)(Math.ceil(i)),a=n(e)?8*s:16*s,o=2*s;t.width=a,t.height=a;const h=t.getContext("2d");h.strokeStyle="#FFFFFF",h.lineWidth=s,h.beginPath(),"vertical"!==e&&"cross"!==e&&"esriSFSCross"!==e&&"esriSFSVertical"!==e||(h.moveTo(a/2,-o),h.lineTo(a/2,a+o)),"horizontal"!==e&&"cross"!==e&&"esriSFSCross"!==e&&"esriSFSHorizontal"!==e||(h.moveTo(-o,a/2),h.lineTo(a+o,a/2)),"forward-diagonal"!==e&&"diagonal-cross"!==e&&"esriSFSDiagonalCross"!==e&&"esriSFSForwardDiagonal"!==e||(h.moveTo(-o,-o),h.lineTo(a+o,a+o),h.moveTo(a-o,-o),h.lineTo(a+o,o),h.moveTo(-o,a-o),h.lineTo(o,a+o)),"backward-diagonal"!==e&&"diagonal-cross"!==e&&"esriSFSBackwardDiagonal"!==e&&"esriSFSDiagonalCross"!==e||(h.moveTo(a+o,-o),h.lineTo(-o,a+o),h.moveTo(o,-o),h.lineTo(-o,o),h.moveTo(a+o,a-o),h.lineTo(a-o,a+o)),h.stroke();const l=h.getImageData(0,0,t.width,t.height),c=new Uint8Array(l.data);let u;for(let r=0;r<c.length;r+=4)u=c[r+3]/255,c[r]=c[r]*u,c[r+1]=c[r+1]*u,c[r+2]=c[r+2]*u;return[c,t.width,t.height]}function o(t,e){const i="Butt"===e,r="Square"===e,n=!i&&!r;t.length%2==1&&(t=[...t,...t]);const a=15.5;let o=0;for(const s of t)o+=s;const h=Math.round(o*a),l=new Float32Array(31*h),c=7.75;let u=0,m=0,d=.5,g=!0;for(const s of t){for(u=m,m+=s*a;d<=m;){let t=.5;for(;t<31;){const e=(t-.5)*h+d-.5,s=n?(t-a)*(t-a):Math.abs(t-a);l[e]=g?i?Math.max(Math.max(u+c-d,s),Math.max(d-m+c,s)):s:n?Math.min((d-u)*(d-u)+s,(d-m)*(d-m)+s):r?Math.min(Math.max(d-u,s),Math.max(m-d,s)):Math.min(Math.max(d-u+c,s),Math.max(m+c-d,s)),t++}d++}g=!g}const f=l.length,p=new Uint8Array(4*f);for(let y=0;y<f;++y){const t=(n?Math.sqrt(l[y]):l[y])/a;(0,s.U)(t,p,4*y)}return[p,h,31]}},75886:(t,e,i)=>{i.d(e,{previewCIMSymbol:()=>f});var s=i(89882),r=i(48002),n=i(79851),a=i(50072),o=i(88148),h=i(73532);const l=new n.CIMSymbolRasterizer(null,!0),c=(0,s.PN)(o.CB.size),u=(0,s.PN)(o.CB.maxSize),m=(0,s.PN)(o.CB.lineWidth),d=1;async function g(t,e,i){const s=e?.size;let n=null!=s&&"object"==typeof s&&"width"in s?s.width:s,a=null!=s&&"object"==typeof s&&"height"in s?s.height:s;if(null==n||null==a)if("esriGeometryPolygon"===i)n=c,a=c;else{const s=await async function(t,e,i){const{feature:s,fieldMap:n,viewParams:a}=e.cimOptions||e,o=await r.$N.resolveSymbolOverrides(t.data,s,null,n,i,null,a);if(!o)return null;(t=t.clone()).data={type:"CIMSymbolReference",symbol:o},t.data.primitiveOverrides=void 0;const h=[];return r.wp.fetchResources(o,l.resourceManager,h),r.wp.fetchFonts(o,l.resourceManager,h),h.length>0&&await Promise.all(h),r.wp.getEnvelope(o,null,l.resourceManager)}(t,e,i);s&&(n=s.width,a=s.height),"esriGeometryPolyline"===i&&(n=m),n=null!=n&&isFinite(n)?Math.min(n,u):c,a=null!=a&&isFinite(a)?Math.max(Math.min(a,u),d):c}return"legend"===e.style&&"esriGeometryPolyline"===i&&(n=m),{width:n,height:a}}async function f(t,e={}){const{node:i,opacity:r,symbolConfig:n}=e,o=null!=n&&"object"==typeof n&&"isSquareFill"in n&&n.isSquareFill,c=e.cimOptions||e,u=c.geometryType||(0,a.n5)(t?.data?.symbol),m=await g(t,e,u),{feature:d,fieldMap:f}=c,p=o||"esriGeometryPolygon"!==u?"preview":"legend",y=await l.rasterizeCIMSymbolAsync(t,d,m,p,f,u,null,c.viewParams,c.allowScalingUp);if(!y)return null;const{width:_,height:x}=y,w=document.createElement("canvas");w.width=_,w.height=x,w.getContext("2d").putImageData(y,0,0);const P=(0,s.Lz)(m.width),z=(0,s.Lz)(m.height),M=new Image(P,z);M.src=w.toDataURL(),M.ariaLabel=e.ariaLabel??null,M.alt=e.ariaLabel??"",null!=r&&(M.style.opacity=`${r}`);let I=M;if(null!=e.effectView){const t={shape:{type:"image",x:0,y:0,width:P,height:z,src:M.src},fill:null,stroke:null,offset:[0,0]};I=(0,h.fz)([[t]],[P,z],{effectView:e.effectView,ariaLabel:e.ariaLabel})}return i&&I&&i.appendChild(I),I}},29986:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(98849),r=i(539),n=i(20698);function a(t,e,i,s,n){if(null==t)return null;const a=t.referencesGeometry()&&n?h(e,s,n):e,o=t.repurposeFeature(a);try{return t.evaluate({...i,$feature:o},t.services)}catch(l){return r.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",l),null}}const o=new Map;function h(t,e,i){const{transform:a,hasZ:h,hasM:l}=i;o.has(e)||o.set(e,function(t){const e={};switch(t){case"esriGeometryPoint":return(t,i,s,r)=>(0,n.Tr)(i,e,t,s,r);case"esriGeometryPolygon":return(t,i,s,r)=>(0,n.$X)(i,e,t,s,r);case"esriGeometryPolyline":return(t,i,s,r)=>(0,n.P5)(i,e,t,s,r);case"esriGeometryMultipoint":return(t,i,s,r)=>(0,n.SW)(i,e,t,s,r);default:return r.A.getLogger("esri.views.2d.support.arcadeOnDemand").error(new s.A("mapview-arcade",`Unable to handle geometryType: ${t}`)),t=>t}}(e));const c=o.get(e)(t.geometry,a,h,l);return{...t,geometry:c}}}}]);