"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1549],{22126:(e,t,i)=>{i.d(t,{J:()=>g});i(17639);var o=i(25707),a=(i(30822),i(20464)),s=i(89882),r=i(58680),n=i(78286),l=i(22279),h=i(63643),c=i(1381),p=i(86548),d=i(78632),_=i(42238),u=i(54394),y=i(23369),m=i(40241);class g extends p.b{constructor(e){super(),this._graphicsLayer=e,this._symbolPairingsByType=new Map}visualizeIntersectionPoint(e,t){return this._visualizeSnappingIndicator(new d.A({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("intersectionPoint",t.view.effectiveTheme.accentColor))}visualizePoint(e,t){return this._visualizeSnappingIndicator(new d.A({x:e.point[0],y:e.point[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("point",t.view.effectiveTheme.accentColor))}visualizeLine(e,t){return this._visualizeSnappingIndicator(new _.A({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.spatialReference}),this._getOrCreateSymbol("line",t.view.effectiveTheme.accentColor))}visualizeParallelSign(e,t){return this._visualizeSnappingIndicator(new _.A({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.spatialReference}),this._getOrCreateSymbol("parallelSign",t.view.effectiveTheme.accentColor))}visualizeRightAngleQuad(e,t){const i=(0,n.a)(),o=(0,n.a)(),a=(0,l.c)();(0,r.c)(i,e.centerVertex,e.previousVertex),(0,r.c)(o,e.nextVertex,e.previousVertex),(0,r.f)(a,i,o);const s="rightAngleQuad"+(a[2]<0?45:225);return this._visualizeSnappingIndicator(new _.A({paths:[[e.previousVertex,e.centerVertex,e.nextVertex]],spatialReference:t.spatialReference}),this._getOrCreateSymbol(s,t.view.effectiveTheme.accentColor))}_visualizeSnappingIndicator(e,t){const i=new o.A({geometry:e,symbol:t});return this._graphicsLayer.add(i),(0,a.hA)((()=>{this._graphicsLayer.remove(i)}))}_getOrCreateSymbol(e,t){const i=this._symbolPairingsByType;return i.get(e)?.color!==t&&i.set(e,{color:t,symbol:v(e,t)}),i.get(e).symbol}}function v(e,t){const i=[...t.toRgb(),255*t.a];switch(e){case"point":return new y.A({outline:{width:.5,color:[0,0,0,1]},size:10,color:t});case"intersectionPoint":return new y.A({outline:new m.A({width:1.5,color:t}),size:15,color:[0,0,0,0]});case"line":return new u.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:h.uT.Butt,joinStyle:h.wd.Round,miterLimit:10,width:(0,s.PN)(c.N.lineHintWidthTarget),color:i}]}}});case"parallelSign":return new u.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}});case"rightAngleQuad45":case"rightAngleQuad225":{const o="rightAngleQuad45"===e?45:225;return new u.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:(0,s.PN)(c.N.rightAngleHintSize),rotation:o,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:(0,s.PN)(c.N.rightAngleHintOutlineSize),color:i},{type:"CIMSolidFill",enable:!0,color:[...t.toRgb(),255*t.a*.4]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})}}}},61549:(e,t,i)=>{i.r(t),i.d(t,{ControlPointsTransformTool:()=>X,DrawGraphicTool2D:()=>S,MediaTransformToolsWrapper:()=>xe,TransformTool:()=>Re});var o=i(66866),a=(i(17639),i(25707)),s=i(20464),r=i(6267),n=i(85251),l=i(21564),h=(i(73446),i(85569),i(39831),i(63863)),c=i(22126),p=(i(30822),i(54394)),d=i(23369);const _=new p.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),u=new d.A({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),y=new d.A({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var m=i(99439),g=i(96453),v=i(12019),f=i(78632),b=i(90067);let S=class extends m.Nt{constructor(e){super(e),this._visualElementGraphics={outline:null,regularVertices:null,activeVertex:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:e.activeLineSymbol??_,regularVertices:e.regularVerticesSymbol??u,activeVertex:e.activeVertexSymbol??y,fill:e.activeFillSymbol},e.activeVertexSymbol||this.addHandles((0,n.wB)((()=>this.view?.effectiveTheme?.accentColor),(e=>{if(!e)return;const t=this._visualElementSymbols.activeVertex.clone().set({color:e});this._visualElementGraphics.activeVertex?.set("symbol",t),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:t}}),n.Vh))}normalizeCtorArgs(e){const t={...e};return delete t.activeFillSymbol,delete t.activeVertexSymbol,delete t.regularVerticesSymbol,delete t.activeLineSymbol,t}initializeGraphic(e){return null!=this._visualElementSymbols.fill&&(e.symbol=this._visualElementSymbols.fill),(0,s.hA)()}makeDrawOperation(){const{defaultZ:e,hasZ:t,view:i}=this;return this._createOrUpdateGraphic(null),new g.O0({view:i,manipulators:this.manipulators,geometryType:(0,m.ld)(this.geometryType),drawingMode:this.mode,hasZ:t,defaultZ:e,snapToSceneEnabled:this.snapToScene,drawSurface:new v.uF(i,t,e),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new c.J(this.internalGraphicsLayer),tooltipOptions:this.tooltipOptions,graphic:this.graphic,cursor:this.cursor})}onActiveVertexChanged(e){if("point"===this.geometryType)return(0,s.hA)();const[t,i]=e,o=new f.A({x:t,y:i,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.activeVertex?(this._visualElementGraphics.activeVertex.geometry=o,(0,s.hA)()):(this._visualElementGraphics.activeVertex=new a.A({geometry:o,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(w),(0,s.hA)((()=>{null!=this._visualElementGraphics.activeVertex&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=(0,r.pR)(this._visualElementGraphics.activeVertex))})))}onOutlineChanged(e){const t=e.clone();if("polyline"===t.type){const e=t.paths[t.paths.length-1];e.splice(0,e.length-2)}return null!=this._visualElementGraphics.outline?(this._visualElementGraphics.outline.geometry=t,(0,s.hA)()):(this._visualElementGraphics.outline=new a.A({geometry:t,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.outline),this.internalGraphicsLayer.graphics.sort(w),(0,s.hA)((()=>{null!=this._visualElementGraphics.outline&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.outline),this._visualElementGraphics.outline=(0,r.pR)(this._visualElementGraphics.outline))})))}onRegularVerticesChanged(e){const t=new b.A({points:e,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.regularVertices?(this._visualElementGraphics.regularVertices.geometry=t,(0,s.hA)()):(this._visualElementGraphics.regularVertices=new a.A({geometry:t,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(w),(0,s.hA)((()=>{null!=this._visualElementGraphics.regularVertices&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=(0,r.pR)(this._visualElementGraphics.regularVertices))})))}};function w(e,t){return(e.attributes?.displayOrder??-1/0)-(t.attributes?.displayOrder??-1/0)}(0,o._)([(0,l.MZ)()],S.prototype,"activeFillSymbol",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],S.prototype,"type",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],S.prototype,"view",void 0),S=(0,o._)([(0,h.$)("esri.views.2d.interactive.draw.DrawGraphicTool2D")],S);var P,T=i(96220),M=i(97303),A=i(87926),G=i(31828),R=i(77573),E=i(10714);class k{get hovering(){return this.someManipulator((e=>e.hovering))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}}!function(e){e[e.TRANSLATE_XY=0]="TRANSLATE_XY",e[e.SCALE=1]="SCALE",e[e.ROTATE=2]="ROTATE"}(P||(P={}));var C=i(74321),x=i(285),L=i(35880),O=i(68928);class V extends k{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(e){e(this._manipulator,P.TRANSLATE_XY)}createDragPipeline(e,t){let i=null,o=null,a=0,s=0,r=0;const{offsetX:n,offsetY:l,size:h}=(0,O.T)(this._graphic.symbol);return(0,C.Xt)(this._manipulator,((c,p)=>{p.next((t=>{if("start"===t.action){const t=e();i=t.editGeometryOperations,o=t.constraints}return t})).next((0,C.y$)(this._view)).next((e=>{const{x:c,y:p,z:d}=e.mapEnd;if(o&&(c+n<o.xmin||p+l-h<o.ymin||c+n>o.xmax||p+l-h>o.ymax))return e;("start"===e.action||0===a&&0===s&&0===r)&&(a=e.mapStart.x,s=e.mapStart.y,r=e.mapStart.z);const _=c-a,u=p-s,y=d-r;a=c,s=p,r=d;const m=[];for(const t of i.data.components)m.push(...t.vertices);const g="start"===e.action?L.B.NEW_STEP:L.B.ACCUMULATE_STEPS,v=i.moveVertices(m,_,u,y,g);return t(e,v),e}))}))}_createManipulator(){const e=this._view,t=this._graphic;return new x.l({view:e,graphic:t,selectable:!0,cursor:"move"})}}var I=i(94377),H=i(37413),D=i(5470);const U="ArrowUp",z="ArrowDown",B="ArrowLeft",Z="ArrowRight",F="t",N="Shift",j=I.ie,W=new T.A("#009AF2");let X=class extends H.g{constructor(e){super(e),this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this._initialControlPoints=null,this._graphicsLayer=new G.A({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),this._undoStack=[],this._redoStack=[],this._sharedUndoStack=[],this._sharedRedoStack=[],this._highlightHandle=null,this.activeHandle=0}initialize(){this._initialize()}destroy(){const{map:e}=this.view;this._controlPointManipulations.forEach((e=>e.destroy())),this._controlPointEditGeometryOperations.forEach((e=>e.destroy())),e.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,r.pR)(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _hasValidSpatialReference(){return(0,A.fn)(this.view.spatialReference)}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){const e=this._undoStack[this._undoStack.length-1];return null!=e&&this._controlPointEditGeometryOperations[e].canUndo}canRedo(){const e=this._redoStack[this._redoStack.length-1];return null!=e&&this._controlPointEditGeometryOperations[e].canRedo}undo(){if(this._undoStack.length>0){const e=this._undoStack.pop();this._controlPointEditGeometryOperations[e].undo(),this.updateGraphics(),this._redoStack.push(e)}}redo(){if(this._redoStack.length>0){const e=this._redoStack.pop();this._controlPointEditGeometryOperations[e].redo(),this.updateGraphics(),this._undoStack.push(e)}}refresh(){const{mediaElement:e}=this;if(null==e.georeference)return;const t=e.georeference;"control-points"===t.type&&null!=t.coords&&(this._georeference=t,this._georeference.controlPoints.forEach((({mapPoint:e},t)=>{const i=this._controlPointEditGeometryOperations[t],o=i.data.components[0].vertices[0];i.setVertexPosition(o,i.data.coordinateHelper.pointToVector(e))})),this.updateGraphics())}reset(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const e=this._georeference,t=e.controlPoints,i=t[0].mapPoint.spatialReference,o=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map(((a,s)=>{const r=a.data.geometry;return this._controlPointGraphics[s].geometry=r,{mapPoint:(0,M.project)(r,i),sourcePoint:o?t[s].sourcePoint:e.toSource(r)}}))}updateActiveHandle(e){if(this.activeHandle===e)return;const t=this._controlPointGraphics[this.activeHandle].symbol.clone();(0,R.Fe)(t,this.view.effectiveTheme.accentColor),this._controlPointGraphics[this.activeHandle].symbol=t;const i=this._controlPointGraphics[e].symbol.clone();(0,R.Fe)(i,W),this._controlPointGraphics[e].symbol=i,this.activeHandle=e,this.view.surface===document.activeElement&&this.highlightActiveHandle()}async highlightActiveHandle(){this.removeHighlightActiveHandle();const e=await this.view.whenLayerView(this._graphicsLayer);this._highlightHandle=e.highlight(this._controlPointGraphics[this.activeHandle])}removeHighlightActiveHandle(){this._highlightHandle&&this._highlightHandle.remove()}setSharedUndoStack(e){this._sharedUndoStack=e}setSharedRedoStack(e){this._sharedRedoStack=e}async _initialize(){const{view:e,mediaElement:t}=this;if(null==t.georeference)return;const i=t.georeference;"control-points"===i.type&&null!=i.coords&&(this._georeference=i,this._initialControlPoints=this._georeference.controlPoints,e.map.addMany([this._graphicsLayer]),e.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._controlPointEditGeometryOperations=this._georeference.controlPoints.map((({mapPoint:t})=>D.p.fromGeometry((0,M.project)(t,e.spatialReference),E.RT.Local))),this._controlPointGraphics=this._controlPointEditGeometryOperations.map(((e,t)=>new a.A({symbol:new p.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t===this.activeHandle?W.toArray():this.view.effectiveTheme.accentColor.toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:e.data.geometry}))),this._graphicsLayer.graphics.addMany([...this._controlPointGraphics]),this._controlPointManipulations=this._controlPointGraphics.map((t=>new V({tool:this,view:e,graphic:t}))),this.addHandles([...this._controlPointManipulations.map(((e,t)=>e.createDragPipeline(this._getInfo.bind(this,t),((e,i)=>{"start"===e.action&&(this._undoStack.push(t),this._redoStack=[],this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0),this.updateGraphics()})))),(0,n.wB)((()=>this.view.scale),(()=>this.active?this.updateGraphics():null))]),this._controlPointManipulations.forEach(((e,t)=>{e.forEachManipulator((e=>{this.addHandles([e.events.on(["click","grab-changed"],(e=>this.updateActiveHandle(t)))])}))})),this.addHandles([e.on("key-down",(i=>{e.activeTool===this&&(i.key!==N||i.repeat||(this._isModifierActive=!0,i.stopPropagation()),i.key!==F||i.repeat||(t.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled,i.stopPropagation()),i.key!==j||i.repeat||(this._factor=10,i.stopPropagation()),this._isModifierActive&&(i.key===U&&(this._move(0,this._factor),i.stopPropagation()),i.key===z&&(this._move(0,-this._factor),i.stopPropagation()),i.key===B&&(this._move(-this._factor,0),i.stopPropagation()),i.key===Z&&(this._move(this._factor,0),i.stopPropagation())))})),e.on("key-up",(t=>{e.activeTool===this&&(t.key===N&&(this._isModifierActive=!1,t.stopPropagation()),t.key===j&&(this._factor=1,t.stopPropagation()))}))]))}async _loadProjectionEngine(){const e=this._georeference.controlPoints[0].mapPoint;return(0,M.initializeProjection)(e.spatialReference,this.view.spatialReference)}_getInfo(e){return{editGeometryOperations:this._controlPointEditGeometryOperations[e],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}_move(e,t){const i=this._controlPointEditGeometryOperations[this.activeHandle],o=[];for(const s of i.data.components)o.push(...s.vertices);const a=i.moveVertices(o,e*this.view.resolution,t*this.view.resolution,0,L.B.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:a}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,o._)([(0,l.MZ)()],X.prototype,"_hasValidSpatialReference",null),(0,o._)([(0,l.MZ)()],X.prototype,"activeHandle",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],X.prototype,"mediaElement",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],X.prototype,"view",void 0),X=(0,o._)([(0,h.$)("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],X);var $=i(775),Y=i(92976),q=i(58680),J=i(78286),Q=i(21839),K=i(22279),ee=i(28769),te=i(1436),ie=i(92504);function oe(e,t){"start"===e.action?t.cursor="grabbing":t.cursor="grab"}class ae{constructor(){this._lastDragEvent=null,this.next=new C.rh,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent){const t={...this._lastDragEvent,action:"update"};e&&this._adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this._lastDragEvent=null,e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e)}_adjustScaleFactors(e){const t=0!==e.direction[0]&&0!==e.direction[1]?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}}class se{constructor(){this._lastDragEvent=null,this.next=new C.rh,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent){const t={...this._lastDragEvent,action:"update"};e&&this._adjustRotateAngle(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this._lastDragEvent=null,e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustRotateAngle(e),e)}_adjustRotateAngle(e){const t=(0,ie.KJ)(e.rotateAngle);e.rotateAngle=(0,ie.kU)(5*Math.round(t/5))}}var re=i(18578),ne=i(63387),le=i(3183);class he extends k{constructor(e){super(),this._handles=new te.A,this._originCache=(0,K.c)(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._snapRotation=e.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(e=>oe(e,this._manipulator)))]),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(e){e(this._manipulator,P.ROTATE)}createDragPipeline(e,t){let i=null,o=null;return(0,C.Xt)(this._manipulator,((a,s)=>{s.next((t=>{if("start"===t.action){a.cursor="grabbing";const t=e();i=t.plane,o=t.editGeometryOperations}return t})).next((0,C.y$)(this._view)).next((e=>({...e,rotateAngle:(0,re.UT)(e.mapStart,e.mapEnd,{x:i.origin[0],y:i.origin[1]},!0)}))).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next((e=>{const a=(0,Q.c)(this._originCache,i.origin),s=[];for(const t of o.data.components)s.push(...t.vertices);const r="start"===e.action?L.B.NEW_STEP:L.B.ACCUMULATE_STEPS,n=o.rotateVertices(s,a,e.rotateAngle,r,ne.K.REPLACE);return(0,le.Bb)(n,i),t(e,n),e})).next((e=>("end"===e.action&&(a.cursor="grab"),e)))}))}_createManipulator(){const e=this._view,t=this._graphic;return new x.l({view:e,graphic:t,selectable:!0,cursor:"grab"})}}const ce=1e-6;function pe(e){const t=(0,Q.l)(e.basis1),i=(0,Q.l)(e.basis2);return.3*Math.min(t,i)}class de extends k{constructor(e){super(),this._handles=new te.A,this._planeStart=(0,ee.a)(),this._displayPlaneStart=(0,ee.a)(),this._originCache=(0,K.c)(),this._axisCache=(0,J.a)(),this._renderStartCache=(0,K.c)(),this._renderEndCache=(0,K.c)(),this._resizeOriginCache=(0,K.c)(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._direction=e.direction,this._preserveAspectRatio=e.preserveAspectRatio,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(e=>oe(e,this._manipulator)))]),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}forEachManipulator(e){e(this._manipulator,P.SCALE)}createDragPipeline(e,t){let i=null,o=null,a=null,s=0,r=null,n=null;const l=this._planeStart,h=this._displayPlaneStart,c=this._direction;return(0,C.Xt)(this._manipulator,((p,d)=>{d.next((t=>{if("start"===t.action){p.cursor="grabbing";const t=e();i=t.plane,o=t.displayPlane,a=t.editGeometryOperations,s=10*this._view.resolution,(0,ee.c)(i,l),(0,ee.c)(o,h);const n=(0,A.Vp)(a.data.spatialReference);r=n?n.valid[1]-n.valid[0]-30*this._view.resolution:null}return t})).next((0,C.y$)(this._view)).next((e=>{const t=(0,Q.c)(this._renderStartCache,[e.mapStart.x,e.mapStart.y,0]),i=(0,Q.c)(this._renderEndCache,[e.mapEnd.x,e.mapEnd.y,0]),a=(0,Q.c)(this._resizeOriginCache,h.origin);(0,Q.q)(a,a,h.basis1,-c[0]),(0,Q.q)(a,a,h.basis2,-c[1]),(0,Q.f)(i,i,a),(0,Q.f)(t,t,a);const r=0!==c[0]&&0!==c[1],n=pe(h),l=pe(o)/n,p=(e,o)=>{if(0===e)return 1;let a=(0,Q.l)(o),n=.5*e*(0,Q.j)(o,i)/a;const h=n<0?-1:1;r&&(n+=(a-.5*e*(0,Q.j)(o,t)/a)*h*l);const c=a<1.5*s?1:ce;return a=Math.max(a-s,ce),h>0&&(n-=10*this._view.resolution),h*Math.max(h*(n/a),c)},d=p(c[0],h.basis1),_=p(c[1],h.basis2);return{...e,direction:c,factor1:d,factor2:_}})).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next((e=>{const o=(0,Q.c)(this._originCache,l.origin);(0,Q.q)(o,o,l.basis1,-c[0]),(0,Q.q)(o,o,l.basis2,-c[1]);const s=(0,q.s)(this._axisCache,l.basis1[0],l.basis1[1]);(0,q.e)(s,s);const h=[];for(const t of a.data.components)h.push(...t.vertices);const p="start"===e.action?L.B.NEW_STEP:L.B.ACCUMULATE_STEPS,d=a.scaleVertices(h,o,s,e.factor1,e.factor2,p,ne.K.REPLACE);return r&&r<a.data.geometry.extent.width&&n?a.updateVertices(h,n):((0,ee.c)(l,i),(0,le.Bb)(d,i),n=d.operation,t(e,d)),e})).next((e=>("end"===e.action&&(p.cursor="grab"),e)))}))}_createManipulator(){return new x.l({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}var _e=i(4057),ue=i(87438),ye=i(30687),me=i(62802),ge=i(68882);const ve="ArrowUp",fe="ArrowDown",be="ArrowLeft",Se="ArrowRight",we="+",Pe="-",Te="t",Me="Shift",Ae=I.ie,Ge=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]];let Re=class extends H.g{constructor(e){super(e),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._planeCache=(0,ee.a)(),this._displayPlaneCache=(0,ee.a)(),this._mainAxisCache=(0,J.a)(),this._rotationHandleCache=(0,K.c)(),this._cornerA=(0,K.c)(),this._cornerB=(0,K.c)(),this._cornerC=(0,K.c)(),this._cornerD=(0,K.c)(),this._avgAB=(0,K.c)(),this._avgBC=(0,K.c)(),this._avgCD=(0,K.c)(),this._avgDA=(0,K.c)(),this._preserveAspectRatio=new ae,this._snapRotation=new se,this._graphicsLayer=new G.A({internal:!0,listMode:"hide",visible:!1}),this._sharedUndoStack=[],this._sharedRedoStack=[],this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this.preserveAspectRatio=null,this.snapRotation=null}initialize(){this._initialize()}destroy(){const{map:e}=this.view;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach((e=>e.destroy())),this._editGeometryOperations.destroy(),e.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,r.pR)(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _plane(){const e=this._graphic.geometry;if(null==e)return null;const t=this._editGeometryOperations.data,i=t.components[0].edges[0],o=(0,q.c)(this._mainAxisCache,i.leftVertex.pos,i.rightVertex.pos);(0,q.e)(o,o);let a=80*this.view.resolution;const s=this.view.spatialReference;return(0,A.aI)(s,e.spatialReference)&&(a*=(0,Y.GA)(s)/(0,Y.GA)(e.spatialReference)),(0,le.G3)(o,t,a,this._planeCache)}get _displayPlane(){const e=this._plane;if(!e)return null;const t=this._displayPlaneCache;(0,ee.c)(e,t);const i=10*this.view.resolution;return(0,Q.i)(t.basis1,t.basis1,1+i/(0,Q.l)(t.basis1)),(0,Q.i)(t.basis2,t.basis2,1+i/(0,Q.l)(t.basis2)),t}get _backgroundGraphicGeometry(){const e=this._displayPlane;if(!e)return null;const t=this.view.spatialReference;return this._updateDisplayPlaneConrers(e),new me.A({spatialReference:t,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}get _rotateGraphicGeometry(){const e=this._plane;if(!e)return null;const t=this._rotationHandleCache;return(0,Q.n)(t,e.basis1),(0,Q.i)(t,t,30*this.view.resolution),(0,Q.g)(t,t,e.origin),(0,Q.g)(t,t,e.basis1),new f.A({x:t[0],y:t[1],spatialReference:this.view.spatialReference})}get _scaleGraphicGeometries(){const e=this._displayPlane;if(!e)return[];const t=this.view.spatialReference;this._updateDisplayPlaneConrers(e);const{_cornerA:i,_cornerB:o,_cornerC:a,_cornerD:s}=this,r=(0,Q.p)(this._avgAB,i,o,.5),n=(0,Q.p)(this._avgBC,o,a,.5),l=(0,Q.p)(this._avgCD,a,s,.5),h=(0,Q.p)(this._avgDA,s,i,.5);return[new f.A({x:i[0],y:i[1],spatialReference:t}),new f.A({x:o[0],y:o[1],spatialReference:t}),new f.A({x:a[0],y:a[1],spatialReference:t}),new f.A({x:s[0],y:s[1],spatialReference:t}),new f.A({x:r[0],y:r[1],spatialReference:t}),new f.A({x:n[0],y:n[1],spatialReference:t}),new f.A({x:l[0],y:l[1],spatialReference:t}),new f.A({x:h[0],y:h[1],spatialReference:t})]}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this._editGeometryOperations.undo(),this.updateGraphics()}redo(){this._editGeometryOperations.redo(),this.updateGraphics()}refresh(){const{view:e,target:t}=this,i="georeference"in t?t.georeference.coords:t.geometry,o=this._editGeometryOperations,a=o.data.components[0].vertices,s=_e.ZE.fromGeometry((0,M.project)(i,e.spatialReference),E.RT.Local).components[0].vertices;a.forEach(((e,t)=>{o.setVertexPosition(e,s[t].pos)})),this.updateGraphics()}reset(){const{target:e}=this;if("georeference"in e){const t=e.georeference;"control-points"===t.type&&(t.controlPoints=this._initialControlPoints)}else e.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const e=this._editGeometryOperations.data.geometry;"georeference"in this.target&&(this.target.georeference.coords=e),this._graphic.geometry=e,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach(((e,t)=>{this._scaleGraphics[t].geometry=e}))}setSharedUndoStack(e){this._sharedUndoStack=e}setSharedRedoStack(e){this._sharedRedoStack=e}async _initialize(){const{view:e,target:t}=this;if("georeference"in t){const e=t.georeference;this._graphic=new a.A({geometry:e.coords}),this._initialControlPoints="control-points"===e.type?e.controlPoints:null}else this._graphic=t,this._initialGeometry=t.geometry;e.map.addMany([this._graphicsLayer]),e.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._editGeometryOperations=D.p.fromGeometry((0,M.project)(this._graphic.geometry,e.spatialReference),E.RT.Local),this._backgroundGraphic=new a.A({symbol:new ge.A({color:"transparent",outline:{type:"simple-line",color:e.effectiveTheme.accentColor,width:2}}),geometry:this._backgroundGraphicGeometry}),this._rotateGraphic=new a.A({symbol:new d.A({color:(0,$.bJ)(e.effectiveTheme.accentColor),outline:{type:"simple-line",color:e.effectiveTheme.accentColor,width:1}}),geometry:this._rotateGraphicGeometry}),this._scaleGraphics=this._scaleGraphicGeometries.map((t=>new a.A({symbol:new d.A({size:6,style:"square",color:(0,$.bJ)(e.effectiveTheme.accentColor),outline:{type:"simple-line",color:e.effectiveTheme.accentColor,width:1}}),geometry:t}))),this._graphicsLayer.graphics.addMany([this._backgroundGraphic,this._rotateGraphic,...this._scaleGraphics]),this._dragManipulation=new V({tool:this,view:e,graphic:this._graphic}),this._rotateManipulation=new he({tool:this,view:e,graphic:this._rotateGraphic,snapRotation:this._snapRotation}),this._scaleManipulations=this._scaleGraphics.map(((t,i)=>new de({tool:this,view:e,graphic:t,direction:Ge[i],preserveAspectRatio:this._preserveAspectRatio}))),this.addHandles([this._dragManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),this._rotateManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),...this._scaleManipulations.map((e=>e.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)))),(0,n.wB)((()=>this.view.scale),(()=>this.active?this.updateGraphics():null)),e.on("click",(async i=>{if(null!=e.activeTool&&e.activeTool!==this)return;const o=(0,ye.ZV)(i),a=[];e.map.allLayers.forEach((e=>{"vector-tile"!==e.type&&"imagery"!==e.type||a.push(e)}));const s=await this.view.hitTest(o,{exclude:a}),r=s.results;if(0===r.length)e.activeTool=null;else{const i=(0,ue.zF)(s.results),o="georeference"in t,a=r.map((e=>"media"===e.type?e.element:null)).filter(Boolean),n=new Set([...this._graphicsLayer.graphics,o?null:t].filter(Boolean));o&&a.includes(t)||null!=i&&n.has(i.graphic)?null==e.activeTool&&(e.activeTool=this):e.activeTool=null}}))]);const i=e=>{this.addHandles(e.events.on("grab-changed",(e=>{"georeference"in t&&("start"===e.action?t.opacity*=.5:"end"===e.action&&(t.opacity*=2))})))};this._dragManipulation.forEachManipulator(i),this._rotateManipulation.forEachManipulator(i),this._scaleManipulations.forEach((e=>e.forEachManipulator(i))),this.addHandles([e.on("key-down",(i=>{e.activeTool===this&&(i.key!==Me||i.repeat||(null==this.preserveAspectRatio&&(this._preserveAspectRatio.enabled=!this._preserveAspectRatio.enabled),null==this.snapRotation&&(this._snapRotation.enabled=!this._snapRotation.enabled),this._isModifierActive=!0,i.stopPropagation()),i.key!==Te||i.repeat||("georeference"in t&&(t.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled),i.stopPropagation()),i.key!==Ae||i.repeat||(this._factor=10,i.stopPropagation()),this._isModifierActive&&(i.key===we&&(this._scale(this._factor),i.stopPropagation()),i.key===Pe&&(this._scale(-this._factor),i.stopPropagation()),i.key===ve&&(this._move(0,this._factor),i.stopPropagation()),i.key===fe&&(this._move(0,-this._factor),i.stopPropagation()),i.key===be&&(this._move(-this._factor,0),i.stopPropagation()),i.key===Se&&(this._move(this._factor,0),i.stopPropagation())))})),e.on("key-up",(t=>{e.activeTool===this&&(t.key===Me&&(null==this.preserveAspectRatio&&(this._preserveAspectRatio.enabled=!this._preserveAspectRatio.enabled),null==this.snapRotation&&(this._snapRotation.enabled=!this._snapRotation.enabled),this._isModifierActive=!1,t.stopPropagation()),t.key===Ae&&(this._factor=1,t.stopPropagation()))}))])}async _loadProjectionEngine(){const e=this._graphic.geometry;return(0,M.initializeProjection)(e.spatialReference,this.view.spatialReference)}_updateDisplayPlaneConrers(e){const{basis1:t,basis2:i,origin:o}=e,a=this._cornerA;(0,Q.g)(a,o,t),(0,Q.g)(a,a,i);const s=this._cornerB;(0,Q.g)(s,o,t),(0,Q.f)(s,s,i);const r=this._cornerC;(0,Q.f)(r,o,t),(0,Q.f)(r,r,i);const n=this._cornerD;(0,Q.f)(n,o,t),(0,Q.g)(n,n,i)}_getInfo(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}_updateGraphics(e,t){"start"===e.action&&(this._sharedUndoStack.push({tool:this,operation:t}),this._sharedRedoStack.length=0),this.updateGraphics()}_scale(e){const t=this._editGeometryOperations,i=[];for(const r of t.data.components)i.push(...r.vertices);const o=t.data.geometry.extent?.width,a=(o+e*this.view.resolution)/o,s=t.scaleVertices(i,this._plane.origin,J.U,a,a,L.B.NEW_STEP,ne.K.REPLACE);this._sharedUndoStack.push({tool:this,operation:s}),this._sharedRedoStack.length=0,this.updateGraphics()}_move(e,t){const i=this._editGeometryOperations,o=[];for(const s of i.data.components)o.push(...s.vertices);const a=i.moveVertices(o,e*this.view.resolution,t*this.view.resolution,0,L.B.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:a}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,o._)([(0,l.MZ)()],Re.prototype,"_plane",null),(0,o._)([(0,l.MZ)()],Re.prototype,"_backgroundGraphicGeometry",null),(0,o._)([(0,l.MZ)()],Re.prototype,"_rotateGraphicGeometry",null),(0,o._)([(0,l.MZ)()],Re.prototype,"_scaleGraphicGeometries",null),(0,o._)([(0,l.MZ)()],Re.prototype,"preserveAspectRatio",void 0),(0,o._)([(0,l.MZ)()],Re.prototype,"snapRotation",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Re.prototype,"target",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],Re.prototype,"view",void 0),Re=(0,o._)([(0,h.$)("esri.views.2d.interactive.editingTools.TransformTool")],Re);var Ee=i(52495);const ke="r",Ce="z";let xe=class extends Ee.A{constructor(e){super(e),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=[],this._sharedRedoStack=[],this._originalOpacity=null,this.activeHandle=0}initialize(){const{view:e,mediaElement:t,preserveAspectRatio:i,snapRotation:o,advancedMode:a}=this;this._originalOpacity=t.opacity,this._transformTool=new Re({target:t,view:e,preserveAspectRatio:i,snapRotation:o}),this._controlPointsTransformTool=new X({mediaElement:t,view:e}),this._advancedModeTransformTool=new X({mediaElement:a.mediaElement,view:a.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const s=t.georeference,r=a.mediaElement.georeference;a.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in r&&"controlPoints"in s&&this.addHandles([a.view.on("key-down",(e=>{e.key===Ce&&this.canUndo()&&(this.undo(),e.stopPropagation()),e.key===ke&&this.canRedo()&&(this.redo(),e.stopPropagation())})),a.view.on("focus",(async e=>{this._controlPointsTransformTool.removeHighlightActiveHandle(),this._advancedModeTransformTool.highlightActiveHandle()})),(0,n.wB)((()=>r.controlPoints),(e=>{s.controlPoints=e.map((({sourcePoint:e},t)=>({sourcePoint:e,mapPoint:s.controlPoints[t].mapPoint}))),this._activeTool?.refresh()})),(0,n.wB)((()=>this._controlPointsTransformTool.activeHandle),(e=>{this._advancedModeTransformTool.updateActiveHandle(e),this.activeHandle=e})),(0,n.wB)((()=>this._advancedModeTransformTool.activeHandle),(e=>{this._controlPointsTransformTool.updateActiveHandle(e),this.activeHandle=e}))]),this.addHandles([e.on("key-down",(e=>{e.key===Ce&&this.canUndo()&&(this.undo(),e.stopPropagation()),e.key===ke&&this.canRedo()&&(this.redo(),e.stopPropagation())})),e.on("focus",(async e=>{this._advancedModeTransformTool.removeHighlightActiveHandle(),this._controlPointsTransformTool.highlightActiveHandle()}))]),e.tools.addMany([this._transformTool,this._controlPointsTransformTool]),e.activeTool=this._transformTool,this._activeTool=this._transformTool,e.focus()}destroy(){this._transformTool?.destroy(),this._controlPointsTransformTool?.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}canUndo(){return this._sharedUndoStack.length>0}canRedo(){return this._sharedRedoStack.length>0}undo(){if(this._sharedUndoStack.length>0){const{tool:e,operation:t}=this._sharedUndoStack.pop();e!==this._activeTool&&e.refresh(),t.undo(),e.updateGraphics(),this._sharedRedoStack.push({tool:e,operation:t}),this._activeTool!==e&&this._activeTool?.refresh()}}redo(){if(this._sharedRedoStack.length>0){const{tool:e,operation:t}=this._sharedRedoStack.pop();e!==this._activeTool&&e.refresh(),t.apply(),e.updateGraphics(),this._sharedUndoStack.push({tool:e,operation:t}),this._activeTool!==e&&this._activeTool?.refresh()}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}async enableAdvancedMode(){this.view.activeTool=this._controlPointsTransformTool,this._activeTool=this._controlPointsTransformTool,this._activeTool.refresh(),await this.advancedMode.view.when(),this.advancedMode.view.activeTool=this._advancedModeTransformTool,this._originalOpacity=this._controlPointsTransformTool.mediaElement.opacity,this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity}disableAdvancedMode(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};(0,o._)([(0,l.MZ)()],xe.prototype,"activeHandle",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],xe.prototype,"advancedMode",void 0),(0,o._)([(0,l.MZ)()],xe.prototype,"preserveAspectRatio",void 0),(0,o._)([(0,l.MZ)()],xe.prototype,"snapRotation",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],xe.prototype,"mediaElement",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],xe.prototype,"view",void 0),xe=(0,o._)([(0,h.$)("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],xe)}}]);