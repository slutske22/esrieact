"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6140],{27451:(e,t,r)=>{r.d(t,{$7:()=>x,B:()=>B,Fo:()=>k,M7:()=>S,NN:()=>p,Q5:()=>_,Tq:()=>Z,Up:()=>M,XF:()=>V,Ze:()=>v,bK:()=>s,bh:()=>h,id:()=>m,ky:()=>u,qt:()=>L,tW:()=>E,v9:()=>d,w7:()=>l,wF:()=>a,wS:()=>b,wz:()=>f,x:()=>y,xS:()=>w,ze:()=>c});var o=r(92976),n=r(97046);function i(e){return e?L:Z}function a(e,t){return t?.mode?t.mode:i(e).mode}function s(e,t){return null!=t?t:i(e)}function l(e,t){return a(null==e||(e.hasZ??!1),t)}function c(e,t){return s(null==e||(e.hasZ??!1),t)}function u(e){const t=g(e);return l(e.geometry,t)}function h(e){const t=g(e),r=l(e.geometry,t),o=null!=t&&"on-the-ground"!==r?S(t):0,n=t?.featureExpressionInfo;return{mode:r,offset:o,featureExpressionInfo:n}}function p(e){return f(h(e))}function d(e){return f(e)||y(e)}function y(e){return"0"===e?.featureExpressionInfo?.expression}function f(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function g(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function v(e,t){if(!e?.offset)return 0;const{offset:r,unit:n}=e;if("decimal-degrees"===n)return 0;const i="unknown"!==n&&n?n:"meters",a=(0,o.mq)(t);return a?(0,o.oU)(r,i,a):0}function m(e,t,r){if(!r?.mode)return;const o=e.hasZ?e.z:0,n=v(r,e.spatialReference);switch(r.mode){case"absolute-height":return o-n;case"on-the-ground":return 0;case"relative-to-ground":return o-((t.elevationProvider.getElevation(e.x,e.y,o,e.spatialReference,"ground")??0)+n);case"relative-to-scene":return o-((t.elevationProvider.getElevation(e.x,e.y,o,e.spatialReference,"scene")??0)+n)}}function b(e,t,r,o=null){return k(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,r,o)}function w(e,t,r,o,n=null){return k(e,t[0],t[1],t.length>2?t[2]:0,r,o,n)}function k(e,t,r,o,n,i,a=null){if(null==i)return;const s=null!=a?a.mode:"absolute-height";if("on-the-ground"===s)return 0;const{absoluteZ:l}=_(t,r,o,n,e,i);return function(e,t,r,o,n,i,a,s){const l=v(a,n);switch(s){case"absolute-height":return e-l;case"relative-to-ground":return e-((i.elevationProvider.getElevation(t,r,o,n,"ground")??0)+l);case"relative-to-scene":return e-((i.elevationProvider.getElevation(t,r,o,n,"scene")??0)+l)}}(l,t,r,o,n,e,a,s)}function _(e,t,r,o,n,i){const a=v(i,o);switch(i.mode){case"absolute-height":return{absoluteZ:r+a,elevation:0};case"on-the-ground":{const r=n.elevationProvider.getElevation(e,t,0,o,"ground")??0;return{absoluteZ:r,elevation:r}}case"relative-to-ground":{const i=n.elevationProvider.getElevation(e,t,r,o,"ground")??0;return{absoluteZ:r+i+a,elevation:i}}case"relative-to-scene":{const i=n.elevationProvider.getElevation(e,t,r,o,"scene")??0;return{absoluteZ:r+i+a,elevation:i}}}}function M(e,t){if(null==t)return!1;const{mode:r}=t;return null!=r&&("scene"===e&&"relative-to-scene"===r||"ground"===e&&"absolute-height"!==r)}function B(e,t,r){return r&&r.mode!==t?`${e} only support ${t} elevation mode`:null}function x(e,t,r){return r?.mode===t?`${e} do not support ${t} elevation mode`:null}function E(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null}function V(e,t){t&&e.warn(".elevationInfo=",t)}function S(e){return(e?.offset??0)*(0,n.Ao)(e?.unit)}const L={mode:"absolute-height",offset:0},Z={mode:"on-the-ground",offset:null}},96234:(e,t,r)=>{r.d(t,{RouteLayerInteraction:()=>w});var o=r(66866),n=r(52495),i=r(20464),a=r(6267),s=r(85251),l=r(21564),c=(r(39831),r(539),r(9272),r(63863)),u=r(4238),h=r(31828),p=r(79493),d=r(78397),y=r(57509),f=r(15704),g=r(10816);function v(e,t){e.networkFeature=t}function m(e){return e.networkFeature}function b(e){return"point"===e?.type||"polyline"===e?.type||"polygon"===e?.type}let w=class extends n.A{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new h.A({internal:!0,listMode:"hide",title:"Banana"}),this._updatingHandles=new u.U,this.enabled=!0,this._handleSketchViewModelEvents=async e=>{switch(e.type){case"update":switch(e.state){case"active":case"complete":for(const t of e.graphics)m(t).geometry=b(t.geometry)?t.geometry.clone():null}break;case"undo":case"redo":break;case"delete":for(const t of e.graphics){const e=m(t);this._removeNetworkFeature(e)}break;case"create":if(e.graphic&&"complete"===e.state&&this._createMode){const t=e.graphic.geometry?.clone(),r=e.graphic.symbol?.clone();if(!t)break;switch(this._createMode){case"stop":{if("point"!==t.type)break;const{stops:r}=this.layer;if(r.length>0&&r.every((({geometry:e})=>!e))){r.at(0).geometry=t;break}if(r.length>1&&r.filter(((e,t)=>0!==t)).every((({geometry:e})=>!e))){r.at(1).geometry=t;break}const o=new f.A({geometry:t});r.add(o),v(e.graphic,o);break}case"point-barrier":{if("point"!==t.type)break;const o=new p.A({geometry:t,symbol:r});this.layer.pointBarriers.add(o),v(e.graphic,o);break}case"polyline-barrier":{if("polyline"!==t.type)break;const o=new y.A({geometry:t,symbol:r});this.layer.polylineBarriers.add(o),v(e.graphic,o);break}case"polygon-barrier":{if("polygon"!==t.type)break;const o=new d.A({geometry:t,symbol:r});this.layer.polygonBarriers.add(o),v(e.graphic,o);break}}}}(await this.view.whenLayerView(this.layer)).emit(e.type,"create"===e.type?function(e){const t=m(e.graphic);return{...e,networkFeature:t}}(e):function(e){const t=e.graphics.map((e=>m(e)));return{...e,networkFeatures:t}}(e))}}initialize(){this._sketchViewModel=new g.A({layer:this._graphicsLayer,view:this.view}),this.addHandles([(0,s.wB)((()=>this.enabled),(e=>{e?this._activate():this._deactivate()}),s.Vh),(0,s.wB)((()=>{const{stops:e,pointBarriers:t,polylineBarriers:r,polygonBarriers:o}=this.layer;return{stops:e,pointBarriers:t,polylineBarriers:r,polygonBarriers:o}}),(()=>{this.enabled&&this._loadClonedGraphics()})),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),(0,i.DQ)(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,a.pR)(this._graphicsLayer),this._sketchViewModel=(0,a.pR)(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map((e=>m(e)))}get updating(){return this._updatingHandles.updating}create(e){switch(this._createMode=e,e){case"stop":this.layer.defaultSymbols.stops?.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(e){const t=this._graphicsLayer.graphics.find((t=>m(t)===e));t&&this._graphicsLayer.remove(t),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){this._sketchViewModel.cancel(),this.view.map?.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap((e=>e.toArray().map((e=>{const t=e.toGraphic();return t.networkFeature=e,t}))));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case"stop":this.layer.stops.remove(e);break;case"point-barrier":this.layer.pointBarriers.remove(e);break;case"polyline-barrier":this.layer.polylineBarriers.remove(e);break;case"polygon-barrier":this.layer.polygonBarriers.remove(e)}}};(0,o._)([(0,l.MZ)()],w.prototype,"enabled",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],w.prototype,"layer",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],w.prototype,"selectedNetworkFeatures",null),(0,o._)([(0,l.MZ)()],w.prototype,"updating",null),(0,o._)([(0,l.MZ)({constructOnly:!0})],w.prototype,"view",void 0),w=(0,o._)([(0,c.$)("esri.views.2d.layers.support.RouteLayerInteraction")],w)}}]);