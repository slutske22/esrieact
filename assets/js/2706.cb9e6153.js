"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2706],{62706:(e,t,i)=>{i.r(t),i.d(t,{default:()=>O});var r=i(66866),n=(i(30822),i(17306)),s=i(19251),o=i(85251),a=i(21564),l=(i(73446),i(63863)),h=i(31828),c=i(18578),u=i(91933),p=i(7407);class d{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-click"}}class f{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-double-click"}}class y{constructor(e,t,i,r,n,s,o,a,l,h){this.graphic=e,this.allGraphics=t,this.index=i,this.x=r,this.y=n,this.dx=s,this.dy=o,this.totalDx=a,this.totalDy=l,this.viewEvent=h,this.defaultPrevented=!1,this.type="graphic-move-start"}preventDefault(){this.defaultPrevented=!0}}class g{constructor(e,t,i,r,n,s,o,a,l,h){this.graphic=e,this.allGraphics=t,this.index=i,this.x=r,this.y=n,this.dx=s,this.dy=o,this.totalDx=a,this.totalDy=l,this.viewEvent=h,this.defaultPrevented=!1,this.type="graphic-move"}preventDefault(){this.defaultPrevented=!0}}class m{constructor(e,t,i,r,n,s,o,a,l,h){this.graphic=e,this.allGraphics=t,this.index=i,this.x=r,this.y=n,this.dx=s,this.dy=o,this.totalDx=a,this.totalDy=l,this.viewEvent=h,this.defaultPrevented=!1,this.type="graphic-move-stop"}preventDefault(){this.defaultPrevented=!0}}class v{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-over"}}class _{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-out"}}class w{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-down"}}class b{constructor(e,t,i,r,n){this.graphic=e,this.index=t,this.x=i,this.y=r,this.viewEvent=n,this.type="graphic-pointer-up"}}var G=i(54874),x=i(285),I=i(30687),k=i(23369),E=i(40241),M=i(68882);const T="indicator-symbols";let A=class extends n.A.EventedAccessor{constructor(e){super(e),this._activeGraphic=null,this._dragEvent=null,this._hoverGraphic=null,this._indicators=[],this._initialDragGeometry=null,this._manipulators=[],this._layerViews=null,this.type="graphic-mover",this.callbacks={onGraphicClick(){},onGraphicDoubleClick(){},onGraphicMoveStart(){},onGraphicMove(){},onGraphicMoveStop(){},onGraphicPointerOver(){},onGraphicPointerOut(){},onGraphicPointerDown(){},onGraphicPointerUp(){}},this.enableMoveAllGraphics=!1,this.graphics=[],this.indicatorsEnabled=!1,this.layer=new h.A({listMode:"hide",internal:!0,title:"GraphicMover highlight layer"}),this.view=null}initialize(){(0,p.Y)(this.view,this.layer),this._highlightHelper=new u.A({view:this.view}),this.refresh(),this.addHandles([(0,o.wB)((()=>this.graphics.length),(()=>this.refresh())),(0,o.z7)((()=>this.view?.ready),(()=>{this.addHandles([this.view.on("immediate-click",(e=>this._clickHandler(e)),G.o.TOOL),this.view.on("double-click",(e=>this._doubleClickHandler(e)),G.o.TOOL),this.view.on("pointer-down",(e=>this._pointerDownHandler(e)),G.o.TOOL),this.view.on("pointer-move",(e=>this._pointerMoveHandler(e)),G.o.TOOL),this.view.on("pointer-up",(e=>this._pointerUpHandler(e)),G.o.TOOL),this.view.on("drag",(e=>this._dragHandler(e)),G.o.TOOL),this.view.on("key-down",(e=>this._keyDownHandler(e)),G.o.TOOL)])}),{once:!0,initial:!0}),(0,o.wB)((()=>this.view),(e=>{this._highlightHelper.removeAll(),this._highlightHelper.view=e}))])}destroy(){this._removeIndicators(),this.view.map?.remove(this.layer),this.layer.destroy(),this.reset(),this._manipulators.forEach((e=>e.destroy())),this._manipulators=null}set highlightsEnabled(e){this._highlightHelper?.removeAll(),this._set("highlightsEnabled",e),e&&this._highlightHelper?.add(this.graphics)}get state(){const e=this.view.ready,t=this.graphics.length>0,i=this._activeGraphic;return e&&t?i?"moving":"active":e?"ready":"disabled"}refresh(){this.reset(),this._setup()}reset(){this._activeGraphic=null,this._hoverGraphic=null,this._dragEvent=null,this._highlightHelper.removeAll()}updateGeometry(e,t){const i=this.graphics[e];i&&(i.set("geometry",t),this._setUpIndicators())}_setup(){this._setUpHighlights(),this._setUpIndicators(),this._setUpManipulators(),this._syncLayerViews()}_clickHandler(e){const t=this._findTargetGraphic((0,I.ZV)(e));if(t){const i=new d(t,this.graphics.indexOf(t),e.x,e.y,e);this.emit("graphic-click",i),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(i)}}_doubleClickHandler(e){const t=this._findTargetGraphic((0,I.ZV)(e));if(t){const i=new f(t,this.graphics.indexOf(t),e.x,e.y,e);this.emit("graphic-double-click",i),this.callbacks.onGraphicDoubleClick&&this.callbacks.onGraphicDoubleClick(i)}}_pointerDownHandler(e){const t=this._findTargetGraphic((0,I.ZV)(e));if(t){this._activeGraphic=t;const{x:i,y:r}=e,n=new w(t,this.graphics.indexOf(t),i,r,e);this.emit("graphic-pointer-down",n),this.callbacks.onGraphicPointerDown&&this.callbacks.onGraphicPointerDown(n)}else this._activeGraphic=null}_pointerUpHandler(e){if(this._activeGraphic){const{x:t,y:i}=e,r=this.graphics.indexOf(this._activeGraphic),n=new b(this._activeGraphic,r,t,i,e);this.emit("graphic-pointer-up",n),this.callbacks.onGraphicPointerUp&&this.callbacks.onGraphicPointerUp(n)}}_pointerMoveHandler(e){if(this._dragEvent)return;const t=this._findTargetGraphic((0,I.ZV)(e));if(t){const{x:i,y:r}=e;if(this._hoverGraphic){if(this._hoverGraphic===t)return;const n=this.graphics.indexOf(this._hoverGraphic),s=new _(this.graphics[n],n,i,r,e);this._hoverGraphic=null,this.emit("graphic-pointer-out",s),this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(s)}const n=this.graphics.indexOf(t),s=new v(t,n,i,r,e);return this._hoverGraphic=t,this.emit("graphic-pointer-over",s),void(this.callbacks.onGraphicPointerOver&&this.callbacks.onGraphicPointerOver(s))}if(this._hoverGraphic){const{x:t,y:i}=e,r=this.graphics.indexOf(this._hoverGraphic),n=new _(this.graphics[r],r,t,i,e);this._hoverGraphic=null,this.emit("graphic-pointer-out",n),this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(n)}}_dragHandler(e){if("start"!==e.action&&!this._dragEvent||!this._activeGraphic?.geometry)return;"start"===e.action&&this._removeIndicators(),e.stopPropagation();const{action:t,x:i,y:r}=e,n=this.graphics.indexOf(this._activeGraphic),o=this._dragEvent?i-this._dragEvent.x:0,a=this._dragEvent?r-this._dragEvent.y:0,l=i-e.origin.x,h=r-e.origin.y,u="start"===t?this._activeGraphic.geometry:this._initialDragGeometry,p=(0,c.lR)(u,l,h,this.view);if(this._activeGraphic.geometry=p,this.enableMoveAllGraphics&&this.graphics.forEach((e=>{e!==this._activeGraphic&&(e.geometry=(0,c.lR)(e.geometry,o,a,this.view))})),this._dragEvent=e,"start"===t){this._initialDragGeometry=(0,s.o8)(u);const t=new y(this._activeGraphic,this.graphics,n,i,r,o,a,l,h,e);this.emit("graphic-move-start",t),this.callbacks.onGraphicMoveStart&&this.callbacks.onGraphicMoveStart(t),t.defaultPrevented&&this._activeGraphic.set("geometry",u)}else if("update"===t){const t=new g(this._activeGraphic,this.graphics,n,i,r,o,a,l,h,e);this.emit("graphic-move",t),this.callbacks.onGraphicMove&&this.callbacks.onGraphicMove(t),t.defaultPrevented&&(this._activeGraphic.geometry=u)}else{const t=new m(this._activeGraphic,this.graphics,n,i,r,o,a,l,h,e);this._dragEvent=null,this._activeGraphic=null,this._setUpIndicators(),this.emit("graphic-move-stop",t),this.callbacks.onGraphicMoveStop&&this.callbacks.onGraphicMoveStop(t),t.defaultPrevented&&(this.graphics[n].set("geometry",this._initialDragGeometry),this._setUpIndicators()),this._initialDragGeometry=null}}_keyDownHandler(e){"a"!==e.key&&"d"!==e.key&&"n"!==e.key||"moving"!==this.state||e.stopPropagation()}_findTargetGraphic(e){const t=this.view.toMap(e),i=this.graphics;let r=null,n=Number.MAX_VALUE;this._syncLayerViews();const s=this._layerViews.flatMap((e=>"graphicsViews"in e?Array.from(e.graphicsViews(),(e=>e.hitTest(t))).flat():e.graphicsView.hitTest(t))).filter((e=>i.includes(e))).sort(((e,t)=>i.indexOf(e)-i.indexOf(t)));return s.length?s[0]:(this._manipulators.forEach((t=>{const i=t.intersectionDistance(e);null!=i&&i<n&&(n=i,r=t.graphic)})),r)}_syncLayerViews(){this._layerViews=[];const e=new Set;for(const t of this.graphics){const i=(0,p.i)(this.view,t.layer);i&&e.add(i)}this._layerViews=[...e]}_setUpManipulators(){const{graphics:e,view:t}=this;this._manipulators.forEach((e=>e.destroy())),this._manipulators=e.length?e.map((e=>new x.l({graphic:e,view:t}))):[]}_setUpHighlights(){this.highlightsEnabled&&this._highlightHelper.add(this.graphics)}_setUpIndicators(){if(this._removeIndicators(),this.indicatorsEnabled){for(const e of this.graphics){const t=e.clone();t.symbol=this._getSymbolForIndicator(e),this._indicators.push(t),this.addHandles((0,o.wB)((()=>e.symbol),(()=>this._setUpIndicators())),T)}this.layer.addMany(this._indicators)}}_removeIndicators(){this.removeHandles(T),this._indicators.length&&(this.layer.removeMany(this._indicators),this._indicators.forEach((e=>e.destroy())),this._indicators=[])}_getSymbolForIndicator(e){if(null==e.symbol)return null;switch(e.symbol.type){case"cim":return new k.A({style:"circle",size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}});case"picture-marker":{const{xoffset:t,yoffset:i,height:r,width:n}=e.symbol,s=r===n?n:Math.max(r,n);return new k.A({xoffset:t,yoffset:i,size:s,style:"square",color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-marker":{const{xoffset:t,yoffset:i,size:r,style:n}=e.symbol;return new k.A({xoffset:t,yoffset:i,style:"circle"===n?"circle":"square",size:r+2,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-fill":return new M.A({color:[0,0,0,0],outline:{style:"dash",color:[255,127,0,1],width:1}});case"simple-line":return new E.A({color:[255,127,0,1],style:"dash",width:1});case"text":{const{xoffset:t,yoffset:i}=e.symbol;return new k.A({xoffset:t,yoffset:i,size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}default:return null}}};(0,r._)([(0,a.MZ)()],A.prototype,"_activeGraphic",void 0),(0,r._)([(0,a.MZ)({readOnly:!0})],A.prototype,"type",void 0),(0,r._)([(0,a.MZ)()],A.prototype,"callbacks",void 0),(0,r._)([(0,a.MZ)()],A.prototype,"enableMoveAllGraphics",void 0),(0,r._)([(0,a.MZ)()],A.prototype,"graphics",void 0),(0,r._)([(0,a.MZ)({value:!1})],A.prototype,"highlightsEnabled",null),(0,r._)([(0,a.MZ)()],A.prototype,"indicatorsEnabled",void 0),(0,r._)([(0,a.MZ)()],A.prototype,"layer",void 0),(0,r._)([(0,a.MZ)({readOnly:!0})],A.prototype,"state",null),(0,r._)([(0,a.MZ)()],A.prototype,"view",void 0),A=(0,r._)([(0,l.$)("esri.views.draw.support.GraphicMover")],A);const O=A},91933:(e,t,i)=>{i.d(t,{A:()=>u});var r=i(66866),n=i(52495),s=i(21564),o=(i(73446),i(85569),i(39831),i(63863)),a=i(7407),l=i(38201),h=i(3769);let c=class extends n.A{constructor(e){super(e),this.view=null}add(e){const t=!e||Array.isArray(e)?e:[e];t?.length&&t.forEach((e=>this._highlight(e)))}remove(e){const t=!e||Array.isArray(e)?e:[e];t?.length&&t.forEach((e=>this._unhighlight(e)))}removeAll(){this.removeAllHandles()}_highlight(e){const t=(0,a.i)(this.view,e.layer);(0,l.Of)(t)&&this.addHandles(t.highlight(e),(0,h.Fr)(e))}_unhighlight(e){e&&this.removeHandles((0,h.Fr)(e))}};(0,r._)([(0,s.MZ)()],c.prototype,"view",void 0),c=(0,r._)([(0,o.$)("esri.views.draw.support.HighlightHelper")],c);const u=c},3769:(e,t,i)=>{i.d(t,{A4:()=>T,AB:()=>I,Ao:()=>ee,DU:()=>J,Fr:()=>ne,J9:()=>R,JF:()=>x,MK:()=>U,Tt:()=>E,Uu:()=>j,a$:()=>V,bG:()=>S,bV:()=>M,c3:()=>Q,cS:()=>ie,gd:()=>H,kX:()=>k,ld:()=>$,lm:()=>q,q6:()=>te,s$:()=>Y,sS:()=>P,u2:()=>F,x1:()=>B,xL:()=>A});var r=i(539),n=i(96274),s=i(76459),o=i(46930),a=i(42453),l=i(40454),h=i(99340),c=i(28965),u=i(12129);const p=r.A.getLogger("esri.widgets.Feature.support.featureUtils"),d=/href=(""|'')/gi,f=/(\{([^\{\r\n]+)\})/g,y=/\'/g,g=/^\s*expression\//i,m=/(\n)/gi,v=/[\u00A0-\u9999<>\&]/gim,_=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,w=/^(?:mailto:|tel:)/,b="relationships/",G=(0,s.J2)("short-date-short-time");function x(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function I(e,t){return"function"==typeof e?e(t):e}function k(e=""){if(e)return!w.test(e.trim().toLowerCase())}function E(e){return!!e&&g.test(e)}function M(e,t){const i=function(e,t){if(!E(t)||!e)return null;const i=t.replace(g,"").toLowerCase();let r=null;return e.some((e=>e.name.toLowerCase()===i&&(r=e,!0))),r}(t,e?.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function T(e,t){const i=O(t,e);return i?i.name:e}function A(e,t){return e&&e.map((e=>T(e,t)))}function O(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function Z(e){return`${e}`.trim()}function F({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:n,fieldInfoMap:s}){return r?H({formattedAttributes:t,template:C(r,{...t,...n,...e},i),fieldInfoMap:s}):""}function H({formattedAttributes:e,template:t,fieldInfoMap:i}){return Z(function(e){return e.replaceAll(d,"")}((0,n.HC)((0,n.HC)(t,(e=>function(e,t){const i=t.get(e.toLowerCase());return`{${i?.fieldName||e}}`}(e,i))),e)))}function D(e,t=!1){const i={...e};return Object.keys(i).forEach((e=>function(e,t,i=!1){const r=t[e];if("string"==typeof r){const n="%27",s=(i?encodeURIComponent(r):r).replaceAll(y,n);t[e]=s}}(e,i,t))),i}function U(e,t){return e.replaceAll(f,((e,i,r)=>{const n=O(t,r);return n?`{${n.name}}`:i}))}function C(e,t,i){const r=U(e,i);return r?r.replaceAll(_,((e,i,r)=>function(e,t,i){const r=(t=Z(t))&&"{"!==t[0];return(0,n.HC)(e,D(i,r||!1))}(e,i||r,t))):r}function P(e){return function(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type)&&"when"in e}(e)&&function(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}(e)}function L(e,t){const{fieldInfos:i,fieldName:r,preventPlacesFormatting:n,layer:s,timeZone:l}=t,c=q(i,r),u=O(s,r);if(c&&!(0,a.JL)(r)){const t=u?.type,i=c.format?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||i)return(0,h.i0)(e,{format:i,fieldType:t,timeZoneOptions:{layerTimeZone:s&&"preferredTimeZone"in s?s.preferredTimeZone:null,viewTimeZone:l,datesInUnknownTimezone:!(!s||!("datesInUnknownTimezone"in s)||!s.datesInUnknownTimezone)}})}const p=c?.format;return"string"==typeof e&&(0,a.JL)(r)&&p?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?N(e,",",", ",t):e.includes(";")?N(e,";","; ",t):e.includes(" ")?N(e," "," ",t):(0,o.ZV)(Number(e),(0,o.yx)(t))}(e,p):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,p))||null==e||null==p?j(e):(0,o.ZV)(e,n?{...(0,o.yx)(p),minimumFractionDigits:0,maximumFractionDigits:20}:(0,o.yx)(p))}function N(e,t,i,r){return e.trim().split(t).map((e=>(0,o.ZV)(Number(e),(0,o.yx)(r)))).join(i)}function q(e,t){if(e?.length&&t)return e.find((e=>e.fieldName?.toLowerCase()===t.toLowerCase()))}function V(e,t,i,r){const{creatorField:n,creationDateField:o,editorField:a,editDateField:l}=e;if(!t)return;const h=(0,u.hv)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r)||!r.datesInUnknownTimezone),i,G,"date"),c={...G,...h},p=t[l];if("number"==typeof p){const e=t[a];return{type:"edit",date:(0,s.Yq)(p,c),user:e}}const d=t[o];if("number"==typeof d){const e=t[n];return{type:"create",date:(0,s.Yq)(d,c),user:e}}return null}function R(e,t){const i=new Map;return e?(e.forEach((e=>{const r=T(e.fieldName,t);e.fieldName=r,i.set(r.toLowerCase(),e)})),i):i}function $(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)?(r.forEach((e=>{if("fields"===e.type){const i=e?.fieldInfos;i&&t.push(...i)}})),t):t}function S(e){return e.replaceAll(v,(e=>`&#${e.charCodeAt(0)};`))}function j(e){return"string"==typeof e?e.replaceAll(m,'<br class="esri-text-new-line" />'):e}function z(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:n,layer:s,graphic:o,timeZone:l}=e;if(null==t)return"";const c=function({fieldName:e,value:t,graphic:i,layer:r}){if(Y(e))return null;if(!r||"function"!=typeof r.getFieldDomain)return null;const n=i&&r.getFieldDomain(e,{feature:i});return n&&"coded-value"===n.type?n.getName(t):null}({fieldName:i,value:t,graphic:o,layer:s});if(c)return c;const u=function({fieldName:e,graphic:t,layer:i}){if(Y(e))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const n=i.getFeatureType(t);return n?n.name:null}({fieldName:i,graphic:o,layer:s});if(u)return u;if(n.get(i.toLowerCase()))return L(t,{fieldInfos:r||Array.from(n.values()),fieldName:i,layer:s,timeZone:l});const p=s?.fieldsIndex?.get(i);return p&&((0,h.fs)(p)||(0,a.OH)(p))?(0,h.i0)(t,{fieldType:p.type,timeZoneOptions:{layerTimeZone:s&&"preferredTimeZone"in s?s.preferredTimeZone:null,viewTimeZone:l,datesInUnknownTimezone:!(!s||!("datesInUnknownTimezone"in s)||!s.datesInUnknownTimezone)}}):j(t)}function B({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:n,relatedInfos:s,timeZone:o}){const a={};return s?.forEach((t=>function({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:n,timeZone:s}){e&&t&&(t.relatedFeatures?.forEach((o=>K({attributes:e,graphic:o,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:n,timeZone:s}))),t.relatedStatsFeatures?.forEach((o=>K({attributes:e,graphic:o,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:n,timeZone:s}))))}({attributes:a,relatedInfo:t,fieldInfoMap:n,fieldInfos:e,layer:i,timeZone:o}))),t&&Object.keys(t).forEach((s=>{const l=t[s];a[s]=z({fieldName:s,fieldInfos:e,fieldInfoMap:n,layer:i,value:l,graphic:r,timeZone:o})})),a}async function J(e,t){const{layer:i,graphic:r,outFields:n,objectIds:s,returnGeometry:o,spatialReference:a}=e,h=s[0];if("number"!=typeof h&&"string"!=typeof h){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:i,graphic:r,objectId:h,requiredFields:n};return p.warn(e,t),null}if(!(0,l.BR)(i)?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:i,graphic:r,requiredFields:n,returnGeometry:o};return p.warn(e,t),null}const c=i.createQuery();return c.objectIds=s,c.outFields=n?.length?n:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,t)).features[0]}async function Q({graphic:e,popupTemplate:t,layer:i,spatialReference:r},n){if(!i||!t)return;if("function"==typeof i.load&&await i.load(n),!e.attributes)return;const s=e.attributes[i.objectIdField];if(null==s)return;const o=[s],l=await t.getRequiredFields(i.fieldsIndex),h=(0,a.Kl)(l,e),u=h?[]:l,p=t.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,c.lw)(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)}(t);if(h&&!p)return;const d=await J({layer:i,graphic:e,outFields:u,objectIds:o,returnGeometry:p,spatialReference:r},n);d&&(d.geometry&&(e.geometry=d.geometry),d.attributes&&(e.attributes={...e.attributes,...d.attributes}))}function Y(e=""){return!!e&&e.includes(b)}function K({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:n,layer:s,timeZone:o}){e&&t&&i&&Object.keys(t.attributes).forEach((a=>{const l=function(e){return e?`${b}${e.layerId}/${e.fieldName}`:""}({layerId:i.relation.id.toString(),fieldName:a}),h=t.attributes[a];e[l]=z({fieldName:l,fieldInfos:r,fieldInfoMap:n,layer:s,value:h,graphic:t,timeZone:o})}))}const X=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},W=({layer:e,method:t,query:i,definitionExpression:r})=>{if(!e.capabilities?.query?.supportsCacheHint||"attachments"===t)return;const n=null!=i.where?i.where:null,s=null!=i.geometry?i.geometry:null;X(r)||X(n)||"extent"===s?.type||"tile"===i.resultType||(i.cacheHint=!0)},ee=({query:e,layer:t,method:i})=>{W({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},te=({queryPayload:e,layer:t,method:i})=>{W({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})};function ie(e,t,i){return e&&t&&i?re(e.allLayers,t,i)||re(e.allTables,t,i):null}function re(e,t,i){const r="scene"===t.type&&t.associatedLayer?t.associatedLayer.url:t.url;return e.filter(P).find((e=>e!==t&&e.url===r&&e.layerId===i.relatedTableId))}function ne(e){const t=e.getObjectId();return null!=t?`oid:${t}`:`uid:${e.uid}`}}}]);