"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[44328],{84858:(t,i,e)=>{var s;e.d(i,{u:()=>s}),function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"}(s||(s={}))},775:(t,i,e)=>{e.d(i,{$:()=>v,IB:()=>a,Iy:()=>$,N2:()=>w,QP:()=>D,RH:()=>M,Vl:()=>S,Ws:()=>T,ZD:()=>b,_L:()=>z,bJ:()=>R,e$:()=>L,f6:()=>k,pW:()=>P,pf:()=>O});var s=e(96220),n=e(85569),h=e(19251),r=(e(92504),e(2662),e(28152));function a(t){return"r"in t&&"g"in t&&"b"in t}function l(t){return"h"in t&&"s"in t&&"v"in t}function o(t){return"l"in t&&"a"in t&&"b"in t}function c(t){return"l"in t&&"c"in t&&"h"in t}const u=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],_=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function y(t,i){const e=[];let s,n;if(t[0].length!==i.length)throw new Error("dimensions do not match");const h=t.length,r=t[0].length;let a=0;for(s=0;s<h;s++){for(a=0,n=0;n<r;n++)a+=t[s][n]*i[n];e.push(a)}return e}function x(t){const i=[t.r/255,t.g/255,t.b/255].map((t=>t<=.04045?t/12.92:((t+.055)/1.055)**2.4)),e=y(u,i);return{x:100*e[0],y:100*e[1],z:100*e[2]}}function f(t){const i=y(_,[t.x/100,t.y/100,t.z/100]).map((t=>{const i=t<=.0031308?12.92*t:1.055*t**(1/2.4)-.055;return Math.min(1,Math.max(i,0))}));return{r:Math.round(255*i[0]),g:Math.round(255*i[1]),b:Math.round(255*i[2])}}function p(t){const i=[t.x/95.047,t.y/100,t.z/108.883].map((t=>t>(6/29)**3?t**(1/3):1/3*(29/6)**2*t+4/29));return{l:116*i[1]-16,a:500*(i[0]-i[1]),b:200*(i[1]-i[2])}}function m(t){const i=t.l,e=[(i+16)/116+t.a/500,(i+16)/116,(i+16)/116-t.b/200].map((t=>t>6/29?t**3:3*(6/29)**2*(t-4/29)));return{x:95.047*e[0],y:100*e[1],z:108.883*e[2]}}function d(t){return function(t){const i=t.l,e=t.a,s=t.b,n=Math.sqrt(e*e+s*s);let h=Math.atan2(s,e);return h=h>0?h:h+2*Math.PI,{l:i,c:n,h:h}}(p(x(t)))}function g(t){return f(m(function(t){const i=t.l,e=t.c,s=t.h;return{l:i,a:e*Math.cos(s),b:e*Math.sin(s)}}(t)))}function v(t){return a(t)?t:c(t)?g(t):o(t)?function(t){return f(m(t))}(t):function(t){return"x"in t&&"y"in t&&"z"in t}(t)?f(t):l(t)?function(t){const i=(t.h+360)%360/60,e=t.s/100,s=t.v/100*255,n=s*e,h=n*(1-Math.abs(i%2-1));let r;switch(Math.floor(i)){case 0:r={r:n,g:h,b:0};break;case 1:r={r:h,g:n,b:0};break;case 2:r={r:0,g:n,b:h};break;case 3:r={r:0,g:h,b:n};break;case 4:r={r:h,g:0,b:n};break;case 5:case 6:r={r:n,g:0,b:h};break;default:r={r:0,g:0,b:0}}return r.r=Math.round(r.r+s-n),r.g=Math.round(r.g+s-n),r.b=Math.round(r.b+s-n),r}(t):t}function w(t){return l(t)?t:function(t){const i=t.r,e=t.g,s=t.b,n=Math.max(i,e,s),h=n-Math.min(i,e,s);let r=n,a=0===h?0:n===i?(e-s)/h%6:n===e?(s-i)/h+2:(i-e)/h+4,l=0===h?0:h/r;return a<0&&(a+=6),a*=60,l*=100,r*=100/255,{h:a,s:l,v:r}}(v(t))}function b(t){return o(t)?t:function(t){return p(x(t))}(v(t))}function M(t){return c(t)?t:d(v(t))}function A(t){let{r:i,g:e,b:n,a:h}=t;return h<1&&(i=Math.round(h*i+255*(1-h)),e=Math.round(h*e+255*(1-h)),n=Math.round(h*n+255*(1-h))),new s.A({r:i,g:e,b:n})}function T(t,i){const{r:e,g:s,b:n}=i?.ignoreAlpha?t:A(t);return.2126*e+.7152*s+.0722*n}var P,I;function R(t,i=P.High){return T(t,{ignoreAlpha:!0})>i?new s.A([0,0,0,t.a]):new s.A([255,255,255,t.a])}function L(t,i){const e=b(t);e.l*=1-i;const s=v(e),n=t.clone();return n.setColor(s),n.a=t.a,n}function z(t,i){const e=t.clone();return e.a*=i,e}function S(t,i){const e=w(t);e.s*=i;const s=v(e),n=t.clone();return n.setColor(s),n.a=t.a,n}function D(t){return s.A.toUnitRGBA(t)}function O(t){return(0,r.fA)(t[0],t[1],t[2],t.length>3?t[3]:1)}function k(t,i){const e=s.A.toUnitRGBA(t);return e[3]*=i,e}function $(t,i,e={}){if(0===t.length||i<=0)return[];if(1===(t=t.map((t=>"string"==typeof t?new s.A(t):t))).length||1===i){const e=[],s=t[0];for(let t=0;t<i;t++)e.push(s.clone());return e}if(e.shuffle&&(t=(0,n.k4)((0,h.o8)(t),e.seed)),t.length>=i){const e=[],s=(t.length-1)/(i-1);for(let n=0;n<i;n++){const i=Math.round(n*s);e.push(t[i].clone())}return e}return function(t,i,e={}){const s=[],h=t.length-1,r=Math.ceil((i-t.length)/h);t:for(let n=0;n<h;n++){const h=t[n],a=t[n+1];for(let n=1;n<=r;n++){const l=n/(r+1);if(s.push(U(h,a,l,e)),s.length+t.length===i)break t}}return[...t.map((t=>t.clone())),...(0,n.k4)(s,e.seed??1)]}(t,i,e)}(I=P||(P={}))[I.Low=160]="Low",I[I.High=225]="High";const q=(t,i)=>{const e=Math.floor(10*i())-5;return Math.min(255,Math.max(0,t+e))};function U(t,i,e,h={}){const r=t.r,a=t.g,l=t.b,o=i.r,c=i.g,u=i.b,_=Math.round(r+(o-r)*e),y=Math.round(a+(c-a)*e),x=Math.round(l+(u-l)*e);if(!h.offset)return new s.A([_,y,x]);const f=(0,n.Mo)(h.seed);return new s.A([q(_,f),q(y,f),q(x,f)])}},87569:(t,i,e)=>{e.d(i,{O3:()=>a,Ox:()=>l,bR:()=>h,dC:()=>s});var s,n;!function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"}(s||(s={}));class h{constructor(t,i){this.x=t,this.y=i}static fromArray(t){return new h(t[0],t[1])}clone(){return new h(this.x,this.y)}equals(t,i){return t===this.x&&i===this.y}isEqual(t){return t.x===this.x&&t.y===this.y}setCoords(t,i){return this.x=t,this.y=i,this}normalize(){const t=this.x,i=this.y,e=Math.sqrt(t*t+i*i);return this.x/=e,this.y/=e,this}rightPerpendicular(){const t=this.x;return this.x=this.y,this.y=-t,this}leftPerpendicular(){const t=this.x;return this.x=-this.y,this.y=t,this}move(t,i){return this.x+=t,this.y+=i,this}assign(t){return this.x=t.x,this.y=t.y,this}assignAdd(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}assignSub(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}rotate(t,i){const e=this.x,s=this.y;return this.x=e*t-s*i,this.y=e*i+s*t,this}rotateReverse(t,i){const e=this.x,s=this.y;return this.x=e*t+s*i,this.y=-e*i+s*t,this}scale(t){return this.x*=t,this.y*=t,this}length(){const t=this.x,i=this.y;return Math.sqrt(t*t+i*i)}sub(t){return this.x-=t.x,this.y-=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}static distance(t,i){const e=i.x-t.x,s=i.y-t.y;return Math.sqrt(e*e+s*s)}static add(t,i){return new h(t.x+i.x,t.y+i.y)}static sub(t,i){return new h(t.x-i.x,t.y-i.y)}}class r{constructor(t,i,e){this.ratio=t,this.x=i,this.y=e}}class a{constructor(t,i,e,s=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=s,this._pixelMargin=n,this._tileSize=512*s,this._dz=t,this._yPos=i,this._xPos=e}setPixelMargin(t){t!==this._pixelMargin&&(this._pixelMargin=t,this.setExtent(this._extent))}setExtent(t){this._extent=t,this._finalRatio=this._tileSize/t*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const e=t>>this._dz;i>e&&(i=e),this._margin=i,this._xmin=e*this._xPos-i,this._ymin=e*this._yPos-i,this._xmax=this._xmin+e+2*i,this._ymax=this._ymin+e+2*i}reset(t){this._type=t,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(t,i){this._pushLine(),this._prevIsIn=this._isIn(t,i),this._moveTo(t,i,this._prevIsIn),this._prevPt=new h(t,i),this._firstPt=new h(t,i),this._dist=0}lineTo(t,i){const e=this._isIn(t,i),s=new h(t,i),n=h.distance(this._prevPt,s);let a,l,o,c,u,_,y,x;if(e)this._prevIsIn?this._lineTo(t,i,!0):(a=this._prevPt,l=s,o=this._intersect(l,a),this._start=this._dist+n*(1-this._r),this._lineTo(o.x,o.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,a=s,o=this._intersect(l,a),this._lineTo(o.x,o.y,!0),this._lineTo(a.x,a.y,!1);else{const t=this._prevPt,i=s;if(t.x<=this._xmin&&i.x<=this._xmin||t.x>=this._xmax&&i.x>=this._xmax||t.y<=this._ymin&&i.y<=this._ymin||t.y>=this._ymax&&i.y>=this._ymax)this._lineTo(i.x,i.y,!1);else{const e=[];if((t.x<this._xmin&&i.x>this._xmin||t.x>this._xmin&&i.x<this._xmin)&&(c=(this._xmin-t.x)/(i.x-t.x),x=t.y+c*(i.y-t.y),x<=this._ymin?_=!1:x>=this._ymax?_=!0:e.push(new r(c,this._xmin,x))),(t.x<this._xmax&&i.x>this._xmax||t.x>this._xmax&&i.x<this._xmax)&&(c=(this._xmax-t.x)/(i.x-t.x),x=t.y+c*(i.y-t.y),x<=this._ymin?_=!1:x>=this._ymax?_=!0:e.push(new r(c,this._xmax,x))),(t.y<this._ymin&&i.y>this._ymin||t.y>this._ymin&&i.y<this._ymin)&&(c=(this._ymin-t.y)/(i.y-t.y),y=t.x+c*(i.x-t.x),y<=this._xmin?u=!1:y>=this._xmax?u=!0:e.push(new r(c,y,this._ymin))),(t.y<this._ymax&&i.y>this._ymax||t.y>this._ymax&&i.y<this._ymax)&&(c=(this._ymax-t.y)/(i.y-t.y),y=t.x+c*(i.x-t.x),y<=this._xmin?u=!1:y>=this._xmax?u=!0:e.push(new r(c,y,this._ymax))),0===e.length)u?_?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):_?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(e.length>1&&e[0].ratio>e[1].ratio)this._start=this._dist+n*e[1].ratio,this._lineTo(e[1].x,e[1].y,!0),this._lineTo(e[0].x,e[0].y,!0);else{this._start=this._dist+n*e[0].ratio;for(let t=0;t<e.length;t++)this._lineTo(e[t].x,e[t].y,!0)}this._lineTo(i.x,i.y,!1)}}this._dist+=n,this._prevIsIn=e,this._prevPt=s}close(){if(this._line.length>2){const t=this._firstPt,i=this._prevPt;t.x===i.x&&t.y===i.y||this.lineTo(t.x,t.y);const e=this._line;let s=e.length;for(;s>=4&&(e[0].x===e[1].x&&e[0].x===e[s-2].x||e[0].y===e[1].y&&e[0].y===e[s-2].y);)e.pop(),e[0].x=e[s-2].x,e[0].y=e[s-2].y,--s}}result(t=!0){return this._pushLine(),0===this._lines.length?null:(this._type===s.Polygon&&t&&o.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==s.LineString)throw new Error("Only valid for lines");this._pushLine();const t=this._lines,i=t.length;if(0===i)return null;const e=[];for(let s=0;s<i;s++)e.push({line:t[s],start:this._starts[s]||0});return e}_isIn(t,i){return t>=this._xmin&&t<=this._xmax&&i>=this._ymin&&i<=this._ymax}_intersect(t,i){let e,s,n;if(i.x>=this._xmin&&i.x<=this._xmax)s=i.y<=this._ymin?this._ymin:this._ymax,n=(s-t.y)/(i.y-t.y),e=t.x+n*(i.x-t.x);else if(i.y>=this._ymin&&i.y<=this._ymax)e=i.x<=this._xmin?this._xmin:this._xmax,n=(e-t.x)/(i.x-t.x),s=t.y+n*(i.y-t.y);else{s=i.y<=this._ymin?this._ymin:this._ymax,e=i.x<=this._xmin?this._xmin:this._xmax;const h=(e-t.x)/(i.x-t.x),r=(s-t.y)/(i.y-t.y);h<r?(n=h,s=t.y+h*(i.y-t.y)):(n=r,e=t.x+r*(i.x-t.x))}return this._r=n,new h(e,s)}_pushLine(){this._line&&(this._type===s.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===s.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===s.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(t,i,e){this._type!==s.Polygon?e&&(t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new h(t,i))):(e||(t<this._xmin&&(t=this._xmin),t>this._xmax&&(t=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new h(t,i)),this._isH=!1,this._isV=!1)}_lineTo(t,i,e){let n,r;if(this._type!==s.Polygon)if(e){if(t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(n=this._line[this._line.length-1],n.equals(t,i)))return;this._line.push(new h(t,i))}else this._line&&this._line.length>0&&this._pushLine();else if(e||(t<this._xmin&&(t=this._xmin),t>this._xmax&&(t=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){n=this._line[this._line.length-1];const e=n.x===t,s=n.y===i;if(e&&s)return;this._isH&&e||this._isV&&s?(n.x=t,n.y=i,r=this._line[this._line.length-2],r.x===t&&r.y===i?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(r=this._line[this._line.length-2],this._isH=r.x===t,this._isV=r.y===i)):(this._isH=r.x===t,this._isV=r.y===i)):(this._line.push(new h(t,i)),this._isH=e,this._isV=s)}else this._line.push(new h(t,i))}}class l{setExtent(t){this._ratio=4096===t?1:4096/t}get validateTessellation(){return this._ratio<1}reset(t){this._lines=[],this._line=null}moveTo(t,i){this._line&&this._lines.push(this._line),this._line=[];const e=this._ratio;this._line.push(new h(t*e,i*e))}lineTo(t,i){const e=this._ratio;this._line.push(new h(t*e,i*e))}close(){const t=this._line;t&&!t[0].isEqual(t[t.length-1])&&t.push(t[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}!function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"}(n||(n={}));class o{static simplify(t,i,e){if(!e)return;const s=-i,h=t+i,r=-i,a=t+i,l=[],c=[],u=e.length;for(let o=0;o<u;++o){const t=e[o];if(!t||t.length<2)continue;let i,u=t[0];const _=t.length;for(let e=1;e<_;++e)i=t[e],u.x===i.x&&(u.x<=s&&(u.y>i.y?(l.push(o),l.push(e),l.push(n.sideLeft),l.push(-1)):(c.push(o),c.push(e),c.push(n.sideLeft),c.push(-1))),u.x>=h&&(u.y<i.y?(l.push(o),l.push(e),l.push(n.sideRight),l.push(-1)):(c.push(o),c.push(e),c.push(n.sideRight),c.push(-1)))),u.y===i.y&&(u.y<=r&&(u.x<i.x?(l.push(o),l.push(e),l.push(n.sideTop),l.push(-1)):(c.push(o),c.push(e),c.push(n.sideTop),c.push(-1))),u.y>=a&&(u.x>i.x?(l.push(o),l.push(e),l.push(n.sideBottom),l.push(-1)):(c.push(o),c.push(e),c.push(n.sideBottom),c.push(-1)))),u=i}if(0===l.length||0===c.length)return;o.fillParent(e,c,l),o.fillParent(e,l,c);const _=[];o.calcDeltas(_,c,l),o.calcDeltas(_,l,c),o.addDeltas(_,e)}static fillParent(t,i,e){const s=e.length,h=i.length;for(let r=0;r<h;r+=4){const h=i[r],a=i[r+1],l=i[r+2],o=t[h][a-1],u=t[h][a];let _=8092,y=-1;for(let i=0;i<s;i+=4){if(e[i+2]!==l)continue;const s=e[i],h=e[i+1],r=t[s][h-1],a=t[s][h];switch(l){case n.sideLeft:case n.sideRight:if(c(o.y,r.y,a.y)&&c(u.y,r.y,a.y)){const t=Math.abs(a.y-r.y);t<_&&(_=t,y=i)}break;case n.sideTop:case n.sideBottom:if(c(o.x,r.x,a.x)&&c(u.x,r.x,a.x)){const t=Math.abs(a.x-r.x);t<_&&(_=t,y=i)}}}i[r+3]=y}}static calcDeltas(t,i,e){const s=i.length;for(let n=0;n<s;n+=4){const s=[],h=o.calcDelta(n,i,e,s);t.push(i[n]),t.push(i[n+1]),t.push(i[n+2]),t.push(h)}}static calcDelta(t,i,e,s){const n=i[t+3];if(-1===n)return 0;const h=s.length;return h>1&&s[h-2]===n?0:(s.push(n),o.calcDelta(n,e,i,s)+1)}static addDeltas(t,i){const e=t.length;let s=0;for(let n=0;n<e;n+=4){const i=t[n+3];i>s&&(s=i)}for(let h=0;h<e;h+=4){const e=i[t[h]],r=t[h+1],a=s-t[h+3];switch(t[h+2]){case n.sideLeft:e[r-1].x-=a,e[r].x-=a,1===r&&(e[e.length-1].x-=a),r===e.length-1&&(e[0].x-=a);break;case n.sideRight:e[r-1].x+=a,e[r].x+=a,1===r&&(e[e.length-1].x+=a),r===e.length-1&&(e[0].x+=a);break;case n.sideTop:e[r-1].y-=a,e[r].y-=a,1===r&&(e[e.length-1].y-=a),r===e.length-1&&(e[0].y-=a);break;case n.sideBottom:e[r-1].y+=a,e[r].y+=a,1===r&&(e[e.length-1].y+=a),r===e.length-1&&(e[0].y+=a)}}}}const c=(t,i,e)=>t>=i&&t<=e||t>=e&&t<=i},50193:(t,i,e)=>{e.d(i,{p:()=>r});var s=e(66866),n=e(21564),h=(e(39831),e(539),e(9272),e(63863));const r=t=>{let i=class extends t{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):function(t){return"portalItem"in t}(this)?this.portalItem?.apiKey:null}set apiKey(t){null!=t?this._override("apiKey",t):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,s._)([(0,n.MZ)({type:String})],i.prototype,"apiKey",null),i=(0,s._)([(0,h.$)("esri.layers.mixins.APIKeyMixin")],i),i}},35787:(t,i,e)=>{e.d(i,{d:()=>T});var s,n=e(66866),h=e(86394),r=e(52495),a=e(84858),l=e(98849),o=e(20464),c=(e(39831),e(89926)),u=e(63678),_=e(40189),y=e(85251),x=e(61449),f=e(20909),p=e(21564),m=(e(539),e(9272),e(63863)),d=e(88061),g=e(19251),v=e(4754),w=e(86942);class b{constructor(t){!function(t){if(!t?.location)throw new l.A("tilemap:missing-location","Location missing from tilemap response");if(!1===t.valid)throw new l.A("tilemap:invalid","Tilemap response was marked as invalid");if(!t.data)throw new l.A("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(t.data))throw new l.A("tilemap:data-mismatch","Data must be an array of numbers");if(t.data.length!==t.location.width*t.location.height)throw new l.A("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}(t);const{location:i,data:e}=t;this.location=Object.freeze((0,g.o8)(i));const s=this.location.width,n=this.location.height;let h=!0,r=!0;const a=function(t,i=!1){return t<=w.y9?i?new Array(t).fill(0):new Array(t):new Uint32Array(t)}(Math.ceil(s*n/32));let o=0;for(let l=0;l<e.length;l++){const t=l%32;e[l]?(r=!1,a[o]|=1<<t):h=!1,31===t&&++o}r?(this._availability="unavailable",this.byteSize=40):h?(this._availability="available",this.byteSize=40):(this._availability=a,this.byteSize=40+(0,v.Qf)(a))}getAvailability(t,i){if("unavailable"===this._availability||"available"===this._availability)return this._availability;const e=(t-this.location.top)*this.location.width+(i-this.location.left),s=e%32,n=e>>5,h=this._availability;return n<0||n>h.length?"unknown":h[n]&1<<s?"available":"unavailable"}static fromDefinition(t,i){const e=t.service.request||h.A,{row:s,col:n,width:r,height:a}=t,o={query:{f:"json"}};return i=i?{...o,...i}:o,e(function(t){let i;if(t.service.tileServers?.length){const e=t.service.tileServers;i=`${e&&e.length?e[t.row%e.length]:t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}else i=`${t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;const e=t.service.query;return e&&(i=`${i}?${e}`),i}(t),i).then((t=>t.data)).catch((t=>{if(422===t?.details?.httpStatus)return{location:{top:s,left:n,width:r,height:a},valid:!0,data:new Array(r*a).fill(0)};throw t})).then((t=>{if(t.location&&(t.location.top!==s||t.location.left!==n||t.location.width!==r||t.location.height!==a))throw new l.A("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:s,left:n,width:r,height:a}});return b.fromJSON(t)}))}static fromJSON(t){return Object.freeze(new b(t))}}function M(t){return`${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}function A(t,i,e){return new l.A("tile-map:tile-unavailable","Tile is not available",{level:t,row:i,col:e})}let T=class extends r.A{static{s=this}constructor(t){super(t),this._pendingTilemapRequests={},this.request=h.A,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new c.q(2*a.u.MEGABYTES),this.addHandles((0,y.wB)((()=>{const{layer:t}=this;return[t?.parsedUrl,t?.tileServers,t?.apiKey,t?.customParameters]}),(()=>this._initializeTilemapDefinition()),y.Vh))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}getAvailability(t,i,e){if(!this.layer.tileInfo.lodAt(t)||t<this.effectiveMinLOD||t>this.effectiveMaxLOD)return"unavailable";const s=this._tilemapFromCache(t,i,e,this._tmpTilemapDefinition);return s?s.getAvailability(i,e):"unknown"}fetchAvailability(t,i,e,s){return!this.layer.tileInfo.lodAt(t)||t<this.effectiveMinLOD||t>this.effectiveMaxLOD?Promise.reject(A(t,i,e)):this._fetchTilemap(t,i,e,s).catch((t=>t)).then((s=>{if(s instanceof b){const n=s.getAvailability(i,e);if("unavailable"===n)throw A(t,i,e);return n}if((0,_.zf)(s))throw s;return"unknown"}))}fetchAvailabilityUpsample(t,i,e,s,n){s.level=t,s.row=i,s.col=e;const h=this.layer.tileInfo;h.updateTileInfo(s);const r=this.fetchAvailability(t,i,e,n).catch((t=>{if((0,_.zf)(t))throw t;if(h.upsampleTile(s))return this.fetchAvailabilityUpsample(s.level,s.row,s.col,s,n);throw t}));return this._fetchAvailabilityUpsamplePrefetch(s.id,t,i,e,n,r),r}async _fetchAvailabilityUpsamplePrefetch(t,i,e,n,h,r){if(!this._prefetchingEnabled||null==t)return;const a=`prefetch-${t}`;if(this.hasHandles(a))return;const l=new AbortController;r.then((()=>l.abort()),(()=>l.abort()));let c=!1;const u=(0,o.hA)((()=>{c||(c=!0,l.abort())}));if(this.addHandles(u,a),await(0,x.md)(10,l.signal).catch((()=>{})),c||(c=!0,this.removeHandles(a)),(0,_.G4)(l))return;const y=new d.U(t,i,e,n),f={...h,signal:l.signal},p=this.layer.tileInfo;for(let o=0;s._prefetches.length<s._maxPrefetch&&p.upsampleTile(y);++o){const t=this.fetchAvailability(y.level,y.row,y.col,f);s._prefetches.push(t);const i=()=>{s._prefetches.removeUnordered(t)};t.then(i,i)}}static{this._maxPrefetch=4}static{this._prefetches=new u.A({initialSize:s._maxPrefetch})}_fetchTilemap(t,i,e,s){if(!this.layer.tileInfo.lodAt(t)||t<this.effectiveMinLOD||t>this.effectiveMaxLOD)return Promise.reject(new l.A("tilemap-cache:level-unavailable",`Level ${t} is unavailable in the service`));const n=this._tmpTilemapDefinition,h=this._tilemapFromCache(t,i,e,n);if(h)return Promise.resolve(h);const r=s?.signal;return s={...s,signal:null},new Promise(((t,i)=>{(0,_.u7)(r,(()=>i((0,_.NK)())));const e=M(n);let h=this._pendingTilemapRequests[e];if(!h){h=b.fromDefinition(n,s).then((t=>(this._tilemapCache.put(e,t,t.byteSize),t)));const t=()=>{delete this._pendingTilemapRequests[e]};this._pendingTilemapRequests[e]=h,h.then(t,t)}h.then(t,i)}))}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const{parsedUrl:t,apiKey:i,customParameters:e}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:t.path,query:(0,f.x0)({...t.query,...e,token:i??t.query?.token}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(t,i,e,s){s.level=t,s.row=i-i%this.size,s.col=e-e%this.size;const n=M(s);return this._tilemapCache.get(n)}get test(){}};(0,n._)([(0,p.MZ)({constructOnly:!0})],T.prototype,"layer",void 0),(0,n._)([(0,p.MZ)({constructOnly:!0})],T.prototype,"minLOD",void 0),(0,n._)([(0,p.MZ)({constructOnly:!0})],T.prototype,"maxLOD",void 0),(0,n._)([(0,p.MZ)({constructOnly:!0})],T.prototype,"request",void 0),(0,n._)([(0,p.MZ)({constructOnly:!0})],T.prototype,"size",void 0),T=s=(0,n._)([(0,m.$)("esri.layers.support.TilemapCache")],T)},47231:(t,i,e)=>{e.d(i,{m:()=>r,v:()=>h});var s=e(20909),n=e(10282);function h(t,i){return{...a(t,i),readResourcePaths:[]}}function r(t,i,e){const n=(0,s.An)(t.itemUrl);return{...a(t,i),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:n?{rootPath:n.path,writtenUrls:[]}:null,resources:e?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function a(t,i){return{origin:i,url:(0,s.An)(t.itemUrl),portal:t.portal||n.A.getDefault(),portalItem:t}}},15946:(t,i,e)=>{e.d(i,{GW:()=>p,IU:()=>v,Jo:()=>r,MG:()=>h,Wh:()=>_,cP:()=>A,os:()=>c,p6:()=>f,pJ:()=>a,ru:()=>b,s3:()=>w,w4:()=>M,wV:()=>x,yM:()=>T,z0:()=>y});var s=e(65319),n=e(87569);const h=Number.POSITIVE_INFINITY,r=Math.PI,a=2*r,l=128/r,o=256/360,c=r/180,u=1/Math.LN2;function _(t,i){return(t%=i)>=0?t:t+i}function y(t){return _(t*l,256)}function x(t){return _(t*o,256)}function f(t){return Math.log(t)*u}function p(t,i,e){return t*(1-e)+i*e}const m=8,d=14,g=16;function v(t){return m+Math.max((t-d)*g,0)}function w(t,i,e){let s,n,h,r=0;for(const a of e){s=a.length;for(let e=1;e<s;++e)n=a[e-1],h=a[e],n.y>i!=h.y>i&&((h.x-n.x)*(i-n.y)-(h.y-n.y)*(t-n.x)>0?r++:r--)}return 0!==r}function b(t,i,e,n){let h,r,a,l;const o=n*n;for(const c of e){const e=c.length;if(!(e<2)){h=c[0].x,r=c[0].y;for(let n=1;n<e;++n){if(a=c[n].x,l=c[n].y,(0,s.Ng)(t,i,h,r,a,l)<o)return!0;h=a,r=l}}}return!1}function M(t,i,e,s,n,h,r){const a=Math.max(s,Math.min(i,h))-i,l=Math.max(n,Math.min(e,r))-e;return a*a+l*l<=t*t}function A(t,i){if(0===i||Number.isNaN(i))return t;const e=[],s=new n.bR(0,0),h=new n.bR(0,0),r=new n.bR(0,0);for(let a=0;a<t.length;a++){const l=t[a],o=[];for(let t=0;t<l.length;t++){const e=l[t-1],a=l[t],c=l[t+1];0===t?s.setCoords(0,0):s.assignSub(a,e).normalize().rightPerpendicular(),t===l.length-1?h.setCoords(0,0):h.assignSub(c,a).normalize().rightPerpendicular(),r.assignAdd(s,h).normalize();const u=r.x*h.x+r.y*h.y;0!==u&&r.scale(1/u),o.push(n.bR.add(a,r.scale(i)))}e.push(o)}return e}function T(t,i,e,s){const h=new n.bR(t[0],t[1]);if(h.scale(s),"viewport"===i){const t=-e*(Math.PI/180),i=Math.cos(t),s=Math.sin(t);h.rotate(i,s)}return h}}}]);