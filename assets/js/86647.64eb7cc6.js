"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[86647,19062,75886,79851,13351],{34427:(e,t,i)=>{function s(e){return null!=l(e)||null!=n(e)}function r(e){return a.test(e)}function o(e){return l(e)??n(e)}function n(e){const t=new Date(e);return function(e,t){if(Number.isNaN(e.getTime()))return!1;let i=!0;if(u&&/\d+\W*$/.test(t)){const e=t.match(/[a-zA-Z]{2,}/);if(e){let t=!1,s=0;for(;!t&&s<=e.length;)t=!c.test(e[s]),s++;i=!t}}return i}(t,e)?Number.isNaN(t.getTime())?null:t.getTime()-6e4*t.getTimezoneOffset():null}function l(e){const t=a.exec(e);if(!t?.groups)return null;const i=t.groups,s=+i.year,r=+i.month-1,o=+i.day,n=+(i.hours??"0"),l=+(i.minutes??"0"),c=+(i.seconds??"0");if(n>23)return null;if(l>59)return null;if(c>59)return null;const u=i.ms??"0",d=u?+u.padEnd(3,"0").slice(0,3):0;let p;if(i.isUTC||!i.offsetSign)p=Date.UTC(s,r,o,n,l,c,d);else{const e=+i.offsetHours,t=+i.offsetMinutes;p=6e4*("+"===i.offsetSign?-1:1)*(60*e+t)+Date.UTC(s,r,o,n,l,c,d)}return Number.isNaN(p)?null:p}i.d(t,{Br:()=>r,Cq:()=>s,_U:()=>o});const a=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/;const c=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,u=!Number.isNaN(new Date("technology 10").getTime())},8695:(e,t,i)=>{i.d(t,{A:()=>y});var s,r=i(66866),o=i(21877),n=i(21564),l=(i(39831),i(539),i(9272),i(63863)),a=i(21742),c=i(86128),u=i(42927),d=i(38911),p=i(58359),h=i(69175);let y=class extends o.A{static{s=this}constructor(e){super(e),this.translation=(0,p.vt)(),this.rotationAxis=(0,p.ci)(h.up),this.rotationAngle=0,this.scale=(0,p.fA)(1,1,1)}get rotation(){return(0,h.i4)(this.rotationAxis,this.rotationAngle)}set rotation(e){this.rotationAxis=(0,p.o8)((0,h.yo)(e)),this.rotationAngle=(0,h.g7)(e)}get localMatrix(){const e=(0,c.vt)();return(0,u.x8)(m,(0,h.yo)(this.rotation),(0,h.$I)(this.rotation)),(0,a.o1)(e,m,this.translation,this.scale),e}get localMatrixInverse(){return(0,a.B8)((0,c.vt)(),this.localMatrix)}equals(e){return this===e||null!=e&&(0,a.t2)(this.localMatrix,e.localMatrix)}clone(){const e={translation:(0,p.o8)(this.translation),rotationAxis:(0,p.o8)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,p.o8)(this.scale)};return new s(e)}};(0,r._)([(0,n.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],y.prototype,"translation",void 0),(0,r._)([(0,n.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],y.prototype,"rotationAxis",void 0),(0,r._)([(0,n.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],y.prototype,"rotationAngle",void 0),(0,r._)([(0,n.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],y.prototype,"scale",void 0),(0,r._)([(0,n.MZ)()],y.prototype,"rotation",null),(0,r._)([(0,n.MZ)()],y.prototype,"localMatrix",null),(0,r._)([(0,n.MZ)()],y.prototype,"localMatrixInverse",null),y=s=(0,r._)([(0,l.$)("esri.geometry.support.MeshTransform")],y);const m=(0,d.vt)()},69175:(e,t,i)=>{i.d(t,{$I:()=>f,AU:()=>y,Cr:()=>d,g7:()=>g,i4:()=>u,ui:()=>p,up:()=>b,vt:()=>c,yo:()=>m});var s=i(92504),r=i(21742),o=i(42927),n=i(38911),l=i(24121),a=i(58359);function c(e=b){return[e[0],e[1],e[2],e[3]]}function u(e,t,i=c()){return(0,l.c)(i,e),i[3]=t,i}function d(e,t,i){return(0,l.h)(i,e,t),(0,l.n)(i,i),i[3]=-(0,l.p)(e,t),i}function p(e,t=c()){const i=(0,r.l)(_,e);return v(t,(0,s.KJ)((0,o.Xd)(t,i))),t}function h(e,t,i=c()){return(0,o.x8)(_,e,f(e)),(0,o.x8)(w,t,f(t)),(0,o.lw)(_,w,_),v(i,(0,s.KJ)((0,o.Xd)(i,_)))}function y(e,t,i,s=c()){return u(a.Cw,e,M),u(a.JP,t,S),u(a.Cb,i,L),h(M,S,M),h(M,L,s),s}function m(e){return e}function g(e){return e[3]}function f(e){return(0,s.kU)(e[3])}function v(e,t){return e[3]=t,e}const b=[0,0,1,0],_=(0,n.vt)(),w=(0,n.vt)(),M=(c(),c()),S=c(),L=c()},97588:(e,t,i)=>{i.r(t),i.d(t,{default:()=>S});var s=i(66866),r=i(98849),o=i(40189),n=i(20909),l=i(21564),a=i(39831),c=(i(539),i(9272),i(75094)),u=i(63863),d=i(78983),p=i(83780),h=i(45307),y=i(90752),m=i(84698),g=i(57822);let f=class extends h.A{constructor(e){super(e),this.type="csv",this.refresh=(0,o.sg)((async e=>{await this.load();const{extent:t,timeExtent:i}=await this._connection.invoke("refresh",e);return t&&(this.sourceJSON.extent=t),i&&(this.sourceJSON.timeInfo.timeExtent=[i.start,i.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}}))}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return g.A.fromJSON(i)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._connection.invoke("queryFeatures",e?e.toJSON():null,t)}async queryFeatureCount(e,t={}){return await this.load(t),this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)}async queryObjectIds(e,t={}){return await this.load(t),this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)}async queryExtent(e,t={}){await this.load(t);const i=await this._connection.invoke("queryExtent",e?e.toJSON():null,t);return{count:i.count,extent:m.A.fromJSON(i.extent)}}async querySnapping(e,t={}){return await this.load(t),this._connection.invoke("querySnapping",e,t)}async queryAttributeBins(e,t={}){return await this.load(),this._connection.invoke("queryAttributeBins",e?e.toJSON():null,t)}async _startWorker(e){this._connection=await(0,y.ho)("CSVSourceWorker",{strategy:(0,a.A)("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{url:t,delimiter:i,fields:s,latitudeField:r,longitudeField:o,spatialReference:n,timeInfo:l}=this.loadOptions,c=await this._connection.invoke("load",{url:t,customParameters:this.customParameters,parsingOptions:{delimiter:i,fields:s?.map((e=>e.toJSON())),latitudeField:r,longitudeField:o,spatialReference:n?.toJSON(),timeInfo:l?.toJSON()}},{signal:e});this.locationInfo=c.locationInfo,this.sourceJSON=c.layerDefinition,this.delimiter=c.delimiter}};(0,s._)([(0,l.MZ)()],f.prototype,"type",void 0),(0,s._)([(0,l.MZ)()],f.prototype,"loadOptions",void 0),(0,s._)([(0,l.MZ)()],f.prototype,"customParameters",void 0),(0,s._)([(0,l.MZ)()],f.prototype,"locationInfo",void 0),(0,s._)([(0,l.MZ)()],f.prototype,"sourceJSON",void 0),(0,s._)([(0,l.MZ)()],f.prototype,"delimiter",void 0),f=(0,s._)([(0,u.$)("esri.layers.graphics.sources.CSVSource")],f);var v=i(20061),b=i(14474),_=i(63680);function w(e,t){throw new r.A(t,`CSVLayer (title: ${e.title}, id: ${e.id}) cannot be saved to a portal item`)}let M=class extends p.default{constructor(...e){super(...e),this.geometryType="point",this.capabilities=(0,v.f)(!1,!1),this.delimiter=null,this.editingEnabled=!1,this.fields=null,this.latitudeField=null,this.locationType="coordinates",this.longitudeField=null,this.operationalLayerType="CSV",this.outFields=["*"],this.path=null,this.spatialReference=d.A.WGS84,this.source=null,this.type="csv"}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=null!=e?e.signal:null,i=this.loadFromPortal({supportedTypes:["CSV"],supportsData:!1},e).catch(o.QP).then((async()=>this.initLayerProperties(await this.createGraphicsSource(t))));return this.addResolvingPromise(i),Promise.resolve(this)}get isTable(){return this.loaded&&null==this.geometryType}readWebMapLabelsVisible(e,t){return null!=t.showLabels?t.showLabels:!!t.layerDefinition?.drawingInfo?.labelingInfo}set url(e){if(!e)return void this._set("url",e);const t=(0,n.An)(e);this._set("url",t.path),t.query&&(this.customParameters={...this.customParameters,...t.query})}async createGraphicsSource(e){const t=new f({loadOptions:{delimiter:this.delimiter,fields:this.fields,latitudeField:this.latitudeField??void 0,longitudeField:this.longitudeField??void 0,spatialReference:this.spatialReference??void 0,timeInfo:this.timeInfo??void 0,url:this.url},customParameters:this.customParameters??void 0});return this._set("source",t),await t.load({signal:e}),this.read({locationInfo:t.locationInfo,columnDelimiter:t.delimiter},{origin:"service",url:this.parsedUrl}),t}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(b.A.from(e)||this.createQuery()))).then((e=>{if(e?.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}))}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(b.A.from(e)||this.createQuery())}queryFeatureCount(e,t){return this.load().then((()=>this.source.queryFeatureCount(b.A.from(e)||this.createQuery())))}queryExtent(e,t){return this.load().then((()=>this.source.queryExtent(b.A.from(e)||this.createQuery())))}read(e,t){super.read(e,t),t&&"service"===t.origin&&this.revert(["latitudeField","longitudeField"],"service")}write(e,t){return super.write(e,{...t,writeLayerSchema:!0})}clone(){throw new r.A("csv-layer:clone",`CSVLayer (title: ${this.title}, id: ${this.id}) cannot be cloned`)}async save(e){return w(this,"csv-layer:save")}async saveAs(e,t){return w(this,"csv-layer:save-as")}async hasDataChanged(){try{const{dataChanged:e,updates:t}=await this.source.refresh(this.customParameters);return null!=t&&this.read(t,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}_verifyFields(){}_verifySource(){}_hasMemorySource(){return!1}};(0,s._)([(0,l.MZ)({readOnly:!0,json:{read:!1,write:!1}})],M.prototype,"capabilities",void 0),(0,s._)([(0,l.MZ)({type:[","," ",";","|","\t"],json:{read:{source:"columnDelimiter"},write:{target:"columnDelimiter",ignoreOrigin:!0}}})],M.prototype,"delimiter",void 0),(0,s._)([(0,l.MZ)({readOnly:!0,type:Boolean,json:{origins:{"web-scene":{read:!1,write:!1}}}})],M.prototype,"editingEnabled",void 0),(0,s._)([(0,l.MZ)({json:{read:{source:"layerDefinition.fields"},write:{target:"layerDefinition.fields"}}})],M.prototype,"fields",void 0),(0,s._)([(0,l.MZ)({type:Boolean,readOnly:!0})],M.prototype,"isTable",null),(0,s._)([(0,c.w)("web-map","labelsVisible",["layerDefinition.drawingInfo.labelingInfo","showLabels"])],M.prototype,"readWebMapLabelsVisible",null),(0,s._)([(0,l.MZ)({type:String,json:{read:{source:"locationInfo.latitudeFieldName"},write:{target:"locationInfo.latitudeFieldName",ignoreOrigin:!0}}})],M.prototype,"latitudeField",void 0),(0,s._)([(0,l.MZ)({type:["show","hide"]})],M.prototype,"listMode",void 0),(0,s._)([(0,l.MZ)({type:["coordinates"],json:{read:{source:"locationInfo.locationType"},write:{target:"locationInfo.locationType",ignoreOrigin:!0,isRequired:!0}}})],M.prototype,"locationType",void 0),(0,s._)([(0,l.MZ)({type:String,json:{read:{source:"locationInfo.longitudeFieldName"},write:{target:"locationInfo.longitudeFieldName",ignoreOrigin:!0}}})],M.prototype,"longitudeField",void 0),(0,s._)([(0,l.MZ)({type:["CSV"]})],M.prototype,"operationalLayerType",void 0),(0,s._)([(0,l.MZ)()],M.prototype,"outFields",void 0),(0,s._)([(0,l.MZ)({type:String,json:{origins:{"web-scene":{read:!1,write:!1}},read:!1,write:!1}})],M.prototype,"path",void 0),(0,s._)([(0,l.MZ)({json:{read:!1},cast:null,type:f,readOnly:!0})],M.prototype,"source",void 0),(0,s._)([(0,l.MZ)({json:{read:!1},value:"csv",readOnly:!0})],M.prototype,"type",void 0),(0,s._)([(0,l.MZ)({json:{read:_.r,write:{isRequired:!0,ignoreOrigin:!0,writer:_.w}}})],M.prototype,"url",null),M=(0,s._)([(0,u.$)("esri.layers.CSVLayer")],M);const S=M},8485:(e,t,i)=>{i.r(t),i.d(t,{default:()=>W});var s=i(66866),r=i(56542),o=i(35775),n=i(40189),l=i(20909),a=i(21564),c=i(39831),u=i(539),d=(i(9272),i(63863)),p=i(84698),h=i(78983),y=i(12433),m=i(68833),g=i(98849),f=i(45307),v=i(90752),b=i(62802),_=i(20061),w=i(57822);let M=class extends f.A{constructor(){super(...arguments),this.type="geojson",this.refresh=(0,n.sg)((async e=>{await this.load();const{extent:t,timeExtent:i}=await this._connection.invoke("refresh",e);return this.sourceJSON.extent=t,i&&(this.sourceJSON.timeInfo.timeExtent=[i.start,i.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}}))}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}applyEdits(e){return this.load().then((()=>this._applyEdits(e)))}openPorts(){return this.load().then((()=>this._connection.openPorts()))}queryFeatures(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,t))).then((e=>w.A.fromJSON(e)))}queryFeaturesJSON(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,t)))}queryFeatureCount(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)))}queryObjectIds(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)))}queryExtent(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t))).then((e=>({count:e.count,extent:p.A.fromJSON(e.extent)})))}querySnapping(e,t={}){return this.load(t).then((()=>this._connection.invoke("querySnapping",e,t)))}async queryAttributeBins(e,t={}){return await this.load(),this._connection.invoke("queryAttributeBins",e?.toJSON(),t)}_applyEdits(e){if(!this._connection)throw new g.A("geojson-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField,i=[],s=[],r=[];if(e.addFeatures)for(const o of e.addFeatures)i.push(this._serializeFeature(o));if(e.deleteFeatures)for(const o of e.deleteFeatures)"objectId"in o&&null!=o.objectId?s.push(o.objectId):"attributes"in o&&null!=o.attributes[t]&&s.push(o.attributes[t]);if(e.updateFeatures)for(const o of e.updateFeatures)r.push(this._serializeFeature(o));return this._connection.invoke("applyEdits",{adds:i,updates:r,deletes:s}).then((({extent:e,timeExtent:t,featureEditResults:i})=>(this.sourceJSON.extent=e,t&&(this.sourceJSON.timeInfo.timeExtent=[t.start,t.end]),this._createEditsResult(i))))}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:""};return{objectId:e.objectId,globalId:e.globalId,error:t?new g.A("geojson-layer-source:edit-failure",t.description,{code:t.code}):null}}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e);return i?{geometry:i.toJSON(),attributes:t}:{attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return null==t?null:"mesh"===t.type||"extent"===t.type?b.A.fromExtent(t.extent):t}async _startWorker(e){this._connection=await(0,v.ho)("GeoJSONSourceWorker",{strategy:(0,c.A)("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:t,spatialReference:i,hasZ:s,geometryType:r,objectIdField:o,url:n,timeInfo:l,customParameters:a}=this.layer,d="defaults"===this.layer.originOf("spatialReference"),p={url:n,customParameters:a,fields:t&&t.map((e=>e.toJSON())),geometryType:y.gy.toJSON(r),hasZ:s,objectIdField:o,timeInfo:l?l.toJSON():null,spatialReference:d?null:i&&i.toJSON()},h=await this._connection.invoke("load",p,{signal:e});for(const c of h.warnings)u.A.getLogger(this.layer).warn("#load()",`${c.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:c});h.featureErrors.length&&u.A.getLogger(this.layer).warn("#load()",`Encountered ${h.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:h.featureErrors}),this.sourceJSON=h.layerDefinition,this.capabilities=(0,_.f)(this.sourceJSON.hasZ,!0)}};(0,s._)([(0,a.MZ)()],M.prototype,"capabilities",void 0),(0,s._)([(0,a.MZ)()],M.prototype,"type",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],M.prototype,"layer",void 0),(0,s._)([(0,a.MZ)()],M.prototype,"sourceJSON",void 0),M=(0,s._)([(0,d.$)("esri.layers.graphics.sources.GeoJSONSource")],M);var S=i(15305),L=i(16161),I=i(54576),A=i(15053),x=i(94783),C=i(41506),T=i(30111),E=i(34722),F=i(50508),R=i(25389),Z=i(90826),O=i(40021),P=i(76592),k=i(52506),D=i(48330),N=i(24738),$=i(77567),V=i(42453),B=i(61826),j=i(79682),G=i(53835),z=i(14474),K=i(44116),U=i(12129);const q=(0,$.p)();let H=class extends((0,T.fY)((0,I.FJ)((0,L.d)((0,x.J)((0,A.F)((0,S.dM)((0,Z.e)((0,O.d)((0,R.j)((0,F.J)((0,C.q)((0,E.A)((0,o.P)(m.A)))))))))))))){constructor(e){super(e),this.attributeTableTemplate=null,this.copyright=null,this.dateFieldsTimeZone=null,this.definitionExpression=null,this.displayField=null,this.editingEnabled=!1,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="GeoJSON",this.outFields=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new M({layer:this}),this.spatialReference=h.A.WGS84,this.templates=null,this.title="GeoJSON",this.type="geojson"}destroy(){this.source?.destroy()}load(e){const t=this.loadFromPortal({supportedTypes:["GeoJson"],supportsData:!1},e).catch(n.QP).then((()=>this.source.load(e))).then((()=>{this.read(this.source.sourceJSON,{origin:"service",url:this.parsedUrl}),this.revert(["objectIdField","fields","timeInfo"],"service"),(0,V.yp)(this.renderer,this.fieldsIndex),(0,V.sv)(this.timeInfo,this.fieldsIndex)}));return this.addResolvingPromise(t),Promise.resolve(this)}get capabilities(){return this.source?this.source.capabilities:null}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}get isTable(){return this.loaded&&null==this.geometryType}get parsedUrl(){return this.url?(0,l.An)(this.url):null}set renderer(e){(0,V.yp)(e,this.fieldsIndex),this._set("renderer",e)}set url(e){if(!e)return void this._set("url",e);const t=(0,l.An)(e);this._set("url",t.path),t.query&&(this.customParameters={...this.customParameters,...t.query})}async applyEdits(e,t){const{applyEdits:s}=await i.e(75903).then(i.bind(i,75903));await this.load();const r=await s(this,this.source,e,t);return this.read({extent:this.source.sourceJSON.extent,timeInfo:this.source.sourceJSON.timeInfo},{origin:"service",ignoreDefaults:!0}),r}on(e,t){return super.on(e,t)}createPopupTemplate(e){return(0,K.tn)(this,e)}createQuery(){const e=new z.A,t=this.capabilities?.data;e.returnGeometry=!0,t&&t.supportsZ&&(e.returnZ=!0),e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:i,timeExtent:s}=this;return e.timeExtent=null!=i&&null!=s?s.offset(-i.value,i.unit):s||null,e}getFieldDomain(e,t){return this.getField(e)?.domain}getField(e){return this.fieldsIndex.get(e)}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(z.A.from(e)||this.createQuery(),t))).then((e=>{if(e?.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this.load().then((()=>this.source.queryObjectIds(z.A.from(e)||this.createQuery(),t)))}queryFeatureCount(e,t){return this.load().then((()=>this.source.queryFeatureCount(z.A.from(e)||this.createQuery(),t)))}queryExtent(e,t){return this.load().then((()=>this.source.queryExtent(z.A.from(e)||this.createQuery(),t)))}async queryAttributeBins(e,t){const{source:s,capabilities:r}=await this.load();(0,k.ZJ)(e,r,"GeoJSONLayer");const o=await Promise.all([i.e(72076),i.e(45970)]).then(i.bind(i,45970)),n=await s.queryAttributeBins(o.default.from(e),t);if(n.features)for(const i of n.features)i.layer=i.sourceLayer=this;return n}async hasDataChanged(){try{const{dataChanged:e,updates:t}=await this.source.refresh(this.customParameters);return null!=t&&this.read(t,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}};(0,s._)([(0,a.MZ)(P.zQ)],H.prototype,"attributeTableTemplate",void 0),(0,s._)([(0,a.MZ)({readOnly:!0,json:{read:!1,write:!1}})],H.prototype,"capabilities",null),(0,s._)([(0,a.MZ)({type:String})],H.prototype,"copyright",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],H.prototype,"createQueryVersion",null),(0,s._)([(0,a.MZ)((0,U.P6)("dateFieldsTimeReference"))],H.prototype,"dateFieldsTimeZone",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],H.prototype,"defaultPopupTemplate",null),(0,s._)([(0,a.MZ)({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],H.prototype,"definitionExpression",void 0),(0,s._)([(0,a.MZ)({type:String})],H.prototype,"displayField",void 0),(0,s._)([(0,a.MZ)({type:Boolean})],H.prototype,"editingEnabled",void 0),(0,s._)([(0,a.MZ)(P.Yj)],H.prototype,"elevationInfo",void 0),(0,s._)([(0,a.MZ)({type:[N.A],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],H.prototype,"fields",void 0),(0,s._)([(0,a.MZ)(q.fieldsIndex)],H.prototype,"fieldsIndex",void 0),(0,s._)([(0,a.MZ)({type:p.A,json:{name:"extent"}})],H.prototype,"fullExtent",void 0),(0,s._)([(0,a.MZ)({type:["point","polygon","polyline","multipoint"],json:{read:{reader:y.gy.read}}})],H.prototype,"geometryType",void 0),(0,s._)([(0,a.MZ)({type:Boolean})],H.prototype,"hasZ",void 0),(0,s._)([(0,a.MZ)(P.id)],H.prototype,"id",void 0),(0,s._)([(0,a.MZ)({type:Boolean,readOnly:!0})],H.prototype,"isTable",null),(0,s._)([(0,a.MZ)(P.kF)],H.prototype,"labelsVisible",void 0),(0,s._)([(0,a.MZ)({type:[B.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:j.w},write:!0}})],H.prototype,"labelingInfo",void 0),(0,s._)([(0,a.MZ)(P.fV)],H.prototype,"legendEnabled",void 0),(0,s._)([(0,a.MZ)({type:["show","hide"]})],H.prototype,"listMode",void 0),(0,s._)([(0,a.MZ)({type:String,json:{name:"layerDefinition.objectIdField",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"objectIdField"}}}})],H.prototype,"objectIdField",void 0),(0,s._)([(0,a.MZ)(P.ke)],H.prototype,"opacity",void 0),(0,s._)([(0,a.MZ)({type:["GeoJSON"]})],H.prototype,"operationalLayerType",void 0),(0,s._)([(0,a.MZ)(q.outFields)],H.prototype,"outFields",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],H.prototype,"parsedUrl",null),(0,s._)([(0,a.MZ)(P.M6)],H.prototype,"popupEnabled",void 0),(0,s._)([(0,a.MZ)({type:r.A,json:{name:"popupInfo",write:!0}})],H.prototype,"popupTemplate",void 0),(0,s._)([(0,a.MZ)({types:G.Hg,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{name:"drawingInfo.renderer"},"web-scene":{types:G.XJ}}}})],H.prototype,"renderer",null),(0,s._)([(0,a.MZ)(P.PY)],H.prototype,"screenSizePerspectiveEnabled",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],H.prototype,"source",void 0),(0,s._)([(0,a.MZ)({type:h.A})],H.prototype,"spatialReference",void 0),(0,s._)([(0,a.MZ)({type:[D.A]})],H.prototype,"templates",void 0),(0,s._)([(0,a.MZ)()],H.prototype,"title",void 0),(0,s._)([(0,a.MZ)({json:{read:!1},readOnly:!0})],H.prototype,"type",void 0),(0,s._)([(0,a.MZ)(P.OZ)],H.prototype,"url",null),H=(0,s._)([(0,d.$)("esri.layers.GeoJSONLayer")],H);const W=H},19062:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Z});var s,r=i(66866),o=i(48982),n=i(14798),l=i(35775),a=i(40189),c=i(85251),u=i(20909),d=i(21564),p=(i(39831),i(539),i(9272),i(75094)),h=i(63863),y=i(77542),m=i(84698),g=i(78983),f=i(68833),v=i(15305),b=i(41506),_=i(34722),w=i(50508),M=i(25389),S=i(76592),L=i(17306),I=i(21877),A=i(45307),x=i(96274),C=i(73446),T=i(78521);let E=s=class extends(L.A.EventedMixin(I.A.JSONSupportMixin(A.A))){constructor(...e){super(...e),this.description=null,this.fullExtent=null,this.id=null,this.networkLink=null,this.parent=null,this.sublayers=null,this.title=null,this.sourceJSON=null,this.layer=null,this.addHandles([(0,c.on)((()=>this.sublayers),"after-add",(({item:e})=>{e.parent=this,e.layer=this.layer}),c.OH),(0,c.on)((()=>this.sublayers),"after-remove",(({item:e})=>{e.layer=e.parent=null}),c.OH),(0,c.wB)((()=>this.sublayers),((e,t)=>{if(t)for(const i of t)i.layer=i.parent=null;if(e)for(const i of e)i.parent=this,i.layer=this.layer}),c.OH),(0,c.wB)((()=>this.layer),(e=>{if(this.sublayers)for(const t of this.sublayers)t.layer=e}),c.OH)])}initialize(){(0,c.C_)((()=>this.networkLink)).then((()=>(0,c.C_)((()=>!0===this.visible)))).then((()=>this.load()))}load(e){if(!this.networkLink)return;if(this.networkLink.viewFormat)return;const t=null!=e?e.signal:null,i=this._fetchService(this._get("networkLink")?.href??"",t).then((e=>{const t=(0,T.Qm)(e.sublayers);this.fullExtent=m.A.fromJSON(t),this.sourceJSON=e;const i=(0,C.dp)(o.A.ofType(s),(0,T.Jy)(s,e));this.sublayers?this.sublayers.addMany(i):this.sublayers=i,this.layer?.emit("sublayer-update"),this.layer&&this.layer.notifyChange("visibleSublayers")}));return this.addResolvingPromise(i),Promise.resolve(this)}get visible(){return this._get("visible")}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this.layer&&this.layer.notifyChange("visibleSublayers"))}readVisible(e,t){return!!t.visibility}_fetchService(e,t){return(0,T.Ox)(e,this.layer.outSpatialReference,this.layer.refreshInterval,t).then((e=>(0,T._4)(e.data)))}};(0,r._)([(0,d.MZ)()],E.prototype,"description",void 0),(0,r._)([(0,d.MZ)({type:m.A})],E.prototype,"fullExtent",void 0),(0,r._)([(0,d.MZ)()],E.prototype,"id",void 0),(0,r._)([(0,d.MZ)({readOnly:!0,value:null})],E.prototype,"networkLink",void 0),(0,r._)([(0,d.MZ)({json:{write:{allowNull:!0}}})],E.prototype,"parent",void 0),(0,r._)([(0,d.MZ)({type:o.A.ofType(E),json:{write:{allowNull:!0}}})],E.prototype,"sublayers",void 0),(0,r._)([(0,d.MZ)({value:null,json:{read:{source:"name",reader:e=>(0,x._e)(e)}}})],E.prototype,"title",void 0),(0,r._)([(0,d.MZ)({value:!0})],E.prototype,"visible",null),(0,r._)([(0,p.w)("visible",["visibility"])],E.prototype,"readVisible",null),(0,r._)([(0,d.MZ)()],E.prototype,"sourceJSON",void 0),(0,r._)([(0,d.MZ)()],E.prototype,"layer",void 0),E=s=(0,r._)([(0,h.$)("esri.layers.support.KMLSublayer")],E);const F=["kml","xml"];let R=class extends((0,v.dM)((0,w.J)((0,M.j)((0,b.q)((0,_.A)((0,l.P)(f.A))))))){constructor(...e){super(...e),this._visibleFolders=[],this.allSublayers=new n.A({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.sublayers}),this.outSpatialReference=g.A.WGS84,this.path=null,this.legendEnabled=!1,this.operationalLayerType="KML",this.sublayers=null,this.type="kml",this.url=null}initialize(){this.addHandles([(0,c.wB)((()=>this.sublayers),((e,t)=>{t&&t.forEach((e=>{e.parent=null,e.layer=null})),e&&e.forEach((e=>{e.parent=this,e.layer=this}))}),c.OH),this.on("sublayer-update",(()=>this.notifyChange("fullExtent")))])}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}readSublayersFromItemOrWebMap(e,t){this._visibleFolders=t.visibleFolders}readSublayers(e,t,i){return(0,T.Jy)(E,t,i,this._visibleFolders)}writeSublayers(e,t){const i=[],s=e.toArray();for(;s.length;){const e=s[0];e.networkLink||(e.visible&&i.push(e.id),e.sublayers&&s.push(...e.sublayers.toArray())),s.shift()}t.visibleFolders=i}get title(){const e=this._get("title");return e&&"defaults"!==this.originOf("title")?e:this.url?(0,u.e7)(this.url,F)||"KML":e}set title(e){this._set("title",e)}get visibleSublayers(){const e=this.sublayers,t=[],i=e=>{e.visible&&(t.push(e),e.sublayers&&e.sublayers.forEach(i))};return e&&e.forEach(i),t}get fullExtent(){return this._recomputeFullExtent()}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["KML"],supportsData:!1},e).catch(a.QP).then((()=>this._fetchService(t)))),Promise.resolve(this)}destroy(){super.destroy(),this.allSublayers.destroy()}async _fetchService(e){const t=await Promise.resolve().then((()=>this.resourceInfo?{ssl:!1,data:this.resourceInfo}:(0,T.Ox)(this.url??"",this.outSpatialReference,this.refreshInterval,e))),i=(0,T._4)(t.data);i&&this.read(i,{origin:"service"})}_recomputeFullExtent(){let e=null;null!=this.extent&&(e=this.extent.clone());const t=i=>{if(i.sublayers)for(const s of i.sublayers.items)t(s),s.visible&&s.fullExtent&&(null!=e?e.union(s.fullExtent):e=s.fullExtent.clone())};return t(this),e}};(0,r._)([(0,d.MZ)({readOnly:!0})],R.prototype,"allSublayers",void 0),(0,r._)([(0,d.MZ)({type:g.A})],R.prototype,"outSpatialReference",void 0),(0,r._)([(0,d.MZ)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],R.prototype,"path",void 0),(0,r._)([(0,d.MZ)({readOnly:!0,json:{read:!1,write:!1}})],R.prototype,"legendEnabled",void 0),(0,r._)([(0,d.MZ)({type:["show","hide","hide-children"]})],R.prototype,"listMode",void 0),(0,r._)([(0,d.MZ)({type:["KML"]})],R.prototype,"operationalLayerType",void 0),(0,r._)([(0,d.MZ)({})],R.prototype,"resourceInfo",void 0),(0,r._)([(0,d.MZ)({type:o.A.ofType(E),json:{write:{ignoreOrigin:!0}}})],R.prototype,"sublayers",void 0),(0,r._)([(0,p.w)(["web-map","portal-item"],"sublayers",["visibleFolders"])],R.prototype,"readSublayersFromItemOrWebMap",null),(0,r._)([(0,p.w)("service","sublayers",["sublayers"])],R.prototype,"readSublayers",null),(0,r._)([(0,y.K)("sublayers")],R.prototype,"writeSublayers",null),(0,r._)([(0,d.MZ)({readOnly:!0,json:{read:!1}})],R.prototype,"type",void 0),(0,r._)([(0,d.MZ)({json:{origins:{"web-map":{read:{source:"title"}}},write:{ignoreOrigin:!0}}})],R.prototype,"title",null),(0,r._)([(0,d.MZ)(S.OZ)],R.prototype,"url",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],R.prototype,"visibleSublayers",null),(0,r._)([(0,d.MZ)({type:m.A})],R.prototype,"extent",void 0),(0,r._)([(0,d.MZ)()],R.prototype,"fullExtent",null),R=(0,r._)([(0,h.$)("esri.layers.KMLLayer")],R);const Z=R},11330:(e,t,i)=>{i.r(t),i.d(t,{default:()=>B});var s=i(66866),r=i(86394),o=i(98849),n=i(6412),l=i(35775),a=i(40189),c=i(21564),u=i(73446),d=(i(39831),i(9272),i(75094)),p=i(63863),h=i(77542),y=i(94255),m=i(84698),g=i(61781),f=i(87926),v=i(68833),b=i(50193),_=i(47217),w=i(45681),M=i(15305),S=i(16161),L=i(41506),I=i(34722),A=i(50508),x=i(25389),C=i(2178),T=i(90826),E=i(76592),F=i(10109),R=i(52775),Z=i(68619),O=i(29306),P=i(93797),k=i(60973),D=i(17197),N=i(12129),$=i(15954);let V=class extends((0,M.dM)((0,T.e)((0,x.j)((0,C.I)((0,_.V)((0,w.b)((0,L.q)((0,I.A)((0,l.P)((0,A.J)((0,b.p)((0,S.d)(v.A))))))))))))){constructor(...e){super(...e),this._exportImageParameters=new F.g({layer:this}),this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.dpi=96,this.elevationInfo=new k.A({mode:"on-the-ground"}),this.gdbVersion=null,this.imageFormat="png24",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType="ArcGISMapServiceLayer",this.preferredTimeZone=null,this.sourceJSON=null,this.sublayers=null,this.type="map-image",this.url=null,this._debouncedSaveOperations=(0,a.sg)((async(e,t,s)=>{const{save:r,saveAs:o}=await i.e(92373).then(i.bind(i,92373));switch(e){case $.X.SAVE:return r(this,t);case $.X.SAVE_AS:return o(this,s,t)}}))}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(a.QP).then((()=>this._fetchService(t)))),Promise.resolve(this)}destroy(){this._exportImageParameters.destroy()}readImageFormat(e,t){const i=t.supportedImageFormatTypes;return i&&i.includes("PNG32")?"png32":"png24"}writeSublayers(e,t,i,s){if(!this.loaded||!e)return;const r=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let o=!1;const n=(0,y.aB)(s.origin);let l;if(this.capabilities?.operations.supportsExportMap&&this.capabilities?.exportMap?.supportsDynamicLayers)if(n===y.Gr.PORTAL_ITEM){const e=this.createSublayersForOrigin("service").sublayers;o=(0,O.Zx)(r,e,y.Gr.SERVICE)}else if(n>y.Gr.PORTAL_ITEM){const e=this.createSublayersForOrigin("portal-item");o=(0,O.Zx)(r,e.sublayers,(0,y.aB)(e.origin)),l=e.originWithPartialOverrides}const a=[],c={writeSublayerStructure:o,...s,minimumWritableOrigin:l};let u=o||this.hasVisibleLayersForOrigin(n);r.forEach((e=>{const t=e.write({},c);a.push(t),u=u||"user"===e.originOf("visible")})),a.some((e=>Object.keys(e).length>1))&&(t.layers=a),u&&(t.visibleLayers=r.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,t,i,s){const r=s?.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian()),this._exportImageParameters.floors=s?.floors??null,this._exportImageParameters.scale=(0,g.X_)({extent:e,width:t})*r;const o=this._exportImageParameters.toJSON(),n=!s?.rotation||this.version<10.3?{}:{rotation:-s.rotation},l=e?.spatialReference,a=(0,f.YX)(l);o.dpi*=r;const c={};if(s?.timeExtent){const{start:e,end:t}=s.timeExtent.toJSON();c.time=e&&t&&e===t?""+e:`${e??"null"},${t??"null"}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(c.time="null,null");return{bbox:e?e.xmin+","+e.ymin+","+e.xmax+","+e.ymax:void 0,bboxSR:a,imageSR:a,size:t+","+i,...o,...n,...c}}async fetchImage(e,t,i,s){const{data:r}=await this._fetchImage("image",e,t,i,s);return r}async fetchImageBitmap(e,t,i,s){const{data:r,url:o}=await this._fetchImage("blob",e,t,i,s);return(0,R.m)(r,o,s?.signal)}async fetchRecomputedExtents(e={}){const t={...e,query:{returnUpdates:!0,f:"json",...this.customParameters,token:this.apiKey}},{data:i}=await(0,r.A)(this.url,t),{extent:s,fullExtent:o,timeExtent:n}=i,l=s||o;return{fullExtent:l&&m.A.fromJSON(l),timeExtent:n&&D.T.fromJSON({start:n[0],end:n[1]})}}loadAll(){return(0,n.g)(this,(e=>{e(this.allSublayers),e(this.subtables)}))}async save(e){return this._debouncedSaveOperations($.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations($.X.SAVE_AS,t,e)}serviceSupportsSpatialReference(e){return(0,P.D)(this,e)}async _fetchImage(e,t,i,s,n){const l={responseType:e,signal:n?.signal??null,query:{...this.parsedUrl.query,...this.createExportImageParameters(t,i,s,n),f:"image",...this.refreshParameters,...this.customParameters,token:this.apiKey}},c=this.parsedUrl.path+"/export";if(null!=l.query?.dynamicLayers&&!this.capabilities?.exportMap?.supportsDynamicLayers)throw new o.A("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:l.query});try{const{data:e}=await(0,r.A)(c,l);return{data:e,url:c}}catch(u){if((0,a.zf)(u))throw u;throw new o.A("mapimagelayer:image-fetch-error",`Unable to load image: ${c}`,{error:u})}}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});const{data:t,ssl:i}=await(0,r.A)(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:e});i&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=t,this.read(t,{origin:"service",url:this.parsedUrl})}hasVisibleLayersForOrigin(e){return!(null==e||!this.sublayersSourceJSON[e]?.visibleLayers)}};(0,s._)([(0,c.MZ)((0,N.P6)("dateFieldsTimeReference"))],V.prototype,"dateFieldsTimeZone",void 0),(0,s._)([(0,c.MZ)({type:Boolean})],V.prototype,"datesInUnknownTimezone",void 0),(0,s._)([(0,c.MZ)()],V.prototype,"dpi",void 0),(0,s._)([(0,c.MZ)()],V.prototype,"elevationInfo",void 0),(0,s._)([(0,c.MZ)()],V.prototype,"gdbVersion",void 0),(0,s._)([(0,c.MZ)()],V.prototype,"imageFormat",void 0),(0,s._)([(0,d.w)("imageFormat",["supportedImageFormatTypes"])],V.prototype,"readImageFormat",null),(0,s._)([(0,c.MZ)({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],V.prototype,"imageMaxHeight",void 0),(0,s._)([(0,c.MZ)({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],V.prototype,"imageMaxWidth",void 0),(0,s._)([(0,c.MZ)()],V.prototype,"imageTransparency",void 0),(0,s._)([(0,c.MZ)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],V.prototype,"isReference",void 0),(0,s._)([(0,c.MZ)({json:{read:!1,write:!1}})],V.prototype,"labelsVisible",void 0),(0,s._)([(0,c.MZ)({type:["ArcGISMapServiceLayer"]})],V.prototype,"operationalLayerType",void 0),(0,s._)([(0,c.MZ)({json:{read:!1,write:!1}})],V.prototype,"popupEnabled",void 0),(0,s._)([(0,c.MZ)((0,N.P6)("preferredTimeReference"))],V.prototype,"preferredTimeZone",void 0),(0,s._)([(0,c.MZ)()],V.prototype,"sourceJSON",void 0),(0,s._)([(0,c.MZ)({json:{write:{ignoreOrigin:!0}}})],V.prototype,"sublayers",void 0),(0,s._)([(0,h.K)("sublayers",{layers:{type:[Z.A]},visibleLayers:{type:[u.jz]}})],V.prototype,"writeSublayers",null),(0,s._)([(0,c.MZ)({type:["show","hide","hide-children"],json:{origins:{"portal-item":{read:!1,write:!1}}}})],V.prototype,"listMode",void 0),(0,s._)([(0,c.MZ)({json:{read:!1},readOnly:!0,value:"map-image"})],V.prototype,"type",void 0),(0,s._)([(0,c.MZ)(E.OZ)],V.prototype,"url",void 0),V=(0,s._)([(0,p.$)("esri.layers.MapImageLayer")],V);const B=V},28820:(e,t,i)=>{i.r(t),i.d(t,{default:()=>z});var s=i(66866),r=i(56542),o=i(98849),n=i(35775),l=i(21564),a=(i(39831),i(539),i(9272),i(63863)),c=i(84698),u=i(78983),d=i(12433),p=i(68833),h=i(45307),y=i(96274),m=i(83650),g=i(97934),f=i(57822);let v=class extends h.A{constructor(){super(...arguments),this.featureDefinition=null,this.type="ogc-feature"}load(e){return this.addResolvingPromise(this._loadOGCServices(this.layer,e)),this.when()}getSource(){const{featureDefinition:{collection:e,layerDefinition:t,spatialReference:i,supportedCrs:s},layer:{apiKey:r,customParameters:o,effectiveMaxRecordCount:n}}=this;return{type:"ogc-source",collection:e,layerDefinition:t,maxRecordCount:n,queryParameters:{apiKey:r,customParameters:o},spatialReference:i,supportedCrs:s}}queryExtent(e,t={}){return null}queryFeatureCount(e,t={}){return null}queryFeatures(e,t={}){return this.queryFeaturesJSON(e,t).then((e=>f.A.fromJSON(e)))}queryFeaturesJSON(e,t={}){const i=this.getSource();return this.load(t).then((()=>(0,m.bW)(i,e,t)))}queryObjectIds(e,t={}){return null}serviceSupportsSpatialReference(e){return!(!e.isWGS84&&!e.isWebMercator&&!this.featureDefinition.supportedCrs[e.wkid])}_conformsToType(e,t){const i=new RegExp(`^${(0,y.Cj)(t)}$`,"i");return e.conformsTo.some((e=>i.test(e)))??!1}_getCapabilities(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryBins:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},query:{maxRecordCount:t,maxRecordCountFactor:void 0,maxUniqueIDCount:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsCurrentUser:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPaginationOnAggregatedQueries:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsReturnMesh:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,supportsSqlExpression:!1,supportsTrueCurve:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:g.$,editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}_getMaxRecordCount(e){const t=e?.components?.parameters;return t?.limit?.schema?.maximum??t?.limitFeatures?.schema?.maximum}_getStorageSpatialReference(e){const t=e.storageCrs??m.QE,i=(0,m.J0)(t);return null==i?u.A.WGS84:new u.A({wkid:i})}_getSupportedSpatialReferences(e,t){const i="#/crs",s=e.crs??[m.QE],r=s.includes(i)?s.filter((e=>e!==i)).concat(t.crs??[]):s,o=/^http:\/\/www\.opengis.net\/def\/crs\/epsg\/.*\/3785$/i;return r.filter((e=>!o.test(e)))}async _loadOGCServices(e,t){const i=null!=t?t.signal:null,{apiKey:s,collectionId:r,customParameters:n,fields:l,geometryType:a,hasZ:c,objectIdField:u,timeInfo:p,url:h}=e,g={fields:l?.map((e=>e.toJSON())),geometryType:d.Ye.toJSON(a),hasZ:c??!1,objectIdField:u,timeInfo:p?.toJSON()},f={apiKey:s,customParameters:n,signal:i},v=await(0,m.Ki)(h,f),[b,_]=await Promise.all([(0,m.Px)(v,f),(0,m.bV)(v,f)]);if(!this._conformsToType(b,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson"))throw new o.A("ogc-feature-layer:no-geojson-support","Server does not support geojson");const w=_.collections.find((({id:e})=>e===r));if(!w)throw new o.A("ogc-feature-layer:collection-not-found","Server does not contain the named collection");const M=this._conformsToType(b,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30")?await(0,m.GA)(v,f):null,S=await(0,m.GL)(w,g,f),L=this._getMaxRecordCount(M),I=this._getCapabilities(S.hasZ,L),A=this._getStorageSpatialReference(w).toJSON(),x=this._getSupportedSpatialReferences(w,_),C=new RegExp(`^${(0,y.Cj)(m.vJ)}`,"i"),T={};for(const o of x){const e=(0,m.J0)(o);null!=e&&(T[e]||(T[e]=o.replace(C,"")))}this.featureDefinition={capabilities:I,collection:w,layerDefinition:S,spatialReference:A,supportedCrs:T}}};(0,s._)([(0,l.MZ)()],v.prototype,"featureDefinition",void 0),(0,s._)([(0,l.MZ)({constructOnly:!0})],v.prototype,"layer",void 0),(0,s._)([(0,l.MZ)()],v.prototype,"type",void 0),v=(0,s._)([(0,a.$)("esri.layers.graphics.sources.OGCFeatureSource")],v);var b=i(50193),_=i(15305),w=i(16161),M=i(54576),S=i(15053),L=i(94783),I=i(41506),A=i(30111),x=i(34722),C=i(50508),T=i(25389),E=i(90826),F=i(40021),R=i(76592),Z=i(25392),O=i(24738),P=i(77567),k=i(42453),D=i(61826),N=i(79682),$=i(53835),V=i(14474),B=i(44116);const j=(0,P.p)();let G=class extends((0,M.FJ)((0,b.p)((0,w.d)((0,L.J)((0,S.F)((0,_.dM)((0,A.fY)((0,E.e)((0,F.d)((0,T.j)((0,I.q)((0,x.A)((0,C.J)((0,n.P)(p.A))))))))))))))){constructor(e){super(e),this.capabilities=null,this.collectionId=null,this.copyright=null,this.description=null,this.displayField=null,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.maxRecordCount=null,this.objectIdField=null,this.operationalLayerType="OGCFeatureLayer",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new v({layer:this}),this.spatialReference=null,this.title=null,this.type="ogc-feature",this.typeIdField=null,this.types=null,this.url=null}destroy(){this.source?.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["OGCFeatureServer"]},e).then((()=>this._fetchService(e)))),this.when()}get defaultPopupTemplate(){return this.createPopupTemplate()}get effectiveMaxRecordCount(){return this.maxRecordCount??this.capabilities?.query.maxRecordCount??5e3}get isTable(){return this.loaded&&null==this.geometryType}set renderer(e){(0,k.yp)(e,this.fieldsIndex),this._set("renderer",e)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return(0,B.tn)(this,e)}createQuery(){return new V.A}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){let i,s=!1;const r=t?.feature?.attributes,o=this.typeIdField&&r?.[this.typeIdField];return null!=o&&this.types&&(s=this.types.some((t=>t.id==o&&(i=t.domains?.[e],"inherited"===i?.type&&(i=this._getLayerDomain(e)),!0)))),s||i||(i=this._getLayerDomain(e)),i}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(V.A.from(e)||this.createQuery(),t))).then((e=>(e?.features?.forEach((e=>{e.layer=e.sourceLayer=this})),e)))}async queryAttributeBins(e,t){throw new o.A("OGCFeatureLayer","Layer source does not support queryAttributeBins capability")}serviceSupportsSpatialReference(e){return this.source?.serviceSupportsSpatialReference(e)??!1}async _fetchService(e){await this.source.load(e),this.read(this.source.featureDefinition,{origin:"service"}),(0,k.yp)(this.renderer,this.fieldsIndex),(0,k.sv)(this.timeInfo,this.fieldsIndex)}_getLayerDomain(e){if(!this.fields)return null;for(const t of this.fields)if(t.name===e&&t.domain)return t.domain;return null}};(0,s._)([(0,l.MZ)({readOnly:!0,json:{origins:{service:{read:!0}}}})],G.prototype,"capabilities",void 0),(0,s._)([(0,l.MZ)({type:String,json:{write:!0}})],G.prototype,"collectionId",void 0),(0,s._)([(0,l.MZ)({type:String})],G.prototype,"copyright",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],G.prototype,"defaultPopupTemplate",null),(0,s._)([(0,l.MZ)({readOnly:!0,type:String,json:{origins:{service:{name:"collection.description"}}}})],G.prototype,"description",void 0),(0,s._)([(0,l.MZ)({type:String})],G.prototype,"displayField",void 0),(0,s._)([(0,l.MZ)({type:Number})],G.prototype,"effectiveMaxRecordCount",null),(0,s._)([(0,l.MZ)(R.Yj)],G.prototype,"elevationInfo",void 0),(0,s._)([(0,l.MZ)({type:[O.A],json:{origins:{service:{name:"layerDefinition.fields"}}}})],G.prototype,"fields",void 0),(0,s._)([(0,l.MZ)(j.fieldsIndex)],G.prototype,"fieldsIndex",void 0),(0,s._)([(0,l.MZ)({readOnly:!0,type:c.A,json:{origins:{service:{name:"layerDefinition.extent"}}}})],G.prototype,"fullExtent",void 0),(0,s._)([(0,l.MZ)({type:d.gy.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:d.gy.read}}}}})],G.prototype,"geometryType",void 0),(0,s._)([(0,l.MZ)({type:Boolean,json:{origins:{service:{name:"layerDefinition.hasZ"}}}})],G.prototype,"hasZ",void 0),(0,s._)([(0,l.MZ)({type:Boolean,readOnly:!0})],G.prototype,"isTable",null),(0,s._)([(0,l.MZ)({type:[D.A],json:{origins:{"web-document":{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:N.w},write:!0}}}})],G.prototype,"labelingInfo",void 0),(0,s._)([(0,l.MZ)(R.kF)],G.prototype,"labelsVisible",void 0),(0,s._)([(0,l.MZ)(R.fV)],G.prototype,"legendEnabled",void 0),(0,s._)([(0,l.MZ)({type:Number})],G.prototype,"maxRecordCount",void 0),(0,s._)([(0,l.MZ)({type:String,json:{origins:{service:{name:"layerDefinition.objectIdField"}}}})],G.prototype,"objectIdField",void 0),(0,s._)([(0,l.MZ)({type:["OGCFeatureLayer"]})],G.prototype,"operationalLayerType",void 0),(0,s._)([(0,l.MZ)(R.M6)],G.prototype,"popupEnabled",void 0),(0,s._)([(0,l.MZ)({type:r.A,json:{name:"popupInfo",write:!0}})],G.prototype,"popupTemplate",void 0),(0,s._)([(0,l.MZ)({types:$.Hg,json:{origins:{service:{name:"layerDefinition.drawingInfo.renderer",write:!1},"web-scene":{types:$.XJ,name:"layerDefinition.drawingInfo.renderer",write:!0}},name:"layerDefinition.drawingInfo.renderer",write:!0}})],G.prototype,"renderer",null),(0,s._)([(0,l.MZ)(R.PY)],G.prototype,"screenSizePerspectiveEnabled",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],G.prototype,"source",void 0),(0,s._)([(0,l.MZ)({readOnly:!0,type:u.A,json:{origins:{service:{read:!0}}}})],G.prototype,"spatialReference",void 0),(0,s._)([(0,l.MZ)({type:String,json:{write:{enabled:!0,ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"collection.title"}}}})],G.prototype,"title",void 0),(0,s._)([(0,l.MZ)({readOnly:!0,json:{read:!1}})],G.prototype,"type",void 0),(0,s._)([(0,l.MZ)({type:String,readOnly:!0})],G.prototype,"typeIdField",void 0),(0,s._)([(0,l.MZ)({type:[Z.A]})],G.prototype,"types",void 0),(0,s._)([(0,l.MZ)(R.OZ)],G.prototype,"url",void 0),G=(0,s._)([(0,a.$)("esri.layers.OGCFeatureLayer")],G);const z=G},9287:(e,t,i)=>{i.r(t),i.d(t,{default:()=>xe});var s=i(66866),r=i(25707),o=i(56542),n=i(24793),l=i(48982),a=i(98849),c=i(20464),u=i(539),d=i(6267),p=i(35775),h=i(40189),y=i(85251),m=i(21564),g=(i(39831),i(9272),i(55135)),f=i(75094),v=i(63863),b=i(94255),_=i(97066),w=i(68833),M=i(29567),S=i(50193),L=i(45681),I=i(16161),A=i(46602),x=i(41506),C=i(34722),T=i(25389),E=i(68821),F=i(90826),R=i(21877),Z=i(42453);function O({associatedLayer:e,serviceUpdateTimeStamp:t}){const i=e?.editingInfo?.lastEditDate,s=e?.serverGens,r=null!=i,o=null!=t,n=r&&o&&t.lastUpdate!==i.getTime();return r&&(n||!o&&s?.minServerGen!==s?.serverGen)}var P=i(83849),k=i(17197),D=i(16984);const N=e=>{let t=class extends e{constructor(){super(...arguments),this.serviceTimeInfo=null}get timeInfo(){const e=this.associatedLayer?.timeInfo;if(null==e)return null;const t=e.clone();return(0,Z.sv)(t,this.fieldsIndex),t}set timeInfo(e){(0,Z.sv)(e,this.fieldsIndex),this._override("timeInfo",e)}get timeExtent(){return this.associatedLayer?.timeExtent}set timeExtent(e){this._override("timeExtent",e)}get timeOffset(){return this.associatedLayer?.timeOffset}set timeOffset(e){this._override("timeOffset",e)}get datesInUnknownTimezone(){return this.associatedLayer?.datesInUnknownTimezone??!1}set datesInUnknownTimezone(e){this._override("datesInUnknownTimezone",e)}async loadTimeInfoFromService(e){const{serviceTimeInfo:t}=this;if(null==t)return;const{startTimeField:i,endTimeField:s}=t;if(null==i&&null==s)return;if(O({associatedLayer:this.associatedLayer,serviceUpdateTimeStamp:this.serviceUpdateTimeStamp}))return;const r=async t=>{let s=null;try{const i=await(this.fetchStatistics?.(t,e));s=i?.stats}catch{}if(null==s)return null;const{minTimeStr:r,min:o,maxTimeStr:n,max:l}=s,a=t===i?r??o:n??l;return null!=a?new Date(a):null},[o,n]=await Promise.all([r(i),r(s)]);if(null!=i&&null==o||null!=s&&null==n)return;const l=new k.T({start:o,end:n});this.setAtOrigin("timeInfo",new P.A({endField:s,startField:i,fullTimeExtent:l}),"service")}};return(0,s._)([(0,m.MZ)({type:P.A,json:{read:!1,write:!1}})],t.prototype,"timeInfo",null),(0,s._)([(0,m.MZ)({type:k.T,json:{read:!1,write:!1}})],t.prototype,"timeExtent",null),(0,s._)([(0,m.MZ)({type:D.T,json:{read:!1,write:!1}})],t.prototype,"timeOffset",null),(0,s._)([(0,m.MZ)({type:Boolean,nonNullable:!0,json:{read:!1,write:!1}})],t.prototype,"datesInUnknownTimezone",null),(0,s._)([(0,m.MZ)({type:$,readOnly:!0,json:{read:{source:"timeInfo"}}})],t.prototype,"serviceTimeInfo",void 0),t=(0,s._)([(0,v.$)("esri.layers.mixins.TemporalSceneLayer")],t),t};let $=class extends R.A{constructor(){super(...arguments),this.endTimeField=null,this.startTimeField=null}};(0,s._)([(0,m.MZ)({type:String})],$.prototype,"endTimeField",void 0),(0,s._)([(0,m.MZ)({type:String})],$.prototype,"startTimeField",void 0),$=(0,s._)([(0,v.$)("esri.layers.mixins.TemporalSceneLayer.SceneServiceTimeInfo")],$);var V=i(16123),B=i(98154),j=i(97934),G=i(76592),z=i(52506),K=i(18475),U=i(99989),q=i(77567),H=i(79005),W=i(84546),J=i(40906),Q=i(61826),Y=i(79682),X=i(8585),ee=i(12434),te=i(44335);let ie=class extends R.A{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};(0,s._)([(0,m.MZ)({type:String,json:{read:!0,write:{isRequired:!0}}})],ie.prototype,"name",void 0),(0,s._)([(0,m.MZ)({type:String,json:{read:!0,write:{isRequired:!0}}})],ie.prototype,"field",void 0),(0,s._)([(0,m.MZ)({type:[Number],json:{read:!0,write:!0}})],ie.prototype,"currentRangeExtent",void 0),(0,s._)([(0,m.MZ)({type:[Number],json:{read:!0,write:!0}})],ie.prototype,"fullRangeExtent",void 0),(0,s._)([(0,m.MZ)({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],ie.prototype,"type",void 0),ie=(0,s._)([(0,v.$)("esri.layers.support.RangeInfo")],ie);var se,re=i(86394),oe=i(19251),ne=i(77841),le=i(32532),ae=i(63680);let ce=se=class extends R.A{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new le.A,this._geometriesSource=null}initialize(){this.addHandles((0,y.on)((()=>this.geometries),"after-changes",(()=>this.geometries=this.geometries),y.OH))}readGeometries(e,t,i){Array.isArray(e)?this.geometries=le.A.fromJSON(e,i):this._geometriesSource={url:(0,ae.f)(e,i),context:i}}async loadGeometries(e,t){if(null==this._geometriesSource)return;const{url:i,context:s}=this._geometriesSource,r=await(0,re.A)(i,{responseType:"json",signal:t?.signal}),o=e.toJSON(),n=r.data.map((e=>({...e,spatialReference:o})));this.geometries=le.A.fromJSON(n,s),this._geometriesSource=null}clone(){const e=new se({geometries:(0,oe.o8)(this.geometries),spatialRelationship:this.spatialRelationship});return e._geometriesSource=this._geometriesSource,e}};(0,s._)([(0,m.MZ)({type:["disjoint","contains"],nonNullable:!0,json:{write:{isRequired:!0}}})],ce.prototype,"spatialRelationship",void 0),(0,s._)([(0,m.MZ)({type:le.A,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),(0,ne.P)({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],ce.prototype,"geometries",void 0),(0,s._)([(0,f.w)(["web-scene","portal-item"],"geometries")],ce.prototype,"readGeometries",null),ce=se=(0,s._)([(0,v.$)("esri.layers.support.SceneFilter")],ce);const ue=ce;var de=i(20909);var pe=i(21484),he=i(53835),ye=i(14474),me=i(27451),ge=i(44116);async function fe(e){const t=[];for(const i of e)i.name.toLowerCase().endsWith(".zip")?t.push(ve(i)):t.push(Promise.resolve(i));return(await Promise.all(t)).flat()}async function ve(e){const{BlobReader:t,ZipReader:s,BlobWriter:r}=await i.e(79087).then(i.bind(i,79087)),o=[],n=new s(new t(e));return(await n.getEntries()).forEach((e=>{if(e.directory||/^__MACOS/i.test(e.filename))return;const t=new r,i=e.getData?.(t).then((t=>new File([t],e.filename)));i&&o.push(i)})),Promise.all(o)}var be=i(15976),_e=i(18846),we=i(48904);const Me=new Set(["3DObject","Point"]),Se=(0,q.p)();let Le=class extends(N((0,A.w6)((0,E.w6)((0,L.b)((0,x.q)((0,C.A)((0,T.j)((0,p.P)((0,I.d)((0,S.p)(n.A.ClonableMixin(w.A)))))))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new l.A,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.attributeTableTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0,this.serviceItemId=void 0}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}destroy(){this._set("renderer",null),this.associatedLayer=(0,d.pR)(this.associatedLayer)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){const i=this.getField(e)?.domain??null;return this.associatedLayer?(0,z.Vq)(this.associatedLayer,e,t,i):i}getFeatureType(e){return e&&this.associatedLayer?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new H.A(this.fields)}readNodePages(e,t,i){return"Point"===t.layerType&&(e=t.pointNodePages),null==e||"object"!=typeof e?null:W.W4.fromJSON(e,i)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return null!=this.associatedLayer&&(0,z.C$)(this.associatedLayer)}get geometryType(){return Ae[this.profile]||"mesh"}set renderer(e){(0,Z.yp)(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return null!=e&&"object"==typeof e||(e={}),null==e.color&&(e.color=!1),e}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(e){e=null!=e?e:j.P;const{query:t,queryRelated:i,editing:{supportsGlobalId:s,supportsRollbackOnFailure:r,supportsUploadWithItemId:o,supportsGeometryUpdate:n,supportsReturnServiceEditsInSourceSpatialReference:l},data:{supportsZ:a,supportsM:c,isVersioned:u,supportsAttachment:d},operations:{supportsEditing:p,supportsAdd:h,supportsUpdate:y,supportsDelete:m,supportsQuery:g,supportsQueryAttachments:f,supportsAsyncConvert3D:v}}=e,b=e.operations.supportsChangeTracking,_=!!this.associatedLayer?.infoFor3D;return{query:t,queryRelated:i,editing:{supportsGlobalId:s,supportsReturnServiceEditsInSourceSpatialReference:l,supportsRollbackOnFailure:r,supportsGeometryUpdate:_&&n,supportsUploadWithItemId:o},data:{supportsAttachment:d,supportsZ:a,supportsM:c,isVersioned:u},operations:{supportsQuery:g,supportsQueryAttachments:f,supportsEditing:p&&b,supportsAdd:_&&h&&b,supportsDelete:_&&m&&b,supportsUpdate:y&&b,supportsAsyncConvert3D:v}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.associatedLayer?.editingEnabled??!1}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some((t=>("esriFieldTypeOID"===t.type&&(e=t.name),!!e))),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some((t=>("esriFieldTypeGlobalID"===t.type&&(e=t.name),!!e))),e||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(e,t){const i=t.store.profile;return null!=i&&Ie[i]?Ie[i]:(u.A.getLogger(this).error("Unknown or missing profile",{profile:i,layer:this}),"mesh-pyramids")}get useViewTime(){return this.associatedLayer?.useViewTime??!0}set useViewTime(e){this._override("useViewTime",e)}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){const t=null!=e?e.signal:null;await this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(h.QP),await this._fetchService(t),await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),this._loadFilterGeometries()]),this._validateElevationInfo(),this._applyAssociatedLayerOverrides(),this._populateFieldUsageInfo(),await this.loadTimeInfoFromService(e),await(0,pe.L)(this,{origin:"service"},t),(0,Z.yp)(this.renderer,this.fieldsIndex),await this.finishLoadEditablePortalLayer(e)}async beforeSave(){null!=this.filter&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(e){u.A.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:e}),this.filter=null}}createQuery(){const e=new ye.A;return"mesh"===this.geometryType?this.capabilities.query.supportsReturnMesh&&(e.returnGeometry=!0):(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e.outFields=["*"],e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryExtent(e||this.createQuery(),t)))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryFeatureCount(e||this.createQuery(),t)))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryFeatures(e||this.createQuery(),t))).then((e=>{if(e?.features)for(const t of e.features)t.layer=this,t.sourceLayer=this;return e}))}async queryRelatedFeatures(e,t){if(await this.load(),!this.associatedLayer)throw new a.A("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeatures(e,t)}async queryRelatedFeaturesCount(e,t){if(await this.load(),!this.associatedLayer)throw new a.A("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(e,t)}async queryCachedAttributes(e,t){const i=(0,Z.hL)(this.fieldsIndex,await(0,_e.TO)(this,(0,_e.D8)(this)));return(0,be.s1)(this.parsedUrl?.path??"",this.attributeStorageInfo??[],e,t,i,this.apiKey,this.customParameters)}async queryCachedFeature(e,t){const i=await this.queryCachedAttributes(e,[t]);if(!i||0===i.length)throw new a.A("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const s=new r.A;return s.attributes=i[0],s.layer=this,s.sourceLayer=this,s}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryObjectIds(e||this.createQuery(),t)))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryAttachments(e,t)))}getFieldUsageInfo(e){const t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(u.A.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)}createPopupTemplate(e){return(0,ge.tn)(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return e?.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new a.A("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new a.A("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return null!=this.statisticsInfo&&this.statisticsInfo.some((t=>t.name===e))}async queryCachedStatistics(e,t){return await this.load(t),await this.fetchStatistics(e,t)}async saveAs(e,t){return this._debouncedSaveOperations(E.Xh.SAVE_AS,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(E.Xh.SAVE,e)}async applyEdits(e,t){const{applyEdits:s}=await i.e(98284).then(i.bind(i,75903));let r=t;await this.load();const o=this.associatedLayer;if(!o)throw new a.A(`${this.type}-layer:not-editable`,"Service is not editable");await o.load();const{globalIdField:n}=o,l=!!o.infoFor3D,c=r?.globalIdUsed??!0;if(l&&null==n)throw new a.A(`${this.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");if(l&&!c)throw new a.A(`${this.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");return(0,V.Wo)(o.url)&&l&&null!=e.deleteFeatures&&null!=n&&(r={...r,globalIdToObjectId:await(0,z.GA)(o,e.deleteFeatures,n)}),s(this,o.source,e,r)}async uploadAssets(e,t){if(await this.load(),null==this.associatedLayer)throw new a.A(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(e,t)}on(e,t){return super.on(e,t)}async convertMesh(e,t){t??={};const s=e=>{throw u.A.getLogger(this).error(".convertMesh()",e.message),e};await this.load(),this.infoFor3D||s(new a.A("invalid:layer","SceneLayer has no capability for mesh conversion"));const r=await this.extractAndFilterFiles(e),o=r.reduce(((e,t)=>(0,J.oF)(this.infoFor3D,t)?e+1:e),0);0===o&&s(new M.VP),o>1&&s(new M.XQ);const n=this.spatialReference,l=t.location??new _.A({x:0,y:0,z:0,spatialReference:n}),c=l.spatialReference.isGeographic?"local":"georeferenced",{default:d}=await Promise.all([i.e(72076),i.e(1817),i.e(94704),i.e(39647)]).then(i.bind(i,39647)),p=d.createWithExternalSource(l,{type:"client",files:r},{vertexSpace:c,transform:(0,te.Z)(l.spatialReference),unitConversionDisabled:!0}),[h]=await this.uploadAssets([p],{...t,useAssetOrigin:!t.location});return h}async extractAndFilterFiles(e){await this.load();const t=this.infoFor3D;return t?(await fe(e)).filter((e=>(0,J.fu)(t,e))):e}validateLayer(e){if(e.layerType&&!Me.has(e.layerType))throw new a.A("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new a.A("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new a.A("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});!function(e,t){let i=!1,s=!1;if(null==e)i=!0,s=!0;else{const r=t&&t.isGeographic;switch(e){case"east-north-up":case"earth-centered":i=!0,s=r;break;case"vertex-reference-frame":i=!0,s=!r;break;default:i=!1}}if(!i)throw new a.A("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!s)throw new a.A("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if("points"===this.profile)e.push("Point");else{if("mesh-pyramids"!==this.profile)throw new a.A("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const t=!!this.attributeStorageInfo?.some((t=>t.name===e.name)),i=!!this.associatedLayer?.fields?.some((t=>t&&e.name===t.name)),s={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||i,supportsLayerQuery:i};this._fieldUsageInfo[e.name]=s}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPropertyOverrides(),this._applyAssociatedLayerExtentOverride(),this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(!this.associatedLayer?.fields)return;let e=null;for(const t of this.associatedLayer.fields){const i=this.getField(t.name);i?(!i.domain&&t.domain&&(i.domain=t.domain.clone()),i.editable=t.editable,i.nullable=t.nullable,i.length=t.length):(e||(e=this.fields?this.fields.slice():[]),e.push(t.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPropertyOverrides(){if(!this.associatedLayer)return;const e=["popupTemplate","popupEnabled","attributeTableTemplate"],t=(0,g.oY)(this);for(let i=0;i<e.length;i++){const s=e[i],r=this.originIdOf(s),o=this.associatedLayer.originIdOf(s);r<o&&(o===b.Gr.SERVICE||o===b.Gr.PORTAL_ITEM)&&t.setAtOrigin(s,this.associatedLayer[s],o)}}_applyAssociatedLayerExtentOverride(){const e=this.associatedLayer?.getAtOrigin("fullExtent","service");null!=this.associatedLayer?.infoFor3D&&e&&(0,V.Wo)(this.associatedLayer?.url)&&O(this)&&(0,g.oY)(this).setAtOrigin("fullExtent",e.clone(),b.Gr.SERVICE)}_applyAssociatedLayerPrivileges(){const e=this.associatedLayer;e&&(this._set("userHasEditingPrivileges",e.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",e.userHasFullEditingPrivileges),this._set("userHasUpdateItemPrivileges",e.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(e){if(["mesh-pyramids","points"].includes(this.profile))try{const{serverUrl:t,layerId:i,portalItem:s}=await(0,B.L)(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:e}),r=await ee.S.FeatureLayer();this.associatedLayer=new r({url:t,customParameters:this.customParameters,layerId:i,portalItem:s}),await this.associatedLayer.load()}catch(ve){(0,h.zf)(ve)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){const e=new AbortController;this.addHandles((0,c.rE)(e));try{await(0,y.C_)((()=>this.popupEnabled&&null!=this.popupTemplate),e.signal)}catch(i){return void(0,h.jH)(i)}const t=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?u.A.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${t}`):u.A.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${t}`)}_validateElevationInfo(){const e=this.elevationInfo;"mesh-pyramids"===this.profile&&(0,me.XF)(u.A.getLogger(this),(0,me.$7)("Mesh scene layers","relative-to-scene",e)),(0,me.XF)(u.A.getLogger(this),(0,me.tW)("Scene layers",e))}async fetchStatistics(e,t){return await async function({fieldName:e,statisticsInfo:t,errorContext:i,fieldsIndex:s,path:r,customParameters:o,apiKey:n,signal:l}){if(null==t)throw new a.A(`${i}:no-cached-statistics`,"Cached statistics are not available for this layer");const c=s.get(e);if(null==c)throw new a.A(`${i}:field-unexisting`,`Field '${e}' does not exist on the layer`);const u=t.find((e=>e.name===c.name));if(null==u)throw new a.A(`${i}:no-cached-statistics`,"Cached statistics for this attribute are not available");const d=(0,de.fj)(r,u.href),{data:p}=await(0,re.A)(d,{query:{f:"json",...o,token:n},responseType:"json",signal:l});return p}({fieldName:e,statisticsInfo:this.statisticsInfo,errorContext:"scenelayer",fieldsIndex:this.fieldsIndex,path:this.parsedUrl?.path??"",customParameters:this.customParameters,apiKey:this.apiKey,signal:t?.signal})}};(0,s._)([(0,m.MZ)({types:{key:"type",base:K.c,typeMap:{selection:U.A}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],Le.prototype,"featureReduction",void 0),(0,s._)([(0,m.MZ)({type:[ie],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],Le.prototype,"rangeInfos",void 0),(0,s._)([(0,m.MZ)({json:{read:!1}})],Le.prototype,"associatedLayer",void 0),(0,s._)([(0,m.MZ)({type:["show","hide"]})],Le.prototype,"listMode",void 0),(0,s._)([(0,m.MZ)({type:["ArcGISSceneServiceLayer"]})],Le.prototype,"operationalLayerType",void 0),(0,s._)([(0,m.MZ)({json:{read:!1},readOnly:!0})],Le.prototype,"type",void 0),(0,s._)([(0,m.MZ)({...Se.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Le.prototype,"fields",void 0),(0,s._)([(0,m.MZ)()],Le.prototype,"types",null),(0,s._)([(0,m.MZ)()],Le.prototype,"typeIdField",null),(0,s._)([(0,m.MZ)()],Le.prototype,"templates",null),(0,s._)([(0,m.MZ)()],Le.prototype,"formTemplate",null),(0,s._)([(0,m.MZ)({readOnly:!0,clonable:!1})],Le.prototype,"fieldsIndex",null),(0,s._)([(0,m.MZ)({type:X.A,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Le.prototype,"floorInfo",void 0),(0,s._)([(0,m.MZ)(Se.outFields)],Le.prototype,"outFields",void 0),(0,s._)([(0,m.MZ)({type:W.W4,readOnly:!0,json:{read:!1}})],Le.prototype,"nodePages",void 0),(0,s._)([(0,f.w)("service","nodePages",["nodePages","pointNodePages"])],Le.prototype,"readNodePages",null),(0,s._)([(0,m.MZ)({type:[W.uV],readOnly:!0})],Le.prototype,"materialDefinitions",void 0),(0,s._)([(0,m.MZ)({type:[W.Ot],readOnly:!0})],Le.prototype,"textureSetDefinitions",void 0),(0,s._)([(0,m.MZ)({type:[W.L0],readOnly:!0})],Le.prototype,"geometryDefinitions",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],Le.prototype,"serviceUpdateTimeStamp",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],Le.prototype,"attributeStorageInfo",void 0),(0,s._)([(0,m.MZ)({readOnly:!0})],Le.prototype,"statisticsInfo",void 0),(0,s._)([(0,m.MZ)({type:l.A.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],Le.prototype,"excludeObjectIds",void 0),(0,s._)([(0,m.MZ)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Le.prototype,"definitionExpression",void 0),(0,s._)([(0,m.MZ)({type:ue,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],Le.prototype,"filter",void 0),(0,s._)([(0,m.MZ)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Le.prototype,"path",void 0),(0,s._)([(0,m.MZ)(G.Yj)],Le.prototype,"elevationInfo",null),(0,s._)([(0,m.MZ)({readOnly:!0,json:{read:!1}})],Le.prototype,"effectiveCapabilities",null),(0,s._)([(0,m.MZ)({readOnly:!0})],Le.prototype,"effectiveEditingEnabled",null),(0,s._)([(0,m.MZ)({type:String})],Le.prototype,"geometryType",null),(0,s._)([(0,m.MZ)(G.kF)],Le.prototype,"labelsVisible",void 0),(0,s._)([(0,m.MZ)({type:[Q.A],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:Y.w},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:Y.w},write:!0}})],Le.prototype,"labelingInfo",void 0),(0,s._)([(0,m.MZ)(G.fV)],Le.prototype,"legendEnabled",void 0),(0,s._)([(0,m.MZ)({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,t){if("number"==typeof e&&e>=0&&e<=1)return e;const i=t.layerDefinition?.drawingInfo?.transparency;return void 0!==i?(0,we.D)(i):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],Le.prototype,"opacity",void 0),(0,s._)([(0,m.MZ)({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Le.prototype,"priority",void 0),(0,s._)([(0,m.MZ)({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Le.prototype,"semantic",void 0),(0,s._)([(0,m.MZ)({types:he.XJ,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],Le.prototype,"renderer",null),(0,s._)([(0,m.MZ)({json:{read:!1}})],Le.prototype,"cachedDrawingInfo",void 0),(0,s._)([(0,f.w)("service","cachedDrawingInfo")],Le.prototype,"readCachedDrawingInfo",null),(0,s._)([(0,m.MZ)({readOnly:!0,json:{read:!1}})],Le.prototype,"capabilities",null),(0,s._)([(0,m.MZ)({type:Boolean,json:{read:!1}})],Le.prototype,"editingEnabled",null),(0,s._)([(0,m.MZ)({readOnly:!0,json:{write:!1,read:!1}})],Le.prototype,"infoFor3D",null),(0,s._)([(0,m.MZ)({readOnly:!0,json:{write:!1,read:!1}})],Le.prototype,"relationships",null),(0,s._)([(0,m.MZ)(G.M6)],Le.prototype,"popupEnabled",void 0),(0,s._)([(0,m.MZ)({type:o.A,json:{name:"popupInfo",write:!0}})],Le.prototype,"popupTemplate",void 0),(0,s._)([(0,m.MZ)({readOnly:!0,json:{read:!1}})],Le.prototype,"defaultPopupTemplate",null),(0,s._)([(0,m.MZ)(G.zQ)],Le.prototype,"attributeTableTemplate",void 0),(0,s._)([(0,m.MZ)({type:String,json:{read:!1}})],Le.prototype,"objectIdField",void 0),(0,s._)([(0,f.w)("service","objectIdField",["objectIdField","fields"])],Le.prototype,"readObjectIdField",null),(0,s._)([(0,m.MZ)({type:String,json:{read:!1}})],Le.prototype,"globalIdField",void 0),(0,s._)([(0,f.w)("service","globalIdField",["globalIdField","fields"])],Le.prototype,"readGlobalIdField",null),(0,s._)([(0,m.MZ)({readOnly:!0,type:String,json:{read:!1}})],Le.prototype,"displayField",null),(0,s._)([(0,m.MZ)({type:String,json:{read:!1}})],Le.prototype,"profile",void 0),(0,s._)([(0,f.w)("service","profile",["store.profile"])],Le.prototype,"readProfile",null),(0,s._)([(0,m.MZ)({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],Le.prototype,"normalReferenceFrame",void 0),(0,s._)([(0,m.MZ)(G.PY)],Le.prototype,"screenSizePerspectiveEnabled",void 0),(0,s._)([(0,m.MZ)({json:{read:!1,origins:{service:{read:!0}}}})],Le.prototype,"serviceItemId",void 0),(0,s._)([(0,m.MZ)(F.B)],Le.prototype,"useViewTime",null),Le=(0,s._)([(0,v.$)("esri.layers.SceneLayer")],Le);const Ie={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},Ae={"mesh-pyramids":"mesh",points:"point"},xe=Le},31058:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ee});var s,r=i(66866),o=i(56542),n=i(86394),l=i(24793),a=i(98849),c=i(20464),u=i(19251),d=i(539),p=i(35775),h=i(40189),y=i(21564),m=i(73446),g=i(75094),f=i(63863),v=i(84698),b=i(78983),_=i(12433),w=i(68833),M=i(45681),S=i(15305),L=i(16161),I=i(54576),A=i(15053),x=i(94783),C=i(41506),T=i(34722),E=i(50508),F=i(25389),R=i(90826),Z=i(40021),O=i(76592),P=i(52506),k=i(24738),D=i(77567),N=i(42453),$=i(61826),V=i(79682),B=i(21877);i(39831),i(9272);let j=class extends B.A{constructor(){super(...arguments),this.age=null,this.ageReceived=null,this.displayCount=null,this.maxObservations=1}static{s=this}clone(){return new s({age:this.age,ageReceived:this.ageReceived,displayCount:this.displayCount,maxObservations:this.maxObservations})}};(0,r._)([(0,y.MZ)({type:Number,json:{write:!0}})],j.prototype,"age",void 0),(0,r._)([(0,y.MZ)({type:Number,json:{write:!0}})],j.prototype,"ageReceived",void 0),(0,r._)([(0,y.MZ)({type:Number,json:{write:!0}})],j.prototype,"displayCount",void 0),(0,r._)([(0,y.MZ)({type:Number,json:{write:!0}})],j.prototype,"maxObservations",void 0),j=s=(0,r._)([(0,f.$)("esri.layers.support.PurgeOptions")],j);var G=i(21822),z=i(48887),K=i(21484),U=i(53835),q=i(14474),H=i(44116),W=i(60973),J=i(15954);const Q=(0,D.p)();function Y(e,t){return new a.A("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}let X=class extends((0,I.FJ)((0,x.J)((0,A.F)((0,S.dM)((0,R.e)((0,Z.d)((0,F.j)((0,E.J)((0,M.b)((0,C.q)((0,T.A)((0,p.P)((0,L.d)(l.A.ClonableMixin(w.A))))))))))))))){constructor(...e){super(...e),this.copyright=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.geometryDefinition=null,this.geometryType=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.maxReconnectionAttempts=0,this.maxReconnectionInterval=20,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.operationalLayerType="ArcGISStreamLayer",this.outFields=["*"],this.popupEnabled=!0,this.popupTemplate=null,this.purgeOptions=new j,this.refreshInterval=0,this.screenSizePerspectiveEnabled=!0,this.sourceJSON=null,this.spatialReference=b.A.WGS84,this.type="stream",this.url=null,this.updateInterval=300,this.useViewTime=!0,this.webSocketUrl=null,this._debouncedSaveOperations=(0,h.sg)((async(e,t,s)=>{const{save:r,saveAs:o}=await i.e(68846).then(i.bind(i,68846));switch(e){case J.X.SAVE:return r(this,t);case J.X.SAVE_AS:return o(this,s,t)}}))}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){if(!("WebSocket"in globalThis))return this.addResolvingPromise(Promise.reject(new a.A("stream-layer:websocket-unsupported","WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."))),Promise.resolve(this);const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service","Feed"]},e).catch(h.QP).then((()=>this._fetchService(t)))),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}set renderer(e){(0,N.yp)(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){t=t.layerDefinition||t;const s=t.drawingInfo?.renderer;if(s){const e=(0,z.L)(s,t,i)||void 0;return e||d.A.getLogger(this).error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),e}return(0,P.PD)(t,i)}async connect(e){const[{createConnection:t}]=await Promise.all([Promise.all([i.e(72076),i.e(14794),i.e(66471)]).then(i.bind(i,14794)),this.load()]),s=this.geometryType?_.gy.toJSON(this.geometryType):null,{customParameters:r=null,definitionExpression:o=null,geometryDefinition:n=null,maxReconnectionAttempts:l=0,maxReconnectionInterval:a=20,spatialReference:u=this.spatialReference}=e||this.createConnectionParameters(),d=t(this.parsedUrl,this.spatialReference,u,s,o,n,l,a,r??void 0),p=(0,c.vE)([this.on("send-message-to-socket",(e=>d.sendMessageToSocket(e))),this.on("send-message-to-client",(e=>d.sendMessageToClient(e)))]);return d.once("destroy",p.remove),d}createConnectionParameters(){return{spatialReference:this.spatialReference,customParameters:this.customParameters,definitionExpression:this.definitionExpression,geometryDefinition:this.geometryDefinition,maxReconnectionAttempts:this.maxReconnectionAttempts,maxReconnectionInterval:this.maxReconnectionInterval}}createPopupTemplate(e){return(0,H.tn)(this,e)}createQuery(){const e=new q.A;return e.returnGeometry=!0,e.outFields=["*"],e.where=this.definitionExpression||"1=1",e}getFieldDomain(e,t){if(!this.fields)return null;let i=null;return this.fields.some((t=>(t.name===e&&(i=t.domain),!!i))),i}getField(e){return this.fieldsIndex.get(e)}serviceSupportsSpatialReference(e){return!0}sendMessageToSocket(e){this.emit("send-message-to-socket",e)}sendMessageToClient(e){this.emit("send-message-to-client",e)}async save(e){return this._debouncedSaveOperations(J.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(J.X.SAVE_AS,t,e)}write(e,t){const i=t?.messages;return this.webSocketUrl?(i?.push(Y(this,"using a custom websocket connection cannot be written to web scenes and web maps")),null):this.parsedUrl?super.write(e,t):(i?.push(Y(this,"using a client-side only connection without a url cannot be written to web scenes and web maps")),null)}async _fetchService(e){if(!this.webSocketUrl&&this.parsedUrl){if(!this.sourceJSON){const{data:t}=await(0,n.A)(this.parsedUrl.path,{query:{f:"json",...this.customParameters,...this.parsedUrl.query},responseType:"json",signal:e});this.sourceJSON=t}}else{if(!this.timeInfo?.trackIdField)throw new a.A("stream-layer:missing-metadata","The stream layer trackIdField must be specified.");if(!this.objectIdField){const e=this.fields.find((e=>"oid"===e.type))?.name;if(!e)throw new a.A("stream-layer:missing-metadata","The stream layer objectIdField must be specified.");this.objectIdField=e}if(!this.fields)throw new a.A("stream-layer:missing-metadata","The stream layer fields must be specified.");if(this.fields.some((e=>e.name===this.objectIdField))||this.fields.push(new k.A({name:this.objectIdField,alias:this.objectIdField,type:"oid"})),!this.geometryType)throw new a.A("stream-layer:missing-metadata","The stream layer geometryType must be specified.");this.webSocketUrl&&(this.url=this.webSocketUrl)}return this.read(this.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}),(0,N.yp)(this.renderer,this.fieldsIndex),(0,N.sv)(this.timeInfo,this.fieldsIndex),this.objectIdField||(this.objectIdField=G.DN),(0,K.L)(this,{origin:"service"})}};(0,r._)([(0,y.MZ)({type:String})],X.prototype,"copyright",void 0),(0,r._)([(0,y.MZ)({readOnly:!0})],X.prototype,"defaultPopupTemplate",null),(0,r._)([(0,y.MZ)({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],X.prototype,"definitionExpression",void 0),(0,r._)([(0,y.MZ)({type:String})],X.prototype,"displayField",void 0),(0,r._)([(0,y.MZ)({type:W.A})],X.prototype,"elevationInfo",void 0),(0,r._)([(0,y.MZ)({json:{origins:{"web-map":{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],X.prototype,"featureReduction",null),(0,r._)([(0,y.MZ)(Q.fields)],X.prototype,"fields",void 0),(0,r._)([(0,y.MZ)(Q.fieldsIndex)],X.prototype,"fieldsIndex",void 0),(0,r._)([(0,y.MZ)({type:v.A,json:{name:"layerDefinition.definitionGeometry",write:!0}})],X.prototype,"geometryDefinition",void 0),(0,r._)([(0,y.MZ)({type:_.gy.apiValues,json:{read:{reader:_.gy.read}}})],X.prototype,"geometryType",void 0),(0,r._)([(0,y.MZ)(O.kF)],X.prototype,"labelsVisible",void 0),(0,r._)([(0,y.MZ)({type:[$.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:V.w},write:!0}})],X.prototype,"labelingInfo",void 0),(0,r._)([(0,y.MZ)(O.fV)],X.prototype,"legendEnabled",void 0),(0,r._)([(0,y.MZ)({type:["show","hide"],json:{origins:{"portal-item":{read:!1,write:!1}}}})],X.prototype,"listMode",void 0),(0,r._)([(0,y.MZ)({type:m.jz})],X.prototype,"maxReconnectionAttempts",void 0),(0,r._)([(0,y.MZ)({type:m.jz})],X.prototype,"maxReconnectionInterval",void 0),(0,r._)([(0,y.MZ)(O.hG)],X.prototype,"maxScale",void 0),(0,r._)([(0,y.MZ)(O.hn)],X.prototype,"minScale",void 0),(0,r._)([(0,y.MZ)({type:String})],X.prototype,"objectIdField",void 0),(0,r._)([(0,y.MZ)({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],X.prototype,"operationalLayerType",void 0),(0,r._)([(0,y.MZ)({readOnly:!0})],X.prototype,"outFields",void 0),(0,r._)([(0,y.MZ)(O.M6)],X.prototype,"popupEnabled",void 0),(0,r._)([(0,y.MZ)({type:o.A,json:{name:"popupInfo",write:!0}})],X.prototype,"popupTemplate",void 0),(0,r._)([(0,y.MZ)({type:j})],X.prototype,"purgeOptions",void 0),(0,r._)([(0,y.MZ)({json:{read:!1,write:!1}})],X.prototype,"refreshInterval",void 0),(0,r._)([(0,y.MZ)({types:U.Hg,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{name:"layerDefinition.drawingInfo.renderer",types:U.XJ,write:!0}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],X.prototype,"renderer",null),(0,r._)([(0,g.w)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),(0,g.w)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],X.prototype,"readRenderer",null),(0,r._)([(0,y.MZ)((()=>{const e=(0,u.o8)(O.PY);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],X.prototype,"screenSizePerspectiveEnabled",void 0),(0,r._)([(0,y.MZ)()],X.prototype,"sourceJSON",void 0),(0,r._)([(0,y.MZ)({type:b.A,json:{origins:{service:{read:{source:"spatialReference"}}}}})],X.prototype,"spatialReference",void 0),(0,r._)([(0,y.MZ)({json:{read:!1}})],X.prototype,"type",void 0),(0,r._)([(0,y.MZ)(O.OZ)],X.prototype,"url",void 0),(0,r._)([(0,y.MZ)({type:Number})],X.prototype,"updateInterval",void 0),(0,r._)([(0,y.MZ)({json:{read:!1,write:!1}})],X.prototype,"useViewTime",void 0),(0,r._)([(0,y.MZ)({type:String})],X.prototype,"webSocketUrl",void 0),X=(0,r._)([(0,f.$)("esri.layers.StreamLayer")],X);const ee=X},38782:(e,t,i)=>{i.r(t),i.d(t,{default:()=>le});var s=i(66866),r=i(86394),o=i(12690),n=i(98849),l=i(19251),a=i(35775),c=i(40189),u=i(20909),d=i(21564),p=(i(39831),i(539)),h=i(75094),y=i(63863),m=i(77542),g=i(84698),f=i(78983),v=i(68833),b=i(50193),_=i(9127),w=i(45681),M=i(15305),S=i(16161),L=i(41506),I=i(34722),A=i(50508),x=i(25389);let C=null;var T=i(86942);class E{constructor(e,t){this._spriteSource=e,this._maxTextureSize=t,this.devicePixelRatio=1,this._spriteImageFormat="png",this._isRetina=!1,this._spritesData={},this.image=null,this.width=null,this.height=null,this.loadStatus="not-loaded","url"===e.type&&e.spriteFormat&&(this._spriteImageFormat=e.spriteFormat),e.pixelRatio&&(this.devicePixelRatio=e.pixelRatio),this.baseURL=e.spriteUrl}get spriteNames(){const e=[];for(const t in this._spritesData)e.push(t);return e.sort(),e}getSpriteInfo(e){return this._spritesData?this._spritesData[e]:null}async load(e){if(this.baseURL){this.loadStatus="loading";try{await this._loadSprites(e),this.loadStatus="loaded"}catch{this.loadStatus="failed"}}else this.loadStatus="failed"}async _loadSprites(e){this._isRetina=this.devicePixelRatio>1.15;const{width:t,height:i,data:s,json:r}=await this._getSpriteData(this._spriteSource,e),o=Object.keys(r);if(!o||0===o.length||!s)return this._spritesData=this.image=null,void(this.width=this.height=0);this._spritesData=r,this.width=t,this.height=i;const l=Math.max(this._maxTextureSize,4096);if(t>l||i>l){const e=`Sprite resource for style ${this.baseURL} is bigger than the maximum allowed of ${l} pixels}`;throw p.A.getLogger("esri.layers.support.SpriteSource").error(e),new n.A("SpriteSource",e)}let a;for(let n=0;n<s.length;n+=4)a=s[n+3]/255,s[n]=s[n]*a,s[n+1]=s[n+1]*a,s[n+2]=s[n+2]*a;this.image=s}async _getSpriteData(e,t){if("image"===e.type){let t,i;if(this.devicePixelRatio<1.15){if(!e.spriteSource1x)throw new n.A("SpriteSource","no image data provided for low resolution sprites!");t=e.spriteSource1x.image,i=e.spriteSource1x.json}else{if(!e.spriteSource2x)throw new n.A("SpriteSource","no image data provided for high resolution sprites!");t=e.spriteSource2x.image,i=e.spriteSource2x.json}return"width"in t&&"height"in t&&"data"in t&&((0,T.mw)(t.data)||(0,T.UR)(t.data))?{width:t.width,height:t.height,data:new Uint8Array(t.data),json:i}:{...F(t),json:i}}const i=(0,u.An)(this.baseURL),s=i.query?"?"+(0,u.x0)(i.query):"",o=this._isRetina?"@2x":"",l=`${i.path}${o}.${this._spriteImageFormat}${s}`,a=`${i.path}${o}.json${s}`,[c,d]=await Promise.all([(0,r.A)(a,t),(0,r.A)(l,{responseType:"image",...t})]);return{...F(d.data),json:c.data}}}function F(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.width=e.width,t.height=e.height,i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height);return{width:e.width,height:e.height,data:new Uint8Array(s.data)}}var R=i(65228),Z=i(35787),O=i(87926),P=i(96082),k=i(42482);class D{constructor(e){this.url=e}destroy(){this._tileIndexPromise=null}async fetchTileIndex(){return this._tileIndexPromise||(this._tileIndexPromise=(0,r.A)(this.url).then((e=>e.data.index))),this._tileIndexPromise}async dataKey(e,t){const i=await this.fetchTileIndex();return(0,c.Te)(t),this._getIndexedDataKey(i,e)}_getIndexedDataKey(e,t){const i=[t];if(t.level<0||t.row<0||t.col<0||t.row>>t.level>0||t.col>>t.level>0)return null;let s=t;for(;0!==s.level;)s=new k.A(s.level-1,s.row>>1,s.col>>1,s.world),i.push(s);let r,o,n=e,l=i.pop();if(1===n)return l;for(;i.length;)if(r=i.pop(),o=(1&r.col)+((1&r.row)<<1),n){if(0===n[o]){l=null;break}if(1===n[o]){l=r;break}l=r,n=n[o]}return l}}var N=i(6267);class ${constructor(e,t){this._tilemap=e,this._tileIndexUrl=t}destroy(){this._tilemap=(0,N.pR)(this._tilemap),this._tileIndexPromise=null}async fetchTileIndex(e){return this._tileIndexPromise||(this._tileIndexPromise=(0,r.A)(this._tileIndexUrl,{query:{...e?.query}}).then((e=>e.data.index))),this._tileIndexPromise}dataKey(e,t){const{level:i,row:s,col:r}=e,o=new k.A(e);return this._tilemap.fetchAvailabilityUpsample(i,s,r,o,t).then((()=>(o.world=e.world,o))).catch((e=>{if((0,c.zf)(e))throw e;return null}))}}var V=i(82256);class B{constructor(e){this._tileUrl=e,this._promise=null,this._abortController=null,this._abortOptions=[]}getData(e){(null==this._promise||(0,c.G4)(this._abortController?.signal))&&(this._promise=this._makeRequest(this._tileUrl));const t=this._abortOptions;return t.push(e),(0,c.u7)(e,(()=>{t.every((e=>(0,c.G4)(e)))&&this._abortController.abort()})),this._promise.then((e=>(0,l.o8)(e)))}async _makeRequest(e){this._abortController=new AbortController;const{data:t}=await(0,r.A)(e,{responseType:"array-buffer",signal:this._abortController.signal});return t}}const j=new Map;function G(e,t){return(0,V.tE)(j,e,(()=>new B(e))).getData(t).finally((()=>j.delete(e)))}class z{constructor(e,t,i){this.tilemap=null,this.tileInfo=null,this.capabilities=null,this.fullExtent=null,this.initialExtent=null,this.name=e,this.sourceUrl=t;const s=(0,u.An)(this.sourceUrl),r=(0,l.o8)(i),o=r.tiles;if(s)for(let l=0;l<o.length;l++){const e=(0,u.An)(o[l]);e&&((0,u.oP)(e.path)||(e.path=(0,u.fj)(s.path,e.path)),o[l]=(0,u.a6)(e.path,{...s.query,...e.query}))}this.tileServers=o;const n=i.capabilities&&i.capabilities.split(",").map((e=>e.toLowerCase().trim())),a=!0===i?.exportTilesAllowed,c=!0===n?.includes("tilemap"),d=a&&i.hasOwnProperty("maxExportTilesCount")?i.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:a,supportsTileMap:c},exportTiles:a?{maxExportTilesCount:+d}:null},this.tileInfo=R.A.fromJSON(r.tileInfo);const p=i.tileMap?(0,u.a6)((0,u.fj)(s.path,i.tileMap),s.query??{}):null;c?(this.type="vector-tile",this.tilemap=new $(new Z.d({layer:{parsedUrl:s,tileInfo:this.tileInfo},minLOD:r.minLOD??this.tileInfo.lods[0].level,maxLOD:r.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}),p)):p&&(this.tilemap=new D(p)),this.fullExtent=g.A.fromJSON(i.fullExtent),this.initialExtent=g.A.fromJSON(i.initialExtent)}destroy(){this.tilemap?.destroy()}async getRefKey(e,t){return this.tilemap?this.tilemap.dataKey(e,t):e}requestTile(e,t,i,s){return function(e,t,i,s,r){const o=(0,u.An)(e),n=o.query;if(n)for(const[a,c]of Object.entries(n))switch(c){case"{x}":n[a]=s.toString();break;case"{y}":n[a]=i.toString();break;case"{z}":n[a]=t.toString()}const l=o.path;return G((0,u.a6)(l.replaceAll(/\{z\}/gi,t.toString()).replaceAll(/\{y\}/gi,i.toString()).replaceAll(/\{x\}/gi,s.toString()),{...o.query}),r)}(this.tileServers[t%this.tileServers.length],e,t,i,s)}isCompatibleWith(e){const t=this.tileInfo,i=e.tileInfo;if(!t.spatialReference.equals(i.spatialReference))return!1;if(!t.origin.equals(i.origin))return!1;if(Math.round(t.dpi)!==Math.round(i.dpi))return!1;const s=t.lods,r=i.lods,o=Math.min(s.length,r.length);for(let n=0;n<o;n++){const e=s[n],t=r[n];if(e.level!==t.level||Math.round(e.scale)!==Math.round(t.scale))return!1}return!0}}function K(...e){let t;for(const i of e)if(null!=i)if((0,u.BQ)(i)){if(t){const e=t.split("://")[0];t=e+":"+i.trim()}}else t=(0,u.oP)(i)?i:(0,u.fj)(t,i);return t?(0,u.UC)(t):void 0}async function U(e,t,i,s,o){let n,l,a;if((0,c.Te)(o),"string"==typeof i){const e=(0,u.S8)(i);a=await(0,r.A)(e,{...o,responseType:"json",query:{f:"json",...o?.query}}),a.ssl&&(n&&(n=n.replace(/^http:/i,"https:")),l&&(l=l.replace(/^http:/i,"https:"))),n=e,l=e}else null!=i&&(a={data:i},n=i.jsonUrl||null,l=s);const d=a?.data;if(H(d))return e.styleUrl=n||null,async function(e,t,i,s){const r=i?(0,u.nM)(i):(0,u.gd)();e.styleBase=r,e.style=t,t["sprite-format"]&&"webp"===t["sprite-format"].toLowerCase()&&(e.spriteFormat="webp");const o=[];if(t.sources&&t.sources.esri){const i=t.sources.esri;i.url?await U(e,"esri",K(r,i.url),void 0,s):o.push(U(e,"esri",i,r,s))}for(const n of Object.keys(t.sources))"esri"!==n&&"vector"===t.sources[n].type&&(t.sources[n].url?o.push(U(e,n,K(r,t.sources[n].url),void 0,s)):t.sources[n].tiles&&o.push(U(e,n,t.sources[n],r,s)));await Promise.all(o)}(e,d,l,o);if(function(e){return!H(e)}(d))return e.sourceUrl?W(e,d,l,!1,t,o):(e.sourceUrl=n||null,W(e,d,l,!0,t,o));throw new Error("You must specify the URL or the JSON for a service or for a style.")}function q(e){return"object"==typeof e&&!!e&&"tilejson"in e&&null!=e.tilejson}function H(e){return!!e&&"sources"in e&&!!e.sources}async function W(e,t,i,s,r,o){const n=i?(0,u.UC)(i)+"/":(0,u.gd)(),a=function(e){const t=512;if(function(e){return e.hasOwnProperty("tileInfo")}(e)){const i=e?.tileInfo;return null!=i&&(null==i.rows&&(i.rows=t),null==i.cols&&(i.cols=t)),e}const i={xmin:-20037507.067161843,ymin:-20037507.067161843,xmax:20037507.067161843,ymax:20037507.067161843,spatialReference:{wkid:102100,latestWkid:3857}};let s=null;if(q(e)){const{bounds:t}=e;if(t){const e=(0,P.Gh)({x:t[0],y:t[1],spatialReference:(0,l.o8)(O.KK)}),i=(0,P.Gh)({x:t[2],y:t[3],spatialReference:(0,l.o8)(O.KK)});s={xmin:e.x,ymin:e.y,xmax:i.x,ymax:i.y,spatialReference:(0,l.o8)(O.ch)}}}null===s&&(s=i);let r=78271.51696400007,o=295828763.7957775;const n=[],a=e.hasOwnProperty("maxzoom")&&null!=e.maxzoom?+e.maxzoom:22,c=0,u=0;for(let l=0;l<=a;l++)n.push({level:l,scale:o,resolution:r}),r/=2,o/=2;return{capabilities:"TilesOnly",initialExtent:s,fullExtent:i,minScale:c,maxScale:u,tiles:e.tiles,tileInfo:{rows:t,cols:t,dpi:96,format:"pbf",origin:{x:-20037508.342787,y:20037508.342787},lods:n,spatialReference:(0,l.o8)(O.ch)}}}(t),c=new z(r,(0,u.a6)(n,o?.query??{}),a);if(!s&&e.primarySourceName in e.sourceNameToSource){const t=e.sourceNameToSource[e.primarySourceName];if(!t.isCompatibleWith(c))return;null!=c.fullExtent&&(null!=t.fullExtent?t.fullExtent.union(c.fullExtent):t.fullExtent=c.fullExtent.clone()),t.tileInfo&&c.tileInfo&&t.tileInfo.lods.length<c.tileInfo.lods.length&&(t.tileInfo=c.tileInfo)}if(s&&(e.sourceBase=n,e.source=t,e.validatedSource=a,e.primarySourceName=r),e.sourceNameToSource[r]=c,!q(e)&&"defaultStyles"in t&&!e.style){if(null==t.defaultStyles)throw new Error;return"string"==typeof t.defaultStyles?U(e,"",K(n,t.defaultStyles,"root.json"),void 0,o):U(e,"",t.defaultStyles,K(n,"root.json"),o)}}var J=i(47231),Q=i(11210),Y=i(63680),X=i(97066),ee=i(50437);const te=1e-6;function ie(e,t){if(e===t)return!0;if(null==e&&null!=t)return!1;if(null!=e&&null==t)return!1;if(null==e||null==t)return!1;if(!e.spatialReference.equals(t.spatialReference)||e.dpi!==t.dpi)return!1;const i=e.origin,s=t.origin;if(Math.abs(i.x-s.x)>=te||Math.abs(i.y-s.y)>=te)return!1;let r,o;e.lods[0].scale>t.lods[0].scale?(r=e,o=t):(o=e,r=t);for(let n=r.lods[0].scale;n>=o.lods[o.lods.length-1].scale-te;n/=2)if(Math.abs(n-o.lods[0].scale)<te)return!0;return!1}function se(e,t){if(e===t)return e;if(null==e&&null!=t)return t;if(null!=e&&null==t)return e;if(null==e||null==t)return null;const i=e.size[0],s=e.format,r=e.dpi,o=new X.A({x:e.origin.x,y:e.origin.y}),n=e.spatialReference,l=e.lods[0].scale>t.lods[0].scale?e.lods[0]:t.lods[0],a=e.lods[e.lods.length-1].scale<=t.lods[t.lods.length-1].scale?e.lods[e.lods.length-1]:t.lods[t.lods.length-1],c=l.scale,u=l.resolution,d=a.scale,p=[];let h=c,y=u,m=0;for(;h>=d;)p.push(new ee.A({level:m,resolution:y,scale:h})),m++,h/=2,y/=2;return new R.A({size:[i,i],dpi:r,format:s||"pbf",origin:o,lods:p,spatialReference:n})}var re=i(17744),oe=i(75228);let ne=class extends((0,M.dM)((0,x.j)((0,A.J)((0,_.f)((0,w.b)((0,L.q)((0,I.A)((0,S.d)((0,b.p)((0,a.P)(v.A))))))))))){constructor(...e){super(...e),this._spriteSourceMap=new Map,this.currentStyleInfo=null,this.isReference=null,this.operationalLayerType="VectorTileLayer",this.path=null,this.refreshInterval=0,this.style=null,this.tilemapCache=null,this.type="vector-tile",this.url=null}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}destroy(){if(this.sourceNameToSource)for(const e of Object.values(this.sourceNameToSource))e?.destroy();this.primarySource?.destroy(),this._spriteSourceMap.clear()}async prefetchResources(e){await this.loadSpriteSource(globalThis.devicePixelRatio||1,e)}load(e){const t=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},e).catch(c.QP).then((async()=>{if(!this.portalItem?.id)return;const t=`${this.portalItem.itemCdnUrl}/resources/styles/root.json`;(await(0,r.A)(t,{...e,query:{f:"json",...this.customParameters,token:this.apiKey},authMode:this.portalItem.portal.authMode})).data&&this.read({url:t},(0,J.v)(this.portalItem,"portal-item"))})).catch(c.QP).then((()=>this._loadStyle(e)));return this.addResolvingPromise(t),Promise.resolve(this)}get attributionDataUrl(){const e=this.currentStyleInfo,t=e?.serviceUrl&&(0,u.An)(e.serviceUrl);if(!t)return null;const i=this._getDefaultAttribution(t.path);return i?(0,u.a6)(i,{...this.customParameters,token:this.apiKey}):null}get capabilities(){const e=this.primarySource;return e?e.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}}get fullExtent(){return this.primarySource?.fullExtent||null}get initialExtent(){return this.primarySource?.initialExtent||null}get parsedUrl(){return this.serviceUrl?(0,u.An)(this.serviceUrl):null}get serviceUrl(){return this.currentStyleInfo?.serviceUrl||null}get spatialReference(){return this.tileInfo?.spatialReference??null}get styleUrl(){return this.currentStyleInfo?.styleUrl||null}writeStyleUrl(e,t){e&&(0,u.BQ)(e)&&(e=`https:${e}`);const i=(0,Q.py)(e);t.styleUrl=(0,Y.e)(e,i)}get tileInfo(){const e=[];for(const i in this.sourceNameToSource)e.push(this.sourceNameToSource[i]);let t=this.primarySource?.tileInfo||new R.A;if(e.length>1)for(let i=0;i<e.length;i++)ie(t,e[i].tileInfo)&&(t=se(t,e[i].tileInfo));return t}readTilemapCache(e,t){const i=t.capabilities?.includes("Tilemap");return i?new Z.d({layer:this}):null}readVersion(e,t){return t.version?parseFloat(t.version):parseFloat(t.currentVersion)}async loadSpriteSource(e=1,t){if(!this._spriteSourceMap.has(e)){const i=(0,oe.C)().maxTextureSize,s=this.currentStyleInfo?.spriteUrl?(0,u.a6)(this.currentStyleInfo.spriteUrl,{...this.customParameters,token:this.apiKey}):null,r=new E({type:"url",spriteUrl:s,pixelRatio:e,spriteFormat:this.currentStyleInfo?.spriteFormat},i);await r.load(t),this._spriteSourceMap.set(e,r)}return this._spriteSourceMap.get(e)}async setSpriteSource(e,t){if(!e)return null;const i=(0,oe.C)().maxTextureSize,s=e.spriteUrl,r=s?(0,u.a6)(s,{...this.customParameters,token:this.apiKey}):null;if(!r&&"url"===e.type)return null;const o=new E(e,i);try{await o.load(t);const i=e.pixelRatio||1;return this._spriteSourceMap.clear(),this._spriteSourceMap.set(i,o),r&&this.currentStyleInfo&&(this.currentStyleInfo.spriteUrl=r),this.emit("spriteSource-change",{spriteSource:o}),o}catch(j){(0,c.QP)(j)}return null}async loadStyle(e,t){const i=e||this.style||this.url;return this._loadingTask&&"string"==typeof i&&this.url===i||(this._loadingTask?.abort(),this._loadingTask=(0,o.UT)((e=>(this._spriteSourceMap.clear(),this._getSourceAndStyle(i,{signal:e}))),t)),this._loadingTask.promise}getStyleLayerId(e){return this.styleRepository.getStyleLayerId(e)}getStyleLayerIndex(e){return this.styleRepository.getStyleLayerIndex(e)}getPaintProperties(e){return(0,l.o8)(this.styleRepository?.getPaintProperties(e))}setPaintProperties(e,t){const i=this.styleRepository.isPainterDataDriven(e);this.styleRepository.setPaintProperties(e,t);const s=this.styleRepository.isPainterDataDriven(e);this.emit("paint-change",{layer:e,paint:t,isDataDriven:i||s})}getStyleLayer(e){return(0,l.o8)(this.styleRepository.getStyleLayer(e))}setStyleLayer(e,t){this.styleRepository.setStyleLayer(e,t),this.emit("style-layer-change",{layer:e,index:t})}deleteStyleLayer(e){this.styleRepository.deleteStyleLayer(e),this.emit("delete-style-layer",{layer:e})}getLayoutProperties(e){return(0,l.o8)(this.styleRepository.getLayoutProperties(e))}setLayoutProperties(e,t){this.styleRepository.setLayoutProperties(e,t),this.emit("layout-change",{layer:e,layout:t})}setStyleLayerVisibility(e,t){this.styleRepository.setStyleLayerVisibility(e,t),this.emit("style-layer-visibility-change",{layer:e,visibility:t})}getStyleLayerVisibility(e){return this.styleRepository.getStyleLayerVisibility(e)}write(e,t){return t?.origin&&!this.styleUrl?(t.messages&&t.messages.push(new n.A("vectortilelayer:unsupported",`VectorTileLayer (${this.title}, ${this.id}) with style defined by JSON only are not supported`,{layer:this})),null):super.write(e,t)}getTileUrl(e,t,i){return null}async _getSourceAndStyle(e,t){if(!e)throw new Error("invalid style!");const i=await async function(e,t){const i={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:"",spriteFormat:"png"},[s,r]="string"==typeof e?[e,null]:[null,e.jsonUrl];return await U(i,"esri",e,r,t),{layerDefinition:i.validatedSource,url:s,serviceUrl:i.sourceUrl,style:i.style,styleUrl:i.styleUrl,spriteUrl:i.style.sprite&&K(i.styleBase,i.style.sprite),spriteFormat:i.spriteFormat,glyphsUrl:i.style.glyphs&&K(i.styleBase,i.style.glyphs),sourceNameToSource:i.sourceNameToSource,primarySourceName:i.primarySourceName}}(e,{...t,query:{...this.customParameters,token:this.apiKey}});"webp"===i.spriteFormat&&(await function(e){if(C)return C;const t={lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"};return C=new Promise((i=>{const s=new Image;s.onload=()=>{s.onload=s.onerror=null,i(s.width>0&&s.height>0)},s.onerror=()=>{s.onload=s.onerror=null,i(!1)},s.src="data:image/webp;base64,"+t[e]})),C}("lossy")||(i.spriteFormat="png")),this._set("currentStyleInfo",{...i}),"string"==typeof e?(this.url=e,this.style=null):(this.url=null,this.style=e),this._set("sourceNameToSource",i.sourceNameToSource),this._set("primarySource",i.sourceNameToSource[i.primarySourceName]),this._set("styleRepository",new re.A(i.style,!1)),this.read(i.layerDefinition,{origin:"service"}),this.emit("load-style")}_getDefaultAttribution(e){const t=e.match(/^https?:\/\/(?:basemaps|basemapsbeta|basemapsdev)(?:-api)?\.arcgis\.com(\/[^/]+)?\/arcgis\/rest\/services\/([^/]+(\/[^/]+)*)\/vectortileserver/i),i=["OpenBasemap_v2","OpenBasemap_GCS_v2","OpenStreetMap_v2","OpenStreetMap_Daylight_v2","OpenStreetMap_Export_v2","OpenStreetMap_FTS_v2","OpenStreetMap_GCS_v2","World_Basemap","World_Basemap_v2","World_Basemap_Export_v2","World_Basemap_GCS_v2","World_Basemap_WGS84","World_Contours_v2","World_Hillshade_v2"];if(!t)return;const s=t[2]&&t[2].toLowerCase();if(!s)return;const r=t[1]||"";for(const o of i)if(o.toLowerCase().includes(s))return(0,u.S8)(`//static.arcgis.com/attribution/Vector${r}/${o}`)}async _loadStyle(e){return this._loadingTask?.promise??this.loadStyle(null,e)}};(0,s._)([(0,d.MZ)({readOnly:!0})],ne.prototype,"attributionDataUrl",null),(0,s._)([(0,d.MZ)({type:["show","hide"]})],ne.prototype,"listMode",void 0),(0,s._)([(0,d.MZ)({json:{read:!0,write:!0}})],ne.prototype,"blendMode",void 0),(0,s._)([(0,d.MZ)({readOnly:!0,json:{read:!1}})],ne.prototype,"capabilities",null),(0,s._)([(0,d.MZ)({readOnly:!0})],ne.prototype,"currentStyleInfo",void 0),(0,s._)([(0,d.MZ)({json:{read:!1},readOnly:!0,type:g.A})],ne.prototype,"fullExtent",null),(0,s._)([(0,d.MZ)({json:{read:!1},readOnly:!0,type:g.A})],ne.prototype,"initialExtent",null),(0,s._)([(0,d.MZ)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],ne.prototype,"isReference",void 0),(0,s._)([(0,d.MZ)({type:["VectorTileLayer"]})],ne.prototype,"operationalLayerType",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],ne.prototype,"parsedUrl",null),(0,s._)([(0,d.MZ)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],ne.prototype,"path",void 0),(0,s._)([(0,d.MZ)({type:Number,json:{write:!1,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],ne.prototype,"refreshInterval",void 0),(0,s._)([(0,d.MZ)()],ne.prototype,"style",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],ne.prototype,"serviceUrl",null),(0,s._)([(0,d.MZ)({type:f.A,readOnly:!0})],ne.prototype,"spatialReference",null),(0,s._)([(0,d.MZ)({readOnly:!0})],ne.prototype,"styleRepository",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],ne.prototype,"sourceNameToSource",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],ne.prototype,"primarySource",void 0),(0,s._)([(0,d.MZ)({type:String,readOnly:!0,json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],ne.prototype,"styleUrl",null),(0,s._)([(0,m.K)(["portal-item","web-document"],"styleUrl")],ne.prototype,"writeStyleUrl",null),(0,s._)([(0,d.MZ)({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:R.A})],ne.prototype,"tileInfo",null),(0,s._)([(0,d.MZ)()],ne.prototype,"tilemapCache",void 0),(0,s._)([(0,h.w)("service","tilemapCache",["capabilities","tileInfo"])],ne.prototype,"readTilemapCache",null),(0,s._)([(0,d.MZ)({json:{read:!1},readOnly:!0,value:"vector-tile"})],ne.prototype,"type",void 0),(0,s._)([(0,d.MZ)({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],ne.prototype,"url",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],ne.prototype,"version",void 0),(0,s._)([(0,h.w)("version",["version","currentVersion"])],ne.prototype,"readVersion",null),ne=(0,s._)([(0,y.$)("esri.layers.VectorTileLayer")],ne);const le=ne},62783:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ee});var s=i(66866),r=i(56542),o=i(35775),n=i(76724),l=i(20909),a=i(21564),c=i(73446),u=i(39831),d=(i(9272),i(63863)),p=i(77542),h=i(84698),y=i(78983),m=i(12433),g=i(68833),f=i(98849),v=i(45307),b=i(539),_=i(40189),w=i(90752),M=i(20061),S=i(29299),L=i(36628),I=i(57822),A=i(54088);let x=class extends v.A{constructor(){super(...arguments),this._connection=null,this._workerHandler=null,this.capabilities=(0,M.f)(!1,!1),this.type="wfs",this.refresh=(0,_.sg)((async()=>{await this.load();const e={customParameters:this.layer.customParameters,maxRecordCount:this.layer.maxRecordCount,maxTotalRecordCount:this.layer.maxTotalRecordCount,maxPageCount:this.layer.maxPageCount},{extent:t}=await this._workerHandler.refresh(e);return t&&(this.sourceJSON.extent=t),{dataChanged:!0,updates:{extent:this.sourceJSON.extent}}}))}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this._startWorker({signal:t})),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null,this._workerHandler=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,t={}){const i=await this.queryFeaturesJSON(e,t);return I.A.fromJSON(i)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._workerHandler.queryFeatures(e?e.toJSON():void 0,t)}async queryFeatureCount(e,t={}){return await this.load(t),this._workerHandler.queryFeatureCount(e?e.toJSON():void 0,t)}async queryObjectIds(e,t={}){return await this.load(t),this._workerHandler.queryObjectIds(e?e.toJSON():void 0,t)}async queryExtent(e,t={}){await this.load(t);const i=await this._workerHandler.queryExtent(e?e.toJSON():void 0,t);return{count:i.count,extent:h.A.fromJSON(i.extent)}}async querySnapping(e,t={}){return await this.load(t),this._workerHandler.querySnapping(e,t)}async queryAttributeBins(e,t={}){await this.load(t);const i=await this._workerHandler.queryAttributeBins(e?.toJSON(),t);return L.A.fromJSON(i)}async _createLoadOptions(e){const{url:t,customParameters:i,name:s,namespaceUri:r,fields:o,geometryType:n,maxRecordCount:l,maxPageCount:a,maxTotalRecordCount:c,swapXY:u}=this.layer,d="defaults"===this.layer.originOf("spatialReference")?void 0:this.layer.spatialReference;if(!t)throw new f.A("wfs-layer:missing-url","WFSLayer must be created with a url");this.wfsCapabilities||(this.wfsCapabilities=await(0,S.Fu)(t,{customParameters:i,...e}));const p=["fields","geometryType","name","namespaceUri","swapXY"].some((e=>null==this.layer[e])),h=p?await(0,S.O8)(this.wfsCapabilities,s,r,{spatialReference:d,customParameters:i,signal:e?.signal}):{...(0,S.YW)(o??[]),geometryType:n,name:s,namespaceUri:r,spatialReference:d,swapXY:u},y=(0,S.mG)(this.wfsCapabilities.readFeatureTypes(),h.name,h.namespaceUri),g=m.gy.toJSON(h.geometryType),{operations:v}=this.wfsCapabilities,b=v.GetFeature.url,_=v.GetFeature.outputFormat;return{customParameters:i,featureType:y,fields:h.fields?.map((e=>e.toJSON()))??[],geometryField:h.geometryField,geometryType:g,getFeatureUrl:b,getFeatureOutputFormat:_,maxRecordCount:l,maxPageCount:a,maxTotalRecordCount:c,objectIdField:h.objectIdField,spatialReference:h.spatialReference?.toJSON(),swapXY:!!h.swapXY}}async _startWorker(e){const[t,i]=await(0,_.Lx)([this._createLoadOptions(e),(0,w.ho)("WFSSourceWorker",{...e,strategy:(0,u.A)("feature-layers-workers")?"dedicated":"local",registryTarget:this})]),s=t.error||i.error||null,r=i.value||null;if(s)throw r&&r.close(),s;const o=t.value;this._connection=i.value,this._workerHandler=this._connection.createInvokeProxy();const n=await this._workerHandler.load(o,e);for(const l of n.warnings)b.A.getLogger(this.layer).warn("#load()",`${l.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:l});this.sourceJSON={dateFieldsTimeReference:{timeZoneIANA:A.n$},extent:n.extent,fields:o.fields,geometryType:o.geometryType,objectIdField:o.objectIdField,geometryField:o.geometryField,drawingInfo:(0,M.F0)(o.geometryType),name:o.featureType.title,wfsInfo:{name:o.featureType.name,featureUrl:o.getFeatureUrl,maxFeatures:o.maxRecordCount,swapXY:o.swapXY,supportedSpatialReferences:o.featureType.supportedSpatialReferences,version:"2.0.0",wfsNamespace:o.featureType.namespaceUri}}}};(0,s._)([(0,a.MZ)()],x.prototype,"capabilities",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],x.prototype,"layer",void 0),(0,s._)([(0,a.MZ)()],x.prototype,"sourceJSON",void 0),(0,s._)([(0,a.MZ)()],x.prototype,"type",void 0),(0,s._)([(0,a.MZ)()],x.prototype,"wfsCapabilities",void 0),x=(0,s._)([(0,d.$)("esri.layers.graphics.sources.WFSSource")],x);var C,T=i(15305),E=i(16161),F=i(54576),R=i(15053),Z=i(94783),O=i(41506),P=i(30111),k=i(34722),D=i(50508),N=i(25389),$=i(90826),V=i(40021),B=i(76592),j=i(52506),G=i(24738),z=i(77567),K=i(42453),U=i(61826),q=i(79682),H=i(53835),W=i(14474),J=i(44116),Q=i(12129);const Y=(0,z.p)();let X=C=class extends((0,P.fY)((0,F.FJ)((0,E.d)((0,Z.J)((0,R.F)((0,T.dM)((0,$.e)((0,V.d)((0,D.J)((0,N.j)((0,O.q)((0,k.A)((0,o.P)(g.A)))))))))))))){static fromWFSLayerInfo(e){const{customParameters:t,fields:i,geometryField:s,geometryType:r,name:o,namespaceUri:n,objectIdField:l,spatialReference:a,swapXY:c,url:u,wfsCapabilities:d}=e;return new C({customParameters:t,fields:i,geometryField:s,geometryType:r,name:o,namespaceUri:n,objectIdField:l,spatialReference:a,swapXY:c,url:u,wfsCapabilities:d})}constructor(e){super(e),this.copyright=null,this.customParameters=null,this.dateFieldsTimeZone=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.featureUrl=void 0,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="WFS",this.maxRecordCount=3e3,this.maxPageCount=10,this.maxTotalRecordCount=2e5,this.mode=0,this.name=null,this.namespaceUri=null,this.outFields=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new x({layer:this}),this.spatialReference=y.A.WGS84,this.spatialReferences=[4326],this.swapXY=void 0,this.title="WFS",this.type="wfs",this.url=null,this.version=void 0}destroy(){this.source?.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WFS"]},e).then((()=>this.source.load(e))).then((()=>{this.read(this.source.sourceJSON,{origin:"service",url:this.parsedUrl}),this.revert(["objectIdField","fields","timeInfo","spatialReference","name","namespaceUri"],"service"),(0,K.yp)(this.renderer,this.fieldsIndex),(0,K.sv)(this.timeInfo,this.fieldsIndex)}))),Promise.resolve(this)}get capabilities(){return this.source?.capabilities}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,i){const s=e.filter((e=>e.name!==S.i5));this.geometryField&&s.unshift(new G.A({name:this.geometryField,alias:this.geometryField,type:"geometry"})),(0,n.sM)(i,s.map((e=>e.toJSON())),t)}get parsedUrl(){return(0,l.An)(this.url)}set renderer(e){(0,K.yp)(e,this.fieldsIndex),this._set("renderer",e)}get wfsCapabilities(){return this.source?.wfsCapabilities}set wfsCapabilities(e){this.source&&(this.source.wfsCapabilities=e)}createPopupTemplate(e){return(0,J.tn)(this,e)}createQuery(){const e=new W.A({returnGeometry:!0,outFields:["*"],where:this.definitionExpression||"1=1"}),{timeOffset:t,timeExtent:i}=this;return e.timeExtent=null!=t&&null!=i?i.offset(-t.value,t.unit):i||null,e}getFieldDomain(e,t){return this.getField(e)?.domain}getField(e){return this.fieldsIndex?.get(e)}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(W.A.from(e)||this.createQuery(),t))).then((e=>{if(e?.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this.load().then((()=>this.source.queryObjectIds(W.A.from(e)||this.createQuery(),t)))}queryFeatureCount(e,t){return this.load().then((()=>this.source.queryFeatureCount(W.A.from(e)||this.createQuery(),t)))}queryExtent(e,t){return this.load().then((()=>this.source.queryExtent(W.A.from(e)||this.createQuery(),t)))}async queryAttributeBins(e,t){const{source:s,capabilities:r}=await this.load();(0,j.ZJ)(e,r,"WFSLayer");const o=await Promise.all([i.e(72076),i.e(45970)]).then(i.bind(i,45970)),n=await s.queryAttributeBins(o.default.from(e),t);if(n.features)for(const i of n.features)i.layer=i.sourceLayer=this;return n}async hasDataChanged(){try{const{dataChanged:e,updates:t}=await this.source.refresh();return null!=t&&this.read(t,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}};(0,s._)([(0,a.MZ)({readOnly:!0})],X.prototype,"capabilities",null),(0,s._)([(0,a.MZ)({type:String})],X.prototype,"copyright",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],X.prototype,"createQueryVersion",null),(0,s._)([(0,a.MZ)({json:{name:"wfsInfo.customParameters",write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0),ignoreOrigin:!0})}}})],X.prototype,"customParameters",void 0),(0,s._)([(0,a.MZ)((0,Q.P6)("dateFieldsTimeReference"))],X.prototype,"dateFieldsTimeZone",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],X.prototype,"defaultPopupTemplate",null),(0,s._)([(0,a.MZ)({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],X.prototype,"definitionExpression",void 0),(0,s._)([(0,a.MZ)({type:String})],X.prototype,"displayField",void 0),(0,s._)([(0,a.MZ)(B.Yj)],X.prototype,"elevationInfo",void 0),(0,s._)([(0,a.MZ)({type:String,readOnly:!0,json:{name:"wfsInfo.featureUrl",write:{ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"featureUrl",void 0),(0,s._)([(0,a.MZ)({type:[G.A],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],X.prototype,"fields",void 0),(0,s._)([(0,p.K)("fields")],X.prototype,"writeFields",null),(0,s._)([(0,a.MZ)(Y.fieldsIndex)],X.prototype,"fieldsIndex",void 0),(0,s._)([(0,a.MZ)({type:h.A,json:{name:"extent"}})],X.prototype,"fullExtent",void 0),(0,s._)([(0,a.MZ)()],X.prototype,"geometryField",void 0),(0,s._)([(0,a.MZ)({type:String,json:{read:{source:"layerDefinition.geometryType",reader:m.gy.read},write:{target:"layerDefinition.geometryType",writer:m.gy.write,ignoreOrigin:!0},origins:{service:{read:m.gy.read}}}})],X.prototype,"geometryType",void 0),(0,s._)([(0,a.MZ)({type:String})],X.prototype,"id",void 0),(0,s._)([(0,a.MZ)(B.kF)],X.prototype,"labelsVisible",void 0),(0,s._)([(0,a.MZ)({type:[U.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:q.w},write:!0}})],X.prototype,"labelingInfo",void 0),(0,s._)([(0,a.MZ)(B.fV)],X.prototype,"legendEnabled",void 0),(0,s._)([(0,a.MZ)({type:["show","hide"]})],X.prototype,"listMode",void 0),(0,s._)([(0,a.MZ)({type:String})],X.prototype,"objectIdField",void 0),(0,s._)([(0,a.MZ)({type:["WFS"]})],X.prototype,"operationalLayerType",void 0),(0,s._)([(0,a.MZ)({type:c.jz,json:{name:"wfsInfo.maxFeatures",write:{ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"maxRecordCount",void 0),(0,s._)([(0,a.MZ)({type:c.jz})],X.prototype,"maxPageCount",void 0),(0,s._)([(0,a.MZ)({type:c.jz})],X.prototype,"maxTotalRecordCount",void 0),(0,s._)([(0,a.MZ)({type:[0],readOnly:!0,json:{origins:{"web-map":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],X.prototype,"mode",void 0),(0,s._)([(0,a.MZ)({type:String,json:{name:"wfsInfo.name",write:{ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"name",void 0),(0,s._)([(0,a.MZ)({type:String,json:{name:"wfsInfo.wfsNamespace",write:{ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"namespaceUri",void 0),(0,s._)([(0,a.MZ)(B.Ih)],X.prototype,"opacity",void 0),(0,s._)([(0,a.MZ)(Y.outFields)],X.prototype,"outFields",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],X.prototype,"parsedUrl",null),(0,s._)([(0,a.MZ)(B.M6)],X.prototype,"popupEnabled",void 0),(0,s._)([(0,a.MZ)({type:r.A,json:{name:"popupInfo",write:!0}})],X.prototype,"popupTemplate",void 0),(0,s._)([(0,a.MZ)({types:H.Hg,json:{origins:{service:{name:"drawingInfo.renderer"},"web-scene":{types:H.XJ,name:"layerDefinition.drawingInfo.renderer",write:!0}},name:"layerDefinition.drawingInfo.renderer",write:{ignoreOrigin:!0}}})],X.prototype,"renderer",null),(0,s._)([(0,a.MZ)(B.PY)],X.prototype,"screenSizePerspectiveEnabled",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],X.prototype,"source",void 0),(0,s._)([(0,a.MZ)({type:y.A,json:{name:"layerDefinition.spatialReference",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"extent.spatialReference"}}}})],X.prototype,"spatialReference",void 0),(0,s._)([(0,a.MZ)({readOnly:!0,type:[c.jz],json:{name:"wfsInfo.supportedSpatialReferences",write:{ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"spatialReferences",void 0),(0,s._)([(0,a.MZ)({type:Boolean,value:!1,json:{name:"wfsInfo.swapXY",write:{ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"swapXY",void 0),(0,s._)([(0,a.MZ)({json:{write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"name"}}}})],X.prototype,"title",void 0),(0,s._)([(0,a.MZ)({json:{read:!1},readOnly:!0})],X.prototype,"type",void 0),(0,s._)([(0,a.MZ)(B.OZ)],X.prototype,"url",void 0),(0,s._)([(0,a.MZ)({type:String,readOnly:!0,json:{name:"wfsInfo.version",write:{ignoreOrigin:!0,isRequired:!0}}})],X.prototype,"version",void 0),(0,s._)([(0,a.MZ)()],X.prototype,"wfsCapabilities",null),X=C=(0,s._)([(0,d.$)("esri.layers.WFSLayer")],X);const ee=X},25719:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Le});var s,r=i(66866),o=i(21121),n=i(25707),l=i(56542),a=i(86394),c=i(48982),u=i(14798),d=i(98849),p=i(59851),h=i(19251),y=i(35775),m=i(40189),g=i(85251),f=i(25816),v=i(20909),b=i(21564),_=i(73446),w=i(75094),M=i(63863),S=i(77542),L=i(77373),I=i(84698),A=i(78983),x=i(61781),C=i(87926),T=i(68833),E=i(15305),F=i(41506),R=i(34722),Z=i(50508),O=i(25389),P=i(90826),k=i(2555),D=i(16123),N=i(76592),$=i(63232),V=i(52775),B=i(65667),j=i(4130);i(39831),i(9272);let G=0,z=s=class extends(B.A.IdentifiableMixin(y.L)){constructor(e){super(e),this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.legendUrl=null,this.legendEnabled=!0,this.layer=null,this.maxScale=0,this.minScale=0,this.name=null,this.parent=null,this.popupEnabled=!1,this.queryable=!1,this.sublayers=null,this.spatialReferences=null,this.title=null,this.addHandles([(0,g.on)((()=>this.sublayers),"after-add",(({item:e})=>{e.parent=this,e.layer=this.layer}),g.OH),(0,g.on)((()=>this.sublayers),"after-remove",(({item:e})=>{e.layer=e.parent=null}),g.OH),(0,g.wB)((()=>this.sublayers),((e,t)=>{if(t)for(const i of t)i.layer=i.parent=null;if(e)for(const i of e)i.parent=this,i.layer=this.layer}),g.OH),(0,g.wB)((()=>this.layer),(e=>{if(this.sublayers)for(const t of this.sublayers)t.layer=e}),g.OH)])}get id(){return this._get("id")??G++}set id(e){this._set("id",e)}readLegendUrl(e,t){return t.legendUrl??t.legendURL??null}get effectiveScaleRange(){const{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}castSublayers(e){return(0,_.dp)(c.A.ofType(s),e)}set visible(e){this._setAndNotifyLayer("visible",e)}clone(){const e=new s;return this.hasOwnProperty("description")&&(e.description=this.description),this.hasOwnProperty("fullExtent")&&(e.fullExtent=this.fullExtent.clone()),this.hasOwnProperty("fullExtents")&&(e.fullExtents=this.fullExtents?.map((e=>e.clone()))??null),this.hasOwnProperty("legendUrl")&&(e.legendUrl=this.legendUrl),this.hasOwnProperty("legendEnabled")&&(e.legendEnabled=this.legendEnabled),this.hasOwnProperty("layer")&&(e.layer=this.layer),this.hasOwnProperty("name")&&(e.name=this.name),this.hasOwnProperty("parent")&&(e.parent=this.parent),this.hasOwnProperty("queryable")&&(e.queryable=this.queryable),this.hasOwnProperty("sublayers")&&(e.sublayers=this.sublayers?.map((e=>e.clone()))),this.hasOwnProperty("spatialReferences")&&(e.spatialReferences=this.spatialReferences?.map((e=>e))),this.hasOwnProperty("visible")&&(e.visible=this.visible),this.hasOwnProperty("title")&&(e.title=this.title),e}_setAndNotifyLayer(e,t){const i=this.layer;this._get(e)!==t&&(this._set(e,t),i&&i.emit("wms-sublayer-update",{propertyName:e,id:this.id}))}};(0,r._)([(0,b.MZ)()],z.prototype,"description",void 0),(0,r._)([(0,b.MZ)({readOnly:!0})],z.prototype,"dimensions",void 0),(0,r._)([(0,b.MZ)({type:I.A,json:{name:"extent"}})],z.prototype,"fullExtent",void 0),(0,r._)([(0,b.MZ)()],z.prototype,"fullExtents",void 0),(0,r._)([(0,b.MZ)({type:Number,json:{write:{enabled:!1,overridePolicy:()=>({ignoreOrigin:!0,enabled:!0})}}})],z.prototype,"id",null),(0,r._)([(0,b.MZ)({type:String,json:{name:"legendUrl",write:{ignoreOrigin:!0}}})],z.prototype,"legendUrl",void 0),(0,r._)([(0,w.w)("legendUrl",["legendUrl","legendURL"])],z.prototype,"readLegendUrl",null),(0,r._)([(0,b.MZ)({type:Boolean,json:{name:"showLegend",origins:{"web-map":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],z.prototype,"legendEnabled",void 0),(0,r._)([(0,b.MZ)()],z.prototype,"layer",void 0),(0,r._)([(0,b.MZ)()],z.prototype,"maxScale",void 0),(0,r._)([(0,b.MZ)()],z.prototype,"minScale",void 0),(0,r._)([(0,b.MZ)({readOnly:!0})],z.prototype,"effectiveScaleRange",null),(0,r._)([(0,b.MZ)({type:String,json:{write:{ignoreOrigin:!0}}})],z.prototype,"name",void 0),(0,r._)([(0,b.MZ)()],z.prototype,"parent",void 0),(0,r._)([(0,b.MZ)({type:Boolean,json:{read:{source:"showPopup"},write:{ignoreOrigin:!0,target:"showPopup"}}})],z.prototype,"popupEnabled",void 0),(0,r._)([(0,b.MZ)({type:Boolean,json:{write:{ignoreOrigin:!0}}})],z.prototype,"queryable",void 0),(0,r._)([(0,b.MZ)()],z.prototype,"sublayers",void 0),(0,r._)([(0,j.w)("sublayers")],z.prototype,"castSublayers",null),(0,r._)([(0,b.MZ)({type:[Number],json:{read:{source:"spatialReferences"}}})],z.prototype,"spatialReferences",void 0),(0,r._)([(0,b.MZ)({type:String,json:{write:{ignoreOrigin:!0}}})],z.prototype,"title",void 0),(0,r._)([(0,b.MZ)({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"}}})],z.prototype,"visible",null),z=s=(0,r._)([(0,M.$)("esri.layers.support.WMSSublayer")],z);var K=i(85569),U=i(34495);const q={84:4326,83:4269,27:4267};function H(e){if(!e)return null;const t={idCounter:-1};"string"==typeof e&&(e=(new DOMParser).parseFromString(e,"text/xml"));const i=e.documentElement;if("ServiceExceptionReport"===i.nodeName){const e=Array.prototype.slice.call(i.childNodes).map((e=>e.textContent)).join("\r\n");throw new d.A("wmslayer:wms-capabilities-xml-is-not-valid","The server returned errors when the WMS capabilities were requested.",e)}const s=Y("Capability",i),r=Y("Service",i),o=s&&Y("Request",s);if(!s||!r||!o)return null;const n=Y("Layer",s);if(!n)return null;const l="WMS_Capabilities"===i.nodeName||"WMT_MS_Capabilities"===i.nodeName?i.getAttribute("version"):"1.3.0",a=ee("Title",r,"")||ee("Name",r,""),c=ee("AccessConstraints",r,""),u=/^none$/i.test(c)?"":c,p=ee("Abstract",r,""),h=parseInt(ee("MaxWidth",r,"5000"),10),y=parseInt(ee("MaxHeight",r,"5000"),10),m=se(o,"GetMap"),g=ie(o,"GetMap"),f=oe(n,l,t);if(!f)return null;let v,b=0;const _=Array.prototype.slice.call(s.childNodes),w=f.sublayers??[],M=e=>{null!=e&&w.push(e)};_.forEach((e=>{"Layer"===e.nodeName&&(0===b?v=e:1===b?(f.name&&(f.name="",M(oe(v,l,t))),M(oe(e,l,t))):M(oe(e,l,t)),b++)}));const S=f.sublayers??[],L=f.fullExtents??[];0===S.length&&S.push(f),f.extent??=S[0].extent;const I=f.spatialReferences.length>0?f.spatialReferences:W(f),A=ie(o,"GetFeatureInfo"),x=A?se(o,"GetFeatureInfo"):null,C=J(S),T=f.minScale||0,E=f.maxScale||0,F=f.dimensions??[],R=C.reduce(((e,t)=>e.concat(t.dimensions??[])),[]),Z=F.concat(R).filter(ae);let O=null;if(Z.length){const e=Z.map((e=>{const{extent:t}=e;return function(e){return Array.isArray(e)&&e.length>0&&e[0]instanceof Date}(t)?t.map((e=>e.getTime())):t?.map((e=>[e.min.getTime(),e.max.getTime()]))})).flat(2).filter(K.Ru),{start:t,end:i}=e.reduce(((e,t)=>({start:Math.min(e.start,t),end:Math.max(e.end,t)})),{start:1/0,end:-1/0});O={startTimeField:null,endTimeField:null,trackIdField:void 0,timeExtent:[t,i]}}return{copyright:u,description:p,dimensions:F,extent:f.extent,fullExtents:L,featureInfoFormats:x,featureInfoUrl:A,mapUrl:g,maxWidth:h,maxHeight:y,maxScale:E,minScale:T,layers:C,spatialReferences:I,supportedImageFormatTypes:m,timeInfo:O,title:a,version:l}}function W(e){if(e.spatialReferences.length>0)return e.spatialReferences;if(e.sublayers)for(const t of e.sublayers){const e=W(t);if(e.length>0)return e}return[]}function J(e){let t=[];for(const i of e)t.push(i),i.sublayers?.length&&(t=t.concat(J(i.sublayers)),delete i.sublayers);return t}function Q(e,t,i){return t.getAttribute(e)??i}function Y(e,t){for(let i=0;i<t.childNodes.length;i++){const s=t.childNodes[i];if(ne(s)&&s.nodeName===e)return s}return null}function X(e,t){if(null==t)return[];const i=[];for(let s=0;s<t.childNodes.length;s++){const r=t.childNodes[s];ne(r)&&r.nodeName===e&&i.push(r)}return i}function ee(e,t,i){return Y(e,t)?.textContent??i}function te(e,t,i){const s=parseFloat(e.getAttribute("minx")??"0"),r=parseFloat(e.getAttribute("miny")??"0"),o=parseFloat(e.getAttribute("maxx")??"0"),n=parseFloat(e.getAttribute("maxy")??"0");return{xmin:i?isNaN(r)?-Number.MAX_VALUE:r:isNaN(s)?-Number.MAX_VALUE:s,ymin:i?isNaN(s)?-Number.MAX_VALUE:s:isNaN(r)?-Number.MAX_VALUE:r,xmax:i?isNaN(n)?Number.MAX_VALUE:n:isNaN(o)?Number.MAX_VALUE:o,ymax:i?isNaN(o)?Number.MAX_VALUE:o:isNaN(n)?Number.MAX_VALUE:n,spatialReference:{wkid:t}}}function ie(e,t){const i=Y(t,e);if(i){const e=Y("DCPType",i);if(e){const t=Y("HTTP",e);if(t){const e=Y("Get",t);if(e){let t=function(e,t,i,s){const r=Y(e,i);return r?Q(t,r,s):s}("OnlineResource","xlink:href",e,null);if(t){const e=t.indexOf("&");return-1!==e&&e===t.length-1&&(t=t.slice(0,-1)),function(e,t){const i=[],s=(0,v.An)(e);for(const r in s.query)s.query.hasOwnProperty(r)&&(t.includes(r.toLowerCase())||i.push(r+"="+s.query[r]));return s.path+(i.length?"?"+i.join("&"):"")}(t,["service","request"])}}}}}return null}function se(e,t){const i=X("Operation",e);if(!i.length)return X("Format",Y(t,e)).map((({textContent:e})=>e)).filter(K.Ru);const s=[];for(const r of i)if(r.getAttribute("name")===t){const e=X("Format",r);for(const{textContent:t}of e)null!=t&&s.push(t)}return s}function re(e,t,i){const s=Y(t,e);if(!s)return i;const{textContent:r}=s;if(null==r||""===r)return i;const o=Number(r);return isNaN(o)?i:o}function oe(e,t,i){if(!e)return null;const s=e.getAttribute("queryable")?.toLowerCase(),r="1"===s||"true"===s,o={id:i.idCounter++,fullExtents:[],parentLayerId:null,queryable:r,spatialReferences:[],sublayers:null},n=Y("LatLonBoundingBox",e),l=Y("EX_GeographicBoundingBox",e),a=n?te(n,4326):l?{xmin:parseFloat(ee("westBoundLongitude",l,"0")),ymin:parseFloat(ee("southBoundLatitude",l,"0")),xmax:parseFloat(ee("eastBoundLongitude",l,"0")),ymax:parseFloat(ee("northBoundLatitude",l,"0")),spatialReference:{wkid:4326}}:{xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:{wkid:4326}};o.minScale=re(e,"MaxScaleDenominator",0),o.maxScale=re(e,"MinScaleDenominator",0);const c=["1.0.0","1.1.0","1.1.1"].includes(t)?"SRS":"CRS";return Array.prototype.slice.call(e.childNodes).forEach((e=>{if("Name"===e.nodeName)o.name=e.textContent||"";else if("Title"===e.nodeName)o.title=e.textContent||"";else if("Abstract"===e.nodeName)o.description=e.textContent||"";else if("BoundingBox"===e.nodeName){const i=e.getAttribute(c),s=i?.indexOf(":");if(s&&s>-1){let r=parseInt(i.slice(s+1),10);0===r||isNaN(r)||(r=q[r]??r);const n="1.3.0"===t?te(e,r,(0,k.m)(r)):te(e,r);n&&o.fullExtents&&o.fullExtents.push(n)}}else if(e.nodeName===c)(e.textContent?.split(" ")??[]).forEach((e=>{let t=NaN;if(e.includes(":")){const[i,s]=e.toUpperCase().split(":");"CRS"!==i&&"EPSG"!==i||(t=parseInt(s,10))}else t=parseInt(e,10);if(0!==t&&!isNaN(t)){const e=q[t]??t;o.spatialReferences.includes(e)||o.spatialReferences.push(e)}}));else if("Style"!==e.nodeName||o.legendUrl){if("Layer"===e.nodeName){const s=oe(e,t,i);s&&(s.parentLayerId=o.id,o.sublayers||(o.sublayers=[]),o.sublayers.push(s))}}else{const t=Y("LegendURL",e);if(t){const e=Y("OnlineResource",t);e&&(o.legendUrl=e.getAttribute("xlink:href"))}}})),o.extent=a,o.dimensions=X("Dimension",e).filter((e=>e.getAttribute("name")&&e.getAttribute("units")&&e.textContent)).map((e=>{const t=e.getAttribute("name"),i=e.getAttribute("units"),s=e.textContent,r=e.getAttribute("unitSymbol")??void 0,o=e.getAttribute("default")??void 0,n="0"!==Q("default",e,"0"),l="0"!==Q("nearestValue",e,"0"),a="0"!==Q("current",e,"0");return ae({name:t,units:i})?{name:"time",units:"ISO8601",extent:de(s),default:de(o),multipleValues:n,nearestValue:l,current:a}:le({name:t,units:i})?{name:"elevation",units:i,extent:ce(s),unitSymbol:r,default:ce(o),multipleValues:n,nearestValue:l}:{name:t,units:i,extent:ue(s),unitSymbol:r,default:ue(o),multipleValues:n,nearestValue:l}})),o}function ne(e){return e.nodeType===Node.ELEMENT_NODE}function le(e){return/^elevation$/i.test(e.name)&&/^(epsg|crs):\d+$/i.test(e.units)}function ae(e){return/^time$/i.test(e.name)&&/^iso8601$/i.test(e.units)}function ce(e){if(!e)return;const t=e.includes("/"),i=e.split(",");return t?i.map((e=>{const t=e.split("/");return t.length<2?null:{min:parseFloat(t[0]),max:parseFloat(t[1]),resolution:t.length>=3&&"0"!==t[2]?parseFloat(t[2]):void 0}})).filter(K.Ru):i.map((e=>parseFloat(e)))}function ue(e){if(!e)return;const t=e.includes("/"),i=e.split(",");return t?i.map((e=>{const t=e.split("/");return t.length<2?null:{min:t[0],max:t[1],resolution:t.length>=3&&"0"!==t[2]?t[2]:void 0}})).filter(K.Ru):i}function de(e){if(!e)return;const t=e.includes("/"),i=e.split(",");return t?i.map((e=>{const t=e.split("/");return t.length<2?null:{min:pe(t[0]),max:pe(t[1]),resolution:t.length>=3&&"0"!==t[2]?he(t[2]):void 0}})).filter(K.Ru):i.map((e=>pe(e)))}function pe(e){return U.c9.fromISO(e,{zone:U.mQ.utcInstance}).toJSDate()}function he(e){const t=e.match(/(?:p(\d+y|\d+(?:\.|,)\d+y)?(\d+m|\d+(?:\.|,)\d+m)?(\d+d|\d+(?:\.|,)\d+d)?)?(?:t(\d+h|\d+(?:\.|,)\d+h)?(\d+m|\d+(?:\.|,)\d+m)?(\d+s|\d+(?:\.|,)\d+s)?)?/i);return t?{years:ye(t[1]),months:ye(t[2]),days:ye(t[3]),hours:ye(t[4]),minutes:ye(t[5]),seconds:ye(t[6])}:null}function ye(e){if(!e)return 0;const t=e.match(/(?:\d+(?:\.|,)\d+|\d+)/);if(!t)return 0;const i=t[0].replace(",",".");return Number(i)}function me(e){return e.toISOString().replace(/\.[0-9]{3}/,"")}function ge(e){if(!e||e.isAllTime||e.isEmpty)return;const{start:t,end:i}=e;return t&&i&&t.getTime()===i.getTime()?`${me(t)}`:`${t?me(t):"0000-01-01T00:00:00Z"}/${i?me(i):"9999-12-31T23:59:59Z"}`}const fe=new Set([102100,3857,102113,900913]),ve=new Set([3395,54004]);const be=new p.J({bmp:"image/bmp",gif:"image/gif",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml"},{ignoreUnknown:!1});function _e(e){return"text/html"===e}function we(e){return"text/plain"===e}let Me=class extends((0,E.dM)((0,P.e)((0,Z.J)((0,O.j)((0,F.q)((0,R.A)((0,y.P)(T.A)))))))){constructor(...e){super(...e),this.allSublayers=new u.A({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.sublayers}),this.customParameters=null,this.customLayerParameters=null,this.copyright=null,this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.featureInfoFormats=null,this.featureInfoUrl=null,this.fetchFeatureInfoFunction=null,this.imageFormat=null,this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.legendEnabled=!0,this.mapUrl=null,this.isReference=null,this.operationalLayerType="WMS",this.spatialReference=null,this.spatialReferences=null,this.sublayers=null,this.type="wms",this.version=null,this.addHandles([(0,g.on)((()=>this.sublayers),"after-add",(({item:e})=>{e.parent=e.layer=this}),g.OH),(0,g.on)((()=>this.sublayers),"after-remove",(({item:e})=>{e.layer=e.parent=null}),g.OH),(0,g.wB)((()=>this.sublayers),((e,t)=>{if(t)for(const i of t)i.layer=i.parent=null;if(e)for(const i of e)i.parent=i.layer=this}),g.OH)])}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}destroy(){this.allSublayers.destroy()}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMS"]},e).catch(m.QP).then((()=>this._fetchService(t))).then((()=>this._checkLayerValidity()))),Promise.resolve(this)}readFullExtentFromItemOrMap(e,t){const i=t.extent;return i?new I.A({xmin:i[0][0],ymin:i[0][1],xmax:i[1][0],ymax:i[1][1]}):null}writeFullExtent(e,t){t.extent=[[e.xmin,e.ymin],[e.xmax,e.ymax]]}get featureInfoFormat(){return null==this.featureInfoFormats?null:this.featureInfoFormats.find(_e)??this.featureInfoFormats.find(we)??null}set featureInfoFormat(e){null==e?(this.revert("featureInfoFormat","service"),this._clearOverride("featureInfoFormat")):(_e(e)||we(e))&&this._override("featureInfoFormat",e)}readImageFormat(e,t){const i=t.supportedImageFormatTypes;return i&&i.includes("image/png")?"image/png":i&&i[0]}readSpatialReferenceFromItemOrDocument(e,t){return new A.A(t.spatialReferences[0])}writeSpatialReferences(e,t){const i=this.spatialReference?.wkid;e&&i?(t.spatialReferences=e.filter((e=>e!==i)),t.spatialReferences.unshift(i)):t.spatialReferences=e}readSublayersFromItemOrMap(e,t,i){return Se(t.layers,i,t.visibleLayers)}readSublayers(e,t,i){return Se(t.layers,i)}writeSublayers(e,t,i,s){t.layers=[];const r=new Map,o=e.flatten((({sublayers:e})=>e??[]));for(const n of o)if("number"==typeof n.parent?.id){const e=r.get(n.parent.id);null!=e?e.push(n.id):r.set(n.parent.id,[n.id])}for(const n of o){const e={sublayer:n,...s},i=n.write({parentLayerId:"number"==typeof n.parent?.id?n.parent.id:-1},e);if(r.has(n.id)&&(i.sublayerIds=r.get(n.id)),!n.sublayers&&n.name){const i=n.write({},e);delete i.id,t.layers.push(i)}}t.visibleLayers=o.filter((({visible:e,sublayers:t})=>e&&!t)).map((({name:e})=>e)).toArray()}set url(e){if(!e)return void this._set("url",e);const{path:t,query:i}=(0,v.An)(e);for(const r in i)/^(request|service)$/i.test(r)&&delete i[r];const s=(0,v.a6)(t,i??{});this._set("url",s)}createExportImageParameters(e,t,i,s){const r=s?.pixelRatio??1,o=(0,x.X_)({extent:e,width:t})*r,n=new $.r({layer:this,scale:o}),{xmin:l,ymin:a,xmax:c,ymax:u,spatialReference:d}=e,p=function(e,t){let i=e.wkid;return null==t?i:(null!=i&&t.includes(i)||!e.latestWkid||(i=e.latestWkid),null!=i&&fe.has(i)?t.find((e=>fe.has(e)))||t.find((e=>ve.has(e)))||102100:i)}(d,this.spatialReferences),h="1.3.0"===this.version&&(0,k.m)(p)?`${a},${l},${u},${c}`:`${l},${a},${c},${u}`,y=n.toJSON(),m="1.3.0"===this.version?"crs":"srs";return{bbox:h,[m]:null==p||isNaN(p)?void 0:"EPSG:"+p,...y}}async fetchImage(e,t,i,s){const r=this.mapUrl,o=this.createExportImageParameters(e,t,i,s);if(!o.layers){const e=document.createElement("canvas");return e.width=t,e.height=i,e}const n=ge(s?.timeExtent),l={responseType:"image",query:this._mixCustomParameters({width:t,height:i,...o,time:n,...this.refreshParameters}),signal:s?.signal};return(0,a.A)(r??"",l).then((e=>e.data))}async fetchImageBitmap(e,t,i,s){const r=this.mapUrl??"",o=this.createExportImageParameters(e,t,i,s);if(!o.layers){const e=document.createElement("canvas");return e.width=t,e.height=i,e}const n=ge(s?.timeExtent),l={responseType:"blob",query:this._mixCustomParameters({width:t,height:i,...o,time:n,...this.refreshParameters}),signal:s?.signal},{data:c}=await(0,a.A)(r,l);return(0,V.m)(c,r,s?.signal)}fetchFeatureInfo(e,t,i,s,r){const o=(0,x.X_)({extent:e,width:t}),n=function(e){const t=e.filter((e=>e.popupEnabled&&e.name&&e.queryable));return t.length?t.map((({name:e})=>e)).join():null}(new $.r({layer:this,scale:o}).visibleSublayers);if(null==this.featureInfoUrl||null==n)return Promise.resolve([]);if(null==this.fetchFeatureInfoFunction&&null==this.featureInfoFormat)return Promise.resolve([]);const l="1.3.0"===this.version?{I:s,J:r}:{x:s,y:r},a={query_layers:n,request:"GetFeatureInfo",info_format:this.featureInfoFormat,feature_count:25,width:t,height:i,...l},c={...this.createExportImageParameters(e,t,i),...a},u=this._mixCustomParameters(c);return null!=this.fetchFeatureInfoFunction?this.fetchFeatureInfoFunction(u):this._defaultFetchFeatureInfoFunction((0,v.a6)(this.featureInfoUrl,u))}findSublayerById(e){return this.allSublayers.find((t=>t.id===e))}findSublayerByName(e){return this.allSublayers.find((t=>t.name===e))}serviceSupportsSpatialReference(e){return(0,D.bd)(this.url)||null!=this.spatialReferences&&this.spatialReferences.some((t=>{const i=900913===t?A.A.WebMercator:new A.A({wkid:t});return(0,C.aI)(i,e)}))}_defaultFetchFeatureInfoFunction(e){const t=document.createElement("iframe");t.src=(0,v.yM)(f.W5.sanitizeUrl((0,v.s2)(e))),t.style.border="none",t.style.margin="0",t.style.width="100%",t.setAttribute("sandbox","");const i=new l.A({title:this.title,content:t}),s=new n.A({sourceLayer:this,popupTemplate:i});return Promise.resolve([s])}async _fetchService(e){if(!this.resourceInfo&&this.parsedUrl?.path){const{path:t,query:i}=this.parsedUrl,{data:s}=await(0,a.A)(t,{query:{SERVICE:"WMS",REQUEST:"GetCapabilities",...i,...this.customParameters},responseType:"xml",signal:e});this.resourceInfo=H(s)}if(this.parsedUrl){const e=new v.s0(this.parsedUrl.path),{httpsDomains:t}=o.A.request;"https"!==e.scheme||e.port&&"443"!==e.port||!e.host||t.includes(e.host)||t.push(e.host)}this.read(this.resourceInfo,{origin:"service"})}_checkLayerValidity(){if(!this.allSublayers.length)throw new d.A("wmslayer:empty-layer","The layer doesn't have any sublayer")}_mixCustomParameters(e){if(!this.customLayerParameters&&!this.customParameters)return e;const t={...this.customParameters,...this.customLayerParameters};for(const i in t)e[i.toLowerCase()]=t[i];return e}};function Se(e,t,i){e=e??[];const s=new Map;e.every((e=>null==e.id))&&(e=(0,h.o8)(e)).forEach(((e,t)=>e.id=t));for(const o of e){const e=new z;e.read(o,t),i&&!i.includes(e.name)&&(e.visible=!1),s.set(e.id,e)}const r=[];for(const o of e){const e=null!=o.id?s.get(o.id):null;if(e)if(null!=o.parentLayerId&&o.parentLayerId>=0){const t=s.get(o.parentLayerId);if(!t)continue;t.sublayers||(t.sublayers=new c.A),t.sublayers.push(e)}else r.push(e)}return r}(0,r._)([(0,b.MZ)({readOnly:!0})],Me.prototype,"allSublayers",void 0),(0,r._)([(0,b.MZ)({json:{type:Object,write:!0}})],Me.prototype,"customParameters",void 0),(0,r._)([(0,b.MZ)({json:{type:Object,write:!0}})],Me.prototype,"customLayerParameters",void 0),(0,r._)([(0,b.MZ)({type:String,json:{write:!0}})],Me.prototype,"copyright",void 0),(0,r._)([(0,b.MZ)()],Me.prototype,"description",void 0),(0,r._)([(0,b.MZ)({readOnly:!0})],Me.prototype,"dimensions",void 0),(0,r._)([(0,b.MZ)({json:{type:[[Number]],read:{source:"extent"},write:{target:"extent"},origins:{"web-document":{write:{ignoreOrigin:!0}},"portal-item":{write:{ignoreOrigin:!0}}}}})],Me.prototype,"fullExtent",void 0),(0,r._)([(0,w.w)(["web-document","portal-item"],"fullExtent",["extent"])],Me.prototype,"readFullExtentFromItemOrMap",null),(0,r._)([(0,S.K)(["web-document","portal-item"],"fullExtent",{extent:{type:[[Number]]}})],Me.prototype,"writeFullExtent",null),(0,r._)([(0,b.MZ)({type:[I.A]})],Me.prototype,"fullExtents",void 0),(0,r._)([(0,b.MZ)({type:String,json:{write:{ignoreOrigin:!0}}})],Me.prototype,"featureInfoFormat",null),(0,r._)([(0,b.MZ)({type:[String],readOnly:!0})],Me.prototype,"featureInfoFormats",void 0),(0,r._)([(0,b.MZ)({type:String,json:{write:{ignoreOrigin:!0}}})],Me.prototype,"featureInfoUrl",void 0),(0,r._)([(0,b.MZ)()],Me.prototype,"fetchFeatureInfoFunction",void 0),(0,r._)([(0,b.MZ)({type:String,json:{origins:{"web-document":{default:"image/png",type:be.jsonValues,read:{reader:be.read,source:"format"},write:{writer:be.write,target:"format"}}}}})],Me.prototype,"imageFormat",void 0),(0,r._)([(0,w.w)("imageFormat",["supportedImageFormatTypes"])],Me.prototype,"readImageFormat",null),(0,r._)([(0,b.MZ)({type:Number,json:{read:{source:"maxHeight"},write:{target:"maxHeight"}}})],Me.prototype,"imageMaxHeight",void 0),(0,r._)([(0,b.MZ)({type:Number,json:{read:{source:"maxWidth"},write:{target:"maxWidth"}}})],Me.prototype,"imageMaxWidth",void 0),(0,r._)([(0,b.MZ)()],Me.prototype,"imageTransparency",void 0),(0,r._)([(0,b.MZ)(N.fV)],Me.prototype,"legendEnabled",void 0),(0,r._)([(0,b.MZ)({type:["show","hide","hide-children"]})],Me.prototype,"listMode",void 0),(0,r._)([(0,b.MZ)({type:String,json:{write:{ignoreOrigin:!0}}})],Me.prototype,"mapUrl",void 0),(0,r._)([(0,b.MZ)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],Me.prototype,"isReference",void 0),(0,r._)([(0,b.MZ)({type:["WMS"]})],Me.prototype,"operationalLayerType",void 0),(0,r._)([(0,b.MZ)()],Me.prototype,"resourceInfo",void 0),(0,r._)([(0,b.MZ)({type:A.A,json:{origins:{service:{read:{source:"extent.spatialReference"}}},write:!1}})],Me.prototype,"spatialReference",void 0),(0,r._)([(0,w.w)(["web-document","portal-item"],"spatialReference",["spatialReferences"])],Me.prototype,"readSpatialReferenceFromItemOrDocument",null),(0,r._)([(0,b.MZ)({type:[_.jz],json:{read:!1,origins:{service:{read:!0},"web-document":{read:!1,write:{ignoreOrigin:!0}},"portal-item":{read:!1,write:{ignoreOrigin:!0}}}}})],Me.prototype,"spatialReferences",void 0),(0,r._)([(0,S.K)(["web-document","portal-item"],"spatialReferences")],Me.prototype,"writeSpatialReferences",null),(0,r._)([(0,b.MZ)({type:c.A.ofType(z),json:{write:{target:"layers",overridePolicy(e,t,i){if(function(e,t){return e.some((e=>{for(const i in e)if((0,L.R)(e,i,null,t))return!0;return!1}))}(this.allSublayers,i))return{ignoreOrigin:!0}}}}})],Me.prototype,"sublayers",void 0),(0,r._)([(0,w.w)(["web-document","portal-item"],"sublayers",["layers","visibleLayers"])],Me.prototype,"readSublayersFromItemOrMap",null),(0,r._)([(0,w.w)("service","sublayers",["layers"])],Me.prototype,"readSublayers",null),(0,r._)([(0,S.K)("sublayers",{layers:{type:[z]},visibleLayers:{type:[String]}})],Me.prototype,"writeSublayers",null),(0,r._)([(0,b.MZ)({json:{read:!1},readOnly:!0,value:"wms"})],Me.prototype,"type",void 0),(0,r._)([(0,b.MZ)(N.OZ)],Me.prototype,"url",null),(0,r._)([(0,b.MZ)({type:String,json:{write:{ignoreOrigin:!0}}})],Me.prototype,"version",void 0),Me=(0,r._)([(0,M.$)("esri.layers.WMSLayer")],Me);const Le=Me},47187:(e,t,i)=>{i.r(t),i.d(t,{default:()=>x});var s,r=i(66866),o=i(86394),n=i(98849),l=i(35775),a=i(96274),c=i(20909),u=i(21564),d=(i(39831),i(539),i(9272),i(75094)),p=i(63863),h=i(77542),y=i(84698),m=i(97066),g=i(78983),f=i(68833),v=i(15305),b=i(41506),_=i(34722),w=i(50508),M=i(25389),S=i(52775),L=i(50437),I=i(65228),A=i(65476);let x=s=class extends((0,v.dM)((0,w.J)((0,M.j)((0,b.q)((0,_.A)((0,l.P)(f.A))))))){constructor(...e){super(...e),this.copyright="",this.fullExtent=new y.A(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,g.A.WebMercator),this.legendEnabled=!1,this.isReference=null,this.popupEnabled=!1,this.spatialReference=g.A.WebMercator,this.subDomains=null,this.tileInfo=new I.A({size:[256,256],dpi:96,format:"png8",compressionQuality:0,origin:new m.A({x:-20037508.342787,y:20037508.342787,spatialReference:g.A.WebMercator}),spatialReference:g.A.WebMercator,lods:[new L.A({level:0,scale:591657527.591555,resolution:156543.033928}),new L.A({level:1,scale:295828763.795777,resolution:78271.5169639999}),new L.A({level:2,scale:147914381.897889,resolution:39135.7584820001}),new L.A({level:3,scale:73957190.948944,resolution:19567.8792409999}),new L.A({level:4,scale:36978595.474472,resolution:9783.93962049996}),new L.A({level:5,scale:18489297.737236,resolution:4891.96981024998}),new L.A({level:6,scale:9244648.868618,resolution:2445.98490512499}),new L.A({level:7,scale:4622324.434309,resolution:1222.99245256249}),new L.A({level:8,scale:2311162.217155,resolution:611.49622628138}),new L.A({level:9,scale:1155581.108577,resolution:305.748113140558}),new L.A({level:10,scale:577790.554289,resolution:152.874056570411}),new L.A({level:11,scale:288895.277144,resolution:76.4370282850732}),new L.A({level:12,scale:144447.638572,resolution:38.2185141425366}),new L.A({level:13,scale:72223.819286,resolution:19.1092570712683}),new L.A({level:14,scale:36111.909643,resolution:9.55462853563415}),new L.A({level:15,scale:18055.954822,resolution:4.77731426794937}),new L.A({level:16,scale:9027.977411,resolution:2.38865713397468}),new L.A({level:17,scale:4513.988705,resolution:1.19432856685505}),new L.A({level:18,scale:2256.994353,resolution:.597164283559817}),new L.A({level:19,scale:1128.497176,resolution:.298582141647617}),new L.A({level:20,scale:564.248588,resolution:.14929107082380833}),new L.A({level:21,scale:282.124294,resolution:.07464553541190416}),new L.A({level:22,scale:141.062147,resolution:.03732276770595208}),new L.A({level:23,scale:70.5310735,resolution:.01866138385297604})]}),this.type="web-tile",this.urlTemplate=null,this.wmtsInfo=null}normalizeCtorArgs(e,t){return"string"==typeof e?{urlTemplate:e,...t}:e}load(e){const t=this.loadFromPortal({supportedTypes:["WMTS"]},e).then((()=>{let e="";if(this.urlTemplate)if(this.spatialReference.equals(this.tileInfo.spatialReference)){const t=new c.s0(this.urlTemplate);!(this.subDomains&&this.subDomains.length>0)&&t.authority?.includes("{subDomain}")&&(e="is missing 'subDomains' property")}else e="spatialReference must match tileInfo.spatialReference";else e="is missing the required 'urlTemplate' property value";if(e)throw new n.A("web-tile-layer:load",`WebTileLayer (title: '${this.title}', id: '${this.id}') ${e}`)}));return this.addResolvingPromise(t),Promise.resolve(this)}get levelValues(){const e=[];if(!this.tileInfo)return null;for(const t of this.tileInfo.lods)e[t.level]=t.levelValue||t.level;return e}readSpatialReference(e,t){return e||g.A.fromJSON(t.fullExtent?.spatialReference)}get tileServers(){if(!this.urlTemplate)return null;const e=[],{urlTemplate:t,subDomains:i}=this,s=new c.s0(t),r=s.scheme?s.scheme+"://":"//",o=r+s.authority+"/",n=s.authority;if(n?.includes("{subDomain}")){if(i&&i.length>0&&n.split(".").length>1)for(const l of i)e.push(r+n.replaceAll(/\{subDomain\}/gi,l)+"/")}else e.push(o);return e.map(c.Il)}get urlPath(){if(!this.urlTemplate)return null;const e=this.urlTemplate,t=new c.s0(e),i=(t.scheme?t.scheme+"://":"//")+t.authority+"/";return e.slice(i.length)}readUrlTemplate(e,t){return e||t.templateUrl}writeUrlTemplate(e,t){(0,c.BQ)(e)&&(e="https:"+e),e&&(e=e.replaceAll(/\{z\}/gi,"{level}").replaceAll(/\{x\}/gi,"{col}").replaceAll(/\{y\}/gi,"{row}"),e=(0,c.S8)(e)),t.templateUrl=e}fetchTile(e,t,i,s={}){const{signal:r}=s,n=this.getTileUrl(e,t,i),l={responseType:"image",signal:r,query:{...this.refreshParameters}};return(0,o.A)(n,l).then((e=>e.data))}async fetchImageBitmapTile(e,t,i,r={}){const{signal:n}=r;if(this.fetchTile!==s.prototype.fetchTile){const s=await this.fetchTile(e,t,i,r);return(0,S.C)(s,e,t,i,n)}const l=this.getTileUrl(e,t,i),a={responseType:"blob",signal:n,query:{...this.refreshParameters}},{data:c}=await(0,o.A)(l,a);return(0,S.C)(c,e,t,i,n)}getTileUrl(e,t,i){const{levelValues:s,tileServers:r,urlPath:o}=this;if(!s||!r||!o)return"";const n=s[e];return r[t%r.length]+(0,a.HC)(o,{level:n,z:n,col:i,x:i,row:t,y:t})}};(0,r._)([(0,u.MZ)({type:String,value:"",json:{write:!0}})],x.prototype,"copyright",void 0),(0,r._)([(0,u.MZ)({type:y.A,json:{write:!0},nonNullable:!0})],x.prototype,"fullExtent",void 0),(0,r._)([(0,u.MZ)({readOnly:!0,json:{read:!1,write:!1}})],x.prototype,"legendEnabled",void 0),(0,r._)([(0,u.MZ)({type:["show","hide"]})],x.prototype,"listMode",void 0),(0,r._)([(0,u.MZ)({json:{read:!0,write:!0}})],x.prototype,"blendMode",void 0),(0,r._)([(0,u.MZ)()],x.prototype,"levelValues",null),(0,r._)([(0,u.MZ)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],x.prototype,"isReference",void 0),(0,r._)([(0,u.MZ)({type:["WebTiledLayer"],value:"WebTiledLayer"})],x.prototype,"operationalLayerType",void 0),(0,r._)([(0,u.MZ)({readOnly:!0,json:{read:!1,write:!1}})],x.prototype,"popupEnabled",void 0),(0,r._)([(0,u.MZ)({type:g.A})],x.prototype,"spatialReference",void 0),(0,r._)([(0,d.w)("spatialReference",["spatialReference","fullExtent.spatialReference"])],x.prototype,"readSpatialReference",null),(0,r._)([(0,u.MZ)({type:[String],json:{write:!0}})],x.prototype,"subDomains",void 0),(0,r._)([(0,u.MZ)({type:I.A,json:{write:!0}})],x.prototype,"tileInfo",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],x.prototype,"tileServers",null),(0,r._)([(0,u.MZ)({json:{read:!1}})],x.prototype,"type",void 0),(0,r._)([(0,u.MZ)()],x.prototype,"urlPath",null),(0,r._)([(0,u.MZ)({type:String,json:{origins:{"portal-item":{read:{source:"url"}}}}})],x.prototype,"urlTemplate",void 0),(0,r._)([(0,d.w)("urlTemplate",["urlTemplate","templateUrl"])],x.prototype,"readUrlTemplate",null),(0,r._)([(0,h.K)("urlTemplate",{templateUrl:{type:String}})],x.prototype,"writeUrlTemplate",null),(0,r._)([(0,u.MZ)({type:A.x,json:{write:!0}})],x.prototype,"wmtsInfo",void 0),x=s=(0,r._)([(0,p.$)("esri.layers.WebTileLayer")],x)},22567:(e,t,i)=>{i.d(t,{F:()=>s,P:()=>r});const s={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!0,supportsCurrentUser:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsPaginationOnAggregatedQueries:!1,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!0,supportsReturnMesh:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,maxUniqueIDCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0,supportsTrueCurve:!1},r={supportsDate:!0,supportsFixedInterval:!0,supportsAutoInterval:!0,supportsFixedBoundaries:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsSnapToData:!1,supportsReturnFullIntervalBin:!1,supportsFirstDayOfWeek:!1,supportsNormalization:!0,supportedStatistics:{count:!0,sum:!0,avg:!0,var:!0,stddev:!0,min:!0,max:!0,percentileContinuous:!0,percentileDiscrete:!0,envelope:!0,centroid:!0,convexHull:!0},supportedNormalizationTypes:{field:!0,log:!0,naturalLog:!0,percentOfTotal:!0,squareRoot:!0}}},11984:(e,t,i)=>{i.d(t,{BM:()=>L,bd:()=>I,sO:()=>S,xD:()=>u});var s=i(34427),r=i(98849),o=i(87926),n=i(32597),l=i(88443),a=i(42453);const c={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function u(e){return c[e]}function*d(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*p(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function h(e){for(const t of e)if(t.length>2)return!0;return!1}function y(e){let t=0;for(let i=0;i<e.length;i++){const s=e[i],r=e[(i+1)%e.length];t+=s[0]*r[1]-r[0]*s[1]}return t<=0}function m(e){const t=e[0],i=e[e.length-1];return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]||e.push(t),e}function g(e,t,i){switch(t.type){case"LineString":case"MultiPoint":return function(e,t,i){return b(e,t.coordinates,i),e}(e,t,i);case"MultiLineString":return function(e,t,i){for(const s of t.coordinates)b(e,s,i);return e}(e,t,i);case"MultiPolygon":return function(e,t,i){for(const s of t.coordinates){f(e,s[0],i);for(let t=1;t<s.length;t++)v(e,s[t],i)}return e}(e,t,i);case"Point":return function(e,t,i){return w(e,t.coordinates,i),e}(e,t,i);case"Polygon":return function(e,t,i){const s=t.coordinates;f(e,s[0],i);for(let r=1;r<s.length;r++)v(e,s[r],i);return e}(e,t,i)}}function f(e,t,i){const s=m(t);!function(e){return!y(e)}(s)?b(e,s,i):_(e,s,i)}function v(e,t,i){const s=m(t);!function(e){return y(e)}(s)?b(e,s,i):_(e,s,i)}function b(e,t,i){for(const s of t)w(e,s,i);e.lengths.push(t.length)}function _(e,t,i){for(let s=t.length-1;s>=0;s--)w(e,t[s],i);e.lengths.push(t.length)}function w(e,t,i){const[s,r,o]=t;e.coords.push(s,r),i.hasZ&&e.coords.push(o||0)}function M(e){switch(typeof e){case"string":return(0,s.Br)(e)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function S(e,t=4326){if(!e)throw new r.A("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new r.A("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:i}=e;if(!i)return;const s="string"==typeof i?i:"name"===i.type?i.properties.name:"EPSG"===i.type?i.properties.code:null,n=(0,o.oT)({wkid:t})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${t})$`,"i");if(!s||!n.test(s))throw new r.A("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:i})}function L(e,t={}){const i=[],s=new Set,r=new Set;let o,n=!1,l=null,c=!1,{geometryType:y=null}=t;for(const g of d(e)){const{geometry:e,properties:t,id:d}=g;if((!e||(y||(y=u(e.type)),u(e.type)===y))&&(n||(n=h(p(e))),c||(c=null!=d,c&&(o=typeof d,t&&(l=Object.keys(t).filter((e=>t[e]===d))))),t&&l&&c&&null!=d&&(l.length>1?l=l.filter((e=>t[e]===d)):1===l.length&&(l=t[l[0]]===d?l:[])),t))for(const o in t){if(s.has(o))continue;const e=M(t[o]);if("unknown"===e){r.add(o);continue}r.delete(o),s.add(o);const n=(0,a.rS)(o);n&&i.push({name:n,alias:o,type:e})}}const m=(0,a.rS)(1===l?.length&&l[0]||null)??void 0;if(m)for(const u of i)if(u.name===m&&(0,a.WA)(u)){u.type="esriFieldTypeOID";break}return{fields:i,geometryType:y,hasZ:n,objectIdFieldName:m,objectIdFieldType:o,unknownFields:Array.from(r)}}function I(e,t){return Array.from(function*(e,t={}){const{geometryType:i,objectIdField:s}=t;for(const r of e){const{geometry:e,properties:o,id:a}=r;if(e&&u(e.type)!==i)continue;const c=o||{};let d;s&&(d=c[s],null==a||d||(c[s]=d=a));const p=new n.Om(e?g(new l.A,e,t):null,c,null,d);yield p}}(d(e),t))}},20061:(e,t,i)=>{i.d(t,{F0:()=>l,Vx:()=>u,e2:()=>p,f:()=>h});var s=i(39831),r=i(19251),o=i(22567),n=i(23173);function l(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?n.Cb:"esriGeometryPolyline"===e?n.yM:n.WR}}}const a=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let c=1;function u(e,t){if((0,s.A)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let i=`this${d(t)} = null;`;for(const t in e)i+=`this${d(t)} = ${JSON.stringify(e[t])};`;const s=new Function(`\n      return class AttributesClass$${c++} {\n        constructor() {\n          ${i};\n        }\n      }\n    `)();return()=>new s}catch(i){return()=>({[t]:null,...e})}}function d(e){return a.test(e)?`.${e}`:`["${e}"]`}function p(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,r.o8)(e)}}]}function h(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:o.F,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:o.P,editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},68877:(e,t,i)=>{i.d(t,{$1:()=>g,CR:()=>m,MB:()=>p,PC:()=>f,Yx:()=>a,bP:()=>u});var s=i(34427),r=i(87926),o=i(42453);class n{constructor(e){this.description=e,this.code=null}}class l{constructor(e){this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error=new n(e)}}function a(e){return new l(e)}class c{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function u(e){return new c(e)}const d=new Set;function p(e,t,i,s=!1){d.clear();for(const r in i){const n=e.get(r);if(!n)continue;const l=h(n,i[r]);if(d.add(n.name),n&&(s||n.editable)){const e=(0,o.CJ)(n,l);if(e)return a((0,o.uo)(e,n,l));t[n.name]=l}}for(const r of e.requiredFields??[])if(!d.has(r.name))return a(`missing required field "${r.name}"`);return null}function h(e,t){let i=t;return(0,o.WA)(e)&&"string"==typeof t?i=parseFloat(t):(0,o.yM)(e)&&null!=t&&"string"!=typeof t?i=String(t):(0,o.vE)(e)&&"string"==typeof t&&(i=(0,s._U)(t)),(0,o.WX)(i)}let y;function m(e,t){if(!e||!(0,r.fn)(t))return e;if("rings"in e||"paths"in e){if(null==y)throw new TypeError("geometry engine not loaded");return y.simplify(t,e)}return e}async function g(e,t){!(0,r.fn)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await async function(){return null==y&&(y=await Promise.all([i.e(72076),i.e(40835),i.e(53366)]).then(i.bind(i,53366))),y}()}const f={supportsAutoIntervalBin:!0,supportsFixedIntervalBin:!0,supportsFixedBoundariesBin:!0,supportsDateBin:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsNormalization:!0,supportedStatisticTypes:["COUNT","SUM","AVG","VAR","STDDEV","MIN","MAX","PERCENTILE_CONT","PERCENTILE_DISC","CentroidAggregate","EnvelopeAggregate","ConvexHullAggregate"],supportedNormalizationTypes:["field","log","naturalLog","percentOfTotal","squareRoot"]}},29567:(e,t,i)=>{i.d(t,{$1:()=>c,H2:()=>h,MT:()=>y,VP:()=>m,WF:()=>u,Wt:()=>n,XQ:()=>g,hK:()=>p,nS:()=>d,uh:()=>l,xY:()=>a});var s=i(98849);const r="upload-assets",o=()=>new Error;class n extends s.A{constructor(){super(`${r}:unsupported`,"Layer does not support asset uploads.",o())}}class l extends s.A{constructor(){super(`${r}:no-glb-support`,"Layer does not support glb.",o())}}class a extends s.A{constructor(){super(`${r}:no-supported-source`,"No supported external source found",o())}}class c extends s.A{constructor(){super(`${r}:not-base-64`,"Expected gltf data in base64 format after conversion.",o())}}class u extends s.A{constructor(){super(`${r}:unable-to-prepare-options`,"Unable to prepare uploadAsset request options.",o())}}class d extends s.A{constructor(e,t){super(`${r}:bad-response`,`Bad response. Uploaded ${e} items and received ${t} results.`,o())}}class p extends s.A{constructor(e,t){super(`${r}-layer:upload-failed`,`Failed to upload mesh file ${e}. Error code: ${t?.code??"-1"}. Error message: ${t?.messages??"unknown"}`,o())}}class h extends s.A{constructor(e){super(`${r}-layer:unsupported-format`,`The service allowed us to upload an asset of FormatID ${e}, but it does not list it in its supported formats.`,o())}}class y extends s.A{constructor(){super(`${r}:convert3D-failed`,"convert3D failed.")}}class m extends s.A{constructor(){super("invalid-input:no-model","No supported model found")}}class g extends s.A{constructor(){super("invalid-input:multiple-models","Multiple supported models found")}}},9127:(e,t,i)=>{i.d(t,{f:()=>d});var s=i(66866),r=i(21564),o=(i(39831),i(539),i(9272),i(75094)),n=i(63863),l=i(78983),a=i(65228),c=i(68820),u=i(35787);const d=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}destroy(){this.tilemapCache?.destroy?.()}readMinScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}readMaxScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(e,t,i){const s=t.capabilities?.includes("Tilemap");let{minLOD:r,maxLOD:o,minScale:n,maxScale:l}=t;if(null==r&&null==o&&(0!==n||0!==l)){const e=e=>Math.round(1e4*e)/1e4;n=e(n||t.tileInfo.lods[0].scale),l=e(l||t.tileInfo.lods[t.tileInfo.lods.length-1].scale);for(const i of t.tileInfo.lods){const t=e(i.scale);r=t>=n?i.level:r,o=t>=l?i.level:o}}if(s)return new u.d({layer:this,minLOD:r,maxLOD:o});if(t.tileInfo){const e=new a.A;return e.read(t.tileInfo,i),new c.A(e,r,o)}return null}};return(0,s._)([(0,r.MZ)({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),(0,s._)([(0,r.MZ)()],t.prototype,"minScale",void 0),(0,s._)([(0,o.w)("service","minScale")],t.prototype,"readMinScale",null),(0,s._)([(0,r.MZ)()],t.prototype,"maxScale",void 0),(0,s._)([(0,o.w)("service","maxScale")],t.prototype,"readMaxScale",null),(0,s._)([(0,r.MZ)({type:l.A})],t.prototype,"spatialReference",void 0),(0,s._)([(0,r.MZ)({readOnly:!0})],t.prototype,"supportsBlankTile",null),(0,s._)([(0,r.MZ)({type:a.A})],t.prototype,"tileInfo",void 0),(0,s._)([(0,r.MZ)()],t.prototype,"tilemapCache",void 0),(0,s._)([(0,o.w)("service","tilemapCache",["capabilities","tileInfo"])],t.prototype,"readTilemapCache",null),(0,s._)([(0,r.MZ)()],t.prototype,"version",void 0),t=(0,s._)([(0,n.$)("esri.layers.mixins.ArcGISCachedService")],t),t}},2555:(e,t,i)=>{i.d(t,{m:()=>r});const s=[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]];function r(e){return null!=e&&s.some((([t,i])=>e>=t&&e<=i))}},83650:(e,t,i)=>{i.d(t,{GA:()=>C,GL:()=>L,I:()=>F,J0:()=>T,Ki:()=>x,Px:()=>A,QE:()=>M,bV:()=>I,bW:()=>E,vJ:()=>w});var s=i(86394),r=i(98849),o=i(539),n=i(20909),l=i(78983),a=i(87926),c=i(96082),u=i(21355),d=i(46461),p=i(11984),h=i(20061),y=i(68877),m=i(79005),g=i(17930),f=i(54088);const v=()=>o.A.getLogger("esri.layers.ogc.ogcFeatureUtils"),b="startindex",_=new Set([b,"offset"]),w="http://www.opengis.net/def/crs/",M=`${w}OGC/1.3/CRS84`;var S;async function L(e,t,i={},o=5){const{links:l}=e,a=k(l,"items",S.geojson)||k(l,"http://www.opengis.net/def/rel/ogc/1.0/items",S.geojson);if(null==a)throw new r.A("ogc-feature-layer:missing-items-page","Missing items url");const{apiKey:c,customParameters:u,signal:d}=i,y=(0,n.s2)(a.href,e.landingPage.url),_={limit:o,...u,token:c},w=(0,n.a6)(y,_),M={accept:S.geojson},{data:L}=await(0,s.A)(w,{signal:d,headers:M}),I=D(w,o,L.links)??b;(0,p.sO)(L);const A=(0,p.BM)(L,{geometryType:t.geometryType}),x=t.fields||A.fields||[],C=null!=t.hasZ?t.hasZ:A.hasZ,T=A.geometryType,E=t.objectIdField||A.objectIdFieldName||"OBJECTID";let F=t.timeInfo;const R=x.find((({name:e})=>e===E));if(R)R.editable=!1,R.nullable=!1;else{if(!A.objectIdFieldType)throw new r.A("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");x.unshift({name:E,alias:E,type:"number"===A.objectIdFieldType?"esriFieldTypeOID":"esriFieldTypeString",editable:!1,nullable:!1})}if(E!==A.objectIdFieldName){const e=x.find((({name:e})=>e===A.objectIdFieldName));e&&(e.type="esriFieldTypeInteger")}x===A.fields&&A.unknownFields.length>0&&v().warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:A.unknownFields}});for(const s of x){if(null==s.name&&(s.name=s.alias),null==s.alias&&(s.alias=s.name),"esriFieldTypeOID"!==s.type&&"esriFieldTypeGlobalID"!==s.type&&(s.editable=null==s.editable||!!s.editable,s.nullable=null==s.nullable||!!s.nullable),!s.name)throw new r.A("ogc-feature-layer:invalid-field-name","field name is missing",{field:s});if(!g.m.jsonValues.includes(s.type))throw new r.A("ogc-feature-layer:invalid-field-type",`invalid type for field "${s.name}"`,{field:s})}if(F){const e=new m.A(x);if(F.startTimeField){const t=e.get(F.startTimeField);t?(F.startTimeField=t.name,t.type="esriFieldTypeDate"):F.startTimeField=null}if(F.endTimeField){const t=e.get(F.endTimeField);t?(F.endTimeField=t.name,t.type="esriFieldTypeDate"):F.endTimeField=null}if(F.trackIdField){const t=e.get(F.trackIdField);t?F.trackIdField=t.name:(F.trackIdField=null,v().warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:F}}))}F.timeReference||={timeZoneIANA:f.n$},F.startTimeField||F.endTimeField||(v().warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:F}}),F=void 0)}return{drawingInfo:T?(0,h.F0)(T):null,extent:P(e),geometryType:T,fields:x,hasZ:!!C,objectIdField:E,paginationParameter:I,timeInfo:F}}async function I(e,t={}){const{links:i,url:o}=e,l=k(i,"data",S.json)||k(i,"http://www.opengis.net/def/rel/ogc/1.0/data",S.json);if(null==l)throw new r.A("ogc-feature-layer:missing-collections-page","Missing collections url");const{apiKey:a,customParameters:c,signal:u}=t,d=(0,n.s2)(l.href,o),{data:p}=await(0,s.A)(d,{signal:u,headers:{accept:S.json},query:{...c,token:a}});for(const s of p.collections)s.landingPage=e;return p}async function A(e,t={}){const{links:i,url:o}=e,l=k(i,"conformance",S.json)||k(i,"http://www.opengis.net/def/rel/ogc/1.0/conformance",S.json);if(null==l)throw new r.A("ogc-feature-layer:missing-conformance-page","Missing conformance url");const{apiKey:a,customParameters:c,signal:u}=t,d=(0,n.s2)(l.href,o),{data:p}=await(0,s.A)(d,{signal:u,headers:{accept:S.json},query:{...c,token:a}});return p}async function x(e,t={}){const{apiKey:i,customParameters:r,signal:o}=t,{data:n}=await(0,s.A)(e,{signal:o,headers:{accept:S.json},query:{...r,token:i}});return n.url=e,n}async function C(e,t={}){const{links:i,url:r}=e,o=k(i,"service-desc",S.openapi);if(null==o)return v().warn("ogc-feature-layer:missing-openapi-page","The OGC API-Features server does not have an OpenAPI page."),null;const{apiKey:l,customParameters:a,signal:c}=t,u=(0,n.s2)(o.href,r),{data:d}=await(0,s.A)(u,{signal:c,headers:{accept:S.openapi},query:{...a,token:l}});return d}function T(e){const t=/^http:\/\/www\.opengis.net\/def\/crs\/(?<authority>.*)\/(?<version>.*)\/(?<code>.*)$/i.exec(e),i=t?.groups;if(!i)return null;const{authority:s,code:r}=i;switch(s.toLowerCase()){case"ogc":switch(r.toLowerCase()){case"crs27":return l.A.GCS_NAD_1927.wkid;case"crs83":return 4269;case"crs84":case"crs84h":return l.A.WGS84.wkid;default:return null}case"esri":case"epsg":{const e=Number.parseInt(r,10);return Number.isNaN(e)?null:e}default:return null}}async function E(e,t,i){const s=await F(e,t,i);return(0,u.ZF)(s)}async function F(e,t,i){const{collection:{links:o,landingPage:{url:h}},layerDefinition:g,maxRecordCount:f,queryParameters:{apiKey:v,customParameters:b},spatialReference:_,supportedCrs:w}=e,M=k(o,"items",S.geojson)||k(o,"http://www.opengis.net/def/rel/ogc/1.0/items",S.geojson);if(null==M)throw new r.A("ogc-feature-layer:missing-items-page","Missing items url");const{geometry:L,num:I,start:A,timeExtent:x,where:C}=t;if(t.objectIds)throw new r.A("ogc-feature-layer:query-by-objectids-not-supported","Queries with object ids are not supported");const T=l.A.fromJSON(_),E=t.outSpatialReference??T,F=E.isWGS84?null:R(E,w),Z=O(L,w),P=function(e){if(null==e)return null;const{start:t,end:i}=e;return`${null!=t?t.toISOString():".."}/${null!=i?i.toISOString():".."}`}(x),D=function(e){return null!=e&&e&&"1=1"!==e?e:null}(C),N=I??(null==A?f:10),$=0===A?void 0:A,{fields:V,geometryType:B,hasZ:j,objectIdField:G,paginationParameter:z}=g,K=(0,n.s2)(M.href,h),{data:U}=await(0,s.A)(K,{...i,query:{...b,...Z,crs:F,datetime:P,query:D,limit:N,[z]:$,token:v},headers:{accept:S.geojson}}),q=(0,p.bd)(U,{geometryType:B,hasZ:j,objectIdField:G}),H=q.length===N&&!!k(U.links??[],"next",S.geojson),W=new m.A(V);for(const s of q){const e={};(0,y.MB)(W,e,s.attributes,!0);for(const t of W.fields)t.nullable&&!(t.name in e)&&(e[t.name]=null);e[G]=s.attributes[G],s.attributes=e}if(!F&&E.isWebMercator)for(const s of q)if(null!=s.geometry&&null!=B){const e=(0,u.zv)(s.geometry,B,j,!1);e.spatialReference=l.A.WGS84,s.geometry=(0,u.Ux)((0,c.Cv)(e,E))}for(const s of q)s.objectId=s.attributes[G];const J=F||!F&&E.isWebMercator?E.toJSON():a.KK,Q=new d.A;return Q.exceededTransferLimit=H,Q.features=q,Q.fields=V,Q.geometryType=B,Q.hasZ=j,Q.spatialReference=J,Q}function R(e,t){const{isWebMercator:i,wkid:s}=e;if(!s)return null;const r=i?t[3857]??t[102100]??t[102113]??t[900913]:t[e.wkid];return r?`${w}${r}`:null}function Z(e){if(null==e)return"";const{xmin:t,ymin:i,xmax:s,ymax:r}=e;return`${t},${i},${s},${r}`}function O(e,t){if(!function(e){return null!=e&&"extent"===e.type}(e))return null;const{spatialReference:i}=e;if(!i||i.isWGS84)return{bbox:Z(e)};const s=R(i,t);return null!=s?{bbox:Z(e),"bbox-crs":s}:i.isWebMercator?{bbox:Z((0,c.Cv)(e,l.A.WGS84))}:null}function P(e){const t=e.extent?.spatial;if(!t)return null;const i=t.bbox[0],s=4===i.length,[r,o]=i,n=s?void 0:i[2];return{xmin:r,ymin:o,xmax:s?i[2]:i[3],ymax:s?i[3]:i[4],zmin:n,zmax:s?void 0:i[5],spatialReference:l.A.WGS84.toJSON()}}function k(e,t,i){return e.find((({rel:e,type:s})=>e===t&&s===i))??e.find((({rel:e,type:i})=>e===t&&!i))}function D(e,t,i){if(!i)return;const s=k(i,"next",S.geojson),r=(0,n.An)(s?.href)?.query;if(!r)return;const o=(0,n.An)(e).query,l=Object.keys(o??{}),a=Object.entries(r).filter((([e])=>!l.includes(e))).find((([e,i])=>_.has(e.toLowerCase())&&Number.parseInt(i,10)===t)),c=a?.[0];return c}!function(e){e.json="application/json",e.geojson="application/geo+json",e.openapi="application/vnd.oai.openapi+json;version=3.0"}(S||(S={}))},29299:(e,t,i)=>{i.d(t,{E:()=>G,Fu:()=>E,O8:()=>k,UH:()=>q,YW:()=>D,i5:()=>b,mG:()=>P,x$:()=>B});var s=i(86394),r=i(98849),o=i(20092),n=i(20909),l=i(84698),a=i(68490),c=i(78983),u=i(87926),d=i(12433),p=i(11984),h=i(91690),y=i(16123),m=i(24738),g=i(42453);const f="xlink:href",v="2.0.0",b="__esri_wfs_id__",_="wfs-layer:getWFSLayerTypeInfo-error",w="wfs-layer:empty-service",M="wfs-layer:feature-type-not-found",S="wfs-layer:geojson-not-supported",L="wfs-layer:kvp-encoding-not-supported",I="wfs-layer:malformed-json",A="wfs-layer:unknown-geometry-type",x="wfs-layer:unknown-field-type",C="wfs-layer:unsupported-spatial-reference",T="wfs-layer:unsupported-wfs-version";async function E(e,t){const i=function(e){const t=z(e);(function(e){const t=e.firstElementChild?.getAttribute("version");if(t&&t!==v)throw new r.A(T,`Unsupported WFS version ${t}. Supported version: ${v}`)})(t),U(t);const i=t.firstElementChild,s=(0,o.PP)(function(e){return(0,h.i)(e,{FeatureTypeList:{FeatureType:e=>{const t={typeName:"undefined:undefined",name:"",title:"",description:"",extent:null,namespacePrefix:"",namespaceUri:"",defaultSpatialReference:4326,supportedSpatialReferences:[]},i=new Set;return(0,h.p)(e,{Name:e=>{const{name:i,prefix:s}=K(e.textContent);t.typeName=`${s}:${i}`,t.name=i,t.namespacePrefix=s,t.namespaceUri=e.lookupNamespaceURI(s)},Abstract:e=>{t.description=e.textContent},Title:e=>{t.title=e.textContent},WGS84BoundingBox:e=>{t.extent=l.A.fromJSON(function(e){let t,i,s,r;for(const o of e.children)switch(o.localName){case"LowerCorner":[t,i]=o.textContent.split(" ").map((e=>Number.parseFloat(e)));break;case"UpperCorner":[s,r]=o.textContent.split(" ").map((e=>Number.parseFloat(e)))}return{xmin:t,ymin:i,xmax:s,ymax:r,spatialReference:u.KK}}(e))},DefaultCRS:e=>{const s=O(e);s&&(t.defaultSpatialReference=s,i.add(s))},OtherCRS:e=>{const t=O(e);t&&i.add(t)}}),t.title||(t.title=t.name),i.add(4326),t.supportedSpatialReferences.push(...i),t}}})}(i));return{operations:Z(i),get featureTypes(){return Array.from(s())},readFeatureTypes:s}}((await(0,s.A)(e,{responseType:"text",query:{SERVICE:"WFS",REQUEST:"GetCapabilities",VERSION:v,...t?.customParameters},signal:t?.signal})).data);return function(e,t){(0,n.m3)(e)&&((0,n.FX)(e,t.operations.DescribeFeatureType.url,!0)&&(t.operations.DescribeFeatureType.url=(0,n.lM)(t.operations.DescribeFeatureType.url)),(0,n.FX)(e,t.operations.GetFeature.url,!0)&&(t.operations.GetFeature.url=(0,n.lM)(t.operations.GetFeature.url)))}(e,i),i}const F=["json","application/json; subtype=geojson; charset=utf-8","application/json; subtype=geojson","application/json","geojson","application/geo+json"];function R(e){for(const t of F){const i=e.findIndex((e=>e.toLowerCase()===t));if(i>=0)return e[i]}return null}function Z(e){let t=!0;const i={GetCapabilities:{url:""},DescribeFeatureType:{url:""},GetFeature:{url:"",outputFormat:null,supportsPagination:!1}},s=[],o=[];if((0,h.p)(e,{OperationsMetadata:{Parameter:e=>{if("outputformat"===e.getAttribute("name")?.toLowerCase())return{AllowedValues:{Value:({textContent:e})=>{e&&s.push(e)}}}},Operation:e=>{switch(e.getAttribute("name")){case"GetCapabilities":return{DCP:{HTTP:{Get:e=>{i.GetCapabilities.url=e.getAttribute(f)}}}};case"DescribeFeatureType":return{DCP:{HTTP:{Get:e=>{i.DescribeFeatureType.url=e.getAttribute(f)}}}};case"GetFeature":return{DCP:{HTTP:{Get:e=>{i.GetFeature.url=e.getAttribute(f)}}},Parameter:e=>{if("outputformat"===e.getAttribute("name")?.toLowerCase())return{AllowedValues:{Value:({textContent:e})=>{e&&o.push(e)}}}}}}},Constraint:e=>{switch(e.getAttribute("name")){case"KVPEncoding":return{DefaultValue:e=>{t="true"===e.textContent.toLowerCase()}};case"ImplementsResultPaging":return{DefaultValue:e=>{i.GetFeature.supportsPagination="true"===e.textContent.toLowerCase()}}}}}}),i.GetFeature.outputFormat=R(o)??R(s),!t)throw new r.A(L,"WFS service doesn't support key/value pair (KVP) encoding");if(null==i.GetFeature.outputFormat)throw new r.A(S,"WFS service doesn't support GeoJSON output format");return i}function O(e){const t=parseInt(e.textContent?.match(/(?<wkid>\d+$)/i)?.groups?.wkid??"",10);if(!Number.isNaN(t))return t}function P(e,t,i){return(0,o.I6)(e,(e=>i?e.name===t&&e.namespaceUri===i:e.typeName===t||e.name===t))}async function k(e,t,i,s={}){const{featureType:o,extent:n}=await async function(e,t,i,s={}){const o=e.readFeatureTypes(),n=t?P(o,t,i):o.next().value,{spatialReference:l=new c.A({wkid:n?.defaultSpatialReference})}=s;if(null==n)throw t?new r.A(M,`The type '${t}' could not be found in the service`):new r.A(w,"The service is empty");let d=n.extent;if(d&&!(0,u.aI)(d.spatialReference,l))try{await(0,a.initializeProjection)(d.spatialReference,l,void 0,s),d=(0,a.project)(d,l)}catch{throw new r.A(C,"Projection not supported")}return{extent:d,spatialReference:l,featureType:n}}(e,t,i,s),{spatialReference:l}=q(e.operations.GetFeature.url,o,s.spatialReference),{fields:d,geometryType:p,swapXY:h,objectIdField:y,geometryField:m}=await async function(e,t,i,s={}){const{typeName:o}=t,[n,l]=await Promise.allSettled([$(e.operations.DescribeFeatureType.url,o,s),N(e,o,i,s)]),a=e=>new r.A(_,`An error occurred while getting info about the feature type '${o}'`,{error:e});if("rejected"===n.status)throw a(n.reason);if("rejected"===l.status)throw a(l.reason);const{fields:c,errors:u}=n.value??{},d=n.value?.geometryType||l.value?.geometryType,p=l.value?.swapXY??!1;if(null==d)throw new r.A(A,`The geometry type could not be determined for type '${o}`,{typeName:o,geometryType:d,fields:c,errors:u});return{...D(c??[]),geometryType:d,swapXY:p}}(e,o,l,s);return{url:e.operations.GetCapabilities.url,name:o.name,namespaceUri:o.namespaceUri,fields:d,geometryField:m,geometryType:p,objectIdField:y,spatialReference:s.spatialReference??new c.A({wkid:o.defaultSpatialReference}),extent:n,swapXY:h,wfsCapabilities:e,customParameters:s.customParameters}}function D(e){const t=e.find((e=>"geometry"===e.type));let i=e.find((e=>"oid"===e.type));return e=e.filter((e=>"geometry"!==e.type)),i||(i=new m.A({name:b,type:"oid",alias:b}),e.unshift(i)),{geometryField:t?.name??null,objectIdField:i.name,fields:e}}async function N(e,t,i,r={}){let o,n=!1;const[l,a]=await Promise.all([B(e.operations.GetFeature.url,t,i,e.operations.GetFeature.outputFormat,{...r,count:1}),(0,s.A)(e.operations.GetFeature.url,{responseType:"text",query:j(t,i,void 0,{...r,count:1}),signal:r?.signal})]),c="FeatureCollection"===l.type&&l.features[0]?.geometry;if(c){let e;switch(o=d.gy.fromJSON((0,p.xD)(c.type)),c.type){case"Point":e=c.coordinates;break;case"LineString":case"MultiPoint":e=c.coordinates[0];break;case"MultiLineString":case"Polygon":e=c.coordinates[0][0];break;case"MultiPolygon":e=c.coordinates[0][0][0]}const t=/<[^>]*pos[^>]*> *(-?\d+(?:\.\d+)?) (-?\d+(?:\.\d+)?)/.exec(a.data);if(t){const i=e[0].toFixed(3),s=e[1].toFixed(3),r=parseFloat(t[1]).toFixed(3);i===parseFloat(t[2]).toFixed(3)&&s===r&&(n=!0)}}return{geometryType:o,swapXY:n}}async function $(e,t,i){return function(e,t){const{name:i}=K(e),s=z(t);U(s);const n=(0,o.I6)((0,h.i)(s.firstElementChild,{element:e=>e}),(e=>e.getAttribute("name")===i));if(null!=n){const e=n.getAttribute("type"),t=e?(0,o.I6)((0,h.i)(s.firstElementChild,{complexType:e=>e}),(t=>t.getAttribute("name")===K(e).name)):(0,o.I6)((0,h.i)(n,{complexType:e=>e}),(()=>!0));if(t)return function(e){const t=[],i=[];let s;const o=(0,h.i)(e,{complexContent:{extension:{sequence:{element:e=>e}}}});for(const n of o){const o=n.getAttribute("name");if(!o)continue;let l,a;if(n.hasAttribute("type")?l=K(n.getAttribute("type")).name:(0,h.p)(n,{simpleType:{restriction:e=>(l=K(e.getAttribute("base")).name,{maxLength:e=>{a=+e.getAttribute("value")}})}}),!l)continue;const c="true"===n.getAttribute("nillable");let u=!1;switch(l.toLowerCase()){case"integer":case"nonpositiveinteger":case"negativeinteger":case"long":case"int":case"short":case"byte":case"nonnegativeinteger":case"unsignedlong":case"unsignedint":case"unsignedshort":case"unsignedbyte":case"positiveinteger":i.push(new m.A({name:o,alias:o,type:"integer",nullable:c,length:(0,g._b)("integer")}));break;case"float":case"double":case"decimal":i.push(new m.A({name:o,alias:o,type:"double",nullable:c,length:(0,g._b)("double")}));break;case"boolean":case"string":case"gyearmonth":case"gyear":case"gmonthday":case"gday":case"gmonth":case"anyuri":case"qname":case"notation":case"normalizedstring":case"token":case"language":case"idrefs":case"entities":case"nmtoken":case"nmtokens":case"name":case"ncname":case"id":case"idref":case"entity":case"duration":case"time":i.push(new m.A({name:o,alias:o,type:"string",nullable:c,length:a??(0,g._b)("string")}));break;case"datetime":case"date":i.push(new m.A({name:o,alias:o,type:"date",nullable:c,length:a??(0,g._b)("date")}));break;case"pointpropertytype":s="point",u=!0;break;case"multipointpropertytype":s="multipoint",u=!0;break;case"curvepropertytype":case"multicurvepropertytype":case"multilinestringpropertytype":s="polyline",u=!0;break;case"surfacepropertytype":case"multisurfacepropertytype":case"multipolygonpropertytype":s="polygon",u=!0;break;case"geometrypropertytype":case"multigeometrypropertytype":u=!0,t.push(new r.A(A,`geometry type '${l}' is not supported`,{type:(new XMLSerializer).serializeToString(e)}));break;default:t.push(new r.A(x,`Unknown field type '${l}'`,{type:(new XMLSerializer).serializeToString(e)}))}u&&i.push(new m.A({name:o,alias:o,type:"geometry",nullable:c}))}for(const r of i)if("integer"===r.type&&!r.nullable&&V.has(r.name.toLowerCase())){r.type="oid";break}return{geometryType:s,fields:i,errors:t}}(t)}throw new r.A(M,`Type '${e}' not found in document`,{document:(new XMLSerializer).serializeToString(s)})}(t,(await(0,s.A)(e,{responseType:"text",query:{SERVICE:"WFS",REQUEST:"DescribeFeatureType",VERSION:v,TYPENAME:t,TYPENAMES:t,...i?.customParameters},signal:i?.signal})).data)}const V=new Set(["objectid","fid"]);async function B(e,t,i,o,n){let{data:l}=await(0,s.A)(e,{responseType:"text",query:j(t,i,o,n),signal:n?.signal});l=l.replaceAll(/": +(-?\d+),(\d+)(,)?/g,'": $1.$2$3');try{return JSON.parse(l)}catch(a){throw new r.A(I,"Error while parsing the\xa0response",{response:l,error:a})}}function j(e,t,i,s){const r="number"==typeof t?t:t.wkid;return{SERVICE:"WFS",REQUEST:"GetFeature",VERSION:v,TYPENAMES:e,OUTPUTFORMAT:i,SRSNAME:"EPSG:"+r,STARTINDEX:s?.startIndex,COUNT:s?.count,...s?.customParameters}}async function G(e,t,i){const r=await(0,s.A)(e,{responseType:"text",query:{SERVICE:"WFS",REQUEST:"GetFeature",VERSION:v,TYPENAMES:t,RESULTTYPE:"hits",...i?.customParameters},signal:i?.signal}),o=/numberMatched=["'](?<numberMatched>\d+)["']/gi.exec(r.data);if(o?.groups)return+o.groups.numberMatched}function z(e){return(new DOMParser).parseFromString(e.trim(),"text/xml")}function K(e){const[t,i]=e.split(":");return{prefix:i?t:"",name:i??t}}function U(e){let t="",i="";if((0,h.p)(e.firstElementChild,{Exception:e=>(t=e.getAttribute("exceptionCode"),{ExceptionText:e=>{i=e.textContent}})}),t)throw new r.A(`wfs-layer:${t}`,i)}function q(e,t,i){const s={wkid:t.defaultSpatialReference},r=null!=i?.wkid?{wkid:i.wkid}:s;return{spatialReference:r,getFeatureSpatialReference:(0,y.Fi)(e)||r.wkid&&t.supportedSpatialReferences.includes(r.wkid)?{wkid:r.wkid}:{wkid:t.defaultSpatialReference}}}},91690:(e,t,i)=>{function s(e,t){if(e&&t)for(const i of e.children)if(i.localName in t){const e=t[i.localName];if("function"==typeof e){const t=e(i);t&&s(i,t)}else s(i,e)}}function*r(e,t){for(const i of e.children)if(i.localName in t){const e=t[i.localName];"function"==typeof e?yield e(i):yield*r(i,e)}}i.d(t,{i:()=>r,p:()=>s})},10109:(e,t,i)=>{i.d(t,{g:()=>p});var s=i(66866),r=i(52495),o=i(76859),n=i(21564),l=(i(39831),i(539),i(9272),i(63863)),a=i(61781),c=i(58921),u=i(29306);const d={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let p=class extends r.A{constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const t=(0,c.f)(this.floors,e);return e.toExportImageJSON(t)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,u.Sk)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.removeHandles("layer"),e&&this.addHandles([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(d[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=!!this.floors?.length,t=this.visibleSublayers.filter((t=>null!=t.definitionExpression||e&&null!=t.floorInfo));return t.length?JSON.stringify(t.reduce(((e,t)=>{const i=(0,c.f)(this.floors,t),s=(0,o.mA)(i,t.definitionExpression);return null!=s&&(e[t.id]=s),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,i=this.scale,s=t=>{t.visible&&(0===i||(0,a.zx)(i,t.minScale,t.maxScale))&&(t.sublayers?t.sublayers.forEach(s):e.unshift(t))};t&&t.forEach(s);const r=this._get("visibleSublayers");return!r||r.length!==e.length||r.some(((t,i)=>e[i]!==t))?e:r}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};(0,s._)([(0,n.MZ)({readOnly:!0})],p.prototype,"dynamicLayers",null),(0,s._)([(0,n.MZ)()],p.prototype,"floors",void 0),(0,s._)([(0,n.MZ)({readOnly:!0})],p.prototype,"hasDynamicLayers",null),(0,s._)([(0,n.MZ)()],p.prototype,"layer",null),(0,s._)([(0,n.MZ)({readOnly:!0})],p.prototype,"layers",null),(0,s._)([(0,n.MZ)({readOnly:!0})],p.prototype,"layerDefs",null),(0,s._)([(0,n.MZ)({type:Number})],p.prototype,"scale",void 0),(0,s._)([(0,n.MZ)({readOnly:!0})],p.prototype,"version",null),(0,s._)([(0,n.MZ)({readOnly:!0})],p.prototype,"visibleSublayers",null),p=(0,s._)([(0,l.$)("esri.layers.support.ExportImageParameters")],p)},63232:(e,t,i)=>{i.d(t,{r:()=>a});var s=i(66866),r=i(52495),o=i(21564),n=(i(39831),i(539),i(9272),i(63863));const l={visible:"visibleSublayers"};let a=class extends r.A{constructor(e){super(e),this.scale=0}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.removeHandles("layer"),e&&this.addHandles([e.sublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("wms-sublayer-update",(e=>this.notifyChange(l[e.propertyName])))],"layer"))}get layers(){return this.visibleSublayers.filter((({name:e})=>e)).map((({name:e})=>e)).join()}get version(){this.commitProperty("layers");const e=this.layer;return e&&e.commitProperty("imageTransparency"),(this._get("version")||0)+1}get visibleSublayers(){const{layer:e,scale:t}=this,i=e?.sublayers,s=[],r=e=>{const{minScale:i,maxScale:o,sublayers:n,visible:l}=e;l&&(0===t||(0===i||t<=i)&&(0===o||t>=o))&&(n?n.forEach(r):s.push(e))};return i?.forEach(r),s}toJSON(){const{layer:e,layers:t}=this,{imageFormat:i,imageTransparency:s,version:r}=e;return{format:i,request:"GetMap",service:"WMS",styles:"",transparent:s?"TRUE":"FALSE",version:r,layers:t}}};(0,s._)([(0,o.MZ)()],a.prototype,"layer",null),(0,s._)([(0,o.MZ)({readOnly:!0})],a.prototype,"layers",null),(0,s._)([(0,o.MZ)({type:Number})],a.prototype,"scale",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],a.prototype,"version",null),(0,s._)([(0,o.MZ)({readOnly:!0})],a.prototype,"visibleSublayers",null),a=(0,s._)([(0,n.$)("esri.layers.support.ExportWMSImageParameters")],a)},68820:(e,t,i)=>{i.d(t,{A:()=>o});var s=i(98849),r=i(40189);class o{constructor(e,t=0,i=e.lods[e.lods.length-1].level){this.tileInfo=e,this.minLOD=t,this.maxLOD=i,e.lodAt(t)||(this.minLOD=e.lods[0].level),e.lodAt(i)||(this.maxLOD=e.lods[e.lods.length-1].level)}get effectiveMinLOD(){return this.minLOD??this.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}getAvailability(e,t,i){const s=this.tileInfo?.lodAt(e);return!s||e<this.minLOD||e>this.maxLOD?"unavailable":s.cols&&s.rows?i>=s.cols[0]&&i<=s.cols[1]&&t>=s.rows[0]&&t<=s.rows[1]?"unknown":"unavailable":"unknown"}async fetchAvailability(e,t,i,o){await(0,r.NO)(o);const n=this.getAvailability(e,t,i);if("unavailable"===n)throw new s.A("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i});return n}async fetchAvailabilityUpsample(e,t,i,s,o){await(0,r.NO)(o),s.level=e,s.row=t,s.col=i;const n=this.tileInfo;return n.updateTileInfo(s),this.fetchAvailability(e,t,i,o).catch((e=>{if((0,r.zf)(e))throw e;if(n.upsampleTile(s))return this.fetchAvailabilityUpsample(s.level,s.row,s.col,s,o);throw e}))}}},65476:(e,t,i)=>{i.d(t,{x:()=>c});var s,r=i(66866),o=i(21877),n=i(19251),l=i(21564),a=(i(39831),i(539),i(63863));let c=s=class extends o.A{constructor(e){super(e)}clone(){return new s({customLayerParameters:(0,n.o8)(this.customLayerParameters),customParameters:(0,n.o8)(this.customParameters),layerIdentifier:this.layerIdentifier,tileMatrixSet:this.tileMatrixSet,url:this.url})}};(0,r._)([(0,l.MZ)({json:{type:Object,write:!0}})],c.prototype,"customLayerParameters",void 0),(0,r._)([(0,l.MZ)({json:{type:Object,write:!0}})],c.prototype,"customParameters",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],c.prototype,"layerIdentifier",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],c.prototype,"tileMatrixSet",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],c.prototype,"url",void 0),c=s=(0,r._)([(0,a.$)("esri.layers.support.WMTSLayerInfo")],c)},98154:(e,t,i)=>{i.d(t,{L:()=>u});var s=i(28830),r=i(86394),o=i(98849),n=i(40189),l=i(16123),a=i(10282),c=i(26099);async function u(e,t){const i=(0,l.qg)(e);if(!i)throw new o.A("invalid-url","Invalid scene service url");const u={...t,sceneServerUrl:i.url.path,layerId:i.sublayer??void 0};if(u.sceneLayerItem??=await async function(e){const t=(await d(e)).serviceItemId;if(!t)return null;const i=new c.default({id:t,apiKey:e.apiKey}),o=await async function(e){const t=s.id?.findServerInfo(e.sceneServerUrl);if(t?.owningSystemUrl)return t.owningSystemUrl;const i=e.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const t=(await(0,r.A)(i,{query:{f:"json"},responseType:"json",signal:e.signal})).data.owningSystemUrl;if(t)return t}catch(h){(0,n.QP)(h)}return null}(e);null!=o&&(i.portal=new a.A({url:o}));try{return await i.load({signal:e.signal})}catch(y){return(0,n.QP)(y),null}}(u),null==u.sceneLayerItem)return p(u.sceneServerUrl.replace("/SceneServer","/FeatureServer"),u);const h=await async function({sceneLayerItem:e,signal:t}){if(!e)return null;try{const i=(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:t})).find((e=>"Feature Service"===e.type))||null;if(!i)return null;const s=new c.default({portal:i.portal,id:i.id});return await s.load(),s}catch(i){return(0,n.QP)(i),null}}(u);if(!h?.url)throw new o.A("related-service-not-found","Could not find feature service through portal item relationship");u.featureServiceItem=h;const y=await p(h.url,u);return y.portalItem=h,y}async function d(e){if(e.rootDocument)return e.rootDocument;const t={query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:e.signal};try{const i=await(0,r.A)(e.sceneServerUrl,t);e.rootDocument=i.data}catch{e.rootDocument={}}return e.rootDocument}async function p(e,t){const i=(0,l.qg)(e);if(!i)throw new o.A("invalid-feature-service-url","Invalid feature service url");const s=i.url.path,n=t.layerId;if(null==n)return{serverUrl:s};const a=d(t),c=t.featureServiceItem?await t.featureServiceItem.fetchData("json"):null,u=(c?.layers?.[0]||c?.tables?.[0])?.customParameters,p=e=>{const i={query:{f:"json",...u},responseType:"json",authMode:e,signal:t.signal};return(0,r.A)(s,i)},h=p("anonymous").catch((()=>p("no-prompt"))),[y,m]=await Promise.all([h,a]),g=m?.layers,f=y.data&&y.data.layers;if(!Array.isArray(f))throw new Error("expected layers array");if(Array.isArray(g)){for(let r=0;r<Math.min(g.length,f.length);r++)if(g[r].id===n)return{serverUrl:s,layerId:f[r].id}}else if(null!=n&&n<f.length)return{serverUrl:s,layerId:f[n].id};throw new Error("could not find matching associated sublayer")}},97934:(e,t,i)=>{i.d(t,{$:()=>s,P:()=>r});const s={supportsDate:!1,supportsFixedInterval:!1,supportsAutoInterval:!1,supportsFixedBoundaries:!1,supportsStackBy:!1,supportsSplitBy:!1,supportsSnapToData:!1,supportsReturnFullIntervalBin:!1,supportsFirstDayOfWeek:!1,supportsNormalization:!1,supportedStatistics:void 0,supportedNormalizationTypes:void 0},r={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsOrderByFields:!1,supportsResize:!1},data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1,zDefault:void 0},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryBins:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:s,query:{maxRecordCount:0,maxRecordCountFactor:0,maxUniqueIDCount:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsCurrentUser:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPaginationOnAggregatedQueries:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsReturnMesh:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsTrueCurve:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}}},83175:(e,t,i)=>{i.d(t,{K:()=>h,Q:()=>n});var s=i(40454),r=i(90176);const o=new Set(["Catalog Layer","Feature Layer","Oriented Imagery Layer"]);async function n(e,t){const{loadContext:i,...o}=t||{},n=i?await i.fetchServiceMetadata(e,o):await(0,r.V)(e,o),l=(0,s.G$)();p(n),c(n);const a={serviceJSON:n,preferredHost:l};if((n.currentVersion??0)<10.5)return a;const u=`${(0,s.$x)()??e}/layers`,d=i?await i.fetchServiceMetadata(u,o):await(0,r.V)(u,o);return p(d),c(d),a.layersJSON={layers:d.layers,tables:d.tables},a}function l(e){const{type:t}=e;return!!t&&o.has(t)}function a(e){return"Table"===e.type}function c(e){e.layers=e.layers?.filter(l),e.tables=e.tables?.filter(a)}function u(e){e.type||="Feature Layer"}function d(e){e.type||="Table"}function p(e){e.layers?.forEach(u),e.tables?.forEach(d)}function h(e){switch(e){case"Feature Layer":case"Table":return"FeatureLayer";case"Oriented Imagery Layer":return"OrientedImageryLayer";case"Catalog Layer":return"CatalogLayer"}return"FeatureLayer"}},58921:(e,t,i)=>{function s(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?o(e.view.floors,t.floorInfo.floorField):null}function r(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?o(e,t.floorInfo.floorField):null}function o(e,t){if(!e?.length)return null;const i=e.filter((e=>""!==e)).map((e=>`'${e}'`));return i.push("''"),`${t} IN (${i.join(",")}) OR ${t} IS NULL`}i.d(t,{E:()=>s,f:()=>r})},78521:(e,t,i)=>{i.d(t,{Jy:()=>f,Ox:()=>g,Qm:()=>_,Sp:()=>b,_4:()=>m});var s=i(21121),r=i(28830),o=i(56542),n=i(86394),l=i(19251),a=i(20909),c=i(78983),u=i(4675),d=i(36358),p=i(48887),h=i(57822);const y={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function m(e){const t=e.folders||[],i=t.slice(),s=new Map,r=new Map,o=new Map,n=new Map,a=new Map,c={esriGeometryPoint:r,esriGeometryPolyline:o,esriGeometryPolygon:n};(e.featureCollection?.layers||[]).forEach((e=>{const t=(0,l.o8)(e);t.featureSet.features=[];const i=e.featureSet.geometryType;s.set(i,t);const a=e.layerDefinition.objectIdField;"esriGeometryPoint"===i?v(r,a,e.featureSet.features):"esriGeometryPolyline"===i?v(o,a,e.featureSet.features):"esriGeometryPolygon"===i&&v(n,a,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{a.set(e.id,e)})),t.forEach((t=>{t.networkLinkIds.forEach((s=>{const r=function(e,t,i){const s=function(e,t){let i;return t.some((t=>t.id===e&&(i=t,!0))),i}(e,i);return s&&(s.parentFolderId=t,s.networkLink=s),s}(s,t.id,e.networkLinks);r&&i.push(r)}))})),i.forEach((e=>{if(e.featureInfos){e.points=(0,l.o8)(s.get("esriGeometryPoint")),e.polylines=(0,l.o8)(s.get("esriGeometryPolyline")),e.polygons=(0,l.o8)(s.get("esriGeometryPolygon")),e.mapImages=[];for(const t of e.featureInfos)switch(t.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const i=c[t.type].get(t.id);i&&e[y[t.type]]?.featureSet.features.push(i);break}case"GroundOverlay":{const i=a.get(t.id);i&&e.mapImages.push(i);break}}e.fullExtent=_([e])}}));const u=_(i);return{folders:t,sublayers:i,extent:u}}function g(e,t,i,o){const l=r.id?.findCredential(e);e=(0,a.a6)(e,{token:l?.token});const c=s.A.kmlServiceUrl;return(0,n.A)(c,{query:{url:e,model:"simple",folders:"",refresh:0!==i||void 0,outSR:JSON.stringify(t)},responseType:"json",signal:o})}function f(e,t,i=null,s=[]){const r=[],o={},n=t.sublayers,l=new Set(t.folders.map((e=>e.id)));return n.forEach((t=>{const n=new e;if(i?n.read(t,i):n.read(t),s.length&&l.has(n.id)&&(n.visible=s.includes(n.id)),o[t.id]=n,null!=t.parentFolderId&&-1!==t.parentFolderId){const e=o[t.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers?.unshift(n)}else r.unshift(n)})),r}function v(e,t,i){i.forEach((i=>{e.set(i.attributes[t],i)}))}async function b(e){const t=h.A.fromJSON(e.featureSet).features,i=e.layerDefinition,s=(0,p.r)(i.drawingInfo.renderer),r=o.A.fromJSON(e.popupInfo),n=[];for(const o of t){const e=await s.getSymbolAsync(o);o.symbol=e,o.popupTemplate=r,o.visible=!0,n.push(o)}return n}function _(e){const t=(0,u.vt)(u.qv),i=(0,u.vt)(u.qv);for(const s of e){if(s.polygons?.featureSet?.features)for(const e of s.polygons.featureSet.features)(0,d.LJ)(t,e.geometry),(0,u.RF)(i,t);if(s.polylines?.featureSet?.features)for(const e of s.polylines.featureSet.features)(0,d.LJ)(t,e.geometry),(0,u.RF)(i,t);if(s.points?.featureSet?.features)for(const e of s.points.featureSet.features)(0,d.LJ)(t,e.geometry),(0,u.RF)(i,t);if(s.mapImages)for(const e of s.mapImages)(0,d.LJ)(t,e.extent),(0,u.RF)(i,t)}return(0,u.aI)(i,u.qv)?void 0:{xmin:i[0],ymin:i[1],zmin:i[2],xmax:i[3],ymax:i[4],zmax:i[5],spatialReference:c.A.WGS84}}},12434:(e,t,i)=>{i.d(t,{S:()=>s});const s={BingMapsLayer:async()=>(await Promise.all([i.e(72076),i.e(16132)]).then(i.bind(i,16132))).default,BuildingSceneLayer:async()=>(await Promise.all([i.e(72076),i.e(53255),i.e(77684),i.e(83780),i.e(92585),i.e(74859),i.e(15976),i.e(61180),i.e(77859)]).then(i.bind(i,59436))).default,CSVLayer:async()=>(await Promise.all([i.e(72076),i.e(53255),i.e(77684),i.e(83780),i.e(54993)]).then(i.bind(i,97588))).default,CatalogLayer:async()=>(await Promise.all([i.e(72076),i.e(77684),i.e(9190),i.e(15524),i.e(97796)]).then(i.bind(i,84480))).default,DimensionLayer:async()=>(await Promise.all([i.e(72076),i.e(39994)]).then(i.bind(i,39994))).default,ElevationLayer:async()=>(await Promise.all([i.e(72076),i.e(48870)]).then(i.bind(i,48870))).default,FeatureLayer:async()=>(await Promise.all([i.e(72076),i.e(53255),i.e(77684),i.e(83780),i.e(73472)]).then(i.bind(i,83780))).default,GeoJSONLayer:async()=>(await Promise.all([i.e(72076),i.e(53255),i.e(8485)]).then(i.bind(i,8485))).default,GeoRSSLayer:async()=>(await Promise.all([i.e(72076),i.e(5730)]).then(i.bind(i,5730))).default,GroupLayer:async()=>(await Promise.all([i.e(72076),i.e(44040),i.e(43374)]).then(i.bind(i,44040))).default,ImageryLayer:async()=>(await Promise.all([i.e(72076),i.e(9190),i.e(98100),i.e(35114),i.e(4739),i.e(43107),i.e(97668)]).then(i.bind(i,43107))).default,ImageryTileLayer:async()=>(await Promise.all([i.e(72076),i.e(98100),i.e(15995),i.e(35114),i.e(25478),i.e(38712),i.e(4739),i.e(11817),i.e(61877),i.e(85517)]).then(i.bind(i,61877))).default,IntegratedMesh3DTilesLayer:async()=>(await Promise.all([i.e(72076),i.e(97701)]).then(i.bind(i,97701))).default,IntegratedMeshLayer:async()=>(await Promise.all([i.e(72076),i.e(61180),i.e(87027)]).then(i.bind(i,87027))).default,KMLLayer:async()=>(await Promise.all([i.e(72076),i.e(19062)]).then(i.bind(i,19062))).default,KnowledgeGraphLayer:async()=>(await Promise.all([i.e(72076),i.e(46826),i.e(96568),i.e(74995),i.e(45442),i.e(90563),i.e(31550),i.e(53423)]).then(i.bind(i,53423))).default,LineOfSightLayer:async()=>(await Promise.all([i.e(72076),i.e(63453),i.e(6593)]).then(i.bind(i,6593))).default,LinkChartLayer:async()=>(await Promise.all([i.e(72076),i.e(46826),i.e(96568),i.e(74995),i.e(45442),i.e(90563),i.e(31550),i.e(32610)]).then(i.bind(i,32610))).default,MapImageLayer:async()=>(await Promise.all([i.e(72076),i.e(9190),i.e(38041),i.e(11330)]).then(i.bind(i,11330))).default,MapNotesLayer:async()=>(await Promise.all([i.e(72076),i.e(53255),i.e(77684),i.e(83780),i.e(27339)]).then(i.bind(i,60266))).default,MediaLayer:async()=>(await Promise.all([i.e(72076),i.e(13183)]).then(i.bind(i,13183))).default,OGCFeatureLayer:async()=>(await Promise.all([i.e(72076),i.e(53255),i.e(28820)]).then(i.bind(i,28820))).default,OpenStreetMapLayer:async()=>(await Promise.all([i.e(72076),i.e(8628)]).then(i.bind(i,8628))).default,OrientedImageryLayer:async()=>(await Promise.all([i.e(72076),i.e(53255),i.e(77684),i.e(83780),i.e(93927),i.e(90745)]).then(i.bind(i,58859))).default,PointCloudLayer:async()=>(await Promise.all([i.e(72076),i.e(75840)]).then(i.bind(i,75840))).default,RouteLayer:async()=>(await Promise.all([i.e(72076),i.e(3058),i.e(2928)]).then(i.bind(i,2928))).default,SceneLayer:async()=>(await Promise.all([i.e(72076),i.e(92585),i.e(74859),i.e(15976),i.e(61180),i.e(9287)]).then(i.bind(i,9287))).default,StreamLayer:async()=>(await Promise.all([i.e(72076),i.e(53255),i.e(31058)]).then(i.bind(i,31058))).default,SubtypeGroupLayer:async()=>(await Promise.all([i.e(72076),i.e(77684),i.e(73182)]).then(i.bind(i,76027))).default,TileLayer:async()=>(await Promise.all([i.e(72076),i.e(9190),i.e(38041),i.e(10107)]).then(i.bind(i,10107))).default,UnknownLayer:async()=>(await Promise.all([i.e(72076),i.e(75335)]).then(i.bind(i,75335))).default,UnsupportedLayer:async()=>(await Promise.all([i.e(72076),i.e(7400)]).then(i.bind(i,7400))).default,VectorTileLayer:async()=>(await Promise.all([i.e(72076),i.e(17744),i.e(13351),i.e(44328)]).then(i.bind(i,38782))).default,VideoLayer:async()=>(await Promise.all([i.e(72076),i.e(93346),i.e(62316)]).then(i.bind(i,62316))).default,ViewshedLayer:async()=>(await Promise.all([i.e(72076),i.e(63453),i.e(24359)]).then(i.bind(i,24359))).default,VoxelLayer:async()=>(await Promise.all([i.e(72076),i.e(68235)]).then(i.bind(i,68235))).default,WCSLayer:async()=>(await Promise.all([i.e(72076),i.e(98100),i.e(15995),i.e(35114),i.e(25478),i.e(38712),i.e(4739),i.e(11817),i.e(13386)]).then(i.bind(i,13386))).default,WFSLayer:async()=>(await Promise.all([i.e(72076),i.e(53255),i.e(62783)]).then(i.bind(i,62783))).default,WMSLayer:async()=>(await Promise.all([i.e(72076),i.e(25719)]).then(i.bind(i,25719))).default,WMTSLayer:async()=>(await Promise.all([i.e(72076),i.e(89685)]).then(i.bind(i,89685))).default,WebTileLayer:async()=>(await Promise.all([i.e(72076),i.e(47187)]).then(i.bind(i,47187))).default}},44335:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(92976),r=i(8695);function o(e){const t=1/(0,s.GA)(e,1);return 1!==t?new r.A({scale:[t,t,t]}):void 0}},21822:(e,t,i)=>{i.d(t,{Aw:()=>n,DN:()=>s,EA:()=>o,Gm:()=>r,t0:()=>a,xq:()=>l});const s="__esri_stream_id__",r="__esri_timestamp__",o="__esri_track_part__",n="__esri_time_received__",l="__esri_track_line__";var a;!function(e){e[e.TrackLine=0]="TrackLine",e[e.LatestObservation=1]="LatestObservation",e[e.PreviousObservation=2]="PreviousObservation"}(a||(a={}))},55876:(e,t,i)=>{function s(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e?.stops?.length?function(e){let t=0,i=0;for(let s=0;s<e.length;s++){const r=e[s].size;"number"==typeof r&&(t+=r,i++)}return t/i}(e.stops):t}function o(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:s}=t;return(r(i,e)+r(s,e))/2}));let s=0;const o=i.length;if(0===o)return e;for(let r=0;r<o;r++)s+=i[r];const n=Math.floor(s/o);return Math.max(n,e)}function n(e){const t=e?.renderer,i=e?.pointerType,r="touch"===i?9:6;if(!t)return r;const n="visualVariables"in t?o(r,t.visualVariables):r;if("simple"===t.type)return s(n,t.symbol);if("unique-value"===t.type){let e=n;return t.uniqueValueInfos?.forEach((t=>{e=s(e,t.symbol)})),e}if("class-breaks"===t.type){let e=n;return t.classBreakInfos.forEach((t=>{e=s(e,t.symbol)})),e}return"dot-density"===t.type||t.type,n}i.d(t,{o:()=>n})},72973:(e,t,i)=>{i.d(t,{b:()=>l,l:()=>n});var s=i(85569),r=(i(39831),i(98849)),o=i(79689);function n(e){return null==e||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function l(e,t){if(null==e)return null;if(!n(e))return new r.A("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case"simple":return function(e,t){const i={...o.c,...t,cimFallbackEnabled:!0};return a(e,(0,o.t)(e.symbol,i).error)}(e,t);case"unique-value":return function(e,t){const i={...o.c,...t,cimFallbackEnabled:!0},r=e.uniqueValueInfos?.map((e=>(0,o.t)(e.symbol,i).error)).filter(s.Ru),n=(0,o.t)(e.defaultSymbol,i);return n.error&&r?.unshift(n.error),a(e,r)}(e,t);case"class-breaks":return function(e,t){const i={...o.c,...t,cimFallbackEnabled:!0},r=e.classBreakInfos.map((e=>(0,o.t)(e.symbol,i).error)).filter(s.Ru),n=(0,o.t)(e.defaultSymbol,i);return n.error&&r.unshift(n.error),a(e,r)}(e,t);case"dictionary":case"heatmap":return null}return null}function a(e,t){if(!t)return null;if(Array.isArray(t)||(t=[t]),t.length>0){const i=t.map((e=>e.details.symbol.type||e.details.symbol.declaredClass)).filter((e=>!!e));i.sort();const s=new Array;return i.forEach(((e,t)=>{0!==t&&e===i[t-1]||s.push(e)})),new r.A("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${s.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:t})}return null}},70727:(e,t,i)=>{i.d(t,{C:()=>u});var s=i(86394),r=i(73446),o=i(1171),n=i(11499),l=i(45355),a=i(72387);const c=(0,r.dp)(a.A);async function u(e,t,i){t=c(t);const r=(0,n.Dl)(e),a={...r.query,f:"json",...t.toJSON()},u=t.outSpatialReference,d=(0,o.$B)(t.geometries[0]),p=(0,n.jV)(a,i);return(0,s.A)(r.path+"/project",p).then((({data:{geometries:e}})=>(0,l.V)(e,d,u)))}},36628:(e,t,i)=>{i.d(t,{A:()=>h});var s,r=i(66866),o=i(25707),n=i(24793),l=i(19251),a=i(21564),c=(i(39831),i(539),i(63863));let u=class extends(n.A.ClonableMixin(o.A)){static{s=this}constructor(e){super(e),this.stackedAttributes=null}cloneShallow(){return new s({...super.cloneShallow(),stackedAttributes:this.stackedAttributes})}toJSON(){return{...super.toJSON(),stackedAttributes:(0,l.o8)(this.stackedAttributes)}}};(0,r._)([(0,a.MZ)()],u.prototype,"stackedAttributes",void 0),u=s=(0,r._)([(0,c.$)("esri.AttributeBinsGraphic")],u);i(9272);var d=i(75094),p=i(57822);let h=class extends(n.A.ClonableMixin(p.A)){constructor(){super(...arguments),this.features=[]}readFeatures(e,t){return this.readFeaturesWithClass(e,t,u)}};(0,r._)([(0,a.MZ)({type:[u],json:{write:!0}})],h.prototype,"features",void 0),(0,r._)([(0,d.w)("features")],h.prototype,"readFeatures",null),h=(0,r._)([(0,c.$)("esri.rest.support.AttributeBinsFeatureSet")],h)},72387:(e,t,i)=>{i.d(t,{A:()=>u});var s=i(66866),r=i(21877),o=i(21564),n=(i(39831),i(539),i(9272),i(63863)),l=i(78983),a=i(1171),c=i(87926);let u=class extends r.A{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map((e=>e.toJSON())),t=this.geometries[0],i={};return i.outSR=(0,c.YX)(this.outSpatialReference),i.inSR=(0,c.YX)(t.spatialReference),i.geometries=JSON.stringify({geometryType:(0,a.$B)(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(i.transformForward=this.transformForward),i}};(0,s._)([(0,o.MZ)()],u.prototype,"geometries",void 0),(0,s._)([(0,o.MZ)({type:l.A,json:{read:{source:"outSR"}}})],u.prototype,"outSpatialReference",void 0),(0,s._)([(0,o.MZ)()],u.prototype,"transformation",void 0),(0,s._)([(0,o.MZ)()],u.prototype,"transformForward",void 0),u=(0,s._)([(0,n.$)("esri.rest.support.ProjectParameters")],u)},12188:(e,t,i)=>{i.d(t,{K:()=>s});const s={type:String,json:{read:{source:"token"},write:{target:"token"}}}},98549:(e,t,i)=>{i.d(t,{oz:()=>p});var s,r=i(19251);i(54394),i(63643);function o(e){switch(e){case"circle":return{rings:[[[8.5,.2],[7.06,.33],[5.66,.7],[4.35,1.31],[3.16,2.14],[2.14,3.16],[1.31,4.35],[.7,5.66],[.33,7.06],[.2,8.5],[.33,9.94],[.7,11.34],[1.31,12.65],[2.14,13.84],[3.16,14.86],[4.35,15.69],[5.66,16.3],[7.06,16.67],[8.5,16.8],[9.94,16.67],[11.34,16.3],[12.65,15.69],[13.84,14.86],[14.86,13.84],[15.69,12.65],[16.3,11.34],[16.67,9.94],[16.8,8.5],[16.67,7.06],[16.3,5.66],[15.69,4.35],[14.86,3.16],[13.84,2.14],[12.65,1.31],[11.34,.7],[9.94,.33],[8.5,.2]]]};case"square":return{rings:[[[.5,.5],[.5,16.5],[16.5,16.5],[16.5,.5],[.5,.5]]]};case"diamond":return{rings:[[[8.5,.5],[.2,8.5],[8.5,16.5],[16.5,8.5],[8.5,.5]]]};case"hexagon-pointy":return{rings:[[[15.86,12.75],[15.86,4.25],[8.5,0],[1.14,4.25],[1.14,12.75],[8.5,17],[15.86,12.75]]]};case"hexagon-flat":return{rings:[[[12.75,15.86],[17,8.5],[12.75,1.14],[4.25,1.14],[0,8.5],[4.25,15.86],[12.75,15.86]]]}}}function n(e){return"CIMVectorMarker"===e?.type?e.markerGraphics?.[0]:void 0}function l(e){return"CIMPolygonSymbol"===e?.symbol?.type?e.symbol.symbolLayers?.[0]:void 0}function a(e,t){"CIMVectorMarker"===e?.type&&null!=t&&(e.size=t)}function c(e,t){const i=n(e);i&&null!=t&&(i.geometry=o(t))}function u(e,t){const i=l(n(e));i&&null!=t&&(i.color=t.toArray())}function d(e,t,i){const s=l(n(e));s&&null!=t&&i&&(s.colorLocked=t)}function p(e,t){const{outerRingSize:i,innerDotSize:o,type:n,color:l,colorLocked:p,primitiveOverrides:h}=t,y="CIMPolygonSymbol"===e.data.symbol?.type?e.data.symbol.symbolLayers:null;if(2===y?.length)for(const r of y){const e=r.primitiveName===s.OuterRing;a(r,e?i:o),c(r,n),u(r,l),d(r,p,e)}return null!=i&&null!=o&&(e.data.primitiveOverrides=null),void 0!==h&&(e.data.primitiveOverrides=(0,r.o8)(h)),e}!function(e){e.OuterRing="reference-size-outer-ring",e.InnerDot="reference-size-inner-dot"}(s||(s={}))},90176:(e,t,i)=>{i.d(t,{V:()=>r});var s=i(86394);async function r(e,t){const{data:i}=await(0,s.A)(e,{responseType:"json",query:{f:"json",...t?.customParameters,token:t?.apiKey}});return i}},74339:(e,t,i)=>{i.d(t,{A:()=>o});var s=i(72777),r=i(25801);class o{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let s=this._inFlightResourceMap.get(e);return s?s.then((e=>({width:e.width,height:e.height}))):(s=(0,r.M5)(e,t),this._inFlightResourceMap.set(e,s),s.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,s.Al)(e)}}},79851:(e,t,i)=>{i.r(t),i.d(t,{CIMSymbolRasterizer:()=>d});var s=i(1171),r=i(74339),o=i(26502),n=i(48002),l=i(17125),a=i(79126),c=i(50072);const u=96/72;class d{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new r.A}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,r,o,u,d,h,y,m){if(!e)return null;const{data:g}=e;if(!g||"CIMSymbolReference"!==g.type||!g.symbol)return null;const{symbol:f}=g;u||(u=(0,c.n5)(f));const v=await l.OverrideHelper.resolveSymbolOverrides(g,t,this._spatialReference,o,u,d,h),b=this._cimResourceManager,_=[];n.wp.fetchResources(v,b,_),n.wp.fetchFonts(v,b,_),_.length>0&&await Promise.all(_);const{width:w,height:M}=i;let S=p(u,w,M,r,m);const L=n.wp.getEnvelope(v,S,b);if(!L)return null;L.x===1/0&&(L.x=w+2),L.y===1/0&&(L.y=-M/2),L.width===-1/0&&(L.width=w),L.height===-1/0&&(L.height=M);let I=1,A=0,x=0;switch(f.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;L.width>w&&(e=w/L.width);let t=1;L.height>M&&(t=M/L.height),"preview"===r&&(L.width<w&&(e=w/L.width),L.height<M&&(t=M/L.height)),I=Math.min(e,t),A=L.x+L.width/2,x=L.y+L.height/2}break;case"CIMLineSymbol":if(m){x=L.y+L.height/2,A=L.x+L.width/2;const e=L.width-w,t=L.height-M;S={paths:(0,a.hs)(S.paths,{xmin:-1*L.width/2+e,xmax:L.width/2-e,ymin:-1*L.height/2+t,ymax:L.height/2-t,width:L.width-2*e,height:L.height-2*t})}}else{(y||L.height>M)&&(I=M/L.height),x=L.y+L.height/2;const e=L.x*I+w/2,t=(L.x+L.width)*I+w/2,i=(0,s.Rg)(S)?S.paths:(0,s.Bi)(S)?S.rings:null;if(null===i)throw new Error("Bad geometry, can't rasterise symbol!");i[0][0][0]-=e/I,i[0][2][0]-=(t-w)/I}break;case"CIMPolygonSymbol":if(m){x=L.y+L.height/2,A=L.x+L.width/2;const e=L.width-w,t=L.height-M;S={paths:(0,a.hs)(S.rings,{xmin:-1*L.width/2+e,xmax:L.width/2-e,ymin:-1*L.height/2+t,ymax:L.height/2-t,width:L.width-2*e,height:L.height-2*t})}}else{A=L.x+L.width/2,x=L.y+L.height/2;const e=L.x*I+w/2,t=(L.x+L.width)*I+w/2,i=L.y*I+M/2,s=(L.y+L.height)*I+M/2,{rings:r}=S;e<0&&(r[0][0][0]-=e,r[0][3][0]-=e,r[0][4][0]-=e),i<0&&(r[0][0][1]+=i,r[0][1][1]+=i,r[0][4][1]+=i),t>w&&(r[0][1][0]-=t-w,r[0][2][0]-=t-w),s>M&&(r[0][2][1]+=s-M,r[0][3][1]+=s-M)}}const C={type:"cim",data:{type:"CIMSymbolReference",symbol:v}};return this.rasterize(C,w,M,A,x,I,u,1,S)}rasterize(e,t,i,s,r,n,l,a=0,d=null,h=window.devicePixelRatio||1){const{data:y}=e;if(!y||"CIMSymbolReference"!==y.type||!y.symbol)return null;const{symbol:m}=y,g=this._canvas,f=h*u;g.width=t*f,g.height=i*f,l||(l=(0,c.n5)(m)),d||(d=p(l,t,i,"legend")),g.width+=2*a,g.height+=2*a;const v=g.getContext("2d",{willReadFrequently:!0}),b=o.IT.createIdentity();return b.translate(-s,-r),b.scale(n*f,-n*f),b.translate(t*f/2+a,i*f/2+a),v.clearRect(0,0,g.width,g.height),new o.Rj(v,this._cimResourceManager,b,!0).drawSymbol(m,d),v.getImageData(0,0,g.width,g.height)}}function p(e,t,i,s,r){const o=-t/2+1,n=t/2-1,l=i/2-1,c=-i/2+1;if(r&&("esriGeometryPolygon"===e||"esriGeometryPolyline"===e)){const s=function(e,t,i,s){return"esriGeometryPolygon"===t?{rings:(0,a.Tl)((0,a.hs)(e.rings,{xmin:0,ymin:0,width:i,height:s}),-1*i/2,-1*s/2)}:"esriGeometryPolyline"===t?{paths:(0,a.Tl)((0,a.hs)(e.paths,{xmin:0,ymin:0,width:i,height:s}),-1*i/2,-1*s/2)}:null}(r,e,t,i);if(s)return s}switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[o,0],[0,0],[n,0]]]};default:return"legend"===s?{rings:[[[o,l],[n,0],[n,c],[o,c],[o,l]]]}:{rings:[[[o,l],[n,l],[n,c],[o,c],[o,l]]]}}}},17125:(e,t,i)=>{i.d(t,{OverrideHelper:()=>d});var s=i(96220),r=i(775),o=i(19251),n=i(79005),l=i(46709),a=i(50072),c=i(29986);const u=e=>{if(!e)return[0,0,0,0];const{r:t,g:i,b:s,a:r}=e;return[t,i,s,255*r]};class d{static findApplicableOverrides(e,t,i){if(e&&t){if(e.primitiveName){let s=!1;for(const t of i)if(t.primitiveName===e.primitiveName){s=!0;break}if(!s)for(const r of t)r.primitiveName===e.primitiveName&&i.push(r)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)d.findApplicableOverrides(s,t,i);if(e.symbolLayers)for(const s of e.symbolLayers)d.findApplicableOverrides(s,t,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const s of e.effects)d.findApplicableOverrides(s,t,i);if(e.markerPlacement&&d.findApplicableOverrides(e.markerPlacement,t,i),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const s of e.markerGraphics)d.findApplicableOverrides(s,t,i),d.findApplicableOverrides(s.symbol,t,i)}else"CIMCharacterMarker"===e.type?d.findApplicableOverrides(e.symbol,t,i):"CIMHatchFill"===e.type?d.findApplicableOverrides(e.lineSymbol,t,i):"CIMPictureMarker"===e.type&&d.findApplicableOverrides(e.animatedSymbolProperties,t,i)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&(0,a.FH)(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const i=(0,a.rB)(e),s=e.primitiveName,r=[];for(const o of t)o.primitiveName===s&&r.push((0,a.rB)(o));return{type:"cim-effect-param",effect:i,overrides:(0,a.pk)(r)}}static async resolveSymbolOverrides(e,t,i,s,r,l,c){if(!e?.symbol)return null;let{symbol:u,primitiveOverrides:p}=e;const h=!!p;if(!h&&!s)return u;u=(0,o.o8)(u),p=(0,o.o8)(p);let y=!0;if(t||(t={attributes:{}},y=!1),h){if(y||(p=p.filter((e=>!e.valueExpressionInfo?.expression.includes("$feature")))),c||(p=p.filter((e=>!e.valueExpressionInfo?.expression.includes("$view")))),p.length>0){const e=(0,a.O2)(t.attributes),s={spatialReference:i,fields:e,geometryType:r};await d.createRenderExpressions(p,s),d.evaluateOverrides(p,t,r??"esriGeometryPoint",l,c,new n.A(e))}d.applyOverrides(u,p)}return s&&d.applyDictionaryTextOverrides(u,t,s,null),u}static{this._expressionToRenderExpression=new Map}static async createRenderExpressions(e,t){const i=[];for(const s of e){const e=s.valueExpressionInfo;if(!e||d._expressionToRenderExpression.has(e.expression))continue;const r=(0,l.Ad)(e.expression,t.spatialReference);i.push(r),r.then((t=>d._expressionToRenderExpression.set(e.expression,t)))}i.length>0&&await Promise.all(i)}static evaluateOverrides(e,t,i,s,o,n){const l={$view:{scale:o?.scale}};for(const a of e){a.value&&"object"==typeof a.value&&(0,r.IB)(a.value)&&("Color"===a.propertyName||"StrokeColor"===a.propertyName)&&(a.value=u(a.value));const e=a.valueExpressionInfo;if(!e)continue;const o=d._expressionToRenderExpression.get(e.expression);o&&(a.value=(0,c.default)(o,t,l,i,n,s))}}static applyDictionaryTextOverrides(e,t,i,s,r="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const o=e.symbolLayers;if(!o)return;for(const n of o)n&&"CIMVectorMarker"===n.type&&d.applyDictionaryTextOverrides(n,t,i,s,"CIMTextSymbol"===e.type?e.textCase:r)}break;case"CIMVectorMarker":{const r=e.markerGraphics;if(!r)return;for(const e of r)e&&d.applyDictionaryTextOverrides(e,t,i,s)}break;case"CIMMarkerGraphic":{const o=e.textString;if(o&&o.includes("[")){const n=(0,a.gQ)(o,i);e.textString=(0,a.FM)(t,n,s,r)}}}}static applyOverrides(e,t,i,s){if(e.primitiveName)for(const r of t)if(r.primitiveName===e.primitiveName){const t=(0,a.YF)(r.propertyName);if(s&&s.push({cim:e,nocapPropertyName:t,value:e[t]}),i){let t=!1;for(const s of i)s.primitiveName===e.primitiveName&&(t=!0);t||i.push(r)}null!=r.value&&(e[t]=r.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const r of e.effects)d.applyOverrides(r,t,i,s);if(e.symbolLayers)for(const r of e.symbolLayers)d.applyOverrides(r,t,i,s);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const r of e.effects)d.applyOverrides(r,t,i,s);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const r of e.markerGraphics)d.applyOverrides(r,t,i,s),d.applyOverrides(r.symbol,t,i,s)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const i of e)void 0!==i.value&&(t+=`${i.primitiveName}${i.propertyName}${JSON.stringify(i.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new s.A(t).toRgba();return e[3]*=255,e}return t}}},75886:(e,t,i)=>{i.d(t,{D:()=>g,previewCIMSymbol:()=>f});var s=i(89882),r=i(48002),o=i(79851),n=i(17125),l=i(50072),a=i(88148),c=i(73532);const u=new o.CIMSymbolRasterizer(null),d=(0,s.PN)(a.CB.size),p=(0,s.PN)(a.CB.maxSize),h=(0,s.PN)(a.CB.lineWidth),y=1;async function m(e,t,i){const s=t?.size;let r=null!=s&&"object"==typeof s&&"width"in s?s.width:s,o=null!=s&&"object"==typeof s&&"height"in s?s.height:s;if(!r||!o)if("esriGeometryPolygon"===i)r=o=t.maxSize?Math.min(t.maxSize,d):d;else{const s=await g(e,t,i);s&&(r=s.width,o=s.height),"esriGeometryPolyline"===i&&(r=t.maxSize?Math.min(t.maxSize,h):h),r=null!=r&&isFinite(r)?Math.min(r,p):d,o=null!=o&&isFinite(o)?Math.max(Math.min(o,p),y):d}return"legend"===t.style&&"esriGeometryPolyline"===i&&(r=h),{width:r,height:o}}async function g(e,t={},i){const s=t.cimOptions||t;i??=s.geometryType||(0,l.n5)(e?.data?.symbol);const{feature:o,fieldMap:a,viewParams:c}=s,d=await n.OverrideHelper.resolveSymbolOverrides(e.data,o,null,a,i,null,c);if(!d)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:d},e.data.primitiveOverrides=void 0;const p=[];return r.wp.fetchResources(d,u.resourceManager,p),r.wp.fetchFonts(d,u.resourceManager,p),p.length>0&&await Promise.all(p),r.wp.getEnvelope(d,null,u.resourceManager)}async function f(e,t={}){const{node:i,opacity:r,symbolConfig:o}=t,n=null!=o&&"object"==typeof o&&"isSquareFill"in o&&o.isSquareFill,a=t.cimOptions||t,d=a.geometryType||(0,l.n5)(e?.data?.symbol),p=await m(e,t,d),{feature:h,fieldMap:y}=a,g=t?.geometry||n||"esriGeometryPolygon"!==d?"preview":"legend";let f=p;const v=p;if(t?.geometry&&("esriGeometryPolygon"===d||"esriGeometryPolyline"===d)){const e=200;if((0,s.Lz)(p.width)<e||(0,s.Lz)(p.height)<e){const t=p.width>p.height?(0,s.PN)(e)*p.height/p.width:(0,s.PN)(e);f={width:p.width>p.height?(0,s.PN)(e):(0,s.PN)(e)*p.width/p.height,height:t}}}const b=await u.rasterizeCIMSymbolAsync(e,h,f,g,y,d,null,a.viewParams,a.allowScalingUp,t?.geometry?.toJSON());if(!b)return null;const{width:_,height:w}=b,M=document.createElement("canvas");M.width=_,M.height=w,M.getContext("2d").putImageData(b,0,0);const S=(0,s.Lz)(v.width),L=(0,s.Lz)(v.height),I=new Image(S,L);I.src=M.toDataURL(),I.ariaLabel=t.ariaLabel??null,I.alt=t.ariaLabel??"",null!=r&&(I.style.opacity=`${r}`);let A=I;if(null!=t.effectView){const e={shape:{type:"image",x:0,y:0,width:S,height:L,src:I.src},fill:null,stroke:null,offset:[0,0]};A=(0,c.fz)([[e]],[S,L],t)}return i&&A&&i.appendChild(A),A}},29986:(e,t,i)=>{i.d(t,{default:()=>n});var s=i(98849),r=i(539),o=i(20698);function n(e,t,i,s,o,n){if(null==e)return null;const l=e.references("geometry")&&n?a(t,s,n):t,c=e.repurposeFeature(l,o);try{return e.evaluate(c,i)}catch(u){return r.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",u),null}}const l=new Map;function a(e,t,i){const{transform:n,hasZ:a,hasM:c}=i;l.has(t)||l.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,i,s,r)=>(0,o.Tr)(i,t,e,s,r);case"esriGeometryPolygon":return(e,i,s,r)=>(0,o.$X)(i,t,e,s,r);case"esriGeometryPolyline":return(e,i,s,r)=>(0,o.P5)(i,t,e,s,r);case"esriGeometryMultipoint":return(e,i,s,r)=>(0,o.SW)(i,t,e,s,r);default:return r.A.getLogger("esri.views.2d.support.arcadeOnDemand").error(new s.A("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const u=l.get(t)(e.geometry,n,a,c);return{...e,geometry:u}}},62146:(e,t,i)=>{i.d(t,{ih:()=>o,kY:()=>s,vA:()=>r});const s=512,r=4096,o=8},46729:(e,t,i)=>{var s,r,o;i.d(t,{$q:()=>o,NP:()=>s,kh:()=>r}),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(s||(s={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(r||(r={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(o||(o={}))},12712:(e,t,i)=>{function s(e,t){const i=e.featureReduction;return i&&"selection"!==i.type&&(!("maxScale"in i)||!i.maxScale||i.maxScale<t.scale)?i:null}i.d(t,{n:()=>s})},96088:(e,t,i)=>{i.d(t,{N:()=>s});const s={absolute:"absolute-direction",relative:"relative-direction"}},18846:(e,t,i)=>{i.d(t,{D8:()=>o,TO:()=>r,d0:()=>n});var s=i(42453);async function r(e,t=e.popupTemplate){if(null==t)return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:r}=t,{objectIdField:o,typeIdField:n,globalIdField:l,relationships:a}=e;if(i.includes("*"))return["*"];const c=r?(0,s.eX)(e):[],u=(0,s.DB)(e.fieldsIndex,[...i,...c]);return n&&u.push(n),u&&o&&e.fieldsIndex?.has(o)&&!u.includes(o)&&u.push(o),u&&l&&e.fieldsIndex?.has(l)&&!u.includes(l)&&u.push(l),a&&a.forEach((t=>{const{keyField:i}=t;u&&i&&e.fieldsIndex?.has(i)&&!u.includes(i)&&u.push(i)})),u}function o(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function n(e,t){return null!=o(e,{defaultPopupTemplateEnabled:t})}},49313:(e,t,i)=>{i.d(t,{V:()=>n,t:()=>l});var s=i(92976),r=i(84698),o=i(55876);function n(e,t,i,o=new r.A){let n=0;if("2d"===i.type)n=t*(i.resolution??0);else if("3d"===i.type){const r=i.overlayPixelSizeInMapUnits(e),o=i.basemapSpatialReference;n=null==o||o.equals(i.spatialReference)?t*r:(0,s.GA)(o)/(0,s.GA)(i.spatialReference)}const l=e.x-n,a=e.y-n,c=e.x+n,u=e.y+n,{spatialReference:d}=i;return o.xmin=Math.min(l,c),o.ymin=Math.min(a,u),o.xmax=Math.max(l,c),o.ymax=Math.max(a,u),o.spatialReference=d,o}function l(e,t,i){const s=i.toMap(e);return null!=s&&n(s,(0,o.o)(),i,a).intersects(t)}const a=new r.A},16097:(e,t,i)=>{i.d(t,{A:()=>be});var s,r=i(66866),o=i(99050),n=i(50220),l=i(539),a=i(85251),c=i(21564),u=(i(39831),i(9272),i(63863)),d=i(30405),p=i(46928),h=i(58556),y=i(48982),m=i(45307),g=i(4130),f=i(68490),v=i(87926),b=i(47393),_=i(66488),w=i(85569),M=i(98849),S=i(40189),L=i(40454),I=i(10714);!function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(s||(s={}));var A=i(80510);function x(e){return(0,v.oT)(e)||(0,v.x1)(e)}var C=i(92504),T=i(92976),E=i(84698),F=i(97066),R=i(78983),Z=i(96082),O=i(50437),P=i(65228);class k{constructor(e){const t=k.checkUnsupported(e);if(null!=t)throw t;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=(0,v.EA)(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce(((e,t)=>(t.level<e.minLod.level&&(e.minLod=t),e.max=Math.max(e.max,t.level),e)),{minLod:i.lods[0],max:-1/0}),r=s.minLod,o=2**r.level;let n=r.resolution*o,l=r.scale*o;this.levels=new Array(s.max+1);for(let a=0;a<this.levels.length;a++)this.levels[a]={resolution:n,scale:l,tileSize:[n*i.size[0],n*i.size[1]]},n/=2,l/=2}clone(){return new k(this.toTileInfo())}toTileInfo(){return new P.A({dpi:this.dpi,origin:new F.A({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(((e,t)=>new O.A({level:t,scale:e.scale,resolution:e.resolution})))})}getExtent(e,t,i,s){const r=this.levels[e],o=r.tileSize[0],n=r.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-t*n,s[1]=this.origin[1]-(t+1)*n}convertExtentToRadians(e,t){this._isWebMercator?(t[0]=(0,Z.yw)(e[0]),t[1]=(0,Z.jg)(e[1]),t[2]=(0,Z.yw)(e[2]),t[3]=(0,Z.jg)(e[3])):this._isGCS&&(t[0]=(0,C.kU)(e[0]),t[1]=(0,C.kU)(e[1]),t[2]=(0,C.kU)(e[2]),t[3]=(0,C.kU)(e[3]))}getExtentGeometry(e,t,i,s=new E.A){return this.getExtent(e,t,i,N),s.spatialReference=this.spatialReference,s.xmin=N[0],s.ymin=N[1],s.xmax=N[2],s.ymax=N[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(null==e)return!1;let t=!1;for(;this.levels.length<=e;){const{resolution:e,scale:i}=this.levels[this.levels.length-1],s=e/2*this.pixelSize;this.levels.push({resolution:e/2,scale:i/2,tileSize:[s,s]}),t=!0}return t}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const t=this.levels[0].scale;return e>=t?0:Math.log(t/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e,t=1/0){if(k.checkUnsupported(e))return!1;const i=new k(e);if(!i.spatialReference.equals(this.spatialReference))return!1;if(i.pixelSize!==this.pixelSize)return!1;const s=Math.min(this.levels.length-1,i.levels.length-1,t),r=this.levels[s].resolution;let o=.5*r;return!(!(0,C.Sp)(i.origin[0],this.origin[0],o)||!(0,C.Sp)(i.origin[1],this.origin[1],o))&&(o=.5*r/2**s/this.pixelSize*12,(0,C.Sp)(r,i.levels[s].resolution,o))}rootTilesInExtent(e,t=null,i=1/0){const s=new Array,r=this.levels[0].tileSize;if(null==e||0===r[0]||0===r[1])return s;k.computeRowColExtent(e,r,this.origin,N);let o=N[1],n=N[3],l=N[0],a=N[2];const c=a-l,u=n-o;if(c*u>i){const e=Math.floor(Math.sqrt(i));u>e&&(o=o+Math.floor(.5*u)-Math.floor(.5*e),n=o+e),c>e&&(l=l+Math.floor(.5*c)-Math.floor(.5*e),a=l+e)}for(let d=o;d<n;d++)for(let e=l;e<a;e++)s.push([0,d,e]);return null!=t&&(t[0]=this.origin[0]+l*r[0],t[1]=this.origin[1]-n*r[1],t[2]=this.origin[0]+a*r[0],t[3]=this.origin[1]-o*r[1]),s}static computeRowColExtent(e,t,i,s){const r=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+r-i[0])/t[0])),s[2]=Math.max(0,Math.ceil((e[2]-r-i[0])/t[0])),s[1]=Math.max(0,Math.floor((i[1]-e[3]+r)/t[1])),s[3]=Math.max(0,Math.ceil((i[1]-e[1]-r)/t[1]))}static isPowerOfTwo(e){const t=e.lods,i=t[0].resolution*2**t[0].level;return!t.some((e=>!(0,C.b6)(e.resolution,i/2**e.level)))}static hasGapInLevels(e){const t=e.lods.map((e=>e.level));t.sort(((e,t)=>e-t));for(let i=1;i<t.length;i++)if(t[i]!==t[0]+i)return!0;return!1}static tileSizeSupported(e){const t=e.size[1];return t===e.size[0]&&!(t&t-1)&&t>=128&&t<=512}static hasOriginPerLODs(e){const t=e.origin;return e.lods.some((e=>null!=e.origin&&(e.origin[0]!==t.x||e.origin[1]!==t.y)))}static getMissingTileInfoError(){return new M.A("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return null==e?D():e.lods.length<1?new M.A("tilingscheme:generic","Tiling scheme must have at least one level"):k.isPowerOfTwo(e)?k.hasGapInLevels(e)?new M.A("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):k.tileSizeSupported(e)?k.hasOriginPerLODs(e)?new M.A("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new M.A("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new M.A("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,t){const i=e[2]-e[0],s=e[3]-e[1],r=(0,T.GA)(t),o=1.2*Math.max(i,s),n=o/256,l=n*r*(96/.0254),a=new k(new P.A({size:[256,256],origin:new F.A({x:e[0]-.5*(o-i),y:e[3]+.5*(o-s)}),lods:[new O.A({level:0,resolution:n,scale:l})],spatialReference:t}));return a.ensureMaxLod(20),a}static makeWebMercatorAuxiliarySphere(e){const t=new k(k.WebMercatorAuxiliarySphereTileInfo);return t.ensureMaxLod(e),t}static makeGCSWithTileSize(e,t=256,i=16){const s=256/t,r=new k(new P.A({size:[t,t],origin:new F.A({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new O.A({level:0,resolution:.703125*s,scale:295497598.570834*s})]}));return r.ensureMaxLod(i),r}static{this.WebMercatorAuxiliarySphereTileInfo=new P.A({size:[256,256],origin:new F.A({x:-20037508.342787,y:20037508.342787,spatialReference:R.A.WebMercator}),spatialReference:R.A.WebMercator,lods:[new O.A({level:0,resolution:156543.03392800014,scale:591657527.591555})]})}static{this.WebMercatorAuxiliarySphere=k.makeWebMercatorAuxiliarySphere(19)}get test(){}}function D(){return new M.A("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}const N=(0,A.vt)(),$=((0,C.$8)(C.pq/10),(0,A.vt)());k.WebMercatorAuxiliarySphere.getExtent(0,0,0,$);(0,A.vt)([-180,-90,180,90]);const V=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:function(e,t,i,s){if(null==e)return D();const r=e.spatialReference;if(r.isGeographic&&!x(r))return new M.A("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const o=k.checkUnsupported(e);if(null!=o)return o;if(null==i)return new M.A("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=function(e,t){const i=e.lods,s=i[0].resolution*2**i[0].level,r=[s*e.size[0],s*e.size[1]],o=[e.origin.x,e.origin.y],n=(0,A.VY)(t),l=(0,A.vt)();k.computeRowColExtent(n,r,o,l);const a=(l[2]-l[0])*(l[3]-l[1]);if(a>64){const t=i[0].scale*2**i[0].level;let r=Math.max((n[3]-n[1])/e.size[1],(n[2]-n[0])/e.size[0])*t/s;const o=Math.floor(Math.log(r)/Math.log(10));return r=Math.ceil(r/10**o)*10**o,new M.A("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(t).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+r.toLocaleString()+".",{level0Scale:t,suggestedLevel0Scale:r,requiredNumRootTiles:a,allowedNumRootTiles:64})}return null}(e,i);return n||(null==t||r.equals(t)||t.isWGS84&&r.isWebMercator?null:new M.A("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"))}},Symbol.toStringTag,{value:"Module"}));const B=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:function(e,t,i,s){if(null==e)return D();const r=e?.lods.length-1,o=e.spatialReference;if(o.isWebMercator){if(!k.makeWebMercatorAuxiliarySphere(r).compatibleWith(e,s))return new M.A("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!function(e){return x(e)||(0,v.q8)(e)||(0,v.KQ)(e)}(o))return new M.A("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!k.makeGCSWithTileSize(e.spatialReference,e.size[0],r).compatibleWith(e,s))return e.spatialReference.isWGS84?new M.A("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new M.A("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return null==t||e.spatialReference.equals(t)?null:new M.A("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}},Symbol.toStringTag,{value:"Module"})),j={[I.RT.Global]:B,[I.RT.Local]:V};function G(e,t,i,s,r){return j[s].checkIfTileInfoSupportedForViewSR(e,i,t,r)}function z(e,t,i){const s=(0,L.r0)(e);if(null!=s){if(!y.A.isCollection(s))return{tileInfo:s.tileInfo,fullExtent:s.fullExtent};{const e=s.find((e=>null==G(e.tileInfo,e.fullExtent,t,i)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}s.NORTH,s.EAST,s.SOUTH,s.WEST,s.NORTH_EAST,s.SOUTH_EAST,s.SOUTH_WEST,s.NORTH_WEST;var K=i(95859);async function U(e,t={}){const{basemap:i,view:s}=e;await i.load(t),function(e){if(0===e.baseLayers.length&&0===e.referenceLayers.length)return;const t=e.baseLayers.concat(e.referenceLayers).toArray().filter((e=>!(0,L.ce)(e))).map((e=>function(e){return new M.A("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:e,operationalLayerType:e.operationalLayerType||"unknown"})}(e)));if(t.length)throw t[0]}(i),await async function(e,t,i){if(0===e.baseLayers.length)return;const s=e.baseLayers.at(0);if((0,L.r$)(s)){try{await s.load(i)}catch(r){const e="basemap-compatibility:unknown-error",t="Unknown basemap compatibility error",{name:i=e,message:s=t,details:o}=r;throw new M.A(i,s,o)}!function(e,t){const i=t.state.viewingMode;if(!i)return;let s,r;if("wmts"===e?.type){const o=z(e,t.spatialReference,i);if(null==o.tileInfo)throw new M.A("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");s=o.tileInfo,r=o.fullExtent}else s=e.tileInfo,r=e.fullExtent;if(null==s)return;if(!function(e,t){return null!=e&&(null==t||(t===I.RT.Local?!e.isGeographic||e.isWGS84||e.wkid===K.Y.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===K.Y.CGCS2000||e.wkid===K.Y.GCSMARS2000||e.wkid===K.Y.GCSMARS2000_SPHERE||e.wkid===K.Y.GCSMOON2000))}(s.spatialReference,i))throw new M.A(`basemapgalleryitem:spatial-reference-unsupported-${(0,I._s)(i)}`,`Basemap spatial reference is unsupported in ${(0,I._s)(i)} mode`);const o="vector-tile"===e?.type?s.getCompatibleForVTL(256):null;if(i===I.RT.Global){let t=G(s,r,null,i);if(t&&"vector-tile"===e?.type&&null!=r&&o&&!G(o,r,null,i)&&(t=null),t){const e=s.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new M.A(`basemapgalleryitem:tiling-scheme-unsupported-${e}-global`,"Basemap tiling scheme is unsupported in global mode",{error:t})}}else if(k.checkUnsupported(s))throw new M.A("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const n=t.basemapTerrain?.tilingScheme;if(n&&!n.compatibleWith(s)&&("vector-tile"!==e?.type||!o||!n.compatibleWith(o)))throw new M.A("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}(s,t)}}(i,s,t),(0,S.Te)(t)}async function q(e,t={}){const{basemap:i,view:s}=e;(0,S.Te)(t);const r=i.baseLayers.find((e=>"unknown"===e.type))?.loadError;if(null!=r)throw r;if(!s||"spatialReferenceLocked"in s&&!s.spatialReferenceLocked)return;if(await i.load(t),(0,S.Te)(t),0===i.baseLayers.length)return;const o=i.baseLayers.at(0);if(!(0,L.qK)(o))return;if(i.spatialReference){if(s.spatialReference.equals(i.spatialReference))return;H()}await o.load(t),(0,S.Te)(t);const n=(("supportedSpatialReferences"in o?o.supportedSpatialReferences:null)||["tileInfo"in o?o.tileInfo?.spatialReference:null]).filter(w.Ru);0!==n.length&&n.every((e=>!s.spatialReference.equals(e)))&&H()}function H(){throw new M.A("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}var W=i(52495),J=i(65667);let Q=class extends(J.A.IdentifiableMixin(W.A)){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.addHandles([(0,a.wB)((()=>this.basemap?.loadStatus),e),(0,a.wB)((()=>this.compatibilityFunction),e),(0,a.wB)((()=>this.view&&"basemapTerrain"in this.view&&this.view.basemapTerrain?.tilingScheme),e),(0,a.wB)((()=>this.view?.ready),e),(0,a.wB)((()=>this.view?.spatialReference),e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return(0,d.n8)(this.view,this.basemap)}set basemap(e){e&&e.load().catch((()=>{})),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){this._cancelRefresh(),this._set("state","loading");const e=this.basemap?.loadStatus;if("loaded"!==e&&"failed"!==e)return;if(!this.compatibilityFunction)return void("loaded"===e?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const t=new AbortController,{signal:i}=t;this.compatibilityFunction(this,{signal:i}).then((()=>(0,a.C_)((()=>!this._spatialReferenceTask.updating),i))).then((()=>{this._set("state","ready"),this._set("error",null)})).catch((e=>{(0,S.zf)(e)||(this._set("state","error"),this._set("error",e))})),this._refreshController=t}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};(0,r._)([(0,c.MZ)({readOnly:!0})],Q.prototype,"_spatialReferenceTask",null),(0,r._)([(0,c.MZ)()],Q.prototype,"basemap",null),(0,r._)([(0,c.MZ)()],Q.prototype,"compatibilityFunction",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],Q.prototype,"error",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],Q.prototype,"spatialReference",null),(0,r._)([(0,c.MZ)({readOnly:!0})],Q.prototype,"state",void 0),(0,r._)([(0,c.MZ)()],Q.prototype,"view",void 0),Q=(0,r._)([(0,u.$)("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],Q);const Y=Q,X=y.A.ofType(h.default);let ee=class extends W.A{constructor(e){super(e),this.basemaps=new X}destroy(){this.basemaps.forEach((e=>e.destroy()))}get state(){return"ready"}refresh(){}};(0,r._)([(0,c.MZ)({type:X})],ee.prototype,"basemaps",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],ee.prototype,"state",null),ee=(0,r._)([(0,u.$)("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],ee);const te=ee;var ie=i(84410),se=i(10282);const re=y.A.ofType(h.default);let oe=class extends(m.A.LoadableMixin(ie.A.EsriPromiseMixin(te))){constructor(e){super(e),this._lastPortalBasemapFetchController=null,this.basemaps=new re,this.filterFunction=null,this.portal=se.A.getDefault(),this.query=null,this.updateBasemapsCallback=null,this.viewType=null}initialize(){this.addHandles((0,a.wB)((()=>[this.filterFunction,this.loadStatus,this.portal?.basemapGalleryGroupQuery,this.portal?.basemapGalleryGroupQuery3D,this.portal?.user,this.query,this.updateBasemapsCallback]),(()=>this.refresh()),a.Vh))}destroy(){this.filterFunction=null,this.portal=null,this.basemaps.forEach((e=>e.destroy()))}get state(){return"not-loaded"===this.loadStatus?"not-loaded":"loading"===this.loadStatus||this._lastPortalBasemapFetchController?"loading":"ready"}load(e){return this.addResolvingPromise(this.portal.load(e)),Promise.resolve(this)}async refresh(){if("loaded"!==this.loadStatus)return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const e=this.portal,t=new AbortController;this._lastPortalBasemapFetchController=t,this.notifyChange("state");try{const i=await e.fetchBasemaps(this._toQueryString(this.query),{signal:t.signal,include3d:"3d"===this.viewType||void 0});await this._updateBasemaps(i)}catch(i){if((0,S.zf)(i))throw i;l.A.getLogger(this).warn(new M.A("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:i})),await this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(e){return e&&"string"!=typeof e?Object.keys(e).map((t=>`${t}:${e[t]}`)).join(" AND "):e}async _updateBasemaps(e=[]){let t=await this._filterBasemaps(e);t=this.updateBasemapsCallback?await this.updateBasemapsCallback(t):t,this.basemaps.removeAll(),this.basemaps.addMany(t)}async _filterBasemaps(e){if(!this.filterFunction)return e;const t=e.map(this.filterFunction),i=await Promise.all(t);return e.filter(((e,t)=>i[t]))}};(0,r._)([(0,c.MZ)({readOnly:!0,type:re})],oe.prototype,"basemaps",void 0),(0,r._)([(0,c.MZ)()],oe.prototype,"filterFunction",void 0),(0,r._)([(0,c.MZ)({type:se.A})],oe.prototype,"portal",void 0),(0,r._)([(0,c.MZ)()],oe.prototype,"query",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],oe.prototype,"state",null),(0,r._)([(0,c.MZ)()],oe.prototype,"updateBasemapsCallback",void 0),(0,r._)([(0,c.MZ)()],oe.prototype,"viewType",void 0),oe=(0,r._)([(0,u.$)("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],oe);const ne=oe,le=y.A.ofType(Y);let ae=class extends m.A{constructor(e){super(e),this._loadingProjectionEngine=!1,this.items=new le,this.source=new ne,this.view=null}initialize(){const e=()=>this._recreateItems();this.addHandles([(0,a.wB)((()=>"ready"===this.state?this.compatibilityFunction:null),(()=>this._updateItems())),(0,a.on)((()=>this.source?.basemaps),"change",e,{onListenerAdd:e}),(0,a.z7)((()=>this.view),(()=>{this.source instanceof ne&&(this.source.viewType=this.view?.type)}),{once:!0})])}destroy(){const e=this.source.basemaps.find((e=>e===this.activeBasemap));e&&this.source.basemaps.remove(e),this.source?.destroy()}get activeBasemap(){return this.view?.map?.basemap??null}set activeBasemap(e){const t=this.view;if(!t?.map)return;if(!e||!t.ready)return t.map.basemap=e,void this._clearOverride("activeBasemap");const i=e.spatialReference||this.items?.find((t=>this.basemapEquals(e,t.basemap)))?.spatialReference;if(i&&"spatialReferenceLocked"in t&&!t.spatialReferenceLocked){const s=t.spatialReference;if(null!=i&&!(0,v.aI)(s,i)&&!(0,f.canProjectWithoutEngine)(t.spatialReference,i)&&!(0,f.isLoaded)())return this._override("activeBasemap",e),this._loadingProjectionEngine=!0,void(0,f.load)().then((()=>{this._get("activeBasemap")===e&&(t.map.basemap=e,t.spatialReference=i,this._clearOverride("activeBasemap"))}),(()=>{})).then((()=>{this._loadingProjectionEngine=!1}));t.map.basemap=e,this._clearOverride("activeBasemap"),null==i||(0,v.aI)(t.spatialReference,i)||(t.spatialReference=i)}else t.map.basemap=e,this._clearOverride("activeBasemap")}castActiveBasemap(e){return(0,_.es)(e)}get activeBasemapIndex(){const{state:e,activeBasemap:t}=this;return"ready"!==e?-1:this._findBasemapIndex(t)}get compatibilityFunction(){return"3d"===this.view?.type?U:q}set compatibilityFunction(e){this._overrideIfSome("compatibilityFunction",e)}castSource(e){return Array.isArray(e)||y.A.isCollection(e)?new te({basemaps:Array.isArray(e)?new y.A(e):e}):function(e){return e&&"esri.portal.Portal"===e.declaredClass}(e)?new ne({portal:e}):function(e){return e&&!(e instanceof ne)&&(!!e.portal||!!e.query)}(e)?new ne(e):function(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}(e)?e:null}get state(){return this.view?.ready&&this.source?(0,b.O)(this.view)&&!this.view.inGeographicLayout?"unsupported":this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(e,t){return(0,d.jU)(e,t)}refresh(){this._recreateItems()}load(){return this.loadSource()}loadSource(e){return this.addResolvingPromise(m.A.isLoadable(this.source)?this.source.load(e):null),Promise.resolve(this)}_findBasemapIndex(e){const{items:t}=this,i=t.findIndex((t=>t.basemap===e));return-1===i?t.findIndex((t=>this.basemapEquals(t.basemap,e))):i}_recreateItems(){const e=this.source?.basemaps??[],{view:t,compatibilityFunction:i}=this,s=new Map(this.items.map((e=>[e.basemap,e]))),r=e.map((e=>{const r=s.get(e);return r?(s.delete(e),r):new Y({basemap:e,compatibilityFunction:i,view:t})}));this.items.removeAll(),this.items.addMany(r),s.forEach((e=>e.destroy()))}_updateItems(){for(const e of this.items)e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}};(0,r._)([(0,c.MZ)()],ae.prototype,"_loadingProjectionEngine",void 0),(0,r._)([(0,c.MZ)({type:h.default})],ae.prototype,"activeBasemap",null),(0,r._)([(0,g.w)("activeBasemap")],ae.prototype,"castActiveBasemap",null),(0,r._)([(0,c.MZ)({readOnly:!0})],ae.prototype,"activeBasemapIndex",null),(0,r._)([(0,c.MZ)()],ae.prototype,"compatibilityFunction",null),(0,r._)([(0,c.MZ)({readOnly:!0,type:le})],ae.prototype,"items",void 0),(0,r._)([(0,c.MZ)()],ae.prototype,"source",void 0),(0,r._)([(0,g.w)("source")],ae.prototype,"castSource",null),(0,r._)([(0,c.MZ)({readOnly:!0})],ae.prototype,"state",null),(0,r._)([(0,c.MZ)()],ae.prototype,"view",void 0),ae=(0,r._)([(0,u.$)("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],ae);const ce=ae,ue="esri-basemap-gallery",de={base:ue,sourceLoading:`${ue}--source-loading`,loader:`${ue}__loader`,item:`${ue}__item`,itemContainer:`${ue}__item-container`,itemContent:`${ue}__item-content`,itemTitle:`${ue}__item-title`,itemTagsContainer:`${ue}__item-tags-container`,itemThumbnail:`${ue}__item-thumbnail`,selectedItem:`${ue}__item--selected`,itemError:`${ue}__item--error`};var pe=i(17199),he=i(35251),ye=i(76943),me=i(60682),ge=i(43955),fe=i(96704);i(99484);let ve=class extends p.A{constructor(e,t){super(e,t),this.disabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new ce,this._focusBasemapItemEnabled=!1,(0,n.ED)(l.A.getLogger(this),"Basemap Gallery","arcgis-basemap-gallery",{version:"4.32"})}initialize(){this.addHandles((0,a.z7)((()=>this.source),(()=>this.viewModel.loadSource()),{sync:!0,initial:!0}))}loadDependencies(){return(0,pe.W)({scrim:()=>Promise.all([i.e(72076),i.e(24293)]).then(i.bind(i,24293)),chip:()=>Promise.all([i.e(72076),i.e(70375)]).then(i.bind(i,70375))})}get activeBasemap(){return this.viewModel.activeBasemap}set activeBasemap(e){this.viewModel.activeBasemap=e}get icon(){return"basemap"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get source(){return this.viewModel.source}set source(e){this.viewModel.source=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e="loading"===this.source.state,t=this.disabled||"disabled"===this.viewModel.state,i={[de.sourceLoading]:e,[he.D.disabled]:t};return(0,fe.K)("div",{class:this.classes(de.base,he.D.widget,he.D.panel,i),key:"container"},this._getContext())}_getContext(){if("unsupported"===this.viewModel.state)return(0,fe.K)("div",{class:he.D.empty,key:"empty-message"},(0,fe.K)(ye.D,{level:this.headingLevel},this.messages.unsupported));if("loading"===this.source.state)return(0,fe.K)("div",{class:de.loader,key:"loader"});const e=this.viewModel.items;return e.length>0?(0,fe.K)("ul",{"aria-disabled":this.disabled,"aria-label":this.label,bind:this,class:de.itemContainer,key:"item-container",onkeydown:this._handleKeyDown,role:"radiogroup"},e.map(((e,t)=>this._renderBasemapGalleryItem(e,t))).toArray()):(0,fe.K)("div",{class:he.D.empty,key:"empty-message"},(0,fe.K)(ye.D,{level:this.headingLevel},this.messages.noBasemaps))}_getRoundRobinIndex(e,t){return(e+t)%t}_handleKeyDown(e){const{key:t}=e;if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t))return;e.preventDefault();const{items:i,activeBasemapIndex:s}=this.viewModel,r="ArrowUp"===t||"ArrowLeft"===t?this._getRoundRobinIndex(Math.max(s-1,-1),i.length):this._getRoundRobinIndex(s+1,i.length),o=i.at(r);"ready"===o?.state&&(this.viewModel.activeBasemap=o.basemap),this._focusBasemapItemEnabled=!0}_focusBasemapItem(e){this._focusBasemapItemEnabled&&0===e.tabIndex&&(e.focus(),this._focusBasemapItemEnabled=!1)}_handleClick(e){const t=e.currentTarget["data-item"];"ready"===t.state&&(this.viewModel.activeBasemap=t.basemap)}_renderBasemapGalleryItem(e,t){const i=(0,d.hA)(e.basemap)||(0,o.s)("esri/themes/base/images/basemap-toggle-64.svg"),s=e.basemap.title,r=e.basemap.portalItem?.snippet,n=e.error?.message||r||s,{viewModel:{state:l,activeBasemapIndex:a}}=this,c=this.disabled||"disabled"===l,u=a===t,p=u||-1===a&&0===t?0:-1,h="loading"===l,y={[de.selectedItem]:u,[de.itemError]:"error"===e.state},m=`basemapgallery-item-${e.uid}`;return(0,fe.K)("li",{afterUpdate:this._focusBasemapItem,"aria-checked":u.toString(),"aria-disabled":c.toString(),"aria-labelledby":m,bind:this,class:this.classes(de.item,y),"data-item":e,key:e.uid,onclick:this._handleClick,onkeydown:this._handleClick,role:"radio",tabIndex:p,title:n},(0,fe.K)("img",{alt:"",class:de.itemThumbnail,src:i}),(0,fe.K)("div",{class:de.itemContent,key:"content"},(0,fe.K)("div",{class:de.itemTitle,key:"title"},(0,fe.K)("span",{id:m},s)),(0,d.$P)(e.basemap)?this._renderTags(e.basemap):null),"loading"===e.state||u&&h?(0,fe.K)("calcite-scrim",null,(0,fe.K)("span",{"aria-hidden":"true",class:he.D.loaderAnimation,key:"loader",role:"presentation"})):null)}_renderTags(e){return(0,fe.K)("div",{class:de.itemTagsContainer,key:"tag"},this._render3DTag(),(0,d.t5)(e)?this._renderBetaTag():null)}_render3DTag(){const{messages:e}=this;return(0,fe.K)("calcite-chip",{key:"tag-3d",label:e.tag3D,scale:"s"},this.messages.tag3D)}_renderBetaTag(){const{messages:e}=this;return(0,fe.K)("calcite-chip",{appearance:"outline-fill",key:"tag-beta",label:e.tagBeta,scale:"s"},this.messages.tagBeta)}};(0,r._)([(0,c.MZ)()],ve.prototype,"activeBasemap",null),(0,r._)([(0,c.MZ)()],ve.prototype,"disabled",void 0),(0,r._)([(0,c.MZ)()],ve.prototype,"headingLevel",void 0),(0,r._)([(0,c.MZ)()],ve.prototype,"icon",null),(0,r._)([(0,c.MZ)()],ve.prototype,"label",null),(0,r._)([(0,c.MZ)(),(0,ge.G)("esri/widgets/BasemapGallery/t9n/BasemapGallery")],ve.prototype,"messages",void 0),(0,r._)([(0,c.MZ)()],ve.prototype,"source",null),(0,r._)([(0,c.MZ)()],ve.prototype,"view",null),(0,r._)([(0,c.MZ)()],ve.prototype,"viewModel",void 0),(0,r._)([(0,c.MZ)()],ve.prototype,"_focusBasemapItemEnabled",void 0),(0,r._)([(0,me.$)()],ve.prototype,"_handleClick",null),ve=(0,r._)([(0,u.$)("esri.widgets.BasemapGallery")],ve);const be=ve},85798:(e,t,i)=>{i.d(t,{A:()=>S});var s=i(66866),r=i(20464),o=i(85251),n=i(21564),l=(i(39831),i(539),i(9272),i(63863)),a=i(46928),c=i(52495);let u=class extends c.A{constructor(e){super(e),this._viewpointHandle=null,this.group=null}initialize(){this.addHandles((0,o.on)((()=>this.view?.ui),"expand",(e=>{const{target:t}=e;t&&t!==this&&t.expanded&&t.group&&t.group===this.group&&this._collapse()})))}destroy(){this._viewpointHandle=null,this.view=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){const t=!!e;this._set("expanded",t);const i=this.view?.ui;i&&i.emit("expand",{target:this}),this._viewpointHandleChange(t)}get state(){return this.view?.ready?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&(0,o.z7)((()=>e.ready),(()=>{this.view===e&&this._watchViewpoint()}),{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?(0,o.z7)((()=>this.view?.stationary),(()=>this._viewpointHandle?.resume()),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const e="viewpoint";this.removeHandles(e),this._viewpointHandle=null;const{autoCollapse:t,view:i}=this;if(!i||!t)return;const s=(0,o.C1)((()=>"3d"===i.type?i.camera:i.viewpoint),(()=>this._collapse()));this.addHandles(s,e),this._viewpointHandle=s}_collapse(){this.expanded=!1}};(0,s._)([(0,n.MZ)({value:!1})],u.prototype,"autoCollapse",null),(0,s._)([(0,n.MZ)({value:!1})],u.prototype,"expanded",null),(0,s._)([(0,n.MZ)()],u.prototype,"group",void 0),(0,s._)([(0,n.MZ)({readOnly:!0})],u.prototype,"state",null),(0,s._)([(0,n.MZ)({value:null})],u.prototype,"view",null),u=(0,s._)([(0,l.$)("esri.widgets.Expand.ExpandViewModel")],u);const d=u;var p=i(17199),h=i(35251),y=i(58357),m=i(43955),g=i(96704);const f="esri-expand",v={base:f,toggle:`${f}__toggle`,popoverContent:`${f}__popover-content`,panel:`${f}__panel`,panelContent:`${f}__panel-content`,sheet:`${f}__sheet`,contentContainer:`${f}__content-container`,icon:"esri-collapse__icon",iconFlip:"esri-collapse__icon-flip",iconNumber:`${f}__icon-number`},b="chevrons-left",_="chevrons-right",w=Symbol("scheduleRender-override-handle");let M=class extends a.A{constructor(e,t){super(e,t),this._boundScheduledRender=this.scheduleRender.bind(this),this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expandTooltip="",this.focusTrapDisabled=!1,this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.placement=null,this.viewModel=new d,this.toggle=()=>{this.viewModel.expanded=!this.viewModel.expanded},this._handlePopoverClose=e=>{e.target===this._popoverEl&&(this.viewModel.expanded=e.currentTarget.open)},this._handleSheetClose=e=>{this.viewModel.expanded=e.currentTarget.open},this._handlePanelClose=e=>{this.viewModel.expanded=!e.currentTarget.closed},this._handleKeyDown=e=>{this.viewModel.expanded&&"Escape"===e.key&&!this._willCloseOnEsc(e)&&e.preventDefault()},this._storeToggleActionEl=e=>{this._toggleActionEl=e},this._storePopoverEl=e=>{this._popoverEl=e}}initialize(){this.addHandles((0,o.wB)((()=>this.viewModel?.view?.size),(()=>this._popoverEl?.reposition()),o.Vh))}loadDependencies(){return(0,p.W)({action:()=>i.e(72076).then(i.bind(i,13847)),icon:()=>i.e(72076).then(i.bind(i,96446)),panel:()=>Promise.all([i.e(72076),i.e(2921)]).then(i.bind(i,2921)),popover:()=>i.e(72076).then(i.bind(i,78568)),sheet:()=>Promise.all([i.e(72076),i.e(30328),i.e(59770)]).then(i.bind(i,59770))})}get expandTitle(){const{expanded:e,messagesCommon:t,collapseTooltip:i,expandTooltip:s}=this;return(e?i||t?.collapse:s||t?.expand)??""}get _displaySheet(){switch(this.mode){case"drawer":return!0;case"auto":return"xsmall"===this.viewModel.view?.widthBreakpoint;default:return!1}}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(e){this.viewModel.autoCollapse=e}get collapseIcon(){return _}set collapseIcon(e){this._overrideIfSome("collapseIcon",e)}get expanded(){return this.viewModel.expanded}set expanded(e){this.viewModel.expanded=e}get expandIcon(){return(0,y.p4)(this.content)?this.content.icon:b}set expandIcon(e){this._overrideIfSome("expandIcon",e)}get group(){return this.viewModel.group}set group(e){this.viewModel.group=e}get icon(){return null}get label(){return((0,y.p4)(this.content)?this.content.label:null)??this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}render(){const{_displaySheet:e,_toggleActionEl:t,viewModel:{expanded:i},label:s,placement:r}=this;return(0,g.K)("div",{class:this.classes(v.base,h.D.widget)},this._renderToggle(),e?(0,g.K)("calcite-sheet",{class:v.sheet,heightScale:"l",label:s,onkeydown:this._handleKeyDown,open:i,position:"block-end",onCalciteSheetClose:this._handleSheetClose},(0,g.K)("calcite-panel",{class:v.panel,closable:!0,closed:!i,heading:s,onkeydown:this._handleKeyDown,onCalcitePanelClose:this._handlePanelClose},(0,g.K)("div",{class:v.panelContent},this._renderContent()))):t?(0,g.K)("calcite-popover",{afterCreate:this._storePopoverEl,afterUpdate:this._storePopoverEl,focusTrapDisabled:this.focusTrapDisabled,label:s,onkeydown:this._handleKeyDown,open:i,overlayPositioning:"fixed",placement:r??this._getPlacement(),referenceElement:t,onCalcitePopoverClose:this._handlePopoverClose},(0,g.K)("div",{class:v.popoverContent},this._renderContent())):null)}_getPlacement(){const{container:e,view:t}=this,i=e&&t?t.ui.getPosition(e):null;if(!i||"manual"===i)return"auto";const[s,r]=i.split("-");return`${"right"===r?"left":"right"}-${"bottom"===s?"end":"start"}`}_willCloseOnEsc(e){const{closeOnEsc:t}=this;return"function"==typeof t?t(e):t}_renderBadgeNumber(){const{expanded:e,iconNumber:t}=this;return t&&!e?(0,g.K)("span",{class:v.iconNumber,key:"expand__icon-number"},t):null}_renderToggleButton(){const{expanded:e,expandTitle:t,expandIcon:i,collapseIcon:s}=this,r=e?s:i,o=r===b||r===_;return(0,g.K)("calcite-action",{afterCreate:this._storeToggleActionEl,afterUpdate:this._storeToggleActionEl,class:h.D.widgetButton,onclick:this.toggle,scale:"s",text:t,title:t},r?(0,g.K)("calcite-icon",{class:this.classes(v.icon,o&&v.iconFlip),icon:r,scale:"s"}):null)}_renderToggle(){return(0,g.K)("div",{class:v.toggle},this._renderToggleButton(),this._renderBadgeNumber())}_renderContent(){const{content:e}=this;return"string"==typeof e?(0,g.K)("div",{class:v.contentContainer,innerHTML:e,key:"content__string"}):(0,y.p4)(e)?(0,g.K)("div",{afterCreate:()=>{this._overwriteChildScheduleRender(e)},afterRemoved:()=>this.removeHandles(w),afterUpdate:()=>{e.scheduleRender!==this._boundScheduledRender&&(this.removeHandles(w),this._overwriteChildScheduleRender(e))},class:v.contentContainer,key:"content__widget"},e.render()):e instanceof HTMLElement?(0,g.K)("div",{afterCreate:this._attachToNode,bind:e,class:v.contentContainer,key:"content__html-element"}):(0,y.xk)(e)?(0,g.K)("div",{afterCreate:this._attachToNode,bind:e.domNode,class:v.contentContainer,key:"content__node"}):null}_overwriteChildScheduleRender(e){const t=e.scheduleRender;e.scheduleRender=this._boundScheduledRender,this.addHandles((0,r.hA)((()=>e.scheduleRender=t)),w)}_attachToNode(e){e.appendChild(this)}};(0,s._)([(0,n.MZ)({readOnly:!0})],M.prototype,"expandTitle",null),(0,s._)([(0,n.MZ)()],M.prototype,"_toggleActionEl",void 0),(0,s._)([(0,n.MZ)()],M.prototype,"_displaySheet",null),(0,s._)([(0,n.MZ)()],M.prototype,"autoCollapse",null),(0,s._)([(0,n.MZ)()],M.prototype,"closeOnEsc",void 0),(0,s._)([(0,n.MZ)()],M.prototype,"collapseIcon",null),(0,s._)([(0,n.MZ)()],M.prototype,"collapseTooltip",void 0),(0,s._)([(0,n.MZ)()],M.prototype,"content",void 0),(0,s._)([(0,n.MZ)()],M.prototype,"expanded",null),(0,s._)([(0,n.MZ)()],M.prototype,"expandIcon",null),(0,s._)([(0,n.MZ)()],M.prototype,"expandTooltip",void 0),(0,s._)([(0,n.MZ)()],M.prototype,"focusTrapDisabled",void 0),(0,s._)([(0,n.MZ)()],M.prototype,"group",null),(0,s._)([(0,n.MZ)()],M.prototype,"icon",null),(0,s._)([(0,n.MZ)()],M.prototype,"iconNumber",void 0),(0,s._)([(0,n.MZ)()],M.prototype,"label",null),(0,s._)([(0,n.MZ)(),(0,m.G)("esri/widgets/Expand/t9n/Expand")],M.prototype,"messages",void 0),(0,s._)([(0,n.MZ)(),(0,m.G)("esri/t9n/common")],M.prototype,"messagesCommon",void 0),(0,s._)([(0,n.MZ)()],M.prototype,"mode",void 0),(0,s._)([(0,n.MZ)()],M.prototype,"placement",void 0),(0,s._)([(0,n.MZ)()],M.prototype,"view",null),(0,s._)([(0,n.MZ)({type:d})],M.prototype,"viewModel",void 0),M=(0,s._)([(0,l.$)("esri.widgets.Expand")],M);const S=M},11408:(e,t,i)=>{i.d(t,{A:()=>F});var s=i(66866),r=i(48982),o=i(65667),n=i(71416),l=i(85251),a=i(21564),c=(i(39831),i(539),i(9272),i(63863)),u=i(46928);const d="esri-layer-list",p=`${d}__item`,h={base:d,actionMenu:`${d}__action-menu`,actionGroup:`${d}__action-group`,filterNoResults:`${d}__filter-no-results`,item:p,itemActive:`${p}--active`,itemContentBottom:`${p}-content-bottom`,itemMessage:`${p}-message`,itemActionIcon:`${p}-action-icon`,itemActionImage:`${p}-action-image`,itemTemporaryIcon:`${p}-temporary-icon`,itemTableIcon:`${p}-table-icon`,itemCatalogIcon:`${p}-catalog-icon`,statusIndicator:`${d}__status-indicator`,publishing:`${d}__publishing`,updating:`${d}__updating`,connectionStatus:`${d}__connection-status`,connectionStatusConnected:`${d}__connection-status--connected`,visibleToggle:`${d}__visible-toggle`,visibleIcon:`${d}__visible-icon`};var y=i(52329),m=i(67118),g=i(52495);let f=class extends g.A{constructor(){super(...arguments),this.catalogLayerList=!0,this.closeButton=!1,this.collapseButton=!1,this.errors=!1,this.filter=!1,this.flow=!0,this.heading=!1,this.statusIndicators=!0,this.temporaryLayerIndicators=!1}};(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"catalogLayerList",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"closeButton",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"collapseButton",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"errors",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"filter",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"flow",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"heading",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"statusIndicators",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"temporaryLayerIndicators",void 0),f=(0,s._)([(0,c.$)("esri.widgets.LayerList.LayerListVisibleElements")],f);const v=f;var b=i(46963),_=i(45937),w=i(17199),M=i(35251),S=i(23148),L=i(99484),I=i(43955),A=i(24611),x=i(96704);const C=r.A.ofType(b.A),T="nested";let E=class extends(o.A.IdentifiableMixin(u.A)){constructor(e,t){super(e,t),this._rootListEl=null,this._activeItem=null,this._tooltipReferenceMap=new n.A,this._focusRootFlowItem=!1,this._focusPanelFlowItem=!1,this._focusLayerFlowItem=null,this._layerListMap=new n.A,this._lastDragDetail=null,this._selectedDragItemLayerUid=null,this._rootGroupUid=`operational-${this.uid}`,this._openedLayersController=null,this.catalogLayerList=null,this.catalogOptions=null,this.collapsed=!1,this.dragEnabled=!1,this.filterPlaceholder="",this.filterPredicate=null,this.filterText="",this.headingLevel=2,this.knowledgeGraphOptions=null,this.layerTablesEnabled=new r.A(["knowledge-graph"]),this.listItemCanGiveFunction=null,this.listItemCanReceiveFunction=null,this.mapImageOptions=null,this.messages=null,this.messagesCommon=null,this.minDragEnabledItems=_.ep,this.minFilterItems=_.dv,this.openedLayers=new r.A,this.openedLayerLists=new r.A,this.selectedItems=new C,this.selectionMode="none",this.tableList=null,this.tileOptions=null,this.viewModel=new m.A,this.visibilityAppearance="default",this.visibleElements=new v,this._canMove=({dragEl:e,fromEl:t,toEl:i},s)=>{const r="pull"===s?this.listItemCanGiveFunction:this.listItemCanReceiveFunction,o=(0,_.Gq)(e);if(!o?.sortable)return!1;const n=(0,_.Gq)(t),l=(0,_.MN)(t),a=(0,_.Gq)(i),c=(0,_.MN)(i),u=!!l&&!!c&&l===c,d={selected:o,from:n,to:a},p=t.group,h=i.group,y=n?.layer?.type??"",m=a?.layer?.type??"",g=new Set(["map-image","catalog","knowledge-graph"]);return p&&h&&"function"==typeof r?r.call(null,d):u&&!g.has(y)&&!g.has(m)&&"sublayer"!==o?.layer?.type},this._onCatalogOpen=e=>{this.openedLayers.push(e.layer?.parent),this._focusLayerFlowItem=e.layer?.uid},this._onTablesOpen=e=>{this.openedLayers.push(e.layer),this._focusLayerFlowItem=e.layer?.uid},this._onPanelOpen=()=>{this._focusPanelFlowItem=!0},this._onTooltipReferenceChange=(e,t)=>{t?this._tooltipReferenceMap.set(e,t):this._tooltipReferenceMap.delete(e)},this._onSelectedDragItemLayerUidChange=e=>{this._selectedDragItemLayerUid=e},this._onTriggerAction=(e,t)=>{this.triggerAction(e,t)},this._clearActiveItem=()=>{this._activeItem=null},this._setActiveItem=e=>{if("default"!==this.visibilityAppearance)return;const t=Array.from(e.composedPath()).find((e=>e.classList?.contains(h.item)));this._activeItem=(0,_.Gq)(t)},this._onCalciteListOrderChange=e=>{const{_lastDragDetail:t}=this,{toEl:i,fromEl:s,dragEl:r,newIndex:o}=e;if(s&&i&&(t?.newIndex!==o||t?.dragEl!==r||t?.toEl!==i||t?.fromEl!==s))if(this._lastDragDetail=e,this._selectedDragItemLayerUid=r.value,s!==i)this._moveLayerFromChildList({toEl:i,fromEl:s,dragEl:r,newIndex:o});else{const e=Array.from(s.children).filter((e=>e?.matches("calcite-list-item"))).map((e=>e.value));this._sortLayers(s,e)}}}initialize(){this.addHandles([(0,l.on)((()=>this.openedLayers),"change",(()=>this._handleOpenedLayersChange()),l.Vh),(0,l.on)((()=>this.viewModel.operationalItems),"change",(()=>(0,_.eY)(this.selectedItems)),l.Vh),(0,l.wB)((()=>[this.filterPredicate,this._rootListEl]),(()=>(0,_._L)(this._rootListEl,this.filterPredicate)))])}loadDependencies(){return(0,w.W)({button:()=>Promise.all([i.e(72076),i.e(42817)]).then(i.bind(i,42817)),flow:()=>Promise.all([i.e(72076),i.e(17541)]).then(i.bind(i,17541)),"flow-item":()=>Promise.all([i.e(72076),i.e(2921),i.e(38131)]).then(i.bind(i,38131)),list:()=>Promise.all([i.e(72076),i.e(62614),i.e(7311),i.e(22678)]).then(i.bind(i,22678)),notice:()=>Promise.all([i.e(72076),i.e(98566)]).then(i.bind(i,98566)),tooltip:()=>Promise.all([i.e(72076),i.e(17230)]).then(i.bind(i,17230))})}destroy(){this._destroyOpenedLayerLists(),this._tooltipReferenceMap.clear()}get _totalItems(){return this.viewModel.operationalItems.flatten((e=>e.children.filter((e=>"catalog-dynamic-group"!==e.layer?.type)))).length}get _visibleItems(){return this.operationalItems?.filter((e=>!e.hidden&&(this.visibleElements.errors||!e.error)))}get _openedPanelItems(){return this._visibleItems.flatten((e=>e.children)).filter((({hidden:e,panel:t})=>!e&&t?.open&&!t.disabled&&t.flowEnabled))}get _dragEnabled(){return this._totalItems>=this.minDragEnabledItems&&this.dragEnabled}get _filterEnabled(){return this._totalItems>=this.minFilterItems&&this.visibleElements.filter}get _renderedOpenLayerFlowItems(){const{openedLayers:e}=this;return e.toArray().map(((t,i)=>this._renderLayerFlowItem(t,i===e.length-1)))}get icon(){return"layers"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(e){this.viewModel.listItemCreatedFunction=e}get operationalItems(){return this.viewModel.operationalItems}set operationalItems(e){this.viewModel.operationalItems=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}triggerAction(e,t){return this.viewModel.triggerAction(e,t)}render(){const e=this.viewModel?.state,t={[M.D.hidden]:"loading"===e,[M.D.disabled]:"disabled"===e};return(0,x.K)("div",{class:this.classes(h.base,M.D.widget,M.D.panel,t)},this._renderItemTooltips(),this._renderItems())}async _createFlowList(e,t){const{_layerListMap:i}=this,s=i.get(e);if(s)return s;const r="catalog"===e.type?await this._createCatalogLayerList(e):await this._createTableList(e);return t.aborted||i.set(e,r),r}async _handleOpenedLayersChange(){const{_layerListMap:e,openedLayers:t,openedLayerLists:i}=this;this._openedLayersController?.abort();const s=new AbortController,{signal:r}=s;this._openedLayersController=s,e.forEach(((i,s)=>{t.includes(s)||(i.destroy(),e.delete(s))}));const o=await Promise.all(t.map((e=>this._createFlowList(e,r))));if(r.aborted)return;i.removeAll(),i.addMany(o);const n=i.at(-1);n?"catalogLayer"in n?(this._set("catalogLayerList",n),this._set("tableList",null)):(this._set("catalogLayerList",null),this._set("tableList",n)):(this._set("catalogLayerList",null),this._set("tableList",null))}_destroyOpenedLayerLists(){this.openedLayerLists.destroyAll(),this.openedLayers.removeAll(),this._layerListMap.clear()}_renderItemTooltip(e){const{_tooltipReferenceMap:t,messages:i}=this;return e?(0,x.K)("calcite-tooltip",{key:`tooltip-${e.layer?.uid}`,overlayPositioning:"fixed",referenceElement:t.get(e.layer?.uid)},i.layerIncompatibleTooltip):null}_renderItemTooltipNodes(e){return e.incompatible?this._renderItemTooltip(e):e.children?.filter((e=>!e.hidden)).toArray().map((e=>this._renderItemTooltipNodes(e)))}_renderItemTooltips(){return this._visibleItems?.toArray().map((e=>this._renderItemTooltipNodes(e)))}_renderNoItemsMessage(){return(0,x.K)("div",{slot:"message"},this.messages.noItemsToDisplay)}_renderNoItems(){return(0,x.K)("div",{class:h.itemMessage,key:"esri-layer-list__no-items"},(0,x.K)("calcite-notice",{icon:"information",kind:"info",open:!0,width:"full"},this._renderNoItemsMessage()))}async _createCatalogLayerList(e){const{default:t}=await i.e(83811).then(i.bind(i,6192)),{headingLevel:s,catalogOptions:r,view:o,filterPlaceholder:n,listItemCreatedFunction:l,minFilterItems:a,selectionMode:c,visibilityAppearance:u,_onCatalogOpen:d,_onTablesOpen:p,layerTablesEnabled:h}=this;return new t({headingLevel:s,view:o,filterPlaceholder:n,listItemCreatedFunction:l,minFilterItems:a,selectionMode:c,visibilityAppearance:u,...r,catalogLayer:e,layerTablesEnabled:h,onCatalogOpen:d,onTablesOpen:p})}_getTableListParams(e){switch(e.type){case"knowledge-graph":return{...this.knowledgeGraphOptions,tables:e.tables};case"map-image":return{...this.mapImageOptions,tables:e.subtables};case"tile":return{...this.tileOptions,tables:e.subtables};default:return null}}async _createTableList(e){const{default:t}=await i.e(46964).then(i.bind(i,46964)),{headingLevel:s,selectionMode:r,dragEnabled:o}=this;return new t({headingLevel:s,selectionMode:r,dragEnabled:o,...this._getTableListParams(e)})}_renderLayerFlowItem(e,t){const{messages:i,openedLayers:s}=this,r=e.title||this.messages.untitledLayer;return(0,x.K)("calcite-flow-item",{afterCreate:this._focusLayerFlowItemNode,afterUpdate:this._focusLayerFlowItemNode,bind:this,"data-layer-uid":e.uid,description:r,heading:i["catalog"===e.type?"catalogLayers":"tables"],headingLevel:this.headingLevel,key:`flow-layer-list-${e.uid}`,selected:t,onCalciteFlowItemBack:e=>{e.preventDefault(),s.pop();const t=s.at(-1);t?this._focusLayerFlowItem=t.uid:this._focusRootFlowItem=!0}},this._layerListMap.get(e)?.render())}_renderPanelFlowItems(){const{_openedPanelItems:e,openedLayers:t}=this;return e.toArray().map((({title:i,panel:s},r)=>{const o=()=>this._handlePanelFlowItemBack(s);return(0,x.K)("calcite-flow-item",{afterCreate:this._focusPanelFlowItemNode,afterUpdate:this._focusPanelFlowItemNode,bind:this,description:i,heading:s.title,headingLevel:this.headingLevel,key:`flow-panel-${s.uid}`,selected:!t.length&&r===e.length-1,onCalciteFlowItemBack:e=>{e.preventDefault(),o()}},s.render(),(0,x.K)("calcite-button",{appearance:"transparent",onclick:o,slot:"footer-actions",width:"full"},this.messagesCommon.back))}))}_handlePanelFlowItemBack(e){e.open=!1,this._focusRootFlowItem=!0}_focusRootFlowItemNode(e){this._focusRootFlowItem&&(this._focusRootFlowItem=!1,(0,L.Z6)(e))}_focusLayerFlowItemNode(e){this._focusLayerFlowItem===e.dataset.layerUid&&(this._focusLayerFlowItem=null,(0,L.Z6)(e))}_focusPanelFlowItemNode(e){this._focusPanelFlowItem&&(this._focusPanelFlowItem=!1,(0,L.Z6)(e))}_renderItems(){const{visible:e,collapsed:t,_visibleItems:i,_openedPanelItems:s,_filterEnabled:r,_rootGroupUid:o,visibleElements:{closeButton:n,collapseButton:l,heading:a,flow:c},_dragEnabled:u,selectionMode:d,filterText:p,openedLayers:y,filterPlaceholder:m,messages:g}=this,f=[(0,x.K)("calcite-flow-item",{afterCreate:this._focusRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,closable:n,closed:!e,collapsed:t,collapsible:l,heading:a?g.widgetLabel:void 0,headingLevel:this.headingLevel,key:"root-flow-item",selected:!y.length&&!s.length,onCalciteFlowItemClose:()=>this.visible=!1},i?.length?null:this._renderNoItems(),(0,x.K)("calcite-list",{afterCreate:e=>{this._rootListEl=e,e.addEventListener("focusin",this._setActiveItem),e.addEventListener("focusout",this._clearActiveItem)},afterRemoved:e=>{this._rootListEl=null,e.removeEventListener("focusin",this._setActiveItem),e.removeEventListener("focusout",this._clearActiveItem)},canPull:e=>this._canMove(e,"pull"),canPut:e=>this._canMove(e,"put"),"data-layer-type":o,displayMode:T,dragEnabled:u,filterEnabled:r,filterPlaceholder:m,filterProps:S.o,filterText:r?p:"",group:o,key:"root-list",label:g.widgetLabel,onmouseleave:this._clearActiveItem,onmouseover:this._setActiveItem,selectionAppearance:"border",selectionMode:d,onCalciteListChange:e=>this._handleCalciteListChange(e),onCalciteListDragEnd:e=>this._handleCalciteListDragEnd(e.detail),onCalciteListFilter:e=>this.filterText=e.currentTarget?.filterText??"",onCalciteListOrderChange:e=>this._onCalciteListOrderChange(e.detail)},i.toArray().map((e=>this._renderItem(e))),r?(0,x.K)("div",{class:h.filterNoResults,slot:"filter-no-results"},(0,x.K)("calcite-notice",{kind:"info",open:!0,width:"full"},this._renderNoItemsMessage())):null)),this._renderPanelFlowItems(),this._renderedOpenLayerFlowItems];return e?c?(0,x.K)("calcite-flow",{key:"root-flow"},f):f:null}_renderItem(e,t,i){return(0,x.K)(y.A,{activeItem:this._activeItem,canMove:this._canMove,css:h,displayMode:T,dragEnabled:this.dragEnabled,item:e,key:`layerListItem-${e.layer?.uid}`,layerTablesEnabled:this.layerTablesEnabled,listModeDisabled:this.viewModel.listModeDisabled,messages:this.messages,messagesCommon:this.messagesCommon,parent:t,parentTitles:i,rootGroupUid:this._rootGroupUid,selectedDragItemLayerUid:this._selectedDragItemLayerUid,selectedItems:this.selectedItems,selectionMode:this.selectionMode,visibilityAppearance:this.visibilityAppearance,visibleElements:this.visibleElements,onAction:this._onTriggerAction,onCatalogOpen:this._onCatalogOpen,onPanelOpen:this._onPanelOpen,onSelectedDragItemLayerUidChange:this._onSelectedDragItemLayerUidChange,onTablesOpen:this._onTablesOpen,onTooltipReferenceChange:this._onTooltipReferenceChange})}_moveLayerFromChildList({toEl:e,fromEl:t,dragEl:i,newIndex:s}){const r=(0,_.Gq)(i),o=(0,_.Gq)(e),n=(0,_.Gq)(t);this.viewModel.moveListItem(r,n,o,s)}_handleCalciteListDragEnd(e){const{fromEl:t,dragEl:i,oldIndex:s}=e;t.insertBefore(i,t.children[s])}_sortLayers(e,t){if(e)if(e===this._rootListEl)(0,_.mk)(this.view?.map?.layers,t);else{const i=(0,_.Gq)(e);if(!i)return;(0,_.kL)(i,t)}}_handleCalciteListChange(e){const{selectionMode:t,selectedItems:i}=this;if("none"===t)return;const s=e.target.selectedItems.map((e=>(0,_.Gq)(e))).filter(Boolean);i.removeAll(),i.addMany(s)}};(0,s._)([(0,a.MZ)()],E.prototype,"_rootListEl",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"_activeItem",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"_tooltipReferenceMap",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"_focusRootFlowItem",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"_focusPanelFlowItem",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"_focusLayerFlowItem",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"_layerListMap",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"_totalItems",null),(0,s._)([(0,a.MZ)()],E.prototype,"_visibleItems",null),(0,s._)([(0,a.MZ)()],E.prototype,"_openedPanelItems",null),(0,s._)([(0,a.MZ)()],E.prototype,"_dragEnabled",null),(0,s._)([(0,a.MZ)()],E.prototype,"_filterEnabled",null),(0,s._)([(0,a.MZ)()],E.prototype,"_renderedOpenLayerFlowItems",null),(0,s._)([(0,a.MZ)({readOnly:!0})],E.prototype,"catalogLayerList",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"catalogOptions",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"collapsed",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"dragEnabled",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"filterPlaceholder",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"filterPredicate",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"filterText",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"headingLevel",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"icon",null),(0,s._)([(0,a.MZ)()],E.prototype,"knowledgeGraphOptions",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"label",null),(0,s._)([(0,a.MZ)()],E.prototype,"layerTablesEnabled",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"listItemCanGiveFunction",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"listItemCanReceiveFunction",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"listItemCreatedFunction",null),(0,s._)([(0,a.MZ)()],E.prototype,"mapImageOptions",void 0),(0,s._)([(0,a.MZ)(),(0,I.G)("esri/widgets/LayerList/t9n/LayerList")],E.prototype,"messages",void 0),(0,s._)([(0,a.MZ)(),(0,I.G)("esri/t9n/common")],E.prototype,"messagesCommon",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"minDragEnabledItems",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"minFilterItems",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],E.prototype,"openedLayers",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],E.prototype,"openedLayerLists",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"operationalItems",null),(0,s._)([(0,a.MZ)()],E.prototype,"selectedItems",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"selectionMode",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],E.prototype,"tableList",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"tileOptions",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"view",null),(0,s._)([(0,A.U)("trigger-action"),(0,a.MZ)({type:m.A})],E.prototype,"viewModel",void 0),(0,s._)([(0,a.MZ)()],E.prototype,"visibilityAppearance",void 0),(0,s._)([(0,a.MZ)({type:v,nonNullable:!0})],E.prototype,"visibleElements",void 0),E=(0,s._)([(0,c.$)("esri.widgets.LayerList")],E);const F=E},52329:(e,t,i)=>{i.d(t,{A:()=>g});var s,r=i(66866),o=(i(17791),i(21564)),n=(i(39831),i(539),i(9272),i(63863)),l=i(26916),a=i(14872),c=i(46928),u=i(45937),d=i(17199),p=i(96704),h=i(99484),y=i(48187);let m=class extends c.A{static{s=this}constructor(e){super(e),this.dragEnabled=!1,this.listModeDisabled=!1,this.parent=null,this.parentTitles=null,this.viewModel=null,this._onActionMenuOpen=e=>{this.item.actionsOpen=e.currentTarget.open},this._setTooltipReference=e=>{this.onTooltipReferenceChange?.(this.item.layer?.uid,e)},this._removeTooltipReference=()=>{this.onTooltipReferenceChange?.(this.item.layer?.uid,null)}}loadDependencies(){return(0,d.W)({"action-group":()=>Promise.all([i.e(72076),i.e(75781)]).then(i.bind(i,75781)),"action-menu":()=>Promise.all([i.e(72076),i.e(93297)]).then(i.bind(i,93297)),action:()=>i.e(72076).then(i.bind(i,13847)),icon:()=>i.e(72076).then(i.bind(i,96446)),"list-item":()=>Promise.all([i.e(72076),i.e(50246),i.e(69183)]).then(i.bind(i,69183)),list:()=>Promise.all([i.e(72076),i.e(62614),i.e(7311),i.e(22678)]).then(i.bind(i,22678)),notice:()=>Promise.all([i.e(72076),i.e(98566)]).then(i.bind(i,98566))})}static{this.vnodeSelector="calcite-list-item"}render(){const e=this.parentTitles??[],{_title:t,item:i,activeItem:s,selectionMode:r,selectedItems:o,messages:n,parent:l,css:a,dragDisabled:c}=this,u="visibleAtCurrentTimeExtent"in i&&"layerInvisibleAtTime"in n&&!i.visibleAtCurrentTimeExtent?`${t} (${n.layerInvisibleAtTime})`:"visibleAtCurrentScale"in i&&"layerInvisibleAtScale"in n&&!i.visibleAtCurrentScale?`${t} (${n.layerInvisibleAtScale})`:t,d="parent"in i&&"catalog"===i.parent?.layer?.type,{layer:h}=i,y="visibleAtCurrentScale"in i&&!i.visibleAtCurrentScale||"visibleAtCurrentTimeExtent"in i&&!i.visibleAtCurrentTimeExtent;return(0,p.K)("calcite-list-item",{afterCreate:e=>this._focusSelectedDragEl(e,i),afterUpdate:e=>this._focusSelectedDragEl(e,i),class:this.classes(a.item,"itemActive"in a&&{[a.itemActive]:s===i}),"data-item":i,"data-layer-id":h?.id,dragDisabled:!i.sortable||d||c,expanded:"open"in i&&i.open,id:h?.uid,key:`list-item-${h?.uid}`,label:t,metadata:{parentTitles:e,_title:t},selected:"none"!==r&&o.includes(i),title:u,unavailable:y,value:h?.uid,onCalciteListItemSelect:e=>"visible"in i&&this._handleCalciteListItemSelect(e,i,l),onCalciteListItemToggle:e=>"open"in i&&this._handleCalciteListItemToggle(e,i)},this._renderedCatalogFootprintIcon,this._renderedCatalogDynamicIcon,this._renderedItemStatus,this._renderedItemToggle,this._renderedCatalogSelectNode,this._renderedItemTemporaryIcon,this._renderedChildList,this._renderedItemMessage,this._renderedPanel,this._renderedPanelAction,this._renderedActions)}get _title(){const{messages:e}=this;return this.item.title||("untitledTable"in e?e.untitledTable:e.untitledLayer)}get _renderedItemStatus(){const{item:e,parent:t,visibleElements:i,css:s}=this;if(!i.statusIndicators)return null;const{publishing:r}=e,o="updating"in e&&e.updating&&!t,n="connectionStatus"in e?e.connectionStatus:void 0,l=!!n;return(0,p.K)("calcite-icon",{class:this.classes(s.statusIndicator,{[s.publishing]:r},"updating"in s&&{[s.updating]:o},"connectionStatus"in s&&{[s.connectionStatus]:l},"connectionStatusConnected"in s&&{[s.connectionStatusConnected]:l&&"connected"===n}),icon:(0,u.cR)({connectionStatus:n,publishing:r}),key:"layer-item-status",scale:"s",slot:"content-end"})}get _renderedItemTemporaryIcon(){const{item:e,visibleElements:t,css:i}=this,{layer:s}=e,r="temporaryLayerIndicators"in t&&t.temporaryLayerIndicators,o="temporaryTableIndicators"in t&&t.temporaryTableIndicators,n=s&&"persistenceEnabled"in s&&((0,l.hc)(s)||!s.persistenceEnabled);return(r||o)&&n?(0,p.K)("calcite-icon",{class:i.itemTemporaryIcon,icon:"temporary",key:"temporary-icon",scale:"s",slot:"content-start",title:this.messages.temporary}):null}get _renderedItemToggle(){const{_title:e,item:t,parent:i,messages:s,visibilityAppearance:r,css:o}=this;if(!("visible"in t&&"layerVisibility"in s&&"showLayer"in s&&"hideLayer"in s&&"visibleToggle"in o&&r))return null;const{visible:n}=t,l=this._getParentVisibilityMode(i);if("inherited"===l)return null;const a=(0,u.cg)({visible:n,exclusive:"exclusive"===l,visibilityAppearance:r}),c="checkbox"===r,d=s.layerVisibility,h=(0,y.V)(n?s.hideLayer:s.showLayer,{layerName:e});return(0,p.K)("calcite-action",{appearance:"transparent",class:o.visibleToggle,icon:c?a:void 0,key:"visibility-toggle",label:h,onclick:()=>this._toggleVisibility(t,i),scale:"s",slot:c?"actions-start":"actions-end",text:d,title:h},c?null:(0,p.K)("calcite-icon",{class:this.classes({[o.visibleIcon]:"exclusive"!==l&&n}),icon:a,scale:"s"}))}get _renderedPanel(){const{panel:e}=this.item;return!e?.open||e.disabled||e.flowEnabled?null:(0,p.K)("div",{class:this.css.itemContentBottom,key:`content-panel-${e.uid}`,slot:"content-bottom"},e.render())}get _renderedPanelAction(){const{panel:e}=this.item;if(!e?.visible)return null;const{open:t,title:i,disabled:s}=e;return(0,p.K)("calcite-action",{active:t,appearance:"transparent",disabled:s,icon:(0,a.Yb)(e),key:`action-${e.uid}`,onclick:()=>this._togglePanel(e),scale:"s",slot:"actions-end",text:i??"",title:i??void 0},this._renderFallbackIcon(e))}get _renderedActions(){switch(this._actionsCount){case 0:return null;case 1:return this._singleAction;default:return this._renderedActionMenu}}get _renderedActionMenu(){const{item:e,messagesCommon:t}=this,i=t.options;return(0,p.K)("calcite-action-menu",{appearance:"transparent",key:"item-action-menu",label:t.menu,open:e.actionsOpen,overlayPositioning:"fixed",placement:"bottom-end",scale:"s",slot:"actions-end",onCalciteActionMenuOpen:this._onActionMenuOpen},(0,p.K)("calcite-action",{appearance:"transparent",icon:"ellipsis",scale:"s",slot:"trigger",text:i,title:i}),this._renderedActionMenuContent)}get _renderedActionMenuContent(){return this._filteredSections.toArray().map((e=>(0,p.K)("calcite-action-group",{key:`action-section-${e.uid}`},e.toArray().map((e=>this._renderAction({action:e,textEnabled:!0}))))))}get _renderedCatalogFootprintIcon(){const{css:e}=this,t=this.item.layer,i="catalog-footprint"===t?.type,s="sublayer"===t?.type&&(0,l.Jt)(t,"footprints");return"itemCatalogIcon"in e&&(i||s)?(0,p.K)("calcite-icon",{class:e.itemCatalogIcon,icon:"footprint",key:"footprint",scale:"s",slot:"content-start"}):null}get _renderedCatalogDynamicIcon(){const{css:e}=this,t=this.item.layer,i="catalog-dynamic-group"===t?.type,s="sublayer"===t?.type&&(0,l.Jt)(t,"layers-in-view");return"itemCatalogIcon"in e&&(i||s)?(0,p.K)("calcite-icon",{class:e.itemCatalogIcon,icon:"catalog-dataset",key:"catalog-dataset",scale:"s",slot:"content-start"}):null}get _renderedCatalogSelectNode(){const{_title:e,item:t,visibleElements:i}=this;if(!("visible"in t))return;const{layer:s}=t,r="catalog-dynamic-group"===s?.type;return"catalogLayerList"in i&&i.catalogLayerList&&r?(0,p.K)("calcite-action",{appearance:"transparent",disabled:!s.visible,icon:"chevron-right",iconFlipRtl:!0,onclick:()=>this._triggerOnCatalogOpen(t),scale:"s",slot:"actions-end",text:e}):null}get _renderedChildList(){const{dragEnabled:e,item:t,rootGroupUid:i,listModeDisabled:s,selectionMode:r,displayMode:o}=this;if(!("children"in t))return;const n=[...this.parentTitles??[],t.title],{children:l,layer:a}=t,c="catalog-dynamic-group"!==a?.type&&(0,u.do)(t),d=!s&&(0,u.Mq)(a),h="group"===a?.type,y=!d&&!c&&e&&h,m=!!e&&"childrenSortable"in t&&t.childrenSortable&&(0,u.dL)(t);return c||y?(0,p.K)("calcite-list",{canPull:e=>!!this.canMove&&this.canMove(e,"pull"),canPut:e=>!!this.canMove&&this.canMove(e,"put"),"data-item":t,"data-layer-type":i,displayMode:o,dragEnabled:m,group:h?i:`${i}-${a?.uid}`,key:`child-list-${a?.uid}`,label:t.title,selectionAppearance:"border",selectionMode:r},l?.filter((e=>!e.hidden&&(this.visibleElements.errors||!e.error))).toArray().map((e=>this._renderItem(e,t,n))),this._renderedTablesItem):null}get _hasTables(){const{layerTablesEnabled:e}=this,t=this.item.layer;if(!e||!t)return!1;switch(t.type){case"knowledge-graph":return e.includes(t.type)&&"tables"in t&&!!t.tables?.length;case"map-image":case"tile":return e.includes(t.type)&&"subtables"in t&&!!t.subtables?.length;default:return!1}}get _renderedTablesItem(){const{item:e,messages:t,css:i}=this,{layer:s}=e;return"itemTableIcon"in i&&"visible"in e&&"tables"in t&&this._hasTables?(0,p.K)("calcite-list-item",{class:i.item,"data-layer-id":s?.id,dragDisabled:!0,key:`list-item-table-list-tables-${s?.uid}`,label:t.tables,title:t.tables,onCalciteListItemSelect:()=>this._triggerOnTablesOpen(e)},(0,p.K)("calcite-icon",{class:i.itemTableIcon,icon:"table",scale:"s",slot:"content-start"}),(0,p.K)("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"})):null}get _renderedItemMessage(){const{item:e,messages:t,css:i}=this;return e.error?(0,p.K)("div",{class:i.itemMessage,key:"esri-layer-list__error",slot:"content-bottom"},(0,p.K)("calcite-notice",{icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",width:"full"},(0,p.K)("div",{slot:"message"},"tableError"in t?t.tableError:t.layerError))):"incompatible"in e&&e.incompatible&&"layerIncompatible"in t?(0,p.K)("div",{class:i.itemMessage,key:"esri-layer-list__incompatible",slot:"content-bottom"},(0,p.K)("calcite-notice",{afterCreate:this._setTooltipReference,afterRemoved:this._removeTooltipReference,bind:this,icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",tabIndex:0,width:"full"},(0,p.K)("div",{slot:"message"},t.layerIncompatible))):null}get _singleAction(){return this._renderAction({action:(0,u.Vq)(this._filteredSections),textEnabled:!1})}get _filteredSections(){return this.item.actionsSections.map((e=>e.filter((e=>e.visible))))}get _actionsCount(){return this.item.actionsSections.reduce(((e,t)=>e+t.length),0)}_renderAction(e){const{item:t}=this,{action:i,textEnabled:s}=e;if(!i)return null;const{active:r,disabled:o,title:n,type:l,indicator:c}=i;return(0,p.K)("calcite-action",{active:"toggle"===l&&i.value,appearance:"transparent","data-action-id":i.id,disabled:o,icon:(0,a.Yb)(i),indicator:c,key:`action-${i.uid}`,loading:r,onclick:()=>this._triggerAction(t,i),scale:"s",slot:s?void 0:"actions-end",text:n??"",textEnabled:s,title:n??void 0},this._renderFallbackIcon(i))}_renderFallbackIcon(e){const{css:t}=this,{icon:i}=e,s="className"in e?e.className:void 0;if(i)return null;const r="image"in e?e.image:void 0,o={[t.itemActionIcon]:!!s,[t.itemActionImage]:!!r};return s&&(o[s]=!0),r||s?(0,p.K)("span",{"aria-hidden":"true",class:this.classes(t.itemActionIcon,o),key:"icon",styles:(0,a.p5)(r)}):null}_renderItem(e,t,i=[]){return(0,p.K)(s,{activeItem:this.activeItem,canMove:this.canMove,css:this.css,displayMode:this.displayMode,dragEnabled:this.dragEnabled,item:e,key:`layerListItem-${e.layer?.uid}`,layerTablesEnabled:this.layerTablesEnabled,listModeDisabled:this.listModeDisabled,messages:this.messages,messagesCommon:this.messagesCommon,parent:t,parentTitles:i,rootGroupUid:this.rootGroupUid,selectedDragItemLayerUid:this.selectedDragItemLayerUid,selectedItems:this.selectedItems,selectionMode:this.selectionMode,visibilityAppearance:this.visibilityAppearance,visibleElements:this.visibleElements,onAction:this.onAction,onCatalogOpen:this.onCatalogOpen,onPanelOpen:this.onPanelOpen,onSelectedDragItemLayerUidChange:this.onSelectedDragItemLayerUidChange,onTablesOpen:this.onTablesOpen,onTooltipReferenceChange:this.onTooltipReferenceChange})}_triggerAction(e,t){t&&e&&("toggle"===t.type&&(t.value=!t.value),this.onAction(t,e))}_triggerOnTablesOpen(e){e&&this.onTablesOpen&&this.onTablesOpen(e)}_triggerOnCatalogOpen(e){e&&this.onCatalogOpen?.(e)}_focusSelectedDragEl(e,t){this.selectedDragItemLayerUid===t.layer?.uid&&((0,h.Z6)(e),this.onSelectedDragItemLayerUidChange?.(null))}_handleCalciteListItemToggle(e,t){e.stopPropagation(),t.open=e.target.expanded}_getParentVisibilityMode(e){return e&&"visibilityMode"in e?e.visibilityMode:null}_handleCalciteListItemSelect(e,t,i){if((0,u.Gq)(e.target)!==t)return;const s=this._getParentVisibilityMode(i);"none"===this.selectionMode&&"inherited"!==s&&this._toggleVisibility(t,i)}_togglePanel(e){e.open=!e.open,e.open&&this.onPanelOpen()}_toggleVisibility(e,t){e&&"visible"in e&&("exclusive"===this._getParentVisibilityMode(t)&&e.visible||(e.visible=!e.visible))}};(0,r._)([(0,o.MZ)()],m.prototype,"activeItem",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"canMove",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"css",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"displayMode",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"dragEnabled",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"dragDisabled",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"item",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"layerTablesEnabled",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"listModeDisabled",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"messages",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"messagesCommon",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"onAction",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"onPanelOpen",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"onCatalogOpen",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"onTablesOpen",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"onSelectedDragItemLayerUidChange",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"onTooltipReferenceChange",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"parent",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"parentTitles",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"rootGroupUid",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"selectionMode",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"selectedItems",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"selectedDragItemLayerUid",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"visibleElements",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"visibilityAppearance",void 0),(0,r._)([(0,o.MZ)()],m.prototype,"_title",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedItemStatus",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedItemTemporaryIcon",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedItemToggle",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedPanel",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedPanelAction",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedActions",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedActionMenu",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedActionMenuContent",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedCatalogFootprintIcon",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedCatalogDynamicIcon",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedCatalogSelectNode",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedChildList",null),(0,r._)([(0,o.MZ)()],m.prototype,"_hasTables",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedTablesItem",null),(0,r._)([(0,o.MZ)()],m.prototype,"_renderedItemMessage",null),(0,r._)([(0,o.MZ)()],m.prototype,"_singleAction",null),(0,r._)([(0,o.MZ)()],m.prototype,"_filteredSections",null),(0,r._)([(0,o.MZ)()],m.prototype,"_actionsCount",null),m=s=(0,r._)([(0,n.$)("esri.widgets.LayerList.LayerListItem")],m);const g=m},67118:(e,t,i)=>{i.d(t,{A:()=>b});var s=i(66866),r=i(48982),o=i(17306),n=i(85251),l=i(21564),a=(i(39831),i(539),i(9272),i(63863)),c=i(47393),u=i(46963),d=i(45937);const p="view",h="view-layers",y="map-layers",m="layer-views",g="layer-list-mode",f=r.A.ofType(u.A);let v=class extends o.A.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new f,this.view=null}initialize(){this.addHandles([(0,n.wB)((()=>!0===this.view?.ready),(()=>this._viewHandles()),n.Vh),(0,n.wB)((()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled]),(()=>this._recompileList())),(0,n.wB)((()=>(0,c.O)(this.view)?this.view.inGeographicLayout:null),(()=>this._compileList()))],p)}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:e}=this;return e?.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten((e=>e.children)).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,s){const r=e?.layer;if(!r||"subtype-sublayer"===r.type||"sublayer"===r.type)return;const o=this.view?.map?.layers,n=t?(0,d.ES)(t):o,l=i?(0,d.ES)(i):o;if(!n||!l)return;const{operationalItems:a}=this,c=t?.children||a,u=i?.children||a,p=l.length-s;e.parent=i||null,c.remove(e),n.remove(r),u.includes(e)||u.add(e,p),l.includes(r)||l.add(r,p),this._compileList()}_createLayerViewHandles(e){this.removeHandles(m),this._compileList(),e&&this.addHandles(e.on("change",(()=>this._compileList())),m)}_createMapLayerHandles(e){this.removeHandles(y),this._compileList(),e&&this.addHandles(e.on("change",(()=>this._compileList())),y)}_createListItem(e){const{view:t,listItemCreatedFunction:i,checkPublishStatusEnabled:s,listModeDisabled:r}=this;return new u.A({checkPublishStatusEnabled:s,listModeDisabled:r,layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter((e=>"hide"!==(0,d.Qv)(e))):void 0}_watchLayersListMode(e){this.removeHandles(g),e&&!this.listModeDisabled&&this.addHandles((0,n.wB)((()=>e.filter((e=>"listMode"in e)).map((e=>e.listMode)).toArray()),(()=>this._compileList())),g)}_compileList(){const e=this.view?.map?.layers,t=(0,c.O)(this.view)&&!this.view.inGeographicLayout?e?.filter((({type:e})=>"link-chart"===e)):e;this._watchLayersListMode(t);const i=this._getViewableLayers(t);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach((e=>{t.some((t=>t.layer===e))||t.add(this._createListItem(e))}))}_removeItems(e){const{operationalItems:t}=this,i=[];t.forEach((t=>{t&&e&&e.includes(t.layer)||i.push(t)})),t.destroyMany(i)}_sortItems(e){const{operationalItems:t}=this;t.sort(((t,i)=>{const s=e.indexOf(t.layer),r=e.indexOf(i.layer);return s>r?-1:s<r?1:0}))}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([y,m,h]),e?.ready?this.addHandles([(0,n.wB)((()=>this.view?.map?.allLayers),(e=>this._createMapLayerHandles(e)),n.Vh),(0,n.wB)((()=>this.view?.allLayerViews),(e=>this._createLayerViewHandles(e)),n.Vh)],h):this._removeAllItems()}};(0,s._)([(0,l.MZ)()],v.prototype,"checkPublishStatusEnabled",void 0),(0,s._)([(0,l.MZ)()],v.prototype,"listItemCreatedFunction",void 0),(0,s._)([(0,l.MZ)({nonNullable:!0})],v.prototype,"listModeDisabled",void 0),(0,s._)([(0,l.MZ)({type:f})],v.prototype,"operationalItems",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],v.prototype,"state",null),(0,s._)([(0,l.MZ)()],v.prototype,"totalItems",null),(0,s._)([(0,l.MZ)()],v.prototype,"view",void 0),v=(0,s._)([(0,a.$)("esri.widgets.LayerList.LayerListViewModel")],v);const b=v},46963:(e,t,i)=>{i.d(t,{A:()=>T});var s=i(66866),r=i(52495),o=i(85569),n=i(48982),l=i(65667),a=i(85251),c=i(21564),u=i(4130),d=(i(39831),i(63863)),p=i(45066),h=i(44072),y=i(88121),m=i(67241),g=i(6267),f=(i(539),i(9272),i(46928)),v=i(45937),b=i(58357),_=i(96704);let w=class extends(l.A.IdentifiableMixin(f.A)){constructor(e,t){super(e,t),this._legend=null,this.content=null,this.flowEnabled=!1,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles([(0,a.wB)((()=>this._canCreateLegend),(()=>this._createLegend()),a.Vh),(0,a.wB)((()=>[this._legend,this._legendOptions]),(()=>this._updateLegend()),a.Vh)])}destroy(){this._legend=(0,g.pR)(this._legend)}get _canCreateLegend(){const{content:e,listItem:t}=this;if(!t)return!1;const i="legend";return e===i||null!=e&&!!Array.isArray(e)&&e.includes(i)}get _legendOptions(){const{listItem:e,_legendLayerInfo:t}=this,i=e?.view;return t&&i?{view:i,layerInfos:[t]}:{}}get _legendLayerInfo(){const e=this.listItem?.layer;if(!e||"subtype-sublayer"===e.type)return null;const t=(0,v.GB)(e)?e:null,i=e?.parent,s=null!=i&&"type"in i&&"map-image"===i.type?t?.source:null;return s&&i?{layer:i,title:"",sublayerIds:[s.mapLayerId]}:{layer:e,title:""}}get disabled(){const{listItem:e,_legend:t,content:i}=this;return!(e&&(Array.isArray(i)&&i.length>1||!t||t.activeLayerInfos?.length&&e.visibleAtCurrentScale&&e.visible))}set disabled(e){this._overrideIfSome("disabled",e)}get icon(){const{image:e}=this,t=this._getFirstWidget();return this._get("icon")??(!e&&t?t.icon:null)}set icon(e){this._overrideIfSome("icon",e)}get title(){return this._get("title")||(this._getFirstWidget()?.label??"")}set title(e){this._override("title",e)}render(){return(0,_.K)("div",{class:"esri-list-item-panel"},this._renderContents())}_renderContent(e){const{_legend:t,disabled:i,open:s}=this;return e&&!i&&s?"legend"===e&&t?(0,_.K)("div",{key:"legend-widget"},t.render()):"string"==typeof e?(0,_.K)("div",{innerHTML:e,key:e}):(0,b.p4)(e)?(0,_.K)("div",{key:"content-widget"},e.render()):e instanceof HTMLElement?(0,_.K)("div",{afterCreate:this._attachToNode,bind:e,key:"content-element"}):null:null}_renderContents(){const{content:e,open:t}=this;return t?Array.isArray(e)?e.map((e=>this._renderContent(e))):this._renderContent(e):null}async _createLegend(){if((0,g.pR)(this._legend),this._legend=null,!this._canCreateLegend)return;const{default:e}=await Promise.resolve().then(i.bind(i,34692)),t=new e(this._legendOptions);this._legend=t}_attachToNode(e){e.appendChild(this)}_updateLegend(){const e=this._legend;e&&e.set(this._legendOptions)}_getWidget(e){return"legend"===e?this._legend:(0,b.p4)(e)?e:null}_getFirstWidget(){const{content:e}=this;return Array.isArray(e)?e.map((e=>this._getWidget(e))).find((e=>e)):this._getWidget(e)}};(0,s._)([(0,c.MZ)()],w.prototype,"_legend",void 0),(0,s._)([(0,c.MZ)()],w.prototype,"_canCreateLegend",null),(0,s._)([(0,c.MZ)()],w.prototype,"_legendOptions",null),(0,s._)([(0,c.MZ)()],w.prototype,"_legendLayerInfo",null),(0,s._)([(0,c.MZ)()],w.prototype,"content",void 0),(0,s._)([(0,c.MZ)()],w.prototype,"disabled",null),(0,s._)([(0,c.MZ)()],w.prototype,"flowEnabled",void 0),(0,s._)([(0,c.MZ)()],w.prototype,"icon",null),(0,s._)([(0,c.MZ)()],w.prototype,"image",void 0),(0,s._)([(0,c.MZ)()],w.prototype,"listItem",void 0),(0,s._)([(0,c.MZ)()],w.prototype,"open",void 0),(0,s._)([(0,c.MZ)()],w.prototype,"title",null),(0,s._)([(0,c.MZ)()],w.prototype,"visible",void 0),w=(0,s._)([(0,d.$)("esri.widgets.LayerList.ListItemPanel")],w);const M=w;var S;const L=n.A.ofType({key:"type",defaultKeyValue:"button",base:h.A,typeMap:{button:y.A,toggle:m.A}}),I=n.A.ofType(L),A="layer",x="child-list-mode";let C=S=class extends(l.A.IdentifiableMixin(r.A)){constructor(e){super(e),this.actionsSections=new I,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(n.A.ofType(S)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.open=!1,this.parent=null,this.view=null}initialize(){if(this.addHandles([(0,a.wB)((()=>[this.layer,this.layer?.listMode,this.listModeDisabled]),(()=>this._watchLayerProperties(this.layer)),a.Vh),(0,a.wB)((()=>this.checkPublishStatusEnabled),(e=>this._updateChildrenPublishing(e)),a.Vh),(0,a.wB)((()=>this.view),(e=>this._updateChildrenView(e)),a.Vh),(0,a.wB)((()=>this.panel),(e=>this._setListItemOnPanel(e)),a.Vh)]),"function"==typeof this.listItemCreatedFunction){const e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){this.panel?.destroy(),this.children.destroyAll(),this.view=null}get connectionStatus(){const{layerView:e,publishing:t}=this;if(!t&&e&&"connectionStatus"in e)return e.connectionStatus}get error(){return this.layer?.loadError}get incompatible(){const{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e)||e.spatialReferenceSupported)}get layerView(){const{layer:e,view:t}=this;if(!e||!t||"sublayer"===e.type)return null;const i="subtype-sublayer"===e.type?e.parent:e;return t.allLayerViews.find((e=>e.layer===i))??null}set panel(e){const t=this._get("panel");e!==t&&e&&t?.destroy(),this._set("panel",e)}castPanel(e){return this.panel?.open&&!e.hasOwnProperty("open")&&(e.open=!0),e?new M(e):null}get sortable(){return"knowledge-graph-sublayer"!==this.layer?.type&&this._get("sortable")}set sortable(e){this._set("sortable",e)}get title(){const e=(0,p.Jt)(this,"layer.layer");return(!e||e&&(0,p.Jt)(this,"layer.layer.loaded"))&&(0,p.Jt)(this,"layer.title")||(0,p.Jt)(this,"layer.attributes.title")||""}set title(e){this._override("title",e)}get publishing(){const{layer:e,checkPublishStatusEnabled:t}=this;return!!(t&&e&&"publishingInfo"in e&&"publishing"===e.publishingInfo?.status)}get updating(){const{layerView:e,connectionStatus:t,layer:i,publishing:s}=this;return!s&&!t&&(e?e.updating:"loading"===i?.loadStatus||!1)}get visible(){return!!this.layer?.visible}set visible(e){const t=this.layer;t&&(t.visible=e)}get visibleAtCurrentScale(){return this.layerView?.visibleAtCurrentScale??!(0,v.eF)(this.layer,this.view?.scale)}get visibleAtCurrentTimeExtent(){return this.layerView?.visibleAtCurrentTimeExtent??!0}get visibilityMode(){return(0,v.Yl)(this.layer)}clone(){return new S({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildrenPublishing(e){this.children?.forEach((t=>t.checkPublishStatusEnabled=e))}_updateChildrenView(e){const t=this.children;t&&t.forEach((t=>t.view=e))}_createChildren(e){const{listModeDisabled:t,children:i}=this,s=e.filter((e=>!i.some((t=>t.layer===e))));i.addMany(this._createChildItems(s,t))}_destroyChildren(e){const{children:t}=this,i=t.filter((t=>!!t.layer&&!e.includes(t.layer)));t.destroyMany(i)}_sortChildren(e){this.children.sort(((t,i)=>e.indexOf(i.layer)-e.indexOf(t.layer)))}_destroyAllChildren(){this.removeHandles(x),this.children.destroyAll()}_watchChildLayerListMode(e){this.removeHandles(x),this.listModeDisabled||this.addHandles(e.toArray().map((t=>(0,a.wB)((()=>t.listMode),(()=>this._compileChildren(e))))),x)}_compileChildren(e){const t=this.listModeDisabled?e:e?.filter((e=>"hide"!==(0,v.Qv)(e)));e?.length?(this._createChildren(t),this._destroyChildren(t),this._sortChildren(t),this._watchChildLayerListMode(e)):this._destroyAllChildren()}_watchSublayerChanges(e){e&&this.addHandles(e.on("change",(()=>this._compileChildren(e))),A)}_initializeChildLayers(e){this._compileChildren(e),this._watchSublayerChanges(e)}_createChildItems(e,t){return e.reverse().map((e=>t||(0,v.oU)(e)?new S({layer:e,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,parent:this,view:this.view}):null)).filter(o.Ru)}_watchLayerProperties(e){if(this.removeHandles(A),this.removeHandles(x),!e)return;if("hide-children"===(!this.listModeDisabled&&(0,v.Qv)(e)))return void this.children.destroyAll();const t=(0,v.oZ)(e);t&&this.addHandles((0,a.wB)((()=>e[t]),(i=>{e.hasOwnProperty(t)&&this._initializeChildLayers(i)}),a.Vh),A)}};(0,s._)([(0,c.MZ)({type:I})],C.prototype,"actionsSections",void 0),(0,s._)([(0,c.MZ)()],C.prototype,"actionsOpen",void 0),(0,s._)([(0,c.MZ)()],C.prototype,"checkPublishStatusEnabled",void 0),(0,s._)([(0,c.MZ)({type:n.A.ofType(C)})],C.prototype,"children",void 0),(0,s._)([(0,c.MZ)()],C.prototype,"childrenSortable",void 0),(0,s._)([(0,c.MZ)({readOnly:!0})],C.prototype,"connectionStatus",null),(0,s._)([(0,c.MZ)({readOnly:!0})],C.prototype,"error",null),(0,s._)([(0,c.MZ)()],C.prototype,"hidden",void 0),(0,s._)([(0,c.MZ)({readOnly:!0})],C.prototype,"incompatible",null),(0,s._)([(0,c.MZ)()],C.prototype,"layer",void 0),(0,s._)([(0,c.MZ)({readOnly:!0})],C.prototype,"layerView",null),(0,s._)([(0,c.MZ)()],C.prototype,"listItemCreatedFunction",void 0),(0,s._)([(0,c.MZ)({nonNullable:!0})],C.prototype,"listModeDisabled",void 0),(0,s._)([(0,c.MZ)()],C.prototype,"open",void 0),(0,s._)([(0,c.MZ)({type:M})],C.prototype,"panel",null),(0,s._)([(0,u.w)("panel")],C.prototype,"castPanel",null),(0,s._)([(0,c.MZ)()],C.prototype,"parent",void 0),(0,s._)([(0,c.MZ)({value:!0})],C.prototype,"sortable",null),(0,s._)([(0,c.MZ)()],C.prototype,"title",null),(0,s._)([(0,c.MZ)({readOnly:!0})],C.prototype,"publishing",null),(0,s._)([(0,c.MZ)({readOnly:!0})],C.prototype,"updating",null),(0,s._)([(0,c.MZ)()],C.prototype,"view",void 0),(0,s._)([(0,c.MZ)()],C.prototype,"visible",null),(0,s._)([(0,c.MZ)({readOnly:!0})],C.prototype,"visibleAtCurrentScale",null),(0,s._)([(0,c.MZ)({readOnly:!0})],C.prototype,"visibleAtCurrentTimeExtent",null),(0,s._)([(0,c.MZ)({readOnly:!0})],C.prototype,"visibilityMode",null),C=S=(0,s._)([(0,d.$)("esri.widgets.LayerList.ListItem")],C);const T=C},45937:(e,t,i)=>{i.d(t,{ES:()=>b,GB:()=>_,Gq:()=>M,MN:()=>S,Mq:()=>a,Qv:()=>c,Vq:()=>I,Yl:()=>u,_L:()=>h,cR:()=>l,cg:()=>n,dL:()=>y,do:()=>L,dv:()=>r,eF:()=>g,eY:()=>d,ep:()=>o,kL:()=>v,mk:()=>f,oU:()=>m,oZ:()=>p});const s={hide:"hide",hideChildren:"hide-children"},r=10,o=2;function n({exclusive:e,visible:t,visibilityAppearance:i}){const s="checkbox"===i;return t?e?"circle-f":s?"check-square-f":"view-visible":e?"circle":s?"square":"view-hide"}function l({connectionStatus:e,publishing:t}){return e?"connected"===e?"beacon":"offline":t?"square":"bullet-point"}function a(e){return e?.listMode===s.hideChildren}function c(e){return e?.listMode??void 0}function u(e){if(!e)return"inherited";const t=function(e){const t=w(e);return null!=t&&"supportsSublayerVisibility"in t?t.supportsSublayerVisibility:void 0}(_(e)?e.layer:e);return null!=t?t?"independent":"inherited":"visibilityMode"in e&&null!=e.visibilityMode?e.visibilityMode:"independent"}function d(e){e?.removeMany(e.filter((e=>e?.destroyed)))}function p(e){if(e&&(!("type"in e)||"wmts"!==e.type))return"sublayers"in e?"sublayers":"layers"in e?"layers":void 0}function h(e,t){e&&(e.filterPredicate=t?e=>t(M(e)):void 0)}function y(e){const t=(e?.layer&&_(e.layer)?e.layer.layer:void 0)??e?.layer;return!!t&&"catalog"!==t.type&&(function(e){const t=w(e);return null!=t&&"supportsDynamicLayers"in t?t.supportsDynamicLayers:void 0}(t)??!0)}function m(e){return c(e)!==s.hide}function g(e,t){if(!e||null==t||isNaN(t))return!1;const i=function(e){return null!=e&&"minScale"in e&&null!=e.minScale?e.minScale:void 0}(e),s=function(e){return null!=e&&"maxScale"in e&&null!=e.maxScale?e.maxScale:void 0}(e),r=null!=i&&!isNaN(i)&&i>0&&t>i,o=null!=s&&!isNaN(s)&&s>0&&t<s;return r||o}function f(e,t){e?.sort(((e,i)=>{const s="uid"in e?t.indexOf(e.uid):-1,r="uid"in i?t.indexOf(i.uid):-1;return s>r?-1:s<r?1:0}))}function v(e,t){const i=e?.layer;if(!i)return;const s=p(i);if(!s)return;let r;"layers"===s&&"layers"in i?r=i.layers:"sublayers"===s&&"sublayers"in i&&(r=i.sublayers),f(r,t)}function b(e){const t=e?.layer;return t&&"layers"in t?t.layers:null}function _(e){return null!=e&&"layer"in e&&null!=e.layer}function w(e){return e&&"capabilities"in e&&null!=e.capabilities&&"exportMap"in e.capabilities?e.capabilities.exportMap:void 0}function M(e){return e?.["data-item"]}function S(e){return e?.getAttribute("data-layer-type")}function L(e){const{children:t,error:i}=e,s="incompatible"in e&&e.incompatible;return!!t?.filter((e=>!e.hidden)).length&&!i&&!s}function I(e){for(const t of e)for(const e of t)if("button"===e.type||"toggle"===e.type)return e}},34692:(e,t,i)=>{i.d(t,{default:()=>Ht});var s=i(66866),r=i(85251),o=i(21564),n=i(4130),l=i(39831),a=(i(9272),i(63863)),c=i(46928),u=(i(17791),i(52495)),d=i(48982),p=i(539),h=i(45066),y=i(12712),m=i(96220),g=i(28830),f=i(86394),v=i(85569),b=i(59851),_=i(92504),w=i(40189),M=i(89882),S=i(76859),L=i(20909),I=i(94255),A=i(57079),x=i(27664),C=i(6117),T=i(10109),E=i(42453),F=i(40454),R=i(22036),Z=i(48887),O=i(72973),P=i(63926),k=i(82140),D=i(98549),N=i(68882),$=i(23369),V=i(77573),B=i(88148),j=i(73532),G=i(42624),z=i(55056);var K=i(26943),U=i(70218),q=i(22428),H=i(57081),W=i(29934),J=(i(76459),i(46930));i(79581);var Q=i(15131),Y=i(48187);const X=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,ee=new b.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),te=new $.A({size:6,outline:{color:[128,128,128,.5],width:.5}}),ie=new N.A({style:"solid"});function se(e){return"flow"===e.type}function re(e){return"vector-field"===e.type}function oe(e){return"raster-colormap"===e.type}function ne(e){return"raster-stretch"===e.type}function le(e){return"raster-shaded-relief"===e.type}function ae(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function ce(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function ue(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function de(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function pe(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function he(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function ye(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function me(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function ge(e){return"esri.renderers.PieChartRenderer"===e.declaredClass}function fe(e){return"esri.layers.SubtypeGroupLayer"===e.declaredClass}function ve(e){return"esri.layers.MapImageLayer"===e.declaredClass}function be(e){return"esri.layers.TileLayer"===e.declaredClass}function _e(e){return"esri.layers.ImageryLayer"===e.declaredClass}function we(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}function Me(e){return"sublayers"in e}function Se(e){return e&&"symbol"in e}async function Le(e,t){const i=await(0,Q.ud)("esri/widgets/Legend/t9n/Legend");return"previewTemplateAriaLabel"!==e||t||(e="previewAriaLabel"),(0,Y.V)(i[e],{label:t})}const Ie=new $.A({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let Ae={},xe=class extends u.A{constructor(e){super(e),this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this._layerDefinitionExpression=null,this._layerDefinitionExpressionClause=null,this._layerDisplayFilterId=null,this._layerDisplayFilterClause=null,this.children=new d.A,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerDefinitionExpression=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this.addHandles([(0,r.on)((()=>this.children),"change",(t=>{const{added:i,removed:s}=t;i.forEach((t=>{const i=`activeLayerInfo-ready-watcher-${t.layer.uid}`;this.addHandles((0,r.wB)((()=>t.ready),e,r.Vh),i)})),s.forEach((e=>this.removeHandles(e.layer.uid))),e()}))]),this.keepCacheOnDestroy||(Ae={})}destroy(){this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(Ae=null),this._layerDefinitionExpressionClause=null}get effectList(){const e=this.layer;let t=null;return"effect"in e&&e.effect&&(t=new A.$B,t.effect=e.effect,t.endTransition(),t.scale=this.scale),t}get opacity(){const e=this.layer.opacity,t=this.parent?.opacity,i=this.layer.parent,s=i&&"uid"in i?this._getParentLayerOpacity(i):null;return null!=t?t*e:null!=s?s*e:e}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view?.scale??0}get isScaleDriven(){const e=this.layer;if(null===e)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if("cluster"===e.featureReduction.type)return!0;if("binning"===e.featureReduction.type&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?!!("displayFilterInfo"in e&&e.displayFilterInfo&&ue(e.renderer))||this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(this.hideLayersNotInCurrentView&&!await this._isLayerInCurrentView())return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,(e=>{if((0,F.yZ)(e))return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet?.features.length){const t=e.layerDefinition,i=t?.drawingInfo,s=i&&(0,Z.r)(i.renderer),r=ee.read(t.geometryType);return s?this._getRendererLegendElements(s,{title:e.name,geometryType:r}):(p.A.getLogger(this).warn("drawingInfo not available!"),null)}return null}));try{const e=[],i=await Promise.allSettled(t);for(const t of i)if("fulfilled"===t.status)for(const i of t.value??[])e.push(i);this.legendElements=e,this.notifyChange("ready")}catch(i){p.A.getLogger(this).warn("error while building legend for layer!",i)}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(t){p.A.getLogger(this).warn("error while building legend for layer!",t)}}async buildLegendElementsForFeatureReduction(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getLegendElementsForFeatureReduction(e):[],this.notifyChange("ready")}catch(t){p.A.getLogger(this).warn("error while building legend for layer!",t)}}async buildLegendElementsForTools(){const e=this.layer;if(function(e){return"esri.layers.VoxelLayer"===e.declaredClass}(e))this._constructLegendElementsForVoxelLayer();else if(function(e){return"esri.layers.WMTSLayer"===e.declaredClass}(e))this._constructLegendElementsForWMTSlayer();else if(function(e){return"esri.layers.WMSLayer"===e.declaredClass}(e))await this._constructLegendElementsForWMSSublayers();else if(function(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}(e))await this._constructLegendElementsForBuildingSceneLayer();else if(ve(e)||be(e)||fe(e))await this._constructLegendElementsForSublayers();else{this.removeHandles("imageryLayers-watcher");let t="default";if(_e(e)){const i=e;t=(i?.rasterFunction?.functionName||"default")+"_"+(e.bandIds?.length?e.bandIds.join(""):"###")}if(we(e)||"link-chart"===e.type)return;await this._getLegendLayers(`${e.uid}-${t}`).then((async t=>{this.legendElements=[],this.notifyChange("ready");const i=t.map((async t=>{if(_e(e)){const t=(0,r.wB)((()=>[e.rasterFunction,e.bandIds]),(()=>(0,w.sg)((async()=>{Ae.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()}))()));this.addHandles(t,"imageryLayers-watcher")}const i=this._generateSymbolTableElementForLegendLayer(t);i?.infos.length&&(_e(e)&&(i.title=e.title),this.legendElements.push(i)),this.notifyChange("ready")}));await Promise.allSettled(i)})).catch((e=>{p.A.getLogger(this).warn("Request to server for legend has failed!",e)}))}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,i=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!(i||t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;await(0,r.C_)((()=>!t.updating));const s=i?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return!s||(s.geometry=this.view.extent,0!==(i?"queryFeatureCount"in t&&await t.queryFeatureCount(s):"queryFeatureCount"in e&&await e.queryFeatureCount(s)))}_getParentLayerOpacity(e){let t=1;const i=e.parent;return i&&"uid"in i&&(t=this._getParentLayerOpacity(i)),e.opacity*t}_isGroupActive(){return this.children.some((e=>e.ready))}_isRendererScaleDriven(e){if("dot-density"===e.type)return!0;const t="valueExpression"in e?e.valueExpression:null;if(X.test(t))return!0;const i="visualVariables"in e?e.visualVariables:null;return!!i?.some((e=>this._isScaleDrivenSizeVariable(e)))||this._hasScaleDrivenSymbols(e)}_hasScaleDrivenSymbols(e){switch(e.type){case"simple":return this._isScaleDrivenSymbol(e.symbol);case"class-breaks":return this._isScaleDrivenSymbol(e.defaultSymbol)||e.classBreakInfos.some((e=>this._isScaleDrivenSymbol(e.symbol)));case"unique-value":return this._isScaleDrivenSymbol(e.defaultSymbol)||!!e.uniqueValueInfos?.some((e=>this._isScaleDrivenSymbol(e.symbol)))}return!1}_isScaleDrivenSymbol(e){if("cim"===e?.type){const{primitiveOverrides:t,minScale:i,maxScale:s}=e.data,r=t?.some((e=>/\$view\.scale/.test(e.valueExpressionInfo?.expression||"")))??!1;return null!=i||null!=s||r}return!1}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return!1;const t=e,i=t.minSize,s=t.maxSize;return!("object"!=typeof i||!i||!this._isScaleDrivenSizeVariable(i))||!("object"!=typeof s||!s||!this._isScaleDrivenSizeVariable(s))||X.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((e=>this._isLayerScaleDriven(e)));const t=e.parent;if(!1===e.loaded&&t&&ve(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const i of t.sourceJSON.layers??[])if(i.id===e.source.mapLayerId&&(i.minScale>0||i.maxScale>0))return!0;return!1}async _constructLegendElementsForVoxelLayer(){this.legendElements=[],this.removeHandles("voxel-style-watcher"),this.removeHandles("voxel-current-variable");const e=this.layer;this.addHandles((0,r.wB)((()=>e.currentVariableId),(()=>this._constructLegendElementsForVoxelLayer())),"voxel-current-variable"),this.addHandles((0,r.wB)((()=>e.getVariableStyles()),(()=>this._constructLegendElementsForVoxelLayer())),"voxel-style-watcher");const t=e.getVariableStyle(null),i=[];if(t)if(t.uniqueValues?.length){const e=[];t.uniqueValues.forEach((t=>{t.enabled&&e.push({label:t.label||`${t.value}`,value:t.value,symbol:new N.A({color:t.color,outline:null})})})),e.length&&i.push({type:"symbol-table",title:t.label,infos:e})}else if(t.transferFunction){const{colorStops:e,stretchRange:s}=t.transferFunction,r=e.toArray().reverse(),o=s.map(((e,t)=>`${0===t?W.l5:W.kC} ${function(e){const t=Math.floor(Math.log10(Math.abs(e)))+1,i=t<4||t>6?4:t,s=Math.abs(e)>=1e6?"compact":"standard";return(0,J.ZV)(e,{notation:s,minimumSignificantDigits:2,maximumSignificantDigits:i})}(e)}`)).reverse(),n=r.map((e=>({color:e.color,value:null,label:null})));n[0].label=o[0],n[n.length-1].label=o[1],i.push({type:"color-ramp",title:t.label,infos:n,preview:(0,G.J0)(r.map((e=>e.color)),{ariaLabel:await Le("previewColorRampAriaLabel")})})}await this._generatePreviewsForLegendElements(i,{opacity:e.opacity}),this.legendElements=i,this.notifyChange("ready")}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this.removeHandles("wmts-activeLayer-watcher");const e=this.layer.activeLayer;this.addHandles((0,r.wB)((()=>{const{layer:e}=this;return e&&"activeLayer"in e&&e.activeLayer}),(()=>this._constructLegendElementsForWMTSlayer())),"wmts-activeLayer-watcher");const t=e.styleId?e.styles?.find((({id:t})=>t===e.styleId))?.legendUrl:void 0;t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}]),this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this.removeHandles("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this.addHandles((0,r.wB)((()=>{const{layer:e}=this;return e&&"sublayers"in e&&e.sublayers}),(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const i=this.layer,s=[];this.addHandles(e.on("change",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher");const o=this.sublayerIds?.map((e=>i.findSublayerById(e)))?.filter(v.Ru)??[],n=o.length?o:e.toArray();for(const l of n){const e=(0,r.wB)((()=>[l.title,l.visible,l.legendEnabled]),(()=>this._constructLegendElementsForWMSSublayers()));if(this.addHandles(e,"wms-sublayers-watcher"),!this.respectLayerVisibility||l.visible&&l.legendEnabled){const e=await this._generateSymbolTableElementForWMSSublayer(l,t);e?.infos.length&&s.unshift(e)}}return s}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const i=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter((e=>e));return{type:"symbol-table",title:e.title,infos:i}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){let i=e.legendUrl;if(!i)return;const s={type:"symbol-table",title:e.title||e.name||String(e.id??""),infos:[]};t&&(i=(0,L.a6)(i,t));let r=null;const o=e.layer?.opacity;try{r=(await(0,f.A)(i,{responseType:"image"})).data,r&&(r.style.opacity=o)}catch{}return s.infos.push({src:i,preview:r,opacity:o}),s}_getLegendLayers(e,t){const i=Ae&&Ae[e];return i?Promise.resolve(i):this._legendRequest(t).then((t=>{const i=t.layers;return Ae[e]=i,i}))}_legendRequest(e){const t=this.layer;let i={f:"json",dynamicLayers:e};if(_e(t)){const e=t.exportImageServiceParameters.rasterFunction;if(e&&(i.renderingRule=JSON.stringify(e.functionDefinition?.toJSON()||e.toJSON())),t.bandIds&&(i.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:e,viewId:s,customParameters:r}=t;i={raster:e,viewId:s,...i,...r}}}let s=t.url.replace(/(\/)+$/,"");if("version"in t&&+t.version>=10.01){const e=s.indexOf("?");e>-1?s=s.slice(0,e)+"/legend"+s.slice(e):s+="/legend"}else{const e=s.toLowerCase().indexOf("/rest/"),t=-1===e?s:s.slice(0,e)+s.slice(e+5);s="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(t)+"&returnbytes=true"}return(0,f.A)(s,{query:i}).then((e=>e.data))}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this.removeHandles("sublayers-watcher");const e=this.layer;this.addHandles((0,r.wB)((()=>e.sublayers),(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){p.A.getLogger(this).warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForBuildingSublayers(e,t){let i=[];this.addHandles(e.on("change",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");const s=e.toArray();for(const o of s){const e=(0,r.wB)((()=>["renderer"in o&&o.renderer,o.opacity,o.title,o.visible]),(()=>this._constructLegendElementsForBuildingSceneLayer()));if(this.addHandles(e,"sublayers-watcher"),!this.respectLayerVisibility||o.visible){const e=null!=o?.opacity?o.opacity:null,s=null!=e?e*t:t;if("building-group"===o.type){const e={type:"symbol-table",title:o.title,infos:[]},t=await this._generateLegendElementsForBuildingSublayers(o.sublayers,s);e.infos.push(...t),i=[e,...i]}else o.renderer&&(i=[...await this._getRendererLegendElements(o.renderer,{title:o.title,opacity:s,sublayer:o}),...i])}}return i.filter((e=>!!e&&(!("infos"in e)||!e.infos||e.infos.length>0)))}async _constructLegendElementsForSublayers(){this.legendElements=[],this.removeHandles("sublayers-watcher");const e=this.layer;if(ve(e)||be(e)||fe(e)){this.addHandles((0,r.wB)((()=>e.sublayers),(()=>this._constructLegendElementsForSublayers)),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){p.A.getLogger(this).warn("Request to server for legend has failed!",t)}}}async _generateLegendElementsForSublayers(e,t,i){const s=this.layer;let o=[];this.addHandles(e.on("change",(()=>this._constructLegendElementsForSublayers())),"sublayers-watcher");let n=e.toArray();!i&&this.sublayerIds&&this.sublayerIds.length&&(n=fe(s)?this.sublayerIds.map((e=>s.findSublayerForSubtypeCode(e))).filter(v.Ru):this.sublayerIds.map((e=>s.findSublayerById(e))).filter(v.Ru));for(const l of n){const e=(0,r.wB)((()=>[l.renderer,l.opacity,l.title,l.visible,l.legendEnabled]),(()=>this._constructLegendElementsForSublayers()));if(this.addHandles(e,"sublayers-watcher"),!this.respectLayerVisibility||l.visible&&l.legendEnabled&&this._isSublayerInScale(l)){const e=null!=l?.opacity?l.opacity:null,s=null!=e?e*t:t,r=!Me(l)||l.originIdOf("renderer")>I.Gr.SERVICE&&!l.sublayers;if(l.renderer&&r)await l.load(),o=[...await this._getRendererLegendElements(l.renderer,{title:l.title,opacity:s,sublayer:l}),...o];else if(Me(l)){const e=await this._generateSymbolTableElementForSublayer(l,s,i);e&&o.unshift(e)}}}return o.filter((e=>!!e&&(!("infos"in e)||!e.infos||e.infos.length>0)))}async _generateSymbolTableElementForSublayer(e,t,i){if(!i){i=new Map;const t=this.layer,s=e.source;let r=null;if(s&&("map-layer"!==s.type||s.mapLayerId!==e.id||s.gdbVersion&&s.gdbVersion!==("gdbVersion"in t&&t.gdbVersion))||e.originIdOf("renderer")>I.Gr.SERVICE||e.originIdOf("labelingInfo")>I.Gr.SERVICE||e.originIdOf("labelsVisible")>I.Gr.SERVICE){const e=new T.g({layer:this.layer});r=e.hasDynamicLayers?e.dynamicLayers:null,e.destroy()}const o=r||`${t.uid}-default`;(await this._getLegendLayers(o,r)).forEach((e=>i.set(e.layerId,e)))}const s=i.get(e.id);if((!s||s?.subLayerIds&&s.defaultVisibility)&&e.sublayers){const s=await this._generateLegendElementsForSublayers(e.sublayers,t,i);return{type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendLayer(s,e,t)}_generateSymbolTableElementForLegendLayer(e,t,i){if(!e?.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const s=t?.renderer;let r=t?.title||e.layerName;if(s&&(!t||t?.originIdOf("renderer")>I.Gr.SERVICE)){const e=t?.title||this._getRendererTitle(s,t);e&&(r&&"string"!=typeof e&&"title"in e&&(e.title=r),r=e)}const o={type:"symbol-table",title:r,legendType:e.legendType||null,infos:[]},n=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return e.legendGroups&&e.legendGroups.length>0?e.legendGroups.forEach((t=>{const s={type:"symbol-table",title:t.heading,legendType:e.legendType||null,infos:this._generateSymbolTableElementInfosForLegendLayer(n.filter((e=>e.groupId===t.id)),e.layerId,i)};s.infos?.length>0&&o.infos.push(s)})):o.infos=this._generateSymbolTableElementInfosForLegendLayer(n,e.layerId,i),o.infos.length>0?o:null}_generateSymbolTableElementInfosForLegendLayer(e,t,i){return e.map((e=>{let s=e.url;if(e.imageData&&e.imageData.length>0)s=`data:image/png;base64,${e.imageData}`;else{if(0===s.indexOf("http"))return null;s=(0,g.Y3)(`${this.layer.url}/${t}/images/${s}`)}return{label:e.label,src:s,opacity:i??this.opacity,width:e.width,height:e.height}})).filter(v.Ru)}_isSublayerInScale(e){const t=e.minScale||0,i=e.maxScale||0;return!(t>0&&t<this.scale||i>this.scale)}_isLegendLayerInScale(e,t){const i=t||this.layer;let s=null,r=null,o=!0;return!i.minScale&&0!==i.minScale||!i.maxScale&&0!==i.maxScale?(0===e.minScale&&i.tileInfo&&(s=i.tileInfo.lods[0].scale),0===e.maxScale&&i.tileInfo&&(r=i.tileInfo.lods[i.tileInfo.lods.length-1].scale)):(s=Math.min(i.minScale,e.minScale)||i.minScale||e.minScale,r=Math.max(i.maxScale,e.maxScale)),(s>0&&s<this.scale||r>this.scale)&&(o=!1),o}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&+this.layer.version<10.1||0===e.length)return e;const i=t.renderer,s=e.some((e=>e.values));let r=0,o=null;return s&&e.some(((e,t)=>(e.values||(r=t,o=e,o.label||(o.label="others")),null!=o))),i?"unique-value"===i.type?o&&(e.splice(r,1),e.push(o)):"class-breaks"===i.type&&(o&&e.splice(r,1),i.legendOptions?.order||e.reverse(),o&&e.push(o)):o&&(e.splice(r,1),e.push(o)),e}async _getRendererLegendElements(e,t={}){if(!function(e,t){return ae(e)||ce(e)||ue(e)||de(e)||me(e)||ge(e)?"2d"===t.type||(0,O.l)(e):ne(e)||oe(e)||le(e)||pe(e)||he(e)||ye(e)||re(e)||se(e)}(e,this.view))return p.A.getLogger(this).warn(`Renderer of type '${e.type}' not supported!`),[];if(function(e){return pe(e)||he(e)||ye(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}(e))return this._constructPointCloudRendererLegendElements(e,t);if(me(e))return this._constructDotDensityRendererLegendElements(e);const i=await this._loadRenderer(e);return ge(i)?this._constructPieChartRendererLegendElements(i):this._constructRendererLegendElements(i,t)}async _getLegendElementsForFeatureReduction(e){let t=null;return"binning"===e.type?t=e.renderer:"cluster"===e.type&&(t=this._getClusterRenderer(e)),t?this._getRendererLegendElements(t):[]}_getPointCloudRendererTitle(e){return(e.legendOptions?.title||e.field)??""}async _constructPointCloudRendererLegendElements(e,t={}){const i=t.title,s=[];let r=null,o=null;if(pe(e))r={type:"symbol-table",title:i||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((e=>{r.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(te,e.color)})}));else if(he(e)){const t=e.stops;let s=null;if(t?.length&&(1===t.length&&(s=t[0].color),!s)){const e=t[0].value,i=t[t.length-1].value;null!=e&&null!=i&&(s=(0,K.G9)(e+(i-e)/2,t))}r={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(te,s||te.color)}]};const n=(0,K.y0)(e.stops??[])??[];o={type:"color-ramp",title:i||this._getPointCloudRendererTitle(e),infos:n,preview:(0,G.J0)(n.map((e=>e.color)),{ariaLabel:await Le("previewColorRampAriaLabel")})}}else ye(e)&&(r={type:"symbol-table",title:i||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos?.forEach((e=>{r.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(te,e.color)})})));return r?.infos.length&&s.push(r),o?.infos.length&&s.push(o),await this._generatePreviewsForLegendElements(s,{opacity:this.opacity,symbolConfig:{applyColorModulation:!!e.colorModulation}}),s}async _getElementInfoForDotDensity(e,t){const{color:i,label:s,valueExpressionTitle:r}=t,{backgroundColor:o,outline:n,dotSize:l}=e,a=this.effectList,c=a?.effects.map((e=>e.toJSON())),u=(0,x.zu)(c),d=await Le("previewTemplateAriaLabel",s||r),p=l+"-"+i+"-"+o+"-"+(n&&JSON.stringify(n.toJSON()))+"-"+u,h=this._dotDensityUrlCache,y=h.has(p)?h.get(p):(0,G.xg)(e,i,{ariaLabel:d});h.set(p,y);const m={shape:{type:"image",x:0,y:0,width:y.width,height:y.height,src:y.src},fill:null,stroke:null,offset:[0,0]},g=(0,j.fz)([[m]],[y.width,y.height],{effectView:this.effectList,ariaLabel:d});return{opacity:1,src:y.src,preview:g,width:y.width,height:y.height}}async _constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),i=e.legendOptions?.unit,s={type:"symbol-table",title:{value:t&&Math.round(t),unit:i||""},infos:[]};for(const r of e.attributes){const t=await this._getElementInfoForDotDensity(e,r);t.label=r.label||r.valueExpressionTitle||r.field,s.infos.push(t)}return[s]}async _constructPieChartRendererLegendElements(e){const t=[];let i=null;const s=e.outline;e.attributes.forEach((e=>{const i=new $.A({color:e.color,outline:s}),r=e.label||e.valueExpressionTitle||e.field;t.push({label:r,symbol:i})}));const r=t.length?[...t]:[];if(e.othersCategory?.color&&0!==e.othersCategory?.threshold){const r=new $.A({color:e.othersCategory.color,outline:s});i=e.othersCategory.label||"Other",t.push({label:i,symbol:r})}if(e.defaultColor?.a){const i=new $.A({color:e.defaultColor,outline:s});t.push({label:e.defaultLabel,symbol:i})}const o=await this._getVisualVariableLegendElements(e,this.layer)||[];if(t.length){o.unshift({type:"symbol-table",title:null,infos:t});const n=r.filter((e=>e.label!==i)).map((e=>e.symbol.color)).filter(Boolean),l=(0,G.es)(n,{holePercentage:e.holePercentage,backgroundColor:e.backgroundFillSymbol?.color,effectList:this.effectList,outline:s,ariaLabel:await Le("previewPieChartAriaLabel")});o.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:t,preview:l})}return await this._generatePreviewsForLegendElements(o,{opacity:this.layer.opacity,effectView:this.effectList}),o}async _getWhereClause(e,t,i){const s=await(0,S.GP)(e,i),r=new Set,{field:o,field2:n,field3:l}=t;(0,E._w)(r,i,[o,n,l]),(0,E.Dx)(r,i,t.valueExpression);const a=new Set(Array.from(r,(e=>e.toLowerCase()))),c=s?.fieldNames.map((e=>e.toLowerCase()));return c?.some((e=>!a.has(e)))?null:s}async _processDefinitionExpression(e,t){if(!("definitionExpression"in e))return;const i=e.definitionExpression;i&&this.respectLayerDefinitionExpression?this._layerDefinitionExpression!==i&&(this._layerDefinitionExpressionClause=await this._getWhereClause(i,t,e.fieldsIndex)):this._layerDefinitionExpressionClause=null,this._layerDefinitionExpression=i}async _processDisplayFilter(e,t){if(!("displayFilterInfo"in e))return;const i=e.displayFilterInfo?(0,C.u2)(e.displayFilterInfo,this.view):null;return i?.where?this._layerDisplayFilterId!==i?.id&&(this._layerDisplayFilterClause=await this._getWhereClause(i.where,t,e.fieldsIndex)):this._layerDisplayFilterClause=null,this._layerDisplayFilterId=i?.id,i}async _constructRendererLegendElements(e,t={}){const{title:i,sublayer:s}=t,r=s||this.layer,o=(0,W.iz)(e,"reference-size"),n=(0,W.iz)(e,"spike");let l=null;ue(e)&&(await this._processDefinitionExpression(r,e),l=await this._processDisplayFilter(r,e)),this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const a=await this._getVisualVariableLegendElements(e,r)||[],c={type:"symbol-table",title:i||this._getRendererTitle(e,r),infos:[]};let u=null,d=!1;const p=new Set;if(se(e)&&!this._hasSizeRamp){const t=await(0,W.Zo)(e);c.infos.push({label:null,symbol:t})}else if(function(e){const t="authoringInfo"in e?e?.authoringInfo:null;return"univariate-color-size"===t?.type}(e)){let t=i;const s=function(e){const t="authoringInfo"in e?e?.authoringInfo:null;return"univariate-color-size"===t?.type&&"above-and-below"===t?.univariateTheme}(e)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",r=a.findIndex((e=>"color-ramp"===e.type)),o=-1!==r?a.splice(r,1)[0]:null,n=a.findIndex((e=>"size-ramp"===e.type)),l=-1!==n?a.splice(n,1)[0]:null,c=[];o&&(t=o.title,c.push(o)),l&&(t=l.title,c.push(l)),c.length>0&&a.push({type:s,title:t,infos:c})}else if(de(e)){const t=(0,U.Y)(e);a.push({type:"heatmap-ramp",title:i||this._getRendererTitle(e,r),infos:t,preview:(0,G.J0)(t.map((e=>e.color)),{effectList:this.effectList,ariaLabel:await Le("previewColorRampAriaLabel")})})}else if(ue(e)){const t=e.authoringInfo;if(t&&"relationship"===t.type){const{numClasses:i,field1:s,field2:o}=t,n=t.focus;if(i&&s&&o){const t=[s,o];let l=(0,q.zv)(n)||0;for(const e of t){const{field:t,normalizationField:i,label:s}=e,o=s||{field:this._getFieldAlias(t,r),normField:i&&this._getFieldAlias(i,r)},n=Ie.clone();n.angle=l,c.infos.push({label:o,symbol:n}),p.add(n),l+=90}const u=(0,q.Jr)({focus:n,numClasses:i,infos:e.uniqueValueInfos??[]});a.unshift(u)}}else if(_e(this.layer)||we(this.layer))e.uniqueValueInfos?.forEach((t=>{t.symbol&&this._checkClausesForUVR(e,t.value)&&c.infos.push({label:t.label||t.value,value:t.value,symbol:t.symbol})}));else{const{field:t,field2:s,field3:n,fieldDelimiter:a,valueExpression:u,defaultSymbol:p}=e,h=!(!t&&!u||!s&&!n),y=this._layerDisplayFilterClause?l?.title:null,m=[];if(e.uniqueValueGroups?.forEach((i=>{const l={type:"symbol-table",title:y||i.heading,infos:[]};i.classes?.forEach((i=>{const{symbol:c,values:d}=i;if(c){const p=[],y=[];for(const e of d??[]){const{value:i,value2:o,value3:l}=e,c=[],d=[];(t||u)&&(c.push(i),d.push(this._getDomainName(t,i,r))),s&&(c.push(o),d.push(this._getDomainName(s,o,r))),n&&(c.push(l),d.push(this._getDomainName(n,l,r))),p.push(h?c.join(a||""):c[0]),y.push(d.join(" - "))}const m=p.join(", ");let g=i.label;if(!g){const e=y.filter(Boolean);g=e.length?e.join(", "):m}const f=c.clone();"cim"===f.type&&o&&(0,D.oz)(f,{innerDotSize:8,outerRingSize:16}),p.some((t=>this._checkClausesForUVR(e,t)))&&l.infos.push({label:g,value:m,symbol:f})}})),l.infos.length&&m.push(l)})),m.length){const t=m[0];if(1===m.length&&"title"in t&&!t.title){const e=t.infos?.filter(Se)??[];c.infos.push(...e)}else p&&(m.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:p}]}),d=!0),c.infos.push(...m);i||e.legendOptions?.title||e.valueExpressionTitle||(c.title=null)}}e.defaultSymbol&&!d&&(c.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),d=!0)}else if(ce(e)){if(!o&&!n){if(u=this._isUnclassedRenderer(e),!u||!this._hasSizeRamp){const t=e.classBreakInfos.filter((({symbol:e})=>e)),i="ascending-values"===e.legendOptions?.order;for(const{label:e,minValue:s,maxValue:r,symbol:o}of t){const t={label:e||(u?null:`${s} - ${r}`),value:[s,r],symbol:o};i?c.infos.push(t):c.infos.unshift(t)}u&&(c.title=null),this._updateInfosForClassedSizeRenderer(e,c.infos)}e.defaultSymbol&&!u&&(c.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),d=!0)}}else if(ne(e))if(we(this.layer)||function(e){return"esri.layers.WCSLayer"===e.declaredClass}(this.layer)){const t=await this._constructTileImageryStretchRendererElements(e);!function(e){return"stretch-ramp"===e.type}(t)?c.infos=t:a.push(t)}else{const t=this.layer;let i,s;e.customStatistics?.length&&({min:i,max:s}=e.customStatistics[0]);let r=[],o=t.serviceRasterInfo;if(t.rasterFunction)try{o=await t.generateRasterInfo(t.rasterFunction)}catch{}const n=(0,R.hP)(o.pixelType);if(1===o.bandCount){const r=t.bandIds?.[0]||0;i=null!=i?i:o.statistics?o.statistics[r].min:n[0],s=null!=s?s:o.statistics?o.statistics[r].max:n[1],i||s?a.push(await this._getStretchLegendElements(e,{min:i,max:s})):this._getServerSideLegend()}else if(t.bandIds&&1===t.bandIds.length)i=null!=i?i:o.statistics?o.statistics[t.bandIds[0]].min:n[0],s=null!=s?s:o.statistics?o.statistics[t.bandIds[0]].max:n[1],i||s?a.push(await this._getStretchLegendElements(e,{min:i,max:s})):this._getServerSideLegend();else if(o.bandCount>=3){const{bandInfos:e}=o,{bandIds:i}=t;e.length>=o.bandCount?3===i?.length?(r=i.map((t=>e[t].name)),c.infos=this._createSymbolTableElementMultiBand(r)):"lerc"===t.format?(r=[0,1,2].map((t=>e[t].name)),c.infos=this._createSymbolTableElementMultiBand(r)):this._getServerSideLegend():"lerc"===t.format?(r=["band1","band2","band3"],c.infos=this._createSymbolTableElementMultiBand(r)):this._getServerSideLegend()}else this._getServerSideLegend()}else if(oe(e))e.colormapInfos.forEach((e=>{c.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(ie,e.color)})}));else if(ae(e)){let i=e.symbol;switch(t.geometryType){case"point":i="pointSymbol"in r?r.pointSymbol:null;break;case"polyline":i="lineSymbol"in r?r.lineSymbol:null;break;case"polygon":i="polygonSymbol"in r?r.polygonSymbol:null}const s=this._hasClusterSizeVariable&&this._getClusterSymbol()||!this._hasSizeRamp;e.symbol&&s&&c.infos.push({label:e.label,symbol:i})}else if(re(e)){e.outputUnit&&(this.title="("+e.toJSON().outputUnit+")"),c.title=e.attributeField;const t=e.getClassBreakInfos();t?.length?t.forEach((e=>{c.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):c.infos.push({label:e.attributeField,symbol:e.getDefaultSymbol()})}else le(e)&&a.push(await this._getStretchLegendElements(e,{min:0,max:255}));const h=e.defaultSymbol;!h||d||ae(e)||u&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||a.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:h}]}),c.infos.length&&a.unshift(c);const y=null==t.opacity?this.opacity:t.opacity,m=this._isTallSymbol("visualVariables"in e?e.visualVariables:null),g=_e(this.layer)||we(this.layer);return await this._generatePreviewsForLegendElements(a,{opacity:y,symbolConfig:{isTall:m,isSquareFill:g},effectView:this.effectList},{defaultSymbol:h,arrowMarkerSymbols:p}),e=null,a}_checkClausesForUVR(e,t){const i=function(e,t){const{field:i,field2:s,field3:r,fieldDelimiter:o,valueExpression:n}=e;if(!i)return null;const l=(i||n)&&(s||r)?t?.toString().split(o||""):[t],a=i?{[i]:l?.[0]}:null;return a&&(s&&(a[s]=l?.[1]),r&&(a[r]=l?.[2])),a}(e,t);return!i||(!this._layerDefinitionExpressionClause||this._layerDefinitionExpressionClause.testFeature(i))&&(!this._layerDisplayFilterClause||this._layerDisplayFilterClause.testFeature(i))}_getServerSideLegend(){setTimeout((()=>this.buildLegendElementsForTools()),0)}_getAllInfos(e){const t=e?.infos;return t?t.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]):[e]}async _constructTileImageryStretchRendererElements(e){const t=this.layer,i=t.symbolizer.rasterInfo??t.raster.rasterInfo;let s,r;const o=e?.customStatistics?.length?e.customStatistics:i?.statistics;if(o)({min:s,max:r}=o[0]);else{const e=(0,R.hP)(i.pixelType);s=e[0],r=e[1]}if(t.hasStandardTime()&&(s=t.getStandardTimeValue(s),r=t.getStandardTimeValue(r)),1===i.bandCount||1===t.bandIds?.length)return this._getStretchLegendElements(e,{min:s,max:r});const n=(t?.bandIds?.length?t.bandIds:Array.from(Array(Math.min(i.bandCount,3)).keys())).map((e=>i.bandInfos[e].name));return n.length<3?n.push(n[1]):n.length>3&&n.splice(3),this._createSymbolTableElementMultiBand(n)}async _getStretchLegendElements(e,t){const i=e.colorRamp,s=(0,K.vt)(i,t);return{type:"stretch-ramp",title:"",infos:s,preview:(0,G.J0)(s.map((e=>e.color)),{ariaLabel:await Le("previewColorRampAriaLabel")})}}_getClusterSymbol(){const e=this.layer,t="featureReduction"in e&&e.featureReduction,i=t&&"symbol"in t&&t.renderer;return i&&!0!==i?.authoringInfo?.isAutoGenerated?null:t&&"symbol"in t?t.symbol:null}async _getSizeLegendElement(e,t,i,s){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:await(0,H.getRampStops)(i,t,await(0,W.uM)(i),this.scale,this.view,s,this._hasClusterSizeVariable?this._getClusterSymbol():null)}}_createSymbolTableElementMultiBand(e){const t=[],i=["red","green","blue"];return e.forEach(((e,s)=>{t.push({label:{colorName:i[s],bandName:e},src:W.E2[s],opacity:this.opacity??1})})),t}_updateInfosForClassedSizeRenderer(e,t){const i=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,s=e.classBreakInfos.some((e=>(0,z.$d)(e.symbol)));if(i&&s){const i=H.mh,s=H.OE,r=e.classBreakInfos.length,o=(i-s)/(r>1?r-1:r);t.forEach(((e,t)=>{e.size=i-o*t}))}}_isTallSymbol(e){let t=!1,i=!1;if(e)for(let s=0;s<e.length&&(!t||!i);s++){const r=e[s];"size"===r.type&&("height"===r.axis&&(t=!0),"width-and-depth"===r.axis&&(i=!0))}return t&&i}async _generatePreviewsForLegendElements(e,t,i){const s=[];for(const r of e)for(const e of r.infos??[])if("infos"in e&&e.infos&&s.push(this._generatePreviewsForLegendElements([e],t,i)),Se(e)&&e.symbol&&!e.preview){let o=!0;if("cim"===e.symbol.type){const{minScale:t,maxScale:i}=e.symbol.data;(t&&t<this.scale||i&&i>this.scale)&&(o=!1)}o&&s.push(this._generateSymbolPreviewForInfo(e,{...t,clipBloomEffect:"theme"in r&&"spike"===r.theme,effectView:i?.arrowMarkerSymbols?.has(e.symbol)?null:t.effectView},i?{isDefault:e.symbol===i.defaultSymbol,applyScaleDrivenSize:!i.arrowMarkerSymbols?.has(e.symbol)}:void 0))}await Promise.all(s)}async _generateSymbolPreviewForInfo(e,t,s){try{let r=!s?.isDefault&&null==e.size&&this._hasSizeRamp?(0,M.PN)(B.CB.size):e.size;if(this._scaleDrivenSizeVariable&&s?.applyScaleDrivenSize){const{getSize:t}=await Promise.resolve().then(i.bind(i,28479));r=t(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null})}const o="cim"===e.symbol.type?{style:"legend",cimOptions:{allowScalingUp:!s?.isDefault&&this._hasSizeRamp||!(!this._scaleDrivenSizeVariable||!s?.applyScaleDrivenSize),viewParams:this.isScaleDriven?{viewingMode:"2d"===this.view?.type?"map":this.view?.viewingMode,scale:this.view?.scale}:null}}:{},n=e.label&&"string"!=typeof e.label?null:await Le("previewTemplateAriaLabel",e.label);e.preview=await(0,G.Gr)(e.symbol,{size:r,scale:!1,ariaLabel:n,...t,...o})}catch{e.preview=null,p.A.getLogger(this).warn(`Generating symbol preview failed for symbol type: ${e.symbol?.type}`)}}_getClusterRenderer(e){this._hasClusterSizeVariable=!1;const t="renderer"in this.layer?this.layer.renderer:null,i=e.renderer?.clone()||t?.clone(),s=function(e,t,i){const s=e.effectiveClusterRenderer;if(!s||!("visualVariables"in s)||!s.visualVariables)return null;const r=s.visualVariables.find((e=>"size"===e.type));if(!("stops"in r)||!r.stops)return null;const o=r.stops.find((e=>e.useMinValue)),n=r.stops.find((e=>e.useMaxValue));if(null==o||null==n)return null;const l=i.featuresTilingScheme.getClosestInfoForScale(i.scale).level,a=r.field,c=t.getDisplayStatistics(l,a);return c?new P.A({field:r.field,minSize:e.clusterMinSize,minDataValue:c.minValue,maxSize:e.clusterMaxSize,maxDataValue:c.maxValue}):null}(e,this.layerView,this.view);if(s&&null!=i&&"visualVariables"in i){const t=i.visualVariables?.some((e=>"size"===e.type&&"outline"!==e.target&&!X.test(e.valueExpression)));if(!t){if("clusterMinSize"in e&&"clusterMaxSize"in e){const{clusterMinSize:t,clusterMaxSize:i}=e;s.legendOptions=new k.A({showLegend:t!==i})}const t=i.visualVariables||[];i.visualVariables=t.concat([s]),this._hasClusterSizeVariable=!0}}return i}async _loadRenderer(e){const t=[],i=e.clone(),s=await(0,W.uM)(i);if(ce(i)||ue(i)){const e=(i.classBreakInfos||i.uniqueValueInfos).map((e=>this._fetchSymbol(e.symbol,s).then((t=>{e.symbol=t})).catch((()=>{e.symbol=null}))));Array.prototype.push.apply(t,e)}return t.push(this._fetchSymbol(i.symbol||i.defaultSymbol,i.defaultSymbol?null:s).then((e=>{this._applySymbolToRenderer(i,e,ae(i))})).catch((()=>{this._applySymbolToRenderer(i,null,ae(i))}))),await Promise.allSettled(t),i}_applySymbolToRenderer(e,t,i){i?e.symbol=t:e.defaultSymbol=t}async _fetchSymbol(e,t){if(!e)throw new Error;if("web-style"===e.type){const i=this._webStyleSymbolCache;try{const s=await e.fetchSymbol({cache:i});return this._getAppliedCloneSymbol(s,t)}catch{throw p.A.getLogger(this).warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;const i=e.clone(),s=t&&t.toRgba();return i.type.includes("3d")?this._applyColorTo3dSymbol(i,s):"cim"===i.type?(0,V.Fe)(i,t):i.color&&(i.color=new m.A(s||i.color)),i}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach((e=>{e&&(e.material||(e.material={}),e.material.color=new m.A(t))}))}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||"vector-field"===e.type)return null;const i=e.visualVariables??[],s=[],r=[],o=[],n=(0,W.iz)(e,"reference-size")??(0,W.iz)(e,"spike");let l;if(2===n?.sizeStops?.length&&(ce(e)||ue(e))){const[e,t]=n.sizeStops;l=new P.A({field:n.field??void 0,normalizationField:n.normalizationField,minSize:(0,_.qE)(e.size,10,100),maxSize:(0,_.qE)(t.size,50,150),minDataValue:e.value,maxDataValue:t.value}),r.push(l)}for(const p of i)"color"===p.type?s.push(p):"size"===p.type?r.push(p):"opacity"===p.type&&o.push(p);const a=[...s,...r,...o];let c,u;if(0===s.length&&ce(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];c=t&&t.symbol}if(0===s.length&&ae(e)&&(c=e.symbol),c)if(c.type.includes("3d")){const e=c.symbolLayers.at(0);"water"===e.type?null!=e.color&&(u=e.color):null!=e.material?.color&&(u=e.material.color)}else c.url||(u=c.color);const d=this.effectList;return(await Promise.all(a.map((async i=>{if(!i.legendOptions||!1!==i.legendOptions.showLegend){const s=se(e)?i.field:this._getRampTitle(i,t);let r=null;const o=(0,W.getDateFormatOptions)(t,i,this.view.timeZone);if("color"===i.type){const e=await(0,K.getRampStops)(i,null,o)??[];r={type:"color-ramp",title:s,infos:e,preview:(0,G.J0)(e.map((e=>e.color)),{effectList:d,ariaLabel:await Le("previewColorRampAriaLabel")})},this._hasColorRamp||(this._hasColorRamp=e.length>0)}else if("size"===i.type&&"outline"!==i.target)X.test(i.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=i):(r=await this._getSizeLegendElement(s,i,e,o),l===i&&"spike"===n?.theme&&(r.theme=n.theme),this._hasSizeRamp||(this._hasSizeRamp=!(null==r.infos||!r.infos.length)));else if("opacity"===i.type){const e=await(0,K.getRampStops)(i,u,o)??[];r={type:"opacity-ramp",title:s,infos:e,preview:(0,G.J0)(e.map((e=>e.color)),{effectList:d,ariaLabel:await Le("previewColorRampAriaLabel")})},this._hasOpacityRamp||(this._hasOpacityRamp=e.length>0)}return r?.infos?r:null}})))).filter(v.Ru)}_getDomainName(e,t,i){if(e&&"function"!=typeof e){const s="getField"in i&&i.getField?.(e),r=s&&"getFieldDomain"in i&&i.getFieldDomain?i.getFieldDomain(s.name,{excludeImpliedDomains:(0,l.A)("esri-widget-legacy-field-domain-calculation")}):null;return"coded-value"===r?.type?r.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,i=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,s="popupTemplate"in e&&e.popupTemplate,r=s&&s.fieldInfos;if(r)for(const t of r)if(t.fieldName===i)return"cluster_count"===i?t.label||{showCount:!0}:t.label}return{showCount:!0}}_getRampTitle(e,t){let i=e.field,s=e.normalizationField,r=!1,o=!1,n=!1,l=null;i="function"==typeof i?null:i,s="function"==typeof s?null:s;const a=e.legendOptions?.title;if(null!=a)l=a;else if(e.valueExpressionTitle)l=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo?.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const i=e[t];if("color"===i.type){if("ratio"===i.style){r=!0;break}if("percent"===i.style){o=!0;break}if("percent-of-total"===i.style){n=!0;break}}}}l={field:i&&this._getFieldAlias(i,t),normField:s&&this._getFieldAlias(s,t),ratio:r,ratioPercent:o,ratioPercentTotal:n}}return l}_getRendererTitle(e,t){const i=e;if(i.legendOptions?.title)return i.legendOptions.title;if(i.valueExpressionTitle)return i.valueExpressionTitle;let s=i.field,r=null,o=null;if(ce(i)&&(r=i.normalizationField,o="percent-of-total"===i.normalizationType),s="function"==typeof s?null:s,r="function"==typeof r?null:r,ue(i)){const{field2:e,field3:r,fieldDelimiter:o}=i;let n=s&&this._getFieldAlias(s,t);return e&&(n=`<${n}>${o}<${this._getFieldAlias(e,t)}>`,r&&(n=`${n}${o}<${this._getFieldAlias(r,t)}>`)),n}let n=null;return(s||r)&&(n={field:s&&this._getFieldAlias(s,t),normField:r&&this._getFieldAlias(r,t),normByPct:o}),n}_getFieldAlias(e,t){const i="popupTemplate"in t?t.popupTemplate:null,s=i?.fieldInfos;let r=s?.find((t=>e===t.fieldName)),o=null;"getField"in t&&t.getField?o=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(o=t.fieldsIndex.get(e));let n=null;const l="featureReduction"in t&&t.featureReduction;l&&(r??="popupTemplate"in l?l.popupTemplate?.fieldInfos?.find((t=>e?.toLowerCase()===t.fieldName?.toLowerCase())):void 0,"fields"in l&&l.fields&&(n=l.fields.find((t=>t.name?.toLowerCase()===e?.toLowerCase()))));const a=r||o||n;let c=null;return a&&(c=r?.label||o?.alias||n?.alias||"name"in a&&a.name||"fieldName"in a&&a.fieldName||null),c}_isUnclassedRenderer(e){const t=e.visualVariables;let i=!1;return ce(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(i=e.field?t.some((t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField))):!!t.length),i}};(0,s._)([(0,o.MZ)()],xe.prototype,"children",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],xe.prototype,"effectList",null),(0,s._)([(0,o.MZ)()],xe.prototype,"layerView",void 0),(0,s._)([(0,o.MZ)()],xe.prototype,"layer",void 0),(0,s._)([(0,o.MZ)()],xe.prototype,"legendElements",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],xe.prototype,"opacity",null),(0,s._)([(0,o.MZ)()],xe.prototype,"parent",void 0),(0,s._)([(0,o.MZ)({readOnly:!0,dependsOn:[]})],xe.prototype,"ready",null),(0,s._)([(0,o.MZ)()],xe.prototype,"hideLayersNotInCurrentView",void 0),(0,s._)([(0,o.MZ)()],xe.prototype,"keepCacheOnDestroy",void 0),(0,s._)([(0,o.MZ)()],xe.prototype,"respectLayerDefinitionExpression",void 0),(0,s._)([(0,o.MZ)()],xe.prototype,"respectLayerVisibility",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],xe.prototype,"scale",null),(0,s._)([(0,o.MZ)()],xe.prototype,"sublayerIds",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],xe.prototype,"isScaleDriven",null),(0,s._)([(0,o.MZ)()],xe.prototype,"title",void 0),(0,s._)([(0,o.MZ)({readOnly:!0,dependsOn:["ready"],value:0})],xe.prototype,"version",null),(0,s._)([(0,o.MZ)()],xe.prototype,"view",void 0),xe=(0,s._)([(0,a.$)("esri.widgets.Legend.support.ActiveLayerInfo")],xe);var Ce=i(91109);const Te="state",Ee="view",Fe="all-layer-views",Re="legend-properties",Ze=d.A.ofType(xe),Oe=new Set(["esri.layers.BuildingSceneLayer","esri.layers.CatalogLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.OrientedImageryLayer","esri.layers.ParquetLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.SubtypeGroupLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer","esri.layers.LinkChartLayer","esri.layers.catalog.CatalogFootprintLayer","esri.layers.catalog.CatalogDynamicGroupLayer","esri.layers.knowledgeGraph.KnowledgeGraphSublayer","esri.layers.KnowledgeGraphLayer"]),Pe="view.basemapView.baseLayerViews",ke="view.groundView.layerViews",De="view.basemapView.referenceLayerViews",Ne=[Pe,ke,"view.layerViews",De];let $e=class extends u.A{constructor(e){super(e),this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new d.A,this.activeLayerInfos=new Ze,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerDefinitionExpression=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this.addHandles((0,r.wB)((()=>this.view),(()=>this._viewHandles()),r.Vh),Ee),this.addHandles((0,Ce.oQ)((()=>this._refresh())))}destroy(){this._destroyViewActiveLayerInfos(),this.view=null}get state(){return this.view?.ready?"ready":"disabled"}_viewHandles(){this.removeHandles(Te),this.view&&this.addHandles((0,r.wB)((()=>this.state),(()=>this._stateHandles()),r.Vh),Te)}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this.removeHandles([Fe,Re]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this.removeHandles(e);const t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t?.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){const{view:e}=this;if(!e)return;const{allLayerViews:t}=e;t.length&&this._refresh(),this.addHandles(t.on("change",(e=>this._allLayerViewsChangeHandle(e))),Fe),this.addHandles((0,r.wB)((()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible]),(()=>this._propertiesChangeHandle())),Re)}_allLayerViewsChangeHandle(e){e.moved.length?this._propertiesChangeHandle():(e.removed.forEach((e=>this._destroyViewActiveLayerInfo(e.uid))),this._refresh())}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){const t=this.view;if(e.length<2||!t)return;const i=[];e.forEach((t=>{if(!t.parent){const s=t.layer.parent,r=s&&"uid"in s&&this._layerViewByLayerId[s.uid],o=r&&this._activeLayerInfosByLayerViewId[r.uid];o&&e.includes(o)&&(i.push(t),t.parent=o,o.children.add(t),this._sortActiveLayerInfos(o.children))}})),e.removeMany(i);const s={};t.allLayerViews.forEach(((e,t)=>s[e.layer.uid]=t)),e.sort(((e,t)=>{const i=s[e.layer.uid]||0;return(s[t.layer.uid]||0)-i}))}_generateLayerViews(){const e=[];return Ne.filter(this._filterLayerViews,this).map((e=>(0,h.Jt)(this,e))).filter((e=>null!=e)).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const t=!this.basemapLegendVisible&&(e===Pe||e===De),i=!this.groundLegendVisible&&e===ke;return!t&&!i}_collectLayerViews(e,t){const i=s=>(s&&s.forEach((s=>{t.push(s),i(s[e])})),t);return i}_filterLayerViewsByLayerInfos(e){const t=this.layerInfos;return!t||!t.length||t.some((t=>this._hasLayerInfo(t,e)))}_hasLayerInfo(e,t){const i=this._isLayerUIDMatching(e.layer,t.layer.uid);return i&&(this._layerInfosByLayerViewId[t.uid]=e),i}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some((e=>this._isLayerUIDMatching(e,t)))}_isLayerViewSupported(e){return!!Oe.has(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this.removeHandles(e.uid),this.addHandles((0,r.wB)((()=>[e.legendEnabled,e.layer?.legendEnabled]),(()=>this._layerActiveHandle(e))),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this.removeHandles(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.layer?.legendEnabled}_buildActiveLayerInfo(e){const t=e.layer,i=e.uid,s=this._layerInfosByLayerViewId[i];let o=this._activeLayerInfosByLayerViewId[i];if(!o){const r=void 0!==s?.title&&s.layer.uid===t.uid;o=new xe({layer:t,layerView:e,title:r?s.title:t.title,view:this.view??void 0,respectLayerDefinitionExpression:this.respectLayerDefinitionExpression,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:s?.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=o}const n=t.parent&&"uid"in t.parent?this._layerViewByLayerId[t.parent?.uid]:null;if(o.parent=this._activeLayerInfosByLayerViewId[n?.uid],!this.hasHandles(i)){const s=[(0,r.wB)((()=>t.title),(e=>this._titleHandle(e,o))),(0,r.wB)((()=>[t.opacity,"renderer"in t&&t.renderer,"pointSymbol"in t&&t.pointSymbol,"lineSymbol"in t&&t.lineSymbol,"polygonSymbol"in t&&t.polygonSymbol]),(()=>this._constructLegendElements(o))),(0,r.z7)((()=>!0===this.view?.stationary),(()=>this._scaleHandle(o)),r.Vh),(0,r.wB)((()=>e.layer?(0,y.n)(e.layer,e.view):null),(()=>this._constructLegendElements(o))),(0,r.wB)((()=>e.updating),(()=>{null!=e.layer&&null!=(0,y.n)(e.layer,e.view)&&this._constructLegendElements(o)})),(0,r.wB)((()=>"effect"in t&&t.effect),(()=>this._constructLegendElements(o))),(0,r.z7)((()=>this.view?.timeZone),(()=>this._constructLegendElements(o)),r.Vh)];if(this.respectLayerVisibility){const i=(0,r.wB)((()=>e.legendEnabled),(e=>this._legendEnabledHandle(e,o))),n=(0,r.wB)((()=>t.legendEnabled),(e=>this._legendEnabledHandle(e,o)));s.push(i,n)}if(this.respectLayerDefinitionExpression&&"definitionExpression"in t){const e=(0,r.wB)((()=>[t.definitionExpression,this.respectLayerDefinitionExpression]),(()=>{o.respectLayerDefinitionExpression=this.respectLayerDefinitionExpression,this._constructLegendElements(o)}));s.push(e)}this.addHandles(s,i)}o.isScaleDriven||this._constructLegendElements(o),this._addActiveLayerInfo(o)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){const{layerView:t,layer:i}=e;if(this._isLayerActive(t)&&!this.activeLayerInfos.includes(e)){const t=e.parent;if(t)t.children.includes(e)||t.children.push(e),this._sortActiveLayerInfos(t.children);else{const t=this.layerInfos?.some((e=>e.layer.uid===i.uid)),s=i.parent;s&&"uid"in s&&this._layerViewByLayerId[s.uid]&&!t?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach((t=>{const i=t.layer.parent,s=i&&"uid"in i?this._layerViewByLayerId[i?.uid]:null,r=this._activeLayerInfosByLayerViewId[s?.uid];r&&(e.push(t),t.parent=r)})),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach((e=>this._addActiveLayerInfo(e))))}}}_removeActiveLayerInfo(e){const t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){const t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"featureReduction"in t&&t.featureReduction&&"renderer"in t.featureReduction&&("binning"===t.featureReduction.type||"cluster"===t.featureReduction.type)&&(!this.view||t.featureReduction.maxScale<=this.view.scale)?e.buildLegendElementsForFeatureReduction(t.featureReduction):"renderer"in t&&t.renderer&&!("sublayers"in t)?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url&&"catalog"!==t.type&&"knowledge-graph"!==t.type?e.buildLegendElementsForTools():e.children.forEach((e=>this._constructLegendElements(e)))}};(0,s._)([(0,o.MZ)({type:Ze})],$e.prototype,"activeLayerInfos",void 0),(0,s._)([(0,o.MZ)()],$e.prototype,"basemapLegendVisible",void 0),(0,s._)([(0,o.MZ)()],$e.prototype,"groundLegendVisible",void 0),(0,s._)([(0,o.MZ)()],$e.prototype,"hideLayersNotInCurrentView",void 0),(0,s._)([(0,o.MZ)()],$e.prototype,"keepCacheOnDestroy",void 0),(0,s._)([(0,o.MZ)()],$e.prototype,"respectLayerDefinitionExpression",void 0),(0,s._)([(0,o.MZ)()],$e.prototype,"respectLayerVisibility",void 0),(0,s._)([(0,o.MZ)()],$e.prototype,"layerInfos",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],$e.prototype,"state",null),(0,s._)([(0,o.MZ)()],$e.prototype,"view",void 0),$e=(0,s._)([(0,a.$)("esri.widgets.Legend.LegendViewModel")],$e);const Ve="esri-legend--card",Be="esri-legend",je={activated:`${Ve}__carousel-indicator--activated`,base:Ve,stacked:`${Be}--stacked`,carouselTitle:`${Ve}__carousel-title`,indicator:`${Ve}__carousel-indicator`,intervalSeparator:`${Ve}__interval-separator`,imageryLayerStretchedImage:`${Ve}__imagery-layer-image--stretched`,imageLabel:`${Ve}__image-label`,layerCaption:`${Ve}__layer-caption`,labelElement:`${Ve}__label-element`,layerRow:`${Ve}__layer-row`,labelCell:`${Ve}__label-cell`,message:`${Ve}__message`,rampLabel:`${Ve}__ramp-label`,section:`${Ve}__section`,relationshipSection:`${Ve}__relationship-section`,serviceCaptionText:`${Ve}__service-caption-text`,serviceContent:`${Ve}__service-content`,service:`${Ve}__service`,groupLayer:`${Ve}__group-layer`,groupLayerChild:`${Ve}__group-layer-child`,symbol:`${Ve}__symbol`,sizeRampRow:`${Ve}__size-ramp-row`,symbolRow:`${Ve}__symbol-row`,symbolCell:`${Ve}__symbol-cell`,carousel:`${Ve}__carousel`,carouselItem:`${Ve}__carousel-item`,indicatorContainer:`${Ve}__carousel-indicator-container`,intervalSeparatorsContainer:`${Ve}__interval-separators-container`,relationshipLabelContainer:`${Ve}__relationship-label-container`,labelContainer:`${Ve}__label-container`,serviceCaptionContainer:`${Ve}__service-caption-container`,symbolContainer:`${Ve}__symbol-container`,colorRampContainer:`${Ve}__color-ramp-container`,sizeRampContainer:`${Ve}__size-ramp-container`,sizeRampPreview:`${Ve}__size-ramp-preview`,pieChartRampPreview:`${Ve}__pie-chart-ramp-preview`,rampContainer:`${Be}__ramps`,sizeRampHorizontal:`${Be}__size-ramp--horizontal`,rampLabelsContainer:`${Be}__ramp-labels`,layerInfo:`${Be}__layer-cell ${Be}__layer-cell--info`,univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card"};var Ge=i(28930),ze=i(96274);function Ke(e){e.appendChild(this)}function Ue(e,t,i){if(!t)return;if("number"==typeof t)return t;if("string"==typeof t)return(0,ze._e)(t);if("value"in t||"unit"in t)return(0,Y.V)(e.dotValue,t);if("colorName"in t&&"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:void 0;let s=null;return function(e,t){return t}(0,i)?s=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:qe(t,i)&&(s=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),s?(0,Y.V)("showField"===s?"{field}":e[s],{field:t.field,normField:t.normField}):void 0}function qe(e,t){return!t}function He(e,t){return!!(t&&"Stretched"===t&&"version"in e&&"number"==typeof e.version&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}function We(e,t,i){switch(t){case"heatmap-ramp":return i[e.label]||e.label;case"stretch-ramp":return function(e,t){return e.label?t[e.label]+": "+("string"==typeof e.value?e.value:(0,J.ZV)(e.value??0,{style:"decimal",notation:e.value?.toString().toLowerCase().includes("e")?"scientific":"standard"})):""}(e,i);default:return e.label}}function Je(e,t){if(!e.title||"string"==typeof e.title)return e.title;const i="color-ramp"===e.type||"opacity-ramp"===e.type,s=e.title,r=Ue(t,s,i);return qe(0,i)&&s.title?`${s.title} (${r})`:r}function Qe(e){return!(!e||"object"!=typeof e)}var Ye=i(99484),Xe=i(96704);let et=class extends c.A{constructor(e,t){super(e,t),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const e=this.legendElement.infos.slice().reverse();return(0,Xe.K)("div",{class:this.classes(je.layerRow,je.colorRampContainer)},this._renderRampLabel(e[0]),(0,Xe.K)("div",{class:je.symbolContainer},this._renderPreview(e),this._renderMiddleStopRampLabel(e)),this._renderRampLabel(e.at(-1)))}_renderPreview(e){const{opacity:t}=this,i="heatmap-ramp"===this.legendElement.type,s=e.length-1,r=25,o=s>2&&!i?25*s:100,n=o+20,l=10,a=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:e[0].color,stroke:{width:0}},{shape:{type:"rect",x:l,y:0,width:o,height:r},fill:{type:"linear",x1:l,y1:0,x2:o+l,y2:0,colors:e.map(((e,t)=>({color:e.color,offset:i&&"ratio"in e?e.ratio:t/s})))},stroke:{width:0}},{shape:{type:"path",path:`M${o+l} 0 L${n} 12.5 L${o+l} 25 Z`},fill:e[e.length-1].color,stroke:{width:0}}]],c=(0,Ge.d8)(a,n,r),u={filter:(0,z.di)(this.effectList)??void 0,opacity:null==t?void 0:`${t}`};return(0,Xe.K)("div",{styles:u},c)}_renderMiddleStopRampLabel(e){const t=e.length%2!=0?e[e.length/2|0]:null;return t?(0,Xe.K)("div",{class:je.intervalSeparatorsContainer},(0,Xe.K)("div",{class:je.intervalSeparator},"|"),this._renderRampLabel(t)):null}_renderRampLabel(e){return(0,Xe.K)("div",{class:je.rampLabel},We(e,this.legendElement.type,this.messages))}};(0,s._)([(0,o.MZ)()],et.prototype,"effectList",void 0),(0,s._)([(0,o.MZ)()],et.prototype,"legendElement",void 0),(0,s._)([(0,o.MZ)()],et.prototype,"messages",void 0),(0,s._)([(0,o.MZ)()],et.prototype,"opacity",void 0),et=(0,s._)([(0,a.$)("esri.widgets.Legend.styles.card.ColorRamp")],et);const tt="#ddd",it=window.devicePixelRatio,st="esri-spike-ramp",rt={spikeRampContainer:`${st}__container`,spikeRampPreviewContainer:`${st}__preview-container`,spikeRampPreview:`${st}__preview`,spikeRampSymbolPreview:`${st}__symbol-preview`,spikeRampLines:`${st}__lines`,spikeRampLabelsContainer:`${st}__labels-container`,spikeRampLabel:`${st}__label`};function ot(e){return 5!==e.infos.length?null:(0,Xe.K)("div",{class:rt.spikeRampContainer},(0,Xe.K)("div",{class:rt.spikeRampPreviewContainer},function(e){const[t,i,s]=nt(e).map((({preview:e})=>{if(!e)return null;const t=e.cloneNode(!0);return t.classList.add(rt.spikeRampSymbolPreview),t}));return t&&i&&s?(0,Xe.K)("div",{class:rt.spikeRampPreview},(0,Xe.K)("div",{afterCreate:Ke,bind:s}),(0,Xe.K)("div",{afterCreate:Ke,bind:i}),(0,Xe.K)("div",{afterCreate:Ke,bind:t})):null}(e),function(e){const[{width:t,height:i},{width:s},{width:r,height:o}]=nt(e).map((({size:e})=>Qe(e)?{width:(0,M.Lz)(e.width),height:(0,M.Lz)(e.height)}:{width:0,height:0})),n=10,l=8,a=t+s+r+3*n,c=i,u=document.createElement("canvas");u.width=(a+n)*it,u.height=c*it,u.style.width=u.width/it+"px",u.style.height=u.height/it+"px";const d=u.getContext("2d");d.beginPath();const p=a-(t/2+n),h=0,y=a+l,m=0;d.moveTo(p*it,h*it),d.lineTo(y*it,m*it);const g=(a-l)/2,f=(i-o)/2,v=a+l,b=(i-o)/2;d.moveTo(g*it,f*it),d.lineTo(v*it,b*it);const _=r/2,w=c-o,S=a+l,L=c-o;return d.moveTo(_*it,w*it),d.lineTo(S*it,L*it),d.strokeStyle=tt,d.lineWidth=.5*it,d.stroke(),(0,Xe.K)("div",{afterCreate:Ke,bind:u,class:rt.spikeRampLines})}(e)),function(e){const[{label:t,height:i},{label:s},{label:r,height:o}]=nt(e).map((({label:e,size:t})=>({label:e,height:Qe(t)?(0,M.Lz)(t.height):0}))),n=i-o,l={position:"absolute",top:"0"},a={position:"absolute",top:n/2+"px"},c={position:"absolute",top:`${n}px`};return(0,Xe.K)("div",{class:rt.spikeRampLabelsContainer},(0,Xe.K)("div",{class:rt.spikeRampLabel,styles:l},t),(0,Xe.K)("div",{class:rt.spikeRampLabel,styles:a},s),(0,Xe.K)("div",{class:rt.spikeRampLabel,styles:c},r))}(e))}function nt(e){return e.infos.filter(((e,t)=>t%2==0))}const lt=window.devicePixelRatio;let at=class extends c.A{constructor(e,t){super(e,t),this.hasIndicators=!1,this.legendElement=null,this.opacity=1}render(){if("spike"===this.legendElement.theme)return(0,Xe.K)("div",{styles:{display:"flex",flex:"1",justifyContent:"center"}},ot(this.legendElement));const{legendElement:e,hasIndicators:t,opacity:i}=this,s=e.infos,r=s.at(0),o=s.at(-1);if(!r||!o)return null;const{label:n,...l}=r,{label:a,...c}=o;let u=l.preview,d=c.preview;const p={"flex-direction":t?"column":"row-reverse"};if(!u||!d)return null;u=u.cloneNode(!0),u.style.display="flex",d=d.cloneNode(!0),d.style.display="flex";const h={opacity:`${i??""}`};return(0,Xe.K)("div",{class:this.classes(je.layerRow,{[je.sizeRampRow]:t})},(0,Xe.K)("div",{class:je.rampLabel},t?n:a),(0,Xe.K)("div",{class:je.sizeRampContainer,styles:p},(0,Xe.K)("div",{afterCreate:Ke,bind:u,class:je.sizeRampPreview,styles:h}),this._renderSizeRampLines(e),(0,Xe.K)("div",{afterCreate:Ke,bind:d,class:je.sizeRampPreview,styles:h})),(0,Xe.K)("div",{class:je.rampLabel},t?a:n))}_renderSizeRampLines(e){const t=e.infos,i=t.at(0),s=t.at(-1);if(!i||!s)return null;const r=i.symbol,o=this.hasIndicators,n=i.size&&"number"==typeof i.size?i.size:0,l=s.size&&"number"==typeof s.size?s.size:0,a=i.outlineSize||0,c=s.outlineSize||0,u=(0,M.Lz)(n+a)*lt,d=(0,M.Lz)(l+c)*lt,p=o?u:u+50*lt,h=o?u/2+50*lt:u,y=function(e){if(e){if(e.type.includes("3d")){if(!e.symbolLayers?.length)return;const t=e.symbolLayers.at(-1),i=t?.resource?.primitive;return"triangle"===i||"cone"===i||"tetrahedron"===i}return"triangle"===e.style}}(r),m=function(e){if(!e)return;if(e.type.includes("3d")){if(!e.symbolLayers?.length)return;const t=e.symbolLayers.at(-1),i=t.resource?.primitive;return"circle"===i||"cross"===i||"kite"===i||"sphere"===i||"cube"===i||"diamond"===i}const t=e.style;return"circle"===t||"diamond"===t||"cross"===t}(r),g=document.createElement("canvas");g.width=p,g.height=h,g.style.width=g.width/lt+"px",g.style.height=g.height/lt+"px";const f=g.getContext("2d");if(o){f.beginPath();const e=0,t=0,i=p/2-d/2,s=h;f.moveTo(e,t),f.lineTo(i,s);const r=p,o=0,n=p/2+d/2,l=h;f.moveTo(r,o),f.lineTo(n,l)}else{f.beginPath();const e=0,t=h/2-d/2,i=p,s=0;f.moveTo(e,t),f.lineTo(i,s);const r=0,o=h/2+d/2,n=p,l=h;f.moveTo(r,o),f.lineTo(n,l)}return f.strokeStyle="#ddd",f.stroke(),(0,Xe.K)("div",{afterCreate:Ke,bind:g,styles:o?{display:"flex",marginTop:`-${y?0:m?u/2:0}px`,marginBottom:`-${y?d:m?d/2:0}px`}:{display:"flex",marginRight:`-${y?0:m?u/2:0}px`,marginLeft:`-${y?0:m?d/2:0}px`}})}};(0,s._)([(0,o.MZ)()],at.prototype,"hasIndicators",void 0),(0,s._)([(0,o.MZ)()],at.prototype,"legendElement",void 0),(0,s._)([(0,o.MZ)()],at.prototype,"messages",void 0),(0,s._)([(0,o.MZ)()],at.prototype,"opacity",void 0),at=(0,s._)([(0,a.$)("esri.widgets.Legend.styles.card.SizeRamp")],at);i(59078);var ct=i(40067),ut=i(8701);const dt=(0,ct.F)(),pt="esri-univariate-above-and-below-ramp__symbol",ht="esri-legend__color-ramp";function yt(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?(0,Xe.K)("svg",{height:"4",width:"10"},(0,Xe.K)("line",{style:t,x1:"0",x2:"10",y1:"2",y2:"2"})):(0,Xe.K)("svg",{height:"10",width:"10"},(0,Xe.K)("line",{style:t,x1:"5",x2:"5",y1:"0",y2:"10"}))}function mt(e,t="vertical"){const i=document.createElement("div");return i.style.height="20px",i.className=pt,null!=e&&(i.style.opacity=e.toString()),dt.append(i,yt.bind(null,t)),i}function gt(e,t,i="vertical",s){e.infos.forEach(((e,r)=>{if(s&&2===r)e.preview=mt(t,i);else{const t=((0,ut.Et)(e.size)?(0,M.Lz)(e.size):0)+("horizontal"===i?20:10),s=e.preview,r="div"===s?.tagName.toLowerCase(),o=r?s:document.createElement("div");o.className=pt,"horizontal"===i?o.style.width=`${t}px`:o.style.height=`${t}px`,!r&&s&&o.appendChild(s),e.preview=o}}))}function ft(e,t="classic"){const i=e.infos,s=i.at(0),r=i.at(-1),o=(0,ut.Et)(s.size)?(0,M.Lz)(s.size):0,n=(0,ut.Et)(r.size)?(0,M.Lz)(r.size):0;return"classic"===t?(o+10)/2:(o-n)/2}function vt(e,t){if(!e)return null;const i=e.infos.map((e=>e.color)),s=(0,G.J0)("full"===t.type?i:"above"===t.type?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList,ariaLabel:t.ariaLabel});return s.className=ht,null!=t.opacity&&(s.style.opacity=t.opacity.toString()),s}function bt(e,t,i,s="vertical"){let r=0;const o=e.infos,n=Math.floor(o.length/2),l="full"===t||"above"===t?0:n,a="full"===t||"below"===t?o.length-1:n;for(let c=l;c<=a;c++)if(i&&c===n)r+="horizontal"===s?10:20;else{const e=o[c].size;r+=((0,ut.Et)(e)?(0,M.Lz)(e):0)+("horizontal"===s?20:10)}return Math.round(r)}function _t(e,t,i,s="vertical"){const r=bt(e,t,i,s),o=e.infos,n=Math.floor(o.length/2),l="full"===t||"above"===t?0:n,a="full"===t||"below"===t?o.length-1:n,c=(0,ut.Et)(o[l].size)?o[l].size:0,u=(0,ut.Et)(o[a].size)?o[a].size:0,d="full"===t?c+u:"above"===t?c:u,p=i?"vertical"===s?20:10:0,h="vertical"===s?10*("full"===t?2:1):20*("full"===t?2:1);return Math.round(r-((0,M.Lz)(d)/2+p/2+h/2))}function wt(e,t,i="vertical"){const s=e.infos;let r=s.find((({type:e})=>"size-ramp"===e)),o=s.find((({type:e})=>"color-ramp"===e));return r&&(r={...r},r.infos=[...r.infos],gt(r,t,i,!0)),o&&(o={...o},o.infos=[...o.infos]),"horizontal"===i&&(r?.infos.reverse(),o?.infos.reverse()),{sizeRampElement:r,colorRampElement:o}}function Mt(e,t="vertical"){const i=e.infos;let s=i.find((({type:e})=>"size-ramp"===e)),r=i.find((({type:e})=>"color-ramp"===e));return s&&(s={...s},s.infos=[...s.infos],gt(s,null,t,!1)),r&&(r={...r},r.infos=[...r.infos]),"horizontal"===t&&(s?.infos.reverse(),r?.infos.reverse()),{sizeRampElement:s,colorRampElement:r}}const St={marginLeft:"3px"},Lt={display:"table-cell",verticalAlign:"middle"},It={display:"flex",alignItems:"flex-start"};let At=class extends c.A{constructor(e,t){super(e,t),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const{legendElement:e,opacity:t,effectList:i,key:s}=this,{sizeRampElement:r,colorRampElement:o}=wt(e,t,"horizontal");if(!r)return null;const n=bt(r,"full",!0,"horizontal"),l=_t(r,"above",!0,"horizontal"),a=_t(r,"below",!0,"horizontal"),c=this.messages?.previewColorRampAriaLabel,u=vt(o,{width:l,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:i,ariaLabel:c}),d=vt(o,{width:a,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:i,ariaLabel:c}),p=ft(r,"card"),h=r.infos.map((e=>e.label)),y=h.length-1,m=h.map(((e,t)=>0===t||t===y?(0,Xe.K)("div",{key:t},e):null)),g={marginTop:"3px",display:"flex"};(0,Ye.V8)(this.container)?g.marginRight=`${p}px`:g.marginLeft=`${p}px`;const f={width:`${n}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,Xe.K)("div",{class:je.layerRow,key:`${s}-container`,styles:{display:"flex",flexDirection:"column"}},(0,Xe.K)("div",{class:this.classes(je.symbolContainer,je.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},r.infos.map(((e,t)=>(0,Xe.K)("div",{afterCreate:Ke,bind:e.preview,class:je.symbol,key:t})))),u?(0,Xe.K)("div",{class:je.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:g},(0,Xe.K)("div",{afterCreate:Ke,bind:u}),(0,Xe.K)("div",{afterCreate:Ke,bind:d})):null,(0,Xe.K)("div",{class:je.layerInfo},(0,Xe.K)("div",{class:je.rampLabelsContainer,styles:f},m)))}};(0,s._)([(0,o.MZ)()],At.prototype,"effectList",void 0),(0,s._)([(0,o.MZ)()],At.prototype,"legendElement",void 0),(0,s._)([(0,o.MZ)()],At.prototype,"messages",void 0),(0,s._)([(0,o.MZ)()],At.prototype,"opacity",void 0),At=(0,s._)([(0,a.$)("esri.widgets.Legend.styles.card.UnivariateAboveAndBelowRamp")],At);let xt=class extends c.A{constructor(e,t){super(e,t),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const{legendElement:e,opacity:t,effectList:i,key:s}=this,{sizeRampElement:r,colorRampElement:o}=Mt(e,"horizontal");if(!r)return null;const n=bt(r,"full",!1,"horizontal"),l=vt(o,{width:_t(r,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:i,ariaLabel:this.messages?.previewColorRampAriaLabel}),a=ft(r,"card"),c=r.infos.length-1,u=r.infos.map(((e,t)=>0===t||t===c?(0,Xe.K)("div",{key:t},e.label):null)),d={marginTop:"3px",display:"flex"};(0,Ye.V8)(this.container)?d.marginRight=`${a}px`:d.marginLeft=`${a}px`;const p={width:`${n}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,Xe.K)("div",{class:je.layerRow,key:`${s}-container`,styles:{display:"flex",flexDirection:"column"}},(0,Xe.K)("div",{class:this.classes(je.symbolContainer,je.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},r.infos.map(((e,t)=>(0,Xe.K)("div",{afterCreate:Ke,bind:e.preview,class:je.symbol,key:t})))),(0,Xe.K)("div",{class:je.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:d},(0,Xe.K)("div",{afterCreate:Ke,bind:l})),(0,Xe.K)("div",{class:je.layerInfo},(0,Xe.K)("div",{class:je.rampLabelsContainer,styles:p},u)))}};(0,s._)([(0,o.MZ)()],xt.prototype,"effectList",void 0),(0,s._)([(0,o.MZ)()],xt.prototype,"legendElement",void 0),(0,s._)([(0,o.MZ)()],xt.prototype,"messages",void 0),(0,s._)([(0,o.MZ)()],xt.prototype,"opacity",void 0),xt=(0,s._)([(0,a.$)("esri.widgets.Legend.styles.card.UnivariateColorSizeRamp")],xt);var Ct,Tt=i(87638),Et=i(76943);let Ft=Ct=class extends c.A{constructor(e,t){super(e,t),this.effectList=null,this.hasIndicators=!1,this.headingLevel=3,this.isChild=!1,this.legendElement=null}render(){const e=this._renderLegendElement(),t=Je(this.legendElement,this.messages),i=this.hasIndicators&&!this.isChild?(0,Xe.K)("div",null,(0,Xe.K)(Et.D,{class:je.carouselTitle,level:this.headingLevel},this.activeLayerInfo.title),(0,Xe.K)(Et.D,{class:je.layerCaption,level:(0,Et.S)(this.headingLevel)},t)):t?(0,Xe.K)(Et.D,{class:je.layerCaption,level:this.headingLevel},t):null;return(0,Xe.K)("section",{"aria-labelledby":this.key,class:je.section,id:`${this.key}-panel`,key:this.key,role:"tabpanel",tabIndex:0},i,e)}_renderLegendElement(){switch(this.legendElement.type){case"symbol-table":return this._renderSymbolTable(this.legendElement);case"size-ramp":return(0,Xe.K)(at,{hasIndicators:this.hasIndicators,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":return(0,Xe.K)(et,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"relationship-ramp":return(0,Tt.p)(this.legendElement,this.id,{opacity:this.layer.opacity,effectList:this.effectList,ariaLabel:this.messages.previewRelationshipRampAriaLabel,key:this.key});case"pie-chart-ramp":return(0,Xe.K)("div",{afterCreate:Ke,bind:this.legendElement.preview,class:je.pieChartRampPreview,key:`${this.key}-preview`});case"univariate-above-and-below-ramp":return(0,Xe.K)(At,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"univariate-color-size-ramp":return(0,Xe.K)(xt,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});default:return null}}_renderSymbolTable(e){const t=e.infos.map((t=>this._renderElementInfo(t,e.legendType))).filter(Boolean);if(!t.length)return null;const i=this.activeLayerInfo.legendElements.some((({type:e})=>"relationship-ramp"===e)),s=t[0]?.properties?.classes?.[je.symbolRow],r={[je.labelContainer]:!s&&!i,[je.relationshipLabelContainer]:i};return(0,Xe.K)("div",{class:this.classes(r)},t)}_renderElementInfo(e,t){const{layer:i}=this,s="label"in e?e.label:null,r=`${this.key}-${s}`;if("type"in e&&e.type)return(0,Xe.K)(Ct,{activeLayerInfo:this.activeLayerInfo,effectList:this.effectList,hasIndicators:this.hasIndicators,headingLevel:this.headingLevel,isChild:!0,key:r,layer:i,legendElement:e,messages:this.messages});if(!("preview"in e&&e.preview||"src"in e&&e.src))return null;const o=He(i,t),n=Ue(this.messages,s,!1)||"";if("src"in e&&e.src)return(0,Xe.K)("div",{class:je.layerRow,key:`${r}-row`},this._renderImage(e,i,o),(0,Xe.K)("div",{class:je.imageLabel},n));if("symbol"in e&&e.preview){if(!e.symbol?.type.includes("simple-fill")){if(!e.label)return(0,Xe.K)("div",{afterCreate:Ke,bind:e.preview,key:`${r}-row`});const t={[je.symbolCell]:this.hasIndicators};return(0,Xe.K)("div",{class:this.classes(je.layerRow,{[je.symbolRow]:this.hasIndicators}),key:`${r}-row`},(0,Xe.K)("div",{afterCreate:Ke,bind:e.preview,class:this.classes(t)}),(0,Xe.K)("div",{class:this.classes(je.imageLabel,{[je.labelCell]:this.hasIndicators})},n))}return(0,Xe.K)("div",{class:je.layerRow,key:`${r}-row`},(0,Xe.K)("div",{class:je.labelElement,styles:this._getBackgroundStyles(e)},n))}return null}_getBackgroundStyles(e){const t=e.symbol,i=t.color,s=!!i?.a,r="outline"in t?t.outline:null,o=!!r?.color?.a,n=new m.A(s&&i?[i.r,i.g,i.b,i.a*this.layer.opacity]:[255,255,255,0]),l=o&&r.color?new m.A([r.color.r,r.color.g,r.color.b,r.color.a*this.layer.opacity]):new m.A([255,255,255,0]),a=e.symbol.color?.isBright??!0,c=a?"black":"white",u=a?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return{background:s?n.toCss(!0):"none",color:c,textShadow:`-1px -1px 0 ${u},\n                  1px -1px 0 ${u},\n                  -1px 1px 0 ${u},\n                  1px 1px 0 ${u}`,border:o?`1px solid ${l.toCss(!0)}`:"none",filter:(0,z.di)(this.effectList)??void 0}}_renderImage(e,t,i){const{label:s,src:r,opacity:o}=e,n={[je.imageryLayerStretchedImage]:i,[je.symbol]:!i},l={opacity:`${o??t.opacity}`},a=Ue(this.messages,s,!1);return(0,Xe.K)("img",{alt:a,"aria-label":a,border:0,class:this.classes(n),height:e.height,src:r,styles:l,width:e.width})}};(0,s._)([(0,o.MZ)()],Ft.prototype,"activeLayerInfo",void 0),(0,s._)([(0,o.MZ)()],Ft.prototype,"effectList",void 0),(0,s._)([(0,o.MZ)()],Ft.prototype,"hasIndicators",void 0),(0,s._)([(0,o.MZ)()],Ft.prototype,"headingLevel",void 0),(0,s._)([(0,o.MZ)()],Ft.prototype,"isChild",void 0),(0,s._)([(0,o.MZ)()],Ft.prototype,"layer",void 0),(0,s._)([(0,o.MZ)()],Ft.prototype,"legendElement",void 0),(0,s._)([(0,o.MZ)()],Ft.prototype,"messages",void 0),Ft=Ct=(0,s._)([(0,a.$)("esri.widgets.Legend.styles.card.LegendElement")],Ft);var Rt=i(17199),Zt=i(43955);let Ot=class extends c.A{constructor(e,t){super(e,t),this._hasIndicators=!1,this.activeLayerInfos=null,this.headingLevel=3,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}loadDependencies(){return(0,Rt.W)({carousel:()=>Promise.all([i.e(72076),i.e(88698)]).then(i.bind(i,88698)),"carousel-item":()=>Promise.all([i.e(72076),i.e(49545)]).then(i.bind(i,49545))})}render(){this._hasIndicators="auto"===this.layout&&this.view&&this.view.container.clientWidth<=768||"stack"===this.layout;const e=this._hasIndicators?this._renderCarousel():this._renderLayers(),t={[je.stacked]:this._hasIndicators};return(0,Xe.K)("div",{class:this.classes(je.base,t)},e||(0,Xe.K)("div",{class:je.message},this.messages.noLegend))}_renderCarousel(){const e=[],t=this.activeLayerInfos;if(t)for(const i of t)this._renderSections(i,e);return e?.length?(0,Xe.K)("calcite-carousel",{class:je.carousel,label:this.messages.carousel},e.map(((t,i)=>(0,Xe.K)("calcite-carousel-item",{class:je.carouselItem,key:i,label:(0,Y.V)(this.messagesCommon.pagination.pageText,{index:i+1,total:e.length})},t)))):null}_renderLayers(){const e=this.activeLayerInfos,t=e?.toArray()?.map((e=>this._renderLegendForLayer(e))).filter(Boolean);return t?.length?t:null}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.toArray().map(this._renderLegendForLayer,this);return(0,Xe.K)("section",{class:this.classes(je.service,je.groupLayer),key:e.layer.uid},(0,Xe.K)("div",{class:je.serviceCaptionContainer},e.title),t)}return this._renderLegendElementsForLayer(e)}_renderLegendElementsForLayer(e){const t=e.legendElements?.filter(Boolean);if(!t?.length)return null;const i=t.map((t=>(0,Xe.K)(Ft,{activeLayerInfo:e,effectList:e.effectList,hasIndicators:this._hasIndicators,headingLevel:this.headingLevel,isChild:!1,key:`${e.layer.uid}-${t.type}`,layer:e.layer,legendElement:t,messages:this.messages}))),s={[je.groupLayerChild]:!!e.parent};return(0,Xe.K)("section",{class:this.classes(je.service,s),key:e.layer.uid},(0,Xe.K)("div",{class:je.serviceCaptionContainer},(0,Xe.K)("div",{class:je.serviceCaptionText},e.title)),(0,Xe.K)("div",{class:je.serviceContent},i))}_renderSections(e,t){if(!e.ready)return;if(e.children.length)for(const s of e.children)this._renderSections(s,t);const i=e.legendElements;if(i?.length)for(const s of i){const i=(0,Xe.K)(Ft,{activeLayerInfo:e,effectList:e.effectList,hasIndicators:this._hasIndicators,headingLevel:this.headingLevel,isChild:!1,key:`${e.layer.uid}-${s.type}`,layer:e.layer,legendElement:s,messages:this.messages});i&&t.push(i)}}};(0,s._)([(0,o.MZ)()],Ot.prototype,"activeLayerInfos",void 0),(0,s._)([(0,o.MZ)()],Ot.prototype,"headingLevel",void 0),(0,s._)([(0,o.MZ)()],Ot.prototype,"layout",void 0),(0,s._)([(0,o.MZ)(),(0,Zt.G)("esri/widgets/Legend/t9n/Legend")],Ot.prototype,"messages",void 0),(0,s._)([(0,o.MZ)(),(0,Zt.G)("esri/t9n/common")],Ot.prototype,"messagesCommon",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],Ot.prototype,"type",void 0),(0,s._)([(0,o.MZ)()],Ot.prototype,"view",void 0),Ot=(0,s._)([(0,a.$)("esri.widgets.Legend.styles.card.CardView")],Ot);const Pt="esri-legend",kt={service:`${Pt}__service`,label:`${Pt}__service-label`,layer:`${Pt}__layer`,groupLayer:`${Pt}__group-layer`,groupLayerChild:`${Pt}__group-layer-child`,layerTable:`${Pt}__layer-table`,layerTableSizeRamp:`${Pt}__layer-table--size-ramp`,layerChildTable:`${Pt}__layer-child-table`,layerCaption:`${Pt}__layer-caption`,layerBody:`${Pt}__layer-body`,layerRow:`${Pt}__layer-row`,layerCell:`${Pt}__layer-cell`,layerInfo:`${Pt}__layer-cell ${Pt}__layer-cell--info`,imageryLayerStretchedImage:`${Pt}__imagery-layer-image--stretched`,imageryLayerCellStretched:`${Pt}__imagery-layer-cell--stretched`,imageryLayerInfoStretched:`${Pt}__imagery-layer-info--stretched`,symbolContainer:`${Pt}__layer-cell ${Pt}__layer-cell--symbols`,symbol:`${Pt}__symbol`,rampContainer:`${Pt}__ramps`,sizeRamp:`${Pt}__size-ramp`,colorRamp:`${Pt}__color-ramp`,opacityRamp:`${Pt}__opacity-ramp`,borderlessRamp:`${Pt}__borderless-ramp`,rampTick:`${Pt}__ramp-tick`,rampFirstTick:`${Pt}__ramp-tick-first`,rampLastTick:`${Pt}__ramp-tick-last`,rampLabelsContainer:`${Pt}__ramp-labels`,rampLabel:`${Pt}__ramp-label`,message:`${Pt}__message`,univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label"};let Dt=class extends c.A{constructor(e,t){super(e,t),this.legendElement=null,this.opacity=1}get _preview(){const e=this.legendElement.preview;if(!e)return null;const t="opacity-ramp"===this.legendElement.type?kt.opacityRamp:"";return e.className=`${kt.colorRamp} ${t}`,null!=this.opacity&&(e.style.opacity=this.opacity.toString()),e}render(){const{legendElement:e,_preview:t}=this;if(!t)return null;const i={width:"24px"},s={height:t.style.height};return(0,Xe.K)("div",{class:kt.layerRow,key:`${this.key}-row`},(0,Xe.K)("div",{class:kt.symbolContainer,styles:i},(0,Xe.K)("div",{afterCreate:Ke,bind:t,class:kt.rampContainer})),(0,Xe.K)("div",{class:kt.layerInfo},(0,Xe.K)("div",{class:kt.rampLabelsContainer,styles:s},e.infos.map(((t,i)=>this._renderRampLabel(t,i,e.type))))))}_renderRampLabel(e,t,i){return(0,Xe.K)("div",{class:e.label?kt.rampLabel:void 0,key:`${this.key}-stop-${e.label??t}-label`},We(e,i,this.messages))}};(0,s._)([(0,o.MZ)()],Dt.prototype,"_preview",null),(0,s._)([(0,o.MZ)()],Dt.prototype,"legendElement",void 0),(0,s._)([(0,o.MZ)()],Dt.prototype,"messages",void 0),(0,s._)([(0,o.MZ)()],Dt.prototype,"opacity",void 0),Dt=(0,s._)([(0,a.$)("esri.widgets.Legend.styles.classic.ColorRamp")],Dt);let Nt=class extends c.A{constructor(e,t){super(e,t),this.legendElement=null}render(){const e=this.legendElement.infos.map((e=>this._renderRow(e))).filter(Boolean);return e.length?"spike"===this.legendElement.theme?ot(this.legendElement):(0,Xe.K)("div",{class:kt.layerBody},e):null}_renderRow(e){return e.preview?(0,Xe.K)("div",{class:kt.layerRow,key:`${this.key}-${e.label}-row`},(0,Xe.K)("div",{class:this.classes(kt.symbolContainer,kt.sizeRamp)},(0,Xe.K)("div",{afterCreate:Ke,bind:e.preview,class:kt.symbol})),(0,Xe.K)("div",{class:kt.layerInfo},Ue(this.messages,e.label,!1)||"")):null}};(0,s._)([(0,o.MZ)()],Nt.prototype,"legendElement",void 0),(0,s._)([(0,o.MZ)()],Nt.prototype,"messages",void 0),Nt=(0,s._)([(0,a.$)("esri.widgets.Legend.styles.classic.SizeRamp")],Nt);let $t=class extends c.A{constructor(e,t){super(e,t),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const{legendElement:e,opacity:t,effectList:i,key:s}=this,{sizeRampElement:r,colorRampElement:o}=wt(e,t);if(!r)return null;const n=this.messages.previewColorRampAriaLabel,l=_t(r,"above",!0),a=_t(r,"below",!0),c=vt(o,{width:12,height:l,rampAlignment:"vertical",opacity:t,type:"above",effectList:i,ariaLabel:n}),u=vt(o,{width:12,height:a,rampAlignment:"vertical",opacity:t,type:"below",effectList:i,ariaLabel:n}),d=ft(r),p=r.infos.map((e=>e.label)),h=p.map(((e,t)=>{const i=2===t;return 0===t?(0,Xe.K)("div",{class:e?c?kt.univariateAboveAndBelowLabel:kt.rampLabel:void 0,key:`${s}-color-ramp-above-label-${e??t}`},e):i?(0,Xe.K)("div",null):null})),y=p.length-1,m=Math.floor(p.length/2),g=p.map(((e,t)=>t===m||t===y?(0,Xe.K)("div",{class:e?c?kt.univariateAboveAndBelowLabel:kt.rampLabel:void 0,key:`${s}-color-ramp-below-label-${e??t}`},e):null)),f={display:"table-cell",verticalAlign:"middle"},v={marginTop:`${d}px`},b={height:`${l}px`},_={height:`${a}px`};return(0,Xe.K)("div",{key:`${s}-container`,styles:It},(0,Xe.K)("div",{class:kt.layerBody},r.infos.map(((e,t)=>(0,Xe.K)("div",{class:this.classes(kt.layerRow,kt.sizeRamp),key:`${s}-row-${t}`},(0,Xe.K)("div",{afterCreate:Ke,bind:e.preview,class:kt.symbol,styles:f}),c||t%2!=0?null:(0,Xe.K)("div",{class:kt.layerInfo},p[t]))))),c?(0,Xe.K)("div",{styles:v},(0,Xe.K)("div",{styles:St},(0,Xe.K)("div",{styles:Lt},(0,Xe.K)("div",{afterCreate:Ke,bind:c,class:kt.rampContainer})),(0,Xe.K)("div",{styles:Lt},(0,Xe.K)("div",{class:kt.rampLabelsContainer,styles:b},h))),(0,Xe.K)("div",{styles:St},(0,Xe.K)("div",{styles:Lt},(0,Xe.K)("div",{afterCreate:Ke,bind:u,class:kt.rampContainer})),(0,Xe.K)("div",{styles:Lt},(0,Xe.K)("div",{class:kt.rampLabelsContainer,styles:_},g)))):null)}};(0,s._)([(0,o.MZ)()],$t.prototype,"effectList",void 0),(0,s._)([(0,o.MZ)()],$t.prototype,"legendElement",void 0),(0,s._)([(0,o.MZ)()],$t.prototype,"messages",void 0),(0,s._)([(0,o.MZ)()],$t.prototype,"opacity",void 0),$t=(0,s._)([(0,a.$)("esri.widgets.Legend.styles.classic.UnivariateAboveAndBelowRamp")],$t);let Vt=class extends c.A{constructor(e,t){super(e,t),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const{legendElement:e,opacity:t,effectList:i,key:s}=this,{sizeRampElement:r,colorRampElement:o}=Mt(e);if(!r)return null;const n=ft(r),l=_t(r,"full",!1),a=vt(o,{width:12,height:l,rampAlignment:"vertical",opacity:t,type:"full",effectList:i,ariaLabel:this.messages?.previewColorRampAriaLabel}),c=r.infos.length-1,u=r.infos.map(((e,t)=>0===t||t===c?(0,Xe.K)("div",{class:e.label?o?kt.univariateAboveAndBelowLabel:kt.rampLabel:void 0,key:`${s}-color-ramp-label-${e.label??t}`},e.label):null)),d={display:"table-cell",verticalAlign:"middle"},p={marginTop:`${n}px`},h={height:`${l}px`};return(0,Xe.K)("div",{key:`${s}-container`,styles:It},(0,Xe.K)("div",{class:kt.layerBody},r.infos.map(((e,t)=>(0,Xe.K)("div",{class:this.classes(kt.layerRow,kt.sizeRamp),key:`${s}-row-${t}`},(0,Xe.K)("div",{afterCreate:Ke,bind:e.preview,class:kt.symbol,styles:d}))))),(0,Xe.K)("div",{styles:p},(0,Xe.K)("div",{styles:St},(0,Xe.K)("div",{styles:Lt},(0,Xe.K)("div",{afterCreate:Ke,bind:a,class:kt.rampContainer})),(0,Xe.K)("div",{styles:Lt},(0,Xe.K)("div",{class:kt.rampLabelsContainer,styles:h},u)))))}};var Bt;(0,s._)([(0,o.MZ)()],Vt.prototype,"effectList",void 0),(0,s._)([(0,o.MZ)()],Vt.prototype,"legendElement",void 0),(0,s._)([(0,o.MZ)()],Vt.prototype,"messages",void 0),(0,s._)([(0,o.MZ)()],Vt.prototype,"opacity",void 0),Vt=(0,s._)([(0,a.$)("esri.widgets.Legend.styles.classic.UnivariateColorSizeRamp")],Vt);let jt=Bt=class extends c.A{constructor(e,t){super(e,t),this.effectList=null,this.isChild=!1,this.legendElement=null}render(){const e=this._renderLegendElement(),t=Je(this.legendElement,this.messages),i=this.isChild?kt.layerChildTable:kt.layerTable,s=t?(0,Xe.K)("div",{class:kt.layerCaption},t):null,r={[kt.layerTableSizeRamp]:"size-ramp"===this.legendElement.type||!this.isChild};return(0,Xe.K)("section",{class:this.classes(i,r),key:`${this.key}-table`},s,e)}_renderLegendElement(){switch(this.legendElement.type){case"symbol-table":return this._renderSymbolTable(this.legendElement);case"size-ramp":return(0,Xe.K)(Nt,{key:this.key,legendElement:this.legendElement,messages:this.messages});case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":return(0,Xe.K)(Dt,{key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"relationship-ramp":return(0,Tt.p)(this.legendElement,this.id,{opacity:this.layer.opacity,effectList:this.effectList,ariaLabel:this.messages.previewRelationshipRampAriaLabel,key:this.key});case"pie-chart-ramp":return(0,Xe.K)("div",{afterCreate:Ke,bind:this.legendElement.preview,key:`${this.key}-preview`});case"univariate-above-and-below-ramp":return(0,Xe.K)($t,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"univariate-color-size-ramp":return(0,Xe.K)(Vt,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});default:return null}}_renderSymbolTable(e){const t=e.infos.map((t=>this._renderElementInfo(t,e.legendType))).filter(Boolean);return t.length?(0,Xe.K)("div",{class:kt.layerBody},t):null}_renderElementInfo(e,t){const{layer:i}=this,s="label"in e?e.label:null,r=`${this.key}-${s}`;if("type"in e&&e.type)return(0,Xe.K)(Bt,{effectList:this.effectList,isChild:!0,key:r,layer:i,legendElement:e,messages:this.messages});if(!("preview"in e&&e.preview||"src"in e&&e.src))return null;const o=He(i,t),n={[kt.imageryLayerInfoStretched]:o},l={[kt.imageryLayerInfoStretched]:o};return(0,Xe.K)("div",{class:kt.layerRow,key:`${r}-row`},(0,Xe.K)("div",{class:this.classes(kt.symbolContainer,l)},this._renderPreview(e,o)),(0,Xe.K)("div",{class:this.classes(kt.layerInfo,n)},Ue(this.messages,s,!1)||""))}_renderPreview(e,t){const{layer:i}=this;return"preview"in e&&e.preview?(0,Xe.K)("div",{afterCreate:Ke,bind:e.preview,class:kt.symbol}):"src"in e&&e.src?this._renderImage(e,i,t):null}_renderImage(e,t,i){const{label:s,src:r,opacity:o}=e,n={[kt.imageryLayerStretchedImage]:i,[kt.symbol]:!i},l={opacity:`${o??t.opacity}`},a=Ue(this.messages,s,!1);return(0,Xe.K)("img",{alt:a,"aria-label":a,border:0,class:this.classes(n),height:e.height,src:r,styles:l,width:e.width})}};(0,s._)([(0,o.MZ)()],jt.prototype,"effectList",void 0),(0,s._)([(0,o.MZ)()],jt.prototype,"isChild",void 0),(0,s._)([(0,o.MZ)()],jt.prototype,"layer",void 0),(0,s._)([(0,o.MZ)()],jt.prototype,"legendElement",void 0),(0,s._)([(0,o.MZ)()],jt.prototype,"messages",void 0),jt=Bt=(0,s._)([(0,a.$)("esri.widgets.Legend.styles.classic.LegendElement")],jt);var Gt=i(35251);const zt=`${Pt}__`;let Kt=class extends c.A{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e?.toArray().map((e=>this._renderLegendForLayer(e))).filter(Boolean);return t?.length?(0,Xe.K)("section",null,t):(0,Xe.K)("div",{class:kt.message,key:"no-legend"},this.messages.noLegend)}_renderLegendForLayer(e,t){if(!e.ready)return null;const i=`${e.layer.uid}-version-${e.version}`,s=`${zt}${t?`${t}-`:""}${i}`,r=e.title?(0,Et.D)({level:this.headingLevel,class:this.classes(Gt.D.heading,kt.label)},e.title):null;if(e.children.length){const t=e.children.toArray().map((e=>this._renderLegendForLayer(e,i)));return(0,Xe.K)("section",{class:this.classes(kt.service,kt.groupLayer),key:s},r,t)}return this._renderLegendElementsForLayer(e,r,s)}_renderLegendElementsForLayer(e,t,i){const s=e.legendElements?.filter(Boolean);if(!s?.length)return null;const r=s.map((t=>(0,Xe.K)(jt,{effectList:e.effectList,isChild:!1,key:`${i}-${t.type}`,layer:e.layer,legendElement:t,messages:this.messages}))),o={[kt.groupLayerChild]:!!e.parent};return(0,Xe.K)("section",{class:this.classes(kt.service,o),key:i},t,(0,Xe.K)("div",{class:kt.layer},r))}};(0,s._)([(0,o.MZ)()],Kt.prototype,"activeLayerInfos",void 0),(0,s._)([(0,o.MZ)()],Kt.prototype,"headingLevel",void 0),(0,s._)([(0,o.MZ)(),(0,Zt.G)("esri/widgets/Legend/t9n/Legend")],Kt.prototype,"messages",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],Kt.prototype,"type",void 0),Kt=(0,s._)([(0,a.$)("esri.widgets.Legend.styles.classic.ClassicView")],Kt);const Ut="esri-legend";let qt=class extends c.A{constructor(e,t){super(e,t),this.headingLevel=3,this.messages=null,this.viewModel=new $e,this.style=new Kt}initialize(){this.addHandles([(0,r.on)((()=>this.view),"resize",(()=>this.scheduleRender())),(0,r.on)((()=>this.activeLayerInfos),"change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),(0,r.wB)((()=>this.headingLevel),(e=>{const{style:t}=this;t&&(t.headingLevel=e)})),(0,r.wB)((()=>this.style),((e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)}),r.Vh)])}destroy(){this.style?.destroy()}get activeLayerInfos(){return this.viewModel.activeLayerInfos}set activeLayerInfos(e){this.viewModel.activeLayerInfos=e}get basemapLegendVisible(){return this.viewModel.basemapLegendVisible}set basemapLegendVisible(e){this.viewModel.basemapLegendVisible=e}get groundLegendVisible(){return this.viewModel.groundLegendVisible}set groundLegendVisible(e){this.viewModel.groundLegendVisible=e}get hideLayersNotInCurrentView(){return this.viewModel.hideLayersNotInCurrentView}set hideLayersNotInCurrentView(e){this.viewModel.hideLayersNotInCurrentView=e}get keepCacheOnDestroy(){return this.viewModel.keepCacheOnDestroy}set keepCacheOnDestroy(e){this.viewModel.keepCacheOnDestroy=e}get respectLayerDefinitionExpression(){return this.viewModel.respectLayerDefinitionExpression}set respectLayerDefinitionExpression(e){this.viewModel.respectLayerDefinitionExpression=e}get respectLayerVisibility(){return this.viewModel.respectLayerVisibility}set respectLayerVisibility(e){this.viewModel.respectLayerVisibility=e}get icon(){return"legend"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}set style(e){const t=this._get("style");e!==t&&t?.destroy(),this._set("style",e)}castStyle(e){if(e instanceof Ot||e instanceof Kt)return e;if("string"==typeof e)return"card"===e?new Ot:new Kt;if(e&&"string"==typeof e.type){const t={...e};return delete t.type,"card"===e.type?new Ot(t):new Kt(t)}return new Kt}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return(0,Xe.K)("div",{class:this.classes(Ut,Gt.D.widget,this.style instanceof Kt?Gt.D.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){e.forEach((e=>{this.removeHandles(`version_${e.layer.uid}`),this._renderOnActiveLayerInfoChange(e)})),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const t=(0,r.wB)((()=>e.version),(()=>this.scheduleRender()));this.addHandles(t,`version_${e.layer.uid}`);const i=(0,r.on)((()=>e.children),"change",(()=>e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))),r.Vh);this.addHandles(i,`version_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};(0,s._)([(0,o.MZ)()],qt.prototype,"activeLayerInfos",null),(0,s._)([(0,o.MZ)()],qt.prototype,"basemapLegendVisible",null),(0,s._)([(0,o.MZ)()],qt.prototype,"groundLegendVisible",null),(0,s._)([(0,o.MZ)()],qt.prototype,"headingLevel",void 0),(0,s._)([(0,o.MZ)()],qt.prototype,"hideLayersNotInCurrentView",null),(0,s._)([(0,o.MZ)()],qt.prototype,"keepCacheOnDestroy",null),(0,s._)([(0,o.MZ)()],qt.prototype,"respectLayerDefinitionExpression",null),(0,s._)([(0,o.MZ)()],qt.prototype,"respectLayerVisibility",null),(0,s._)([(0,o.MZ)()],qt.prototype,"icon",null),(0,s._)([(0,o.MZ)()],qt.prototype,"label",null),(0,s._)([(0,o.MZ)()],qt.prototype,"layerInfos",null),(0,s._)([(0,o.MZ)(),(0,Zt.G)("esri/widgets/Legend/t9n/Legend")],qt.prototype,"messages",void 0),(0,s._)([(0,o.MZ)()],qt.prototype,"style",null),(0,s._)([(0,n.w)("style")],qt.prototype,"castStyle",null),(0,s._)([(0,o.MZ)()],qt.prototype,"view",null),(0,s._)([(0,o.MZ)()],qt.prototype,"viewModel",void 0),qt=(0,s._)([(0,a.$)("esri.widgets.Legend")],qt);const Ht=qt},57081:(e,t,i)=>{i.d(t,{getRampStops:()=>R,mh:()=>L,OE:()=>I});var s=i(96220),r=i(775),o=i(82178),n=i(98549),l=i(19251),a=i(89882),c=(i(54394),i(63643));const u="spike-height-override";(0,a.PN)(8),(0,a.PN)(20);function d(e){const{strokeColor:t,strokeWidth:i,symbolStyle:s}=e,r=s?.includes("solid-fill")||s?.includes("gradient-fill");let o=t?.toArray(),n=!1;return s?.includes("outline")&&r?n=!0:o=e.color?.toArray(),{type:"CIMSolidStroke",effects:p(s),enable:!0,colorLocked:n,capStyle:c.uT.Round,joinStyle:c.wd.Round,lineStyle3D:c.h5.Strip,miterLimit:4,width:i??(0,a.PN)(1),color:o}}function p(e){if(!e?.includes("closed"))return[{type:"CIMGeometricEffectAddControlPoints",angleTolerance:90,primitiveName:"spike-control-points"},{type:"CIMGeometricEffectSuppress",suppress:!0,invert:!0,primitiveName:"spike-stroke-suppress"}]}function h(e){const{color:t,symbolStyle:i}=e,s=i?.includes("solid-fill"),r=i?.includes("gradient-fill");if(!s&&!r||!t)return;if(s)return{type:"CIMSolidFill",enable:!0,colorLocked:!1,color:t?.toArray()};const o=t.clone();return o.a=0,{type:"CIMGradientFill",enable:!0,angle:90,colorRamp:{type:"CIMMultipartColorRamp",colorRamps:[{type:"CIMLinearContinuousColorRamp",fromColor:t.toArray(),toColor:o.toArray()}],weights:[1]},gradientMethod:"Linear",gradientSize:70,gradientSizeUnits:"Relative",gradientType:"Continuous"}}function y(e,t){const{defaultHeight:i,baseWidth:r,color:o,strokeColor:n,primitiveOverrides:a,symbolStyle:c,strokeWidth:p}=t,y="CIMPointSymbol"===e.data.symbol?.type?e.data.symbol:null,g=y?.symbolLayers;if(!g)return e;const f=y.effects,v=f?.find((e=>"CIMGeometricEffectTaperedPolygon"===e.type)),b=f?.find((e=>"CIMGeometricEffectRadial"===e.type&&e.primitiveName===u));null!=r&&v&&(v.fromWidth=r),null!=i&&b&&(b.length=i);const _=g?.find((e=>"CIMSolidStroke"===e.type)),w=g?.find((e=>"CIMSolidFill"===e.type)),M=g?.find((e=>"CIMGradientFill"===e.type)),S="CIMMultipartColorRamp"===M?.colorRamp?.type&&"CIMLinearContinuousColorRamp"===M.colorRamp.colorRamps[0]?.type?M.colorRamp.colorRamps[0]:null;if(c){const e=w?.color??S?.fromColor??_?.color,i=o??(e?new s.A(e):void 0),r=_?.color??e,l=n??(r?new s.A(r):void 0),a=c.includes("solid-fill"),u=c.includes("gradient-fill");if(a||u||m(g,w??M),i)if(a)m(g,M),w?w.color=i?.toArray():g.push(h({...t,color:i}));else if(u)if(m(g,w),M){if(S&&o){const e=i.clone();e.a=0,S.fromColor=i.toArray(),S.toColor=e.toArray()}}else g.push(h({...t,color:i}));if(_){const e=d({...t,strokeColor:l,color:i});_.effects=e.effects,_.color=e.color,_.width=e.width,_.colorLocked=e.colorLocked}}else if(_&&(n&&(_.color=n.toArray()),null!=p&&(_.width=p)),w&&o&&(w.color=o.toArray()),S&&o){const e=o.clone();e.a=0,S.fromColor=o.toArray(),S.toColor=e.toArray()}return void 0!==a&&(e.data.primitiveOverrides=(0,l.o8)(a)),e}function m(e,t){if(!t)return;const i=e.indexOf(t);-1!==i&&e.splice(i,1)}var g=i(40241),f=i(23369),v=i(77573),b=i(75886),_=i(66961),w=i(55056),M=i(29934),S=(i(99484),i(67923));const L=30,I=12,A=24,x=[255,255,255],C=[200,200,200],T=[128,128,128],E=20,F=5;async function R(e,t,s,r,n,l,a){const c=t.legendOptions,u=c?.customValues,d=a||await O(e,s),p=t.stops,h=!!d,y=!!u,m=null!=t.minSize&&null!=t.maxSize,g=p&&p.length>1,f=!!t.target;if(!h||!y&&!(m||g&&!f))return;const v=(0,w.$d)(d);let _=!1,S=null,L=null;S=v&&!g?(0,o.LI)([t.minDataValue,t.maxDataValue]):u??await async function(e,t,s,r){const n=(await i.e(72076).then(i.bind(i,28479))).getSizeRangeAtScale(e,s,r),l=n&&D(n);if(!n||!l)return;let a=l.map((t=>function(e,t,i){const s=i.minSize,r=i.maxSize,o=t.minDataValue,n=t.maxDataValue;let l;l=e<=s?o:e>=r?n:(e-s)/(r-s)*(n-o)+o;return l}(t,e,n)));a=(0,o.LI)(a);for(let i=1;i<a.length-1;i++){const o=await N(e,t,a[i],a[i-1],s,r);o&&(a[i]=o[0],l[i]=o[1])}return a}(t,d,r,n?.type);const I=e?.authoringInfo,x="univariate-color-size"===I?.type,C=x&&"above-and-below"===I?.univariateTheme,T=!!(0,M.iz)(e,"reference-size"),E=!!(0,M.iz)(e,"spike");if(!S&&g&&(S=p.map((e=>e.value)),_=p.some((e=>!!e.label)),"flow"===e.type&&(S=(0,o.LI)(S)),_&&(L=p.map((e=>e.label)))),v&&null!=S&&S?.length>2&&!C&&(S=[S[0],S[S.length-1]]),!S)return null;x&&5!==S?.length&&(S=D({minSize:S[0],maxSize:S[S.length-1]}));const F=v?Z(e,S):null,R=(0,w.k_)(d),P=_?null:function(e,t){const i=e.length-1;return e.map(((e,s)=>(0,M.Dd)(e,s,i,t)))}(S,l),k=await Promise.all(S.map((async(i,s)=>{let o=v?F[s]:await $(t,d,i,r,n?.type),l=o;T&&(o*=A/t.maxSize||1,l=A);const a=V(d,o,e,s);return E&&"cim"===a.type&&(l=await(0,b.D)(a)),{value:i,symbol:a,label:_?L[s]:P[s],size:l,outlineSize:R}})));return k.reverse()}function Z(e,t){const i=e?.authoringInfo,s="univariate-color-size"===i?.type;let r=[I,L];if(s){const e=t[0],i=t[t.length-1],s=I,o=L;r=t.map((t=>s+(t-e)/(i-e)*(o-s)))}return s&&"below"===i?.univariateTheme&&r.reverse(),r}async function O(e,t){if("flow"===e.type)return(0,M.Zo)(e,t);if("pie-chart"===e.type)return new f.A({color:null,outline:e.outline?.width?e.outline:new g.A});let i=null,o=null;if("simple"===e.type)i=e.symbol;else if("class-breaks"===e.type){const t=e.classBreakInfos;i=t&&t[0]&&t[0].symbol,o=t.length>1}else if("unique-value"===e.type){const t=e.uniqueValueInfos;i=t?.[0]?.symbol,o=null!=t&&t.length>1}if(!i||function(e){return(0,_.wk)(e)?e.symbolLayers?.some((e=>"fill"===e?.type))??!1:e?.type.includes("fill")??!1}(i))return null;if(i=i.clone(),t||o)if(i.type.includes("3d"))P(i);else if((0,M.iz)(e,"reference-size")&&"cim"===i.type)(0,n.oz)(i,{color:t??("class-breaks"!==e.type?new s.A(C):null)});else if((0,M.iz)(e,"spike")&&"cim"===i.type){const e=new s.A(C),o=new s.A(T),n="CIMPointSymbol"===i.data.symbol?.type?i.data.symbol:null,l=!!n?.symbolLayers?.find((({type:e})=>"CIMSolidStroke"===e))?.colorLocked;let a,c=t??void 0;if(c){const t=(0,r.Ws)(c),i=(0,S.ud)();(!i&&t>225||i&&t<25)&&(c=e,a=l?o:e)}else c=e,a=l?o:e;y(i,{color:c,strokeColor:a})}else k(i);return i}function P(e){"line-3d"===e.type?e.symbolLayers.forEach((e=>{e.material={color:T}})):e.symbolLayers.forEach((e=>{"icon"!==e.type||e.resource?.href?e.material={color:C}:(e.material={color:x},e.outline={color:T,size:1.5})}))}function k(e){const t=(0,S.ud)();if("cim"===e.type)(0,v.Fe)(e,new s.A(C));else if(e.type.includes("line"))e.color=T;else if(e.color=t?T:x,"simple-marker"===e.type)if(e.outline){const t=e.outline?.color?.toHex();"#ffffff"===t&&(e.outline.color=T)}else e.outline={color:T,width:1.5}}function D(e){const t=e.minSize,i=e.maxSize,s=F,r=(i-t)/(s-1),o=[];for(let n=0;n<s;n++)o.push(t+r*n);return o}async function N(e,t,i,s,r,n){const l=await $(e,t,i,r,n),a=await $(e,t,s,r,n),c=(0,o.lc)(i),u=c.fractional,d=E;let p=c.integer,h=null,y=null;i>0&&i<1&&(h=10**u,p=(0,o.lc)(i*=h).integer);for(let m=p-1;m>=0;m--){const s=10**m;let c=Math.floor(i/s)*s,u=Math.ceil(i/s)*s;null!=h&&(c/=h,u/=h);let p=(c+u)/2;[,p]=(0,o.LI)([c,p,u],{indexes:[1]});const g=await $(e,t,c,r,n),f=await $(e,t,u,r,n),v=await $(e,t,p,r,n),b=(0,o.u5)(l,g,a,null),_=(0,o.u5)(l,f,a,null),w=(0,o.u5)(l,v,a,null);let M=b.previous<=d,S=_.previous<=d;if(M&&S&&(b.previous<=_.previous?(M=!0,S=!1):(S=!0,M=!1)),M?y=[c,g]:S?y=[u,f]:w.previous<=d&&(y=[p,v]),y)break}return y}async function $(e,t,s,r,o){const{getSize:n}=await i.e(72076).then(i.bind(i,28479));return n(e,s,{scale:r,view:o,shape:"simple-marker"===t.type?t.style:null})}function V(e,t,i,s){"univariate-color-size"===i?.authoringInfo?.type&&"above-and-below"===i?.authoringInfo?.univariateTheme&&"class-breaks"===i.type&&(e=function(e,t){const i=e.classBreakInfos,s=i.length,r=s<2||!(t>=2)?i[0].symbol.clone():i[s-1].symbol.clone(),o=e.visualVariables?.some((e=>"color"===e.type));return o&&(r.type.includes("3d")?P(r):k(r)),r}(i,s));const r=e.clone();if((0,_.wk)(r))(0,w.$d)(r)||r.symbolLayers.forEach((e=>{"fill"!==e.type&&(e.size=t)}));else if(function(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(r))r.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(r)){const e=r.width,i=r.height;r.height=t,r.width=t*(e/i)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(r)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(r)?r.font&&(r.font.size=t):"cim"===r.type&&(0,M.iz)(i,"reference-size")?(0,n.oz)(r,{innerDotSize:t,outerRingSize:A}):"cim"===r.type&&(0,M.iz)(i,"spike")&&y(r,{defaultHeight:t,primitiveOverrides:null}):r.width=t;return r}},65717:(e,t,i)=>{i.d(t,{A:()=>bt});var s=i(66866),r=(i(17791),i(50220)),o=i(539),n=i(6267),l=i(40189),a=i(85251),c=i(61449),u=i(21564),d=i(39831),p=(i(9272),i(63863)),h=i(46928);const y="esri-search",m={base:y,autocomplete:`${y}__autocomplete`,dropdown:`${y}__dropdown`,container:`${y}__container`,form:`${y}__form`},g="esri-search-result-renderer",f={base:g,moreResults:`${g}--more-results`};var v=i(99050),b=i(25707),_=i(56542),w=i(52495),M=i(85569),S=i(48982),L=i(98849),I=i(17306),A=i(97066),x=i(78983),C=i(33645),T=i(91109),E=i(15131),F=i(10282),R=i(71647),Z=i(72001),O=i(68882),P=i(40241),k=i(42602),D=i(38201),N=i(19251),$=i(65667),V=i(21877);let B=class extends($.A.IdentifiableMixin(V.A)){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};(0,s._)([(0,u.MZ)()],B.prototype,"autoNavigate",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"filter",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"getResults",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"getSuggestions",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"maxResults",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"maxSuggestions",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"minSuggestCharacters",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"outFields",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"placeholder",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"popupEnabled",void 0),(0,s._)([(0,u.MZ)({type:_.A})],B.prototype,"popupTemplate",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"prefix",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"resultGraphicEnabled",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"resultSymbol",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"suggestionsEnabled",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"suffix",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"withinViewEnabled",void 0),(0,s._)([(0,u.MZ)()],B.prototype,"zoomScale",void 0),B=(0,s._)([(0,p.$)("esri.widgets.Search.SearchSource")],B);const j=B;var G=i(92976),z=i(62802),K=i(44146),U=i(48187),q=i(76459);const H=/https?:\/\/services.*\.arcgis\.com/i,W=/(?:\{([^}]+)\})/g,J=()=>o.A.getLogger("esri.widgets.Search.support.layerSearchUtils");function Q(e,t){const{exactMatch:i=!1,location:s,maxResults:r,spatialReference:o,source:n,sourceIndex:l,suggestResult:a,view:c}=e,{layer:u,filter:d,zoomScale:p}=n,h=c?.scale,y=X(n,c),m=t?.signal;return te(u).then((()=>{const e=u.popupTemplate;return e?e.getRequiredFields(u.fieldsIndex):null})).then((e=>{const{objectIdField:t,returnZ:g}=u,f=le(n);if(!ce(u,f))throw J().error("invalid-field: displayField is invalid."),new L.A("getResults():invalid-field","displayField is invalid.");const v=e?.length?e:[f],b=n.outFields||v,_=ee(b);if(b.includes(t)||_||b.push(t),u.floorInfo?.floorField&&b.push(u.floorInfo.floorField),!_&&!ae(u,b))throw J().error("invalid-field: outField is invalid."),new L.A("getResults():invalid-field","outField is invalid.");const w=u.createQuery(),{orderByFields:M}=n;if(M&&(w.orderByFields=M),o){w.outSpatialReference=o;const e=1/(0,G.GA)(o);e&&(w.maxAllowableOffset=e)}const S="mesh"===u.geometryType||"multipatch"===u.geometryType,I=u.capabilities?.data?.supportsZ&&!S;if(w.returnZ=I&&!1!==g,w.returnGeometry=!0,w.multipatchOption=S?"xyFootprint":null,b&&(w.outFields=b),s)w.geometry=s;else if(a.key)w.objectIds=[a.key];else{const e=n.searchFields||[f];if(!ae(u,e))throw J().error("invalid-field: search field is invalid."),new L.A("getResults():invalid-field","search field is invalid.");ne(u)&&(w.num=r),y&&(w.geometry=y);const t=a.text?.trim();if(!t)return[];const s=a.text,{prefix:o="",suffix:l=""}=n,c=ue(`${o}${s}${l}`);oe(u)&&se(u,e)&&!i&&s&&(w.fullText=re({text:s,searchFields:e}));const p=pe({searchTerm:c,layer:u,searchFields:e,filter:d,exactMatch:i,query:w,type:"search"});if(w.where=p,!ie(w))return[]}return u.queryFeatures(w,{signal:m}).then((e=>function(e,t,i,s,r,o,n){return e.features.map((e=>ye(e,t,i,s,r,o,n)))}(e,c,n,l,f,h,p)))}))}function Y(e,t){const{source:i,spatialReference:s,view:r,suggestTerm:o,maxSuggestions:n,sourceIndex:l,exactMatch:a}=e,{layer:c,filter:u}=i,d=t?.signal,p=X(i,r);return te(c).then((()=>{if(!ne(c))return[];const e=le(i),t=i.searchFields||[e],r=[];i.suggestionTemplate?i.suggestionTemplate.replaceAll(W,((e,t)=>(r.push(t),e))):r.push(e);const h=ee(r);r.includes(c.objectIdField)||h||r.push(c.objectIdField);const y=ce(c,e),m=h||ae(c,r),g=ae(c,t);if(!y)throw J().error("invalid-field: displayField is invalid."),new L.A("getSuggestions():invalid-field","displayField is invalid.");if(!m)throw J().error("invalid-field: outField is invalid."),new L.A("getSuggestions():invalid-field","outField is invalid.");if(!g)throw J().error("invalid-field: search field is invalid."),new L.A("getSuggestions():invalid-field","search field is invalid.");const f=c.createQuery(),{orderByFields:v}=i;if(v&&(f.orderByFields=v),f.outSpatialReference=s,f.returnGeometry=!1,f.num=n,f.outFields=r,p&&(f.geometry=p),!o.trim())return[];const{prefix:b="",suffix:_=""}=i,w=ue(`${b}${o}${_}`);oe(c)&&se(c,t)&&!a&&o&&(f.fullText=re({text:o,searchFields:t}));const M=pe({searchTerm:w,layer:c,searchFields:t,filter:u,exactMatch:a,query:f,type:"suggest"});return f.where=M,ie(f)?c.queryFeatures(f,{signal:d}).then((t=>function(e,t,i,s){return e.features.map((e=>function(e,t,i,s){const r=e.sourceLayer,{attributes:o}=e,{objectIdField:n}=r,l=n?o[n]:null;return{text:he(e,t.suggestionTemplate,s),key:l,sourceIndex:i}}(e,t,i,s)))}(t,i,l,e))):[]}))}function X(e,t){const{filter:i,withinViewEnabled:s}=e,r=t?.extent,o=i?.geometry;return o??(s&&r?r:void 0)}function ee(e){return e&&e.includes("*")}async function te(e){e&&await e.load()}function ie(e){return!(!e.fullText&&!e.where)}function se(e,t){const i=e?.indexes;return!(!i||!t?.length)&&i.filter((e=>"FullText"===e.indexType)).some((e=>{const i=e.fields?.split(",").map((e=>e.trim().toLowerCase()))||[];return t.every((e=>i.includes(e.toLowerCase())))}))}function re({text:e,searchFields:t}){return e.trim().split(" ").filter((e=>!!e.trim())).map((e=>new K.A({onFields:t,searchTerm:e,searchType:"prefix"})))}function oe(e){return e?.capabilities?.query?.supportsFullTextSearch??!1}function ne(e){return e?.capabilities?.query?.supportsPagination??!1}function le(e){return e.displayField||e.layer.displayField||function(e){return e?.fieldsIndex?.fields?.find((e=>"string"===e.type))?.name??""}(e.layer)}function ae(e,t){return!(!e||!t?.length)&&t.every((t=>ce(e,t)))}function ce(e,t){return!!e.getField(t)}function ue(e){return e.replaceAll("'","''")}function de(e,t){const i=t?.where;return i?`(${e}) AND (${i})`:e}function pe({searchTerm:e,layer:t,searchFields:i,filter:s,exactMatch:r,query:o,type:l}){const{definitionExpression:a,url:c}=t;let u="";return!o.fullText&&e&&i&&i.forEach((i=>{const o=t.getField(i),a=t.getFieldDomain?.(i,{excludeImpliedDomains:(0,d.A)("esri-widget-legacy-field-domain-calculation")}),p=(a&&"coded-value"===a.type?function({codedValues:e},t,i){return(0,n.Pb)(e??[],(e=>{const s=e.name,r=i?s:s.toLowerCase();return(i?t:t.toLowerCase())===r?e.code.toString():null}))??null}(a,e,r):null)||e||null;if(null!==p){const e=function({currentTerm:e,field:t,filter:i,exactMatch:s,url:r,type:o}){const n=t?.type,l=t?.name;if("string"===n||"date"===n||"global-id"===n){const t=H.test(r??""),n=t&&function(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(e)?"N":"";return de(s&&"search"===o?`${l} = ${n}'${e}'`:t?`${l} LIKE ${n}'${e}%'`:`LOWER(${l}) LIKE ${n}'${e.toLowerCase()}%'`,i)}if("oid"===n||"small-integer"===n||"integer"===n||"single"===n||"double"===n){const t=Number(e);return isNaN(t)?null:de(`${l} = ${t}`,i)}return de(`${l} = ${e}`,i)}({currentTerm:p,field:o,filter:s,exactMatch:r,url:c,type:l});e&&(u+=function(e,t){return e?` OR (${t})`:`(${t})`}(u,e))}})),a&&u?`(${a}) AND (${u})`:a||u}function he(e,t,i){const s=e.sourceLayer,{attributes:r}=e,o=s.getFieldDomain?.(i,{feature:e,excludeImpliedDomains:(0,d.A)("esri-widget-legacy-field-domain-calculation")});if(t)return(0,U.V)(t,r);if(i&&r){const e=s.getField(i),t=function(e,t){return e[t]??e[Object.keys(e).find((e=>e.toLowerCase()===t.toLowerCase()))]}(r,i);return null==t?"":o&&"coded-value"===o.type?function(e,t){let i=null;const{codedValues:s}=e;return s&&s.length&&s.some((e=>e.code===t&&(i=e.name,!0))),i}(o,t)??"":"date"===e?.type?(0,q.Yq)(new Date(t)):"number"==typeof t?t.toString():"string"!=typeof t?"":t.trim()}return""}function ye(e,t,i,s,r,o,n){const l=e.clone();l.layer=e.layer;const a=e.sourceLayer,c=a?.objectIdField,u=c?e.attributes[c]:null,d=he(e,i.searchTemplate,r);null!=o&&function(e){return null!=e&&null!=e.minScale&&null!=e.maxScale}(a)&&(a.minScale&&a.minScale<o?o=a.minScale:a.maxScale&&a.maxScale>o&&(o=a.maxScale));const p=l.geometry?(0,C.ZY)(l.geometry,t??void 0,o??void 0):void 0,h="number"==typeof n&&p?(0,C.DN)((0,N.o8)(p),t??void 0,n):p,y=e.clone();return y.layer=e.layer,null!=h&&(y.geometry=z.A.fromExtent(h)),{extent:h,target:y,feature:l,key:u,name:d,sourceIndex:s}}var me;let ge=me=class extends j{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,t)=>Q({source:this,...e},t),this.getSuggestions=(e,t)=>Y({source:this,...e},t)}set layer(e){this._set("layer",e),e&&e.load().catch((()=>{}))}get name(){return this._getLayerTitle()??""}set name(e){this._overrideIfSome("name",e)}clone(){return new me({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,N.o8)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?(0,N.o8)(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){return this.layer.fieldsIndex?.fields.find((e=>"string"===e.type))?.name??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map((t=>{const i=e.getField(t);return i?.alias||t})).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};(0,s._)([(0,u.MZ)({json:{read:{source:"field.name"},write:{target:"field.name"}}})],ge.prototype,"displayField",void 0),(0,s._)([(0,u.MZ)({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],ge.prototype,"exactMatch",void 0),(0,s._)([(0,u.MZ)({value:null})],ge.prototype,"layer",null),(0,s._)([(0,u.MZ)()],ge.prototype,"name",null),(0,s._)([(0,u.MZ)({type:[String],json:{write:!0}})],ge.prototype,"orderByFields",void 0),(0,s._)([(0,u.MZ)()],ge.prototype,"searchFields",void 0),(0,s._)([(0,u.MZ)()],ge.prototype,"searchTemplate",void 0),(0,s._)([(0,u.MZ)()],ge.prototype,"suggestionTemplate",void 0),ge=me=(0,s._)([(0,p.$)("esri.widgets.Search.LayerSearchSource")],ge);const fe=ge;var ve=i(86394),be=i(11499);var _e=i(84698);let we=class extends V.A{constructor(e){super(e),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};(0,s._)([(0,u.MZ)({type:String,json:{write:!0}})],we.prototype,"address",void 0),(0,s._)([(0,u.MZ)({type:Object,json:{write:!0}})],we.prototype,"attributes",void 0),(0,s._)([(0,u.MZ)({type:_e.A,json:{write:!0}})],we.prototype,"extent",void 0),(0,s._)([(0,u.MZ)({type:A.A,json:{write:!0}})],we.prototype,"location",void 0),(0,s._)([(0,u.MZ)({type:Number,json:{write:!0}})],we.prototype,"score",void 0),we=(0,s._)([(0,p.$)("esri.rest.support.AddressCandidate")],we);const Me=we;var Se=i(73446),Le=i(12188);let Ie=class extends V.A{constructor(e){super(e),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};(0,s._)([(0,u.MZ)({type:Object,json:{write:!0}})],Ie.prototype,"address",void 0),(0,s._)([(0,u.MZ)(Le.K)],Ie.prototype,"apiKey",void 0),(0,s._)([(0,u.MZ)({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],Ie.prototype,"categories",void 0),(0,s._)([(0,u.MZ)({type:String,json:{write:!0}})],Ie.prototype,"countryCode",void 0),(0,s._)([(0,u.MZ)({type:Boolean,json:{write:!0}})],Ie.prototype,"forStorage",void 0),(0,s._)([(0,u.MZ)({type:A.A,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],Ie.prototype,"location",void 0),(0,s._)([(0,u.MZ)({type:["rooftop","street"],json:{write:!0}})],Ie.prototype,"locationType",void 0),(0,s._)([(0,u.MZ)({type:String,json:{write:!0}})],Ie.prototype,"magicKey",void 0),(0,s._)([(0,u.MZ)({type:Number,json:{write:!0}})],Ie.prototype,"maxLocations",void 0),(0,s._)([(0,u.MZ)({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],Ie.prototype,"outFields",void 0),(0,s._)([(0,u.MZ)({type:x.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ie.prototype,"outSpatialReference",void 0),(0,s._)([(0,u.MZ)({type:_e.A,json:{write:{writer:(e,t)=>{const i=e?e.shiftCentralMeridian():null;t.searchExtent=i}}}})],Ie.prototype,"searchExtent",void 0),Ie=(0,s._)([(0,p.$)("esri.rest.support.AddressToLocationsParameters")],Ie),Ie.from=(0,Se.dp)(Ie);const Ae=Ie;function xe({data:e}){if(!e)return[];const{candidates:t,spatialReference:i}=e;return t?t.map((e=>{if(!e)return;const{extent:t,location:s}=e,r=!t||function(e){return e&&"number"==typeof e.xmin&&"number"==typeof e.ymin&&"number"==typeof e.xmax&&"number"==typeof e.ymax}(t);return function(e){return!!e&&"number"==typeof e.x&&"number"==typeof e.y}(s)&&r?(t&&(t.spatialReference=i),s&&(s.spatialReference=i),Me.fromJSON(e)):void 0})):[]}let Ce=class extends V.A{constructor(e){super(e),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};(0,s._)([(0,u.MZ)(Le.K)],Ce.prototype,"apiKey",void 0),(0,s._)([(0,u.MZ)({type:A.A,json:{write:{writer:(e,t)=>{const i=e?e.clone().normalize():null,s=void 0!==i;t.location=s?i:null}}}})],Ce.prototype,"location",void 0),(0,s._)([(0,u.MZ)({type:["street","rooftop"],json:{write:!0}})],Ce.prototype,"locationType",void 0),(0,s._)([(0,u.MZ)({type:x.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ce.prototype,"outSpatialReference",void 0),Ce=(0,s._)([(0,p.$)("esri.rest.support.LocationToAddressParameters")],Ce),Ce.from=(0,Se.dp)(Ce);const Te=Ce;async function Ee(e,t,i){t=Te.from(t);const s=(0,be.Dl)(e),r={...t.toJSON(),f:"json"},o=(0,be.lF)({...s.query,...r}),n=(0,be.jV)(o,i),l=`${s.path}/reverseGeocode`;return(0,ve.A)(l,n).then(Fe)}function Fe({data:e}){if(!e)return;const{address:t,location:i}=e,s=t?.Match_addr||"";return Me.fromJSON({address:s,attributes:t||{},location:i,score:100})}let Re=class extends V.A{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};(0,s._)([(0,u.MZ)({type:Boolean,json:{write:!0}})],Re.prototype,"isCollection",void 0),(0,s._)([(0,u.MZ)({type:String,json:{write:!0}})],Re.prototype,"magicKey",void 0),(0,s._)([(0,u.MZ)({type:String,json:{write:!0}})],Re.prototype,"text",void 0),Re=(0,s._)([(0,p.$)("esri.rest.support.SuggestionCandidate")],Re);const Ze=Re;let Oe=class extends V.A{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};(0,s._)([(0,u.MZ)(Le.K)],Oe.prototype,"apiKey",void 0),(0,s._)([(0,u.MZ)({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],Oe.prototype,"categories",void 0),(0,s._)([(0,u.MZ)({type:String,json:{write:!0}})],Oe.prototype,"countryCode",void 0),(0,s._)([(0,u.MZ)({type:A.A,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],Oe.prototype,"location",void 0),(0,s._)([(0,u.MZ)({type:Number,json:{write:!0}})],Oe.prototype,"maxSuggestions",void 0),(0,s._)([(0,u.MZ)({type:x.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Oe.prototype,"outSpatialReference",void 0),(0,s._)([(0,u.MZ)({type:_e.A,json:{write:{writer:(e,t)=>{const i=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(i)}}}})],Oe.prototype,"searchExtent",void 0),(0,s._)([(0,u.MZ)({type:String,json:{write:!0}})],Oe.prototype,"text",void 0),Oe=(0,s._)([(0,p.$)("esri.rest.support.SuggestLocationsParameters")],Oe),Oe.from=(0,Se.dp)(Oe);const Pe=Oe;function ke(e){const{data:t}=e;if(!t)return[];const{suggestions:i}=t;return i?i.map((e=>new Ze(e))):[]}const De="Single Line Input";function Ne(e,t){return e.location?async function(e,t){const{source:i,spatialReference:s,location:r,sourceIndex:o,view:n}=e,{apiKey:l,url:a,zoomScale:c,defaultZoomScale:u}=i;if(null==a)return[];const d=n?.scale,p=t?.signal,h=new Te({location:r});l&&(h.apiKey=l),s&&(h.outSpatialReference=s);try{return Ge([await Ee(a,h,{signal:p})],{sourceIndex:o,scale:d,view:n,zoomScale:c,defaultZoomScale:u})}catch(X){return[]}}(e,t):async function(e,t){const{source:i,suggestResult:s,spatialReference:r,view:o,maxResults:n,sourceIndex:l}=e,a=i?.zoomScale,c=i?.defaultZoomScale,u=s.text?.trim();if(!u)return null;const d=!s.key&&i.prefix?i.prefix:"",p=!s.key&&i.suffix?i.suffix:"",h=`${d}${s.text}${p}`,y=new Ae,{apiKey:m,url:g}=i,f=o?.scale,v=je(i,o),b=t?.signal;if(m&&(y.apiKey=m),!g)return null;i.categories&&(y.categories=i.categories),i.locationType&&(y.locationType=i.locationType),r&&(y.outSpatialReference=r);const _=$e(o,i);_&&(y.location=_),y.maxLocations=n,v&&(y.searchExtent=v),i.countryCode&&(y.countryCode=i.countryCode);const{key:w}=s,M=`${w}`;return w&&(y.magicKey=M),y.address={},y.address[i.singleLineFieldName||De]=h,i.outFields&&(y.outFields=i.outFields),async function(e,t,i){t=Ae.from(t);const s=(0,be.Dl)(e),{address:r,...o}=t.toJSON(),n={...r,...o,f:"json"},l=(0,be.lF)({...s.query,...n}),a=(0,be.jV)(l,i),c=`${s.path}/findAddressCandidates`;return(0,ve.A)(c,a).then(xe)}(g,y,{signal:b}).then((e=>Ge(e,{key:M,scale:f,sourceIndex:l,view:o,zoomScale:a,defaultZoomScale:c})))}(e,t)}function $e(e,t){if(t.localSearchDisabled)return null;const i=e?.scale;return"number"==typeof i&&i<=3e5?e?.extent?.center:null}async function Ve(e,t){const{source:i,spatialReference:s,view:r,suggestTerm:o,maxSuggestions:n,sourceIndex:l}=e,a=new Pe,{apiKey:c,url:u}=i,d=je(i,r),p=t?.signal;if(!u)return null;c&&(a.apiKey=c),i.categories&&(a.categories=i.categories),s&&(a.outSpatialReference=s);const h=$e(r,i);if(h&&(a.location=h),!o.trim())return null;const{prefix:y="",suffix:m=""}=i,g=`${y}${o}${m}`;return a.text=g,d&&(a.searchExtent=d),a.maxSuggestions=n,i.countryCode&&(a.countryCode=i.countryCode),async function(e,t,i){const s=(0,be.Dl)(e),r={...(t=Pe.from(t)).toJSON(),f:"json"},o=(0,be.lF)({...s.query,...r}),n=(0,be.jV)(o,i),l=`${s.path}/suggest`;return(0,ve.A)(l,n).then(ke)}(u,a,{signal:p}).then((e=>function(e,t){return e.map((e=>function(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}(e,t)))}(e,l)))}function Be(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function je(e,t){const{filter:i,withinViewEnabled:s}=e,r=t?.scale,o=t?.extent,n=i?.geometry;return(n?(0,C.ZY)(n,t??void 0,r):void 0)||(s&&o?o:void 0)}function Ge(e,t){return e.filter(Boolean).map((e=>function(e,t){const{key:i,scale:s,sourceIndex:r,view:o,zoomScale:n,defaultZoomScale:l}=t,{attributes:a,extent:c,location:u,address:d}=e,p=new b.A({geometry:u,attributes:a}),h=c||u,y=h?(0,C.ZY)(h,o??void 0,s??void 0):void 0,m=y?"number"==typeof n?(0,C.DN)(y,o??void 0,n):"number"==typeof l&&"point"===h?.type?(0,C.DN)(y,o??void 0,l):y:null,g=u?`${u.x},${u.y}`:"",f=d||g,v=p.clone();return null!=m&&(v.geometry=z.A.fromExtent(m)),{extent:m,feature:p,target:v,key:i,name:f,sourceIndex:r}}(e,t)))}var ze;let Ke=ze=class extends j{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(e,t)=>Ne({source:this,...e},t),this.getSuggestions=(e,t)=>Ve({source:this,...e},t)}clone(){return new ze({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,N.o8)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?(0,N.o8)(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};(0,s._)([(0,u.MZ)()],Ke.prototype,"apiKey",void 0),(0,s._)([(0,u.MZ)()],Ke.prototype,"categories",void 0),(0,s._)([(0,u.MZ)()],Ke.prototype,"countryCode",void 0),(0,s._)([(0,u.MZ)({json:{write:!0}})],Ke.prototype,"defaultZoomScale",void 0),(0,s._)([(0,u.MZ)()],Ke.prototype,"localSearchDisabled",void 0),(0,s._)([(0,u.MZ)()],Ke.prototype,"locationType",void 0),(0,s._)([(0,u.MZ)({json:{write:!0}})],Ke.prototype,"name",void 0),(0,s._)([(0,u.MZ)({json:{write:!0}})],Ke.prototype,"placeholder",void 0),(0,s._)([(0,u.MZ)()],Ke.prototype,"searchTemplate",void 0),(0,s._)([(0,u.MZ)({json:{write:!0}})],Ke.prototype,"singleLineFieldName",void 0),(0,s._)([(0,u.MZ)({json:{read:{source:"suggest"},write:{target:"suggest"}}})],Ke.prototype,"suggestionsEnabled",void 0),(0,s._)([(0,u.MZ)({json:{write:!0}})],Ke.prototype,"url",void 0),(0,s._)([(0,u.MZ)({json:{write:!0}})],Ke.prototype,"zoomScale",void 0),Ke=ze=(0,s._)([(0,p.$)("esri.widgets.Search.LocatorSearchSource")],Ke);const Ue=Ke;var qe=i(21121),He=i(96082),We=i(70727),Je=i(72387);const Qe=()=>o.A.getLogger("esri.widgets.support.geolocationUtils"),Ye={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function Xe(){return function(){const e=!!(0,d.A)("esri-geolocation");return e||Qe().warn("geolocation-unsupported","Geolocation unsupported."),e}()&&function(){const e=window.isSecureContext;return e||Qe().warnOnce("insecure-context","Geolocation requires a secure origin."),e}()}let et;function tt(e,t){if(et)return et(e,t);const{position:i,view:s}=e,r=function(e){const t=e&&e.coords||{},i={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed,toJSON:()=>({})};return e?{coords:i,timestamp:e.timestamp,toJSON:()=>({})}:e}(i),o=r?.coords;if(!o)throw new L.A("geometry-service:no-coords","Geolocation has no coordinates");return function(e,t,i){if(!t)return Promise.resolve(e);const s=t.spatialReference;return s.isWGS84?Promise.resolve(e):s.isWebMercator?Promise.resolve((0,He.Gh)(e)):function(e){if(qe.A.geometryServiceUrl)return Promise.resolve(qe.A.geometryServiceUrl);const t=F.A.getDefault();return t.load(e).catch((()=>{})).then((()=>t.helperServices?.geometry?.url))}(i).then((t=>{if(!t)throw new L.A("geometry-service:missing-url","Geometry service URL is missing");const r=new Je.A({geometries:[e],outSpatialReference:s});return(0,We.C)(t,r,i).then((e=>e[0]))}))}(function({longitude:e,latitude:t,altitude:i}){return new A.A({longitude:e,latitude:t,z:i||void 0,spatialReference:{wkid:4326}})}(o),s,t)}var it=i(57328);function st(e,t){return e.hasOwnProperty(t)&&null!=e[t]&&""!==e[t]}const rt="highlight",ot=S.A.ofType({key:e=>e.layer?"layer":"locator",base:j,typeMap:{layer:fe,locator:Ue}}),nt=x.A.WGS84,lt=/<[\s\S]*?>/g,at=-1;let ct=class extends((0,it.A)(I.A.EventedMixin(w.A))){constructor(e){super(e),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new ot,this.defaultSymbols={point:new Z.A({url:(0,v.s)("esri/images/search/search-symbol-32.png"),size:24,width:24,height:24}),polyline:new P.A({color:[130,130,130,1],width:2}),polygon:new O.A({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=F.A.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new ot,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const e=await(0,E.ud)("esri/widgets/Search/t9n/Search");this.messages=e,this.defaultPopupTemplate=new _.A({title:e.searchResult,content:"{Match_addr}"})};e(),this.addHandles([(0,a.wB)((()=>[this.includeDefaultSources,this.view,this.portal]),(()=>this._update()),a.Vh),(0,T.oQ)(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}static{this.ALL_INDEX=at}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return 1!==this.allSources.length&&this.searchAllEnabled?at:0}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){return this.messages?.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:i}=this,s="function"==typeof i?i.call(null,{sources:e,defaultSources:t}):i?t.concat(e):e,r=this._get("allSources")||new ot;return r.removeAll(),r.addMany(s.filter(Boolean)),r}get locationEnabled(){return this._get("locationEnabled")||Xe()}set locationEnabled(e){if(void 0===e)return void this._clearOverride("locationEnabled");const t=Xe();if(e&&!t){const e=new L.A("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});o.A.getLogger(this).error(e)}this._override("locationEnabled",!!e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:i}=this;if(t===at)return i??"";const s=e.at(t);return s?.placeholder??""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),""===e&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();const{view:e,resultGraphic:t}=this;e&&t&&e.graphics.remove(t),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const i=this._createSuggestionForSearch(e),s=(async()=>{try{await this.when();const e=await this._getResultsFromSources(i,t);if(t?.signal?.aborted)return null;const s={activeSourceIndex:this.activeSourceIndex,searchTerm:i.text??"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(s,e,i);const r=this._getFirstResult(s.results),o=i.location&&r?r.name:i.text,n=o?.replace(lt,"");return this._set("searchTerm",n),(i.key&&"number"==typeof i.sourceIndex||i.location)&&this._set("selectedSuggestion",i),this._set("results",s.results),this._set("resultCount",s.results.reduce(((e,t)=>e+(t.results?.length??0)),0)),this.emit("search-complete",s),await this._selectFirstResult(r),s}finally{this._clearSearching()}})();return this._searching=s,s}async searchNearby(e){if(!this.locationEnabled){const e=new L.A("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw o.A.getLogger(this).error(e),e}const t=(async()=>{try{const t=await function(e){return e??=Ye,new Promise(((t,i)=>{setTimeout((()=>i(new L.A("geolocation:timeout","getting the current geolocation position timed out"))),15e3),navigator.geolocation.getCurrentPosition(t,i,e??void 0)}))}(),i=await tt({position:t,view:this.view},e);return await this.search(i,e)}finally{this._clearSearching()}})();return this._searching=t,t}async select(e){if(this.clearGraphics(),!e){const t=new L.A("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});throw o.A.getLogger(this).error(t),t}const{view:t}=this,i=st(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),s=null!=i?this.allSources.at(i):null;if(!s){const e=new L.A("select:missing-source","Cannot select without a source.",{source:s});throw o.A.getLogger(this).error(e),e}const r=s instanceof fe?this._getLayerSourcePopupTemplate(s):s.popupTemplate,n=s.resultSymbol||this._getDefaultSymbol(e),a=st(s,"resultGraphicEnabled")?s.resultGraphicEnabled:this.resultGraphicEnabled,c=st(s,"autoNavigate")?s.autoNavigate:this.autoNavigate,u=st(s,"popupEnabled")?s.popupEnabled:this.popupEnabled,d=u?r||this.popupTemplate||this.defaultPopupTemplate:null,{feature:p}=e;if(!p){const e=new L.A("select:missing-feature","Cannot select without a feature.",{feature:p});throw o.A.getLogger(this).error(e),e}const{attributes:h,geometry:y,layer:m,sourceLayer:g}=p,f=y?(0,C.z8)(y):null,v={layerViewQuery:this._getLayerView(p),elevationQuery:t&&null!=f?(0,C.Sv)(f,t):Promise.resolve(f)},_=await(0,l.Lx)(v),w=_.layerViewQuery.value,M=_.elevationQuery.value;n instanceof k.A&&(n.text=e.name);const S=t&&c?e.target||e.extent:null,I=null!=S?this._goToSearchResult(S):Promise.resolve();await I;const A=w?p:new b.A({geometry:y,symbol:n,attributes:h,layer:m,sourceLayer:g,popupTemplate:d}),x=t?.popup,T=x&&u&&A.getEffectivePopupTemplate(x.defaultPopupTemplateEnabled);return T&&await t.openPopup({features:[A],location:M}),w&&(0,D.Of)(w)&&!T&&this._highlightFeature({graphic:A,layerView:w}),!w&&a&&t&&t.graphics.push(A),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",A),this.emit("select-result",{result:e,source:s,sourceIndex:i}),e}async suggest(e,t,i){const s=e||this.searchTerm;this.emit("suggest-start",{searchTerm:s}),await this._suggestTimer(t,i);const r=await this._suggestImmediate(s,i);return this._set("suggestions",r?.results),this._set("suggestionCount",r?.results.reduce(((e,t)=>e+(t.results?.length??0)),0)??null),this.emit("suggest-complete",r),r}async when(){await(0,a.C_)((()=>!this.updating))}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const i=this._updatingPromise=(0,l.Lx)([e?.load(),t?.when()]);if(this.destroyed)return;if(await i,i!==this._updatingPromise)return}await(0,a.C_)((()=>this.messages)),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){const e=this.portal?.helperServices?.geocode;return e?e.map((e=>{if(!1===e.placefinding)return;const t=Be(e.url)&&(0,R.Jn)(e.url)?{url:"https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer"}:null,i=Ue.fromJSON({...e,...t}),s=i.url;if(Be(s)||function(e){return!!e&&/(?:\/servers\/[\da-z.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}(s)||function(e){return!!e&&/(?:geocode-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}(s)){const e=i.outFields??["Addr_type","Match_addr","StAddr","City"],t=(i.placeholder||this.messages?.placeholder)??"",s="number"==typeof i.defaultZoomScale?i.defaultZoomScale:2500;i.singleLineFieldName="SingleLine",i.outFields=e,i.placeholder=t,i.defaultZoomScale=s}return i.singleLineFieldName?i:void 0})).filter(M.Ru):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach((e=>e?.destroy())),this._createdFeatureLayers=[]}_getLayerSources(e,t){const i=this.view?.map;return e.map((e=>{const s=i.findLayerById(e.id);if(!s)return;const r=this._getLayerJSON(e),o=fe.fromJSON(r);return o.placeholder=t,this._getLayer(s,r).then((e=>{o.layer=e})),o})).filter(M.Ru).toArray()}_getTableSources(e,t){const i=this.view?.map;return e.map((e=>{if(!e.id)return;const s=i.findTableById(e.id);if(!s)return;const r=this._getLayerJSON(e),o=fe.fromJSON(r);return o.placeholder=t,this._getLayer(s,r).then((e=>{o.layer=e})),o})).filter(M.Ru).toArray()}_convertApplicationProperties(){const e=this.view?.map,t=e?.applicationProperties?.viewing?.search;if(!t)return[];const{enabled:i,hintText:s,layers:r,tables:o}=t;return i?[...this._getLayerSources(r,s),...this._getTableSources(o,s)]:[]}async _getSubLayer(e,t){if(await e.load(),!e.allSublayers)throw new Error;const i=e.allSublayers.find((e=>e.id===t.subLayer));if(!i)throw new Error;const s=await(i.createFeatureLayer?.());if(!s)throw new Error;return this._createdFeatureLayers.push(s),s}async _getBuildingSubLayer(e,t){await e.load();const i=e.allSublayers.find((e=>e.id===t.subLayer));if("building-component"!==i?.type)throw new Error;if(await i.load(),null==i.associatedLayer)throw new Error;return await i.associatedLayer.load(),i}async _getLayer(e,t){if("feature"===e.type||"scene"===e.type||"csv"===e.type||"geojson"===e.type||"ogc-feature"===e.type)return e;if("map-image"===e.type)try{return await this._getSubLayer(e,t)}catch(f){const i=new L.A("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return o.A.getLogger(this).error(i),null}return"building-scene"===e.type?this._getBuildingSubLayer(e,t):null}_getLayerJSON(e){return"function"==typeof e.toJSON?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){const e=this.view?.popup,{resultGraphic:t}=this;if(!e||!t)return;const i="selectedFeature"in e,s=i?e.selectedFeature:null;i&&s&&s===t&&e.close()}_suggestTimer(e,t){const i=null!=e?e:this.suggestionDelay;return(0,l.Pl)(i,null,t?.signal)}_createLocationForSearch(e){return e instanceof b.A&&e.geometry?(0,C.z8)(e.geometry):e instanceof A.A?e:Array.isArray(e)&&2===e.length?new A.A({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&st(e,"key")&&st(e,"text")&&st(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),i="string"==typeof e?e:this.searchTerm,{selectedSuggestion:s,selectedResult:r}=this,o=!e&&s&&r,n=o&&s.key===r.key&&s.sourceIndex===r.sourceIndex,l=o&&s.location;return n||l?s:{location:t,text:t?"":i,sourceIndex:null,key:null}}_getFirstResult(e){return(0,n.Pb)(e,(({results:e})=>e?.[0]))??null}async _selectFirstResult(e){return this.autoSelect&&e?this.select(e):null}async _suggestImmediate(e,t){await this.when();const i=await this._getSuggestionsFromSources(e,t);if(t?.signal?.aborted)return null;const s={activeSourceIndex:this.activeSourceIndex,searchTerm:e??"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(s,i),s}_formatSourceResponse(e,t,i){const s=t?.value||[],r=t?.error,n=this.allSources.at(i);if(r){const t={sourceIndex:i,source:n,error:r};e.errors.push(t),o.A.getLogger(this).error(r),e.numErrors++}else{const t={sourceIndex:i,source:n,results:s};e.results.push(t),e.numResults+=s.length}}_formatResponse(e,t,i){if(t)if(e.activeSourceIndex===at){const s=i&&st(i,"sourceIndex")&&-1!==i.sourceIndex?i.sourceIndex:void 0;t.forEach(((t,i)=>{const r=void 0!==s?s:i;this._formatSourceResponse(e,t,r)}))}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}async _getResultsFromSources(e,t){const{allSources:i}=this,s=!e.location&&st(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,r=[];if(!i.length){const e=new L.A("search:no-sources-defined","At least one source is required.",{allSources:i});throw o.A.getLogger(this).error(e),e}return s===at?i.forEach(((i,s)=>{r.push(this._getResultsFromSource(e,s,t))})):r.push(this._getResultsFromSource(e,s,t)),(0,l.Lx)(r)}async _getSuggestionsFromSources(e,t){const{allSources:i,activeSourceIndex:s}=this,r=[];if(!i.length){const e=new L.A("suggest:no-sources-defined","At least one source is required.",{allSources:i});throw o.A.getLogger(this).error(e),e}return s===at?i.forEach(((i,s)=>{r.push(this._getSuggestionsFromSource(e,s,t))})):r.push(this._getSuggestionsFromSource(e,s,t)),(0,l.Lx)(r)}async _getResultsFromSource(e,t,i){const s=null!=t?this.allSources.at(t):null;if(!s)return null;const{location:r=null}=e,o=this.view?.spatialReference||nt,n=st(s,"maxResults")?s.maxResults:this.maxResults,l=!!(s instanceof fe&&st(s,"exactMatch"))&&s.exactMatch,{view:a}=this;return s.getResults?.({view:a,sourceIndex:t,location:r,suggestResult:e,spatialReference:o,exactMatch:l,maxResults:n},i)}async _getSuggestionsFromSource(e,t,i){const s=this.allSources.at(t);if(!s)return null;e??="";const r=st(s,"suggestionsEnabled")?s.suggestionsEnabled:this.suggestionsEnabled,o=e?.length,n=st(s,"minSuggestCharacters")?s.minSuggestCharacters:this.minSuggestCharacters;if(r&&e.trim()&&o>=n){const r=this.view?.spatialReference||nt,o=st(s,"maxSuggestions")?s.maxSuggestions:this.maxSuggestions,{view:n}=this,l=!!(s instanceof fe&&st(s,"exactMatch"))&&s.exactMatch;return s.getSuggestions?.({view:n,sourceIndex:t,suggestTerm:e,spatialReference:r,maxSuggestions:o,exactMatch:l},i)}return null}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return st(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){return(0,n.Pb)(this.results??[],(({results:t,sourceIndex:i})=>{const s=t?.includes(e);return s?i:null}))??null}async _goToSearchResult(e){this._abortGoTo();const t=new AbortController;this._gotoController=t;const i={target:{target:e},options:{signal:t.signal}};e||(i.options.animate=!1),await this.callGoTo(i),this._gotoController=null}_getDefaultSymbol(e){const{defaultSymbols:t}=this,i=e.feature?.geometry;if(null==i)return null;switch(i.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this.removeHandles(rt)}async _getLayerView(e){const{view:t}=this;if(!e||!t)return null;const{layer:i,sourceLayer:s}=e,r=i??s;return r&&"building-component"!==r.type&&"subtype-sublayer"!==r.type?(await t.when(),t.whenLayerView(r)):null}_highlightFeature(e){const{graphic:t,layerView:i}=e,{attributes:s,layer:r,sourceLayer:o}=t,n=r??o,{objectIdField:l}=n,a=(l&&s?.[l])??null,c=i.highlight(a??t);this.addHandles(c,rt)}_setResultFloor(e){const{view:t}=this,i=e.feature?.attributes,s=e.feature?.sourceLayer;if(s&&"floorInfo"in s&&s?.floorInfo?.floorField&&i){const e=i[s.floorInfo.floorField];t?.emit("select-result-floor",e)}}};(0,s._)([(0,u.MZ)()],ct.prototype,"_searching",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"_updatingPromise",void 0),(0,s._)([(0,u.MZ)({readOnly:!0,value:null})],ct.prototype,"activeSource",null),(0,s._)([(0,u.MZ)()],ct.prototype,"activeSourceIndex",null),(0,s._)([(0,u.MZ)()],ct.prototype,"allPlaceholder",null),(0,s._)([(0,u.MZ)({readOnly:!0})],ct.prototype,"allSources",null),(0,s._)([(0,u.MZ)()],ct.prototype,"autoNavigate",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"autoSelect",void 0),(0,s._)([(0,u.MZ)({type:_.A})],ct.prototype,"defaultPopupTemplate",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],ct.prototype,"defaultSources",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"defaultSymbols",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"includeDefaultSources",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"locationEnabled",null),(0,s._)([(0,u.MZ)()],ct.prototype,"maxInputLength",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"maxResults",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"maxSuggestions",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"messages",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"minSuggestCharacters",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],ct.prototype,"placeholder",null),(0,s._)([(0,u.MZ)()],ct.prototype,"popupEnabled",void 0),(0,s._)([(0,u.MZ)({type:_.A})],ct.prototype,"popupTemplate",void 0),(0,s._)([(0,u.MZ)({type:F.A})],ct.prototype,"portal",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"resultCount",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"resultGraphicEnabled",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],ct.prototype,"resultGraphic",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],ct.prototype,"results",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],ct.prototype,"selectedSuggestion",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"searchAllEnabled",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],ct.prototype,"selectedResult",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"searchTerm",null),(0,s._)([(0,u.MZ)({type:ot})],ct.prototype,"sources",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],ct.prototype,"state",null),(0,s._)([(0,u.MZ)()],ct.prototype,"suggestionDelay",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"suggestionCount",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],ct.prototype,"suggestions",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"suggestionsEnabled",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],ct.prototype,"updating",null),(0,s._)([(0,u.MZ)()],ct.prototype,"view",void 0),(0,s._)([(0,u.MZ)()],ct.prototype,"clear",null),ct=(0,s._)([(0,p.$)("esri.widgets.Search.SearchViewModel")],ct);const ut=ct;var dt=i(17199),pt=i(35251),ht=(i(99484),i(43955)),yt=i(96704);let mt=class extends h.A{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}loadDependencies(){return(0,dt.W)({block:()=>Promise.all([i.e(72076),i.e(50246),i.e(62776)]).then(i.bind(i,62776)),list:()=>Promise.all([i.e(72076),i.e(62614),i.e(7311),i.e(22678)]).then(i.bind(i,22678)),"list-item":()=>Promise.all([i.e(72076),i.e(50246),i.e(69183)]).then(i.bind(i,69183)),"list-item-group":()=>Promise.all([i.e(72076),i.e(81613)]).then(i.bind(i,81613))})}destroy(){this.viewModel=null}render(){return(0,yt.K)("div",{class:this.classes(f.base,pt.D.widget)},this.viewModel?.selectedResult?.name??"",this._renderMoreResults())}_renderMoreResults(){if(!this.viewModel)return null;const{resultCount:e,results:t}=this.viewModel;return!e||e<2||!t?null:(0,yt.K)("calcite-block",{class:f.moreResults,collapsible:!0,expanded:this.showMoreResultsOpen,heading:(0,U.V)(this.messages.showMoreResults,{count:e-1}),onCalciteBlockClose:()=>this._toggleShowMoreResults(!1),onCalciteBlockOpen:()=>this._toggleShowMoreResults(!0)},t.map((e=>this._renderMoreResultsList(e,t?.length>1))))}_renderListItem(e){return(0,yt.K)("calcite-list-item",{key:`result-${e.sourceIndex}-${e.key}`,label:e.name,onCalciteListItemSelect:()=>this._selectResult(e)})}_renderMoreResultsList(e,t){const{results:i}=e;if(!i?.length||!i)return null;const s=this.viewModel?.selectedResult,r=this._getSourceName(e.source,e.sourceIndex),o=i.filter((e=>e!==s)).map((e=>this._renderListItem(e)));return(0,yt.K)("calcite-list",{label:r},t?(0,yt.K)("calcite-list-item-group",{heading:r,key:`group-${e.sourceIndex}`},o):o)}_selectResult(e){this.showMoreResultsOpen=!1,this.viewModel?.select(e)}_toggleShowMoreResults(e){this.showMoreResultsOpen=e;const t=this.viewModel?.view?.popup;t&&"reposition"in t&&t.reposition()}_getSourceName(e,t){return t===ut.ALL_INDEX?this.messages.all:e.name}};(0,s._)([(0,u.MZ)(),(0,ht.G)("esri/widgets/Search/t9n/Search")],mt.prototype,"messages",void 0),(0,s._)([(0,u.MZ)()],mt.prototype,"showMoreResultsOpen",void 0),(0,s._)([(0,u.MZ)()],mt.prototype,"viewModel",void 0),mt=(0,s._)([(0,p.$)("esri.widgets.Search.SearchResultRenderer")],mt);const gt=mt;var ft=i(24611);let vt=class extends h.A{constructor(e,t){super(e,t),this._currentLocationValue=`${this.id}-search-use-current-location`,this._autocompleteNode=null,this._focusAbortController=null,this._searchResultRenderer=new gt,this._suggestController=null,this._searchController=null,this._lastSearchTerm="",this._locateFailed=!1,this._showNoResults=!1,this.disabled=!1,this.messages=null,this.messagesCommon=null,this.viewModel=new ut,this._renderSearchResultsContent=()=>this._searchResultRenderer,(0,r.ED)(o.A.getLogger(this),"Search","arcgis-search",{version:"4.33"}),this.addHandles([(0,a.wB)((()=>this.viewModel),(e=>this._searchResultRenderer.viewModel=e),a.Vh),(0,a.wB)((()=>this.viewModel.results),(()=>this._searchResultRenderer.showMoreResultsOpen=!1)),(0,a.wB)((()=>this.viewModel?.defaultPopupTemplate),(e=>{e&&(e.content=this._renderSearchResultsContent)}),a.Vh)])}loadDependencies(){return(0,dt.W)({autocomplete:()=>Promise.all([i.e(72076),i.e(62614),i.e(7311),i.e(62077)]).then(i.bind(i,62077)),"autocomplete-item-group":()=>i.e(84537).then(i.bind(i,84537)),"autocomplete-item":()=>Promise.all([i.e(72076),i.e(54278)]).then(i.bind(i,54278)),button:()=>Promise.all([i.e(72076),i.e(42817)]).then(i.bind(i,42817)),dropdown:()=>Promise.all([i.e(72076),i.e(13406)]).then(i.bind(i,13406)),"dropdown-group":()=>Promise.all([i.e(72076),i.e(16792)]).then(i.bind(i,16792)),"dropdown-item":()=>Promise.all([i.e(72076),i.e(44490)]).then(i.bind(i,44490)),notice:()=>Promise.all([i.e(72076),i.e(98566)]).then(i.bind(i,98566))})}destroy(){this._cancelQueries(),this._searchResultRenderer=(0,n.pR)(this._searchResultRenderer),this._focusAbortController?.abort()}get _isDisabled(){const{state:e}=this.viewModel;return"disabled"===e||"loading"===e||this.disabled}get _showCurrentLocation(){return this.locationEnabled&&!this.searchTerm?.trim()}get _effectiveActiveMenu(){const{activeMenu:e}=this;return this._isDisabled?"none":"warning"===e?"suggestion":e}get activeMenu(){return"none"}set activeMenu(e){"warning"===e&&(0,r.ck)(o.A.getLogger(this),"activeMenu","warning",{replacement:"Use the value 'suggestion' instead",version:"4.32",warnOnce:!0}),this._overrideIfSome("activeMenu",e)}get activeSource(){return this.viewModel?.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"search"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){return this.viewModel?.portal}set portal(e){this.viewModel&&(this.viewModel.portal=e)}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this._locateFailed=!1,this.viewModel.clear()}focus(){this._handleFocus(),this._emitFocus()}blur(){this._autocompleteNode?.blur(),this._emitBlur()}async search(e){this._cancelQueries();const t=new AbortController,{signal:i}=t;this._searchController=t;try{const s=await this.viewModel.search(e,{signal:i});if(this._searchController!==t)return;return s?.numResults||(this._showNoResults=!0,this.activeMenu="suggestion"),this._searchController=null,s}catch(s){if(this._searchController!==t)return;return void(this._searchController=null)}}async suggest(e){this._cancelSuggest();const t=new AbortController,{signal:i}=t;this._suggestController=t;try{const s=await this.viewModel.suggest(e,null,{signal:i});if(this._suggestController!==t)return;return this._suggestController=null,s?.numResults&&(this.activeMenu="suggestion",this._scrollToTopSuggestion()),s}catch(s){return this._suggestController!==t||(this._suggestController=null),null}}render(){return(0,yt.K)("div",{class:this.classes(m.base,pt.D.widget)},(0,yt.K)("div",{class:m.container},this._renderSourcesMenu(),this._renderForm()))}_handleInputKeydown(e){"Tab"===e.key&&this._cancelSuggest()}_emitFocus(){this.emit("search-focus")}_emitBlur(){this.emit("search-blur")}async _handleFocus(){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const e=this._focusAbortController.signal;await(0,l.QZ)((0,c.$m)(e)),this._autocompleteNode?.setFocus()}_renderSourcesMenu(){const{messages:e,_isDisabled:t,_effectiveActiveMenu:i}=this,{allSources:s,searchAllEnabled:r}=this.viewModel;return s.length>1?(0,yt.K)("calcite-dropdown",{bind:this,class:m.dropdown,disabled:t,open:"source"===i,overlayPositioning:"fixed",onCalciteDropdownClose:this._handleSourceClose,onCalciteDropdownOpen:this._handleSourceOpen,onCalciteDropdownSelect:this._handleSourceSelect},(0,yt.K)("calcite-button",{appearance:"outline-fill",iconStart:"caret-down",kind:"neutral",label:e.searchIn,slot:"trigger"}),(0,yt.K)("calcite-dropdown-group",{groupTitle:e.searchIn},r?this._renderSource(ut.ALL_INDEX):null,s.map(((e,t)=>this._renderSource(t))).toArray())):null}_renderUseCurrentLocation(){const{_currentLocationValue:e}=this;return(0,yt.K)("calcite-autocomplete-item",{heading:this.messages.useCurrentLocation,iconStart:"gps-on",key:e,value:e})}_handleAutocompleteCreate(e){this._autocompleteNode=e}_handleCalciteAutocompleteTextInput(e){const t=e.target.inputValue;t!==this.viewModel.searchTerm&&(this.viewModel.searchTerm=t,t||this.clear(),this.suggest())}_handleAutocompleteOpen(){this.activeMenu="suggestion"}_handleAutocompleteClose(){"suggestion"===this.activeMenu&&(this.activeMenu="none")}_handleCalciteAutocompleteChange(e){const t=e.target.value;if(t===this._currentLocationValue)return void this._useCurrentLocation();const i=JSON.parse(t),s=this.viewModel.suggestions?.find((({sourceIndex:e})=>e===i.sourceIndex))?.results?.find((({key:e})=>`${e}`==`${i.key}`));s&&this.search(s)}_renderAutocomplete(){const{_effectiveActiveMenu:e,messages:t,_isDisabled:i}=this,{maxInputLength:s,placeholder:r,searchTerm:o,state:n}=this.viewModel,l=this.label??t.searchButtonTitle??"";return(0,yt.K)("calcite-autocomplete",{afterCreate:this._handleAutocompleteCreate,autocomplete:"off",bind:this,class:m.autocomplete,disabled:i,icon:this.icon,inputValue:o,label:l,loading:"searching"===n,maxLength:s,name:this.id,onblur:this._emitBlur,onfocus:this._emitFocus,onkeydown:this._handleInputKeydown,open:"suggestion"===e,overlayPositioning:"fixed",placeholder:r,title:o?"":r,onCalciteAutocompleteChange:this._handleCalciteAutocompleteChange,onCalciteAutocompleteClose:this._handleAutocompleteClose,onCalciteAutocompleteOpen:this._handleAutocompleteOpen,onCalciteAutocompleteTextChange:this._handleCalciteAutocompleteTextInput,onCalciteAutocompleteTextInput:this._handleCalciteAutocompleteTextInput},this._renderSuggestions(),this._renderNotices())}_renderForm(){return(0,yt.K)("form",{bind:this,class:m.form,disabled:this._isDisabled,key:m.form,onsubmit:this._formSubmit,role:"search"},this._renderAutocomplete())}_renderSuggestGroup(e){return e.results?.map((e=>this._renderSuggestion(e)))}_renderSuggestions(){const{suggestions:e}=this.viewModel;return this._showNoResults?null:this._showCurrentLocation?this._renderUseCurrentLocation():e?.map((e=>this._renderSuggestResults(e)))}_renderSuggestResults(e){const{allSources:t,activeSourceIndex:i}=this.viewModel,{sourceIndex:s}=e,r=e.results?.length,o=t.length>1&&i===ut.ALL_INDEX,n=this._getSourceName(s);return r&&o?(0,yt.K)("calcite-autocomplete-item-group",{heading:n,key:`suggestion-group-${n}-${s}`},this._renderSuggestGroup(e)):this._renderSuggestGroup(e)}_renderSuggestion({key:e,sourceIndex:t,text:i}){const s={key:e,sourceIndex:t};return(0,yt.K)("calcite-autocomplete-item",{heading:i??this.messages.untitledResult,key:`suggestion_${e}`,value:JSON.stringify(s)})}_renderSource(e){const t=this._getSourceName(e);return(0,yt.K)("calcite-dropdown-item",{"data-source-index":`${e}`,key:`source-${t}-${e}`,selected:e===this.viewModel.activeSourceIndex},t)}_renderNoResultsWarning(e){const{messages:t}=this,i=e?(0,U.V)(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return(0,yt.K)("calcite-notice",{icon:"exclamation-mark-triangle",key:"no-results-warning",kind:"warning",open:!0,slot:"content-bottom"},(0,yt.K)("div",{slot:"title"},t.noResults),(0,yt.K)("div",{slot:"message"},i))}_renderLocateError(){return(0,yt.K)("calcite-notice",{icon:"exclamation-mark-circle",key:"locate-warning",kind:"danger",open:!0,slot:"content-bottom"},(0,yt.K)("div",{slot:"message"},this.messages.locateError))}_renderNotices(){return this._locateFailed?this._renderLocateError():this._showNoResults?this._renderNoResultsWarning(this._lastSearchTerm??this.viewModel.searchTerm):null}async _useCurrentLocation(){this._cancelQueries();const e=new AbortController,{signal:t}=e;this._searchController=e;try{await this.viewModel.searchNearby({signal:t})}catch(y){(0,l.zf)(y)||(this._locateFailed=!0,this.activeMenu="suggestion")}finally{this._searchController=null}}_handleSourceOpen(){this.activeMenu="source"}_handleSourceClose(){"source"===this.activeMenu&&(this.activeMenu="none")}_handleSourceSelect(e){const t=e.target.selectedItems[0].getAttribute("data-source-index");t&&(this.viewModel.activeSourceIndex=parseInt(t,10))}_cancelSuggest(){this.activeMenu="none",this._locateFailed=!1,this._showNoResults=!1,this._suggestController=(0,n.DC)(this._suggestController)}_cancelQueries(){this._cancelSuggest(),this._searchController=(0,n.DC)(this._searchController)}_scrollToTopSuggestion(){this._autocompleteNode?.scrollContentTo({top:0})}_formSubmit(e){e.preventDefault(),this.activeMenu="none",this._lastSearchTerm=this.searchTerm,this.searchTerm&&this.search()}_getSourceName(e){const{messages:t}=this,{allSources:i}=this.viewModel,s=i.at(e);return e===ut.ALL_INDEX?t.all:s?.name||t.untitledSource}};(0,s._)([(0,u.MZ)()],vt.prototype,"_locateFailed",void 0),(0,s._)([(0,u.MZ)()],vt.prototype,"_showNoResults",void 0),(0,s._)([(0,u.MZ)()],vt.prototype,"_isDisabled",null),(0,s._)([(0,u.MZ)()],vt.prototype,"_showCurrentLocation",null),(0,s._)([(0,u.MZ)()],vt.prototype,"_effectiveActiveMenu",null),(0,s._)([(0,u.MZ)()],vt.prototype,"activeMenu",null),(0,s._)([(0,u.MZ)({readOnly:!0})],vt.prototype,"activeSource",null),(0,s._)([(0,u.MZ)()],vt.prototype,"activeSourceIndex",null),(0,s._)([(0,u.MZ)()],vt.prototype,"allPlaceholder",null),(0,s._)([(0,u.MZ)({readOnly:!0})],vt.prototype,"allSources",null),(0,s._)([(0,u.MZ)()],vt.prototype,"autoNavigate",null),(0,s._)([(0,u.MZ)()],vt.prototype,"autoSelect",null),(0,s._)([(0,u.MZ)({readOnly:!0})],vt.prototype,"defaultSources",null),(0,s._)([(0,u.MZ)()],vt.prototype,"disabled",void 0),(0,s._)([(0,u.MZ)()],vt.prototype,"goToOverride",null),(0,s._)([(0,u.MZ)()],vt.prototype,"icon",null),(0,s._)([(0,u.MZ)()],vt.prototype,"includeDefaultSources",null),(0,s._)([(0,u.MZ)()],vt.prototype,"label",null),(0,s._)([(0,u.MZ)()],vt.prototype,"locationEnabled",null),(0,s._)([(0,u.MZ)()],vt.prototype,"maxResults",null),(0,s._)([(0,u.MZ)()],vt.prototype,"maxSuggestions",null),(0,s._)([(0,u.MZ)(),(0,ht.G)("esri/widgets/Search/t9n/Search")],vt.prototype,"messages",void 0),(0,s._)([(0,u.MZ)(),(0,ht.G)("esri/t9n/common")],vt.prototype,"messagesCommon",void 0),(0,s._)([(0,u.MZ)()],vt.prototype,"minSuggestCharacters",null),(0,s._)([(0,u.MZ)()],vt.prototype,"popupEnabled",null),(0,s._)([(0,u.MZ)()],vt.prototype,"popupTemplate",null),(0,s._)([(0,u.MZ)()],vt.prototype,"portal",null),(0,s._)([(0,u.MZ)()],vt.prototype,"resultGraphic",null),(0,s._)([(0,u.MZ)()],vt.prototype,"resultGraphicEnabled",null),(0,s._)([(0,u.MZ)({readOnly:!0})],vt.prototype,"results",null),(0,s._)([(0,u.MZ)()],vt.prototype,"searchAllEnabled",null),(0,s._)([(0,u.MZ)()],vt.prototype,"searchTerm",null),(0,s._)([(0,u.MZ)({readOnly:!0})],vt.prototype,"selectedResult",null),(0,s._)([(0,u.MZ)()],vt.prototype,"sources",null),(0,s._)([(0,u.MZ)({readOnly:!0})],vt.prototype,"suggestions",null),(0,s._)([(0,u.MZ)()],vt.prototype,"suggestionsEnabled",null),(0,s._)([(0,u.MZ)()],vt.prototype,"view",null),(0,s._)([(0,ft.U)(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),(0,u.MZ)({type:ut})],vt.prototype,"viewModel",void 0),vt=(0,s._)([(0,p.$)("esri.widgets.Search")],vt);const bt=vt},44199:(e,t,i)=>{i.d(t,{A:()=>it});var s=i(66866),r=(i(17791),i(85569)),o=i(20464),n=i(539),l=i(6267),a=i(40189),c=i(85251),u=i(21564),d=(i(39831),i(63863)),p=i(66689),h=i(46928),y=i(10816),m=i(52495),g=(i(9272),i(12535));let f=class extends m.A{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.gridEnabledToggle=!0,this.header=!1,this.layerList=!0,this.gridControls=!0,this.gridControlsElements=new g.A({gridSnapEnabledToggle:!1,gridEnabledToggle:!1}),this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"enabledToggle",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"featureEnabledToggle",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"gridEnabledToggle",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"header",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"layerList",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"gridControls",void 0),(0,s._)([(0,u.MZ)({type:g.A,nonNullable:!0})],f.prototype,"gridControlsElements",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"layerListToggleLayersButton",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],f.prototype,"selfEnabledToggle",void 0),f=(0,s._)([(0,d.$)("esri.widgets.support.SnappingControls.VisibleElements")],f);const v=f;let b=class extends m.A{constructor(e){super(e),this.point=!0,this.polyline=!0,this.polygon=!0,this.rectangle=!0,this.circle=!0,this.multipoint=!0,this.mesh=!0,this.freehandPolyline=!1,this.freehandPolygon=!1}};(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],b.prototype,"point",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],b.prototype,"polyline",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],b.prototype,"polygon",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],b.prototype,"rectangle",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],b.prototype,"circle",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],b.prototype,"multipoint",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],b.prototype,"mesh",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],b.prototype,"freehandPolyline",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],b.prototype,"freehandPolygon",void 0),b=(0,s._)([(0,d.$)("esri.widgets.Sketch.VisibleElements.CreateToolVisibilityMap")],b);let _=class extends m.A{constructor(e){super(e),this["rectangle-selection"]=!0,this["lasso-selection"]=!0,this["custom-selection"]=!0}};(0,s._)([(0,u.MZ)({nonNullable:!0})],_.prototype,"rectangle-selection",void 0),(0,s._)([(0,u.MZ)({nonNullable:!0})],_.prototype,"lasso-selection",void 0),(0,s._)([(0,u.MZ)({nonNullable:!0})],_.prototype,"custom-selection",void 0),_=(0,s._)([(0,d.$)("esri.widgets.Sketch.VisibleElements.SelectionToolVisibilityMap")],_);let w=class extends m.A{constructor(e){super(e),this.createTools=new b,this.directionModePicker=!1,this.duplicateButton=!0,this.deleteButton=!0,this.selectionCountLabel=!0,this.labelsToggle=!0,this.selectionTools=new _,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new v,this.tooltipsToggle=!0,this.undoRedoMenu=!0}};(0,s._)([(0,u.MZ)({type:b,nonNullable:!0})],w.prototype,"createTools",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],w.prototype,"directionModePicker",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],w.prototype,"duplicateButton",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],w.prototype,"deleteButton",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],w.prototype,"selectionCountLabel",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],w.prototype,"labelsToggle",void 0),(0,s._)([(0,u.MZ)({type:_,nonNullable:!0})],w.prototype,"selectionTools",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],w.prototype,"settingsMenu",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],w.prototype,"snappingControls",void 0),(0,s._)([(0,u.MZ)({type:v,nonNullable:!0})],w.prototype,"snappingControlsElements",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],w.prototype,"tooltipsToggle",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],w.prototype,"undoRedoMenu",void 0),w=(0,s._)([(0,d.$)("esri.widgets.Sketch.VisibleElements")],w);var M=i(123);const S=1,L={s:32,m:48,l:64},I={horizontal:{s:16,m:16,l:24},vertical:{s:16,m:24,l:40}},A={splitButton:{horizontal:"chevron-down",vertical:"ellipsis"},overflow:"ellipsis"};function x(e,t){return e.vnodeSelector===t?[e]:e.children?.flatMap((e=>x(e,t)))??[]}const C=e=>{let t=class extends e{constructor(){super(...arguments),this.priority=0,this.scale="m",this.slot=void 0,this.lastActiveKey=null,this.layout="horizontal"}destroy(){this.measurementManager?.managedElements.remove(this),this.measurementManager=null}set measurementManager(e){const t=this._get("measurementManager");e!==t&&(t&&t.managedElements.remove(this),this._set("measurementManager",e),e?.managedElements.add(this))}set budgetedLength(e){this.budgetedLength!==e&&(this._set("budgetedLength",e),this.scheduleRender())}get actionChildren(){return this.children?.flatMap((e=>x(e,"calcite-action")))??[]}get activeChildElement(){const e=this.actionChildren.find((e=>!0===e.properties?.active));return e?(this._set("lastActiveKey",e.properties?.key),e):this.lastActiveKey?this.actionChildren.find((e=>e.properties?.key===this.lastActiveKey)):void 0}_handleClick(e){e?.dataset&&"dataset"in e&&e.dataset.actionKey&&(this.lastActiveKey=e.dataset.actionKey)}};return(0,s._)([(0,u.MZ)()],t.prototype,"priority",void 0),(0,s._)([(0,u.MZ)()],t.prototype,"measurementManager",null),(0,s._)([(0,u.MZ)()],t.prototype,"budgetedLength",null),(0,s._)([(0,u.MZ)()],t.prototype,"actionChildren",null),(0,s._)([(0,u.MZ)()],t.prototype,"activeChildElement",null),(0,s._)([(0,u.MZ)()],t.prototype,"scale",void 0),(0,s._)([(0,u.MZ)()],t.prototype,"slot",void 0),(0,s._)([(0,u.MZ)()],t.prototype,"lastActiveKey",void 0),(0,s._)([(0,u.MZ)()],t.prototype,"layout",void 0),t=(0,s._)([(0,d.$)("esri.widgets.Sketch.support.ResponsiveToolbar.ToolbarGroupBase")],t),t};var T=i(99484),E=i(96704);const F=Symbol("on-resize-handle-key");let R=class extends(C(h.A)){constructor(e){super(e),this._measuredWidth=0,this._measuredHeight=0,this._measuredElement=null}destroy(){this._measuredElement=null}get lengthOptions(){return["horizontal"===this.layout?this._measuredWidth:this._measuredHeight]}render(){return(0,E.K)("div",{afterCreate:e=>{this._measuredElement=e.firstElementChild,this.addHandles((0,T.EV)(this._measuredElement,(()=>{this._measuredWidth=this._measuredElement?.clientWidth??0,this._measuredHeight=this._measuredElement?.clientHeight??0})),F)},afterRemoved:()=>this.removeHandles(F)},this.children)}};(0,s._)([(0,u.MZ)()],R.prototype,"_measuredWidth",void 0),(0,s._)([(0,u.MZ)()],R.prototype,"_measuredHeight",void 0),(0,s._)([(0,u.MZ)()],R.prototype,"lengthOptions",null),(0,s._)([(0,u.MZ)()],R.prototype,"_measuredElement",void 0),R=(0,s._)([(0,d.$)("esri.widgets.Sketch.support.ResponsiveToolbar.MeasuredContentGroup")],R);var Z=i(17199),O=i(43955);let P=class extends(C(h.A)){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return(0,Z.W)({action:()=>i.e(72076).then(i.bind(i,13847)),"action-group":()=>Promise.all([i.e(72076),i.e(75781)]).then(i.bind(i,75781)),"action-menu":()=>Promise.all([i.e(72076),i.e(93297)]).then(i.bind(i,93297))})}static{this.vnodeSelector="calcite-action-group"}get minimumLength(){const{actionChildren:e,scale:t}=this;return e.length?this.allowCollapse?S+L[t]*Math.min(e.length,2):S+L[t]*e.length:0}get lengthOptions(){const{actionChildren:e,scale:t,minimumLength:i,allowCollapse:s,priority:r}=this,o=[i];if(e.length<=2||!s||r<1)return o;for(let n=1;n<e.length-1;n++)o.push(i+L[t]*n);return o}render(){if(!this.actionChildren.length)return(0,E.K)(E.w,null,void 0);const{budgetedLength:e,actionChildren:t,activeChildElement:i,layout:s,slot:r,scale:o}=this,n=Math.floor(e/L[o]),l=[],a=[];if(n>=t.length)l.push(...t);else{const e=i??l.at(0);if(l.push(...t.slice(0,n-1)),a.push(...t.slice(n-1)),e&&a.includes(e)){const[t]=a.splice(a.indexOf(e),1),i=l.pop();l.push(t),i&&a.unshift(i)}}return(0,E.K)("calcite-action-group",{key:"overflow-button-group",layout:s,onclick:e=>this._handleClick(e.target),slot:r},l.map((e=>this._renderManagedAction(e))),a.length>0?(0,E.K)("calcite-action-menu",{key:"split-button-dropdown",label:this.messagesCommon.more,overlayPositioning:"fixed"},(0,E.K)("calcite-action",{icon:A.overflow,key:"split-button-dropdown-trigger",scale:o,slot:"trigger",text:this.messagesCommon.more}),a.map((e=>this._renderManagedAction(e)))):void 0)}_renderManagedAction(e){return(0,E.K)("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};(0,s._)([(0,u.MZ)()],P.prototype,"allowCollapse",void 0),(0,s._)([(0,u.MZ)()],P.prototype,"minimumLength",null),(0,s._)([(0,u.MZ)(),(0,O.G)("esri/t9n/common")],P.prototype,"messagesCommon",void 0),(0,s._)([(0,u.MZ)()],P.prototype,"lengthOptions",null),P=(0,s._)([(0,d.$)("esri.widgets.Sketch.support.ResponsiveToolbar.OverflowGroup")],P);var k=i(48982);let D=class extends m.A{constructor(){super(...arguments),this.measuredElement=null,this.managedElements=new k.A,this.availableLength=0,this.layout="horizontal",this._resizeObserver=new ResizeObserver((()=>{this._measure()}))}get _sortedElements(){return[...this.managedElements].sort(((e,t)=>t.priority-e.priority))}connect(e){this._resizeObserver.disconnect(),this.measuredElement=e,this._resizeObserver.observe(e),this._measure()}allocate(){const e=new Map,{availableLength:t,_sortedElements:i}=this;let s=0;for(const r of i){const t=r.lengthOptions[0];e.set(r,t),s+=t}for(const r of i)for(;s<t;){const i=e.get(r);if(!i)break;const o=r.lengthOptions.find((e=>e>i));if(!o)break;const n=s-i+o;if(n>t)break;e.set(r,o),s=n}for(const[r,o]of e)r.budgetedLength=o}_measure(){const e=this.measuredElement;this.availableLength=e?"horizontal"===this.layout?e.clientWidth??0:e.clientHeight??0:0,this.allocate()}destroy(){this._resizeObserver.disconnect()}};(0,s._)([(0,u.MZ)()],D.prototype,"measuredElement",void 0),(0,s._)([(0,u.MZ)()],D.prototype,"managedElements",void 0),(0,s._)([(0,u.MZ)()],D.prototype,"_sortedElements",null),(0,s._)([(0,u.MZ)()],D.prototype,"availableLength",void 0),(0,s._)([(0,u.MZ)()],D.prototype,"layout",void 0),D=(0,s._)([(0,d.$)("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbarManager")],D);const N="esri-split-button--split-part";let $=class extends(C(h.A)){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return(0,Z.W)({action:()=>i.e(72076).then(i.bind(i,13847)),"action-group":()=>Promise.all([i.e(72076),i.e(75781)]).then(i.bind(i,75781)),"action-menu":()=>Promise.all([i.e(72076),i.e(93297)]).then(i.bind(i,93297))})}static{this.vnodeSelector="calcite-action-group"}get minimumLength(){const e=this.actionChildren;return e.length?1===e.length?L[this.scale]+S:this.allowCollapse?L[this.scale]+I[this.layout][this.scale]+S:L[this.scale]*e.length+S:0}get lengthOptions(){const{actionChildren:e,minimumLength:t,layout:i,scale:s,priority:r,allowCollapse:o}=this;if(e.length<2||r<0||!o)return[t];const n=S+L[s]*e.length;return[S+L[s]+I[i][s],n]}render(){if(!this.actionChildren.length)return(0,E.K)(E.w,null,void 0);const{actionChildren:e,minimumLength:t,budgetedLength:i,layout:s,slot:r,allowCollapse:o}=this,n=!o||e.length<2||i>t;return(0,E.K)("calcite-action-group",{key:"split-button-group",layout:s,onclick:e=>this._handleClick(e.target),slot:r},n?this._renderUnSplit():this._renderSplit())}_renderSplit(){const{activeChildElement:e,layout:t,actionChildren:i,scale:s,messagesCommon:r}=this,o=e??i.at(0);if(!o)return;const n=i.filter((e=>e!==o));return[this._renderManagedAction(o),(0,E.K)("calcite-action-menu",{key:"split-button-dropdown",label:r.more,overlayPositioning:"fixed",placement:"horizontal"===t?"bottom-end":"right-end"},(0,E.K)("calcite-action",{class:`${N}--${t}--${this.scale}`,compact:"horizontal"===t,icon:A.splitButton[t],key:"split-button-dropdown-trigger",scale:s,slot:"trigger",text:r.more}),n?.map((e=>this._renderManagedAction(e))))]}_renderUnSplit(){return this.actionChildren.map((e=>this._renderManagedAction(e)))}_renderManagedAction(e){return(0,E.K)("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};(0,s._)([(0,u.MZ)()],$.prototype,"minimumLength",null),(0,s._)([(0,u.MZ)()],$.prototype,"allowCollapse",void 0),(0,s._)([(0,u.MZ)()],$.prototype,"lengthOptions",null),(0,s._)([(0,u.MZ)(),(0,O.G)("esri/t9n/common")],$.prototype,"messagesCommon",void 0),$=(0,s._)([(0,d.$)("esri.widgets.Sketch.support.ResponsiveToolbar.SplitButton")],$);const V="esri-responsive-toolbar",B={rulerBase:`${V}__ruler`,rulerBarHorizontal:`${V}__ruler--bar`,rulerBarVertical:`${V}__ruler--bar--vertical`,rulerPadVertical:`${V}__ruler--pad--vertical`,rulerPadHorizontal:`${V}__ruler--pad--horizontal`,bar:`${V}__bar`,barHorizontal:`${V}__bar--horizontal`,barVertical:`${V}__bar--vertical`,pad:`${V}__pad`,padVertical:`${V}__pad--vertical`,padHorizontal:`${V}__pad--horizontal`};let j=class extends h.A{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new D,this._managedWidgets=new Map}loadDependencies(){return(0,Z.W)({"action-bar":()=>Promise.all([i.e(72076),i.e(63010)]).then(i.bind(i,63010))})}destroy(){this._measurementManager=(0,l.pR)(this._measurementManager),this._managedWidgets.forEach((e=>e.destroy())),this._managedWidgets.clear()}set layout(e){const t=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),t!==e&&this.scheduleRender()}get _barClasses(){const e="docked"===this.barStyle,t="vertical"===this.layout;return{[B.barHorizontal]:e&&!t,[B.barVertical]:e&&t,[B.bar]:e,[B.padHorizontal]:!e&&!t,[B.padVertical]:!e&&t,[B.pad]:!e}}render(){const{layout:e,scale:t,barStyle:i}=this,s={layout:e,scale:t,expandDisabled:!0,key:"measured-toolbar"},r="docked"===i?"vertical"===e?B.rulerBarVertical:B.rulerBarHorizontal:"horizontal"===e?B.rulerPadHorizontal:B.rulerPadVertical;return(0,E.K)("div",null,(0,E.K)("div",{afterCreate:e=>{this._measurementManager?.connect(e)},class:this.classes(B.rulerBase,r)}),(0,E.K)("calcite-action-bar",{...s,classes:this._barClasses,floating:"docked"!==i,overflowActionsDisabled:!0},this._renderChildren()))}_renderChildren(){if(!this.children)return;const e=this.children.filter((e=>void 0!==e.properties?.key&&"group-kind"in e.properties)),t=new Set,i=e.map((e=>{const i=e.properties,s=i.key;t.add(s);const r="docked"===this.barStyle?i.slot??void 0:void 0,o=i.priority??0,n=i["group-kind"]??"overflow-group",l=i["allow-collapse"]??!0,a=this._managedWidgets.get(s);if(a)return a.children=e.children,a.priority=o,"allowCollapse"in a&&(a.allowCollapse=l),a.slot=r,a.layout=this.layout,a.scale=this.scale,a.measurementManager=this._measurementManager,a;const c={scale:this.scale,priority:o,measurementManager:this._measurementManager,children:e.children,slot:r,layout:this.layout};switch(n){case"split-button":{const e=new $({...c,allowCollapse:l});return this._managedWidgets.set(s,e),e}case"overflow-group":{const e=new P({...c,allowCollapse:l});return this._managedWidgets.set(s,e),e}case"measured-content":{const e=new R({...c});return this._managedWidgets.set(s,e),e}}})).filter(r.Ru);return Array.from(this._managedWidgets.keys()).filter((e=>!t.has(e))).forEach((e=>{this._managedWidgets.get(e)?.destroy(),this._managedWidgets.delete(e)})),this._measurementManager?.allocate(),i.map((e=>e.render()))}};(0,s._)([(0,u.MZ)()],j.prototype,"scale",void 0),(0,s._)([(0,u.MZ)({value:"horizontal"})],j.prototype,"layout",null),(0,s._)([(0,u.MZ)()],j.prototype,"barStyle",void 0),(0,s._)([(0,u.MZ)()],j.prototype,"_measurementManager",void 0),(0,s._)([(0,u.MZ)()],j.prototype,"_managedWidgets",void 0),(0,s._)([(0,u.MZ)()],j.prototype,"_barClasses",null),j=(0,s._)([(0,d.$)("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],j);var G=i(50220),z=i(35251),K=i(17306),U=i(40454),q=i(7407),H=i(38201),W=i(12690),J=i(89882),Q=i(97066),Y=i(62802),X=i(65319),ee=i(70384),te=i(36408),ie=i(42453),se=i(55876),re=i(49313);async function oe(e){const{returnFeatureTitleFields:t,returnGeometry:i,selector:s,signal:r,sources:o,view:n}=e;if(!o?.length)return[];const{layers:l,layerViews:c,graphicsLayers:u}=function(e){const t=[],i=[],s=[];return e.forEach((e=>{(0,U.yZ)(e)||(0,U.F2)(e)||(0,U.Sv)(e)?t.push(e):((0,U.cM)(e)||(0,U.Qz)(e))&&e.layers?.length?t.push(...e.layers.toArray()):(0,U.Rv)(e)&&e.sublayers?.length?s.push(...e.sublayers.toArray()):(0,U.V0)(e)?s.push(e):(0,H.lO)(e)&&i.push(e)})),{layers:t,layerViews:i,graphicsLayers:s}}(o),d=[];return await(0,a.QZ)((0,a.qr)(Promise.all([le({candidates:d,layers:l,returnFeatureTitleFields:t,returnGeometry:i,selector:s,signal:r,view:n}),ne({candidates:d,layerViews:c,returnGeometry:i,selector:s,signal:r,view:n}),ce({candidates:d,graphicsLayers:u,selector:s})]),r)),d}async function ne(e){const{candidates:t,layerViews:i,returnGeometry:s,selector:o,signal:n,view:l}=e;"point"!==o.type?await(0,a.qr)(Promise.allSettled(i.map((async e=>{const i=function(e,t,i,s=!0){const r=e.createQuery();return r.outFields=["*"],r.geometry=ae(t,e.layer,i),r.returnGeometry=s,r.outSpatialReference=i.spatialReference,r}(e,o,l,s),a=await e.queryFeatures(i,{signal:n});(0,r.FB)(t,a.features)}))),n):await async function({candidates:e,layerViews:t,selector:i,view:s}){const r=s.toScreen(i);if(!r)return;const o=t.map((e=>e.layer)),{results:n}=await s.hitTest(r,{include:o});n.forEach((t=>{"graphic"in t&&t.graphic&&e.push(t.graphic)}))}({candidates:t,layerViews:i,selector:o,view:l})}async function le(e){const{candidates:t,layers:i,returnFeatureTitleFields:s,returnGeometry:o,selector:n,signal:l,view:c}=e;await(0,a.qr)(Promise.allSettled(i.map((async e=>{if("isTable"in e&&e.isTable)return;const i=function(e,t,i,s=!1,r=!0){const o=e.createQuery();return o.outFields=function(e,t,i){const{fields:s,fieldsIndex:r}=e,o=new Set([e.objectIdField]);"globalIdField"in e&&null!=e.globalIdField&&r.has(e.globalIdField)&&o.add(r.get(e.globalIdField).name);const n="displayField"in e?e.displayField:null,l=(0,ie.mB)({displayField:n,fields:s});if(null!=l&&r.has(l)&&o.add(l),"subtypeField"in e&&null!=e.subtypeField){const i=r.get(e.subtypeField)?.name;if(null!=i&&o.add(i),"utilityNetworks"in t.map&&t.map.utilityNetworks?.length){const e=r.get("assetgroup");e?.name&&o.add(e.name);const t=r.get("assettype");t?.name&&o.add(t.name)}}return(i||t.requiredFieldsOptions.featureTitleFields)&&"featureTitleFields"in e&&e.featureTitleFields&&e.featureTitleFields.forEach((e=>o.add(e))),Array.from(o.values())}(e,i,s),o.geometry=ae(t,e,i),o.returnGeometry=r,o.outSpatialReference=i.spatialReference,o}(e,n,c,s,o),a=await e.queryFeatures(i,{signal:l});(0,r.FB)(t,a.features)}))),l)}function ae(e,t,i){return"point"===e.type?(0,re.V)(e,"renderer"in t?(0,se.o)({renderer:t.renderer}):0,i):e}async function ce(e){const{candidates:t,graphicsLayers:s,selector:r}=e,o=s.flatMap((e=>e.graphics.toArray()))??[];if(!o?.length||!r)return;const n=await Promise.all([i.e(72076),i.e(68318)]).then(i.bind(i,68318));n.accelerateGeometry(r),o.forEach((e=>{e.geometry&&"mesh"!==e.geometry.type&&n.execute(r,e.geometry)&&t.push(e)}))}let ue=class extends K.A.EventedAccessor{constructor(e){super(e),this._completed=!1,this._isConstraintKeyDown=!1,this._processTask=null,this.createTool="rectangle",this.mode=null,this.persistSelection=!0,this.returnFeatureTitleFields=!1,this.returnGeometry=!0,this.selection=new k.A,this.selectionManager=null,this.selectOnComplete=!0,this.sources=null,this.toolName="",this.type="add",this._process=(0,a.sg)((async(e,t)=>{const{callback:i,selector:s,completed:r}=e,o=(0,W.UT)((async e=>{const{effectiveSelectionManager:t,returnFeatureTitleFields:o,returnGeometry:n,selection:l,sources:a,view:c}=this;if((a?.length||t.sources.length)&&c){if(s&&null!=a){const i=await oe({returnFeatureTitleFields:o,returnGeometry:n,selector:s,signal:e,sources:a,view:c});if(l.removeAll(),l.addMany(i),r&&this.persistSelection)switch(this.effectiveType){case"remove":t.updateSelection({current:[],added:[],removed:i});break;case"replace":t.clear(),t.updateSelection({current:i,added:[],removed:[]});break;default:t.updateSelection({current:i,added:[],removed:[]})}}i&&i()}else l.removeAll()}));return(0,a.u7)(t,(()=>o.abort())),this._processTask=o,o.promise}),100),this._onOperationFinish=this._onOperationFinish.bind(this)}initialize(){this._setup()}get _defaultMode(){return"polygon"===this.createTool?"click":"hybrid"}get _selectionArea(){const e=this._tool.coordinates;if(0===e.length)return;const t=(0,J.tc)(),i=this.view.spatialReference,s=e=>{t.x=e[0],t.y=e[1];const i=this.view.toMap(t);return[i?.x??0,i?.y??0]};if(1===e.length||e.every((([t,i])=>t===e[0][0]&&i===e[0][1]))){const[t,r]=s(e[0]);return new Q.A({x:t,y:r,spatialReference:i})}const r=e.map(s);return 0!==r.length?((0,X.$3)(r)||r.reverse(),new Y.A({spatialReference:i,rings:[r]})):void 0}get completed(){return this._completed}get effectiveSelectionManager(){return this.selectionManager??this.view.selectionManager}get effectiveType(){const e=this.type??"add";if(this._isConstraintKeyDown)switch(e){case"add":return"remove";case"remove":case"replace":return"add";default:return e}return e}get processingFinalSelection(){return!(!this._processTask||!this._tool?.drawOperation?.isCompleted)}cancel(){this.selection.removeAll(),this._onOperationFinish(!0)}destroy(){this._toolImportController=(0,l.DC)(this._toolImportController)}async _setup(){const{createTool:e,view:t}=this;if(await t.whenReady(),this.destroyed||this._toolImportController)return;const s=new AbortController;this._toolImportController=s;const[r,l]=await Promise.all([Promise.all([i.e(72076),i.e(69699),i.e(53098),i.e(98407)]).then(i.bind(i,87290)),(0,te.f)()]);if(s.signal.aborted)return;const c=Symbol();try{this._tool=new r.DrawScreenTool({view:t,mode:this.mode??this._defaultMode,geometryType:e,cursor:"point"===e?"default":"crosshair",automaticLengthMeasurementUtils:l})}finally{this._toolImportController=null}this._tool?(this.selectOnComplete||this.addHandles(this._tool.on(["cursor-update","vertex-add","vertex-remove"],(()=>{this._syncConstraintKeyDown(),(0,a.QZ)(this._process({selector:this._selectionArea}))})),c),this.addHandles([t.on("key-down",(e=>{if(!e.repeat)switch(e.key){case ee.NE.constraint:this._tool.uniformSizeToggled=!0,e.stopPropagation();break;case ee.NE.center:this._tool.centeredToggled=!0,e.stopPropagation()}})),t.on("key-up",(e=>{switch(e.key){case ee.NE.constraint:this._tool.uniformSizeToggled=!1,e.stopPropagation();break;case ee.NE.center:this._tool.centeredToggled=!1,e.stopPropagation()}})),this.selection.on("change",(({added:e,removed:t})=>this.emit("selection-change",{operationType:this.effectiveType,added:e,removed:t}))),this._tool.on("complete",(async e=>{this._syncConstraintKeyDown(),this.removeHandles(c),e.aborted?this.cancel():(this._tool.cursor="progress",await this._process({selector:this._selectionArea,callback:this._onOperationFinish,completed:!0}))}))],c),this.addHandles((0,o.hA)((()=>t.tools.remove(this._tool)))),t.addAndActivateTool(this._tool)):n.A.getLogger(this).warn("Unable to import Draw module. SelectionOperation failed to load.")}_syncConstraintKeyDown(){const{inputManager:e}=this.view;this._isConstraintKeyDown=ee.hi.invertType.some((t=>e.isModifierKeyDown(t)))}_onOperationFinish(e=!1){this.removeAllHandles(),this._processTask?.abort(),this.emit("complete",{aborted:e,operationType:this.effectiveType,selection:this.selection.toArray(),toolName:this.toolName}),this._completed=!0}};(0,s._)([(0,u.MZ)()],ue.prototype,"_completed",void 0),(0,s._)([(0,u.MZ)()],ue.prototype,"_defaultMode",null),(0,s._)([(0,u.MZ)()],ue.prototype,"_isConstraintKeyDown",void 0),(0,s._)([(0,u.MZ)()],ue.prototype,"_processTask",void 0),(0,s._)([(0,u.MZ)()],ue.prototype,"_selectionArea",null),(0,s._)([(0,u.MZ)()],ue.prototype,"completed",null),(0,s._)([(0,u.MZ)({constructOnly:!0})],ue.prototype,"createTool",void 0),(0,s._)([(0,u.MZ)()],ue.prototype,"effectiveSelectionManager",null),(0,s._)([(0,u.MZ)()],ue.prototype,"effectiveType",null),(0,s._)([(0,u.MZ)({constructOnly:!0})],ue.prototype,"mode",void 0),(0,s._)([(0,u.MZ)()],ue.prototype,"persistSelection",void 0),(0,s._)([(0,u.MZ)()],ue.prototype,"processingFinalSelection",null),(0,s._)([(0,u.MZ)()],ue.prototype,"returnFeatureTitleFields",void 0),(0,s._)([(0,u.MZ)()],ue.prototype,"returnGeometry",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],ue.prototype,"selection",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],ue.prototype,"selectionManager",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],ue.prototype,"selectOnComplete",void 0),(0,s._)([(0,u.MZ)()],ue.prototype,"sources",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],ue.prototype,"toolName",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],ue.prototype,"type",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],ue.prototype,"view",void 0),ue=(0,s._)([(0,d.$)("esri.widgets.support.Selector2D.SelectionOperation")],ue);const de=ue;let pe=class extends K.A.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.continuousSelectionEnabled=!1,this.defaultLassoToolOptions={createTool:"polygon",mode:"hybrid",toolName:"lasso"},this.defaultOperationType="add",this.defaultPointToolOptions={createTool:"point",toolName:"point"},this.defaultRectangleToolOptions={createTool:"rectangle",toolName:"rectangle"},this.layerViewPreferenceEnabled=!0,this.persistSelection=!0,this.selectionManager=null,this.returnFeatureTitleFields=!1,this.returnGeometry=!0,this.selectOnComplete=!0,this.sources=null,this.toolConfigs=[]}initialize(){this.addHandles([(0,c.wB)((()=>this.effectiveSources),(e=>{this.activeOperation&&(this.activeOperation.sources=e)}))])}destroy(){this._operationHandlesGroup=(0,l.xt)(this._operationHandlesGroup)}get effectiveSelectionManager(){return this.selectionManager??this.view?.selectionManager}get effectiveSources(){const{layerViewPreferenceEnabled:e,sources:t,view:i}=this,s=t??this.effectiveSelectionManager?.sources;if(!s?.length)return[];const r=[];return s.forEach((t=>{if((0,H.lO)(t))r.push(t);else if((0,U.cM)(t)||(0,U.Qz)(t))(t.layers||[]).forEach((t=>{const s=i?(0,q.in)(i,t):void 0,o=e&&(0,H.lO)(s)?s:t;r.push(o)}));else if(e){const e=i?(0,q.in)(i,t):void 0,s=(0,H.lO)(e)?e:t;r.push(s)}else r.push(t)})),r}get layers(){return(0,G.Lx)(n.A.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){(0,G.Lx)(n.A.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){return this.activeOperation?"active":this.view?.ready&&this.effectiveSources.length?"ready":"disabled"}activate(e){const{state:t}=this,i=e?.view||this.view,s=e?.sources||this.effectiveSources;if("disabled"===t||!i)return void n.A.getLogger(this).warn("Unable to start selection operation.");"active"===t&&this.cancel();const r=new CustomEvent("before-activate",{cancelable:!0,detail:{toolName:e?.toolName??null}});if(this.emit("before-activate",r),r.defaultPrevented)return;const l={type:this.defaultOperationType,persistSelection:this.persistSelection,returnFeatureTitleFields:this.returnFeatureTitleFields,returnGeometry:this.returnGeometry,selectOnComplete:this.selectOnComplete,selectionManager:this.effectiveSelectionManager,...e,sources:s,view:i},a=new de({...l});return this._operationHandlesGroup=(0,o.vE)([a.on("selection-change",(e=>this.emit("selection-change",e))),a.once("complete",(e=>this._onOperationComplete(e,l)))]),this._set("activeOperation",a),a}activateTool(e){this.cancel();const t=this._getToolOptions(e);if(t)return this.activate(t);n.A.getLogger(this).warn("Unable to activate tool: unable to determine options.")}cancel(){this.activeOperation?.cancel(),this._set("activeOperation",null)}toggleTool(e){const{activeOperation:t}=this;if(t){const i=t.toolName;if(this.cancel(),i===e)return}return this.activateTool(e)}_onOperationComplete(e,t){this._operationHandlesGroup=(0,l.xt)(this._operationHandlesGroup),this._set("activeOperation",null),this.emit("complete",e),this.continuousSelectionEnabled&&!e.aborted&&this.activate(t)}_getToolOptions(e){return this.toolConfigs.find((t=>t.toolName===e))||("lasso"===e?this.defaultLassoToolOptions:"point"===e?this.defaultPointToolOptions:"rectangle"===e?this.defaultRectangleToolOptions:void 0)}};(0,s._)([(0,u.MZ)({readOnly:!0})],pe.prototype,"activeOperation",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"continuousSelectionEnabled",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"defaultLassoToolOptions",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"defaultOperationType",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"defaultPointToolOptions",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"defaultRectangleToolOptions",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"effectiveSelectionManager",null),(0,s._)([(0,u.MZ)()],pe.prototype,"effectiveSources",null),(0,s._)([(0,u.MZ)()],pe.prototype,"layers",null),(0,s._)([(0,u.MZ)()],pe.prototype,"layerViewPreferenceEnabled",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"persistSelection",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"selectionManager",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"returnFeatureTitleFields",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"returnGeometry",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"selectOnComplete",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"sources",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],pe.prototype,"state",null),(0,s._)([(0,u.MZ)()],pe.prototype,"toolConfigs",void 0),(0,s._)([(0,u.MZ)()],pe.prototype,"view",void 0),pe=(0,s._)([(0,d.$)("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],pe);const he=pe;let ye=class extends m.A{constructor(e){super(e),this.chip=!0,this.lassoTool=!0,this.pan=!0,this.pointTool=!0,this.rectangleTool=!0}};(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],ye.prototype,"chip",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],ye.prototype,"lassoTool",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],ye.prototype,"pan",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],ye.prototype,"pointTool",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],ye.prototype,"rectangleTool",void 0),ye=(0,s._)([(0,d.$)("esri.widgets.support.SelectionToolbar.VisibleElements")],ye);const me=ye;var ge=i(46930);const fe="esri-selection-toolbar",ve={base:fe,container:`${fe}__container`,toolButton:`${fe}__tool-button`};let be=class extends h.A{constructor(e,t){super(e,t),this._viewModelHandlesGroup=null,this.disabled=!1,this.layout="horizontal",this.messages=null,this.scale="s",this.viewModel=new he,this.visibleElements=new me}initialize(){this._viewModelHandlesGroup=(0,o.vE)([(0,c.on)((()=>this.viewModel),"before-activate",(e=>this.emit("before-activate",e))),(0,c.on)((()=>this.viewModel),"complete",(e=>this.emit("complete",e))),(0,c.on)((()=>this.viewModel),"selection-change",(e=>this.emit("selection-change",e)))])}destroy(){this._viewModelHandlesGroup=(0,l.xt)(this._viewModelHandlesGroup)}loadDependencies(){return(0,Z.W)({action:()=>i.e(72076).then(i.bind(i,13847)),"action-bar":()=>Promise.all([i.e(72076),i.e(63010)]).then(i.bind(i,63010)),chip:()=>Promise.all([i.e(72076),i.e(70375)]).then(i.bind(i,70375))})}get _effectiveDisabled(){return this.disabled||"disabled"===this.state}get activeOperation(){return this.viewModel.activeOperation}get continuousSelectionEnabled(){return this.viewModel.continuousSelectionEnabled}set continuousSelectionEnabled(e){this.viewModel.continuousSelectionEnabled=e}get defaultLassoToolOptions(){return this.viewModel.defaultLassoToolOptions}set defaultLassoToolOptions(e){this.viewModel.defaultLassoToolOptions=e}get defaultOperationType(){return this.viewModel.defaultOperationType}set defaultOperationType(e){this.viewModel.defaultOperationType=e}get defaultPointToolOptions(){return this.viewModel.defaultPointToolOptions}set defaultPointToolOptions(e){this.viewModel.defaultPointToolOptions=e}get defaultRectangleToolOptions(){return this.viewModel.defaultRectangleToolOptions}set defaultRectangleToolOptions(e){this.viewModel.defaultRectangleToolOptions=e}get effectiveSelectionManager(){return this.viewModel.effectiveSelectionManager}get effectiveSources(){return this.viewModel.effectiveSources}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return(0,G.Lx)(n.A.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(e){(0,G.Lx)(n.A.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=e}get layerViewPreferenceEnabled(){return this.viewModel.layerViewPreferenceEnabled}set layerViewPreferenceEnabled(e){this.viewModel.layerViewPreferenceEnabled=e}get persistSelection(){return this.viewModel.persistSelection}set persistSelection(e){this.viewModel.persistSelection=e}get returnFeatureTitleFields(){return this.viewModel.returnFeatureTitleFields}set returnFeatureTitleFields(e){this.viewModel.returnFeatureTitleFields=e}get returnGeometry(){return this.viewModel.returnGeometry}set returnGeometry(e){this.viewModel.returnGeometry=e}get selectOnComplete(){return this.viewModel.selectOnComplete}set selectOnComplete(e){this.viewModel.selectOnComplete=e}get selectionManager(){return this.viewModel.selectionManager}set selectionManager(e){this.viewModel.selectionManager=e}get state(){return this.viewModel.state}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get toolConfigs(){return this.viewModel.toolConfigs}set toolConfigs(e){this.viewModel.toolConfigs=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visibleToolCount(){const{visibleElements:e}=this;return this.toolConfigs.length+(e.lassoTool?1:0)+(e.rectangleTool?1:0)}activate(e){if(this.cancel(),!this._effectiveDisabled)return this.viewModel.activate(e)}activateTool(e){if(!this._effectiveDisabled)return this.viewModel.activateTool(e)}cancel(){this.viewModel.cancel()}toggleTool(e){if(!this._effectiveDisabled)return this.viewModel.toggleTool(e)}render(){return(0,E.K)("div",{"aria-label":this.label,class:this.classes(ve.base,z.D.widget)},(0,E.K)("div",{class:ve.container},(0,E.K)("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",scale:this.scale},this._renderDefaultTools(),this._renderCustomTools(),this._renderChip())))}_renderDefaultTools(){return[this._renderPanAction(),this._renderPointTool(),this._renderRectangleTool(),this._renderLassoTool()]}_renderPanAction(){if(!this.visibleElements.pan)return;const e=this.messages.pan,t=`${this.id}-tool-pan`;return this._renderAction({active:!this.activeOperation,disabled:this._effectiveDisabled,icon:"pan",id:t,key:t,onclick:()=>this.cancel(),text:e,title:e})}_renderChip(){if(!this.visibleElements.chip)return;const{effectiveSelectionManager:e}=this,t=e?.count??0,i=(0,ge.ZV)(t);return(0,E.K)("calcite-chip",{appearance:"outline",closable:t>0,closed:0===t,disabled:this._effectiveDisabled||0===t,label:i,scale:this.scale,slot:"actions-end",title:this.messages.clearSelection,onCalciteChipClose:()=>e?.clear()},i)}_renderCustomTools(){return this.toolConfigs.map((({toolName:e,icon:t})=>this._renderToolWithTooltip(e,t)))}_renderPointTool(){if(this.visibleElements.pointTool)return this._renderToolWithTooltip("point","selection-set",this.messages.selectByPoint)}_renderLassoTool(){if(this.visibleElements.lassoTool)return this._renderToolWithTooltip("lasso","lasso-select",this.messages.selectByLasso)}_renderRectangleTool(){if(this.visibleElements.rectangleTool)return this._renderToolWithTooltip("rectangle","cursor-marquee",this.messages.selectByRectangle)}_renderToolWithTooltip(e,t,i=e){const s=`${this.id}-tool-${e}`;return this._renderAction({active:this.activeOperation?.toolName===e,disabled:this._effectiveDisabled,icon:t||"selection",id:s,key:s,onclick:()=>this.toggleTool(e),text:i,title:i})}_renderAction(e){return(0,E.K)("calcite-action",{...e,bind:this,class:ve.toolButton,scale:this.scale})}};(0,s._)([(0,u.MZ)()],be.prototype,"_effectiveDisabled",null),(0,s._)([(0,u.MZ)()],be.prototype,"activeOperation",null),(0,s._)([(0,u.MZ)()],be.prototype,"continuousSelectionEnabled",null),(0,s._)([(0,u.MZ)()],be.prototype,"defaultLassoToolOptions",null),(0,s._)([(0,u.MZ)()],be.prototype,"defaultOperationType",null),(0,s._)([(0,u.MZ)()],be.prototype,"defaultPointToolOptions",null),(0,s._)([(0,u.MZ)()],be.prototype,"defaultRectangleToolOptions",null),(0,s._)([(0,u.MZ)()],be.prototype,"disabled",void 0),(0,s._)([(0,u.MZ)()],be.prototype,"effectiveSelectionManager",null),(0,s._)([(0,u.MZ)()],be.prototype,"effectiveSources",null),(0,s._)([(0,u.MZ)()],be.prototype,"label",null),(0,s._)([(0,u.MZ)()],be.prototype,"layers",null),(0,s._)([(0,u.MZ)()],be.prototype,"layerViewPreferenceEnabled",null),(0,s._)([(0,u.MZ)()],be.prototype,"layout",void 0),(0,s._)([(0,u.MZ)(),(0,O.G)("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],be.prototype,"messages",void 0),(0,s._)([(0,u.MZ)()],be.prototype,"persistSelection",null),(0,s._)([(0,u.MZ)()],be.prototype,"returnFeatureTitleFields",null),(0,s._)([(0,u.MZ)()],be.prototype,"returnGeometry",null),(0,s._)([(0,u.MZ)()],be.prototype,"selectOnComplete",null),(0,s._)([(0,u.MZ)()],be.prototype,"scale",void 0),(0,s._)([(0,u.MZ)()],be.prototype,"selectionManager",null),(0,s._)([(0,u.MZ)()],be.prototype,"state",null),(0,s._)([(0,u.MZ)()],be.prototype,"sources",null),(0,s._)([(0,u.MZ)()],be.prototype,"toolConfigs",null),(0,s._)([(0,u.MZ)()],be.prototype,"view",null),(0,s._)([(0,u.MZ)()],be.prototype,"viewModel",void 0),(0,s._)([(0,u.MZ)({type:me,nonNullable:!0})],be.prototype,"visibleElements",void 0),(0,s._)([(0,u.MZ)()],be.prototype,"visibleToolCount",null),be=(0,s._)([(0,d.$)("esri.widgets.support.SelectionToolbar")],be);const _e=be;var we=i(76748),Me=i(96088),Se=i(11650);let Le=class extends m.A{constructor(e){super(e),this.directionModePicker=!1,this.header=!1,this.labelsToggle=!0,this.tooltipsToggle=!0}};(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],Le.prototype,"directionModePicker",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],Le.prototype,"header",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],Le.prototype,"labelsToggle",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],Le.prototype,"tooltipsToggle",void 0),Le=(0,s._)([(0,d.$)("esri.widgets.support.SketchTooltipControls.VisibleElements")],Le);const Ie=Le,Ae="esri-sketch-tooltip-controls",xe={base:Ae,block:`${Ae}__block`,blockContent:`${Ae}__block-content`,radioButtonLabelWrapper:`${Ae}__radio-button-label-wrapper`};let Ce=class extends h.A{constructor(e,t){super(e,t),this.viewModel=null,this.visibleElements=new Ie,this.sketchOptions=new we.A,this.viewType=void 0,this._onTooltipsEnabledChange=e=>{this.sketchOptions.tooltips.enabled=e},this._onLabelsEnabledChange=e=>{this.sketchOptions.labels.enabled=e},this._onDirectionModeChange=e=>{this.sketchOptions.values.directionMode=e.currentTarget.selectedItem.value}}loadDependencies(){return Promise.all([(0,Z.W)({block:()=>Promise.all([i.e(72076),i.e(50246),i.e(62776)]).then(i.bind(i,62776)),label:()=>Promise.all([i.e(72076),i.e(87337)]).then(i.bind(i,87337)),icon:()=>i.e(72076).then(i.bind(i,96446)),"radio-button":()=>Promise.all([i.e(72076),i.e(40763)]).then(i.bind(i,40763)),"radio-button-group":()=>Promise.all([i.e(72076),i.e(62377)]).then(i.bind(i,62377))}),(0,Se.m)()])}render(){const{label:e,visibleElements:t}=this,i=this._renderContent();return(0,E.K)("div",{"aria-label":e,class:this.classes(xe.base,z.D.widget)},i?(0,E.K)("calcite-block",{class:xe.block,expanded:!0,heading:t.header?this.label:"",key:"content-block",label:this.label},(0,E.K)("div",{class:xe.blockContent,key:"content"},i)):void 0)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}_renderContent(){const{visibleElements:e,viewType:t}=this,i=[e.tooltipsToggle?this._renderTooltipsToggle():null,e.labelsToggle&&"2d"!==t?this._renderLabelsToggle():null,e.directionModePicker?this._renderDirectionModePicker():null].filter(r.Ru);return 0===i.length?null:i}_renderTooltipsToggle(){const{messages:e,sketchOptions:t}=this;return(0,E.K)(Se.o,{checked:t.tooltips.effectiveEnabled,hint:e.tooltipsToggleHint,key:`${this.id}__tooltips`,label:e.tooltipsToggle,onChange:this._onTooltipsEnabledChange})}_renderLabelsToggle(){const{messages:e,sketchOptions:t}=this;return(0,E.K)(Se.o,{checked:t.labels.enabled,hint:e.labelsToggleHint,key:`${this.id}__labels`,label:e.labelsToggle,onChange:this._onLabelsEnabledChange})}_renderDirectionModePicker(){const{messages:e,sketchOptions:t}=this,{directionMode:i}=t.values;return(0,E.K)("calcite-label",{key:"direction-mode",layout:"default",scale:"s"},e.directionModePicker,(0,E.K)("calcite-radio-button-group",{key:"radio-button-group",layout:"horizontal",name:this.id,scale:"s",value:i,onCalciteRadioButtonGroupChange:this._onDirectionModeChange},this._renderDirectionModeOption("relative",i,e.directionModeRelative),this._renderDirectionModeOption("absolute",i,e.directionModeAbsolute)))}_renderDirectionModeOption(e,t,i){return(0,E.K)("calcite-label",{key:e,layout:"inline",scale:"s"},(0,E.K)("calcite-radio-button",{checked:e===t,scale:"s",value:e}),(0,E.K)("div",{class:xe.radioButtonLabelWrapper,key:"label-wrapper"},(0,E.K)("calcite-icon",{icon:Me.N[e],scale:"s"}),i))}};(0,s._)([(0,u.MZ)()],Ce.prototype,"label",null),(0,s._)([(0,u.MZ)({type:Ie,nonNullable:!0})],Ce.prototype,"visibleElements",void 0),(0,s._)([(0,u.MZ)(),(0,O.G)("esri/widgets/support/SketchTooltipControls/t9n/SketchTooltipControls")],Ce.prototype,"messages",void 0),(0,s._)([(0,u.MZ)({nonNullable:!0,type:we.A})],Ce.prototype,"sketchOptions",void 0),(0,s._)([(0,u.MZ)({type:String})],Ce.prototype,"viewType",void 0),Ce=(0,s._)([(0,d.$)("esri.widgets.support.SketchTooltipControls")],Ce);const Te=Ce;var Ee=i(65061),Fe=i(98849),Re=i(2622),Ze=i(72740),Oe=i(45937),Pe=i(67118);const ke=e=>De(e)||Ne(e),De=e=>{if(!("type"in e))return!1;switch(e.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":case"subtype-sublayer":return!0;default:return!1}},Ne=e=>{const t=(0,Oe.oZ)(e);if(null!=t&&e.hasOwnProperty(t)&&null!=e[t])for(const i of e[t])if(ke(i))return!0;return!1},$e=(e,t)=>null!=t&&null!=e&&(t.test(e.title)?"self":!!e.children.some((e=>!1!==$e(e,t)))&&"children");var Ve,Be=i(46963);let je=Ve=class extends Be.A{constructor(e){super(e),this.children=new k.A,this.parent=null}get enabled(){const{children:e}=this;if(0===e.length)return null!=this.featureSource&&this.featureSource.enabled?"enabled":"disabled";let t=!1,i=!1;for(const s of e){if("indeterminate"===s.enabled)return s.enabled;if("enabled"===s.enabled?t=!0:"disabled"===s.enabled&&(i=!0),i&&t)return"indeterminate"}return i?"disabled":"enabled"}get childLayerIds(){return this.children.toArray().flatMap((e=>[e.layer?.id,...e.childLayerIds]))}get featureSource(){const{layer:e,getFeatureSnappingSources:t}=this;return t().find((t=>t.layer===e))}_initializeChildLayers(e){if(!e)return;const t=e.filter(ke);super._initializeChildLayers(t)}_createChildItems(e){return e.map((e=>(0,Oe.oU)(e)?new Ve({layer:e,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null)).filter(r.Ru).reverse()}};(0,s._)([(0,u.MZ)()],je.prototype,"enabled",null),(0,s._)([(0,u.MZ)()],je.prototype,"children",void 0),(0,s._)([(0,u.MZ)()],je.prototype,"childLayerIds",null),(0,s._)([(0,u.MZ)()],je.prototype,"featureSource",null),(0,s._)([(0,u.MZ)({constructOnly:!0})],je.prototype,"getFeatureSnappingSources",void 0),(0,s._)([(0,u.MZ)()],je.prototype,"parent",void 0),je=Ve=(0,s._)([(0,d.$)("esri.widgets.support.SnappingControls.SnappingListItem")],je);let Ge=class extends Pe.A{constructor(){super(...arguments),this.featureSnappingSources=new k.A}get operationalItemsFlat(){return this.operationalItems.flatten((e=>e.children))}get selectableItems(){return this.operationalItemsFlat.filter((e=>!e.children?.length))}_compileList(){const e=this.view?.map?.layers;if(!e)return;const t=e.filter(ke);this._watchLayersListMode(t);const i=this._getViewableLayers(t);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createListItem(e){return new je({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}};(0,s._)([(0,u.MZ)()],Ge.prototype,"featureSnappingSources",void 0),(0,s._)([(0,u.MZ)()],Ge.prototype,"operationalItems",void 0),(0,s._)([(0,u.MZ)()],Ge.prototype,"operationalItemsFlat",null),(0,s._)([(0,u.MZ)()],Ge.prototype,"selectableItems",null),Ge=(0,s._)([(0,d.$)("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],Ge);let ze=class extends m.A{constructor(e){super(e),this.layerListViewModel=new Ge,this.snappingOptions=new Ze.A,this.view=null}initialize(){this.addHandles([(0,c.wB)((()=>({viewModel:this.layerListViewModel,view:this.view})),(({viewModel:e,view:t})=>{e.view=t}),c.Vh),(0,c.wB)((()=>({viewModel:this.layerListViewModel,sources:this.snappingOptions?.featureSources})),(({viewModel:e,sources:t})=>{e.featureSnappingSources=t}),c.Vh)])}get allLayersEnabled(){return(this.layerListViewModel?.selectableItems??[]).every((e=>"enabled"===e.enabled))}get allLayersDisabled(){return(this.layerListViewModel?.selectableItems??[]).every((e=>!e.enabled))}get layersEnabledCount(){return this.layerListViewModel?.selectableItems?.filter((e=>"enabled"===e.enabled)).length??0}get state(){return this.snappingOptions?"ready":"disabled"}toggleSnappingForLayers(e,t){e?.forEach((e=>t?this.enableSnappingForLayer(e):this.disableSnappingForLayer(e)))}toggleSnappingForAllLayers(e){this.layerListViewModel.selectableItems.forEach((({layer:t})=>{const i=t?.id;e?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i)}))}enableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e);t&&(t.enabled=!0)}disableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e);t&&(t.enabled=!1)}updateEnabledFeatureSources(e){for(const t of this.snappingOptions.featureSources)(0,Oe.oU)(t.layer)&&(t.enabled=e.includes(t.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find((t=>t.layer.id===e))}_makeSnappingSourceForLayer(e){const t=this.layerListViewModel.operationalItemsFlat.find((t=>t.layer?.id===e))?.layer;if(!t)throw new Fe.A("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);if("group"===t.type)return;const i=new Re.A({layer:t});return this.snappingOptions.featureSources.add(i),i}};(0,s._)([(0,u.MZ)()],ze.prototype,"allLayersEnabled",null),(0,s._)([(0,u.MZ)()],ze.prototype,"allLayersDisabled",null),(0,s._)([(0,u.MZ)({constructOnly:!0})],ze.prototype,"layerListViewModel",void 0),(0,s._)([(0,u.MZ)()],ze.prototype,"layersEnabledCount",null),(0,s._)([(0,u.MZ)({type:Ze.A,nonNullable:!0})],ze.prototype,"snappingOptions",void 0),(0,s._)([(0,u.MZ)()],ze.prototype,"state",null),(0,s._)([(0,u.MZ)()],ze.prototype,"view",void 0),ze=(0,s._)([(0,d.$)("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],ze);const Ke=ze,Ue="esri-snapping-controls",qe={base:Ue,container:`${Ue}__container`,toggleBlock:`${Ue}__toggle-block`,layerListBlock:`${Ue}__layer-list-block`,layerList:`${Ue}__layer-list`,layerListFilter:`${Ue}__layer-list__filter`,layerListButton:`${Ue}__layer-list__button`,layerListItem:`${Ue}__layer-list__item`,layerListGroup:`${Ue}__layer-list__group`,nestedContainer:`${Ue}__nested-container`};let He=class extends h.A{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this._gridLoadTask=null,this.layerListOpen=!0,this.gridOptionsOpen=!1,this.messages=null,this.messagesCommon=null,this.snappingManager=null,this.visibleElements=new v,this._enableSnappingSwitchChange=e=>{this.snappingOptions.enabled=e},this._featureEnabledSwitchChange=e=>{this.snappingOptions.featureEnabled=e},this._gridEnabledSwitchChange=e=>{this.snappingOptions.gridEnabled=e,e&&this._startLoadGrid()},this._selfEnabledSwitchChange=e=>{this.snappingOptions.selfEnabled=e},this._onToggleLayersButtonClick=e=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),(0,T.Z6)(e.target)};const{snappingOptions:i,view:s,viewModel:r}=e;this.viewModel=r??(this._defaultViewModel=new Ke({snappingOptions:i,view:s}))}normalizeCtorArgs(e){const{snappingOptions:t,view:i,viewModel:s,...r}=e;return r}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=(0,l.pR)(this._defaultViewModel))}loadDependencies(){return Promise.all([(0,Z.W)({block:()=>Promise.all([i.e(72076),i.e(50246),i.e(62776)]).then(i.bind(i,62776)),button:()=>Promise.all([i.e(72076),i.e(42817)]).then(i.bind(i,42817)),input:()=>Promise.all([i.e(72076),i.e(62614),i.e(7311)]).then(i.bind(i,7311)),list:()=>Promise.all([i.e(72076),i.e(62614),i.e(7311),i.e(22678)]).then(i.bind(i,22678)),"list-item":()=>Promise.all([i.e(72076),i.e(50246),i.e(69183)]).then(i.bind(i,69183)),checkbox:()=>Promise.all([i.e(72076),i.e(302)]).then(i.bind(i,302)),loader:()=>i.e(72076).then(i.bind(i,32524))}),(0,Se.m)()])}initialize(){this.addHandles((0,c.wB)((()=>"2d"===this.view?.type&&!!this.view.grid),(e=>{this.visibleElements.gridControls&&(this.snappingOptions.gridEnabled=e)})))}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(null!=this._defaultViewModel&&this._defaultViewModel===e||(this._defaultViewModel=(0,l.pR)(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return(0,E.K)("div",{"aria-label":e,class:this.classes(qe.base,z.D.widget)},(0,E.K)("div",{class:qe.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList(),"2d"===this.view?.type&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){const{visibleElements:e,view:t}=this,i=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null,e.gridEnabledToggle&&"2d"===t?.type?this._renderGridEnabledToggle():null].filter(r.Ru),s=[e.enabledToggle?this._renderEnabledToggle():null,i.length>0?(0,E.K)("div",{class:qe.nestedContainer},i):null].filter(r.Ru);return 0===s.length?null:(0,E.K)("calcite-block",{class:qe.toggleBlock,expanded:!0,heading:e.header?this.label:"",key:"toggle-block",label:this.label},s)}_renderEnabledToggle(){return(0,E.K)(Se.o,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return(0,E.K)(Se.o,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return(0,E.K)(Se.o,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return(0,E.K)(Se.o,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,i=t.layerListViewModel.operationalItems.length>9?(0,E.K)("calcite-input",{class:qe.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:({currentTarget:{value:e}})=>{this._layerListFilter=""===e?null:new RegExp(e,"i")}}):null,s=this._secondaryElementsDisabled,r=this.layerListOpen&&!s,o=t.layerListViewModel.operationalItems?.find((e=>!!e.children.length));return(0,E.K)("calcite-block",{class:qe.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,expanded:r,heading:e.snappingLayers,key:"list-block",onCalciteBlockToggle:e=>this.layerListOpen=e.currentTarget.expanded},i,this._renderToggleLayersButton(),(0,E.K)("calcite-list",{class:qe.layerList,displayMode:o?"nested":"flat",label:e?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems)))}_renderGridOptions(){const{view:e,visibleElements:t,snappingManager:i,snappingOptions:s,_openAndReady:r}=this,{gridEnabled:o,enabled:n}=s;(r||"2d"===e?.type&&e.grid)&&this._startLoadGrid();const l=this._gridLoadTask?.value,a=l&&"2d"===e?.type&&(0,E.K)(l,{snappingManager:i,snappingOptions:s,view:e,visibleElements:t.gridControlsElements});return(0,E.K)("calcite-block",{class:qe.layerListBlock,collapsible:!0,disabled:!o||!n,expanded:r,heading:this.messages.gridOptionsHeading,key:"grid-block",onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},a??(0,E.K)("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}async _startLoadGrid(){!this._gridLoadTask&&this.visibleElements.gridControls&&"2d"===this.view?.type&&(this._gridLoadTask=(0,W.UT)((async()=>(await Promise.all([i.e(72076),i.e(71226),i.e(69699),i.e(53098),i.e(44217),i.e(68290),i.e(49902)]).then(i.bind(i,94744))).default)))}_renderLayerListItemCollection(e){const t=this._layerListFilter;return e.map((e=>{switch(t?$e(e,t):null){case"children":{const i=e.children.filter((e=>!1!==$e(e,t)));return this._renderLayerListItemGroup(e,i)}case"self":case null:return this._renderLayerListItemOrGroup(e);case!1:return"self"===$e(e.parent,t)?this._renderLayerListItemOrGroup(e):null}})).toArray().filter(r.Ru)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,i=e?t.disableAllLayers:t.enableAllLayers;return(0,E.K)("calcite-button",{appearance:"transparent",class:qe.layerListButton,label:i,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},i)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);const{messages:{untitledLayer:t}}=this,i=e.title||t,s=()=>{this.viewModel.toggleSnappingForLayers([e.layer?.id],"enabled"!==e.enabled)};return(0,E.K)("calcite-list-item",{class:qe.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:i,onCalciteListItemSelect:e=>{e.stopPropagation(),s()}},(0,E.K)("calcite-checkbox",{checked:"enabled"===e.enabled,slot:"actions-start",onCalciteCheckboxChange:s}))}_renderLayerListItemGroup(e,t){const{messages:i}=this,{children:s,title:r}=e,o=r||i.untitledLayer,n=r&&""!==r?r:(0,Ee.c)(),l=!!t?.length,a=t??s,c=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,"enabled"!==e.enabled)},u=a?.find((e=>!!e.children.length));return(0,E.K)("calcite-list-item",{class:qe.layerListGroup,expanded:l,key:n,label:o,onCalciteListItemSelect:e=>{e.stopPropagation(),c()}},(0,E.K)("calcite-checkbox",{checked:"enabled"===e.enabled,indeterminate:"indeterminate"===e.enabled,slot:"actions-start",onCalciteCheckboxChange:c}),(0,E.K)("calcite-list",{displayMode:u?"nested":"flat",label:i?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(a)))}get _enabledToggleDisabled(){const e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};(0,s._)([(0,u.MZ)()],He.prototype,"_defaultViewModel",void 0),(0,s._)([(0,u.MZ)()],He.prototype,"_layerListFilter",void 0),(0,s._)([(0,u.MZ)()],He.prototype,"_gridLoadTask",void 0),(0,s._)([(0,u.MZ)()],He.prototype,"_openAndReady",null),(0,s._)([(0,u.MZ)()],He.prototype,"label",null),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],He.prototype,"layerListOpen",void 0),(0,s._)([(0,u.MZ)({type:Boolean,nonNullable:!0})],He.prototype,"gridOptionsOpen",void 0),(0,s._)([(0,u.MZ)(),(0,O.G)("esri/widgets/support/SnappingControls/t9n/SnappingControls")],He.prototype,"messages",void 0),(0,s._)([(0,u.MZ)(),(0,O.G)("esri/t9n/common")],He.prototype,"messagesCommon",void 0),(0,s._)([(0,u.MZ)()],He.prototype,"snappingOptions",null),(0,s._)([(0,u.MZ)()],He.prototype,"snappingManager",void 0),(0,s._)([(0,u.MZ)()],He.prototype,"view",null),(0,s._)([(0,u.MZ)()],He.prototype,"viewModel",null),(0,s._)([(0,u.MZ)({type:v,nonNullable:!0})],He.prototype,"visibleElements",void 0),(0,s._)([(0,u.MZ)()],He.prototype,"_enabledToggleDisabled",null),(0,s._)([(0,u.MZ)()],He.prototype,"_secondaryElementsDisabled",null),He=(0,s._)([(0,d.$)("esri.widgets.support.SnappingControls")],He);const We=He;var Je=i(24611),Qe=i(48187);const Ye="esri-sketch",Xe={base:Ye,vertical:`${Ye}--vertical`,docked:`${Ye}-bar`,floating:`${Ye}-pad`,chipHorizontal:`${Ye}__selection-count-chip--horizontal`,chipVertical:`${Ye}__selection-count-chip--vertical`,chipVerticalSmall:`${Ye}__selection-count-chip--vertical--s`,popoverWrapper:`${Ye}__popover-wrapper`},et={point:"pin",polyline:"line",polygon:"polygon",rectangle:"rectangle",circle:"circle",multipoint:"pins",mesh:"i3d-building",freehandPolygon:"freehand-area",freehandPolyline:"freehand"};let tt=class extends h.A{constructor(e,t){super(e,t),this._activeCustomToolOptions=null,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.customToolOptions=null,this.customActions=null,this.toolbarKind="floating",this.contextualToolLocation="separate",this.groupCollapsePriorities=null,this.groupAllowCollapseOptions=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new w,this._defaultViewModel=null,this._calcitePopoverReferenceElement=null,this._relativeLocation="top",this._popoverOpen=!1,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=e?.viewModel||(this._defaultViewModel=new y.A({creationMode:e?.creationMode??"continuous"}))}initialize(){const{layer:e,view:t}=this,i="2d"===t?.type,s=new _e({persistSelection:!1,visibleElements:new me({chip:!1,pan:!1,pointTool:!1,lassoTool:i,rectangleTool:i}),view:t,sources:e?[e]:null,scale:this.scale});this.addHandles([(0,c.wB)((()=>this.viewModel),(e=>{this._viewModelHandlesGroup=(0,l.xt)(this._viewModelHandlesGroup),e&&(this._viewModelHandlesGroup=(0,o.vE)([e.on("create",(()=>this.scheduleRender())),e.on("update",(()=>this.scheduleRender())),e.on("delete",(e=>this.emit("delete",e))),e.on("undo",(()=>this.scheduleRender())),e.on("redo",(()=>this.scheduleRender())),(0,c.wB)((()=>e.layer),(e=>{this._selectionToolbar&&(this._selectionToolbar.sources=e?[e]:null)})),(0,c.wB)((()=>e.view),(e=>{this._selectionToolbar&&(this._selectionToolbar.view=e)})),(0,c.wB)((()=>e.state),(()=>this.notifyChange("state")))]))}),c.pc),(0,c.z7)((()=>s.activeOperation),(()=>this.viewModel.cancel())),s.on("complete",(e=>this._onSelectionOperationComplete(e))),(0,c.wB)((()=>{const{view:e,visibleElements:{selectionTools:t}}=this;return{lassoTool:"3d"!==e?.type&&!!t?.["lasso-selection"],rectangleTool:"3d"!==e?.type&&!!t?.["rectangle-selection"]}}),(e=>{Object.assign(s.visibleElements,e)}),c.pc)]),this._selectionToolbar=s}loadDependencies(){return(0,Z.W)({action:()=>i.e(72076).then(i.bind(i,13847)),chip:()=>Promise.all([i.e(72076),i.e(70375)]).then(i.bind(i,70375)),popover:()=>i.e(72076).then(i.bind(i,78568))})}destroy(){this._selectionToolbar?.destroy(),this._viewModelHandlesGroup=(0,l.xt)(this._viewModelHandlesGroup)}get activeTool(){const e=this._selectionToolbar?.activeOperation;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}const t=this._effectiveAvailableCreateTools,{activeTool:i,activeCreateToolDrawMode:s}=this.viewModel;return"polygon"===i&&"freehand"===s&&t?.includes("freehandPolygon")?"freehandPolygon":"polyline"===i&&"freehand"===s&&t?.includes("freehandPolyline")?"freehandPolyline":this.viewModel.activeTool}get activeTooltip(){return this.viewModel.activeTooltip}get createGraphic(){return this.viewModel.createGraphic}get creationMode(){return this.viewModel.creationMode}set creationMode(e){this.viewModel.creationMode=e}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(e){this.viewModel.defaultUpdateOptions=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}set layout(e){this._set("layout",e),this._selectionToolbar&&(this._selectionToolbar.layout=e)}set scale(e){this._set("scale",e),this._selectionToolbar&&(this._selectionToolbar.scale=e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get state(){return this._selectionToolbar?.activeOperation?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get updateGraphics(){return this.viewModel.updateGraphics}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){const t=this._get("viewModel");e!==t&&(t&&t===this._defaultViewModel&&(0,l.pR)(t),this._set("viewModel",e))}get _effectiveAvailableCreateTools(){const{availableCreateTools:e,view:t,visibleElements:i}=this,s=e?.filter((e=>!!i.createTools?.[e]));return"3d"===t?.type?s?.filter((e=>"multipoint"!==e)):s}create(e,t,i){const s=i?.createOptions??t;return this._activeCustomToolOptions=i,(0,a.QZ)(this.viewModel.create(e,s))}update(e,t){return(0,a.QZ)(this.viewModel.update(e,t))}complete(){this.viewModel.complete()}cancel(){this._selectionToolbar?.cancel(),this.viewModel.cancel(),this._activeCustomToolOptions=null}undo(){this.viewModel.undo(),this.view?.focus()}redo(){this.viewModel.redo(),this.view?.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}dismissFloatingElements(){this._popoverOpen=!1}render(){const{toolbarKind:e,layout:t,scale:i}=this,s=this.customActions?.filter((e=>"selection-toolbar"===e.position));return(0,E.K)("div",null,(0,E.K)("div",{classes:{[Xe.base]:!0,[Xe.floating]:"floating"===e,[Xe.docked]:"docked"===e,[Xe.vertical]:"vertical"===t}},(0,E.K)(j,{barStyle:e,layout:t,scale:i},this._renderSelectionSetItemGroupInline(),(0,E.K)("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("selectionTools")??!0,"group-kind":"split-button",key:"selection-split-button",priority:this.groupCollapsePriorities?.get("selectionTools")??M.Jl.Low},this._renderDefaultSelectionButton(),this._selectionToolbar?.render(),s?.map((e=>this._renderToolbarItem(e)))),this._renderCreateToolActionGroup(),this._renderUndoRedoMenuItemGroup(),this._renderSettingsMenuItemGroup()),this._renderSelectionSetToolbar(),this._renderSettingsMenuPopover()))}_renderSettingsMenuPopover(){const{messagesCommon:e,snappingOptions:t,view:i,viewModel:s,visibleElements:r}=this;if(!this._calcitePopoverReferenceElement)return;const o={directionModePicker:r.directionModePicker,labelsToggle:r.labelsToggle,tooltipsToggle:r.tooltipsToggle},n="horizontal"===this.layout?"top"===this._relativeLocation?"bottom-end":"top-end":"right-end";return(0,E.K)("calcite-popover",{closable:!0,focusTrapDisabled:!0,heading:e.settings,label:e.settings,open:this._popoverOpen,overlayPositioning:"fixed",placement:n,referenceElement:this._calcitePopoverReferenceElement,scale:this.scale,onCalcitePopoverBeforeClose:()=>this._popoverOpen=!1,onCalcitePopoverBeforeOpen:e=>this._remeasurePopoverSizes(e.currentTarget),onCalcitePopoverClose:()=>this._refocusOnView()},(0,E.K)("div",{class:Xe.popoverWrapper},Object.values(o).includes(!0)?(0,E.K)(Te,{sketchOptions:s.sketchOptions,viewType:i?.type,visibleElements:new Ie(o)}):void 0,r.snappingControls&&i&&t?(0,E.K)(We,{snappingManager:this.viewModel.snappingManager,snappingOptions:t,view:i,visibleElements:r.snappingControlsElements}):void 0))}_renderSelectionSetToolbar(){if("separate"!==this.contextualToolLocation)return;const e=this._renderSelectionSetItemGroup();return e?.length?(0,E.K)(j,{barStyle:this.toolbarKind,layout:this.layout,scale:this.scale},e):void 0}_renderSelectionSetItemGroupInline(){return"separate"===this.contextualToolLocation?[]:this._renderSelectionSetItemGroup()}_renderUndoRedoMenuItemGroup(){return(0,E.K)("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("undoRedo")??!0,"group-kind":"split-button",key:"undo-redo-menu",priority:this.groupCollapsePriorities?.get("undoRedo")??M.Jl.Medium,slot:"actions-end"},this._renderUndoButton(),this._renderRedoButton())}_renderSettingsMenuItemGroup(){const e=[],t=[];this.customActions?.forEach((i=>{"settings-before"===i.position?t.push(i):"settings-after"===i.position&&e.push(i)}));const i=[...t.map((e=>this._renderToolbarItem(e))),this._renderSettingsMenuButton(),...e.map((e=>this._renderToolbarItem(e)))].filter(r.Ru);if(i.length)return(0,E.K)("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("settings")??!1,"group-kind":"overflow-group",key:"settings-menu",priority:this.groupCollapsePriorities?.get("settings")??M.Jl.Max,slot:"actions-end"},i)}_renderSelectionSetItemGroup(){if(!this.updateGraphics.length)return[];const e="inline-end"===this.contextualToolLocation?"actions-end":void 0,t=this.customActions?.filter((e=>"before-selection-set"===e.position)),i=this.customActions?.filter((e=>"after-selection-set"===e.position)),s=this.groupCollapsePriorities?.get("selectionSet")??M.Jl.High;return[(0,E.K)("div",{"group-kind":"measured-content",key:"selection-count-chip-group",priority:s,slot:e},this._renderFeatureCountChip()),(0,E.K)("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("selectionSet")??!1,"group-kind":"overflow-group",key:"selection-set-tool-group",priority:s,slot:e},t?.map((e=>this._renderToolbarItem(e))),this._renderDuplicateButton(),this._renderDeleteButton(),i?.map((e=>this._renderToolbarItem(e))))]}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return[];const{messages:e,state:t}=this;return this._renderToolbarItem({id:"pointer-select",text:e.selectFeature,icon:"cursor",onclick:this._activateDefaultSelectTool,active:"ready"===t})}_renderCreateToolActionGroup(){const e=this._effectiveAvailableCreateTools?.flatMap((e=>this._renderBuiltInCreateToolItem(e)))??[],t=this.customToolOptions?.flatMap((e=>this._renderCustomToolItem(e)))??[];return(0,E.K)("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("createTools")??!0,"group-kind":"overflow-group",key:"create-tools-group",priority:this.groupCollapsePriorities?.get("createTools")??M.Jl.High},e,t)}_renderBuiltInCreateToolItem(e){return this._renderToolbarItem({id:`${e}-button`,text:this.messages.draw[e],icon:et[e],onclick:()=>this._activateCreateTool(e),active:this.activeTool===e&&!this._activeCustomToolOptions})}_renderCustomToolItem(e){const{toolKey:t}=e;return this._renderToolbarItem({id:`custom-${e.toolKey}`,text:e.label,icon:e.icon,onclick:()=>this._activateCreateTool(e.toolName,null,e),active:this._activeCustomToolOptions?.toolKey===t})}_renderUndoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"undo-button",text:this.messages.undo,icon:"undo",disabled:!this.viewModel.canUndo(),onclick:this.undo,flipRTL:!0}):[]}_renderRedoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"redo-button",text:this.messages.redo,icon:"redo",disabled:!this.viewModel.canRedo(),onclick:this.redo,flipRTL:!0}):[]}_renderSettingsMenuButton(){return this.visibleElements.settingsMenu?this._renderToolbarItem({id:"settings-menu-action",text:this.messagesCommon.settings,icon:"gear",active:this._popoverOpen,onclick:()=>this._popoverOpen=!this._popoverOpen,afterCreate:e=>this._calcitePopoverReferenceElement=e,afterUpdate:e=>this._calcitePopoverReferenceElement=e,afterRemoved:()=>this._calcitePopoverReferenceElement=null}):[]}_renderFeatureCountChip(){if(!this.visibleElements.selectionCountLabel)return[];const{layout:e,messages:t,scale:i,id:s,updateGraphics:{length:r}}=this,o=(0,Qe.V)(t.selectedCount,{count:r}),n="s"===i?99:999,l=r>n?(0,Qe.V)(t.selectedCountTruncated,{truncated:n}):r,a="s"===i&&"vertical"===e,c=a?`${s}-selection-chip-small`:`${s}-selection-chip`;return[a?(0,E.K)("span",{classes:{[Xe.chipVertical]:!0,[Xe.chipVerticalSmall]:"s"===this.scale},id:c,tabIndex:0,title:o},l):(0,E.K)("calcite-chip",{appearance:"outline",class:"horizontal"===e?Xe.chipHorizontal:Xe.chipVertical,id:c,kind:"brand",label:o,scale:"l"===i?"m":"s",tabIndex:0,title:"vertical"===e?o:void 0},"vertical"===e?l:o)]}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return[];const{messages:e}=this;return this._renderToolbarItem({id:"duplicate",text:this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature,icon:"copy",onclick:this._onDuplicateSelect})}_renderDeleteButton(){if(!this.visibleElements.deleteButton)return[];const{messages:e}=this,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return this._renderToolbarItem({id:"delete",text:t,icon:"trash",onclick:this.delete})}_renderToolbarItem({id:e,text:t,icon:i,disabled:s,onclick:r,active:o,flipRTL:n,afterCreate:l,afterUpdate:a,afterRemoved:c}){const u=`${this.id}-${e}`;return[(0,E.K)("calcite-action",{active:o,afterCreate:l,afterRemoved:c,afterUpdate:a,bind:this,"data-testid":e,disabled:s||"disabled"===this.state,icon:i,iconFlipRtl:n??!1,id:u,key:e,onclick:r,scale:this.scale,text:t,title:t})]}_remeasurePopoverSizes(e){try{const t=e.parentElement,i=this?.view?.container?.getBoundingClientRect(),s=t?.style;if(!(t&&i&&s&&this.view?.container?.contains(t)))return;const r=this._calcitePopoverReferenceElement;if(!r)return;const{bottom:o,top:n}=r.getBoundingClientRect();if("horizontal"===this.layout){const e=o<i.height/2;e!==("top"===this._relativeLocation)&&(this._relativeLocation=e?"top":"bottom"),e?(s?.setProperty("--sketch-view-height-offset",o-i.top+"px"),s?.setProperty("--sketch-view-margin-offset","30px")):(s?.setProperty("--sketch-view-height-offset",i.bottom-n+"px"),s?.setProperty("--sketch-view-margin-offset","15px"))}else"vertical"===this.layout&&(s.setProperty("--sketch-view-height-offset","15px"),s.setProperty("--sketch-view-margin-offset","15px"));const l=e.shadowRoot?.querySelector("div.header")?.getBoundingClientRect().height;s.setProperty("--sketch-popover-header-offset",`${l}px`)}catch(De){n.A.getLogger(this.declaredClass).warnOnce("Sketch failed to lay out settings menu.",De)}}_activateCreateTool(e,t,i){const s=this._activeCustomToolOptions;if(i||s){if(i?.toolKey===s?.toolKey)return void this.cancel()}else if(this.activeTool===e)return void this.cancel();this._selectionToolbar?.cancel(),this.create(e,t,i)}_onDuplicateSelect(){const e=this.duplicate(),t=this.viewModel.activeTool;"transform"!==t&&"reshape"!==t||this.update(e,{tool:t})}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:i}=e;if(!e.aborted&&i.length){const e=t.tool,s=i.length>1&&"reshape"===e?"transform":e;this.update(i,{...t,tool:s})}this.notifyChange("state")}_activateDefaultSelectTool(){this.cancel(),this.view?.focus()}_refocusOnView(){this.activeTool&&this.view?.focus()}};(0,s._)([(0,u.MZ)()],tt.prototype,"_activeCustomToolOptions",void 0),(0,s._)([(0,u.MZ)()],tt.prototype,"activeTool",null),(0,s._)([(0,u.MZ)({readOnly:!0})],tt.prototype,"activeTooltip",null),(0,s._)([(0,u.MZ)({cast:e=>{if(!e?.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle","multipoint","freehandPolyline","freehandPolygon","mesh"]);return e.filter((e=>t.has(e)))}})],tt.prototype,"availableCreateTools",void 0),(0,s._)([(0,u.MZ)({readOnly:!0})],tt.prototype,"createGraphic",null),(0,s._)([(0,u.MZ)()],tt.prototype,"creationMode",null),(0,s._)([(0,u.MZ)()],tt.prototype,"customToolOptions",void 0),(0,s._)([(0,u.MZ)()],tt.prototype,"customActions",void 0),(0,s._)([(0,u.MZ)()],tt.prototype,"defaultCreateOptions",null),(0,s._)([(0,u.MZ)()],tt.prototype,"defaultUpdateOptions",null),(0,s._)([(0,u.MZ)()],tt.prototype,"icon",null),(0,s._)([(0,u.MZ)()],tt.prototype,"label",null),(0,s._)([(0,u.MZ)()],tt.prototype,"labelOptions",null),(0,s._)([(0,u.MZ)()],tt.prototype,"layer",null),(0,s._)([(0,u.MZ)({type:["horizontal","vertical"],value:"horizontal"})],tt.prototype,"layout",null),(0,s._)([(0,u.MZ)({value:"m"})],tt.prototype,"scale",null),(0,s._)([(0,u.MZ)()],tt.prototype,"toolbarKind",void 0),(0,s._)([(0,u.MZ)()],tt.prototype,"contextualToolLocation",void 0),(0,s._)([(0,u.MZ)()],tt.prototype,"groupCollapsePriorities",void 0),(0,s._)([(0,u.MZ)()],tt.prototype,"groupAllowCollapseOptions",void 0),(0,s._)([(0,u.MZ)(),(0,O.G)("esri/widgets/Sketch/t9n/Sketch")],tt.prototype,"messages",void 0),(0,s._)([(0,u.MZ)(),(0,O.G)("esri/t9n/common")],tt.prototype,"messagesCommon",void 0),(0,s._)([(0,u.MZ)()],tt.prototype,"snappingOptions",null),(0,s._)([(0,u.MZ)()],tt.prototype,"state",null),(0,s._)([(0,u.MZ)()],tt.prototype,"tooltipOptions",null),(0,s._)([(0,u.MZ)({readOnly:!0})],tt.prototype,"updateGraphics",null),(0,s._)([(0,u.MZ)({type:p.A,nonNullable:!0})],tt.prototype,"valueOptions",null),(0,s._)([(0,u.MZ)()],tt.prototype,"view",null),(0,s._)([(0,u.MZ)({type:y.A}),(0,Je.U)(["create","update","undo","redo"])],tt.prototype,"viewModel",null),(0,s._)([(0,u.MZ)({type:w,nonNullable:!0})],tt.prototype,"visibleElements",void 0),(0,s._)([(0,u.MZ)()],tt.prototype,"_effectiveAvailableCreateTools",null),(0,s._)([(0,u.MZ)()],tt.prototype,"_defaultViewModel",void 0),(0,s._)([(0,u.MZ)()],tt.prototype,"_calcitePopoverReferenceElement",void 0),(0,s._)([(0,u.MZ)()],tt.prototype,"_relativeLocation",void 0),(0,s._)([(0,u.MZ)()],tt.prototype,"_popoverOpen",void 0),tt=(0,s._)([(0,d.$)("esri.widgets.Sketch")],tt);const it=tt},12535:(e,t,i)=>{i.d(t,{A:()=>a});var s=i(66866),r=i(52495),o=i(21564),n=(i(39831),i(539),i(9272),i(63863));let l=class extends r.A{constructor(e){super(e),this.colorSelection=!0,this.dynamicScaleToggle=!0,this.gridEnabledToggle=!0,this.numericInputs=!0,this.gridSnapEnabledToggle=!0,this.lineIntervalInput=!0,this.outOfScaleWarning=!0,this.placementButtons=!0,this.rotateWithMapToggle=!0}};(0,s._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"colorSelection",void 0),(0,s._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"dynamicScaleToggle",void 0),(0,s._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"gridEnabledToggle",void 0),(0,s._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"numericInputs",void 0),(0,s._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"gridSnapEnabledToggle",void 0),(0,s._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"lineIntervalInput",void 0),(0,s._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"outOfScaleWarning",void 0),(0,s._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"placementButtons",void 0),(0,s._)([(0,o.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"rotateWithMapToggle",void 0),l=(0,s._)([(0,n.$)("esri.widgets.support.GridControls.VisibleElements")],l);const a=l},11650:(e,t,i)=>{i.d(t,{m:()=>o,o:()=>a});var s=i(17199),r=(i(99484),i(96704));const o=()=>(0,s.W)({icon:()=>i.e(72076).then(i.bind(i,96446)),label:()=>Promise.all([i.e(72076),i.e(87337)]).then(i.bind(i,87337)),switch:()=>Promise.all([i.e(72076),i.e(43281)]).then(i.bind(i,43281)),tooltip:()=>Promise.all([i.e(72076),i.e(17230)]).then(i.bind(i,17230))}),n="esri-labeled-switch",l={label:`${n}__label`,labelContent:`${n}__label-content`,iconInfo:`${n}__icon_info`,iconWarning:`${n}__icon_warning`,tooltip:`${n}__tooltip`};function a({checked:e,disabled:t,hint:i,key:s,label:o,onChange:n,hintIcon:a,hintKind:c}){return(0,r.K)("calcite-label",{class:l.label,disabled:t,key:s,layout:"inline-space-between",scale:"s"},i?(0,r.K)("div",{class:l.labelContent,key:"label-content"},(0,r.K)("div",null,o),(0,r.K)("calcite-icon",{class:"warning"!==c?l.iconInfo:l.iconWarning,icon:a??"information",id:s,onclick:e=>e.stopPropagation(),onpointerdown:e=>{e.preventDefault(),e.stopPropagation();const t=e.target.nextElementSibling;t.open=!t.open},scale:"s",tabIndex:0}),(0,r.K)("calcite-tooltip",{class:l.tooltip,overlayPositioning:"fixed",referenceElement:s},i)):o,(0,r.K)("calcite-switch",{checked:e,disabled:t,scale:"s",onCalciteSwitchChange:e=>n(e.currentTarget.checked)}))}},23148:(e,t,i)=>{i.d(t,{o:()=>s});const s=["label","description","metadata"]}}]);