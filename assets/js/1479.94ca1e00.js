"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1479],{91479:(e,t,i)=>{i.r(t),i.d(t,{default:()=>I});var r=i(66866),s=i(85569),a=i(48982),h=i(14798),n=i(20464),o=i(85251),l=i(21564),d=(i(73446),i(39831),i(63863)),c=i(93065),u=i(12301),p=i(79493),g=i(78397),_=i(57509),f=i(48667),w=i(15704),y=i(40231),m=i(13737),v=i(80734),M=i(9049);const A=["route-info","direction-line","direction-point","polygon-barrier","polyline-barrier","point-barrier","stop"],b={graphic:null,property:null,oldValue:null,newValue:null};function k(e){return e instanceof c.A||e instanceof u.A||e instanceof p.A||e instanceof g.A||e instanceof _.A||e instanceof f.A||e instanceof w.A}let x=class extends((0,y.e)(M.A)){constructor(){super(...arguments),this._graphics=new a.A,this._highlightIds=new Map,this._networkFeatureMap=new Map,this._networkGraphicMap=new Map}get _routeItems(){return new h.A({getCollections:()=>null==this.layer||this.destroyed?[]:[null!=this.layer.routeInfo?new a.A([this.layer.routeInfo]):null,this.layer.directionLines,this.layer.directionPoints,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.pointBarriers,this.layer.stops]})}initialize(){this._updatingHandles.addOnCollectionChange((()=>this._routeItems),(e=>this._routeItemsChanged(e)),o.Vh)}destroy(){this._networkFeatureMap.clear(),this._networkGraphicMap.clear(),this._graphics.removeAll(),this._get("_routeItems")?.destroy()}attach(){this._createGraphicsView()}detach(){this._destroyGraphicsView()}async fetchPopupFeatures(e){return this._graphicsView.hitTest(e).filter((e=>!!e.popupTemplate))}highlight(e){let t;t=k(e)?[this._getNetworkFeatureUid(e)]:function(e){return Array.isArray(e)&&e.length>0&&k(e[0])}(e)?e.map((e=>this._getNetworkFeatureUid(e))):function(e){return a.A.isCollection(e)&&e.length&&k(e.at(0))}(e)?e.map((e=>this._getNetworkFeatureUid(e))).toArray():[e.uid];const i=t.filter(s.Ru);return i.length?(this._addHighlight(i),(0,n.hA)((()=>this._removeHighlight(i)))):(0,n.hA)()}async hitTest(e,t){if(this.suspended)return null;const i=this._graphicsView.hitTest(e).filter(s.Ru).map((e=>this._networkGraphicMap.get(e)));if(!i.length)return null;const{layer:r}=this;return i.reverse().map((t=>({type:"route",layer:r,mapPoint:e,networkFeature:t})))}isUpdating(){return this._graphicsView.updating}moveStart(){}moveEnd(){}update(e){this._graphicsView.processUpdate(e)}viewChange(){this._graphicsView.viewChange()}_addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight()}_createGraphic(e){const t=e.toGraphic();return t.layer=this.layer,t.sourceLayer=this.layer,t}_createGraphicsView(){const e=this.view,t=new m.A(e.featuresTilingScheme);this._graphicsView=new v.A({container:t,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),view:e}),this.container.addChild(t),this._updateHighlight()}_destroyGraphicsView(){this.container.removeChild(this._graphicsView.container),this._graphicsView.destroy()}_getDrawOrder(e){const t=this._networkGraphicMap.get(e);return A.indexOf(t.type)}_getNetworkFeatureUid(e){return this._networkFeatureMap.has(e)?this._networkFeatureMap.get(e).uid:null}_removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight()}_routeItemsChanged(e){if(e.removed.length){this._graphics.removeMany(e.removed.map((e=>{const t=this._networkFeatureMap.get(e);return this._networkFeatureMap.delete(e),this._networkGraphicMap.delete(t),t})));for(const t of e.removed)this.removeHandles(t)}if(e.added.length){this._graphics.addMany(e.added.map((e=>{const t=this._createGraphic(e);return null==t.symbol?null:(this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),t)})).filter(s.Ru));for(const t of e.added)this.addHandles([(0,o.wB)((()=>t.geometry),((e,i)=>{this._updateGraphic(t,"geometry",e,i)})),(0,o.wB)((()=>t.symbol),((e,i)=>{this._updateGraphic(t,"symbol",e,i)}))],t);this._graphics.sort(((e,t)=>this._getDrawOrder(e)-this._getDrawOrder(t)))}}_updateGraphic(e,t,i,r){if(!this._networkFeatureMap.has(e)){const t=this._createGraphic(e);return this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),void this._graphics.add(t)}const s=this._networkFeatureMap.get(e);s[t]=i,b.graphic=s,b.property=t,b.oldValue=r,b.newValue=i,this._graphicsView.graphicUpdateHandler(b)}_updateHighlight(){const e=Array.from(this._highlightIds.keys());this._graphicsView.setHighlight(e)}};(0,r._)([(0,l.MZ)()],x.prototype,"_graphics",void 0),(0,r._)([(0,l.MZ)()],x.prototype,"_routeItems",null),x=(0,r._)([(0,d.$)("esri.views.2d.layers.RouteLayerView2D")],x);const I=x},95387:(e,t,i)=>{i.d(t,{A:()=>y});var r=i(6267),s=i(42766),a=i(46615),h=i(21360),n=i(48325),o=i(80952),l=i(65231),d=i(37353),c=i(38403),u=i(89423),p=i(41746),g=i(80976);const _=Math.PI/180;class f extends d.q{constructor(e){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,h.c)(),this._localOrigin={x:0,y:0},this._getBounds=e}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,r.WD)(this._program)}doRender(e){const{context:t}=e,i=this._getBounds();if(i.length<1)return;this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(e),this._updateBufferData(t,i),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(p.dn.ONE,p.dn.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0);const r=this._program;t.bindVAO(this._vao),t.useProgram(r),r.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),t.gl.lineWidth(1),t.drawElements(p.WR.LINES,8*i.length,p.pe.UNSIGNED_INT,0),t.bindVAO()}_createTransforms(){return{dvs:(0,h.c)()}}_createShaderProgram(e){if(this._program)return;this._program=e.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",w().attributes)}_updateMatricesAndLocalOrigin(e){const{state:t}=e,{displayMat3:i,size:r,resolution:s,pixelRatio:h,rotation:d,viewpoint:c}=t,u=_*d,{x:p,y:g}=c.targetGeometry,f=(0,l.mT)(p,t.spatialReference);this._localOrigin.x=f,this._localOrigin.y=g;const w=h*r[0],y=h*r[1],m=s*w,v=s*y,M=(0,a.g)(this._dvsMat3);(0,a.m)(M,M,i),(0,a.h)(M,M,(0,n.f)(w/2,y/2)),(0,a.c)(M,M,(0,o.f)(r[0]/m,-y/v,1)),(0,a.r)(M,M,-u)}_updateBufferData(e,t){const{x:i,y:r}=this._localOrigin,s=8*t.length,a=new Float32Array(s),h=new Uint32Array(8*t.length);let n=0,o=0;for(const l of t)l&&(a[2*n]=l[0]-i,a[2*n+1]=l[1]-r,a[2*n+2]=l[0]-i,a[2*n+3]=l[3]-r,a[2*n+4]=l[2]-i,a[2*n+5]=l[3]-r,a[2*n+6]=l[2]-i,a[2*n+7]=l[1]-r,h[o]=n+0,h[o+1]=n+3,h[o+2]=n+3,h[o+3]=n+2,h[o+4]=n+2,h[o+5]=n+1,h[o+6]=n+1,h[o+7]=n+0,n+=4,o+=8);if(this._vertexBuffer?this._vertexBuffer.setData(a.buffer):this._vertexBuffer=u.g.createVertex(e,p._U.DYNAMIC_DRAW,a.buffer),this._indexBuffer?this._indexBuffer.setData(h):this._indexBuffer=u.g.createIndex(e,p._U.DYNAMIC_DRAW,h),!this._vao){const t=w();this._vao=new g.Z(e,t.attributes,t.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const w=()=>(0,c.ES)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:p.pe.FLOAT}]});let y=class extends s.i{constructor(e){super(e),this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,r.pR)(this._boundsRenderer)}enableRenderingBounds(e){this._boundsRenderer=new f(e),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(e,t){e.patch(t),this.contains(e)||this.addChild(e),this.requestRender()}onTileError(e){e.clear(),this.contains(e)||this.addChild(e)}_renderChildren(e,t){for(const i of this.children)i.isReady&&i.hasData&&(i.commit(e),e.context.setStencilFunction(p.MT.EQUAL,i.stencilRef,255),i.getDisplayList().replay(e,i,t))}}},13737:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(79432),s=i(95387);class a extends s.A{renderChildren(e){this.attributeView.update(),this.children.some((e=>e.hasData))&&(this.attributeView.bindTextures(e.context,!1),super.renderChildren(e),e.drawPhase===r.S5.MAP&&this._renderChildren(e),this.hasHighlight&&e.drawPhase===r.S5.HIGHLIGHT&&this._renderHighlight(e),this._boundsRenderer&&this._boundsRenderer.doRender(e))}_renderHighlight(e){const{painter:t}=e,i=t.effects.highlight;i.bind(e),this._renderChildren(e,i.defines),i.draw(e),i.unbind()}}}}]);