/*! For license information please see 7167.87db78c4.js.LICENSE.txt */
"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7167,9062],{21394:(e,t,i)=>{i.d(t,{A:()=>g});var s,n=i(66866),r=i(92976),o=i(21564),a=(i(73446),i(85569),i(39831),i(63863)),l=i(47936),c=i(78632),d=i(62802),u=i(22256),h=i(96082),p=i(83811);let y=s=class extends d.A{constructor(...e){super(...e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let i;if(e?.center)i=e;else{if(e?.rings)return super.normalizeCtorArgs(e,t);i={center:e}}return{...super.normalizeCtorArgs(),...i,...t}}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,0!==this.rings.length||!e)return;const i=(0,r.oU)(this.radius,this.radiusUnit,"meters"),s=e.spatialReference;let n,o="geographic";if(s.isWebMercator?o="webMercator":(null!=(s.wkid&&p.A[s.wkid])||(s.wkt2||s.wkt)&&(0,r.x1)(s.wkt2||s.wkt))&&(o="projected"),this.geodesic){let s;switch(o){case"webMercator":s=(0,h.ci)(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":s=e}n=this._createGeodesicCircle(s,i,t),"webMercator"===o&&(n=(0,h.Gh)(n))}else{let s;"webMercator"===o||"projected"===o?s=i/(0,r.Ao)(e.spatialReference):"geographic"===o&&(s=(0,r.vl)(i,"meters",(0,l.tO)(e.spatialReference).radius)),n=this._createPlanarCircle(e,s,t)}this.spatialReference=n.spatialReference,this.addRing(n.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:n,geodesic:r}=this;return new s({center:e?.clone(),numberOfPoints:t,radius:i,radiusUnit:n,geodesic:r})}_createGeodesicCircle(e,t,i){let s=0;const n=[];for(;s<360;){const r=[0,0],o=[e.x,e.y];(0,u.vN)(r,o,s,t),this.hasZ&&r.push(e.z),n.push(r),s+=360/i}return n.push(n[0]),new d.A(n)}_createPlanarCircle(e,t,i){const s=[],n=2*Math.PI/i;for(let r=0;r<i;++r){const i=n*r,o=[e.x+Math.cos(-i)*t,e.y+Math.sin(-i)*t];this.hasZ&&o.push(e.z),s.push(o)}return s.push(s[0]),new d.A({spatialReference:e.spatialReference,rings:[s]})}};(0,n._)([(0,o.MZ)({type:c.A})],y.prototype,"center",void 0),(0,n._)([(0,o.MZ)()],y.prototype,"geodesic",void 0),(0,n._)([(0,o.MZ)()],y.prototype,"numberOfPoints",void 0),(0,n._)([(0,o.MZ)()],y.prototype,"radius",void 0),(0,n._)([(0,o.MZ)()],y.prototype,"radiusUnit",void 0),y=s=(0,n._)([(0,a.$)("esri.geometry.Circle")],y);const g=y},22256:(e,t,i)=>{i.d(t,{TT:()=>p,Zj:()=>f,_3:()=>_,l1:()=>g,qy:()=>y,vN:()=>v});i(17639);var s=i(98849),n=i(92976),r=i(5324),o=i(87926),a=i(42238),l=i(62802),c=(i(78632),i(78983));function d(e){if(!e)return null;if((0,o.EA)(e)&&e.wkid){const t=r.uw[e.wkid];if(t)return t}const t=e.wkt2||e.wkt;if(t){const e=function(e){const t=r._f.exec(e);if(!t||2!==t.length)return null;const i=t[1].split(",");if(!i||i.length<3)return null;const s=parseFloat(i[1]),n=parseFloat(i[2]);return isNaN(s)||isNaN(n)?null:{a:s,f:0===n?0:1/n}}(t);if(e)return e}return null}function u(e){const t=d(e??c.A.WGS84);if(function(e){return null!=e&&"b"in e&&"eSq"in e&&"radius"in e}(t))return t;const i=t.a*(1-t.f);return Object.assign(t,{b:i,eSq:1-(i/t.a)**2,radius:(2*t.a+i)/3,densificationRatio:1e4/((2*t.a+i)/3)})}function h(e,t,i){const{a:s,eSq:n}=u(i),o=Math.sqrt(n),a=Math.sin(t[1]*r.eh),l=s*t[0]*r.eh;let c;return c=n>0?s*((1-n)*(a/(1-n*(a*a))-1/(2*o)*Math.log((1-o*a)/(1+o*a))))*.5:s*a,e[0]=l,e[1]=c,e}function p(e){return null!==d(e)}function y(e,t="square-meters"){if(e.some((e=>!p(e.spatialReference))))throw new s.A("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let s=0;s<e.length;s++){const t=e[s],n=t.spatialReference,{radius:r,densificationRatio:o}=u(n),a=r*o;i.push(m(t,a))}const r=[],o=[0,0],a=[0,0];for(let s=0;s<i.length;s++){const{rings:e,spatialReference:l}=i[s];let c=0;for(let t=0;t<e.length;t++){const i=e[t];h(o,i[0],l),h(a,i[i.length-1],l);let s=a[0]*o[1]-o[0]*a[1];for(let e=0;e<i.length-1;e++)h(o,i[e+1],l),h(a,i[e],l),s+=a[0]*o[1]-o[0]*a[1];c+=s}c=(0,n.oU)(c,"square-meters",t),r.push(c/-2)}return r}function g(e,t="meters"){if(!e)throw new s.A("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some((e=>!p(e.spatialReference))))throw new s.A("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let s=0;s<e.length;s++){const r=e[s],{spatialReference:o}=r,a="polyline"===r.type?r.paths:r.rings;let l=0;for(let e=0;e<a.length;e++){const t=a[e];let i=0;for(let e=1;e<t.length;e++){const s=t[e-1][0],n=t[e][0],r=t[e-1][1],a=t[e][1];if(r!==a||s!==n){const e=new f;_(e,[s,r],[n,a],o),i+=e.distance}}l+=i}l=(0,n.oU)(l,"meters",t),i.push(l)}return i}function m(e,t){if("polyline"!==e.type&&"polygon"!==e.type)throw new s.A("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:i}=e;if(!p(i))throw new s.A("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const n="polyline"===e.type?e.paths:e.rings,r=[],o=[0,0],c=new f;for(const s of n){const e=[];r.push(e),e.push([s[0][0],s[0][1]]);let n,a,l=s[0][0],d=s[0][1];for(let r=0;r<s.length-1;r++){if(n=s[r+1][0],a=s[r+1][1],l===n&&d===a)continue;const u=[l,d];_(c,[l,d],[n,a],i);const{azimuth:h,distance:p}=c,y=p/t;if(y>1){for(let s=1;s<=y-1;s++)v(o,u,h,s*t,i),e.push(o.slice(0));v(o,u,h,(p+Math.floor(y-1)*t)/2,i),e.push(o.slice(0))}v(o,u,h,p,i),e.push(o.slice(0)),l=o[0],d=o[1]}}return"polyline"===e.type?new a.A({paths:r,spatialReference:i}):new l.A({rings:r,spatialReference:i})}class f{constructor(e=0,t=void 0,i=void 0){this.distance=e,this.azimuth=t,this.reverseAzimuth=i}}function v(e,t,i,s,n){const o=t[0],a=t[1],l=o*r.eh,c=a*r.eh,d=(i??0)*r.eh,{a:h,b:p,f:y}=u(n),g=Math.sin(d),m=Math.cos(d),f=(1-y)*Math.tan(c),v=1/Math.sqrt(1+f*f),_=f*v,b=Math.atan2(f,m),w=v*g,S=w*w,M=1-S,L=M*(h*h-p*p)/(p*p),E=1+L/16384*(4096+L*(L*(320-175*L)-768)),I=L/1024*(256+L*(L*(74-47*L)-128));let T,C,x,A,R=s/(p*E),O=2*Math.PI;for(;Math.abs(R-O)>1e-12;)x=Math.cos(2*b+R),T=Math.sin(R),C=Math.cos(R),A=I*T*(x+I/4*(C*(2*x*x-1)-I/6*x*(4*T*T-3)*(4*x*x-3))),O=R,R=s/(p*E)+A;const k=_*T-v*C*m,Z=Math.atan2(_*C+v*T*m,(1-y)*Math.sqrt(S+k*k)),P=Math.atan2(T*g,v*C-_*T*m),F=y/16*M*(4+y*(4-3*M)),N=Z/r.eh,D=(l+(P-(1-F)*y*w*(R+F*T*(x+F*C*(2*x*x-1)))))/r.eh;return e[0]=D,e[1]=N,e}function _(e,t,i,s){const n=t[0]*r.eh,o=t[1]*r.eh,a=i[0]*r.eh,l=i[1]*r.eh,{a:c,b:d,f:h,radius:p}=u(s),y=a-n,g=Math.atan((1-h)*Math.tan(o)),m=Math.atan((1-h)*Math.tan(l)),f=Math.sin(g),v=Math.cos(g),_=Math.sin(m),b=Math.cos(m);let w,S,M,L,E,I,T,C,x,A,R=1e3,O=y;do{if(T=Math.sin(O),C=Math.cos(O),M=Math.sqrt(b*T*(b*T)+(v*_-f*b*C)*(v*_-f*b*C)),0===M)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;E=f*_+v*b*C,I=Math.atan2(M,E),x=v*b*T/M,S=1-x*x,L=E-2*f*_/S,isNaN(L)&&(L=0),A=h/16*S*(4+h*(4-3*S)),w=O,O=y+(1-A)*h*x*(I+A*M*(L+A*E*(2*L*L-1)))}while(Math.abs(O-w)>1e-12&&--R>0);if(0===R){const t=p,i=Math.acos(Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos(a-n))*t,s=a-n,c=Math.sin(s)*Math.cos(l),d=Math.cos(o)*Math.sin(l)-Math.sin(o)*Math.cos(l)*Math.cos(s),u=Math.atan2(c,d);return e.azimuth=u/r.eh,e.distance=i,e.reverseAzimuth=void 0,e}const k=S*(c*c-d*d)/(d*d),Z=k/1024*(256+k*(k*(74-47*k)-128)),P=d*(1+k/16384*(4096+k*(k*(320-175*k)-768)))*(I-Z*M*(L+Z/4*(E*(2*L*L-1)-Z/6*L*(4*M*M-3)*(4*L*L-3)))),F=Math.atan2(b*Math.sin(O),v*_-f*b*Math.cos(O)),N=Math.atan2(v*Math.sin(O),v*_*Math.cos(O)-f*b);return e.azimuth=F/r.eh,e.distance=P,e.reverseAzimuth=N/r.eh,e}},97588:(e,t,i)=>{i.r(t),i.d(t,{default:()=>M});var s=i(66866),n=(i(17639),i(98849)),r=i(40189),o=i(20909),a=i(21564),l=(i(73446),i(85569),i(39831)),c=i(75094),d=i(63863),u=i(83780),h=i(45307),p=i(90752),y=i(57822),g=i(84698);let m=class extends h.A{constructor(e){super(e),this.type="csv",this.refresh=(0,r.sg)((async e=>{await this.load();const{extent:t,timeExtent:i}=await this._connection.invoke("refresh",e);return t&&(this.sourceJSON.extent=t),i&&(this.sourceJSON.timeInfo.timeExtent=[i.start,i.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}}))}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return y.A.fromJSON(i)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._connection.invoke("queryFeatures",e?e.toJSON():null,t)}async queryFeatureCount(e,t={}){return await this.load(t),this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)}async queryObjectIds(e,t={}){return await this.load(t),this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)}async queryExtent(e,t={}){await this.load(t);const i=await this._connection.invoke("queryExtent",e?e.toJSON():null,t);return{count:i.count,extent:g.A.fromJSON(i.extent)}}async querySnapping(e,t={}){return await this.load(t),this._connection.invoke("querySnapping",e,t)}async _startWorker(e){this._connection=await(0,p.ho)("CSVSourceWorker",{strategy:(0,l.A)("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{url:t,delimiter:i,fields:s,latitudeField:n,longitudeField:r,spatialReference:o,timeInfo:a}=this.loadOptions,c=await this._connection.invoke("load",{url:t,customParameters:this.customParameters,parsingOptions:{delimiter:i,fields:s?.map((e=>e.toJSON())),latitudeField:n,longitudeField:r,spatialReference:o?.toJSON(),timeInfo:a?.toJSON()}},{signal:e});this.locationInfo=c.locationInfo,this.sourceJSON=c.layerDefinition,this.delimiter=c.delimiter}};(0,s._)([(0,a.MZ)()],m.prototype,"type",void 0),(0,s._)([(0,a.MZ)()],m.prototype,"loadOptions",void 0),(0,s._)([(0,a.MZ)()],m.prototype,"customParameters",void 0),(0,s._)([(0,a.MZ)()],m.prototype,"locationInfo",void 0),(0,s._)([(0,a.MZ)()],m.prototype,"sourceJSON",void 0),(0,s._)([(0,a.MZ)()],m.prototype,"delimiter",void 0),m=(0,s._)([(0,d.$)("esri.layers.graphics.sources.CSVSource")],m);var f=i(20061),v=i(14474),_=i(63680),b=i(78983);function w(e,t){throw new n.A(t,`CSVLayer (title: ${e.title}, id: ${e.id}) cannot be saved to a portal item`)}let S=class extends u.default{constructor(...e){super(...e),this.geometryType="point",this.capabilities=(0,f.f)(!1,!1),this.delimiter=null,this.editingEnabled=!1,this.fields=null,this.latitudeField=null,this.locationType="coordinates",this.longitudeField=null,this.operationalLayerType="CSV",this.outFields=["*"],this.path=null,this.spatialReference=b.A.WGS84,this.source=null,this.type="csv"}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=null!=e?e.signal:null,i=this.loadFromPortal({supportedTypes:["CSV"],supportsData:!1},e).catch(r.QP).then((async()=>this.initLayerProperties(await this.createGraphicsSource(t))));return this.addResolvingPromise(i),Promise.resolve(this)}get isTable(){return this.loaded&&null==this.geometryType}readWebMapLabelsVisible(e,t){return null!=t.showLabels?t.showLabels:!!t.layerDefinition?.drawingInfo?.labelingInfo}set url(e){if(!e)return void this._set("url",e);const t=(0,o.An)(e);this._set("url",t.path),t.query&&(this.customParameters={...this.customParameters,...t.query})}async createGraphicsSource(e){const t=new m({loadOptions:{delimiter:this.delimiter,fields:this.fields,latitudeField:this.latitudeField??void 0,longitudeField:this.longitudeField??void 0,spatialReference:this.spatialReference??void 0,timeInfo:this.timeInfo??void 0,url:this.url},customParameters:this.customParameters??void 0});return this._set("source",t),await t.load({signal:e}),this.read({locationInfo:t.locationInfo,columnDelimiter:t.delimiter},{origin:"service",url:this.parsedUrl}),t}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(v.A.from(e)||this.createQuery()))).then((e=>{if(e?.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this.load().then((()=>this.source.queryObjectIds(v.A.from(e)||this.createQuery())))}queryFeatureCount(e,t){return this.load().then((()=>this.source.queryFeatureCount(v.A.from(e)||this.createQuery())))}queryExtent(e,t){return this.load().then((()=>this.source.queryExtent(v.A.from(e)||this.createQuery())))}read(e,t){super.read(e,t),t&&"service"===t.origin&&this.revert(["latitudeField","longitudeField"],"service")}write(e,t){return super.write(e,{...t,writeLayerSchema:!0})}clone(){throw new n.A("csv-layer:clone",`CSVLayer (title: ${this.title}, id: ${this.id}) cannot be cloned`)}async save(e){return w(this,"csv-layer:save")}async saveAs(e,t){return w(this,"csv-layer:save-as")}async hasDataChanged(){try{const{dataChanged:e,updates:t}=await this.source.refresh(this.customParameters);return null!=t&&this.read(t,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}_verifyFields(){}_verifySource(){}_hasMemorySource(){return!1}};(0,s._)([(0,a.MZ)({readOnly:!0,json:{read:!1,write:!1}})],S.prototype,"capabilities",void 0),(0,s._)([(0,a.MZ)({type:[","," ",";","|","\t"],json:{read:{source:"columnDelimiter"},write:{target:"columnDelimiter",ignoreOrigin:!0}}})],S.prototype,"delimiter",void 0),(0,s._)([(0,a.MZ)({readOnly:!0,type:Boolean,json:{origins:{"web-scene":{read:!1,write:!1}}}})],S.prototype,"editingEnabled",void 0),(0,s._)([(0,a.MZ)({json:{read:{source:"layerDefinition.fields"},write:{target:"layerDefinition.fields"}}})],S.prototype,"fields",void 0),(0,s._)([(0,a.MZ)({type:Boolean,readOnly:!0})],S.prototype,"isTable",null),(0,s._)([(0,c.w)("web-map","labelsVisible",["layerDefinition.drawingInfo.labelingInfo","showLabels"])],S.prototype,"readWebMapLabelsVisible",null),(0,s._)([(0,a.MZ)({type:String,json:{read:{source:"locationInfo.latitudeFieldName"},write:{target:"locationInfo.latitudeFieldName",ignoreOrigin:!0}}})],S.prototype,"latitudeField",void 0),(0,s._)([(0,a.MZ)({type:["show","hide"]})],S.prototype,"listMode",void 0),(0,s._)([(0,a.MZ)({type:["coordinates"],json:{read:{source:"locationInfo.locationType"},write:{target:"locationInfo.locationType",ignoreOrigin:!0,isRequired:!0}}})],S.prototype,"locationType",void 0),(0,s._)([(0,a.MZ)({type:String,json:{read:{source:"locationInfo.longitudeFieldName"},write:{target:"locationInfo.longitudeFieldName",ignoreOrigin:!0}}})],S.prototype,"longitudeField",void 0),(0,s._)([(0,a.MZ)({type:["CSV"]})],S.prototype,"operationalLayerType",void 0),(0,s._)([(0,a.MZ)()],S.prototype,"outFields",void 0),(0,s._)([(0,a.MZ)({type:String,json:{origins:{"web-scene":{read:!1,write:!1}},read:!1,write:!1}})],S.prototype,"path",void 0),(0,s._)([(0,a.MZ)({json:{read:!1},cast:null,type:m,readOnly:!0})],S.prototype,"source",void 0),(0,s._)([(0,a.MZ)({json:{read:!1},value:"csv",readOnly:!0})],S.prototype,"type",void 0),(0,s._)([(0,a.MZ)({json:{read:_.r,write:{isRequired:!0,ignoreOrigin:!0,writer:_.w}}})],S.prototype,"url",null),S=(0,s._)([(0,d.$)("esri.layers.CSVLayer")],S);const M=S},8485:(e,t,i)=>{i.r(t),i.d(t,{default:()=>U});var s=i(66866),n=(i(17639),i(56542)),r=(i(17671),i(84685),i(20299),i(25498),i(79300),i(76589),i(47347),i(2692),i(48887),i(49169)),o=i(35775),a=i(40189),l=i(20909),c=i(21564),d=(i(73446),i(85569),i(39831)),u=i(63863),h=i(12433),p=i(68833),y=i(98849),g=i(45307),m=i(539),f=i(90752),v=i(20061),_=i(57822),b=i(84698),w=i(62802);let S=class extends g.A{constructor(){super(...arguments),this.type="geojson",this.refresh=(0,a.sg)((async e=>{await this.load();const{extent:t,timeExtent:i}=await this._connection.invoke("refresh",e);return this.sourceJSON.extent=t,i&&(this.sourceJSON.timeInfo.timeExtent=[i.start,i.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}}))}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}applyEdits(e){return this.load().then((()=>this._applyEdits(e)))}openPorts(){return this.load().then((()=>this._connection.openPorts()))}queryFeatures(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,t))).then((e=>_.A.fromJSON(e)))}queryFeaturesJSON(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,t)))}queryFeatureCount(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)))}queryObjectIds(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)))}queryExtent(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t))).then((e=>({count:e.count,extent:b.A.fromJSON(e.extent)})))}querySnapping(e,t={}){return this.load(t).then((()=>this._connection.invoke("querySnapping",e,t)))}_applyEdits(e){if(!this._connection)throw new y.A("geojson-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField,i=[],s=[],n=[];if(e.addFeatures)for(const r of e.addFeatures)i.push(this._serializeFeature(r));if(e.deleteFeatures)for(const r of e.deleteFeatures)"objectId"in r&&null!=r.objectId?s.push(r.objectId):"attributes"in r&&null!=r.attributes[t]&&s.push(r.attributes[t]);if(e.updateFeatures)for(const r of e.updateFeatures)n.push(this._serializeFeature(r));return this._connection.invoke("applyEdits",{adds:i,updates:n,deletes:s}).then((({extent:e,timeExtent:t,featureEditResults:i})=>(this.sourceJSON.extent=e,t&&(this.sourceJSON.timeInfo.timeExtent=[t.start,t.end]),this._createEditsResult(i))))}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new y.A("geojson-layer-source:edit-failure",t.description,{code:t.code}):null}}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e);return i?{geometry:i.toJSON(),attributes:t}:{attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return null==t?null:"mesh"===t.type||"extent"===t.type?w.A.fromExtent(t.extent):t}async _startWorker(e){this._connection=await(0,f.ho)("GeoJSONSourceWorker",{strategy:(0,d.A)("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:t,spatialReference:i,hasZ:s,geometryType:n,objectIdField:r,url:o,timeInfo:a,customParameters:l}=this.layer,c="defaults"===this.layer.originOf("spatialReference"),u={url:o,customParameters:l,fields:t&&t.map((e=>e.toJSON())),geometryType:h.g.toJSON(n),hasZ:s,objectIdField:r,timeInfo:a?a.toJSON():null,spatialReference:c?null:i&&i.toJSON()},p=await this._connection.invoke("load",u,{signal:e});for(const d of p.warnings)m.A.getLogger(this.layer).warn("#load()",`$${d.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:d});p.featureErrors.length&&m.A.getLogger(this.layer).warn("#load()",`Encountered ${p.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:p.featureErrors}),this.sourceJSON=p.layerDefinition,this.capabilities=(0,v.f)(this.sourceJSON.hasZ,!0)}};(0,s._)([(0,c.MZ)()],S.prototype,"capabilities",void 0),(0,s._)([(0,c.MZ)()],S.prototype,"type",void 0),(0,s._)([(0,c.MZ)({constructOnly:!0})],S.prototype,"layer",void 0),(0,s._)([(0,c.MZ)()],S.prototype,"sourceJSON",void 0),S=(0,s._)([(0,u.$)("esri.layers.graphics.sources.GeoJSONSource")],S);var M=i(15305),L=i(16161),E=i(15053),I=i(64782),T=i(41506),C=i(94795),x=i(34722),A=i(50508),R=i(25389),O=i(90826),k=i(84356),Z=i(48330),P=i(25392),F=i(24738),N=i(77567),D=i(42453),V=i(86155),G=i(79682),$=i(14474),B=i(44116),z=i(12129),H=i(78983);const K=(0,N.p)();let j=class extends((0,C.f)((0,L.d)((0,I.J)((0,E.F)((0,M.d)((0,O.e)((0,R.j)((0,A.J)((0,T.q)((0,x.A)((0,o.P)(p.A)))))))))))){constructor(e){super(e),this.copyright=null,this.dateFieldsTimeZone=null,this.definitionExpression=null,this.displayField=null,this.editingEnabled=!1,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="GeoJSON",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new S({layer:this}),this.spatialReference=H.A.WGS84,this.templates=null,this.title="GeoJSON",this.type="geojson",this.typeIdField=null,this.types=null}destroy(){this.source?.destroy()}load(e){const t=this.loadFromPortal({supportedTypes:["GeoJson"],supportsData:!1},e).catch(a.QP).then((()=>this.source.load(e))).then((()=>{this.read(this.source.sourceJSON,{origin:"service",url:this.parsedUrl}),this.revert(["objectIdField","fields","timeInfo"],"service"),(0,D.yp)(this.renderer,this.fieldsIndex),(0,D.sv)(this.timeInfo,this.fieldsIndex)}));return this.addResolvingPromise(t),Promise.resolve(this)}get capabilities(){return this.source?this.source.capabilities:null}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}get isTable(){return this.loaded&&null==this.geometryType}get parsedUrl(){return this.url?(0,l.An)(this.url):null}set renderer(e){(0,D.yp)(e,this.fieldsIndex),this._set("renderer",e)}set url(e){if(!e)return void this._set("url",e);const t=(0,l.An)(e);this._set("url",t.path),t.query&&(this.customParameters={...this.customParameters,...t.query})}async applyEdits(e,t){const{applyEdits:s}=await i.e(5903).then(i.bind(i,75903));await this.load();const n=await s(this,this.source,e,t);return this.read({extent:this.source.sourceJSON.extent,timeInfo:this.source.sourceJSON.timeInfo},{origin:"service",ignoreDefaults:!0}),n}on(e,t){return super.on(e,t)}createPopupTemplate(e){return(0,B.tn)(this,e)}createQuery(){const e=new $.A,t=this.capabilities?.data;e.returnGeometry=!0,t&&t.supportsZ&&(e.returnZ=!0),e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:i,timeExtent:s}=this;return e.timeExtent=null!=i&&null!=s?s.offset(-i.value,i.unit):s||null,e}getFieldDomain(e,t){let i,s=!1;const n=t?.feature,r=n?.attributes,o=this.typeIdField&&r?.[this.typeIdField];return null!=o&&this.types&&(s=this.types.some((t=>t.id==o&&(i=t.domains&&t.domains[e],i&&"inherited"===i.type&&(i=this._getLayerDomain(e)),!0)))),s||i||(i=this._getLayerDomain(e)),i}getField(e){return this.fieldsIndex.get(e)}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures($.A.from(e)||this.createQuery(),t))).then((e=>{if(e?.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this.load().then((()=>this.source.queryObjectIds($.A.from(e)||this.createQuery(),t)))}queryFeatureCount(e,t){return this.load().then((()=>this.source.queryFeatureCount($.A.from(e)||this.createQuery(),t)))}queryExtent(e,t){return this.load().then((()=>this.source.queryExtent($.A.from(e)||this.createQuery(),t)))}async hasDataChanged(){try{const{dataChanged:e,updates:t}=await this.source.refresh(this.customParameters);return null!=t&&this.read(t,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}_getLayerDomain(e){if(!this.fields)return null;let t=null;return this.fields.some((i=>(i.name===e&&(t=i.domain),!!t))),t}};(0,s._)([(0,c.MZ)({readOnly:!0,json:{read:!1,write:!1}})],j.prototype,"capabilities",null),(0,s._)([(0,c.MZ)({type:String})],j.prototype,"copyright",void 0),(0,s._)([(0,c.MZ)({readOnly:!0})],j.prototype,"createQueryVersion",null),(0,s._)([(0,c.MZ)((0,z.P6)("dateFieldsTimeReference"))],j.prototype,"dateFieldsTimeZone",void 0),(0,s._)([(0,c.MZ)({readOnly:!0})],j.prototype,"defaultPopupTemplate",null),(0,s._)([(0,c.MZ)({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],j.prototype,"definitionExpression",void 0),(0,s._)([(0,c.MZ)({type:String})],j.prototype,"displayField",void 0),(0,s._)([(0,c.MZ)({type:Boolean})],j.prototype,"editingEnabled",void 0),(0,s._)([(0,c.MZ)(k.Yj)],j.prototype,"elevationInfo",void 0),(0,s._)([(0,c.MZ)({type:[F.A],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],j.prototype,"fields",void 0),(0,s._)([(0,c.MZ)(K.fieldsIndex)],j.prototype,"fieldsIndex",void 0),(0,s._)([(0,c.MZ)({type:b.A,json:{name:"extent"}})],j.prototype,"fullExtent",void 0),(0,s._)([(0,c.MZ)({type:["point","polygon","polyline","multipoint"],json:{read:{reader:h.g.read}}})],j.prototype,"geometryType",void 0),(0,s._)([(0,c.MZ)({type:Boolean})],j.prototype,"hasZ",void 0),(0,s._)([(0,c.MZ)(k.id)],j.prototype,"id",void 0),(0,s._)([(0,c.MZ)({type:Boolean,readOnly:!0})],j.prototype,"isTable",null),(0,s._)([(0,c.MZ)(k.kF)],j.prototype,"labelsVisible",void 0),(0,s._)([(0,c.MZ)({type:[V.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:G.w},write:!0}})],j.prototype,"labelingInfo",void 0),(0,s._)([(0,c.MZ)(k.fV)],j.prototype,"legendEnabled",void 0),(0,s._)([(0,c.MZ)({type:["show","hide"]})],j.prototype,"listMode",void 0),(0,s._)([(0,c.MZ)({type:String,json:{name:"layerDefinition.objectIdField",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"objectIdField"}}}})],j.prototype,"objectIdField",void 0),(0,s._)([(0,c.MZ)(k.ke)],j.prototype,"opacity",void 0),(0,s._)([(0,c.MZ)({type:["GeoJSON"]})],j.prototype,"operationalLayerType",void 0),(0,s._)([(0,c.MZ)({readOnly:!0})],j.prototype,"parsedUrl",null),(0,s._)([(0,c.MZ)(k.M6)],j.prototype,"popupEnabled",void 0),(0,s._)([(0,c.MZ)({type:n.A,json:{name:"popupInfo",write:!0}})],j.prototype,"popupTemplate",void 0),(0,s._)([(0,c.MZ)({types:r.H,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{name:"drawingInfo.renderer"},"web-scene":{types:r.X}}}})],j.prototype,"renderer",null),(0,s._)([(0,c.MZ)(k.PY)],j.prototype,"screenSizePerspectiveEnabled",void 0),(0,s._)([(0,c.MZ)({readOnly:!0})],j.prototype,"source",void 0),(0,s._)([(0,c.MZ)({type:H.A})],j.prototype,"spatialReference",void 0),(0,s._)([(0,c.MZ)({type:[Z.A]})],j.prototype,"templates",void 0),(0,s._)([(0,c.MZ)()],j.prototype,"title",void 0),(0,s._)([(0,c.MZ)({json:{read:!1},readOnly:!0})],j.prototype,"type",void 0),(0,s._)([(0,c.MZ)({type:String,readOnly:!0})],j.prototype,"typeIdField",void 0),(0,s._)([(0,c.MZ)({type:[P.A]})],j.prototype,"types",void 0),(0,s._)([(0,c.MZ)(k.OZ)],j.prototype,"url",null),j=(0,s._)([(0,u.$)("esri.layers.GeoJSONLayer")],j);const U=j},31828:(e,t,i)=>{i.d(t,{A:()=>p});var s=i(66866),n=i(21564),r=(i(73446),i(85569),i(39831),i(63863)),o=i(8651),a=i(68833),l=i(15305),c=i(25389),d=i(91394),u=i(60973);let h=class extends((0,l.d)((0,c.j)(a.A))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new d.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,s._)([(0,n.MZ)({type:u.A})],h.prototype,"elevationInfo",void 0),(0,s._)([(0,n.MZ)((0,o.C)(d.Y,"graphics"))],h.prototype,"graphics",void 0),(0,s._)([(0,n.MZ)({type:["show","hide"]})],h.prototype,"listMode",void 0),(0,s._)([(0,n.MZ)()],h.prototype,"screenSizePerspectiveEnabled",void 0),(0,s._)([(0,n.MZ)({readOnly:!0})],h.prototype,"type",void 0),(0,s._)([(0,n.MZ)({constructOnly:!0})],h.prototype,"internal",void 0),h=(0,s._)([(0,r.$)("esri.layers.GraphicsLayer")],h);const p=h},62102:(e,t,i)=>{i.r(t),i.d(t,{default:()=>R});var s=i(66866),n=i(14798),r=i(6412),o=i(539),a=i(35775),l=i(40189),c=i(85251),d=i(21564),u=(i(73446),i(85569),i(39831),i(55135)),h=i(75094),p=i(63863),y=i(77542),g=i(94255),m=i(68833),f=i(15305),v=i(41506),_=i(34722),b=i(25389),w=i(12434),S=i(26099),M=i(62090),L=i(82576),E=i(18437);const I=Symbol("WebScene");var T=i(15954),C=i(22942),x=i(91146);let A=class extends((0,f.d)((0,b.j)((0,v.q)((0,_.A)((0,E.l)((0,L.Q)((0,a.P)(m.A)))))))){constructor(e){super(e),this.allLayers=new n.A({getCollections:()=>[this.layers],getChildrenFunction:e=>"layers"in e?e.layers:null}),this.allTables=(0,M.Z)(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._debouncedSaveOperations=(0,l.sg)((async(e,t,s)=>{const{save:n,saveAs:r}=await i.e(4627).then(i.bind(i,84627));switch(e){case T.X.SAVE:return n(this,t);case T.X.SAVE_AS:return r(this,s,t)}}))}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([(0,c.wB)((()=>{let e=this.parent;for(;e&&"parent"in e&&e.parent;)e=e.parent;return e&&I in e}),(e=>{const t="prevent-adding-tables";this.removeHandles(t),e&&(this.tables.removeAll(),this.addHandles((0,c.on)((()=>this.tables),"before-add",(e=>{e.preventDefault(),o.A.getLogger(this).errorOnce("tables","tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.")})),t))}),c.pc),(0,c.wB)((()=>this.visible),this._onVisibilityChange.bind(this),c.OH)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf("portalItem")===g.Gr.USER}_writeLayers(e,t,i,s){const n=[];if(!e)return n;e.forEach((e=>{const t=(0,x.CJ)(e,s.webmap?s.webmap.getLayerJSONFromResourceInfo(e):null,s);t?.layerType&&n.push(t)})),t.layers=n}set portalItem(e){this._set("portalItem",e)}readPortalItem(e,t,i){const{itemId:s,layerType:n}=t;if("GroupLayer"===n&&s)return new S.default({id:s,portal:i?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}set visibilityMode(e){const t=this._get("visibilityMode")!==e;this._set("visibilityMode",e),t&&this._enforceVisibility(e,this.visible)}async beforeSave(){return(0,C.dL)(this)}load(e){const t=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Group Layer","Scene Service"],layerModuleTypeMap:w.S},e).catch((e=>{if((0,l.QP)(e),this.sourceIsPortalItem)throw e}));return this.addResolvingPromise(t),Promise.resolve(this)}async loadAll(){return(0,r.g)(this,(e=>{e(this.layers,this.tables)}))}async save(e){return this._debouncedSaveOperations(T.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(T.X.SAVE_AS,t,e)}layerAdded(e){e.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(e):"inherited"===this.visibilityMode&&(e.visible=this.visible),this.hasHandles(e.uid)?console.error(`Layer readded to Grouplayer: uid=${e.uid}`):this.addHandles((0,c.wB)((()=>e.visible),(t=>this._onChildVisibilityChange(e,t)),c.OH),e.uid)}layerRemoved(e){this.removeHandles(e.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach((t=>{t!==e&&(t.visible=!1)}))}_enforceVisibility(e,t){if(!(0,u.oY)(this).initialized)return;const i=this.layers;let s=i.find((e=>e.visible));switch(e){case"exclusive":i.length&&!s&&(s=i.at(0),s.visible=!0),this._turnOffOtherLayers(s);break;case"inherited":i.forEach((e=>{e.visible=t}))}}_onVisibilityChange(e){"inherited"===this.visibilityMode&&this.layers.forEach((t=>{t.visible=e}))}_onChildVisibilityChange(e,t){switch(this.visibilityMode){case"exclusive":t?this._turnOffOtherLayers(e):this._isAnyLayerVisible()||(e.visible=!0);break;case"inherited":e.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some((e=>e.visible))}};(0,s._)([(0,d.MZ)({readOnly:!0,dependsOn:[]})],A.prototype,"allLayers",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],A.prototype,"allTables",void 0),(0,s._)([(0,d.MZ)({json:{read:!0,write:!0}})],A.prototype,"blendMode",void 0),(0,s._)([(0,d.MZ)()],A.prototype,"fullExtent",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],A.prototype,"sourceIsPortalItem",null),(0,s._)([(0,d.MZ)({json:{read:!1,write:{ignoreOrigin:!0}}})],A.prototype,"layers",void 0),(0,s._)([(0,y.K)("layers")],A.prototype,"_writeLayers",null),(0,s._)([(0,d.MZ)({type:["GroupLayer"]})],A.prototype,"operationalLayerType",void 0),(0,s._)([(0,d.MZ)({json:{origins:{"web-map":{read:!1,write:{overridePolicy(e,t,i){return{enabled:"Group Layer"===e?.type&&i?.initiator!==this}}}},"web-scene":{read:!1,write:!1}}}})],A.prototype,"portalItem",null),(0,s._)([(0,h.w)("web-map","portalItem",["itemId"])],A.prototype,"readPortalItem",null),(0,s._)([(0,y.K)("web-map","portalItem",{itemId:{type:String}})],A.prototype,"writePortalItem",null),(0,s._)([(0,d.MZ)()],A.prototype,"spatialReference",void 0),(0,s._)([(0,d.MZ)({json:{read:!1},readOnly:!0,value:"group"})],A.prototype,"type",void 0),(0,s._)([(0,d.MZ)({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(e,t,i)=>{"inherited"!==e&&(t[i]=e)}}}}})],A.prototype,"visibilityMode",null),A=(0,s._)([(0,p.$)("esri.layers.GroupLayer")],A);const R=A},19062:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Z});var s,n=i(66866),r=(i(17639),i(48982)),o=i(14798),a=i(35775),l=i(40189),c=i(85251),d=i(20909),u=i(21564),h=i(73446),p=(i(85569),i(39831),i(75094)),y=i(63863),g=i(77542),m=i(78983),f=i(68833),v=i(15305),_=i(41506),b=i(34722),w=i(50508),S=i(25389),M=i(84356),L=i(17306),E=i(21877),I=i(45307),T=i(96274),C=i(78521),x=i(84698);let A=s=class extends(L.A.EventedMixin((0,E.Te)(I.A))){constructor(...e){super(...e),this.description=null,this.fullExtent=null,this.id=null,this.networkLink=null,this.parent=null,this.sublayers=null,this.title=null,this.sourceJSON=null,this.layer=null,this.addHandles([(0,c.on)((()=>this.sublayers),"after-add",(({item:e})=>{e.parent=this,e.layer=this.layer}),c.OH),(0,c.on)((()=>this.sublayers),"after-remove",(({item:e})=>{e.layer=e.parent=null}),c.OH),(0,c.wB)((()=>this.sublayers),((e,t)=>{if(t)for(const i of t)i.layer=i.parent=null;if(e)for(const i of e)i.parent=this,i.layer=this.layer}),c.OH),(0,c.wB)((()=>this.layer),(e=>{if(this.sublayers)for(const t of this.sublayers)t.layer=e}),c.OH)])}initialize(){(0,c.C_)((()=>this.networkLink)).then((()=>(0,c.C_)((()=>!0===this.visible)))).then((()=>this.load()))}load(e){if(!this.networkLink)return;if(this.networkLink.viewFormat)return;const t=null!=e?e.signal:null,i=this._fetchService(this._get("networkLink")?.href??"",t).then((e=>{const t=(0,C.Qm)(e.sublayers);this.fullExtent=x.A.fromJSON(t),this.sourceJSON=e;const i=(0,h.dp)(r.A.ofType(s),(0,C.Jy)(s,e));this.sublayers?this.sublayers.addMany(i):this.sublayers=i,this.layer?.emit("sublayer-update"),this.layer&&this.layer.notifyChange("visibleSublayers")}));return this.addResolvingPromise(i),Promise.resolve(this)}get visible(){return this._get("visible")}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this.layer&&this.layer.notifyChange("visibleSublayers"))}readVisible(e,t){return!!t.visibility}_fetchService(e,t){return(0,C.Ox)(e,this.layer.outSpatialReference,this.layer.refreshInterval,t).then((e=>(0,C._4)(e.data)))}};(0,n._)([(0,u.MZ)()],A.prototype,"description",void 0),(0,n._)([(0,u.MZ)({type:x.A})],A.prototype,"fullExtent",void 0),(0,n._)([(0,u.MZ)()],A.prototype,"id",void 0),(0,n._)([(0,u.MZ)({readOnly:!0,value:null})],A.prototype,"networkLink",void 0),(0,n._)([(0,u.MZ)({json:{write:{allowNull:!0}}})],A.prototype,"parent",void 0),(0,n._)([(0,u.MZ)({type:r.A.ofType(A),json:{write:{allowNull:!0}}})],A.prototype,"sublayers",void 0),(0,n._)([(0,u.MZ)({value:null,json:{read:{source:"name",reader:e=>(0,T._e)(e)}}})],A.prototype,"title",void 0),(0,n._)([(0,u.MZ)({value:!0})],A.prototype,"visible",null),(0,n._)([(0,p.w)("visible",["visibility"])],A.prototype,"readVisible",null),(0,n._)([(0,u.MZ)()],A.prototype,"sourceJSON",void 0),(0,n._)([(0,u.MZ)()],A.prototype,"layer",void 0),A=s=(0,n._)([(0,y.$)("esri.layers.support.KMLSublayer")],A);const R=A,O=["kml","xml"];let k=class extends((0,v.d)((0,w.J)((0,S.j)((0,_.q)((0,b.A)((0,a.P)(f.A))))))){constructor(...e){super(...e),this._visibleFolders=[],this.allSublayers=new o.A({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.sublayers}),this.outSpatialReference=m.A.WGS84,this.path=null,this.legendEnabled=!1,this.operationalLayerType="KML",this.sublayers=null,this.type="kml",this.url=null}initialize(){this.addHandles([(0,c.wB)((()=>this.sublayers),((e,t)=>{t&&t.forEach((e=>{e.parent=null,e.layer=null})),e&&e.forEach((e=>{e.parent=this,e.layer=this}))}),c.OH),this.on("sublayer-update",(()=>this.notifyChange("fullExtent")))])}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}readSublayersFromItemOrWebMap(e,t){this._visibleFolders=t.visibleFolders}readSublayers(e,t,i){return(0,C.Jy)(R,t,i,this._visibleFolders)}writeSublayers(e,t){const i=[],s=e.toArray();for(;s.length;){const e=s[0];e.networkLink||(e.visible&&i.push(e.id),e.sublayers&&s.push(...e.sublayers.toArray())),s.shift()}t.visibleFolders=i}get title(){const e=this._get("title");return e&&"defaults"!==this.originOf("title")?e:this.url?(0,d.e7)(this.url,O)||"KML":e||""}set title(e){this._set("title",e)}get visibleSublayers(){const e=this.sublayers,t=[],i=e=>{e.visible&&(t.push(e),e.sublayers&&e.sublayers.forEach(i))};return e&&e.forEach(i),t}get fullExtent(){return this._recomputeFullExtent()}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["KML"],supportsData:!1},e).catch(l.QP).then((()=>this._fetchService(t)))),Promise.resolve(this)}destroy(){super.destroy(),this.allSublayers.destroy()}async _fetchService(e){const t=await Promise.resolve().then((()=>this.resourceInfo?{ssl:!1,data:this.resourceInfo}:(0,C.Ox)(this.url??"",this.outSpatialReference,this.refreshInterval,e))),i=(0,C._4)(t.data);i&&this.read(i,{origin:"service"})}_recomputeFullExtent(){let e=null;null!=this.extent&&(e=this.extent.clone());const t=i=>{if(i.sublayers)for(const s of i.sublayers.items)t(s),s.visible&&s.fullExtent&&(null!=e?e.union(s.fullExtent):e=s.fullExtent.clone())};return t(this),e}};(0,n._)([(0,u.MZ)({readOnly:!0})],k.prototype,"allSublayers",void 0),(0,n._)([(0,u.MZ)({type:m.A})],k.prototype,"outSpatialReference",void 0),(0,n._)([(0,u.MZ)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],k.prototype,"path",void 0),(0,n._)([(0,u.MZ)({readOnly:!0,json:{read:!1,write:!1}})],k.prototype,"legendEnabled",void 0),(0,n._)([(0,u.MZ)({type:["show","hide","hide-children"]})],k.prototype,"listMode",void 0),(0,n._)([(0,u.MZ)({type:["KML"]})],k.prototype,"operationalLayerType",void 0),(0,n._)([(0,u.MZ)({})],k.prototype,"resourceInfo",void 0),(0,n._)([(0,u.MZ)({type:r.A.ofType(R),json:{write:{ignoreOrigin:!0}}})],k.prototype,"sublayers",void 0),(0,n._)([(0,p.w)(["web-map","portal-item"],"sublayers",["visibleFolders"])],k.prototype,"readSublayersFromItemOrWebMap",null),(0,n._)([(0,p.w)("service","sublayers",["sublayers"])],k.prototype,"readSublayers",null),(0,n._)([(0,g.K)("sublayers")],k.prototype,"writeSublayers",null),(0,n._)([(0,u.MZ)({readOnly:!0,json:{read:!1}})],k.prototype,"type",void 0),(0,n._)([(0,u.MZ)({json:{origins:{"web-map":{read:{source:"title"}}},write:{ignoreOrigin:!0}}})],k.prototype,"title",null),(0,n._)([(0,u.MZ)(M.OZ)],k.prototype,"url",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],k.prototype,"visibleSublayers",null),(0,n._)([(0,u.MZ)({type:x.A})],k.prototype,"extent",void 0),(0,n._)([(0,u.MZ)()],k.prototype,"fullExtent",null),k=(0,n._)([(0,y.$)("esri.layers.KMLLayer")],k);const Z=k},11330:(e,t,i)=>{i.r(t),i.d(t,{default:()=>V});var s=i(66866),n=i(86394),r=i(19790),o=i(98849),a=i(6412),l=i(35775),c=i(40189),d=i(21564),u=i(73446),h=(i(85569),i(39831),i(75094)),p=i(63863),y=i(77542),g=i(94255),m=i(84698),f=i(61781),v=i(87926),_=i(68833),b=i(50193),w=i(47217),S=i(45681),M=i(15305),L=i(16161),E=i(41506),I=i(34722),T=i(50508),C=i(25389),x=i(2178),A=i(90826),R=i(84356),O=i(10109),k=i(52775),Z=i(68619),P=i(29306),F=i(93797),N=i(12129);let D=class extends((0,M.d)((0,A.e)((0,C.j)((0,x.I)((0,w.V)((0,S.b)((0,E.q)((0,I.A)((0,l.P)((0,T.J)((0,b.p)((0,L.d)(_.A))))))))))))){constructor(...e){super(...e),this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat="png24",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType="ArcGISMapServiceLayer",this.preferredTimeZone=null,this.sourceJSON=null,this.sublayers=null,this.type="map-image",this.url=null}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(c.QP).then((()=>this._fetchService(t)))),Promise.resolve(this)}readImageFormat(e,t){const i=t.supportedImageFormatTypes;return i&&i.includes("PNG32")?"png32":"png24"}writeSublayers(e,t,i,s){if(!this.loaded||!e)return;const n=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let r=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap?.supportsDynamicLayers){const e=(0,g.aB)(s.origin);if(e===g.Gr.PORTAL_ITEM){const e=this.createSublayersForOrigin("service").sublayers;r=(0,P.Zx)(n,e,g.Gr.SERVICE)}else if(e>g.Gr.PORTAL_ITEM){const e=this.createSublayersForOrigin("portal-item");r=(0,P.Zx)(n,e.sublayers,(0,g.aB)(e.origin))}}const o=[],a={writeSublayerStructure:r,...s};let l=r;n.forEach((e=>{const t=e.write({},a);o.push(t),l=l||"user"===e.originOf("visible")})),o.some((e=>Object.keys(e).length>1))&&(t.layers=o),l&&(t.visibleLayers=n.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,t,i,s){const n=s?.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const r=new O.g({layer:this,floors:s?.floors,scale:(0,f.X_)({extent:e,width:t})*n}),o=r.toJSON();r.destroy();const a=!s?.rotation||this.version<10.3?{}:{rotation:-s.rotation},l=e?.spatialReference,c=(0,v.YX)(l);o.dpi*=n;const d={};if(s?.timeExtent){const{start:e,end:t}=s.timeExtent.toJSON();d.time=e&&t&&e===t?""+e:`${e??"null"},${t??"null"}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(d.time="null,null");return{bbox:e&&e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:c,imageSR:c,size:t+","+i,...o,...a,...d}}async fetchImage(e,t,i,s){const{data:n}=await this._fetchImage("image",e,t,i,s);return n}async fetchImageBitmap(e,t,i,s){const{data:n,url:r}=await this._fetchImage("blob",e,t,i,s);return(0,k.m)(n,r,s?.signal)}async fetchRecomputedExtents(e={}){const t={...e,query:{returnUpdates:!0,f:"json",...this.customParameters,token:this.apiKey}},{data:i}=await(0,n.A)(this.url,t),{extent:s,fullExtent:o,timeExtent:a}=i,l=s||o;return{fullExtent:l&&m.A.fromJSON(l),timeExtent:a&&r.A.fromJSON({start:a[0],end:a[1]})}}loadAll(){return(0,a.g)(this,(e=>{e(this.allSublayers)}))}serviceSupportsSpatialReference(e){return(0,F.D)(this,e)}async _fetchImage(e,t,i,s,r){const a={responseType:e,signal:r?.signal??null,query:{...this.parsedUrl.query,...this.createExportImageParameters(t,i,s,r),f:"image",...this.refreshParameters,...this.customParameters,token:this.apiKey}},l=this.parsedUrl.path+"/export";if(null!=a.query?.dynamicLayers&&!this.capabilities?.exportMap?.supportsDynamicLayers)throw new o.A("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:a.query});try{const{data:e}=await(0,n.A)(l,a);return{data:e,url:l}}catch(d){if((0,c.zf)(d))throw d;throw new o.A("mapimagelayer:image-fetch-error",`Unable to load image: ${l}`,{error:d})}}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});const{data:t,ssl:i}=await(0,n.A)(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:e});i&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=t,this.read(t,{origin:"service",url:this.parsedUrl})}};(0,s._)([(0,d.MZ)((0,N.P6)("dateFieldsTimeReference"))],D.prototype,"dateFieldsTimeZone",void 0),(0,s._)([(0,d.MZ)({type:Boolean})],D.prototype,"datesInUnknownTimezone",void 0),(0,s._)([(0,d.MZ)()],D.prototype,"dpi",void 0),(0,s._)([(0,d.MZ)()],D.prototype,"gdbVersion",void 0),(0,s._)([(0,d.MZ)()],D.prototype,"imageFormat",void 0),(0,s._)([(0,h.w)("imageFormat",["supportedImageFormatTypes"])],D.prototype,"readImageFormat",null),(0,s._)([(0,d.MZ)({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],D.prototype,"imageMaxHeight",void 0),(0,s._)([(0,d.MZ)({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],D.prototype,"imageMaxWidth",void 0),(0,s._)([(0,d.MZ)()],D.prototype,"imageTransparency",void 0),(0,s._)([(0,d.MZ)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],D.prototype,"isReference",void 0),(0,s._)([(0,d.MZ)({json:{read:!1,write:!1}})],D.prototype,"labelsVisible",void 0),(0,s._)([(0,d.MZ)({type:["ArcGISMapServiceLayer"]})],D.prototype,"operationalLayerType",void 0),(0,s._)([(0,d.MZ)({json:{read:!1,write:!1}})],D.prototype,"popupEnabled",void 0),(0,s._)([(0,d.MZ)((0,N.P6)("preferredTimeReference"))],D.prototype,"preferredTimeZone",void 0),(0,s._)([(0,d.MZ)()],D.prototype,"sourceJSON",void 0),(0,s._)([(0,d.MZ)({json:{write:{ignoreOrigin:!0}}})],D.prototype,"sublayers",void 0),(0,s._)([(0,y.K)("sublayers",{layers:{type:[Z.A]},visibleLayers:{type:[u.jz]}})],D.prototype,"writeSublayers",null),(0,s._)([(0,d.MZ)({type:["show","hide","hide-children"]})],D.prototype,"listMode",void 0),(0,s._)([(0,d.MZ)({json:{read:!1},readOnly:!0,value:"map-image"})],D.prototype,"type",void 0),(0,s._)([(0,d.MZ)(R.OZ)],D.prototype,"url",void 0),D=(0,s._)([(0,p.$)("esri.layers.MapImageLayer")],D);const V=D},31058:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Q});var s,n=i(66866),r=(i(17639),i(56542)),o=(i(17671),i(84685),i(20299),i(25498),i(79300),i(76589),i(47347),i(2692),i(48887)),a=i(49169),l=i(86394),c=i(24793),d=i(98849),u=i(20464),h=i(19251),p=i(539),y=i(35775),g=i(40189),m=i(21564),f=i(73446),v=i(75094),_=i(63863),b=i(12433),w=i(68833),S=i(45681),M=i(15305),L=i(16161),E=i(15053),I=i(64782),T=i(41506),C=i(34722),x=i(50508),A=i(25389),R=i(90826),O=i(84356),k=i(97461),Z=i(24738),P=i(77567),F=i(42453),N=i(86155),D=i(79682),V=i(21877);i(85569),i(39831);let G=s=class extends V.oY{constructor(){super(...arguments),this.age=null,this.ageReceived=null,this.displayCount=null,this.maxObservations=1}clone(){return new s({age:this.age,ageReceived:this.ageReceived,displayCount:this.displayCount,maxObservations:this.maxObservations})}};(0,n._)([(0,m.MZ)({type:Number,json:{write:!0}})],G.prototype,"age",void 0),(0,n._)([(0,m.MZ)({type:Number,json:{write:!0}})],G.prototype,"ageReceived",void 0),(0,n._)([(0,m.MZ)({type:Number,json:{write:!0}})],G.prototype,"displayCount",void 0),(0,n._)([(0,m.MZ)({type:Number,json:{write:!0}})],G.prototype,"maxObservations",void 0),G=s=(0,n._)([(0,_.$)("esri.layers.support.PurgeOptions")],G);const $=G;var B=i(21484),z=i(14474),H=i(44116),K=i(60973),j=i(15954),U=i(78983),q=i(84698);const W=(0,P.p)();function J(e,t){return new d.A("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}let Y=class extends((0,I.J)((0,E.F)((0,M.d)((0,R.e)((0,A.j)((0,x.J)((0,S.b)((0,T.q)((0,C.A)((0,y.P)((0,L.d)((0,c.O)(w.A))))))))))))){constructor(...e){super(...e),this.copyright=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.geometryDefinition=null,this.geometryType=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.maxReconnectionAttempts=0,this.maxReconnectionInterval=20,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.operationalLayerType="ArcGISStreamLayer",this.outFields=["*"],this.popupEnabled=!0,this.popupTemplate=null,this.purgeOptions=new $,this.refreshInterval=0,this.screenSizePerspectiveEnabled=!0,this.sourceJSON=null,this.spatialReference=U.A.WGS84,this.type="stream",this.url=null,this.updateInterval=300,this.useViewTime=!0,this.webSocketUrl=null,this._debouncedSaveOperations=(0,g.sg)((async(e,t,s)=>{const{save:n,saveAs:r}=await i.e(8846).then(i.bind(i,68846));switch(e){case j.X.SAVE:return n(this,t);case j.X.SAVE_AS:return r(this,s,t)}}))}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){if(!("WebSocket"in globalThis))return this.addResolvingPromise(Promise.reject(new d.A("stream-layer:websocket-unsupported","WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."))),Promise.resolve(this);const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service","Feed"]},e).catch(g.QP).then((()=>this._fetchService(t)))),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}set renderer(e){(0,F.yp)(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){t=t.layerDefinition||t;const s=t.drawingInfo?.renderer;if(s){const e=(0,o.L)(s,t,i)||void 0;return e||p.A.getLogger(this).error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),e}return(0,k.PD)(t,i)}async connect(e){const[{createConnection:t}]=await Promise.all([Promise.all([i.e(2076),i.e(4794)]).then(i.bind(i,14794)),this.load()]),s=this.geometryType?b.g.toJSON(this.geometryType):null,{customParameters:n=null,definitionExpression:r=null,geometryDefinition:o=null,maxReconnectionAttempts:a=0,maxReconnectionInterval:l=20,spatialReference:c=this.spatialReference}=e||this.createConnectionParameters(),d=t(this.parsedUrl,this.spatialReference,c,s,{geometry:o,where:r},a,l,n??void 0),h=(0,u.vE)([this.on("send-message-to-socket",(e=>d.sendMessageToSocket(e))),this.on("send-message-to-client",(e=>d.sendMessageToClient(e)))]);return d.once("destroy",h.remove),d}createConnectionParameters(){return{spatialReference:this.spatialReference,customParameters:this.customParameters,definitionExpression:this.definitionExpression,geometryDefinition:this.geometryDefinition,maxReconnectionAttempts:this.maxReconnectionAttempts,maxReconnectionInterval:this.maxReconnectionInterval}}createPopupTemplate(e){return(0,H.tn)(this,e)}createQuery(){const e=new z.A;return e.returnGeometry=!0,e.outFields=["*"],e.where=this.definitionExpression||"1=1",e}getFieldDomain(e,t){if(!this.fields)return null;let i=null;return this.fields.some((t=>(t.name===e&&(i=t.domain),!!i))),i}getField(e){return this.fieldsIndex.get(e)}serviceSupportsSpatialReference(e){return!0}sendMessageToSocket(e){this.emit("send-message-to-socket",e)}sendMessageToClient(e){this.emit("send-message-to-client",e)}async save(e){return this._debouncedSaveOperations(j.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(j.X.SAVE_AS,t,e)}write(e,t){const i=t?.messages;return this.webSocketUrl?(i?.push(J(this,"using a custom websocket connection cannot be written to web scenes and web maps")),null):this.parsedUrl?super.write(e,t):(i?.push(J(this,"using a client-side only connection without a url cannot be written to web scenes and web maps")),null)}async _fetchService(e){if(!this.webSocketUrl&&this.parsedUrl){if(!this.sourceJSON){const{data:t}=await(0,l.A)(this.parsedUrl.path,{query:{f:"json",...this.customParameters,...this.parsedUrl.query},responseType:"json",signal:e});this.sourceJSON=t}}else{if(!this.timeInfo?.trackIdField)throw new d.A("stream-layer:missing-metadata","The stream layer trackIdField must be specified.");if(!this.objectIdField){const e=this.fields.find((e=>"oid"===e.type))?.name;if(!e)throw new d.A("stream-layer:missing-metadata","The stream layer objectIdField must be specified.");this.objectIdField=e}if(!this.fields)throw new d.A("stream-layer:missing-metadata","The stream layer fields must be specified.");if(this.fields.some((e=>e.name===this.objectIdField))||this.fields.push(new Z.A({name:this.objectIdField,alias:this.objectIdField,type:"oid"})),!this.geometryType)throw new d.A("stream-layer:missing-metadata","The stream layer geometryType must be specified.");this.webSocketUrl&&(this.url=this.webSocketUrl)}return this.read(this.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}),(0,F.yp)(this.renderer,this.fieldsIndex),(0,F.sv)(this.timeInfo,this.fieldsIndex),this.objectIdField||(this.objectIdField="__esri_stream_id__"),(0,B.L)(this,{origin:"service"})}};(0,n._)([(0,m.MZ)({type:String})],Y.prototype,"copyright",void 0),(0,n._)([(0,m.MZ)({readOnly:!0})],Y.prototype,"defaultPopupTemplate",null),(0,n._)([(0,m.MZ)({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Y.prototype,"definitionExpression",void 0),(0,n._)([(0,m.MZ)({type:String})],Y.prototype,"displayField",void 0),(0,n._)([(0,m.MZ)({type:K.A})],Y.prototype,"elevationInfo",void 0),(0,n._)([(0,m.MZ)({json:{origins:{"web-map":{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],Y.prototype,"featureReduction",null),(0,n._)([(0,m.MZ)(W.fields)],Y.prototype,"fields",void 0),(0,n._)([(0,m.MZ)(W.fieldsIndex)],Y.prototype,"fieldsIndex",void 0),(0,n._)([(0,m.MZ)({type:q.A,json:{name:"layerDefinition.definitionGeometry",write:!0}})],Y.prototype,"geometryDefinition",void 0),(0,n._)([(0,m.MZ)({type:b.g.apiValues,json:{read:{reader:b.g.read}}})],Y.prototype,"geometryType",void 0),(0,n._)([(0,m.MZ)(O.kF)],Y.prototype,"labelsVisible",void 0),(0,n._)([(0,m.MZ)({type:[N.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:D.w},write:!0}})],Y.prototype,"labelingInfo",void 0),(0,n._)([(0,m.MZ)(O.fV)],Y.prototype,"legendEnabled",void 0),(0,n._)([(0,m.MZ)({type:["show","hide"],json:{origins:{"portal-item":{read:!1,write:!1}}}})],Y.prototype,"listMode",void 0),(0,n._)([(0,m.MZ)({type:f.jz})],Y.prototype,"maxReconnectionAttempts",void 0),(0,n._)([(0,m.MZ)({type:f.jz})],Y.prototype,"maxReconnectionInterval",void 0),(0,n._)([(0,m.MZ)(O.hG)],Y.prototype,"maxScale",void 0),(0,n._)([(0,m.MZ)(O.hn)],Y.prototype,"minScale",void 0),(0,n._)([(0,m.MZ)({type:String})],Y.prototype,"objectIdField",void 0),(0,n._)([(0,m.MZ)({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],Y.prototype,"operationalLayerType",void 0),(0,n._)([(0,m.MZ)({readOnly:!0})],Y.prototype,"outFields",void 0),(0,n._)([(0,m.MZ)(O.M6)],Y.prototype,"popupEnabled",void 0),(0,n._)([(0,m.MZ)({type:r.A,json:{name:"popupInfo",write:!0}})],Y.prototype,"popupTemplate",void 0),(0,n._)([(0,m.MZ)({type:$})],Y.prototype,"purgeOptions",void 0),(0,n._)([(0,m.MZ)({json:{read:!1,write:!1}})],Y.prototype,"refreshInterval",void 0),(0,n._)([(0,m.MZ)({types:a.H,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{name:"layerDefinition.drawingInfo.renderer",types:a.X,write:!0}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],Y.prototype,"renderer",null),(0,n._)([(0,v.w)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),(0,v.w)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Y.prototype,"readRenderer",null),(0,n._)([(0,m.MZ)((()=>{const e=(0,h.o8)(O.PY);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],Y.prototype,"screenSizePerspectiveEnabled",void 0),(0,n._)([(0,m.MZ)()],Y.prototype,"sourceJSON",void 0),(0,n._)([(0,m.MZ)({type:U.A,json:{origins:{service:{read:{source:"spatialReference"}}}}})],Y.prototype,"spatialReference",void 0),(0,n._)([(0,m.MZ)({json:{read:!1}})],Y.prototype,"type",void 0),(0,n._)([(0,m.MZ)(O.OZ)],Y.prototype,"url",void 0),(0,n._)([(0,m.MZ)({type:Number})],Y.prototype,"updateInterval",void 0),(0,n._)([(0,m.MZ)({json:{read:!1,write:!1}})],Y.prototype,"useViewTime",void 0),(0,n._)([(0,m.MZ)({type:String})],Y.prototype,"webSocketUrl",void 0),Y=(0,n._)([(0,_.$)("esri.layers.StreamLayer")],Y);const Q=Y},47187:(e,t,i)=>{i.r(t),i.d(t,{default:()=>C});var s,n=i(66866),r=(i(17639),i(86394)),o=i(98849),a=i(35775),l=i(96274),c=i(20909),d=i(21564),u=(i(73446),i(85569),i(39831),i(75094)),h=i(63863),p=i(77542),y=i(68833),g=i(15305),m=i(41506),f=i(34722),v=i(50508),_=i(25389),b=i(52775),w=i(50437),S=i(65228),M=i(65476),L=i(84698),E=i(78983),I=i(78632);let T=s=class extends((0,g.d)((0,v.J)((0,_.j)((0,m.q)((0,f.A)((0,a.P)(y.A))))))){constructor(...e){super(...e),this.copyright="",this.fullExtent=new L.A(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,E.A.WebMercator),this.legendEnabled=!1,this.isReference=null,this.popupEnabled=!1,this.spatialReference=E.A.WebMercator,this.subDomains=null,this.tileInfo=new S.A({size:[256,256],dpi:96,format:"png8",compressionQuality:0,origin:new I.A({x:-20037508.342787,y:20037508.342787,spatialReference:E.A.WebMercator}),spatialReference:E.A.WebMercator,lods:[new w.A({level:0,scale:591657527.591555,resolution:156543.033928}),new w.A({level:1,scale:295828763.795777,resolution:78271.5169639999}),new w.A({level:2,scale:147914381.897889,resolution:39135.7584820001}),new w.A({level:3,scale:73957190.948944,resolution:19567.8792409999}),new w.A({level:4,scale:36978595.474472,resolution:9783.93962049996}),new w.A({level:5,scale:18489297.737236,resolution:4891.96981024998}),new w.A({level:6,scale:9244648.868618,resolution:2445.98490512499}),new w.A({level:7,scale:4622324.434309,resolution:1222.99245256249}),new w.A({level:8,scale:2311162.217155,resolution:611.49622628138}),new w.A({level:9,scale:1155581.108577,resolution:305.748113140558}),new w.A({level:10,scale:577790.554289,resolution:152.874056570411}),new w.A({level:11,scale:288895.277144,resolution:76.4370282850732}),new w.A({level:12,scale:144447.638572,resolution:38.2185141425366}),new w.A({level:13,scale:72223.819286,resolution:19.1092570712683}),new w.A({level:14,scale:36111.909643,resolution:9.55462853563415}),new w.A({level:15,scale:18055.954822,resolution:4.77731426794937}),new w.A({level:16,scale:9027.977411,resolution:2.38865713397468}),new w.A({level:17,scale:4513.988705,resolution:1.19432856685505}),new w.A({level:18,scale:2256.994353,resolution:.597164283559817}),new w.A({level:19,scale:1128.497176,resolution:.298582141647617}),new w.A({level:20,scale:564.248588,resolution:.14929107082380833}),new w.A({level:21,scale:282.124294,resolution:.07464553541190416}),new w.A({level:22,scale:141.062147,resolution:.03732276770595208}),new w.A({level:23,scale:70.5310735,resolution:.01866138385297604})]}),this.type="web-tile",this.urlTemplate=null,this.wmtsInfo=null}normalizeCtorArgs(e,t){return"string"==typeof e?{urlTemplate:e,...t}:e}load(e){const t=this.loadFromPortal({supportedTypes:["WMTS"]},e).then((()=>{let e="";if(this.urlTemplate)if(this.spatialReference.equals(this.tileInfo.spatialReference)){const t=new c.s0(this.urlTemplate);!(this.subDomains&&this.subDomains.length>0)&&t.authority?.includes("{subDomain}")&&(e="is missing 'subDomains' property")}else e="spatialReference must match tileInfo.spatialReference";else e="is missing the required 'urlTemplate' property value";if(e)throw new o.A("web-tile-layer:load",`WebTileLayer (title: '${this.title}', id: '${this.id}') ${e}`)}));return this.addResolvingPromise(t),Promise.resolve(this)}get levelValues(){const e=[];if(!this.tileInfo)return null;for(const t of this.tileInfo.lods)e[t.level]=t.levelValue||t.level;return e}readSpatialReference(e,t){return e||E.A.fromJSON(t.fullExtent?.spatialReference)}get tileServers(){if(!this.urlTemplate)return null;const e=[],{urlTemplate:t,subDomains:i}=this,s=new c.s0(t),n=s.scheme?s.scheme+"://":"//",r=n+s.authority+"/",o=s.authority;if(o?.includes("{subDomain}")){if(i&&i.length>0&&o.split(".").length>1)for(const a of i)e.push(n+o.replaceAll(/\{subDomain\}/gi,a)+"/")}else e.push(r);return e.map(c.Il)}get urlPath(){if(!this.urlTemplate)return null;const e=this.urlTemplate,t=new c.s0(e),i=(t.scheme?t.scheme+"://":"//")+t.authority+"/";return e.substring(i.length)}readUrlTemplate(e,t){return e||t.templateUrl}writeUrlTemplate(e,t){(0,c.BQ)(e)&&(e="https:"+e),e&&(e=e.replaceAll(/\{z\}/gi,"{level}").replaceAll(/\{x\}/gi,"{col}").replaceAll(/\{y\}/gi,"{row}"),e=(0,c.S8)(e)),t.templateUrl=e}fetchTile(e,t,i,s={}){const{signal:n}=s,o=this.getTileUrl(e,t,i),a={responseType:"image",signal:n,query:{...this.refreshParameters}};return(0,r.A)(o,a).then((e=>e.data))}async fetchImageBitmapTile(e,t,i,n={}){const{signal:o}=n;if(this.fetchTile!==s.prototype.fetchTile){const s=await this.fetchTile(e,t,i,n);return(0,b.C)(s,e,t,i,o)}const a=this.getTileUrl(e,t,i),l={responseType:"blob",signal:o,query:{...this.refreshParameters}},{data:c}=await(0,r.A)(a,l);return(0,b.C)(c,e,t,i,o)}getTileUrl(e,t,i){const{levelValues:s,tileServers:n,urlPath:r}=this;if(!s||!n||!r)return"";const o=s[e];return n[t%n.length]+(0,l.HC)(r,{level:o,z:o,col:i,x:i,row:t,y:t})}};(0,n._)([(0,d.MZ)({type:String,value:"",json:{write:!0}})],T.prototype,"copyright",void 0),(0,n._)([(0,d.MZ)({type:L.A,json:{write:!0},nonNullable:!0})],T.prototype,"fullExtent",void 0),(0,n._)([(0,d.MZ)({readOnly:!0,json:{read:!1,write:!1}})],T.prototype,"legendEnabled",void 0),(0,n._)([(0,d.MZ)({type:["show","hide"]})],T.prototype,"listMode",void 0),(0,n._)([(0,d.MZ)({json:{read:!0,write:!0}})],T.prototype,"blendMode",void 0),(0,n._)([(0,d.MZ)()],T.prototype,"levelValues",null),(0,n._)([(0,d.MZ)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],T.prototype,"isReference",void 0),(0,n._)([(0,d.MZ)({type:["WebTiledLayer"],value:"WebTiledLayer"})],T.prototype,"operationalLayerType",void 0),(0,n._)([(0,d.MZ)({readOnly:!0,json:{read:!1,write:!1}})],T.prototype,"popupEnabled",void 0),(0,n._)([(0,d.MZ)({type:E.A})],T.prototype,"spatialReference",void 0),(0,n._)([(0,u.w)("spatialReference",["spatialReference","fullExtent.spatialReference"])],T.prototype,"readSpatialReference",null),(0,n._)([(0,d.MZ)({type:[String],json:{write:!0}})],T.prototype,"subDomains",void 0),(0,n._)([(0,d.MZ)({type:S.A,json:{write:!0}})],T.prototype,"tileInfo",void 0),(0,n._)([(0,d.MZ)({readOnly:!0})],T.prototype,"tileServers",null),(0,n._)([(0,d.MZ)({json:{read:!1}})],T.prototype,"type",void 0),(0,n._)([(0,d.MZ)()],T.prototype,"urlPath",null),(0,n._)([(0,d.MZ)({type:String,json:{origins:{"portal-item":{read:{source:"url"}}}}})],T.prototype,"urlTemplate",void 0),(0,n._)([(0,u.w)("urlTemplate",["urlTemplate","templateUrl"])],T.prototype,"readUrlTemplate",null),(0,n._)([(0,p.K)("urlTemplate",{templateUrl:{type:String}})],T.prototype,"writeUrlTemplate",null),(0,n._)([(0,d.MZ)({type:M.x,json:{write:!0}})],T.prototype,"wmtsInfo",void 0),T=s=(0,n._)([(0,h.$)("esri.layers.WebTileLayer")],T);const C=T},29394:(e,t,i)=>{function s(e,t,i,s){return{x:e,y:t,z:i,hasZ:null!=i,hasM:!1,spatialReference:s,type:"point"}}i.d(t,{T:()=>s})},10109:(e,t,i)=>{i.d(t,{g:()=>p});var s=i(66866),n=i(52495),r=i(76859),o=i(21564),a=(i(73446),i(85569),i(39831),i(63863)),l=i(61781),c=i(84356),d=i(58921),u=i(29306);const h={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let p=class extends n.A{constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const t=(0,d.f)(this.floors,e);return e.toExportImageJSON(t)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,u.Sk)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.removeHandles("layer"),e&&this.addHandles([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(h[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=!!this.floors?.length,t=this.visibleSublayers.filter((t=>null!=t.definitionExpression||e&&null!=t.floorInfo));return t.length?JSON.stringify(t.reduce(((e,t)=>{const i=(0,d.f)(this.floors,t),s=(0,r.m)(i,t.definitionExpression);return null!=s&&(e[t.id]=s),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,i=this.scale,s=t=>{t.visible&&(0===i||(0,l.zx)(i,t.minScale,t.maxScale))&&(t.sublayers?t.sublayers.forEach(s):e.unshift(t))};t&&t.forEach(s);const n=this._get("visibleSublayers");return!n||n.length!==e.length||n.some(((t,i)=>e[i]!==t))?e:n}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};(0,s._)([(0,o.MZ)({readOnly:!0})],p.prototype,"dynamicLayers",null),(0,s._)([(0,o.MZ)()],p.prototype,"floors",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],p.prototype,"hasDynamicLayers",null),(0,s._)([(0,o.MZ)()],p.prototype,"layer",null),(0,s._)([(0,o.MZ)({readOnly:!0})],p.prototype,"layers",null),(0,s._)([(0,o.MZ)({readOnly:!0})],p.prototype,"layerDefs",null),(0,s._)([(0,o.MZ)({type:Number})],p.prototype,"scale",void 0),(0,s._)([(0,o.MZ)(c.ui)],p.prototype,"timeExtent",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],p.prototype,"version",null),(0,s._)([(0,o.MZ)({readOnly:!0})],p.prototype,"visibleSublayers",null),p=(0,s._)([(0,a.$)("esri.layers.mixins.ExportImageParameters")],p)},65476:(e,t,i)=>{i.d(t,{x:()=>c});var s,n=i(66866),r=i(21877),o=i(19251),a=i(21564),l=(i(73446),i(63863));let c=s=class extends r.oY{constructor(e){super(e)}clone(){return new s({customLayerParameters:(0,o.o8)(this.customLayerParameters),customParameters:(0,o.o8)(this.customParameters),layerIdentifier:this.layerIdentifier,tileMatrixSet:this.tileMatrixSet,url:this.url})}};(0,n._)([(0,a.MZ)({json:{type:Object,write:!0}})],c.prototype,"customLayerParameters",void 0),(0,n._)([(0,a.MZ)({json:{type:Object,write:!0}})],c.prototype,"customParameters",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"layerIdentifier",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"tileMatrixSet",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"url",void 0),c=s=(0,n._)([(0,l.$)("esri.layer.support.WMTSLayerInfo")],c)},58921:(e,t,i)=>{function s(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?r(e.view.floors,t.floorInfo.floorField):null}function n(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?r(e,t.floorInfo.floorField):null}function r(e,t){if(!e?.length)return null;const i=e.filter((e=>""!==e)).map((e=>`'${e}'`));return i.push("''"),`${t} IN (${i.join(",")}) OR ${t} IS NULL`}i.d(t,{E:()=>s,f:()=>n})},78521:(e,t,i)=>{i.d(t,{Jy:()=>f,Ox:()=>m,Qm:()=>b,Sp:()=>_,_4:()=>g});var s=i(21121),n=i(28830),r=i(56542),o=i(86394),a=i(19251),l=i(20909),c=i(78983),d=i(4675),u=i(36358),h=i(48887),p=i(57822);const y={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function g(e){const t=e.folders||[],i=t.slice(),s=new Map,n=new Map,r=new Map,o=new Map,l=new Map,c={esriGeometryPoint:n,esriGeometryPolyline:r,esriGeometryPolygon:o};(e.featureCollection?.layers||[]).forEach((e=>{const t=(0,a.o8)(e);t.featureSet.features=[];const i=e.featureSet.geometryType;s.set(i,t);const l=e.layerDefinition.objectIdField;"esriGeometryPoint"===i?v(n,l,e.featureSet.features):"esriGeometryPolyline"===i?v(r,l,e.featureSet.features):"esriGeometryPolygon"===i&&v(o,l,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{l.set(e.id,e)})),t.forEach((t=>{t.networkLinkIds.forEach((s=>{const n=function(e,t,i){const s=function(e,t){let i;return t.some((t=>t.id===e&&(i=t,!0))),i}(e,i);return s&&(s.parentFolderId=t,s.networkLink=s),s}(s,t.id,e.networkLinks);n&&i.push(n)}))})),i.forEach((e=>{if(e.featureInfos){e.points=(0,a.o8)(s.get("esriGeometryPoint")),e.polylines=(0,a.o8)(s.get("esriGeometryPolyline")),e.polygons=(0,a.o8)(s.get("esriGeometryPolygon")),e.mapImages=[];for(const t of e.featureInfos)switch(t.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const i=c[t.type].get(t.id);i&&e[y[t.type]]?.featureSet.features.push(i);break}case"GroundOverlay":{const i=l.get(t.id);i&&e.mapImages.push(i);break}}e.fullExtent=b([e])}}));const d=b(i);return{folders:t,sublayers:i,extent:d}}function m(e,t,i,r){const a=n.id?.findCredential(e);e=(0,l.a6)(e,{token:a?.token});const c=s.A.kmlServiceUrl;return(0,o.A)(c,{query:{url:e,model:"simple",folders:"",refresh:0!==i||void 0,outSR:JSON.stringify(t)},responseType:"json",signal:r})}function f(e,t,i=null,s=[]){const n=[],r={},o=t.sublayers,a=new Set(t.folders.map((e=>e.id)));return o.forEach((t=>{const o=new e;if(i?o.read(t,i):o.read(t),s.length&&a.has(o.id)&&(o.visible=s.includes(o.id)),r[t.id]=o,null!=t.parentFolderId&&-1!==t.parentFolderId){const e=r[t.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers?.unshift(o)}else n.unshift(o)})),n}function v(e,t,i){i.forEach((i=>{e.set(i.attributes[t],i)}))}async function _(e){const t=p.A.fromJSON(e.featureSet).features,i=e.layerDefinition,s=(0,h.r)(i.drawingInfo.renderer),n=r.A.fromJSON(e.popupInfo),o=[];for(const r of t){const e=await s.getSymbolAsync(r);r.symbol=e,r.popupTemplate=n,r.visible=!0,o.push(r)}return o}function b(e){const t=(0,d.vt)(d.qv),i=(0,d.vt)(d.qv);for(const s of e){if(s.polygons?.featureSet?.features)for(const e of s.polygons.featureSet.features)(0,u.LJ)(t,e.geometry),(0,d.RF)(i,t);if(s.polylines?.featureSet?.features)for(const e of s.polylines.featureSet.features)(0,u.LJ)(t,e.geometry),(0,d.RF)(i,t);if(s.points?.featureSet?.features)for(const e of s.points.featureSet.features)(0,u.LJ)(t,e.geometry),(0,d.RF)(i,t);if(s.mapImages)for(const e of s.mapImages)(0,u.LJ)(t,e.extent),(0,d.RF)(i,t)}return(0,d.aI)(i,d.qv)?void 0:{xmin:i[0],ymin:i[1],zmin:i[2],xmax:i[3],ymax:i[4],zmax:i[5],spatialReference:c.A.WGS84}}},12434:(e,t,i)=>{i.d(t,{S:()=>s});const s={BingMapsLayer:async()=>(await Promise.all([i.e(2076),i.e(6132)]).then(i.bind(i,16132))).default,BuildingSceneLayer:async()=>(await Promise.all([i.e(2076),i.e(4782),i.e(7568),i.e(3780),i.e(7258),i.e(1180),i.e(5047),i.e(6818)]).then(i.bind(i,59436))).default,CSVLayer:async()=>(await Promise.all([i.e(2076),i.e(4782),i.e(7568),i.e(3780),i.e(3770)]).then(i.bind(i,97588))).default,DimensionLayer:async()=>(await Promise.all([i.e(2076),i.e(9994)]).then(i.bind(i,39994))).default,ElevationLayer:async()=>(await Promise.all([i.e(2076),i.e(8870)]).then(i.bind(i,48870))).default,FeatureLayer:async()=>(await Promise.all([i.e(2076),i.e(4782),i.e(7568),i.e(3780),i.e(4007)]).then(i.bind(i,83780))).default,GeoJSONLayer:async()=>(await Promise.all([i.e(2076),i.e(4782),i.e(8485)]).then(i.bind(i,8485))).default,GeoRSSLayer:async()=>(await Promise.all([i.e(2076),i.e(5730)]).then(i.bind(i,5730))).default,GroupLayer:async()=>(await Promise.all([i.e(2076),i.e(2102)]).then(i.bind(i,62102))).default,ImageryLayer:async()=>(await Promise.all([i.e(2076),i.e(8100),i.e(5114),i.e(2307),i.e(1874),i.e(438)]).then(i.bind(i,81874))).default,ImageryTileLayer:async()=>(await Promise.all([i.e(2076),i.e(8100),i.e(5114),i.e(2297),i.e(2204),i.e(2307),i.e(7663),i.e(7690)]).then(i.bind(i,87663))).default,IntegratedMeshLayer:async()=>(await Promise.all([i.e(2076),i.e(1180),i.e(2491)]).then(i.bind(i,22491))).default,KMLLayer:async()=>(await Promise.all([i.e(2076),i.e(9062)]).then(i.bind(i,19062))).default,LineOfSightLayer:async()=>(await Promise.all([i.e(2076),i.e(9081)]).then(i.bind(i,49081))).default,LinkChartLayer:async()=>(await Promise.all([i.e(2076),i.e(4782),i.e(1615),i.e(6109),i.e(4640),i.e(2459)]).then(i.bind(i,92459))).default,MapImageLayer:async()=>(await Promise.all([i.e(2076),i.e(4594),i.e(4634),i.e(4868)]).then(i.bind(i,11330))).default,MapNotesLayer:async()=>(await Promise.all([i.e(2076),i.e(4782),i.e(7568),i.e(3780),i.e(860)]).then(i.bind(i,60266))).default,MediaLayer:async()=>(await Promise.all([i.e(2076),i.e(4749)]).then(i.bind(i,74749))).default,OGCFeatureLayer:async()=>(await Promise.all([i.e(2076),i.e(4782),i.e(8820),i.e(4769)]).then(i.bind(i,28820))).default,OpenStreetMapLayer:async()=>(await Promise.all([i.e(2076),i.e(8628)]).then(i.bind(i,8628))).default,OrientedImageryLayer:async()=>(await Promise.all([i.e(2076),i.e(4782),i.e(7568),i.e(3780),i.e(5034)]).then(i.bind(i,51092))).default,PointCloudLayer:async()=>(await Promise.all([i.e(2076),i.e(5840)]).then(i.bind(i,75840))).default,RouteLayer:async()=>(await Promise.all([i.e(2076),i.e(3058),i.e(1060)]).then(i.bind(i,81060))).default,SceneLayer:async()=>(await Promise.all([i.e(2076),i.e(7258),i.e(1180),i.e(5047),i.e(2534),i.e(1571)]).then(i.bind(i,12534))).default,StreamLayer:async()=>(await Promise.all([i.e(2076),i.e(4782),i.e(1058)]).then(i.bind(i,31058))).default,SubtypeGroupLayer:async()=>(await Promise.all([i.e(2076),i.e(7568),i.e(8002),i.e(7461)]).then(i.bind(i,64810))).default,TileLayer:async()=>(await Promise.all([i.e(2076),i.e(4594),i.e(4634),i.e(7325)]).then(i.bind(i,10107))).default,UnknownLayer:async()=>(await Promise.all([i.e(2076),i.e(5335)]).then(i.bind(i,75335))).default,UnsupportedLayer:async()=>(await Promise.all([i.e(2076),i.e(7400)]).then(i.bind(i,7400))).default,VectorTileLayer:async()=>(await Promise.all([i.e(2076),i.e(7744),i.e(8782),i.e(569)]).then(i.bind(i,38782))).default,VoxelLayer:async()=>(await Promise.all([i.e(2076),i.e(9901)]).then(i.bind(i,89901))).default,WFSLayer:async()=>(await Promise.all([i.e(2076),i.e(4782),i.e(2783),i.e(1965)]).then(i.bind(i,62783))).default,WMSLayer:async()=>(await Promise.all([i.e(2076),i.e(5719),i.e(2775)]).then(i.bind(i,25719))).default,WMTSLayer:async()=>(await Promise.all([i.e(2076),i.e(9685)]).then(i.bind(i,89685))).default,WebTileLayer:async()=>(await Promise.all([i.e(2076),i.e(7187)]).then(i.bind(i,47187))).default}},55876:(e,t,i)=>{function s(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e,t){return"number"==typeof e?e:e?.stops?.length?function(e){let t=0,i=0;for(let s=0;s<e.length;s++){const n=e[s].size;"number"==typeof n&&(t+=n,i++)}return t/i}(e.stops):t}function r(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:s}=t;return(n(i,e)+n(s,e))/2}));let s=0;const r=i.length;if(0===r)return e;for(let n=0;n<r;n++)s+=i[n];const o=Math.floor(s/r);return Math.max(o,e)}function o(e){const t=e?.renderer,i=e?.event?.pointerType,n="touch"===i?9:6;if(!t)return n;const o="visualVariables"in t?r(n,t.visualVariables):n;if("simple"===t.type)return s(o,t.symbol);if("unique-value"===t.type){let e=o;return t.uniqueValueInfos?.forEach((t=>{e=s(e,t.symbol)})),e}if("class-breaks"===t.type){let e=o;return t.classBreakInfos.forEach((t=>{e=s(e,t.symbol)})),e}return"dot-density"===t.type||t.type,o}i.d(t,{o:()=>o})},72973:(e,t,i)=>{i.d(t,{b:()=>a,l:()=>o});var s=i(85569),n=(i(39831),i(98849)),r=i(79689);function o(e){return null==e||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function a(e,t){if(null==e)return null;if(!o(e))return new n.A("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case"simple":return function(e){return l(e,(0,r.t)(e.symbol).error)}(e);case"unique-value":return function(e,t){const i={...r.c,...t},n=e.uniqueValueInfos?.map((e=>(0,r.t)(e.symbol,i).error)).filter(s.Ru),o=(0,r.t)(e.defaultSymbol,i);return o.error&&n?.unshift(o.error),l(e,n)}(e,t);case"class-breaks":return function(e){const t=e.classBreakInfos.map((e=>(0,r.t)(e.symbol).error)).filter(s.Ru),i=(0,r.t)(e.defaultSymbol);return i.error&&t.unshift(i.error),l(e,t)}(e);case"dictionary":case"heatmap":return null}return null}function l(e,t){if(!t)return null;let i;if(i=Array.isArray(t)?t:[t],i.length>0){const t=i.map((e=>e.details.symbol.type||e.details.symbol.declaredClass)).filter((e=>!!e));t.sort();const s=[];return t.forEach(((e,i)=>{0!==i&&e===t[i-1]||s.push(e)})),new n.A("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${s.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:i})}return null}},70727:(e,t,i)=>{i.d(t,{C:()=>d});var s=i(86394),n=i(73446),r=i(1171),o=i(11499),a=i(45355),l=i(72387);const c=(0,n.dp)(l.A);async function d(e,t,i){t=c(t);const n=(0,o.Dl)(e),l={...n.query,f:"json",...t.toJSON()},d=t.outSpatialReference,u=(0,r.$B)(t.geometries[0]),h=(0,o.jV)(l,i);return(0,s.A)(n.path+"/project",h).then((({data:{geometries:e}})=>(0,a.V)(e,u,d)))}},72387:(e,t,i)=>{i.d(t,{A:()=>d});var s=i(66866),n=i(21877),r=i(21564),o=(i(73446),i(85569),i(39831),i(63863)),a=i(1171),l=i(87926);let c=class extends n.oY{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map((e=>e.toJSON())),t=this.geometries[0],i={};return i.outSR=(0,l.YX)(this.outSpatialReference),i.inSR=(0,l.YX)(t.spatialReference),i.geometries=JSON.stringify({geometryType:(0,a.$B)(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(i.transformForward=this.transformForward),i}};(0,s._)([(0,r.MZ)()],c.prototype,"geometries",void 0),(0,s._)([(0,r.MZ)({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0),(0,s._)([(0,r.MZ)()],c.prototype,"transformation",void 0),(0,s._)([(0,r.MZ)()],c.prototype,"transformForward",void 0),c=(0,s._)([(0,o.$)("esri.rest.support.ProjectParameters")],c);const d=c},12188:(e,t,i)=>{i.d(t,{K:()=>s});const s={type:String,json:{read:{source:"token"},write:{target:"token"}}}},21292:(e,t,i)=>{i.d(t,{d:()=>n,e:()=>s});var s;i(39831);function n(e){switch(e){case s.SUPPORTED:break;case s.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case s.GEOMETRY_MISSING:return"no geometry";case s.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case s.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case s.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}!function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"}(s||(s={}))},42497:(e,t,i)=>{i.d(t,{N:()=>r});i(39831);var s=i(27451),n=i(21292);function r(e){if("graphics"!==e.layer?.type)return n.e.GRAPHICS_LAYER_MISSING;if(null==e.geometry)return n.e.GEOMETRY_MISSING;switch(e.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return n.e.GEOMETRY_TYPE_UNSUPPORTED}return"on-the-ground"!==(0,s.ky)(e)&&(0,s.NN)(e)?n.e.ELEVATION_MODE_UNSUPPORTED:n.e.SUPPORTED}},49858:(e,t,i)=>{i.d(t,{N:()=>o,g:()=>a});var s=i(21394),n=i(27451),r=i(21292);function o(e){return l(e).result}function a(e){return l(e).geometry}function l(e){if("graphics"!==e.layer?.type)return{result:r.e.GRAPHICS_LAYER_MISSING,geometry:null};const{geometry:t}=e;if(null==t)return{result:r.e.GEOMETRY_MISSING,geometry:null};if("on-the-ground"!==(0,n.ky)(e)&&(0,n.NN)(e))return{result:r.e.ELEVATION_MODE_UNSUPPORTED,geometry:null};const i=t.type;return"point"!==i&&"mesh"!==i&&"polyline"!==i&&("polygon"!==i||e.geometry instanceof s.A)?{result:r.e.GEOMETRY_TYPE_UNSUPPORTED,geometry:null}:{result:r.e.SUPPORTED,geometry:t}}},58947:(e,t,i)=>{i.d(t,{L:()=>l,MX:()=>o,M_:()=>d,O_:()=>a,kL:()=>c,vA:()=>r,zH:()=>u});var s=i(78286);i(25102);(0,i(52712).c)();class n{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function r(e,t){if(!e){t=t||"Assertion";const e=new Error(t).stack;throw new n(`${t} at ${e}`)}}function o(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function a(e,t,i,s){let n,r=(i[0]-e[0])/t[0],o=(s[0]-e[0])/t[0];r>o&&(n=r,r=o,o=n);let a=(i[1]-e[1])/t[1],l=(s[1]-e[1])/t[1];if(a>l&&(n=a,a=l,l=n),r>l||a>o)return!1;a>r&&(r=a),l<o&&(o=l);let c=(i[2]-e[2])/t[2],d=(s[2]-e[2])/t[2];return c>d&&(n=c,c=d,d=n),!(r>d||c>o||(d<o&&(o=d),o<0))}function l(e,t,i,n,r,o=(0,s.a)()){const a=(n[r]-i[r])*(t[0]-e[0])-(n[0]-i[0])*(t[r]-e[r]),l=(n[0]-i[0])*(e[r]-i[r])-(n[r]-i[r])*(e[0]-i[0]);if(0===a)return!1;const c=l/a;return o[0]=e[0]+c*(t[0]-e[0]),o[1]=e[r]+c*(t[r]-e[r]),!0}function c(e,t){return Math.log(e)/Math.log(t)}function d(e,t,i,s){e[12]=t,e[13]=i,e[14]=s}function u(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}},7407:(e,t,i)=>{function s(e,t,i){if(!t||!e?.map)return;const{map:s}=e,n=s.layers.find((e=>e===t));n||s.add(t,i),n&&null!=i&&s.layers.reorder(n,i)}function n(e,t){const i="subtype-sublayer"===t?.type?t.parent:t;return e.allLayerViews.find((e=>{const t=e.layer;return t===i||"sublayers"in t&&null!=t.sublayers&&t.sublayers.includes(i)}))}i.d(t,{Y:()=>s,i:()=>n})},70384:(e,t,i)=>{i.d(t,{NE:()=>s,ac:()=>r,fn:()=>n});const s={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},n={toggle:"Control"},r={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"}},86084:(e,t,i)=>{i.d(t,{A:()=>l});var s=i(66866),n=i(52495),r=i(21564),o=(i(73446),i(85569),i(39831),i(63863));let a=class extends n.A{constructor(e){super(e),this.enabled=!1}};(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],a.prototype,"enabled",void 0),a=(0,s._)([(0,o.$)("esri.views.interactive.sketch.SketchLabelOptions")],a);const l=a},30520:(e,t,i)=>{i.d(t,{A:()=>d});var s=i(66866),n=i(52495),r=i(21564),o=(i(73446),i(85569),i(39831),i(63863));let a=class extends n.A{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};(0,s._)([(0,r.MZ)({type:String,nonNullable:!0})],a.prototype,"mode",void 0),a=(0,s._)([(0,o.$)("esri.widgets.Sketch.SketchTooltipOptions.ElevationOptions")],a);let l=class extends n.A{constructor(e){super(e),this.area=!0,this.distance=!0,this.elevation=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}toJSON(){return{area:this.area,distance:this.distance,elevation:this.elevation,helpMessage:this.helpMessage,orientation:this.orientation,radius:this.radius,rotation:this.rotation,scale:this.scale,size:this.size,totalLength:this.totalLength}}};(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"area",void 0),(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"distance",void 0),(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"elevation",void 0),(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"helpMessage",void 0),(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"orientation",void 0),(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"radius",void 0),(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"rotation",void 0),(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"scale",void 0),(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"size",void 0),(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"totalLength",void 0),l=(0,s._)([(0,o.$)("esri.widgets.Sketch.SketchTooltipOptions.VisibleElements")],l);let c=class extends n.A{constructor(e){super(e),this.enabled=!1,this.inputEnabled=!1,this.elevation=new a,this.visibleElements=new l,this.visualVariables=null}toJSON(){return{enabled:this.enabled,elevation:this.elevation,visibleElements:this.visibleElements}}};(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],c.prototype,"enabled",void 0),(0,s._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],c.prototype,"inputEnabled",void 0),(0,s._)([(0,r.MZ)({type:a,nonNullable:!0})],c.prototype,"elevation",void 0),(0,s._)([(0,r.MZ)({type:l,nonNullable:!0})],c.prototype,"visibleElements",void 0),(0,s._)([(0,r.MZ)()],c.prototype,"visualVariables",void 0),c=(0,s._)([(0,o.$)("esri.widgets.Sketch.SketchTooltipOptions")],c);const d=c},81066:(e,t,i)=>{i.d(t,{FX:()=>O,JV:()=>Z,Mn:()=>f,WG:()=>k,ej:()=>b,en:()=>P,i7:()=>g,qR:()=>E});var s=i(85569),n=i(58680),r=i(78286),o=i(21839),a=i(22279),l=i(38774),c=i(32532),d=i(96245),u=i(97847),h=i(29106),p=i(41561);class y{intersect(e){return F(this,e)}closestPoints(e){return[this.closestTo(e)]}}class g extends y{constructor(e){super(),this.point=e}equals(e){return this===e||W(e)&&(0,o.h)(this.point,e.point)}closestTo(){return(0,u.o8)(this.point)}}class m extends y{constructor(e,t,i){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:i}}equals(e){return this===e||J(e)&&this.lineLike.type===e.lineLike.type&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)}closestTo(e){const t=(0,h.Yv)(e,this.lineLike);return(0,u._7)(t)}}class f extends m{constructor(e,t){super(e,t,p.Vv.LINE)}}class v extends m{constructor(e,t){super(e,t,p.Vv.RAY)}}class _ extends y{constructor(e){super(),this.constraints=e}equals(e){return this===e||q(e)&&(0,s.aI)(this.constraints,e.constraints,((e,t)=>e.equals(t)))}closestTo(e){let t,i=1/0;for(const s of this.constraints){const n=s.closestTo(e),r=(0,o.a)(e,n);r<i&&(i=r,t=n)}return t?(0,u.o8)(t):e}closestPoints(e){return this.constraints.flatMap((t=>t===this?[]:t.closestPoints(e)))}}class b extends y{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||X(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=(0,h.Nm)(e,this.center,this.radius);return(0,u._7)(t)}}class w extends y{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ee(e)&&(0,o.h)(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=(0,h.Nm)(e,this.center,this.radius);return t[2]=this.center[2],(0,u._7)(t)}asCircle(){return new S((0,u.o8)(this.center),this.radius,(0,u.fA)(0,0,1))}}class S extends y{constructor(e,t,i,s=void 0){super(),this.center=e,this.radius=t,this.normal=i,this.slicePlane=s}equals(e){return this===e||te(e)&&(0,o.h)(this.center,e.center)&&(0,o.h)(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:i}=this;(0,l._I)(this.getPlane(L),e,M);const s=(0,o.u)(M,M,t),n=(0,o.m)(s);if((0,h.Zj)(n,0))return(0,u.o8)(e);const r=i/Math.sqrt(n),c=(0,o.q)((0,a.c)(),t,s,r),{slicePlane:d}=this;if(d&&!(0,h.F2)(d,c)){const t=D(d,this);return t?.closestTo(e)??(0,u.o8)(e)}return(0,u._7)(c)}getPlane(e=(0,l.vt)()){return(0,l.O_)(this.center,this.normal,e)}}const M=(0,a.c)(),L=(0,l.vt)();class E extends y{constructor(e){super(),this.z=e}equals(e){return this===e||Y(e)&&this.z===e.z}closestTo(e){return(0,u._7)((0,a.f)(e[0],e[1],this.z))}getPlane(e=(0,l.vt)()){return(0,o.s)(I,0,0,this.z),(0,l.O_)(I,a.d,e)}}const I=(0,a.c)();class T extends y{constructor(e,t,i){super(),this.start=e,this.end=t,this.planeLike={start:e,end:t,type:i}}equals(e){return this===e||Q(e)&&this.planeLike.type===e.planeLike.type&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)}closestTo(e){return(0,u._7)((0,h.r2)(e,this.planeLike))}closestEndTo(e){const{start:t,end:i}=this;return Math.sign((0,n.g)((0,n.c)(C,i,t),(0,n.c)(x,e,t)))>0?i:t}getPlane(e=(0,l.vt)()){const t=(0,o.c)(A,this.end);return t[2]+=1,(0,l.Cr)(this.start,this.end,t,e)}getSlicePlane(e=(0,l.vt)()){const{start:t,end:i,type:s}=this.planeLike;if(s===h.pJ.PLANE)return;const n=(0,o.s)(A,t[0],t[1],0),r=(0,o.s)(R,i[0],i[1],0),a=(0,o.f)(R,r,n);return(0,l.O_)(n,a,e),e}}const C=(0,r.a)(),x=(0,r.a)(),A=(0,a.c)(),R=(0,a.c)();class O extends T{constructor(e,t){super(e,t,h.pJ.HALF_PLANE)}}class k extends T{constructor(e,t){super(e,t,h.pJ.PLANE)}}class Z extends y{constructor(e,t){super(),this.sphere=(0,d.k)(e,t)}equals(e){return this===e||ie(e)&&(0,d.l)(this.sphere,e.sphere)}closestTo(e){const t=(0,d.p)(this.sphere,e,(0,a.c)());return(0,u._7)(t)}get center(){return this.sphere}get radius(){return this.sphere[3]}}class P extends y{constructor(e,t,i){super(),this.start=e,this.end=t,this.getZ=i,this.planeLike={start:e,end:t,type:h.pJ.PLANE}}equals(e){return this===e||se(e)&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return function(e,t){const i=(0,h.r2)(t,e.planeLike);return i[2]=e.getZ(i[0],i[1])??ne,(0,u._7)(i)}(this,e)}addIfOnTheGround(e,t){for(const i of t){const t=this.getZ(i[0],i[1])??0;(0,h.Zj)(i[2],t)&&(i[2]=t,e.push(i))}}}function F(e,t){if(q(e)){const i=[];for(const s of e.constraints){const e=s.intersect(t);e&&i.push(e)}return U(i)}if(q(t))return F(t,e);if(se(e))return z(e,t);if(se(t))return z(t,e);if(W(e)){const{point:i}=e,s=t.closestTo(i);return(0,o.G)(s,i)?e:void 0}if(J(e)){if(W(t))return F(t,e);if(J(t))return K((0,h.SO)(e.lineLike,t.lineLike));if(Y(t))return N(e,t);if(Q(t))return K((0,h.Mc)(t.planeLike,e.lineLike));if(X(t))return K((0,h.K4)(e.lineLike,t.center,t.radius));if(te(t))return K((0,h.IB)(e.lineLike,t));if(ee(t))return function({lineLike:e},{center:t,radius:i}){const s=t[2];return K((0,h.K4)(e,t,i).filter((e=>(0,h.Zj)(e[2],s))))}(e,t);if(ie(t))return function({lineLike:e},{sphere:t}){return K((0,d.m)(t,e.start,e.end))}(e,t)}else if(Y(e)){if(W(t)||J(t))return F(t,e);if(Y(t))return function(e,t){return(0,h.Zj)(e.z,t.z)?e:void 0}(e,t);if(Q(t))return function({z:e},{planeLike:t}){const[i,s]=t.start,[n,r]=t.end,o=(0,u.fA)(i,s,e),a=(0,u.fA)(n,r,e);return t.type===h.pJ.PLANE?new f(o,a):new v(o,a)}(e,t);if(X(t))return function(e,t){const[i,s]=t.center;return new w((0,u.fA)(i,s,e.z),t.radius)}(e,t);if(te(t))return V(e,t);if(ee(t))return function(e,t){return(0,h.Zj)(t.center[2],e.z)?t:void 0}(e,t);if(ie(t))return function(e,{center:t,radius:i}){const s=Math.abs(t[2]-e.z);if(s>i&&!(0,h.Zj)(s,i))return;const n=(0,u.fA)(t[0],t[1],e.z),r=Math.sqrt(i**2-s**2);return(0,h.Zj)(r,0)?void 0:new w(n,r)}(e,t)}else if(Q(e)){if(W(t)||J(t)||Y(t))return F(t,e);if(Q(t))return H((0,h.b_)(e.planeLike,t.planeLike));if(X(t))return H((0,h.Bn)(e.planeLike,t.center,t.radius));if(te(t))return $(e,t);if(ee(t))return G(e,t);if(ie(t))return B(e,t)}else if(X(e)){if(W(t)||J(t)||Y(t)||Q(t))return F(t,e);if(X(t))return H((0,h.t1)(e.center,e.radius,t.center,t.radius));if(te(t))return;if(ee(t))return function(e,t){const i=(0,n.k)(e.center,t.center);return(0,h.Zj)(i,0)&&(0,h.Zj)(e.radius,t.radius)?t:j((0,h.t1)(e.center,e.radius,t.center,t.radius),t.center[2])}(e,t);if(ie(t))return}else if(te(e)){if(W(t)||J(t)||Y(t)||Q(t)||X(t))return F(t,e);if(te(t))return;if(ee(t))return void t.asCircle();if(ie(t))return}else if(ee(e)){if(W(t)||J(t)||Y(t)||Q(t)||X(t)||te(t))return F(t,e);if(ee(t))return function(e,t){if(!(0,h.HG)(e.center,t.center))return;const i=(0,n.k)(e.center,t.center);return(0,h.Zj)(i,0)&&(0,h.Zj)(e.radius,t.radius)?e:j((0,h.t1)(e.center,e.radius,t.center,t.radius),e.center[2])}(t,e);if(ie(t))return}else if(ie(e)){if(W(t)||J(t)||Y(t)||Q(t)||X(t)||ee(t))return F(t,e);if(ie(t))return}}const N=(()=>{const e=(0,l.vt)();return(t,i)=>{const{start:s,end:n}=t;if((0,h.HG)(s,n)&&(0,h.Zj)(s[2],i.z))return t;const r=(0,a.c)();return(0,l.U5)(i.getPlane(e),s,n,r)?new g((0,u._7)(r)):void 0}})();const D=(()=>{const e=(0,c.vt)(),t=(0,l.vt)(),i={start:(0,a.c)(),end:(0,a.c)(),type:p.Vv.LINE};return(s,n,r)=>{const{normal:c,center:d,radius:p}=n,y=(0,o.j)(c,(0,l.qb)(s)),m=(0,h.Zj)((0,l.Io)(s,d),0);if((0,h.Zj)(y,1))return m?n:void 0;if(n.getPlane(t),m&&(0,h.Zj)(y,0)&&(0,l.fk)(s)&&(0,l.fk)(t)){if((0,h.Zj)(p,0))return!r||(0,h.F2)(r,d)?new g((0,u.o8)(d)):void 0;const e=(0,a.g)(d);e[2]+=p;const t=(0,a.g)(d);t[2]-=p;const i=[];return r&&!(0,h.F2)(r,e)||i.push(e),r&&!(0,h.F2)(r,t)||i.push(t),K(i)}if(!(0,l.Ji)(s,t,e))return;(0,o.c)(i.start,e.origin),(0,o.g)(i.end,e.origin,e.direction);const f=(0,h.IB)(i,n);return K(r?(0,h.UL)(r,f):f)}})();const V=(()=>{const e=(0,l.vt)();return(t,i)=>D(t.getPlane(e),i)})();const G=(()=>{const e=(0,l.vt)();return(t,{center:i,radius:s})=>{const n=(0,h.Bn)(t.planeLike,i,s),r=i[2];t.getSlicePlane(e);const o=[];for(const[a,l]of n){const t=[a,l,r];(0,h.F2)(e,t)&&o.push(t)}return K(o)}})(),$=(()=>{const e=(0,l.vt)(),t=(0,l.vt)();return(i,s)=>D(i.getPlane(e),s,i.getSlicePlane(t))})(),B=(()=>{const e=(0,l.vt)();return(t,{center:i,radius:s})=>{const n=t.getPlane(e),r=(0,l.mN)(n,i),c=Math.abs(r);if(c>s&&!(0,h.Zj)(c,s))return;const d=(0,a.g)((0,l.qb)(n)),p=(0,o.q)((0,a.c)(),i,d,r),y=Math.sqrt(s**2-r**2);return(0,h.Zj)(y,0)?new g((0,u._7)((0,l._I)(n,i,(0,a.c)()))):new S((0,u._7)(p),y,d,t.getSlicePlane())}})();function z(e,t){const{planeLike:i,getZ:s}=e,n=[];if(W(t))e.addIfOnTheGround(n,(0,h.VT)(i,t.point));else if(J(t))e.addIfOnTheGround(n,(0,h.Mc)(i,t.lineLike));else if(X(t))for(const[r,o]of(0,h.Bn)(i,t.center,t.radius)){const e=s(r,o);null!=e&&n.push((0,a.f)(r,o,e))}else if(Q(t)||se(t))for(const[r,o]of(0,h.b_)(i,t.planeLike)){const e=s(r,o)??ne;n.push((0,a.f)(r,o,e))}return K(n)}function H(e){return U(e.map((([e,t])=>{const i=(0,u.fA)(e,t,0),s=(0,u.fA)(e,t,1);return new f(i,s)})))}function K(e){return U(e.map((e=>e?new g((0,u._7)(e)):void 0)))}function j(e,t){return K(e.map((([e,i])=>[e,i,t])))}function U(e){if(0!==e.length)return 1===e.length?e[0]??void 0:new _(e.filter(s.Ru))}function q(e){return e instanceof _}function W(e){return e instanceof g}function J(e){return e instanceof m}function Y(e){return e instanceof E}function Q(e){return e instanceof T}function X(e){return e instanceof b}function ee(e){return e instanceof w}function te(e){return e instanceof S}function ie(e){return e instanceof Z}function se(e){return e instanceof P}const ne=0},97847:(e,t,i)=>{i.d(t,{Lp:()=>d,_7:()=>a,fA:()=>l,io:()=>h,o8:()=>c,vf:()=>u,vt:()=>o});var s=i(22279),n=i(29394),r=i(27451);function o(e,t,i){return(0,s.f)(e,t,i)}function a(e){return e}function l(e,t,i){return(0,s.f)(e,t,i)}function c(e){return(0,s.g)(e)}function d(e,t,{coordinateHelper:i,elevationInfo:s}){return e?u(i.vectorToDehydratedPoint(e,p),t,s):null}function u(e,t,i){if(null==e)return null;if(null==t)return(0,s.f)(e.x,e.y,e.z??0);if("2d"===t.type)return(0,s.f)(e.x,e.y,0);const n=(0,r.wS)(t,e,i,r.qt)??0;return(0,s.f)(e.x,e.y,n)}function h(e,t){return(0,n.T)(e[0],e[1],e[2],t)}const p=(0,n.T)(0,0,0,null)},1381:(e,t,i)=>{i.d(t,{N:()=>d});var s=i(66866),n=i(96220),r=i(21877),o=i(21564),a=i(63863);let l=class extends r.oY{constructor(){super(...arguments),this.enabled=!0}};(0,s._)([(0,o.MZ)({type:Boolean})],l.prototype,"enabled",void 0),l=(0,s._)([(0,a.$)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],l);let c=class extends r.oY{constructor(e){super(e),this.lineSnapper=new l,this.parallelLineSnapper=new l,this.rightAngleSnapper=new l,this.rightAngleTriangleSnapper=new l,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThreshold=.1,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new n.A([255,127,0]),this.orangeTransparent=new n.A([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,s._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"lineSnapper",void 0),(0,s._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"parallelLineSnapper",void 0),(0,s._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleSnapper",void 0),(0,s._)([(0,o.MZ)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleTriangleSnapper",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"shortLineThreshold",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"distance",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointThreshold",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"intersectionParallelLineThreshold",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"parallelLineThreshold",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"verticalLineThreshold",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"touchSensitivityMultiplier",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointOnLineThreshold",void 0),(0,s._)([(0,o.MZ)({type:n.A,nonNullable:!0})],c.prototype,"orange",void 0),(0,s._)([(0,o.MZ)({type:n.A,nonNullable:!0})],c.prototype,"orangeTransparent",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthReference",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthTarget",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"lineHintFadedExtensions",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"parallelLineHintWidth",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],c.prototype,"parallelLineHintLength",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"parallelLineHintOffset",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],c.prototype,"rightAngleHintSize",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],c.prototype,"rightAngleHintOutlineSize",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"satisfiesConstraintScreenThreshold",void 0),c=(0,s._)([(0,a.$)("esri.views.interactive.snapping.Settings.Defaults")],c);const d=new c},40508:(e,t,i)=>{var s;i.d(t,{n:()=>s}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(s||(s={}))},46113:(e,t,i)=>{i.d(t,{X:()=>a});var s=i(81066),n=i(61851),r=i(90814),o=i(4368);class a extends r.w{constructor(e){super({...e,isDraped:!0,constraint:new s.en(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new o.c(n.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},15991:(e,t,i)=>{i.d(t,{z:()=>a});var s=i(81066),n=i(61851),r=i(90814),o=i(4368);class a extends r.w{constructor(e){super({...e,constraint:new s.Mn(e.edgeStart,e.edgeEnd)})}get hints(){return[new o.c(n.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},90814:(e,t,i)=>{i.d(t,{w:()=>r});var s=i(40508),n=i(820);class r extends n.C{constructor({targetPoint:e,objectId:t,constraint:i,isDraped:n}){super(e,i,n,s.n.FEATURE),this.objectId=t}}},820:(e,t,i)=>{i.d(t,{C:()=>s});class s{constructor(e,t,i,s){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=s}}},13795:(e,t,i)=>{i.d(t,{v:()=>o});var s=i(21839),n=i(40508),r=i(53830);class o extends r.m{constructor(e,t,i=n.n.ALL){super(t,i),this.intersectionPoint=e}equals(e){return e instanceof o&&(0,s.h)(this.intersectionPoint,e.intersectionPoint)}}},4368:(e,t,i)=>{i.d(t,{c:()=>o});i(39831),i(539);var s=i(21839),n=i(40508),r=i(53830);class o extends r.m{constructor(e,t,i,s,r=n.n.ALL,o=!0,a=!0){super(s,r),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof o&&this.type===e.type&&(0,s.h)(this.lineStart,e.lineStart)&&(0,s.h)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return(0,s.o)(this.lineStart,this.lineEnd)}}},74989:(e,t,i)=>{i.d(t,{r:()=>o});i(39831),i(539);var s=i(21839),n=i(40508),r=i(53830);class o extends r.m{constructor(e,t,i,s=n.n.ALL){super(i,s),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof o&&(0,s.h)(this.lineStart,e.lineStart)&&(0,s.h)(this.lineEnd,e.lineEnd)}}},23495:(e,t,i)=>{i.d(t,{l:()=>o});i(39831),i(539);var s=i(21839),n=i(40508),r=i(53830);class o extends r.m{constructor(e,t,i,s,r=n.n.ALL){super(s,r),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof o&&(0,s.h)(this.previousVertex,e.previousVertex)&&(0,s.h)(this.centerVertex,e.centerVertex)&&(0,s.h)(this.nextVertex,e.nextVertex)}}},53830:(e,t,i)=>{i.d(t,{m:()=>s});class s{constructor(e,t){this.isDraped=e,this.domain=t}}},61851:(e,t,i)=>{i.d(t,{BY:()=>b,H3:()=>s,HN:()=>_,Mo:()=>g,Tu:()=>w,is:()=>v,nf:()=>f,pM:()=>y,xX:()=>m});var s,n=i(85251),r=i(76286),o=i(76859),a=i(46437),l=i(21839),c=i(29394),d=i(14474),u=i(54874),h=i(70384),p=i(97847);function y(e,t){const i=e.x-t.x,s=e.y-t.y;return i*i+s*s}function g(e,t){return Math.sqrt(y(e,t))}function m(e,t){t.sort(((t,i)=>(0,l.a)(t.targetPoint,e)-(0,l.a)(i.targetPoint,e)))}function f({point:e,distance:t,returnEdge:i,vertexMode:s,coordinateHelper:{spatialReference:n},filter:l},u,h){return h=null!=h?h.clone():new d.A({where:"1=1"}),l&&(h.geometry=l.geometry,h.distance=l.distance,h.spatialRelationship=l.spatialRelationship,h.where=(0,o.m)(h.where,l.where),h.timeExtent=(0,a.pJ)(h.timeExtent,l.timeExtent),h.objectIds=function(e,t){return e||t?t?e?Array.from((0,r.E$)(new Set(e),new Set(t))):t:e:null}(h.objectIds,l.objectIds)),{point:(0,c.T)(e[0],e[1],e[2],n.toJSON()),mode:u,distance:t,returnEdge:i,vertexMode:s,query:h.toJSON()}}function v(e,t,i){return{left:(0,p.Lp)(e.leftVertex.pos,t,i),right:(0,p.Lp)(e.rightVertex.pos,t,i)}}function _(e){return e.createQuery()}function b(e,t=()=>{}){const i=(0,n.wB)((()=>({view:e.view,snappingOptions:e.snappingOptions})),(({view:i,snappingOptions:s})=>{const n="snapping-toggle",r=u.o.TOOL;if(e.removeHandles(n),i&&null!=s){const o=[i.on("key-down",(e=>{e.key!==h.fn.toggle||e.repeat||(s.enabledToggled=!0,t())}),r),i.on("key-up",(e=>{e.key===h.fn.toggle&&(s.enabledToggled=!1,t())}),r),i.on("pointer-move",(e=>{const i=e.native.ctrlKey;s.enabledToggled!==i&&(s.enabledToggled=i,t())}),r)];e.addHandles(o,n)}}),n.pc);e.addHandles(i)}function w(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass&&"utilityNetworks"in e&&!!e?.utilityNetworks?.length}!function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(s||(s={}))},38175:(e,t,i)=>{i.d(t,{XG:()=>l,jq:()=>c});var s=i(89882),n=(i(58680),i(21839)),r=i(22279),o=i(29394),a=i(27451);function l(e,t,i,s,o=(0,r.c)()){const l=(0,n.c)(u,e);return l[2]=(0,a.xS)(s,l,t,i)||0,s.renderCoordsHelper.toRenderCoords(l,t,o),o}function c(e,t,i,n){return"2d"===n.type?(d.x=e[0],d.y=e[1],d.spatialReference=t,n.toScreen(d)):(l(e,t,i,n,u),n.state.camera.projectToScreen(u,h),(0,s.tc)(h[0],h[1]))}const d=(0,o.T)(0,0,0,null),u=(0,r.c)(),h=((0,s.r_)(),(0,s.r_)(),(0,s.gs)())},49313:(e,t,i)=>{i.d(t,{V:()=>o,t:()=>a});i(17639);var s=i(92976),n=i(55876),r=i(84698);function o(e,t,i,n=new r.A){let o=0;if("2d"===i.type)o=t*(i.resolution??0);else if("3d"===i.type){const n=i.overlayPixelSizeInMapUnits(e),r=i.basemapSpatialReference;o=null==r||r.equals(i.spatialReference)?t*n:(0,s.GA)(r)/(0,s.GA)(i.spatialReference)}const a=e.x-o,l=e.y-o,c=e.x+o,d=e.y+o,{spatialReference:u}=i;return n.xmin=Math.min(a,c),n.ymin=Math.min(l,d),n.xmax=Math.max(a,c),n.ymax=Math.max(l,d),n.spatialReference=u,n}function a(e,t,i){const s=i.toMap(e);return null!=s&&o(s,(0,n.o)(),i,l).intersects(t)}const l=new r.A},41561:(e,t,i)=>{i.d(t,{Dh:()=>l,IB:()=>d,Vv:()=>s,fg:()=>a,jI:()=>c});i(92504);var s,n=i(58680),r=i(78286);function o(e,t){return e[0]*t[1]-e[1]*t[0]}function a(e,t,i,s,r=i){return(0,n.c)(h,s,i),(0,n.c)(y,t,r),function(e,t,i){const s=(0,n.g)(i,t)/(0,n.v)(i);(0,n.a)(e,i,s)}(g,y,h),(0,n.i)(e,r,g)}function l(e,t,i,s){(0,n.c)(h,t,i);const r=s/(0,n.h)(h);return(0,n.w)(e,i,h,r)}function c(e,t){const i=e.start,r=e.end,a=t.start,l=t.end,c=(0,n.c)(h,r,i),d=(0,n.c)(p,l,a),m=o(c,d);if(Math.abs(m)<=u)return[];const f=(0,n.c)(y,i,a),v=o(d,f)/m,_=o(c,f)/m;if(v>=0){if(_>=0||t.type===s.LINE)return[(0,n.w)(g,i,c,v)]}else if(e.type===s.LINE&&(_>=0||t.type===s.LINE))return[(0,n.w)(g,i,c,v)];return[]}function d(e,t,i){const r=[],o=(0,n.c)(h,e.end,e.start),a=(0,n.c)(p,e.start,t),l=(0,n.v)(o),c=2*(0,n.g)(o,a),d=c*c-4*l*((0,n.v)(a)-i*i);if(0===d){const t=-c/(2*l);(e.type===s.LINE||t>=0)&&r.push((0,n.w)(g,e.start,o,t))}else if(d>0){const t=Math.sqrt(d),i=(-c+t)/(2*l);(e.type===s.LINE||i>=0)&&r.push((0,n.w)(g,e.start,o,i));const a=(-c-t)/(2*l);(e.type===s.LINE||a>=0)&&r.push((0,n.w)(y,e.start,o,a))}return r}!function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"}(s||(s={}));const u=1e-6,h=(0,r.a)(),p=(0,r.a)(),y=(0,r.a)(),g=(0,r.a)()},29106:(e,t,i)=>{i.d(t,{Bn:()=>u,F2:()=>I,HG:()=>M,IB:()=>v,K4:()=>_,Mc:()=>h,Ni:()=>x,Nm:()=>m,SO:()=>b,UL:()=>E,VT:()=>p,Yv:()=>f,Zj:()=>L,b_:()=>y,pJ:()=>T,r2:()=>g,t1:()=>w});var s=i(92504),n=i(58680),r=i(78286),o=i(21839),a=i(22279),l=i(38774),c=i(72699),d=i(41561);function u({start:e,end:t,type:i},s,o){const a=[],l=(0,n.c)(O,t,e),c=(0,n.c)(k,e,s),d=(0,n.v)(l),u=2*(0,n.g)(l,c),h=u*u-4*d*((0,n.v)(c)-o*o);if(0===h){const t=-u/(2*d);(i===T.PLANE||t>=0)&&a.push((0,n.w)((0,r.a)(),e,l,t))}else if(h>0){const t=Math.sqrt(h),s=(-u+t)/(2*d);(i===T.PLANE||s>=0)&&a.push((0,n.w)((0,r.a)(),e,l,s));const o=(-u-t)/(2*d);(i===T.PLANE||o>=0)&&a.push((0,n.w)((0,r.a)(),e,l,o))}return a}function h(e,t){const i=e.start,s=e.end,r=(0,n.c)(O,s,i),l=(0,o.s)(k,-r[1],r[0],0),c=t.start,u=t.end,h=(0,o.u)(Z,u,c),p=(0,o.j)(h,l),y=(0,o.s)(P,i[0],i[1],0),g=(0,o.u)(F,y,c),m=(0,o.j)(g,l);if(Math.abs(p)<x)return Math.abs(m),[];const f=(0,o.q)(N,c,h,m/p);if(t.type===d.Vv.RAY){const e=(0,o.u)(D,f,c);if((0,o.j)(e,h)<-x)return[]}if(e.type===T.HALF_PLANE){const e=(0,n.b)(D,f,i);if((0,n.g)(e,r)<-x)return[]}return[(0,a.g)(f)]}function p(e,t){return function({start:e,end:t,type:i},s){const n=(0,o.u)(O,s,e),r=(0,o.u)(k,t,e),l=(0,o.b)(Z,r,n);if((0,o.F)(l)/(0,o.F)(r)<x)switch(i){case d.Vv.LINE:return[(0,a.g)(s)];case d.Vv.RAY:return(0,o.j)(r,n)<-x?[]:[(0,a.g)(s)]}return[]}(S(G,t[2],e),t)}function y(e,t){const i=b(S(G,0,e),S($,0,t)),s=[];for(const n of i)s.push((0,r.d)(n));return s}function g(e,t){return f(e,S(G,e[2],t))}function m(e,t,i){const s=(0,n.c)(O,e,t),r=i/(0,n.h)(s),o=(0,n.w)((0,a.c)(),t,s,r);return o[2]=e[2],o}function f(e,{start:t,end:i,type:s}){const n=(0,o.u)(O,e,t),r=(0,o.u)(k,i,t),l=(0,o.j)(n,r)/(0,o.j)(r,r);return(0,o.q)((0,a.c)(),t,r,s===d.Vv.RAY?Math.max(l,0):l)}const v=(()=>{const e=(0,a.c)(),t=(0,a.c)(),i=(0,a.c)();return({start:s,end:u},{center:h,radius:p,normal:y,slicePlane:g})=>{const m=(0,a.c)(),f=(0,l.O_)(h,y,V);if(L((0,l.Io)(f,s),0)&&L((0,l.Io)(f,u),0)){(0,c.VV)(y,e,t);const l=(s,r)=>((0,o.f)(i,r,h),(0,n.s)(s,(0,o.j)(i,e),(0,o.j)(i,t)),s),m=(0,d.IB)({start:l(A,s),end:l(R,u),type:d.Vv.LINE},r.Z,p),f=[];for(const[i,s]of m){const n=(0,o.c)((0,a.c)(),h);(0,o.q)(n,n,e,i),(0,o.q)(n,n,t,s),g&&!I(g,n)||f.push(n)}return f}return(0,l.U5)(f,s,u,m)?!L((0,o.o)(m,h),p)||g&&!I(g,m)?[]:[m]:[]}})();function _({start:e,end:t,type:i},s,r){const l=[],c=(0,o.f)(O,t,e),u=(0,n.c)(k,e,s),h=(0,n.v)(c),p=2*(0,n.g)(c,u),y=p*p-4*h*((0,n.v)(u)-r*r);if(0===y){const t=-p/(2*h);(i===d.Vv.LINE||t>=0)&&l.push((0,o.q)((0,a.c)(),e,c,t))}else if(y>0){const t=Math.sqrt(y),s=(-p+t)/(2*h);(i===d.Vv.LINE||s>=0)&&l.push((0,o.q)((0,a.c)(),e,c,s));const n=(-p-t)/(2*h);(i===d.Vv.LINE||n>=0)&&l.push((0,o.q)((0,a.c)(),e,c,n))}return l}function b(e,t){const i=e.start,n=e.end,r=t.start,l=t.end,c=(0,o.u)(O,n,i),u=(0,o.u)(k,l,r),h=(0,o.u)(Z,r,i),p=(0,o.b)(P,c,u),y=(0,o.j)(h,p);if(!(0,s.Sp)(y,0,x))return[];const g=(0,o.F)(p);if((0,s.Sp)(g,0,x))return[];const m=(0,o.b)(F,h,u),f=(0,o.j)(m,p)/g,v=(0,o.q)(N,i,c,f);if(e.type===d.Vv.RAY){const e=(0,o.u)(D,v,i);if((0,o.j)(c,e)<-x)return[]}if(t.type===d.Vv.RAY){const e=(0,o.u)(D,v,r);if((0,o.j)(u,e)<-x)return[]}return[(0,a.g)(v)]}function w(e,t,i,s){const[o,a]=e,[l,c]=i,d=l-o,u=c-a,h=d*d+u*u,p=Math.sqrt(h);if(p>t+s)return[];if(p<Math.abs(t-s))return[];if(L(p,0)&&L(t,s))return[];const y=(t*t-s*s+h)/(2*p),g=Math.sqrt(t*t-y*y),m=g*u/p,f=g*d/p,[v,_]=(0,n.l)(A,e,i,y/p);return L(m,f)?[(0,r.f)(v,_)]:[(0,r.f)(v+m,_-f),(0,r.f)(v-m,_+f)]}function S(e,t,{start:i,end:s,type:n}){return(0,o.s)(e.start,i[0],i[1],t),(0,o.s)(e.end,s[0],s[1],t),e.type=C[n],e}function M(e,t){return L(e[2],t[2])}function L(e,t){return Math.abs(e-t)<x}function E(e,t){return t.filter((t=>I(e,t)))}function I(e,t){return(0,l.Tj)(e,t)}var T;!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(T||(T={}));const C={[T.PLANE]:d.Vv.LINE,[T.HALF_PLANE]:d.Vv.RAY},x=1e-6,A=(0,r.a)(),R=(0,r.a)(),O=(0,a.c)(),k=(0,a.c)(),Z=(0,a.c)(),P=(0,a.c)(),F=(0,a.c)(),N=(0,a.c)(),D=(0,a.c)(),V=(0,l.vt)(),G={start:(0,a.c)(),end:(0,a.c)(),type:d.Vv.LINE},$={start:(0,a.c)(),end:(0,a.c)(),type:d.Vv.LINE}},87438:(e,t,i)=>{i.d(t,{zF:()=>n});function s(e){return"graphic"===e?.type}function n(e){return e.find(s)??null}},21477:(e,t,i)=>{i.d(t,{A:()=>$e});var s=i(66866),n=i(99050),r=i(85251),o=i(21564),a=(i(73446),i(85569)),l=(i(39831),i(63863)),c=i(30405),d=i(46928),u=i(58556),h=i(48982),p=i(45307),y=i(4130),g=i(97303),m=i(87926),f=i(98849),v=i(40189),_=i(40454),b=i(10714),w=i(86394),S=i(52495),M=i(19251),L=i(6267),E=i(58947);class I{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}}class T{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new C}}class C{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class x{constructor(e,t,i,s){this._workerFunc=e,this._callbackFunc=t,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map((e=>new T(e)))}destroy(){this._clients.length=0}hasQuota(e){const t=this._clients[e];return!!t&&(this._totalNumWorkers<this._maxTotalNumWorkers||t.numWorkers+t.tasks.length<t.typeWorkerQuota)}push(e){const t=this._clients[e.client];t&&(this._totalNumWorkers<this._maxTotalNumWorkers?(t.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,((e,t)=>this._taskCallback(e,t)))):t.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const t=this._clients[e.client];this._totalNumWorkers--,t&&(t.numWorkers--,t.statistics.requests++,t.statistics.size+=e.size||0,t.statistics.duration+=e.duration||0,t.statistics.speed=t.statistics.duration>0?t.statistics.size/t.statistics.duration:0,(0,E.vA)(t.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),((e,t)=>this._taskCallback(e,t))))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,t){e._cancelled||(this._callbackFunc(e,t),this._taskFinished(e))}getStatsForType(e){const t=this._clients[e];return t?{quota:t.typeWorkerQuota,workers:t.numWorkers,queueSize:t.tasks.length,requestStats:t.statistics}:null}get test(){const e=this;return{set workerFunc(t){e._workerFunc=t}}}}var A=i(93399);let R=class extends S.A{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new x(((e,t)=>this._startLoading(e,t)),((e,t)=>this._doneLoadingCB(e,t)),e,t),i&&(this._frameTask=i.registerTask(A.W6.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=(0,L.xt)(this._frameTask),this._tasks.forEach((e=>(0,L.DC)(e.abortController))),this._loadQueue=(0,L.pR)(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,s={}){const n=(0,v.Tw)();n.__signal=null!=s?s.signal:null;const r=this._createOrUpdateTask(e,t,i,s,n);return(0,v.u7)(s,(()=>this._cancelRequest(r,n))),n.promise}_createTask(e,t,i,s,n,r){const o=new Z(e,t,i,s,n);return this._updateTask(o,r),this._tasks.set(n,o),1===this._tasks.size&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){(0,a.Xy)(e.resolvers,t),t.reject((0,v.NK)()),0===e.resolvers.length&&(e.status===P.DOWNLOADING&&(e.status=P.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=P.CANCELLED,this._tasks.delete(e.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,s,n){const r=function(e,t,i){return`${e}:${t}:${i}`}(s?.uid||e,t,i),o=this._tasks.get(r);return o?(this._updateTask(o,n),o):this._createTask(e,s,t,i,r,n)}_doneLoadingCB(e,t){this._loadQueue&&((0,E.vA)(e.status===P.DOWNLOADING),e.status=P.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();(0,v.Te)(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==P.DOWNLOADED&&(t.err=t.err||(0,v.NK)()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!(0,v.zf)(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(t)(0,v.zf)(t)?s.reject(t):s.reject(new f.A("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const t=i>0?(0,M.o8)(e.result):e.result;s.resolve(t)}this._tasks.delete(e.key),0===this._tasks.size&&this._set("updating",!1)}_startLoading(e,t){if(e.status===P.CANCELLED)return!1;let i,s;switch(e.startTime=performance.now(),e.status=P.DOWNLOADING,e.docType){case"binary":s="array-buffer",i=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=(0,w.A)(e.url,{...e.options,responseType:s,timeout:i,signal:n});let r=()=>{};const o=i=>{e.duration=performance.now()-e.startTime,e.size=i instanceof ArrayBuffer?i.byteLength:e.size||0,e.result=i,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=i=>{e.status===P.DOWNLOADING&&t(e,i),r()};return"image+type"!==e.docType?(e.request.then((e=>o(e.data)),a),!0):(e.request.then((t=>{const l=t.data,c=function(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return 137===t[0]&&80===t[1]?"image/png":71===t[0]&&73===t[1]?"image/gif":66===t[0]&&77===t[1]?"image/bmp":255===t[0]&&216===t[1]?"image/jpeg":"unknown"}(l);if(s="image",e.size=l.byteLength,"unknown"===c)return e.request=(0,w.A)(e.url,{responseType:s,timeout:i,signal:n}),void e.request.then((e=>o(e.data)),a);const d=new Blob([l],{type:c}),u=window.URL.createObjectURL(d);r=()=>window.URL.revokeObjectURL(u),e.request=(0,w.A)(u,{responseType:s,timeout:i,signal:n}),e.request.then((e=>o(new k(e.data,c,r))),a)}),a),!0)}get test(){return{loadQueue:this._loadQueue}}};(0,s._)([(0,o.MZ)({readOnly:!0})],R.prototype,"updating",void 0),R=(0,s._)([(0,l.$)("esri.views.3d.support.StreamDataLoader")],R);const O=0;class k{constructor(e,t,i){this.image=e,this.type=t,this.release=i}get isOpaque(){return"image/jpeg"===this.type}}class Z extends I{constructor(e,t,i,s,n){super(s),this.url=e,this.options=t,this.docType=i,this.key=n,this.result=null,this.status=P.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=O}}var P,F,N;!function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"}(P||(P={})),function(e){e[e.INSIDE=0]="INSIDE",e[e.INTERSECTS=1]="INTERSECTS",e[e.OUTSIDE=2]="OUTSIDE"}(F||(F={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(N||(N={}));var D=i(21839),V=i(22279),G=i(80510),$=i(92504),B=(i(17639),i(92976)),z=i(84698),H=i(78983),K=i(96082),j=i(50437),U=i(65228),q=i(78632);class W{constructor(e){const t=W.checkUnsupported(e);if(null!=t)throw t;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=(0,g.canProjectToWGS84ComparableLonLat)(this.spatialReference)||(0,m.q8)(this.spatialReference)||(0,m.KQ)(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce(((e,t,i)=>(t.level<e.min&&(e.min=t.level,e.minIndex=i),e.max=Math.max(e.max,t.level),e)),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],r=2**n.level;let o=n.resolution*r,a=n.scale*r;this.levels=new Array(s.max+1);for(let l=0;l<this.levels.length;l++)this.levels[l]={resolution:o,scale:a,tileSize:[o*i.size[0],o*i.size[1]]},o/=2,a/=2}clone(){return new W(this.toTileInfo())}toTileInfo(){return new U.A({dpi:this.dpi,origin:new q.A({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(((e,t)=>new j.A({level:t,scale:e.scale,resolution:e.resolution})))})}getExtent(e,t,i,s){const n=this.levels[e],r=n.tileSize[0],o=n.tileSize[1];s[0]=this.origin[0]+i*r,s[2]=this.origin[0]+(i+1)*r,s[3]=this.origin[1]-t*o,s[1]=this.origin[1]-(t+1)*o}convertExtentToRadians(e,t){this._isWebMercator?(t[0]=(0,K.yw)(e[0]),t[1]=(0,K.jg)(e[1]),t[2]=(0,K.yw)(e[2]),t[3]=(0,K.jg)(e[3])):this._isGCS&&(t[0]=(0,$.kU)(e[0]),t[1]=(0,$.kU)(e[1]),t[2]=(0,$.kU)(e[2]),t[3]=(0,$.kU)(e[3]))}getExtentGeometry(e,t,i,s=new z.A){return this.getExtent(e,t,i,Y),s.spatialReference=this.spatialReference,s.xmin=Y[0],s.ymin=Y[1],s.xmax=Y[2],s.ymax=Y[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(null==e)return!1;let t=!1;for(;this.levels.length<=e;){const e=this.levels[this.levels.length-1],i=e.resolution/2;this.levels.push({resolution:i,scale:e.scale/2,tileSize:[i*this.pixelSize,i*this.pixelSize]}),t=!0}return t}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const t=this.levels[0].scale;return e>=t?0:Math.log(t/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof W)){if(W.checkUnsupported(e))return!1;e=new W(e)}if(!e.spatialReference.equals(this.spatialReference))return!1;if(e.pixelSize!==this.pixelSize)return!1;const t=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[t].resolution;let s=.5*i;return!(!(0,$.Sp)(e.origin[0],this.origin[0],s)||!(0,$.Sp)(e.origin[1],this.origin[1],s))&&(s=.5*i/2**t/this.pixelSize*12,(0,$.Sp)(i,e.levels[t].resolution,s))}rootTilesInExtent(e,t=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(null==e||0===n[0]||0===n[1])return s;W.computeRowColExtent(e,n,this.origin,Y);let r=Y[1],o=Y[3],a=Y[0],l=Y[2];const c=l-a,d=o-r;if(c*d>i){const e=Math.floor(Math.sqrt(i));d>e&&(r=r+Math.floor(.5*d)-Math.floor(.5*e),o=r+e),c>e&&(a=a+Math.floor(.5*c)-Math.floor(.5*e),l=a+e)}for(let u=r;u<o;u++)for(let e=a;e<l;e++)s.push([0,u,e]);return null!=t&&(t[0]=this.origin[0]+a*n[0],t[1]=this.origin[1]-o*n[1],t[2]=this.origin[0]+l*n[0],t[3]=this.origin[1]-r*n[1]),s}static computeRowColExtent(e,t,i,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-i[0])/t[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-i[0])/t[0])),s[1]=Math.max(0,Math.floor((i[1]-e[3]+n)/t[1])),s[3]=Math.max(0,Math.ceil((i[1]-e[1]-n)/t[1]))}static isPowerOfTwo(e){const t=e.lods,i=t[0].resolution*2**t[0].level;return!t.some((e=>!(0,$.b6)(e.resolution,i/2**e.level)))}static hasGapInLevels(e){const t=e.lods.map((e=>e.level));t.sort(((e,t)=>e-t));for(let i=1;i<t.length;i++)if(t[i]!==t[0]+i)return!0;return!1}static tileSizeSupported(e){const t=e.size[1];return t===e.size[0]&&!(t&t-1)&&t>=128&&t<=512}static hasOriginPerLODs(e){const t=e.origin;return e.lods.some((e=>null!=e.origin&&(e.origin[0]!==t.x||e.origin[1]!==t.y)))}static getMissingTileInfoError(){return new f.A("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return null==e?J():e.lods.length<1?new f.A("tilingscheme:generic","Tiling scheme must have at least one level"):W.isPowerOfTwo(e)?W.hasGapInLevels(e)?new f.A("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):W.tileSizeSupported(e)?W.hasOriginPerLODs(e)?new f.A("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new f.A("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new f.A("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,t){const i=e[2]-e[0],s=e[3]-e[1],n=(0,B.GA)(t),r=1.2*Math.max(i,s),o=256,a=new W(new U.A({size:[o,o],origin:new q.A({x:e[0]-.5*(r-i),y:e[3]+.5*(r-s)}),lods:[new j.A({level:0,resolution:r/o,scale:1/(o/96*.0254/(r*n))})],spatialReference:t}));return a.ensureMaxLod(20),a}static makeWebMercatorAuxiliarySphere(e){const t=new W(W.WebMercatorAuxiliarySphereTileInfo);return t.ensureMaxLod(e),t}static makeGCSWithTileSize(e,t=256,i=16){const s=256/t,n=new W(new U.A({size:[t,t],origin:new q.A({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new j.A({level:0,resolution:.703125*s,scale:295497598.570834*s})]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function J(){return new f.A("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}W.WebMercatorAuxiliarySphereTileInfo=new U.A({size:[256,256],origin:new q.A({x:-20037508.342787,y:20037508.342787,spatialReference:H.A.WebMercator}),spatialReference:H.A.WebMercator,lods:[new j.A({level:0,resolution:156543.03392800014,scale:591657527.591555})]}),W.WebMercatorAuxiliarySphere=W.makeWebMercatorAuxiliarySphere(19);const Y=(0,G.vt)(),Q=((0,$.$8)($.pq/10),(0,G.vt)());W.WebMercatorAuxiliarySphere.getExtent(0,0,0,Q);(0,G.vt)([-180,-90,180,90]);const X=(0,V.c)(),ee=(0,V.c)(),te=(0,V.c)(),ie=(0,V.c)();function se(e,t,i,s){(0,D.c)(X,i),X[s]=t[s];const n=(0,D.f)(X,X,t),r=(0,D.f)(ee,e,t),o=(0,D.j)(r,n),a=(0,D.j)(n,n);let l;l=o<=0?t:a<=o?i:(0,D.g)(X,t,(0,D.i)(n,n,o/a));const c=(0,D.f)(X,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}const ne=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:function(e,t,i){if(null==e)return J();if(e.spatialReference.isGeographic&&!(0,g.canProjectToWGS84ComparableLonLat)(e.spatialReference))return new f.A("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const s=W.checkUnsupported(e);if(null!=s)return s;if(null==i)return new f.A("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=function(e,t){const i=e.lods,s=i[0].resolution*2**i[0].level,n=[s*e.size[0],s*e.size[1]],r=[e.origin.x,e.origin.y],o=(0,G.VY)(t),a=(0,G.vt)();W.computeRowColExtent(o,n,r,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>64){const t=i[0].scale*2**i[0].level;let n=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*t/s;const r=Math.floor(Math.log(n)/Math.log(10));return n=Math.ceil(n/10**r)*10**r,new f.A("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(t).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+n.toLocaleString()+".",{level0Scale:t,suggestedLevel0Scale:n,requiredNumRootTiles:l,allowedNumRootTiles:64})}return null}(e,i);if(n)return n;const r=e.spatialReference;return null==t||r.equals(t)||t.isWGS84&&r.isWebMercator?null:new f.A("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")},isInsideExtent:function(e,t,i=0){const s=e.extent;if(null==s)return!1;if(0===i)return(0,G.Uc)(s,t);const n=Math.min(s[2]-s[0],s[3]-s[1]);return(0,G.k$)(s,t,i*n)},tiltToExtentEdge:function(e,t,i){const s=e.extent;if(null==s)return 0;te[0]=s[0],te[1]=s[1],te[2]=i,ie[0]=s[2],ie[1]=s[3],ie[2]=i;let n=1/0,r=1/0;return t[0]<te[0]?n=se(t,te,ie,0):t[0]>ie[0]&&(n=se(t,ie,te,0)),t[1]<te[1]?r=se(t,te,ie,1):t[1]>ie[1]&&(r=se(t,ie,te,1)),Math.min(n,r)}},Symbol.toStringTag,{value:"Module"}));const re=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:function(e,t){if(null==e)return J();const i=e.lods.length-1,s=e.spatialReference,n=(0,g.canProjectToWGS84ComparableLonLat)(s)||(0,m.q8)(s)||(0,m.KQ)(s);if(s.isWebMercator){if(!W.makeWebMercatorAuxiliarySphere(i).compatibleWith(e))return new f.A("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new f.A("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!W.makeGCSWithTileSize(e.spatialReference,e.size[0],i).compatibleWith(e))return e.spatialReference.isWGS84?new f.A("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new f.A("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return null==t||e.spatialReference.equals(t)?void 0:new f.A("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")},isInsideExtent:function(){return!0},tiltToExtentEdge:function(){return 0}},Symbol.toStringTag,{value:"Module"})),oe={[b.RT.Global]:re,[b.RT.Local]:ne};function ae(e,t,i,s){return oe[s].checkIfTileInfoSupportedForViewSR(e,i,t)}function le(e,t,i){const s=(0,_.r0)(e);if(null!=s){if(!h.A.isCollection(s))return{tileInfo:s.tileInfo,fullExtent:s.fullExtent};{const e=s.find((e=>null==ae(e.tileInfo,e.fullExtent,t,i)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}N.NORTH,N.EAST,N.SOUTH,N.WEST,N.NORTH_EAST,N.SOUTH_EAST,N.SOUTH_WEST,N.NORTH_WEST;var ce=i(95859);async function de(e,t={}){const{basemap:i,view:s}=e;await i.load(t),function(e){if(0===e.baseLayers.length&&0===e.referenceLayers.length)return;const t=e.baseLayers.concat(e.referenceLayers).toArray().filter((e=>!(0,_.ce)(e))).map((e=>function(e){return new f.A("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:e,operationalLayerType:e.operationalLayerType||"unknown"})}(e)));if(t.length)throw t[0]}(i),await async function(e,t,i){if(0===e.baseLayers.length)return;const s=e.baseLayers.at(0);if((0,_.r$)(s)){try{await s.load(i)}catch(I){const t="basemap-compatibility:unknown-error",i="Unknown basemap compatibility error",{name:s=t,message:n=i,details:r}=I;throw new f.A(s,n,r)}!function(e,t){const i=t.state.viewingMode;if(!i)return;let s,n;if("wmts"===e?.type){const r=le(e,t.spatialReference,i);if(null==r.tileInfo)throw new f.A("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");s=r.tileInfo,n=r.fullExtent}else s=e.tileInfo,n=e.fullExtent;if(null==s)return;if(!function(e,t){return null!=e&&(null==t||(t===b.RT.Local?!e.isGeographic||e.isWGS84||e.wkid===ce.Y.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===ce.Y.CGCS2000||e.wkid===ce.Y.GCSMARS2000||e.wkid===ce.Y.GCSMARS2000_SPHERE||e.wkid===ce.Y.GCSMOON2000))}(s.spatialReference,i))throw new f.A(`basemapgalleryitem:spatial-reference-unsupported-${(0,b._s)(i)}`,`Basemap spatial reference is unsupported in ${(0,b._s)(i)} mode`);const r=s.spatialReference.isGeographic,o="vector-tile"===e?.type?s.getOrCreateCompatible(256,r?1:2):null;if(i===b.RT.Global){let t=ae(s,n,null,i);if(t&&"vector-tile"===e?.type&&null!=n&&o&&!ae(o,n,null,i)&&(t=null),t){const e=s.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new f.A(`basemapgalleryitem:tiling-scheme-unsupported-${e}-global`,"Basemap tiling scheme is unsupported in global mode",{error:t})}}else if(W.checkUnsupported(s))throw new f.A("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const a=t.basemapTerrain?.tilingScheme;if(a&&!a.compatibleWith(s)&&("vector-tile"!==e?.type||!o||!a.compatibleWith(o)))throw new f.A("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}(s,t)}}(i,s,t),(0,v.Te)(t)}async function ue(e,t={}){const{basemap:i,view:s}=e;if((0,v.Te)(t),!s||"spatialReferenceLocked"in s&&!s.spatialReferenceLocked)return;if(await i.load(t),(0,v.Te)(t),0===i.baseLayers.length)return;const n=i.baseLayers.at(0);if(!(0,_.qK)(n))return;if(i.spatialReference){if(s.spatialReference.equals(i.spatialReference))return;he()}await n.load(t),(0,v.Te)(t);const r=(("supportedSpatialReferences"in n?n.supportedSpatialReferences:null)||["tileInfo"in n?n.tileInfo?.spatialReference:null]).filter(a.Ru);0!==r.length&&r.every((e=>!s.spatialReference.equals(e)))&&he()}function he(){throw new f.A("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}var pe=i(65667);let ye=class extends((0,pe.sA)(S.A)){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.addHandles([(0,r.wB)((()=>this.basemap?.loadStatus),e),(0,r.wB)((()=>this.compatibilityFunction),e),(0,r.wB)((()=>this.view&&"basemapTerrain"in this.view&&this.view.basemapTerrain?.tilingScheme),e),(0,r.wB)((()=>this.view?.ready),e),(0,r.wB)((()=>this.view?.spatialReference),e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return(0,c.n8)(this.view,this.basemap)}set basemap(e){e&&e.load().catch((()=>{})),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){this._cancelRefresh(),this._set("state","loading");const e=this.basemap?.loadStatus;if("loaded"!==e&&"failed"!==e)return;if(!this.compatibilityFunction)return void("loaded"===e?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const t=new AbortController,{signal:i}=t;this.compatibilityFunction(this,{signal:i}).then((()=>(0,r.C_)((()=>!this._spatialReferenceTask.updating),i))).then((()=>{this._set("state","ready"),this._set("error",null)})).catch((e=>{(0,v.zf)(e)||(this._set("state","error"),this._set("error",e))})),this._refreshController=t}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};(0,s._)([(0,o.MZ)({readOnly:!0})],ye.prototype,"_spatialReferenceTask",null),(0,s._)([(0,o.MZ)()],ye.prototype,"basemap",null),(0,s._)([(0,o.MZ)()],ye.prototype,"compatibilityFunction",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],ye.prototype,"error",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],ye.prototype,"spatialReference",null),(0,s._)([(0,o.MZ)({readOnly:!0})],ye.prototype,"state",void 0),(0,s._)([(0,o.MZ)()],ye.prototype,"view",void 0),ye=(0,s._)([(0,l.$)("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],ye);const ge=ye,me=h.A.ofType(u.default);let fe=class extends S.A{constructor(e){super(e),this.basemaps=new me}destroy(){this.basemaps.forEach((e=>e.destroy()))}get state(){return"ready"}refresh(){}};(0,s._)([(0,o.MZ)({type:me})],fe.prototype,"basemaps",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],fe.prototype,"state",null),fe=(0,s._)([(0,l.$)("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],fe);const ve=fe;var _e=i(539),be=i(84410),we=i(10282);const Se=h.A.ofType(u.default);let Me=class extends(p.A.LoadableMixin((0,be.g)(ve))){constructor(e){super(e),this._lastPortalBasemapFetchController=null,this.basemaps=new Se,this.filterFunction=null,this.portal=we.A.getDefault(),this.query=null,this.updateBasemapsCallback=null,this.viewType=null}initialize(){this.addHandles([(0,r.wB)((()=>[this.filterFunction,this.loadStatus,this.portal?.basemapGalleryGroupQuery,this.portal?.basemapGalleryGroupQuery3D,this.portal?.user,this.query,this.updateBasemapsCallback]),(()=>this.refresh()),r.Vh)])}destroy(){this.filterFunction=null,this.portal=null,this.basemaps.forEach((e=>e.destroy()))}get state(){return"not-loaded"===this.loadStatus?"not-loaded":"loading"===this.loadStatus||this._lastPortalBasemapFetchController?"loading":"ready"}load(e){return this.addResolvingPromise(this.portal.load(e)),Promise.resolve(this)}async refresh(){if("loaded"!==this.loadStatus)return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const e=this.portal,t=new AbortController;this._lastPortalBasemapFetchController=t,this.notifyChange("state");try{const i=await e.fetchBasemaps(this._toQueryString(this.query),{signal:t.signal,include3d:"3d"===this.viewType||void 0});await this._updateBasemaps(i)}catch(I){if((0,v.zf)(I))throw I;_e.A.getLogger(this).warn(new f.A("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:I})),await this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(e){return e&&"string"!=typeof e?Object.keys(e).map((t=>`${t}:${e[t]}`)).join(" AND "):e}async _updateBasemaps(e=[]){let t=await this._filterBasemaps(e);t=this.updateBasemapsCallback?this.updateBasemapsCallback(t):t,this.basemaps.removeAll(),this.basemaps.addMany(t)}async _filterBasemaps(e){if(!this.filterFunction)return e;const t=e.map(this.filterFunction),i=await Promise.all(t);return e.filter(((e,t)=>i[t]))}};(0,s._)([(0,o.MZ)({readOnly:!0,type:Se})],Me.prototype,"basemaps",void 0),(0,s._)([(0,o.MZ)()],Me.prototype,"filterFunction",void 0),(0,s._)([(0,o.MZ)({type:we.A})],Me.prototype,"portal",void 0),(0,s._)([(0,o.MZ)()],Me.prototype,"query",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],Me.prototype,"state",null),(0,s._)([(0,o.MZ)()],Me.prototype,"updateBasemapsCallback",void 0),(0,s._)([(0,o.MZ)()],Me.prototype,"viewType",void 0),Me=(0,s._)([(0,l.$)("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],Me);const Le=Me,Ee=h.A.ofType(ge);let Ie=class extends p.A{constructor(e){super(e),this._loadingProjectionEngine=!1,this._originalActiveBasemap=null,this.includeCurrentBasemap=!1,this.items=new Ee,this.source=new Le,this.view=null}initialize(){const e=()=>this._recreateItems();this.addHandles([(0,r.wB)((()=>[this.view,this.view?.ready]),(()=>{this.view?.ready&&(this._originalActiveBasemap=this.activeBasemap)}),{initial:!0}),(0,r.wB)((()=>"ready"===this.state?this.compatibilityFunction:null),(()=>this._updateItems())),(0,r.wB)((()=>[this._effectiveIncludeCurrentBasemap,this._originalActiveBasemap]),e),(0,r.on)((()=>this.source?.basemaps),"change",e,{onListenerAdd:e}),(0,r.z7)((()=>this.view),(()=>{this.source instanceof Le&&(this.source.viewType=this.view?.type)}),{once:!0})])}destroy(){const e=this.source.basemaps.find((e=>e===this.activeBasemap));e&&this.source.basemaps.remove(e),this.source?.destroy()}get _effectiveIncludeCurrentBasemap(){return this.includeCurrentBasemap&&this.source?.basemaps.every((e=>"loading"!==e.loadStatus))}get activeBasemap(){return this.view?.map?.basemap??null}set activeBasemap(e){const t=this.view;if(!t?.map)return;const i="string"==typeof e?u.default.fromId(e):e;if(!i||!t.ready)return t.map.basemap=i,void this._clearOverride("activeBasemap");const s=i.spatialReference||this.items?.find((e=>this.basemapEquals(i,e.basemap)))?.spatialReference;if(s&&"spatialReferenceLocked"in t&&!t.spatialReferenceLocked){const n=t.spatialReference;if(null!=s&&!(0,m.aI)(n,s)&&!(0,g.canProjectWithoutEngine)(t.spatialReference,s)&&!(0,g.isLoaded)())return this._override("activeBasemap",i),this._loadingProjectionEngine=!0,void(0,g.load)().then((()=>{this._get("activeBasemap")===e&&(t.map.basemap=e,t.spatialReference=s,this._clearOverride("activeBasemap"))}),(()=>{})).then((()=>{this._loadingProjectionEngine=!1}));t.map.basemap=i,this._clearOverride("activeBasemap"),null==s||(0,m.aI)(t.spatialReference,s)||(t.spatialReference=s)}else t.map.basemap=i,this._clearOverride("activeBasemap")}get activeBasemapIndex(){const{state:e,activeBasemap:t}=this;return"ready"!==e?-1:this._findBasemapIndex(t)}get compatibilityFunction(){return"3d"===this.view?.type?de:ue}set compatibilityFunction(e){this._overrideIfSome("compatibilityFunction",e)}castSource(e){return Array.isArray(e)||h.A.isCollection(e)?new ve({basemaps:e}):function(e){return e&&"esri.portal.Portal"===e.declaredClass}(e)?new Le({portal:e}):function(e){return e&&!(e instanceof Le)&&(!!e.portal||!!e.query)}(e)?new Le(e):function(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}(e)?e:null}get state(){return this.view?.ready&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(e,t){return(0,c.jU)(e,t)}refresh(){this._recreateItems()}load(e){return this.addResolvingPromise(p.A.isLoadable(this.source)?this.source.load(e):null),Promise.resolve(this)}_findBasemapIndex(e){const{items:t}=this,i=t.findIndex((t=>t.basemap===e));return-1===i?t.findIndex((t=>this.basemapEquals(t.basemap,e))):i}_recreateItems(){const e=this.source?.basemaps,{view:t,compatibilityFunction:i}=this,s=new Map(this.items.map((e=>[e.basemap,e])));function n(e){const n=s.get(e);return n?(s.delete(e),n):new ge({basemap:e,compatibilityFunction:i,view:t})}this.items.removeAll(),e&&this.items.addMany(e.map(n));const r=-1!==this._findBasemapIndex(this._originalActiveBasemap);this._effectiveIncludeCurrentBasemap&&!r&&null!=this._originalActiveBasemap&&this.items.unshift(n(this._originalActiveBasemap)),s.forEach((e=>e.destroy()))}_updateItems(){for(const e of this.items)e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}};(0,s._)([(0,o.MZ)()],Ie.prototype,"_effectiveIncludeCurrentBasemap",null),(0,s._)([(0,o.MZ)()],Ie.prototype,"_loadingProjectionEngine",void 0),(0,s._)([(0,o.MZ)()],Ie.prototype,"_originalActiveBasemap",void 0),(0,s._)([(0,o.MZ)()],Ie.prototype,"activeBasemap",null),(0,s._)([(0,o.MZ)({readOnly:!0})],Ie.prototype,"activeBasemapIndex",null),(0,s._)([(0,o.MZ)()],Ie.prototype,"compatibilityFunction",null),(0,s._)([(0,o.MZ)()],Ie.prototype,"includeCurrentBasemap",void 0),(0,s._)([(0,o.MZ)({readOnly:!0,type:Ee})],Ie.prototype,"items",void 0),(0,s._)([(0,o.MZ)()],Ie.prototype,"source",void 0),(0,s._)([(0,y.w)("source")],Ie.prototype,"castSource",null),(0,s._)([(0,o.MZ)({readOnly:!0})],Ie.prototype,"state",null),(0,s._)([(0,o.MZ)()],Ie.prototype,"view",void 0),Ie=(0,s._)([(0,l.$)("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],Ie);const Te=Ie;const Ce="esri-basemap-gallery",xe={base:Ce,widgetIcon:i(2295).T.basemap,sourceLoading:`${Ce}--source-loading`,layoutGrid:`${Ce}--grid`,narrowItems:`${Ce}--narrow-items`,loader:`${Ce}__loader`,item:`${Ce}__item`,itemContainer:`${Ce}__item-container`,itemContent:`${Ce}__item-content`,itemTitle:`${Ce}__item-title`,itemTagsContainer:`${Ce}__item-tags-container`,itemThumbnail:`${Ce}__item-thumbnail`,selectedItem:`${Ce}__item--selected`,itemError:`${Ce}__item--error`};var Ae=i(11693),Re=i(35251),Oe=i(76943),ke=i(60682),Ze=i(43955),Pe=i(96704),Fe=i(72638);const Ne=200,De=280,Ve=420;let Ge=class extends d.A{constructor(e,t){super(e,t),this.disabled=!1,this.headingLevel=2,this.iconClass=xe.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new Te,this._focusBasemapItemEnabled=!1,this._container=null,this._width=0,this._onContainerCreated=e=>{this._container=e}}initialize(){this.addHandles([(0,Fe.EV)((()=>this._container),(({contentRect:e})=>{this._width=e.width})),(0,r.z7)((()=>this.source),(()=>this.viewModel.load()),{sync:!0,initial:!0,once:!0})])}loadDependencies(){return(0,Ae.W)({scrim:()=>Promise.all([i.e(2076),i.e(5900)]).then(i.bind(i,15900)),chip:()=>Promise.all([i.e(2076),i.e(8553)]).then(i.bind(i,48553))})}get activeBasemap(){return this.viewModel.activeBasemap}set activeBasemap(e){this.viewModel.activeBasemap=e}get includeCurrentBasemap(){return this.viewModel.includeCurrentBasemap}set includeCurrentBasemap(e){this.viewModel.includeCurrentBasemap=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get source(){return this.viewModel.source}set source(e){this.viewModel.source=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e="loading"===this.source.state,t=this.disabled||"disabled"===this.viewModel.state,i=this.viewModel.items,s={[xe.sourceLoading]:e,[Re.D.disabled]:t},n=this._width;n<=Ne||n>=Ve?s[xe.layoutGrid]=!0:n<De&&(s[xe.narrowItems]=!0);const r=e?(0,Pe.K)("div",{class:xe.loader,key:"loader"}):null,o=e?null:i.length>0?(0,Pe.K)("ul",{"aria-disabled":this.disabled,"aria-label":this.label,bind:this,class:xe.itemContainer,key:"item-container",onkeydown:this._handleKeyDown,role:"radiogroup"},i.map(((e,t)=>this._renderBasemapGalleryItem(e,t))).toArray()):(0,Pe.K)("div",{class:Re.D.empty,key:"empty-message"},(0,Pe.K)(Oe.D,{level:this.headingLevel},this.messages.noBasemaps));return(0,Pe.K)("div",{afterCreate:this._onContainerCreated,class:this.classes(xe.base,Re.D.widget,Re.D.panelHeightOnly,s),key:"container"},0===this._width?null:[r,o])}_getRoundRobinIndex(e,t){return(e+t)%t}_handleKeyDown(e){const{key:t}=e;if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t))return;e.preventDefault();const{items:i,activeBasemapIndex:s}=this.viewModel,n="ArrowUp"===t||"ArrowLeft"===t?this._getRoundRobinIndex(Math.max(s-1,-1),i.length):this._getRoundRobinIndex(s+1,i.length),r=i.at(n);"ready"===r?.state&&(this.viewModel.activeBasemap=r.basemap),this._focusBasemapItemEnabled=!0}_focusBasemapItem(e){this._focusBasemapItemEnabled&&0===e.tabIndex&&(e.focus(),this._focusBasemapItemEnabled=!1)}_handleClick(e){const t=e.currentTarget["data-item"];"ready"===t.state&&(this.viewModel.activeBasemap=t.basemap)}_renderBasemapGalleryItem(e,t){const i=(0,c.hA)(e.basemap)||(0,n.s)("esri/themes/base/images/basemap-toggle-64.svg"),s=e.basemap.title,r=e.basemap.portalItem?.snippet,o=e.error?.message||r||s,{viewModel:{state:a,activeBasemapIndex:l}}=this,d=this.disabled||"disabled"===a,u=l===t,h=u||-1===l&&0===t?0:-1,p="loading"===a,y={[xe.selectedItem]:u,[xe.itemError]:"error"===e.state},g=`basemapgallery-item-${e.uid}`;return(0,Pe.K)("li",{afterUpdate:this._focusBasemapItem,"aria-checked":u.toString(),"aria-disabled":d.toString(),"aria-labelledby":g,bind:this,class:this.classes(xe.item,y),"data-item":e,key:e.uid,onclick:this._handleClick,onkeydown:this._handleClick,role:"radio",tabIndex:h,title:o},(0,Pe.K)("img",{alt:"",class:xe.itemThumbnail,src:i}),(0,Pe.K)("div",{class:xe.itemContent,key:"content"},(0,Pe.K)("div",{class:xe.itemTitle,key:"title"},(0,Pe.K)("span",{id:g},s)),(0,c.$P)(e.basemap)?this._renderTags(e.basemap):null),"loading"===e.state||u&&p?(0,Pe.K)("calcite-scrim",null,(0,Pe.K)("span",{"aria-hidden":"true",class:Re.D.loaderAnimation,key:"loader",role:"presentation"})):null)}_renderTags(e){return(0,Pe.K)("div",{class:xe.itemTagsContainer,key:"tag"},this._render3DTag(),(0,c.t5)(e)?this._renderBetaTag():null)}_render3DTag(){const{messages:e}=this;return(0,Pe.K)("calcite-chip",{key:"tag-3d",scale:"s",value:e.tag3D},this.messages.tag3D)}_renderBetaTag(){const{messages:e}=this;return(0,Pe.K)("calcite-chip",{appearance:"outline-fill",key:"tag-beta",scale:"s",value:e.tagBeta},this.messages.tagBeta)}};(0,s._)([(0,o.MZ)()],Ge.prototype,"activeBasemap",null),(0,s._)([(0,o.MZ)()],Ge.prototype,"disabled",void 0),(0,s._)([(0,o.MZ)()],Ge.prototype,"headingLevel",void 0),(0,s._)([(0,o.MZ)()],Ge.prototype,"iconClass",void 0),(0,s._)([(0,o.MZ)()],Ge.prototype,"icon",void 0),(0,s._)([(0,o.MZ)()],Ge.prototype,"label",null),(0,s._)([(0,o.MZ)(),(0,Ze.G)("esri/widgets/BasemapGallery/t9n/BasemapGallery")],Ge.prototype,"messages",void 0),(0,s._)([(0,o.MZ)()],Ge.prototype,"source",null),(0,s._)([(0,o.MZ)()],Ge.prototype,"view",null),(0,s._)([(0,o.MZ)()],Ge.prototype,"viewModel",void 0),(0,s._)([(0,o.MZ)()],Ge.prototype,"_focusBasemapItemEnabled",void 0),(0,s._)([(0,o.MZ)()],Ge.prototype,"_container",void 0),(0,s._)([(0,o.MZ)()],Ge.prototype,"_width",void 0),(0,s._)([(0,ke.$)()],Ge.prototype,"_handleClick",null),Ge=(0,s._)([(0,l.$)("esri.widgets.BasemapGallery")],Ge);const $e=Ge},85798:(e,t,i)=>{i.d(t,{A:()=>w});var s=i(66866),n=i(21564),r=(i(73446),i(85569),i(39831),i(63863)),o=i(46928),a=i(52495),l=i(85251);let c=class extends a.A{constructor(e){super(e),this._viewpointHandle=null,this.group=null}initialize(){this.addHandles((0,l.on)((()=>this.view?.ui),"expand",(e=>{const{target:t}=e;t&&t!==this&&t.expanded&&t.group&&t.group===this.group&&this._collapse()})))}destroy(){this._viewpointHandle=null,this.view=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){const t=!!e;this._set("expanded",t);const i=this.view?.ui;i&&i.emit("expand",{target:this}),this._viewpointHandleChange(t)}get state(){return this.view?.ready?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&(0,l.z7)((()=>e.ready),(()=>{this.view===e&&this._watchViewpoint()}),{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?(0,l.z7)((()=>this.view?.stationary),(()=>this._viewpointHandle?.resume()),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const e="viewpoint";this.removeHandles(e),this._viewpointHandle=null;const{autoCollapse:t,view:i}=this;if(!i||!t)return;const s=(0,l.C1)((()=>"3d"===i.type?i.camera:i.viewpoint),(()=>this._collapse()));this.addHandles(s,e),this._viewpointHandle=s}_collapse(){this.expanded=!1}};(0,s._)([(0,n.MZ)({value:!1})],c.prototype,"autoCollapse",null),(0,s._)([(0,n.MZ)({value:!1})],c.prototype,"expanded",null),(0,s._)([(0,n.MZ)()],c.prototype,"group",void 0),(0,s._)([(0,n.MZ)({readOnly:!0})],c.prototype,"state",null),(0,s._)([(0,n.MZ)({value:null})],c.prototype,"view",null),c=(0,s._)([(0,r.$)("esri.widgets.Expand.ExpandViewModel")],c);const d=c;var u=i(11693),h=i(35251),p=i(2295),y=i(58357),g=i(96704),m=i(43955),f=i(60682);const v="esri-expand",_={base:v,modeAuto:`${v}--auto`,modeDrawer:`${v}--drawer`,modeFloating:`${v}--floating`,container:`${v}__container`,containerExpanded:`${v}__container--expanded`,panel:`${v}__panel`,icon:"esri-collapse__icon",iconExpanded:`${v}__icon--expanded`,iconNumber:`${v}__icon-number`,iconNumberExpanded:`${v}__icon-number--expanded`,content:`${v}__content`,contentExpanded:`${v}__content--expanded`,expandMask:`${v}__mask`,expandMaskExpanded:`${v}__mask--expanded`};let b=class extends o.A{constructor(e,t){super(e,t),this.closeOnEsc=!0,this.collapseIcon=null,this.collapseTooltip="",this.content="",this.expandTooltip="",this.iconClass=null,this.icon=null,this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.viewModel=new d,this._handleKeyDown=e=>{const{closeOnEsc:t,_toggleButtonEl:i,expanded:s}=this;s&&t&&e.target!==i&&"Escape"===e.key&&("function"==typeof t?t(e):t)&&(this.expanded=!1,i?.focus())}}loadDependencies(){return(0,u.W)({icon:()=>Promise.all([i.e(2076),i.e(7509)]).then(i.bind(i,77509))})}get contentId(){return`${this.id}_controls_content`}get expandTitle(){const{expanded:e,messagesCommon:t,collapseTooltip:i,expandTooltip:s}=this;return(e?i||t?.collapse:s||t?.expand)??""}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(e){this.viewModel.autoCollapse=e}get collapseIconClass(){return p.T.collapse}set collapseIconClass(e){this._overrideIfSome("collapseIconClass",e)}get expanded(){return this.viewModel.expanded}set expanded(e){this.viewModel.expanded=e}get expandIconClass(){return(0,y.p4)(this.content)?this.content.iconClass:p.T.expand}set expandIconClass(e){this._overrideIfSome("expandIconClass",e)}get expandIcon(){return(0,y.p4)(this.content)?this.content.icon:void 0}set expandIcon(e){this._overrideIfSome("expandIcon",e)}get group(){return this.viewModel.group}set group(e){this.viewModel.group=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}toggle(){this.viewModel.expanded=!this.viewModel.expanded}render(){const{mode:e}=this,t={[_.modeAuto]:"auto"===e,[_.modeDrawer]:"drawer"===e,[_.modeFloating]:"floating"===e};return(0,g.K)("div",{class:this.classes(_.base,h.D.widget,t),onkeydown:this._handleKeyDown},this._renderMask(),this._renderContainer())}_renderContainer(){const{expanded:e}=this,t={[_.containerExpanded]:e};return(0,g.K)("div",{class:this.classes(_.container,t)},this._renderPanel(),this._renderContent())}_renderMask(){const{expanded:e}=this,t={[_.expandMaskExpanded]:e};return(0,g.K)("div",{bind:this,class:this.classes(_.expandMask,t),onclick:this._toggle})}_renderBadgeNumber(){const{expanded:e,iconNumber:t}=this;return t&&!e?(0,g.K)("span",{class:_.iconNumber,key:"expand__icon-number"},t):null}_renderPanelNumber(){const{iconNumber:e,expanded:t}=this;return e&&t?(0,g.K)("span",{class:this.classes(_.iconNumber,_.iconNumberExpanded),key:"expand__expand-icon-number"},e):null}_renderIcon(){const e=(this.expanded?this.collapseIcon:this.expandIcon)??"";return(0,g.K)("calcite-icon",{icon:e,key:"icon",scale:"s"})}_renderLegacyIcon(){const{collapseIconClass:e,expandIconClass:t,expanded:i}=this,s={[_.iconExpanded]:i};return null!=t&&(s[t]=!i),null!=e&&(s[e]=e===t||i),(0,g.K)("span",{"aria-hidden":"true",class:this.classes(_.icon,s),key:"legacy-icon"})}_renderTitle(){return(0,g.K)("span",{class:p.T.fontFallbackText},this.expandTitle)}_renderExpandButton(){const{expanded:e,expandTitle:t,expandIcon:i,collapseIcon:s,contentId:n}=this;return(0,g.K)("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":n,"aria-expanded":e?"true":"false",bind:this,class:h.D.widgetButton,onclick:this._toggle,onkeydown:this._toggle,role:"button",tabIndex:0,title:t},this._renderBadgeNumber(),!e&&null!=i||e&&null!=s?this._renderIcon():this._renderLegacyIcon(),this._renderTitle())}_renderPanel(){return(0,g.K)("div",{class:_.panel},this._renderExpandButton(),this._renderPanelNumber())}_renderContent(){const{expanded:e,contentId:t,content:i}=this,s={[_.contentExpanded]:e},n={id:t,role:"region",class:this.classes(_.content,s)};return"string"==typeof i?(0,g.K)("div",{innerHTML:i,key:"content__string",...n}):(0,y.p4)(i)?(0,g.K)("div",{key:"content__widget",...n},i.render()):i instanceof HTMLElement?(0,g.K)("div",{afterCreate:this._attachToNode,bind:i,key:"content__html-element",...n}):(0,y.xk)(i)?(0,g.K)("div",{afterCreate:this._attachToNode,bind:i.domNode,key:"content__node",...n}):null}_toggle(){this.toggle()}_attachToNode(e){e.appendChild(this)}_storeToggleButtonEl(e){this._toggleButtonEl=e}};(0,s._)([(0,n.MZ)({readOnly:!0})],b.prototype,"contentId",null),(0,s._)([(0,n.MZ)({readOnly:!0})],b.prototype,"expandTitle",null),(0,s._)([(0,n.MZ)()],b.prototype,"autoCollapse",null),(0,s._)([(0,n.MZ)()],b.prototype,"closeOnEsc",void 0),(0,s._)([(0,n.MZ)()],b.prototype,"collapseIconClass",null),(0,s._)([(0,n.MZ)()],b.prototype,"collapseIcon",void 0),(0,s._)([(0,n.MZ)()],b.prototype,"collapseTooltip",void 0),(0,s._)([(0,n.MZ)()],b.prototype,"content",void 0),(0,s._)([(0,n.MZ)()],b.prototype,"expanded",null),(0,s._)([(0,n.MZ)()],b.prototype,"expandIconClass",null),(0,s._)([(0,n.MZ)()],b.prototype,"expandIcon",null),(0,s._)([(0,n.MZ)()],b.prototype,"expandTooltip",void 0),(0,s._)([(0,n.MZ)()],b.prototype,"group",null),(0,s._)([(0,n.MZ)()],b.prototype,"iconClass",void 0),(0,s._)([(0,n.MZ)()],b.prototype,"icon",void 0),(0,s._)([(0,n.MZ)()],b.prototype,"iconNumber",void 0),(0,s._)([(0,n.MZ)()],b.prototype,"label",null),(0,s._)([(0,n.MZ)(),(0,m.G)("esri/widgets/Expand/t9n/Expand")],b.prototype,"messages",void 0),(0,s._)([(0,n.MZ)(),(0,m.G)("esri/t9n/common")],b.prototype,"messagesCommon",void 0),(0,s._)([(0,n.MZ)()],b.prototype,"mode",void 0),(0,s._)([(0,n.MZ)()],b.prototype,"view",null),(0,s._)([(0,n.MZ)({type:d})],b.prototype,"viewModel",void 0),(0,s._)([(0,f.$)()],b.prototype,"_toggle",null),b=(0,s._)([(0,r.$)("esri.widgets.Expand")],b);const w=b},78276:(e,t,i)=>{i.d(t,{A:()=>Bt});var s=i(66866),n=i(48982),r=i(64874),o=i(85251),a=i(21564),l=i(4130),c=(i(85569),i(39831),i(63863)),d=i(46928),u=i(67118),h=i(75777),p=i(45937),y=i(11693),g=i(35251),m=i(2295),f=i(60682),v=i(43955),_=i(24611),b=i(96704);i(72638);function w(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function S(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?w(Object(i),!0).forEach((function(t){L(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function L(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function E(){return E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},E.apply(this,arguments)}function I(e,t){if(null==e)return{};var i,s,n=function(e,t){if(null==e)return{};var i,s,n={},r=Object.keys(e);for(s=0;s<r.length;s++)i=r[s],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)i=r[s],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}function T(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var C=T(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),x=T(/Edge/i),A=T(/firefox/i),R=T(/safari/i)&&!T(/chrome/i)&&!T(/android/i),O=T(/iP(ad|od|hone)/i),k=T(/chrome/i)&&T(/android/i),Z={capture:!1,passive:!1};function P(e,t,i){e.addEventListener(t,i,!C&&Z)}function F(e,t,i){e.removeEventListener(t,i,!C&&Z)}function N(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(i){return!1}return!1}}function D(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function V(e,t,i,s){if(e){i=i||document;do{if(null!=t&&(">"===t[0]?e.parentNode===i&&N(e,t):N(e,t))||s&&e===i)return e;if(e===i)break}while(e=D(e))}return null}var G,$=/\s+/g;function B(e,t,i){if(e&&t)if(e.classList)e.classList[i?"add":"remove"](t);else{var s=(" "+e.className+" ").replace($," ").replace(" "+t+" "," ");e.className=(s+(i?" "+t:"")).replace($," ")}}function z(e,t,i){var s=e&&e.style;if(s){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(i=e.currentStyle),void 0===t?i:i[t];t in s||-1!==t.indexOf("webkit")||(t="-webkit-"+t),s[t]=i+("string"==typeof i?"":"px")}}function H(e,t){var i="";if("string"==typeof e)i=e;else do{var s=z(e,"transform");s&&"none"!==s&&(i=s+" "+i)}while(!t&&(e=e.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(i)}function K(e,t,i){if(e){var s=e.getElementsByTagName(t),n=0,r=s.length;if(i)for(;n<r;n++)i(s[n],n);return s}return[]}function j(){var e=document.scrollingElement;return e||document.documentElement}function U(e,t,i,s,n){if(e.getBoundingClientRect||e===window){var r,o,a,l,c,d,u;if(e!==window&&e.parentNode&&e!==j()?(o=(r=e.getBoundingClientRect()).top,a=r.left,l=r.bottom,c=r.right,d=r.height,u=r.width):(o=0,a=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(t||i)&&e!==window&&(n=n||e.parentNode,!C))do{if(n&&n.getBoundingClientRect&&("none"!==z(n,"transform")||i&&"static"!==z(n,"position"))){var h=n.getBoundingClientRect();o-=h.top+parseInt(z(n,"border-top-width")),a-=h.left+parseInt(z(n,"border-left-width")),l=o+r.height,c=a+r.width;break}}while(n=n.parentNode);if(s&&e!==window){var p=H(n||e),y=p&&p.a,g=p&&p.d;p&&(l=(o/=g)+(d/=g),c=(a/=y)+(u/=y))}return{top:o,left:a,bottom:l,right:c,width:u,height:d}}}function q(e){var t=U(e),i=parseInt(z(e,"padding-left")),s=parseInt(z(e,"padding-top")),n=parseInt(z(e,"padding-right")),r=parseInt(z(e,"padding-bottom"));return t.top+=s+parseInt(z(e,"border-top-width")),t.left+=i+parseInt(z(e,"border-left-width")),t.width=e.clientWidth-i-n,t.height=e.clientHeight-s-r,t.bottom=t.top+t.height,t.right=t.left+t.width,t}function W(e,t,i){for(var s=ee(e,!0),n=U(e)[t];s;){var r=U(s)[i];if(!("top"===i||"left"===i?n>=r:n<=r))return s;if(s===j())break;s=ee(s,!1)}return!1}function J(e,t,i,s){for(var n=0,r=0,o=e.children;r<o.length;){if("none"!==o[r].style.display&&o[r]!==nt.ghost&&(s||o[r]!==nt.dragged)&&V(o[r],i.draggable,e,!1)){if(n===t)return o[r];n++}r++}return null}function Y(e,t){for(var i=e.lastElementChild;i&&(i===nt.ghost||"none"===z(i,"display")||t&&!N(i,t));)i=i.previousElementSibling;return i||null}function Q(e,t){var i=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===nt.clone||t&&!N(e,t)||i++;return i}function X(e){var t=0,i=0,s=j();if(e)do{var n=H(e),r=n.a,o=n.d;t+=e.scrollLeft*r,i+=e.scrollTop*o}while(e!==s&&(e=e.parentNode));return[t,i]}function ee(e,t){if(!e||!e.getBoundingClientRect)return j();var i=e,s=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var n=z(i);if(i.clientWidth<i.scrollWidth&&("auto"==n.overflowX||"scroll"==n.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==n.overflowY||"scroll"==n.overflowY)){if(!i.getBoundingClientRect||i===document.body)return j();if(s||t)return i;s=!0}}}while(i=i.parentNode);return j()}function te(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function ie(e,t){return function(){if(!G){var i=arguments;1===i.length?e.call(this,i[0]):e.apply(this,i),G=setTimeout((function(){G=void 0}),t)}}}function se(e,t,i){e.scrollLeft+=t,e.scrollTop+=i}function ne(e){var t=window.Polymer,i=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):i?i(e).clone(!0)[0]:e.cloneNode(!0)}var re="Sortable"+(new Date).getTime();function oe(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==z(e,"display")&&e!==nt.ghost){t.push({target:e,rect:U(e)});var i=S({},t[t.length-1].rect);if(e.thisAnimationDuration){var s=H(e,!0);s&&(i.top-=s.f,i.left-=s.e)}e.fromRect=i}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var i in e)if(e.hasOwnProperty(i))for(var s in t)if(t.hasOwnProperty(s)&&t[s]===e[i][s])return Number(i);return-1}(t,{target:e}),1)},animateAll:function(i){var s=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof i&&i());var n=!1,r=0;t.forEach((function(e){var t=0,i=e.target,o=i.fromRect,a=U(i),l=i.prevFromRect,c=i.prevToRect,d=e.rect,u=H(i,!0);u&&(a.top-=u.f,a.left-=u.e),i.toRect=a,i.thisAnimationDuration&&te(l,a)&&!te(o,a)&&(d.top-a.top)/(d.left-a.left)==(o.top-a.top)/(o.left-a.left)&&(t=function(e,t,i,s){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-i.top,2)+Math.pow(t.left-i.left,2))*s.animation}(d,l,c,s.options)),te(a,o)||(i.prevFromRect=o,i.prevToRect=a,t||(t=s.options.animation),s.animate(i,d,a,t)),t&&(n=!0,r=Math.max(r,t),clearTimeout(i.animationResetTimer),i.animationResetTimer=setTimeout((function(){i.animationTime=0,i.prevFromRect=null,i.fromRect=null,i.prevToRect=null,i.thisAnimationDuration=null}),t),i.thisAnimationDuration=t)})),clearTimeout(e),n?e=setTimeout((function(){"function"==typeof i&&i()}),r):"function"==typeof i&&i(),t=[]},animate:function(e,t,i,s){if(s){z(e,"transition",""),z(e,"transform","");var n=H(this.el),r=n&&n.a,o=n&&n.d,a=(t.left-i.left)/(r||1),l=(t.top-i.top)/(o||1);e.animatingX=!!a,e.animatingY=!!l,z(e,"transform","translate3d("+a+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),z(e,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),z(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){z(e,"transition",""),z(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),s)}}}}var ae=[],le={initializeByDefault:!0},ce={mount:function(e){for(var t in le)le.hasOwnProperty(t)&&!(t in e)&&(e[t]=le[t]);ae.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),ae.push(e)},pluginEvent:function(e,t,i){var s=this;this.eventCanceled=!1,i.cancel=function(){s.eventCanceled=!0};var n=e+"Global";ae.forEach((function(s){t[s.pluginName]&&(t[s.pluginName][n]&&t[s.pluginName][n](S({sortable:t},i)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](S({sortable:t},i)))}))},initializePlugins:function(e,t,i,s){for(var n in ae.forEach((function(s){var n=s.pluginName;if(e.options[n]||s.initializeByDefault){var r=new s(e,t,e.options);r.sortable=e,r.options=e.options,e[n]=r,E(i,r.defaults)}})),e.options)if(e.options.hasOwnProperty(n)){var r=this.modifyOption(e,n,e.options[n]);void 0!==r&&(e.options[n]=r)}},getEventProperties:function(e,t){var i={};return ae.forEach((function(s){"function"==typeof s.eventProperties&&E(i,s.eventProperties.call(t[s.pluginName],e))})),i},modifyOption:function(e,t,i){var s;return ae.forEach((function(n){e[n.pluginName]&&n.optionListeners&&"function"==typeof n.optionListeners[t]&&(s=n.optionListeners[t].call(e[n.pluginName],i))})),s}};function de(e){var t=e.sortable,i=e.rootEl,s=e.name,n=e.targetEl,r=e.cloneEl,o=e.toEl,a=e.fromEl,l=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,u=e.newDraggableIndex,h=e.originalEvent,p=e.putSortable,y=e.extraEventProperties;if(t=t||i&&i[re]){var g,m=t.options,f="on"+s.charAt(0).toUpperCase()+s.substr(1);!window.CustomEvent||C||x?(g=document.createEvent("Event")).initEvent(s,!0,!0):g=new CustomEvent(s,{bubbles:!0,cancelable:!0}),g.to=o||i,g.from=a||i,g.item=n||i,g.clone=r,g.oldIndex=l,g.newIndex=c,g.oldDraggableIndex=d,g.newDraggableIndex=u,g.originalEvent=h,g.pullMode=p?p.lastPutMode:void 0;var v=S(S({},y),ce.getEventProperties(s,t));for(var _ in v)g[_]=v[_];i&&i.dispatchEvent(g),m[f]&&m[f].call(t,g)}}var ue=["evt"],he=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.evt,n=I(i,ue);ce.pluginEvent.bind(nt)(e,t,S({dragEl:ye,parentEl:ge,ghostEl:me,rootEl:fe,nextEl:ve,lastDownEl:_e,cloneEl:be,cloneHidden:we,dragStarted:Ze,putSortable:Te,activeSortable:nt.active,originalEvent:s,oldIndex:Se,oldDraggableIndex:Le,newIndex:Me,newDraggableIndex:Ee,hideGhostForTarget:et,unhideGhostForTarget:tt,cloneNowHidden:function(){we=!0},cloneNowShown:function(){we=!1},dispatchSortableEvent:function(e){pe({sortable:t,name:e,originalEvent:s})}},n))};function pe(e){de(S({putSortable:Te,cloneEl:be,targetEl:ye,rootEl:fe,oldIndex:Se,oldDraggableIndex:Le,newIndex:Me,newDraggableIndex:Ee},e))}var ye,ge,me,fe,ve,_e,be,we,Se,Me,Le,Ee,Ie,Te,Ce,xe,Ae,Re,Oe,ke,Ze,Pe,Fe,Ne,De,Ve=!1,Ge=!1,$e=[],Be=!1,ze=!1,He=[],Ke=!1,je=[],Ue="undefined"!=typeof document,qe=O,We=x||C?"cssFloat":"float",Je=Ue&&!k&&!O&&"draggable"in document.createElement("div"),Ye=function(){if(Ue){if(C)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),Qe=function(e,t){var i=z(e),s=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),n=J(e,0,t),r=J(e,1,t),o=n&&z(n),a=r&&z(r),l=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+U(n).width,c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+U(r).width;if("flex"===i.display)return"column"===i.flexDirection||"column-reverse"===i.flexDirection?"vertical":"horizontal";if("grid"===i.display)return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&o.float&&"none"!==o.float){var d="left"===o.float?"left":"right";return!r||"both"!==a.clear&&a.clear!==d?"horizontal":"vertical"}return n&&("block"===o.display||"flex"===o.display||"table"===o.display||"grid"===o.display||l>=s&&"none"===i[We]||r&&"none"===i[We]&&l+c>s)?"vertical":"horizontal"},Xe=function(e){function t(e,i){return function(s,n,r,o){var a=s.options.group.name&&n.options.group.name&&s.options.group.name===n.options.group.name;if(null==e&&(i||a))return!0;if(null==e||!1===e)return!1;if(i&&"clone"===e)return e;if("function"==typeof e)return t(e(s,n,r,o),i)(s,n,r,o);var l=(i?s:n).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var i={},s=e.group;s&&"object"==M(s)||(s={name:s}),i.name=s.name,i.checkPull=t(s.pull,!0),i.checkPut=t(s.put),i.revertClone=s.revertClone,e.group=i},et=function(){!Ye&&me&&z(me,"display","none")},tt=function(){!Ye&&me&&z(me,"display","")};Ue&&!k&&document.addEventListener("click",(function(e){if(Ge)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),Ge=!1,!1}),!0);var it=function(e){if(ye){var t=function(e,t){var i;return $e.some((function(s){var n=s[re].options.emptyInsertThreshold;if(n&&!Y(s)){var r=U(s),o=e>=r.left-n&&e<=r.right+n,a=t>=r.top-n&&t<=r.bottom+n;return o&&a?i=s:void 0}})),i}((e=e.touches?e.touches[0]:e).clientX,e.clientY);if(t){var i={};for(var s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);i.target=i.rootEl=t,i.preventDefault=void 0,i.stopPropagation=void 0,t[re]._onDragOver(i)}}},st=function(e){ye&&ye.parentNode[re]._isOutsideThisEl(e.target)};function nt(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=E({},t),e[re]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Qe(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==nt.supportPointer&&"PointerEvent"in window&&!R,emptyInsertThreshold:5};for(var s in ce.initializePlugins(this,e,i),i)!(s in t)&&(t[s]=i[s]);for(var n in Xe(t),this)"_"===n.charAt(0)&&"function"==typeof this[n]&&(this[n]=this[n].bind(this));this.nativeDraggable=!t.forceFallback&&Je,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?P(e,"pointerdown",this._onTapStart):(P(e,"mousedown",this._onTapStart),P(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(P(e,"dragover",this),P(e,"dragenter",this)),$e.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),E(this,oe())}function rt(e,t,i,s,n,r,o,a){var l,c,d=e[re],u=d.options.onMove;return!window.CustomEvent||C||x?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=i,l.draggedRect=s,l.related=n||t,l.relatedRect=r||U(t),l.willInsertAfter=a,l.originalEvent=o,e.dispatchEvent(l),u&&(c=u.call(d,l,o)),c}function ot(e){e.draggable=!1}function at(){Ke=!1}function lt(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,i=t.length,s=0;i--;)s+=t.charCodeAt(i);return s.toString(36)}function ct(e){return setTimeout(e,0)}function dt(e){return clearTimeout(e)}nt.prototype={constructor:nt,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(Pe=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,ye):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,i=this.el,s=this.options,n=s.preventOnFilter,r=e.type,o=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,a=(o||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||a,c=s.filter;if(function(e){je.length=0;var t=e.getElementsByTagName("input"),i=t.length;for(;i--;){var s=t[i];s.checked&&je.push(s)}}(i),!ye&&!(/mousedown|pointerdown/.test(r)&&0!==e.button||s.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!R||!a||"SELECT"!==a.tagName.toUpperCase())&&!((a=V(a,s.draggable,i,!1))&&a.animated||_e===a)){if(Se=Q(a),Le=Q(a,s.draggable),"function"==typeof c){if(c.call(this,e,a,this))return pe({sortable:t,rootEl:l,name:"filter",targetEl:a,toEl:i,fromEl:i}),he("filter",t,{evt:e}),void(n&&e.cancelable&&e.preventDefault())}else if(c&&(c=c.split(",").some((function(s){if(s=V(l,s.trim(),i,!1))return pe({sortable:t,rootEl:s,name:"filter",targetEl:a,fromEl:i,toEl:i}),he("filter",t,{evt:e}),!0}))))return void(n&&e.cancelable&&e.preventDefault());s.handle&&!V(l,s.handle,i,!1)||this._prepareDragStart(e,o,a)}}},_prepareDragStart:function(e,t,i){var s,n=this,r=n.el,o=n.options,a=r.ownerDocument;if(i&&!ye&&i.parentNode===r){var l=U(i);if(fe=r,ge=(ye=i).parentNode,ve=ye.nextSibling,_e=i,Ie=o.group,nt.dragged=ye,Ce={target:ye,clientX:(t||e).clientX,clientY:(t||e).clientY},Oe=Ce.clientX-l.left,ke=Ce.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,ye.style["will-change"]="all",s=function(){he("delayEnded",n,{evt:e}),nt.eventCanceled?n._onDrop():(n._disableDelayedDragEvents(),!A&&n.nativeDraggable&&(ye.draggable=!0),n._triggerDragStart(e,t),pe({sortable:n,name:"choose",originalEvent:e}),B(ye,o.chosenClass,!0))},o.ignore.split(",").forEach((function(e){K(ye,e.trim(),ot)})),P(a,"dragover",it),P(a,"mousemove",it),P(a,"touchmove",it),P(a,"mouseup",n._onDrop),P(a,"touchend",n._onDrop),P(a,"touchcancel",n._onDrop),A&&this.nativeDraggable&&(this.options.touchStartThreshold=4,ye.draggable=!0),he("delayStart",this,{evt:e}),!o.delay||o.delayOnTouchOnly&&!t||this.nativeDraggable&&(x||C))s();else{if(nt.eventCanceled)return void this._onDrop();P(a,"mouseup",n._disableDelayedDrag),P(a,"touchend",n._disableDelayedDrag),P(a,"touchcancel",n._disableDelayedDrag),P(a,"mousemove",n._delayedDragTouchMoveHandler),P(a,"touchmove",n._delayedDragTouchMoveHandler),o.supportPointer&&P(a,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(s,o.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){ye&&ot(ye),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;F(e,"mouseup",this._disableDelayedDrag),F(e,"touchend",this._disableDelayedDrag),F(e,"touchcancel",this._disableDelayedDrag),F(e,"mousemove",this._delayedDragTouchMoveHandler),F(e,"touchmove",this._delayedDragTouchMoveHandler),F(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?P(document,"pointermove",this._onTouchMove):P(document,t?"touchmove":"mousemove",this._onTouchMove):(P(ye,"dragend",this),P(fe,"dragstart",this._onDragStart));try{document.selection?ct((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(i){}},_dragStarted:function(e,t){if(Ve=!1,fe&&ye){he("dragStarted",this,{evt:t}),this.nativeDraggable&&P(document,"dragover",st);var i=this.options;!e&&B(ye,i.dragClass,!1),B(ye,i.ghostClass,!0),nt.active=this,e&&this._appendGhost(),pe({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(xe){this._lastX=xe.clientX,this._lastY=xe.clientY,et();for(var e=document.elementFromPoint(xe.clientX,xe.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(xe.clientX,xe.clientY))!==t;)t=e;if(ye.parentNode[re]._isOutsideThisEl(e),t)do{if(t[re]){if(t[re]._onDragOver({clientX:xe.clientX,clientY:xe.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);tt()}},_onTouchMove:function(e){if(Ce){var t=this.options,i=t.fallbackTolerance,s=t.fallbackOffset,n=e.touches?e.touches[0]:e,r=me&&H(me,!0),o=me&&r&&r.a,a=me&&r&&r.d,l=qe&&De&&X(De),c=(n.clientX-Ce.clientX+s.x)/(o||1)+(l?l[0]-He[0]:0)/(o||1),d=(n.clientY-Ce.clientY+s.y)/(a||1)+(l?l[1]-He[1]:0)/(a||1);if(!nt.active&&!Ve){if(i&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<i)return;this._onDragStart(e,!0)}if(me){r?(r.e+=c-(Ae||0),r.f+=d-(Re||0)):r={a:1,b:0,c:0,d:1,e:c,f:d};var u="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");z(me,"webkitTransform",u),z(me,"mozTransform",u),z(me,"msTransform",u),z(me,"transform",u),Ae=c,Re=d,xe=n}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!me){var e=this.options.fallbackOnBody?document.body:fe,t=U(ye,!0,qe,!0,e),i=this.options;if(qe){for(De=e;"static"===z(De,"position")&&"none"===z(De,"transform")&&De!==document;)De=De.parentNode;De!==document.body&&De!==document.documentElement?(De===document&&(De=j()),t.top+=De.scrollTop,t.left+=De.scrollLeft):De=j(),He=X(De)}B(me=ye.cloneNode(!0),i.ghostClass,!1),B(me,i.fallbackClass,!0),B(me,i.dragClass,!0),z(me,"transition",""),z(me,"transform",""),z(me,"box-sizing","border-box"),z(me,"margin",0),z(me,"top",t.top),z(me,"left",t.left),z(me,"width",t.width),z(me,"height",t.height),z(me,"opacity","0.8"),z(me,"position",qe?"absolute":"fixed"),z(me,"zIndex","100000"),z(me,"pointerEvents","none"),nt.ghost=me,e.appendChild(me),z(me,"transform-origin",Oe/parseInt(me.style.width)*100+"% "+ke/parseInt(me.style.height)*100+"%")}},_onDragStart:function(e,t){var i=this,s=e.dataTransfer,n=i.options;he("dragStart",this,{evt:e}),nt.eventCanceled?this._onDrop():(he("setupClone",this),nt.eventCanceled||((be=ne(ye)).removeAttribute("id"),be.draggable=!1,be.style["will-change"]="",this._hideClone(),B(be,this.options.chosenClass,!1),nt.clone=be),i.cloneId=ct((function(){he("clone",i),nt.eventCanceled||(i.options.removeCloneOnHide||fe.insertBefore(be,ye),i._hideClone(),pe({sortable:i,name:"clone"}))})),!t&&B(ye,n.dragClass,!0),t?(Ge=!0,i._loopId=setInterval(i._emulateDragOver,50)):(F(document,"mouseup",i._onDrop),F(document,"touchend",i._onDrop),F(document,"touchcancel",i._onDrop),s&&(s.effectAllowed="move",n.setData&&n.setData.call(i,s,ye)),P(document,"drop",i),z(ye,"transform","translateZ(0)")),Ve=!0,i._dragStartId=ct(i._dragStarted.bind(i,t,e)),P(document,"selectstart",i),Ze=!0,R&&z(document.body,"user-select","none"))},_onDragOver:function(e){var t,i,s,n,r=this.el,o=e.target,a=this.options,l=a.group,c=nt.active,d=Ie===l,u=a.sort,h=Te||c,p=this,y=!1;if(!Ke){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),o=V(o,a.draggable,r,!0),A("dragOver"),nt.eventCanceled)return y;if(ye.contains(e.target)||o.animated&&o.animatingX&&o.animatingY||p._ignoreWhileAnimating===o)return O(!1);if(Ge=!1,c&&!a.disabled&&(d?u||(s=ge!==fe):Te===this||(this.lastPutMode=Ie.checkPull(this,c,ye,e))&&l.checkPut(this,c,ye,e))){if(n="vertical"===this._getDirection(e,o),t=U(ye),A("dragOverValid"),nt.eventCanceled)return y;if(s)return ge=fe,R(),this._hideClone(),A("revert"),nt.eventCanceled||(ve?fe.insertBefore(ye,ve):fe.appendChild(ye)),O(!0);var g=Y(r,a.draggable);if(!g||function(e,t,i){var s=U(Y(i.el,i.options.draggable)),n=q(i.el),r=10;return t?e.clientX>n.right+r||e.clientY>s.bottom&&e.clientX>s.left:e.clientY>n.bottom+r||e.clientX>s.right&&e.clientY>s.top}(e,n,this)&&!g.animated){if(g===ye)return O(!1);if(g&&r===e.target&&(o=g),o&&(i=U(o)),!1!==rt(fe,r,ye,t,o,i,e,!!o))return R(),g&&g.nextSibling?r.insertBefore(ye,g.nextSibling):r.appendChild(ye),ge=r,k(),O(!0)}else if(g&&function(e,t,i){var s=U(J(i.el,0,i.options,!0)),n=q(i.el),r=10;return t?e.clientX<n.left-r||e.clientY<s.top&&e.clientX<s.right:e.clientY<n.top-r||e.clientY<s.bottom&&e.clientX<s.left}(e,n,this)){var m=J(r,0,a,!0);if(m===ye)return O(!1);if(i=U(o=m),!1!==rt(fe,r,ye,t,o,i,e,!1))return R(),r.insertBefore(ye,m),ge=r,k(),O(!0)}else if(o.parentNode===r){i=U(o);var f,v,_,b=ye.parentNode!==r,w=!function(e,t,i){var s=i?e.left:e.top,n=i?e.right:e.bottom,r=i?e.width:e.height,o=i?t.left:t.top,a=i?t.right:t.bottom,l=i?t.width:t.height;return s===o||n===a||s+r/2===o+l/2}(ye.animated&&ye.toRect||t,o.animated&&o.toRect||i,n),M=n?"top":"left",L=W(o,"top","top")||W(ye,"top","top"),E=L?L.scrollTop:void 0;if(Pe!==o&&(v=i[M],Be=!1,ze=!w&&a.invertSwap||b),f=function(e,t,i,s,n,r,o,a){var l=s?e.clientY:e.clientX,c=s?i.height:i.width,d=s?i.top:i.left,u=s?i.bottom:i.right,h=!1;if(!o)if(a&&Ne<c*n){if(!Be&&(1===Fe?l>d+c*r/2:l<u-c*r/2)&&(Be=!0),Be)h=!0;else if(1===Fe?l<d+Ne:l>u-Ne)return-Fe}else if(l>d+c*(1-n)/2&&l<u-c*(1-n)/2)return function(e){return Q(ye)<Q(e)?1:-1}(t);if((h=h||o)&&(l<d+c*r/2||l>u-c*r/2))return l>d+c/2?1:-1;return 0}(e,o,i,n,w?1:a.swapThreshold,null==a.invertedSwapThreshold?a.swapThreshold:a.invertedSwapThreshold,ze,Pe===o),0!==f){var I=Q(ye);do{I-=f,_=ge.children[I]}while(_&&("none"===z(_,"display")||_===me))}if(0===f||_===o)return O(!1);Pe=o,Fe=f;var T=o.nextElementSibling,C=!1,x=rt(fe,r,ye,t,o,i,e,C=1===f);if(!1!==x)return 1!==x&&-1!==x||(C=1===x),Ke=!0,setTimeout(at,30),R(),C&&!T?r.appendChild(ye):o.parentNode.insertBefore(ye,C?T:o),L&&se(L,0,E-L.scrollTop),ge=ye.parentNode,void 0===v||ze||(Ne=Math.abs(v-U(o)[M])),k(),O(!0)}if(r.contains(ye))return O(!1)}return!1}function A(a,l){he(a,p,S({evt:e,isOwner:d,axis:n?"vertical":"horizontal",revert:s,dragRect:t,targetRect:i,canSort:u,fromSortable:h,target:o,completed:O,onMove:function(i,s){return rt(fe,r,ye,t,i,U(i),e,s)},changed:k},l))}function R(){A("dragOverAnimationCapture"),p.captureAnimationState(),p!==h&&h.captureAnimationState()}function O(t){return A("dragOverCompleted",{insertion:t}),t&&(d?c._hideClone():c._showClone(p),p!==h&&(B(ye,Te?Te.options.ghostClass:c.options.ghostClass,!1),B(ye,a.ghostClass,!0)),Te!==p&&p!==nt.active?Te=p:p===nt.active&&Te&&(Te=null),h===p&&(p._ignoreWhileAnimating=o),p.animateAll((function(){A("dragOverAnimationComplete"),p._ignoreWhileAnimating=null})),p!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(o===ye&&!ye.animated||o===r&&!o.animated)&&(Pe=null),a.dragoverBubble||e.rootEl||o===document||(ye.parentNode[re]._isOutsideThisEl(e.target),!t&&it(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),y=!0}function k(){Me=Q(ye),Ee=Q(ye,a.draggable),pe({sortable:p,name:"change",toEl:r,newIndex:Me,newDraggableIndex:Ee,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){F(document,"mousemove",this._onTouchMove),F(document,"touchmove",this._onTouchMove),F(document,"pointermove",this._onTouchMove),F(document,"dragover",it),F(document,"mousemove",it),F(document,"touchmove",it)},_offUpEvents:function(){var e=this.el.ownerDocument;F(e,"mouseup",this._onDrop),F(e,"touchend",this._onDrop),F(e,"pointerup",this._onDrop),F(e,"touchcancel",this._onDrop),F(document,"selectstart",this)},_onDrop:function(e){var t=this.el,i=this.options;Me=Q(ye),Ee=Q(ye,i.draggable),he("drop",this,{evt:e}),ge=ye&&ye.parentNode,Me=Q(ye),Ee=Q(ye,i.draggable),nt.eventCanceled||(Ve=!1,ze=!1,Be=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),dt(this.cloneId),dt(this._dragStartId),this.nativeDraggable&&(F(document,"drop",this),F(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),R&&z(document.body,"user-select",""),z(ye,"transform",""),e&&(Ze&&(e.cancelable&&e.preventDefault(),!i.dropBubble&&e.stopPropagation()),me&&me.parentNode&&me.parentNode.removeChild(me),(fe===ge||Te&&"clone"!==Te.lastPutMode)&&be&&be.parentNode&&be.parentNode.removeChild(be),ye&&(this.nativeDraggable&&F(ye,"dragend",this),ot(ye),ye.style["will-change"]="",Ze&&!Ve&&B(ye,Te?Te.options.ghostClass:this.options.ghostClass,!1),B(ye,this.options.chosenClass,!1),pe({sortable:this,name:"unchoose",toEl:ge,newIndex:null,newDraggableIndex:null,originalEvent:e}),fe!==ge?(Me>=0&&(pe({rootEl:ge,name:"add",toEl:ge,fromEl:fe,originalEvent:e}),pe({sortable:this,name:"remove",toEl:ge,originalEvent:e}),pe({rootEl:ge,name:"sort",toEl:ge,fromEl:fe,originalEvent:e}),pe({sortable:this,name:"sort",toEl:ge,originalEvent:e})),Te&&Te.save()):Me!==Se&&Me>=0&&(pe({sortable:this,name:"update",toEl:ge,originalEvent:e}),pe({sortable:this,name:"sort",toEl:ge,originalEvent:e})),nt.active&&(null!=Me&&-1!==Me||(Me=Se,Ee=Le),pe({sortable:this,name:"end",toEl:ge,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){he("nulling",this),fe=ye=ge=me=ve=be=_e=we=Ce=xe=Ze=Me=Ee=Se=Le=Pe=Fe=Te=Ie=nt.dragged=nt.ghost=nt.clone=nt.active=null,je.forEach((function(e){e.checked=!0})),je.length=Ae=Re=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":ye&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],i=this.el.children,s=0,n=i.length,r=this.options;s<n;s++)V(e=i[s],r.draggable,this.el,!1)&&t.push(e.getAttribute(r.dataIdAttr)||lt(e));return t},sort:function(e,t){var i={},s=this.el;this.toArray().forEach((function(e,t){var n=s.children[t];V(n,this.options.draggable,s,!1)&&(i[e]=n)}),this),t&&this.captureAnimationState(),e.forEach((function(e){i[e]&&(s.removeChild(i[e]),s.appendChild(i[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return V(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var i=this.options;if(void 0===t)return i[e];var s=ce.modifyOption(this,e,t);i[e]=void 0!==s?s:t,"group"===e&&Xe(i)},destroy:function(){he("destroy",this);var e=this.el;e[re]=null,F(e,"mousedown",this._onTapStart),F(e,"touchstart",this._onTapStart),F(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(F(e,"dragover",this),F(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),$e.splice($e.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!we){if(he("hideClone",this),nt.eventCanceled)return;z(be,"display","none"),this.options.removeCloneOnHide&&be.parentNode&&be.parentNode.removeChild(be),we=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(we){if(he("showClone",this),nt.eventCanceled)return;ye.parentNode!=fe||this.options.group.revertClone?ve?fe.insertBefore(be,ve):fe.appendChild(be):fe.insertBefore(be,ye),this.options.group.revertClone&&this.animate(ye,be),z(be,"display",""),we=!1}}else this._hideClone()}},Ue&&P(document,"touchmove",(function(e){(nt.active||Ve)&&e.cancelable&&e.preventDefault()})),nt.utils={on:P,off:F,css:z,find:K,is:function(e,t){return!!V(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},throttle:ie,closest:V,toggleClass:B,clone:ne,index:Q,nextTick:ct,cancelNextTick:dt,detectDirection:Qe,getChild:J},nt.get=function(e){return e[re]},nt.mount=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(nt.utils=S(S({},nt.utils),e.utils)),ce.mount(e)}))},nt.create=function(e,t){return new nt(e,t)},nt.version="1.15.1";var ut,ht,pt,yt,gt,mt,ft=[],vt=!1;function _t(){ft.forEach((function(e){clearInterval(e.pid)})),ft=[]}function bt(){clearInterval(mt)}var wt=ie((function(e,t,i,s){if(t.scroll){var n,r=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,a=t.scrollSensitivity,l=t.scrollSpeed,c=j(),d=!1;ht!==i&&(ht=i,_t(),ut=t.scroll,n=t.scrollFn,!0===ut&&(ut=ee(i,!0)));var u=0,h=ut;do{var p=h,y=U(p),g=y.top,m=y.bottom,f=y.left,v=y.right,_=y.width,b=y.height,w=void 0,S=void 0,M=p.scrollWidth,L=p.scrollHeight,E=z(p),I=p.scrollLeft,T=p.scrollTop;p===c?(w=_<M&&("auto"===E.overflowX||"scroll"===E.overflowX||"visible"===E.overflowX),S=b<L&&("auto"===E.overflowY||"scroll"===E.overflowY||"visible"===E.overflowY)):(w=_<M&&("auto"===E.overflowX||"scroll"===E.overflowX),S=b<L&&("auto"===E.overflowY||"scroll"===E.overflowY));var C=w&&(Math.abs(v-r)<=a&&I+_<M)-(Math.abs(f-r)<=a&&!!I),x=S&&(Math.abs(m-o)<=a&&T+b<L)-(Math.abs(g-o)<=a&&!!T);if(!ft[u])for(var A=0;A<=u;A++)ft[A]||(ft[A]={});ft[u].vx==C&&ft[u].vy==x&&ft[u].el===p||(ft[u].el=p,ft[u].vx=C,ft[u].vy=x,clearInterval(ft[u].pid),0==C&&0==x||(d=!0,ft[u].pid=setInterval(function(){s&&0===this.layer&&nt.active._onTouchMove(gt);var t=ft[this.layer].vy?ft[this.layer].vy*l:0,i=ft[this.layer].vx?ft[this.layer].vx*l:0;"function"==typeof n&&"continue"!==n.call(nt.dragged.parentNode[re],i,t,e,gt,ft[this.layer].el)||se(ft[this.layer].el,i,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&h!==c&&(h=ee(h,!1)));vt=d}}),30),St=function(e){var t=e.originalEvent,i=e.putSortable,s=e.dragEl,n=e.activeSortable,r=e.dispatchSortableEvent,o=e.hideGhostForTarget,a=e.unhideGhostForTarget;if(t){var l=i||n;o();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(c.clientX,c.clientY);a(),l&&!l.el.contains(d)&&(r("spill"),this.onSpill({dragEl:s,putSortable:i}))}};function Mt(){}function Lt(){}Mt.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,i=e.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var s=J(this.sortable.el,this.startIndex,this.options);s?this.sortable.el.insertBefore(t,s):this.sortable.el.appendChild(t),this.sortable.animateAll(),i&&i.animateAll()},drop:St},E(Mt,{pluginName:"revertOnSpill"}),Lt.prototype={onSpill:function(e){var t=e.dragEl,i=e.putSortable||this.sortable;i.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),i.animateAll()},drop:St},E(Lt,{pluginName:"removeOnSpill"});nt.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?P(document,"dragover",this._handleAutoScroll):this.options.supportPointer?P(document,"pointermove",this._handleFallbackAutoScroll):t.touches?P(document,"touchmove",this._handleFallbackAutoScroll):P(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?F(document,"dragover",this._handleAutoScroll):(F(document,"pointermove",this._handleFallbackAutoScroll),F(document,"touchmove",this._handleFallbackAutoScroll),F(document,"mousemove",this._handleFallbackAutoScroll)),bt(),_t(),clearTimeout(G),G=void 0},nulling:function(){gt=ht=ut=vt=mt=pt=yt=null,ft.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var i=this,s=(e.touches?e.touches[0]:e).clientX,n=(e.touches?e.touches[0]:e).clientY,r=document.elementFromPoint(s,n);if(gt=e,t||this.options.forceAutoScrollFallback||x||C||R){wt(e,this.options,r,t);var o=ee(r,!0);!vt||mt&&s===pt&&n===yt||(mt&&bt(),mt=setInterval((function(){var r=ee(document.elementFromPoint(s,n),!0);r!==o&&(o=r,_t()),wt(e,i.options,r,t)}),10),pt=s,yt=n)}else{if(!this.options.bubbleScroll||ee(r,!0)===j())return void _t();wt(e,this.options,ee(r,!1),!1)}}},E(e,{pluginName:"scroll",initializeByDefault:!0})}),nt.mount(Lt,Mt);const Et=nt;function It(e,t,i){e.splice(i,0,e.splice(t,1)[0])}const Tt=n.A.ofType(h.A),Ct="data-sort-filter",xt="data-layer-uid",At="esri-layer-list",Rt=`${At}__item`,Ot={base:At,widgetIcon:m.T.layers,newUI:`${At}--new-ui`,noItems:`${At}__no-items`,list:`${At}__list`,listRoot:`${At}__list--root`,listExclusive:`${At}__list--exclusive`,listEmpty:`${At}__list--empty`,listEmptyState:`${At}__list-empty-state`,listEmptyStateDragEnabled:`${At}__list-empty-state--drag-enabled`,listInherited:`${At}__list--inherited`,listIndependent:`${At}__list--independent`,item:Rt,itemContent:`${Rt}-content`,itemMessage:`${Rt}--has-message`,itemInvisible:`${Rt}--invisible`,itemInvisibleAtScale:`${Rt}--invisible-at-scale`,itemChildren:`${Rt}--has-children`,itemSelectable:`${Rt}--selectable`,itemContainer:`${Rt}-container`,actionsMenu:`${Rt}-actions-menu`,actionsMenuItem:`${Rt}-actions-menu-item`,actionsMenuItemActive:`${Rt}-actions-menu-item--active`,actions:`${Rt}-actions`,actionsList:`${Rt}-actions-list`,action:`${Rt}-action`,actionIcon:`${Rt}-action-icon`,actionImage:`${Rt}-action-image`,actionTitle:`${Rt}-action-title`,actionToggle:`${At}__action-toggle`,actionToggleOn:`${At}__action-toggle--on`,label:`${Rt}-label`,message:`${Rt}-message`,title:`${Rt}-title`,statusIndicator:`${At}__status-indicator`,publishing:`${At}__publishing`,updating:`${At}__updating`,connectionStatus:`${At}__connection-status`,connectionStatusConnected:`${At}__connection-status--connected`,toggleVisible:`${Rt}-toggle`,toggleVisibleIcon:`${Rt}-toggle-icon`,toggleIcon:`${Rt}-toggle-icon`,radioIcon:`${Rt}-radio-icon`,childToggle:`${At}__child-toggle`,childToggleOpen:`${At}__child-toggle--open`,childOpened:`${At}__child-toggle-icon--opened`,childClosed:`${At}__child-toggle-icon--closed`,childClosed_RTL:`${At}__child-toggle-icon--closed-rtl`,sortableChosen:`${At}--chosen`},kt="actions",Zt="action-section",Pt="items",Ft={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function Nt(e){const{actionsOpen:t,children:i}=e;t&&(e.actionsOpen=!1),i.forEach((e=>Nt(e)))}const Dt="root",Vt={statusIndicators:!0,errors:!1};let Gt=class extends d.A{constructor(e,t){super(e,t),this._sortableNodes=new Map,this._sortableMap=new Map,this._focusSortUid=null,this._tooltipReferenceMap=new Map,this.visibleItems=null,this.iconClass=Ot.widgetIcon,this.icon=null,this.listItemCanGiveFunction=null,this.listItemCanReceiveFunction=null,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.selectionEnabled=!1,this.selectedItems=new Tt,this.style="classic",this.viewModel=new u.A,this.visibleElements={...Vt},this._onSortableSort=({to:e,from:t,item:i,newIndex:s})=>{t&&e&&(t===e?this._sortLayers(this._sortableMap.get(t.dataset.group)):this._moveLayerFromChildList({to:e,from:t,item:i,newIndex:s}))},this._sortableCanSort=(e,t)=>!(!e.el.dataset.group||!t.el.dataset.group),this._sortableCanPull=(e,t,i)=>{const{listItemCanGiveFunction:s}=this,n={selected:$t(i),from:$t(t.el),to:$t(e.el)};return!this._sortableCanSort(e,t)||"function"!=typeof s||s.call(null,n)},this._sortableCanPut=(e,t,i)=>{const{listItemCanReceiveFunction:s}=this,n={selected:$t(i),from:$t(t.el),to:$t(e.el)};return!this._sortableCanSort(e,t)||"function"!=typeof s||s.call(null,n)},this._onSortableEnd=({oldIndex:e,from:t,to:i,item:s})=>{t!==i&&t.insertBefore(s,t.children[e])}}initialize(){const e=this.operationalItems;this._setVisibleItems(e),this.addHandles([(0,o.on)((()=>this.operationalItems),"change",(()=>this._itemsChanged(e))),(0,o.wB)((()=>this.visibleElements),(()=>this._itemsChanged(e))),(0,o.wB)((()=>this.selectionEnabled),(()=>this._toggleAllSorting()),o.Vh)])}loadDependencies(){return(0,y.W)({icon:()=>Promise.all([i.e(2076),i.e(7509)]).then(i.bind(i,77509)),tooltip:()=>Promise.all([i.e(2076),i.e(9073),i.e(4245)]).then(i.bind(i,46626))})}destroy(){this._destroySortables(),this._tooltipReferenceMap.clear()}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(e){this.viewModel.listItemCreatedFunction=e}get operationalItems(){return this.viewModel.operationalItems}set operationalItems(e){this.viewModel.operationalItems=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...Vt,...e}}triggerAction(e,t){return this.viewModel.triggerAction(e,t)}render(){const{visibleItems:e,style:t}=this,i=this.viewModel?.state,s={[Ot.newUI]:"modern"===t,[g.D.hidden]:"loading"===i,[g.D.disabled]:"disabled"===i},n=this._renderItemTooltips(),r=this._renderItems();return(0,b.K)("div",{class:this.classes(Ot.base,g.D.widget,g.D.panel,s)},e.length?[n,r]:this._renderNoItems())}_renderItemTooltip(e){const{_tooltipReferenceMap:t,messages:i}=this;return e?(0,b.K)("calcite-tooltip",{referenceElement:t.get(e.uid)},i.layerIncompatibleTooltip):null}_renderItemTooltipNodes(e){const{incompatible:t,children:i}=e;return[t?this._renderItemTooltip(e):null,...!t&&i?i.toArray().map((e=>this._renderItemTooltipNodes(e))):[]]}_renderItemTooltips(){return this.visibleItems.toArray().map((e=>this._renderItemTooltipNodes(e)))??[]}_renderNoItems(){return(0,b.K)("div",{class:Ot.noItems},this.messages.noItemsToDisplay)}_renderItems(){const{visibleItems:e,selectionEnabled:t,messages:i}=this;return(0,b.K)("ul",{afterCreate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,afterUpdate:this._sortNodeCreated,"aria-label":i.widgetLabel,bind:this,class:this.classes(Ot.list,Ot.listRoot,Ot.listIndependent),"data-group":Dt,role:t?"listbox":void 0},e.map((e=>this._renderItem(e,null))).toArray())}_renderActionsMenuIcon(e,t){const{messagesCommon:i}=this,s={[Ot.actionsMenuItemActive]:e.actionsOpen};return(0,b.K)("div",{"aria-controls":t,"aria-label":i.options,bind:this,class:this.classes(Ot.actionsMenuItem,s),"data-item":e,key:"actions-menu-toggle",onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,role:"button",tabIndex:0,title:i.options},(0,b.K)("span",{"aria-hidden":"true",class:m.T.handleHorizontal}))}_renderActionsMenu(e,t,i,s){const{panel:n}=e,r=n&&n.visible?this._renderPanelButton(n):null,o=1===i&&this._getSingleActionButton(t),a=o?this._renderAction({item:e,action:o,singleAction:!0}):null,l=!o&&i?this._renderActionsMenuIcon(e,s):null;return l||r||o?(0,b.K)("div",{class:Ot.actionsMenu,key:"actions-menu"},r,a,l):null}_renderChildList(e,t){const{selectionEnabled:i}=this,{visibilityMode:s,children:n}=e,r=this._hasChildren(e),o=!r&&i&&"group"===e.layer?.type,{exclusive:a,inherited:l}=Ft,c={[Ot.listEmpty]:!r,[Ot.listExclusive]:s===a,[Ot.listInherited]:s===l,[Ot.listIndependent]:s!==l&&s!==a},d={[Ot.listEmptyState]:!0,[Ot.listEmptyStateDragEnabled]:i};return r||o?r?(0,b.K)("ul",{afterCreate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,afterUpdate:this._sortNodeCreated,"aria-expanded":e.open?"true":"false",bind:this,class:this.classes(Ot.list,c),"data-group":e.uid,"data-item":e,hidden:!e.open&&!o||null,id:t,key:"list-items",role:i?"listbox":s===a?"radiogroup":"group"},n?.map((t=>this._renderItem(t,e))).toArray()):(0,b.K)("div",{afterCreate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,afterUpdate:this._sortNodeCreated,bind:this,class:this.classes(d),"data-group":e.uid,"data-item":e,id:t,key:"list-items"},this.messages.noItemsToDisplay):null}_renderChildrenToggle(e,t){const{messagesCommon:i}=this,s=this._hasChildren(e),n={[Ot.childToggleOpen]:e.open},r=e.open?i.collapse:i.expand;return s?(0,b.K)("span",{"aria-controls":t,"aria-label":r,class:this.classes(Ot.childToggle,n),"data-item":e,key:"toggle-children",onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,role:"button",tabIndex:0,title:r},(0,b.K)("span",{"aria-hidden":"true",class:this.classes(Ot.childClosed,m.T.rightTriangleArrow)}),(0,b.K)("span",{"aria-hidden":"true",class:this.classes(Ot.childOpened,m.T.downArrow)}),(0,b.K)("span",{"aria-hidden":"true",class:this.classes(Ot.childClosed_RTL,m.T.leftTriangleArrow)})):null}_renderItemMessage(e){return e.error?(0,b.K)("div",{class:Ot.message,key:"esri-layer-list__error",role:"alert"},(0,b.K)("span",{"aria-hidden":"true",class:m.T.noticeTriangle}),this.messages.layerError):e.incompatible?(0,b.K)("div",{class:Ot.message,key:"esri-layer-list__incompatible",role:"alert"},(0,b.K)("span",{afterCreate:t=>this._setTooltipReference(t,e),"aria-hidden":"true",bind:this,class:m.T.noticeTriangle,tabIndex:0}),this.messages.layerIncompatible):null}_renderItemContent(e,t,i){const{id:s}=this,n=`${s}_${e.uid}`,r=`${n}_actions`,o=`${n}__list`,{panel:a}=e,l=this._filterActions(e.actionsSections),c=this._countActions(l);return[(0,b.K)("div",{class:Ot.itemContainer,key:"list-item-container"},this._renderChildrenToggle(e,o),this._renderLabel(e,t,i),this._renderActionsMenu(e,l,c,r)),this._renderItemMessage(e),c?this._renderActionsSections(e,l,r):null,a&&a.open&&!a.disabled?a.render():null,this._renderChildList(e,o)]}_renderItem(e,t){const{style:i,id:s,selectionEnabled:n,selectedItems:r}=this,o=`${s}_${e.uid}__title`,a=this._hasMessage(e),l=this._hasChildren(e),c={[Ot.itemChildren]:l,[Ot.itemMessage]:!!a,[Ot.itemInvisible]:"modern"===i&&!e.visible,[Ot.itemInvisibleAtScale]:!e.visibleAtCurrentScale,[Ot.itemSelectable]:n};if(n){const i={[xt]:e.layer?.uid,[Ct]:(!e.sortable).toString()};return(0,b.K)("li",{afterCreate:this._focusListItem,afterUpdate:this._focusListItem,"aria-labelledby":o,"aria-selected":(0,p.m)(e,r)?"true":"false",bind:this,class:this.classes(Ot.item,c),"data-group":t?t.uid:Dt,"data-item":e,key:`item-with-selection-${e.uid}`,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,role:"option",tabIndex:0,...i},this._renderItemContent(e,t,o))}return(0,b.K)("li",{afterCreate:this._focusListItem,afterUpdate:this._focusListItem,"aria-labelledby":o,bind:this,class:this.classes(Ot.item,c),key:`item-no-selection-${e.uid}`},this._renderItemContent(e,t,o))}_renderConnectionIcon(e){const{connectionStatus:t}=e;return null!=t?(0,b.K)("calcite-icon",{icon:"connected"===t?"beacon":"offline",scale:"s"}):null}_renderItemStatus(e,t){const{visibleElements:i}=this;if(!i.statusIndicators)return null;const{connectionStatus:s,publishing:n,updating:r}=e,o=r&&!t,a=!!s;return(0,b.K)("span",{class:this.classes({[Ot.statusIndicator]:!0,[Ot.publishing]:n,[Ot.updating]:o,[Ot.connectionStatus]:a,[Ot.connectionStatusConnected]:a&&"connected"===s}),key:"layer-item-status"},this._renderConnectionIcon(e))}_renderItemTitle(e,t){const{messages:i}=this;if(!e)return null;const s=e.title||i.untitledLayer,n=e.visibleAtCurrentScale?s:`${s} (${i.layerInvisibleAtScale})`;return(0,b.K)("span",{"aria-label":n,class:Ot.title,id:t,key:"layer-title-container",title:n},s)}_renderItemToggleIcon({visible:e},t){const{style:i}=this,{exclusive:s}=Ft,n=t?.visibilityMode,r="modern"===i,o=n===s,a={[Ot.toggleVisibleIcon]:r,[Ot.toggleIcon]:r&&!o,[Ot.radioIcon]:r&&o,[m.T.radioChecked]:o&&e,[m.T.radioUnchecked]:o&&!e,[m.T.visible]:!o&&e,[m.T.nonVisible]:!o&&!e};return(0,b.K)("span",{"aria-hidden":"true",class:this.classes(a),key:"item-toggle-icon"})}_renderItemToggle(e,t,i){const{selectionEnabled:s,messages:n}=this,{exclusive:r}=Ft,o=t?.visibilityMode,a=o===r?"radio":"switch";return(0,b.K)("span",s?{"aria-checked":e.visible?"true":"false","aria-labelledby":i,bind:this,class:Ot.toggleVisible,"data-item":e,"data-parent-visibility":o,key:"item-toggle-selection-enabled",onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,role:a,tabIndex:0,title:n.layerVisibility}:{class:Ot.toggleVisible,key:"item-toggle"},this._renderItemToggleIcon(e,t))}_renderLabel(e,t,i){const{selectionEnabled:s,style:n,messages:r}=this,{inherited:o,exclusive:a}=Ft,l=t?.visibilityMode,c=l===a?"radio":"switch",d=this._renderItemTitle(e,i),u=this._renderItemStatus(e,t),h=this._renderItemToggle(e,t,i),p="modern"===n?[d,u,h]:[h,d,u],y=(0,b.K)("div",s?{class:Ot.label,key:`item-label-no-selection-${e.uid}`}:{"aria-checked":e.visible?"true":"false","aria-labelledby":i,bind:this,class:Ot.label,"data-item":e,"data-parent-visibility":l,key:`item-label-with-selection-${e.uid}`,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,role:c,tabIndex:0,title:r.layerVisibility},p);return l===o||e.error?(0,b.K)("div",{class:Ot.label,key:`item-label-container-${e.uid}`},this._renderItemTitle(e,i),this._renderItemStatus(e,t)):y}_renderPanelButton(e){const{className:t,open:i,title:s,image:n,disabled:r}=e,o=n||t?t:m.T.defaultAction,a=this._getIconImageStyles(e),l={[Ot.actionsMenuItemActive]:i&&!r},c={[Ot.actionImage]:!!a["background-image"],[g.D.disabledElement]:e.disabled};return o&&(c[o]=!!o),(0,b.K)("div",{"aria-disabled":e.disabled.toString(),"aria-label":s,bind:this,class:this.classes(Ot.actionsMenuItem,l),"data-panel":e,key:`panel-${e.uid}`,onclick:this._triggerPanel,onkeydown:this._triggerPanel,role:"button",tabIndex:e.disabled?void 0:0,title:s},(0,b.K)("span",{class:this.classes(c),styles:a}))}_renderActionsSections(e,t,i){const s=t.toArray().map(((t,i)=>(0,b.K)("ul",{class:Ot.actionsList,key:`${e}-action-section-${i}`},this._renderActionSection(e,t))));return(0,b.K)("div",{"aria-expanded":e.actionsOpen?"true":"false",class:Ot.actions,hidden:!e.actionsOpen||null,id:i,key:"actions-section",role:"group"},s)}_renderActionSection(e,t){return(t&&t.toArray()).map((t=>this._renderAction({item:e,action:t})))}_renderActionIcon(e){const{active:t,className:i}=e,s=this._getIconImageStyles(e),n="button"!==e.type||e.image||i?i:m.T.defaultAction,r={[Ot.actionImage]:!t&&!!s["background-image"],[m.T.loadingIndicator]:t,[g.D.rotating]:t};return n&&!t&&(r[n]=!0),(0,b.K)("span",{"aria-hidden":"true",class:this.classes(Ot.actionIcon,r),key:"action-icon",styles:s})}_renderActionTitle(e,t){return t?null:(0,b.K)("span",{class:Ot.actionTitle,key:"action-title"},e)}_renderAction(e){const{item:t,action:i,singleAction:s}=e,{active:n,disabled:r,title:o}=i,a={[Ot.actionsMenuItem]:s&&"button"===i.type,[Ot.action]:n||!s&&"toggle"!==i.type,[Ot.actionToggle]:!n&&"toggle"===i.type,[Ot.actionToggleOn]:!n&&"toggle"===i.type&&i.value,[g.D.disabledElement]:r},l=[this._renderActionIcon(i),this._renderActionTitle(o,s)];return s?(0,b.K)("div",{"aria-label":o??void 0,bind:this,classes:a,"data-action":i,"data-item":t,key:`single-action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:0,title:o??void 0},l):(0,b.K)("li",{"aria-label":o??void 0,bind:this,classes:a,"data-action":i,"data-item":t,key:`action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:0,title:o??void 0},l)}_setTooltipReference(e,t){this._tooltipReferenceMap.set(t.uid,e),this.scheduleRender()}_hasMessage(e){return!!e.error||e.incompatible}_hasChildren(e){return!!e.children.length&&!this._hasMessage(e)}_sortNodeRemoved(e){const{_sortableMap:t}=this,i=e.dataset.group,s=t.get(i);s&&s.destroy(),t.delete(i)}_destroySortables(){const{_sortableMap:e,_sortableNodes:t}=this;e.forEach((e=>e&&e.destroy())),e.clear(),t.clear()}_moveLayerFromChildList({to:e,from:t,item:i,newIndex:s}){const n=$t(i),r=$t(e),o=$t(t);this.viewModel.moveListItem(n,o,r,s)}_sortLayers(e){if(!e)return;const t=$t(e.el),i=e.toArray();t?(0,p.kL)(t,i):(0,p.mk)(this.view?.map?.layers,i)}_toggleSorting(e,t){const{_sortableMap:i,selectionEnabled:s}=this,n=i.get(t),r=$t(e),o=(t===Dt||r?.childrenSortable&&(0,p.dL)(r))&&s;if(n)n.option("disabled",!o);else if(o){const s=Et.create(e,{dataIdAttr:xt,group:{name:t,pull:this._sortableCanPull,put:this._sortableCanPut},filter:`[${Ct}="true"]`,fallbackTolerance:4,onSort:this._onSortableSort,onEnd:this._onSortableEnd,disabled:!o,chosenClass:Ot.sortableChosen});i.set(t,s)}}_toggleAllSorting(){this._sortableNodes.forEach(((e,t)=>this._toggleSorting(e,t)))}_sortNodeCreated(e){const t=e.dataset.group;t&&(this._sortableNodes.set(t,e),this._toggleSorting(e,t))}_setVisibleItems(e){this.visibleItems=e.filter((e=>!e.hidden&&(this.visibleElements.errors||!e.error)))}_getSingleActionButton(e){return e.reduce((e=>e)).filter((e=>e&&"button"===e.type)).at(0)}_focusListItem(e){const{_focusSortUid:t}=this;if(!e||!t)return;const i=$t(e);i?.layer?.uid===t&&(e.focus(),this._focusSortUid=null)}_watchActionSectionChanges(e){this.addHandles(e.on("change",this.scheduleRender.bind(this)),Zt),e.forEach((e=>this._renderOnActionChanges(e)))}_renderOnActionChanges(e){"toggle"!==e.type?"slider"!==e.type?this.addHandles((0,o.wB)((()=>[e?.className,e?.image,e?.id,e?.title,e?.visible]),(()=>this.scheduleRender()),o.Vh),kt):this.addHandles((0,o.wB)((()=>[e?.className,e?.id,e?.title,e?.visible,e?.value,e?.displayValueEnabled,e?.max,e?.min,e?.step]),(()=>this.scheduleRender()),o.Vh),kt):this.addHandles((0,o.wB)((()=>[e?.className,e?.image,e?.id,e?.title,e?.visible,e?.value]),(()=>this.scheduleRender()),o.Vh),kt)}_renderOnItemChanges(e){this.addHandles([(0,o.wB)((()=>[e?.actionsOpen,e?.visible,e?.open,e?.updating,e?.connectionStatus,e?.publishing,e?.title,e?.visibleAtCurrentScale,e?.error,e?.visibilityMode,e?.panel,e?.panel?.title,e?.panel?.content,e?.panel?.className,e?.sortable,e?.childrenSortable]),(()=>this.scheduleRender()),o.pc),(0,o.wB)((()=>[e?.hidden,e?.error]),(()=>this._setVisibleItems(this.operationalItems))),e.actionsSections.on("change",(()=>this.scheduleRender())),e.children.on("change",(()=>this.scheduleRender()))],Pt),e.children.forEach((e=>this._renderOnItemChanges(e))),e.actionsSections.forEach((e=>this._watchActionSectionChanges(e)))}_itemsChanged(e){this.removeHandles(Pt),this.removeHandles(kt),this.removeHandles(Zt),e.forEach((e=>this._renderOnItemChanges(e))),this._tooltipReferenceMap.clear(),this._setVisibleItems(e),this.scheduleRender()}_filterActions(e){return e.map((e=>e.filter((e=>e.visible))))}_countActions(e){return e.reduce(((e,t)=>e+t.length),0)}_getIconImageStyles(e){const t="esri.widgets.LayerList.ListItemPanel"===e.declaredClass||"esri.support.Action.ActionButton"===e.declaredClass||"esri.support.Action.ActionToggle"===e.declaredClass?e.image:null;return{"background-image":t?`url("${t}")`:void 0}}_selectionKeydown(e){const t=(0,r.Mk)(e);if(!["ArrowDown","ArrowUp"].includes(t))return void this._toggleSelection(e);e.stopPropagation();const i=e.currentTarget,s=$t(i),{_sortableMap:n,selectedItems:o}=this,a=i.dataset.group,l=n.get(a);if(!l||!s)return;const c=(0,p.m)(s,o),d=l.toArray(),u=e.target,h=d.indexOf(u.dataset.layerUid);if(-1!==h){if("ArrowDown"===t){const e=h+1;if(e>=d.length)return;c?(It(d,h,e),l.sort(d),this._sortLayers(l),this._focusSortUid=s.layer?.uid):(this._focusSortUid=s.layer?.uid,this.scheduleRender())}if("ArrowUp"===t){const e=h-1;if(e<=-1)return;c?(It(d,h,e),l.sort(d),this._sortLayers(l),this._focusSortUid=s.layer?.uid):(this._focusSortUid=s.layer?.uid,this.scheduleRender())}}}_toggleActionsOpen(e){const t=$t(e.currentTarget);if(!t)return;const{actionsOpen:i}=t,s=!i;s&&this.operationalItems.forEach((e=>Nt(e))),t.actionsOpen=s,e.stopPropagation()}_triggerPanel(e){const t=function(e){return e?.["data-panel"]}(e.currentTarget);e.stopPropagation(),t&&!t.disabled&&(t.open=!t.open)}_triggerAction(e){const t=e.currentTarget,i=function(e){return e?.["data-action"]}(t),s=$t(t);i&&s&&("toggle"===i.type&&(i.value=!i.value),this.triggerAction(i,s),e.stopPropagation())}_toggleVisibility(e){const t=e.currentTarget,i=t.getAttribute("data-parent-visibility"),s=$t(t);s&&(i===Ft.exclusive&&s.visible||(s.visible=!s.visible),e.stopPropagation())}_toggleChildrenClick(e){const t=$t(e.currentTarget);t&&(t.open=!t.open,e.stopPropagation())}_toggleSelection(e){e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:i}=this,s=$t(e.currentTarget);if(!s)return;const n=(0,p.m)(s,i),{length:r}=i;if(!t)return!r||n&&1===r?void(n?i.remove?.(n):i.add(s)):(i.removeAll(),void i.add(s));n?i.remove?.(n):i.add(s)}get test(){return{visibleItems:this.visibleItems}}};function $t(e){return e?.["data-item"]}(0,s._)([(0,a.MZ)()],Gt.prototype,"visibleItems",void 0),(0,s._)([(0,a.MZ)()],Gt.prototype,"iconClass",void 0),(0,s._)([(0,a.MZ)()],Gt.prototype,"icon",void 0),(0,s._)([(0,a.MZ)()],Gt.prototype,"label",null),(0,s._)([(0,a.MZ)()],Gt.prototype,"listItemCanGiveFunction",void 0),(0,s._)([(0,a.MZ)()],Gt.prototype,"listItemCanReceiveFunction",void 0),(0,s._)([(0,a.MZ)()],Gt.prototype,"listItemCreatedFunction",null),(0,s._)([(0,a.MZ)(),(0,v.G)("esri/widgets/LayerList/t9n/LayerList")],Gt.prototype,"messages",void 0),(0,s._)([(0,a.MZ)(),(0,v.G)("esri/t9n/common")],Gt.prototype,"messagesCommon",void 0),(0,s._)([(0,a.MZ)()],Gt.prototype,"multipleSelectionEnabled",void 0),(0,s._)([(0,a.MZ)()],Gt.prototype,"operationalItems",null),(0,s._)([(0,a.MZ)()],Gt.prototype,"selectionEnabled",void 0),(0,s._)([(0,a.MZ)()],Gt.prototype,"selectedItems",void 0),(0,s._)([(0,a.MZ)()],Gt.prototype,"style",void 0),(0,s._)([(0,a.MZ)()],Gt.prototype,"view",null),(0,s._)([(0,_.U)("trigger-action"),(0,a.MZ)({type:u.A})],Gt.prototype,"viewModel",void 0),(0,s._)([(0,a.MZ)()],Gt.prototype,"visibleElements",void 0),(0,s._)([(0,l.w)("visibleElements")],Gt.prototype,"castVisibleElements",null),(0,s._)([(0,f.$)()],Gt.prototype,"_toggleActionsOpen",null),(0,s._)([(0,f.$)()],Gt.prototype,"_triggerPanel",null),(0,s._)([(0,f.$)()],Gt.prototype,"_triggerAction",null),(0,s._)([(0,f.$)()],Gt.prototype,"_toggleVisibility",null),(0,s._)([(0,f.$)()],Gt.prototype,"_toggleChildrenClick",null),(0,s._)([(0,f.$)()],Gt.prototype,"_toggleSelection",null),Gt=(0,s._)([(0,c.$)("esri.widgets.LayerList")],Gt);const Bt=Gt},67118:(e,t,i)=>{i.d(t,{A:()=>v});var s=i(66866),n=i(48982),r=i(17306),o=i(85251),a=i(21564),l=(i(73446),i(85569),i(39831),i(63863)),c=i(75777),d=i(45937);const u="view",h="view-layers",p="map-layers",y="layer-views",g="layer-list-mode",m=n.A.ofType(c.A);let f=class extends r.A.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.operationalItems=new m,this.view=null}initialize(){this.addHandles([(0,o.wB)((()=>[this.view,this.view?.ready]),(()=>this._viewHandles()),o.Vh),(0,o.wB)((()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled]),(()=>this._recompileList()))],u)}destroy(){this.view=null,this.operationalItems.removeAll()}get state(){const{view:e}=this;return e?.ready?"ready":e?"loading":"disabled"}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,s){const n=e?.layer;if(!n)return;const r=this.view?.map?.layers,o=t?(0,d.ES)(t):r,a=i?(0,d.ES)(i):r;if(!o||!a)return;const{operationalItems:l}=this,c=t?.children||l,u=i?.children||l,h=a.length-s;e.parent=i||null,c.includes(e)&&c.remove(e),o.includes(n)&&o.remove(n),u.includes(e)||u.add(e,h),a.includes(n)||a.add(n,h)}_createLayerViewHandles(e){this.removeHandles(y),this._compileList(),e&&this.addHandles(e.on("change",(()=>this._compileList())),y)}_createMapLayerHandles(e){this.removeHandles(p),this._compileList(),e&&this.addHandles(e.on("change",(()=>this._compileList())),p)}_createListItem(e){const{view:t,listItemCreatedFunction:i,checkPublishStatusEnabled:s}=this;return new c.A({checkPublishStatusEnabled:s,layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){this.operationalItems.removeAll()}_getViewableLayers(e){if(e)return e.filter((e=>"hide"!==(0,d.Qv)(e)))}_watchLayersListMode(e){this.removeHandles(g),e&&e.forEach((e=>{"listMode"in e&&this.addHandles((0,o.wB)((()=>e.listMode),(()=>this._compileList())),g)}))}_compileList(){const e=this.view?.map?.layers;this._watchLayersListMode(e);const t=this._getViewableLayers(e);t?.length?(this._createNewItems(t),this._removeItems(t),this._sortItems(t)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach((e=>{t.find((t=>t.layer===e))||t.add(this._createListItem(e))}))}_removeItems(e){const{operationalItems:t}=this,i=[];t.forEach((t=>{t&&e&&e.includes(t.layer)||i.push(t)})),t.removeMany(i)}_sortItems(e){const{operationalItems:t}=this;t.sort(((t,i)=>{const s=e.indexOf(t.layer),n=e.indexOf(i.layer);return s>n?-1:s<n?1:0}))}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([p,y,h]),this._recompileList(),e&&e.ready&&this.addHandles([(0,o.wB)((()=>this.view?.map?.allLayers),(e=>this._createMapLayerHandles(e)),o.Vh),(0,o.wB)((()=>this.view?.allLayerViews),(e=>this._createLayerViewHandles(e)),o.Vh)],h)}};(0,s._)([(0,a.MZ)()],f.prototype,"checkPublishStatusEnabled",void 0),(0,s._)([(0,a.MZ)()],f.prototype,"listItemCreatedFunction",void 0),(0,s._)([(0,a.MZ)({type:m})],f.prototype,"operationalItems",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],f.prototype,"state",null),(0,s._)([(0,a.MZ)()],f.prototype,"view",void 0),f=(0,s._)([(0,l.$)("esri.widgets.LayerList.LayerListViewModel")],f);const v=f},75777:(e,t,i)=>{i.d(t,{A:()=>P});var s,n=i(66866),r=i(52495),o=i(85569),a=i(48982),l=i(65667),c=i(85251),d=i(21564),u=i(4130),h=(i(39831),i(63863)),p=i(45066),y=i(44072),g=i(88121);i(73446);let m=s=class extends y.A{constructor(e){super(e),this.displayValueEnabled=!1,this.max=1,this.min=0,this.step=.1,this.type="slider",this.value=null}clone(){return new s({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,displayValueEnabled:this.displayValueEnabled,max:this.max,min:this.min,step:this.step,value:this.value})}};(0,n._)([(0,d.MZ)()],m.prototype,"displayValueEnabled",void 0),(0,n._)([(0,d.MZ)()],m.prototype,"max",void 0),(0,n._)([(0,d.MZ)()],m.prototype,"min",void 0),(0,n._)([(0,d.MZ)()],m.prototype,"step",void 0),(0,n._)([(0,d.MZ)()],m.prototype,"value",void 0),m=s=(0,n._)([(0,h.$)("esri.support.Action.ActionSlider")],m);const f=m;var v=i(67241),_=i(6267),b=i(46928),w=i(45937),S=i(58357),M=i(96704);const L="esri-layer-list-panel",E=`${L}__content`,I={base:L,content:E,contentLegend:`${E}--legend`,contentString:`${E}--string`,contentElement:`${E}--html-element`,contentWidget:`${E}--widget`};let T=class extends((0,l.sA)(b.A)){constructor(e,t){super(e,t),this._legend=null,this.content=null,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles((0,c.wB)((()=>this.content),(e=>this._createLegend(e)),c.Vh))}destroy(){this._legend=(0,_.pR)(this._legend)}get className(){const{image:e}=this,t=this._getFirstWidget();return this._get("className")||(!e&&t?t.iconClass??"":"")}set className(e){this._override("className",e)}get disabled(){const{listItem:e,_legend:t,content:i}=this;return!(e&&(Array.isArray(i)&&i.length>1||!t||t.activeLayerInfos?.length&&e.visibleAtCurrentScale&&e.visible))}set disabled(e){this._overrideIfSome("disabled",e)}get title(){const e=this._getFirstWidget();return this._get("title")||(e?.label??"")}set title(e){this._override("title",e)}render(){return(0,M.K)("div",{class:I.base},this._renderContents())}_renderContent(e){const{_legend:t,disabled:i}=this;return!e||i?null:"legend"===e&&t?(0,M.K)("div",{class:this.classes(I.content,I.contentLegend),key:t},t.render()):"string"==typeof e?(0,M.K)("div",{class:this.classes(I.content,I.contentString),innerHTML:e,key:e}):(0,S.p4)(e)?(0,M.K)("div",{class:this.classes(I.content,I.contentWidget),key:e},e.render()):e instanceof HTMLElement?(0,M.K)("div",{afterCreate:this._attachToNode,bind:e,class:this.classes(I.content,I.contentElement),key:e}):null}_renderContents(){const{content:e}=this;return Array.isArray(e)?e.map((e=>this._renderContent(e))):this._renderContent(e)}_getLegendOptions(){const{listItem:e}=this;if(!e)return{};const{layer:t,view:i}=e;return t&&i?{view:i,layerInfos:[(0,w.TO)(t)]}:{}}async _createLegend(e){if(!this._hasLegend(e)||this._legend)return;const{default:t}=await Promise.resolve().then(i.bind(i,13625)),{listItem:s}=this,n=new t(this._getLegendOptions());this._legend=n,this.notifyChange("className"),this.notifyChange("title");const r=(0,c.wB)((()=>[s?.view,s?.layer,s?.layer?.source,s?.layer?.parent]),(()=>this._updateLegend(n)),c.Vh);this.addHandles(r,"legends"),this.scheduleRender()}_hasLegend(e){const t="legend";return e===t||null!=e&&!!Array.isArray(e)&&e.includes(t)}_attachToNode(e){e.appendChild(this)}_updateLegend(e){e.set(this._getLegendOptions()),this.scheduleRender()}_getWidget(e){return"legend"===e?this._legend:(0,S.p4)(e)?e:null}_getFirstWidget(){const{content:e}=this;if(Array.isArray(e)){let t=null;return e.some((e=>{const i=this._getWidget(e);return i&&(t=i),!!i})),t}return this._getWidget(e)}};(0,n._)([(0,d.MZ)()],T.prototype,"_legend",void 0),(0,n._)([(0,d.MZ)()],T.prototype,"className",null),(0,n._)([(0,d.MZ)()],T.prototype,"content",void 0),(0,n._)([(0,d.MZ)()],T.prototype,"disabled",null),(0,n._)([(0,d.MZ)()],T.prototype,"image",void 0),(0,n._)([(0,d.MZ)()],T.prototype,"listItem",void 0),(0,n._)([(0,d.MZ)()],T.prototype,"title",null),(0,n._)([(0,d.MZ)()],T.prototype,"open",void 0),(0,n._)([(0,d.MZ)()],T.prototype,"visible",void 0),T=(0,n._)([(0,h.$)("esri.widgets.LayerList.ListItemPanel")],T);const C=T;var x;const A=a.A.ofType({key:"type",defaultKeyValue:"button",base:y.A,typeMap:{button:g.A,toggle:v.A,slider:f}}),R=a.A.ofType(A),O="layer",k="child-list-mode";let Z=x=class extends((0,l.sA)(r.A)){constructor(e){super(e),this.actionsSections=new R,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(a.A.ofType(x)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.layerView=null,this.listItemCreatedFunction=null,this.open=!1,this.panel=null,this.parent=null,this.sortable=!0,this.view=null}initialize(){if(this.addHandles([(0,c.wB)((()=>this.layer),(e=>this._watchLayerProperties(e)),c.Vh),(0,c.wB)((()=>this.checkPublishStatusEnabled),(e=>this._updateChildrenPublishing(e)),c.Vh),(0,c.wB)((()=>this.view),(e=>this._updateChildrenView(e)),c.Vh),(0,c.wB)((()=>this.panel),(e=>this._setListItemOnPanel(e)),c.Vh),(0,c.wB)((()=>[this.layer,this.view]),(()=>this._getLayerView()),c.Vh)]),"function"==typeof this.listItemCreatedFunction){const e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){this.view=null}get connectionStatus(){const{layerView:e,publishing:t}=this;if(!t&&e&&"connectionStatus"in e)return e.connectionStatus}get error(){return this.layer?.loadError}get incompatible(){const{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e)||e.spatialReferenceSupported)}castPanel(e){return this.panel?.open&&!e.hasOwnProperty("open")&&(e.open=!0),e?new C(e):null}get title(){const e=(0,p.Jt)(this,"layer.layer");return(!e||e&&(0,p.Jt)(this,"layer.layer.loaded"))&&(0,p.Jt)(this,"layer.title")||(0,p.Jt)(this,"layer.attributes.title")||""}set title(e){this._override("title",e)}get publishing(){const{layer:e,checkPublishStatusEnabled:t}=this;return t&&e&&"publishingInfo"in e&&"publishing"===e.publishingInfo?.status}get updating(){const{layerView:e,connectionStatus:t,layer:i,publishing:s}=this;return!s&&!t&&(e?e.updating:"loading"===i?.loadStatus||!1)}get visible(){return this.layer?.visible}set visible(e){const t=this.layer;t&&(t.visible=e)}get visibleAtCurrentScale(){return!(0,w.eF)(this.layer,this.view?.scale)}get visibilityMode(){return(0,w.Yl)(this.layer)}clone(){return new x({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,open:this.open,panel:this.panel,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildrenPublishing(e){const t=this.children;t&&t.forEach((t=>t.checkPublishStatusEnabled=e))}_updateChildrenView(e){const t=this.children;t&&t.forEach((t=>t.view=e))}_addChildren(e){if(this.removeHandles(k),this.children.removeAll(),!e)return;e.forEach((t=>{this.addHandles((0,c.wB)((()=>t.listMode),(()=>this._addChildren(e))),k)}));const t=e.filter((e=>"hide"!==(0,w.Qv)(e)));this.children.addMany(this._makeChildren(t))}_watchSublayerChanges(e){e&&this.addHandles(e.on("change",(()=>{this._addChildren(e)})),O)}_initializeChildLayers(e){this._addChildren(e),this._watchSublayerChanges(e)}_makeChildren(e){return e.map((e=>(0,w.oU)(e)?new x({layer:e,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,parent:this,view:this.view}):null)).filter(o.Ru).reverse()}_watchLayerProperties(e){if(this.removeHandles(O),this.removeHandles(k),!e)return;if(this.addHandles((0,c.wB)((()=>e.listMode),(()=>this._watchLayerProperties(e))),O),"hide-children"===(0,w.Qv)(e))return void this.children.removeAll();const t=(0,w.oZ)(e);t&&this.addHandles((0,c.wB)((()=>e[t]),(i=>{e.hasOwnProperty(t)&&this._initializeChildLayers(i)}),c.Vh),O)}async _getLayerView(){const{layer:e,view:t}=this;if(e&&t)try{const i=await t.whenLayerView(e);if(i.layer!==this.layer)return;this._set("layerView",i)}catch{}}};(0,n._)([(0,d.MZ)({type:R})],Z.prototype,"actionsSections",void 0),(0,n._)([(0,d.MZ)()],Z.prototype,"actionsOpen",void 0),(0,n._)([(0,d.MZ)()],Z.prototype,"checkPublishStatusEnabled",void 0),(0,n._)([(0,d.MZ)({type:a.A})],Z.prototype,"children",void 0),(0,n._)([(0,d.MZ)()],Z.prototype,"childrenSortable",void 0),(0,n._)([(0,d.MZ)({readOnly:!0})],Z.prototype,"connectionStatus",null),(0,n._)([(0,d.MZ)({readOnly:!0})],Z.prototype,"error",null),(0,n._)([(0,d.MZ)()],Z.prototype,"hidden",void 0),(0,n._)([(0,d.MZ)({readOnly:!0})],Z.prototype,"incompatible",null),(0,n._)([(0,d.MZ)()],Z.prototype,"layer",void 0),(0,n._)([(0,d.MZ)({readOnly:!0})],Z.prototype,"layerView",void 0),(0,n._)([(0,d.MZ)()],Z.prototype,"listItemCreatedFunction",void 0),(0,n._)([(0,d.MZ)()],Z.prototype,"open",void 0),(0,n._)([(0,d.MZ)({type:C})],Z.prototype,"panel",void 0),(0,n._)([(0,u.w)("panel")],Z.prototype,"castPanel",null),(0,n._)([(0,d.MZ)()],Z.prototype,"parent",void 0),(0,n._)([(0,d.MZ)()],Z.prototype,"sortable",void 0),(0,n._)([(0,d.MZ)()],Z.prototype,"title",null),(0,n._)([(0,d.MZ)({readOnly:!0})],Z.prototype,"publishing",null),(0,n._)([(0,d.MZ)({readOnly:!0})],Z.prototype,"updating",null),(0,n._)([(0,d.MZ)()],Z.prototype,"view",void 0),(0,n._)([(0,d.MZ)()],Z.prototype,"visible",null),(0,n._)([(0,d.MZ)({readOnly:!0})],Z.prototype,"visibleAtCurrentScale",null),(0,n._)([(0,d.MZ)({readOnly:!0})],Z.prototype,"visibilityMode",null),Z=x=(0,n._)([(0,h.$)("esri.widgets.LayerList.ListItem")],Z);const P=Z},45937:(e,t,i)=>{i.d(t,{ES:()=>h,Qv:()=>n,TO:()=>y,Yl:()=>r,dL:()=>a,eF:()=>c,kL:()=>u,m:()=>p,mk:()=>d,oU:()=>l,oZ:()=>o});const s={hide:"hide",hideChildren:"hide-children"};function n(e){if(e)return null!=e.listMode?e.listMode:void 0}function r(e){if(!e)return"inherited";const t=function(e){const t=m(e);return null!=t&&"supportsSublayerVisibility"in t?t.supportsSublayerVisibility:void 0}(g(e)?e.layer:e);return null!=t?t?"independent":"inherited":"visibilityMode"in e&&null!=e.visibilityMode?e.visibilityMode:"independent"}function o(e){if(e&&(!("type"in e)||"wmts"!==e.type)&&e.listMode!==s.hideChildren)return"sublayers"in e?"sublayers":"layers"in e?"layers":void 0}function a(e){const t=(e?.layer&&g(e.layer)?e.layer.layer:void 0)??e?.layer;return!!t&&(function(e){const t=m(e);return null!=t&&"supportsDynamicLayers"in t?t.supportsDynamicLayers:void 0}(t)??!0)}function l(e){return n(e)!==s.hide}function c(e,t){if(!e||null==t||isNaN(t))return!1;const i=function(e){return null!=e&&"minScale"in e&&null!=e.minScale?e.minScale:void 0}(e),s=function(e){return null!=e&&"maxScale"in e&&null!=e.maxScale?e.maxScale:void 0}(e),n=null!=i&&!isNaN(i)&&i>0&&t>i,r=null!=s&&!isNaN(s)&&s>0&&t<s;return n||r}function d(e,t){e?.sort(((e,i)=>{const s="uid"in e?t.indexOf(e.uid):-1,n="uid"in i?t.indexOf(i.uid):-1;return s>n?-1:s<n?1:0}))}function u(e,t){const i=e?.layer;if(!i)return;const s=o(i);if(!s)return;let n;"layers"===s&&"layers"in i?n=i.layers:"sublayers"===s&&"sublayers"in i&&(n=i.sublayers),d(n,t)}function h(e){const t=e?.layer;return t&&"layers"in t?t.layers:null}function p(e,t){const i=e.layer?.uid;return null!=i?t.find((e=>e.layer?.uid===i)):null}function y(e){const t=g(e)?e:null,i=e?.parent,s=null!=i&&"type"in i&&"map-image"===i.type?t?.source:null;return s&&i?{layer:i,title:"",sublayerIds:[s.mapLayerId]}:{layer:e,title:""}}function g(e){return null!=e&&"layer"in e&&null!=e.layer}function m(e){return e&&"capabilities"in e&&null!=e.capabilities&&"exportMap"in e.capabilities?e.capabilities.exportMap:void 0}},13625:(e,t,i)=>{i.d(t,{default:()=>Kt});var s=i(66866),n=i(85251),r=i(21564),o=i(4130),a=i(85569),l=(i(39831),i(63863)),c=i(46928),d=(i(17791),i(52495)),u=i(48982),h=(i(73446),i(45066)),p=i(96220),y=i(28830),g=i(86394),m=i(30822),f=i(59851),v=i(539),_=i(40189),b=i(89882),w=i(46437),S=i(20909),M=i(94255),L=i(57079),E=i(27664),I=i(10109),T=i(42453),C=i(40454),x=i(22036),A=i(48887),R=i(72973),O=i(82140),k=i(99340),Z=i(77573),P=i(88148),F=i(73532),N=i(42624),D=i(55056),V=i(44237);function G(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;const i=e.visualVariables.find((e=>"size"===e.type)),s=((e,t)=>{const i=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return t?.levels?t.levels[i]:null})(t,i);return s?new V.A({field:i.field,minSize:s[2].size,minDataValue:s[2].value,maxSize:s[3].size,maxDataValue:s[3].value}):null}var $=i(26943),B=i(70218),z=i(22428),H=i(82178),K=i(29934),j=i(72638),U=i(71521),q=i(23369),W=i(40241);const J=[255,255,255],Y=[200,200,200],Q=[128,128,128];async function X(e,t,i,s,n,r,o){const a=t.legendOptions,l=a?.customValues,c=o||await ie(e,i),d=t.stops,u=!!c,h=!!l,p=null!=t.minSize&&null!=t.maxSize,y=d&&d.length>1,g=!!t.target;if(!u||!h&&!(p||y&&!g))return;const m=(0,D.$d)(c);let f=!1,v=null,_=null;v=m&&!y?(0,H.LI)([t.minDataValue,t.maxDataValue]):l??await re(t,c,s,n?.type);const b=e?.authoringInfo,w="univariate-color-size"===b?.type,S=w&&"above-and-below"===b?.univariateTheme;if(!v&&y&&(v=d.map((e=>e.value)),f=d.some((e=>!!e.label)),"flow"===e.type&&(v=(0,H.LI)(v)),f&&(_=d.map((e=>e.label)))),m&&null!=v&&v?.length>2&&!S&&(v=[v[0],v[v.length-1]]),!v)return null;w&&5!==v?.length&&(v=oe({minSize:v[0],maxSize:v[v.length-1]}));const M=m?ee(e,v):null,L=(0,D.k_)(c),E=f?null:function(e,t){const i=e.length-1;return e.map(((e,s)=>(0,K.Dd)(e,s,i,t)))}(v,r);return(await Promise.all(v.map((async(i,r)=>{const o=m?M[r]:await le(t,c,i,s,n?.type);return{value:i,symbol:ce(S&&"class-breaks"===e.type?te(e,r):c,o),label:f?_[r]:E[r],size:o,outlineSize:L}})))).reverse()}function ee(e,t){const i=e?.authoringInfo,s="univariate-color-size"===i?.type;let n=[12,30];if(s){const e=t[0],i=t[t.length-1],s=12,r=30;n=t.map((t=>s+(t-e)/(i-e)*(r-s)))}return s&&"below"===i?.univariateTheme&&n.reverse(),n}function te(e,t){const i=e.classBreakInfos,s=i.length,n=s<2||!(t>=2)?i[0].symbol.clone():i[s-1].symbol.clone();return e.visualVariables.some((e=>"color"===e.type))&&(n.type.includes("3d")?se(n):ne(n)),n}async function ie(e,t){if("flow"===e.type)return(0,K.Zo)(e,t);if("pie-chart"===e.type)return new q.A({color:null,outline:e.outline?.width?e.outline:new W.A});let i=null,s=null;if("simple"===e.type)i=e.symbol;else if("class-breaks"===e.type){const t=e.classBreakInfos;i=t&&t[0]&&t[0].symbol,s=t.length>1}else if("unique-value"===e.type){const t=e.uniqueValueInfos;i=t?.[0]?.symbol,s=null!=t&&t.length>1}return!i||function(e){if(e)return(0,m.wk)(e)?!!e.symbolLayers&&e.symbolLayers.some((e=>e&&"fill"===e.type)):e.type.includes("fill");return!1}(i)?null:(i=i.clone(),(t||s)&&(i.type.includes("3d")?se(i):ne(i)),i)}function se(e){"line-3d"===e.type?e.symbolLayers.forEach((e=>{e.material={color:Q}})):e.symbolLayers.forEach((e=>{"icon"!==e.type||e.resource?.href?e.material={color:Y}:(e.material={color:J},e.outline={color:Q,size:1.5})}))}function ne(e){const t=(0,U.g4)();if("cim"===e.type)(0,Z.Fe)(e,new p.A(Y));else if(e.type.includes("line"))e.color=Q;else if(e.color=t?Q:J,"simple-marker"===e.type)if(e.outline){const t=e.outline?.color?.toHex();"#ffffff"===t&&(e.outline.color=Q)}else e.outline={color:Q,width:1.5}}async function re(e,t,s,n){const r=(await Promise.resolve().then(i.bind(i,28479))).getSizeRangeAtScale(e,s,n),o=r&&oe(r);if(!r||!o)return;let a=o.map((t=>function(e,t,i){const s=i.minSize,n=i.maxSize,r=t.minDataValue,o=t.maxDataValue;let a;a=e<=s?r:e>=n?o:(e-s)/(n-s)*(o-r)+r;return a}(t,e,r)));a=(0,H.LI)(a);for(let i=1;i<a.length-1;i++){const r=await ae(e,t,a[i],a[i-1],s,n);r&&(a[i]=r[0],o[i]=r[1])}return a}function oe(e){const t=e.minSize,i=(e.maxSize-t)/4,s=[];for(let n=0;n<5;n++)s.push(t+i*n);return s}async function ae(e,t,i,s,n,r){const o=await le(e,t,i,n,r),a=await le(e,t,s,n,r),l=(0,H.lc)(i),c=l.fractional;let d=l.integer,u=null,h=null;i>0&&i<1&&(u=10**c,d=(0,H.lc)(i*=u).integer);for(let p=d-1;p>=0;p--){const s=10**p;let l=Math.floor(i/s)*s,c=Math.ceil(i/s)*s;null!=u&&(l/=u,c/=u);let d=(l+c)/2;[,d]=(0,H.LI)([l,d,c],{indexes:[1]});const y=await le(e,t,l,n,r),g=await le(e,t,c,n,r),m=await le(e,t,d,n,r),f=(0,H.u5)(o,y,a,null),v=(0,H.u5)(o,g,a,null),_=(0,H.u5)(o,m,a,null);let b=f.previous<=20,w=v.previous<=20;if(b&&w&&(f.previous<=v.previous?(b=!0,w=!1):(w=!0,b=!1)),b?h=[l,y]:w?h=[c,g]:_.previous<=20&&(h=[d,m]),h)break}return h}async function le(e,t,s,n,r){const{getSize:o}=await Promise.resolve().then(i.bind(i,28479));return o(e,s,{scale:n,view:r,shape:"simple-marker"===t.type?t.style:null})}function ce(e,t){const i=e.clone();if((0,m.wk)(i))(0,D.$d)(i)||i.symbolLayers.forEach((e=>{"fill"!==e.type&&(e.size=t)}));else if(function(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(i))i.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(i)){const e=i.width,s=i.height;i.height=t,i.width=t*(e/s)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(i)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(i)&&i.font&&(i.font.size=t):i.width=t;return i}i(76459);var de=i(46930);i(79581);var ue=i(68882),he=i(15131),pe=i(48187);const ye=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,ge=new f.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),me=new q.A({size:6,outline:{color:[128,128,128,.5],width:.5}}),fe=new ue.A({style:"solid"});function ve(e){return"flow"===e.type}function _e(e){return"vector-field"===e.type}function be(e){return"raster-colormap"===e.type}function we(e){return"raster-stretch"===e.type}function Se(e){return"raster-shaded-relief"===e.type}function Me(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function Le(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function Ee(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function Ie(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function Te(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function Ce(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function xe(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function Ae(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function Re(e){return"esri.renderers.PieChartRenderer"===e.declaredClass}function Oe(e){return"esri.layers.SubtypeGroupLayer"===e.declaredClass}function ke(e){return"esri.layers.MapImageLayer"===e.declaredClass}function Ze(e){return"esri.layers.TileLayer"===e.declaredClass}function Pe(e){return"esri.layers.ImageryLayer"===e.declaredClass}function Fe(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}function Ne(e){return"sublayers"in e}async function De(e,t){const i=await(0,he.ud)("esri/widgets/Legend/t9n/Legend");return"previewTemplateAriaLabel"!==e||t||(e="previewAriaLabel"),(0,pe.V)(i[e],{label:t})}const Ve=new q.A({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let Ge={},$e=class extends d.A{constructor(e){super(e),this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new u.A,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this.addHandles([(0,n.on)((()=>this.children),"change",(t=>{const{added:i,removed:s}=t;i.forEach((t=>{const i=`activeLayerInfo-ready-watcher-${t.layer.uid}`;this.addHandles((0,n.wB)((()=>t.ready),e,n.Vh),i)})),s.forEach((e=>this.removeHandles(e.layer.uid))),e()}))]),this.keepCacheOnDestroy||(Ge={})}destroy(){this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(Ge=null)}get effectList(){const e=this.layer;let t=null;return"effect"in e&&e.effect&&(t=new L.$B,t.effect=e.effect,t.endTransitions(),t.scale=this.scale),t}get opacity(){const e=this.layer.opacity,t=this.parent?.opacity,i=this.layer.parent,s=i&&"uid"in i?this._getParentLayerOpacity(i):null;return null!=t?t*e:null!=s?s*e:e}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view?.scale??0}get isScaleDriven(){const e=this.layer;if(null===e)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if("cluster"===e.featureReduction.type)return!0;if("binning"===e.featureReduction.type&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(this.hideLayersNotInCurrentView&&!await this._isLayerInCurrentView())return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,(e=>{if((0,C.yZ)(e))return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet?.features.length){const t=e.layerDefinition,i=t?.drawingInfo,s=i&&(0,A.r)(i.renderer),n=ge.read(t.geometryType);return s?this._getRendererLegendElements(s,{title:e.name,geometryType:n}):(v.A.getLogger(this).warn("drawingInfo not available!"),null)}return null}));try{const e=[],i=await Promise.allSettled(t);for(const t of i)if("fulfilled"===t.status)for(const i of t.value??[])e.push(i);this.legendElements=e,this.notifyChange("ready")}catch(i){v.A.getLogger(this).warn("error while building legend for layer!",i)}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(t){v.A.getLogger(this).warn("error while building legend for layer!",t)}}async buildLegendElementsForFeatureReduction(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getLegendElementsForFeatureReduction(e):[],this.notifyChange("ready")}catch(t){v.A.getLogger(this).warn("error while building legend for layer!",t)}}async buildLegendElementsForTools(){const e=this.layer;if(function(e){return"esri.layers.VoxelLayer"===e.declaredClass}(e))this._constructLegendElementsForVoxellayer();else if(function(e){return"esri.layers.WMTSLayer"===e.declaredClass}(e))this._constructLegendElementsForWMTSlayer();else if(function(e){return"esri.layers.WMSLayer"===e.declaredClass}(e))await this._constructLegendElementsForWMSSublayers();else if(function(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}(e))await this._constructLegendElementsForBuildingSceneLayer();else if(ke(e)||Ze(e)||Oe(e))await this._constructLegendElementsForSublayers();else{this.removeHandles("imageryLayers-watcher");let t="default";if(Pe(e)){const i=e;t=(i?.rasterFunction?.functionName||"default")+"_"+(e.bandIds?.length?e.bandIds.join(""):"###")}await this._getLegendLayers(`${e.uid}-${t}`).then((async t=>{this.legendElements=[],this.notifyChange("ready");const i=t.map((async t=>{if(Pe(e)||Fe(e)){const t=(0,n.wB)((()=>["renderingRule"in e&&e.rasterFunction,e.bandIds]),(()=>(0,_.sg)((async()=>{Ge.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()}))()));this.addHandles(t,"imageryLayers-watcher")}const i=this._generateSymbolTableElementForLegendLayer(t);i&&i.infos.length&&(Pe(e)&&(i.title=e.title),this.legendElements.push(i)),this.notifyChange("ready")}));await Promise.allSettled(i)})).catch((e=>{v.A.getLogger(this).warn("Request to server for legend has failed!",e)}))}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,i=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!(i||t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;await(0,n.C_)((()=>!t.updating));const s=i?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return!s||(s.geometry=this.view.extent,0!==(i?"queryFeatureCount"in t&&await t.queryFeatureCount(s):"queryFeatureCount"in e&&await e.queryFeatureCount(s)))}_getParentLayerOpacity(e){let t=1;const i=e.parent;return i&&"uid"in i&&(t=this._getParentLayerOpacity(i)),e.opacity*t}_isGroupActive(){const e=this.children;return!!e.length&&e.some((e=>e.ready))}_isRendererScaleDriven(e){if("dot-density"===e.type)return!0;const t="valueExpression"in e?e.valueExpression:null;if(ye.test(t))return!0;const i="visualVariables"in e?e.visualVariables:null;return!!i?.some((e=>this._isScaleDrivenSizeVariable(e)))||this._hasScaleDrivenSymbols(e)}_hasScaleDrivenSymbols(e){switch(e.type){case"simple":return this._isScaleDrivenSymbol(e.symbol);case"class-breaks":return this._isScaleDrivenSymbol(e.defaultSymbol)||e.classBreakInfos.some((e=>this._isScaleDrivenSymbol(e.symbol)));case"unique-value":return this._isScaleDrivenSymbol(e.defaultSymbol)||!!e.uniqueValueInfos?.some((e=>this._isScaleDrivenSymbol(e.symbol)))}return!1}_isScaleDrivenSymbol(e){if("cim"===e?.type){const{primitiveOverrides:t,minScale:i,maxScale:s}=e.data,n=t?.some((e=>/\$view\.scale/.test(e.valueExpressionInfo?.expression||"")))??!1;return null!=i||null!=s||n}return!1}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return!1;const t=e,i=t.minSize,s=t.maxSize;return!("object"!=typeof i||!i||!this._isScaleDrivenSizeVariable(i))||!("object"!=typeof s||!s||!this._isScaleDrivenSizeVariable(s))||!!t.expression||ye.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((e=>this._isLayerScaleDriven(e)));const t=e.parent;if(!1===e.loaded&&t&&ke(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const i of t.sourceJSON.layers??[])if(i.id===e.source.mapLayerId&&(i.minScale>0||i.maxScale>0))return!0;return!1}async _constructLegendElementsForVoxellayer(){this.legendElements=[],this.removeHandles("voxel-style-watcher"),this.removeHandles("voxel-current-variable");const e=this.layer;this.addHandles((0,n.wB)((()=>e.currentVariableId),(()=>this._constructLegendElementsForVoxellayer())),"voxel-current-variable"),this.addHandles((0,n.wB)((()=>e.getVariableStyles()),(()=>this._constructLegendElementsForVoxellayer())),"voxel-style-watcher");const t=e.getVariableStyle(null),i=[];if(t)if(t.uniqueValues?.length){const e=[];t.uniqueValues.forEach((t=>{t.enabled&&e.push({label:t.label||`${t.value}`,value:t.value,symbol:new ue.A({color:t.color,outline:null})})})),e.length&&i.push({type:"symbol-table",title:t.label,infos:e})}else if(t.transferFunction){const{colorStops:e,stretchRange:s}=t.transferFunction,n=e.toArray().reverse(),r=s.map(((e,t)=>`${0===t?K.l5:K.kC} ${function(e){const t=Math.floor(Math.log10(Math.abs(e)))+1,i=t<4||t>6?4:t,s=Math.abs(e)>=1e6?"compact":"standard";return(0,de.ZV)(e,{notation:s,minimumSignificantDigits:2,maximumSignificantDigits:i})}(e)}`)).reverse(),o=n.map((e=>({color:e.color,value:null,label:null})));o[0].label=r[0],o[o.length-1].label=r[1],i.push({type:"color-ramp",title:t.label,infos:o,preview:(0,N.J0)(n.map((e=>e.color)),{ariaLabel:await De("previewColorRampAriaLabel")})})}const s=e.opacity,r=i.reduce(((e,t)=>[...e,...this._getAllInfos(t)]),[]).filter((e=>!!e?.symbol)).map((e=>this._getSymbolPreview(e,s)));await Promise.allSettled(r),this.legendElements=i,this.notifyChange("ready")}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this.removeHandles("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this.addHandles((0,n.wB)((()=>{const{layer:e}=this;return e&&"activeLayer"in e&&e.activeLayer}),(()=>this._constructLegendElementsForWMTSlayer())),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some((i=>e.styleId===i.id&&(t=i.legendUrl,!0))),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}])}this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this.removeHandles("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this.addHandles((0,n.wB)((()=>{const{layer:e}=this;return e&&"sublayers"in e&&e.sublayers}),(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const i=[];this.addHandles(e.on("change",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher");const s=e.toArray();for(const r of s){const e=(0,n.wB)((()=>[r.title,r.visible,r.legendEnabled]),(()=>this._constructLegendElementsForWMSSublayers()));if(this.addHandles(e,"wms-sublayers-watcher"),!this.respectLayerVisibility||r.visible&&r.legendEnabled){const e=await this._generateSymbolTableElementForWMSSublayer(r,t);e?.infos.length&&i.unshift(e)}}return i}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const i=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter((e=>e));return{type:"symbol-table",title:e.title,infos:i}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){let i=e.legendUrl;if(!i)return;const s={type:"symbol-table",title:e.title||e.name||String(e.id??""),infos:[]};t&&(i=(0,S.a6)(i,t));let n=null;const r=e.layer?.opacity;try{n=(await(0,g.A)(i,{responseType:"image"})).data,n&&(n.style.opacity=r)}catch{}return s.infos.push({src:i,preview:n,opacity:r}),s}_getLegendLayers(e,t){const i=Ge&&Ge[e];return i?Promise.resolve(i):this._legendRequest(t).then((t=>{const i=t.layers;return Ge[e]=i,i}))}_legendRequest(e){const t=this.layer;let i={f:"json",dynamicLayers:e};if(Pe(t)){const e=t.exportImageServiceParameters.rasterFunction;if(e&&(i.renderingRule=JSON.stringify(e.functionDefinition?.toJSON()||e.toJSON())),t.bandIds&&(i.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:e,viewId:s,customParameters:n}=t;i={raster:e,viewId:s,...i,...n}}}let s=t.url.replace(/(\/)+$/,"");if("version"in t&&+t.version>=10.01){const e=s.indexOf("?");e>-1?s=s.substring(0,e)+"/legend"+s.substring(e):s+="/legend"}else{const e=s.toLowerCase().indexOf("/rest/"),t=s.substring(0,e)+s.substring(e+5,s.length);s="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(t)+"&returnbytes=true"}return(0,g.A)(s,{query:i}).then((e=>e.data))}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this.removeHandles("sublayers-watcher");const e=this.layer;this.addHandles((0,n.wB)((()=>e.sublayers),(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){v.A.getLogger(this).warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForBuildingSublayers(e,t){let i=[];this.addHandles(e.on("change",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");const s=e.toArray();for(const r of s){const e=(0,n.wB)((()=>["renderer"in r&&r.renderer,r.opacity,r.title,r.visible]),(()=>this._constructLegendElementsForBuildingSceneLayer()));if(this.addHandles(e,"sublayers-watcher"),!this.respectLayerVisibility||r.visible){const e=null!=r?.opacity?r.opacity:null,s=null!=e?e*t:t;if("building-group"===r.type){const e={type:"symbol-table",title:r.title,infos:[]},t=await this._generateLegendElementsForBuildingSublayers(r.sublayers,s);e.infos.push(...t),i=[e,...i]}else r.renderer&&(i=[...await this._getRendererLegendElements(r.renderer,{title:r.title,opacity:s,sublayer:r}),...i])}}return i.filter((e=>!!e&&(!("infos"in e)||!e.infos||e.infos.length>0)))}async _constructLegendElementsForSublayers(){this.legendElements=[],this.removeHandles("sublayers-watcher");const e=this.layer;if(ke(e)||Ze(e)||Oe(e)){this.addHandles((0,n.wB)((()=>e.sublayers),(()=>this._constructLegendElementsForSublayers)),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){v.A.getLogger(this).warn("Request to server for legend has failed!",t)}}}async _generateLegendElementsForSublayers(e,t,i){const s=this.layer;let r=[];this.addHandles(e.on("change",(()=>this._constructLegendElementsForSublayers())),"sublayers-watcher");let o=e.toArray();!i&&this.sublayerIds&&this.sublayerIds.length&&(o=Oe(s)?this.sublayerIds.map((e=>s.findSublayerForSubtypeCode(e))).filter(a.Ru):this.sublayerIds.map((e=>s.findSublayerById(e))).filter(a.Ru));for(const a of o){const e=(0,n.wB)((()=>[a.renderer,a.opacity,a.title,a.visible,a.legendEnabled]),(()=>this._constructLegendElementsForSublayers()));if(this.addHandles(e,"sublayers-watcher"),!this.respectLayerVisibility||a.visible&&a.legendEnabled&&this._isSublayerInScale(a)){const e=null!=a?.opacity?a.opacity:null,s=null!=e?e*t:t,n=!Ne(a)||a.originIdOf("renderer")>M.Gr.SERVICE&&!a.sublayers;if(a.renderer&&n)await a.load(),r=[...await this._getRendererLegendElements(a.renderer,{title:a.title,opacity:s,sublayer:a}),...r];else if(Ne(a)){const e=await this._generateSymbolTableElementForSublayer(a,s,i);e&&r.unshift(e)}}}return r.filter((e=>!!e&&(!("infos"in e)||!e.infos||e.infos.length>0)))}async _generateSymbolTableElementForSublayer(e,t,i){if(!i){i=new Map;const t=this.layer,s=e.source;let n=null;if(s&&("map-layer"!==s.type||s.mapLayerId!==e.id||s.gdbVersion&&s.gdbVersion!==("gdbVersion"in t&&t.gdbVersion))||e.originIdOf("renderer")>M.Gr.SERVICE||e.originIdOf("labelingInfo")>M.Gr.SERVICE||e.originIdOf("labelsVisible")>M.Gr.SERVICE){const e=new I.g({layer:this.layer});n=e.hasDynamicLayers?e.dynamicLayers:null,e.destroy()}const r=n||`${t.uid}-default`;(await this._getLegendLayers(r,n)).forEach((e=>i.set(e.layerId,e)))}const s=i.get(e.id);if((!s||s?.subLayerIds&&s.defaultVisibility)&&e.sublayers){const s=await this._generateLegendElementsForSublayers(e.sublayers,t,i);return{type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendLayer(s,e,t)}_generateSymbolTableElementForLegendLayer(e,t,i){if(!e?.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const s=t?.renderer;let n=t?.title||e.layerName;if(s&&(!t||t?.originIdOf("renderer")>M.Gr.SERVICE)){const e=t?.title||this._getRendererTitle(s,t);e&&(n&&"string"!=typeof e&&"title"in e&&(e.title=n),n=e)}const r={type:"symbol-table",title:n,legendType:e.legendType||null,infos:[]},o=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return e.legendGroups&&e.legendGroups.length>0?e.legendGroups.forEach((t=>{const s={type:"symbol-table",title:t.heading,legendType:e.legendType||null,infos:this._generateSymbolTableElementInfosForLegendLayer(o.filter((e=>e.groupId===t.id)),e.layerId,i)};s.infos?.length>0&&r.infos.push(s)})):r.infos=this._generateSymbolTableElementInfosForLegendLayer(o,e.layerId,i),r.infos.length>0?r:null}_generateSymbolTableElementInfosForLegendLayer(e,t,i){return e.map((e=>{let s=e.url;if(e.imageData&&e.imageData.length>0)s=`data:image/png;base64,${e.imageData}`;else{if(0===s.indexOf("http"))return null;s=(0,y.Y3)(`${this.layer.url}/${t}/images/${s}`)}return{label:e.label,src:s,opacity:i??this.opacity,width:e.width,height:e.height}})).filter(a.Ru)}_isSublayerInScale(e){const t=e.minScale||0,i=e.maxScale||0;return!(t>0&&t<this.scale||i>this.scale)}_isLegendLayerInScale(e,t){const i=t||this.layer;let s=null,n=null,r=!0;return!i.minScale&&0!==i.minScale||!i.maxScale&&0!==i.maxScale?(0===e.minScale&&i.tileInfo&&(s=i.tileInfo.lods[0].scale),0===e.maxScale&&i.tileInfo&&(n=i.tileInfo.lods[i.tileInfo.lods.length-1].scale)):(s=Math.min(i.minScale,e.minScale)||i.minScale||e.minScale,n=Math.max(i.maxScale,e.maxScale)),(s>0&&s<this.scale||n>this.scale)&&(r=!1),r}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&+this.layer.version<10.1||0===e.length)return e;const i=t.renderer,s=e.some((e=>e.values));let n=0,r=null;return s&&e.some(((e,t)=>(e.values||(n=t,r=e,r.label||(r.label="others")),null!=r))),i?"unique-value"===i.type?r&&(e.splice(n,1),e.push(r)):"class-breaks"===i.type&&(r&&e.splice(n,1),e.reverse(),r&&e.push(r)):r&&(e.splice(n,1),e.push(r)),e}async _getRendererLegendElements(e,t={}){if(!function(e,t){return Me(e)||Le(e)||Ee(e)||Ie(e)||Ae(e)||Re(e)?"2d"===t.type||(0,R.l)(e):we(e)||be(e)||Se(e)||Te(e)||Ce(e)||xe(e)||_e(e)||ve(e)}(e,this.view))return v.A.getLogger(this).warn(`Renderer of type '${e.type}' not supported!`),[];if(function(e){return Te(e)||Ce(e)||xe(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}(e))return this._constructPointCloudRendererLegendElements(e,t);if(Ae(e))return this._constructDotDensityRendererLegendElements(e);const i=await this._loadRenderer(e);return Re(i)?this._constructPieChartRendererLegendElements(i):this._constructRendererLegendElements(i,t)}async _getLegendElementsForFeatureReduction(e){let t=null;return"binning"===e.type?t=e.renderer:"cluster"===e.type&&(t=this._getClusterRenderer(e)),t?this._getRendererLegendElements(t):[]}_getPointCloudRendererTitle(e){return(e.legendOptions?.title||e.field)??""}async _constructPointCloudRendererLegendElements(e,t={}){const i=t.title,s=[];let n=null,r=null;if(Te(e))n={type:"symbol-table",title:i||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((e=>{n.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(me,e.color)})}));else if(Ce(e)){const t=e.stops;let s=null;if(t?.length&&(1===t.length&&(s=t[0].color),!s)){const e=t[0].value,i=t[t.length-1].value;null!=e&&null!=i&&(s=(0,$.G9)(e+(i-e)/2,t))}n={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(me,s||me.color)}]};const o=(0,$.y0)(e.stops??[])??[];r={type:"color-ramp",title:i||this._getPointCloudRendererTitle(e),infos:o,preview:(0,N.J0)(o.map((e=>e.color)),{ariaLabel:await De("previewColorRampAriaLabel")})}}else xe(e)&&(n={type:"symbol-table",title:i||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos?.forEach((e=>{n.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(me,e.color)})})));n&&n.infos.length&&s.push(n),r&&r.infos.length&&s.push(r);const o=s.reduce(((e,t)=>[...e,...t.infos??[]]),[]).filter((e=>!!e.symbol)).map((t=>this._getSymbolPreview(t,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})));return await Promise.allSettled(o),s}async _getElementInfoForDotDensity(e,t){const{color:i,label:s,valueExpressionTitle:n}=t,{backgroundColor:r,outline:o,dotSize:a}=e,l=this.effectList,c=l?.effects.map((e=>e.toJSON())),d=(0,E.zu)(c),u=await De("previewTemplateAriaLabel",s||n),h=a+"-"+i+"-"+r+"-"+(o&&JSON.stringify(o.toJSON()))+"-"+d,p=this._dotDensityUrlCache,y=p.has(h)?p.get(h):(0,N.xg)(e,i,{ariaLabel:u});p.set(h,y);const g={shape:{type:"image",x:0,y:0,width:y.width,height:y.height,src:y.src},fill:null,stroke:null,offset:[0,0]},m=(0,F.fz)([[g]],[y.width,y.height],{effectView:this.effectList,ariaLabel:u});return{opacity:1,src:y.src,preview:m,width:y.width,height:y.height}}async _constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),i=e.legendOptions?.unit,s={type:"symbol-table",title:{value:t&&Math.round(t),unit:i||""},infos:[]};for(const n of e.attributes){const t=await this._getElementInfoForDotDensity(e,n);t.label=n.label||n.valueExpressionTitle||n.field,s.infos.push(t)}return[s]}async _constructPieChartRendererLegendElements(e){const t=this.layer.opacity,i=[];let s=null;const n=e.outline;e.attributes.forEach((e=>{const t=new q.A({color:e.color,outline:n}),s=e.label||e.valueExpressionTitle||e.field;i.push({label:s,symbol:t})}));const r=i.length?[...i]:[];if(e.othersCategory?.color&&0!==e.othersCategory?.threshold){const t=new q.A({color:e.othersCategory.color,outline:n});s=e.othersCategory.label||"Other",i.push({label:s,symbol:t})}if(e.defaultColor?.a){const t=new q.A({color:e.defaultColor,outline:n});i.push({label:e.defaultLabel,symbol:t})}const o=await this._getVisualVariableLegendElements(e,this.layer)||[];if(i.length){o.unshift({type:"symbol-table",title:null,infos:i});const t=r.filter((e=>e.label!==s)).map((e=>e.symbol.color)).filter(Boolean),a=(0,N.es)(t,{holePercentage:e.holePercentage,backgroundColor:e.backgroundFillSymbol?.color,effectList:this.effectList,outline:n,ariaLabel:await De("previewPieChartAriaLabel")});o.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:i,preview:a})}const a=o.reduce(((e,t)=>[...e,...this._getAllInfos(t)]),[]).filter((e=>!!e?.symbol&&!e?.preview)).map((e=>this._getSymbolPreview(e,t,{effectList:this.effectList})));return await Promise.allSettled(a),o}async _constructRendererLegendElements(e,t={}){const{title:i,sublayer:s}=t,n=s||this.layer;this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const r=await this._getVisualVariableLegendElements(e,n)||[],o={type:"symbol-table",title:i||this._getRendererTitle(e,n),infos:[]};let a=null,l=!1;const c=new Set;if(ve(e)&&!this._hasSizeRamp){const t=await(0,K.Zo)(e);o.infos.push({label:null,symbol:t})}else if(function(e){const t="authoringInfo"in e?e?.authoringInfo:null;return"univariate-color-size"===t?.type}(e)){let t=i;const s=function(e){const t="authoringInfo"in e?e?.authoringInfo:null;return"univariate-color-size"===t?.type&&"above-and-below"===t?.univariateTheme}(e)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",n=r.findIndex((e=>"color-ramp"===e.type)),o=-1!==n?r.splice(n,1)[0]:null,a=r.findIndex((e=>"size-ramp"===e.type)),l=-1!==a?r.splice(a,1)[0]:null,c=[];o&&(t=o.title,c.push(o)),l&&(t=l.title,c.push(l)),c.length>0&&r.push({type:s,title:t,infos:c})}else if(Ie(e)){const t=(0,B.Y)(e);r.push({type:"heatmap-ramp",title:i||this._getRendererTitle(e,n),infos:t,preview:(0,N.J0)(t.map((e=>e.color)),{effectList:this.effectList,ariaLabel:await De("previewColorRampAriaLabel")})})}else if(Ee(e)){const t=e&&e.authoringInfo;if(t&&"relationship"===t.type){const{numClasses:i,field1:s,field2:a}=t,l=t.focus;if(i&&s&&a){const t=[s,a];let d=(0,z.zv)(l)||0;for(const e of t){const{field:t,normalizationField:i,label:s}=e,r=s||{field:this._getFieldAlias(t,n),normField:i&&this._getFieldAlias(i,n)},a=Ve.clone();a.angle=d,o.infos.push({label:r,symbol:a}),c.add(a),d+=90}const u=(0,z.Jr)({focus:l,numClasses:i,infos:e.uniqueValueInfos??[]});r.unshift(u)}}else if(Pe(this.layer)||Fe(this.layer))e.uniqueValueInfos?.forEach((e=>{e.symbol&&o.infos.push({label:e.label||e.value,value:e.value,symbol:e.symbol})}));else{const{field:t,field2:s,field3:r,fieldDelimiter:a,valueExpression:c,defaultSymbol:d}=e,u=!(!t&&!c||!s&&!r),h=[];if(e.uniqueValueGroups?.forEach((e=>{const i={type:"symbol-table",title:e.heading,infos:[]};e.classes?.forEach((e=>{const{symbol:o,values:l}=e;if(o){const d=[],h=[];for(const e of l??[]){const{value:i,value2:o,value3:l}=e,p=[],y=[];(t||c)&&(p.push(i),y.push(this._getDomainName(t,i,n))),s&&(p.push(o),y.push(this._getDomainName(s,o,n))),r&&(p.push(l),y.push(this._getDomainName(r,l,n))),d.push(u?p.join(a||""):p[0]),h.push(y.join(" - "))}const p=d.join(", ");let y=e.label;if(!y){const e=h.filter(Boolean);y=e.length?e.join(", "):p}i.infos.push({label:y,value:p,symbol:o})}})),i.infos.length&&h.push(i)})),h.length){const t=h[0];1===h.length&&"title"in t&&!t.title?o.infos.push(...t.infos??[]):(d&&(h.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:d}]}),l=!0),o.infos.push(...h)),i||e.legendOptions?.title||e.valueExpressionTitle||(o.title=null)}}e.defaultSymbol&&!l&&(o.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),l=!0)}else if(Le(e))a=this._isUnclassedRenderer(e),(!a||!this._hasSizeRamp)&&(e.classBreakInfos.forEach((e=>{e.symbol&&o.infos.unshift({label:e.label||(a?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),a&&(o.title=null),this._updateInfosforClassedSizeRenderer(e,o.infos)),e.defaultSymbol&&!a&&(o.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),l=!0);else if(we(e))if(Fe(this.layer)||function(e){return"esri.layers.WCSLayer"===e.declaredClass}(this.layer)){const t=await this._constructTileImageryStretchRendererElements(e);!function(e){return"stretch-ramp"===e.type}(t)?o.infos=t:r.push(t)}else{const t=this.layer;let i,s;if(e.statistics?.length){const t=e.statistics[0];(0,K.sx)(t)?(i=t.min,s=t.max):[i,s]=t}let n=[],a=t.serviceRasterInfo;if(t.rasterFunction)try{a=await t.generateRasterInfo(t.rasterFunction)}catch{}const l=(0,x.h)(a.pixelType);if(1===a.bandCount){const n=t.bandIds?.[0]||0;i=null!=i?i:a.statistics?a.statistics[n].min:l[0],s=null!=s?s:a.statistics?a.statistics[n].max:l[1],i||s?r.push(await this._getStretchLegendElements(e,{min:i,max:s})):this._getServerSideLegend()}else if(t.bandIds&&1===t.bandIds.length)i=null!=i?i:a.statistics?a.statistics[t.bandIds[0]].min:l[0],s=null!=s?s:a.statistics?a.statistics[t.bandIds[0]].max:l[1],i||s?r.push(await this._getStretchLegendElements(e,{min:i,max:s})):this._getServerSideLegend();else if(a.bandCount>=3){const{bandInfos:e}=a,{bandIds:i}=t;e.length>=a.bandCount?3===i?.length?(n=i.map((t=>e[t].name)),o.infos=this._createSymbolTableElementMultiBand(n)):"lerc"===t.format?(n=[0,1,2].map((t=>e[t].name)),o.infos=this._createSymbolTableElementMultiBand(n)):this._getServerSideLegend():"lerc"===t.format?(n=["band1","band2","band3"],o.infos=this._createSymbolTableElementMultiBand(n)):this._getServerSideLegend()}else this._getServerSideLegend()}else if(be(e))e.colormapInfos.forEach((e=>{o.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(fe,e.color)})}));else if(Me(e)){let i=e.symbol;switch(t.geometryType){case"point":i="pointSymbol"in n?n.pointSymbol:null;break;case"polyline":i="lineSymbol"in n?n.lineSymbol:null;break;case"polygon":i="polygonSymbol"in n?n.polygonSymbol:null}const s=this._hasClusterSizeVariable&&this._getClusterSymbol()||!this._hasSizeRamp;e.symbol&&s&&o.infos.push({label:e.label,symbol:i})}else if(_e(e)){e.outputUnit&&(this.title="("+e.toJSON().outputUnit+")"),o.title=e.attributeField;const t=e.getClassBreakInfos();t?.length?t.forEach((e=>{o.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):o.infos.push({label:e.attributeField,symbol:e.getDefaultSymbol()})}else Se(e)&&r.push(await this._getStretchLegendElements(e,{min:0,max:255}));const d=e.defaultSymbol;!d||l||Me(e)||a&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||r.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:d}]}),o.infos.length&&r.unshift(o);const u=null==t.opacity?this.opacity:t.opacity,h=this._isTallSymbol("visualVariables"in e?e.visualVariables:null),p=Pe(this.layer)||Fe(this.layer),y=r.reduce(((e,t)=>[...e,...this._getAllInfos(t)]),[]).filter((e=>!!e?.symbol)).filter((e=>{if("cim"===e.symbol.type){const{minScale:t,maxScale:i}=e.symbol.data;if(t&&t<this.scale||i&&i>this.scale)return!1}return!0})).map((e=>this._getSymbolPreview(e,u,{isDefault:e.symbol===d,applyScaleDrivenSize:!c.has(e.symbol),symbolConfig:{isTall:h,isSquareFill:p},effectList:c.has(e.symbol)?null:this.effectList})));return e=null,await Promise.allSettled(y),r}_getServerSideLegend(){setTimeout((()=>this.buildLegendElementsForTools()),0)}_getAllInfos(e){const t=e?.infos;return t?t.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]):[e]}async _constructTileImageryStretchRendererElements(e){const t=this.layer,i=t.symbolizer.rasterInfo??t.raster.rasterInfo;let s,n;const r=e?.statistics?.length?e.statistics:i?.statistics;if(r){const e=r[0];(0,K.sx)(e)?(s=e.min,n=e.max):[s,n]=e}else{const e=(0,x.h)(i.pixelType);s=e[0],n=e[1]}if(t.hasStandardTime()&&(s=t.getStandardTimeValue(s),n=t.getStandardTimeValue(n)),1===i.bandCount||1===t.bandIds?.length)return this._getStretchLegendElements(e,{min:s,max:n});const o=(t?.bandIds?.length?t.bandIds:Array.from(Array(Math.min(i.bandCount,3)).keys())).map((e=>i.bandInfos[e].name));return o.length<3?o.push(o[1]):o.length>3&&o.splice(3),this._createSymbolTableElementMultiBand(o)}async _getStretchLegendElements(e,t){const i=e.colorRamp,s=(0,$.k4)(i,t);return{type:"stretch-ramp",title:"",infos:s,preview:(0,N.J0)(s.map((e=>e.color)),{ariaLabel:await De("previewColorRampAriaLabel")})}}_getClusterSymbol(){const e=this.layer,t="featureReduction"in e&&e.featureReduction,i=t&&"symbol"in t&&t.renderer;return i&&!0!==i?.authoringInfo?.isAutoGenerated?null:t&&"symbol"in t?t.symbol:null}async _getSizeLegendElement(e,t,i,s){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:await X(i,t,await(0,K.uM)(i),this.scale,this.view,s,this._hasClusterSizeVariable?this._getClusterSymbol():null)}}_createSymbolTableElementMultiBand(e){const t=[],i=["red","green","blue"];return e.forEach(((e,s)=>{t.push({label:{colorName:i[s],bandName:e},src:K.E2[s],opacity:this.opacity??1})})),t}_updateInfosforClassedSizeRenderer(e,t){const i=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,s=e.classBreakInfos.some((e=>(0,D.$d)(e.symbol)));if(i&&s){const i=30,s=12,n=e.classBreakInfos.length,r=(i-s)/(n>1?n-1:n);t.forEach(((e,t)=>{e.size=i-r*t}))}}_isTallSymbol(e){let t=!1,i=!1;if(e)for(let s=0;s<e.length&&(!t||!i);s++){const n=e[s];"size"===n.type&&("height"===n.axis&&(t=!0),"width-and-depth"===n.axis&&(i=!0))}return t&&i}async _getSymbolPreview(e,t,s){let n=!s?.isDefault&&null==e.size&&this._hasSizeRamp?(0,b.PN)(P.CB.size):e.size;if(this._scaleDrivenSizeVariable&&s?.applyScaleDrivenSize){const{getSize:t}=await Promise.resolve().then(i.bind(i,28479));n=t(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null})}const r=!s?.isDefault&&this._hasSizeRamp||!(!this._scaleDrivenSizeVariable||!s?.applyScaleDrivenSize);return(0,N.Gr)(e.symbol,{size:n,opacity:t,scale:!1,symbolConfig:s?.symbolConfig,effectView:s?.effectList,style:"legend",cimOptions:{allowScalingUp:r,viewParams:this.isScaleDriven?{viewingMode:"2d"===this.view?.type?"map":this.view?.viewingMode,scale:this.view?.scale}:null},ariaLabel:e.label&&"string"!=typeof e.label?null:await De("previewTemplateAriaLabel",e.label)}).then((t=>(e.preview=t,e))).catch((()=>(e.preview=null,e)))}_getClusterRenderer(e){this._hasClusterSizeVariable=!1;const t="renderer"in this.layer?this.layer.renderer:null,i=e.renderer?.clone()||t?.clone(),s=G(this.layerView._effectiveRenderer,this.view);if(s&&null!=i&&"visualVariables"in i){const t=i.visualVariables?.some((e=>"size"===e.type&&"outline"!==e.target&&!ye.test(e.valueExpression)));if(!t){if("clusterMinSize"in e&&"clusterMaxSize"in e){const{clusterMinSize:t,clusterMaxSize:i}=e;s.legendOptions=new O.A({showLegend:t!==i})}const t=i.visualVariables||[];i.visualVariables=t.concat([s]),this._hasClusterSizeVariable=!0}}return i}async _loadRenderer(e){const t=[],i=e.clone(),s=await(0,K.uM)(i);if(Le(i)||Ee(i)){const e=(i.classBreakInfos||i.uniqueValueInfos).map((e=>this._fetchSymbol(e.symbol,s).then((t=>{e.symbol=t})).catch((()=>{e.symbol=null}))));Array.prototype.push.apply(t,e)}return t.push(this._fetchSymbol(i.symbol||i.defaultSymbol,i.defaultSymbol?null:s).then((e=>{this._applySymbolToRenderer(i,e,Me(i))})).catch((()=>{this._applySymbolToRenderer(i,null,Me(i))}))),await Promise.allSettled(t),i}_applySymbolToRenderer(e,t,i){i?e.symbol=t:e.defaultSymbol=t}async _fetchSymbol(e,t){if(!e)throw new Error;if("web-style"===e.type){const i=this._webStyleSymbolCache;try{const s=await("2d"===this.view.type?e.fetchCIMSymbol({cache:i}):e.fetchSymbol({cache:i}));return this._getAppliedCloneSymbol(s,t)}catch{throw v.A.getLogger(this).warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;const i=e.clone(),s=t&&t.toRgba();return i.type.includes("3d")?this._applyColorTo3dSymbol(i,s):"cim"===i.type?(0,Z.Fe)(i,t):i.color&&(i.color=new p.A(s||i.color)),i}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach((e=>{e&&(e.material||(e.material={}),e.material.color=new p.A(t))}))}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||"vector-field"===e.type)return null;const i=e.visualVariables,s=[],n=[],r=[];for(const a of i)"color"===a.type?s.push(a):"size"===a.type?n.push(a):"opacity"===a.type&&r.push(a);const o=[...s,...n,...r];let l,c;if(0===s.length&&Le(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];l=t&&t.symbol}if(0===s.length&&Me(e)&&(l=e.symbol),l)if(l.type.includes("3d")){const e=l.symbolLayers.at(0);"water"===e.type?null!=e.color&&(c=e.color):null!=e.material?.color&&(c=e.material.color)}else l.url||(c=l.color);const d=this.effectList;return(await Promise.all(o.map((async i=>{if(!i.legendOptions||!1!==i.legendOptions.showLegend){const s=ve(e)?i.field:this._getRampTitle(i,t);let n=null;const r=this._getDateFormatOptions(t,i);if("color"===i.type){const e=await(0,$.Cm)(i,null,r)??[];n={type:"color-ramp",title:s,infos:e,preview:(0,N.J0)(e.map((e=>e.color)),{effectList:d,ariaLabel:await De("previewColorRampAriaLabel")})},this._hasColorRamp||(this._hasColorRamp=e.length>0)}else if("size"===i.type&&"outline"!==i.target)ye.test(i.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=i):(n=await this._getSizeLegendElement(s,i,e,r),this._hasSizeRamp||(this._hasSizeRamp=!(null==n.infos||!n.infos.length)));else if("opacity"===i.type){const e=await(0,$.Cm)(i,c,r)??[];n={type:"opacity-ramp",title:s,infos:e,preview:(0,N.J0)(e.map((e=>e.color)),{effectList:d,ariaLabel:await De("previewColorRampAriaLabel")})},this._hasOpacityRamp||(this._hasOpacityRamp=e.length>0)}return n&&n.infos?n:null}})))).filter(a.Ru)}_getFieldInfo(e,t){if(!t.field)return null;if("featureReduction"in e)switch(e.featureReduction?.type){case"cluster":case"binning":{const i=e.featureReduction.fields.find((({name:e})=>e.toLowerCase()===t.field.toLowerCase()));return i&&"getField"in e?e.getField(i.onStatisticField):null}}return"getField"in e?e.getField?.(t.field):null}_getDateFormat(e,t){const i="popupTemplate"in e?e.popupTemplate?.fieldInfos:null;if(i?.length&&t)return i.find((e=>e.fieldName?.toLowerCase()===t.toLowerCase()))?.format?.dateFormat}_getDateFormatOptions(e,t){const i=this._getFieldInfo(e,t);if(!i||!(0,k.fs)(i)&&!(0,T.OH)(i))return null;let s=this._getDateFormat(e,i.name);if(!s&&"date"===i.type){let e=0,i=0;t.stops?(e=t.stops?.at(0)?.value??e,i=t.stops?.at(-1)?.value??i):"minDataValue"in t&&"maxDataValue"in t&&(e=t.minDataValue??e,i=t.maxDataValue??i),s=i-e>2*w.vf.days?"short-date":"short-date-short-time"}return{fieldType:i.type,format:s,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in e?e.preferredTimeZone:null,viewTimeZone:this.view.timeZone,datesInUnknownTimezone:"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone}}}_getDomainName(e,t,i){if(e&&"function"!=typeof e){const s="getField"in i&&i.getField?.(e),n=s&&"getFieldDomain"in i&&i.getFieldDomain?i.getFieldDomain(s.name):null;return"coded-value"===n?.type?n.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,i=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,s="popupTemplate"in e&&e.popupTemplate,n=s&&s.fieldInfos;if(n)for(const t of n)if(t.fieldName===i)return"cluster_count"===i?t.label||{showCount:!0}:t.label}return{showCount:!0}}_getRampTitle(e,t){let i=e.field,s=e.normalizationField,n=!1,r=!1,o=!1,a=null;i="function"==typeof i?null:i,s="function"==typeof s?null:s;const l=e.legendOptions?.title;if(null!=l)a=l;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo?.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const i=e[t];if("color"===i.type){if("ratio"===i.style){n=!0;break}if("percent"===i.style){r=!0;break}if("percent-of-total"===i.style){o=!0;break}}}}a={field:i&&this._getFieldAlias(i,t),normField:s&&this._getFieldAlias(s,t),ratio:n,ratioPercent:r,ratioPercentTotal:o}}return a}_getRendererTitle(e,t){const i=e;if(i.legendOptions?.title)return i.legendOptions.title;if(i.valueExpressionTitle)return i.valueExpressionTitle;let s=i.field,n=null,r=null;if(Le(i)&&(n=i.normalizationField,r="percent-of-total"===i.normalizationType),s="function"==typeof s?null:s,n="function"==typeof n?null:n,Ee(i)){const{field2:e,field3:n,fieldDelimiter:r}=i;let o=s&&this._getFieldAlias(s,t);return e&&(o=`<${o}>${r}<${this._getFieldAlias(e,t)}>`,n&&(o=`${o}${r}<${this._getFieldAlias(n,t)}>`)),o}let o=null;return(s||n)&&(o={field:s&&this._getFieldAlias(s,t),normField:n&&this._getFieldAlias(n,t),normByPct:r}),o}_getFieldAlias(e,t){const i="popupTemplate"in t?t.popupTemplate:null,s=i?.fieldInfos;let n;s&&s.some((t=>e===t.fieldName&&(n=t,!0)));let r=null;"getField"in t&&t.getField?r=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(r=t.fieldsIndex.get(e));let o=null;const a="featureReduction"in t&&t.featureReduction;a&&(!n&&"popupTemplate"in a&&a.popupTemplate?.fieldInfos&&a.popupTemplate.fieldInfos.some((t=>e?.toLowerCase()===t.fieldName?.toLowerCase()&&(n=t,!0))),"fields"in a&&a.fields&&(o=a.fields.find((t=>t.name?.toLowerCase()===e?.toLowerCase()))));const l=n||r||o;let c=null;return l&&(c=n?.label||r?.alias||o?.alias||"name"in l&&l.name||"fieldName"in l&&l.fieldName||null),c}_isUnclassedRenderer(e){const t=e.visualVariables;let i=!1;return Le(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(i=e.field?t.some((t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField))):!!t.length),i}};(0,s._)([(0,r.MZ)()],$e.prototype,"children",void 0),(0,s._)([(0,r.MZ)({readOnly:!0})],$e.prototype,"effectList",null),(0,s._)([(0,r.MZ)()],$e.prototype,"layerView",void 0),(0,s._)([(0,r.MZ)()],$e.prototype,"layer",void 0),(0,s._)([(0,r.MZ)()],$e.prototype,"legendElements",void 0),(0,s._)([(0,r.MZ)({readOnly:!0})],$e.prototype,"opacity",null),(0,s._)([(0,r.MZ)()],$e.prototype,"parent",void 0),(0,s._)([(0,r.MZ)({readOnly:!0,dependsOn:[]})],$e.prototype,"ready",null),(0,s._)([(0,r.MZ)()],$e.prototype,"hideLayersNotInCurrentView",void 0),(0,s._)([(0,r.MZ)()],$e.prototype,"keepCacheOnDestroy",void 0),(0,s._)([(0,r.MZ)()],$e.prototype,"respectLayerVisibility",void 0),(0,s._)([(0,r.MZ)({readOnly:!0})],$e.prototype,"scale",null),(0,s._)([(0,r.MZ)()],$e.prototype,"sublayerIds",void 0),(0,s._)([(0,r.MZ)({readOnly:!0})],$e.prototype,"isScaleDriven",null),(0,s._)([(0,r.MZ)()],$e.prototype,"title",void 0),(0,s._)([(0,r.MZ)({readOnly:!0,dependsOn:["ready"],value:0})],$e.prototype,"version",null),(0,s._)([(0,r.MZ)()],$e.prototype,"view",void 0),$e=(0,s._)([(0,l.$)("esri.widgets.Legend.support.ActiveLayerInfo")],$e);const Be=$e;var ze=i(91109);const He="state",Ke="view",je="all-layer-views",Ue="legend-properties",qe=u.A.ofType(Be),We=new Set(["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.SubtypeGroupLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer","esri.layers.LinkChartLayer","esri.layers.knowledgeGraph.KnowledgeGraphSublayer"]),Je="view.basemapView.baseLayerViews",Ye="view.groundView.layerViews",Qe="view.basemapView.referenceLayerViews",Xe=[Je,Ye,"view.layerViews",Qe];let et=class extends d.A{constructor(e){super(e),this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new u.A,this.activeLayerInfos=new qe,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this.addHandles((0,n.wB)((()=>this.view),(()=>this._viewHandles()),n.Vh),Ke),this.addHandles((0,ze.oQ)((()=>this._refresh())))}destroy(){this._destroyViewActiveLayerInfos(),this.view=null}get state(){return this.view?.ready?"ready":"disabled"}_viewHandles(){this.removeHandles(He),this.view&&this.addHandles((0,n.wB)((()=>this.state),(()=>this._stateHandles()),n.Vh),He)}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this.removeHandles([je,Ue]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this.removeHandles(e);const t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t?.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){const{view:e}=this;if(!e)return;const{allLayerViews:t}=e;t.length&&this._refresh(),this.addHandles(t.on("change",(e=>this._allLayerViewsChangeHandle(e))),je),this.addHandles((0,n.wB)((()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible]),(()=>this._propertiesChangeHandle())),Ue)}_allLayerViewsChangeHandle(e){e.removed.forEach((e=>this._destroyViewActiveLayerInfo(e.uid))),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){const t=this.view;if(e.length<2||!t)return;const i=[];e.forEach((t=>{if(!t.parent){const s=t.layer.parent,n=s&&"uid"in s&&this._layerViewByLayerId[s.uid],r=n&&this._activeLayerInfosByLayerViewId[n.uid];r&&e.includes(r)&&(i.push(t),t.parent=r,r.children.add(t),this._sortActiveLayerInfos(r.children))}})),e.removeMany(i);const s={};t.allLayerViews.forEach(((e,t)=>s[e.layer.uid]=t)),e.sort(((e,t)=>{const i=s[e.layer.uid]||0;return(s[t.layer.uid]||0)-i}))}_generateLayerViews(){const e=[];return Xe.filter(this._filterLayerViews,this).map((e=>(0,h.Jt)(this,e))).filter((e=>null!=e)).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const t=!this.basemapLegendVisible&&(e===Je||e===Qe),i=!this.groundLegendVisible&&e===Ye;return!t&&!i}_collectLayerViews(e,t){const i=s=>(s&&s.forEach((s=>{t.push(s),i(s[e])})),t);return i}_filterLayerViewsByLayerInfos(e){const t=this.layerInfos;return!t||!t.length||t.some((t=>this._hasLayerInfo(t,e)))}_hasLayerInfo(e,t){const i=this._isLayerUIDMatching(e.layer,t.layer.uid);return i&&(this._layerInfosByLayerViewId[t.uid]=e),i}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some((e=>this._isLayerUIDMatching(e,t)))}_isLayerViewSupported(e){return!!We.has(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this.removeHandles(e.uid),this.addHandles((0,n.wB)((()=>[e.legendEnabled,e.layer?.legendEnabled]),(()=>this._layerActiveHandle(e))),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this.removeHandles(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.layer?.legendEnabled}_buildActiveLayerInfo(e){const t=e.layer,i=e.uid,s=this._layerInfosByLayerViewId[i];let r=this._activeLayerInfosByLayerViewId[i];if(!r){const n=void 0!==s?.title&&s.layer.uid===t.uid;r=new Be({layer:t,layerView:e,title:n?s.title:t.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:s?.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=r}const o=t.parent&&"uid"in t.parent?this._layerViewByLayerId[t.parent?.uid]:null;if(r.parent=this._activeLayerInfosByLayerViewId[o?.uid],!this.hasHandles(i)){const s=[(0,n.wB)((()=>t.title),(e=>this._titleHandle(e,r))),(0,n.wB)((()=>[t.opacity,"renderer"in t&&t.renderer,"pointSymbol"in t&&t.pointSymbol,"lineSymbol"in t&&t.lineSymbol,"polygonSymbol"in t&&t.polygonSymbol]),(()=>this._constructLegendElements(r))),(0,n.z7)((()=>!0===this.view?.stationary),(()=>this._scaleHandle(r)),n.Vh),(0,n.wB)((()=>e._effectiveRenderer),(()=>this._constructLegendElements(r))),(0,n.wB)((()=>"effect"in t&&t.effect),(()=>this._constructLegendElements(r))),(0,n.z7)((()=>this.view?.timeZone),(()=>this._constructLegendElements(r)),n.Vh)];if(this.respectLayerVisibility){const i=(0,n.wB)((()=>e.legendEnabled),(e=>this._legendEnabledHandle(e,r))),o=(0,n.wB)((()=>t.legendEnabled),(e=>this._legendEnabledHandle(e,r)));s.push(i,o)}this.addHandles(s,i)}r.isScaleDriven||this._constructLegendElements(r),this._addActiveLayerInfo(r)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){const{layerView:t,layer:i}=e;if(this._isLayerActive(t)&&!this.activeLayerInfos.includes(e)){const t=e.parent;if(t)t.children.includes(e)||t.children.push(e),this._sortActiveLayerInfos(t.children);else{const t=this.layerInfos?.some((e=>e.layer.uid===i.uid));i.parent&&"uid"in i.parent&&!t?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach((t=>{const i=t.layer.parent,s=i&&"uid"in i?this._layerViewByLayerId[i?.uid]:null,n=this._activeLayerInfosByLayerViewId[s?.uid];n&&(e.push(t),t.parent=n)})),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach((e=>this._addActiveLayerInfo(e))))}}}_removeActiveLayerInfo(e){const t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){const t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"featureReduction"in t&&t.featureReduction&&"renderer"in t.featureReduction&&("binning"===t.featureReduction.type||"cluster"===t.featureReduction.type)?e.buildLegendElementsForFeatureReduction(t.featureReduction):"renderer"in t&&t.renderer&&!("sublayers"in t)?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url?e.buildLegendElementsForTools():e.children.forEach((e=>this._constructLegendElements(e)))}};(0,s._)([(0,r.MZ)({type:qe})],et.prototype,"activeLayerInfos",void 0),(0,s._)([(0,r.MZ)()],et.prototype,"basemapLegendVisible",void 0),(0,s._)([(0,r.MZ)()],et.prototype,"groundLegendVisible",void 0),(0,s._)([(0,r.MZ)()],et.prototype,"hideLayersNotInCurrentView",void 0),(0,s._)([(0,r.MZ)()],et.prototype,"keepCacheOnDestroy",void 0),(0,s._)([(0,r.MZ)()],et.prototype,"respectLayerVisibility",void 0),(0,s._)([(0,r.MZ)()],et.prototype,"layerInfos",void 0),(0,s._)([(0,r.MZ)({readOnly:!0})],et.prototype,"state",null),(0,s._)([(0,r.MZ)()],et.prototype,"view",void 0),et=(0,s._)([(0,l.$)("esri.widgets.Legend.LegendViewModel")],et);const tt=et;var it=i(61818);const st="esri-legend--card",nt="esri-legend",rt={activated:`${st}__carousel-indicator--activated`,base:st,stacked:`${nt}--stacked`,carouselTitle:`${st}__carousel-title`,indicator:`${st}__carousel-indicator`,intervalSeparator:`${st}__interval-separator`,imageryLayerStretchedImage:`${st}__imagery-layer-image--stretched`,imageLabel:`${st}__image-label`,layerCaption:`${st}__layer-caption`,labelElement:`${st}__label-element`,layerRow:`${st}__layer-row`,labelCell:`${st}__label-cell`,message:`${st}__message`,rampLabel:`${st}__ramp-label`,section:`${st}__section`,relationshipSection:`${st}__relationship-section`,serviceCaptionText:`${st}__service-caption-text`,serviceContent:`${st}__service-content`,service:`${st}__service`,groupLayer:`${st}__group-layer`,groupLayerChild:`${st}__group-layer-child`,symbol:`${st}__symbol`,sizeRampRow:`${st}__size-ramp-row`,symbolRow:`${st}__symbol-row`,symbolCell:`${st}__symbol-cell`,indicatorContainer:`${st}__carousel-indicator-container`,intervalSeparatorsContainer:`${st}__interval-separators-container`,relationshipLabelContainer:`${st}__relationship-label-container`,labelContainer:`${st}__label-container`,serviceCaptionContainer:`${st}__service-caption-container`,symbolContainer:`${st}__symbol-container`,sizeRampContainer:`${st}__size-ramp-container`,sizeRampPreview:`${st}__size-ramp-preview`,pieChartRampPreview:`${st}__pie-chart-ramp-preview`,rampContainer:`${nt}__ramps`,sizeRampHorizontal:`${nt}__size-ramp--horizontal`,rampLabelsContainer:`${nt}__ramp-labels`,layerInfo:`${nt}__layer-cell ${nt}__layer-cell--info`,univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card"};var ot=i(65257),at=(i(59078),i(40067)),lt=i(96704);const ct=(0,at.F)(),dt="esri-univariate-above-and-below-ramp__symbol",ut="esri-legend__color-ramp";function ht(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?(0,lt.K)("svg",{height:"4",width:"10"},(0,lt.K)("line",{style:t,x1:"0",x2:"10",y1:"2",y2:"2"})):(0,lt.K)("svg",{height:"10",width:"10"},(0,lt.K)("line",{style:t,x1:"5",x2:"5",y1:"0",y2:"10"}))}function pt(e,t="vertical"){const i=document.createElement("div");return i.style.height="20px",i.className=dt,null!=e&&(i.style.opacity=e.toString()),ct.append(i,ht.bind(null,t)),i}function yt(e,t,i="vertical",s){e.infos.forEach(((e,n)=>{if(s&&2===n)e.preview=pt(t,i);else{const t=(0,b.Lz)(e.size)+("horizontal"===i?20:10),s=e.preview,n="div"===s?.tagName.toLowerCase(),r=n?s:document.createElement("div");r.className=dt,"horizontal"===i?r.style.width=`${t}px`:r.style.height=`${t}px`,!n&&s&&r.appendChild(s),e.preview=r}}))}function gt(e,t="classic"){const i=e.infos;return"classic"===t?((0,b.Lz)(i[0].size)+10)/2:((0,b.Lz)(i[0].size)-(0,b.Lz)(i[i.length-1].size))/2}function mt(e,t){if(!e)return null;const i=e.infos.map((e=>e.color)),s=(0,N.J0)("full"===t.type?i:"above"===t.type?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList,ariaLabel:t.ariaLabel});return s.className=ut,null!=t.opacity&&(s.style.opacity=t.opacity.toString()),s}function ft(e,t,i,s="vertical"){let n=0;const r=e.infos,o=Math.floor(r.length/2),a="full"===t||"above"===t?0:o,l="full"===t||"below"===t?r.length-1:o;for(let c=a;c<=l;c++)n+=i&&c===o?"horizontal"===s?10:20:(0,b.Lz)(r[c].size)+("horizontal"===s?20:10);return Math.round(n)}function vt(e,t,i,s="vertical"){const n=ft(e,t,i,s),r=e.infos,o=Math.floor(r.length/2),a="full"===t||"above"===t?0:o,l="full"===t||"below"===t?r.length-1:o,c="full"===t?r[a].size+r[l].size:"above"===t?r[a].size:r[l].size,d=i?"vertical"===s?20:10:0,u="vertical"===s?10*("full"===t?2:1):20*("full"===t?2:1);return Math.round(n-((0,b.Lz)(c)/2+d/2+u/2))}function _t(e,t,i="vertical"){const s=e.infos;let n=s.find((({type:e})=>"size-ramp"===e)),r=s.find((({type:e})=>"color-ramp"===e));return n&&(n={...n},n.infos=[...n.infos],yt(n,t,i,!0)),r&&(r={...r},r.infos=[...r.infos]),"horizontal"===i&&(n?.infos.reverse(),r?.infos.reverse()),{sizeRampElement:n,colorRampElement:r}}function bt(e,t="vertical"){const i=e.infos;let s=i.find((({type:e})=>"size-ramp"===e)),n=i.find((({type:e})=>"color-ramp"===e));return s&&(s={...s},s.infos=[...s.infos],yt(s,null,t,!1)),n&&(n={...n},n.infos=[...n.infos]),"horizontal"===t&&(s?.infos.reverse(),n?.infos.reverse()),{sizeRampElement:s,colorRampElement:n}}var wt=i(96274);function St(e){e.appendChild(this)}function Mt(e,t,i){if(!t)return;if("number"==typeof t)return t;if("string"==typeof t)return(0,wt._e)(t);if("value"in t||"unit"in t)return(0,pe.V)(e.dotValue,t);if("colorName"in t&&"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:void 0;let s=null;return function(e,t){return t}(0,i)?s=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:Lt(t,i)&&(s=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),s?(0,pe.V)("showField"===s?"{field}":e[s],{field:t.field,normField:t.normField}):void 0}function Lt(e,t){return!t}function Et(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}function It(e,t){return e.label?t[e.label]+": "+("string"==typeof e.value?e.value:(0,de.ZV)(e.value??0,{style:"decimal",notation:e.value?.toString().toLowerCase().includes("e")?"scientific":"standard"})):""}var Tt=i(76943),Ct=i(60682),xt=i(43955);var At;!function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"}(At||(At={}));const Rt=window.devicePixelRatio;let Ot=class extends c.A{constructor(e,t){super(e,t),this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=At.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.addHandles((0,n.wB)((()=>this.activeLayerInfos),(e=>{this.removeAllHandles(),this._watchForSectionChanges(e)})))}render(){const{view:e}=this;this._hasIndicators=this.layout===At.Auto&&e&&e.container.clientWidth<=768||this.layout===At.Stack;const t=this.activeLayerInfos,i=t&&t.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const s=this._sectionNames.length,n=this._sectionNames.map(((e,t)=>{const i=(0,pe.V)(this.messagesCommon.pagination.pageText,{index:t+1,total:s});return(0,lt.K)("div",{"aria-controls":`${e}-panel`,"aria-label":i,"aria-selected":(this._selectedSectionName===e).toString(),bind:this,class:this.classes(rt.indicator,{[rt.activated]:this._selectedSectionName===e}),"data-section-name":e,id:e,key:e,onclick:this._selectSection,onkeydown:this._focusSection,role:"tab",tabIndex:this._selectedSectionName===e?0:-1,title:i})})),r=this._hasIndicators&&s>1?(0,lt.K)("div",{class:rt.indicatorContainer,key:"carousel-navigation",role:"tablist"},n):null,o=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):i&&i.length?i:null,a={[rt.stacked]:this._hasIndicators};return(0,lt.K)("div",{class:this.classes(rt.base,a)},o||(0,lt.K)("div",{class:rt.message},this.messages.noLegend),r)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const t=e.key,i="ArrowLeft"===t?-1:1,s=e.target.getAttribute("data-section-name"),n=this._sectionNames.indexOf(s),r=this._sectionNames;let o=null;-1!==n&&(r[n+i]?o=document.getElementById(r[n+i]):"ArrowLeft"===t?o=document.getElementById(r[r.length-1]):"ArrowRight"===t&&(o=document.getElementById(r[0])),o?.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const t=`activeLayerInfo-${e.layer.uid}-version-change`;this.removeHandles(t),this._watchForSectionChanges(e.children),this.addHandles((0,n.wB)((()=>e.version),(()=>this._generateSectionNames())),t)}));const t="activeLayerInfos-collection-change";this.removeHandles(t),this.addHandles(e.on("change",(()=>this._watchForSectionChanges(e))),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,i){return`${this.id}${e.uid}-type-${t.type}-${i}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((t,i)=>{this._sectionNames.push(this._getSectionName(e.layer,t,i))}))}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return(0,lt.K)("div",{class:this.classes(rt.service,rt.groupLayer),key:e.layer.uid},(0,lt.K)("div",{class:rt.serviceCaptionContainer},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const i=t.some((e=>"relationship-ramp"===e.type)),s=t.map(((t,s)=>this._renderLegendForElement(t,e,s,i))).filter((e=>!!e));if(!s.length)return null;const n={[rt.groupLayerChild]:!!e.parent};return(0,lt.K)("div",{class:this.classes(rt.service,n),key:e.layer.uid},(0,lt.K)("div",{class:rt.serviceCaptionContainer},(0,lt.K)("div",{class:rt.serviceCaptionText},e.title)),(0,lt.K)("div",{class:rt.serviceContent},s))}}_renderLegendForElement(e,t,i,s=!1,n=!1){const r="color-ramp"===e.type,o="opacity-ramp"===e.type,a=t.layer;let l=null;if("string"==typeof e.title)l=e.title;else if(e.title){const t=e.title,i=Mt(this.messages,t,r||o);l=t.title?`${t.title} (${i})`:i}const c=this._getSectionName(a,e,i),d=this._hasIndicators&&!n?(0,lt.K)("div",null,(0,lt.K)(Tt.D,{class:rt.carouselTitle,level:this.headingLevel},t.title),(0,lt.K)(Tt.D,{class:rt.layerCaption,level:(0,Tt.S)(this.headingLevel)},l)):l?(0,lt.K)(Tt.D,{class:rt.layerCaption,level:this.headingLevel},l):null,u=t.effectList;let h=null;switch(e.type){case"symbol-table":{const i=e.infos.map(((i,s)=>this._renderLegendForElementInfo(i,t,e.legendType,s))).filter((e=>!!e));if(i.length){const e=i[0].properties.classes?.[rt.symbolRow],t={[rt.labelContainer]:!e&&!s,[rt.relationshipLabelContainer]:s};h=(0,lt.K)("div",{class:this.classes(t)},i)}break}case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":h=this._renderLegendForRamp(e,a.opacity,u);break;case"size-ramp":h=this._renderSizeRamp(e,a.opacity);break;case"pie-chart-ramp":h=this._renderPieChartRamp(e);break;case"relationship-ramp":h=(0,ot.p)(e,this.id,{opacity:a.opacity,effectList:u,ariaLabel:this.messages.previewRelationshipRampAriaLabel});break;case"univariate-above-and-below-ramp":h=this._renderUnivariateAboveAndBelowRamp(e,a.opacity,u);break;case"univariate-color-size-ramp":h=this._renderUnivariateColorSizeRamp(e,a.opacity,u)}if(!h)return null;const p=(0,lt.K)("div",{"aria-labelledby":c,class:rt.section,id:`${c}-panel`,key:c,role:"tabpanel",tabIndex:0},[d,h]);return n||this._sectionMap.set(c,p),p}_renderPieChartRamp(e){return(0,lt.K)("div",{afterCreate:St,bind:e.preview,class:rt.pieChartRampPreview})}_renderUnivariateAboveAndBelowRamp(e,t,i){const{sizeRampElement:s,colorRampElement:n}=_t(e,t,"horizontal");if(!s)return null;const r=ft(s,"full",!0,"horizontal"),o=vt(s,"above",!0,"horizontal"),a=vt(s,"below",!0,"horizontal"),l=this.messages?.previewColorRampAriaLabel,c=mt(n,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:i,ariaLabel:l}),d=mt(n,{width:a,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:i,ariaLabel:l}),u=gt(s,"card"),h=s.infos.map((e=>e.label)),p=h.length-1,y=h.map(((e,t)=>0===t||t===p?(0,lt.K)("div",{key:t},e):null)),g={marginTop:"3px",display:"flex"};(0,j.V8)(this.container)?g.marginRight=`${u}px`:g.marginLeft=`${u}px`;const m={width:`${r}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,lt.K)("div",{class:rt.layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,lt.K)("div",{class:this.classes(rt.symbolContainer,rt.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},s.infos.map(((e,t)=>(0,lt.K)("div",{afterCreate:St,bind:e.preview,class:rt.symbol,key:t})))),c?(0,lt.K)("div",{class:rt.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:g},(0,lt.K)("div",{afterCreate:St,bind:c}),(0,lt.K)("div",{afterCreate:St,bind:d})):null,(0,lt.K)("div",{class:rt.layerInfo},(0,lt.K)("div",{class:rt.rampLabelsContainer,styles:m},y)))}_renderUnivariateColorSizeRamp(e,t,i){const{sizeRampElement:s,colorRampElement:n}=bt(e,"horizontal");if(!s)return null;const r=ft(s,"full",!1,"horizontal"),o=mt(n,{width:vt(s,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:i,ariaLabel:this.messages?.previewColorRampAriaLabel}),a=gt(s,"card"),l=s.infos.length-1,c=s.infos.map(((e,t)=>0===t||t===l?(0,lt.K)("div",{key:t},e.label):null)),d={marginTop:"3px",display:"flex"};(0,j.V8)(this.container)?d.marginRight=`${a}px`:d.marginLeft=`${a}px`;const u={width:`${r}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,lt.K)("div",{class:rt.layerRow,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,lt.K)("div",{class:this.classes(rt.symbolContainer,rt.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},s.infos.map(((e,t)=>(0,lt.K)("div",{afterCreate:St,bind:e.preview,class:rt.symbol,key:t})))),(0,lt.K)("div",{class:rt.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:d},(0,lt.K)("div",{afterCreate:St,bind:o})),(0,lt.K)("div",{class:rt.layerInfo},(0,lt.K)("div",{class:rt.rampLabelsContainer,styles:u},c)))}_renderLegendForElementInfo(e,t,i,s){const n=t.layer;if(e.type)return this._renderLegendForElement(e,t,s,!1,!0);const r=Et(n,i),o=Mt(this.messages,e.label,!1)??"";if(e.preview){if(!e.symbol?.type.includes("simple-fill")){if(!e.label)return(0,lt.K)("div",{afterCreate:St,bind:e.preview,key:s});const t={[rt.symbolCell]:this._hasIndicators};return(0,lt.K)("div",{class:this.classes(rt.layerRow,{[rt.symbolRow]:this._hasIndicators}),key:s},(0,lt.K)("div",{afterCreate:St,bind:e.preview,class:this.classes(t)}),(0,lt.K)("div",{class:this.classes(rt.imageLabel,{[rt.labelCell]:this._hasIndicators})},o))}let i=255,r=255,a=255,l=0,c=255,d=255,u=255,h=0;const p=e.symbol.color?.a,y=e.symbol.outline?.color?.a;p&&(i=e.symbol.color.r,r=e.symbol.color.g,a=e.symbol.color.b,l=e.symbol.color.a*n.opacity),y&&(c=e.symbol.outline.color.r,d=e.symbol.outline.color.g,u=e.symbol.outline.color.b,h=e.symbol.outline.color.a*n.opacity);const g=e.symbol.color?.isBright??!0,m=g?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",f={background:p?`rgba(${i}, ${r}, ${a}, ${l})`:"none",color:g?"black":"white",textShadow:`-1px -1px 0 ${m},\n                                              1px -1px 0 ${m},\n                                              -1px 1px 0 ${m},\n                                              1px 1px 0 ${m}`,border:y?`1px solid rgba(${c}, ${d}, ${u}, ${h})`:"none",filter:(0,D.di)(t.effectList)??void 0};return(0,lt.K)("div",{class:rt.layerRow,key:s},(0,lt.K)("div",{class:rt.labelElement,styles:f},o))}if(e.src){const t=this._renderImage(e,n,r);return(0,lt.K)("div",{class:rt.layerRow,key:s},t,(0,lt.K)("div",{class:rt.imageLabel},o))}}_renderImage(e,t,i){const{label:s,src:n,opacity:r}=e,o={[rt.imageryLayerStretchedImage]:i,[rt.symbol]:!i},a={opacity:`${null!=r?r:t.opacity}`};return(0,lt.K)("img",{alt:Mt(this.messages,s,!1),"aria-label":Mt(this.messages,s,!1),border:0,class:this.classes(o),height:e.height,src:n,styles:a,width:e.width})}_renderSizeRampLines(e){const t=e.infos,i=t[0],s=t[t.length-1],n=i.symbol,r=this._hasIndicators,o=(0,b.Lz)(i.size+i.outlineSize)*Rt,a=(0,b.Lz)(s.size+s.outlineSize)*Rt,l=r?o:o+50*Rt,c=r?o/2+50*Rt:o,d=function(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers?.length;if(!t)return;const i=e.symbolLayers.at(t-1).get("resource.primitive");return"triangle"===i||"cone"===i||"tetrahedron"===i}return"triangle"===e.style}}(n),u=function(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers?.length;if(!t)return;const i=e.symbolLayers.at(t-1),s=i.resource?.primitive;return"circle"===s||"cross"===s||"kite"===s||"sphere"===s||"cube"===s||"diamond"===s}{const t=e.style;return"circle"===t||"diamond"===t||"cross"===t}}}(n),h=document.createElement("canvas");h.width=l,h.height=c,h.style.width=h.width/Rt+"px",h.style.height=h.height/Rt+"px";const p=h.getContext("2d");if(r){p.beginPath();const e=0,t=0,i=l/2-a/2,s=c;p.moveTo(e,t),p.lineTo(i,s);const n=l,r=0,o=l/2+a/2,d=c;p.moveTo(n,r),p.lineTo(o,d)}else{p.beginPath();const e=0,t=c/2-a/2,i=l,s=0;p.moveTo(e,t),p.lineTo(i,s);const n=0,r=c/2+a/2,o=l,d=c;p.moveTo(n,r),p.lineTo(o,d)}return p.strokeStyle="#ddd",p.stroke(),(0,lt.K)("div",{afterCreate:St,bind:h,styles:r?{display:"flex",marginTop:`-${d?0:u?o/2:0}px`,marginBottom:`-${d?a:u?a/2:0}px`}:{display:"flex",marginRight:`-${d?0:u?o/2:0}px`,marginLeft:`-${d?0:u?a/2:0}px`}})}_renderSizeRamp(e,t){const i=e.infos,s=i[0].label,n=i[i.length-1].label;let r=i[0].preview,o=i[i.length-1].preview;const a=this._hasIndicators,l={"flex-direction":a?"column":"row-reverse"};r&&(r=r.cloneNode(!0),r.style.display="flex"),o&&(o=o.cloneNode(!0),o.style.display="flex");const c={opacity:null!=t?`${t}`:""};return(0,lt.K)("div",{class:this.classes(rt.layerRow,{[rt.sizeRampRow]:a})},(0,lt.K)("div",{class:rt.rampLabel},a?s:n),(0,lt.K)("div",{class:rt.sizeRampContainer,styles:l},(0,lt.K)("div",{afterCreate:St,bind:r,class:rt.sizeRampPreview,styles:c}),this._renderSizeRampLines(e),(0,lt.K)("div",{afterCreate:St,bind:o,class:rt.sizeRampContainer,styles:c})),(0,lt.K)("div",{class:rt.rampLabel},a?n:s))}_getRampStopLabel(e,t){switch(t){case"heatmap-ramp":return this.messages[e.label];case"stretch-ramp":return It(e,this.messages);default:return e.label}}_renderLegendForRamp(e,t,i){const s=e.infos,n=e.type,r="heatmap-ramp"===n,o=s.length-1,a=25,l=o>2&&!r?25*o:100,c=l+20,d=10,u=s.slice(0).reverse(),h=u.length-1,p=u.length%2!=0?u[u.length/2|0]:null,y=p&&(0,lt.K)("div",{class:rt.intervalSeparatorsContainer},(0,lt.K)("div",{class:rt.intervalSeparator},"|"),(0,lt.K)("div",{class:rt.rampLabel},this._getRampStopLabel(p,n))),g=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:u[0].color,stroke:{width:0}},{shape:{type:"rect",x:d,y:0,width:l,height:a},fill:{type:"linear",x1:d,y1:0,x2:l+d,y2:0,colors:u.map(((e,t)=>({color:e.color,offset:r&&"ratio"in e?e.ratio:t/o})))},stroke:{width:0}},{shape:{type:"path",path:`M${l+d} 0 L${c} 12.5 L${l+d} 25 Z`},fill:u[h].color,stroke:{width:0}}]],m=(0,it.d8)(g,c,a),f={filter:(0,D.di)(i)??void 0,opacity:null==t?void 0:`${t}`};return(0,lt.K)("div",{class:rt.layerRow,styles:{justifyContent:"center"}},(0,lt.K)("div",{class:rt.rampLabel},this._getRampStopLabel(u[0],n)),(0,lt.K)("div",{class:rt.symbolContainer},(0,lt.K)("div",{styles:f},m),y),(0,lt.K)("div",{class:rt.rampLabel},this._getRampStopLabel(u[h],n)))}};(0,s._)([(0,r.MZ)()],Ot.prototype,"activeLayerInfos",void 0),(0,s._)([(0,r.MZ)()],Ot.prototype,"headingLevel",void 0),(0,s._)([(0,r.MZ)()],Ot.prototype,"layout",void 0),(0,s._)([(0,r.MZ)(),(0,xt.G)("esri/widgets/Legend/t9n/Legend")],Ot.prototype,"messages",void 0),(0,s._)([(0,r.MZ)(),(0,xt.G)("esri/t9n/common")],Ot.prototype,"messagesCommon",void 0),(0,s._)([(0,r.MZ)({readOnly:!0})],Ot.prototype,"type",void 0),(0,s._)([(0,r.MZ)()],Ot.prototype,"view",void 0),(0,s._)([(0,Ct.$)()],Ot.prototype,"_selectSection",null),Ot=(0,s._)([(0,l.$)("esri.widgets.Legend.styles.Card")],Ot);const kt=Ot,Zt="esri-legend",Pt={service:`${Zt}__service`,label:`${Zt}__service-label`,layer:`${Zt}__layer`,groupLayer:`${Zt}__group-layer`,groupLayerChild:`${Zt}__group-layer-child`,layerTable:`${Zt}__layer-table`,layerTableSizeRamp:`${Zt}__layer-table--size-ramp`,layerChildTable:`${Zt}__layer-child-table`,layerCaption:`${Zt}__layer-caption`,layerBody:`${Zt}__layer-body`,layerRow:`${Zt}__layer-row`,layerCell:`${Zt}__layer-cell`,layerInfo:`${Zt}__layer-cell ${Zt}__layer-cell--info`,imageryLayerStretchedImage:`${Zt}__imagery-layer-image--stretched`,imageryLayerCellStretched:`${Zt}__imagery-layer-cell--stretched`,imageryLayerInfoStretched:`${Zt}__imagery-layer-info--stretched`,symbolContainer:`${Zt}__layer-cell ${Zt}__layer-cell--symbols`,symbol:`${Zt}__symbol`,rampContainer:`${Zt}__ramps`,sizeRamp:`${Zt}__size-ramp`,colorRamp:`${Zt}__color-ramp`,opacityRamp:`${Zt}__opacity-ramp`,borderlessRamp:`${Zt}__borderless-ramp`,rampTick:`${Zt}__ramp-tick`,rampFirstTick:`${Zt}__ramp-tick-first`,rampLastTick:`${Zt}__ramp-tick-last`,rampLabelsContainer:`${Zt}__ramp-labels`,rampLabel:`${Zt}__ramp-label`,message:`${Zt}__message`,univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label"};var Ft=i(35251);const Nt=`${Zt}__`,Dt={display:"flex",alignItems:"flex-start"},Vt={marginLeft:"3px"},Gt={display:"table-cell",verticalAlign:"middle"};let $t=class extends c.A{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return(0,lt.K)("div",null,t&&t.length?t:(0,lt.K)("div",{class:Pt.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const t=!!e.children.length,i=`${Nt}${e.layer.uid}-version-${e.version}`,s=e.title?(0,Tt.D)({level:this.headingLevel,class:this.classes(Ft.D.heading,Pt.label)},e.title):null;if(t){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return(0,lt.K)("div",{class:this.classes(Pt.service,Pt.groupLayer),key:i},s,t)}{const t=e.legendElements;if(t&&!t.length)return null;const n=t.map((t=>this._renderLegendForElement(t,e.layer,e.effectList))).filter((e=>!!e));if(!n.length)return null;const r={[Pt.groupLayerChild]:!!e.parent};return(0,lt.K)("div",{class:this.classes(Pt.service,r),key:i},s,(0,lt.K)("div",{class:Pt.layer},n))}}_renderLegendForElement(e,t,i,s){const n="color-ramp"===e.type,r="opacity-ramp"===e.type,o="size-ramp"===e.type;let a=null;if("symbol-table"===e.type||o){const s=e.infos.map((s=>this._renderLegendForElementInfo(s,t,i,o,e.legendType))).filter((e=>!!e));s.length&&(a=(0,lt.K)("div",{class:Pt.layerBody},s))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?a=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?a=(0,ot.p)(e,this.id,{opacity:t.opacity,effectList:i,ariaLabel:this.messages.previewRelationshipRampAriaLabel}):"pie-chart-ramp"===e.type?a=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?a=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,i):"univariate-color-size-ramp"===e.type&&(a=this._renderUnivariateColorSizeRamp(e,t.opacity,i));if(!a)return null;const l=e.title;let c=null;if("string"==typeof l)c=l;else if(l){const e=Mt(this.messages,l,n||r);c=Lt(0,n||r)&&l.title?`${l.title} (${e})`:e}const d=s?Pt.layerChildTable:Pt.layerTable,u=c?(0,lt.K)("div",{class:Pt.layerCaption},c):null,h={[Pt.layerTableSizeRamp]:o||!s};return(0,lt.K)("div",{class:this.classes(d,h)},u,a)}_renderPieChartRamp(e){return(0,lt.K)("div",{afterCreate:St,bind:e.preview})}_renderUnivariateAboveAndBelowRamp(e,t,i){const{sizeRampElement:s,colorRampElement:n}=_t(e,t);if(!s)return null;const r=this.messages?.previewColorRampAriaLabel,o=vt(s,"above",!0),a=vt(s,"below",!0),l=mt(n,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"above",effectList:i,ariaLabel:r}),c=mt(n,{width:12,height:a,rampAlignment:"vertical",opacity:t,type:"below",effectList:i,ariaLabel:r}),d=gt(s),u=s.infos.map((e=>e.label)),h=u.map(((e,t)=>{const i=2===t;return 0===t?(0,lt.K)("div",{class:e?l?Pt.univariateAboveAndBelowLabel:Pt.rampLabel:void 0,key:t},e):i?(0,lt.K)("div",null):null})),p=u.length-1,y=Math.floor(u.length/2),g=u.map(((e,t)=>t===y||t===p?(0,lt.K)("div",{class:e?l?Pt.univariateAboveAndBelowLabel:Pt.rampLabel:void 0,key:t},e):null)),m={display:"table-cell",verticalAlign:"middle"},f={marginTop:`${d}px`},v={height:`${o}px`},_={height:`${a}px`};return(0,lt.K)("div",{key:"univariate-above-and-below-ramp-preview",styles:Dt},(0,lt.K)("div",{class:Pt.layerBody},s.infos.map(((e,t)=>(0,lt.K)("div",{class:this.classes(Pt.layerRow,Pt.sizeRamp)},(0,lt.K)("div",{afterCreate:St,bind:e.preview,class:Pt.symbol,styles:m}),l||t%2!=0?null:(0,lt.K)("div",{class:Pt.layerInfo},u[t]))))),l?(0,lt.K)("div",{key:"color-ramp-preview",styles:f},(0,lt.K)("div",{styles:Vt},(0,lt.K)("div",{styles:Gt},(0,lt.K)("div",{afterCreate:St,bind:l,class:Pt.rampContainer})),(0,lt.K)("div",{styles:Gt},(0,lt.K)("div",{class:Pt.rampLabelsContainer,styles:v},h))),(0,lt.K)("div",{styles:Vt},(0,lt.K)("div",{styles:Gt},(0,lt.K)("div",{afterCreate:St,bind:c,class:Pt.rampContainer})),(0,lt.K)("div",{styles:Gt},(0,lt.K)("div",{class:Pt.rampLabelsContainer,styles:_},g)))):null)}_renderUnivariateColorSizeRamp(e,t,i){const{sizeRampElement:s,colorRampElement:n}=bt(e);if(!s)return null;const r=gt(s),o=vt(s,"full",!1),a=mt(n,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"full",effectList:i,ariaLabel:this.messages?.previewColorRampAriaLabel}),l=s.infos.length-1,c=s.infos.map(((e,t)=>0===t||t===l?(0,lt.K)("div",{class:e.label?n?Pt.univariateAboveAndBelowLabel:Pt.rampLabel:void 0,key:t},e.label):null)),d={display:"table-cell",verticalAlign:"middle"},u={marginTop:`${r}px`},h={height:`${o}px`};return(0,lt.K)("div",{key:"univariate-above-and-below-ramp-preview",styles:Dt},(0,lt.K)("div",{class:Pt.layerBody},s.infos.map((e=>(0,lt.K)("div",{class:this.classes(Pt.layerRow,Pt.sizeRamp)},(0,lt.K)("div",{afterCreate:St,bind:e.preview,class:Pt.symbol,styles:d}))))),(0,lt.K)("div",{key:"color-ramp-preview",styles:u},(0,lt.K)("div",{styles:Vt},(0,lt.K)("div",{styles:Gt},(0,lt.K)("div",{afterCreate:St,bind:a,class:Pt.rampContainer})),(0,lt.K)("div",{styles:Gt},(0,lt.K)("div",{class:Pt.rampLabelsContainer,styles:h},c)))))}_renderLegendForRamp(e,t){const i=e.infos,s="opacity-ramp"===e.type,n="heatmap-ramp"===e.type,r="stretch-ramp"===e.type,o=e.preview,a=s?Pt.opacityRamp:"";o.className=`${Pt.colorRamp} ${a}`,null!=t&&(o.style.opacity=t.toString());const l=i.map((e=>(0,lt.K)("div",{class:e.label?Pt.rampLabel:void 0},n?this.messages[e.label]||e.label:r?It(e,this.messages):e.label))),c={width:"24px"},d={height:o.style.height};return(0,lt.K)("div",{class:Pt.layerRow},(0,lt.K)("div",{class:Pt.symbolContainer,styles:c},(0,lt.K)("div",{afterCreate:St,bind:o,class:Pt.rampContainer})),(0,lt.K)("div",{class:Pt.layerInfo},(0,lt.K)("div",{class:Pt.rampLabelsContainer,styles:d},l)))}_renderLegendForElementInfo(e,t,i,s,n){if(e.type)return this._renderLegendForElement(e,t,i,!0);let r=null;const o=Et(t,n);if(e.preview?r=(0,lt.K)("div",{afterCreate:St,bind:e.preview,class:Pt.symbol}):e.src&&(r=this._renderImage(e,t,o)),!r)return null;const a={[Pt.imageryLayerInfoStretched]:o},l={[Pt.imageryLayerInfoStretched]:o,[Pt.sizeRamp]:!o&&s};return(0,lt.K)("div",{class:Pt.layerRow},(0,lt.K)("div",{class:this.classes(Pt.symbolContainer,l)},r),(0,lt.K)("div",{class:this.classes(Pt.layerInfo,a)},Mt(this.messages,e.label,!1)||""))}_renderImage(e,t,i){const{label:s,src:n,opacity:r}=e,o={[Pt.imageryLayerStretchedImage]:i,[Pt.symbol]:!i},a={opacity:`${null!=r?r:t.opacity}`};return(0,lt.K)("img",{alt:Mt(this.messages,s,!1),"aria-label":Mt(this.messages,s,!1),border:0,class:this.classes(o),height:e.height,src:n,styles:a,width:e.width})}};(0,s._)([(0,r.MZ)()],$t.prototype,"activeLayerInfos",void 0),(0,s._)([(0,r.MZ)()],$t.prototype,"headingLevel",void 0),(0,s._)([(0,r.MZ)(),(0,xt.G)("esri/widgets/Legend/t9n/Legend")],$t.prototype,"messages",void 0),(0,s._)([(0,r.MZ)({readOnly:!0})],$t.prototype,"type",void 0),$t=(0,s._)([(0,l.$)("esri.widgets.Legend.styles.Classic")],$t);const Bt=$t;const zt={base:"esri-legend",widgetIcon:i(2295).T.layerList};let Ht=class extends c.A{constructor(e,t){super(e,t),this.headingLevel=3,this.iconClass=zt.widgetIcon,this.icon=null,this.messages=null,this.style=new Bt,this.viewModel=new tt}initialize(){this.addHandles([(0,n.on)((()=>this.view),"resize",(()=>this.scheduleRender())),(0,n.on)((()=>this.activeLayerInfos),"change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),(0,n.wB)((()=>this.headingLevel),(e=>{const{style:t}=this;t&&(t.headingLevel=e)})),(0,n.wB)((()=>this.style),((e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)}),n.Vh)])}get activeLayerInfos(){return this.viewModel.activeLayerInfos}set activeLayerInfos(e){this.viewModel.activeLayerInfos=e}get basemapLegendVisible(){return this.viewModel.basemapLegendVisible}set basemapLegendVisible(e){this.viewModel.basemapLegendVisible=e}get groundLegendVisible(){return this.viewModel.groundLegendVisible}set groundLegendVisible(e){this.viewModel.groundLegendVisible=e}get hideLayersNotInCurrentView(){return this.viewModel.hideLayersNotInCurrentView}set hideLayersNotInCurrentView(e){this.viewModel.hideLayersNotInCurrentView=e}get keepCacheOnDestroy(){return this.viewModel.keepCacheOnDestroy}set keepCacheOnDestroy(e){this.viewModel.keepCacheOnDestroy=e}get respectLayerVisibility(){return this.viewModel.respectLayerVisibility}set respectLayerVisibility(e){this.viewModel.respectLayerVisibility=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}castStyle(e){if(e instanceof kt||e instanceof Bt)return e;if("string"==typeof e)return"card"===e?new kt:new Bt;if(e&&"string"==typeof e.type){const t={...e};return delete t.type,new("card"===e.type?kt:Bt)(t)}return new Bt}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return(0,lt.K)("div",{class:this.classes(zt.base,Ft.D.widget,this.style instanceof Bt?Ft.D.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){e.forEach((e=>{this.removeHandles(`version_${e.layer.uid}`),this._renderOnActiveLayerInfoChange(e)})),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const t=(0,n.wB)((()=>e.version),(()=>this.scheduleRender()));this.addHandles(t,`version_${e.layer.uid}`);const i=(0,n.on)((()=>e.children),"change",(()=>e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))),n.Vh);this.addHandles(i,`version_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};(0,s._)([(0,r.MZ)()],Ht.prototype,"activeLayerInfos",null),(0,s._)([(0,r.MZ)()],Ht.prototype,"basemapLegendVisible",null),(0,s._)([(0,r.MZ)()],Ht.prototype,"groundLegendVisible",null),(0,s._)([(0,r.MZ)()],Ht.prototype,"headingLevel",void 0),(0,s._)([(0,r.MZ)()],Ht.prototype,"hideLayersNotInCurrentView",null),(0,s._)([(0,r.MZ)()],Ht.prototype,"keepCacheOnDestroy",null),(0,s._)([(0,r.MZ)()],Ht.prototype,"respectLayerVisibility",null),(0,s._)([(0,r.MZ)()],Ht.prototype,"iconClass",void 0),(0,s._)([(0,r.MZ)()],Ht.prototype,"icon",void 0),(0,s._)([(0,r.MZ)()],Ht.prototype,"label",null),(0,s._)([(0,r.MZ)()],Ht.prototype,"layerInfos",null),(0,s._)([(0,r.MZ)(),(0,xt.G)("esri/widgets/Legend/t9n/Legend")],Ht.prototype,"messages",void 0),(0,s._)([(0,r.MZ)()],Ht.prototype,"style",void 0),(0,s._)([(0,o.w)("style")],Ht.prototype,"castStyle",null),(0,s._)([(0,r.MZ)()],Ht.prototype,"view",null),(0,s._)([(0,r.MZ)()],Ht.prototype,"viewModel",void 0),Ht=(0,s._)([(0,l.$)("esri.widgets.Legend")],Ht);const Kt=Ht},15145:(e,t,i)=>{i.d(t,{A:()=>Ot});var s=i(66866),n=(i(17791),i(64874)),r=i(6267),o=i(85251),a=i(96274),l=i(21564),c=i(73446),d=i(85569),u=i(39831),h=i(63863),p=i(46928),y=i(2295);const g="esri-search",m={base:g,widgetIcon:y.T.search,hasMultipleSources:`${g}--multiple-sources`,isLoading:`${g}--loading`,isSearching:`${g}--searching`,showSuggestions:`${g}--show-suggestions`,showSources:`${g}--sources`,showWarning:`${g}--warning`,container:`${g}__container`,input:`${g}__input`,inputContainer:`${g}__input-container`,form:`${g}__form`,submitButton:`${g}__submit-button`,sourcesButton:`${g}__sources-button`,sourcesButtonDown:`${g}__sources-button--down`,sourcesButtonUp:`${g}__sources-button--up`,clearButton:`${g}__clear-button`,sourceName:`${g}__source-name`,suggestionsMenu:`${g}__suggestions-menu`,suggestionList:`${g}__suggestions-list`,suggestionListCurrentLocation:`${g}__suggestions-list--current-location`,sourcesMenu:`${g}__sources-menu`,source:`${g}__source`,warningMenu:`${g}__warning-menu`,warningMenuBody:`${g}__warning-body`,warningMenuHeader:`${g}__warning-header`,warningMenuText:`${g}__warning-text`,noValueText:`${g}__no-value-text`},f="esri-search-result-renderer",v={base:f,showMoreResults:`${f}__more-results--show-more-results`,moreResults:`${f}__more-results`,moreResultsList:`${f}__more-results-list`,moreResultsHeader:`${f}__more-results-header`,moreResultsItem:`${f}__more-results-item`,moreResultsListHeader:`${f}__more-results-list-header`};var _=i(99050),b=i(21121),w=i(25707),S=i(56542),M=(i(30822),i(52495)),L=i(48982),E=i(98849),I=i(17306),T=i(539),C=i(40189),x=i(78632),A=i(78983),R=i(91109),O=i(15131),k=i(10282),Z=i(38201),P=i(19251),F=i(65667),N=i(21877);let D=class extends((0,F.sA)(N.oY)){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};(0,s._)([(0,l.MZ)()],D.prototype,"autoNavigate",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"filter",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"getResults",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"getSuggestions",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"maxResults",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"maxSuggestions",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"minSuggestCharacters",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"outFields",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"placeholder",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"popupEnabled",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"popupTemplate",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"prefix",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"resultGraphicEnabled",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"resultSymbol",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"suggestionsEnabled",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"suffix",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"withinViewEnabled",void 0),(0,s._)([(0,l.MZ)()],D.prototype,"zoomScale",void 0),D=(0,s._)([(0,h.$)("esri.widgets.Search.SearchSource")],D);const V=D;var G=i(92976),$=i(62802),B=i(44146),z=(i(17639),i(61781)),H=i(84698);const K=T.A.getLogger("esri.widgets.Search.support.geometryUtils");function j(e,t){if(!t)return K.error("missing-parameter: view is missing."),Promise.reject(new E.A("searchgeometryutils:missing-parameter","view is missing."));if(!e)return K.error("missing-parameter: point is missing."),Promise.reject(new E.A("searchgeometryutils:missing-parameter","point is missing."));if(e.hasZ||"2d"===t.type)return Promise.resolve(e);const i=t?.map?.ground;return i?.layers.length?i.queryElevation(e,{cache:t.basemapTerrain?.elevationQueryCache}).then((e=>e.geometry)):Promise.resolve(e)}function U(e){if(null==e)return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":return e.getPoint(0);case"polyline":return e.getPoint(0,0)}return null}function q(e,t,i){return null==e?null:"extent"===e.type?e:"multipoint"===e.type||"polygon"===e.type||"polyline"===e.type?e.extent:"point"===e.type?J(e,t,i):void 0}function W(e,t,i){return null==e||null==t?null:J(e.center,t,i)}function J(e,t,i){const s=e.hasZ?e.z:void 0;return t?.map?(null!=i?(0,z.eU)(t,i):t.extent).clone().centerAt(e).set({zmax:s,zmin:s}):new H.A({xmin:e.x-.25,ymin:e.y-.25,xmax:e.x+.25,ymax:e.y+.25,spatialReference:e.spatialReference,zmin:s,zmax:s})}var Y=i(48187),Q=i(76459);const X=/https?:\/\/services.*\.arcgis\.com/i,ee=/(?:\{([^}]+)\})/g,te=T.A.getLogger("esri.widgets.Search.support.layerSearchUtils");function ie(e,t){const{exactMatch:i=!1,location:s,maxResults:n,spatialReference:r,source:o,sourceIndex:a,suggestResult:l,view:c}=e,{layer:d,filter:u,zoomScale:h}=o,p=c?.scale,y=ne(o,c),g=t?.signal;return oe(d).then((()=>{const e=d.popupTemplate;return e?e.getRequiredFields(d.fieldsIndex):null})).then((e=>{const{objectIdField:t,returnZ:m}=d,f=he(o);if(!ye(d,f))throw te.error("invalid-field: displayField is invalid."),new E.A("getResults():invalid-field","displayField is invalid.");const v=e&&e.length?e:[f],_=o.outFields||v,b=re(_);if(_.includes(t)||b||_.push(t),d.floorInfo?.floorField&&_.push(d.floorInfo.floorField),!b&&!pe(d,_))throw te.error("invalid-field: outField is invalid."),new E.A("getResults():invalid-field","outField is invalid.");const w=d.createQuery(),{orderByFields:S}=o;if(S&&(w.orderByFields=S),r){w.outSpatialReference=r;const e=1/(0,G.GA)(r);e&&(w.maxAllowableOffset=e)}const M="mesh"===d.geometryType||"multipatch"===d.geometryType,L=d.capabilities?.data?.supportsZ&&!M;if(w.returnZ=L&&!1!==m,w.returnGeometry=!0,w.multipatchOption=M?"xyFootprint":null,_&&(w.outFields=_),s)w.geometry=s;else if(l.key)w.objectIds=[l.key];else{const e=o.searchFields||[f];if(!pe(d,e))throw te.error("invalid-field: search field is invalid."),new E.A("getResults():invalid-field","search field is invalid.");ue(d)&&(w.num=n),y&&(w.geometry=y);const t=l.text?.trim();if(!t)return[];const s=l.text,{prefix:r="",suffix:a=""}=o,c=ge(`${r}${s}${a}`);de(d)&&le(d,e)&&!i&&s&&(w.fullText=ce({text:s,searchFields:e}));const h=ve({searchTerm:c,layer:d,searchFields:e,filter:u,exactMatch:i,query:w,type:"search"});if(w.where=h,!ae(w))return[]}return d.queryFeatures(w,{signal:g}).then((e=>function(e,t,i,s,n,r,o){return e.features.map((e=>we(e,t,i,s,n,r,o)))}(e,c,o,a,f,p,h)))}))}function se(e,t){const{source:i,spatialReference:s,view:n,suggestTerm:r,maxSuggestions:o,sourceIndex:a,exactMatch:l}=e,{layer:c,filter:d}=i,u=t?.signal,h=ne(i,n);return oe(c).then((()=>{if(!ue(c))return[];const e=he(i),t=i.searchFields||[e],n=[];i.suggestionTemplate?i.suggestionTemplate.replaceAll(ee,((e,t)=>(n.push(t),e))):n.push(e);const p=re(n);n.includes(c.objectIdField)||p||n.push(c.objectIdField);const y=ye(c,e),g=p||pe(c,n),m=pe(c,t);if(!y)throw te.error("invalid-field: displayField is invalid."),new E.A("getSuggestions():invalid-field","displayField is invalid.");if(!g)throw te.error("invalid-field: outField is invalid."),new E.A("getSuggestions():invalid-field","outField is invalid.");if(!m)throw te.error("invalid-field: search field is invalid."),new E.A("getSuggestions():invalid-field","search field is invalid.");const f=c.createQuery(),{orderByFields:v}=i;if(v&&(f.orderByFields=v),f.outSpatialReference=s,f.returnGeometry=!1,f.num=o,f.outFields=n,h&&(f.geometry=h),!r.trim())return[];const{prefix:_="",suffix:b=""}=i,w=ge(`${_}${r}${b}`);de(c)&&le(c,t)&&!l&&r&&(f.fullText=ce({text:r,searchFields:t}));const S=ve({searchTerm:w,layer:c,searchFields:t,filter:d,exactMatch:l,query:f,type:"suggest"});return f.where=S,ae(f)?c.queryFeatures(f,{signal:u}).then((t=>function(e,t,i,s){return e.features.map((e=>be(e,t,i,s)))}(t,i,a,e))):[]}))}function ne(e,t){const{filter:i,withinViewEnabled:s}=e,n=t?.extent,r=i?.geometry;return r??(s&&n?n:void 0)}function re(e){return e&&e.includes("*")}async function oe(e){e&&await e.load()}function ae(e){return!(!e.fullText&&!e.where)}function le(e,t){const i=e?.indexes;return!(!i||!t?.length)&&i.filter((e=>"FullText"===e.indexType)).some((e=>{const i=e.fields?.split(",").map((e=>e.trim().toLowerCase()))||[];return t.every((e=>i.includes(e.toLowerCase())))}))}function ce({text:e,searchFields:t}){return e.trim().split(" ").filter((e=>!!e.trim())).map((e=>new B.A({onFields:t,searchTerm:e,searchType:"prefix"})))}function de(e){return e?.capabilities?.query?.supportsFullTextSearch??!1}function ue(e){return e?.capabilities?.query?.supportsPagination??!1}function he(e){return e.displayField||e.layer.displayField||function(e){return e?.fieldsIndex?.fields?.find((e=>"string"===e.type))?.name??""}(e.layer)}function pe(e,t){return!(!e||!t?.length)&&t.every((t=>ye(e,t)))}function ye(e,t){return!!e.getField(t)}function ge(e){return e.replaceAll("'","''")}function me(e,t){const i=t?.where;return i?`(${e}) AND (${i})`:e}function fe({currentTerm:e,field:t,filter:i,exactMatch:s,url:n,type:r}){const o=t?.type,a=t?.name;if("string"===o||"date"===o||"global-id"===o){const t=X.test(n??""),o=t&&function(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(e)?"N":"";return me(s&&"search"===r?`${a} = ${o}'${e}'`:t?`${a} LIKE ${o}'${e}%'`:`LOWER(${a}) LIKE ${o}'${e.toLowerCase()}%'`,i)}if("oid"===o||"small-integer"===o||"integer"===o||"single"===o||"double"===o){const t=Number(e);return isNaN(t)?null:me(`${a} = ${t}`,i)}return me(`${a} = ${e}`,i)}function ve({searchTerm:e,layer:t,searchFields:i,filter:s,exactMatch:n,query:r,type:o}){const{definitionExpression:a,url:l}=t;let c="";return!r.fullText&&e&&i&&i.forEach((i=>{const r=t.getField(i),a="function"==typeof t.getFieldDomain&&t.getFieldDomain(i),d=(a&&"coded-value"===a.type?function(e,t,i){let s=null;const{codedValues:n}=e;return n&&n.some((e=>{const n=e.name,r=i?n:n.toLowerCase();return(i?t:t.toLowerCase())===r&&(s=e.code.toString(),!0)})),s}(a,e,n):null)||e||null;if(null!==d){const e=fe({currentTerm:d,field:r,filter:s,exactMatch:n,url:l,type:o});e&&(c+=function(e,t){return e?` OR (${t})`:`(${t})`}(c,e))}})),a&&c?`(${a}) AND (${c})`:a||c}function _e(e,t,i){const s=e.sourceLayer,{attributes:n}=e,r="function"==typeof s.getFieldDomain&&s.getFieldDomain(i);if(t)return(0,Y.V)(t,n);if(i&&n){const e=s.getField(i),t=function(e,t){return e[Object.keys(e).find((e=>e.toLowerCase()===t.toLowerCase()))]}(n,i);return null==t?"":r&&"coded-value"===r.type?function(e,t){let i=null;const{codedValues:s}=e;return s&&s.length&&s.some((e=>e.code===t&&(i=e.name,!0))),i}(r,t)??"":"date"===e?.type?(0,Q.Yq)(new Date(t)):"number"==typeof t?t.toString():"string"!=typeof t?"":t.trim()}return""}function be(e,t,i,s){const n=e.sourceLayer,{attributes:r}=e,{objectIdField:o}=n,a=o?r[o]:null;return{text:_e(e,t.suggestionTemplate,s),key:a,sourceIndex:i}}function we(e,t,i,s,n,r,o){const a=e.clone(),l=e.sourceLayer,c=l?.objectIdField,d=c?e.attributes[c]:null,u=_e(e,i.searchTemplate,n);null!=r&&function(e){return null!=e&&null!=e.minScale&&null!=e.maxScale}(l)&&(l.minScale&&l.minScale<r?r=l.minScale:l.maxScale&&l.maxScale>r&&(r=l.maxScale));const h=q(a.geometry,t,r),p="number"==typeof o?W((0,P.o8)(h),t,o):h,y=e.clone();return null!=p&&(y.geometry=$.A.fromExtent(p)),{extent:p,target:y,feature:a,key:d,name:u,sourceIndex:s}}var Se;let Me=Se=class extends V{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,t)=>ie({source:this,...e},t),this.getSuggestions=(e,t)=>se({source:this,...e},t)}set layer(e){this._set("layer",e),e&&e.load().catch((()=>{}))}get name(){return this._getLayerTitle()??""}set name(e){this._overrideIfSome("name",e)}clone(){return new Se({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,P.o8)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?(0,P.o8)(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){return this.layer.fieldsIndex?.fields.find((e=>"string"===e.type))?.name??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map((t=>{const i=e.getField(t);return i?.alias||t})).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};(0,s._)([(0,l.MZ)({json:{read:{source:"field.name"},write:{target:"field.name"}}})],Me.prototype,"displayField",void 0),(0,s._)([(0,l.MZ)({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],Me.prototype,"exactMatch",void 0),(0,s._)([(0,l.MZ)({value:null})],Me.prototype,"layer",null),(0,s._)([(0,l.MZ)()],Me.prototype,"name",null),(0,s._)([(0,l.MZ)({type:[String],json:{write:!0}})],Me.prototype,"orderByFields",void 0),(0,s._)([(0,l.MZ)()],Me.prototype,"searchFields",void 0),(0,s._)([(0,l.MZ)()],Me.prototype,"searchTemplate",void 0),(0,s._)([(0,l.MZ)()],Me.prototype,"suggestionTemplate",void 0),Me=Se=(0,s._)([(0,h.$)("esri.widgets.Search.LayerSearchSource")],Me);const Le=Me;var Ee=i(86394),Ie=i(11499);let Te=class extends N.oY{constructor(e){super(e),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};(0,s._)([(0,l.MZ)({type:String,json:{write:!0}})],Te.prototype,"address",void 0),(0,s._)([(0,l.MZ)({type:Object,json:{write:!0}})],Te.prototype,"attributes",void 0),(0,s._)([(0,l.MZ)({type:H.A,json:{write:!0}})],Te.prototype,"extent",void 0),(0,s._)([(0,l.MZ)({type:x.A,json:{write:!0}})],Te.prototype,"location",void 0),(0,s._)([(0,l.MZ)({type:Number,json:{write:!0}})],Te.prototype,"score",void 0),Te=(0,s._)([(0,h.$)("esri.rest.support.AddressCandidate")],Te);const Ce=Te;var xe=i(12188);let Ae=class extends N.oY{constructor(e){super(e),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};(0,s._)([(0,l.MZ)({type:Object,json:{write:!0}})],Ae.prototype,"address",void 0),(0,s._)([(0,l.MZ)(xe.K)],Ae.prototype,"apiKey",void 0),(0,s._)([(0,l.MZ)({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],Ae.prototype,"categories",void 0),(0,s._)([(0,l.MZ)({type:String,json:{write:!0}})],Ae.prototype,"countryCode",void 0),(0,s._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],Ae.prototype,"forStorage",void 0),(0,s._)([(0,l.MZ)({type:x.A,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],Ae.prototype,"location",void 0),(0,s._)([(0,l.MZ)({type:String,json:{write:!0}})],Ae.prototype,"locationType",void 0),(0,s._)([(0,l.MZ)({type:String,json:{write:!0}})],Ae.prototype,"magicKey",void 0),(0,s._)([(0,l.MZ)({type:Number,json:{write:!0}})],Ae.prototype,"maxLocations",void 0),(0,s._)([(0,l.MZ)({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],Ae.prototype,"outFields",void 0),(0,s._)([(0,l.MZ)({type:A.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ae.prototype,"outSpatialReference",void 0),(0,s._)([(0,l.MZ)({type:H.A,json:{write:{writer:(e,t)=>{const i=e?e.shiftCentralMeridian():null;t.searchExtent=i}}}})],Ae.prototype,"searchExtent",void 0),Ae=(0,s._)([(0,h.$)("esri.rest.support.AddressToLocationsParameters")],Ae),Ae.from=(0,c.dp)(Ae);const Re=Ae;function Oe({data:e}){if(!e)return[];const{candidates:t,spatialReference:i}=e;return t?t.map((e=>{if(!e)return;const{extent:t,location:s}=e,n=!t||function(e){return e&&"number"==typeof e.xmin&&"number"==typeof e.ymin&&"number"==typeof e.xmax&&"number"==typeof e.ymax}(t);return function(e){return!!e&&"number"==typeof e.x&&"number"==typeof e.y}(s)&&n?(t&&(t.spatialReference=i),s&&(s.spatialReference=i),Ce.fromJSON(e)):void 0})):[]}let ke=class extends N.oY{constructor(e){super(e),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};(0,s._)([(0,l.MZ)(xe.K)],ke.prototype,"apiKey",void 0),(0,s._)([(0,l.MZ)({type:x.A,json:{write:{writer:(e,t)=>{const i=e?e.clone().normalize():null,s=void 0!==i;t.location=s?i:null}}}})],ke.prototype,"location",void 0),(0,s._)([(0,l.MZ)({type:String,json:{write:!0}})],ke.prototype,"locationType",void 0),(0,s._)([(0,l.MZ)({type:A.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ke.prototype,"outSpatialReference",void 0),ke=(0,s._)([(0,h.$)("esri.rest.support.LocationToAddressParameters")],ke),ke.from=(0,c.dp)(ke);const Ze=ke;async function Pe(e,t,i){t=Ze.from(t);const s=(0,Ie.Dl)(e),n={...t.toJSON(),f:"json"},r=(0,Ie.lF)({...s.query,...n}),o=(0,Ie.jV)(r,i),a=`${s.path}/reverseGeocode`;return(0,Ee.A)(a,o).then(Fe)}function Fe({data:e}){if(!e)return;const{address:t,location:i}=e,s=t?.Match_addr||"";return Ce.fromJSON({address:s,attributes:t||{},location:i,score:100})}let Ne=class extends N.oY{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};(0,s._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],Ne.prototype,"isCollection",void 0),(0,s._)([(0,l.MZ)({type:String,json:{write:!0}})],Ne.prototype,"magicKey",void 0),(0,s._)([(0,l.MZ)({type:String,json:{write:!0}})],Ne.prototype,"text",void 0),Ne=(0,s._)([(0,h.$)("esri.rest.support.SuggestionCandidate")],Ne);const De=Ne;let Ve=class extends N.oY{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};(0,s._)([(0,l.MZ)(xe.K)],Ve.prototype,"apiKey",void 0),(0,s._)([(0,l.MZ)({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],Ve.prototype,"categories",void 0),(0,s._)([(0,l.MZ)({type:String,json:{write:!0}})],Ve.prototype,"countryCode",void 0),(0,s._)([(0,l.MZ)({type:x.A,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],Ve.prototype,"location",void 0),(0,s._)([(0,l.MZ)({type:Number,json:{write:!0}})],Ve.prototype,"maxSuggestions",void 0),(0,s._)([(0,l.MZ)({type:A.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ve.prototype,"outSpatialReference",void 0),(0,s._)([(0,l.MZ)({type:H.A,json:{write:{writer:(e,t)=>{const i=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(i)}}}})],Ve.prototype,"searchExtent",void 0),(0,s._)([(0,l.MZ)({type:String,json:{write:!0}})],Ve.prototype,"text",void 0),Ve=(0,s._)([(0,h.$)("esri.rest.support.SuggestLocationsParameters")],Ve),Ve.from=(0,c.dp)(Ve);const Ge=Ve;function $e(e){const{data:t}=e;if(!t)return[];const{suggestions:i}=t;return i?i.map((e=>new De(e))):[]}const Be="Single Line Input";function ze(e,t){return e.location?async function(e,t){const{source:i,spatialReference:s,location:n,sourceIndex:r,view:o}=e,{apiKey:a,url:l,zoomScale:c,defaultZoomScale:d}=i;if(null==l)return[];const u=o?.scale,h=t?.signal,p=new Ze;p.location=n,a&&(p.apiKey=a),s&&(p.outSpatialReference=s);try{return qe([await Pe(l,p,{signal:h})],{sourceIndex:r,scale:u,view:o,zoomScale:c,defaultZoomScale:d})}catch(re){return[]}}(e,t):async function(e,t){const{source:i,suggestResult:s,spatialReference:n,view:r,maxResults:o,sourceIndex:a}=e,l=i?.zoomScale,c=i?.defaultZoomScale,d=s.text?.trim();if(!d)return null;const u=!s.key&&i.prefix?i.prefix:"",h=!s.key&&i.suffix?i.suffix:"",p=`${u}${s.text}${h}`,y=new Re,{apiKey:g,url:m}=i,f=r?.scale,v=Ue(i,r),_=t?.signal;if(g&&(y.apiKey=g),!m)return null;i.categories&&(y.categories=i.categories),i.locationType&&(y.locationType=i.locationType),n&&(y.outSpatialReference=n);const b=He(r,i);b&&(y.location=b),y.maxLocations=o,v&&(y.searchExtent=v),i.countryCode&&(y.countryCode=i.countryCode);const{key:w}=s,S=`${w}`;return w&&(y.magicKey=S),y.address={},y.address[i.singleLineFieldName||Be]=p,i.outFields&&(y.outFields=i.outFields),async function(e,t,i){t=Re.from(t);const s=(0,Ie.Dl)(e),{address:n,...r}=t.toJSON(),o={...n,...r,f:"json"},a=(0,Ie.lF)({...s.query,...o}),l=(0,Ie.jV)(a,i),c=`${s.path}/findAddressCandidates`;return(0,Ee.A)(c,l).then(Oe)}(m,y,{signal:_}).then((e=>qe(e,{key:S,scale:f,sourceIndex:a,view:r,zoomScale:l,defaultZoomScale:c})))}(e,t)}function He(e,t){if(t.localSearchDisabled)return null;const i=e?.scale;return"number"==typeof i&&i<=3e5?e?.extent?.center:null}async function Ke(e,t){const{source:i,spatialReference:s,view:n,suggestTerm:r,maxSuggestions:o,sourceIndex:a}=e,l=new Ge,{apiKey:c,url:d}=i,u=Ue(i,n),h=t?.signal;if(!d)return null;c&&(l.apiKey=c),i.categories&&(l.categories=i.categories),s&&(l.outSpatialReference=s);const p=He(n,i);if(p&&(l.location=p),!r.trim())return null;const{prefix:y="",suffix:g=""}=i,m=`${y}${r}${g}`;return l.text=m,u&&(l.searchExtent=u),l.maxSuggestions=o,i.countryCode&&(l.countryCode=i.countryCode),async function(e,t,i){const s=(0,Ie.Dl)(e),n={...(t=Ge.from(t)).toJSON(),f:"json"},r=(0,Ie.lF)({...s.query,...n}),o=(0,Ie.jV)(r,i),a=`${s.path}/suggest`;return(0,Ee.A)(a,o).then($e)}(d,l,{signal:h}).then((e=>function(e,t){return e.map((e=>function(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}(e,t)))}(e,a)))}function je(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function Ue(e,t){const{filter:i,withinViewEnabled:s}=e,n=t?.scale,r=t?.extent,o=i?.geometry;return q(o,t,n)||(s&&r?r:void 0)}function qe(e,t){return e.filter(Boolean).map((e=>function(e,t){const{key:i,scale:s,sourceIndex:n,view:r,zoomScale:o,defaultZoomScale:a}=t,{attributes:l,extent:c,location:d,address:u}=e,h=new w.A({geometry:d,attributes:l}),p=c||d,y=q(p,r,s),g="number"==typeof o?W(y,r,o):"number"==typeof a&&"point"===p?.type?W(y,r,a):y,m=d?`${d.x},${d.y}`:"",f=u||m,v=h.clone();return null!=g&&(v.geometry=$.A.fromExtent(g)),{extent:g,feature:h,target:v,key:i,name:f,sourceIndex:n}}(e,t)))}var We;let Je=We=class extends V{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(e,t)=>ze({source:this,...e},t),this.getSuggestions=(e,t)=>Ke({source:this,...e},t)}clone(){return new We({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,P.o8)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?(0,P.o8)(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};(0,s._)([(0,l.MZ)()],Je.prototype,"apiKey",void 0),(0,s._)([(0,l.MZ)()],Je.prototype,"categories",void 0),(0,s._)([(0,l.MZ)()],Je.prototype,"countryCode",void 0),(0,s._)([(0,l.MZ)({json:{write:!0}})],Je.prototype,"defaultZoomScale",void 0),(0,s._)([(0,l.MZ)()],Je.prototype,"localSearchDisabled",void 0),(0,s._)([(0,l.MZ)()],Je.prototype,"locationType",void 0),(0,s._)([(0,l.MZ)({json:{write:!0}})],Je.prototype,"name",void 0),(0,s._)([(0,l.MZ)({json:{write:!0}})],Je.prototype,"placeholder",void 0),(0,s._)([(0,l.MZ)()],Je.prototype,"searchTemplate",void 0),(0,s._)([(0,l.MZ)({json:{write:!0}})],Je.prototype,"singleLineFieldName",void 0),(0,s._)([(0,l.MZ)({json:{read:{source:"suggest"},write:{target:"suggest"}}})],Je.prototype,"suggestionsEnabled",void 0),(0,s._)([(0,l.MZ)({json:{write:!0}})],Je.prototype,"url",void 0),(0,s._)([(0,l.MZ)({json:{write:!0}})],Je.prototype,"zoomScale",void 0),Je=We=(0,s._)([(0,h.$)("esri.widgets.Search.LocatorSearchSource")],Je);const Ye=Je;var Qe=i(96082),Xe=i(70727),et=i(72387);const tt=T.A.getLogger("esri.widgets.support.geolocationUtils"),it={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function st(){return function(){const e=(0,u.A)("esri-geolocation");return e||tt.warn("geolocation-unsupported","Geolocation unsupported."),e}()&&function(){const e=window.isSecureContext;return e||tt.warn("insecure-context","Geolocation requires a secure origin."),e}()}let nt;function rt(e,t){if(nt)return nt(e,t);const{position:i,view:s}=e,n=function(e){const t=e&&e.coords||{},i={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e?{coords:i,timestamp:e.timestamp}:e}(i),r=n?.coords;if(!r)throw new E.A("geometry-service:no-coords","Geolocation has no coordinates");return function(e,t,i){if(!t)return Promise.resolve(e);const s=t.spatialReference;return s.isWGS84?Promise.resolve(e):s.isWebMercator?Promise.resolve((0,Qe.Gh)(e)):function(e){if(b.A.geometryServiceUrl)return Promise.resolve(b.A.geometryServiceUrl);const t=k.A.getDefault();return t.load(e).catch((()=>{})).then((()=>t.helperServices?.geometry?.url))}(i).then((t=>{if(!t)throw new E.A("geometry-service:missing-url","Geometry service URL is missing");const n=new et.A({geometries:[e],outSpatialReference:s});return(0,Xe.C)(t,n,i).then((e=>e[0]))}))}(function({longitude:e,latitude:t,altitude:i}){return new x.A({longitude:e,latitude:t,z:i||void 0,spatialReference:{wkid:4326}})}(r),s,t)}var ot=i(90670),at=i(72001),lt=i(40241),ct=i(68882),dt=i(42602);function ut(e,t){return e.hasOwnProperty(t)&&null!=e[t]&&""!==e[t]}const ht="esri.widgets.Search.SearchViewModel",pt=T.A.getLogger(ht),yt="highlight",gt=L.A.ofType({key:e=>e.layer?"layer":"locator",base:V,typeMap:{layer:Le,locator:Ye}}),mt=A.A.WGS84,ft=/<[\s\S]*?>/g,vt=-1;let _t=class extends((0,ot.R)(I.A.EventedMixin(M.A))){constructor(e){super(e),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new gt,this.defaultSymbols={point:new at.A({url:(0,_.s)("esri/images/search/search-symbol-32.png"),size:24,width:24,height:24}),polyline:new lt.A({color:[130,130,130,1],width:2}),polygon:new ct.A({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=k.A.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new gt,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const e=await(0,O.ud)("esri/widgets/Search/t9n/Search");this.messages=e,this.defaultPopupTemplate=new S.A({title:e.searchResult,content:"{Match_addr}"})};e(),this.addHandles([(0,o.wB)((()=>[this.includeDefaultSources,this.view,this.portal]),(()=>this._update()),o.Vh),(0,R.oQ)(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return 1!==this.allSources.length&&this.searchAllEnabled?vt:0}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){return this.messages?.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:i}=this,s="function"==typeof i?i.call(null,{sources:e,defaultSources:t}):i?t.concat(e):e,n=this._get("allSources")||new gt;return n.removeAll(),n.addMany(s.filter(Boolean)),n}get locationEnabled(){return this._get("locationEnabled")||st()}set locationEnabled(e){if(void 0===e)return void this._clearOverride("locationEnabled");const t=st();if(e&&!t){const e=new E.A("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});pt.error(e)}this._override("locationEnabled",!!e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:i}=this;if(t===vt)return i??"";const s=e.at(t);return s?.placeholder??""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),""===e&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();const{view:e,resultGraphic:t}=this;e&&t&&e.graphics.remove(t),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const i=this._createSuggestionForSearch(e),s=(async()=>{try{await this.when();const e=await this._getResultsFromSources(i,t);if(t?.signal?.aborted)return null;const s={activeSourceIndex:this.activeSourceIndex,searchTerm:i.text??"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(s,e,i);const n=this._getFirstResult(s.results),r=i.location&&n?n.name:i.text,o=r?.replace(ft,"");return this._set("searchTerm",o),(i.key&&"number"==typeof i.sourceIndex||i.location)&&this._set("selectedSuggestion",i),this._set("results",s.results),this._set("resultCount",s.results.reduce(((e,t)=>e+(t.results?.length??0)),0)),this.emit("search-complete",s),await this._selectFirstResult(n),s}finally{this._clearSearching()}})();return this._searching=s,s}async searchNearby(e){if(!this.locationEnabled){const e=new E.A("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw pt.error(e),e}const t=(async()=>{try{const t=await function(e){return e||(e=it),new Promise(((t,i)=>{setTimeout((()=>i(new E.A("geolocation:timeout","getting the current geolocation position timed out"))),15e3),navigator.geolocation.getCurrentPosition(t,i,e??void 0)}))}(),i=await rt({position:t,view:this.view},e);return await this.search(i,e)}finally{this._clearSearching()}})();return this._searching=t,t}async select(e){if(this.clearGraphics(),!e){const t=new E.A("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});throw pt.error(t),t}const{view:t}=this,i=ut(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),s=null!=i?this.allSources.at(i):null;if(!s){const e=new E.A("select:missing-source","Cannot select without a source.",{source:s});throw pt.error(e),e}const n=s instanceof Le?this._getLayerSourcePopupTemplate(s):s.popupTemplate,r=s.resultSymbol||this._getDefaultSymbol(e),o=ut(s,"resultGraphicEnabled")?s.resultGraphicEnabled:this.resultGraphicEnabled,a=ut(s,"autoNavigate")?s.autoNavigate:this.autoNavigate,l=(ut(s,"popupEnabled")?s.popupEnabled:this.popupEnabled)?n||this.popupTemplate||this.defaultPopupTemplate:null,{feature:c}=e;if(!c){const e=new E.A("select:missing-feature","Cannot select without a feature.",{feature:c});throw pt.error(e),e}const{attributes:d,geometry:u,layer:h,sourceLayer:p}=c,y=U(u),g={layerViewQuery:this._getLayerView(c),elevationQuery:t&&null!=y?j(y,t).catch((()=>y)):Promise.resolve(y)},m=await(0,C.Lx)(g),f=m.layerViewQuery.value,v=m.elevationQuery.value;r instanceof dt.A&&(r.text=e.name);const _=t&&a?e.target||e.extent:null,b=null!=_?this._goToSearchResult(_):Promise.resolve();await b;const S=f?c:new w.A({geometry:u,symbol:r,attributes:d,layer:h,sourceLayer:p,popupTemplate:l}),M=t?.popup,L=M&&S.getEffectivePopupTemplate(M.defaultPopupTemplateEnabled);return L&&await t.openPopup({features:[S],location:v}),f&&(0,Z.Of)(f)&&!L&&this._highlightFeature({graphic:S,layerView:f}),!f&&o&&t&&t.graphics.push(S),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",S),this.emit("select-result",{result:e,source:s,sourceIndex:i}),e}async suggest(e,t,i){const s=e||this.searchTerm;this.emit("suggest-start",{searchTerm:s}),await this._suggestTimer(t,i);const n=await this._suggestImmediate(s,i);return this._set("suggestions",n?.results),this._set("suggestionCount",n?.results.reduce(((e,t)=>e+(t.results?.length??0)),0)??null),this.emit("suggest-complete",n),n}async when(){await(0,o.C_)((()=>!this.updating))}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const i=this._updatingPromise=(0,C.Lx)([e?.load(),t?.when()]);if(this.destroyed)return;if(await i,i!==this._updatingPromise)return}await(0,o.C_)((()=>this.messages)),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){const e=this.portal?.helperServices?.geocode;return e?e.map((e=>{if(!1===e.placefinding)return;const t=b.A.apiKey&&je(e.url)?{url:"https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer"}:null,i=Ye.fromJSON({...e,...t}),s=i.url;if(je(s)||function(e){return!!e&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}(s)||function(e){return!!e&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}(s)){const e=i.outFields??["Addr_type","Match_addr","StAddr","City"],t=(i.placeholder||this.messages?.placeholder)??"",s="number"==typeof i.defaultZoomScale?i.defaultZoomScale:2500;i.singleLineFieldName="SingleLine",i.outFields=e,i.placeholder=t,i.defaultZoomScale=s}return i.singleLineFieldName?i:void 0})).filter(d.Ru):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach((e=>e?.destroy())),this._createdFeatureLayers=[]}_getLayerSources(e,t){const i=this.view?.map;return e.map((e=>{const s=i.findLayerById(e.id);if(!s)return;const n=this._getLayerJSON(e),r=Le.fromJSON(n);return r.placeholder=t,this._getLayer(s,n).then((e=>{r.layer=e})),r})).filter(d.Ru).toArray()}_getTableSources(e,t){const i=this.view?.map;return e.map((e=>{if(!e.id)return;const s=i.findTableById(e.id);if(!s)return;const n=this._getLayerJSON(e),r=Le.fromJSON(n);return r.placeholder=t,this._getLayer(s,n).then((e=>{r.layer=e})),r})).filter(d.Ru).toArray()}_convertApplicationProperties(){const e=this.view?.map,t=e?.applicationProperties?.viewing?.search;if(!t)return[];const{enabled:i,hintText:s,layers:n,tables:r}=t;return i?[...this._getLayerSources(n,s),...this._getTableSources(r,s)]:[]}async _getSubLayer(e,t){if(await e.load(),!e.allSublayers)throw new Error;const i=e.allSublayers.find((e=>e.id===t.subLayer));if(!i)throw new Error;const s=await(i.createFeatureLayer?.());if(!s)throw new Error;return this._createdFeatureLayers.push(s),s}async _getBuildingSubLayer(e,t){await e.load();const i=e.allSublayers.find((e=>e.id===t.subLayer));if("building-component"!==i?.type)throw new Error;if(await i.load(),null==i.associatedLayer)throw new Error;return await i.associatedLayer.load(),i}async _getLayer(e,t){if("feature"===e.type||"scene"===e.type||"csv"===e.type||"geojson"===e.type||"ogc-feature"===e.type)return e;if("map-image"===e.type)try{return await this._getSubLayer(e,t)}catch(g){const i=new E.A("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return pt.error(i),null}return"building-scene"===e.type?this._getBuildingSubLayer(e,t):null}_getLayerJSON(e){return"function"==typeof e.toJSON?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){const e=this.view?.popup,{resultGraphic:t}=this;if(!e||!t)return;const i="selectedFeature"in e,s=i?e.selectedFeature:null;i&&s&&s===t&&e.close()}_suggestTimer(e,t){const i=null!=e?e:this.suggestionDelay;return(0,C.Pl)(i,null,t?.signal)}_createLocationForSearch(e){return e instanceof w.A?U(e.geometry):e instanceof x.A?e:Array.isArray(e)&&2===e.length?new x.A({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&ut(e,"key")&&ut(e,"text")&&ut(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),i="string"==typeof e?e:this.searchTerm,{selectedSuggestion:s,selectedResult:n}=this,r=!e&&s&&n,o=r&&s.key===n.key&&s.sourceIndex===n.sourceIndex,a=r&&s.location;return o||a?s:{location:t,text:t?"":i,sourceIndex:null,key:null}}_getFirstResult(e){let t=null;return e&&e.some((e=>{const{results:i}=e,s=i?.[0],n=!!s;return n&&(t=s),n})),t}async _selectFirstResult(e){return this.autoSelect&&e?this.select(e):null}async _suggestImmediate(e,t){await this.when();const i=await this._getSuggestionsFromSources(e,t);if(t?.signal?.aborted)return null;const s={activeSourceIndex:this.activeSourceIndex,searchTerm:e??"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(s,i),s}_formatSourceResponse(e,t,i){const s=t?.value||[],n=t?.error,r=this.allSources.at(i);if(n){const t={sourceIndex:i,source:r,error:n};e.errors.push(t),pt.error(n),e.numErrors++}else{const t={sourceIndex:i,source:r,results:s};e.results.push(t),e.numResults+=s.length}}_formatResponse(e,t,i){if(t)if(e.activeSourceIndex===vt){const s=i&&ut(i,"sourceIndex")&&-1!==i.sourceIndex?i.sourceIndex:void 0;t.forEach(((t,i)=>{const n=void 0!==s?s:i;this._formatSourceResponse(e,t,n)}))}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}async _getResultsFromSources(e,t){const{allSources:i}=this,s=!e.location&&ut(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,n=[];if(!i.length){const e=new E.A("search:no-sources-defined","At least one source is required.",{allSources:i});throw pt.error(e),e}return s===vt?i.forEach(((i,s)=>{n.push(this._getResultsFromSource(e,s,t))})):n.push(this._getResultsFromSource(e,s,t)),(0,C.Lx)(n)}async _getSuggestionsFromSources(e,t){const{allSources:i,activeSourceIndex:s}=this,n=[];if(!i.length){const e=new E.A("suggest:no-sources-defined","At least one source is required.",{allSources:i});throw pt.error(e),e}return s===vt?i.forEach(((i,s)=>{n.push(this._getSuggestionsFromSource(e,s,t))})):n.push(this._getSuggestionsFromSource(e,s,t)),(0,C.Lx)(n)}async _getResultsFromSource(e,t,i){const s=null!=t?this.allSources.at(t):null;if(!s)return null;const{location:n=null}=e,r=this.view?.spatialReference||mt,o=ut(s,"maxResults")?s.maxResults:this.maxResults,a=!!(s instanceof Le&&ut(s,"exactMatch"))&&s.exactMatch,{view:l}=this;return s.getResults?.({view:l,sourceIndex:t,location:n,suggestResult:e,spatialReference:r,exactMatch:a,maxResults:o},i)}async _getSuggestionsFromSource(e,t,i){const s=this.allSources.at(t);if(!s)return null;e??="";const n=ut(s,"suggestionsEnabled")?s.suggestionsEnabled:this.suggestionsEnabled,r=e?.length,o=ut(s,"minSuggestCharacters")?s.minSuggestCharacters:this.minSuggestCharacters;if(n&&e.trim()&&r>=o){const n=this.view?.spatialReference||mt,r=ut(s,"maxSuggestions")?s.maxSuggestions:this.maxSuggestions,{view:o}=this,a=!!(s instanceof Le&&ut(s,"exactMatch"))&&s.exactMatch;return s.getSuggestions?.({view:o,sourceIndex:t,suggestTerm:e,spatialReference:n,maxSuggestions:r,exactMatch:a},i)}return null}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return ut(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){const t=this.results;if(!t)return null;let i=null;return t.some((t=>t.results.some((s=>s===e&&(i=t.sourceIndex,!0))))),i}async _goToSearchResult(e){this._abortGoTo();const t=new AbortController;this._gotoController=t;const i={target:{target:e},options:{signal:t.signal}};e||(i.options.animate=!1),await this.callGoTo(i),this._gotoController=null}_getDefaultSymbol(e){const{defaultSymbols:t}=this,i=e.feature?.geometry;if(null==i)return null;switch(i.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this.removeHandles(yt)}async _getLayerView(e){const{view:t}=this;if(!e||!t||"building-component"===e.layer?.type||"subtype-sublayer"===e.layer?.type)return null;const{layer:i}=e;return i?(await t.when(),t.whenLayerView(i)):null}_highlightFeature(e){const{graphic:t,layerView:i}=e,{attributes:s,layer:n}=t,{objectIdField:r}=n,o=(r&&s?.[r])??null,a=i.highlight(o??t);this.addHandles(a,yt)}_setResultFloor(e){const{view:t}=this,i=e.feature?.attributes,s=e.feature?.sourceLayer;if(s&&"floorInfo"in s&&s?.floorInfo?.floorField&&i){const e=i[s.floorInfo.floorField];t?.emit("select-result-floor",e)}}};_t.ALL_INDEX=vt,(0,s._)([(0,l.MZ)()],_t.prototype,"_searching",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"_updatingPromise",void 0),(0,s._)([(0,l.MZ)({readOnly:!0,value:null})],_t.prototype,"activeSource",null),(0,s._)([(0,l.MZ)()],_t.prototype,"activeSourceIndex",null),(0,s._)([(0,l.MZ)()],_t.prototype,"allPlaceholder",null),(0,s._)([(0,l.MZ)({readOnly:!0})],_t.prototype,"allSources",null),(0,s._)([(0,l.MZ)()],_t.prototype,"autoNavigate",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"autoSelect",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"defaultPopupTemplate",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],_t.prototype,"defaultSources",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"defaultSymbols",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"includeDefaultSources",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"locationEnabled",null),(0,s._)([(0,l.MZ)()],_t.prototype,"maxInputLength",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"maxResults",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"maxSuggestions",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"messages",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"minSuggestCharacters",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],_t.prototype,"placeholder",null),(0,s._)([(0,l.MZ)()],_t.prototype,"popupEnabled",void 0),(0,s._)([(0,l.MZ)({type:S.A})],_t.prototype,"popupTemplate",void 0),(0,s._)([(0,l.MZ)({type:k.A})],_t.prototype,"portal",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"resultCount",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"resultGraphicEnabled",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],_t.prototype,"resultGraphic",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],_t.prototype,"results",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],_t.prototype,"selectedSuggestion",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"searchAllEnabled",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],_t.prototype,"selectedResult",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"searchTerm",null),(0,s._)([(0,l.MZ)({type:gt})],_t.prototype,"sources",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],_t.prototype,"state",null),(0,s._)([(0,l.MZ)()],_t.prototype,"suggestionDelay",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"suggestionCount",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],_t.prototype,"suggestions",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"suggestionsEnabled",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],_t.prototype,"updating",null),(0,s._)([(0,l.MZ)()],_t.prototype,"view",void 0),(0,s._)([(0,l.MZ)()],_t.prototype,"clear",null),_t=(0,s._)([(0,h.$)(ht)],_t);const bt=_t;var wt=i(35251),St=i(60682),Mt=i(43955),Lt=i(96704),Et=i(72638);let It=class extends p.A{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}destroy(){this.viewModel=null}render(){const e={[v.showMoreResults]:this.showMoreResultsOpen};return(0,Lt.K)("div",{class:this.classes(v.base,wt.D.widget)},(0,Lt.K)("div",{class:this.classes(v.moreResults,e),key:"esri-search-renderer__container"},this._renderSearchResultName(),this._renderMoreResults()))}_renderMoreResults(){return(0,Lt.K)("div",{key:"esri-search-renderer__more-results"},this._renderMoreResultsButton(),this._renderMoreResultsLists())}_renderSearchResultName(){const e=this.viewModel?.selectedResult,t=e?.name||"";return(0,Lt.K)("div",{class:v.moreResultsItem,key:"esri-search-renderer__result-name"},t)}_renderMoreResultsLists(){const{viewModel:e}=this;if(!e)return[];const t=e.results;if((e.resultCount??0)<2)return null;const i=t?.map((e=>this._renderMoreResultsList(e)));return(0,Lt.K)("div",{class:v.moreResultsList,key:"esri-search-renderer__more-results-container"},i)}_renderMoreResultsButton(){const{messages:e,viewModel:t}=this;return t?(t.resultCount??0)<2?null:(0,Lt.K)("div",{class:v.moreResultsItem,key:"esri-search-renderer__more-results-button"},(0,Lt.K)("a",{bind:this,class:wt.D.anchor,href:"#",onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults)):null}_renderMoreResultsHeader(e,t){return(0,Lt.K)("div",{class:v.moreResultsListHeader,key:`esri-search-result-renderer__header-${t}`},e)}_renderMoreResultsList(e){const{results:t}=e,i=t?.length??0,s=i>0,n=this.viewModel?.selectedResult,r=1===i&&t[0]===n,o=this._getSourceName(e.source,e.sourceIndex),a=(this.viewModel?.results?.length??0)>1&&!r?this._renderMoreResultsHeader(o,e.sourceIndex):null,l=s&&t.map(((e,t)=>this._renderMoreResultsListItem(e,t))),c=s&&!r?(0,Lt.K)("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},l):null;return s?(0,Lt.K)("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},a,c):null}_renderMoreResultsListItem(e,t){const i=this.viewModel?.selectedResult;return e!==i?(0,Lt.K)("li",{key:`esri-search-result-renderer__list-item-${t}`},(0,Lt.K)("a",{bind:this,class:wt.D.anchor,"data-result":e,href:"#",onclick:this._selectResultClick,onkeydown:this._selectResultClick,tabIndex:0},e.name)):null}_showMoreResultsClick(e){e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const t=this.viewModel?.view?.popup;t&&"reposition"in t&&t.reposition()}_selectResultClick(e){e.preventDefault();const t=e.currentTarget["data-result"];this.viewModel?.select(t)}_getSourceName(e,t){return t===bt.ALL_INDEX?this.messages.all:e.name}};(0,s._)([(0,l.MZ)(),(0,Mt.G)("esri/widgets/Search/t9n/Search")],It.prototype,"messages",void 0),(0,s._)([(0,l.MZ)()],It.prototype,"showMoreResultsOpen",void 0),(0,s._)([(0,l.MZ)()],It.prototype,"viewModel",void 0),(0,s._)([(0,St.$)()],It.prototype,"_showMoreResultsClick",null),(0,s._)([(0,St.$)()],It.prototype,"_selectResultClick",null),It=(0,s._)([(0,h.$)("esri.widgets.Search.SearchResultRenderer")],It);const Tt=It;var Ct=i(24611);const xt=/<[a-z/][\s\S]*>/i;let At=class extends p.A{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new Tt,this._suggestController=null,this._searchController=null,this._locateFailed=!1,this._container=null,this.activeMenu="none",this.disabled=!1,this.iconClass=m.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.viewModel=new bt,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=e=>{const t=e.relatedTarget;t&&this._container?.contains(t)||this._clearActiveMenu()},this.addHandles([(0,o.wB)((()=>this.searchTerm),(e=>{(e&&"warning"===this.activeMenu||!e&&!this.viewModel?.selectedSuggestion?.location)&&this._clearActiveMenu()})),(0,o.on)((()=>this.viewModel?.allSources),"change",(()=>this._watchSourceChanges())),(0,o.wB)((()=>this.activeMenu),(()=>this._resetActiveMenuItemIndex()),o.Vh),(0,o.wB)((()=>this.viewModel?.defaultPopupTemplate),(e=>{e&&(e.content=this._renderSearchResultsContent.bind(this))}),o.Vh)])}destroy(){this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer=(0,r.pR)(this._searchResultRenderer)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}get activeSource(){return this.viewModel?.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){return this.viewModel?.portal}set portal(e){this.viewModel&&(this.viewModel.portal=e)}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this.viewModel.clear()}focus(){this._inputNode?.focus(),this.emit("search-focus")}blur(){this._inputNode?.blur(),this.emit("search-blur")}async search(e){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:i}=t;this._searchController=t;try{const s=await this.viewModel.search(e,{signal:i});if(this._searchController!==t)return;return this.activeMenu=s?.numResults?"none":"warning",this._searchController=null,s}catch(s){if(this._searchController!==t)return;return this._clearActiveMenu(),void(this._searchController=null)}}async suggest(e){this._cancelSuggest();const t=new AbortController,{signal:i}=t;this._suggestController=t;try{const s=await this.viewModel.suggest(e,null,{signal:i});if(this._suggestController!==t)return;return this._suggestController=null,s?.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),s}catch(s){return this._suggestController!==t||(this._suggestController=null),null}}render(){const{state:e}=this.viewModel,t={[wt.D.disabled]:"disabled"===e,[wt.D.widgetDisabled]:this.disabled};return(0,Lt.K)("div",{class:this.classes(m.base,wt.D.widget,t)},"loading"===e?this._renderLoader():this._renderContainer())}_renderSubmitButton(){const{messages:e,disabled:t}=this;return(0,Lt.K)("button",{"aria-label":e.searchButtonTitle,bind:this,class:this.classes(m.submitButton,wt.D.widgetButton),disabled:t,key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle,type:"button"},(0,Lt.K)("span",{"aria-hidden":"true",class:y.T.search}))}_renderWarningMenu(){return(0,Lt.K)("div",{class:this.classes(wt.D.menu,m.warningMenu),key:"esri-search__error-menu"},(0,Lt.K)("div",{class:m.warningMenuBody},this._renderWarning()))}_renderSourceMenuButton(){const{messages:e,activeMenu:t,sourceMenuId:i,sourceMenuButtonId:s,disabled:n}=this,{activeSourceIndex:r,allSources:o}=this.viewModel;return o.length>1?(0,Lt.K)("button",{afterCreate:Et.cA,"aria-controls":i,"aria-expanded":("source"===t).toString(),"aria-haspopup":"true","aria-label":e.searchIn,bind:this,class:this.classes(m.sourcesButton,wt.D.widgetButton),"data-node-ref":"_sourceMenuButtonNode",disabled:n,id:s,key:"esri-search__source-menu-button",onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,title:e.searchIn,type:"button"},(0,Lt.K)("span",{"aria-hidden":"true",class:this.classes(y.T.downArrow,m.sourcesButtonDown)}),(0,Lt.K)("span",{"aria-hidden":"true",class:this.classes(y.T.upArrow,m.sourcesButtonUp)}),(0,Lt.K)("span",{class:m.sourceName},this._getSourceName(r))):null}_renderSourcesList(){const{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:i,activeMenu:s,sourceMenuId:n,sourceMenuButtonId:r}=this,o="source"===s&&i>-1?this._buildId("source-item",i):null;return e.length>1?(0,Lt.K)("ul",{afterCreate:Et.cA,"aria-activedescendant":o,"aria-labelledby":r,bind:this,class:wt.D.menuList,"data-node-ref":"_sourceListNode",id:n,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,role:"menu",tabIndex:-1},t?this._renderSource(bt.ALL_INDEX):null,e.map(((e,t)=>this._renderSource(t))).toArray()):null}_renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?(0,Lt.K)("div",{class:this.classes(wt.D.menu,m.sourcesMenu),key:"esri-search__source-menu"},this._renderSourcesList()):null}_renderLoader(){const{messages:e,messagesCommon:t,disabled:i}=this;return(0,Lt.K)("div",{class:wt.D.loader,key:"base-loader",tabIndex:i?-1:void 0},(0,Lt.K)("span",{"aria-hidden":"true",class:wt.D.loaderAnimation}),(0,Lt.K)("span",{class:y.T.fontFallbackText},e.searchButtonTitle),(0,Lt.K)("span",{class:wt.D.loaderText},t.loading))}_renderContainer(){const{allSources:e,state:t}=this.viewModel,{activeMenu:i}=this,s={[m.hasMultipleSources]:e.length>1,[m.isLoading]:"loading"===t,[m.isSearching]:"searching"===t,[m.showWarning]:"warning"===i,[m.showSources]:"source"===i,[m.showSuggestions]:"suggestion"===i};return(0,Lt.K)("div",{afterCreate:e=>{this._container=e,e.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:e=>{e.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(s,m.container),key:"base-container",tabIndex:-1},this._renderSourceMenuButton(),this._renderSourcesMenu(),this._renderInputContainer(),this._renderSubmitButton(),this._renderWarningMenu())}_renderClearButton(){return this.searchTerm?(0,Lt.K)("button",{bind:this,class:this.classes(m.clearButton,wt.D.widgetButton),disabled:this.disabled,key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},(0,Lt.K)("span",{"aria-hidden":"true",class:y.T.close})):null}_renderLocationGroup(){const{messages:e,locationEnabled:t,displayedSearchTerm:i}=this,s=t&&!i,n="suggestion"===this.activeMenu&&0===this._activeMenuItemIndex;return s?(0,Lt.K)("ul",{class:this.classes(wt.D.menuList,m.suggestionList,m.suggestionListCurrentLocation),key:"esri-search__suggestion-list-current-location",role:"group"},(0,Lt.K)("li",{"aria-selected":("suggestion"===this.activeMenu&&0===this._activeMenuItemIndex).toString(),bind:this,class:this.classes(wt.D.menuItem,n?wt.D.menuItemFocus:null),"data-current-location-item":!0,id:this._buildId("suggestion-item",0),onclick:this._handleUseCurrentLocationClick,role:"option"},(0,Lt.K)("span",{"aria-hidden":"true",class:y.T.locateCircled})," ",e.useCurrentLocation)):null}_renderInput(){const{activeMenu:e,locationEnabled:t,displayedSearchTerm:i,messages:s,suggestionsMenuId:n,inputId:r,_activeMenuItemIndex:o,disabled:a}=this,{maxInputLength:l,placeholder:c,searchTerm:d,suggestionCount:u}=this.viewModel,h=!((!t||i)&&!u),p="suggestion"===e&&o>-1?this._buildId("suggestion-item",o):null;return(0,Lt.K)("input",{afterCreate:Et.cA,"aria-activedescendant":p,"aria-autocomplete":"list","aria-controls":h?n:null,"aria-expanded":(h&&"suggestion"===e).toString(),"aria-haspopup":"listbox","aria-label":s.searchButtonTitle,autocomplete:"off",bind:this,class:this.classes(wt.D.input,m.input),"data-node-ref":"_inputNode",disabled:a,id:r,maxlength:l,onblur:this.blur,onclick:this._openSuggestionMenu,onfocus:this.focus,oninput:this._handleInputPaste,onkeyup:this._handleInputKeyup,onpaste:this._handleInputPaste,placeholder:c,role:"combobox",title:d?"":c,type:"text",value:d})}_renderForm(){return(0,Lt.K)("form",{bind:this,class:m.form,disabled:this.disabled,key:"esri-search__form",onsubmit:this._formSubmit,role:"search"},this._renderInput())}_renderSuggestList(e){const{sourceIndex:t}=e,{results:i}=e,s=i?.length;return s?(0,Lt.K)("ul",{class:this.classes(wt.D.menuList,m.suggestionList),key:`esri-search__suggestion-list-${t}`,role:"group"},i?.map((e=>this._renderSuggestion(e,this._menuItemCount++)))):null}_renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map((e=>[this._renderSuggestionHeader(e),this._renderSuggestList(e)])):[]}_renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:i,inputId:s}=this,{suggestionCount:n}=this.viewModel,r=t&&!e||n;return this._menuItemCount=0,r?(0,Lt.K)("div",{afterCreate:Et.cA,"aria-labelledby":s,bind:this,class:this.classes(wt.D.menu,m.suggestionsMenu),"data-node-ref":"_suggestionListNode",id:i,key:"esri-search__suggestions-menu",role:"listbox"},this._renderLocationGroup(),this._renderSuggestionsGroup()):null}_renderInputContainer(){return(0,Lt.K)("div",{class:m.inputContainer,key:"esri-search__input-container"},this._renderForm(),this._renderSuggestionsMenu(),this._renderClearButton())}_renderSuggestionHeader(e){const{allSources:t,activeSourceIndex:i}=this.viewModel,{sourceIndex:s}=e,n=e.results?.length,r=t.length>1&&i===bt.ALL_INDEX;return n&&r?(0,Lt.K)("div",{class:wt.D.menuHeader,key:`esri-search__suggestion-header-${s}`},this._getSourceName(s)):null}_renderSuggestion(e,t){const{_activeMenuItemIndex:i,viewModel:{searchTerm:s}}=this;if(!s)return;const n="suggestion"===this.activeMenu&&i===t;return(0,Lt.K)("li",{"aria-selected":("suggestion"===this.activeMenu&&this._activeMenuItemIndex===t).toString(),bind:this,class:this.classes(wt.D.menuItem,n?wt.D.menuItemFocus:null),"data-suggestion":e,id:this._buildId("suggestion-item",t),innerHTML:this._getSuggestResultHTML(e.text,s),key:`esri-search__suggestion_${t}`,onclick:this._handleSuggestionClick,role:"option"})}_renderSource(e){const{activeSourceIndex:t,searchAllEnabled:i}=this.viewModel,s={[wt.D.menuItemActive]:e===t,[wt.D.menuItemFocus]:"source"===this.activeMenu&&e===(i?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},n=i?e+1:e;return(0,Lt.K)("li",{"aria-checked":(e===t).toString(),bind:this,class:this.classes(m.source,wt.D.menuItem,s),"data-source-index":e,id:this._buildId("source-item",n),key:`esri-search__source-${e}`,onclick:this._handleSourceClick,role:"menuitemradio"},this._getSourceName(e))}_renderNoResultsWarning(e){const{messages:t}=this,i=e?(0,Y.V)(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return(0,Lt.K)("div",{key:"esri-search__no_results"},(0,Lt.K)("div",{class:m.warningMenuHeader},t.noResults),(0,Lt.K)("div",{class:m.warningMenuText},i))}_renderEmptySearchWarning(){const{messages:e}=this;return(0,Lt.K)("div",{key:"esri-search__empty-search"},(0,Lt.K)("span",{"aria-hidden":"true",class:y.T.noticeTriangle}),(0,Lt.K)("span",{class:m.noValueText},e.emptyValue))}_renderLocateWarning(){const{messages:e}=this;return(0,Lt.K)("div",{key:"esri-search__locate-error"},(0,Lt.K)("span",{"aria-hidden":"true",class:y.T.noticeTriangle}),(0,Lt.K)("span",{class:m.noValueText},e.locateError))}_renderWarning(){const{displayedSearchTerm:e,_locateFailed:t}=this,{viewModel:i}=this;return t?this._renderLocateWarning():i.selectedSuggestion?.location||e?this._renderNoResultsWarning(e):this._renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,t){return`${this.id}-${e}${void 0===t?"":`-${t}`}`}_watchSourceChanges(){const{viewModel:{allSources:e}}=this,t="sources";this.removeHandles(t),e.forEach((e=>this.addHandles((0,o.wB)((()=>e.name),(()=>this.scheduleRender())),t)))}_handleSourcesMenuToggleFocus(){"source"!==this.activeMenu&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){const e="source"===this.activeMenu;this.activeMenu=e?"none":"source",this.renderNow(),"source"===this.activeMenu&&this._sourceListNode?.focus()}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){const t=Rt(e.currentTarget);t&&(this._focus(),this.search(t))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:t}=e;this._searchController=e,(async()=>{try{const e=await this.viewModel.searchNearby({signal:t});this.activeMenu=e?.numResults?"none":"warning"}catch(e){this._locateFailed=!0,this.activeMenu="warning"}finally{this._searchController=null}})()}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){if(!e)return;const t=function(e){return e?.["data-source-index"]}(e);null!=t&&(this.viewModel.activeSourceIndex=t,this._clearActiveMenu(),this._sourceMenuButtonNode?.focus())}_cancelSuggest(){this._suggestController=(0,r.DC)(this._suggestController)}_cancelSearch(){this._searchController=(0,r.DC)(this._searchController),this._locateFailed=!1}_handleInputKeyup(e){const t=(0,n.Mk)(e);if(e.ctrlKey||e.metaKey||"Copy"===t||"ArrowLeft"===t||"ArrowRight"===t||"Shift"===t)return;if("Tab"===t||"Escape"===t||e.shiftKey&&"Tab"===t)return this._cancelSuggest(),void("Escape"===t&&this._clearActiveMenu());const i="Home"===t||"End"===t||"ArrowUp"===t||"ArrowDown"===t;if("Enter"===t&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const s=this._suggestionListNode?.getElementsByTagName("li");if(s?.length){if("suggestion"!==this.activeMenu&&this._openSuggestionMenu(),i)return e.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(t,s,this._suggestionListNode);const n=s[this._activeMenuItemIndex];if("Enter"===t&&n){const e=Rt(n);return void(e?(this._focus(),this.search(e)):function(e){return!!e?.["data-current-location-item"]}(n)&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(e,t,i){const s=this._activeMenuItemIndex;"Home"===e&&(this._activeMenuItemIndex=0),"End"===e&&(this._activeMenuItemIndex=t.length-1),"ArrowUp"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),"ArrowDown"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),s!==this._activeMenuItemIndex&&i&&(0,Et.yH)(t[this._activeMenuItemIndex],i)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(e){const t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){const t=(0,n.Mk)(e);if((0,Et.OU)(t)){e.preventDefault();const t=this._sourceListNode?.getElementsByTagName("li"),i=t?.[this._activeMenuItemIndex];this._setSourceFromMenuItem(i)}else"ArrowUp"!==t&&"ArrowDown"!==t&&"End"!==t&&"Home"!==t||e.preventDefault()}_handleSourceMenuKeyup(e){const t=(0,n.Mk)(e),i="ArrowUp"===t||"ArrowDown"===t||"End"===t||"Home"===t;if(i&&e.preventDefault(),"Escape"===t)return this._clearActiveMenu(),void this._sourceMenuButtonNode?.focus();const s=this._sourceListNode?.getElementsByTagName("li");return s&&0!==s.length&&i?("source"!==this.activeMenu&&(this.activeMenu="source"),void this._handleItemNavigation(t,s,this._sourceListNode?.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),-1===this._activeMenuItemIndex&&this.search()}_getSourceName(e){const{messages:t}=this,i=this.viewModel,{allSources:s}=i,n=s.at(e);return e===bt.ALL_INDEX?t.all:n&&n.name||t.untitledSource}_getSuggestResultHTML(e,t){return e?xt.test(e)?e:((e,t)=>{const i=(0,a.Cj)(t).split(/\s/),s=new RegExp(`(${i.join("|")})`,"gi");return e.replace(s,(e=>`<strong>${e}</strong>`))})(e,t):this.messages.untitledResult}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};function Rt(e){return e?.["data-suggestion"]}(0,s._)([(0,l.MZ)()],At.prototype,"_activeMenuItemIndex",void 0),(0,s._)([(0,l.MZ)()],At.prototype,"displayedSearchTerm",null),(0,s._)([(0,l.MZ)({readOnly:!0})],At.prototype,"inputId",null),(0,s._)([(0,l.MZ)({readOnly:!0})],At.prototype,"suggestionsMenuId",null),(0,s._)([(0,l.MZ)({readOnly:!0})],At.prototype,"sourceMenuId",null),(0,s._)([(0,l.MZ)({readOnly:!0})],At.prototype,"sourceMenuButtonId",null),(0,s._)([(0,l.MZ)()],At.prototype,"activeMenu",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],At.prototype,"activeSource",null),(0,s._)([(0,l.MZ)()],At.prototype,"activeSourceIndex",null),(0,s._)([(0,l.MZ)()],At.prototype,"allPlaceholder",null),(0,s._)([(0,l.MZ)({readOnly:!0})],At.prototype,"allSources",null),(0,s._)([(0,l.MZ)()],At.prototype,"autoNavigate",null),(0,s._)([(0,l.MZ)()],At.prototype,"autoSelect",null),(0,s._)([(0,l.MZ)({readOnly:!0})],At.prototype,"defaultSources",null),(0,s._)([(0,l.MZ)()],At.prototype,"disabled",void 0),(0,s._)([(0,l.MZ)()],At.prototype,"goToOverride",null),(0,s._)([(0,l.MZ)()],At.prototype,"iconClass",void 0),(0,s._)([(0,l.MZ)()],At.prototype,"icon",void 0),(0,s._)([(0,l.MZ)()],At.prototype,"includeDefaultSources",null),(0,s._)([(0,l.MZ)()],At.prototype,"label",null),(0,s._)([(0,l.MZ)()],At.prototype,"locationEnabled",null),(0,s._)([(0,l.MZ)()],At.prototype,"maxResults",null),(0,s._)([(0,l.MZ)()],At.prototype,"maxSuggestions",null),(0,s._)([(0,l.MZ)(),(0,Mt.G)("esri/widgets/Search/t9n/Search")],At.prototype,"messages",void 0),(0,s._)([(0,l.MZ)(),(0,Mt.G)("esri/t9n/common")],At.prototype,"messagesCommon",void 0),(0,s._)([(0,l.MZ)()],At.prototype,"minSuggestCharacters",null),(0,s._)([(0,l.MZ)()],At.prototype,"popupEnabled",null),(0,s._)([(0,l.MZ)()],At.prototype,"popupTemplate",null),(0,s._)([(0,l.MZ)()],At.prototype,"portal",null),(0,s._)([(0,l.MZ)()],At.prototype,"resultGraphic",null),(0,s._)([(0,l.MZ)()],At.prototype,"resultGraphicEnabled",null),(0,s._)([(0,l.MZ)({readOnly:!0})],At.prototype,"results",null),(0,s._)([(0,l.MZ)()],At.prototype,"searchAllEnabled",null),(0,s._)([(0,l.MZ)()],At.prototype,"searchTerm",null),(0,s._)([(0,l.MZ)({readOnly:!0})],At.prototype,"selectedResult",null),(0,s._)([(0,l.MZ)()],At.prototype,"sources",null),(0,s._)([(0,l.MZ)({readOnly:!0})],At.prototype,"suggestions",null),(0,s._)([(0,l.MZ)()],At.prototype,"suggestionsEnabled",null),(0,s._)([(0,l.MZ)()],At.prototype,"view",null),(0,s._)([(0,Ct.U)(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),(0,l.MZ)({type:bt})],At.prototype,"viewModel",void 0),At=(0,s._)([(0,h.$)("esri.widgets.Search")],At);const Ot=At},60105:(e,t,i)=>{i.d(t,{A:()=>Ci});var s=i(66866),n=(i(17791),i(20464)),r=i(6267),o=i(85251),a=i(21564),l=(i(73446),i(85569)),c=(i(39831),i(63863)),d=i(46928),u=i(30822),h=i(48982),p=i(98849),y=i(17306),g=i(539),m=i(40189),f=i(47936),v=i(97303),_=i(65319),b=i(87926),w=i(31828),S=i(21292),M=i(42497),L=i(49858),E=i(27451);var I=i(7407),T=i(54874),C=i(70384),x=i(86084),A=i(30520),R=i(52495),O=i(97847),k=i(1381),Z=i(40508),P=i(92976),F=i(58680),N=i(21839),D=i(22279),V=i(57137),G=i(4238),$=i(81066),B=i(76859),z=i(25758),H=i(58921),K=i(40454),j=i(61851);let U=class extends R.A{get layerView(){return this.view?.allLayerViews?.find((e=>e.layer===this.layer))}get valid(){return this._valid}get subtypeFilter(){const{layer:e}=this;if(!(0,K.F2)(e)||!e.subtypes?.length)return{mode:"not-in-use",filter:null};const t=e.fieldsIndex.get(e.subtypeField)?.name??e.subtypeField,i=e.sublayers.filter((e=>e.visible)).map((e=>e.subtypeCode));return i.length?i.length===e.subtypes.length?{mode:"all-visible",filter:null}:1===i.length?{mode:"in-use",filter:`${t} = ${i.getItemAt(0)}`}:{mode:"in-use",filter:`${t} IN (${i.join(", ")})`}:{mode:"none-visible",filter:null}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?(0,H.E)({view:e,layer:t}):null}constructor(e){super(e),this.rulesTable=null,this._valid=!1}initialize(){if(!this.snappingSource||!this.layer)return;const{layer:e,snappingSource:t}=this;if("refresh"in e){const i=e;this.addHandles(i.on("refresh",(()=>t.refresh())))}this.loadRules(),this.addHandles([(0,o.wB)((()=>t.updating),(e=>t.layerSource.updating=e),o.pc),(0,o.wB)((()=>t.availability),(e=>t.layerSource.availability=e),o.pc)])}getFetchCandidatesParameters(e,t,i){if(!this.valid)return[];const{layer:s,layerView:n,floorFilter:r,rulesTable:o,subtypeFilter:a}=this,l={distance:i,mode:this.view?.type??"2d",point:e,coordinateHelper:t.coordinateHelper,...this._types,filter:n&&"filter"in n?n.filter:null};if(r&&(l.filter=q(l.filter,r)),"not-in-use"!==a.mode&&"all-visible"!==a.mode){if("none-visible"===a.mode)return[];l.filter?l.filter.where=(0,B.m)(l.filter.where,a.mode):l.filter=new z.A({where:a.filter})}if(o){const e=t.feature,i=e?.sourceLayer;if(!(e&&(0,K.yZ)(s)&&s.layerId&&(0,K.yZ)(i)&&"loaded"===o.loadStatus))return[];const n=[],r=s.layerId,a=o.getFeatureSQL(i,e)?.[r];if(!a)return[];const c=a.anyVertex;let d=a.endVertex;return d&&c&&d===c&&(d=""),d&&n.push({...l,returnEdge:!1,vertexMode:"ends",filter:q(l.filter,d)}),c&&n.push({...l,returnEdge:!1,vertexMode:"all",filter:q(l.filter,c)}),n}return[l]}async loadRules(){const{layer:e,view:t}=this;if(e&&t&&(0,j.Tu)(t?.map)&&(0,K.yZ)(e)){const i=t.map.utilityNetworks?.find((t=>t.isUtilityLayer(e)));if(i)try{this.rulesTable=await i.getRulesTable(),await(this.rulesTable?.load()),this._valid=!0}catch(Ie){return void g.A.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}}else this._valid=!0}get _types(){return{returnEdge:!0,vertexMode:"all"}}remove(){this.destroy()}destroy(){this.snappingSource?.destroy()}};function q(e,t){return null==e?new z.A({where:t}):e.where?new z.A({where:(0,B.m)(e.where,t)}):new z.A({where:t})}(0,s._)([(0,a.MZ)({constructOnly:!0})],U.prototype,"layer",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],U.prototype,"snappingSource",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],U.prototype,"view",void 0),(0,s._)([(0,a.MZ)()],U.prototype,"layerView",null),(0,s._)([(0,a.MZ)()],U.prototype,"rulesTable",void 0),(0,s._)([(0,a.MZ)()],U.prototype,"valid",null),(0,s._)([(0,a.MZ)()],U.prototype,"subtypeFilter",null),(0,s._)([(0,a.MZ)()],U.prototype,"floorFilter",null),(0,s._)([(0,a.MZ)()],U.prototype,"_valid",void 0),U=(0,s._)([(0,c.$)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],U);var W,J=i(46113),Y=i(15991),Q=i(90814),X=i(820),ee=i(4368),te=i(23495);class ie extends X.C{constructor({targetPoint:e,constraint:t,previousVertex:i,otherVertex:s,otherVertexType:n,objectId:r,isDraped:o}){super(e,t,o,Z.n.SELF),this.previousVertex=i,this.otherVertex=s,this.otherVertexType=n,this.objectId=r}get hints(){const e=this.previousVertex,t=this.otherVertexType===W.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===W.CENTER?this.targetPoint:this.otherVertex;return[new ee.c(j.H3.TARGET,t,i,this.isDraped,this.domain),new ee.c(j.H3.REFERENCE,e,t,this.isDraped,this.domain),new te.l(this.previousVertex,t,i,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(W||(W={}));var se=i(38175);let ne=class extends R.A{get updating(){return this._snappingSources.some((e=>null==e||e.valid&&e.snappingSource.updating))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=Z.n.FEATURE,this._updatingHandles=new G.U,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=(0,o.lZ)((()=>this.options?.featureSources),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles((0,n.DQ)(e))}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,i,s){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const n=[],r=this._computeScreenSizeDistanceParameters(e,i);for(const a of this._snappingSources){if(null==a||!a.valid||!a.snappingSource.layerSource.enabled||a.layerView?.suspended)continue;const t=a.getFetchCandidatesParameters(e,i,r);for(const e of t)n.push(a.snappingSource.fetchCandidates(e,s).then((e=>e.filter((e=>!this._candidateIsExcluded(a.snappingSource,e,i.excludeFeature))))))}const o=(await(0,m.nA)(n)).flat();return this._addRightAngleCandidates(o,e,r,i),(0,m.Te)(s),(0,j.xX)(e,o),o}_addRightAngleCandidates(e,t,i,s){const n=null!=s.vertexHandle?s.vertexHandle.rightEdge?.rightVertex?.pos:null!=s.editGeometryOperations&&"polygon"===s.editGeometryOperations.data.type?s.editGeometryOperations.data.components[0]?.getFirstVertex()?.pos:null,r=null!=s.vertexHandle?s.vertexHandle.leftEdge?.leftVertex?.pos:null!=s.editGeometryOperations?s.editGeometryOperations.data.components[0]?.getLastVertex()?.pos:null,{view:o}=this,a=(0,O.Lp)(n,o,s),l=(0,O.Lp)(r,o,s),c=e.length;for(let d=0;d<c;d++)this._addRightAngleCandidate(e[d],l,t,i,e),this._addRightAngleCandidate(e[d],a,t,i,e)}_addRightAngleCandidate(e,t,i,s,n){if(null==t||!function(e){return(e instanceof Y.z||e instanceof J.X)&&!function({constraint:{start:e,end:t}}){const i=(0,N.a)(e,t),s=(0,F.k)(e,t);return i<(0,V.g)()||s/i<le}(e)}(e))return;const r=e.constraint.closestTo(t),o=(r[0]-i[0])/s.x,a=(r[1]-i[1])/s.y,{start:l,end:c}=e.constraint;if(o*o+a*a<=1){const i=new ie({targetPoint:r,otherVertex:t,otherVertexType:W.NEXT,previousVertex:(0,F.k)(r,l)>(0,F.k)(r,c)?l:c,constraint:new $.FX(t,r),objectId:e.objectId,isDraped:e.isDraped});n.push(i)}}_computeScreenSizeDistanceParameters(e,t){let i=null!=this.options?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:i,y:i,z:i,distance:i}:"2d"===this.view.type?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,s){const{spatialReference:n}=s;i.renderCoordsHelper.toRenderCoords(e,n,oe);const r=i.state.camera.computeScreenPixelSizeAt(oe),o=r*i.renderCoordsHelper.unitInMeters,a=o/(0,P.GA)(n),l=o/(0,P.G9)(n),c=t*a,d=t*l,u=(0,se.jq)(e,n,E.qt,i),h=u?re(u,e,a,0,0,i,s):0,p=u?re(u,e,0,a,0,i,s):0,y=u?re(u,e,0,0,l,i,s):0;return{x:0===h?0:c/h,y:0===p?0:c/p,z:0===y?0:d/y,distance:r*t}}_candidateIsExcluded(e,t,i){if(null==i)return!1;const s=this._getCandidateObjectId(t);if(null==s)return!1;const n=e.layerSource.layer;return"graphics"===n.type?i.uid===s:i.sourceLayer===n&&!(!i.attributes||!("objectIdField"in n))&&i.attributes[n.objectIdField]===s}_getCandidateObjectId(e){return e instanceof Q.w?e.objectId:null}async _createSourceInfo(e,t){const i=e.layer;i.loaded||(await i.load(),(0,m.Te)(t));const{view:s}=this,n=await this._createFeatureSnappingSourceType(e);return(0,m.Te)(t),new U(null==n?{}:{snappingSource:n,view:s,layer:i})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return null==t||"3d"!==t.type?null:new((await this._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source?.type){case"feature-layer":case"oriented-imagery":return new((await this._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===e.layer.geometryType?null:new((await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>e.layer.sublayers?.toArray()??[],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),i={module:null,loader:t};this._sourceModules[e]=i;const s=await t,n={module:s,loader:t};return this._sourceModules[e]=n,s}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(i.e(4858).then(i.bind(i,44858)));case"featureCollection":return t.addPromise(i.e(3476).then(i.bind(i,33476)));case"graphics":case"notes":return t.addPromise(Promise.all([i.e(2076),i.e(1615),i.e(6109),i.e(587)]).then(i.bind(i,70587)));case"scene":return t.addPromise(Promise.all([i.e(4133),i.e(1529)]).then(i.bind(i,11529)))}}get test(){return{snappingSources:this._snappingSources}}};function re(e,t,i,s,n,r,{spatialReference:o}){const a=(0,N.c)(ae,t);a[0]+=i,a[1]+=s,a[2]+=n;const l=(0,se.jq)(a,o,E.qt,r);return l?(0,j.Mo)(l,e):1/0}(0,s._)([(0,a.MZ)({constructOnly:!0})],ne.prototype,"spatialReference",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],ne.prototype,"view",void 0),(0,s._)([(0,a.MZ)()],ne.prototype,"options",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],ne.prototype,"updating",null),(0,s._)([(0,a.MZ)()],ne.prototype,"_snappingSources",void 0),ne=(0,s._)([(0,c.$)("esri.views.interactive.snapping.FeatureSnappingEngine")],ne);const oe=(0,D.c)(),ae=(0,D.c)(),le=1e-4;class ce{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=k.N.shortLineThreshold*k.N.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,O.Lp)(e.leftVertex.pos,this.view,t),(0,O.Lp)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,{spatialReference:i}){return 0===this.squaredShortLineThreshold||(0,j.pM)((0,se.jq)(t,i,E.qt,this.view),(0,se.jq)(e,i,E.qt,this.view))>this.squaredShortLineThreshold}isVertical(e,t){return(0,F.k)(e,t)<k.N.verticalLineThreshold}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}class de extends X.C{constructor({lineStart:e,lineEnd:t,targetPoint:i,isDraped:s}){super(i,new $.WG(e,t),s,Z.n.SELF),this._referenceLineHint=new ee.c(j.H3.REFERENCE_EXTENSION,e,t,s,this.domain)}get hints(){return[this._referenceLineHint,new ee.c(j.H3.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var ue=i(29106),he=i(41561);class pe extends ce{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=i.edges.length,n=[];if(s<1)return n;const{spatialReference:r}=t,o=(0,se.jq)(e,r,E.qt,this.view),{view:a}=this,l=i.edges[s-1];let c=l;do{if(this.edgeExceedsShortLineThreshold(c,t)){const i=(0,j.is)(c,a,t);this._processCandidateProposal(i.left,i.right,e,o,t,n)}c=c.leftVertex.leftEdge}while(c&&c!==l);return n}snapExistingVertex(e,t){const i=[],s=t.vertexHandle,n=s.component;if(n.edges.length<2)return i;const{view:r}=this,{spatialReference:o}=t,a=(0,se.jq)(e,o,E.qt,r),l=s.leftEdge,c=s.rightEdge;l&&c&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal((0,O.Lp)(l.leftVertex.pos,r,t),(0,O.Lp)(c.rightVertex.pos,r,t),e,a,t,i);const d=n.edges[0];let u=d;do{if(u!==s.leftEdge&&u!==s.rightEdge&&this.edgeExceedsShortLineThreshold(u,t)){const s=(0,j.is)(u,r,t);this._processCandidateProposal(s.left,s.right,e,a,t,i)}u=u.rightVertex.rightEdge}while(u&&u!==d);return i}_processCandidateProposal(e,t,i,s,n,r){const{spatialReference:o,pointer:a}=n,l=(0,O._7)((0,ue.Yv)(i,{start:e,end:t,type:he.Vv.LINE}));(0,j.pM)(s,(0,se.jq)(l,o,E.qt,this.view))<this.squaredProximityThreshold(a)&&r.push(new de({lineStart:e,lineEnd:t,targetPoint:l,isDraped:"on-the-ground"===n.elevationInfo?.mode}))}}var ye=i(78286),ge=i(74989);class me extends X.C{constructor({referenceLine:e,lineStart:t,targetPoint:i,isDraped:s}){const n=(0,D.g)(t),{left:r,right:o}=e;(0,N.f)(n,(0,N.g)(n,n,o),r),super(i,new $.WG(t,(0,O._7)(n)),s,Z.n.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new ee.c(j.H3.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new ge.r(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new ee.c(j.H3.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((i=>{(0,N.h)(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),(0,N.h)(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),(0,N.h)(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),(0,N.h)(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class fe extends ce{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=i.edges.length,n=i.vertices.length,r=[];if(s<2)return r;const{view:o}=this,a=(0,se.jq)(e,t.spatialReference,E.qt,o),l=(0,O.Lp)(i.vertices[n-1].pos,o,t),c=(0,O.Lp)(i.vertices[0].pos,o,t),d=i.edges[s-1];let u=d;do{if(this.edgeExceedsShortLineThreshold(u,t)){const i=(0,j.is)(u,o,t);this._checkEdgeForParallelLines(i,l,e,a,t,r),this._checkEdgeForParallelLines(i,c,e,a,t,r)}u=u.leftVertex.leftEdge}while(u&&u!==d);return r}snapExistingVertex(e,t){const i=[],s=t.vertexHandle,n=s.component;if(n.edges.length<3)return i;const{view:r}=this,o=(0,se.jq)(e,t.spatialReference,E.qt,r),a=s.leftEdge,l=s.rightEdge,c=n.vertices[0],d=(0,O.Lp)(c.pos,r,t),u=n.vertices.length,h=n.vertices[u-1],p=(0,O.Lp)(h.pos,r,t),y=n.edges[0];let g=y;do{if(g!==a&&g!==l&&this.edgeExceedsShortLineThreshold(g,t)){const n=(0,j.is)(g,r,t);a&&this._checkEdgeForParallelLines(n,(0,O.Lp)(a.leftVertex.pos,r,t),e,o,t,i),l&&this._checkEdgeForParallelLines(n,(0,O.Lp)(l.rightVertex.pos,r,t),e,o,t,i),s===c?this._checkEdgeForParallelLines(n,p,e,o,t,i):s===h&&this._checkEdgeForParallelLines(n,d,e,o,t,i)}g=g.rightVertex.rightEdge}while(g&&g!==y);return i}_checkEdgeForParallelLines(e,t,i,s,n,r){const o=e.left,a=e.right;if((0,he.fg)(ve,t,o,a),(0,F.k)(ve,t)<k.N.parallelLineThreshold)return;(0,he.fg)(ve,i,o,a,t);const{spatialReference:l,pointer:c}=n,d=(0,O.fA)(ve[0],ve[1],i[2]);if((0,j.pM)(s,(0,se.jq)(d,l,E.qt,this.view))<this.squaredProximityThreshold(c)){if(this.isVertical(d,t)||this.isVertical(o,a))return;if(this._parallelToPreviousCandidate(e,r))return;r.push(new me({referenceLine:e,lineStart:t,targetPoint:d,isDraped:"on-the-ground"===n.elevationInfo?.mode}))}}_parallelToPreviousCandidate(e,t){const i=e.left,s=e.right;for(const n of t)if((0,he.fg)(ve,s,n.constraint.start,n.constraint.end,i),(0,F.k)(ve,s)<k.N.parallelLineThreshold)return n.addReferenceLine(e),!0;return!1}}const ve=(0,ye.a)();class _e extends ce{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=i.vertices.length,n=[];if(s<2)return n;const{view:r}=this,o=(0,se.jq)(e,t.spatialReference,E.qt,r),a=i.vertices[s-1];if(this.edgeExceedsShortLineThreshold(a.leftEdge,t)){const i=(0,O.Lp)(a.pos,r,t),s=(0,O.Lp)(a.leftEdge.leftVertex.pos,r,t);this._checkForSnappingCandidate(n,s,i,e,o,t)}const l=i.vertices[0];if(this.edgeExceedsShortLineThreshold(l.rightEdge,t)){const i=(0,O.Lp)(l.pos,r,t),s=(0,O.Lp)(l.rightEdge.rightVertex.pos,r,t);this._checkForSnappingCandidate(n,s,i,e,o,t)}return n}snapExistingVertex(e,t){const i=[],s=t.vertexHandle;if(s.component.vertices.length<3)return i;const{view:n}=this,r=(0,se.jq)(e,t.spatialReference,E.qt,n),o=s.leftEdge,a=s.rightEdge;if(o?.leftVertex.leftEdge){const s=o.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(s,t)){const o=(0,O.Lp)(s.rightVertex.pos,n,t),a=(0,O.Lp)(s.leftVertex.pos,n,t);this._checkForSnappingCandidate(i,a,o,e,r,t)}}if(a?.rightVertex.rightEdge){const s=a.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(s,t)){const o=(0,O.Lp)(s.leftVertex.pos,n,t),a=(0,O.Lp)(s.rightVertex.pos,n,t);this._checkForSnappingCandidate(i,a,o,e,r,t)}}return i}_checkForSnappingCandidate(e,t,i,s,n,r){const{spatialReference:o,pointer:a}=r;(0,F.c)(be,i,t);const l=(0,N.s)(we,be[1],-be[0],0),c=(0,F.g)(l,(0,F.c)(be,s,i))/(0,F.v)(l),d=(0,O._7)((0,F.w)((0,D.g)(s),i,l,c));if((0,j.pM)(n,(0,se.jq)(d,o,E.qt,this.view))<this.squaredProximityThreshold(a)){if(this.isVertical(d,i)||this.isVertical(i,t))return;const s=(0,N.q)((0,D.c)(),i,l,Math.sign(c));e.push(new ie({targetPoint:d,constraint:new $.FX(i,(0,O._7)(s)),previousVertex:t,otherVertex:i,otherVertexType:W.CENTER,isDraped:"on-the-ground"===r.elevationInfo?.mode}))}}}const be=(0,ye.a)(),we=(0,D.c)();class Se extends X.C{constructor({targetPoint:e,point1:t,point2:i,isDraped:s}){super(e,new $.ej((0,O._7)((0,N.p)((0,D.c)(),t,i,.5)),.5*(0,F.d)(t,i)),s,Z.n.SELF),this._p1=t,this._p2=i}get hints(){return[new ee.c(j.H3.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new ee.c(j.H3.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new te.l(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class Me extends ce{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=[],n=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||n<2)return s;const{view:r}=this,o=i.vertices[0],a=i.vertices[n-1],l=(0,O.Lp)(o.pos,r,t),c=(0,O.Lp)(a.pos,r,t);return this._processCandidateProposal(l,c,e,t,s),s}snapExistingVertex(e,t){const i=[],s=t.vertexHandle,n=s.component;if(n.edges.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===s.index||s.index===n.vertices.length-1))return i;const{view:r}=this,o=(0,O.Lp)(s.leftEdge.leftVertex.pos,r,t),a=(0,O.Lp)(s.rightEdge.rightVertex.pos,r,t);return this._processCandidateProposal(o,a,e,t,i),i}_processCandidateProposal(e,t,i,s,n){if(!this.exceedsShortLineThreshold(e,t,s))return;const r=(0,F.l)(Le,e,t,.5),o=.5*(0,F.d)(e,t),a=(0,D.c)();(0,he.Dh)(a,i,r,o),a[2]=i[2];const l=(0,O._7)(a),{spatialReference:c,pointer:d}=s,u=(0,se.jq)(i,c,E.qt,this.view);if((0,j.pM)(u,(0,se.jq)(l,c,E.qt,this.view))<this.squaredProximityThreshold(d)){if(this.isVertical(e,l)||this.isVertical(l,t))return;n.push(new Se({targetPoint:l,point1:e,point2:t,isDraped:"on-the-ground"===s.elevationInfo?.mode}))}}}const Le=(0,ye.a)();let Ee=class extends R.A{constructor(e){super(e),this.updating=!1,this._snappers=new h.A,this._domain=Z.n.SELF}initialize(){this._snappers.push(new fe(this.view,this.options),new pe(this.view,this.options),new _e(this.view,this.options),new Me(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,i){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const s=[];for(const n of this._snappers.items)for(const t of n.snap(e,i))s.push(t);return(0,j.xX)(e,s),s}};function Ie(e,t){return[new Ee({view:e,options:t}),new ne({view:e,options:t,spatialReference:e.spatialReference})]}(0,s._)([(0,a.MZ)({readOnly:!0})],Ee.prototype,"updating",void 0),(0,s._)([(0,a.MZ)({constructOnly:!0})],Ee.prototype,"view",void 0),(0,s._)([(0,a.MZ)()],Ee.prototype,"options",null),Ee=(0,s._)([(0,c.$)("esri.views.interactive.snapping.SelfSnappingEngine")],Ee);let Te=class extends R.A{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,s._)([(0,a.MZ)({constructOnly:!0})],Te.prototype,"layer",void 0),(0,s._)([(0,a.MZ)()],Te.prototype,"enabled",void 0),(0,s._)([(0,a.MZ)()],Te.prototype,"updating",void 0),(0,s._)([(0,a.MZ)()],Te.prototype,"availability",void 0),Te=(0,s._)([(0,c.$)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],Te);const Ce=Te;let xe=class extends R.A{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new h.A,this.distance=k.N.distance,this.touchSensitivityMultiplier=k.N.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,s._)([(0,a.MZ)()],xe.prototype,"enabled",void 0),(0,s._)([(0,a.MZ)()],xe.prototype,"enabledToggled",void 0),(0,s._)([(0,a.MZ)()],xe.prototype,"selfEnabled",void 0),(0,s._)([(0,a.MZ)()],xe.prototype,"featureEnabled",void 0),(0,s._)([(0,a.MZ)({type:h.A.ofType(Ce)})],xe.prototype,"featureSources",void 0),(0,s._)([(0,a.MZ)()],xe.prototype,"distance",void 0),(0,s._)([(0,a.MZ)()],xe.prototype,"touchSensitivityMultiplier",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],xe.prototype,"effectiveEnabled",null),(0,s._)([(0,a.MZ)({readOnly:!0})],xe.prototype,"effectiveSelfEnabled",null),(0,s._)([(0,a.MZ)({readOnly:!0})],xe.prototype,"effectiveFeatureEnabled",null),xe=(0,s._)([(0,c.$)("esri.views.interactive.snapping.SnappingOptions")],xe);const Ae=xe;var Re=i(29394);function Oe(e,t,{z:i,m:s,spatialReference:n,elevationInfo:r}){if(null==i&&null==s){const t=(0,Re.T)(e[0],e[1],void 0,n);return null!=s&&(t.m=s,t.hasM=!0),t}if(null==t||"2d"===t.type){const t=(0,Re.T)(e[0],e[1],i,n);return null!=s&&(t.m=s,t.hasM=!0),t}const o=(0,E.xS)(t,e,n,E.qt,r)??0,a=(0,Re.T)(e[0],e[1],o,n);return null!=s&&(a.m=s,a.hasM=!0),a}var ke=i(13795);class Ze extends X.C{constructor(e,t,i,s){super(e,new $.i7(e),s,Z.n.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ke.v(this.targetPoint,this.isDraped,this.domain)]}}let Pe=class extends(y.A.EventedMixin(R.A)){constructor(e){super(e),this.options=new Ae,this.snappingEnginesFactory=Ie,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Fe.MAIN}initialize(){this.addHandles([(0,o.wB)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:s}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:s}}),(()=>{this.doneSnapping(),this.emit("changed")}),o.OH),(0,o.wB)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),o.OH),(0,o.wB)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(({viewReady:e,snappingEnginesFactory:t})=>this._recreateEngines(e,t)),o.pc)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:i,options:s}=this;this._engines=t(i,s)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}get _squaredSatisfiesConstraintThreshold(){return k.N.satisfiesConstraintScreenThreshold*k.N.satisfiesConstraintScreenThreshold}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const s=this._currentMainCandidate;if(null==s)return t;const n=this._selectUpdateInput(e);if(null==n)return t;const{spatialReference:r}=i,o=(0,v.project)(n,r);if(null==o)return t;const{view:a}=this,{elevationInfo:l,visualizer:c}=i,d=[],u=(0,O.vf)(o,a,l),h=s.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,h,i))return this._resetSnappingState(),t;s.targetPoint=h,d.push(...s.hints);for(const p of this._currentOtherActiveCandidates)p.targetPoint=h,d.push(...p.hints);return null!=c&&this.addHandles(c.draw(d,{spatialReference:r,elevationInfo:De(i),view:a,selfSnappingZ:i.selfSnappingZ}),Ne),Oe(h,a,{z:t.z,m:t.m,spatialReference:t.spatialReference,elevationInfo:l})}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case Fe.MAIN:return e;case Fe.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Fe.MAIN}_removeVisualization(){this.removeHandles(Ne)}async _snapSinglePoint({point:e,context:t,signal:i}){const{view:s}=this,{elevationInfo:n}=t,r=(0,O.vf)(e,s,n),o=await this._fetchCandidates(r,Z.n.ALL,t,i);return this._createSnapResult(r,Fe.MAIN,o,s,t,{z:e.z,m:e.m,spatialReference:e.spatialReference,elevationInfo:n},i)}async _snapMultiPoint({point:e,scenePoint:t,context:i,signal:s}){const{view:n}=this,{coordinateHelper:r,elevationInfo:o,spatialReference:a}=i;await(0,v.initializeProjection)(t.spatialReference,a);const l=(0,v.project)(t,a),c=(0,O.vf)(l,n,o),d=await this._fetchCandidates(c,Z.n.FEATURE,i,s);if(d.length>0){const e=await this._fetchCandidates(c,Z.n.SELF,i,s);return this._createSnapResult(c,Fe.SCENE,[...d,...e],n,i,{z:l.z,m:l.m,spatialReference:l.spatialReference,elevationInfo:o},s)}const u=(0,O.vf)(e,n,o),h=await this._fetchCandidates(u,Z.n.SELF,i,s);return this._createSnapResult(u,Fe.MAIN,h,n,i,{z:r.hasZ()&&e.hasZ?e.z??0:void 0,m:r.hasM()&&e.hasM?e.m??0:void 0,spatialReference:e.spatialReference,elevationInfo:o},s)}async _fetchCandidates(e,t,i,s){return(await Promise.all(this._engines.map((n=>n.fetchCandidates(e,t,i,s))))).flat()}_createSnapResult(e,t,i,s,n,r,o){return{get valid(){return!(0,m.G4)(o)},apply:()=>{const{spatialReference:o}=n,{snappedPoint:a,hints:l}=this._processCandidates(e,t,i,n);return this._removeVisualization(),null!=n.visualizer&&this.addHandles(n.visualizer.draw(l,{spatialReference:o,elevationInfo:E.qt,view:s,selfSnappingZ:n.selfSnappingZ}),Ne),Oe(a,s,r)}}}_processCandidates(e,t,i,s){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,j.xX)(e,i);const n=this._currentMainCandidate;if(null!=n){const r=this._findOldConstraintInNewCandidates(n,i);if(r>=0){if(!(i[r]instanceof Ze))return this._intersectWithOtherCandidates(r,i,e,t,s);if(this._arePointsWithinScreenThreshold(e,n.targetPoint,s))return this._updateSnappingCandidate(n,t,i,s)}}return this._intersectWithOtherCandidates(0,i,e,t,s)}_findOldConstraintInNewCandidates(e,t){return e instanceof Ze?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,s,n){const{coordinateHelper:r}=n,o=t[e],a=[];for(let l=0;l<t.length;++l){if(l===e)continue;const s=t[l],n=o.constraint.intersect(s.constraint);if(n)for(const e of n.closestPoints(o.targetPoint))a.push([new Ze(e,o,s,s.isDraped),this._squaredScreenDistance(i,e,r)])}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(n.pointer))?this._updateSnappingCandidate(a[0][0],s,t,n):this._updateSnappingCandidate(o,s,t,n)}_updateSnappingCandidate(e,t,i,s){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const n=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const o of i){if(e instanceof Ze){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const t=o.constraint.closestTo(n);this._squaredScreenDistance(t,n,s.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(o.targetPoint=n,this._currentOtherActiveCandidates.push(o),r.push(...o.hints))}return{snappedPoint:n,hints:r}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return(0,j.pM)(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return(0,se.jq)(e,t.spatialReference,E.qt,this.view)}_findOldCandidateIndex(e,t){let i=-1;for(let s=0;s<e.length;++s)if(t.constraint.equals(e[s].constraint)){i=s;break}return i}get test(){return{visualizationsActive:this.hasHandles(Ne),engines:this._engines}}};var Fe;(0,s._)([(0,a.MZ)({constructOnly:!0})],Pe.prototype,"view",void 0),(0,s._)([(0,a.MZ)()],Pe.prototype,"options",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Pe.prototype,"updating",null),(0,s._)([(0,a.MZ)()],Pe.prototype,"snappingEnginesFactory",void 0),(0,s._)([(0,a.MZ)()],Pe.prototype,"_engines",void 0),(0,s._)([(0,a.MZ)()],Pe.prototype,"_squaredMouseProximityTreshold",null),(0,s._)([(0,a.MZ)()],Pe.prototype,"_squaredTouchProximityThreshold",null),(0,s._)([(0,a.MZ)()],Pe.prototype,"_squaredSatisfiesConstraintThreshold",null),Pe=(0,s._)([(0,c.$)("esri.views.interactive.snapping.SnappingManager")],Pe),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(Fe||(Fe={}));const Ne="visualization-handle";function De({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?E.qt:t}var Ve=i(87438),Ge=i(30687),$e=i(73345);let Be=class extends y.A.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:(0,$e.Xb)(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",(()=>{this.canUndo()&&e()}))}set redo(e){this._set("redo",(()=>{this.canRedo()&&e()}))}};(0,s._)([(0,a.MZ)()],Be.prototype,"activeComponent",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"cancelled",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"history",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"tool",null),(0,s._)([(0,a.MZ)()],Be.prototype,"type",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"canUndo",null),(0,s._)([(0,a.MZ)()],Be.prototype,"canRedo",null),(0,s._)([(0,a.MZ)()],Be.prototype,"onEnd",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"undo",null),(0,s._)([(0,a.MZ)()],Be.prototype,"redo",null),(0,s._)([(0,a.MZ)()],Be.prototype,"toggleTool",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"addToSelection",void 0),(0,s._)([(0,a.MZ)()],Be.prototype,"removeFromSelection",void 0),Be=(0,s._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle")],Be);let ze=class extends Be{};(0,s._)([(0,a.MZ)()],ze.prototype,"activeComponent",void 0),ze=(0,s._)([(0,c.$)("esri.widgets.Sketch.support.CreateOperationHandle")],ze);let He=class extends Be{};(0,s._)([(0,a.MZ)()],He.prototype,"activeComponent",void 0),He=(0,s._)([(0,c.$)("esri.widgets.Sketch.support.UpdateOperationHandle")],He);var Ke=i(23369),je=i(68882),Ue=i(40241),qe=i(50151),We=i(88506);const Je={defaultZ:0},Ye={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let Qe=class extends y.A.EventedAccessor{constructor(e){super(e),this._numUpdating=0,this._internalGraphicsLayer=new w.A({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.labelOptions=new x.A,this.layer=null,this.pointSymbol=new Ke.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new je.A({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Ue.A({color:[130,130,130,1],width:2}),this.meshSymbol=new qe.A({symbolLayers:new h.A([new We.A])}),this._snappingManager=null,this.tooltipOptions=new A.A,this.updateGraphics=new h.A,this.updateOnGraphicClick=!0,this.vertexSymbol=new Ke.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalPopupEnabled=null,this.defaultCreateOptions=Je,this.defaultUpdateOptions=Ye,this.snappingOptions=new Ae}initialize(){this.addHandles([(0,o.on)((()=>this.view?.map?.layers),"change",(e=>{e.removed.includes(this.layer)&&this.cancel()})),(0,o.on)((()=>this.layer?.graphics),"change",(e=>{if(null!=this._operationHandle)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())})),(0,o.wB)((()=>this.layer?.elevationInfo??null),(e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)}),o.pc),(0,o.wB)((()=>this.view),(e=>{(0,r.pR)(this._snappingManager),e&&(this._snappingManager=new Pe({view:e,options:this.snappingOptions}),"2d"===e.type?Promise.all([i.e(2076),i.e(2487),i.e(513),i.e(9667),i.e(1549)]).then(i.bind(i,61549)):"3d"===e.type&&(Promise.all([i.e(2076),i.e(4133),i.e(2487),i.e(513),i.e(4016),i.e(3142),i.e(9667),i.e(6579),i.e(6527)]).then(i.bind(i,16527)),Promise.all([i.e(2076),i.e(4133),i.e(4016),i.e(3142),i.e(6579),i.e(6041),i.e(9997),i.e(2470),i.e(7129)]).then(i.bind(i,78857))))}),o.pc),(0,o.wB)((()=>this.view?.spatialReference),((e,t)=>{e&&t&&!e.equals(t)&&this.cancel()}))]),(0,j.BY)(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._snappingManager=(0,r.pR)(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){return"3d"===this.view?.type?"move":"transform"}get updating(){return this._numUpdating>0||null!=this._snappingManager&&this._snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return null==this.activeComponent||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Je,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Ye,...e,reshapeOptions:{...Ye.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...Ye.highlightOptions,...e?.highlightOptions}})}set snappingOptions(e){null!=this._snappingManager&&(this._snappingManager.options=e),this._set("snappingOptions",e)}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:i}=t;e&&(t.cursor=null),i?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),e&&this.addHandles((0,o.z7)((()=>e.ready),(t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)}),o.pc),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=(0,r.DC)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,r.DC)(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:i}=this,s=t.toArray();i.removeMany(s),this.cancel(),this._emitDeleteEvent({graphics:s,tool:e})}}duplicate(){if("active"===this.state&&this.updateGraphics.length){const e=this.updateGraphics.map((e=>e.clone())).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:i,layer:s}=this;if(!i||"disabled"===this.state)throw s||this._logMissingLayer(),(0,m.NK)();if(null!=i.activeTool&&(i.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,I.Y)(i,this._internalGraphicsLayer);const n=await this._setupCreateOperation(e,t);if(null==n||this.destroyed)return void i.map.remove(this._internalGraphicsLayer);n.on("complete",(()=>{if(n===this._operationHandle){const t=this.createGraphic,i=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),n.cancelled||null==t||s.add(t),this.emit("create",{graphic:t,state:i?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}})),this._operationHandle=n,i.ready&&i.focus()}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:s,state:n}=this;if(!s||"disabled"===n)throw i||this._logMissingLayer(),(0,m.NK)();null!=s.activeTool&&(s.activeTool=null);const r=Array.isArray(e)?e:[e];if(null==e||!r?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some((e=>e.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):null==e.geometry&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0))))return;const o=await this._setupUpdateOperation(r,t);this.destroyed||null==o||ot(o)||((0,I.Y)(s,this._internalGraphicsLayer),this._setUpdateOperationHandle(o,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:o.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){this._beginAsyncOperation(),e=Array.isArray(e)?e:[e];for(const i of e)null==i.geometry||"mesh"===i.geometry.type||(0,b.aI)(i.geometry.spatialReference,t.spatialReference)||((0,v.canProjectWithoutEngine)(i.geometry.spatialReference,t.spatialReference)||(0,v.isLoaded)()||await(0,v.load)(),i.geometry=(0,v.project)(i.geometry,t.spatialReference));this._endAsyncOperation()}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if("2d"===t.type){const i=[];t.map.allLayers.forEach((e=>{"vector-tile"!==e.type&&"imagery"!==e.type||i.push(e)}));const s=await t.hitTest(e,{exclude:i});return(0,Ve.zF)(s.results)}const i=[t.map.ground];t.map.allLayers.forEach((e=>{"integrated-mesh"===e.type&&i.push(e)}));const s=await t.hitTest(e,{exclude:i});if(s.results.length>0){const e=s.results[0];if(null!=e&&"graphic"===e.type&&e.graphic&&(!s.ground.mapPoint||t.map.ground.opacity<1||s.ground.distance-(e.distance??0)>-Math.min(3*s.ground.distance,"global"===t.viewingMode?(0,f.tO)(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",(async t=>{const i="active"===this.state&&"create"===this._operationHandle?.type;if("disabled"===this.state||i||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const s=await t.async((()=>this._getFirstHit((0,Ge.ZV)(t))));let n=null;if(null!=s){const i=s.graphic;this.updateGraphics.includes(i)||i.layer===this.layer?(t.stopPropagation(),n=i):"2d"!==e.type||this._isComponentGraphic(i)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();null==n||this.updateGraphics.includes(n)||await this.update([n],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}}),this._endAsyncOperation()}),T.o.WIDGET)]}async _setupCreateOperation(e,t){const i=this.view;if(!i)return this._logMissingView(),null;const s={hasZ:"3d"===i.type,...this.defaultCreateOptions,...t},n=await this._setupDrawGraphicTool(e,i,s);return null==n?null:(i.tools.add(n),i.activeTool=n,this._setupCreateOperationHandle(n))}async _setupDrawGraphicTool(e,t,i){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const s="rectangle"!==e,n="rectangle"!==e,r={view:t,mode:"rectangle"===e||"circle"===e?"hybrid":"click",...i,snapToScene:!1,geometryType:e,graphicSymbol:this._getGraphicSymbolFromTool(e),snappingManager:this._snappingManager,forceUniformSize:n,centered:s};return"2d"===t.type?this._makeDrawGraphicTool2D(r):this._makeDrawGraphicTool3D(r)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(Promise.all([i.e(2076),i.e(2487),i.e(513),i.e(9667),i.e(1549)]).then(i.bind(i,61549)));return ot(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:tt(e.geometryType)?this.activeFillSymbol:null,tooltipOptions:this.tooltipOptions})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(Promise.all([i.e(2076),i.e(4133),i.e(2487),i.e(513),i.e(4016),i.e(3142),i.e(9667),i.e(6579),i.e(6527)]).then(i.bind(i,16527)));if(ot(t)||this.destroyed)return null;const{elevationInfo:s}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:s,snapToScene:null==s||"absolute-height"===s.mode,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let i=null;const s=e.forceUniformSize,n=e.centered,r=[t.on("key-down",(t=>{if(t.key===C.NE.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===C.NE.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==C.NE.vertexAdd||t.repeat)t.key===C.NE.undo?(t.stopPropagation(),a.undo()):t.key===C.NE.redo?(t.stopPropagation(),a.redo()):t.key!==C.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===C.NE.center&&(t.repeat||(e.centered=!n,t.stopPropagation())):(e.forceUniformSize=!s,t.stopPropagation());else{const i=e.drawOperation.geometryType;"polyline"!==i&&"polygon"!==i&&"multipoint"!==i||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}}),T.o.WIDGET),t.on("key-up",(t=>{t.key===C.NE.pan?e.enabled=!0:t.key!==C.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===C.NE.center&&(e.centered=n,t.stopPropagation()):(e.forceUniformSize=s,t.stopPropagation())}),T.o.WIDGET),e.on("vertex-add",(t=>{switch(i=null==i?"start":"active",t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:i,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}})),e.on("cursor-update",(t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})})),e.on("vertex-remove",(t=>{switch(t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}})),e.on("complete",(e=>{this._set("createGraphic",e.graphic),i="complete",e.aborted?a&&a.cancel():a&&a.complete()})),(0,o.wB)((()=>this._getGraphicSymbolFromTool(e.geometryType)),(t=>{e.graphicSymbol=t}))],a=new ze({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{r.forEach((e=>e.remove())),r.length=0,t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return a}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:i,view:s}=this;if(!s)return this._logMissingView(),null;const n={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let r=n.tool;for(const o of e)i.remove(o),i.add(o);if("3d"===s.type){if(0===e.length)return null;switch(r){case"move":return this._setupMove3DOperation(e,n,s,r);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=(0,L.N)(e[0]);return t===S.e.SUPPORTED?this._setupReshape3DOperation(e[0],n,s):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,S.d)(t)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(e,n,s)}}switch(r){case"move":return this._setupMove2DOperation(e,n,s);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=(0,L.N)(e[0]);return t===S.e.SUPPORTED?this._setupTransformOrReshape2DOperation(e,r,n,s):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,S.d)(t)}).`),null)}case"transform":if(1===e.length){const t=e[0].geometry?.type;"point"!==t&&"multipoint"!==t||(r="reshape")}return this._setupTransformOrReshape2DOperation(e,r,n,s)}}async _setupMove3DOperation(e,t,s,n,r=!1){for(const i of e){const e=(0,M.N)(i);if(e!==S.e.SUPPORTED)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${(0,S.d)(e)}).`),null}const o=await this._requireModule(Promise.all([i.e(2076),i.e(4133),i.e(2487),i.e(513),i.e(4016),i.e(3142),i.e(9667),i.e(6579),i.e(6527)]).then(i.bind(i,16527)));if(ot(o))return o;const a=new o.module.GraphicMoveTool({view:s,enableZ:t.enableZ,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});s.tools.add(a),a.graphics.addMany(e),r||this.updateGraphics.addMany(e);const l=[],c=new He({activeComponent:a,tool:n,type:"update",onEnd:()=>{l.forEach((e=>e.remove())),l.length=0,s.tools?.remove(a),a.destroyed||a.destroy()},undo:()=>{it(c,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{st(c,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:e=>{this.updateGraphics.push(e),a.graphics.push(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);c.history.undo.forEach((e=>e.updates.splice(t,1))),c.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?a.graphics.remove(e):c.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==n)return;const e=this.updateGraphics.at(0);if((0,L.N)(e)!==S.e.SUPPORTED)return;c.onEnd(),c.destroy();const i=await this._setupReshape3DOperation(e,t,s,!0);ot(i)||this._setUpdateOperationHandle(i,t)}});return l.push(...this._getHandlesForComponent(c,t),s.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(c,e,t)),T.o.WIDGET),s.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(c,e)}),T.o.WIDGET)),c}_setupGraphicTransform3DOperation(e,t,i,s=!1){if(1===e.length&&function(e){if("graphics"!==e.layer?.type)return S.e.GRAPHICS_LAYER_MISSING;if(null==e.geometry)return S.e.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return S.e.SUPPORTED;default:return S.e.GEOMETRY_TYPE_UNSUPPORTED}const t=null!=e.symbol&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return t&&t.some((e=>"object"===e.type))?"on-the-ground"!==(0,E.ky)(e)&&(0,E.NN)(e)?S.e.ELEVATION_MODE_UNSUPPORTED:S.e.SUPPORTED:S.e.SYMBOL_TYPE_UNSUPPORTED}(e[0])===S.e.SUPPORTED){const n=e[0],r=n.geometry;if(null!=r&&("point"===r.type||"mesh"===r.type))return this._setupPointTransform3DOperation(n,t,i);if(null!=r&&("polygon"===r.type||"polyline"===r.type))return this._setupPolyTransform3DOperation(n,t,i,s)}return this._setupMove3DOperation(e,t,i,"transform",s)}async _setupPointTransform3DOperation(e,t,s){const n="transform",{enableRotation:r,enableScaling:o,enableZ:a}=t,l=await this._requireModule(Promise.all([i.e(2076),i.e(4133),i.e(2487),i.e(513),i.e(4016),i.e(3142),i.e(9667),i.e(6579),i.e(6527)]).then(i.bind(i,16527)));if(ot(l))return l;const c=new l.module.GraphicTransformTool({graphic:e,view:s,enableRotation:r,enableScaling:o,enableZ:a,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});s.tools.add(c),this.updateGraphics.add(e);const d=[],u=new He({activeComponent:c,tool:n,type:"update",onEnd:()=>{d.forEach((e=>e.remove())),d.length=0,s.tools?.remove(c),c.destroyed||c.destroy()},undo:()=>{it(u,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{st(u,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),u.onEnd(),u.destroy();const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,s,"transform",!0);ot(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),u.complete()},toggleTool:()=>{}});return d.push(...this._getHandlesForComponent(u,t),s.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(u,e,t)),T.o.WIDGET),s.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(u,e)}),T.o.WIDGET)),u}async _setupPolyTransform3DOperation(e,t,s,n=!1){const r="transform",{enableRotation:o,enableScaling:a,enableZ:l,preserveAspectRatio:c}=t,d=await this._requireModule(Promise.all([i.e(2076),i.e(4133),i.e(2487),i.e(513),i.e(4016),i.e(3142),i.e(9667),i.e(6579),i.e(6527)]).then(i.bind(i,16527)));if(ot(d))return d;const u=new d.module.ExtentTransformTool({graphic:e,view:s,enableRotation:o,enableScaling:a,enableZ:l,preserveAspectRatio:c,tooltipOptions:this.tooltipOptions});s.tools.add(u),n||this.updateGraphics.add(e);const h=[],p=new He({activeComponent:u,tool:r,type:"update",onEnd:()=>{h.forEach((e=>e.remove())),h.length=0,s.tools?.remove(u),u.destroyed||u.destroy()},canUndo:()=>u.canUndo,undo:()=>{u.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},canRedo:()=>u.canRedo,redo:()=>{u.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),p.onEnd(),p.destroy();const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,s,"transform",!0);ot(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),p.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const e=this.updateGraphics.at(0);if((0,L.N)(e)!==S.e.SUPPORTED)return;p.onEnd(),p.destroy();const i=await this._setupReshape3DOperation(e,t,s,!0);ot(i)||this._setUpdateOperationHandle(i,t)}});return h.push(...this._getHandlesForComponent(p,t),s.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(p,e,t)),T.o.WIDGET),s.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(p,e)),T.o.WIDGET),s.on("key-down",(e=>{e.key!==C.NE.constraint||e.repeat||(u.preserveAspectRatio=!u.preserveAspectRatio,e.stopPropagation())}),T.o.WIDGET),s.on("key-up",(e=>{e.key===C.NE.constraint&&(u.preserveAspectRatio=!u.preserveAspectRatio,e.stopPropagation())}),T.o.WIDGET)),p}async _setupMove2DOperation(e,t,i){const s="move";this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const n=await this._getGraphicMover(e,t,i);if(ot(n))return n;const r=new He({activeComponent:n,tool:s,type:"update",onEnd:()=>{this._displayDefaultCursor(),l.forEach((e=>e.remove())),a.forEach((e=>e.remove())),l=[],a=[],n.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();it(r,e),r.refreshComponent(),this._emitUndoEvent({graphics:e,tool:s})},redo:()=>{const e=this.updateGraphics.toArray();st(r,e),r.refreshComponent(),this._emitRedoEvent({graphics:e,tool:s})},addToSelection:async e=>{await this._updateSpatialReference(e),this.updateGraphics.push(e),n.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);r.history.undo.forEach((e=>e.updates.splice(t,1))),r.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?n.graphics=i:r.complete()}});let o=!1,a=[i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(r,e,t)),T.o.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key!==C.NE.constraint||e.repeat||(o=!0,n.enableMoveAllGraphics=!n.enableMoveAllGraphics)}),T.o.WIDGET),i.on("key-up",(e=>{e.key===C.NE.constraint&&o&&(o=!1,n.enableMoveAllGraphics=!n.enableMoveAllGraphics)}),T.o.WIDGET)],l=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,s,n=!1){const r="reshape",o=await this._requireModule(Promise.all([i.e(2076),i.e(4133),i.e(2487),i.e(513),i.e(4016),i.e(3142),i.e(9667),i.e(6579),i.e(6527)]).then(i.bind(i,16527)));if(ot(o))return o;const a=t.reshapeOptions,l=new o.module.GraphicReshapeTool({view:s,graphic:e,enableZVertex:t.enableZ&&"move"===a?.vertexOperation,enableZShape:t.enableZ&&"move"===a?.shapeOperation,enableMoveGraphic:"move"===a?.shapeOperation||"move-xy"===a?.shapeOperation,enableMidpoints:"split"===a?.edgeOperation,enableEdgeOffset:"offset"===a?.edgeOperation,snappingManager:this._snappingManager,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions});s.tools.add(l),n||this.updateGraphics.add(e);const c=[],d=new He({activeComponent:l,tool:r,type:"update",onEnd:()=>{c.forEach((e=>e.remove())),c.length=0,s.tools?.remove(l),l.destroyed||l.destroy()},canUndo:()=>l.canUndo,undo:()=>{l.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},canRedo:()=>l.canRedo,redo:()=>{l.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),d.onEnd(),d.destroy();const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,s,"transform",!0);ot(i)||this._setUpdateOperationHandle(i,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),d.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;d.onEnd(),d.destroy();const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,s,!0);ot(e)||this._setUpdateOperationHandle(e,t)}});return c.push(...this._getHandlesForComponent(d,t),s.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(d,e,t)),T.o.WIDGET),s.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(d,e)}),T.o.WIDGET)),d}async _setupTransformOrReshape2DOperation(e,t,i,s){this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const n="transform"===t?await this._getBox(e,i,s):await this._getReshape(e,i,s);if(ot(n))return n;const r=new He({activeComponent:n,type:"update",onEnd:()=>{a.forEach((e=>e.remove())),o.forEach((e=>e.remove())),a=[],o=[],r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{it(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{st(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async e=>{let t=r.activeComponent;if("reshape"===t?.type){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();const n=await this._setupMove2DOperation(t,i,s);if(ot(n))return;this._setUpdateOperationHandle(n,i)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async e=>{const t=this.updateGraphics.indexOf(e);r.history.undo.forEach((e=>e.updates.splice(t,1))),r.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();if(0===i.length)r.complete();else{const e=i[0].geometry;1!==i.length||null==e||"point"!==e.type&&"multipoint"!==e.type?r.activeComponent.graphics=i:r.toggleTool()}this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const e=this.updateGraphics.at(0),t=e.geometry;if(null!=t&&("reshape"===r.tool&&("point"===t.type||"multipoint"===t.type)||"transform"===r.tool&&"extent"===t.type))return;let n=null;"transform"===r.tool?n=await this._getReshape([e],i,s):"reshape"===r.tool&&(n=await this._getBox([e],i,s)),ot(n)||(r.activeComponent?.destroy(),r.activeComponent=n,r.activeComponent&&(a.forEach((e=>e.remove())),a=this._getHandlesForComponent(r,i)))}});let o=[s.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(r,e,i)),T.o.WIDGET),s.on("key-down",(e=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key===C.NE.constraint&&!e.repeat&&r){const e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),T.o.WIDGET),s.on("key-up",(e=>{if(e.key===C.NE.constraint&&r){const e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),T.o.WIDGET)],a=this._getHandlesForComponent(r,i);return r}async _getGraphicMover(e,t,s){const{enableMoveAllGraphics:n,highlightOptions:r}=t,o=await this._requireModule(Promise.all([i.e(2706),i.e(5262)]).then(i.bind(i,62706)));return ot(o)?o:new o.module.default({enableMoveAllGraphics:n,highlightsEnabled:!!r?.enabled,indicatorsEnabled:!1,graphics:e,view:s,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:i})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-start"},type:"update"})},onGraphicMove:({dx:e,dy:t,graphic:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move"},type:"update"}),onGraphicMoveStop:({dx:e,dy:t,graphic:i})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,s){const{enableRotation:n,enableScaling:r,highlightOptions:o,preserveAspectRatio:a}=t,l=await this._requireModule(Promise.all([i.e(2076),i.e(2487),i.e(2706),i.e(2399)]).then(i.bind(i,72399)));return ot(l)?l:new l.module.default({graphics:e,enableRotation:n,enableScaling:r,highlightsEnabled:!!o?.enabled,preserveAspectRatio:a,layer:this._internalGraphicsLayer,view:s,tooltipOptions:this.tooltipOptions,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,s){const n="split"===t.reshapeOptions?.edgeOperation,r="move"===t.reshapeOptions?.shapeOperation,o=!!t.highlightOptions?.enabled,a=await this._requireModule(Promise.all([i.e(2076),i.e(2487),i.e(513),i.e(2706),i.e(8431)]).then(i.bind(i,38431)));return ot(a)?a:new a.module.default({enableMidpoints:n,enableMovement:r,graphic:e[0],highlightsEnabled:o,layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions,view:s,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:({mover:e,type:t})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:"update"}),onMoveStart:({dx:e,dy:t,mover:i,type:s})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:s},type:"update"}),onMove:({dx:e,dy:t,mover:i,type:s})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:s},type:"update"}),onMoveStop:({dx:e,dy:t,mover:i,type:s})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:s},type:"update"}),onVertexAdd:({added:e,type:t,vertices:i})=>{const s=e.map((e=>(0,_.$K)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:s,vertices:i,type:t},type:"update"})},onVertexRemove:({removed:e,type:t,vertices:i})=>{const s=e.map((e=>(0,_.$K)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:s,vertices:i,type:t},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",(({graphic:t,viewEvent:i})=>{i.native?.shiftKey&&(i.stopPropagation(),e.removeFromSelection(t))})),i.on("graphic-move-start",(t=>e.addToHistory(rt(t.allGraphics))))];case"box":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(rt(t.graphics)))),i.on("rotate-start",(t=>e.addToHistory(rt(t.graphics)))),i.on("scale-start",(t=>e.addToHistory(rt(t.graphics))))];case"reshape":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(rt([t.mover])))),i.on("reshape-start",(t=>e.addToHistory(rt([t.graphic])))),i.on("vertex-add",(t=>e.addToHistory(rt([t.oldGraphic])))),i.on("vertex-remove",(t=>e.addToHistory(rt([t.oldGraphic]))))];case"move-3d":return[i.on("graphic-move-start",(t=>{e.addToHistory(rt(t.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:t.allGraphics.length>0?t.allGraphics[0]:null,type:"move-start"},type:"update"})})),i.on("graphic-move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move"},type:"update"})})),i.on("graphic-move-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move-stop"},type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))];case"transform-3d":return[i.on("record-undo",(({record:t})=>{e.addToHistory({updates:[t]})})),i.on("graphic-translate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})})),i.on("graphic-translate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})})),i.on("graphic-rotate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-start"},type:"update"})})),i.on("graphic-rotate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})})),i.on("graphic-scale-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})})),i.on("graphic-scale-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})})),i.on("graphic-translate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})})),i.on("graphic-rotate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate"},type:"update"})})),i.on("graphic-scale",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))];case"reshape-3d":return[i.on("reshape",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("vertex-add",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("vertex-remove",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))]}}_onTransformOrReshape2DGraphicClick(e,t,i){const{graphic:s,viewEvent:n}=i;return n.native?.shiftKey&&s.layer===this.layer?(n.stopPropagation(),e.removeFromSelection(s)):t.toggleToolOnClick?(n.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view?.map;this._disablePopup(t);e.on("complete",(()=>{if(e===this._operationHandle){const s=this.updateGraphics.toArray(),n=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:s,state:"complete",aborted:e.cancelled,tool:n,toolEventInfo:null,type:"update"})}}))}async _getCommonUpdateOperationClickHandlers(e,t,i){const s=(0,Ge.ZV)(t),n=await t.async((()=>this._getFirstHit(s)));null!=n&&(t.native.shiftKey&&this._toggleSelection([n.graphic],e,i)||this.updateGraphics.includes(n.graphic))?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const s=!!i.multipleSelectionEnabled;return e.some((e=>!(null==e||!s||e.layer!==this.layer||(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),0))))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===C.NE.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===C.NE.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===C.NE.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&C.NE.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent,i=this.updateGraphics.toArray();null!=t&&"reshape-3d"!==t.type&&("reshape"!==t.type||1===i.length&&"point"===i[0].geometry?.type)&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,r.pR)(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||null==t)&&(e.attributes?.esriSketchTool||"draw-2d"===t.type&&t.graphic===e||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view?.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,i){g.A.getLogger(this).error(new p.A(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){return{operationHandle:this._operationHandle,snappingManager:this._snappingManager,defaultUpdateOptions:Ye}}wait(){return(0,o.C_)((()=>!this.updating))}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){return"3d"!==this.view?.type||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&null==this._originalPopupEnabled&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&null!=this._originalPopupEnabled&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?((0,r.DC)(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await(0,m.qr)((0,o.C_)((()=>e?.ready)),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",et("view"))}_logMissingLayer(){this._logError(Xe,et("layer"))}};(0,s._)([(0,a.MZ)()],Qe.prototype,"updating",null),(0,s._)([(0,a.MZ)()],Qe.prototype,"_operationHandle",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Qe.prototype,"activeTool",null),(0,s._)([(0,a.MZ)()],Qe.prototype,"activeFillSymbol",void 0),(0,s._)([(0,a.MZ)()],Qe.prototype,"activeLineSymbol",void 0),(0,s._)([(0,a.MZ)()],Qe.prototype,"activeVertexSymbol",void 0),(0,s._)([(0,a.MZ)()],Qe.prototype,"allowDeleteKey",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Qe.prototype,"createGraphic",null),(0,s._)([(0,a.MZ)()],Qe.prototype,"defaultCreateOptions",null),(0,s._)([(0,a.MZ)()],Qe.prototype,"defaultUpdateOptions",null),(0,s._)([(0,a.MZ)({type:x.A,nonNullable:!0})],Qe.prototype,"labelOptions",void 0),(0,s._)([(0,a.MZ)()],Qe.prototype,"layer",void 0),(0,s._)([(0,a.MZ)({types:u.Es})],Qe.prototype,"pointSymbol",void 0),(0,s._)([(0,a.MZ)({types:u.Es})],Qe.prototype,"polygonSymbol",void 0),(0,s._)([(0,a.MZ)({types:u.Es})],Qe.prototype,"polylineSymbol",void 0),(0,s._)([(0,a.MZ)()],Qe.prototype,"meshSymbol",void 0),(0,s._)([(0,a.MZ)({type:Ae,nonNullable:!0})],Qe.prototype,"snappingOptions",null),(0,s._)([(0,a.MZ)()],Qe.prototype,"_snappingManager",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Qe.prototype,"state",null),(0,s._)([(0,a.MZ)({type:A.A,nonNullable:!0})],Qe.prototype,"tooltipOptions",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Qe.prototype,"updateGraphics",void 0),(0,s._)([(0,a.MZ)()],Qe.prototype,"updateOnGraphicClick",void 0),(0,s._)([(0,a.MZ)({types:u.Es})],Qe.prototype,"vertexSymbol",void 0),(0,s._)([(0,a.MZ)({value:null})],Qe.prototype,"view",null),Qe=(0,s._)([(0,c.$)("esri.widgets.Sketch.SketchViewModel")],Qe);const Xe="sketch:missing-property",et=e=>`Property '${e}' is missing on SketchViewModel.`;function tt(e){return"polygon"===e||"rectangle"===e||"circle"===e}function it(e,t){nt("undo",e.history.undo,e.history.redo,t)}function st(e,t){nt("redo",e.history.redo,e.history.undo,t)}function nt(e,t,i,s){const n=t.pop();if(!n)return;const r=n.updates,o=[];s.forEach(((t,i)=>{const s=r[i];null!=s&&("geometry"in s&&null!=s.geometry&&(o.push({geometry:t.geometry}),t.geometry=s.geometry),"symbol"in s&&null!=s.symbol&&(o.push({symbol:t.symbol}),t.symbol=s.symbol),"undo"in s&&(o.push(s),s[e](t)))})),i.push({updates:o})}function rt(e){return{updates:e.map((e=>({geometry:e.geometry})))}}function ot(e){return"requireError"in e&&"aborted"===e.requireError}const at=Qe;let lt=class extends R.A{constructor(e){super(e),this.header=!1,this.labelsToggle=!0,this.tooltipsToggle=!0}};(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],lt.prototype,"header",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],lt.prototype,"labelsToggle",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],lt.prototype,"tooltipsToggle",void 0),lt=(0,s._)([(0,c.$)("esri.widgets.support.SketchTooltipControls.VisibleElements")],lt);const ct=lt;let dt=class extends R.A{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.header=!1,this.layerList=!0,this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],dt.prototype,"enabledToggle",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],dt.prototype,"featureEnabledToggle",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],dt.prototype,"header",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],dt.prototype,"layerList",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],dt.prototype,"layerListToggleLayersButton",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],dt.prototype,"selfEnabledToggle",void 0),dt=(0,s._)([(0,c.$)("esri.widgets.support.SnappingControls.VisibleElements")],dt);const ut=dt;let ht=class extends R.A{constructor(e){super(e),this.point=!0,this.polyline=!0,this.polygon=!0,this.rectangle=!0,this.circle=!0,this.multipoint=!0,this.mesh=!0}};(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],ht.prototype,"point",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],ht.prototype,"polyline",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],ht.prototype,"polygon",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],ht.prototype,"rectangle",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],ht.prototype,"circle",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],ht.prototype,"multipoint",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],ht.prototype,"mesh",void 0),ht=(0,s._)([(0,c.$)("esri.widgets.Sketch.VisibleElements.CreateToolVisibilityMap")],ht);let pt=class extends R.A{constructor(e){super(e),this["rectangle-selection"]=!0,this["lasso-selection"]=!0,this["custom-selection"]=!0}};(0,s._)([(0,a.MZ)({nonNullable:!0})],pt.prototype,"rectangle-selection",void 0),(0,s._)([(0,a.MZ)({nonNullable:!0})],pt.prototype,"lasso-selection",void 0),(0,s._)([(0,a.MZ)({nonNullable:!0})],pt.prototype,"custom-selection",void 0),pt=(0,s._)([(0,c.$)("esri.widgets.Sketch.VisibleElements.SelectionToolVisibilityMap")],pt);let yt=class extends R.A{constructor(e){super(e),this.createTools=new ht,this.duplicateButton=!0,this.selectionTools=new pt,this.settingsMenu=!0,this.sketchTooltipControls=!0,this.sketchTooltipControlsElements=new ct,this.snappingControls=!0,this.snappingControlsElements=new ut,this.undoRedoMenu=!0}};(0,s._)([(0,a.MZ)({type:ht,nonNullable:!0})],yt.prototype,"createTools",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],yt.prototype,"duplicateButton",void 0),(0,s._)([(0,a.MZ)({type:pt,nonNullable:!0})],yt.prototype,"selectionTools",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],yt.prototype,"settingsMenu",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],yt.prototype,"sketchTooltipControls",void 0),(0,s._)([(0,a.MZ)({type:ct,nonNullable:!0})],yt.prototype,"sketchTooltipControlsElements",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],yt.prototype,"snappingControls",void 0),(0,s._)([(0,a.MZ)({type:ut,nonNullable:!0})],yt.prototype,"snappingControlsElements",void 0),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],yt.prototype,"undoRedoMenu",void 0),yt=(0,s._)([(0,c.$)("esri.widgets.Sketch.VisibleElements")],yt);const gt=yt;var mt=i(11693),ft=i(35251),vt=i(2295),_t=i(50220),bt=i(4130),wt=i(72638),St=i(43955),Mt=i(96704),Lt=i(38201),Et=i(42453),It=i(55876),Tt=i(49313);async function Ct(){return async function(){return Promise.all([i.e(2076),i.e(3366)]).then(i.bind(i,53366))}().then((({contains:e,intersects:t,overlaps:i,simplify:s})=>({contains:e,intersects:t,overlaps:i,simplify:s})))}async function xt(e){const{currentSelection:t,options:i,selector:s,signal:n,sources:r,view:o}=e;if(!r?.length)return{added:[],removed:[]};const{layers:a,layerViews:l,graphicsLayers:c}=function(e){const t=[],i=[],s=[];return e.forEach((e=>{(0,K.yZ)(e)?t.push(e):(0,K.cM)(e)&&e.layers?.length?t.push(...e.layers.toArray()):(0,K.Rv)(e)&&e.sublayers?.length?s.push(...e.sublayers.toArray()):(0,K.V0)(e)?s.push(e):(0,Lt.lO)(e)&&i.push(e)})),{layers:t,layerViews:i,graphicsLayers:s}}(r),d=(await(0,m.qr)(Promise.all([Rt(s,a,o,n),Ot(s,l,o,n),At(s,c,i,o)]),n)).flat();if(!t)return{added:d,removed:[]};const u=d.filter((e=>kt(t.toArray(),e))),h=t.filter((e=>kt(d,e))).toArray();return t.removeMany(h),t.addMany(u),{added:u,removed:h}}const At=async(e,t,i,s)=>async function(e){const{selector:t,candidates:i,options:s,view:n}=e;if(!i?.length||!t||!s)return[];const{overlaps:r,intersects:o,contains:a}=s,{spatialReference:l}=n,c=t,d=await Ct();return i.filter((e=>{const t=e.geometry,i=r&&d.overlaps(l,c,t),s=o&&d.intersects(l,c,t),n=a&&d.contains(l,c,t);return i||s||n}))}({candidates:t.flatMap((e=>e.graphics.toArray()))??[],selector:e,options:i,view:s}),Rt=async(e,t,i,s)=>{const n=await(0,m.QZ)(async function(e){const{layers:t,selector:i,signal:s,view:n}=e;return(0,m.qr)(Promise.allSettled(t.map((async e=>e.queryFeatures(function(e,t,i,s){const{outFields:n,geometry:r}=Zt(t,i,s);return e.outFields=n,e.geometry=r,e.returnGeometry=!0,e.outSpatialReference=s.spatialReference,e}(e.createQuery(),i,e,n),{signal:s}).then((({features:e})=>e))))),s)}({selector:e,signal:s,layers:t,view:i}));return n?n.filter((e=>"fulfilled"===e.status)).flatMap((e=>e.value)):[]},Ot=async(e,t,i,s)=>{const n=await(0,m.QZ)(async function(e){const{layerViews:t,selector:i,signal:s,view:n}=e;return(0,m.qr)(Promise.allSettled(t.map((async e=>{const t=e.createQuery(),{outFields:r,geometry:o}=Zt(i,e.layer,n);return t.outFields=r,t.geometry=o,t.returnGeometry=!0,t.outSpatialReference=n.spatialReference,e.queryFeatures(t,{signal:s}).then((({features:e})=>e))}))),s)}({selector:e,signal:s,layerViews:t,view:i}));return n?n.filter((e=>"fulfilled"===e.status)).flatMap((e=>e.value)):[]};function kt(e,t){const i=e.includes(t),s=t.getObjectId(),n=null!=s,r=e.some((e=>{const i=t.layer===e.layer,r=n&&e.getObjectId()===s,o=t.uid===e.uid;return i&&(r||o)}));return!i&&!r}function Zt(e,t,i){const s="displayField"in t?t.displayField:null,n=(0,Et.mB)({displayField:s,fields:t.fields}),r=[t.objectIdField];null!=n&&t.fieldsIndex.has(n)&&r.push(n);const o="renderer"in t?(0,It.o)({renderer:t.renderer}):0;return{geometry:"point"===e.type?(0,Tt.V)(e,o,i):e,outFields:r}}let Pt=class extends y.A.EventedAccessor{constructor({options:e,view:t}){super(),this._abortController=null,this._activeOptions=null,this._completed=!1,this._dashedFillSymbol=new je.A({color:[0,0,0,0],outline:{style:"dash",color:[12,207,255],width:2}}),this._dashedLineSymbol=new Ue.A({style:"dash",color:[12,207,255],width:2}),this._defaultOptions={createTool:"rectangle",selectionOptions:{overlaps:!0,intersects:!0,contains:!1}},this._processSelectionGeometry=async({canceled:e,completed:t,selector:i})=>{const{_activeOptions:s,sources:n,selection:r,view:o}=this;if(this._abortController&&this._abortController.abort(),(t||e)&&(this._completed=!0),e)return void this._onComplete([],!0);if(!i||!n?.length||!o)return void r.removeAll();const a=new AbortController;this._abortController=a;const{added:l,removed:c}=await xt({currentSelection:r,sources:n,options:s.selectionOptions,selector:i,signal:a.signal,view:o});this._abortController===a&&(this._abortController=null),a.signal.aborted||(t?this._onComplete(this.selection.toArray(),!1):(l.length||c.length)&&this.emit("selection-change",{added:l,removed:c,type:"selection-change"}))},this._processDebounced=(0,m.sg)(this._processSelectionGeometry,100),this._sketchViewModel=new at,this._sketchGraphicsLayer=new w.A({listMode:"hide",internal:!0}),this._transparentPointSymbol=new Ke.A({color:[0,0,0,0],outline:{style:"none",width:0}}),this.options=null,this.selection=new h.A,this.sources=null,this.options=e,this.view=t;const{_dashedFillSymbol:i,_dashedLineSymbol:s,_sketchViewModel:n,_sketchGraphicsLayer:r,_transparentPointSymbol:o}=this;n.set({layer:r,activePointSymbol:o,activeLineSymbol:s,activeVertexSymbol:o,activeFillSymbol:i,pointSymbol:o,polygonSymbol:i,polylineSymbol:s,vertexSymbol:o,view:t}),this.addHandles([n.on("create",(e=>this._onSketchEvent(e))),n.on(["undo","redo"],(e=>this._onSketchEvent(e))),n.watch("activeComponent.forceUniformSize",(()=>this._onSketchGeometryChange()))])}initialize(){this._load()}set cursor(e){const t=this._sketchViewModel?.activeComponent;"draw-2d"!==t?.type&&"draw-3d"!==t?.type||(t.cursor=e),this._set("cursor",e)}get state(){const{_completed:e,_sketchViewModel:{state:t}}=this;return e?"complete":"active"===t?"active":"disabled"}set view(e){this._sketchViewModel.view=e,this._set("view",e)}cancel(){return this._sketchViewModel.cancel()}async _load(){await(this.view?.whenReady());const{_defaultOptions:e,options:t}=this,i=t?.createOptions?.cursor||this.cursor||e.createOptions?.cursor,{createTool:s,createOptions:n}=this._activeOptions={...e,...t,createOptions:{...e.createOptions,cursor:i,...t?.createOptions},selectionOptions:{...e.selectionOptions,...t?.selectionOptions}};this._sketchViewModel.create(s,n)}_onSketchEvent(e){const t="create"===e.type?e.graphic:e.graphics[0],i=t?.geometry,s="create"===e.type&&"cancel"===e.state,n="create"===e.type&&"complete"===e.state;(0,m.QZ)(this._processDebounced({canceled:s,completed:n,selector:i}))}_onSketchGeometryChange(){const e=this._sketchViewModel.createGraphic,t=e?.geometry;t&&(0,m.QZ)(this._processDebounced({canceled:!1,completed:!1,selector:t}))}_onComplete(e,t){this.removeAllHandles(),this.notifyChange("state"),this.emit("complete",{aborted:t,selection:e,type:"complete"})}};(0,s._)([(0,a.MZ)()],Pt.prototype,"_abortController",void 0),(0,s._)([(0,a.MZ)()],Pt.prototype,"_completed",void 0),(0,s._)([(0,a.MZ)()],Pt.prototype,"cursor",null),(0,s._)([(0,a.MZ)()],Pt.prototype,"options",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Pt.prototype,"selection",void 0),(0,s._)([(0,a.MZ)()],Pt.prototype,"sources",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Pt.prototype,"state",null),(0,s._)([(0,a.MZ)()],Pt.prototype,"view",null),Pt=(0,s._)([(0,c.$)("esri.widgets.support.Selector2D.SelectionOperation2D")],Pt);const Ft=Pt;let Nt=class extends R.A{constructor(e){super(e),this._defaultSelectionOptions={intersects:!0,overlaps:!0,contains:!0},this.cursor=null,this.options=null,this.sources=null,this.view=null}draw(e){const{operationOptions:t}=e,{view:i}=this;return new Ft({cursor:this.cursor,sources:e.sources??this.sources??[],options:{...t,selectionOptions:{...this._defaultSelectionOptions,...this.options,...t?.selectionOptions}},view:i})}async selectionFrom(e){const{view:t}=this,i=e.sources??this.sources??[];if(!i.length||!t)return[];const s=new h.A;return await xt({selector:e.geometry,currentSelection:s,sources:i,options:{...this._defaultSelectionOptions,...this.options,...e.selectionOptions},view:t}),s.toArray()}};(0,s._)([(0,a.MZ)()],Nt.prototype,"cursor",void 0),(0,s._)([(0,a.MZ)()],Nt.prototype,"options",void 0),(0,s._)([(0,a.MZ)()],Nt.prototype,"sources",void 0),(0,s._)([(0,a.MZ)()],Nt.prototype,"view",void 0),Nt=(0,s._)([(0,c.$)("esri.widgets.support.Selector2D")],Nt);const Dt=Nt;let Vt=class extends y.A.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.selector=new Dt,this.sources=null}initialize(){this.addHandles([(0,o.wB)((()=>this._sources),(e=>{this.selector.sources=e,this.activeOperation&&(this.activeOperation.sources=e)}))])}destroy(){this._operationHandlesGroup=(0,r.xt)(this._operationHandlesGroup),this.selector.destroy()}get _sources(){const{sources:e,view:t}=this;return t&&e?.length?e.flatMap((e=>{if((0,Lt.lO)(e))return e;if((0,K.cM)(e)){const i=e.layers||[],s=i.map((e=>{const i=(0,I.i)(t,e)||void 0;return(0,Lt.lO)(i)?i:e}));return s.length?s.toArray():i.length?i.toArray():e}const i=(0,I.i)(t,e)||void 0;return(0,Lt.lO)(i)?i:e})):[]}set cursor(e){this.activeOperation&&(this.activeOperation.cursor=e),this.selector.cursor=e,this._set("cursor",e)}get layers(){return(0,_t.Lx)(g.A.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){(0,_t.Lx)(g.A.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){return this.activeOperation?"active":this.view?.ready&&this._sources.length?"ready":"disabled"}set view(e){this.selector.view=e,this._set("view",e)}async selectionFrom(e,t){const{_sources:i}=this;return this.view&&i.length?this.selector.selectionFrom({geometry:e,selectionOptions:t,sources:i}):[]}cancel(){"active"===this.state&&(this.activeOperation?.cancel(),this._set("activeOperation",null))}activate(e){const{_sources:t,state:i}=this;if("disabled"===i||!t?.length)return;"active"===i&&this.cancel();const s=this.selector.draw({sources:t,operationOptions:e});return this._operationHandlesGroup=(0,n.vE)([s.once("complete",(e=>this._onOperationComplete(e))),s.on("selection-change",(e=>this._onOperationSelectionChange(e)))]),this._set("activeOperation",s),s}_onOperationSelectionChange(e){this.emit("selection-change",e)}_onOperationComplete(e){this._operationHandlesGroup=(0,r.xt)(this._operationHandlesGroup),this._set("activeOperation",null),this.emit("complete",e)}};(0,s._)([(0,a.MZ)()],Vt.prototype,"_sources",null),(0,s._)([(0,a.MZ)({readOnly:!0})],Vt.prototype,"activeOperation",void 0),(0,s._)([(0,a.MZ)()],Vt.prototype,"cursor",null),(0,s._)([(0,a.MZ)()],Vt.prototype,"layers",null),(0,s._)([(0,a.MZ)({readOnly:!0})],Vt.prototype,"selector",void 0),(0,s._)([(0,a.MZ)()],Vt.prototype,"sources",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Vt.prototype,"state",null),(0,s._)([(0,a.MZ)()],Vt.prototype,"view",null),Vt=(0,s._)([(0,c.$)("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],Vt);const Gt=Vt,$t={lassoTool:!0,rectangleTool:!0},Bt={createTool:"polygon",createOptions:{mode:"freehand"}},zt={createTool:"rectangle"},Ht="esri-selection-toolbar",Kt={base:Ht,widgetIcon:vt.T.vertexGps,container:`${Ht}__container`,toolButton:`${Ht}__tool-button`};let jt=class extends d.A{constructor(e,t){super(e,t),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.messages=null,this.toolConfigs=[],this.viewModel=new Gt,this.visibleElements={...$t},this._viewModelHandlesGroup=(0,n.vE)([this.viewModel.on("selection-change",(e=>this.emit("selection-change",e))),this.viewModel.on("complete",(e=>{this._set("activeToolInfo",null),this.emit("complete",e)}))])}destroy(){this._viewModelHandlesGroup=(0,r.xt)(this._viewModelHandlesGroup)}loadDependencies(){return(0,mt.W)({action:()=>Promise.all([i.e(2076),i.e(4994)]).then(i.bind(i,34994)),icon:()=>Promise.all([i.e(2076),i.e(7509)]).then(i.bind(i,77509))})}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return(0,_t.Lx)(g.A.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(e){(0,_t.Lx)(g.A.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=e}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...$t,...e}}get visibleToolCount(){const{view:e,toolConfigs:t,visibleElements:i}=this;return(t?.length??0)+("2d"===e?.type?(i.lassoTool?1:0)+(i.rectangleTool?1:0):0)}activate(e){switch(this.cancel(),e){case"lasso":this._activateTool("lasso");break;case"rectangle":this._activateTool("rectangle");break;default:this._activateTool(e)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return(0,Mt.K)("div",{"aria-label":this.label,class:this.classes(Kt.base,ft.D.widget)},(0,Mt.K)("div",{class:Kt.container},this._renderDefaultTools(),this._renderCustomTools()))}_renderDefaultTools(){if("2d"===this.view?.type)return[this._renderRectangleTool(),this._renderLassoTool()]}_renderCustomTools(){if(this.toolConfigs?.length)return this.toolConfigs.map((e=>(0,Mt.K)("calcite-action",{active:this.activeToolInfo?.toolName===e.toolName,bind:this,class:Kt.toolButton,label:e.toolName,onclick:()=>this._onCustomToolClick(e.toolName),scale:"s",text:e.toolName,title:e.toolName},(0,Mt.K)("calcite-icon",{icon:e.icon||"selection",scale:"s"}))))}_renderLassoTool(){const{activeToolInfo:e,messages:t,visibleElements:i}=this;if(i.lassoTool)return(0,Mt.K)("calcite-action",{active:"lasso"===e?.toolName,bind:this,label:t.selectByLasso,onclick:this._onLassoToolClick,scale:"s",text:t.selectByLasso,title:t.selectByLasso},(0,Mt.K)("calcite-icon",{icon:"lasso-select",scale:"s"}))}_renderRectangleTool(){const{activeToolInfo:e,messages:t,visibleElements:i}=this;if(i.rectangleTool)return(0,Mt.K)("calcite-action",{active:"rectangle"===e?.toolName,bind:this,label:t.selectByRectangle,onclick:this._onRectangleToolClick,scale:"s",text:t.selectByRectangle,title:t.selectByRectangle},(0,Mt.K)("calcite-icon",{icon:"cursor-marquee",scale:"s"}))}_onCustomToolClick(e){this._toggleTool(e)}_onLassoToolClick(){this._toggleTool("lasso")}_onRectangleToolClick(){this._toggleTool("rectangle")}_activateTool(e){const t=this._getToolOptions(e);if(!t)return;const i=this.viewModel.activate(t);i&&this._set("activeToolInfo",{toolName:e,operation:i})}_toggleTool(e){if(this.activeToolInfo){const t=this.activeToolInfo.toolName;if(this.cancel(),t===e)return}this._activateTool(e)}_getToolOptions(e){if("lasso"===e)return Bt;if("rectangle"===e)return zt;const t=this.toolConfigs.find((t=>t.toolName===e));if(!t)return;const{createTool:i,createOptions:s,selectionOptions:n}=t;return{createTool:i,createOptions:s,selectionOptions:n}}};(0,s._)([(0,a.MZ)({readOnly:!0})],jt.prototype,"activeToolInfo",void 0),(0,s._)([(0,a.MZ)()],jt.prototype,"label",null),(0,s._)([(0,a.MZ)()],jt.prototype,"layers",null),(0,s._)([(0,a.MZ)(),(0,St.G)("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],jt.prototype,"messages",void 0),(0,s._)([(0,a.MZ)()],jt.prototype,"sources",null),(0,s._)([(0,a.MZ)()],jt.prototype,"toolConfigs",void 0),(0,s._)([(0,a.MZ)()],jt.prototype,"view",null),(0,s._)([(0,a.MZ)()],jt.prototype,"viewModel",void 0),(0,s._)([(0,a.MZ)()],jt.prototype,"visibleElements",void 0),(0,s._)([(0,bt.w)("visibleElements")],jt.prototype,"castVisibleElements",null),(0,s._)([(0,a.MZ)()],jt.prototype,"visibleToolCount",null),jt=(0,s._)([(0,c.$)("esri.widgets.support.SelectionToolbar")],jt);const Ut=jt,qt=()=>Promise.all([(0,mt.W)({icon:()=>Promise.all([i.e(2076),i.e(7509)]).then(i.bind(i,77509)),label:()=>i.e(1929).then(i.bind(i,91929)),switch:()=>Promise.all([i.e(2076),i.e(7912)]).then(i.bind(i,87912)),tooltip:()=>Promise.all([i.e(2076),i.e(9073),i.e(4245)]).then(i.bind(i,46626))})]),Wt="esri-labeled-switch",Jt={label:`${Wt}__label`,labelContent:`${Wt}__label-content`,icon:`${Wt}__icon`};function Yt({checked:e,disabled:t,hint:i,key:s,label:n,onChange:r}){return(0,Mt.K)("calcite-label",{class:Jt.label,disabled:t,key:s,layout:"inline-space-between",scale:"s"},(0,Mt.K)("div",{class:Jt.labelContent,key:"label-content"},i?(0,Mt.K)(Mt.w,null,(0,Mt.K)("div",null,n),(0,Mt.K)("calcite-icon",{class:Jt.icon,icon:"information",id:s,scale:"s"}),(0,Mt.K)("calcite-tooltip",{referenceElement:s},i)):n),(0,Mt.K)("calcite-switch",{checked:e,disabled:t,scale:"s",onCalciteSwitchChange:e=>r(e.target.checked)}))}let Qt=class extends R.A{constructor(e){super(e),this.labelOptions=new x.A,this.tooltipOptions=new A.A}};(0,s._)([(0,a.MZ)({type:x.A,nonNullable:!0})],Qt.prototype,"labelOptions",void 0),(0,s._)([(0,a.MZ)({type:A.A,nonNullable:!0})],Qt.prototype,"tooltipOptions",void 0),Qt=(0,s._)([(0,c.$)("esri.widgets.support.SketchTooltipControls.SketchTooltipControlsViewModel")],Qt);const Xt=Qt,ei="esri-sketch-tooltip-controls",ti={base:ei,widgetIcon:vt.T.gear,block:`${ei}__block`,blockContent:`${ei}__block-content`,hintIcon:`${ei}__hint-icon`};let ii=class extends d.A{constructor(e,t){super(e,t),this._defaultViewModel=null,this.icon=null,this.iconClass=ti.widgetIcon,this.visibleElements=new ct,this.viewType=void 0,this._onTooltipsEnabledChange=e=>{this.tooltipOptions.enabled=e},this._onLabelsEnabledChange=e=>{this.labelOptions.enabled=e};const{tooltipOptions:i,labelOptions:s,viewModel:n}=e;this.viewModel=n??(this._defaultViewModel=new Xt({tooltipOptions:i,labelOptions:s}))}loadDependencies(){return Promise.all([(0,mt.W)({block:()=>Promise.all([i.e(2076),i.e(9073),i.e(4437),i.e(4667)]).then(i.bind(i,14667))}),qt()])}render(){const{label:e,visibleElements:t}=this,i=this._renderContent();return(0,Mt.K)("div",{"aria-label":e,class:this.classes(ti.base,ft.D.widget)},i?(0,Mt.K)("calcite-block",{class:ti.block,heading:t.header?this.label:"",key:"content-block",open:!0},(0,Mt.K)("div",{class:ti.blockContent,key:"content"},i)):void 0)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}set viewModel(e){e!==this._get("viewModel")&&(null!=this._defaultViewModel&&this._defaultViewModel===e||(this._defaultViewModel=(0,r.pR)(this._defaultViewModel)),this._set("viewModel",e))}_renderContent(){const{visibleElements:e,viewType:t}=this,i=[e.tooltipsToggle?this._renderTooltipsToggle():null,e.labelsToggle&&"2d"!==t?this._renderLabelsToggle():null].filter(l.Ru);return 0===i.length?null:i}_renderTooltipsToggle(){const{messages:e,tooltipOptions:t}=this;return(0,Mt.K)(Yt,{checked:t.enabled,hint:e.tooltipsToggleHint,key:`${this.id}__tooltips`,label:e.tooltipsToggle,onChange:this._onTooltipsEnabledChange})}_renderLabelsToggle(){const{messages:e,labelOptions:t}=this;return(0,Mt.K)(Yt,{checked:t.enabled,hint:e.labelsToggleHint,key:`${this.id}__labels`,label:e.labelsToggle,onChange:this._onLabelsEnabledChange})}};(0,s._)([(0,a.MZ)()],ii.prototype,"icon",void 0),(0,s._)([(0,a.MZ)()],ii.prototype,"iconClass",void 0),(0,s._)([(0,a.MZ)()],ii.prototype,"label",null),(0,s._)([(0,a.MZ)()],ii.prototype,"labelOptions",null),(0,s._)([(0,a.MZ)()],ii.prototype,"tooltipOptions",null),(0,s._)([(0,a.MZ)()],ii.prototype,"viewModel",null),(0,s._)([(0,a.MZ)({type:ct,nonNullable:!0})],ii.prototype,"visibleElements",void 0),(0,s._)([(0,a.MZ)(),(0,St.G)("esri/widgets/support/SketchTooltipControls/t9n/SketchTooltipControls")],ii.prototype,"messages",void 0),(0,s._)([(0,a.MZ)({type:String})],ii.prototype,"viewType",void 0),ii=(0,s._)([(0,c.$)("esri.widgets.support.SketchTooltipControls")],ii);const si=ii;var ni=i(65061),ri=i(45937),oi=i(67118);const ai=e=>li(e)||ci(e),li=e=>{if(!("type"in e))return!1;switch(e.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":return!0;default:return!1}},ci=e=>{const t=(0,ri.oZ)(e);if(null!=t&&e.hasOwnProperty(t)&&null!=e[t])for(const i of e[t])if(ai(i))return!0;return!1};var di,ui=i(75777);let hi=di=class extends ui.A{constructor(e){super(e),this.children=new h.A,this.parent=null}get allChildrenEnabled(){return this.children.every((e=>e.enabled))??!1}get childLayerIds(){return this.children.map((e=>e.layer.id)).toArray()}get enabled(){return null!=this.featureSource&&this.featureSource.enabled}get featureSource(){const{layer:e,getFeatureSnappingSources:t}=this;return t().find((t=>t.layer===e))}get hasChildrenEnabled(){return this.children.some((e=>e.enabled))}_initializeChildLayers(e){if(!e)return;const t=e.filter(ai);super._initializeChildLayers(t)}_makeChildren(e){return e.map((e=>(0,ri.oU)(e)?new di({layer:e,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null)).filter(l.Ru).reverse()}};(0,s._)([(0,a.MZ)()],hi.prototype,"allChildrenEnabled",null),(0,s._)([(0,a.MZ)()],hi.prototype,"children",void 0),(0,s._)([(0,a.MZ)()],hi.prototype,"childLayerIds",null),(0,s._)([(0,a.MZ)()],hi.prototype,"enabled",null),(0,s._)([(0,a.MZ)()],hi.prototype,"featureSource",null),(0,s._)([(0,a.MZ)({constructOnly:!0})],hi.prototype,"getFeatureSnappingSources",void 0),(0,s._)([(0,a.MZ)()],hi.prototype,"hasChildrenEnabled",null),(0,s._)([(0,a.MZ)()],hi.prototype,"parent",void 0),hi=di=(0,s._)([(0,c.$)("esri.widgets.support.SnappingControls.SnappingListItem")],hi);let pi=class extends oi.A{constructor(){super(...arguments),this.featureSnappingSources=new h.A}get operationalItemsFlat(){return this.operationalItems.flatten((e=>e.children))}get selectableItems(){return this.operationalItemsFlat.filter((e=>!e.children?.length))}_compileList(){const e=this.view?.map?.layers;if(!e)return;const t=e.filter(ai);this._watchLayersListMode(t);const i=this._getViewableLayers(t);i?.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createListItem(e){return new hi({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}};(0,s._)([(0,a.MZ)()],pi.prototype,"featureSnappingSources",void 0),(0,s._)([(0,a.MZ)()],pi.prototype,"operationalItems",void 0),(0,s._)([(0,a.MZ)()],pi.prototype,"operationalItemsFlat",null),(0,s._)([(0,a.MZ)()],pi.prototype,"selectableItems",null),pi=(0,s._)([(0,c.$)("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],pi);let yi=class extends R.A{constructor(e){super(e),this.layerListViewModel=new pi,this.snappingOptions=new Ae,this.view=null}initialize(){this.addHandles([(0,o.wB)((()=>({viewModel:this.layerListViewModel,view:this.view})),(({viewModel:e,view:t})=>{e.view=t}),o.Vh),(0,o.wB)((()=>({viewModel:this.layerListViewModel,sources:this.snappingOptions?.featureSources})),(({viewModel:e,sources:t})=>{e.featureSnappingSources=t}),o.Vh)])}get allLayersEnabled(){return(this.layerListViewModel?.selectableItems??[]).every((e=>e.enabled))}get allLayersDisabled(){return(this.layerListViewModel?.selectableItems??[]).every((e=>!e.enabled))}get layersEnabledCount(){return this.layerListViewModel?.selectableItems?.filter((e=>e.enabled)).length??0}get state(){return this.snappingOptions?"ready":"disabled"}toggleSnappingForLayers(e,t){e?.forEach((e=>t?this.enableSnappingForLayer(e):this.disableSnappingForLayer(e)))}toggleSnappingForAllLayers(e){this.layerListViewModel.selectableItems.forEach((({layer:{id:t}})=>{e?this.enableSnappingForLayer(t):this.disableSnappingForLayer(t)}))}enableSnappingForLayer(e){(this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e)).enabled=!0}disableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e);t&&(t.enabled=!1)}updateEnabledFeatureSources(e){for(const t of this.snappingOptions.featureSources)(0,ri.oU)(t.layer)&&(t.enabled=e.includes(t.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find((t=>t.layer.id===e))}_makeSnappingSourceForLayer(e){const t=this.layerListViewModel.operationalItemsFlat.find((t=>t.layer.id===e))?.layer;if(!t)throw new p.A("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);const i=new Ce({layer:t});return this.snappingOptions.featureSources.add(i),i}};(0,s._)([(0,a.MZ)()],yi.prototype,"allLayersEnabled",null),(0,s._)([(0,a.MZ)()],yi.prototype,"allLayersDisabled",null),(0,s._)([(0,a.MZ)({constructOnly:!0})],yi.prototype,"layerListViewModel",void 0),(0,s._)([(0,a.MZ)()],yi.prototype,"layersEnabledCount",null),(0,s._)([(0,a.MZ)({type:Ae,nonNullable:!0})],yi.prototype,"snappingOptions",void 0),(0,s._)([(0,a.MZ)()],yi.prototype,"state",null),(0,s._)([(0,a.MZ)()],yi.prototype,"view",void 0),yi=(0,s._)([(0,c.$)("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],yi);const gi=yi,mi="esri-snapping-controls",fi={base:mi,widgetIcon:vt.T.vertexGps,container:`${mi}__container`,item:`${mi}__item`,toggleBlock:`${mi}__toggle-block`,layerListBlock:`${mi}__layer-list-block`,layerList:`${mi}__layer-list`,layerListFilter:`${mi}__layer-list__filter`,layerListButton:`${mi}__layer-list__button`,layerListItem:`${mi}__layer-list__item`,layerListGroup:`${mi}__layer-list__group`,nestedContainer:`${mi}__nested-container`},vi="check-square-f",_i="square",bi="minus-square";let wi=class extends d.A{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this.iconClass=fi.widgetIcon,this.icon=null,this.layerListOpen=!0,this.messages=null,this.visibleElements=new ut,this._enableSnappingSwitchChange=e=>{this.snappingOptions.enabled=e},this._featureEnabledSwitchChange=e=>{this.snappingOptions.featureEnabled=e},this._selfEnabledSwitchChange=e=>{this.snappingOptions.selfEnabled=e},this._onToggleLayersButtonClick=e=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),requestAnimationFrame((()=>e.target.setFocus()))};const{snappingOptions:i,view:s,viewModel:n}=e;this.viewModel=n??(this._defaultViewModel=new gi({snappingOptions:i,view:s}))}normalizeCtorArgs(e){const{snappingOptions:t,view:i,viewModel:s,...n}=e;return n}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=(0,r.pR)(this._defaultViewModel))}loadDependencies(){return Promise.all([(0,mt.W)({accordion:()=>Promise.all([i.e(2076),i.e(2259)]).then(i.bind(i,44640)),"accordion-item":()=>Promise.all([i.e(2076),i.e(3738)]).then(i.bind(i,83738)),action:()=>Promise.all([i.e(2076),i.e(4994)]).then(i.bind(i,34994)),block:()=>Promise.all([i.e(2076),i.e(9073),i.e(4437),i.e(4667)]).then(i.bind(i,14667)),button:()=>Promise.all([i.e(2076),i.e(3705)]).then(i.bind(i,3705)),icon:()=>Promise.all([i.e(2076),i.e(7509)]).then(i.bind(i,77509)),input:()=>Promise.all([i.e(2076),i.e(9640),i.e(5402)]).then(i.bind(i,65402)),list:()=>Promise.all([i.e(2076),i.e(9640),i.e(9444)]).then(i.bind(i,69444)),"list-item":()=>Promise.all([i.e(2076),i.e(9642)]).then(i.bind(i,89642))}),qt()])}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(null!=this._defaultViewModel&&this._defaultViewModel===e||(this._defaultViewModel=(0,r.pR)(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return(0,Mt.K)("div",{"aria-label":e,class:this.classes(fi.base,ft.D.widget)},(0,Mt.K)("div",{class:fi.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList()]}_renderToggles(){const{visibleElements:e}=this,t=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null].filter(l.Ru),i=[e.enabledToggle?this._renderEnabledToggle():null,t.length>0?(0,Mt.K)("div",{class:fi.nestedContainer},t):null].filter(l.Ru);return 0===i.length?null:(0,Mt.K)("calcite-block",{class:fi.toggleBlock,heading:e.header?this.label:"",key:"toggle-block",open:!0},i)}_renderEnabledToggle(){const{messages:e,viewModel:t}=this,{snappingOptions:i}=t;return(0,Mt.K)(Yt,{checked:i.enabled,disabled:i.enabledToggled,key:`${this.id}__enabled-toggle`,label:e.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){const{messages:e,viewModel:t}=this,{snappingOptions:i}=t,s=i.enabled&&i.selfEnabled,n=i.enabledToggled||!i.enabled;return(0,Mt.K)(Yt,{checked:s,disabled:n,key:`${this.id}__self-enabled-toggle`,label:e.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){const{messages:e,viewModel:t}=this,{snappingOptions:i}=t,s=i.enabled&&i.featureEnabled,n=i.enabledToggled||!i.enabled;return(0,Mt.K)(Yt,{checked:s,disabled:n,key:`${this.id}__feature-enabled-toggle`,label:e.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,{snappingOptions:{enabled:i,enabledToggled:s}}=t,n=t.layerListViewModel.operationalItems.length>9?(0,Mt.K)("calcite-input",{class:fi.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:({target:{value:e}})=>{this._layerListFilter=""===e?null:new RegExp(e,"i")}}):null,r=s||!i,o=this.layerListOpen&&!r;return(0,Mt.K)("calcite-block",{class:fi.layerListBlock,collapsible:!0,disabled:r,heading:e.snappingLayers,key:"list-block",open:o,onCalciteBlockToggle:e=>this.layerListOpen=e.target.open},n,this._renderToggleLayersButton(),(0,Mt.K)("calcite-list",{class:fi.layerList},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems,this._layerListFilter)))}_renderLayerListItemCollection(e,t){return e.map((e=>{if(!t||this._itemTitleMatchesFilter(e,t))return e.children.length>0?this._renderLayerListItemGroup(e):this._renderLayerListItem(e);const i=e.children.filter((e=>this._itemTitleMatchesFilter(e,t)));return i.length>0?this._renderLayerListItemGroup(e,i):null})).toArray().filter(l.Ru)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,i=e?t.disableAllLayers:t.enableAllLayers;return(0,Mt.K)("calcite-button",{appearance:"transparent",class:fi.layerListButton,label:i,name:"layer-toggle",onclick:this._onToggleLayersButtonClick,scale:"m"},i)}_renderLayerListItem(e){const{messages:{untitledLayer:t}}=this,i=e.title||t,s=e.enabled;return(0,Mt.K)("calcite-list-item",{class:fi.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:i,onCalciteListItemSelect:()=>{this._handleLayerListItemChange({checked:!s,value:e.layer.id})}},(0,Mt.K)("calcite-icon",{icon:s?vi:_i,scale:"s",slot:"content-start"}))}_renderLayerListItemGroup(e,t){const{allChildrenEnabled:i,children:s,hasChildrenEnabled:n,title:r}=e,o=this.messages,a=r||o.untitledLayer,l=r&&""!==r?r:(0,ni.L)(),c=!!t,d=t??s,u=i?vi:n?bi:_i,h=i?o.disableAllLayers:o.enableAllLayers;return(0,Mt.K)("calcite-list-item",{class:fi.layerListItem,key:l},(0,Mt.K)("calcite-accordion",{appearance:"transparent",class:fi.layerListGroup},(0,Mt.K)("calcite-accordion-item",{expanded:c,heading:a,key:e.uid},(0,Mt.K)("calcite-action",{onclick:()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,!i)},scale:"m",slot:"actions-start",text:h,textEnabled:!1},(0,Mt.K)("calcite-icon",{icon:u,scale:"s"})),(0,Mt.K)("calcite-list",null,this._renderLayerListItemCollection(d)))))}_itemTitleMatchesFilter(e,t){return null!=t&&t.test(e.title)}async _handleLayerListItemChange(e){e.checked?this.viewModel.enableSnappingForLayer(e.value):this.viewModel.disableSnappingForLayer(e.value)}};(0,s._)([(0,a.MZ)()],wi.prototype,"_defaultViewModel",void 0),(0,s._)([(0,a.MZ)()],wi.prototype,"_layerListFilter",void 0),(0,s._)([(0,a.MZ)()],wi.prototype,"iconClass",void 0),(0,s._)([(0,a.MZ)()],wi.prototype,"icon",void 0),(0,s._)([(0,a.MZ)()],wi.prototype,"label",null),(0,s._)([(0,a.MZ)({type:Boolean,nonNullable:!0})],wi.prototype,"layerListOpen",void 0),(0,s._)([(0,a.MZ)(),(0,St.G)("esri/widgets/support/SnappingControls/t9n/SnappingControls")],wi.prototype,"messages",void 0),(0,s._)([(0,a.MZ)()],wi.prototype,"snappingOptions",null),(0,s._)([(0,a.MZ)()],wi.prototype,"view",null),(0,s._)([(0,a.MZ)()],wi.prototype,"viewModel",null),(0,s._)([(0,a.MZ)({type:ut,nonNullable:!0})],wi.prototype,"visibleElements",void 0),wi=(0,s._)([(0,c.$)("esri.widgets.support.SnappingControls")],wi);const Si=wi;var Mi=i(24611),Li=i(48187);const Ei="esri-sketch",Ii={base:Ei,widgetIcon:vt.T.edit,verticalLayout:`${Ei}--vertical`,panel:`${Ei}__panel`,infoPanel:`${Ei}__info-panel`,section:`${Ei}__section`,toolSection:`${Ei}__tool-section`,infoSection:`${Ei}__info-section`,infoCountSection:`${Ei}__info-count-section`,menuContainer:`${Ei}__menu-container`,menuHeader:`${Ei}__menu-header`,menuTitle:`${Ei}__menu-title`,featureCountBadge:`${Ei}__feature-count-badge`,featureCountText:`${Ei}__feature-count-text`,featureCountNumber:`${Ei}__feature-count-number`,actionToggle:`${Ei}__action-toggle`,actionToggleOn:`${Ei}__action-toggle--on`,actionTitle:`${Ei}__item-action-title`,actionIcon:`${Ei}__item-action-icon`};let Ti=class extends d.A{constructor(e,t){super(e,t),this._activeCreateOptions=null,this._menuOpen=!1,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.creationMode="continuous",this.iconClass=Ii.widgetIcon,this.icon=null,this.layout="horizontal",this.messages=null,this.messagesCommon=null,this.visibleElements=new gt,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=e?.viewModel||new at}initialize(){const{layer:e,view:t}=this,i=new Ut({view:"2d"===t?.type?t:null,sources:e?[e]:null});this.addHandles([(0,o.wB)((()=>this.viewModel),(e=>{this._viewModelHandlesGroup=(0,r.xt)(this._viewModelHandlesGroup),e&&(this._viewModelHandlesGroup=(0,n.vE)([e.on("create",(e=>{this.scheduleRender(),this._onCreateOperation(e)})),e.on("update",(()=>this.scheduleRender())),e.on("delete",(e=>this.emit("delete",e))),e.on("undo",(()=>this.scheduleRender())),e.on("redo",(()=>this.scheduleRender())),(0,o.wB)((()=>e.layer),(e=>{this._selectionToolbar&&(this._selectionToolbar.sources=e?[e]:null)})),(0,o.wB)((()=>e.view),(e=>{this._selectionToolbar&&(this._selectionToolbar.view="2d"===e?.type?e:null)})),(0,o.wB)((()=>e.state),(()=>this.notifyChange("state")))]))}),o.pc),(0,o.z7)((()=>i.activeToolInfo),(()=>this.viewModel.cancel())),i.on("complete",(e=>this._onSelectionOperationComplete(e))),(0,o.wB)((()=>{const{selectionTools:e}=this.visibleElements;return{lassoTool:!!e?.["lasso-selection"],rectangleTool:!!e?.["rectangle-selection"]}}),(e=>{Object.assign(i.visibleElements,e)}),o.pc)]),this._selectionToolbar=i}loadDependencies(){return(0,mt.W)({action:()=>Promise.all([i.e(2076),i.e(4994)]).then(i.bind(i,34994)),icon:()=>Promise.all([i.e(2076),i.e(7509)]).then(i.bind(i,77509))})}destroy(){this._selectionToolbar?.destroy(),this._viewModelHandlesGroup=(0,r.xt)(this._viewModelHandlesGroup)}get activeTool(){const e=this._selectionToolbar?.activeToolInfo;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}return this.viewModel.activeTool}get createGraphic(){return this.viewModel.createGraphic}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(e){this.viewModel.defaultUpdateOptions=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get state(){return this._selectionToolbar?.activeToolInfo?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get updateGraphics(){return this.viewModel.updateGraphics}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){const t=this._get("viewModel");e!==t&&(t&&(0,r.pR)(t),this._set("viewModel",e))}get _effectiveAvailableCreateTools(){const{availableCreateTools:e,visibleElements:t}=this;return e?.filter((e=>!!t.createTools?.[e]))}create(e,t){this._activeCreateOptions=t||null,this.viewModel.create(e,t)}update(e,t){return this.viewModel.update(e,t)}complete(){this.viewModel.complete()}cancel(){this._selectionToolbar?.cancel(),this.viewModel.cancel()}undo(){this.viewModel.undo(),this.view?.focus()}redo(){this.viewModel.redo(),this.view?.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}render(){const{label:e,layout:t,viewModel:{state:i}}=this;return(0,Mt.K)("div",{"aria-label":e,class:this.classes(Ii.base,ft.D.widget,{[ft.D.disabled]:"disabled"===i,[Ii.verticalLayout]:"vertical"===t})},(0,Mt.K)("div",{class:Ii.panel,role:"toolbar"},this._renderTopPanelContents()),(0,Mt.K)("div",{class:this.classes(Ii.panel,Ii.infoPanel)},this._renderInfoPanelContents()))}_renderTopPanelContents(){const e=this.classes(Ii.section,Ii.toolSection),{_effectiveAvailableCreateTools:t,visibleElements:i,viewModel:s}=this;return[s.updateOnGraphicClick||this._selectionToolbar?.visibleToolCount?(0,Mt.K)("div",{class:e,key:"selection-button-container",role:"menu"},this._renderDefaultSelectionButton(),this._renderSelectionToolbar()):null,t?.length?(0,Mt.K)("div",{class:e,role:"menu"},this._renderDrawButtons()):null,i.undoRedoMenu?(0,Mt.K)("div",{class:e,key:"undo-redo-menu-button-container",role:"menu"},this._renderUndoRedoMenuButtons()):null,i.settingsMenu?(0,Mt.K)("div",{class:Ii.section,key:"settings-menu-button-container"},this._renderSettingsMenuButton()):null]}_renderInfoPanelContents(){return this._menuOpen?this._renderSettingsMenu():this.updateGraphics.length?[(0,Mt.K)("div",{class:this.classes(Ii.section,Ii.infoSection,Ii.infoCountSection),key:"feature-count-container"},this._renderFeatureCount()),(0,Mt.K)("div",{class:this.classes(Ii.section,Ii.infoSection),key:"delete-button-container"},this._renderDuplicateButton(),this._renderDeleteButton())]:void 0}_renderSettingsMenu(){const{labelOptions:e,messagesCommon:t,snappingOptions:i,tooltipOptions:s,view:n,visibleElements:r}=this;return[(0,Mt.K)("div",{class:Ii.menuContainer,"data-testid":"menu",key:"settings-menu-container",role:"menu"},(0,Mt.K)("header",{class:Ii.menuHeader,key:"settings-menu-header"},(0,Mt.K)("span",{class:Ii.menuTitle},t.settings)),r.sketchTooltipControls?(0,Mt.K)(si,{labelOptions:e,tooltipOptions:s,viewType:n?.type,visibleElements:r.sketchTooltipControlsElements}):void 0,r.snappingControls&&n&&i?(0,Mt.K)(Si,{snappingOptions:i,view:n,visibleElements:r.snappingControlsElements}):void 0)]}_renderFeatureCount(){const{layout:e,messages:t,updateGraphics:{length:i}}=this,s=(0,Li.V)(t.selectedCount,{count:i});return(0,Mt.K)("div",{"aria-label":s,class:Ii.featureCountBadge},(0,Mt.K)("span",{class:Ii.featureCountNumber},"vertical"===e?i:s))}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return;const e=this.messages,t=this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature;return(0,Mt.K)("calcite-action",{bind:this,label:t,onclick:this._onDuplicateSelect,scale:"s",text:t,title:t},(0,Mt.K)("calcite-icon",{icon:"copy",scale:"s"}))}_renderDeleteButton(){const e=this.messages,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return(0,Mt.K)("calcite-action",{bind:this,label:t,onclick:this.delete,scale:"s",text:t,title:t},(0,Mt.K)("calcite-icon",{icon:"trash",scale:"s"}))}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return;const e=this.messages.selectFeature;return(0,Mt.K)("calcite-action",{active:"ready"===this.state,bind:this,label:e,onclick:this._activateDefaultSelectTool,scale:"s",text:e,title:e},(0,Mt.K)("calcite-icon",{icon:"cursor",scale:"s"}))}_renderSelectionToolbar(){if("2d"===this.view?.type&&this._selectionToolbar)return this._selectionToolbar.render()}_renderDrawButtons(){return this._effectiveAvailableCreateTools?.map((e=>{switch(e){case"point":return this._renderPointButton();case"polyline":return this._renderPolylineButton();case"polygon":return this._renderPolygonButton();case"rectangle":return this._renderRectangleButton();case"circle":return this._renderCircleButton();default:return}}))}_renderPointButton(){const e="point",t=this.messages.drawPoint;return(0,Mt.K)("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},(0,Mt.K)("calcite-icon",{icon:"pin",scale:"s"}))}_renderPolygonButton(){const e="polygon",t=this.messages.drawPolygon;return(0,Mt.K)("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},(0,Mt.K)("calcite-icon",{icon:"polygon",scale:"s"}))}_renderPolylineButton(){const e="polyline",t=this.messages.drawPolyline;return(0,Mt.K)("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},(0,Mt.K)("calcite-icon",{icon:"line",scale:"s"}))}_renderCircleButton(){const e="circle",t=this.messages.drawCircle;return(0,Mt.K)("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},(0,Mt.K)("calcite-icon",{icon:"circle",scale:"s"}))}_renderRectangleButton(){const e="rectangle",t=this.messages.drawRectangle;return(0,Mt.K)("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},(0,Mt.K)("calcite-icon",{icon:"rectangle",scale:"s"}))}_renderUndoRedoMenuButtons(){return[this._renderUndoButton(),this._renderRedoButton()]}_renderUndoButton(){const e=this.messages.undo;return(0,Mt.K)("calcite-action",{bind:this,disabled:!this.viewModel.canUndo(),label:e,onclick:this.undo,scale:"s",text:e,title:e},(0,Mt.K)("calcite-icon",{icon:(0,wt.V8)(this.container)?"redo":"undo",scale:"s"}))}_renderRedoButton(){const e=this.messages.redo;return(0,Mt.K)("calcite-action",{bind:this,disabled:!this.viewModel.canRedo(),label:e,onclick:this.redo,scale:"s",text:e,title:e},(0,Mt.K)("calcite-icon",{icon:(0,wt.V8)(this.container)?"undo":"redo",scale:"s"}))}_renderSettingsMenuButton(){const e=this.messagesCommon.settings;return(0,Mt.K)("calcite-action",{active:this._menuOpen,bind:this,"data-testid":"settings-menu-action",label:e,onclick:this._toggleMenu,scale:"s",text:e,title:e},(0,Mt.K)("calcite-icon",{icon:"gear",scale:"s"}))}_activateCreateTool(e){this.activeTool!==e?(this._selectionToolbar?.cancel(),this.create(e)):this.cancel()}_onCreateOperation(e){if("complete"!==e.state)return;const{creationMode:t}=this,{type:i}=e;if("create"===i){const{tool:i,graphic:s}=e,n=this._activeCreateOptions;this._activeCreateOptions=null,"continuous"===t?this.create(i,n):"update"===t&&this.update([s])}}_toggleMenu(){this._menuOpen=!this._menuOpen,this.scheduleRender()}_onDuplicateSelect(){const e=this.duplicate(),t=this.viewModel.activeTool;"transform"!==t&&"reshape"!==t||this.update(e,{tool:t})}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:i}=e;if(!e.aborted&&i.length){const e=t.tool,s=i.length>1&&"reshape"===e?"transform":e;this.update(i,{...t,tool:s})}this.notifyChange("state")}_activateDefaultSelectTool(){this.cancel(),this.view?.focus()}};(0,s._)([(0,a.MZ)()],Ti.prototype,"activeTool",null),(0,s._)([(0,a.MZ)({cast:e=>{if(!e?.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle"]);return e.filter((e=>t.has(e)))}})],Ti.prototype,"availableCreateTools",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],Ti.prototype,"createGraphic",null),(0,s._)([(0,a.MZ)()],Ti.prototype,"creationMode",void 0),(0,s._)([(0,a.MZ)()],Ti.prototype,"defaultCreateOptions",null),(0,s._)([(0,a.MZ)()],Ti.prototype,"defaultUpdateOptions",null),(0,s._)([(0,a.MZ)()],Ti.prototype,"iconClass",void 0),(0,s._)([(0,a.MZ)()],Ti.prototype,"icon",void 0),(0,s._)([(0,a.MZ)()],Ti.prototype,"label",null),(0,s._)([(0,a.MZ)()],Ti.prototype,"labelOptions",null),(0,s._)([(0,a.MZ)()],Ti.prototype,"layer",null),(0,s._)([(0,a.MZ)({type:["horizontal","vertical"]})],Ti.prototype,"layout",void 0),(0,s._)([(0,a.MZ)(),(0,St.G)("esri/widgets/Sketch/t9n/Sketch")],Ti.prototype,"messages",void 0),(0,s._)([(0,a.MZ)(),(0,St.G)("esri/t9n/common")],Ti.prototype,"messagesCommon",void 0),(0,s._)([(0,a.MZ)()],Ti.prototype,"snappingOptions",null),(0,s._)([(0,a.MZ)()],Ti.prototype,"state",null),(0,s._)([(0,a.MZ)()],Ti.prototype,"tooltipOptions",null),(0,s._)([(0,a.MZ)({readOnly:!0})],Ti.prototype,"updateGraphics",null),(0,s._)([(0,a.MZ)()],Ti.prototype,"view",null),(0,s._)([(0,a.MZ)(),(0,Mi.U)(["create","update","undo","redo"])],Ti.prototype,"viewModel",null),(0,s._)([(0,a.MZ)({type:gt,nonNullable:!0})],Ti.prototype,"visibleElements",void 0),(0,s._)([(0,a.MZ)()],Ti.prototype,"_effectiveAvailableCreateTools",null),Ti=(0,s._)([(0,c.$)("esri.widgets.Sketch")],Ti);const Ci=Ti}}]);