"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2207],{76287:(e,t,s)=>{function r(){return[1,0,0,0,1,0,0,0,1]}function i(e,t,s,r,i,n,o,a,l){return[e,t,s,r,i,n,o,a,l]}function n(e,t){return new Float64Array(e,t,9)}s.d(t,{a:()=>r,c:()=>n,f:()=>i});Object.freeze(Object.defineProperty({__proto__:null,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},create:r,createView:n,fromValues:i},Symbol.toStringTag,{value:"Module"}))},20316:(e,t,s)=>{s.d(t,{O:()=>u,W:()=>d});var r=s(46615),i=s(76287),n=s(58680),o=s(21839);const a=(0,s(22279).c)(),l=(0,i.a)(),h=(0,i.a)(),c=(0,i.a)();function d(e,t,s){return(0,o.s)(a,t[0],t[1],1),(0,o.t)(a,a,(0,r.t)(l,s)),0===a[2]?(0,n.s)(e,a[0],a[1]):(0,n.s)(e,a[0]/a[2],a[1]/a[2])}function u(e,t,s){return p(h,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]),p(c,s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]),(0,r.m)(e,(0,r.a)(h,h),c),0!==e[8]&&(e[0]/=e[8],e[1]/=e[8],e[2]/=e[8],e[3]/=e[8],e[4]/=e[8],e[5]/=e[8],e[6]/=e[8],e[7]/=e[8],e[8]/=e[8]),e}function p(e,t,s,i,n,h,c,d,u){(0,r.s)(e,t,i,h,s,n,c,1,1,1),(0,o.s)(a,d,u,1),(0,r.a)(l,e);const[p,m,f]=(0,o.t)(a,a,(0,r.t)(l,l));return(0,r.s)(l,p,0,0,0,m,0,0,0,f),(0,r.m)(e,l,e)}},49241:(e,t,s)=>{s.d(t,{_:()=>d});var r=s(66866),i=s(52495),n=s(21564),o=(s(73446),s(85569),s(39831),s(63863)),a=s(62802),l=s(13484),h=s(80510),c=s(14537);let d=class extends i.A{constructor(e){super(e)}get bounds(){const e=this.coords;return null==e?.extent?null:(0,h.VY)(e.extent)}get coords(){const e=this.element.georeference?.coords;return(0,l.projectOrLoad)(e,this.spatialReference).geometry}get normalizedCoords(){return a.A.fromJSON((0,c.jZ)(this.coords))}get normalizedBounds(){const e=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=e?(0,h.VY)(e):null}};(0,r._)([(0,n.MZ)()],d.prototype,"spatialReference",void 0),(0,r._)([(0,n.MZ)()],d.prototype,"element",void 0),(0,r._)([(0,n.MZ)()],d.prototype,"bounds",null),(0,r._)([(0,n.MZ)()],d.prototype,"coords",null),(0,r._)([(0,n.MZ)()],d.prototype,"normalizedCoords",null),(0,r._)([(0,n.MZ)()],d.prototype,"normalizedBounds",null),d=(0,r._)([(0,o.$)("esri.layers.support.MediaElementView")],d)},12207:(e,t,s)=>{s.r(t),s.d(t,{default:()=>re});var r=s(66866),i=(s(17639),s(25707),s(17671),s(84685),s(20299),s(25498),s(79300),s(76589),s(47347),s(2692),s(48887),s(539)),n=(s(30822),s(48982)),o=(s(39831),s(82256)),a=s(40189),l=s(85251),h=s(21564),c=(s(73446),s(85569),s(63863)),d=s(80510),u=s(1364),p=s(43525),m=s(49241),f=s(98849),_=(s(61449),s(35193),s(21121),s(86394),s(20909),s(57079),s(37353)),y=(s(25024),s(17306),s(92504)),v=s(21946),g=(s(92996),s(79432)),w=(s(18806),s(20035),s(38403),s(97394),s(41746)),R=(s(16541),s(30860),s(43556),s(9272),s(59601),s(97066),s(37555),s(33605),s(41575),s(89423)),x=(s(84852),s(12966),s(6940)),M=s(80976),V=(s(83739),s(7370),s(13294),s(74373),s(55429),s(31541),s(48325)),E=(s(46729),s(64341),s(79286),s(75472),s(78360),s(79194),s(4071),s(23934),s(14125),s(2449),s(99152),s(51859),s(1931),s(38646),s(348),s(80734),s(75928),s(16528),s(21355),s(92976),s(10301),s(80952)),b=s(65231),T=(s(92595),s(12690),s(36134),s(75976),s(42482),s(75758)),C=s(62540),A=s(64874),S=s(6267),q=s(20316),O=s(76287),z=s(58680),G=s(78286),D=s(63643),P=s(68775),H=s(45758);const L=(0,O.a)(),U={none:D.fu.None,loop:D.fu.Loop,oscillate:D.fu.Oscillate};class W extends _.q{constructor(e){super(),this.elementView=e,this.isWrapAround=!1,this.perspectiveTransform=(0,G.a)(),this._playHandle=null,this._vertices=new Float32Array(20),this._handles=[],this._handles.push((0,l.wB)((()=>this.elementView.element.opacity),(e=>this.opacity=e),l.Vh),(0,l.wB)((()=>[this.elementView.coords]),(()=>{this.requestRender()}),l.Vh),(0,l.wB)((()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions]),(()=>{this._playHandle?.remove(),this.texture=(0,S.WD)(this.texture),this.requestRender()}),l.Vh),(0,l.z7)((()=>this.elementView.element.loaded),(()=>{const e=this.elementView.element;this.ready(),"video"===e.type&&null!=e.content&&this._handles.push((0,A.on)(e.content,"play",(()=>this.requestRender())))}),l.Vh)),e.element.load().catch((t=>{i.A.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new f.A("element-load-error","Element cannot be displayed",{element:e,error:t}))}))}destroy(){this._playHandle?.remove(),this._handles.forEach((e=>e.remove())),this.texture=(0,S.WD)(this.texture)}get dvsMat3(){return this.parent.dvsMat3}beforeRender(e){const{context:t}=e,s=this.elementView.element.content;if(null!=s){const e=s instanceof HTMLImageElement,r=s instanceof HTMLVideoElement,i=e?s.naturalWidth:r?s.videoWidth:s.width,n=e?s.naturalHeight:r?s.videoHeight:s.height;if(this._updatePerspectiveTransform(i,n),this.texture)r&&!s.paused&&(this.texture.setData(s),this.requestRender(),(t.type===v.EL.WEBGL2||(0,y.r6)(i)&&(0,y.r6)(n))&&this.texture.generateMipmap());else{const e=new H.R;if(e.wrapMode=w.pF.CLAMP_TO_EDGE,e.preMultiplyAlpha=!0,e.width=i,e.height=n,"getFrame"in s){const r=s=>{this.texture?this.texture.setData(s):this.texture=new x.g(t,e,s),this.requestRender()};"animationOptions"in this.elementView.element&&(this._playHandle=(0,P.ZH)(s,function(e){return e?{...e,playAnimation:e.playing,repeatType:e.repeatType?U[e.repeatType]:void 0}:{}}(this.elementView.element.animationOptions),null,r))}else this.texture=new x.g(t,e,s);(t.type===v.EL.WEBGL2||(0,y.r6)(i)&&(0,y.r6)(n))&&this.texture.generateMipmap(),r&&!s.paused&&this.requestRender()}}super.beforeRender(e)}_createTransforms(){return null}updateDrawCoords(e,t){const s=this.elementView.coords;if(null==s)return;const[r,i,n,o]=s.rings[0],a=this._vertices,{x:l,y:h}=e,c=0!==t;c?a.set([i[0]-l,i[1]-h,r[0]-l,r[1]-h,n[0]-l,n[1]-h,o[0]-l,o[1]-h,o[0]-l,o[1]-h,i[0]+t-l,i[1]-h,i[0]+t-l,i[1]-h,r[0]+t-l,r[1]-h,n[0]+t-l,n[1]-h,o[0]+t-l,o[1]-h]):a.set([i[0]-l,i[1]-h,r[0]-l,r[1]-h,n[0]-l,n[1]-h,o[0]-l,o[1]-h]),this.isWrapAround=c}getVAO(e,t,s){if(null==this.elementView.coords)return null;const r=this._vertices;if(this._vao)this._geometryVbo.setData(r);else{this._geometryVbo=R.g.createVertex(e,w._U.DYNAMIC_DRAW,r);const i=R.g.createVertex(e,w._U.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]));this._vao=new M.Z(e,s,t,{geometry:this._geometryVbo,tex:i})}return this._vao}_updatePerspectiveTransform(e,t){const s=this._vertices;(0,q.O)(L,[0,0,e,0,0,t,e,t],[s[0],s[1],s[4],s[5],s[2],s[3],s[6],s[7]]),(0,z.s)(this.perspectiveTransform,L[6]/L[8]*e,L[7]/L[8]*t)}}var Z=s(89882),j=s(46615),I=s(21360),B=s(87926),k=s(25887),Q=s(98949),F=s(49195);class N extends F.A{constructor(){super(...arguments),this._localOrigin=(0,Z.tc)(0,0),this._viewStateId=-1,this._dvsMat3=(0,I.c)()}get dvsMat3(){return this._dvsMat3}beforeRender(e){this._updateMatrices(e),this._updateOverlays(e,this.children);for(const t of this.children)t.beforeRender(e)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"overlay",brushes:[Q.d.overlay],target:()=>this.children,drawPhase:g.S5.MAP});return[...super.prepareRenderPasses(e),t]}_updateMatrices(e){const{state:t}=e,{id:s,size:r,pixelRatio:i,resolution:n,rotation:o,viewpoint:a,displayMat3:l}=t;if(this._viewStateId===s)return;const h=Math.PI/180*o,c=i*r[0],d=i*r[1],{x:u,y:p}=a.targetGeometry,m=(0,b.mT)(u,t.spatialReference);this._localOrigin.x=m,this._localOrigin.y=p;const f=n*c,_=n*d,y=(0,j.g)(this._dvsMat3);(0,j.m)(y,y,l),(0,j.h)(y,y,(0,V.f)(c/2,d/2)),(0,j.c)(y,y,(0,E.f)(c/f,-d/_,1)),(0,j.r)(y,y,-h),this._viewStateId=s}_updateOverlays(e,t){const{state:s}=e,{rotation:r,spatialReference:i,worldScreenWidth:n,size:o,viewpoint:a}=s,l=this._localOrigin;let h=0;const c=(0,B.Vp)(i);if(c&&i.isWrappable){const e=o[0],d=o[1],u=180/Math.PI*r,p=Math.abs(Math.cos(u)),m=Math.abs(Math.sin(u)),f=Math.round(e*p+d*m),[_,y]=c.valid,v=(0,k.FT)(i),{x:g,y:w}=a.targetGeometry,R=[g,w],x=[0,0];s.toScreen(x,R);const M=[0,0];let V;V=f>n?.5*n:.5*f;const E=Math.floor((g+.5*v)/v),b=_+E*v,T=y+E*v,C=[x[0]+V,0];s.toMap(M,C),M[0]>T&&(h=v),C[0]=x[0]-V,s.toMap(M,C),M[0]<b&&(h=-v);for(const s of t){const e=s.elementView.bounds;if(null==e)continue;const[t,,r]=e;t<_&&r>_?s.updateDrawCoords(l,v):r>y&&t<y?s.updateDrawCoords(l,-v):s.updateDrawCoords(l,h)}}else for(const d of t)d.updateDrawCoords(l,h)}}var Y=s(40231),$=s(9049),J=s(84698);let K=class extends((0,Y.e)($.A)){constructor(){super(...arguments),this._overlayContainer=null,this._fetchQueue=null,this._tileStrategy=null,this._elementReferences=new Map,this._debugGraphicsView=null,this.layer=null,this.elements=new n.A}attach(){this.addAttachHandles([(0,l.on)((()=>this.layer.effectiveSource),"refresh",(()=>{this._tileStrategy.refresh((e=>this._updateTile(e))),this.requestUpdate()})),(0,l.on)((()=>this.layer.effectiveSource),"change",(({element:e})=>this._elementUpdateHandler(e)))]),this._overlayContainer=new N,this.container.addChild(this._overlayContainer),this._fetchQueue=new T.A({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(e,t)=>this._queryElements(e,t)}),this._tileStrategy=new C.A({cachePolicy:"purge",resampling:!0,acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}detach(){this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear(),this._debugGraphicsView?.destroy()}supportsSpatialReference(e){return!0}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(e){this._tileStrategy.update(e),this._debugGraphicsView?.update(e)}async hitTest(e,t){const s=[],r=e.normalize(),i=[r.x,r.y];for(const{projectedElement:{normalizedCoords:n,element:o}}of this._elementReferences.values())null!=n&&(0,u.t1)(n.rings,i)&&s.push({type:"media",element:o,layer:this.layer,mapPoint:e,sourcePoint:o.toSource(e)});return s.reverse()}canResume(){return null!=this.layer.source&&super.canResume()}async doRefresh(){this._fetchQueue.reset(),this._tileStrategy.refresh((e=>this._updateTile(e)))}_acquireTile(e){const t=new se(e.clone());return this._updateTile(t),t}_updateTile(e){this._updatingHandles.addPromise(this._fetchQueue.push(e.key).then((t=>{const[s,r]=e.setElements(t);this._referenceElements(e,s),this._dereferenceElements(e,r),this.requestUpdate()}),(e=>{(0,a.zf)(e)||i.A.getLogger(this).error(e)})))}_releaseTile(e){this._fetchQueue.abort(e.key.id),e.elements&&this._dereferenceElements(e,e.elements),this.requestUpdate()}async _queryElements(e,t){const s=this.layer.effectiveSource;if(null==s)return[];this.view.featuresTilingScheme.getTileBounds(X,e,!0);const r=new J.A({xmin:X[0],ymin:X[1],xmax:X[2],ymax:X[3],spatialReference:this.view.spatialReference});return s.queryElements(r,t)}_referenceElements(e,t){if(null!=this.layer.source)for(const s of t)this._referenceElement(e,s)}_referenceElement(e,t){(0,o.tE)(this._elementReferences,t.uid,(()=>{const e=new m._({element:t,spatialReference:this.view.spatialReference}),s=new W(e);this._overlayContainer.addChild(s),this.elements.add(t);return{tiles:new Set,projectedElement:e,overlay:s,debugGraphic:null}})).tiles.add(e)}_dereferenceElements(e,t){for(const s of t)this._dereferenceElement(e,s)}_dereferenceElement(e,t){const s=this._elementReferences.get(t.uid);s.tiles.delete(e),s.tiles.size||(this._overlayContainer.removeChild(s.overlay),s.overlay.destroy(),s.projectedElement.destroy(),this._elementReferences.delete(t.uid),this.elements.remove(t),this._debugGraphicsView?.graphics.remove(s.debugGraphic))}_elementUpdateHandler(e){let t=this._elementReferences.get(e.uid);if(t){const s=t.projectedElement.normalizedCoords;if(null==s)return this._overlayContainer.removeChild(t.overlay),t.overlay.destroy(),t.projectedElement.destroy(),this._elementReferences.delete(e.uid),this.elements.remove(e),void this._debugGraphicsView?.graphics.remove(t.debugGraphic);const r=[],i=[];for(const e of this._tileStrategy.tiles){const n=te(this.view.featuresTilingScheme,e,s);t.tiles.has(e)?n||i.push(e):n&&r.push(e)}for(const t of r)this._referenceElement(t,e);for(const t of i)this._dereferenceElement(t,e);return t=this._elementReferences.get(e.uid),void(t?.debugGraphic&&(t.debugGraphic.geometry=t.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:t.debugGraphic,property:"geometry"})))}const s=new m._({element:e,spatialReference:this.view.spatialReference}).normalizedCoords;if(null!=s)for(const r of this._tileStrategy.tiles)te(this.view.featuresTilingScheme,r,s)&&this._referenceElement(r,e)}};(0,r._)([(0,h.MZ)()],K.prototype,"layer",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],K.prototype,"elements",void 0),K=(0,r._)([(0,c.$)("esri.views.2d.layers.MediaLayerView2D")],K);const X=(0,d.vt)(),ee={xmin:0,ymin:0,xmax:0,ymax:0};function te(e,t,s){return e.getTileBounds(X,t.key,!0),ee.xmin=X[0],ee.ymin=X[1],ee.xmax=X[2],ee.ymax=X[3],(0,p.fA)(ee,s)}class se{constructor(e){this.key=e,this.elements=null,this.isReady=!1,this.visible=!0}setElements(e){const t=[],s=new Set(this.elements);this.elements=e;for(const r of e)s.has(r)?s.delete(r):t.push(r);return this.isReady=!0,[t,Array.from(s)]}destroy(){}}const re=K}}]);