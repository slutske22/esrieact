"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3476],{6371:(e,t,n)=>{function i(e){let t,n,i=[],s=!1;return function(...o){return s&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(o,i)||(n=e.apply(this,o),t=this,i=o,s=!0),n}}n.d(t,{B:()=>i})},22970:(e,t,n)=>{n.d(t,{C:()=>a});var i=n(81066),s=n(90814),o=n(75796);class a extends s.w{constructor(e){super({...e,constraint:new i.i7(e.targetPoint)})}get hints(){return[new o._(this.targetPoint,this.isDraped,this.domain)]}}},33476:(e,t,n)=>{n.r(t),n.d(t,{FeatureCollectionSnappingSource:()=>f});var i=n(66866),s=n(52495),o=n(6371),a=n(40189),r=n(85251),c=n(21564),l=(n(73446),n(85569),n(39831),n(63863)),u=n(27451),p=n(61851),d=n(78200),h=n(75662),y=n(60397),g=n(2344);let f=class extends s.A{get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,n=null!=e&&"3d"===e.type;if(!n||"subtype-group"===t.type)return(0,h.n)();return(0,h.n)(n,{elevationInfo:t.elevationInfo,alignPointsInFeatures:async(n,i)=>(await(0,a.qr)(e.whenLayerView(t),i)).elevationAlignPointsInFeatures(n,i)})}get _snappingElevationFilter(){const{view:e}=this,t=null!=e&&"3d"===e.type&&"subtype-group"!==this.layerSource.layer.type;return(0,y.z)(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return null!=e&&"3d"===e.type&&"subtype-group"!==t.type?(0,g.H)(this._symbologySnappingSupported,(async(n,i)=>{const s=await e.whenLayerView(t);return(0,a.Te)(i),s.queryForSymbologySnapping({candidates:n,spatialReference:e.spatialReference},i)})):(0,g.H)()}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;null!=e&&"3d"===e.type&&"subtype-group"!==t.type&&(e.whenLayerView(t).then((e=>this._layerView3D=e)),this.addHandles([e.elevationProvider.on("elevation-change",(({context:e})=>{const{elevationInfo:n}=t;(0,u.Up)(e,n)&&this._snappingElevationAligner.notifyElevationSourceChange()})),(0,r.wB)((()=>t.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),r.Vh),(0,r.wB)((()=>null!=this._layerView3D?this._layerView3D.processor?.renderer:null),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),r.Vh),(0,r.on)((()=>this._layerView3D?.layer),["edits","apply-edits","graphic-update"],(()=>this._symbologySnappingFetcher.notifySymbologyChange()))]))}constructor(e){super(e),this.view=null,this._layerView3D=null,this._memoizedMakeGetGroundElevation=(0,o.B)(d.p)}refresh(){}async fetchCandidates(e,t){const{layer:n}=this.layerSource,i=n.source;if(!i?.querySnapping)return[];const s=(0,p.HN)(n),o=(0,p.nf)(e,this.view?.type??"2d",s),r=await i.querySnapping(o,{signal:t});(0,a.Te)(t);const c=e.coordinateHelper.spatialReference,l=await this._snappingElevationAligner.alignCandidates(r.candidates,c,t);(0,a.Te)(t);const u=await this._symbologySnappingFetcher.fetch(l,t);(0,a.Te)(t);const h=0===u.length?l:[...l,...u],y=this._snappingElevationFilter.filter(o,h),g=this._memoizedMakeGetGroundElevation(this.view,c);return y.map((e=>(0,d.$)(e,g)))}};(0,i._)([(0,c.MZ)({constructOnly:!0})],f.prototype,"layerSource",void 0),(0,i._)([(0,c.MZ)({constructOnly:!0})],f.prototype,"view",void 0),(0,i._)([(0,c.MZ)()],f.prototype,"_snappingElevationAligner",null),(0,i._)([(0,c.MZ)()],f.prototype,"_snappingElevationFilter",null),(0,i._)([(0,c.MZ)()],f.prototype,"_symbologySnappingFetcher",null),(0,i._)([(0,c.MZ)()],f.prototype,"_layerView3D",void 0),(0,i._)([(0,c.MZ)()],f.prototype,"_symbologySnappingSupported",null),f=(0,i._)([(0,l.$)("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],f)},78200:(e,t,n)=>{n.d(t,{$:()=>c,p:()=>l});var i=n(97847),s=n(46113),o=n(15991),a=n(22970);function r({x:e,y:t,z:n}){return(0,i.fA)(e,t,n??0)}function c(e,t){switch(e.type){case"edge":return e.draped?new s.X({edgeStart:r(e.start),edgeEnd:r(e.end),targetPoint:r(e.target),objectId:e.objectId,getGroundElevation:t}):new o.z({edgeStart:r(e.start),edgeEnd:r(e.end),targetPoint:r(e.target),objectId:e.objectId,isDraped:!1});case"vertex":return new a.C({targetPoint:r(e.target),objectId:e.objectId,isDraped:!1})}}function l(e,t){return null!=e&&"3d"===e.type?(n,i)=>e.elevationProvider.getElevation(n,i,0,t,"ground"):()=>null}},75662:(e,t,n)=>{n.d(t,{n:()=>c});n(39831);var i=n(89926),s=n(82256),o=n(40189),a=n(92976),r=n(97046);function c(e=!1,t){if(e){const{elevationInfo:e,alignPointsInFeatures:n}=t;return new u(e,n)}return new l}class l{async alignCandidates(e,t,n){return e}notifyElevationSourceChange(){}}class u{constructor(e,t){this._elevationInfo=e,this._alignPointsInFeatures=t,this._alignmentsCache=new i.q(1024),this._cacheVersion=0}async alignCandidates(e,t,n){const i=this._elevationInfo;return null==i||"absolute-height"!==i.mode||i.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,n):(this._alignAbsoluteElevationCandidates(e,t,i),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}_alignAbsoluteElevationCandidates(e,t,n){const{offset:i,unit:s}=n;if(null==i)return;const o=(0,a.G9)(t),c=i*((0,r.Ao)(s??"meters")/o);for(const a of e)switch(a.type){case"edge":a.start.z+=c,a.end.z+=c;continue;case"vertex":a.target.z+=c;continue}}async _alignComputedElevationCandidates(e,t,n){const i=new Map;for(const o of e)(0,s.tE)(i,o.objectId,h).push(o);const[a,r,c]=this._prepareQuery(i,t),l=await this._alignPointsInFeatures(a,n);if((0,o.Te)(n),c!==this._cacheVersion)return this._alignComputedElevationCandidates(e,t,n);this._applyCacheAndResponse(a,l,r);const{drapedObjectIds:u,failedObjectIds:p}=l,d=[];for(const s of e){const{objectId:e}=s;u.has(e)&&"edge"===s.type&&(s.draped=!0),p.has(e)||d.push(s)}return d}_prepareQuery(e,t){const n=[],i=[];for(const[s,o]of e){const e=[];for(const t of o)this._addToQueriesOrCachedResult(s,t.target,e,i),"edge"===t.type&&(this._addToQueriesOrCachedResult(s,t.start,e,i),this._addToQueriesOrCachedResult(s,t.end,e,i));0!==e.length&&n.push({objectId:s,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:n},i,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,n,i){const s=d(e,t),o=this._alignmentsCache.get(s);null==o?n.push(t):i.push(new p(t,o))}_applyCacheAndResponse(e,{elevations:t,drapedObjectIds:n,failedObjectIds:i},s){for(const r of s)r.apply();let o=0;const a=this._alignmentsCache;for(const{objectId:r,points:c}of e.pointsInFeatures){if(i.has(r)){o+=c.length;continue}const e=!n.has(r);for(const n of c){const i=d(r,n),s=t[o++];n.z=s,e&&a.put(i,s,1)}}}}class p{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function d(e,{x:t,y:n,z:i,spatialReference:s}){return`${e}-${t}-${n}-${i??0}}-wkid:${s?.wkid}`}function h(){return[]}},60397:(e,t,n)=>{n.d(t,{z:()=>a});n(39831);class i{filter(e,t){return t}notifyElevationSourceChange(){}}class s{filter(e,t){const{point:n,distance:i}=e,{z:s}=n;if(null==s)return t;if(0===t.length)return t;const a=function(e){return"number"==typeof e?{x:e,y:e,z:e}:e}(i),r=this._updateCandidatesTo3D(t,n,a).filter(o);return r.sort(l),r}_updateCandidatesTo3D(e,t,n){for(const i of e)switch(i.type){case"edge":r(i,t,n);continue;case"vertex":c(i,t,n);continue}return e}}function o(e){return e.distance<=1}function a(e=!1){return e?new s:new i}function r(e,t,{x:n,y:i,z:s}){const{start:o,end:a,target:r}=e;e.draped||function(e,t,n,i){const s=i.x-n.x,o=i.y-n.y,a=i.z-n.z,r=s*s+o*o+a*a,c=(t.x-n.x)*s+(t.y-n.y)*o+a*(t.z-n.z),l=Math.min(1,Math.max(0,c/r)),u=n.x+s*l,p=n.y+o*l,d=n.z+a*l;e.x=u,e.y=p,e.z=d}(r,t,o,a);const c=(t.x-r.x)/n,l=(t.y-r.y)/i,u=(t.z-r.z)/s;e.distance=Math.sqrt(c*c+l*l+u*u)}function c(e,t,{x:n,y:i,z:s}){const{target:o}=e,a=(t.x-o.x)/n,r=(t.y-o.y)/i,c=(t.z-o.z)/s,l=Math.sqrt(a*a+r*r+c*c);e.distance=l}function l(e,t){return e.distance-t.distance}},2344:(e,t,n)=>{n.d(t,{H:()=>r});n(39831);var i=n(19251),s=n(89926),o=n(40189),a=n(96274);function r(e=!1,t){return e?new l(t):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}class l{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new s.q(1024),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];const n=[],s=[],a=this._candidatesCache;for(const o of e){const e=u(o),t=a.get(e);if(t)for(const n of t)s.push((0,i.o8)(n));else n.push(o),a.put(e,[],1)}if(0===n.length)return s;const r=this._cacheVersion,{candidates:c,sourceCandidateIndices:l}=await this._getSymbologyCandidates(n,t);if((0,o.Te)(t),r!==this._cacheVersion)return this.fetch(e,t);const p=[],{length:d}=c;for(let o=0;o<d;++o){const e=c[o],t=u(n[l[o]]),s=a.get(t);s.push(e),a.put(t,s,s.length),p.push((0,i.o8)(e))}return s.concat(p)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function u(e){switch(e.type){case"vertex":{const{objectId:t,target:n}=e,i=`${t}-vertex-${n.x}-${n.y}-${n.z??0}`;return(0,a.Wm)(i).toString()}case"edge":{const{objectId:t,start:n,end:i}=e,s=`${t}-edge-${n.x}-${n.y}-${n.z??0}-to-${i.x}-${i.y}-${i.z??0}`;return(0,a.Wm)(s).toString()}default:return""}}},75796:(e,t,n)=>{n.d(t,{_:()=>o});var i=n(21839),s=n(53830);class o extends s.m{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof o&&(0,i.h)(this.point,e.point)}}}}]);