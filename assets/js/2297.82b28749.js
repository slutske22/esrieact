"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2297],{85470:(e,n,t)=>{t.d(n,{A:()=>f});var i,o=t(66866),s=t(21877),r=t(19251),a=t(21564),l=t(73446),c=t(63863);let u=i=class extends s.oY{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new i({variableName:this.variableName,dimensionName:this.dimensionName,values:(0,r.o8)(this.values),isSlice:this.isSlice})}};(0,o._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"variableName",void 0),(0,o._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"dimensionName",void 0),(0,o._)([(0,a.MZ)({type:l.gK.array(l.gK.oneOf([l.gK.native(Number),l.gK.array(l.gK.native(Number))])),json:{write:!0}})],u.prototype,"values",void 0),(0,o._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],u.prototype,"isSlice",void 0),u=i=(0,o._)([(0,c.$)("esri.layers.support.DimensionalDefinition")],u);const f=u},75786:(e,n,t)=>{t.d(n,{jX:()=>u,zo:()=>h,gd:()=>f,ph:()=>a,no:()=>m,kz:()=>l,ht:()=>c,yo:()=>d});t(17639);var i=t(15995),o=t(78632);const s=new Map,r=new class{constructor(e=15e3,n=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,n)}decreaseRefCount(e,n){const t=e+"/"+n,i=this._cachedBlocks;if(i.has(t)){const e=i.get(t);return e.refCount--,e.refCount<=0&&(i.delete(t),e.controller&&e.controller.abort()),e.refCount}return 0}getBlock(e,n){const t=e+"/"+n,i=this._cachedBlocks;if(i.has(t)){const e=i.get(t);return e.ts=Date.now(),e.refCount++,i.delete(t),i.set(t,e),e.block}return null}putBlock(e,n,t,i){const o=this._cachedBlocks,s=e+"/"+n;if(o.has(s)){const e=o.get(s);e.ts=Date.now(),e.refCount++}else o.set(s,{block:t,ts:Date.now(),refCount:1,controller:i});this._trim(),this._updateTimer()}deleteBlock(e,n){const t=this._cachedBlocks,i=e+"/"+n;t.has(i)&&t.delete(i)}updateMaxSize(e){this._size=e,this._trim()}empty(){this._cachedBlocks.clear(),this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null!=this._timer)return;const e=this._cachedBlocks;this._timer=setInterval((()=>{const n=Array.from(e),t=Date.now();for(let i=0;i<n.length&&n[i][1].ts<=t-this._duration;i++)e.delete(n[i][0]);0===e.size&&this._clearTimer()}),this._interval)}_trim(){const e=this._cachedBlocks;if(-1===this._size||this._size>=e.size)return;const n=Array.from(e);for(let t=0;t<n.length-this._size;t++)e.delete(n[t][0])}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}};function a(e,n){return null==n?e:`${e}?sliceId=${n}`}function l(e,n){const t={extent:null,rasterInfo:n,cache:new Map},i=s.get(e);return i?(i.push(t),i.length-1):(s.set(e,[t]),0)}function c(e,n){const t=s.get(e);t&&(t[n]=null,t.some((e=>null!=e))||s.delete(e))}function u(e,n,t){const i=s.get(e);if(!i)return null==n?r.decreaseRefCount(e,t):0;if(null==n||null==i[n])return r.decreaseRefCount(e,t);const o=i[n]?.cache,a=o?.get(t);if(o&&a){if(a.refCount--,0===a.refCount){o.delete(t);for(let e=0;e<i.length;e++)i[e]?.cache.delete(t);a.controller&&a.controller.abort()}return a.refCount}return 0}function f(e,n,t){const i=s.get(e);if(!i)return null==n?r.getBlock(e,t):null;if(null==n||null==i[n]){for(let e=0;e<i.length;e++){const n=i[e]?.cache.get(t);if(n)return n.refCount++,n.block}return r.getBlock(e,t)}const o=i[n]?.cache.get(t);if(o)return o.refCount++,o.block;for(let s=0;s<i.length;s++){if(s===n||!i[s])continue;const e=i[s]?.cache,o=e?.get(t);if(e&&o)return o.refCount++,e.set(t,o),o.block}return null}function m(e,n,t,i,o=null){const a=s.get(e);if(!a)return void(null==n&&r.putBlock(e,t,i,o));if(null==n||null==a[n])return void r.putBlock(e,t,i,o);const l={refCount:1,block:i,isResolved:!1,isRejected:!1,controller:o};i.then((()=>l.isResolved=!0)).catch((()=>l.isRejected=!0)),a[n]?.cache.set(t,l)}function h(e,n,t){const i=s.get(e);i?null!=n&&null!=i[n]?i[n]?.cache.delete(t):r.deleteBlock(e,t):null==n&&r.deleteBlock(e,t)}function x(e,n){const t=s.get(e);return t?t[n]??null:null}function d(e,n,t,s,r,a,l=null){const c=x(e,n);if(!c)return;const u=c.extent,{cache:f,rasterInfo:m}=c;if(u&&u.xmin===t.xmin&&u.xmax===t.xmax&&u.ymin===t.ymin&&u.ymax===t.ymax)return;s=s??0;const h=t.clone().normalize(),{spatialReference:d,transform:g}=m,p=new Set;for(let x=0;x<h.length;x++){const e=h[x];if(e.xmax-e.xmin<=s||e.ymax-e.ymin<=s)continue;let n=(0,i._l)(e,d,l);null!=g&&(n=g.inverseTransform(n));const t=new o.A({x:s,y:s,spatialReference:e.spatialReference});if(null==r&&!(r=(0,i.Wo)(t,d,e,l)))return;const{pyramidLevel:c,pyramidResolution:u,excessiveReading:f}=(0,i.t$)(r,m,a||"closest");if(f)return;const{storageInfo:y}=m,{origin:M}=y,w={x:Math.max(0,Math.floor((n.xmin-M.x)/u.x)),y:Math.max(0,Math.floor((M.y-n.ymax)/u.y))},b=Math.ceil((n.xmax-n.xmin)/u.x-.1),v=Math.ceil((n.ymax-n.ymin)/u.y-.1),R=c>0?y.pyramidBlockWidth:y.blockWidth,k=c>0?y.pyramidBlockHeight:y.blockHeight,N=1,S=Math.max(0,Math.floor(w.x/R)-N),C=Math.max(0,Math.floor(w.y/k)-N),_=Math.floor((w.x+b-1)/R)+N,P=Math.floor((w.y+v-1)/k)+N;for(let i=C;i<=P;i++)for(let e=S;e<=_;e++)p.add(`${c}/${i}/${e}`)}f.forEach(((e,n)=>{if(!p.has(n)){const e=f.get(n);(null==e||e.isResolved||e.isRejected)&&f.delete(n)}})),c.extent={xmin:t.xmin,ymin:t.ymin,xmax:t.xmax,ymax:t.ymax}}},75792:(e,n,t)=>{t.d(n,{DY:()=>g,NG:()=>w,QW:()=>r,Rp:()=>h,fy:()=>d,j5:()=>x,sx:()=>m,xx:()=>a,z2:()=>p});var i=t(85569),o=t(85470);function s(e,n,t){const i=n.shift();if(0===t.length){const e=[];t.push({sliceId:-1,multidimensionalDefinition:e})}const o=t.length;for(let s=0;s<o;s++){const n=t.shift().multidimensionalDefinition;i.values?.forEach((o=>{t.push({sliceId:-1,multidimensionalDefinition:[...n,{variableName:e,dimensionName:i.name,values:[o]}]})}))}n.length&&s(e,n,t)}function r(e,n){const t=[];let i=0;return(n?e.variables.filter((e=>e.name.toLowerCase()===n.toLowerCase())):[...e.variables].sort(((e,n)=>e.name>n.name?1:-1))).forEach((e=>{const n=[],o=[...e.dimensions].sort(((e,n)=>e.name>n.name?-1:1));s(e.name,o,n),n.forEach((e=>{t.push({...e,sliceId:i++})}))})),t}function a(e,n,t){let i=e;if(n&&(n=[...n].sort(((e,n)=>e.dimensionName<n.dimensionName?-1:1))).forEach((({dimensionName:e,values:n,isSlice:t})=>{n.length&&(i=i.filter((i=>{const o=i.multidimensionalDefinition.find((n=>n.dimensionName===e));if(null==o)return!1;const s=o.values[0];return"number"==typeof s?"number"==typeof n[0]?n.includes(s):n.some((e=>e[0]<=s&&e[1]>=s)):"number"==typeof n[0]?n.some((e=>s[0]<=e&&s[1]>=e)):t?n.some((e=>e[0]===s[0]&&e[0]===s[1])):n.some((e=>e[0]>=s[0]&&e[0]<=s[1]||e[1]>=s[0]&&e[1]<=s[1]||e[0]<s[0]&&e[1]>s[1]))})))})),i.length&&null!=t?.start&&null!=t.end){const e=t.start.getTime(),n=t.end.getTime(),o=i[0].multidimensionalDefinition.findIndex((e=>"StdTime"===e.dimensionName));o>-1&&(i=i.filter((t=>{const i=t.multidimensionalDefinition[o].values[0];return e<=i&&n>=i})))}return i.map((e=>e.sliceId))}function l(e,n){return Array.isArray(e)?n[0]===n[1]?e[0]===n[0]||e[1]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]}function c(e,n){return e[0]<=n[0]&&e[1]>=n[0]||e[0]<=n[1]&&e[1]>=n[1]||e[0]>=n[0]&&e[1]<=n[1]}function u(e){return 1===e.length?[e[0],e[0]]:[e[0],e[e.length-1]]}function f(e,n,t){if(!n?.subsetDefinitions?.length)return e;let i;if(t){const{variables:o}=n;if(o.length&&!o.includes(t))return null;const s=n.subsetDefinitions.find((n=>n.dimensionName===e.name&&n.variableName===t));if(!s?.values?.length)return e;i=u(s.values)}else{const t=n.dimensions.find((({name:n})=>n===e.name));i=t?.extent}const o=i;if(!o?.length)return e;const s=e.values.filter((e=>l(e,o)));return{...e,extent:[...o],values:s}}function m(e,n,t){if(!n?.subsetDefinitions?.length)return!1;const{variables:i}=n;if(i.length&&e.some((({variableName:e})=>e&&!i.includes(e))))return!0;for(let o=0;o<e.length;o++){const i=e[o],s=n.subsetDefinitions.find((e=>(""===i.variableName||e.variableName===i.variableName)&&e.dimensionName===i.dimensionName));if(s?.values.length){const e=u(s.values);if(i.isSlice||2!==i.values.length||Array.isArray(i.values[0])||i.values[0]===i.values[1]||!t){if(i.values.some((n=>!l(n,e))))return!0}else if(!c(i.values,e))return!0}}return!1}function h(e,n){if(null==e)return{isOutside:!1};const{geometry:t,timeExtent:i,multidimensionalDefinition:s}=n;let r=null;if(null!=i&&(r=function(e,n){const t=e.dimensions.find((({name:e})=>"StdTime"===e));if(null==t||null==n.start&&null==n.end)return n;n=n.clone();const{start:i,end:s}=n.toJSON(),r=i===s?[i]:null!=i&&null!=s?[i,s]:[i??s];return 2===r.length&&t?.extent.length&&(r[0]=Math.max(r[0],t.extent[0]),r[1]=Math.min(r[1],t.extent[1]??t.extent[0]),r[1]<r[0])||m([new o.A({variableName:"",dimensionName:"StdTime",isSlice:1===r.length,values:r})],e,!0)?null:(n.start=new Date(r[0]),n.end=new Date(r[1]??r[0]),n)}(e,i),null==r))return{isOutside:!0};const{areaOfInterest:a}=e;if(a&&t){const e="point"===t.type?t:"extent"===t.type?t.center:"polygon"===t.type?t.centroid:null;if(e&&!a.contains(e))return{isOutside:!0}}return null!=s&&s.length&&m(s,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:t,timeExtent:r,multidimensionalDefinition:s}}}function x(e,n={}){const{multidimensionalInfo:t,keyProperties:i}=e;if(null==t)return null;const{variableName:o,multidimensionalSubset:s,multidimensionalDefinition:r}=n,a=null!=r?r[0]?.variableName:null,l=o||a||i?.DefaultVariable;let{variables:c}=t;return s?.variables?.length&&(c=c.filter((({name:e})=>s.variables.includes(e)))),l?c.find((({name:e})=>e===l))??c[0]:c[0]}function d(e,n={}){const t=x(e,n);if(!t)return null;const i=[],{dimensions:s,name:r}=t;if(0===s.length)return[new o.A({variableName:r,dimensionName:"",values:[],isSlice:!0})];for(let a=0;a<s.length;a++){const e=f(s[a],n.multidimensionalSubset,r);if(!e)return null;const{values:t,extent:l}=e;let c=t?.[0]??l[0];"stdz"===e.name.toLowerCase()&&!e.hasRanges&&Math.abs(l[1])<=Math.abs(l[0])&&(c=t?.length?t[t.length-1]:l[1]),i.push(new o.A({variableName:r,dimensionName:e.name,values:[c],isSlice:!n.useRangeForRangedDimensionInfo||!!e.hasRanges}))}return i}function g(e){return!!e?.length&&e.some((e=>{if(null==e.values)return!0;const n=e.values.length;return 0===n||n>1||!e.isSlice&&Array.isArray(e.values[0])}))}function p(e,n){if(null==n||null==e)return null;let t=n.variables.map((e=>({...e})));return e?.variables?.length&&(t=t.filter((({name:n})=>e.variables.includes(n))),t.forEach((n=>{n.dimensions=n.dimensions.map((t=>f(t,e,n.name))).filter(i.Ru)}))),t}function y(e,n){const{values:t}=n;if(t?.length){const n=Array.isArray(t[0]),i=Array.isArray(e);return n!==i?-1:n&&i?t.findIndex((n=>n[0]===e[0]&&n[1]===e[1])):t.indexOf(e)}const{extent:i}=n;if(Array.isArray(e)||e<i[0]||e>i[1])return-1;const o=n.interval||1;if("ISO8601"!==n.unit)return Math.round((e-i[0])/o);const s=i[0];let r=-1;switch(n.intervalUnit?.toLowerCase()||"seconds"){case"seconds":r=Math.round((e-s)/1e3/o);break;case"minutes":r=Math.round((e-s)/6e4/o);break;case"hours":r=Math.round((e-s)/36e5/o);break;case"days":r=Math.round((e-s)/864e5/o);break;case"months":{const n=new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear(),t=new Date(s).getUTCMonth(),i=new Date(e).getUTCMonth();r=0===n?i-t:i+11-t+12*(n-1)}break;case"years":r=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/o);break;case"decades":r=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/10/o)}return r}function M(e){let n=e.values?.length;if(n)return n;const{extent:t,unit:i}=e,o=e.interval||1,s=t?t[1]-t[0]:0;if("ISO8601"!==i)return Math.round(s/o);switch(e.intervalUnit?.toLowerCase()??"seconds"){case"seconds":n=Math.round(s/1e3/o);break;case"minutes":n=Math.round(s/6e4/o);break;case"hours":n=Math.round(s/36e5/o);break;case"days":n=Math.round(s/864e5/o);break;case"months":{const e=new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear(),i=new Date(t[0]).getUTCMonth(),o=new Date(t[1]).getUTCMonth();n=0===e?o-i+1:o+11-i+12*(e-1)+1}break;case"years":n=Math.round((new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear())/o);break;case"decades":n=Math.round((new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear())/10/o);break;default:n=0}return n}function w(e,n){let t=0;const i=e[0].variableName,o=[...n.variables].sort(((e,n)=>e.name>n.name?1:-1));for(let s=0;s<o.length;s++){const n=o[s],r=[...n.dimensions].sort(((e,n)=>e.name>n.name?-1:1));if(n.name!==i){t+=r.map((e=>M(e))).reduce(((e,n)=>e*n));continue}const a=r.map((e=>M(e))),l=r.length;for(let i=0;i<l;i++){const n=e.find((e=>e.dimensionName===r[i].name));if(null==n)return null;const o=y(n.values[0],r[i]);if(-1===o)return null;a.shift(),t+=i===l-1?o:o*a.reduce(((e,n)=>e*n))}break}return t}},15995:(e,n,t)=>{t.d(n,{DO:()=>U,FT:()=>L,Hh:()=>N,OM:()=>Y,Ps:()=>J,Wo:()=>C,_I:()=>P,_l:()=>B,dK:()=>H,eh:()=>Z,l0:()=>K,t$:()=>X,uk:()=>j,vI:()=>S,xh:()=>d});t(17639);var i,o,s=t(85569),r=t(98849),a=t(92976),l=t(47063),c=t(97303),u=t(87926),f=t(84698),m=t(78632),h=t(62802),x=t(78983);function d(e,n,t){return!(0,c.canProjectWithoutEngine)(e,n,t)}function g(e,n,t){const i=d(e,n,t);if(i&&!(0,c.isLoaded)())throw new r.A("rasterprojectionhelper-project","projection engine is not loaded");return i}(o=i||(i={}))[o.None=0]="None",o[o.North=1]="North",o[o.South=2]="South",o[o.Both=3]="Both";const p=(e,n,t,i=0)=>{if(1===t[0])return[0,0];let o=1,s=-1,r=1,a=-1;for(let g=0;g<e.length;g+=2)isNaN(e[g])||(o=o>e[g]?e[g]:o,s=s>e[g]?s:e[g],r=r>e[g+1]?e[g+1]:r,a=a>e[g+1]?a:e[g+1]);const{cols:l,rows:c}=n,u=(s-o)/l/t[0],f=(a-r)/c/t[1],m=2*i;let h=0,x=!1,d=[0,0];for(let g=0;g<l-3;g++){for(let n=0;n<c-3;n++){const t=g*c*2+2*n,i=(e[t]+e[t+4]+e[t+4*c]+e[t+4*c+4])/4,o=(e[t+1]+e[t+5]+e[t+4*c+1]+e[t+4*c+5])/4,s=Math.abs((i-e[t+2*c+2])/u),r=Math.abs((o-e[t+2*c+3])/f);if(s+r>h&&(h=s+r,d=[s,r]),m&&h>m){x=!0;break}}if(x)break}return d},y={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},M=32,w=4,b=w,v=new Map,R=new Map,k=500;async function N(){(0,c.isLoaded)()||await(0,c.load)()}function S(e,n,t){return g(e.spatialReference,n),t?(0,c.getTransformation)(n,e.spatialReference,e):(0,c.getTransformation)(e.spatialReference,n,e)}function C(e,n,t,i=null){const o=e.spatialReference;if(o.equals(n))return e;g(o,n,i);const s=t.center,r=new f.A({xmin:s.x-e.x/2,xmax:s.x+e.x/2,ymin:s.y-e.y/2,ymax:s.y+e.y/2,spatialReference:o}),l=(0,c.project)(r,n,i),u=L(n);let m;if(null==l||null!=u&&l.width>=u){const t=(0,a.GA)(o)/(0,a.GA)(n);m={x:e.x*t,y:e.y*t}}else m={x:l.width,y:l.height};return m}function _(e,n=.01){return(0,a.GA)(e)?n/(0,a.GA)(e):0}function P(e,n,t=null,i=!0){const o=e.spatialReference;if(o.equals(n))return e;g(o,n,t);const s=(0,c.project)(e,n,t);return i&&s?(T([e],[s],o,n),s):s}function T(e,n,t,i){const o=F(t,!0),s=F(i,!0),r=_(t,k),a=_(i,k);if(r&&null!=o&&null!=s)for(let l=0;l<e.length;l++){const t=n[l];if(!t)continue;const{x:i}=e[l],{x:c}=t;c>=s[1]-a&&Math.abs(i-o[0])<r?t.x-=s[1]-s[0]:c<=s[0]+a&&Math.abs(i-o[1])<r&&(t.x+=s[1]-s[0])}}function A(e){const{inSR:n,outSR:t,datumTransformation:i,preferPE:o}=e;if(n.equals(t)){const{points:n}=I(e,null);return n}if(n.isWebMercator&&t.isWGS84||n.isWGS84&&t.isWebMercator)return function(e){const{cols:n,rows:t,xres:i,yres:o,usePixelCenter:s,inSR:r,outSR:a}=e;let{xmin:l,ymax:u}=e;s&&(l+=i/2,u-=o/2);const f=[],h=[],x=Math.max(n,t);for(let g=0;g<x;g++){const e=l+i*Math.min(n,g),s=u-o*Math.min(t,g),x=(0,c.project)(new m.A({x:e,y:s,spatialReference:r}),a);g<=n&&f.push(x.x),g<=t&&h.push(x.y)}const d=[];for(let c=0;c<n;c++)for(let e=0;e<t;e++)d.push([f[c],h[e]]);return d}(e);if(g(n,t,i)&&o){if(n.isGeographic)return G(e);if(null!=E(n))return G(e)}return function(e){const{points:n}=I(e,null),{inSR:t,outSR:i,datumTransformation:o}=e,s=n.map((e=>new m.A(e[0],e[1],t))),r=(0,c.project)(s,i,o);return o&&T(s,r,t,i),r.map((e=>e?[e.x,e.y]:[NaN,NaN]))}(e)}function G(e){const{inSR:n,outSR:t,datumTransformation:i}=e,o=E(n),{points:s,mask:r}=I(e,o);if(!n.isGeographic){const e=n.wkid?l.P.coordsys(n.wkid):l.P.fromString(n.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,n.wkt2||n.wkt);l.g.projToGeog(e,s.length,s)}if(null!=i&&i.steps.length){let e;const n=179.9955;if(t.isGeographic&&(e=s.map((([e])=>e>n?1:e<-n?-1:0))),i.steps.forEach((e=>{const n=e.wkid?l.P.geogtran(e.wkid):l.P.fromString(l.a.PE_TYPE_GEOGTRAN,e.wkt);l.h.geogToGeog(n,s.length,s,null,e.isInverse?l.a.PE_TRANSFORM_2_TO_1:l.a.PE_TRANSFORM_1_TO_2)})),e)for(let t=0;t<s.length;t++){const i=e[t],o=s[t][0],r=o>n?1:o<-n?-1:0;i&&r&&i!==r&&(s[t][0]=i>0?o+360:o-360)}}if(!t.isGeographic){const e=E(t,!0),n=null!=e&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];!function(e,n){const[t,i]=n;for(let o=0;o<e.length;o++){const n=e[o][1];(n<t||n>i)&&(e[o]=[NaN,NaN])}}(s,n);const i=t.wkid?l.P.coordsys(t.wkid):l.P.fromString(t.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,t.wkt2||t.wkt);l.g.geogToProj(i,s.length,s)}let a=s;if(r&&s.length!==r.length){a=[];for(let e=0,n=0;e<r.length;e++)r[e]?a.push(s[n++]):a.push([NaN,NaN])}return a}function E(e,n=!1){let t=e.wkid||e.wkt2||e.wkt;if(!t||e.isGeographic)return null;if(t=String(t),v.has(t)){const e=v.get(t);return n?e?.gcs:e?.pcs}const i=e.wkid?l.P.coordsys(e.wkid):l.P.fromString(e.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,e.wkt2||e.wkt),o=D(i,_(e,1e-4)),s=D(i,0,!0);return v.set(t,{pcs:o,gcs:s}),n?s:o}function D(e,n=0,t=!1){const i=l.j.generate(e),o=t?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!i||!o?.length)return null;let s=!1,r=o.find((e=>1===e.getInclusive()&&1===e.getKind()));if(!r){if(r=o.find((e=>1===e.getInclusive()&&0===e.getKind())),!r)return null;s=!0}const a=t?0:(2===i.getNorthPoleLocation()?1:0)|(2===i.getSouthPoleLocation()?2:0),c=i.isPannableRectangle(),u=r.getCoord();if(s)return{isEnvelope:s,isPannable:c,vertices:u,coef:null,bbox:[u[0][0]-n,u[0][1]-n,u[1][0]+n,u[1][1]+n],poleLocation:a};let f=0;const m=[];let[h,x]=u[0],[d,g]=u[0];for(let l=0,p=u.length;l<p;l++){f++,f===p&&(f=0);const[e,n]=u[l],[t,i]=u[f];if(i===n)m.push([e,t,n,i,2]);else{const o=(t-e)/(i-n||1e-4),s=e-o*n;n<i?m.push([o,s,n,i,0]):m.push([o,s,i,n,1])}h=h<e?h:e,x=x<n?x:n,d=d>e?d:e,g=g>n?g:n}return{isEnvelope:!1,isPannable:c,vertices:u,coef:m,bbox:[h,x,d,g],poleLocation:a}}function I(e,n){const t=[],{cols:i,rows:o,xres:s,yres:r,usePixelCenter:a}=e;let{xmin:l,ymax:c}=e;if(a&&(l+=s/2,c-=r/2),null==n){for(let e=0;e<i;e++)for(let n=0;n<o;n++)t.push([l+s*e,c-r*n]);return{points:t}}const u=new Uint8Array(i*o);if(n.isEnvelope){const{bbox:[e,a,f,m]}=n;for(let h=0,x=0;h<i;h++){const i=l+s*h,d=n.isPannable||i>=e&&i<=f;for(let e=0;e<o;e++,x++){const n=c-r*e;d&&n>=a&&n<=m&&(t.push([i,n]),u[x]=1)}}return{points:t,mask:u}}const f=n.coef,m=[];for(let h=0;h<o;h++){const e=c-r*h,n=[],t=[];for(let o=0;o<f.length;o++){const[i,s,r,a,l]=f[o];if(e===r&&r===a)n.push(i),n.push(s),t.push(2),t.push(2);else if(e>=r&&e<=a){const o=i*e+s;n.push(o),t.push(l)}}let i=n;if(n.length>2){let e=2===t[0]?0:t[0],o=n[0];i=[];for(let s=1;s<t.length;s++)2===t[s]&&s!==t.length-1||(t[s]!==e&&(i.push(0===e?Math.min(o,n[s-1]):Math.max(o,n[s-1])),e=t[s],o=n[s]),s===t.length-1&&i.push(0===t[s]?Math.min(o,n[s]):Math.max(o,n[s])));i.sort(((e,n)=>e-n))}else n[0]>n[1]&&(i=[n[1],n[0]]);m.push(i)}for(let h=0,x=0;h<i;h++){const e=l+s*h;for(let n=0;n<o;n++,x++){const i=c-r*n,o=m[n];if(2===o.length)e>=o[0]&&e<=o[1]&&(t.push([e,i]),u[x]=1);else if(o.length>2){let n=!1;for(let t=0;t<o.length;t+=2)if(e>=o[t]&&e<=o[t+1]){n=!0;break}n&&(t.push([e,i]),u[x]=1)}}}return{points:t,mask:u}}function z(e,n){const t=L(e[0].spatialReference);if(e.length<2||null==t)return e[0];if(n=n??_(e[0].spatialReference),1===(e=e.filter((e=>e.width>n))).length)return e[0];let{xmin:i,xmax:o,ymin:s,ymax:r}=e[0];for(let a=1;a<e.length;a++){const n=e[a];o=n.xmax+t*a,s=Math.min(s,n.ymin),r=Math.max(r,n.ymax)}return new f.A({xmin:i,xmax:o,ymin:s,ymax:r,spatialReference:e[0].spatialReference})}function B(e,n,t=null,o=!0){const r=e.spatialReference;if(r.equals(n))return e;const a=Y(e),l=L(r,!0),u=L(n);if(0===a||null==l||null==u){const s=O(e,n,t,o);if(null==l&&null!=u&&Math.abs(s.width-u)<_(n)&&(0,c.isLoaded)()){const t=E(r);if(null!=t&&t.poleLocation===i.None&&e.width<(t.bbox[2]-t.bbox[0])/2)return function(e,n){const t=L(n);if(null==t)return null;let{xmin:i,ymin:o,xmax:s,ymax:r}=e;const a=e.spatialReference,l=new h.A({spatialReference:a,rings:[[[i,o],[s,o],[s,r],[i,r],[i,o]]]}),u=(0,c.project)(l,n);if(2!==u.rings.length||!u.rings[0].length||!u.rings[1].length)return null;const{rings:m}=u,x=_(a),d=new f.A({spatialReference:n});for(let c=0;c<2;c++){i=s=m[c][0][0],o=r=m[c][0][1];for(let e=0;e<m[c].length;e++)i=i>m[c][e][0]?m[c][e][0]:i,s=s<m[c][e][0]?m[c][e][0]:s,o=o>m[c][e][1]?m[c][e][1]:o,r=r<m[c][e][1]?m[c][e][1]:r;if(0===c)d.ymin=o,d.ymax=r,d.xmin=i,d.xmax=s;else if(d.ymin=Math.min(d.ymin,o),d.ymax=Math.max(d.ymax,r),Math.abs(s-t/2)<x)d.xmin=i,d.xmax=d.xmax+t;else{if(!(Math.abs(i+t/2)<x))return null;d.xmax=s+t}}return d}(e,n)||s}return s}const m=e.clone().normalize();if(1===m.length&&e.xmax<l&&e.xmax-l/2>_(r)){const{xmin:n,xmax:t}=e;for(let i=0;i<=a;i++){const o=0===i?n:-l/2,s=i===a?t-l*i:l/2;m[i]=new f.A({xmin:o,xmax:s,ymin:e.ymin,ymax:e.ymax,spatialReference:r})}}return z(m.map((e=>O(e,n,t,o))).filter(s.Ru))}function j(e,n,t){if("extent"===e.type){const{xmin:n,ymin:t,xmax:i,ymax:o,spatialReference:s}=e;e=new h.A({rings:[[[n,o],[i,o],[i,t],[n,t],[n,o]]],spatialReference:s})}return e.spatialReference.equals(n)?e:(g(e.spatialReference,n,t),(0,c.project)(e,n,t))}function O(e,n,t=null,i=!0,o=!0){const s=e.spatialReference;if(s.equals(n)||!n)return e;g(s,n,t);const r=(0,c.project)(e,n,t);if(o&&n.isWebMercator&&r&&(r.ymax=Math.min(20037508.342787,r.ymax),r.ymin=Math.max(-20037508.342787,r.ymin),r.ymin>=r.ymax))return null;if(!i||!r)return r;const a=F(s,!0),l=F(n,!0);if(null==a||null==l)return r;const u=_(s,.001),f=_(s,k),h=_(n,.001);if(Math.abs(r.xmin-l[0])<h&&Math.abs(r.xmax-l[1])<h){const i=Math.abs(e.xmin-a[0]),o=Math.abs(a[1]-e.xmax);if(i<u&&o>f){r.xmin=l[0];const i=[];i.push(new m.A(e.xmax,e.ymin,s)),i.push(new m.A(e.xmax,(e.ymin+e.ymax)/2,s)),i.push(new m.A(e.xmax,e.ymax,s));const o=i.map((e=>P(e,n,t))).filter((e=>!isNaN(e?.x))).map((e=>e.x));r.xmax=Math.max.apply(null,o)}if(o<u&&i>f){r.xmax=l[1];const i=[];i.push(new m.A(e.xmin,e.ymin,s)),i.push(new m.A(e.xmin,(e.ymin+e.ymax)/2,s)),i.push(new m.A(e.xmin,e.ymax,s));const o=i.map((e=>P(e,n,t))).filter((e=>!isNaN(e?.x))).map((e=>e.x));r.xmin=Math.min.apply(null,o)}}else{const e=_(n,.001);Math.abs(r.xmin-l[0])<e&&(r.xmin=l[0]),Math.abs(r.xmax-l[1])<e&&(r.xmax=l[1])}return r}function L(e,n=!1){if(!e)return null;const t=n?20037508.342787:20037508.342788905;return e.isWebMercator?2*t:e.wkid&&e.isGeographic?360:2*y[e.wkid]||null}function F(e,n=!1){if(e.isGeographic)return[-180,180];const t=L(e,n);return null!=t?[-t/2,t/2]:null}function W(e,n,t,i){let o=(e-n)/t;return o-Math.floor(o)!=0?o=Math.floor(o):i&&(o-=1),o}function Y(e,n=!1){const t=L(e.spatialReference);if(null==t)return 0;const i=n?0:-t/2,o=_(e.spatialReference),s=!n&&Math.abs(e.xmax-t/2)<o?t/2:e.xmax,r=!n&&Math.abs(e.xmin+t/2)<o?-t/2:e.xmin;return W(s,i,t,!0)-W(r,i,t,!1)}function U(e){const n=e.storageInfo.origin.x,t=L(e.spatialReference,!0);if(null==t)return{originX:n,halfWorldWidth:null,pyramidsInfo:null};const i=t/2,{nativePixelSize:o,storageInfo:s,extent:r}=e,{maximumPyramidLevel:a,blockWidth:l,pyramidScalingFactor:c}=s;let u=o.x;const f=[],m=null!=e.transform&&"gcs-shift"===e.transform.type,h=n+(m?0:i),x=m?t-n:i-n;for(let d=0;d<=a;d++){const e=(r.xmax-n)/u/l,t=e-Math.floor(e)==0?e:Math.ceil(e),i=x/u/l,o=i-Math.floor(i)==0?i:Math.ceil(i),s=Math.floor(h/u/l),a=Math.round(h/u)%l,m=(l-Math.round(x/u)%l)%l;f.push({resolutionX:u,blockWidth:l,datsetColumnCount:t,worldColumnCountFromOrigin:o,leftMargin:a,rightPadding:m,originColumnOffset:s}),u*=c}return{originX:n,halfWorldWidth:i,pyramidsInfo:f,hasGCSSShiftTransform:m}}function K(e){const n=e.isAdaptive&&null==e.spacing;let t=e.spacing||[M,M],i=$(e),o={cols:i.size[0]+1,rows:i.size[1]+1};const s=i.outofBoundPointCount>0&&i.outofBoundPointCount<i.offsets.length/2;let r=i.outofBoundPointCount===i.offsets.length/2||n&&s?[0,0]:p(i.offsets,o,t,b);const a=(r[0]+r[1])/2,c=e.projectedExtent.spatialReference,u=e.srcBufferExtent.spatialReference;if(n&&(s||a>b)&&(d(c,u,e.datumTransformation)&&(c.isGeographic||E(c)),t=[w,w],i=$({...e,spacing:t}),o={cols:i.size[0]+1,rows:i.size[1]+1},r=p(i.offsets,o,t,b)),i.error=r,t[0]>1&&(i.coefficients=q(i.offsets,o,s)),e.includeGCSGrid&&!c.isGeographic&&!c.isWebMercator)if(u.isGeographic)i.gcsGrid={offsets:i.offsets,coefficients:i.coefficients,spacing:t};else{const n=E(c);if(null!=n&&!n.isEnvelope){const n=function(e){if(!e||e.isGeographic)return e;const n=String(e.wkid||e.wkt2||e.wkt);let t;return R.has(n)?t=R.get(n):(t=(e.wkid?l.P.coordsys(e.wkid):l.P.fromString(l.a.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),R.set(n,t)),new x.A({wkid:t})}(c),r=B(e.projectedExtent,n),{offsets:a}=$({...e,srcBufferExtent:r,spacing:t}),u=q(a,o,s);i.gcsGrid={offsets:a,coefficients:u,spacing:t}}}return i}function $(e){const{projectedExtent:n,srcBufferExtent:t,pixelSize:i,datumTransformation:o,rasterTransform:s}=e,r=n.spatialReference,a=t.spatialReference,l=g(r,a),{xmin:c,ymin:u,xmax:f,ymax:h}=n,x=L(a),d=null!=x&&(e.hasWrapAround||"gcs-shift"===s?.type),p=e.spacing||[M,M],y=p[0]*i.x,b=p[1]*i.y,v=1===p[0],R=Math.ceil((f-c)/y-.1/p[0])+(v?0:1),N=Math.ceil((h-u)/b-.1/p[1])+(v?0:1),S=A({cols:R,rows:N,xmin:c,ymax:h,xres:y,yres:b,inSR:r,outSR:a,datumTransformation:o,preferPE:p[0]<=w,usePixelCenter:v}),C=[];let P,T=0;const G=v?-1:NaN,{xmin:D,xmax:I,ymax:z,width:B,height:j}=t,O=_(a,k),F=null!=x&&D>0&&I>x/2;let W=!1;if(l){const e=E(r);W=null!=e&&e.poleLocation>0}for(let g=0;g<R;g++){const e=[];for(let n=0;n<N;n++){let t=S[g*N+n];if(d&&t[0]>I&&t[0]>x/2-O?t[0]-=x:d&&0===g&&t[0]<0&&F&&!s&&(t[0]+=x),!t||isNaN(t[0])||isNaN(t[1]))C.push(G),C.push(G),e.push(null),T++;else{if(s){const e=s.inverseTransform(new m.A({x:t[0],y:t[1],spatialReference:a}));t=[e.x,e.y]}e.push(t),g>0&&d&&P[n]&&t[0]<P[n][0]&&(t[0]+=x,W&&t[0]>I&&t[0]>x&&(t[0]-=x)),C.push((t[0]-D)/B),C.push((z-t[1])/j)}}P=e}return{offsets:C,error:null,coefficients:null,outofBoundPointCount:T,spacing:p,size:v?[R,N]:[R-1,N-1]}}function q(e,n,t){const{cols:i,rows:o}=n,s=new Float32Array((i-1)*(o-1)*2*6),r=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),a=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<i-1;l++){for(let n=0;n<o-1;n++){let t=l*o*2+2*n;const c=e[t],u=e[t+1],f=e[t+2],m=e[t+3];t+=2*o;const h=e[t],x=e[t+1],d=e[t+2],g=e[t+3];let p=0,y=12*(n*(i-1)+l);for(let e=0;e<3;e++)s[y++]=r[p++]*c+r[p++]*f+r[p++]*d;p=0;for(let e=0;e<3;e++)s[y++]=r[p++]*u+r[p++]*m+r[p++]*g;p=0;for(let e=0;e<3;e++)s[y++]=a[p++]*c+a[p++]*h+a[p++]*d;p=0;for(let e=0;e<3;e++)s[y++]=a[p++]*u+a[p++]*x+a[p++]*g}if(t)for(let e=0;e<s.length;e++)isNaN(s[e])&&(s[e]=-1)}return s}function J(e){const{spatialReference:n}=e,t=(0,u.Vp)(n);if(!t)return e;const[i,o]=t.valid,s=o-i;let r=0;if(e.xmin<i){const n=i-e.xmin;r=Math.ceil(n/s)}else if(e.xmin>o){const n=e.xmin-o;r=-Math.ceil(n/s)}return new f.A({spatialReference:e.spatialReference,xmin:e.xmin+r*s,ymin:e.ymin,xmax:e.xmax+r*s,ymax:e.ymax})}function X(e,n,t){const{storageInfo:i,pixelSize:o}=n;let s=0,r=!1;const{pyramidResolutions:l}=i,c="mixed"===i.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,i.tileInfo.dpi/96)):1,u=(e.x+e.y)/2/c;if(null!=l&&l.length){const e=l[l.length-1],i=(e.x+e.y)/2,c=(o.x+o.y)/2;if(u<=c)s=0;else if(u>=i)s=l.length,r=u/i>8;else{let e,n=c;for(let i=1;i<=l.length;i++){if(e=(l[i-1].x+l[i-1].y)/2,u<=e){u===e?s=i:"down"===t?(s=i-1,r=u/n>8):s="up"===t||u-n>e-u||u/n>2?i:i-1;break}n=e}}const f=0===s?o:l[s-1];return r&&Math.min(f.x,f.y)*(0,a.GA)(n.spatialReference)>19567&&(r=!1),{pyramidLevel:s,pyramidResolution:new m.A({x:f.x,y:f.y,spatialReference:n.spatialReference}),excessiveReading:r}}const f=Math.log(e.x/o.x)/Math.LN2,h=Math.log(e.y/o.y)/Math.LN2,x=n.storageInfo.maximumPyramidLevel||0;s="down"===t?Math.floor(Math.min(f,h)):"up"===t?Math.ceil(Math.max(f,h)):Math.round((f+h)/2),s<0?s=0:s>x&&(r=s>x+3,s=x);const d=2**s;return{pyramidLevel:s,pyramidResolution:new m.A({x:d*n.nativePixelSize.x,y:d*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:r}}function Z(e,n){const{pixelSize:t,extent:i}=e,o=S(i,n,!1);return B(function(e,n){const t=e.clone().normalize();return 1===t.length?t[0]:z(t,n)}(i,(t.x+t.y)/16),n,o)}function H(e,n,t){const i=t?.tileSize??512,o=t?.alignGlobalDatasetWithAGOL??!0,s=!!t?.limitToSrcResolution,{extent:r,spatialReference:l,pixelSize:c}=e,u=C(new m.A({x:c.x,y:c.y,spatialReference:l}),n,r);if(null==u)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const f=(u.x+u.y)/2,h=(0,a.GA)(n),x=f*h*96*39.37,d=n.isGeographic?256/i*295828763.7958547:256/i*591657527.591555;let g="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const p=Z(e,n),y=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(d/2/x)/Math.LN2));if(!g&&o&&(n.isGeographic||n.isWebMercator)){const t=L(n);if(g=Y(p)>0||null!=t&&p.width>t/4,!g&&null!=t){let n=-1;if(y<3)n=2**y*f*i;else if(e.storageInfo){const{maximumPyramidLevel:t=0,pyramidScalingFactor:o=2}=e.storageInfo;n=o**t*f*i}const o=Math.ceil(t/n);g=1===o||2===o&&t/2-p.xmax<n}}let M,w=x;const b=1.001,v=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(g){w=d;const e=n.isGeographic?1341104507446289e-21:.29858214164761665,t=e*(96*h*39.37),i=n.isGeographic?4326:3857;M=C(new m.A({x:e,y:e,spatialReference:{wkid:i}}),l,p),M.x*=w/t,M.y*=w/t}else{M={x:c.x,y:c.y};let e=0;for(;w<d*(b/2)&&e<y;)e++,w*=v,M.x*=v,M.y*=v;Math.max(w,d)/Math.min(w,d)<=b&&(w=d)}const R=[w],k=[{x:M.x,y:M.y}],N=Math.min(70.5310735,x)/b;for(;w>=N;)w/=v,M.x/=v,M.y/=v,R.push(w),k.push({x:M.x,y:M.y});if(s){const e=.001*c.x;let n=k.findIndex((n=>n.x>=c.x-e&&n.x<=c.x+e));n>-1?(k.length=n+1,R.length=n+1):(n=k.findIndex((n=>n.x<=c.x+e)),n>0&&(k.length=n,R.length=n))}return{projectedPixelSize:u,scales:R,srcResolutions:k,isCustomTilingScheme:!g}}}}]);