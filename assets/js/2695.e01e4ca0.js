"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2695],{72695:(e,t,i)=>{i.r(t),i.d(t,{default:()=>w});var s=i(66866),r=i(25707),h=i(85569),a=i(48982),n=i(20464),o=i(85251),l=(i(539),i(73446),i(39831),i(98849),i(63863)),d=i(40231),c=i(13737),u=i(80734),g=i(9049);const p="sublayers",_="layerView";let f=class extends((0,d.e)(g.A)){constructor(){super(...arguments),this._highlightIds=new Map}async fetchPopupFeatures(e){return Array.from(this.graphicsViews(),(t=>t.hitTest(e).filter((e=>!!e.popupTemplate)))).flat()}*graphicsViews(){null==this._graphicsViewsFeatureCollectionMap?null==this._graphicsViews?yield*[]:yield*this._graphicsViews:yield*this._graphicsViewsFeatureCollectionMap.keys()}async hitTest(e,t){return Array.from(this.graphicsViews(),(t=>{const i=t.hitTest(e);if(null!=this._graphicsViewsFeatureCollectionMap){const e=this._graphicsViewsFeatureCollectionMap.get(t);for(const t of i)!t.popupTemplate&&e.popupTemplate&&(t.popupTemplate=e.popupTemplate),t.sourceLayer=t.layer=this.layer}return i})).flat().map((t=>({type:"graphic",graphic:t,layer:this.layer,mapPoint:e})))}highlight(e){let t;"number"==typeof e?t=[e]:e instanceof r.A?t=[e.uid]:Array.isArray(e)&&e.length>0?t="number"==typeof e[0]?e:e.map((e=>e&&e.uid)):a.A.isCollection(e)&&(t=e.map((e=>e&&e.uid)).toArray());const i=t?.filter(h.Ru);return i?.length?(this._addHighlight(i),(0,n.hA)((()=>this._removeHighlight(i)))):(0,n.hA)()}update(e){for(const t of this.graphicsViews())t.processUpdate(e)}attach(){const e=this.view,t=()=>this.requestUpdate(),i=this.layer.featureCollections;if(null!=i&&i.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const s of i){const i=new c.A(this.view.featuresTilingScheme),r=new u.A({view:e,graphics:s.source,renderer:s.renderer,requestUpdateCallback:t,container:i});this._graphicsViewsFeatureCollectionMap.set(r,s),this.container.addChild(r.container),this.addHandles([(0,o.wB)((()=>s.visible),(e=>r.container.visible=e),o.Vh),(0,o.wB)((()=>r.updating),(()=>this.notifyChange("updating")),o.Vh)],_)}this._updateHighlight()}else null!=this.layer.sublayers&&this.addHandles((0,o.on)((()=>this.layer.sublayers),"change",(()=>this._createGraphicsViews()),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),p)}detach(){this._destroyGraphicsViews(),this.removeHandles(p)}moveStart(){}moveEnd(){}viewChange(){for(const e of this.graphicsViews())e.viewChange()}isUpdating(){for(const e of this.graphicsViews())if(e.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.removeHandles(_);for(const e of this.graphicsViews())e.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),null==this.layer.sublayers)return;const e=[],t=this.view,i=()=>this.requestUpdate();for(const s of this.layer.sublayers){const r=new c.A(this.view.featuresTilingScheme);r.fadeTransitionEnabled=!0;const h=new u.A({view:t,graphics:s.graphics,requestUpdateCallback:i,container:r});this.addHandles([s.on("graphic-update",h.graphicUpdateHandler),(0,o.wB)((()=>s.visible),(e=>h.container.visible=e),o.Vh),(0,o.wB)((()=>h.updating),(()=>this.notifyChange("updating")),o.Vh)],_),this.container.addChild(h.container),e.push(h)}this._graphicsViews=e,this._updateHighlight()}_addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight()}_removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight()}_updateHighlight(){const e=Array.from(this._highlightIds.keys());for(const t of this.graphicsViews())t.setHighlight(e)}};f=(0,s._)([(0,l.$)("esri.views.2d.layers.MapNotesLayerView2D")],f);const w=f},95387:(e,t,i)=>{i.d(t,{A:()=>y});var s=i(6267),r=i(42766),h=i(46615),a=i(21360),n=i(48325),o=i(80952),l=i(65231),d=i(37353),c=i(38403),u=i(89423),g=i(41746),p=i(80976);const _=Math.PI/180;class f extends d.q{constructor(e){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,a.c)(),this._localOrigin={x:0,y:0},this._getBounds=e}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,s.WD)(this._program)}doRender(e){const{context:t}=e,i=this._getBounds();if(i.length<1)return;this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(e),this._updateBufferData(t,i),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(g.dn.ONE,g.dn.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0);const s=this._program;t.bindVAO(this._vao),t.useProgram(s),s.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),t.gl.lineWidth(1),t.drawElements(g.WR.LINES,8*i.length,g.pe.UNSIGNED_INT,0),t.bindVAO()}_createTransforms(){return{dvs:(0,a.c)()}}_createShaderProgram(e){if(this._program)return;this._program=e.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",w().attributes)}_updateMatricesAndLocalOrigin(e){const{state:t}=e,{displayMat3:i,size:s,resolution:r,pixelRatio:a,rotation:d,viewpoint:c}=t,u=_*d,{x:g,y:p}=c.targetGeometry,f=(0,l.mT)(g,t.spatialReference);this._localOrigin.x=f,this._localOrigin.y=p;const w=a*s[0],y=a*s[1],m=r*w,v=r*y,b=(0,h.g)(this._dvsMat3);(0,h.m)(b,b,i),(0,h.h)(b,b,(0,n.f)(w/2,y/2)),(0,h.c)(b,b,(0,o.f)(s[0]/m,-y/v,1)),(0,h.r)(b,b,-u)}_updateBufferData(e,t){const{x:i,y:s}=this._localOrigin,r=8*t.length,h=new Float32Array(r),a=new Uint32Array(8*t.length);let n=0,o=0;for(const l of t)l&&(h[2*n]=l[0]-i,h[2*n+1]=l[1]-s,h[2*n+2]=l[0]-i,h[2*n+3]=l[3]-s,h[2*n+4]=l[2]-i,h[2*n+5]=l[3]-s,h[2*n+6]=l[2]-i,h[2*n+7]=l[1]-s,a[o]=n+0,a[o+1]=n+3,a[o+2]=n+3,a[o+3]=n+2,a[o+4]=n+2,a[o+5]=n+1,a[o+6]=n+1,a[o+7]=n+0,n+=4,o+=8);if(this._vertexBuffer?this._vertexBuffer.setData(h.buffer):this._vertexBuffer=u.g.createVertex(e,g._U.DYNAMIC_DRAW,h.buffer),this._indexBuffer?this._indexBuffer.setData(a):this._indexBuffer=u.g.createIndex(e,g._U.DYNAMIC_DRAW,a),!this._vao){const t=w();this._vao=new p.Z(e,t.attributes,t.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const w=()=>(0,c.ES)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:g.pe.FLOAT}]});let y=class extends r.i{constructor(e){super(e),this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,s.pR)(this._boundsRenderer)}enableRenderingBounds(e){this._boundsRenderer=new f(e),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(e,t){e.patch(t),this.contains(e)||this.addChild(e),this.requestRender()}onTileError(e){e.clear(),this.contains(e)||this.addChild(e)}_renderChildren(e,t){for(const i of this.children)i.isReady&&i.hasData&&(i.commit(e),e.context.setStencilFunction(g.MT.EQUAL,i.stencilRef,255),i.getDisplayList().replay(e,i,t))}}},13737:(e,t,i)=>{i.d(t,{A:()=>h});var s=i(79432),r=i(95387);class h extends r.A{renderChildren(e){this.attributeView.update(),this.children.some((e=>e.hasData))&&(this.attributeView.bindTextures(e.context,!1),super.renderChildren(e),e.drawPhase===s.S5.MAP&&this._renderChildren(e),this.hasHighlight&&e.drawPhase===s.S5.HIGHLIGHT&&this._renderHighlight(e),this._boundsRenderer&&this._boundsRenderer.doRender(e))}_renderHighlight(e){const{painter:t}=e,i=t.effects.highlight;i.bind(e),this._renderChildren(e,i.defines),i.draw(e),i.unbind()}}}}]);