"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[78367,15878],{98350:(e,t,i)=>{i.d(t,{A:()=>c});var s=i(66866),r=i(24793),a=i(59851),n=i(21877),o=i(21564),l=(i(39831),i(539),i(9272),i(63863));const d=new a.J({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),p=new a.J({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let c=class extends(r.A.ClonableMixin(n.A)){constructor(e){super(e),this.cardinality=null,this.catalogId=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};(0,s._)([(0,o.MZ)({json:{read:d.read,write:d.write}})],c.prototype,"cardinality",void 0),(0,s._)([(0,o.MZ)({json:{name:"catalogID"}})],c.prototype,"catalogId",void 0),(0,s._)([(0,o.MZ)({json:{read:!0,write:!0}})],c.prototype,"composite",void 0),(0,s._)([(0,o.MZ)({json:{read:!0,write:!0}})],c.prototype,"id",void 0),(0,s._)([(0,o.MZ)({json:{read:!0,write:!0}})],c.prototype,"keyField",void 0),(0,s._)([(0,o.MZ)({json:{read:!0,write:!0}})],c.prototype,"keyFieldInRelationshipTable",void 0),(0,s._)([(0,o.MZ)({json:{read:!0,write:!0}})],c.prototype,"name",void 0),(0,s._)([(0,o.MZ)({json:{read:!0,write:!0}})],c.prototype,"relatedTableId",void 0),(0,s._)([(0,o.MZ)({json:{read:!0,write:!0}})],c.prototype,"relationshipTableId",void 0),(0,s._)([(0,o.MZ)({json:{read:p.read,write:p.write}})],c.prototype,"role",void 0),c=(0,s._)([(0,l.$)("esri.layers.support.Relationship")],c)},15878:(e,t,i)=>{i.d(t,{A:()=>u});var s=i(66866),r=i(52495),a=i(85569),n=i(12690),o=i(48982),l=i(21564),d=(i(39831),i(539),i(63863)),p=i(42453),c=i(35387);let u=class extends r.A{constructor(e){super(e),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){return this.expressionsUsedInTitle.length>0?this._get("_arcadeTask")||(0,n.UT)((()=>(0,c.l)())):null}get featureUtilsPromise(){return this._get("featureUtilsPromise")??Promise.all([i.e(72076),i.e(3769)]).then(i.bind(i,3769)).then((e=>this._featureUtils=e))}get calculatedExpressions(){const e=new o.A;if(!this.expressionsUsedInTitle.length)return e;if(!this._arcadeTask?.value){for(const t of this.expressionsUsedInTitle??[])e.push({name:t.name,invalid:!0});return e}for(const t of this.expressionsUsedInTitle)try{const i=this._arcadeTask.value.arcade.parseScript(t.expression,["$layer","$map","$datastore"]);if(i.isAsync){e.push({name:t.name,invalid:!0});break}e.push({name:t.name,syntax:i,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(i,{vars:{$feature:"any"}})})}catch{e.push({name:t.name,invalid:!0});break}return e}get expressionsUsedInTitle(){let e=this.effectivePopupTemplate?.title??"";return"string"!=typeof e?[]:(e=e.toLowerCase(),this.effectivePopupTemplate?.expressionInfos?.filter((t=>e.includes(`{expression/${t.name.toLowerCase()}}`)))??[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some((e=>!0===e.invalid))}get requiredFields(){const e=new Set;if(this._arcadeTask?.value&&!this.hasBadExpressions)for(const i of this.calculatedExpressions?.toArray()??[])try{const t=this._arcadeTask.value.arcade.extractFieldLiterals(i.syntax);for(const i of t){const t=i.split("."),s=this.fieldsIndex.get(t.at(-1)??"");s&&e.add(s.name)}}catch{}const t=this._extractFieldNames(this.workingTitle);for(const i of t){const t=this.fieldsIndex.get(i);t&&e.add(t.name)}return null!=this.objectIdField&&e.add(this.objectIdField),e}get titleFromDisplayField(){let e="";return this.displayField&&(e=this.fieldsIndex.get(this.displayField)?.name??""),e||(e=this.fieldsIndex.get(this.objectIdField)?.name??""),e?`{${e}}`:""}get workingTitle(){const e=this.effectivePopupTemplate?this.effectivePopupTemplate.title:"";return""===e||null==e||this.hasBadExpressions||"string"!=typeof e?this.titleFromDisplayField:e}async getTitle(e,t,i){const s=t.getObjectId()??t.attributes[e.objectIdField];return(await this.getTitles(e,[t],i)).get(s)??""}async getTitles(e,t,i){const s=new Map,r=i?.timeZone??"system";try{const[{substituteFieldsInLinksAndAttributes:a}]=await Promise.all([this.featureUtilsPromise,this._arcadeTask?.promise]);i?.fetchMissingFields&&(t=await this._checkAndReQueryGraphics(e,t));const{fieldInfoMap:n,workingTitle:o}=this,l=o&&n;t.forEach((t=>{const i=t.getObjectId()??t.attributes[e.objectIdField],d=l?a({attributes:t.attributes,expressionAttributes:null,fieldInfoMap:n,globalAttributes:this._createFormattedAttributes(e,t,r).global,layer:e,text:o}):"";s.set(i,d)}))}catch{}return s}async _checkAndReQueryGraphics(e,t){const i=t.map((t=>t.getObjectId()??t.attributes[e.objectIdField])).filter(a.Ru);if(i.length!==t.length)return t;if(t.some((e=>!(0,p.Kl)(e,this.requiredFields)))){const s=e.createQuery();s.where="1=1",s.outFields=[...this.requiredFields],s.objectIds=i;const r=await e.queryFeatures(s);if(r?.features.length===t.length)return r.features}return t}_createFieldInfoMap(e){const t=new Map;if(!e)return t;for(const i of e){if(!i.fieldName)continue;const e=this.fieldsIndex.get(i.fieldName),s=e?.name??i.fieldName;i.fieldName=s,t.set(s.toLowerCase(),i)}return t}_createFormattedAttributes(e,t,i="system"){const s=this.effectivePopupTemplate?.fieldInfos??[],r={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&this._arcadeTask?.value){const i=this._arcadeTask.value.Feature.createFromGraphicLikeObject(t.geometry,t.attributes,e,null);for(const e of this.calculatedExpressions)try{r[`expression/${e.name}`]=e.func({vars:{$feature:i}})}catch{}}const a={...t.attributes,...r};return{global:this._featureUtils.formatAttributes({fieldInfos:s,attributes:a,graphic:t,timeZone:i,layer:e,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(e){return(0,p.nw)(e).filter((e=>!(0===e.indexOf("relationships/")||0===e.indexOf("expression/"))))}};(0,s._)([(0,l.MZ)({readOnly:!0})],u.prototype,"_arcadeTask",null),(0,s._)([(0,l.MZ)()],u.prototype,"_featureUtils",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],u.prototype,"featureUtilsPromise",null),(0,s._)([(0,l.MZ)({readOnly:!0})],u.prototype,"calculatedExpressions",null),(0,s._)([(0,l.MZ)()],u.prototype,"displayField",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"effectivePopupTemplate",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"expressionsUsedInTitle",null),(0,s._)([(0,l.MZ)()],u.prototype,"fieldsIndex",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"fieldInfoMap",null),(0,s._)([(0,l.MZ)()],u.prototype,"fields",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"objectIdField",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"requiredFields",null),u=(0,s._)([(0,d.$)("esri.layers.support.TitleCreator")],u)}}]);